Using /etc/ansible/ansible.cfg as config file

PLAY [main] *************************************************************************************************************************************************

TASK [Detach Interface] *************************************************************************************************************************************
changed: [localhost] => (item=[{u'ns_name': u't1ns1', u'bridge_name': u't1br1'}, {u'vmif_m': u't1VM1if1_m', u'vm_mac': u'52:54:00:2b:e1:5c', u'name': u't1_VM1', u'vmif': u't1VM1if1', u'brif_m': u't1br1if1_m'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "virsh domiflist \"t1_VM1\" | grep -w \"t1VM1if1\" ; if [ $? -eq 0 ] ; then virsh detach-interface --domain \"t1_VM1\" --type direct --config ; fi\n", "delta": "0:00:00.045200", "end": "2019-11-18 03:42:36.173954", "item": [{"bridge_name": "t1br1", "ns_name": "t1ns1"}, {"brif_m": "t1br1if1_m", "name": "t1_VM1", "vm_mac": "52:54:00:2b:e1:5c", "vmif": "t1VM1if1", "vmif_m": "t1VM1if1_m"}], "rc": 0, "start": "2019-11-18 03:42:36.128754", "stderr": "", "stderr_lines": [], "stdout": "macvtap0   direct     t1VM1if1   rtl8139     52:54:00:2b:e1:5c\nInterface detached successfully", "stdout_lines": ["macvtap0   direct     t1VM1if1   rtl8139     52:54:00:2b:e1:5c", "Interface detached successfully"]}

TASK [Shutdown VMs] *****************************************************************************************************************************************
changed: [localhost] => (item=[{u'ns_name': u't1ns1', u'bridge_name': u't1br1'}, {u'vmif_m': u't1VM1if1_m', u'vm_mac': u'52:54:00:2b:e1:5c', u'name': u't1_VM1', u'vmif': u't1VM1if1', u'brif_m': u't1br1if1_m'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "virsh list --state-shutoff | grep -w \"t1_VM1\" ; if [ $? -ne 0 ] ; then virsh shutdown \"t1_VM1\" ; fi\n", "delta": "0:00:00.127472", "end": "2019-11-18 03:42:36.527465", "item": [{"bridge_name": "t1br1", "ns_name": "t1ns1"}, {"brif_m": "t1br1if1_m", "name": "t1_VM1", "vm_mac": "52:54:00:2b:e1:5c", "vmif": "t1VM1if1", "vmif_m": "t1VM1if1_m"}], "rc": 0, "start": "2019-11-18 03:42:36.399993", "stderr": "", "stderr_lines": [], "stdout": "Domain t1_VM1 is being shutdown", "stdout_lines": ["Domain t1_VM1 is being shutdown"]}

PLAY [worker] ***********************************************************************************************************************************************

TASK [Migrate VM images] ************************************************************************************************************************************
failed: [99.99.99.2] (item=[{u'ns_name': u't1ns1', u'bridge_name': u't1br1'}, {u'vmif_m': u't1VM1if1_m', u'vm_mac': u'52:54:00:2b:e1:5c', u'name': u't1_VM1', u'vmif': u't1VM1if1', u'brif_m': u't1br1if1_m'}]) => {"ansible_loop_var": "item", "changed": false, "checksum": "41cff74b446b3c3a412dce52e0915603bc08acf2", "expected_checksum": "11bdf3e8917b026d856abf034f3a9e472b05911d", "item": [{"bridge_name": "t1br1", "ns_name": "t1ns1"}, {"brif_m": "t1br1if1_m", "name": "t1_VM1", "vm_mac": "52:54:00:2b:e1:5c", "vmif": "t1VM1if1", "vmif_m": "t1VM1if1_m"}], "msg": "Copied file does not match the expected checksum. Transfer failed."}

PLAY RECAP **************************************************************************************************************************************************
99.99.99.2                 : ok=0    changed=0    unreachable=0    failed=1    skipped=0    rescued=0    ignored=0   
localhost                  : ok=2    changed=2    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0   

Using /etc/ansible/ansible.cfg as config file

PLAY [main] *************************************************************************************************************************************************

TASK [Detach Interface] *************************************************************************************************************************************
changed: [localhost] => (item=[{u'ns_name': u't1ns1', u'bridge_name': u't1br1'}, {u'vmif_m': u't1VM1if1_m', u'vm_mac': u'', u'name': u't1_VM1', u'vmif': u't1VM1if1', u'brif_m': u't1br1if1_m'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "virsh domiflist \"t1_VM1\" | grep -w \"t1VM1if1\" ; if [ $? -eq 0 ] ; then virsh detach-interface --domain \"t1_VM1\" --type direct --config ; fi\n", "delta": "0:00:00.023562", "end": "2019-11-18 03:50:45.624109", "item": [{"bridge_name": "t1br1", "ns_name": "t1ns1"}, {"brif_m": "t1br1if1_m", "name": "t1_VM1", "vm_mac": "", "vmif": "t1VM1if1", "vmif_m": "t1VM1if1_m"}], "rc": 0, "start": "2019-11-18 03:50:45.600547", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Shutdown VMs] *****************************************************************************************************************************************
changed: [localhost] => (item=[{u'ns_name': u't1ns1', u'bridge_name': u't1br1'}, {u'vmif_m': u't1VM1if1_m', u'vm_mac': u'', u'name': u't1_VM1', u'vmif': u't1VM1if1', u'brif_m': u't1br1if1_m'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "virsh list --state-shutoff | grep -w \"t1_VM1\" ; if [ $? -ne 0 ] ; then virsh shutdown \"t1_VM1\" ; fi\n", "delta": "0:00:00.020328", "end": "2019-11-18 03:50:45.906780", "item": [{"bridge_name": "t1br1", "ns_name": "t1ns1"}, {"brif_m": "t1br1if1_m", "name": "t1_VM1", "vm_mac": "", "vmif": "t1VM1if1", "vmif_m": "t1VM1if1_m"}], "rc": 0, "start": "2019-11-18 03:50:45.886452", "stderr": "", "stderr_lines": [], "stdout": " -     t1_VM1                         shut off", "stdout_lines": [" -     t1_VM1                         shut off"]}

PLAY [worker] ***********************************************************************************************************************************************

TASK [Migrate VM images] ************************************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'ns_name': u't1ns1', u'bridge_name': u't1br1'}, {u'vmif_m': u't1VM1if1_m', u'vm_mac': u'', u'name': u't1_VM1', u'vmif': u't1VM1if1', u'brif_m': u't1br1if1_m'}]) => {"ansible_loop_var": "item", "changed": true, "checksum": "41cff74b446b3c3a412dce52e0915603bc08acf2", "dest": "/var/lib/libvirt/images/t1_VM1.qcow2", "gid": 0, "group": "root", "item": [{"bridge_name": "t1br1", "ns_name": "t1ns1"}, {"brif_m": "t1br1if1_m", "name": "t1_VM1", "vm_mac": "", "vmif": "t1VM1if1", "vmif_m": "t1VM1if1_m"}], "md5sum": "2f6ecf9672a6d5773f7e128806763aa7", "mode": "0644", "owner": "root", "size": 10739318784, "src": "/root/.ansible/tmp/ansible-tmp-1574049045.98-202324241758085/source", "state": "file", "uid": 0}

TASK [Migrate VM templates] *********************************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'ns_name': u't1ns1', u'bridge_name': u't1br1'}, {u'vmif_m': u't1VM1if1_m', u'vm_mac': u'', u'name': u't1_VM1', u'vmif': u't1VM1if1', u'brif_m': u't1br1if1_m'}]) => {"ansible_loop_var": "item", "changed": true, "checksum": "713e53f22c957623f54f9e47094bab05c28a5b82", "dest": "/etc/libvirt/qemu/t1_VM1.xml", "gid": 0, "group": "root", "item": [{"bridge_name": "t1br1", "ns_name": "t1ns1"}, {"brif_m": "t1br1if1_m", "name": "t1_VM1", "vm_mac": "", "vmif": "t1VM1if1", "vmif_m": "t1VM1if1_m"}], "md5sum": "9971f41cb19f5c5083f8b174fc0861f4", "mode": "0644", "owner": "root", "size": 4252, "src": "/root/.ansible/tmp/ansible-tmp-1574049310.65-193065841914947/source", "state": "file", "uid": 0}

TASK [Get list of running VMs] ******************************************************************************************************************************
ok: [99.99.99.2] => {"changed": false, "cmd": ["virsh", "list", "--name"], "delta": "0:00:00.076467", "end": "2019-11-18 03:55:11.400726", "rc": 0, "start": "2019-11-18 03:55:11.324259", "stderr": "", "stderr_lines": [], "stdout": "t1_VM4", "stdout_lines": ["t1_VM4"]}

TASK [Define VM] ********************************************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'ns_name': u't1ns1', u'bridge_name': u't1br1'}, {u'vmif_m': u't1VM1if1_m', u'vm_mac': u'', u'name': u't1_VM1', u'vmif': u't1VM1if1', u'brif_m': u't1br1if1_m'}]) => {"ansible_loop_var": "item", "changed": true, "created": "t1_VM1", "item": [{"bridge_name": "t1br1", "ns_name": "t1ns1"}, {"brif_m": "t1br1if1_m", "name": "t1_VM1", "vm_mac": "", "vmif": "t1VM1if1", "vmif_m": "t1VM1if1_m"}], "warnings": ["'xml' is given - ignoring 'name'"]}

TASK [Create VM] ********************************************************************************************************************************************
ok: [99.99.99.2] => (item=[{u'ns_name': u't1ns1', u'bridge_name': u't1br1'}, {u'vmif_m': u't1VM1if1_m', u'vm_mac': u'', u'name': u't1_VM1', u'vmif': u't1VM1if1', u'brif_m': u't1br1if1_m'}]) => {"ansible_loop_var": "item", "changed": false, "create": 0, "item": [{"bridge_name": "t1br1", "ns_name": "t1ns1"}, {"brif_m": "t1br1if1_m", "name": "t1_VM1", "vm_mac": "", "vmif": "t1VM1if1", "vmif_m": "t1VM1if1_m"}]}

TASK [Start VM] *********************************************************************************************************************************************
ok: [99.99.99.2] => (item=[{u'ns_name': u't1ns1', u'bridge_name': u't1br1'}, {u'vmif_m': u't1VM1if1_m', u'vm_mac': u'', u'name': u't1_VM1', u'vmif': u't1VM1if1', u'brif_m': u't1br1if1_m'}]) => {"ansible_loop_var": "item", "changed": false, "item": [{"bridge_name": "t1br1", "ns_name": "t1ns1"}, {"brif_m": "t1br1if1_m", "name": "t1_VM1", "vm_mac": "", "vmif": "t1VM1if1", "vmif_m": "t1VM1if1_m"}]}

TASK [Create VETH Pairs] ************************************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'ns_name': u't1ns1', u'bridge_name': u't1br1'}, {u'vmif_m': u't1VM1if1_m', u'vm_mac': u'', u'name': u't1_VM1', u'vmif': u't1VM1if1', u'brif_m': u't1br1if1_m'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip link show \"t1br1if1_m\" ; if [ $? -ne 0 ] ; then ip link add \"t1VM1if1_m\" type veth peer name \"t1br1if1_m\" ; fi\nip link set dev \"t1br1if1_m\" up\nip link set dev \"t1VM1if1_m\" up\n", "delta": "0:00:00.033740", "end": "2019-11-18 03:55:13.893601", "item": [{"bridge_name": "t1br1", "ns_name": "t1ns1"}, {"brif_m": "t1br1if1_m", "name": "t1_VM1", "vm_mac": "", "vmif": "t1VM1if1", "vmif_m": "t1VM1if1_m"}], "rc": 0, "start": "2019-11-18 03:55:13.859861", "stderr": "Device \"t1br1if1_m\" does not exist.", "stderr_lines": ["Device \"t1br1if1_m\" does not exist."], "stdout": "", "stdout_lines": []}

TASK [Attach VETH Pairs] ************************************************************************************************************************************
failed: [99.99.99.2] (item=[{u'ns_name': u't1ns1', u'bridge_name': u't1br1'}, {u'vmif_m': u't1VM1if1_m', u'vm_mac': u'', u'name': u't1_VM1', u'vmif': u't1VM1if1', u'brif_m': u't1br1if1_m'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip link show \"t1br1if1_m\" ; if [ $? -eq 0 ] ; then ip link set \"t1br1if1_m\" netns \"t1ns1\" ; fi\nip netns exec \"t1ns1\" brctl show \"t1br1\" | grep -w 't1br1if1_m' ; if [ $? -ne 0 ] ; then ip netns exec \"t1ns1\" brctl addif \"t1br1\" \"t1br1if1_m\" ; fi\nvirsh domiflist \"t1_VM1\" | grep -w \"t1VM1if1_m\" ; if [ $? -ne 0 ] ; then virsh attach-interface --domain \"t1_VM1\" direct \"t1VM1if1_m\" --live --persistent --mac \"\" ; fi\n", "delta": "0:00:00.169578", "end": "2019-11-18 03:55:14.347195", "item": [{"bridge_name": "t1br1", "ns_name": "t1ns1"}, {"brif_m": "t1br1if1_m", "name": "t1_VM1", "vm_mac": "", "vmif": "t1VM1if1", "vmif_m": "t1VM1if1_m"}], "msg": "non-zero return code", "rc": 1, "start": "2019-11-18 03:55:14.177617", "stderr": "error: Failed to get option 'mac': Option argument is empty", "stderr_lines": ["error: Failed to get option 'mac': Option argument is empty"], "stdout": "21: t1br1if1_m@t1VM1if1_m: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP mode DEFAULT group default qlen 1000\n    link/ether 9e:41:08:b6:91:bb brd ff:ff:ff:ff:ff:ff", "stdout_lines": ["21: t1br1if1_m@t1VM1if1_m: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP mode DEFAULT group default qlen 1000", "    link/ether 9e:41:08:b6:91:bb brd ff:ff:ff:ff:ff:ff"]}

PLAY RECAP **************************************************************************************************************************************************
99.99.99.2                 : ok=7    changed=4    unreachable=0    failed=1    skipped=0    rescued=0    ignored=0   
localhost                  : ok=2    changed=2    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0   

