INFO:root: 16:52:28.976380 Printing the yaml input file
INFO:root: 16:52:28.976497 {'C1': [{'VM': [{'disk': '10G', 'internet_access': True, 'mem': 2, 'name': 'VM1', 'vcpu': 4}, {'disk': '10G', 'internet_access': False, 'mem': 4, 'name': 'VM2', 'vcpu': 2}], 'subnet_addr': '1.1.1.0/24'}], 'C2': [{'VM': [{'disk': '10G', 'internet_access': True, 'mem': 2, 'name': 'VM4', 'vcpu': 4}], 'subnet_addr': '1.1.1.0/24'}, {'VM': [{'disk': '10G', 'internet_access': True, 'mem': 3, 'name': 'VM3', 'vcpu': 2}], 'subnet_addr': '2.2.2.0/24'}], 'MISC': [{'LOG_ENABLE': True}, {'GUI': True}]}
INFO:root: 16:52:28.976587 Provided subnet in C1: 1.1.1.0/24 is valid
INFO:root: 16:52:28.976635 Provided subnet in C2: 1.1.1.0/24 is valid
INFO:root: 16:52:28.976675 Provided subnet in C2: 2.2.2.0/24 is valid
Using /etc/ansible/ansible.cfg as config file

PLAY [main] *************************************************************************************************************************************************

TASK [Create Tenant Namespace] ******************************************************************************************************************************
changed: [localhost] => (item={u'default_route_ip': u'192.168.1.1', u'name': u't1', u'pns_ip': u'192.168.1.1/24', u'tenant_if': u't1if', u'tenant_ip': u'192.168.1.2/24', u'pns_if': u't1pns_if'}) => {"ansible_loop_var": "item", "changed": true, "cmd": ["ip", "netns", "add", "t1"], "delta": "0:00:00.051055", "end": "2019-12-05 16:52:30.383068", "item": {"default_route_ip": "192.168.1.1", "name": "t1", "pns_if": "t1pns_if", "pns_ip": "192.168.1.1/24", "tenant_if": "t1if", "tenant_ip": "192.168.1.2/24"}, "rc": 0, "start": "2019-12-05 16:52:30.332013", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Create Subnet Namespace] ******************************************************************************************************************************
changed: [localhost] => (item={u'route': [{u'ip': u'10.1.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.1.2/24', u'tenant_ns_ip': u'10.1.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_ns_name': u't1', u'tenant_sub_if': u't1s1if'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't1_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM1if1'}, {u'mem': 4, u'name': u't1_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br1if2', u'vmif': u't1VM2if1'}], u'vxlan': [{u'local_ip': u'10.1.1.2', u'tenant_route_ip': u'192.168.1.2', u'dsport': 4789, u'dev': u't1s1if', u'subnet_route': u'10.1.1.0/24', u'remote_route': u'10.2.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.2.1.2'}]}) => {"ansible_loop_var": "item", "changed": true, "cmd": ["ip", "netns", "add", "t1ns1"], "delta": "0:00:00.054900", "end": "2019-12-05 16:52:30.713779", "item": {"bridge_name": "t1br1", "default_route_ip": "10.1.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.5", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.1.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.1.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.1.1.2/24"}], "vms": [{"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM1", "vcpu": 4, "vmif": "t1VM1if1"}, {"brif": "t1br1if2", "disk": "10G", "mem": 4, "name": "t1_VM2", "vcpu": 2, "vmif": "t1VM2if1"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.1.2", "remote_ip": "10.2.1.2", "remote_route": "10.2.1.0/24", "subnet_route": "10.1.1.0/24", "tenant_route_ip": "192.168.1.2", "v_name": "vxlan_t1s1"}]}, "rc": 0, "start": "2019-12-05 16:52:30.658879", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Create Tenant VETH pairs] *****************************************************************************************************************************
changed: [localhost] => (item={u'default_route_ip': u'192.168.1.1', u'name': u't1', u'pns_ip': u'192.168.1.1/24', u'tenant_if': u't1if', u'tenant_ip': u'192.168.1.2/24', u'pns_if': u't1pns_if'}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip link show \"t1if\" ; if [ $? -ne 0 ] ; then ip link add \"t1if\" type veth peer name \"t1pns_if\" ; fi\n", "delta": "0:00:00.011267", "end": "2019-12-05 16:52:31.029614", "item": {"default_route_ip": "192.168.1.1", "name": "t1", "pns_if": "t1pns_if", "pns_ip": "192.168.1.1/24", "tenant_if": "t1if", "tenant_ip": "192.168.1.2/24"}, "rc": 0, "start": "2019-12-05 16:52:31.018347", "stderr": "Device \"t1if\" does not exist.", "stderr_lines": ["Device \"t1if\" does not exist."], "stdout": "", "stdout_lines": []}

TASK [Attach Tenant VETH Pairs] *****************************************************************************************************************************
changed: [localhost] => (item={u'default_route_ip': u'192.168.1.1', u'name': u't1', u'pns_ip': u'192.168.1.1/24', u'tenant_if': u't1if', u'tenant_ip': u'192.168.1.2/24', u'pns_if': u't1pns_if'}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec pns ip link show \"t1pns_if\" ; if [ $? -ne 0 ] ; then ip link set \"t1pns_if\" netns pns ; fi\nip netns exec \"t1\" ip link show \"t1if\" ; if [ $? -ne 0 ] ; then ip link set \"t1if\" netns \"t1\" ; fi\nip netns exec pns ip link set dev \"t1pns_if\" up\nip netns exec \"t1\" ip link set dev \"t1if\" up\n", "delta": "0:00:00.209792", "end": "2019-12-05 16:52:31.534822", "item": {"default_route_ip": "192.168.1.1", "name": "t1", "pns_if": "t1pns_if", "pns_ip": "192.168.1.1/24", "tenant_if": "t1if", "tenant_ip": "192.168.1.2/24"}, "rc": 0, "start": "2019-12-05 16:52:31.325030", "stderr": "Device \"t1pns_if\" does not exist.\nDevice \"t1if\" does not exist.", "stderr_lines": ["Device \"t1pns_if\" does not exist.", "Device \"t1if\" does not exist."], "stdout": "", "stdout_lines": []}

TASK [Add IP addresses to Tenant VETH Pairs] ****************************************************************************************************************
changed: [localhost] => (item={u'default_route_ip': u'192.168.1.1', u'name': u't1', u'pns_ip': u'192.168.1.1/24', u'tenant_if': u't1if', u'tenant_ip': u'192.168.1.2/24', u'pns_if': u't1pns_if'}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec pns ip addr show \"t1pns_if\" | awk 'FNR==3{ print $2 }' | grep -w '^192.168.1.1/24' ; if [ $? -ne 0 ] ; then ip netns exec pns ip addr add \"192.168.1.1/24\" dev \"t1pns_if\" ; fi\nip netns exec \"t1\" ip addr show \"t1if\" | awk 'FNR==3{ print $2 }' | grep -w '^192.168.1.2/24' ; if [ $? -ne 0 ] ; then ip netns exec \"t1\" ip addr add \"192.168.1.2/24\" dev \"t1if\" ; fi\n", "delta": "0:00:00.160078", "end": "2019-12-05 16:52:31.946818", "item": {"default_route_ip": "192.168.1.1", "name": "t1", "pns_if": "t1pns_if", "pns_ip": "192.168.1.1/24", "tenant_if": "t1if", "tenant_ip": "192.168.1.2/24"}, "rc": 0, "start": "2019-12-05 16:52:31.786740", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Create Namespace VETH Pairs] **************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't1_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM1if1'}, {u'mem': 4, u'name': u't1_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br1if2', u'vmif': u't1VM2if1'}], u'vxlan': [{u'local_ip': u'10.1.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.1.2', u'remote_route': u'10.2.1.0/24', u'subnet_route': u'10.1.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.2.1.2'}]}, {u'tenant_sub_ip': u'10.1.1.2/24', u'tenant_ns_ip': u'10.1.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip link show \"t1ns1if\" ; if [ $? -ne 0 ] ; then ip link add \"t1ns1if\" type veth peer name \"t1s1if\" ; fi\n", "delta": "0:00:00.012294", "end": "2019-12-05 16:52:32.222447", "item": [{"bridge_name": "t1br1", "default_route_ip": "10.1.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.5", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.1.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "vms": [{"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM1", "vcpu": 4, "vmif": "t1VM1if1"}, {"brif": "t1br1if2", "disk": "10G", "mem": 4, "name": "t1_VM2", "vcpu": 2, "vmif": "t1VM2if1"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.1.2", "remote_ip": "10.2.1.2", "remote_route": "10.2.1.0/24", "subnet_route": "10.1.1.0/24", "tenant_route_ip": "192.168.1.2", "v_name": "vxlan_t1s1"}]}, {"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.1.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.1.1.2/24"}], "rc": 0, "start": "2019-12-05 16:52:32.210153", "stderr": "Device \"t1ns1if\" does not exist.", "stderr_lines": ["Device \"t1ns1if\" does not exist."], "stdout": "", "stdout_lines": []}

TASK [Attach Namespace VETH Pairs] **************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't1_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM1if1'}, {u'mem': 4, u'name': u't1_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br1if2', u'vmif': u't1VM2if1'}], u'vxlan': [{u'local_ip': u'10.1.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.1.2', u'remote_route': u'10.2.1.0/24', u'subnet_route': u'10.1.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.2.1.2'}]}, {u'tenant_sub_ip': u'10.1.1.2/24', u'tenant_ns_ip': u'10.1.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t1\" ip link show \"t1ns1if\" ; if [ $? -ne 0 ] ; then ip link set \"t1ns1if\" netns \"t1\" ; fi\nip netns exec \"t1ns1\" ip link show \"t1s1if\" ; if [ $? -ne 0 ] ; then ip link set \"t1s1if\" netns \"t1ns1\" ; fi\n", "delta": "0:00:00.127908", "end": "2019-12-05 16:52:32.607207", "item": [{"bridge_name": "t1br1", "default_route_ip": "10.1.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.5", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.1.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "vms": [{"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM1", "vcpu": 4, "vmif": "t1VM1if1"}, {"brif": "t1br1if2", "disk": "10G", "mem": 4, "name": "t1_VM2", "vcpu": 2, "vmif": "t1VM2if1"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.1.2", "remote_ip": "10.2.1.2", "remote_route": "10.2.1.0/24", "subnet_route": "10.1.1.0/24", "tenant_route_ip": "192.168.1.2", "v_name": "vxlan_t1s1"}]}, {"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.1.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.1.1.2/24"}], "rc": 0, "start": "2019-12-05 16:52:32.479299", "stderr": "Device \"t1ns1if\" does not exist.\nDevice \"t1s1if\" does not exist.", "stderr_lines": ["Device \"t1ns1if\" does not exist.", "Device \"t1s1if\" does not exist."], "stdout": "", "stdout_lines": []}

TASK [Set Namespace VETH Pairs UP] **************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't1_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM1if1'}, {u'mem': 4, u'name': u't1_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br1if2', u'vmif': u't1VM2if1'}], u'vxlan': [{u'local_ip': u'10.1.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.1.2', u'remote_route': u'10.2.1.0/24', u'subnet_route': u'10.1.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.2.1.2'}]}, {u'tenant_sub_ip': u'10.1.1.2/24', u'tenant_ns_ip': u'10.1.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t1\" ip link set dev \"t1ns1if\" up\nip netns exec \"t1ns1\" ip link set dev \"t1s1if\" up\n", "delta": "0:00:00.070493", "end": "2019-12-05 16:52:32.938782", "item": [{"bridge_name": "t1br1", "default_route_ip": "10.1.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.5", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.1.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "vms": [{"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM1", "vcpu": 4, "vmif": "t1VM1if1"}, {"brif": "t1br1if2", "disk": "10G", "mem": 4, "name": "t1_VM2", "vcpu": 2, "vmif": "t1VM2if1"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.1.2", "remote_ip": "10.2.1.2", "remote_route": "10.2.1.0/24", "subnet_route": "10.1.1.0/24", "tenant_route_ip": "192.168.1.2", "v_name": "vxlan_t1s1"}]}, {"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.1.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.1.1.2/24"}], "rc": 0, "start": "2019-12-05 16:52:32.868289", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Add IP addresses to Namespace VETH Pairs] *************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't1_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM1if1'}, {u'mem': 4, u'name': u't1_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br1if2', u'vmif': u't1VM2if1'}], u'vxlan': [{u'local_ip': u'10.1.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.1.2', u'remote_route': u'10.2.1.0/24', u'subnet_route': u'10.1.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.2.1.2'}]}, {u'tenant_sub_ip': u'10.1.1.2/24', u'tenant_ns_ip': u'10.1.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t1ns1\" ip addr show \"t1s1if\" | awk 'FNR==3{ print $2 }' | grep -w '^10.1.1.2/24' ; if [ $? -ne 0 ] ; then ip netns exec \"t1ns1\" ip addr add \"10.1.1.2/24\" dev \"t1s1if\" ; fi\n\nip netns exec \"t1\" ip addr show \"t1ns1if\" | awk 'FNR==3{ print $2 }' | grep -w '^10.1.1.1/24' ; if [ $? -ne 0 ] ; then ip netns exec \"t1\" ip addr add \"10.1.1.1/24\" dev \"t1ns1if\" ; fi\n", "delta": "0:00:00.171846", "end": "2019-12-05 16:52:33.382943", "item": [{"bridge_name": "t1br1", "default_route_ip": "10.1.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.5", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.1.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "vms": [{"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM1", "vcpu": 4, "vmif": "t1VM1if1"}, {"brif": "t1br1if2", "disk": "10G", "mem": 4, "name": "t1_VM2", "vcpu": 2, "vmif": "t1VM2if1"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.1.2", "remote_ip": "10.2.1.2", "remote_route": "10.2.1.0/24", "subnet_route": "10.1.1.0/24", "tenant_route_ip": "192.168.1.2", "v_name": "vxlan_t1s1"}]}, {"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.1.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.1.1.2/24"}], "rc": 0, "start": "2019-12-05 16:52:33.211097", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Add IP Route to Tenant] *******************************************************************************************************************************
changed: [localhost] => (item={u'default_route_ip': u'192.168.1.1', u'name': u't1', u'pns_ip': u'192.168.1.1/24', u'tenant_if': u't1if', u'tenant_ip': u'192.168.1.2/24', u'pns_if': u't1pns_if'}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t1\" ip route show default | grep -w '[d]efault via 192.168.1.1' ; if [ $? -ne 0 ] ; then ip netns exec \"t1\" ip route add default via \"192.168.1.1\" ; fi\n", "delta": "0:00:00.066323", "end": "2019-12-05 16:52:33.738773", "item": {"default_route_ip": "192.168.1.1", "name": "t1", "pns_if": "t1pns_if", "pns_ip": "192.168.1.1/24", "tenant_if": "t1if", "tenant_ip": "192.168.1.2/24"}, "rc": 0, "start": "2019-12-05 16:52:33.672450", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Add IP Route to Tenant Subnet] ************************************************************************************************************************
changed: [localhost] => (item={u'route': [{u'ip': u'10.1.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.1.2/24', u'tenant_ns_ip': u'10.1.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_ns_name': u't1', u'tenant_sub_if': u't1s1if'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't1_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM1if1'}, {u'mem': 4, u'name': u't1_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br1if2', u'vmif': u't1VM2if1'}], u'vxlan': [{u'local_ip': u'10.1.1.2', u'tenant_route_ip': u'192.168.1.2', u'dsport': 4789, u'dev': u't1s1if', u'subnet_route': u'10.1.1.0/24', u'remote_route': u'10.2.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.2.1.2'}]}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t1ns1\" ip route show default | grep -w '[d]efault via 10.1.1.1' ; if [ $? -ne 0 ] ; then ip netns exec \"t1ns1\" ip route add default via \"10.1.1.1\" ; fi\n", "delta": "0:00:00.068395", "end": "2019-12-05 16:52:34.062647", "item": {"bridge_name": "t1br1", "default_route_ip": "10.1.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.5", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.1.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.1.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.1.1.2/24"}], "vms": [{"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM1", "vcpu": 4, "vmif": "t1VM1if1"}, {"brif": "t1br1if2", "disk": "10G", "mem": 4, "name": "t1_VM2", "vcpu": 2, "vmif": "t1VM2if1"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.1.2", "remote_ip": "10.2.1.2", "remote_route": "10.2.1.0/24", "subnet_route": "10.1.1.0/24", "tenant_route_ip": "192.168.1.2", "v_name": "vxlan_t1s1"}]}, "rc": 0, "start": "2019-12-05 16:52:33.994252", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Create bridge inside namespace] ***********************************************************************************************************************
changed: [localhost] => (item={u'route': [{u'ip': u'10.1.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.1.2/24', u'tenant_ns_ip': u'10.1.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_ns_name': u't1', u'tenant_sub_if': u't1s1if'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't1_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM1if1'}, {u'mem': 4, u'name': u't1_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br1if2', u'vmif': u't1VM2if1'}], u'vxlan': [{u'local_ip': u'10.1.1.2', u'tenant_route_ip': u'192.168.1.2', u'dsport': 4789, u'dev': u't1s1if', u'subnet_route': u'10.1.1.0/24', u'remote_route': u'10.2.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.2.1.2'}]}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t1ns1\" brctl show | grep -w '^t1br1'; if [ $? -ne 0 ] ; then ip netns exec \"t1ns1\" brctl addbr \"t1br1\" ; fi\nip netns exec \"t1ns1\" ip link set dev \"t1br1\" up\n", "delta": "0:00:00.122736", "end": "2019-12-05 16:52:34.466749", "item": {"bridge_name": "t1br1", "default_route_ip": "10.1.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.5", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.1.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.1.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.1.1.2/24"}], "vms": [{"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM1", "vcpu": 4, "vmif": "t1VM1if1"}, {"brif": "t1br1if2", "disk": "10G", "mem": 4, "name": "t1_VM2", "vcpu": 2, "vmif": "t1VM2if1"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.1.2", "remote_ip": "10.2.1.2", "remote_route": "10.2.1.0/24", "subnet_route": "10.1.1.0/24", "tenant_route_ip": "192.168.1.2", "v_name": "vxlan_t1s1"}]}, "rc": 0, "start": "2019-12-05 16:52:34.344013", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Create DNS VETH Pair] *********************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.1.1', u'bridge_name': u't1br1', u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.1.2/24', u'tenant_ns_ip': u'10.1.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't1_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM1if1'}, {u'mem': 4, u'name': u't1_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br1if2', u'vmif': u't1VM2if1'}], u'vxlan': [{u'local_ip': u'10.1.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.1.2', u'remote_route': u'10.2.1.0/24', u'subnet_route': u'10.1.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.2.1.2'}]}, {u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t1ns1\" ip link show \"t1s1_dnsbrif\" ; if [ $? -ne 0 ] ; then ip netns exec \"t1ns1\" ip link add \"t1s1_dnsbrif\" type veth peer name \"t1s1_dnsif\" ; fi\nip netns exec \"t1ns1\" ip link set dev \"t1s1_dnsbrif\" up\nip netns exec \"t1ns1\" ip link set dev \"t1s1_dnsif\" up\n", "delta": "0:00:00.135660", "end": "2019-12-05 16:52:34.879036", "item": [{"bridge_name": "t1br1", "default_route_ip": "10.1.1.1", "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.1.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.1.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.1.1.2/24"}], "vms": [{"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM1", "vcpu": 4, "vmif": "t1VM1if1"}, {"brif": "t1br1if2", "disk": "10G", "mem": 4, "name": "t1_VM2", "vcpu": 2, "vmif": "t1VM2if1"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.1.2", "remote_ip": "10.2.1.2", "remote_route": "10.2.1.0/24", "subnet_route": "10.1.1.0/24", "tenant_route_ip": "192.168.1.2", "v_name": "vxlan_t1s1"}]}, {"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.5", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "rc": 0, "start": "2019-12-05 16:52:34.743376", "stderr": "Device \"t1s1_dnsbrif\" does not exist.", "stderr_lines": ["Device \"t1s1_dnsbrif\" does not exist."], "stdout": "", "stdout_lines": []}

TASK [Attach DNS VETH Pair] *********************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.1.1', u'bridge_name': u't1br1', u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.1.2/24', u'tenant_ns_ip': u'10.1.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't1_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM1if1'}, {u'mem': 4, u'name': u't1_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br1if2', u'vmif': u't1VM2if1'}], u'vxlan': [{u'local_ip': u'10.1.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.1.2', u'remote_route': u'10.2.1.0/24', u'subnet_route': u'10.1.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.2.1.2'}]}, {u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t1ns1\" brctl show \"t1br1\" | grep -w 't1s1_dnsbrif' ; if [ $? -ne 0 ] ; then ip netns exec \"t1ns1\" brctl addif \"t1br1\" \"t1s1_dnsbrif\" ; fi\n", "delta": "0:00:00.070617", "end": "2019-12-05 16:52:35.214806", "item": [{"bridge_name": "t1br1", "default_route_ip": "10.1.1.1", "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.1.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.1.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.1.1.2/24"}], "vms": [{"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM1", "vcpu": 4, "vmif": "t1VM1if1"}, {"brif": "t1br1if2", "disk": "10G", "mem": 4, "name": "t1_VM2", "vcpu": 2, "vmif": "t1VM2if1"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.1.2", "remote_ip": "10.2.1.2", "remote_route": "10.2.1.0/24", "subnet_route": "10.1.1.0/24", "tenant_route_ip": "192.168.1.2", "v_name": "vxlan_t1s1"}]}, {"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.5", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "rc": 0, "start": "2019-12-05 16:52:35.144189", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Create VETH Pairs] ************************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.1.2/24', u'tenant_ns_ip': u'10.1.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.1.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.1.2', u'remote_route': u'10.2.1.0/24', u'subnet_route': u'10.1.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.2.1.2'}]}, {u'mem': 2, u'name': u't1_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM1if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip link show \"t1br1if1\" ; if [ $? -ne 0 ] ; then ip link add \"t1VM1if1\" type veth peer name \"t1br1if1\" ; fi\nip link set dev \"t1br1if1\" up\nip link set dev \"t1VM1if1\" up\n", "delta": "0:00:00.015518", "end": "2019-12-05 16:52:35.516995", "item": [{"bridge_name": "t1br1", "default_route_ip": "10.1.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.5", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.1.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.1.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.1.1.2/24"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.1.2", "remote_ip": "10.2.1.2", "remote_route": "10.2.1.0/24", "subnet_route": "10.1.1.0/24", "tenant_route_ip": "192.168.1.2", "v_name": "vxlan_t1s1"}]}, {"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM1", "vcpu": 4, "vmif": "t1VM1if1"}], "rc": 0, "start": "2019-12-05 16:52:35.501477", "stderr": "Device \"t1br1if1\" does not exist.", "stderr_lines": ["Device \"t1br1if1\" does not exist."], "stdout": "", "stdout_lines": []}
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.1.2/24', u'tenant_ns_ip': u'10.1.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.1.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.1.2', u'remote_route': u'10.2.1.0/24', u'subnet_route': u'10.1.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.2.1.2'}]}, {u'mem': 4, u'name': u't1_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br1if2', u'vmif': u't1VM2if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip link show \"t1br1if2\" ; if [ $? -ne 0 ] ; then ip link add \"t1VM2if1\" type veth peer name \"t1br1if2\" ; fi\nip link set dev \"t1br1if2\" up\nip link set dev \"t1VM2if1\" up\n", "delta": "0:00:00.017468", "end": "2019-12-05 16:52:35.755725", "item": [{"bridge_name": "t1br1", "default_route_ip": "10.1.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.5", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.1.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.1.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.1.1.2/24"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.1.2", "remote_ip": "10.2.1.2", "remote_route": "10.2.1.0/24", "subnet_route": "10.1.1.0/24", "tenant_route_ip": "192.168.1.2", "v_name": "vxlan_t1s1"}]}, {"brif": "t1br1if2", "disk": "10G", "mem": 4, "name": "t1_VM2", "vcpu": 2, "vmif": "t1VM2if1"}], "rc": 0, "start": "2019-12-05 16:52:35.738257", "stderr": "Device \"t1br1if2\" does not exist.", "stderr_lines": ["Device \"t1br1if2\" does not exist."], "stdout": "", "stdout_lines": []}

TASK [Attach VETH Pairs] ************************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.1.2/24', u'tenant_ns_ip': u'10.1.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.1.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.1.2', u'remote_route': u'10.2.1.0/24', u'subnet_route': u'10.1.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.2.1.2'}]}, {u'mem': 2, u'name': u't1_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM1if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip link show \"t1br1if1\" ; if [ $? -eq 0 ] ; then ip link set \"t1br1if1\" netns \"t1ns1\" ; fi\nip netns exec \"t1ns1\" brctl show \"t1br1\" | grep -w 't1br1if1' ; if [ $? -ne 0 ] ; then ip netns exec \"t1ns1\" brctl addif \"t1br1\" \"t1br1if1\" ; fi\n", "delta": "0:00:00.093665", "end": "2019-12-05 16:52:36.134626", "item": [{"bridge_name": "t1br1", "default_route_ip": "10.1.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.5", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.1.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.1.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.1.1.2/24"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.1.2", "remote_ip": "10.2.1.2", "remote_route": "10.2.1.0/24", "subnet_route": "10.1.1.0/24", "tenant_route_ip": "192.168.1.2", "v_name": "vxlan_t1s1"}]}, {"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM1", "vcpu": 4, "vmif": "t1VM1if1"}], "rc": 0, "start": "2019-12-05 16:52:36.040961", "stderr": "", "stderr_lines": [], "stdout": "20: t1br1if1@t1VM1if1: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP mode DEFAULT group default qlen 1000\n    link/ether 02:1f:74:7d:53:c1 brd ff:ff:ff:ff:ff:ff", "stdout_lines": ["20: t1br1if1@t1VM1if1: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP mode DEFAULT group default qlen 1000", "    link/ether 02:1f:74:7d:53:c1 brd ff:ff:ff:ff:ff:ff"]}
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.1.2/24', u'tenant_ns_ip': u'10.1.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.1.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.1.2', u'remote_route': u'10.2.1.0/24', u'subnet_route': u'10.1.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.2.1.2'}]}, {u'mem': 4, u'name': u't1_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br1if2', u'vmif': u't1VM2if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip link show \"t1br1if2\" ; if [ $? -eq 0 ] ; then ip link set \"t1br1if2\" netns \"t1ns1\" ; fi\nip netns exec \"t1ns1\" brctl show \"t1br1\" | grep -w 't1br1if2' ; if [ $? -ne 0 ] ; then ip netns exec \"t1ns1\" brctl addif \"t1br1\" \"t1br1if2\" ; fi\n", "delta": "0:00:00.092416", "end": "2019-12-05 16:52:36.426574", "item": [{"bridge_name": "t1br1", "default_route_ip": "10.1.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.5", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.1.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.1.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.1.1.2/24"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.1.2", "remote_ip": "10.2.1.2", "remote_route": "10.2.1.0/24", "subnet_route": "10.1.1.0/24", "tenant_route_ip": "192.168.1.2", "v_name": "vxlan_t1s1"}]}, {"brif": "t1br1if2", "disk": "10G", "mem": 4, "name": "t1_VM2", "vcpu": 2, "vmif": "t1VM2if1"}], "rc": 0, "start": "2019-12-05 16:52:36.334158", "stderr": "", "stderr_lines": [], "stdout": "22: t1br1if2@t1VM2if1: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP mode DEFAULT group default qlen 1000\n    link/ether c6:35:3c:ea:41:10 brd ff:ff:ff:ff:ff:ff", "stdout_lines": ["22: t1br1if2@t1VM2if1: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP mode DEFAULT group default qlen 1000", "    link/ether c6:35:3c:ea:41:10 brd ff:ff:ff:ff:ff:ff"]}

TASK [All interfaces and bridges UP] ************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.1.2/24', u'tenant_ns_ip': u'10.1.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.1.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.1.2', u'remote_route': u'10.2.1.0/24', u'subnet_route': u'10.1.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.2.1.2'}]}, {u'mem': 2, u'name': u't1_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM1if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t1ns1\" ip link set \"t1br1if1\" up\nip netns exec \"t1ns1\" ip link set dev \"t1br1\" up\n", "delta": "0:00:00.074070", "end": "2019-12-05 16:52:36.778802", "item": [{"bridge_name": "t1br1", "default_route_ip": "10.1.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.5", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.1.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.1.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.1.1.2/24"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.1.2", "remote_ip": "10.2.1.2", "remote_route": "10.2.1.0/24", "subnet_route": "10.1.1.0/24", "tenant_route_ip": "192.168.1.2", "v_name": "vxlan_t1s1"}]}, {"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM1", "vcpu": 4, "vmif": "t1VM1if1"}], "rc": 0, "start": "2019-12-05 16:52:36.704732", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.1.2/24', u'tenant_ns_ip': u'10.1.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.1.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.1.2', u'remote_route': u'10.2.1.0/24', u'subnet_route': u'10.1.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.2.1.2'}]}, {u'mem': 4, u'name': u't1_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br1if2', u'vmif': u't1VM2if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t1ns1\" ip link set \"t1br1if2\" up\nip netns exec \"t1ns1\" ip link set dev \"t1br1\" up\n", "delta": "0:00:00.069570", "end": "2019-12-05 16:52:37.079148", "item": [{"bridge_name": "t1br1", "default_route_ip": "10.1.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.5", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.1.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.1.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.1.1.2/24"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.1.2", "remote_ip": "10.2.1.2", "remote_route": "10.2.1.0/24", "subnet_route": "10.1.1.0/24", "tenant_route_ip": "192.168.1.2", "v_name": "vxlan_t1s1"}]}, {"brif": "t1br1if2", "disk": "10G", "mem": 4, "name": "t1_VM2", "vcpu": 2, "vmif": "t1VM2if1"}], "rc": 0, "start": "2019-12-05 16:52:37.009578", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Add IP to DNS Interface] ******************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.1.1', u'bridge_name': u't1br1', u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.1.2/24', u'tenant_ns_ip': u'10.1.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't1_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM1if1'}, {u'mem': 4, u'name': u't1_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br1if2', u'vmif': u't1VM2if1'}], u'vxlan': [{u'local_ip': u'10.1.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.1.2', u'remote_route': u'10.2.1.0/24', u'subnet_route': u'10.1.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.2.1.2'}]}, {u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t1ns1\" ip addr show \"t1s1_dnsif\" | awk 'FNR==3{ print $2 }' | grep -w '^1.1.1.1/24' ; if [ $? -ne 0 ] ; then ip netns exec \"t1ns1\" ip addr add \"1.1.1.1/24\" dev \"t1s1_dnsif\" ; fi\n", "delta": "0:00:00.093861", "end": "2019-12-05 16:52:37.470915", "item": [{"bridge_name": "t1br1", "default_route_ip": "10.1.1.1", "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.1.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.1.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.1.1.2/24"}], "vms": [{"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM1", "vcpu": 4, "vmif": "t1VM1if1"}, {"brif": "t1br1if2", "disk": "10G", "mem": 4, "name": "t1_VM2", "vcpu": 2, "vmif": "t1VM2if1"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.1.2", "remote_ip": "10.2.1.2", "remote_route": "10.2.1.0/24", "subnet_route": "10.1.1.0/24", "tenant_route_ip": "192.168.1.2", "v_name": "vxlan_t1s1"}]}, {"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.5", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "rc": 0, "start": "2019-12-05 16:52:37.377054", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Install DHCP Server] **********************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.1.1', u'bridge_name': u't1br1', u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.1.2/24', u'tenant_ns_ip': u'10.1.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't1_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM1if1'}, {u'mem': 4, u'name': u't1_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br1if2', u'vmif': u't1VM2if1'}], u'vxlan': [{u'local_ip': u'10.1.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.1.2', u'remote_route': u'10.2.1.0/24', u'subnet_route': u'10.1.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.2.1.2'}]}, {u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t1ns1\" ps aux | grep -w '[d]nsmasq --interface t1s1_dnsif -z --dhcp-range=1.1.1.5,1.1.1.254' ; if [ $? -ne 0 ] ; then ip netns exec \"t1ns1\" dnsmasq --interface \"t1s1_dnsif\" -z --dhcp-range=1.1.1.5,'1.1.1.254' ; fi\n", "delta": "0:00:00.065813", "end": "2019-12-05 16:52:37.824358", "item": [{"bridge_name": "t1br1", "default_route_ip": "10.1.1.1", "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.1.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.1.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.1.1.2/24"}], "vms": [{"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM1", "vcpu": 4, "vmif": "t1VM1if1"}, {"brif": "t1br1if2", "disk": "10G", "mem": 4, "name": "t1_VM2", "vcpu": 2, "vmif": "t1VM2if1"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.1.2", "remote_ip": "10.2.1.2", "remote_route": "10.2.1.0/24", "subnet_route": "10.1.1.0/24", "tenant_route_ip": "192.168.1.2", "v_name": "vxlan_t1s1"}]}, {"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.5", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "rc": 0, "start": "2019-12-05 16:52:37.758545", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Create VXLAN devices] *********************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.1.2/24', u'tenant_ns_ip': u'10.1.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't1_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM1if1'}, {u'mem': 4, u'name': u't1_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br1if2', u'vmif': u't1VM2if1'}]}, {u'local_ip': u'10.1.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.1.2', u'remote_route': u'10.2.1.0/24', u'subnet_route': u'10.1.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.2.1.2'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t1ns1\" ip link show \"vxlan_t1s1\" ; if [ $? -ne 0 ] ; then ip netns exec \"t1ns1\" ip link add \"vxlan_t1s1\" type vxlan id \"42\" local \"10.1.1.2\" remote \"10.2.1.2\" dstport \"4789\" dev \"t1s1if\"; ip netns exec \"t1ns1\" ip link set dev \"vxlan_t1s1\" up ; fi\n", "delta": "0:00:00.138536", "end": "2019-12-05 16:52:38.246767", "item": [{"bridge_name": "t1br1", "default_route_ip": "10.1.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.5", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.1.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.1.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.1.1.2/24"}], "vms": [{"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM1", "vcpu": 4, "vmif": "t1VM1if1"}, {"brif": "t1br1if2", "disk": "10G", "mem": 4, "name": "t1_VM2", "vcpu": 2, "vmif": "t1VM2if1"}]}, {"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.1.2", "remote_ip": "10.2.1.2", "remote_route": "10.2.1.0/24", "subnet_route": "10.1.1.0/24", "tenant_route_ip": "192.168.1.2", "v_name": "vxlan_t1s1"}], "rc": 0, "start": "2019-12-05 16:52:38.108231", "stderr": "Device \"vxlan_t1s1\" does not exist.", "stderr_lines": ["Device \"vxlan_t1s1\" does not exist."], "stdout": "", "stdout_lines": []}

TASK [Attach VXLANs to bridge] ******************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.1.2/24', u'tenant_ns_ip': u'10.1.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't1_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM1if1'}, {u'mem': 4, u'name': u't1_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br1if2', u'vmif': u't1VM2if1'}]}, {u'local_ip': u'10.1.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.1.2', u'remote_route': u'10.2.1.0/24', u'subnet_route': u'10.1.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.2.1.2'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t1ns1\" brctl show \"t1br1\" | grep -w 'vxlan_t1s1' ; if [ $? -ne 0 ] ; then ip netns exec \"t1ns1\" brctl addif \"t1br1\" \"vxlan_t1s1\" ; fi\n", "delta": "0:00:00.072275", "end": "2019-12-05 16:52:38.595147", "item": [{"bridge_name": "t1br1", "default_route_ip": "10.1.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.5", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.1.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.1.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.1.1.2/24"}], "vms": [{"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM1", "vcpu": 4, "vmif": "t1VM1if1"}, {"brif": "t1br1if2", "disk": "10G", "mem": 4, "name": "t1_VM2", "vcpu": 2, "vmif": "t1VM2if1"}]}, {"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.1.2", "remote_ip": "10.2.1.2", "remote_route": "10.2.1.0/24", "subnet_route": "10.1.1.0/24", "tenant_route_ip": "192.168.1.2", "v_name": "vxlan_t1s1"}], "rc": 0, "start": "2019-12-05 16:52:38.522872", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

PLAY RECAP **************************************************************************************************************************************************
localhost                  : ok=21   changed=21   unreachable=0    failed=0    skipped=0    rescued=0    ignored=0   

Using /etc/ansible/ansible.cfg as config file

PLAY [worker] ***********************************************************************************************************************************************

TASK [Create Tenant Namespace] ******************************************************************************************************************************
changed: [99.99.99.2] => (item={u'default_route_ip': u'192.168.129.1', u'name': u't1', u'pns_ip': u'192.168.129.1/24', u'tenant_if': u't1if', u'tenant_ip': u'192.168.129.2/24', u'pns_if': u't1pns_if'}) => {"ansible_loop_var": "item", "changed": true, "cmd": ["ip", "netns", "add", "t1"], "delta": "0:00:00.053235", "end": "2019-12-05 16:52:40.577425", "item": {"default_route_ip": "192.168.129.1", "name": "t1", "pns_if": "t1pns_if", "pns_ip": "192.168.129.1/24", "tenant_if": "t1if", "tenant_ip": "192.168.129.2/24"}, "rc": 0, "start": "2019-12-05 16:52:40.524190", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Create Subnet Namespace] ******************************************************************************************************************************
changed: [99.99.99.2] => (item={u'route': [{u'ip': u'10.2.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.2.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.1.2/24', u'tenant_ns_ip': u'10.2.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_ns_name': u't1', u'tenant_sub_if': u't1s1if'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't1_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM4if1'}], u'vxlan': [{u'local_ip': u'10.2.1.2', u'tenant_route_ip': u'192.168.129.2', u'dsport': 4789, u'dev': u't1s1if', u'subnet_route': u'10.2.1.0/24', u'remote_route': u'10.1.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.1.1.2'}]}) => {"ansible_loop_var": "item", "changed": true, "cmd": ["ip", "netns", "add", "t1ns1"], "delta": "0:00:00.054638", "end": "2019-12-05 16:52:41.045925", "item": {"bridge_name": "t1br1", "default_route_ip": "10.2.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.5", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.2.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.2.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.2.1.2/24"}], "vms": [{"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM4", "vcpu": 4, "vmif": "t1VM4if1"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.1.2", "remote_ip": "10.1.1.2", "remote_route": "10.1.1.0/24", "subnet_route": "10.2.1.0/24", "tenant_route_ip": "192.168.129.2", "v_name": "vxlan_t1s1"}]}, "rc": 0, "start": "2019-12-05 16:52:40.991287", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}
changed: [99.99.99.2] => (item={u'route': [{u'ip': u'10.2.2.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.2.2.1', u'bridge_name': u't1br2', u'dns': [{u'dnsif': u't1s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s2_dnsbrif'}], u'ns_name': u't1ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.2.2/24', u'tenant_ns_ip': u'10.2.2.1/24', u'tenant_ns_if': u't1ns2if', u'tenant_ns_name': u't1', u'tenant_sub_if': u't1s2if'}], u'subnet_ip': u'2.2.2.0/24', u'vms': [{u'mem': 3, u'name': u't1_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br2if1', u'vmif': u't1VM3if1'}], u'vxlan': [{u'local_ip': [], u'tenant_route_ip': [], u'dsport': [], u'dev': [], u'subnet_route': [], u'remote_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}) => {"ansible_loop_var": "item", "changed": true, "cmd": ["ip", "netns", "add", "t1ns2"], "delta": "0:00:00.056921", "end": "2019-12-05 16:52:41.429606", "item": {"bridge_name": "t1br2", "default_route_ip": "10.2.2.1", "dns": [{"brif": "t1s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t1s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns2", "route": [{"if": "p1", "ip": "10.2.2.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "2.2.2.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns2if", "tenant_ns_ip": "10.2.2.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s2if", "tenant_sub_ip": "10.2.2.2/24"}], "vms": [{"brif": "t1br2if1", "disk": "10G", "mem": 3, "name": "t1_VM3", "vcpu": 2, "vmif": "t1VM3if1"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, "rc": 0, "start": "2019-12-05 16:52:41.372685", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Create Tenant VETH pairs] *****************************************************************************************************************************
changed: [99.99.99.2] => (item={u'default_route_ip': u'192.168.129.1', u'name': u't1', u'pns_ip': u'192.168.129.1/24', u'tenant_if': u't1if', u'tenant_ip': u'192.168.129.2/24', u'pns_if': u't1pns_if'}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip link show \"t1if\" ; if [ $? -ne 0 ] ; then ip link add \"t1if\" type veth peer name \"t1pns_if\" ; fi\n", "delta": "0:00:00.011517", "end": "2019-12-05 16:52:41.828724", "item": {"default_route_ip": "192.168.129.1", "name": "t1", "pns_if": "t1pns_if", "pns_ip": "192.168.129.1/24", "tenant_if": "t1if", "tenant_ip": "192.168.129.2/24"}, "rc": 0, "start": "2019-12-05 16:52:41.817207", "stderr": "Device \"t1if\" does not exist.", "stderr_lines": ["Device \"t1if\" does not exist."], "stdout": "", "stdout_lines": []}

TASK [Attach Tenant VETH Pairs] *****************************************************************************************************************************
changed: [99.99.99.2] => (item={u'default_route_ip': u'192.168.129.1', u'name': u't1', u'pns_ip': u'192.168.129.1/24', u'tenant_if': u't1if', u'tenant_ip': u'192.168.129.2/24', u'pns_if': u't1pns_if'}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec pns ip link show \"t1pns_if\" ; if [ $? -ne 0 ] ; then ip link set \"t1pns_if\" netns pns ; fi\nip netns exec \"t1\" ip link show \"t1if\" ; if [ $? -ne 0 ] ; then ip link set \"t1if\" netns \"t1\" ; fi\nip netns exec pns ip link set dev \"t1pns_if\" up\nip netns exec \"t1\" ip link set dev \"t1if\" up\n", "delta": "0:00:00.212929", "end": "2019-12-05 16:52:42.447771", "item": {"default_route_ip": "192.168.129.1", "name": "t1", "pns_if": "t1pns_if", "pns_ip": "192.168.129.1/24", "tenant_if": "t1if", "tenant_ip": "192.168.129.2/24"}, "rc": 0, "start": "2019-12-05 16:52:42.234842", "stderr": "Device \"t1pns_if\" does not exist.\nDevice \"t1if\" does not exist.", "stderr_lines": ["Device \"t1pns_if\" does not exist.", "Device \"t1if\" does not exist."], "stdout": "", "stdout_lines": []}

TASK [Add IP addresses to Tenant VETH Pairs] ****************************************************************************************************************
changed: [99.99.99.2] => (item={u'default_route_ip': u'192.168.129.1', u'name': u't1', u'pns_ip': u'192.168.129.1/24', u'tenant_if': u't1if', u'tenant_ip': u'192.168.129.2/24', u'pns_if': u't1pns_if'}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec pns ip addr show \"t1pns_if\" | awk 'FNR==3{ print $2 }' | grep -w '^192.168.129.1/24' ; if [ $? -ne 0 ] ; then ip netns exec pns ip addr add \"192.168.129.1/24\" dev \"t1pns_if\" ; fi\nip netns exec \"t1\" ip addr show \"t1if\" | awk 'FNR==3{ print $2 }' | grep -w '^192.168.129.2/24' ; if [ $? -ne 0 ] ; then ip netns exec \"t1\" ip addr add \"192.168.129.2/24\" dev \"t1if\" ; fi\n", "delta": "0:00:00.146538", "end": "2019-12-05 16:52:42.983821", "item": {"default_route_ip": "192.168.129.1", "name": "t1", "pns_if": "t1pns_if", "pns_ip": "192.168.129.1/24", "tenant_if": "t1if", "tenant_ip": "192.168.129.2/24"}, "rc": 0, "start": "2019-12-05 16:52:42.837283", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Create Namespace VETH Pairs] **************************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.2.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't1_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM4if1'}], u'vxlan': [{u'local_ip': u'10.2.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.129.2', u'remote_route': u'10.1.1.0/24', u'subnet_route': u'10.2.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.1.1.2'}]}, {u'tenant_sub_ip': u'10.2.1.2/24', u'tenant_ns_ip': u'10.2.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip link show \"t1ns1if\" ; if [ $? -ne 0 ] ; then ip link add \"t1ns1if\" type veth peer name \"t1s1if\" ; fi\n", "delta": "0:00:00.012089", "end": "2019-12-05 16:52:43.383506", "item": [{"bridge_name": "t1br1", "default_route_ip": "10.2.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.5", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.2.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "vms": [{"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM4", "vcpu": 4, "vmif": "t1VM4if1"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.1.2", "remote_ip": "10.1.1.2", "remote_route": "10.1.1.0/24", "subnet_route": "10.2.1.0/24", "tenant_route_ip": "192.168.129.2", "v_name": "vxlan_t1s1"}]}, {"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.2.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.2.1.2/24"}], "rc": 0, "start": "2019-12-05 16:52:43.371417", "stderr": "Device \"t1ns1if\" does not exist.", "stderr_lines": ["Device \"t1ns1if\" does not exist."], "stdout": "", "stdout_lines": []}
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.2.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.2.2.1', u'bridge_name': u't1br2', u'dns': [{u'dnsif': u't1s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s2_dnsbrif'}], u'ns_name': u't1ns2', u'subnet_ip': u'2.2.2.0/24', u'vms': [{u'mem': 3, u'name': u't1_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br2if1', u'vmif': u't1VM3if1'}], u'vxlan': [{u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}, {u'tenant_sub_ip': u'10.2.2.2/24', u'tenant_ns_ip': u'10.2.2.1/24', u'tenant_ns_if': u't1ns2if', u'tenant_sub_if': u't1s2if', u'tenant_ns_name': u't1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip link show \"t1ns2if\" ; if [ $? -ne 0 ] ; then ip link add \"t1ns2if\" type veth peer name \"t1s2if\" ; fi\n", "delta": "0:00:00.010793", "end": "2019-12-05 16:52:43.736145", "item": [{"bridge_name": "t1br2", "default_route_ip": "10.2.2.1", "dns": [{"brif": "t1s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t1s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns2", "route": [{"if": "p1", "ip": "10.2.2.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "2.2.2.0/24", "vms": [{"brif": "t1br2if1", "disk": "10G", "mem": 3, "name": "t1_VM3", "vcpu": 2, "vmif": "t1VM3if1"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, {"tenant_ns_if": "t1ns2if", "tenant_ns_ip": "10.2.2.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s2if", "tenant_sub_ip": "10.2.2.2/24"}], "rc": 0, "start": "2019-12-05 16:52:43.725352", "stderr": "Device \"t1ns2if\" does not exist.", "stderr_lines": ["Device \"t1ns2if\" does not exist."], "stdout": "", "stdout_lines": []}

TASK [Attach Namespace VETH Pairs] **************************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.2.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't1_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM4if1'}], u'vxlan': [{u'local_ip': u'10.2.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.129.2', u'remote_route': u'10.1.1.0/24', u'subnet_route': u'10.2.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.1.1.2'}]}, {u'tenant_sub_ip': u'10.2.1.2/24', u'tenant_ns_ip': u'10.2.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t1\" ip link show \"t1ns1if\" ; if [ $? -ne 0 ] ; then ip link set \"t1ns1if\" netns \"t1\" ; fi\nip netns exec \"t1ns1\" ip link show \"t1s1if\" ; if [ $? -ne 0 ] ; then ip link set \"t1s1if\" netns \"t1ns1\" ; fi\n", "delta": "0:00:00.127214", "end": "2019-12-05 16:52:44.249017", "item": [{"bridge_name": "t1br1", "default_route_ip": "10.2.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.5", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.2.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "vms": [{"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM4", "vcpu": 4, "vmif": "t1VM4if1"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.1.2", "remote_ip": "10.1.1.2", "remote_route": "10.1.1.0/24", "subnet_route": "10.2.1.0/24", "tenant_route_ip": "192.168.129.2", "v_name": "vxlan_t1s1"}]}, {"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.2.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.2.1.2/24"}], "rc": 0, "start": "2019-12-05 16:52:44.121803", "stderr": "Device \"t1ns1if\" does not exist.\nDevice \"t1s1if\" does not exist.", "stderr_lines": ["Device \"t1ns1if\" does not exist.", "Device \"t1s1if\" does not exist."], "stdout": "", "stdout_lines": []}
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.2.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.2.2.1', u'bridge_name': u't1br2', u'dns': [{u'dnsif': u't1s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s2_dnsbrif'}], u'ns_name': u't1ns2', u'subnet_ip': u'2.2.2.0/24', u'vms': [{u'mem': 3, u'name': u't1_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br2if1', u'vmif': u't1VM3if1'}], u'vxlan': [{u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}, {u'tenant_sub_ip': u'10.2.2.2/24', u'tenant_ns_ip': u'10.2.2.1/24', u'tenant_ns_if': u't1ns2if', u'tenant_sub_if': u't1s2if', u'tenant_ns_name': u't1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t1\" ip link show \"t1ns2if\" ; if [ $? -ne 0 ] ; then ip link set \"t1ns2if\" netns \"t1\" ; fi\nip netns exec \"t1ns2\" ip link show \"t1s2if\" ; if [ $? -ne 0 ] ; then ip link set \"t1s2if\" netns \"t1ns2\" ; fi\n", "delta": "0:00:00.120158", "end": "2019-12-05 16:52:44.696447", "item": [{"bridge_name": "t1br2", "default_route_ip": "10.2.2.1", "dns": [{"brif": "t1s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t1s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns2", "route": [{"if": "p1", "ip": "10.2.2.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "2.2.2.0/24", "vms": [{"brif": "t1br2if1", "disk": "10G", "mem": 3, "name": "t1_VM3", "vcpu": 2, "vmif": "t1VM3if1"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, {"tenant_ns_if": "t1ns2if", "tenant_ns_ip": "10.2.2.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s2if", "tenant_sub_ip": "10.2.2.2/24"}], "rc": 0, "start": "2019-12-05 16:52:44.576289", "stderr": "Device \"t1ns2if\" does not exist.\nDevice \"t1s2if\" does not exist.", "stderr_lines": ["Device \"t1ns2if\" does not exist.", "Device \"t1s2if\" does not exist."], "stdout": "", "stdout_lines": []}

TASK [Set Namespace VETH Pairs UP] **************************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.2.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't1_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM4if1'}], u'vxlan': [{u'local_ip': u'10.2.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.129.2', u'remote_route': u'10.1.1.0/24', u'subnet_route': u'10.2.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.1.1.2'}]}, {u'tenant_sub_ip': u'10.2.1.2/24', u'tenant_ns_ip': u'10.2.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t1\" ip link set dev \"t1ns1if\" up\nip netns exec \"t1ns1\" ip link set dev \"t1s1if\" up\n", "delta": "0:00:00.070055", "end": "2019-12-05 16:52:45.155939", "item": [{"bridge_name": "t1br1", "default_route_ip": "10.2.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.5", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.2.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "vms": [{"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM4", "vcpu": 4, "vmif": "t1VM4if1"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.1.2", "remote_ip": "10.1.1.2", "remote_route": "10.1.1.0/24", "subnet_route": "10.2.1.0/24", "tenant_route_ip": "192.168.129.2", "v_name": "vxlan_t1s1"}]}, {"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.2.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.2.1.2/24"}], "rc": 0, "start": "2019-12-05 16:52:45.085884", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.2.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.2.2.1', u'bridge_name': u't1br2', u'dns': [{u'dnsif': u't1s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s2_dnsbrif'}], u'ns_name': u't1ns2', u'subnet_ip': u'2.2.2.0/24', u'vms': [{u'mem': 3, u'name': u't1_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br2if1', u'vmif': u't1VM3if1'}], u'vxlan': [{u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}, {u'tenant_sub_ip': u'10.2.2.2/24', u'tenant_ns_ip': u'10.2.2.1/24', u'tenant_ns_if': u't1ns2if', u'tenant_sub_if': u't1s2if', u'tenant_ns_name': u't1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t1\" ip link set dev \"t1ns2if\" up\nip netns exec \"t1ns2\" ip link set dev \"t1s2if\" up\n", "delta": "0:00:00.095822", "end": "2019-12-05 16:52:45.567866", "item": [{"bridge_name": "t1br2", "default_route_ip": "10.2.2.1", "dns": [{"brif": "t1s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t1s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns2", "route": [{"if": "p1", "ip": "10.2.2.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "2.2.2.0/24", "vms": [{"brif": "t1br2if1", "disk": "10G", "mem": 3, "name": "t1_VM3", "vcpu": 2, "vmif": "t1VM3if1"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, {"tenant_ns_if": "t1ns2if", "tenant_ns_ip": "10.2.2.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s2if", "tenant_sub_ip": "10.2.2.2/24"}], "rc": 0, "start": "2019-12-05 16:52:45.472044", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Add IP addresses to Namespace VETH Pairs] *************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.2.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't1_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM4if1'}], u'vxlan': [{u'local_ip': u'10.2.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.129.2', u'remote_route': u'10.1.1.0/24', u'subnet_route': u'10.2.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.1.1.2'}]}, {u'tenant_sub_ip': u'10.2.1.2/24', u'tenant_ns_ip': u'10.2.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t1ns1\" ip addr show \"t1s1if\" | awk 'FNR==3{ print $2 }' | grep -w '^10.2.1.2/24' ; if [ $? -ne 0 ] ; then ip netns exec \"t1ns1\" ip addr add \"10.2.1.2/24\" dev \"t1s1if\" ; fi\n\nip netns exec \"t1\" ip addr show \"t1ns1if\" | awk 'FNR==3{ print $2 }' | grep -w '^10.2.1.1/24' ; if [ $? -ne 0 ] ; then ip netns exec \"t1\" ip addr add \"10.2.1.1/24\" dev \"t1ns1if\" ; fi\n", "delta": "0:00:00.145705", "end": "2019-12-05 16:52:46.119788", "item": [{"bridge_name": "t1br1", "default_route_ip": "10.2.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.5", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.2.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "vms": [{"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM4", "vcpu": 4, "vmif": "t1VM4if1"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.1.2", "remote_ip": "10.1.1.2", "remote_route": "10.1.1.0/24", "subnet_route": "10.2.1.0/24", "tenant_route_ip": "192.168.129.2", "v_name": "vxlan_t1s1"}]}, {"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.2.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.2.1.2/24"}], "rc": 0, "start": "2019-12-05 16:52:45.974083", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.2.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.2.2.1', u'bridge_name': u't1br2', u'dns': [{u'dnsif': u't1s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s2_dnsbrif'}], u'ns_name': u't1ns2', u'subnet_ip': u'2.2.2.0/24', u'vms': [{u'mem': 3, u'name': u't1_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br2if1', u'vmif': u't1VM3if1'}], u'vxlan': [{u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}, {u'tenant_sub_ip': u'10.2.2.2/24', u'tenant_ns_ip': u'10.2.2.1/24', u'tenant_ns_if': u't1ns2if', u'tenant_sub_if': u't1s2if', u'tenant_ns_name': u't1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t1ns2\" ip addr show \"t1s2if\" | awk 'FNR==3{ print $2 }' | grep -w '^10.2.2.2/24' ; if [ $? -ne 0 ] ; then ip netns exec \"t1ns2\" ip addr add \"10.2.2.2/24\" dev \"t1s2if\" ; fi\n\nip netns exec \"t1\" ip addr show \"t1ns2if\" | awk 'FNR==3{ print $2 }' | grep -w '^10.2.2.1/24' ; if [ $? -ne 0 ] ; then ip netns exec \"t1\" ip addr add \"10.2.2.1/24\" dev \"t1ns2if\" ; fi\n", "delta": "0:00:00.145026", "end": "2019-12-05 16:52:46.591750", "item": [{"bridge_name": "t1br2", "default_route_ip": "10.2.2.1", "dns": [{"brif": "t1s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t1s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns2", "route": [{"if": "p1", "ip": "10.2.2.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "2.2.2.0/24", "vms": [{"brif": "t1br2if1", "disk": "10G", "mem": 3, "name": "t1_VM3", "vcpu": 2, "vmif": "t1VM3if1"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, {"tenant_ns_if": "t1ns2if", "tenant_ns_ip": "10.2.2.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s2if", "tenant_sub_ip": "10.2.2.2/24"}], "rc": 0, "start": "2019-12-05 16:52:46.446724", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Add IP Route to Tenant] *******************************************************************************************************************************
changed: [99.99.99.2] => (item={u'default_route_ip': u'192.168.129.1', u'name': u't1', u'pns_ip': u'192.168.129.1/24', u'tenant_if': u't1if', u'tenant_ip': u'192.168.129.2/24', u'pns_if': u't1pns_if'}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t1\" ip route show default | grep -w '[d]efault via 192.168.129.1' ; if [ $? -ne 0 ] ; then ip netns exec \"t1\" ip route add default via \"192.168.129.1\" ; fi\n", "delta": "0:00:00.070608", "end": "2019-12-05 16:52:47.039871", "item": {"default_route_ip": "192.168.129.1", "name": "t1", "pns_if": "t1pns_if", "pns_ip": "192.168.129.1/24", "tenant_if": "t1if", "tenant_ip": "192.168.129.2/24"}, "rc": 0, "start": "2019-12-05 16:52:46.969263", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Add IP Route to Tenant Subnet] ************************************************************************************************************************
changed: [99.99.99.2] => (item={u'route': [{u'ip': u'10.2.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.2.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.1.2/24', u'tenant_ns_ip': u'10.2.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_ns_name': u't1', u'tenant_sub_if': u't1s1if'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't1_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM4if1'}], u'vxlan': [{u'local_ip': u'10.2.1.2', u'tenant_route_ip': u'192.168.129.2', u'dsport': 4789, u'dev': u't1s1if', u'subnet_route': u'10.2.1.0/24', u'remote_route': u'10.1.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.1.1.2'}]}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t1ns1\" ip route show default | grep -w '[d]efault via 10.2.1.1' ; if [ $? -ne 0 ] ; then ip netns exec \"t1ns1\" ip route add default via \"10.2.1.1\" ; fi\n", "delta": "0:00:00.083083", "end": "2019-12-05 16:52:47.491846", "item": {"bridge_name": "t1br1", "default_route_ip": "10.2.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.5", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.2.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.2.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.2.1.2/24"}], "vms": [{"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM4", "vcpu": 4, "vmif": "t1VM4if1"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.1.2", "remote_ip": "10.1.1.2", "remote_route": "10.1.1.0/24", "subnet_route": "10.2.1.0/24", "tenant_route_ip": "192.168.129.2", "v_name": "vxlan_t1s1"}]}, "rc": 0, "start": "2019-12-05 16:52:47.408763", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}
changed: [99.99.99.2] => (item={u'route': [{u'ip': u'10.2.2.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.2.2.1', u'bridge_name': u't1br2', u'dns': [{u'dnsif': u't1s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s2_dnsbrif'}], u'ns_name': u't1ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.2.2/24', u'tenant_ns_ip': u'10.2.2.1/24', u'tenant_ns_if': u't1ns2if', u'tenant_ns_name': u't1', u'tenant_sub_if': u't1s2if'}], u'subnet_ip': u'2.2.2.0/24', u'vms': [{u'mem': 3, u'name': u't1_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br2if1', u'vmif': u't1VM3if1'}], u'vxlan': [{u'local_ip': [], u'tenant_route_ip': [], u'dsport': [], u'dev': [], u'subnet_route': [], u'remote_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t1ns2\" ip route show default | grep -w '[d]efault via 10.2.2.1' ; if [ $? -ne 0 ] ; then ip netns exec \"t1ns2\" ip route add default via \"10.2.2.1\" ; fi\n", "delta": "0:00:00.076089", "end": "2019-12-05 16:52:47.887866", "item": {"bridge_name": "t1br2", "default_route_ip": "10.2.2.1", "dns": [{"brif": "t1s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t1s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns2", "route": [{"if": "p1", "ip": "10.2.2.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "2.2.2.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns2if", "tenant_ns_ip": "10.2.2.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s2if", "tenant_sub_ip": "10.2.2.2/24"}], "vms": [{"brif": "t1br2if1", "disk": "10G", "mem": 3, "name": "t1_VM3", "vcpu": 2, "vmif": "t1VM3if1"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, "rc": 0, "start": "2019-12-05 16:52:47.811777", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Create bridge inside namespace] ***********************************************************************************************************************
changed: [99.99.99.2] => (item={u'route': [{u'ip': u'10.2.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.2.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.1.2/24', u'tenant_ns_ip': u'10.2.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_ns_name': u't1', u'tenant_sub_if': u't1s1if'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't1_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM4if1'}], u'vxlan': [{u'local_ip': u'10.2.1.2', u'tenant_route_ip': u'192.168.129.2', u'dsport': 4789, u'dev': u't1s1if', u'subnet_route': u'10.2.1.0/24', u'remote_route': u'10.1.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.1.1.2'}]}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t1ns1\" brctl show | grep -w '^t1br1'; if [ $? -ne 0 ] ; then ip netns exec \"t1ns1\" brctl addbr \"t1br1\" ; fi\nip netns exec \"t1ns1\" ip link set dev \"t1br1\" up\n", "delta": "0:00:00.132460", "end": "2019-12-05 16:52:48.424024", "item": {"bridge_name": "t1br1", "default_route_ip": "10.2.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.5", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.2.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.2.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.2.1.2/24"}], "vms": [{"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM4", "vcpu": 4, "vmif": "t1VM4if1"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.1.2", "remote_ip": "10.1.1.2", "remote_route": "10.1.1.0/24", "subnet_route": "10.2.1.0/24", "tenant_route_ip": "192.168.129.2", "v_name": "vxlan_t1s1"}]}, "rc": 0, "start": "2019-12-05 16:52:48.291564", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}
changed: [99.99.99.2] => (item={u'route': [{u'ip': u'10.2.2.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.2.2.1', u'bridge_name': u't1br2', u'dns': [{u'dnsif': u't1s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s2_dnsbrif'}], u'ns_name': u't1ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.2.2/24', u'tenant_ns_ip': u'10.2.2.1/24', u'tenant_ns_if': u't1ns2if', u'tenant_ns_name': u't1', u'tenant_sub_if': u't1s2if'}], u'subnet_ip': u'2.2.2.0/24', u'vms': [{u'mem': 3, u'name': u't1_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br2if1', u'vmif': u't1VM3if1'}], u'vxlan': [{u'local_ip': [], u'tenant_route_ip': [], u'dsport': [], u'dev': [], u'subnet_route': [], u'remote_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t1ns2\" brctl show | grep -w '^t1br2'; if [ $? -ne 0 ] ; then ip netns exec \"t1ns2\" brctl addbr \"t1br2\" ; fi\nip netns exec \"t1ns2\" ip link set dev \"t1br2\" up\n", "delta": "0:00:00.106371", "end": "2019-12-05 16:52:48.851990", "item": {"bridge_name": "t1br2", "default_route_ip": "10.2.2.1", "dns": [{"brif": "t1s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t1s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns2", "route": [{"if": "p1", "ip": "10.2.2.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "2.2.2.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns2if", "tenant_ns_ip": "10.2.2.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s2if", "tenant_sub_ip": "10.2.2.2/24"}], "vms": [{"brif": "t1br2if1", "disk": "10G", "mem": 3, "name": "t1_VM3", "vcpu": 2, "vmif": "t1VM3if1"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, "rc": 0, "start": "2019-12-05 16:52:48.745619", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Create DNS VETH Pair] *********************************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.2.1.1', u'bridge_name': u't1br1', u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.1.2/24', u'tenant_ns_ip': u'10.2.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't1_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM4if1'}], u'vxlan': [{u'local_ip': u'10.2.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.129.2', u'remote_route': u'10.1.1.0/24', u'subnet_route': u'10.2.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.1.1.2'}]}, {u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t1ns1\" ip link show \"t1s1_dnsbrif\" ; if [ $? -ne 0 ] ; then ip netns exec \"t1ns1\" ip link add \"t1s1_dnsbrif\" type veth peer name \"t1s1_dnsif\" ; fi\nip netns exec \"t1ns1\" ip link set dev \"t1s1_dnsbrif\" up\nip netns exec \"t1ns1\" ip link set dev \"t1s1_dnsif\" up\n", "delta": "0:00:00.146256", "end": "2019-12-05 16:52:49.407773", "item": [{"bridge_name": "t1br1", "default_route_ip": "10.2.1.1", "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.2.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.2.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.2.1.2/24"}], "vms": [{"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM4", "vcpu": 4, "vmif": "t1VM4if1"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.1.2", "remote_ip": "10.1.1.2", "remote_route": "10.1.1.0/24", "subnet_route": "10.2.1.0/24", "tenant_route_ip": "192.168.129.2", "v_name": "vxlan_t1s1"}]}, {"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.5", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "rc": 0, "start": "2019-12-05 16:52:49.261517", "stderr": "Device \"t1s1_dnsbrif\" does not exist.", "stderr_lines": ["Device \"t1s1_dnsbrif\" does not exist."], "stdout": "", "stdout_lines": []}
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.2.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.2.2.1', u'bridge_name': u't1br2', u'ns_name': u't1ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.2.2/24', u'tenant_ns_ip': u'10.2.2.1/24', u'tenant_ns_if': u't1ns2if', u'tenant_sub_if': u't1s2if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'2.2.2.0/24', u'vms': [{u'mem': 3, u'name': u't1_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br2if1', u'vmif': u't1VM3if1'}], u'vxlan': [{u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}, {u'dnsif': u't1s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s2_dnsbrif'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t1ns2\" ip link show \"t1s2_dnsbrif\" ; if [ $? -ne 0 ] ; then ip netns exec \"t1ns2\" ip link add \"t1s2_dnsbrif\" type veth peer name \"t1s2_dnsif\" ; fi\nip netns exec \"t1ns2\" ip link set dev \"t1s2_dnsbrif\" up\nip netns exec \"t1ns2\" ip link set dev \"t1s2_dnsif\" up\n", "delta": "0:00:00.160957", "end": "2019-12-05 16:52:49.908066", "item": [{"bridge_name": "t1br2", "default_route_ip": "10.2.2.1", "ns_name": "t1ns2", "route": [{"if": "p1", "ip": "10.2.2.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "2.2.2.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns2if", "tenant_ns_ip": "10.2.2.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s2if", "tenant_sub_ip": "10.2.2.2/24"}], "vms": [{"brif": "t1br2if1", "disk": "10G", "mem": 3, "name": "t1_VM3", "vcpu": 2, "vmif": "t1VM3if1"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, {"brif": "t1s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t1s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "rc": 0, "start": "2019-12-05 16:52:49.747109", "stderr": "Device \"t1s2_dnsbrif\" does not exist.", "stderr_lines": ["Device \"t1s2_dnsbrif\" does not exist."], "stdout": "", "stdout_lines": []}

TASK [Attach DNS VETH Pair] *********************************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.2.1.1', u'bridge_name': u't1br1', u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.1.2/24', u'tenant_ns_ip': u'10.2.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't1_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM4if1'}], u'vxlan': [{u'local_ip': u'10.2.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.129.2', u'remote_route': u'10.1.1.0/24', u'subnet_route': u'10.2.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.1.1.2'}]}, {u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t1ns1\" brctl show \"t1br1\" | grep -w 't1s1_dnsbrif' ; if [ $? -ne 0 ] ; then ip netns exec \"t1ns1\" brctl addif \"t1br1\" \"t1s1_dnsbrif\" ; fi\n", "delta": "0:00:00.072215", "end": "2019-12-05 16:52:50.383919", "item": [{"bridge_name": "t1br1", "default_route_ip": "10.2.1.1", "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.2.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.2.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.2.1.2/24"}], "vms": [{"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM4", "vcpu": 4, "vmif": "t1VM4if1"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.1.2", "remote_ip": "10.1.1.2", "remote_route": "10.1.1.0/24", "subnet_route": "10.2.1.0/24", "tenant_route_ip": "192.168.129.2", "v_name": "vxlan_t1s1"}]}, {"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.5", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "rc": 0, "start": "2019-12-05 16:52:50.311704", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.2.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.2.2.1', u'bridge_name': u't1br2', u'ns_name': u't1ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.2.2/24', u'tenant_ns_ip': u'10.2.2.1/24', u'tenant_ns_if': u't1ns2if', u'tenant_sub_if': u't1s2if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'2.2.2.0/24', u'vms': [{u'mem': 3, u'name': u't1_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br2if1', u'vmif': u't1VM3if1'}], u'vxlan': [{u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}, {u'dnsif': u't1s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s2_dnsbrif'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t1ns2\" brctl show \"t1br2\" | grep -w 't1s2_dnsbrif' ; if [ $? -ne 0 ] ; then ip netns exec \"t1ns2\" brctl addif \"t1br2\" \"t1s2_dnsbrif\" ; fi\n", "delta": "0:00:00.084488", "end": "2019-12-05 16:52:50.807969", "item": [{"bridge_name": "t1br2", "default_route_ip": "10.2.2.1", "ns_name": "t1ns2", "route": [{"if": "p1", "ip": "10.2.2.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "2.2.2.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns2if", "tenant_ns_ip": "10.2.2.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s2if", "tenant_sub_ip": "10.2.2.2/24"}], "vms": [{"brif": "t1br2if1", "disk": "10G", "mem": 3, "name": "t1_VM3", "vcpu": 2, "vmif": "t1VM3if1"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, {"brif": "t1s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t1s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "rc": 0, "start": "2019-12-05 16:52:50.723481", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Create VETH Pairs] ************************************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.2.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.1.2/24', u'tenant_ns_ip': u'10.2.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.2.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.129.2', u'remote_route': u'10.1.1.0/24', u'subnet_route': u'10.2.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.1.1.2'}]}, {u'mem': 2, u'name': u't1_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM4if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip link show \"t1br1if1\" ; if [ $? -ne 0 ] ; then ip link add \"t1VM4if1\" type veth peer name \"t1br1if1\" ; fi\nip link set dev \"t1br1if1\" up\nip link set dev \"t1VM4if1\" up\n", "delta": "0:00:00.011787", "end": "2019-12-05 16:52:51.239011", "item": [{"bridge_name": "t1br1", "default_route_ip": "10.2.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.5", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.2.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.2.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.2.1.2/24"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.1.2", "remote_ip": "10.1.1.2", "remote_route": "10.1.1.0/24", "subnet_route": "10.2.1.0/24", "tenant_route_ip": "192.168.129.2", "v_name": "vxlan_t1s1"}]}, {"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM4", "vcpu": 4, "vmif": "t1VM4if1"}], "rc": 0, "start": "2019-12-05 16:52:51.227224", "stderr": "Device \"t1br1if1\" does not exist.", "stderr_lines": ["Device \"t1br1if1\" does not exist."], "stdout": "", "stdout_lines": []}
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.2.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.2.2.1', u'bridge_name': u't1br2', u'dns': [{u'dnsif': u't1s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s2_dnsbrif'}], u'ns_name': u't1ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.2.2/24', u'tenant_ns_ip': u'10.2.2.1/24', u'tenant_ns_if': u't1ns2if', u'tenant_sub_if': u't1s2if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'2.2.2.0/24', u'vxlan': [{u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}, {u'mem': 3, u'name': u't1_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br2if1', u'vmif': u't1VM3if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip link show \"t1br2if1\" ; if [ $? -ne 0 ] ; then ip link add \"t1VM3if1\" type veth peer name \"t1br2if1\" ; fi\nip link set dev \"t1br2if1\" up\nip link set dev \"t1VM3if1\" up\n", "delta": "0:00:00.019463", "end": "2019-12-05 16:52:51.598168", "item": [{"bridge_name": "t1br2", "default_route_ip": "10.2.2.1", "dns": [{"brif": "t1s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t1s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns2", "route": [{"if": "p1", "ip": "10.2.2.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "2.2.2.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns2if", "tenant_ns_ip": "10.2.2.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s2if", "tenant_sub_ip": "10.2.2.2/24"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, {"brif": "t1br2if1", "disk": "10G", "mem": 3, "name": "t1_VM3", "vcpu": 2, "vmif": "t1VM3if1"}], "rc": 0, "start": "2019-12-05 16:52:51.578705", "stderr": "Device \"t1br2if1\" does not exist.", "stderr_lines": ["Device \"t1br2if1\" does not exist."], "stdout": "", "stdout_lines": []}

TASK [Attach VETH Pairs] ************************************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.2.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.1.2/24', u'tenant_ns_ip': u'10.2.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.2.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.129.2', u'remote_route': u'10.1.1.0/24', u'subnet_route': u'10.2.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.1.1.2'}]}, {u'mem': 2, u'name': u't1_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM4if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip link show \"t1br1if1\" ; if [ $? -eq 0 ] ; then ip link set \"t1br1if1\" netns \"t1ns1\" ; fi\nip netns exec \"t1ns1\" brctl show \"t1br1\" | grep -w 't1br1if1' ; if [ $? -ne 0 ] ; then ip netns exec \"t1ns1\" brctl addif \"t1br1\" \"t1br1if1\" ; fi\n", "delta": "0:00:00.101128", "end": "2019-12-05 16:52:52.143850", "item": [{"bridge_name": "t1br1", "default_route_ip": "10.2.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.5", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.2.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.2.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.2.1.2/24"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.1.2", "remote_ip": "10.1.1.2", "remote_route": "10.1.1.0/24", "subnet_route": "10.2.1.0/24", "tenant_route_ip": "192.168.129.2", "v_name": "vxlan_t1s1"}]}, {"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM4", "vcpu": 4, "vmif": "t1VM4if1"}], "rc": 0, "start": "2019-12-05 16:52:52.042722", "stderr": "", "stderr_lines": [], "stdout": "21: t1br1if1@t1VM4if1: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP mode DEFAULT group default qlen 1000\n    link/ether 8e:df:3c:6c:9c:ce brd ff:ff:ff:ff:ff:ff", "stdout_lines": ["21: t1br1if1@t1VM4if1: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP mode DEFAULT group default qlen 1000", "    link/ether 8e:df:3c:6c:9c:ce brd ff:ff:ff:ff:ff:ff"]}
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.2.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.2.2.1', u'bridge_name': u't1br2', u'dns': [{u'dnsif': u't1s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s2_dnsbrif'}], u'ns_name': u't1ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.2.2/24', u'tenant_ns_ip': u'10.2.2.1/24', u'tenant_ns_if': u't1ns2if', u'tenant_sub_if': u't1s2if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'2.2.2.0/24', u'vxlan': [{u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}, {u'mem': 3, u'name': u't1_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br2if1', u'vmif': u't1VM3if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip link show \"t1br2if1\" ; if [ $? -eq 0 ] ; then ip link set \"t1br2if1\" netns \"t1ns2\" ; fi\nip netns exec \"t1ns2\" brctl show \"t1br2\" | grep -w 't1br2if1' ; if [ $? -ne 0 ] ; then ip netns exec \"t1ns2\" brctl addif \"t1br2\" \"t1br2if1\" ; fi\n", "delta": "0:00:00.106679", "end": "2019-12-05 16:52:52.603747", "item": [{"bridge_name": "t1br2", "default_route_ip": "10.2.2.1", "dns": [{"brif": "t1s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t1s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns2", "route": [{"if": "p1", "ip": "10.2.2.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "2.2.2.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns2if", "tenant_ns_ip": "10.2.2.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s2if", "tenant_sub_ip": "10.2.2.2/24"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, {"brif": "t1br2if1", "disk": "10G", "mem": 3, "name": "t1_VM3", "vcpu": 2, "vmif": "t1VM3if1"}], "rc": 0, "start": "2019-12-05 16:52:52.497068", "stderr": "", "stderr_lines": [], "stdout": "23: t1br2if1@t1VM3if1: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP mode DEFAULT group default qlen 1000\n    link/ether de:61:b3:44:d7:6f brd ff:ff:ff:ff:ff:ff", "stdout_lines": ["23: t1br2if1@t1VM3if1: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP mode DEFAULT group default qlen 1000", "    link/ether de:61:b3:44:d7:6f brd ff:ff:ff:ff:ff:ff"]}

TASK [All interfaces and bridges UP] ************************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.2.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.1.2/24', u'tenant_ns_ip': u'10.2.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.2.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.129.2', u'remote_route': u'10.1.1.0/24', u'subnet_route': u'10.2.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.1.1.2'}]}, {u'mem': 2, u'name': u't1_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM4if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t1ns1\" ip link set \"t1br1if1\" up\nip netns exec \"t1ns1\" ip link set dev \"t1br1\" up\n", "delta": "0:00:00.067901", "end": "2019-12-05 16:52:53.084007", "item": [{"bridge_name": "t1br1", "default_route_ip": "10.2.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.5", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.2.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.2.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.2.1.2/24"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.1.2", "remote_ip": "10.1.1.2", "remote_route": "10.1.1.0/24", "subnet_route": "10.2.1.0/24", "tenant_route_ip": "192.168.129.2", "v_name": "vxlan_t1s1"}]}, {"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM4", "vcpu": 4, "vmif": "t1VM4if1"}], "rc": 0, "start": "2019-12-05 16:52:53.016106", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.2.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.2.2.1', u'bridge_name': u't1br2', u'dns': [{u'dnsif': u't1s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s2_dnsbrif'}], u'ns_name': u't1ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.2.2/24', u'tenant_ns_ip': u'10.2.2.1/24', u'tenant_ns_if': u't1ns2if', u'tenant_sub_if': u't1s2if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'2.2.2.0/24', u'vxlan': [{u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}, {u'mem': 3, u'name': u't1_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br2if1', u'vmif': u't1VM3if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t1ns2\" ip link set \"t1br2if1\" up\nip netns exec \"t1ns2\" ip link set dev \"t1br2\" up\n", "delta": "0:00:00.086392", "end": "2019-12-05 16:52:53.507795", "item": [{"bridge_name": "t1br2", "default_route_ip": "10.2.2.1", "dns": [{"brif": "t1s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t1s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns2", "route": [{"if": "p1", "ip": "10.2.2.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "2.2.2.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns2if", "tenant_ns_ip": "10.2.2.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s2if", "tenant_sub_ip": "10.2.2.2/24"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, {"brif": "t1br2if1", "disk": "10G", "mem": 3, "name": "t1_VM3", "vcpu": 2, "vmif": "t1VM3if1"}], "rc": 0, "start": "2019-12-05 16:52:53.421403", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Add IP to DNS Interface] ******************************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.2.1.1', u'bridge_name': u't1br1', u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.1.2/24', u'tenant_ns_ip': u'10.2.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't1_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM4if1'}], u'vxlan': [{u'local_ip': u'10.2.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.129.2', u'remote_route': u'10.1.1.0/24', u'subnet_route': u'10.2.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.1.1.2'}]}, {u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t1ns1\" ip addr show \"t1s1_dnsif\" | awk 'FNR==3{ print $2}'| grep -w '^1.1.1.1/24' ; if [ $? -ne 0 ] ; then ip netns exec \"t1ns1\" ip addr add \"1.1.1.1/24\" dev \"t1s1_dnsif\" ; fi\n", "delta": "0:00:00.085219", "end": "2019-12-05 16:52:54.051728", "item": [{"bridge_name": "t1br1", "default_route_ip": "10.2.1.1", "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.2.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.2.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.2.1.2/24"}], "vms": [{"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM4", "vcpu": 4, "vmif": "t1VM4if1"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.1.2", "remote_ip": "10.1.1.2", "remote_route": "10.1.1.0/24", "subnet_route": "10.2.1.0/24", "tenant_route_ip": "192.168.129.2", "v_name": "vxlan_t1s1"}]}, {"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.5", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "rc": 0, "start": "2019-12-05 16:52:53.966509", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.2.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.2.2.1', u'bridge_name': u't1br2', u'ns_name': u't1ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.2.2/24', u'tenant_ns_ip': u'10.2.2.1/24', u'tenant_ns_if': u't1ns2if', u'tenant_sub_if': u't1s2if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'2.2.2.0/24', u'vms': [{u'mem': 3, u'name': u't1_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br2if1', u'vmif': u't1VM3if1'}], u'vxlan': [{u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}, {u'dnsif': u't1s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s2_dnsbrif'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t1ns2\" ip addr show \"t1s2_dnsif\" | awk 'FNR==3{ print $2}'| grep -w '^2.2.2.1/24' ; if [ $? -ne 0 ] ; then ip netns exec \"t1ns2\" ip addr add \"2.2.2.1/24\" dev \"t1s2_dnsif\" ; fi\n", "delta": "0:00:00.087095", "end": "2019-12-05 16:52:54.487904", "item": [{"bridge_name": "t1br2", "default_route_ip": "10.2.2.1", "ns_name": "t1ns2", "route": [{"if": "p1", "ip": "10.2.2.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "2.2.2.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns2if", "tenant_ns_ip": "10.2.2.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s2if", "tenant_sub_ip": "10.2.2.2/24"}], "vms": [{"brif": "t1br2if1", "disk": "10G", "mem": 3, "name": "t1_VM3", "vcpu": 2, "vmif": "t1VM3if1"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, {"brif": "t1s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t1s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "rc": 0, "start": "2019-12-05 16:52:54.400809", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Install DHCP Server] **********************************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.2.1.1', u'bridge_name': u't1br1', u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.1.2/24', u'tenant_ns_ip': u'10.2.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't1_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM4if1'}], u'vxlan': [{u'local_ip': u'10.2.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.129.2', u'remote_route': u'10.1.1.0/24', u'subnet_route': u'10.2.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.1.1.2'}]}, {u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t1ns1\" ps aux | grep -w '[d]nsmasq --interface t1s1_dnsif -z --dhcp-range=1.1.1.5,1.1.1.254' ; if [ $? -ne 0 ] ; then ip netns exec \"t1ns1\" dnsmasq --interface \"t1s1_dnsif\" -z --dhcp-range=1.1.1.5,'1.1.1.254' ; fi\n", "delta": "0:00:00.077224", "end": "2019-12-05 16:52:54.965730", "item": [{"bridge_name": "t1br1", "default_route_ip": "10.2.1.1", "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.2.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.2.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.2.1.2/24"}], "vms": [{"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM4", "vcpu": 4, "vmif": "t1VM4if1"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.1.2", "remote_ip": "10.1.1.2", "remote_route": "10.1.1.0/24", "subnet_route": "10.2.1.0/24", "tenant_route_ip": "192.168.129.2", "v_name": "vxlan_t1s1"}]}, {"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.5", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "rc": 0, "start": "2019-12-05 16:52:54.888506", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.2.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.2.2.1', u'bridge_name': u't1br2', u'ns_name': u't1ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.2.2/24', u'tenant_ns_ip': u'10.2.2.1/24', u'tenant_ns_if': u't1ns2if', u'tenant_sub_if': u't1s2if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'2.2.2.0/24', u'vms': [{u'mem': 3, u'name': u't1_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br2if1', u'vmif': u't1VM3if1'}], u'vxlan': [{u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}, {u'dnsif': u't1s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s2_dnsbrif'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t1ns2\" ps aux | grep -w '[d]nsmasq --interface t1s2_dnsif -z --dhcp-range=2.2.2.5,2.2.2.254' ; if [ $? -ne 0 ] ; then ip netns exec \"t1ns2\" dnsmasq --interface \"t1s2_dnsif\" -z --dhcp-range=2.2.2.5,'2.2.2.254' ; fi\n", "delta": "0:00:00.064254", "end": "2019-12-05 16:52:55.368258", "item": [{"bridge_name": "t1br2", "default_route_ip": "10.2.2.1", "ns_name": "t1ns2", "route": [{"if": "p1", "ip": "10.2.2.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "2.2.2.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns2if", "tenant_ns_ip": "10.2.2.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s2if", "tenant_sub_ip": "10.2.2.2/24"}], "vms": [{"brif": "t1br2if1", "disk": "10G", "mem": 3, "name": "t1_VM3", "vcpu": 2, "vmif": "t1VM3if1"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, {"brif": "t1s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t1s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "rc": 0, "start": "2019-12-05 16:52:55.304004", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Create VXLAN devices] *********************************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.2.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.1.2/24', u'tenant_ns_ip': u'10.2.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't1_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM4if1'}]}, {u'local_ip': u'10.2.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.129.2', u'remote_route': u'10.1.1.0/24', u'subnet_route': u'10.2.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.1.1.2'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t1ns1\" ip link show \"vxlan_t1s1\" ; if [ $? -ne 0 ] ; then ip netns exec \"t1ns1\" ip link add \"vxlan_t1s1\" type vxlan id \"42\" local \"10.2.1.2\" remote \"10.1.1.2\" dstport \"4789\" dev \"t1s1if\" ; ip netns exec \"t1ns1\" ip link set dev \"vxlan_t1s1\" up ; fi\n", "delta": "0:00:00.156083", "end": "2019-12-05 16:52:55.939914", "item": [{"bridge_name": "t1br1", "default_route_ip": "10.2.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.5", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.2.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.2.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.2.1.2/24"}], "vms": [{"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM4", "vcpu": 4, "vmif": "t1VM4if1"}]}, {"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.1.2", "remote_ip": "10.1.1.2", "remote_route": "10.1.1.0/24", "subnet_route": "10.2.1.0/24", "tenant_route_ip": "192.168.129.2", "v_name": "vxlan_t1s1"}], "rc": 0, "start": "2019-12-05 16:52:55.783831", "stderr": "Device \"vxlan_t1s1\" does not exist.", "stderr_lines": ["Device \"vxlan_t1s1\" does not exist."], "stdout": "", "stdout_lines": []}
skipping: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.2.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.2.2.1', u'bridge_name': u't1br2', u'dns': [{u'dnsif': u't1s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s2_dnsbrif'}], u'ns_name': u't1ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.2.2/24', u'tenant_ns_ip': u'10.2.2.1/24', u'tenant_ns_if': u't1ns2if', u'tenant_sub_if': u't1s2if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'2.2.2.0/24', u'vms': [{u'mem': 3, u'name': u't1_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br2if1', u'vmif': u't1VM3if1'}]}, {u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}])  => {"ansible_loop_var": "item", "changed": false, "item": [{"bridge_name": "t1br2", "default_route_ip": "10.2.2.1", "dns": [{"brif": "t1s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t1s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns2", "route": [{"if": "p1", "ip": "10.2.2.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "2.2.2.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns2if", "tenant_ns_ip": "10.2.2.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s2if", "tenant_sub_ip": "10.2.2.2/24"}], "vms": [{"brif": "t1br2if1", "disk": "10G", "mem": 3, "name": "t1_VM3", "vcpu": 2, "vmif": "t1VM3if1"}]}, {"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}], "skip_reason": "Conditional result was False"}

TASK [Attach VXLANs to bridge] ******************************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.2.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.1.2/24', u'tenant_ns_ip': u'10.2.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't1_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM4if1'}]}, {u'local_ip': u'10.2.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.129.2', u'remote_route': u'10.1.1.0/24', u'subnet_route': u'10.2.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.1.1.2'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t1ns1\" brctl show \"t1br1\" | grep -w 'vxlan_t1s1' ; if [ $? -ne 0 ] ; then ip netns exec \"t1ns1\" brctl addif \"t1br1\" \"vxlan_t1s1\" ; fi\n", "delta": "0:00:00.073551", "end": "2019-12-05 16:52:56.399753", "item": [{"bridge_name": "t1br1", "default_route_ip": "10.2.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.5", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.2.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.2.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.2.1.2/24"}], "vms": [{"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM4", "vcpu": 4, "vmif": "t1VM4if1"}]}, {"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.1.2", "remote_ip": "10.1.1.2", "remote_route": "10.1.1.0/24", "subnet_route": "10.2.1.0/24", "tenant_route_ip": "192.168.129.2", "v_name": "vxlan_t1s1"}], "rc": 0, "start": "2019-12-05 16:52:56.326202", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}
skipping: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.2.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.2.2.1', u'bridge_name': u't1br2', u'dns': [{u'dnsif': u't1s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s2_dnsbrif'}], u'ns_name': u't1ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.2.2/24', u'tenant_ns_ip': u'10.2.2.1/24', u'tenant_ns_if': u't1ns2if', u'tenant_sub_if': u't1s2if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'2.2.2.0/24', u'vms': [{u'mem': 3, u'name': u't1_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br2if1', u'vmif': u't1VM3if1'}]}, {u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}])  => {"ansible_loop_var": "item", "changed": false, "item": [{"bridge_name": "t1br2", "default_route_ip": "10.2.2.1", "dns": [{"brif": "t1s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t1s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns2", "route": [{"if": "p1", "ip": "10.2.2.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "2.2.2.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns2if", "tenant_ns_ip": "10.2.2.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s2if", "tenant_sub_ip": "10.2.2.2/24"}], "vms": [{"brif": "t1br2if1", "disk": "10G", "mem": 3, "name": "t1_VM3", "vcpu": 2, "vmif": "t1VM3if1"}]}, {"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}], "skip_reason": "Conditional result was False"}

PLAY RECAP **************************************************************************************************************************************************
99.99.99.2                 : ok=21   changed=21   unreachable=0    failed=0    skipped=0    rescued=0    ignored=0   

Using /etc/ansible/ansible.cfg as config file

PLAY [main] *************************************************************************************************************************************************

TASK [Add VXLAN routes in PNS] ******************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.1.2/24', u'tenant_ns_ip': u'10.1.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't1_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM1if1'}, {u'mem': 4, u'name': u't1_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br1if2', u'vmif': u't1VM2if1'}]}, {u'local_ip': u'10.1.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.1.2', u'remote_route': u'10.2.1.0/24', u'subnet_route': u'10.1.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.2.1.2'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec pns ip route show \"10.1.1.0/24\" via \"192.168.1.2\" | grep -w '^10.1.1.0/24' ; if [ $? -ne 0 ] ; then ip netns exec pns ip route add \"10.1.1.0/24\" via \"192.168.1.2\" ; fi\n", "delta": "0:00:00.075346", "end": "2019-12-05 16:52:57.590891", "item": [{"bridge_name": "t1br1", "default_route_ip": "10.1.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.5", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.1.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.1.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.1.1.2/24"}], "vms": [{"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM1", "vcpu": 4, "vmif": "t1VM1if1"}, {"brif": "t1br1if2", "disk": "10G", "mem": 4, "name": "t1_VM2", "vcpu": 2, "vmif": "t1VM2if1"}]}, {"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.1.2", "remote_ip": "10.2.1.2", "remote_route": "10.2.1.0/24", "subnet_route": "10.1.1.0/24", "tenant_route_ip": "192.168.1.2", "v_name": "vxlan_t1s1"}], "rc": 0, "start": "2019-12-05 16:52:57.515545", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Get PNS ip address] ***********************************************************************************************************************************
ok: [localhost] => {"changed": false, "cmd": "ip netns exec pns ip addr show p1 | awk 'FNR==3{ print $2 }' | awk -F/ '{ print $1 }'\n", "delta": "0:00:00.042656", "end": "2019-12-05 16:52:57.907329", "rc": 0, "start": "2019-12-05 16:52:57.864673", "stderr": "", "stderr_lines": [], "stdout": "192.168.100.238", "stdout_lines": ["192.168.100.238"]}

TASK [Add VXLAN routes to host] *****************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.1.2/24', u'tenant_ns_ip': u'10.1.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't1_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM1if1'}, {u'mem': 4, u'name': u't1_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br1if2', u'vmif': u't1VM2if1'}]}, {u'local_ip': u'10.1.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.1.2', u'remote_route': u'10.2.1.0/24', u'subnet_route': u'10.1.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.2.1.2'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip route show \"10.1.1.0/24\" via \"192.168.100.238\" | grep -w '^10.1.1.0/24' ; if [ $? -ne 0 ] ; then ip route add \"10.1.1.0/24\" via \"192.168.100.238\" ; fi\nip route show \"10.2.1.0/24\" via 99.99.99.2 | grep -w '^10.2.1.0/24'; if [ $? -ne 0 ] ; then ip route add \"10.2.1.0/24\" via 99.99.99.2 ; fi\n", "delta": "0:00:00.009340", "end": "2019-12-05 16:52:58.230448", "item": [{"bridge_name": "t1br1", "default_route_ip": "10.1.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.5", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.1.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.1.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.1.1.2/24"}], "vms": [{"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM1", "vcpu": 4, "vmif": "t1VM1if1"}, {"brif": "t1br1if2", "disk": "10G", "mem": 4, "name": "t1_VM2", "vcpu": 2, "vmif": "t1VM2if1"}]}, {"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.1.2", "remote_ip": "10.2.1.2", "remote_route": "10.2.1.0/24", "subnet_route": "10.1.1.0/24", "tenant_route_ip": "192.168.1.2", "v_name": "vxlan_t1s1"}], "rc": 0, "start": "2019-12-05 16:52:58.221108", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

PLAY RECAP **************************************************************************************************************************************************
localhost                  : ok=3    changed=2    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0   

Using /etc/ansible/ansible.cfg as config file

PLAY [worker] ***********************************************************************************************************************************************

TASK [Add VXLAN routes in PNS] ******************************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.2.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.1.2/24', u'tenant_ns_ip': u'10.2.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't1_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM4if1'}]}, {u'local_ip': u'10.2.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.129.2', u'remote_route': u'10.1.1.0/24', u'subnet_route': u'10.2.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.1.1.2'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec pns ip route show \"10.2.1.0/24\" via \"192.168.129.2\" | grep -w '^10.2.1.0/24' ; if [ $? -ne 0 ] ; then ip netns exec pns ip route add \"10.2.1.0/24\" via \"192.168.129.2\" ; fi\n", "delta": "0:00:00.079606", "end": "2019-12-05 16:52:59.475889", "item": [{"bridge_name": "t1br1", "default_route_ip": "10.2.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.5", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.2.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.2.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.2.1.2/24"}], "vms": [{"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM4", "vcpu": 4, "vmif": "t1VM4if1"}]}, {"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.1.2", "remote_ip": "10.1.1.2", "remote_route": "10.1.1.0/24", "subnet_route": "10.2.1.0/24", "tenant_route_ip": "192.168.129.2", "v_name": "vxlan_t1s1"}], "rc": 0, "start": "2019-12-05 16:52:59.396283", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}
skipping: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.2.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.2.2.1', u'bridge_name': u't1br2', u'dns': [{u'dnsif': u't1s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s2_dnsbrif'}], u'ns_name': u't1ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.2.2/24', u'tenant_ns_ip': u'10.2.2.1/24', u'tenant_ns_if': u't1ns2if', u'tenant_sub_if': u't1s2if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'2.2.2.0/24', u'vms': [{u'mem': 3, u'name': u't1_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br2if1', u'vmif': u't1VM3if1'}]}, {u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}])  => {"ansible_loop_var": "item", "changed": false, "item": [{"bridge_name": "t1br2", "default_route_ip": "10.2.2.1", "dns": [{"brif": "t1s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t1s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns2", "route": [{"if": "p1", "ip": "10.2.2.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "2.2.2.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns2if", "tenant_ns_ip": "10.2.2.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s2if", "tenant_sub_ip": "10.2.2.2/24"}], "vms": [{"brif": "t1br2if1", "disk": "10G", "mem": 3, "name": "t1_VM3", "vcpu": 2, "vmif": "t1VM3if1"}]}, {"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}], "skip_reason": "Conditional result was False"}

TASK [Get PNS ip address] ***********************************************************************************************************************************
ok: [99.99.99.2] => {"changed": false, "cmd": "ip netns exec pns ip addr show p1 | awk 'FNR==3{ print $2 }' | awk -F/ '{ print $1 }'\n", "delta": "0:00:00.039904", "end": "2019-12-05 16:52:59.892100", "rc": 0, "start": "2019-12-05 16:52:59.852196", "stderr": "", "stderr_lines": [], "stdout": "192.168.100.50", "stdout_lines": ["192.168.100.50"]}

TASK [Add VXLAN routes to host] *****************************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.2.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.1.2/24', u'tenant_ns_ip': u'10.2.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't1_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM4if1'}]}, {u'local_ip': u'10.2.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.129.2', u'remote_route': u'10.1.1.0/24', u'subnet_route': u'10.2.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.1.1.2'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip route show \"10.2.1.0/24\" via \"192.168.100.50\" | grep -w '^10.2.1.0/24' ; if [ $? -ne 0 ] ; then ip route add \"10.2.1.0/24\" via \"192.168.100.50\" ; fi\nip route show \"10.1.1.0/24\" via 99.99.99.1 | grep -w '^10.1.1.0/24'; if [ $? -ne 0 ] ; then ip route add \"10.1.1.0/24\" via 99.99.99.1 ; fi\n", "delta": "0:00:00.008177", "end": "2019-12-05 16:53:00.326710", "item": [{"bridge_name": "t1br1", "default_route_ip": "10.2.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.5", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.2.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.2.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.2.1.2/24"}], "vms": [{"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM4", "vcpu": 4, "vmif": "t1VM4if1"}]}, {"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.1.2", "remote_ip": "10.1.1.2", "remote_route": "10.1.1.0/24", "subnet_route": "10.2.1.0/24", "tenant_route_ip": "192.168.129.2", "v_name": "vxlan_t1s1"}], "rc": 0, "start": "2019-12-05 16:53:00.318533", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}
skipping: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.2.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.2.2.1', u'bridge_name': u't1br2', u'dns': [{u'dnsif': u't1s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s2_dnsbrif'}], u'ns_name': u't1ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.2.2/24', u'tenant_ns_ip': u'10.2.2.1/24', u'tenant_ns_if': u't1ns2if', u'tenant_sub_if': u't1s2if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'2.2.2.0/24', u'vms': [{u'mem': 3, u'name': u't1_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br2if1', u'vmif': u't1VM3if1'}]}, {u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}])  => {"ansible_loop_var": "item", "changed": false, "item": [{"bridge_name": "t1br2", "default_route_ip": "10.2.2.1", "dns": [{"brif": "t1s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t1s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns2", "route": [{"if": "p1", "ip": "10.2.2.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "2.2.2.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns2if", "tenant_ns_ip": "10.2.2.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s2if", "tenant_sub_ip": "10.2.2.2/24"}], "vms": [{"brif": "t1br2if1", "disk": "10G", "mem": 3, "name": "t1_VM3", "vcpu": 2, "vmif": "t1VM3if1"}]}, {"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}], "skip_reason": "Conditional result was False"}

PLAY RECAP **************************************************************************************************************************************************
99.99.99.2                 : ok=3    changed=2    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0   

Using /etc/ansible/ansible.cfg as config file

PLAY [main] *************************************************************************************************************************************************

TASK [Create VM templates (C1)] *****************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.1.2/24', u'tenant_ns_ip': u'10.1.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.1.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.1.2', u'remote_route': u'10.2.1.0/24', u'subnet_route': u'10.1.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.2.1.2'}]}, {u'mem': 2, u'name': u't1_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM1if1'}]) => {"ansible_loop_var": "item", "changed": true, "checksum": "350ba870bd31b7f6ee517845c14237910b5af0bf", "dest": "/root/Migration-as-a-Service/etc/t1/VM_templates/t1_VM1.xml.j2", "gid": 0, "group": "root", "item": [{"bridge_name": "t1br1", "default_route_ip": "10.1.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.5", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.1.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.1.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.1.1.2/24"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.1.2", "remote_ip": "10.2.1.2", "remote_route": "10.2.1.0/24", "subnet_route": "10.1.1.0/24", "tenant_route_ip": "192.168.1.2", "v_name": "vxlan_t1s1"}]}, {"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM1", "vcpu": 4, "vmif": "t1VM1if1"}], "md5sum": "fbfc2eb0c2569531f25eea92c26d3bee", "mode": "0644", "owner": "root", "size": 4091, "src": "/root/.ansible/tmp/ansible-tmp-1575564781.02-253102262605216/source", "state": "file", "uid": 0}
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.1.2/24', u'tenant_ns_ip': u'10.1.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.1.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.1.2', u'remote_route': u'10.2.1.0/24', u'subnet_route': u'10.1.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.2.1.2'}]}, {u'mem': 4, u'name': u't1_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br1if2', u'vmif': u't1VM2if1'}]) => {"ansible_loop_var": "item", "changed": true, "checksum": "350ba870bd31b7f6ee517845c14237910b5af0bf", "dest": "/root/Migration-as-a-Service/etc/t1/VM_templates/t1_VM2.xml.j2", "gid": 0, "group": "root", "item": [{"bridge_name": "t1br1", "default_route_ip": "10.1.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.5", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.1.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.1.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.1.1.2/24"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.1.2", "remote_ip": "10.2.1.2", "remote_route": "10.2.1.0/24", "subnet_route": "10.1.1.0/24", "tenant_route_ip": "192.168.1.2", "v_name": "vxlan_t1s1"}]}, {"brif": "t1br1if2", "disk": "10G", "mem": 4, "name": "t1_VM2", "vcpu": 2, "vmif": "t1VM2if1"}], "md5sum": "fbfc2eb0c2569531f25eea92c26d3bee", "mode": "0644", "owner": "root", "size": 4091, "src": "/root/.ansible/tmp/ansible-tmp-1575564781.6-28717099839816/source", "state": "file", "uid": 0}

PLAY RECAP **************************************************************************************************************************************************
localhost                  : ok=1    changed=1    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0   

Using /etc/ansible/ansible.cfg as config file

PLAY [main] *************************************************************************************************************************************************

TASK [Create VM templates (C2)] *****************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.2.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.2.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.1.2/24', u'tenant_ns_ip': u'10.2.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.2.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.129.2', u'remote_route': u'10.1.1.0/24', u'subnet_route': u'10.2.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.1.1.2'}]}, {u'mem': 2, u'name': u't1_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM4if1'}]) => {"ansible_loop_var": "item", "changed": true, "checksum": "350ba870bd31b7f6ee517845c14237910b5af0bf", "dest": "/root/Migration-as-a-Service/etc/t1/VM_templates/t1_VM4.xml.j2", "gid": 0, "group": "root", "item": [{"bridge_name": "t1br1", "default_route_ip": "10.2.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.5", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.2.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.2.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.2.1.2/24"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.1.2", "remote_ip": "10.1.1.2", "remote_route": "10.1.1.0/24", "subnet_route": "10.2.1.0/24", "tenant_route_ip": "192.168.129.2", "v_name": "vxlan_t1s1"}]}, {"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM4", "vcpu": 4, "vmif": "t1VM4if1"}], "md5sum": "fbfc2eb0c2569531f25eea92c26d3bee", "mode": "0644", "owner": "root", "size": 4091, "src": "/root/.ansible/tmp/ansible-tmp-1575564782.48-133612664587968/source", "state": "file", "uid": 0}
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.2.2.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.2.2.1', u'bridge_name': u't1br2', u'dns': [{u'dnsif': u't1s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s2_dnsbrif'}], u'ns_name': u't1ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.2.2/24', u'tenant_ns_ip': u'10.2.2.1/24', u'tenant_ns_if': u't1ns2if', u'tenant_sub_if': u't1s2if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'2.2.2.0/24', u'vxlan': [{u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}, {u'mem': 3, u'name': u't1_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br2if1', u'vmif': u't1VM3if1'}]) => {"ansible_loop_var": "item", "changed": true, "checksum": "350ba870bd31b7f6ee517845c14237910b5af0bf", "dest": "/root/Migration-as-a-Service/etc/t1/VM_templates/t1_VM3.xml.j2", "gid": 0, "group": "root", "item": [{"bridge_name": "t1br2", "default_route_ip": "10.2.2.1", "dns": [{"brif": "t1s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t1s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns2", "route": [{"if": "p1", "ip": "10.2.2.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "2.2.2.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns2if", "tenant_ns_ip": "10.2.2.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s2if", "tenant_sub_ip": "10.2.2.2/24"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, {"brif": "t1br2if1", "disk": "10G", "mem": 3, "name": "t1_VM3", "vcpu": 2, "vmif": "t1VM3if1"}], "md5sum": "fbfc2eb0c2569531f25eea92c26d3bee", "mode": "0644", "owner": "root", "size": 4091, "src": "/root/.ansible/tmp/ansible-tmp-1575564783.05-86552572139749/source", "state": "file", "uid": 0}

PLAY RECAP **************************************************************************************************************************************************
localhost                  : ok=1    changed=1    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0   

Using /etc/ansible/ansible.cfg as config file

PLAY [main] *************************************************************************************************************************************************

TASK [Copy VM image] ****************************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.1.2/24', u'tenant_ns_ip': u'10.1.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.1.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.1.2', u'remote_route': u'10.2.1.0/24', u'subnet_route': u'10.1.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.2.1.2'}]}, {u'mem': 2, u'name': u't1_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM1if1'}]) => {"ansible_loop_var": "item", "changed": true, "checksum": "d86d5962370fcd0c3d05943fc209d9e05fdac89f", "dest": "/var/lib/libvirt/images/t1_VM1.qcow2", "gid": 0, "group": "root", "item": [{"bridge_name": "t1br1", "default_route_ip": "10.1.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.5", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.1.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.1.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.1.1.2/24"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.1.2", "remote_ip": "10.2.1.2", "remote_route": "10.2.1.0/24", "subnet_route": "10.1.1.0/24", "tenant_route_ip": "192.168.1.2", "v_name": "vxlan_t1s1"}]}, {"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM1", "vcpu": 4, "vmif": "t1VM1if1"}], "md5sum": "b977a19124b65f2d544ddc62e407114d", "mode": "0644", "owner": "root", "size": 10739318784, "src": "/root/.ansible/tmp/ansible-tmp-1575564784.07-25587481027340/source", "state": "file", "uid": 0}
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.1.2/24', u'tenant_ns_ip': u'10.1.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.1.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.1.2', u'remote_route': u'10.2.1.0/24', u'subnet_route': u'10.1.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.2.1.2'}]}, {u'mem': 4, u'name': u't1_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br1if2', u'vmif': u't1VM2if1'}]) => {"ansible_loop_var": "item", "changed": true, "checksum": "d86d5962370fcd0c3d05943fc209d9e05fdac89f", "dest": "/var/lib/libvirt/images/t1_VM2.qcow2", "gid": 0, "group": "root", "item": [{"bridge_name": "t1br1", "default_route_ip": "10.1.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.5", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.1.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.1.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.1.1.2/24"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.1.2", "remote_ip": "10.2.1.2", "remote_route": "10.2.1.0/24", "subnet_route": "10.1.1.0/24", "tenant_route_ip": "192.168.1.2", "v_name": "vxlan_t1s1"}]}, {"brif": "t1br1if2", "disk": "10G", "mem": 4, "name": "t1_VM2", "vcpu": 2, "vmif": "t1VM2if1"}], "md5sum": "b977a19124b65f2d544ddc62e407114d", "mode": "0644", "owner": "root", "size": 10739318784, "src": "/root/.ansible/tmp/ansible-tmp-1575564881.04-76678975040675/source", "state": "file", "uid": 0}

TASK [Get list of running VMs] ******************************************************************************************************************************
ok: [localhost] => {"changed": false, "cmd": ["virsh", "list", "--name"], "delta": "0:00:00.044711", "end": "2019-12-05 16:56:00.315116", "rc": 0, "start": "2019-12-05 16:56:00.270405", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Define VM] ********************************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.1.2/24', u'tenant_ns_ip': u'10.1.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.1.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.1.2', u'remote_route': u'10.2.1.0/24', u'subnet_route': u'10.1.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.2.1.2'}]}, {u'mem': 2, u'name': u't1_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM1if1'}]) => {"ansible_loop_var": "item", "changed": true, "created": "t1_VM1", "item": [{"bridge_name": "t1br1", "default_route_ip": "10.1.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.5", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.1.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.1.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.1.1.2/24"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.1.2", "remote_ip": "10.2.1.2", "remote_route": "10.2.1.0/24", "subnet_route": "10.1.1.0/24", "tenant_route_ip": "192.168.1.2", "v_name": "vxlan_t1s1"}]}, {"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM1", "vcpu": 4, "vmif": "t1VM1if1"}], "warnings": ["'xml' is given - ignoring 'name'"]}
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.1.2/24', u'tenant_ns_ip': u'10.1.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.1.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.1.2', u'remote_route': u'10.2.1.0/24', u'subnet_route': u'10.1.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.2.1.2'}]}, {u'mem': 4, u'name': u't1_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br1if2', u'vmif': u't1VM2if1'}]) => {"ansible_loop_var": "item", "changed": true, "created": "t1_VM2", "item": [{"bridge_name": "t1br1", "default_route_ip": "10.1.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.5", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.1.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.1.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.1.1.2/24"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.1.2", "remote_ip": "10.2.1.2", "remote_route": "10.2.1.0/24", "subnet_route": "10.1.1.0/24", "tenant_route_ip": "192.168.1.2", "v_name": "vxlan_t1s1"}]}, {"brif": "t1br1if2", "disk": "10G", "mem": 4, "name": "t1_VM2", "vcpu": 2, "vmif": "t1VM2if1"}], "warnings": ["'xml' is given - ignoring 'name'"]}

TASK [Create VM] ********************************************************************************************************************************************
ok: [localhost] => (item=[{u'route': [{u'ip': u'10.1.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.1.2/24', u'tenant_ns_ip': u'10.1.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.1.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.1.2', u'remote_route': u'10.2.1.0/24', u'subnet_route': u'10.1.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.2.1.2'}]}, {u'mem': 2, u'name': u't1_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM1if1'}]) => {"ansible_loop_var": "item", "changed": false, "create": 0, "item": [{"bridge_name": "t1br1", "default_route_ip": "10.1.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.5", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.1.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.1.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.1.1.2/24"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.1.2", "remote_ip": "10.2.1.2", "remote_route": "10.2.1.0/24", "subnet_route": "10.1.1.0/24", "tenant_route_ip": "192.168.1.2", "v_name": "vxlan_t1s1"}]}, {"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM1", "vcpu": 4, "vmif": "t1VM1if1"}]}
ok: [localhost] => (item=[{u'route': [{u'ip': u'10.1.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.1.2/24', u'tenant_ns_ip': u'10.1.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.1.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.1.2', u'remote_route': u'10.2.1.0/24', u'subnet_route': u'10.1.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.2.1.2'}]}, {u'mem': 4, u'name': u't1_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br1if2', u'vmif': u't1VM2if1'}]) => {"ansible_loop_var": "item", "changed": false, "create": 0, "item": [{"bridge_name": "t1br1", "default_route_ip": "10.1.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.5", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.1.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.1.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.1.1.2/24"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.1.2", "remote_ip": "10.2.1.2", "remote_route": "10.2.1.0/24", "subnet_route": "10.1.1.0/24", "tenant_route_ip": "192.168.1.2", "v_name": "vxlan_t1s1"}]}, {"brif": "t1br1if2", "disk": "10G", "mem": 4, "name": "t1_VM2", "vcpu": 2, "vmif": "t1VM2if1"}]}

TASK [Start VM] *********************************************************************************************************************************************
ok: [localhost] => (item=[{u'route': [{u'ip': u'10.1.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.1.2/24', u'tenant_ns_ip': u'10.1.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.1.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.1.2', u'remote_route': u'10.2.1.0/24', u'subnet_route': u'10.1.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.2.1.2'}]}, {u'mem': 2, u'name': u't1_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM1if1'}]) => {"ansible_loop_var": "item", "changed": false, "item": [{"bridge_name": "t1br1", "default_route_ip": "10.1.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.5", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.1.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.1.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.1.1.2/24"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.1.2", "remote_ip": "10.2.1.2", "remote_route": "10.2.1.0/24", "subnet_route": "10.1.1.0/24", "tenant_route_ip": "192.168.1.2", "v_name": "vxlan_t1s1"}]}, {"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM1", "vcpu": 4, "vmif": "t1VM1if1"}]}
ok: [localhost] => (item=[{u'route': [{u'ip': u'10.1.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.1.2/24', u'tenant_ns_ip': u'10.1.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.1.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.1.2', u'remote_route': u'10.2.1.0/24', u'subnet_route': u'10.1.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.2.1.2'}]}, {u'mem': 4, u'name': u't1_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br1if2', u'vmif': u't1VM2if1'}]) => {"ansible_loop_var": "item", "changed": false, "item": [{"bridge_name": "t1br1", "default_route_ip": "10.1.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.5", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.1.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.1.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.1.1.2/24"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.1.2", "remote_ip": "10.2.1.2", "remote_route": "10.2.1.0/24", "subnet_route": "10.1.1.0/24", "tenant_route_ip": "192.168.1.2", "v_name": "vxlan_t1s1"}]}, {"brif": "t1br1if2", "disk": "10G", "mem": 4, "name": "t1_VM2", "vcpu": 2, "vmif": "t1VM2if1"}]}

TASK [Attach VM interface] **********************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.1.2/24', u'tenant_ns_ip': u'10.1.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.1.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.1.2', u'remote_route': u'10.2.1.0/24', u'subnet_route': u'10.1.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.2.1.2'}]}, {u'mem': 2, u'name': u't1_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM1if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "virsh domiflist \"t1_VM1\" | grep -w 't1VM1if1' ; if [ $? -ne 0 ] ; then virsh attach-interface \"t1_VM1\" direct \"t1VM1if1\" --live --persistent ; fi\n", "delta": "0:00:02.724745", "end": "2019-12-05 16:56:20.237364", "item": [{"bridge_name": "t1br1", "default_route_ip": "10.1.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.5", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.1.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.1.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.1.1.2/24"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.1.2", "remote_ip": "10.2.1.2", "remote_route": "10.2.1.0/24", "subnet_route": "10.1.1.0/24", "tenant_route_ip": "192.168.1.2", "v_name": "vxlan_t1s1"}]}, {"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM1", "vcpu": 4, "vmif": "t1VM1if1"}], "rc": 0, "start": "2019-12-05 16:56:17.512619", "stderr": "", "stderr_lines": [], "stdout": "Interface attached successfully", "stdout_lines": ["Interface attached successfully"]}
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.1.2/24', u'tenant_ns_ip': u'10.1.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.1.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.1.2', u'remote_route': u'10.2.1.0/24', u'subnet_route': u'10.1.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.2.1.2'}]}, {u'mem': 4, u'name': u't1_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br1if2', u'vmif': u't1VM2if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "virsh domiflist \"t1_VM2\" | grep -w 't1VM2if1' ; if [ $? -ne 0 ] ; then virsh attach-interface \"t1_VM2\" direct \"t1VM2if1\" --live --persistent ; fi\n", "delta": "0:00:00.228499", "end": "2019-12-05 16:56:20.624453", "item": [{"bridge_name": "t1br1", "default_route_ip": "10.1.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.5", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.1.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.1.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.1.1.2/24"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.1.2", "remote_ip": "10.2.1.2", "remote_route": "10.2.1.0/24", "subnet_route": "10.1.1.0/24", "tenant_route_ip": "192.168.1.2", "v_name": "vxlan_t1s1"}]}, {"brif": "t1br1if2", "disk": "10G", "mem": 4, "name": "t1_VM2", "vcpu": 2, "vmif": "t1VM2if1"}], "rc": 0, "start": "2019-12-05 16:56:20.395954", "stderr": "", "stderr_lines": [], "stdout": "Interface attached successfully", "stdout_lines": ["Interface attached successfully"]}

PLAY RECAP **************************************************************************************************************************************************
localhost                  : ok=6    changed=3    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0   

Using /etc/ansible/ansible.cfg as config file

PLAY [worker] ***********************************************************************************************************************************************

TASK [Copy VM image] ****************************************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.2.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.1.2/24', u'tenant_ns_ip': u'10.2.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.2.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.129.2', u'remote_route': u'10.1.1.0/24', u'subnet_route': u'10.2.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.1.1.2'}]}, {u'mem': 2, u'name': u't1_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM4if1'}]) => {"ansible_loop_var": "item", "changed": true, "checksum": "f8b2ffa2bf201c84196c582f2dec0d33a1eb4b42", "dest": "/var/lib/libvirt/images/t1_VM4.qcow2", "gid": 0, "group": "root", "item": [{"bridge_name": "t1br1", "default_route_ip": "10.2.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.5", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.2.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.2.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.2.1.2/24"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.1.2", "remote_ip": "10.1.1.2", "remote_route": "10.1.1.0/24", "subnet_route": "10.2.1.0/24", "tenant_route_ip": "192.168.129.2", "v_name": "vxlan_t1s1"}]}, {"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM4", "vcpu": 4, "vmif": "t1VM4if1"}], "md5sum": "e6d5d524b68797ddd748ba1475985d34", "mode": "0644", "owner": "root", "size": 10739318784, "src": "/root/mainVM.qcow2", "state": "file", "uid": 0}
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.2.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.2.2.1', u'bridge_name': u't1br2', u'dns': [{u'dnsif': u't1s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s2_dnsbrif'}], u'ns_name': u't1ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.2.2/24', u'tenant_ns_ip': u'10.2.2.1/24', u'tenant_ns_if': u't1ns2if', u'tenant_sub_if': u't1s2if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'2.2.2.0/24', u'vxlan': [{u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}, {u'mem': 3, u'name': u't1_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br2if1', u'vmif': u't1VM3if1'}]) => {"ansible_loop_var": "item", "changed": true, "checksum": "f8b2ffa2bf201c84196c582f2dec0d33a1eb4b42", "dest": "/var/lib/libvirt/images/t1_VM3.qcow2", "gid": 0, "group": "root", "item": [{"bridge_name": "t1br2", "default_route_ip": "10.2.2.1", "dns": [{"brif": "t1s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t1s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns2", "route": [{"if": "p1", "ip": "10.2.2.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "2.2.2.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns2if", "tenant_ns_ip": "10.2.2.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s2if", "tenant_sub_ip": "10.2.2.2/24"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, {"brif": "t1br2if1", "disk": "10G", "mem": 3, "name": "t1_VM3", "vcpu": 2, "vmif": "t1VM3if1"}], "md5sum": "e6d5d524b68797ddd748ba1475985d34", "mode": "0644", "owner": "root", "size": 10739318784, "src": "/root/mainVM.qcow2", "state": "file", "uid": 0}

TASK [Get list of running VMs] ******************************************************************************************************************************
ok: [99.99.99.2] => {"changed": false, "cmd": ["virsh", "list", "--name"], "delta": "0:00:00.045389", "end": "2019-12-05 17:00:02.639065", "rc": 0, "start": "2019-12-05 17:00:02.593676", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Define VM] ********************************************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.2.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.1.2/24', u'tenant_ns_ip': u'10.2.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.2.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.129.2', u'remote_route': u'10.1.1.0/24', u'subnet_route': u'10.2.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.1.1.2'}]}, {u'mem': 2, u'name': u't1_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM4if1'}]) => {"ansible_loop_var": "item", "changed": true, "created": "t1_VM4", "item": [{"bridge_name": "t1br1", "default_route_ip": "10.2.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.5", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.2.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.2.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.2.1.2/24"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.1.2", "remote_ip": "10.1.1.2", "remote_route": "10.1.1.0/24", "subnet_route": "10.2.1.0/24", "tenant_route_ip": "192.168.129.2", "v_name": "vxlan_t1s1"}]}, {"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM4", "vcpu": 4, "vmif": "t1VM4if1"}], "warnings": ["'xml' is given - ignoring 'name'"]}
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.2.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.2.2.1', u'bridge_name': u't1br2', u'dns': [{u'dnsif': u't1s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s2_dnsbrif'}], u'ns_name': u't1ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.2.2/24', u'tenant_ns_ip': u'10.2.2.1/24', u'tenant_ns_if': u't1ns2if', u'tenant_sub_if': u't1s2if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'2.2.2.0/24', u'vxlan': [{u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}, {u'mem': 3, u'name': u't1_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br2if1', u'vmif': u't1VM3if1'}]) => {"ansible_loop_var": "item", "changed": true, "created": "t1_VM3", "item": [{"bridge_name": "t1br2", "default_route_ip": "10.2.2.1", "dns": [{"brif": "t1s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t1s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns2", "route": [{"if": "p1", "ip": "10.2.2.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "2.2.2.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns2if", "tenant_ns_ip": "10.2.2.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s2if", "tenant_sub_ip": "10.2.2.2/24"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, {"brif": "t1br2if1", "disk": "10G", "mem": 3, "name": "t1_VM3", "vcpu": 2, "vmif": "t1VM3if1"}], "warnings": ["'xml' is given - ignoring 'name'"]}

TASK [Create VM] ********************************************************************************************************************************************
ok: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.2.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.1.2/24', u'tenant_ns_ip': u'10.2.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.2.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.129.2', u'remote_route': u'10.1.1.0/24', u'subnet_route': u'10.2.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.1.1.2'}]}, {u'mem': 2, u'name': u't1_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM4if1'}]) => {"ansible_loop_var": "item", "changed": false, "create": 0, "item": [{"bridge_name": "t1br1", "default_route_ip": "10.2.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.5", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.2.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.2.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.2.1.2/24"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.1.2", "remote_ip": "10.1.1.2", "remote_route": "10.1.1.0/24", "subnet_route": "10.2.1.0/24", "tenant_route_ip": "192.168.129.2", "v_name": "vxlan_t1s1"}]}, {"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM4", "vcpu": 4, "vmif": "t1VM4if1"}]}
ok: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.2.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.2.2.1', u'bridge_name': u't1br2', u'dns': [{u'dnsif': u't1s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s2_dnsbrif'}], u'ns_name': u't1ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.2.2/24', u'tenant_ns_ip': u'10.2.2.1/24', u'tenant_ns_if': u't1ns2if', u'tenant_sub_if': u't1s2if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'2.2.2.0/24', u'vxlan': [{u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}, {u'mem': 3, u'name': u't1_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br2if1', u'vmif': u't1VM3if1'}]) => {"ansible_loop_var": "item", "changed": false, "create": 0, "item": [{"bridge_name": "t1br2", "default_route_ip": "10.2.2.1", "dns": [{"brif": "t1s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t1s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns2", "route": [{"if": "p1", "ip": "10.2.2.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "2.2.2.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns2if", "tenant_ns_ip": "10.2.2.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s2if", "tenant_sub_ip": "10.2.2.2/24"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, {"brif": "t1br2if1", "disk": "10G", "mem": 3, "name": "t1_VM3", "vcpu": 2, "vmif": "t1VM3if1"}]}

TASK [Start VM] *********************************************************************************************************************************************
ok: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.2.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.1.2/24', u'tenant_ns_ip': u'10.2.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.2.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.129.2', u'remote_route': u'10.1.1.0/24', u'subnet_route': u'10.2.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.1.1.2'}]}, {u'mem': 2, u'name': u't1_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM4if1'}]) => {"ansible_loop_var": "item", "changed": false, "item": [{"bridge_name": "t1br1", "default_route_ip": "10.2.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.5", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.2.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.2.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.2.1.2/24"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.1.2", "remote_ip": "10.1.1.2", "remote_route": "10.1.1.0/24", "subnet_route": "10.2.1.0/24", "tenant_route_ip": "192.168.129.2", "v_name": "vxlan_t1s1"}]}, {"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM4", "vcpu": 4, "vmif": "t1VM4if1"}]}
ok: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.2.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.2.2.1', u'bridge_name': u't1br2', u'dns': [{u'dnsif': u't1s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s2_dnsbrif'}], u'ns_name': u't1ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.2.2/24', u'tenant_ns_ip': u'10.2.2.1/24', u'tenant_ns_if': u't1ns2if', u'tenant_sub_if': u't1s2if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'2.2.2.0/24', u'vxlan': [{u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}, {u'mem': 3, u'name': u't1_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br2if1', u'vmif': u't1VM3if1'}]) => {"ansible_loop_var": "item", "changed": false, "item": [{"bridge_name": "t1br2", "default_route_ip": "10.2.2.1", "dns": [{"brif": "t1s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t1s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns2", "route": [{"if": "p1", "ip": "10.2.2.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "2.2.2.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns2if", "tenant_ns_ip": "10.2.2.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s2if", "tenant_sub_ip": "10.2.2.2/24"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, {"brif": "t1br2if1", "disk": "10G", "mem": 3, "name": "t1_VM3", "vcpu": 2, "vmif": "t1VM3if1"}]}

TASK [Attach VM interface] **********************************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.2.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.1.2/24', u'tenant_ns_ip': u'10.2.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.2.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.129.2', u'remote_route': u'10.1.1.0/24', u'subnet_route': u'10.2.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.1.1.2'}]}, {u'mem': 2, u'name': u't1_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM4if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "virsh domiflist \"t1_VM4\" | grep -w 't1VM4if1' ; if [ $? -ne 0 ] ; then virsh attach-interface \"t1_VM4\" direct \"t1VM4if1\" --live --persistent ; fi\n", "delta": "0:00:00.286867", "end": "2019-12-05 17:00:07.764798", "item": [{"bridge_name": "t1br1", "default_route_ip": "10.2.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.5", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.2.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.2.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.2.1.2/24"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.1.2", "remote_ip": "10.1.1.2", "remote_route": "10.1.1.0/24", "subnet_route": "10.2.1.0/24", "tenant_route_ip": "192.168.129.2", "v_name": "vxlan_t1s1"}]}, {"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM4", "vcpu": 4, "vmif": "t1VM4if1"}], "rc": 0, "start": "2019-12-05 17:00:07.477931", "stderr": "", "stderr_lines": [], "stdout": "Interface attached successfully", "stdout_lines": ["Interface attached successfully"]}
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.2.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.2.2.1', u'bridge_name': u't1br2', u'dns': [{u'dnsif': u't1s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s2_dnsbrif'}], u'ns_name': u't1ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.2.2/24', u'tenant_ns_ip': u'10.2.2.1/24', u'tenant_ns_if': u't1ns2if', u'tenant_sub_if': u't1s2if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'2.2.2.0/24', u'vxlan': [{u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}, {u'mem': 3, u'name': u't1_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br2if1', u'vmif': u't1VM3if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "virsh domiflist \"t1_VM3\" | grep -w 't1VM3if1' ; if [ $? -ne 0 ] ; then virsh attach-interface \"t1_VM3\" direct \"t1VM3if1\" --live --persistent ; fi\n", "delta": "0:00:00.220787", "end": "2019-12-05 17:00:08.257936", "item": [{"bridge_name": "t1br2", "default_route_ip": "10.2.2.1", "dns": [{"brif": "t1s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t1s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns2", "route": [{"if": "p1", "ip": "10.2.2.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "2.2.2.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns2if", "tenant_ns_ip": "10.2.2.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s2if", "tenant_sub_ip": "10.2.2.2/24"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, {"brif": "t1br2if1", "disk": "10G", "mem": 3, "name": "t1_VM3", "vcpu": 2, "vmif": "t1VM3if1"}], "rc": 0, "start": "2019-12-05 17:00:08.037149", "stderr": "", "stderr_lines": [], "stdout": "Interface attached successfully", "stdout_lines": ["Interface attached successfully"]}

PLAY RECAP **************************************************************************************************************************************************
99.99.99.2                 : ok=6    changed=3    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0   

INFO:root: 17:15:37.407959 Printing the yaml input file
INFO:root: 17:15:37.408143 {'C1': [{'VM': [{'disk': '10G', 'internet_access': True, 'mem': 2, 'name': 'VM1', 'vcpu': 4}, {'disk': '10G', 'internet_access': False, 'mem': 4, 'name': 'VM2', 'vcpu': 2}], 'subnet_addr': '1.1.1.0/24'}], 'C2': [{'VM': [{'disk': '10G', 'internet_access': True, 'mem': 2, 'name': 'VM4', 'vcpu': 4}], 'subnet_addr': '1.1.1.0/24'}, {'VM': [{'disk': '10G', 'internet_access': True, 'mem': 3, 'name': 'VM3', 'vcpu': 2}], 'subnet_addr': '2.2.2.0/24'}], 'MISC': [{'LOG_ENABLE': True}, {'GUI': True}]}
INFO:root: 17:15:37.408262 Provided subnet in C1: 1.1.1.0/24 is valid
INFO:root: 17:15:37.408313 Provided subnet in C2: 1.1.1.0/24 is valid
INFO:root: 17:15:37.408353 Provided subnet in C2: 2.2.2.0/24 is valid
Using /etc/ansible/ansible.cfg as config file

PLAY [main] *************************************************************************************************************************************************

TASK [Create Tenant Namespace] ******************************************************************************************************************************
changed: [localhost] => (item={u'default_route_ip': u'192.168.2.1', u'name': u't2', u'pns_ip': u'192.168.2.1/24', u'tenant_if': u't2if', u'tenant_ip': u'192.168.2.2/24', u'pns_if': u't2pns_if'}) => {"ansible_loop_var": "item", "changed": true, "cmd": ["ip", "netns", "add", "t2"], "delta": "0:00:00.071459", "end": "2019-12-05 17:15:38.653906", "item": {"default_route_ip": "192.168.2.1", "name": "t2", "pns_if": "t2pns_if", "pns_ip": "192.168.2.1/24", "tenant_if": "t2if", "tenant_ip": "192.168.2.2/24"}, "rc": 0, "start": "2019-12-05 17:15:38.582447", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Create Subnet Namespace] ******************************************************************************************************************************
changed: [localhost] => (item={u'route': [{u'ip': u'10.1.11.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.1.11.1', u'bridge_name': u't2br1', u'dns': [{u'dnsif': u't2s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't2s1_dnsbrif'}], u'ns_name': u't2ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.11.2/24', u'tenant_ns_ip': u'10.1.11.1/24', u'tenant_ns_if': u't2ns1if', u'tenant_ns_name': u't2', u'tenant_sub_if': u't2s1if'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't2_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't2br1if1', u'vmif': u't2VM1if1'}, {u'mem': 4, u'name': u't2_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't2br1if2', u'vmif': u't2VM2if1'}], u'vxlan': [{u'local_ip': u'10.1.11.2', u'tenant_route_ip': u'192.168.2.2', u'dsport': 4789, u'dev': u't2s1if', u'subnet_route': u'10.1.11.0/24', u'remote_route': u'10.2.11.0/24', u'v_name': u'vxlan_t2s1', u'id': 42, u'remote_ip': u'10.2.11.2'}]}) => {"ansible_loop_var": "item", "changed": true, "cmd": ["ip", "netns", "add", "t2ns1"], "delta": "0:00:00.075022", "end": "2019-12-05 17:15:39.000074", "item": {"bridge_name": "t2br1", "default_route_ip": "10.1.11.1", "dns": [{"brif": "t2s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.5", "dnsif": "t2s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns1", "route": [{"if": "p1", "ip": "10.1.11.1/24", "ns_if": "t2if", "ns_name": "t2"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t2ns1if", "tenant_ns_ip": "10.1.11.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s1if", "tenant_sub_ip": "10.1.11.2/24"}], "vms": [{"brif": "t2br1if1", "disk": "10G", "mem": 2, "name": "t2_VM1", "vcpu": 4, "vmif": "t2VM1if1"}, {"brif": "t2br1if2", "disk": "10G", "mem": 4, "name": "t2_VM2", "vcpu": 2, "vmif": "t2VM2if1"}], "vxlan": [{"dev": "t2s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.11.2", "remote_ip": "10.2.11.2", "remote_route": "10.2.11.0/24", "subnet_route": "10.1.11.0/24", "tenant_route_ip": "192.168.2.2", "v_name": "vxlan_t2s1"}]}, "rc": 0, "start": "2019-12-05 17:15:38.925052", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Create Tenant VETH pairs] *****************************************************************************************************************************
changed: [localhost] => (item={u'default_route_ip': u'192.168.2.1', u'name': u't2', u'pns_ip': u'192.168.2.1/24', u'tenant_if': u't2if', u'tenant_ip': u'192.168.2.2/24', u'pns_if': u't2pns_if'}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip link show \"t2if\" ; if [ $? -ne 0 ] ; then ip link add \"t2if\" type veth peer name \"t2pns_if\" ; fi\n", "delta": "0:00:00.011057", "end": "2019-12-05 17:15:39.275579", "item": {"default_route_ip": "192.168.2.1", "name": "t2", "pns_if": "t2pns_if", "pns_ip": "192.168.2.1/24", "tenant_if": "t2if", "tenant_ip": "192.168.2.2/24"}, "rc": 0, "start": "2019-12-05 17:15:39.264522", "stderr": "Device \"t2if\" does not exist.", "stderr_lines": ["Device \"t2if\" does not exist."], "stdout": "", "stdout_lines": []}

TASK [Attach Tenant VETH Pairs] *****************************************************************************************************************************
changed: [localhost] => (item={u'default_route_ip': u'192.168.2.1', u'name': u't2', u'pns_ip': u'192.168.2.1/24', u'tenant_if': u't2if', u'tenant_ip': u'192.168.2.2/24', u'pns_if': u't2pns_if'}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec pns ip link show \"t2pns_if\" ; if [ $? -ne 0 ] ; then ip link set \"t2pns_if\" netns pns ; fi\nip netns exec \"t2\" ip link show \"t2if\" ; if [ $? -ne 0 ] ; then ip link set \"t2if\" netns \"t2\" ; fi\nip netns exec pns ip link set dev \"t2pns_if\" up\nip netns exec \"t2\" ip link set dev \"t2if\" up\n", "delta": "0:00:00.224108", "end": "2019-12-05 17:15:39.754978", "item": {"default_route_ip": "192.168.2.1", "name": "t2", "pns_if": "t2pns_if", "pns_ip": "192.168.2.1/24", "tenant_if": "t2if", "tenant_ip": "192.168.2.2/24"}, "rc": 0, "start": "2019-12-05 17:15:39.530870", "stderr": "Device \"t2pns_if\" does not exist.\nDevice \"t2if\" does not exist.", "stderr_lines": ["Device \"t2pns_if\" does not exist.", "Device \"t2if\" does not exist."], "stdout": "", "stdout_lines": []}

TASK [Add IP addresses to Tenant VETH Pairs] ****************************************************************************************************************
changed: [localhost] => (item={u'default_route_ip': u'192.168.2.1', u'name': u't2', u'pns_ip': u'192.168.2.1/24', u'tenant_if': u't2if', u'tenant_ip': u'192.168.2.2/24', u'pns_if': u't2pns_if'}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec pns ip addr show \"t2pns_if\" | awk 'FNR==3{ print $2 }' | grep -w '^192.168.2.1/24' ; if [ $? -ne 0 ] ; then ip netns exec pns ip addr add \"192.168.2.1/24\" dev \"t2pns_if\" ; fi\nip netns exec \"t2\" ip addr show \"t2if\" | awk 'FNR==3{ print $2 }' | grep -w '^192.168.2.2/24' ; if [ $? -ne 0 ] ; then ip netns exec \"t2\" ip addr add \"192.168.2.2/24\" dev \"t2if\" ; fi\n", "delta": "0:00:00.127886", "end": "2019-12-05 17:15:40.175075", "item": {"default_route_ip": "192.168.2.1", "name": "t2", "pns_if": "t2pns_if", "pns_ip": "192.168.2.1/24", "tenant_if": "t2if", "tenant_ip": "192.168.2.2/24"}, "rc": 0, "start": "2019-12-05 17:15:40.047189", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Create Namespace VETH Pairs] **************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.11.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.1.11.1', u'bridge_name': u't2br1', u'dns': [{u'dnsif': u't2s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't2s1_dnsbrif'}], u'ns_name': u't2ns1', u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't2_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't2br1if1', u'vmif': u't2VM1if1'}, {u'mem': 4, u'name': u't2_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't2br1if2', u'vmif': u't2VM2if1'}], u'vxlan': [{u'local_ip': u'10.1.11.2', u'dsport': 4789, u'dev': u't2s1if', u'tenant_route_ip': u'192.168.2.2', u'remote_route': u'10.2.11.0/24', u'subnet_route': u'10.1.11.0/24', u'v_name': u'vxlan_t2s1', u'id': 42, u'remote_ip': u'10.2.11.2'}]}, {u'tenant_sub_ip': u'10.1.11.2/24', u'tenant_ns_ip': u'10.1.11.1/24', u'tenant_ns_if': u't2ns1if', u'tenant_sub_if': u't2s1if', u'tenant_ns_name': u't2'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip link show \"t2ns1if\" ; if [ $? -ne 0 ] ; then ip link add \"t2ns1if\" type veth peer name \"t2s1if\" ; fi\n", "delta": "0:00:00.011833", "end": "2019-12-05 17:15:40.488049", "item": [{"bridge_name": "t2br1", "default_route_ip": "10.1.11.1", "dns": [{"brif": "t2s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.5", "dnsif": "t2s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns1", "route": [{"if": "p1", "ip": "10.1.11.1/24", "ns_if": "t2if", "ns_name": "t2"}], "subnet_ip": "1.1.1.0/24", "vms": [{"brif": "t2br1if1", "disk": "10G", "mem": 2, "name": "t2_VM1", "vcpu": 4, "vmif": "t2VM1if1"}, {"brif": "t2br1if2", "disk": "10G", "mem": 4, "name": "t2_VM2", "vcpu": 2, "vmif": "t2VM2if1"}], "vxlan": [{"dev": "t2s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.11.2", "remote_ip": "10.2.11.2", "remote_route": "10.2.11.0/24", "subnet_route": "10.1.11.0/24", "tenant_route_ip": "192.168.2.2", "v_name": "vxlan_t2s1"}]}, {"tenant_ns_if": "t2ns1if", "tenant_ns_ip": "10.1.11.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s1if", "tenant_sub_ip": "10.1.11.2/24"}], "rc": 0, "start": "2019-12-05 17:15:40.476216", "stderr": "Device \"t2ns1if\" does not exist.", "stderr_lines": ["Device \"t2ns1if\" does not exist."], "stdout": "", "stdout_lines": []}

TASK [Attach Namespace VETH Pairs] **************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.11.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.1.11.1', u'bridge_name': u't2br1', u'dns': [{u'dnsif': u't2s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't2s1_dnsbrif'}], u'ns_name': u't2ns1', u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't2_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't2br1if1', u'vmif': u't2VM1if1'}, {u'mem': 4, u'name': u't2_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't2br1if2', u'vmif': u't2VM2if1'}], u'vxlan': [{u'local_ip': u'10.1.11.2', u'dsport': 4789, u'dev': u't2s1if', u'tenant_route_ip': u'192.168.2.2', u'remote_route': u'10.2.11.0/24', u'subnet_route': u'10.1.11.0/24', u'v_name': u'vxlan_t2s1', u'id': 42, u'remote_ip': u'10.2.11.2'}]}, {u'tenant_sub_ip': u'10.1.11.2/24', u'tenant_ns_ip': u'10.1.11.1/24', u'tenant_ns_if': u't2ns1if', u'tenant_sub_if': u't2s1if', u'tenant_ns_name': u't2'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t2\" ip link show \"t2ns1if\" ; if [ $? -ne 0 ] ; then ip link set \"t2ns1if\" netns \"t2\" ; fi\nip netns exec \"t2ns1\" ip link show \"t2s1if\" ; if [ $? -ne 0 ] ; then ip link set \"t2s1if\" netns \"t2ns1\" ; fi\n", "delta": "0:00:00.115039", "end": "2019-12-05 17:15:40.902249", "item": [{"bridge_name": "t2br1", "default_route_ip": "10.1.11.1", "dns": [{"brif": "t2s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.5", "dnsif": "t2s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns1", "route": [{"if": "p1", "ip": "10.1.11.1/24", "ns_if": "t2if", "ns_name": "t2"}], "subnet_ip": "1.1.1.0/24", "vms": [{"brif": "t2br1if1", "disk": "10G", "mem": 2, "name": "t2_VM1", "vcpu": 4, "vmif": "t2VM1if1"}, {"brif": "t2br1if2", "disk": "10G", "mem": 4, "name": "t2_VM2", "vcpu": 2, "vmif": "t2VM2if1"}], "vxlan": [{"dev": "t2s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.11.2", "remote_ip": "10.2.11.2", "remote_route": "10.2.11.0/24", "subnet_route": "10.1.11.0/24", "tenant_route_ip": "192.168.2.2", "v_name": "vxlan_t2s1"}]}, {"tenant_ns_if": "t2ns1if", "tenant_ns_ip": "10.1.11.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s1if", "tenant_sub_ip": "10.1.11.2/24"}], "rc": 0, "start": "2019-12-05 17:15:40.787210", "stderr": "Device \"t2ns1if\" does not exist.\nDevice \"t2s1if\" does not exist.", "stderr_lines": ["Device \"t2ns1if\" does not exist.", "Device \"t2s1if\" does not exist."], "stdout": "", "stdout_lines": []}

TASK [Set Namespace VETH Pairs UP] **************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.11.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.1.11.1', u'bridge_name': u't2br1', u'dns': [{u'dnsif': u't2s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't2s1_dnsbrif'}], u'ns_name': u't2ns1', u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't2_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't2br1if1', u'vmif': u't2VM1if1'}, {u'mem': 4, u'name': u't2_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't2br1if2', u'vmif': u't2VM2if1'}], u'vxlan': [{u'local_ip': u'10.1.11.2', u'dsport': 4789, u'dev': u't2s1if', u'tenant_route_ip': u'192.168.2.2', u'remote_route': u'10.2.11.0/24', u'subnet_route': u'10.1.11.0/24', u'v_name': u'vxlan_t2s1', u'id': 42, u'remote_ip': u'10.2.11.2'}]}, {u'tenant_sub_ip': u'10.1.11.2/24', u'tenant_ns_ip': u'10.1.11.1/24', u'tenant_ns_if': u't2ns1if', u'tenant_sub_if': u't2s1if', u'tenant_ns_name': u't2'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t2\" ip link set dev \"t2ns1if\" up\nip netns exec \"t2ns1\" ip link set dev \"t2s1if\" up\n", "delta": "0:00:00.089484", "end": "2019-12-05 17:15:41.290760", "item": [{"bridge_name": "t2br1", "default_route_ip": "10.1.11.1", "dns": [{"brif": "t2s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.5", "dnsif": "t2s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns1", "route": [{"if": "p1", "ip": "10.1.11.1/24", "ns_if": "t2if", "ns_name": "t2"}], "subnet_ip": "1.1.1.0/24", "vms": [{"brif": "t2br1if1", "disk": "10G", "mem": 2, "name": "t2_VM1", "vcpu": 4, "vmif": "t2VM1if1"}, {"brif": "t2br1if2", "disk": "10G", "mem": 4, "name": "t2_VM2", "vcpu": 2, "vmif": "t2VM2if1"}], "vxlan": [{"dev": "t2s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.11.2", "remote_ip": "10.2.11.2", "remote_route": "10.2.11.0/24", "subnet_route": "10.1.11.0/24", "tenant_route_ip": "192.168.2.2", "v_name": "vxlan_t2s1"}]}, {"tenant_ns_if": "t2ns1if", "tenant_ns_ip": "10.1.11.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s1if", "tenant_sub_ip": "10.1.11.2/24"}], "rc": 0, "start": "2019-12-05 17:15:41.201276", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Add IP addresses to Namespace VETH Pairs] *************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.11.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.1.11.1', u'bridge_name': u't2br1', u'dns': [{u'dnsif': u't2s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't2s1_dnsbrif'}], u'ns_name': u't2ns1', u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't2_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't2br1if1', u'vmif': u't2VM1if1'}, {u'mem': 4, u'name': u't2_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't2br1if2', u'vmif': u't2VM2if1'}], u'vxlan': [{u'local_ip': u'10.1.11.2', u'dsport': 4789, u'dev': u't2s1if', u'tenant_route_ip': u'192.168.2.2', u'remote_route': u'10.2.11.0/24', u'subnet_route': u'10.1.11.0/24', u'v_name': u'vxlan_t2s1', u'id': 42, u'remote_ip': u'10.2.11.2'}]}, {u'tenant_sub_ip': u'10.1.11.2/24', u'tenant_ns_ip': u'10.1.11.1/24', u'tenant_ns_if': u't2ns1if', u'tenant_sub_if': u't2s1if', u'tenant_ns_name': u't2'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t2ns1\" ip addr show \"t2s1if\" | awk 'FNR==3{ print $2 }' | grep -w '^10.1.11.2/24' ; if [ $? -ne 0 ] ; then ip netns exec \"t2ns1\" ip addr add \"10.1.11.2/24\" dev \"t2s1if\" ; fi\n\nip netns exec \"t2\" ip addr show \"t2ns1if\" | awk 'FNR==3{ print $2 }' | grep -w '^10.1.11.1/24' ; if [ $? -ne 0 ] ; then ip netns exec \"t2\" ip addr add \"10.1.11.1/24\" dev \"t2ns1if\" ; fi\n", "delta": "0:00:00.145753", "end": "2019-12-05 17:15:41.766972", "item": [{"bridge_name": "t2br1", "default_route_ip": "10.1.11.1", "dns": [{"brif": "t2s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.5", "dnsif": "t2s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns1", "route": [{"if": "p1", "ip": "10.1.11.1/24", "ns_if": "t2if", "ns_name": "t2"}], "subnet_ip": "1.1.1.0/24", "vms": [{"brif": "t2br1if1", "disk": "10G", "mem": 2, "name": "t2_VM1", "vcpu": 4, "vmif": "t2VM1if1"}, {"brif": "t2br1if2", "disk": "10G", "mem": 4, "name": "t2_VM2", "vcpu": 2, "vmif": "t2VM2if1"}], "vxlan": [{"dev": "t2s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.11.2", "remote_ip": "10.2.11.2", "remote_route": "10.2.11.0/24", "subnet_route": "10.1.11.0/24", "tenant_route_ip": "192.168.2.2", "v_name": "vxlan_t2s1"}]}, {"tenant_ns_if": "t2ns1if", "tenant_ns_ip": "10.1.11.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s1if", "tenant_sub_ip": "10.1.11.2/24"}], "rc": 0, "start": "2019-12-05 17:15:41.621219", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Add IP Route to Tenant] *******************************************************************************************************************************
changed: [localhost] => (item={u'default_route_ip': u'192.168.2.1', u'name': u't2', u'pns_ip': u'192.168.2.1/24', u'tenant_if': u't2if', u'tenant_ip': u'192.168.2.2/24', u'pns_if': u't2pns_if'}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t2\" ip route show default | grep -w '[d]efault via 192.168.2.1' ; if [ $? -ne 0 ] ; then ip netns exec \"t2\" ip route add default via \"192.168.2.1\" ; fi\n", "delta": "0:00:00.091528", "end": "2019-12-05 17:15:42.110964", "item": {"default_route_ip": "192.168.2.1", "name": "t2", "pns_if": "t2pns_if", "pns_ip": "192.168.2.1/24", "tenant_if": "t2if", "tenant_ip": "192.168.2.2/24"}, "rc": 0, "start": "2019-12-05 17:15:42.019436", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Add IP Route to Tenant Subnet] ************************************************************************************************************************
changed: [localhost] => (item={u'route': [{u'ip': u'10.1.11.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.1.11.1', u'bridge_name': u't2br1', u'dns': [{u'dnsif': u't2s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't2s1_dnsbrif'}], u'ns_name': u't2ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.11.2/24', u'tenant_ns_ip': u'10.1.11.1/24', u'tenant_ns_if': u't2ns1if', u'tenant_ns_name': u't2', u'tenant_sub_if': u't2s1if'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't2_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't2br1if1', u'vmif': u't2VM1if1'}, {u'mem': 4, u'name': u't2_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't2br1if2', u'vmif': u't2VM2if1'}], u'vxlan': [{u'local_ip': u'10.1.11.2', u'tenant_route_ip': u'192.168.2.2', u'dsport': 4789, u'dev': u't2s1if', u'subnet_route': u'10.1.11.0/24', u'remote_route': u'10.2.11.0/24', u'v_name': u'vxlan_t2s1', u'id': 42, u'remote_ip': u'10.2.11.2'}]}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t2ns1\" ip route show default | grep -w '[d]efault via 10.1.11.1' ; if [ $? -ne 0 ] ; then ip netns exec \"t2ns1\" ip route add default via \"10.1.11.1\" ; fi\n", "delta": "0:00:00.085723", "end": "2019-12-05 17:15:42.482997", "item": {"bridge_name": "t2br1", "default_route_ip": "10.1.11.1", "dns": [{"brif": "t2s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.5", "dnsif": "t2s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns1", "route": [{"if": "p1", "ip": "10.1.11.1/24", "ns_if": "t2if", "ns_name": "t2"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t2ns1if", "tenant_ns_ip": "10.1.11.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s1if", "tenant_sub_ip": "10.1.11.2/24"}], "vms": [{"brif": "t2br1if1", "disk": "10G", "mem": 2, "name": "t2_VM1", "vcpu": 4, "vmif": "t2VM1if1"}, {"brif": "t2br1if2", "disk": "10G", "mem": 4, "name": "t2_VM2", "vcpu": 2, "vmif": "t2VM2if1"}], "vxlan": [{"dev": "t2s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.11.2", "remote_ip": "10.2.11.2", "remote_route": "10.2.11.0/24", "subnet_route": "10.1.11.0/24", "tenant_route_ip": "192.168.2.2", "v_name": "vxlan_t2s1"}]}, "rc": 0, "start": "2019-12-05 17:15:42.397274", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Create bridge inside namespace] ***********************************************************************************************************************
changed: [localhost] => (item={u'route': [{u'ip': u'10.1.11.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.1.11.1', u'bridge_name': u't2br1', u'dns': [{u'dnsif': u't2s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't2s1_dnsbrif'}], u'ns_name': u't2ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.11.2/24', u'tenant_ns_ip': u'10.1.11.1/24', u'tenant_ns_if': u't2ns1if', u'tenant_ns_name': u't2', u'tenant_sub_if': u't2s1if'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't2_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't2br1if1', u'vmif': u't2VM1if1'}, {u'mem': 4, u'name': u't2_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't2br1if2', u'vmif': u't2VM2if1'}], u'vxlan': [{u'local_ip': u'10.1.11.2', u'tenant_route_ip': u'192.168.2.2', u'dsport': 4789, u'dev': u't2s1if', u'subnet_route': u'10.1.11.0/24', u'remote_route': u'10.2.11.0/24', u'v_name': u'vxlan_t2s1', u'id': 42, u'remote_ip': u'10.2.11.2'}]}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t2ns1\" brctl show | grep -w '^t2br1'; if [ $? -ne 0 ] ; then ip netns exec \"t2ns1\" brctl addbr \"t2br1\" ; fi\nip netns exec \"t2ns1\" ip link set dev \"t2br1\" up\n", "delta": "0:00:00.102136", "end": "2019-12-05 17:15:42.894917", "item": {"bridge_name": "t2br1", "default_route_ip": "10.1.11.1", "dns": [{"brif": "t2s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.5", "dnsif": "t2s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns1", "route": [{"if": "p1", "ip": "10.1.11.1/24", "ns_if": "t2if", "ns_name": "t2"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t2ns1if", "tenant_ns_ip": "10.1.11.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s1if", "tenant_sub_ip": "10.1.11.2/24"}], "vms": [{"brif": "t2br1if1", "disk": "10G", "mem": 2, "name": "t2_VM1", "vcpu": 4, "vmif": "t2VM1if1"}, {"brif": "t2br1if2", "disk": "10G", "mem": 4, "name": "t2_VM2", "vcpu": 2, "vmif": "t2VM2if1"}], "vxlan": [{"dev": "t2s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.11.2", "remote_ip": "10.2.11.2", "remote_route": "10.2.11.0/24", "subnet_route": "10.1.11.0/24", "tenant_route_ip": "192.168.2.2", "v_name": "vxlan_t2s1"}]}, "rc": 0, "start": "2019-12-05 17:15:42.792781", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Create DNS VETH Pair] *********************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.11.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.1.11.1', u'bridge_name': u't2br1', u'ns_name': u't2ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.11.2/24', u'tenant_ns_ip': u'10.1.11.1/24', u'tenant_ns_if': u't2ns1if', u'tenant_sub_if': u't2s1if', u'tenant_ns_name': u't2'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't2_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't2br1if1', u'vmif': u't2VM1if1'}, {u'mem': 4, u'name': u't2_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't2br1if2', u'vmif': u't2VM2if1'}], u'vxlan': [{u'local_ip': u'10.1.11.2', u'dsport': 4789, u'dev': u't2s1if', u'tenant_route_ip': u'192.168.2.2', u'remote_route': u'10.2.11.0/24', u'subnet_route': u'10.1.11.0/24', u'v_name': u'vxlan_t2s1', u'id': 42, u'remote_ip': u'10.2.11.2'}]}, {u'dnsif': u't2s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't2s1_dnsbrif'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t2ns1\" ip link show \"t2s1_dnsbrif\" ; if [ $? -ne 0 ] ; then ip netns exec \"t2ns1\" ip link add \"t2s1_dnsbrif\" type veth peer name \"t2s1_dnsif\" ; fi\nip netns exec \"t2ns1\" ip link set dev \"t2s1_dnsbrif\" up\nip netns exec \"t2ns1\" ip link set dev \"t2s1_dnsif\" up\n", "delta": "0:00:00.150082", "end": "2019-12-05 17:15:43.346811", "item": [{"bridge_name": "t2br1", "default_route_ip": "10.1.11.1", "ns_name": "t2ns1", "route": [{"if": "p1", "ip": "10.1.11.1/24", "ns_if": "t2if", "ns_name": "t2"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t2ns1if", "tenant_ns_ip": "10.1.11.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s1if", "tenant_sub_ip": "10.1.11.2/24"}], "vms": [{"brif": "t2br1if1", "disk": "10G", "mem": 2, "name": "t2_VM1", "vcpu": 4, "vmif": "t2VM1if1"}, {"brif": "t2br1if2", "disk": "10G", "mem": 4, "name": "t2_VM2", "vcpu": 2, "vmif": "t2VM2if1"}], "vxlan": [{"dev": "t2s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.11.2", "remote_ip": "10.2.11.2", "remote_route": "10.2.11.0/24", "subnet_route": "10.1.11.0/24", "tenant_route_ip": "192.168.2.2", "v_name": "vxlan_t2s1"}]}, {"brif": "t2s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.5", "dnsif": "t2s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "rc": 0, "start": "2019-12-05 17:15:43.196729", "stderr": "Device \"t2s1_dnsbrif\" does not exist.", "stderr_lines": ["Device \"t2s1_dnsbrif\" does not exist."], "stdout": "", "stdout_lines": []}

TASK [Attach DNS VETH Pair] *********************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.11.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.1.11.1', u'bridge_name': u't2br1', u'ns_name': u't2ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.11.2/24', u'tenant_ns_ip': u'10.1.11.1/24', u'tenant_ns_if': u't2ns1if', u'tenant_sub_if': u't2s1if', u'tenant_ns_name': u't2'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't2_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't2br1if1', u'vmif': u't2VM1if1'}, {u'mem': 4, u'name': u't2_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't2br1if2', u'vmif': u't2VM2if1'}], u'vxlan': [{u'local_ip': u'10.1.11.2', u'dsport': 4789, u'dev': u't2s1if', u'tenant_route_ip': u'192.168.2.2', u'remote_route': u'10.2.11.0/24', u'subnet_route': u'10.1.11.0/24', u'v_name': u'vxlan_t2s1', u'id': 42, u'remote_ip': u'10.2.11.2'}]}, {u'dnsif': u't2s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't2s1_dnsbrif'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t2ns1\" brctl show \"t2br1\" | grep -w 't2s1_dnsbrif' ; if [ $? -ne 0 ] ; then ip netns exec \"t2ns1\" brctl addif \"t2br1\" \"t2s1_dnsbrif\" ; fi\n", "delta": "0:00:00.062648", "end": "2019-12-05 17:15:43.706815", "item": [{"bridge_name": "t2br1", "default_route_ip": "10.1.11.1", "ns_name": "t2ns1", "route": [{"if": "p1", "ip": "10.1.11.1/24", "ns_if": "t2if", "ns_name": "t2"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t2ns1if", "tenant_ns_ip": "10.1.11.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s1if", "tenant_sub_ip": "10.1.11.2/24"}], "vms": [{"brif": "t2br1if1", "disk": "10G", "mem": 2, "name": "t2_VM1", "vcpu": 4, "vmif": "t2VM1if1"}, {"brif": "t2br1if2", "disk": "10G", "mem": 4, "name": "t2_VM2", "vcpu": 2, "vmif": "t2VM2if1"}], "vxlan": [{"dev": "t2s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.11.2", "remote_ip": "10.2.11.2", "remote_route": "10.2.11.0/24", "subnet_route": "10.1.11.0/24", "tenant_route_ip": "192.168.2.2", "v_name": "vxlan_t2s1"}]}, {"brif": "t2s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.5", "dnsif": "t2s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "rc": 0, "start": "2019-12-05 17:15:43.644167", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Create VETH Pairs] ************************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.11.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.1.11.1', u'bridge_name': u't2br1', u'dns': [{u'dnsif': u't2s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't2s1_dnsbrif'}], u'ns_name': u't2ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.11.2/24', u'tenant_ns_ip': u'10.1.11.1/24', u'tenant_ns_if': u't2ns1if', u'tenant_sub_if': u't2s1if', u'tenant_ns_name': u't2'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.1.11.2', u'dsport': 4789, u'dev': u't2s1if', u'tenant_route_ip': u'192.168.2.2', u'remote_route': u'10.2.11.0/24', u'subnet_route': u'10.1.11.0/24', u'v_name': u'vxlan_t2s1', u'id': 42, u'remote_ip': u'10.2.11.2'}]}, {u'mem': 2, u'name': u't2_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't2br1if1', u'vmif': u't2VM1if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip link show \"t2br1if1\" ; if [ $? -ne 0 ] ; then ip link add \"t2VM1if1\" type veth peer name \"t2br1if1\" ; fi\nip link set dev \"t2br1if1\" up\nip link set dev \"t2VM1if1\" up\n", "delta": "0:00:00.019546", "end": "2019-12-05 17:15:44.014769", "item": [{"bridge_name": "t2br1", "default_route_ip": "10.1.11.1", "dns": [{"brif": "t2s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.5", "dnsif": "t2s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns1", "route": [{"if": "p1", "ip": "10.1.11.1/24", "ns_if": "t2if", "ns_name": "t2"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t2ns1if", "tenant_ns_ip": "10.1.11.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s1if", "tenant_sub_ip": "10.1.11.2/24"}], "vxlan": [{"dev": "t2s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.11.2", "remote_ip": "10.2.11.2", "remote_route": "10.2.11.0/24", "subnet_route": "10.1.11.0/24", "tenant_route_ip": "192.168.2.2", "v_name": "vxlan_t2s1"}]}, {"brif": "t2br1if1", "disk": "10G", "mem": 2, "name": "t2_VM1", "vcpu": 4, "vmif": "t2VM1if1"}], "rc": 0, "start": "2019-12-05 17:15:43.995223", "stderr": "Device \"t2br1if1\" does not exist.", "stderr_lines": ["Device \"t2br1if1\" does not exist."], "stdout": "", "stdout_lines": []}
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.11.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.1.11.1', u'bridge_name': u't2br1', u'dns': [{u'dnsif': u't2s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't2s1_dnsbrif'}], u'ns_name': u't2ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.11.2/24', u'tenant_ns_ip': u'10.1.11.1/24', u'tenant_ns_if': u't2ns1if', u'tenant_sub_if': u't2s1if', u'tenant_ns_name': u't2'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.1.11.2', u'dsport': 4789, u'dev': u't2s1if', u'tenant_route_ip': u'192.168.2.2', u'remote_route': u'10.2.11.0/24', u'subnet_route': u'10.1.11.0/24', u'v_name': u'vxlan_t2s1', u'id': 42, u'remote_ip': u'10.2.11.2'}]}, {u'mem': 4, u'name': u't2_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't2br1if2', u'vmif': u't2VM2if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip link show \"t2br1if2\" ; if [ $? -ne 0 ] ; then ip link add \"t2VM2if1\" type veth peer name \"t2br1if2\" ; fi\nip link set dev \"t2br1if2\" up\nip link set dev \"t2VM2if1\" up\n", "delta": "0:00:00.020903", "end": "2019-12-05 17:15:44.263421", "item": [{"bridge_name": "t2br1", "default_route_ip": "10.1.11.1", "dns": [{"brif": "t2s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.5", "dnsif": "t2s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns1", "route": [{"if": "p1", "ip": "10.1.11.1/24", "ns_if": "t2if", "ns_name": "t2"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t2ns1if", "tenant_ns_ip": "10.1.11.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s1if", "tenant_sub_ip": "10.1.11.2/24"}], "vxlan": [{"dev": "t2s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.11.2", "remote_ip": "10.2.11.2", "remote_route": "10.2.11.0/24", "subnet_route": "10.1.11.0/24", "tenant_route_ip": "192.168.2.2", "v_name": "vxlan_t2s1"}]}, {"brif": "t2br1if2", "disk": "10G", "mem": 4, "name": "t2_VM2", "vcpu": 2, "vmif": "t2VM2if1"}], "rc": 0, "start": "2019-12-05 17:15:44.242518", "stderr": "Device \"t2br1if2\" does not exist.", "stderr_lines": ["Device \"t2br1if2\" does not exist."], "stdout": "", "stdout_lines": []}

TASK [Attach VETH Pairs] ************************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.11.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.1.11.1', u'bridge_name': u't2br1', u'dns': [{u'dnsif': u't2s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't2s1_dnsbrif'}], u'ns_name': u't2ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.11.2/24', u'tenant_ns_ip': u'10.1.11.1/24', u'tenant_ns_if': u't2ns1if', u'tenant_sub_if': u't2s1if', u'tenant_ns_name': u't2'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.1.11.2', u'dsport': 4789, u'dev': u't2s1if', u'tenant_route_ip': u'192.168.2.2', u'remote_route': u'10.2.11.0/24', u'subnet_route': u'10.1.11.0/24', u'v_name': u'vxlan_t2s1', u'id': 42, u'remote_ip': u'10.2.11.2'}]}, {u'mem': 2, u'name': u't2_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't2br1if1', u'vmif': u't2VM1if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip link show \"t2br1if1\" ; if [ $? -eq 0 ] ; then ip link set \"t2br1if1\" netns \"t2ns1\" ; fi\nip netns exec \"t2ns1\" brctl show \"t2br1\" | grep -w 't2br1if1' ; if [ $? -ne 0 ] ; then ip netns exec \"t2ns1\" brctl addif \"t2br1\" \"t2br1if1\" ; fi\n", "delta": "0:00:00.115427", "end": "2019-12-05 17:15:44.714709", "item": [{"bridge_name": "t2br1", "default_route_ip": "10.1.11.1", "dns": [{"brif": "t2s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.5", "dnsif": "t2s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns1", "route": [{"if": "p1", "ip": "10.1.11.1/24", "ns_if": "t2if", "ns_name": "t2"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t2ns1if", "tenant_ns_ip": "10.1.11.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s1if", "tenant_sub_ip": "10.1.11.2/24"}], "vxlan": [{"dev": "t2s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.11.2", "remote_ip": "10.2.11.2", "remote_route": "10.2.11.0/24", "subnet_route": "10.1.11.0/24", "tenant_route_ip": "192.168.2.2", "v_name": "vxlan_t2s1"}]}, {"brif": "t2br1if1", "disk": "10G", "mem": 2, "name": "t2_VM1", "vcpu": 4, "vmif": "t2VM1if1"}], "rc": 0, "start": "2019-12-05 17:15:44.599282", "stderr": "", "stderr_lines": [], "stdout": "30: t2br1if1@t2VM1if1: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP mode DEFAULT group default qlen 1000\n    link/ether 4a:fe:c4:f0:f5:27 brd ff:ff:ff:ff:ff:ff", "stdout_lines": ["30: t2br1if1@t2VM1if1: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP mode DEFAULT group default qlen 1000", "    link/ether 4a:fe:c4:f0:f5:27 brd ff:ff:ff:ff:ff:ff"]}
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.11.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.1.11.1', u'bridge_name': u't2br1', u'dns': [{u'dnsif': u't2s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't2s1_dnsbrif'}], u'ns_name': u't2ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.11.2/24', u'tenant_ns_ip': u'10.1.11.1/24', u'tenant_ns_if': u't2ns1if', u'tenant_sub_if': u't2s1if', u'tenant_ns_name': u't2'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.1.11.2', u'dsport': 4789, u'dev': u't2s1if', u'tenant_route_ip': u'192.168.2.2', u'remote_route': u'10.2.11.0/24', u'subnet_route': u'10.1.11.0/24', u'v_name': u'vxlan_t2s1', u'id': 42, u'remote_ip': u'10.2.11.2'}]}, {u'mem': 4, u'name': u't2_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't2br1if2', u'vmif': u't2VM2if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip link show \"t2br1if2\" ; if [ $? -eq 0 ] ; then ip link set \"t2br1if2\" netns \"t2ns1\" ; fi\nip netns exec \"t2ns1\" brctl show \"t2br1\" | grep -w 't2br1if2' ; if [ $? -ne 0 ] ; then ip netns exec \"t2ns1\" brctl addif \"t2br1\" \"t2br1if2\" ; fi\n", "delta": "0:00:00.104674", "end": "2019-12-05 17:15:45.042751", "item": [{"bridge_name": "t2br1", "default_route_ip": "10.1.11.1", "dns": [{"brif": "t2s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.5", "dnsif": "t2s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns1", "route": [{"if": "p1", "ip": "10.1.11.1/24", "ns_if": "t2if", "ns_name": "t2"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t2ns1if", "tenant_ns_ip": "10.1.11.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s1if", "tenant_sub_ip": "10.1.11.2/24"}], "vxlan": [{"dev": "t2s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.11.2", "remote_ip": "10.2.11.2", "remote_route": "10.2.11.0/24", "subnet_route": "10.1.11.0/24", "tenant_route_ip": "192.168.2.2", "v_name": "vxlan_t2s1"}]}, {"brif": "t2br1if2", "disk": "10G", "mem": 4, "name": "t2_VM2", "vcpu": 2, "vmif": "t2VM2if1"}], "rc": 0, "start": "2019-12-05 17:15:44.938077", "stderr": "", "stderr_lines": [], "stdout": "32: t2br1if2@t2VM2if1: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP mode DEFAULT group default qlen 1000\n    link/ether 32:82:b4:a7:c2:91 brd ff:ff:ff:ff:ff:ff", "stdout_lines": ["32: t2br1if2@t2VM2if1: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP mode DEFAULT group default qlen 1000", "    link/ether 32:82:b4:a7:c2:91 brd ff:ff:ff:ff:ff:ff"]}

TASK [All interfaces and bridges UP] ************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.11.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.1.11.1', u'bridge_name': u't2br1', u'dns': [{u'dnsif': u't2s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't2s1_dnsbrif'}], u'ns_name': u't2ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.11.2/24', u'tenant_ns_ip': u'10.1.11.1/24', u'tenant_ns_if': u't2ns1if', u'tenant_sub_if': u't2s1if', u'tenant_ns_name': u't2'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.1.11.2', u'dsport': 4789, u'dev': u't2s1if', u'tenant_route_ip': u'192.168.2.2', u'remote_route': u'10.2.11.0/24', u'subnet_route': u'10.1.11.0/24', u'v_name': u'vxlan_t2s1', u'id': 42, u'remote_ip': u'10.2.11.2'}]}, {u'mem': 2, u'name': u't2_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't2br1if1', u'vmif': u't2VM1if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t2ns1\" ip link set \"t2br1if1\" up\nip netns exec \"t2ns1\" ip link set dev \"t2br1\" up\n", "delta": "0:00:00.085754", "end": "2019-12-05 17:15:45.414746", "item": [{"bridge_name": "t2br1", "default_route_ip": "10.1.11.1", "dns": [{"brif": "t2s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.5", "dnsif": "t2s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns1", "route": [{"if": "p1", "ip": "10.1.11.1/24", "ns_if": "t2if", "ns_name": "t2"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t2ns1if", "tenant_ns_ip": "10.1.11.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s1if", "tenant_sub_ip": "10.1.11.2/24"}], "vxlan": [{"dev": "t2s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.11.2", "remote_ip": "10.2.11.2", "remote_route": "10.2.11.0/24", "subnet_route": "10.1.11.0/24", "tenant_route_ip": "192.168.2.2", "v_name": "vxlan_t2s1"}]}, {"brif": "t2br1if1", "disk": "10G", "mem": 2, "name": "t2_VM1", "vcpu": 4, "vmif": "t2VM1if1"}], "rc": 0, "start": "2019-12-05 17:15:45.328992", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.11.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.1.11.1', u'bridge_name': u't2br1', u'dns': [{u'dnsif': u't2s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't2s1_dnsbrif'}], u'ns_name': u't2ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.11.2/24', u'tenant_ns_ip': u'10.1.11.1/24', u'tenant_ns_if': u't2ns1if', u'tenant_sub_if': u't2s1if', u'tenant_ns_name': u't2'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.1.11.2', u'dsport': 4789, u'dev': u't2s1if', u'tenant_route_ip': u'192.168.2.2', u'remote_route': u'10.2.11.0/24', u'subnet_route': u'10.1.11.0/24', u'v_name': u'vxlan_t2s1', u'id': 42, u'remote_ip': u'10.2.11.2'}]}, {u'mem': 4, u'name': u't2_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't2br1if2', u'vmif': u't2VM2if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t2ns1\" ip link set \"t2br1if2\" up\nip netns exec \"t2ns1\" ip link set dev \"t2br1\" up\n", "delta": "0:00:00.075299", "end": "2019-12-05 17:15:45.710994", "item": [{"bridge_name": "t2br1", "default_route_ip": "10.1.11.1", "dns": [{"brif": "t2s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.5", "dnsif": "t2s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns1", "route": [{"if": "p1", "ip": "10.1.11.1/24", "ns_if": "t2if", "ns_name": "t2"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t2ns1if", "tenant_ns_ip": "10.1.11.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s1if", "tenant_sub_ip": "10.1.11.2/24"}], "vxlan": [{"dev": "t2s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.11.2", "remote_ip": "10.2.11.2", "remote_route": "10.2.11.0/24", "subnet_route": "10.1.11.0/24", "tenant_route_ip": "192.168.2.2", "v_name": "vxlan_t2s1"}]}, {"brif": "t2br1if2", "disk": "10G", "mem": 4, "name": "t2_VM2", "vcpu": 2, "vmif": "t2VM2if1"}], "rc": 0, "start": "2019-12-05 17:15:45.635695", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Add IP to DNS Interface] ******************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.11.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.1.11.1', u'bridge_name': u't2br1', u'ns_name': u't2ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.11.2/24', u'tenant_ns_ip': u'10.1.11.1/24', u'tenant_ns_if': u't2ns1if', u'tenant_sub_if': u't2s1if', u'tenant_ns_name': u't2'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't2_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't2br1if1', u'vmif': u't2VM1if1'}, {u'mem': 4, u'name': u't2_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't2br1if2', u'vmif': u't2VM2if1'}], u'vxlan': [{u'local_ip': u'10.1.11.2', u'dsport': 4789, u'dev': u't2s1if', u'tenant_route_ip': u'192.168.2.2', u'remote_route': u'10.2.11.0/24', u'subnet_route': u'10.1.11.0/24', u'v_name': u'vxlan_t2s1', u'id': 42, u'remote_ip': u'10.2.11.2'}]}, {u'dnsif': u't2s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't2s1_dnsbrif'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t2ns1\" ip addr show \"t2s1_dnsif\" | awk 'FNR==3{ print $2 }' | grep -w '^1.1.1.1/24' ; if [ $? -ne 0 ] ; then ip netns exec \"t2ns1\" ip addr add \"1.1.1.1/24\" dev \"t2s1_dnsif\" ; fi\n", "delta": "0:00:00.089645", "end": "2019-12-05 17:15:46.099104", "item": [{"bridge_name": "t2br1", "default_route_ip": "10.1.11.1", "ns_name": "t2ns1", "route": [{"if": "p1", "ip": "10.1.11.1/24", "ns_if": "t2if", "ns_name": "t2"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t2ns1if", "tenant_ns_ip": "10.1.11.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s1if", "tenant_sub_ip": "10.1.11.2/24"}], "vms": [{"brif": "t2br1if1", "disk": "10G", "mem": 2, "name": "t2_VM1", "vcpu": 4, "vmif": "t2VM1if1"}, {"brif": "t2br1if2", "disk": "10G", "mem": 4, "name": "t2_VM2", "vcpu": 2, "vmif": "t2VM2if1"}], "vxlan": [{"dev": "t2s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.11.2", "remote_ip": "10.2.11.2", "remote_route": "10.2.11.0/24", "subnet_route": "10.1.11.0/24", "tenant_route_ip": "192.168.2.2", "v_name": "vxlan_t2s1"}]}, {"brif": "t2s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.5", "dnsif": "t2s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "rc": 0, "start": "2019-12-05 17:15:46.009459", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Install DHCP Server] **********************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.11.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.1.11.1', u'bridge_name': u't2br1', u'ns_name': u't2ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.11.2/24', u'tenant_ns_ip': u'10.1.11.1/24', u'tenant_ns_if': u't2ns1if', u'tenant_sub_if': u't2s1if', u'tenant_ns_name': u't2'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't2_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't2br1if1', u'vmif': u't2VM1if1'}, {u'mem': 4, u'name': u't2_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't2br1if2', u'vmif': u't2VM2if1'}], u'vxlan': [{u'local_ip': u'10.1.11.2', u'dsport': 4789, u'dev': u't2s1if', u'tenant_route_ip': u'192.168.2.2', u'remote_route': u'10.2.11.0/24', u'subnet_route': u'10.1.11.0/24', u'v_name': u'vxlan_t2s1', u'id': 42, u'remote_ip': u'10.2.11.2'}]}, {u'dnsif': u't2s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't2s1_dnsbrif'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t2ns1\" ps aux | grep -w '[d]nsmasq --interface t2s1_dnsif -z --dhcp-range=1.1.1.5,1.1.1.254' ; if [ $? -ne 0 ] ; then ip netns exec \"t2ns1\" dnsmasq --interface \"t2s1_dnsif\" -z --dhcp-range=1.1.1.5,'1.1.1.254' ; fi\n", "delta": "0:00:00.081337", "end": "2019-12-05 17:15:46.461336", "item": [{"bridge_name": "t2br1", "default_route_ip": "10.1.11.1", "ns_name": "t2ns1", "route": [{"if": "p1", "ip": "10.1.11.1/24", "ns_if": "t2if", "ns_name": "t2"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t2ns1if", "tenant_ns_ip": "10.1.11.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s1if", "tenant_sub_ip": "10.1.11.2/24"}], "vms": [{"brif": "t2br1if1", "disk": "10G", "mem": 2, "name": "t2_VM1", "vcpu": 4, "vmif": "t2VM1if1"}, {"brif": "t2br1if2", "disk": "10G", "mem": 4, "name": "t2_VM2", "vcpu": 2, "vmif": "t2VM2if1"}], "vxlan": [{"dev": "t2s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.11.2", "remote_ip": "10.2.11.2", "remote_route": "10.2.11.0/24", "subnet_route": "10.1.11.0/24", "tenant_route_ip": "192.168.2.2", "v_name": "vxlan_t2s1"}]}, {"brif": "t2s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.5", "dnsif": "t2s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "rc": 0, "start": "2019-12-05 17:15:46.379999", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Create VXLAN devices] *********************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.11.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.1.11.1', u'bridge_name': u't2br1', u'dns': [{u'dnsif': u't2s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't2s1_dnsbrif'}], u'ns_name': u't2ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.11.2/24', u'tenant_ns_ip': u'10.1.11.1/24', u'tenant_ns_if': u't2ns1if', u'tenant_sub_if': u't2s1if', u'tenant_ns_name': u't2'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't2_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't2br1if1', u'vmif': u't2VM1if1'}, {u'mem': 4, u'name': u't2_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't2br1if2', u'vmif': u't2VM2if1'}]}, {u'local_ip': u'10.1.11.2', u'dsport': 4789, u'dev': u't2s1if', u'tenant_route_ip': u'192.168.2.2', u'remote_route': u'10.2.11.0/24', u'subnet_route': u'10.1.11.0/24', u'v_name': u'vxlan_t2s1', u'id': 42, u'remote_ip': u'10.2.11.2'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t2ns1\" ip link show \"vxlan_t2s1\" ; if [ $? -ne 0 ] ; then ip netns exec \"t2ns1\" ip link add \"vxlan_t2s1\" type vxlan id \"42\" local \"10.1.11.2\" remote \"10.2.11.2\" dstport \"4789\" dev \"t2s1if\"; ip netns exec \"t2ns1\" ip link set dev \"vxlan_t2s1\" up ; fi\n", "delta": "0:00:00.119411", "end": "2019-12-05 17:15:46.862879", "item": [{"bridge_name": "t2br1", "default_route_ip": "10.1.11.1", "dns": [{"brif": "t2s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.5", "dnsif": "t2s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns1", "route": [{"if": "p1", "ip": "10.1.11.1/24", "ns_if": "t2if", "ns_name": "t2"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t2ns1if", "tenant_ns_ip": "10.1.11.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s1if", "tenant_sub_ip": "10.1.11.2/24"}], "vms": [{"brif": "t2br1if1", "disk": "10G", "mem": 2, "name": "t2_VM1", "vcpu": 4, "vmif": "t2VM1if1"}, {"brif": "t2br1if2", "disk": "10G", "mem": 4, "name": "t2_VM2", "vcpu": 2, "vmif": "t2VM2if1"}]}, {"dev": "t2s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.11.2", "remote_ip": "10.2.11.2", "remote_route": "10.2.11.0/24", "subnet_route": "10.1.11.0/24", "tenant_route_ip": "192.168.2.2", "v_name": "vxlan_t2s1"}], "rc": 0, "start": "2019-12-05 17:15:46.743468", "stderr": "Device \"vxlan_t2s1\" does not exist.", "stderr_lines": ["Device \"vxlan_t2s1\" does not exist."], "stdout": "", "stdout_lines": []}

TASK [Attach VXLANs to bridge] ******************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.11.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.1.11.1', u'bridge_name': u't2br1', u'dns': [{u'dnsif': u't2s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't2s1_dnsbrif'}], u'ns_name': u't2ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.11.2/24', u'tenant_ns_ip': u'10.1.11.1/24', u'tenant_ns_if': u't2ns1if', u'tenant_sub_if': u't2s1if', u'tenant_ns_name': u't2'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't2_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't2br1if1', u'vmif': u't2VM1if1'}, {u'mem': 4, u'name': u't2_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't2br1if2', u'vmif': u't2VM2if1'}]}, {u'local_ip': u'10.1.11.2', u'dsport': 4789, u'dev': u't2s1if', u'tenant_route_ip': u'192.168.2.2', u'remote_route': u'10.2.11.0/24', u'subnet_route': u'10.1.11.0/24', u'v_name': u'vxlan_t2s1', u'id': 42, u'remote_ip': u'10.2.11.2'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t2ns1\" brctl show \"t2br1\" | grep -w 'vxlan_t2s1' ; if [ $? -ne 0 ] ; then ip netns exec \"t2ns1\" brctl addif \"t2br1\" \"vxlan_t2s1\" ; fi\n", "delta": "0:00:00.066936", "end": "2019-12-05 17:15:47.222808", "item": [{"bridge_name": "t2br1", "default_route_ip": "10.1.11.1", "dns": [{"brif": "t2s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.5", "dnsif": "t2s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns1", "route": [{"if": "p1", "ip": "10.1.11.1/24", "ns_if": "t2if", "ns_name": "t2"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t2ns1if", "tenant_ns_ip": "10.1.11.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s1if", "tenant_sub_ip": "10.1.11.2/24"}], "vms": [{"brif": "t2br1if1", "disk": "10G", "mem": 2, "name": "t2_VM1", "vcpu": 4, "vmif": "t2VM1if1"}, {"brif": "t2br1if2", "disk": "10G", "mem": 4, "name": "t2_VM2", "vcpu": 2, "vmif": "t2VM2if1"}]}, {"dev": "t2s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.11.2", "remote_ip": "10.2.11.2", "remote_route": "10.2.11.0/24", "subnet_route": "10.1.11.0/24", "tenant_route_ip": "192.168.2.2", "v_name": "vxlan_t2s1"}], "rc": 0, "start": "2019-12-05 17:15:47.155872", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

PLAY RECAP **************************************************************************************************************************************************
localhost                  : ok=21   changed=21   unreachable=0    failed=0    skipped=0    rescued=0    ignored=0   

Using /etc/ansible/ansible.cfg as config file

PLAY [worker] ***********************************************************************************************************************************************

TASK [Create Tenant Namespace] ******************************************************************************************************************************
changed: [99.99.99.2] => (item={u'default_route_ip': u'192.168.130.1', u'name': u't2', u'pns_ip': u'192.168.130.1/24', u'tenant_if': u't2if', u'tenant_ip': u'192.168.130.2/24', u'pns_if': u't2pns_if'}) => {"ansible_loop_var": "item", "changed": true, "cmd": ["ip", "netns", "add", "t2"], "delta": "0:00:00.050154", "end": "2019-12-05 17:15:49.193203", "item": {"default_route_ip": "192.168.130.1", "name": "t2", "pns_if": "t2pns_if", "pns_ip": "192.168.130.1/24", "tenant_if": "t2if", "tenant_ip": "192.168.130.2/24"}, "rc": 0, "start": "2019-12-05 17:15:49.143049", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Create Subnet Namespace] ******************************************************************************************************************************
changed: [99.99.99.2] => (item={u'route': [{u'ip': u'10.2.11.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.2.11.1', u'bridge_name': u't2br1', u'dns': [{u'dnsif': u't2s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't2s1_dnsbrif'}], u'ns_name': u't2ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.11.2/24', u'tenant_ns_ip': u'10.2.11.1/24', u'tenant_ns_if': u't2ns1if', u'tenant_ns_name': u't2', u'tenant_sub_if': u't2s1if'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't2_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't2br1if1', u'vmif': u't2VM4if1'}], u'vxlan': [{u'local_ip': u'10.2.11.2', u'tenant_route_ip': u'192.168.130.2', u'dsport': 4789, u'dev': u't2s1if', u'subnet_route': u'10.2.11.0/24', u'remote_route': u'10.1.11.0/24', u'v_name': u'vxlan_t2s1', u'id': 42, u'remote_ip': u'10.1.11.2'}]}) => {"ansible_loop_var": "item", "changed": true, "cmd": ["ip", "netns", "add", "t2ns1"], "delta": "0:00:00.071059", "end": "2019-12-05 17:15:49.705887", "item": {"bridge_name": "t2br1", "default_route_ip": "10.2.11.1", "dns": [{"brif": "t2s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.5", "dnsif": "t2s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns1", "route": [{"if": "p1", "ip": "10.2.11.1/24", "ns_if": "t2if", "ns_name": "t2"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t2ns1if", "tenant_ns_ip": "10.2.11.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s1if", "tenant_sub_ip": "10.2.11.2/24"}], "vms": [{"brif": "t2br1if1", "disk": "10G", "mem": 2, "name": "t2_VM4", "vcpu": 4, "vmif": "t2VM4if1"}], "vxlan": [{"dev": "t2s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.11.2", "remote_ip": "10.1.11.2", "remote_route": "10.1.11.0/24", "subnet_route": "10.2.11.0/24", "tenant_route_ip": "192.168.130.2", "v_name": "vxlan_t2s1"}]}, "rc": 0, "start": "2019-12-05 17:15:49.634828", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}
changed: [99.99.99.2] => (item={u'route': [{u'ip': u'10.2.12.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.2.12.1', u'bridge_name': u't2br2', u'dns': [{u'dnsif': u't2s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't2s2_dnsbrif'}], u'ns_name': u't2ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.12.2/24', u'tenant_ns_ip': u'10.2.12.1/24', u'tenant_ns_if': u't2ns2if', u'tenant_ns_name': u't2', u'tenant_sub_if': u't2s2if'}], u'subnet_ip': u'2.2.2.0/24', u'vms': [{u'mem': 3, u'name': u't2_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't2br2if1', u'vmif': u't2VM3if1'}], u'vxlan': [{u'local_ip': [], u'tenant_route_ip': [], u'dsport': [], u'dev': [], u'subnet_route': [], u'remote_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}) => {"ansible_loop_var": "item", "changed": true, "cmd": ["ip", "netns", "add", "t2ns2"], "delta": "0:00:00.057296", "end": "2019-12-05 17:15:50.105873", "item": {"bridge_name": "t2br2", "default_route_ip": "10.2.12.1", "dns": [{"brif": "t2s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t2s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns2", "route": [{"if": "p1", "ip": "10.2.12.1/24", "ns_if": "t2if", "ns_name": "t2"}], "subnet_ip": "2.2.2.0/24", "tenant_ns": [{"tenant_ns_if": "t2ns2if", "tenant_ns_ip": "10.2.12.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s2if", "tenant_sub_ip": "10.2.12.2/24"}], "vms": [{"brif": "t2br2if1", "disk": "10G", "mem": 3, "name": "t2_VM3", "vcpu": 2, "vmif": "t2VM3if1"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, "rc": 0, "start": "2019-12-05 17:15:50.048577", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Create Tenant VETH pairs] *****************************************************************************************************************************
changed: [99.99.99.2] => (item={u'default_route_ip': u'192.168.130.1', u'name': u't2', u'pns_ip': u'192.168.130.1/24', u'tenant_if': u't2if', u'tenant_ip': u'192.168.130.2/24', u'pns_if': u't2pns_if'}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip link show \"t2if\" ; if [ $? -ne 0 ] ; then ip link add \"t2if\" type veth peer name \"t2pns_if\" ; fi\n", "delta": "0:00:00.017620", "end": "2019-12-05 17:15:50.537060", "item": {"default_route_ip": "192.168.130.1", "name": "t2", "pns_if": "t2pns_if", "pns_ip": "192.168.130.1/24", "tenant_if": "t2if", "tenant_ip": "192.168.130.2/24"}, "rc": 0, "start": "2019-12-05 17:15:50.519440", "stderr": "Device \"t2if\" does not exist.", "stderr_lines": ["Device \"t2if\" does not exist."], "stdout": "", "stdout_lines": []}

TASK [Attach Tenant VETH Pairs] *****************************************************************************************************************************
changed: [99.99.99.2] => (item={u'default_route_ip': u'192.168.130.1', u'name': u't2', u'pns_ip': u'192.168.130.1/24', u'tenant_if': u't2if', u'tenant_ip': u'192.168.130.2/24', u'pns_if': u't2pns_if'}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec pns ip link show \"t2pns_if\" ; if [ $? -ne 0 ] ; then ip link set \"t2pns_if\" netns pns ; fi\nip netns exec \"t2\" ip link show \"t2if\" ; if [ $? -ne 0 ] ; then ip link set \"t2if\" netns \"t2\" ; fi\nip netns exec pns ip link set dev \"t2pns_if\" up\nip netns exec \"t2\" ip link set dev \"t2if\" up\n", "delta": "0:00:00.199723", "end": "2019-12-05 17:15:51.159854", "item": {"default_route_ip": "192.168.130.1", "name": "t2", "pns_if": "t2pns_if", "pns_ip": "192.168.130.1/24", "tenant_if": "t2if", "tenant_ip": "192.168.130.2/24"}, "rc": 0, "start": "2019-12-05 17:15:50.960131", "stderr": "Device \"t2pns_if\" does not exist.\nDevice \"t2if\" does not exist.", "stderr_lines": ["Device \"t2pns_if\" does not exist.", "Device \"t2if\" does not exist."], "stdout": "", "stdout_lines": []}

TASK [Add IP addresses to Tenant VETH Pairs] ****************************************************************************************************************
changed: [99.99.99.2] => (item={u'default_route_ip': u'192.168.130.1', u'name': u't2', u'pns_ip': u'192.168.130.1/24', u'tenant_if': u't2if', u'tenant_ip': u'192.168.130.2/24', u'pns_if': u't2pns_if'}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec pns ip addr show \"t2pns_if\" | awk 'FNR==3{ print $2 }' | grep -w '^192.168.130.1/24' ; if [ $? -ne 0 ] ; then ip netns exec pns ip addr add \"192.168.130.1/24\" dev \"t2pns_if\" ; fi\nip netns exec \"t2\" ip addr show \"t2if\" | awk 'FNR==3{ print $2 }' | grep -w '^192.168.130.2/24' ; if [ $? -ne 0 ] ; then ip netns exec \"t2\" ip addr add \"192.168.130.2/24\" dev \"t2if\" ; fi\n", "delta": "0:00:00.155334", "end": "2019-12-05 17:15:51.695933", "item": {"default_route_ip": "192.168.130.1", "name": "t2", "pns_if": "t2pns_if", "pns_ip": "192.168.130.1/24", "tenant_if": "t2if", "tenant_ip": "192.168.130.2/24"}, "rc": 0, "start": "2019-12-05 17:15:51.540599", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Create Namespace VETH Pairs] **************************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.11.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.2.11.1', u'bridge_name': u't2br1', u'dns': [{u'dnsif': u't2s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't2s1_dnsbrif'}], u'ns_name': u't2ns1', u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't2_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't2br1if1', u'vmif': u't2VM4if1'}], u'vxlan': [{u'local_ip': u'10.2.11.2', u'dsport': 4789, u'dev': u't2s1if', u'tenant_route_ip': u'192.168.130.2', u'remote_route': u'10.1.11.0/24', u'subnet_route': u'10.2.11.0/24', u'v_name': u'vxlan_t2s1', u'id': 42, u'remote_ip': u'10.1.11.2'}]}, {u'tenant_sub_ip': u'10.2.11.2/24', u'tenant_ns_ip': u'10.2.11.1/24', u'tenant_ns_if': u't2ns1if', u'tenant_sub_if': u't2s1if', u'tenant_ns_name': u't2'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip link show \"t2ns1if\" ; if [ $? -ne 0 ] ; then ip link add \"t2ns1if\" type veth peer name \"t2s1if\" ; fi\n", "delta": "0:00:00.014958", "end": "2019-12-05 17:15:52.116888", "item": [{"bridge_name": "t2br1", "default_route_ip": "10.2.11.1", "dns": [{"brif": "t2s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.5", "dnsif": "t2s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns1", "route": [{"if": "p1", "ip": "10.2.11.1/24", "ns_if": "t2if", "ns_name": "t2"}], "subnet_ip": "1.1.1.0/24", "vms": [{"brif": "t2br1if1", "disk": "10G", "mem": 2, "name": "t2_VM4", "vcpu": 4, "vmif": "t2VM4if1"}], "vxlan": [{"dev": "t2s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.11.2", "remote_ip": "10.1.11.2", "remote_route": "10.1.11.0/24", "subnet_route": "10.2.11.0/24", "tenant_route_ip": "192.168.130.2", "v_name": "vxlan_t2s1"}]}, {"tenant_ns_if": "t2ns1if", "tenant_ns_ip": "10.2.11.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s1if", "tenant_sub_ip": "10.2.11.2/24"}], "rc": 0, "start": "2019-12-05 17:15:52.101930", "stderr": "Device \"t2ns1if\" does not exist.", "stderr_lines": ["Device \"t2ns1if\" does not exist."], "stdout": "", "stdout_lines": []}
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.12.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.2.12.1', u'bridge_name': u't2br2', u'dns': [{u'dnsif': u't2s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't2s2_dnsbrif'}], u'ns_name': u't2ns2', u'subnet_ip': u'2.2.2.0/24', u'vms': [{u'mem': 3, u'name': u't2_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't2br2if1', u'vmif': u't2VM3if1'}], u'vxlan': [{u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}, {u'tenant_sub_ip': u'10.2.12.2/24', u'tenant_ns_ip': u'10.2.12.1/24', u'tenant_ns_if': u't2ns2if', u'tenant_sub_if': u't2s2if', u'tenant_ns_name': u't2'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip link show \"t2ns2if\" ; if [ $? -ne 0 ] ; then ip link add \"t2ns2if\" type veth peer name \"t2s2if\" ; fi\n", "delta": "0:00:00.013302", "end": "2019-12-05 17:15:52.471128", "item": [{"bridge_name": "t2br2", "default_route_ip": "10.2.12.1", "dns": [{"brif": "t2s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t2s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns2", "route": [{"if": "p1", "ip": "10.2.12.1/24", "ns_if": "t2if", "ns_name": "t2"}], "subnet_ip": "2.2.2.0/24", "vms": [{"brif": "t2br2if1", "disk": "10G", "mem": 3, "name": "t2_VM3", "vcpu": 2, "vmif": "t2VM3if1"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, {"tenant_ns_if": "t2ns2if", "tenant_ns_ip": "10.2.12.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s2if", "tenant_sub_ip": "10.2.12.2/24"}], "rc": 0, "start": "2019-12-05 17:15:52.457826", "stderr": "Device \"t2ns2if\" does not exist.", "stderr_lines": ["Device \"t2ns2if\" does not exist."], "stdout": "", "stdout_lines": []}

TASK [Attach Namespace VETH Pairs] **************************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.11.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.2.11.1', u'bridge_name': u't2br1', u'dns': [{u'dnsif': u't2s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't2s1_dnsbrif'}], u'ns_name': u't2ns1', u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't2_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't2br1if1', u'vmif': u't2VM4if1'}], u'vxlan': [{u'local_ip': u'10.2.11.2', u'dsport': 4789, u'dev': u't2s1if', u'tenant_route_ip': u'192.168.130.2', u'remote_route': u'10.1.11.0/24', u'subnet_route': u'10.2.11.0/24', u'v_name': u'vxlan_t2s1', u'id': 42, u'remote_ip': u'10.1.11.2'}]}, {u'tenant_sub_ip': u'10.2.11.2/24', u'tenant_ns_ip': u'10.2.11.1/24', u'tenant_ns_if': u't2ns1if', u'tenant_sub_if': u't2s1if', u'tenant_ns_name': u't2'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t2\" ip link show \"t2ns1if\" ; if [ $? -ne 0 ] ; then ip link set \"t2ns1if\" netns \"t2\" ; fi\nip netns exec \"t2ns1\" ip link show \"t2s1if\" ; if [ $? -ne 0 ] ; then ip link set \"t2s1if\" netns \"t2ns1\" ; fi\n", "delta": "0:00:00.127401", "end": "2019-12-05 17:15:53.048844", "item": [{"bridge_name": "t2br1", "default_route_ip": "10.2.11.1", "dns": [{"brif": "t2s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.5", "dnsif": "t2s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns1", "route": [{"if": "p1", "ip": "10.2.11.1/24", "ns_if": "t2if", "ns_name": "t2"}], "subnet_ip": "1.1.1.0/24", "vms": [{"brif": "t2br1if1", "disk": "10G", "mem": 2, "name": "t2_VM4", "vcpu": 4, "vmif": "t2VM4if1"}], "vxlan": [{"dev": "t2s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.11.2", "remote_ip": "10.1.11.2", "remote_route": "10.1.11.0/24", "subnet_route": "10.2.11.0/24", "tenant_route_ip": "192.168.130.2", "v_name": "vxlan_t2s1"}]}, {"tenant_ns_if": "t2ns1if", "tenant_ns_ip": "10.2.11.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s1if", "tenant_sub_ip": "10.2.11.2/24"}], "rc": 0, "start": "2019-12-05 17:15:52.921443", "stderr": "Device \"t2ns1if\" does not exist.\nDevice \"t2s1if\" does not exist.", "stderr_lines": ["Device \"t2ns1if\" does not exist.", "Device \"t2s1if\" does not exist."], "stdout": "", "stdout_lines": []}
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.12.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.2.12.1', u'bridge_name': u't2br2', u'dns': [{u'dnsif': u't2s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't2s2_dnsbrif'}], u'ns_name': u't2ns2', u'subnet_ip': u'2.2.2.0/24', u'vms': [{u'mem': 3, u'name': u't2_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't2br2if1', u'vmif': u't2VM3if1'}], u'vxlan': [{u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}, {u'tenant_sub_ip': u'10.2.12.2/24', u'tenant_ns_ip': u'10.2.12.1/24', u'tenant_ns_if': u't2ns2if', u'tenant_sub_if': u't2s2if', u'tenant_ns_name': u't2'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t2\" ip link show \"t2ns2if\" ; if [ $? -ne 0 ] ; then ip link set \"t2ns2if\" netns \"t2\" ; fi\nip netns exec \"t2ns2\" ip link show \"t2s2if\" ; if [ $? -ne 0 ] ; then ip link set \"t2s2if\" netns \"t2ns2\" ; fi\n", "delta": "0:00:00.136772", "end": "2019-12-05 17:15:53.541802", "item": [{"bridge_name": "t2br2", "default_route_ip": "10.2.12.1", "dns": [{"brif": "t2s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t2s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns2", "route": [{"if": "p1", "ip": "10.2.12.1/24", "ns_if": "t2if", "ns_name": "t2"}], "subnet_ip": "2.2.2.0/24", "vms": [{"brif": "t2br2if1", "disk": "10G", "mem": 3, "name": "t2_VM3", "vcpu": 2, "vmif": "t2VM3if1"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, {"tenant_ns_if": "t2ns2if", "tenant_ns_ip": "10.2.12.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s2if", "tenant_sub_ip": "10.2.12.2/24"}], "rc": 0, "start": "2019-12-05 17:15:53.405030", "stderr": "Device \"t2ns2if\" does not exist.\nDevice \"t2s2if\" does not exist.", "stderr_lines": ["Device \"t2ns2if\" does not exist.", "Device \"t2s2if\" does not exist."], "stdout": "", "stdout_lines": []}

TASK [Set Namespace VETH Pairs UP] **************************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.11.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.2.11.1', u'bridge_name': u't2br1', u'dns': [{u'dnsif': u't2s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't2s1_dnsbrif'}], u'ns_name': u't2ns1', u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't2_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't2br1if1', u'vmif': u't2VM4if1'}], u'vxlan': [{u'local_ip': u'10.2.11.2', u'dsport': 4789, u'dev': u't2s1if', u'tenant_route_ip': u'192.168.130.2', u'remote_route': u'10.1.11.0/24', u'subnet_route': u'10.2.11.0/24', u'v_name': u'vxlan_t2s1', u'id': 42, u'remote_ip': u'10.1.11.2'}]}, {u'tenant_sub_ip': u'10.2.11.2/24', u'tenant_ns_ip': u'10.2.11.1/24', u'tenant_ns_if': u't2ns1if', u'tenant_sub_if': u't2s1if', u'tenant_ns_name': u't2'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t2\" ip link set dev \"t2ns1if\" up\nip netns exec \"t2ns1\" ip link set dev \"t2s1if\" up\n", "delta": "0:00:00.084697", "end": "2019-12-05 17:15:54.043976", "item": [{"bridge_name": "t2br1", "default_route_ip": "10.2.11.1", "dns": [{"brif": "t2s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.5", "dnsif": "t2s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns1", "route": [{"if": "p1", "ip": "10.2.11.1/24", "ns_if": "t2if", "ns_name": "t2"}], "subnet_ip": "1.1.1.0/24", "vms": [{"brif": "t2br1if1", "disk": "10G", "mem": 2, "name": "t2_VM4", "vcpu": 4, "vmif": "t2VM4if1"}], "vxlan": [{"dev": "t2s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.11.2", "remote_ip": "10.1.11.2", "remote_route": "10.1.11.0/24", "subnet_route": "10.2.11.0/24", "tenant_route_ip": "192.168.130.2", "v_name": "vxlan_t2s1"}]}, {"tenant_ns_if": "t2ns1if", "tenant_ns_ip": "10.2.11.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s1if", "tenant_sub_ip": "10.2.11.2/24"}], "rc": 0, "start": "2019-12-05 17:15:53.959279", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.12.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.2.12.1', u'bridge_name': u't2br2', u'dns': [{u'dnsif': u't2s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't2s2_dnsbrif'}], u'ns_name': u't2ns2', u'subnet_ip': u'2.2.2.0/24', u'vms': [{u'mem': 3, u'name': u't2_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't2br2if1', u'vmif': u't2VM3if1'}], u'vxlan': [{u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}, {u'tenant_sub_ip': u'10.2.12.2/24', u'tenant_ns_ip': u'10.2.12.1/24', u'tenant_ns_if': u't2ns2if', u'tenant_sub_if': u't2s2if', u'tenant_ns_name': u't2'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t2\" ip link set dev \"t2ns2if\" up\nip netns exec \"t2ns2\" ip link set dev \"t2s2if\" up\n", "delta": "0:00:00.088035", "end": "2019-12-05 17:15:54.488024", "item": [{"bridge_name": "t2br2", "default_route_ip": "10.2.12.1", "dns": [{"brif": "t2s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t2s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns2", "route": [{"if": "p1", "ip": "10.2.12.1/24", "ns_if": "t2if", "ns_name": "t2"}], "subnet_ip": "2.2.2.0/24", "vms": [{"brif": "t2br2if1", "disk": "10G", "mem": 3, "name": "t2_VM3", "vcpu": 2, "vmif": "t2VM3if1"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, {"tenant_ns_if": "t2ns2if", "tenant_ns_ip": "10.2.12.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s2if", "tenant_sub_ip": "10.2.12.2/24"}], "rc": 0, "start": "2019-12-05 17:15:54.399989", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Add IP addresses to Namespace VETH Pairs] *************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.11.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.2.11.1', u'bridge_name': u't2br1', u'dns': [{u'dnsif': u't2s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't2s1_dnsbrif'}], u'ns_name': u't2ns1', u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't2_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't2br1if1', u'vmif': u't2VM4if1'}], u'vxlan': [{u'local_ip': u'10.2.11.2', u'dsport': 4789, u'dev': u't2s1if', u'tenant_route_ip': u'192.168.130.2', u'remote_route': u'10.1.11.0/24', u'subnet_route': u'10.2.11.0/24', u'v_name': u'vxlan_t2s1', u'id': 42, u'remote_ip': u'10.1.11.2'}]}, {u'tenant_sub_ip': u'10.2.11.2/24', u'tenant_ns_ip': u'10.2.11.1/24', u'tenant_ns_if': u't2ns1if', u'tenant_sub_if': u't2s1if', u'tenant_ns_name': u't2'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t2ns1\" ip addr show \"t2s1if\" | awk 'FNR==3{ print $2 }' | grep -w '^10.2.11.2/24' ; if [ $? -ne 0 ] ; then ip netns exec \"t2ns1\" ip addr add \"10.2.11.2/24\" dev \"t2s1if\" ; fi\n\nip netns exec \"t2\" ip addr show \"t2ns1if\" | awk 'FNR==3{ print $2 }' | grep -w '^10.2.11.1/24' ; if [ $? -ne 0 ] ; then ip netns exec \"t2\" ip addr add \"10.2.11.1/24\" dev \"t2ns1if\" ; fi\n", "delta": "0:00:00.165311", "end": "2019-12-05 17:15:55.067882", "item": [{"bridge_name": "t2br1", "default_route_ip": "10.2.11.1", "dns": [{"brif": "t2s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.5", "dnsif": "t2s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns1", "route": [{"if": "p1", "ip": "10.2.11.1/24", "ns_if": "t2if", "ns_name": "t2"}], "subnet_ip": "1.1.1.0/24", "vms": [{"brif": "t2br1if1", "disk": "10G", "mem": 2, "name": "t2_VM4", "vcpu": 4, "vmif": "t2VM4if1"}], "vxlan": [{"dev": "t2s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.11.2", "remote_ip": "10.1.11.2", "remote_route": "10.1.11.0/24", "subnet_route": "10.2.11.0/24", "tenant_route_ip": "192.168.130.2", "v_name": "vxlan_t2s1"}]}, {"tenant_ns_if": "t2ns1if", "tenant_ns_ip": "10.2.11.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s1if", "tenant_sub_ip": "10.2.11.2/24"}], "rc": 0, "start": "2019-12-05 17:15:54.902571", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.12.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.2.12.1', u'bridge_name': u't2br2', u'dns': [{u'dnsif': u't2s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't2s2_dnsbrif'}], u'ns_name': u't2ns2', u'subnet_ip': u'2.2.2.0/24', u'vms': [{u'mem': 3, u'name': u't2_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't2br2if1', u'vmif': u't2VM3if1'}], u'vxlan': [{u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}, {u'tenant_sub_ip': u'10.2.12.2/24', u'tenant_ns_ip': u'10.2.12.1/24', u'tenant_ns_if': u't2ns2if', u'tenant_sub_if': u't2s2if', u'tenant_ns_name': u't2'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t2ns2\" ip addr show \"t2s2if\" | awk 'FNR==3{ print $2 }' | grep -w '^10.2.12.2/24' ; if [ $? -ne 0 ] ; then ip netns exec \"t2ns2\" ip addr add \"10.2.12.2/24\" dev \"t2s2if\" ; fi\n\nip netns exec \"t2\" ip addr show \"t2ns2if\" | awk 'FNR==3{ print $2 }' | grep -w '^10.2.12.1/24' ; if [ $? -ne 0 ] ; then ip netns exec \"t2\" ip addr add \"10.2.12.1/24\" dev \"t2ns2if\" ; fi\n", "delta": "0:00:00.154316", "end": "2019-12-05 17:15:55.571871", "item": [{"bridge_name": "t2br2", "default_route_ip": "10.2.12.1", "dns": [{"brif": "t2s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t2s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns2", "route": [{"if": "p1", "ip": "10.2.12.1/24", "ns_if": "t2if", "ns_name": "t2"}], "subnet_ip": "2.2.2.0/24", "vms": [{"brif": "t2br2if1", "disk": "10G", "mem": 3, "name": "t2_VM3", "vcpu": 2, "vmif": "t2VM3if1"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, {"tenant_ns_if": "t2ns2if", "tenant_ns_ip": "10.2.12.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s2if", "tenant_sub_ip": "10.2.12.2/24"}], "rc": 0, "start": "2019-12-05 17:15:55.417555", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Add IP Route to Tenant] *******************************************************************************************************************************
changed: [99.99.99.2] => (item={u'default_route_ip': u'192.168.130.1', u'name': u't2', u'pns_ip': u'192.168.130.1/24', u'tenant_if': u't2if', u'tenant_ip': u'192.168.130.2/24', u'pns_if': u't2pns_if'}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t2\" ip route show default | grep -w '[d]efault via 192.168.130.1' ; if [ $? -ne 0 ] ; then ip netns exec \"t2\" ip route add default via \"192.168.130.1\" ; fi\n", "delta": "0:00:00.089821", "end": "2019-12-05 17:15:56.072044", "item": {"default_route_ip": "192.168.130.1", "name": "t2", "pns_if": "t2pns_if", "pns_ip": "192.168.130.1/24", "tenant_if": "t2if", "tenant_ip": "192.168.130.2/24"}, "rc": 0, "start": "2019-12-05 17:15:55.982223", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Add IP Route to Tenant Subnet] ************************************************************************************************************************
changed: [99.99.99.2] => (item={u'route': [{u'ip': u'10.2.11.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.2.11.1', u'bridge_name': u't2br1', u'dns': [{u'dnsif': u't2s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't2s1_dnsbrif'}], u'ns_name': u't2ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.11.2/24', u'tenant_ns_ip': u'10.2.11.1/24', u'tenant_ns_if': u't2ns1if', u'tenant_ns_name': u't2', u'tenant_sub_if': u't2s1if'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't2_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't2br1if1', u'vmif': u't2VM4if1'}], u'vxlan': [{u'local_ip': u'10.2.11.2', u'tenant_route_ip': u'192.168.130.2', u'dsport': 4789, u'dev': u't2s1if', u'subnet_route': u'10.2.11.0/24', u'remote_route': u'10.1.11.0/24', u'v_name': u'vxlan_t2s1', u'id': 42, u'remote_ip': u'10.1.11.2'}]}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t2ns1\" ip route show default | grep -w '[d]efault via 10.2.11.1' ; if [ $? -ne 0 ] ; then ip netns exec \"t2ns1\" ip route add default via \"10.2.11.1\" ; fi\n", "delta": "0:00:00.069790", "end": "2019-12-05 17:15:56.567959", "item": {"bridge_name": "t2br1", "default_route_ip": "10.2.11.1", "dns": [{"brif": "t2s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.5", "dnsif": "t2s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns1", "route": [{"if": "p1", "ip": "10.2.11.1/24", "ns_if": "t2if", "ns_name": "t2"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t2ns1if", "tenant_ns_ip": "10.2.11.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s1if", "tenant_sub_ip": "10.2.11.2/24"}], "vms": [{"brif": "t2br1if1", "disk": "10G", "mem": 2, "name": "t2_VM4", "vcpu": 4, "vmif": "t2VM4if1"}], "vxlan": [{"dev": "t2s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.11.2", "remote_ip": "10.1.11.2", "remote_route": "10.1.11.0/24", "subnet_route": "10.2.11.0/24", "tenant_route_ip": "192.168.130.2", "v_name": "vxlan_t2s1"}]}, "rc": 0, "start": "2019-12-05 17:15:56.498169", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}
changed: [99.99.99.2] => (item={u'route': [{u'ip': u'10.2.12.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.2.12.1', u'bridge_name': u't2br2', u'dns': [{u'dnsif': u't2s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't2s2_dnsbrif'}], u'ns_name': u't2ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.12.2/24', u'tenant_ns_ip': u'10.2.12.1/24', u'tenant_ns_if': u't2ns2if', u'tenant_ns_name': u't2', u'tenant_sub_if': u't2s2if'}], u'subnet_ip': u'2.2.2.0/24', u'vms': [{u'mem': 3, u'name': u't2_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't2br2if1', u'vmif': u't2VM3if1'}], u'vxlan': [{u'local_ip': [], u'tenant_route_ip': [], u'dsport': [], u'dev': [], u'subnet_route': [], u'remote_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t2ns2\" ip route show default | grep -w '[d]efault via 10.2.12.1' ; if [ $? -ne 0 ] ; then ip netns exec \"t2ns2\" ip route add default via \"10.2.12.1\" ; fi\n", "delta": "0:00:00.079619", "end": "2019-12-05 17:15:56.980012", "item": {"bridge_name": "t2br2", "default_route_ip": "10.2.12.1", "dns": [{"brif": "t2s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t2s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns2", "route": [{"if": "p1", "ip": "10.2.12.1/24", "ns_if": "t2if", "ns_name": "t2"}], "subnet_ip": "2.2.2.0/24", "tenant_ns": [{"tenant_ns_if": "t2ns2if", "tenant_ns_ip": "10.2.12.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s2if", "tenant_sub_ip": "10.2.12.2/24"}], "vms": [{"brif": "t2br2if1", "disk": "10G", "mem": 3, "name": "t2_VM3", "vcpu": 2, "vmif": "t2VM3if1"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, "rc": 0, "start": "2019-12-05 17:15:56.900393", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Create bridge inside namespace] ***********************************************************************************************************************
changed: [99.99.99.2] => (item={u'route': [{u'ip': u'10.2.11.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.2.11.1', u'bridge_name': u't2br1', u'dns': [{u'dnsif': u't2s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't2s1_dnsbrif'}], u'ns_name': u't2ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.11.2/24', u'tenant_ns_ip': u'10.2.11.1/24', u'tenant_ns_if': u't2ns1if', u'tenant_ns_name': u't2', u'tenant_sub_if': u't2s1if'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't2_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't2br1if1', u'vmif': u't2VM4if1'}], u'vxlan': [{u'local_ip': u'10.2.11.2', u'tenant_route_ip': u'192.168.130.2', u'dsport': 4789, u'dev': u't2s1if', u'subnet_route': u'10.2.11.0/24', u'remote_route': u'10.1.11.0/24', u'v_name': u'vxlan_t2s1', u'id': 42, u'remote_ip': u'10.1.11.2'}]}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t2ns1\" brctl show | grep -w '^t2br1'; if [ $? -ne 0 ] ; then ip netns exec \"t2ns1\" brctl addbr \"t2br1\" ; fi\nip netns exec \"t2ns1\" ip link set dev \"t2br1\" up\n", "delta": "0:00:00.131579", "end": "2019-12-05 17:15:57.527927", "item": {"bridge_name": "t2br1", "default_route_ip": "10.2.11.1", "dns": [{"brif": "t2s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.5", "dnsif": "t2s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns1", "route": [{"if": "p1", "ip": "10.2.11.1/24", "ns_if": "t2if", "ns_name": "t2"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t2ns1if", "tenant_ns_ip": "10.2.11.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s1if", "tenant_sub_ip": "10.2.11.2/24"}], "vms": [{"brif": "t2br1if1", "disk": "10G", "mem": 2, "name": "t2_VM4", "vcpu": 4, "vmif": "t2VM4if1"}], "vxlan": [{"dev": "t2s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.11.2", "remote_ip": "10.1.11.2", "remote_route": "10.1.11.0/24", "subnet_route": "10.2.11.0/24", "tenant_route_ip": "192.168.130.2", "v_name": "vxlan_t2s1"}]}, "rc": 0, "start": "2019-12-05 17:15:57.396348", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}
changed: [99.99.99.2] => (item={u'route': [{u'ip': u'10.2.12.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.2.12.1', u'bridge_name': u't2br2', u'dns': [{u'dnsif': u't2s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't2s2_dnsbrif'}], u'ns_name': u't2ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.12.2/24', u'tenant_ns_ip': u'10.2.12.1/24', u'tenant_ns_if': u't2ns2if', u'tenant_ns_name': u't2', u'tenant_sub_if': u't2s2if'}], u'subnet_ip': u'2.2.2.0/24', u'vms': [{u'mem': 3, u'name': u't2_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't2br2if1', u'vmif': u't2VM3if1'}], u'vxlan': [{u'local_ip': [], u'tenant_route_ip': [], u'dsport': [], u'dev': [], u'subnet_route': [], u'remote_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t2ns2\" brctl show | grep -w '^t2br2'; if [ $? -ne 0 ] ; then ip netns exec \"t2ns2\" brctl addbr \"t2br2\" ; fi\nip netns exec \"t2ns2\" ip link set dev \"t2br2\" up\n", "delta": "0:00:00.123383", "end": "2019-12-05 17:15:57.968030", "item": {"bridge_name": "t2br2", "default_route_ip": "10.2.12.1", "dns": [{"brif": "t2s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t2s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns2", "route": [{"if": "p1", "ip": "10.2.12.1/24", "ns_if": "t2if", "ns_name": "t2"}], "subnet_ip": "2.2.2.0/24", "tenant_ns": [{"tenant_ns_if": "t2ns2if", "tenant_ns_ip": "10.2.12.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s2if", "tenant_sub_ip": "10.2.12.2/24"}], "vms": [{"brif": "t2br2if1", "disk": "10G", "mem": 3, "name": "t2_VM3", "vcpu": 2, "vmif": "t2VM3if1"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, "rc": 0, "start": "2019-12-05 17:15:57.844647", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Create DNS VETH Pair] *********************************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.11.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.2.11.1', u'bridge_name': u't2br1', u'ns_name': u't2ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.11.2/24', u'tenant_ns_ip': u'10.2.11.1/24', u'tenant_ns_if': u't2ns1if', u'tenant_sub_if': u't2s1if', u'tenant_ns_name': u't2'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't2_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't2br1if1', u'vmif': u't2VM4if1'}], u'vxlan': [{u'local_ip': u'10.2.11.2', u'dsport': 4789, u'dev': u't2s1if', u'tenant_route_ip': u'192.168.130.2', u'remote_route': u'10.1.11.0/24', u'subnet_route': u'10.2.11.0/24', u'v_name': u'vxlan_t2s1', u'id': 42, u'remote_ip': u'10.1.11.2'}]}, {u'dnsif': u't2s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't2s1_dnsbrif'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t2ns1\" ip link show \"t2s1_dnsbrif\" ; if [ $? -ne 0 ] ; then ip netns exec \"t2ns1\" ip link add \"t2s1_dnsbrif\" type veth peer name \"t2s1_dnsif\" ; fi\nip netns exec \"t2ns1\" ip link set dev \"t2s1_dnsbrif\" up\nip netns exec \"t2ns1\" ip link set dev \"t2s1_dnsif\" up\n", "delta": "0:00:00.174173", "end": "2019-12-05 17:15:58.584156", "item": [{"bridge_name": "t2br1", "default_route_ip": "10.2.11.1", "ns_name": "t2ns1", "route": [{"if": "p1", "ip": "10.2.11.1/24", "ns_if": "t2if", "ns_name": "t2"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t2ns1if", "tenant_ns_ip": "10.2.11.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s1if", "tenant_sub_ip": "10.2.11.2/24"}], "vms": [{"brif": "t2br1if1", "disk": "10G", "mem": 2, "name": "t2_VM4", "vcpu": 4, "vmif": "t2VM4if1"}], "vxlan": [{"dev": "t2s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.11.2", "remote_ip": "10.1.11.2", "remote_route": "10.1.11.0/24", "subnet_route": "10.2.11.0/24", "tenant_route_ip": "192.168.130.2", "v_name": "vxlan_t2s1"}]}, {"brif": "t2s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.5", "dnsif": "t2s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "rc": 0, "start": "2019-12-05 17:15:58.409983", "stderr": "Device \"t2s1_dnsbrif\" does not exist.", "stderr_lines": ["Device \"t2s1_dnsbrif\" does not exist."], "stdout": "", "stdout_lines": []}
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.12.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.2.12.1', u'bridge_name': u't2br2', u'ns_name': u't2ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.12.2/24', u'tenant_ns_ip': u'10.2.12.1/24', u'tenant_ns_if': u't2ns2if', u'tenant_sub_if': u't2s2if', u'tenant_ns_name': u't2'}], u'subnet_ip': u'2.2.2.0/24', u'vms': [{u'mem': 3, u'name': u't2_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't2br2if1', u'vmif': u't2VM3if1'}], u'vxlan': [{u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}, {u'dnsif': u't2s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't2s2_dnsbrif'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t2ns2\" ip link show \"t2s2_dnsbrif\" ; if [ $? -ne 0 ] ; then ip netns exec \"t2ns2\" ip link add \"t2s2_dnsbrif\" type veth peer name \"t2s2_dnsif\" ; fi\nip netns exec \"t2ns2\" ip link set dev \"t2s2_dnsbrif\" up\nip netns exec \"t2ns2\" ip link set dev \"t2s2_dnsif\" up\n", "delta": "0:00:00.191474", "end": "2019-12-05 17:15:59.124180", "item": [{"bridge_name": "t2br2", "default_route_ip": "10.2.12.1", "ns_name": "t2ns2", "route": [{"if": "p1", "ip": "10.2.12.1/24", "ns_if": "t2if", "ns_name": "t2"}], "subnet_ip": "2.2.2.0/24", "tenant_ns": [{"tenant_ns_if": "t2ns2if", "tenant_ns_ip": "10.2.12.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s2if", "tenant_sub_ip": "10.2.12.2/24"}], "vms": [{"brif": "t2br2if1", "disk": "10G", "mem": 3, "name": "t2_VM3", "vcpu": 2, "vmif": "t2VM3if1"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, {"brif": "t2s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t2s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "rc": 0, "start": "2019-12-05 17:15:58.932706", "stderr": "Device \"t2s2_dnsbrif\" does not exist.", "stderr_lines": ["Device \"t2s2_dnsbrif\" does not exist."], "stdout": "", "stdout_lines": []}

TASK [Attach DNS VETH Pair] *********************************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.11.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.2.11.1', u'bridge_name': u't2br1', u'ns_name': u't2ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.11.2/24', u'tenant_ns_ip': u'10.2.11.1/24', u'tenant_ns_if': u't2ns1if', u'tenant_sub_if': u't2s1if', u'tenant_ns_name': u't2'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't2_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't2br1if1', u'vmif': u't2VM4if1'}], u'vxlan': [{u'local_ip': u'10.2.11.2', u'dsport': 4789, u'dev': u't2s1if', u'tenant_route_ip': u'192.168.130.2', u'remote_route': u'10.1.11.0/24', u'subnet_route': u'10.2.11.0/24', u'v_name': u'vxlan_t2s1', u'id': 42, u'remote_ip': u'10.1.11.2'}]}, {u'dnsif': u't2s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't2s1_dnsbrif'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t2ns1\" brctl show \"t2br1\" | grep -w 't2s1_dnsbrif' ; if [ $? -ne 0 ] ; then ip netns exec \"t2ns1\" brctl addif \"t2br1\" \"t2s1_dnsbrif\" ; fi\n", "delta": "0:00:00.084382", "end": "2019-12-05 17:15:59.631885", "item": [{"bridge_name": "t2br1", "default_route_ip": "10.2.11.1", "ns_name": "t2ns1", "route": [{"if": "p1", "ip": "10.2.11.1/24", "ns_if": "t2if", "ns_name": "t2"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t2ns1if", "tenant_ns_ip": "10.2.11.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s1if", "tenant_sub_ip": "10.2.11.2/24"}], "vms": [{"brif": "t2br1if1", "disk": "10G", "mem": 2, "name": "t2_VM4", "vcpu": 4, "vmif": "t2VM4if1"}], "vxlan": [{"dev": "t2s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.11.2", "remote_ip": "10.1.11.2", "remote_route": "10.1.11.0/24", "subnet_route": "10.2.11.0/24", "tenant_route_ip": "192.168.130.2", "v_name": "vxlan_t2s1"}]}, {"brif": "t2s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.5", "dnsif": "t2s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "rc": 0, "start": "2019-12-05 17:15:59.547503", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.12.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.2.12.1', u'bridge_name': u't2br2', u'ns_name': u't2ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.12.2/24', u'tenant_ns_ip': u'10.2.12.1/24', u'tenant_ns_if': u't2ns2if', u'tenant_sub_if': u't2s2if', u'tenant_ns_name': u't2'}], u'subnet_ip': u'2.2.2.0/24', u'vms': [{u'mem': 3, u'name': u't2_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't2br2if1', u'vmif': u't2VM3if1'}], u'vxlan': [{u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}, {u'dnsif': u't2s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't2s2_dnsbrif'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t2ns2\" brctl show \"t2br2\" | grep -w 't2s2_dnsbrif' ; if [ $? -ne 0 ] ; then ip netns exec \"t2ns2\" brctl addif \"t2br2\" \"t2s2_dnsbrif\" ; fi\n", "delta": "0:00:00.069796", "end": "2019-12-05 17:16:00.039853", "item": [{"bridge_name": "t2br2", "default_route_ip": "10.2.12.1", "ns_name": "t2ns2", "route": [{"if": "p1", "ip": "10.2.12.1/24", "ns_if": "t2if", "ns_name": "t2"}], "subnet_ip": "2.2.2.0/24", "tenant_ns": [{"tenant_ns_if": "t2ns2if", "tenant_ns_ip": "10.2.12.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s2if", "tenant_sub_ip": "10.2.12.2/24"}], "vms": [{"brif": "t2br2if1", "disk": "10G", "mem": 3, "name": "t2_VM3", "vcpu": 2, "vmif": "t2VM3if1"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, {"brif": "t2s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t2s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "rc": 0, "start": "2019-12-05 17:15:59.970057", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Create VETH Pairs] ************************************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.11.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.2.11.1', u'bridge_name': u't2br1', u'dns': [{u'dnsif': u't2s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't2s1_dnsbrif'}], u'ns_name': u't2ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.11.2/24', u'tenant_ns_ip': u'10.2.11.1/24', u'tenant_ns_if': u't2ns1if', u'tenant_sub_if': u't2s1if', u'tenant_ns_name': u't2'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.2.11.2', u'dsport': 4789, u'dev': u't2s1if', u'tenant_route_ip': u'192.168.130.2', u'remote_route': u'10.1.11.0/24', u'subnet_route': u'10.2.11.0/24', u'v_name': u'vxlan_t2s1', u'id': 42, u'remote_ip': u'10.1.11.2'}]}, {u'mem': 2, u'name': u't2_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't2br1if1', u'vmif': u't2VM4if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip link show \"t2br1if1\" ; if [ $? -ne 0 ] ; then ip link add \"t2VM4if1\" type veth peer name \"t2br1if1\" ; fi\nip link set dev \"t2br1if1\" up\nip link set dev \"t2VM4if1\" up\n", "delta": "0:00:00.017644", "end": "2019-12-05 17:16:00.469681", "item": [{"bridge_name": "t2br1", "default_route_ip": "10.2.11.1", "dns": [{"brif": "t2s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.5", "dnsif": "t2s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns1", "route": [{"if": "p1", "ip": "10.2.11.1/24", "ns_if": "t2if", "ns_name": "t2"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t2ns1if", "tenant_ns_ip": "10.2.11.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s1if", "tenant_sub_ip": "10.2.11.2/24"}], "vxlan": [{"dev": "t2s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.11.2", "remote_ip": "10.1.11.2", "remote_route": "10.1.11.0/24", "subnet_route": "10.2.11.0/24", "tenant_route_ip": "192.168.130.2", "v_name": "vxlan_t2s1"}]}, {"brif": "t2br1if1", "disk": "10G", "mem": 2, "name": "t2_VM4", "vcpu": 4, "vmif": "t2VM4if1"}], "rc": 0, "start": "2019-12-05 17:16:00.452037", "stderr": "Device \"t2br1if1\" does not exist.", "stderr_lines": ["Device \"t2br1if1\" does not exist."], "stdout": "", "stdout_lines": []}
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.12.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.2.12.1', u'bridge_name': u't2br2', u'dns': [{u'dnsif': u't2s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't2s2_dnsbrif'}], u'ns_name': u't2ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.12.2/24', u'tenant_ns_ip': u'10.2.12.1/24', u'tenant_ns_if': u't2ns2if', u'tenant_sub_if': u't2s2if', u'tenant_ns_name': u't2'}], u'subnet_ip': u'2.2.2.0/24', u'vxlan': [{u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}, {u'mem': 3, u'name': u't2_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't2br2if1', u'vmif': u't2VM3if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip link show \"t2br2if1\" ; if [ $? -ne 0 ] ; then ip link add \"t2VM3if1\" type veth peer name \"t2br2if1\" ; fi\nip link set dev \"t2br2if1\" up\nip link set dev \"t2VM3if1\" up\n", "delta": "0:00:00.019640", "end": "2019-12-05 17:16:00.854567", "item": [{"bridge_name": "t2br2", "default_route_ip": "10.2.12.1", "dns": [{"brif": "t2s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t2s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns2", "route": [{"if": "p1", "ip": "10.2.12.1/24", "ns_if": "t2if", "ns_name": "t2"}], "subnet_ip": "2.2.2.0/24", "tenant_ns": [{"tenant_ns_if": "t2ns2if", "tenant_ns_ip": "10.2.12.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s2if", "tenant_sub_ip": "10.2.12.2/24"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, {"brif": "t2br2if1", "disk": "10G", "mem": 3, "name": "t2_VM3", "vcpu": 2, "vmif": "t2VM3if1"}], "rc": 0, "start": "2019-12-05 17:16:00.834927", "stderr": "Device \"t2br2if1\" does not exist.", "stderr_lines": ["Device \"t2br2if1\" does not exist."], "stdout": "", "stdout_lines": []}

TASK [Attach VETH Pairs] ************************************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.11.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.2.11.1', u'bridge_name': u't2br1', u'dns': [{u'dnsif': u't2s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't2s1_dnsbrif'}], u'ns_name': u't2ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.11.2/24', u'tenant_ns_ip': u'10.2.11.1/24', u'tenant_ns_if': u't2ns1if', u'tenant_sub_if': u't2s1if', u'tenant_ns_name': u't2'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.2.11.2', u'dsport': 4789, u'dev': u't2s1if', u'tenant_route_ip': u'192.168.130.2', u'remote_route': u'10.1.11.0/24', u'subnet_route': u'10.2.11.0/24', u'v_name': u'vxlan_t2s1', u'id': 42, u'remote_ip': u'10.1.11.2'}]}, {u'mem': 2, u'name': u't2_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't2br1if1', u'vmif': u't2VM4if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip link show \"t2br1if1\" ; if [ $? -eq 0 ] ; then ip link set \"t2br1if1\" netns \"t2ns1\" ; fi\nip netns exec \"t2ns1\" brctl show \"t2br1\" | grep -w 't2br1if1' ; if [ $? -ne 0 ] ; then ip netns exec \"t2ns1\" brctl addif \"t2br1\" \"t2br1if1\" ; fi\n", "delta": "0:00:00.116741", "end": "2019-12-05 17:16:01.415972", "item": [{"bridge_name": "t2br1", "default_route_ip": "10.2.11.1", "dns": [{"brif": "t2s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.5", "dnsif": "t2s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns1", "route": [{"if": "p1", "ip": "10.2.11.1/24", "ns_if": "t2if", "ns_name": "t2"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t2ns1if", "tenant_ns_ip": "10.2.11.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s1if", "tenant_sub_ip": "10.2.11.2/24"}], "vxlan": [{"dev": "t2s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.11.2", "remote_ip": "10.1.11.2", "remote_route": "10.1.11.0/24", "subnet_route": "10.2.11.0/24", "tenant_route_ip": "192.168.130.2", "v_name": "vxlan_t2s1"}]}, {"brif": "t2br1if1", "disk": "10G", "mem": 2, "name": "t2_VM4", "vcpu": 4, "vmif": "t2VM4if1"}], "rc": 0, "start": "2019-12-05 17:16:01.299231", "stderr": "", "stderr_lines": [], "stdout": "33: t2br1if1@t2VM4if1: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP mode DEFAULT group default qlen 1000\n    link/ether 42:61:0b:cb:76:f7 brd ff:ff:ff:ff:ff:ff", "stdout_lines": ["33: t2br1if1@t2VM4if1: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP mode DEFAULT group default qlen 1000", "    link/ether 42:61:0b:cb:76:f7 brd ff:ff:ff:ff:ff:ff"]}
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.12.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.2.12.1', u'bridge_name': u't2br2', u'dns': [{u'dnsif': u't2s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't2s2_dnsbrif'}], u'ns_name': u't2ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.12.2/24', u'tenant_ns_ip': u'10.2.12.1/24', u'tenant_ns_if': u't2ns2if', u'tenant_sub_if': u't2s2if', u'tenant_ns_name': u't2'}], u'subnet_ip': u'2.2.2.0/24', u'vxlan': [{u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}, {u'mem': 3, u'name': u't2_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't2br2if1', u'vmif': u't2VM3if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip link show \"t2br2if1\" ; if [ $? -eq 0 ] ; then ip link set \"t2br2if1\" netns \"t2ns2\" ; fi\nip netns exec \"t2ns2\" brctl show \"t2br2\" | grep -w 't2br2if1' ; if [ $? -ne 0 ] ; then ip netns exec \"t2ns2\" brctl addif \"t2br2\" \"t2br2if1\" ; fi\n", "delta": "0:00:00.114667", "end": "2019-12-05 17:16:01.911929", "item": [{"bridge_name": "t2br2", "default_route_ip": "10.2.12.1", "dns": [{"brif": "t2s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t2s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns2", "route": [{"if": "p1", "ip": "10.2.12.1/24", "ns_if": "t2if", "ns_name": "t2"}], "subnet_ip": "2.2.2.0/24", "tenant_ns": [{"tenant_ns_if": "t2ns2if", "tenant_ns_ip": "10.2.12.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s2if", "tenant_sub_ip": "10.2.12.2/24"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, {"brif": "t2br2if1", "disk": "10G", "mem": 3, "name": "t2_VM3", "vcpu": 2, "vmif": "t2VM3if1"}], "rc": 0, "start": "2019-12-05 17:16:01.797262", "stderr": "", "stderr_lines": [], "stdout": "35: t2br2if1@t2VM3if1: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP mode DEFAULT group default qlen 1000\n    link/ether e6:d4:83:fd:6a:25 brd ff:ff:ff:ff:ff:ff", "stdout_lines": ["35: t2br2if1@t2VM3if1: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP mode DEFAULT group default qlen 1000", "    link/ether e6:d4:83:fd:6a:25 brd ff:ff:ff:ff:ff:ff"]}

TASK [All interfaces and bridges UP] ************************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.11.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.2.11.1', u'bridge_name': u't2br1', u'dns': [{u'dnsif': u't2s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't2s1_dnsbrif'}], u'ns_name': u't2ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.11.2/24', u'tenant_ns_ip': u'10.2.11.1/24', u'tenant_ns_if': u't2ns1if', u'tenant_sub_if': u't2s1if', u'tenant_ns_name': u't2'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.2.11.2', u'dsport': 4789, u'dev': u't2s1if', u'tenant_route_ip': u'192.168.130.2', u'remote_route': u'10.1.11.0/24', u'subnet_route': u'10.2.11.0/24', u'v_name': u'vxlan_t2s1', u'id': 42, u'remote_ip': u'10.1.11.2'}]}, {u'mem': 2, u'name': u't2_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't2br1if1', u'vmif': u't2VM4if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t2ns1\" ip link set \"t2br1if1\" up\nip netns exec \"t2ns1\" ip link set dev \"t2br1\" up\n", "delta": "0:00:00.064326", "end": "2019-12-05 17:16:02.403901", "item": [{"bridge_name": "t2br1", "default_route_ip": "10.2.11.1", "dns": [{"brif": "t2s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.5", "dnsif": "t2s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns1", "route": [{"if": "p1", "ip": "10.2.11.1/24", "ns_if": "t2if", "ns_name": "t2"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t2ns1if", "tenant_ns_ip": "10.2.11.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s1if", "tenant_sub_ip": "10.2.11.2/24"}], "vxlan": [{"dev": "t2s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.11.2", "remote_ip": "10.1.11.2", "remote_route": "10.1.11.0/24", "subnet_route": "10.2.11.0/24", "tenant_route_ip": "192.168.130.2", "v_name": "vxlan_t2s1"}]}, {"brif": "t2br1if1", "disk": "10G", "mem": 2, "name": "t2_VM4", "vcpu": 4, "vmif": "t2VM4if1"}], "rc": 0, "start": "2019-12-05 17:16:02.339575", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.12.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.2.12.1', u'bridge_name': u't2br2', u'dns': [{u'dnsif': u't2s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't2s2_dnsbrif'}], u'ns_name': u't2ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.12.2/24', u'tenant_ns_ip': u'10.2.12.1/24', u'tenant_ns_if': u't2ns2if', u'tenant_sub_if': u't2s2if', u'tenant_ns_name': u't2'}], u'subnet_ip': u'2.2.2.0/24', u'vxlan': [{u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}, {u'mem': 3, u'name': u't2_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't2br2if1', u'vmif': u't2VM3if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t2ns2\" ip link set \"t2br2if1\" up\nip netns exec \"t2ns2\" ip link set dev \"t2br2\" up\n", "delta": "0:00:00.077662", "end": "2019-12-05 17:16:02.848136", "item": [{"bridge_name": "t2br2", "default_route_ip": "10.2.12.1", "dns": [{"brif": "t2s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t2s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns2", "route": [{"if": "p1", "ip": "10.2.12.1/24", "ns_if": "t2if", "ns_name": "t2"}], "subnet_ip": "2.2.2.0/24", "tenant_ns": [{"tenant_ns_if": "t2ns2if", "tenant_ns_ip": "10.2.12.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s2if", "tenant_sub_ip": "10.2.12.2/24"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, {"brif": "t2br2if1", "disk": "10G", "mem": 3, "name": "t2_VM3", "vcpu": 2, "vmif": "t2VM3if1"}], "rc": 0, "start": "2019-12-05 17:16:02.770474", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Add IP to DNS Interface] ******************************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.11.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.2.11.1', u'bridge_name': u't2br1', u'ns_name': u't2ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.11.2/24', u'tenant_ns_ip': u'10.2.11.1/24', u'tenant_ns_if': u't2ns1if', u'tenant_sub_if': u't2s1if', u'tenant_ns_name': u't2'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't2_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't2br1if1', u'vmif': u't2VM4if1'}], u'vxlan': [{u'local_ip': u'10.2.11.2', u'dsport': 4789, u'dev': u't2s1if', u'tenant_route_ip': u'192.168.130.2', u'remote_route': u'10.1.11.0/24', u'subnet_route': u'10.2.11.0/24', u'v_name': u'vxlan_t2s1', u'id': 42, u'remote_ip': u'10.1.11.2'}]}, {u'dnsif': u't2s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't2s1_dnsbrif'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t2ns1\" ip addr show \"t2s1_dnsif\" | awk 'FNR==3{ print $2}'| grep -w '^1.1.1.1/24' ; if [ $? -ne 0 ] ; then ip netns exec \"t2ns1\" ip addr add \"1.1.1.1/24\" dev \"t2s1_dnsif\" ; fi\n", "delta": "0:00:00.095424", "end": "2019-12-05 17:16:03.359987", "item": [{"bridge_name": "t2br1", "default_route_ip": "10.2.11.1", "ns_name": "t2ns1", "route": [{"if": "p1", "ip": "10.2.11.1/24", "ns_if": "t2if", "ns_name": "t2"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t2ns1if", "tenant_ns_ip": "10.2.11.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s1if", "tenant_sub_ip": "10.2.11.2/24"}], "vms": [{"brif": "t2br1if1", "disk": "10G", "mem": 2, "name": "t2_VM4", "vcpu": 4, "vmif": "t2VM4if1"}], "vxlan": [{"dev": "t2s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.11.2", "remote_ip": "10.1.11.2", "remote_route": "10.1.11.0/24", "subnet_route": "10.2.11.0/24", "tenant_route_ip": "192.168.130.2", "v_name": "vxlan_t2s1"}]}, {"brif": "t2s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.5", "dnsif": "t2s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "rc": 0, "start": "2019-12-05 17:16:03.264563", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.12.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.2.12.1', u'bridge_name': u't2br2', u'ns_name': u't2ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.12.2/24', u'tenant_ns_ip': u'10.2.12.1/24', u'tenant_ns_if': u't2ns2if', u'tenant_sub_if': u't2s2if', u'tenant_ns_name': u't2'}], u'subnet_ip': u'2.2.2.0/24', u'vms': [{u'mem': 3, u'name': u't2_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't2br2if1', u'vmif': u't2VM3if1'}], u'vxlan': [{u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}, {u'dnsif': u't2s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't2s2_dnsbrif'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t2ns2\" ip addr show \"t2s2_dnsif\" | awk 'FNR==3{ print $2}'| grep -w '^2.2.2.1/24' ; if [ $? -ne 0 ] ; then ip netns exec \"t2ns2\" ip addr add \"2.2.2.1/24\" dev \"t2s2_dnsif\" ; fi\n", "delta": "0:00:00.077233", "end": "2019-12-05 17:16:03.763977", "item": [{"bridge_name": "t2br2", "default_route_ip": "10.2.12.1", "ns_name": "t2ns2", "route": [{"if": "p1", "ip": "10.2.12.1/24", "ns_if": "t2if", "ns_name": "t2"}], "subnet_ip": "2.2.2.0/24", "tenant_ns": [{"tenant_ns_if": "t2ns2if", "tenant_ns_ip": "10.2.12.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s2if", "tenant_sub_ip": "10.2.12.2/24"}], "vms": [{"brif": "t2br2if1", "disk": "10G", "mem": 3, "name": "t2_VM3", "vcpu": 2, "vmif": "t2VM3if1"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, {"brif": "t2s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t2s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "rc": 0, "start": "2019-12-05 17:16:03.686744", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Install DHCP Server] **********************************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.11.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.2.11.1', u'bridge_name': u't2br1', u'ns_name': u't2ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.11.2/24', u'tenant_ns_ip': u'10.2.11.1/24', u'tenant_ns_if': u't2ns1if', u'tenant_sub_if': u't2s1if', u'tenant_ns_name': u't2'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't2_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't2br1if1', u'vmif': u't2VM4if1'}], u'vxlan': [{u'local_ip': u'10.2.11.2', u'dsport': 4789, u'dev': u't2s1if', u'tenant_route_ip': u'192.168.130.2', u'remote_route': u'10.1.11.0/24', u'subnet_route': u'10.2.11.0/24', u'v_name': u'vxlan_t2s1', u'id': 42, u'remote_ip': u'10.1.11.2'}]}, {u'dnsif': u't2s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't2s1_dnsbrif'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t2ns1\" ps aux | grep -w '[d]nsmasq --interface t2s1_dnsif -z --dhcp-range=1.1.1.5,1.1.1.254' ; if [ $? -ne 0 ] ; then ip netns exec \"t2ns1\" dnsmasq --interface \"t2s1_dnsif\" -z --dhcp-range=1.1.1.5,'1.1.1.254' ; fi\n", "delta": "0:00:00.092508", "end": "2019-12-05 17:16:04.273485", "item": [{"bridge_name": "t2br1", "default_route_ip": "10.2.11.1", "ns_name": "t2ns1", "route": [{"if": "p1", "ip": "10.2.11.1/24", "ns_if": "t2if", "ns_name": "t2"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t2ns1if", "tenant_ns_ip": "10.2.11.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s1if", "tenant_sub_ip": "10.2.11.2/24"}], "vms": [{"brif": "t2br1if1", "disk": "10G", "mem": 2, "name": "t2_VM4", "vcpu": 4, "vmif": "t2VM4if1"}], "vxlan": [{"dev": "t2s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.11.2", "remote_ip": "10.1.11.2", "remote_route": "10.1.11.0/24", "subnet_route": "10.2.11.0/24", "tenant_route_ip": "192.168.130.2", "v_name": "vxlan_t2s1"}]}, {"brif": "t2s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.5", "dnsif": "t2s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "rc": 0, "start": "2019-12-05 17:16:04.180977", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.12.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.2.12.1', u'bridge_name': u't2br2', u'ns_name': u't2ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.12.2/24', u'tenant_ns_ip': u'10.2.12.1/24', u'tenant_ns_if': u't2ns2if', u'tenant_sub_if': u't2s2if', u'tenant_ns_name': u't2'}], u'subnet_ip': u'2.2.2.0/24', u'vms': [{u'mem': 3, u'name': u't2_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't2br2if1', u'vmif': u't2VM3if1'}], u'vxlan': [{u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}, {u'dnsif': u't2s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't2s2_dnsbrif'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t2ns2\" ps aux | grep -w '[d]nsmasq --interface t2s2_dnsif -z --dhcp-range=2.2.2.5,2.2.2.254' ; if [ $? -ne 0 ] ; then ip netns exec \"t2ns2\" dnsmasq --interface \"t2s2_dnsif\" -z --dhcp-range=2.2.2.5,'2.2.2.254' ; fi\n", "delta": "0:00:00.085682", "end": "2019-12-05 17:16:04.708679", "item": [{"bridge_name": "t2br2", "default_route_ip": "10.2.12.1", "ns_name": "t2ns2", "route": [{"if": "p1", "ip": "10.2.12.1/24", "ns_if": "t2if", "ns_name": "t2"}], "subnet_ip": "2.2.2.0/24", "tenant_ns": [{"tenant_ns_if": "t2ns2if", "tenant_ns_ip": "10.2.12.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s2if", "tenant_sub_ip": "10.2.12.2/24"}], "vms": [{"brif": "t2br2if1", "disk": "10G", "mem": 3, "name": "t2_VM3", "vcpu": 2, "vmif": "t2VM3if1"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, {"brif": "t2s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t2s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "rc": 0, "start": "2019-12-05 17:16:04.622997", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Create VXLAN devices] *********************************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.11.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.2.11.1', u'bridge_name': u't2br1', u'dns': [{u'dnsif': u't2s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't2s1_dnsbrif'}], u'ns_name': u't2ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.11.2/24', u'tenant_ns_ip': u'10.2.11.1/24', u'tenant_ns_if': u't2ns1if', u'tenant_sub_if': u't2s1if', u'tenant_ns_name': u't2'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't2_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't2br1if1', u'vmif': u't2VM4if1'}]}, {u'local_ip': u'10.2.11.2', u'dsport': 4789, u'dev': u't2s1if', u'tenant_route_ip': u'192.168.130.2', u'remote_route': u'10.1.11.0/24', u'subnet_route': u'10.2.11.0/24', u'v_name': u'vxlan_t2s1', u'id': 42, u'remote_ip': u'10.1.11.2'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t2ns1\" ip link show \"vxlan_t2s1\" ; if [ $? -ne 0 ] ; then ip netns exec \"t2ns1\" ip link add \"vxlan_t2s1\" type vxlan id \"42\" local \"10.2.11.2\" remote \"10.1.11.2\" dstport \"4789\" dev \"t2s1if\" ; ip netns exec \"t2ns1\" ip link set dev \"vxlan_t2s1\" up ; fi\n", "delta": "0:00:00.163672", "end": "2019-12-05 17:16:05.276074", "item": [{"bridge_name": "t2br1", "default_route_ip": "10.2.11.1", "dns": [{"brif": "t2s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.5", "dnsif": "t2s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns1", "route": [{"if": "p1", "ip": "10.2.11.1/24", "ns_if": "t2if", "ns_name": "t2"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t2ns1if", "tenant_ns_ip": "10.2.11.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s1if", "tenant_sub_ip": "10.2.11.2/24"}], "vms": [{"brif": "t2br1if1", "disk": "10G", "mem": 2, "name": "t2_VM4", "vcpu": 4, "vmif": "t2VM4if1"}]}, {"dev": "t2s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.11.2", "remote_ip": "10.1.11.2", "remote_route": "10.1.11.0/24", "subnet_route": "10.2.11.0/24", "tenant_route_ip": "192.168.130.2", "v_name": "vxlan_t2s1"}], "rc": 0, "start": "2019-12-05 17:16:05.112402", "stderr": "Device \"vxlan_t2s1\" does not exist.", "stderr_lines": ["Device \"vxlan_t2s1\" does not exist."], "stdout": "", "stdout_lines": []}
skipping: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.12.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.2.12.1', u'bridge_name': u't2br2', u'dns': [{u'dnsif': u't2s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't2s2_dnsbrif'}], u'ns_name': u't2ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.12.2/24', u'tenant_ns_ip': u'10.2.12.1/24', u'tenant_ns_if': u't2ns2if', u'tenant_sub_if': u't2s2if', u'tenant_ns_name': u't2'}], u'subnet_ip': u'2.2.2.0/24', u'vms': [{u'mem': 3, u'name': u't2_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't2br2if1', u'vmif': u't2VM3if1'}]}, {u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}])  => {"ansible_loop_var": "item", "changed": false, "item": [{"bridge_name": "t2br2", "default_route_ip": "10.2.12.1", "dns": [{"brif": "t2s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t2s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns2", "route": [{"if": "p1", "ip": "10.2.12.1/24", "ns_if": "t2if", "ns_name": "t2"}], "subnet_ip": "2.2.2.0/24", "tenant_ns": [{"tenant_ns_if": "t2ns2if", "tenant_ns_ip": "10.2.12.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s2if", "tenant_sub_ip": "10.2.12.2/24"}], "vms": [{"brif": "t2br2if1", "disk": "10G", "mem": 3, "name": "t2_VM3", "vcpu": 2, "vmif": "t2VM3if1"}]}, {"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}], "skip_reason": "Conditional result was False"}

TASK [Attach VXLANs to bridge] ******************************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.11.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.2.11.1', u'bridge_name': u't2br1', u'dns': [{u'dnsif': u't2s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't2s1_dnsbrif'}], u'ns_name': u't2ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.11.2/24', u'tenant_ns_ip': u'10.2.11.1/24', u'tenant_ns_if': u't2ns1if', u'tenant_sub_if': u't2s1if', u'tenant_ns_name': u't2'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't2_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't2br1if1', u'vmif': u't2VM4if1'}]}, {u'local_ip': u'10.2.11.2', u'dsport': 4789, u'dev': u't2s1if', u'tenant_route_ip': u'192.168.130.2', u'remote_route': u'10.1.11.0/24', u'subnet_route': u'10.2.11.0/24', u'v_name': u'vxlan_t2s1', u'id': 42, u'remote_ip': u'10.1.11.2'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t2ns1\" brctl show \"t2br1\" | grep -w 'vxlan_t2s1' ; if [ $? -ne 0 ] ; then ip netns exec \"t2ns1\" brctl addif \"t2br1\" \"vxlan_t2s1\" ; fi\n", "delta": "0:00:00.070858", "end": "2019-12-05 17:16:05.779892", "item": [{"bridge_name": "t2br1", "default_route_ip": "10.2.11.1", "dns": [{"brif": "t2s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.5", "dnsif": "t2s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns1", "route": [{"if": "p1", "ip": "10.2.11.1/24", "ns_if": "t2if", "ns_name": "t2"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t2ns1if", "tenant_ns_ip": "10.2.11.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s1if", "tenant_sub_ip": "10.2.11.2/24"}], "vms": [{"brif": "t2br1if1", "disk": "10G", "mem": 2, "name": "t2_VM4", "vcpu": 4, "vmif": "t2VM4if1"}]}, {"dev": "t2s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.11.2", "remote_ip": "10.1.11.2", "remote_route": "10.1.11.0/24", "subnet_route": "10.2.11.0/24", "tenant_route_ip": "192.168.130.2", "v_name": "vxlan_t2s1"}], "rc": 0, "start": "2019-12-05 17:16:05.709034", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}
skipping: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.12.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.2.12.1', u'bridge_name': u't2br2', u'dns': [{u'dnsif': u't2s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't2s2_dnsbrif'}], u'ns_name': u't2ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.12.2/24', u'tenant_ns_ip': u'10.2.12.1/24', u'tenant_ns_if': u't2ns2if', u'tenant_sub_if': u't2s2if', u'tenant_ns_name': u't2'}], u'subnet_ip': u'2.2.2.0/24', u'vms': [{u'mem': 3, u'name': u't2_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't2br2if1', u'vmif': u't2VM3if1'}]}, {u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}])  => {"ansible_loop_var": "item", "changed": false, "item": [{"bridge_name": "t2br2", "default_route_ip": "10.2.12.1", "dns": [{"brif": "t2s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t2s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns2", "route": [{"if": "p1", "ip": "10.2.12.1/24", "ns_if": "t2if", "ns_name": "t2"}], "subnet_ip": "2.2.2.0/24", "tenant_ns": [{"tenant_ns_if": "t2ns2if", "tenant_ns_ip": "10.2.12.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s2if", "tenant_sub_ip": "10.2.12.2/24"}], "vms": [{"brif": "t2br2if1", "disk": "10G", "mem": 3, "name": "t2_VM3", "vcpu": 2, "vmif": "t2VM3if1"}]}, {"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}], "skip_reason": "Conditional result was False"}

PLAY RECAP **************************************************************************************************************************************************
99.99.99.2                 : ok=21   changed=21   unreachable=0    failed=0    skipped=0    rescued=0    ignored=0   

Using /etc/ansible/ansible.cfg as config file

PLAY [main] *************************************************************************************************************************************************

TASK [Add VXLAN routes in PNS] ******************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.11.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.1.11.1', u'bridge_name': u't2br1', u'dns': [{u'dnsif': u't2s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't2s1_dnsbrif'}], u'ns_name': u't2ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.11.2/24', u'tenant_ns_ip': u'10.1.11.1/24', u'tenant_ns_if': u't2ns1if', u'tenant_sub_if': u't2s1if', u'tenant_ns_name': u't2'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't2_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't2br1if1', u'vmif': u't2VM1if1'}, {u'mem': 4, u'name': u't2_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't2br1if2', u'vmif': u't2VM2if1'}]}, {u'local_ip': u'10.1.11.2', u'dsport': 4789, u'dev': u't2s1if', u'tenant_route_ip': u'192.168.2.2', u'remote_route': u'10.2.11.0/24', u'subnet_route': u'10.1.11.0/24', u'v_name': u'vxlan_t2s1', u'id': 42, u'remote_ip': u'10.2.11.2'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec pns ip route show \"10.1.11.0/24\" via \"192.168.2.2\" | grep -w '^10.1.11.0/24' ; if [ $? -ne 0 ] ; then ip netns exec pns ip route add \"10.1.11.0/24\" via \"192.168.2.2\" ; fi\n", "delta": "0:00:00.070466", "end": "2019-12-05 17:16:06.926888", "item": [{"bridge_name": "t2br1", "default_route_ip": "10.1.11.1", "dns": [{"brif": "t2s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.5", "dnsif": "t2s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns1", "route": [{"if": "p1", "ip": "10.1.11.1/24", "ns_if": "t2if", "ns_name": "t2"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t2ns1if", "tenant_ns_ip": "10.1.11.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s1if", "tenant_sub_ip": "10.1.11.2/24"}], "vms": [{"brif": "t2br1if1", "disk": "10G", "mem": 2, "name": "t2_VM1", "vcpu": 4, "vmif": "t2VM1if1"}, {"brif": "t2br1if2", "disk": "10G", "mem": 4, "name": "t2_VM2", "vcpu": 2, "vmif": "t2VM2if1"}]}, {"dev": "t2s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.11.2", "remote_ip": "10.2.11.2", "remote_route": "10.2.11.0/24", "subnet_route": "10.1.11.0/24", "tenant_route_ip": "192.168.2.2", "v_name": "vxlan_t2s1"}], "rc": 0, "start": "2019-12-05 17:16:06.856422", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Get PNS ip address] ***********************************************************************************************************************************
ok: [localhost] => {"changed": false, "cmd": "ip netns exec pns ip addr show p1 | awk 'FNR==3{ print $2 }' | awk -F/ '{ print $1 }'\n", "delta": "0:00:00.039464", "end": "2019-12-05 17:16:07.263163", "rc": 0, "start": "2019-12-05 17:16:07.223699", "stderr": "", "stderr_lines": [], "stdout": "192.168.100.238", "stdout_lines": ["192.168.100.238"]}

TASK [Add VXLAN routes to host] *****************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.11.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.1.11.1', u'bridge_name': u't2br1', u'dns': [{u'dnsif': u't2s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't2s1_dnsbrif'}], u'ns_name': u't2ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.11.2/24', u'tenant_ns_ip': u'10.1.11.1/24', u'tenant_ns_if': u't2ns1if', u'tenant_sub_if': u't2s1if', u'tenant_ns_name': u't2'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't2_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't2br1if1', u'vmif': u't2VM1if1'}, {u'mem': 4, u'name': u't2_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't2br1if2', u'vmif': u't2VM2if1'}]}, {u'local_ip': u'10.1.11.2', u'dsport': 4789, u'dev': u't2s1if', u'tenant_route_ip': u'192.168.2.2', u'remote_route': u'10.2.11.0/24', u'subnet_route': u'10.1.11.0/24', u'v_name': u'vxlan_t2s1', u'id': 42, u'remote_ip': u'10.2.11.2'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip route show \"10.1.11.0/24\" via \"192.168.100.238\" | grep -w '^10.1.11.0/24' ; if [ $? -ne 0 ] ; then ip route add \"10.1.11.0/24\" via \"192.168.100.238\" ; fi\nip route show \"10.2.11.0/24\" via 99.99.99.2 | grep -w '^10.2.11.0/24'; if [ $? -ne 0 ] ; then ip route add \"10.2.11.0/24\" via 99.99.99.2 ; fi\n", "delta": "0:00:00.008951", "end": "2019-12-05 17:16:07.571889", "item": [{"bridge_name": "t2br1", "default_route_ip": "10.1.11.1", "dns": [{"brif": "t2s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.5", "dnsif": "t2s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns1", "route": [{"if": "p1", "ip": "10.1.11.1/24", "ns_if": "t2if", "ns_name": "t2"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t2ns1if", "tenant_ns_ip": "10.1.11.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s1if", "tenant_sub_ip": "10.1.11.2/24"}], "vms": [{"brif": "t2br1if1", "disk": "10G", "mem": 2, "name": "t2_VM1", "vcpu": 4, "vmif": "t2VM1if1"}, {"brif": "t2br1if2", "disk": "10G", "mem": 4, "name": "t2_VM2", "vcpu": 2, "vmif": "t2VM2if1"}]}, {"dev": "t2s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.11.2", "remote_ip": "10.2.11.2", "remote_route": "10.2.11.0/24", "subnet_route": "10.1.11.0/24", "tenant_route_ip": "192.168.2.2", "v_name": "vxlan_t2s1"}], "rc": 0, "start": "2019-12-05 17:16:07.562938", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

PLAY RECAP **************************************************************************************************************************************************
localhost                  : ok=3    changed=2    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0   

Using /etc/ansible/ansible.cfg as config file

PLAY [worker] ***********************************************************************************************************************************************

TASK [Add VXLAN routes in PNS] ******************************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.11.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.2.11.1', u'bridge_name': u't2br1', u'dns': [{u'dnsif': u't2s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't2s1_dnsbrif'}], u'ns_name': u't2ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.11.2/24', u'tenant_ns_ip': u'10.2.11.1/24', u'tenant_ns_if': u't2ns1if', u'tenant_sub_if': u't2s1if', u'tenant_ns_name': u't2'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't2_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't2br1if1', u'vmif': u't2VM4if1'}]}, {u'local_ip': u'10.2.11.2', u'dsport': 4789, u'dev': u't2s1if', u'tenant_route_ip': u'192.168.130.2', u'remote_route': u'10.1.11.0/24', u'subnet_route': u'10.2.11.0/24', u'v_name': u'vxlan_t2s1', u'id': 42, u'remote_ip': u'10.1.11.2'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec pns ip route show \"10.2.11.0/24\" via \"192.168.130.2\" | grep -w '^10.2.11.0/24' ; if [ $? -ne 0 ] ; then ip netns exec pns ip route add \"10.2.11.0/24\" via \"192.168.130.2\" ; fi\n", "delta": "0:00:00.075684", "end": "2019-12-05 17:16:08.847896", "item": [{"bridge_name": "t2br1", "default_route_ip": "10.2.11.1", "dns": [{"brif": "t2s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.5", "dnsif": "t2s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns1", "route": [{"if": "p1", "ip": "10.2.11.1/24", "ns_if": "t2if", "ns_name": "t2"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t2ns1if", "tenant_ns_ip": "10.2.11.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s1if", "tenant_sub_ip": "10.2.11.2/24"}], "vms": [{"brif": "t2br1if1", "disk": "10G", "mem": 2, "name": "t2_VM4", "vcpu": 4, "vmif": "t2VM4if1"}]}, {"dev": "t2s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.11.2", "remote_ip": "10.1.11.2", "remote_route": "10.1.11.0/24", "subnet_route": "10.2.11.0/24", "tenant_route_ip": "192.168.130.2", "v_name": "vxlan_t2s1"}], "rc": 0, "start": "2019-12-05 17:16:08.772212", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}
skipping: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.12.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.2.12.1', u'bridge_name': u't2br2', u'dns': [{u'dnsif': u't2s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't2s2_dnsbrif'}], u'ns_name': u't2ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.12.2/24', u'tenant_ns_ip': u'10.2.12.1/24', u'tenant_ns_if': u't2ns2if', u'tenant_sub_if': u't2s2if', u'tenant_ns_name': u't2'}], u'subnet_ip': u'2.2.2.0/24', u'vms': [{u'mem': 3, u'name': u't2_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't2br2if1', u'vmif': u't2VM3if1'}]}, {u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}])  => {"ansible_loop_var": "item", "changed": false, "item": [{"bridge_name": "t2br2", "default_route_ip": "10.2.12.1", "dns": [{"brif": "t2s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t2s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns2", "route": [{"if": "p1", "ip": "10.2.12.1/24", "ns_if": "t2if", "ns_name": "t2"}], "subnet_ip": "2.2.2.0/24", "tenant_ns": [{"tenant_ns_if": "t2ns2if", "tenant_ns_ip": "10.2.12.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s2if", "tenant_sub_ip": "10.2.12.2/24"}], "vms": [{"brif": "t2br2if1", "disk": "10G", "mem": 3, "name": "t2_VM3", "vcpu": 2, "vmif": "t2VM3if1"}]}, {"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}], "skip_reason": "Conditional result was False"}

TASK [Get PNS ip address] ***********************************************************************************************************************************
ok: [99.99.99.2] => {"changed": false, "cmd": "ip netns exec pns ip addr show p1 | awk 'FNR==3{ print $2 }' | awk -F/ '{ print $1 }'\n", "delta": "0:00:00.045408", "end": "2019-12-05 17:16:09.292388", "rc": 0, "start": "2019-12-05 17:16:09.246980", "stderr": "", "stderr_lines": [], "stdout": "192.168.100.50", "stdout_lines": ["192.168.100.50"]}

TASK [Add VXLAN routes to host] *****************************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.11.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.2.11.1', u'bridge_name': u't2br1', u'dns': [{u'dnsif': u't2s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't2s1_dnsbrif'}], u'ns_name': u't2ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.11.2/24', u'tenant_ns_ip': u'10.2.11.1/24', u'tenant_ns_if': u't2ns1if', u'tenant_sub_if': u't2s1if', u'tenant_ns_name': u't2'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't2_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't2br1if1', u'vmif': u't2VM4if1'}]}, {u'local_ip': u'10.2.11.2', u'dsport': 4789, u'dev': u't2s1if', u'tenant_route_ip': u'192.168.130.2', u'remote_route': u'10.1.11.0/24', u'subnet_route': u'10.2.11.0/24', u'v_name': u'vxlan_t2s1', u'id': 42, u'remote_ip': u'10.1.11.2'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip route show \"10.2.11.0/24\" via \"192.168.100.50\" | grep -w '^10.2.11.0/24' ; if [ $? -ne 0 ] ; then ip route add \"10.2.11.0/24\" via \"192.168.100.50\" ; fi\nip route show \"10.1.11.0/24\" via 99.99.99.1 | grep -w '^10.1.11.0/24'; if [ $? -ne 0 ] ; then ip route add \"10.1.11.0/24\" via 99.99.99.1 ; fi\n", "delta": "0:00:00.008209", "end": "2019-12-05 17:16:09.712659", "item": [{"bridge_name": "t2br1", "default_route_ip": "10.2.11.1", "dns": [{"brif": "t2s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.5", "dnsif": "t2s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns1", "route": [{"if": "p1", "ip": "10.2.11.1/24", "ns_if": "t2if", "ns_name": "t2"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t2ns1if", "tenant_ns_ip": "10.2.11.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s1if", "tenant_sub_ip": "10.2.11.2/24"}], "vms": [{"brif": "t2br1if1", "disk": "10G", "mem": 2, "name": "t2_VM4", "vcpu": 4, "vmif": "t2VM4if1"}]}, {"dev": "t2s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.11.2", "remote_ip": "10.1.11.2", "remote_route": "10.1.11.0/24", "subnet_route": "10.2.11.0/24", "tenant_route_ip": "192.168.130.2", "v_name": "vxlan_t2s1"}], "rc": 0, "start": "2019-12-05 17:16:09.704450", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}
skipping: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.12.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.2.12.1', u'bridge_name': u't2br2', u'dns': [{u'dnsif': u't2s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't2s2_dnsbrif'}], u'ns_name': u't2ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.12.2/24', u'tenant_ns_ip': u'10.2.12.1/24', u'tenant_ns_if': u't2ns2if', u'tenant_sub_if': u't2s2if', u'tenant_ns_name': u't2'}], u'subnet_ip': u'2.2.2.0/24', u'vms': [{u'mem': 3, u'name': u't2_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't2br2if1', u'vmif': u't2VM3if1'}]}, {u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}])  => {"ansible_loop_var": "item", "changed": false, "item": [{"bridge_name": "t2br2", "default_route_ip": "10.2.12.1", "dns": [{"brif": "t2s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t2s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns2", "route": [{"if": "p1", "ip": "10.2.12.1/24", "ns_if": "t2if", "ns_name": "t2"}], "subnet_ip": "2.2.2.0/24", "tenant_ns": [{"tenant_ns_if": "t2ns2if", "tenant_ns_ip": "10.2.12.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s2if", "tenant_sub_ip": "10.2.12.2/24"}], "vms": [{"brif": "t2br2if1", "disk": "10G", "mem": 3, "name": "t2_VM3", "vcpu": 2, "vmif": "t2VM3if1"}]}, {"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}], "skip_reason": "Conditional result was False"}

PLAY RECAP **************************************************************************************************************************************************
99.99.99.2                 : ok=3    changed=2    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0   

Using /etc/ansible/ansible.cfg as config file

PLAY [main] *************************************************************************************************************************************************

TASK [Create VM templates (C1)] *****************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.11.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.1.11.1', u'bridge_name': u't2br1', u'dns': [{u'dnsif': u't2s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't2s1_dnsbrif'}], u'ns_name': u't2ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.11.2/24', u'tenant_ns_ip': u'10.1.11.1/24', u'tenant_ns_if': u't2ns1if', u'tenant_sub_if': u't2s1if', u'tenant_ns_name': u't2'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.1.11.2', u'dsport': 4789, u'dev': u't2s1if', u'tenant_route_ip': u'192.168.2.2', u'remote_route': u'10.2.11.0/24', u'subnet_route': u'10.1.11.0/24', u'v_name': u'vxlan_t2s1', u'id': 42, u'remote_ip': u'10.2.11.2'}]}, {u'mem': 2, u'name': u't2_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't2br1if1', u'vmif': u't2VM1if1'}]) => {"ansible_loop_var": "item", "changed": true, "checksum": "350ba870bd31b7f6ee517845c14237910b5af0bf", "dest": "/root/Migration-as-a-Service/etc/t2/VM_templates/t2_VM1.xml.j2", "gid": 0, "group": "root", "item": [{"bridge_name": "t2br1", "default_route_ip": "10.1.11.1", "dns": [{"brif": "t2s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.5", "dnsif": "t2s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns1", "route": [{"if": "p1", "ip": "10.1.11.1/24", "ns_if": "t2if", "ns_name": "t2"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t2ns1if", "tenant_ns_ip": "10.1.11.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s1if", "tenant_sub_ip": "10.1.11.2/24"}], "vxlan": [{"dev": "t2s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.11.2", "remote_ip": "10.2.11.2", "remote_route": "10.2.11.0/24", "subnet_route": "10.1.11.0/24", "tenant_route_ip": "192.168.2.2", "v_name": "vxlan_t2s1"}]}, {"brif": "t2br1if1", "disk": "10G", "mem": 2, "name": "t2_VM1", "vcpu": 4, "vmif": "t2VM1if1"}], "md5sum": "fbfc2eb0c2569531f25eea92c26d3bee", "mode": "0644", "owner": "root", "size": 4091, "src": "/root/.ansible/tmp/ansible-tmp-1575566170.44-124610988213122/source", "state": "file", "uid": 0}
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.11.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.1.11.1', u'bridge_name': u't2br1', u'dns': [{u'dnsif': u't2s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't2s1_dnsbrif'}], u'ns_name': u't2ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.11.2/24', u'tenant_ns_ip': u'10.1.11.1/24', u'tenant_ns_if': u't2ns1if', u'tenant_sub_if': u't2s1if', u'tenant_ns_name': u't2'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.1.11.2', u'dsport': 4789, u'dev': u't2s1if', u'tenant_route_ip': u'192.168.2.2', u'remote_route': u'10.2.11.0/24', u'subnet_route': u'10.1.11.0/24', u'v_name': u'vxlan_t2s1', u'id': 42, u'remote_ip': u'10.2.11.2'}]}, {u'mem': 4, u'name': u't2_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't2br1if2', u'vmif': u't2VM2if1'}]) => {"ansible_loop_var": "item", "changed": true, "checksum": "350ba870bd31b7f6ee517845c14237910b5af0bf", "dest": "/root/Migration-as-a-Service/etc/t2/VM_templates/t2_VM2.xml.j2", "gid": 0, "group": "root", "item": [{"bridge_name": "t2br1", "default_route_ip": "10.1.11.1", "dns": [{"brif": "t2s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.5", "dnsif": "t2s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns1", "route": [{"if": "p1", "ip": "10.1.11.1/24", "ns_if": "t2if", "ns_name": "t2"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t2ns1if", "tenant_ns_ip": "10.1.11.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s1if", "tenant_sub_ip": "10.1.11.2/24"}], "vxlan": [{"dev": "t2s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.11.2", "remote_ip": "10.2.11.2", "remote_route": "10.2.11.0/24", "subnet_route": "10.1.11.0/24", "tenant_route_ip": "192.168.2.2", "v_name": "vxlan_t2s1"}]}, {"brif": "t2br1if2", "disk": "10G", "mem": 4, "name": "t2_VM2", "vcpu": 2, "vmif": "t2VM2if1"}], "md5sum": "fbfc2eb0c2569531f25eea92c26d3bee", "mode": "0644", "owner": "root", "size": 4091, "src": "/root/.ansible/tmp/ansible-tmp-1575566171.08-215228952907218/source", "state": "file", "uid": 0}

PLAY RECAP **************************************************************************************************************************************************
localhost                  : ok=1    changed=1    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0   

Using /etc/ansible/ansible.cfg as config file

PLAY [main] *************************************************************************************************************************************************

TASK [Create VM templates (C2)] *****************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.2.11.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.2.11.1', u'bridge_name': u't2br1', u'dns': [{u'dnsif': u't2s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't2s1_dnsbrif'}], u'ns_name': u't2ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.11.2/24', u'tenant_ns_ip': u'10.2.11.1/24', u'tenant_ns_if': u't2ns1if', u'tenant_sub_if': u't2s1if', u'tenant_ns_name': u't2'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.2.11.2', u'dsport': 4789, u'dev': u't2s1if', u'tenant_route_ip': u'192.168.130.2', u'remote_route': u'10.1.11.0/24', u'subnet_route': u'10.2.11.0/24', u'v_name': u'vxlan_t2s1', u'id': 42, u'remote_ip': u'10.1.11.2'}]}, {u'mem': 2, u'name': u't2_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't2br1if1', u'vmif': u't2VM4if1'}]) => {"ansible_loop_var": "item", "changed": true, "checksum": "350ba870bd31b7f6ee517845c14237910b5af0bf", "dest": "/root/Migration-as-a-Service/etc/t2/VM_templates/t2_VM4.xml.j2", "gid": 0, "group": "root", "item": [{"bridge_name": "t2br1", "default_route_ip": "10.2.11.1", "dns": [{"brif": "t2s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.5", "dnsif": "t2s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns1", "route": [{"if": "p1", "ip": "10.2.11.1/24", "ns_if": "t2if", "ns_name": "t2"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t2ns1if", "tenant_ns_ip": "10.2.11.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s1if", "tenant_sub_ip": "10.2.11.2/24"}], "vxlan": [{"dev": "t2s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.11.2", "remote_ip": "10.1.11.2", "remote_route": "10.1.11.0/24", "subnet_route": "10.2.11.0/24", "tenant_route_ip": "192.168.130.2", "v_name": "vxlan_t2s1"}]}, {"brif": "t2br1if1", "disk": "10G", "mem": 2, "name": "t2_VM4", "vcpu": 4, "vmif": "t2VM4if1"}], "md5sum": "fbfc2eb0c2569531f25eea92c26d3bee", "mode": "0644", "owner": "root", "size": 4091, "src": "/root/.ansible/tmp/ansible-tmp-1575566172.05-258680757173992/source", "state": "file", "uid": 0}
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.2.12.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.2.12.1', u'bridge_name': u't2br2', u'dns': [{u'dnsif': u't2s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't2s2_dnsbrif'}], u'ns_name': u't2ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.12.2/24', u'tenant_ns_ip': u'10.2.12.1/24', u'tenant_ns_if': u't2ns2if', u'tenant_sub_if': u't2s2if', u'tenant_ns_name': u't2'}], u'subnet_ip': u'2.2.2.0/24', u'vxlan': [{u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}, {u'mem': 3, u'name': u't2_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't2br2if1', u'vmif': u't2VM3if1'}]) => {"ansible_loop_var": "item", "changed": true, "checksum": "350ba870bd31b7f6ee517845c14237910b5af0bf", "dest": "/root/Migration-as-a-Service/etc/t2/VM_templates/t2_VM3.xml.j2", "gid": 0, "group": "root", "item": [{"bridge_name": "t2br2", "default_route_ip": "10.2.12.1", "dns": [{"brif": "t2s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t2s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns2", "route": [{"if": "p1", "ip": "10.2.12.1/24", "ns_if": "t2if", "ns_name": "t2"}], "subnet_ip": "2.2.2.0/24", "tenant_ns": [{"tenant_ns_if": "t2ns2if", "tenant_ns_ip": "10.2.12.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s2if", "tenant_sub_ip": "10.2.12.2/24"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, {"brif": "t2br2if1", "disk": "10G", "mem": 3, "name": "t2_VM3", "vcpu": 2, "vmif": "t2VM3if1"}], "md5sum": "fbfc2eb0c2569531f25eea92c26d3bee", "mode": "0644", "owner": "root", "size": 4091, "src": "/root/.ansible/tmp/ansible-tmp-1575566172.62-137627926586896/source", "state": "file", "uid": 0}

PLAY RECAP **************************************************************************************************************************************************
localhost                  : ok=1    changed=1    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0   

Using /etc/ansible/ansible.cfg as config file

PLAY [main] *************************************************************************************************************************************************

TASK [Copy VM image] ****************************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.11.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.1.11.1', u'bridge_name': u't2br1', u'dns': [{u'dnsif': u't2s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't2s1_dnsbrif'}], u'ns_name': u't2ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.11.2/24', u'tenant_ns_ip': u'10.1.11.1/24', u'tenant_ns_if': u't2ns1if', u'tenant_sub_if': u't2s1if', u'tenant_ns_name': u't2'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.1.11.2', u'dsport': 4789, u'dev': u't2s1if', u'tenant_route_ip': u'192.168.2.2', u'remote_route': u'10.2.11.0/24', u'subnet_route': u'10.1.11.0/24', u'v_name': u'vxlan_t2s1', u'id': 42, u'remote_ip': u'10.2.11.2'}]}, {u'mem': 2, u'name': u't2_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't2br1if1', u'vmif': u't2VM1if1'}]) => {"ansible_loop_var": "item", "changed": true, "checksum": "d86d5962370fcd0c3d05943fc209d9e05fdac89f", "dest": "/var/lib/libvirt/images/t2_VM1.qcow2", "gid": 0, "group": "root", "item": [{"bridge_name": "t2br1", "default_route_ip": "10.1.11.1", "dns": [{"brif": "t2s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.5", "dnsif": "t2s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns1", "route": [{"if": "p1", "ip": "10.1.11.1/24", "ns_if": "t2if", "ns_name": "t2"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t2ns1if", "tenant_ns_ip": "10.1.11.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s1if", "tenant_sub_ip": "10.1.11.2/24"}], "vxlan": [{"dev": "t2s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.11.2", "remote_ip": "10.2.11.2", "remote_route": "10.2.11.0/24", "subnet_route": "10.1.11.0/24", "tenant_route_ip": "192.168.2.2", "v_name": "vxlan_t2s1"}]}, {"brif": "t2br1if1", "disk": "10G", "mem": 2, "name": "t2_VM1", "vcpu": 4, "vmif": "t2VM1if1"}], "md5sum": "b977a19124b65f2d544ddc62e407114d", "mode": "0644", "owner": "root", "size": 10739318784, "src": "/root/.ansible/tmp/ansible-tmp-1575566173.63-243798079082995/source", "state": "file", "uid": 0}
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.11.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.1.11.1', u'bridge_name': u't2br1', u'dns': [{u'dnsif': u't2s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't2s1_dnsbrif'}], u'ns_name': u't2ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.11.2/24', u'tenant_ns_ip': u'10.1.11.1/24', u'tenant_ns_if': u't2ns1if', u'tenant_sub_if': u't2s1if', u'tenant_ns_name': u't2'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.1.11.2', u'dsport': 4789, u'dev': u't2s1if', u'tenant_route_ip': u'192.168.2.2', u'remote_route': u'10.2.11.0/24', u'subnet_route': u'10.1.11.0/24', u'v_name': u'vxlan_t2s1', u'id': 42, u'remote_ip': u'10.2.11.2'}]}, {u'mem': 4, u'name': u't2_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't2br1if2', u'vmif': u't2VM2if1'}]) => {"ansible_loop_var": "item", "changed": true, "checksum": "d86d5962370fcd0c3d05943fc209d9e05fdac89f", "dest": "/var/lib/libvirt/images/t2_VM2.qcow2", "gid": 0, "group": "root", "item": [{"bridge_name": "t2br1", "default_route_ip": "10.1.11.1", "dns": [{"brif": "t2s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.5", "dnsif": "t2s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns1", "route": [{"if": "p1", "ip": "10.1.11.1/24", "ns_if": "t2if", "ns_name": "t2"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t2ns1if", "tenant_ns_ip": "10.1.11.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s1if", "tenant_sub_ip": "10.1.11.2/24"}], "vxlan": [{"dev": "t2s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.11.2", "remote_ip": "10.2.11.2", "remote_route": "10.2.11.0/24", "subnet_route": "10.1.11.0/24", "tenant_route_ip": "192.168.2.2", "v_name": "vxlan_t2s1"}]}, {"brif": "t2br1if2", "disk": "10G", "mem": 4, "name": "t2_VM2", "vcpu": 2, "vmif": "t2VM2if1"}], "md5sum": "b977a19124b65f2d544ddc62e407114d", "mode": "0644", "owner": "root", "size": 10739318784, "src": "/root/.ansible/tmp/ansible-tmp-1575566298.24-184710592608301/source", "state": "file", "uid": 0}

TASK [Get list of running VMs] ******************************************************************************************************************************
ok: [localhost] => {"changed": false, "cmd": ["virsh", "list", "--name"], "delta": "0:00:00.064717", "end": "2019-12-05 17:20:08.178749", "rc": 0, "start": "2019-12-05 17:20:08.114032", "stderr": "", "stderr_lines": [], "stdout": "t1_VM1\nt1_VM2", "stdout_lines": ["t1_VM1", "t1_VM2"]}

TASK [Define VM] ********************************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.11.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.1.11.1', u'bridge_name': u't2br1', u'dns': [{u'dnsif': u't2s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't2s1_dnsbrif'}], u'ns_name': u't2ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.11.2/24', u'tenant_ns_ip': u'10.1.11.1/24', u'tenant_ns_if': u't2ns1if', u'tenant_sub_if': u't2s1if', u'tenant_ns_name': u't2'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.1.11.2', u'dsport': 4789, u'dev': u't2s1if', u'tenant_route_ip': u'192.168.2.2', u'remote_route': u'10.2.11.0/24', u'subnet_route': u'10.1.11.0/24', u'v_name': u'vxlan_t2s1', u'id': 42, u'remote_ip': u'10.2.11.2'}]}, {u'mem': 2, u'name': u't2_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't2br1if1', u'vmif': u't2VM1if1'}]) => {"ansible_loop_var": "item", "changed": true, "created": "t2_VM1", "item": [{"bridge_name": "t2br1", "default_route_ip": "10.1.11.1", "dns": [{"brif": "t2s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.5", "dnsif": "t2s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns1", "route": [{"if": "p1", "ip": "10.1.11.1/24", "ns_if": "t2if", "ns_name": "t2"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t2ns1if", "tenant_ns_ip": "10.1.11.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s1if", "tenant_sub_ip": "10.1.11.2/24"}], "vxlan": [{"dev": "t2s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.11.2", "remote_ip": "10.2.11.2", "remote_route": "10.2.11.0/24", "subnet_route": "10.1.11.0/24", "tenant_route_ip": "192.168.2.2", "v_name": "vxlan_t2s1"}]}, {"brif": "t2br1if1", "disk": "10G", "mem": 2, "name": "t2_VM1", "vcpu": 4, "vmif": "t2VM1if1"}], "warnings": ["'xml' is given - ignoring 'name'"]}
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.11.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.1.11.1', u'bridge_name': u't2br1', u'dns': [{u'dnsif': u't2s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't2s1_dnsbrif'}], u'ns_name': u't2ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.11.2/24', u'tenant_ns_ip': u'10.1.11.1/24', u'tenant_ns_if': u't2ns1if', u'tenant_sub_if': u't2s1if', u'tenant_ns_name': u't2'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.1.11.2', u'dsport': 4789, u'dev': u't2s1if', u'tenant_route_ip': u'192.168.2.2', u'remote_route': u'10.2.11.0/24', u'subnet_route': u'10.1.11.0/24', u'v_name': u'vxlan_t2s1', u'id': 42, u'remote_ip': u'10.2.11.2'}]}, {u'mem': 4, u'name': u't2_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't2br1if2', u'vmif': u't2VM2if1'}]) => {"ansible_loop_var": "item", "changed": true, "created": "t2_VM2", "item": [{"bridge_name": "t2br1", "default_route_ip": "10.1.11.1", "dns": [{"brif": "t2s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.5", "dnsif": "t2s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns1", "route": [{"if": "p1", "ip": "10.1.11.1/24", "ns_if": "t2if", "ns_name": "t2"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t2ns1if", "tenant_ns_ip": "10.1.11.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s1if", "tenant_sub_ip": "10.1.11.2/24"}], "vxlan": [{"dev": "t2s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.11.2", "remote_ip": "10.2.11.2", "remote_route": "10.2.11.0/24", "subnet_route": "10.1.11.0/24", "tenant_route_ip": "192.168.2.2", "v_name": "vxlan_t2s1"}]}, {"brif": "t2br1if2", "disk": "10G", "mem": 4, "name": "t2_VM2", "vcpu": 2, "vmif": "t2VM2if1"}], "warnings": ["'xml' is given - ignoring 'name'"]}

TASK [Create VM] ********************************************************************************************************************************************
ok: [localhost] => (item=[{u'route': [{u'ip': u'10.1.11.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.1.11.1', u'bridge_name': u't2br1', u'dns': [{u'dnsif': u't2s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't2s1_dnsbrif'}], u'ns_name': u't2ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.11.2/24', u'tenant_ns_ip': u'10.1.11.1/24', u'tenant_ns_if': u't2ns1if', u'tenant_sub_if': u't2s1if', u'tenant_ns_name': u't2'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.1.11.2', u'dsport': 4789, u'dev': u't2s1if', u'tenant_route_ip': u'192.168.2.2', u'remote_route': u'10.2.11.0/24', u'subnet_route': u'10.1.11.0/24', u'v_name': u'vxlan_t2s1', u'id': 42, u'remote_ip': u'10.2.11.2'}]}, {u'mem': 2, u'name': u't2_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't2br1if1', u'vmif': u't2VM1if1'}]) => {"ansible_loop_var": "item", "changed": false, "create": 0, "item": [{"bridge_name": "t2br1", "default_route_ip": "10.1.11.1", "dns": [{"brif": "t2s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.5", "dnsif": "t2s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns1", "route": [{"if": "p1", "ip": "10.1.11.1/24", "ns_if": "t2if", "ns_name": "t2"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t2ns1if", "tenant_ns_ip": "10.1.11.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s1if", "tenant_sub_ip": "10.1.11.2/24"}], "vxlan": [{"dev": "t2s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.11.2", "remote_ip": "10.2.11.2", "remote_route": "10.2.11.0/24", "subnet_route": "10.1.11.0/24", "tenant_route_ip": "192.168.2.2", "v_name": "vxlan_t2s1"}]}, {"brif": "t2br1if1", "disk": "10G", "mem": 2, "name": "t2_VM1", "vcpu": 4, "vmif": "t2VM1if1"}]}
ok: [localhost] => (item=[{u'route': [{u'ip': u'10.1.11.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.1.11.1', u'bridge_name': u't2br1', u'dns': [{u'dnsif': u't2s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't2s1_dnsbrif'}], u'ns_name': u't2ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.11.2/24', u'tenant_ns_ip': u'10.1.11.1/24', u'tenant_ns_if': u't2ns1if', u'tenant_sub_if': u't2s1if', u'tenant_ns_name': u't2'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.1.11.2', u'dsport': 4789, u'dev': u't2s1if', u'tenant_route_ip': u'192.168.2.2', u'remote_route': u'10.2.11.0/24', u'subnet_route': u'10.1.11.0/24', u'v_name': u'vxlan_t2s1', u'id': 42, u'remote_ip': u'10.2.11.2'}]}, {u'mem': 4, u'name': u't2_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't2br1if2', u'vmif': u't2VM2if1'}]) => {"ansible_loop_var": "item", "changed": false, "create": 0, "item": [{"bridge_name": "t2br1", "default_route_ip": "10.1.11.1", "dns": [{"brif": "t2s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.5", "dnsif": "t2s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns1", "route": [{"if": "p1", "ip": "10.1.11.1/24", "ns_if": "t2if", "ns_name": "t2"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t2ns1if", "tenant_ns_ip": "10.1.11.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s1if", "tenant_sub_ip": "10.1.11.2/24"}], "vxlan": [{"dev": "t2s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.11.2", "remote_ip": "10.2.11.2", "remote_route": "10.2.11.0/24", "subnet_route": "10.1.11.0/24", "tenant_route_ip": "192.168.2.2", "v_name": "vxlan_t2s1"}]}, {"brif": "t2br1if2", "disk": "10G", "mem": 4, "name": "t2_VM2", "vcpu": 2, "vmif": "t2VM2if1"}]}

TASK [Start VM] *********************************************************************************************************************************************
ok: [localhost] => (item=[{u'route': [{u'ip': u'10.1.11.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.1.11.1', u'bridge_name': u't2br1', u'dns': [{u'dnsif': u't2s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't2s1_dnsbrif'}], u'ns_name': u't2ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.11.2/24', u'tenant_ns_ip': u'10.1.11.1/24', u'tenant_ns_if': u't2ns1if', u'tenant_sub_if': u't2s1if', u'tenant_ns_name': u't2'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.1.11.2', u'dsport': 4789, u'dev': u't2s1if', u'tenant_route_ip': u'192.168.2.2', u'remote_route': u'10.2.11.0/24', u'subnet_route': u'10.1.11.0/24', u'v_name': u'vxlan_t2s1', u'id': 42, u'remote_ip': u'10.2.11.2'}]}, {u'mem': 2, u'name': u't2_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't2br1if1', u'vmif': u't2VM1if1'}]) => {"ansible_loop_var": "item", "changed": false, "item": [{"bridge_name": "t2br1", "default_route_ip": "10.1.11.1", "dns": [{"brif": "t2s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.5", "dnsif": "t2s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns1", "route": [{"if": "p1", "ip": "10.1.11.1/24", "ns_if": "t2if", "ns_name": "t2"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t2ns1if", "tenant_ns_ip": "10.1.11.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s1if", "tenant_sub_ip": "10.1.11.2/24"}], "vxlan": [{"dev": "t2s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.11.2", "remote_ip": "10.2.11.2", "remote_route": "10.2.11.0/24", "subnet_route": "10.1.11.0/24", "tenant_route_ip": "192.168.2.2", "v_name": "vxlan_t2s1"}]}, {"brif": "t2br1if1", "disk": "10G", "mem": 2, "name": "t2_VM1", "vcpu": 4, "vmif": "t2VM1if1"}]}
ok: [localhost] => (item=[{u'route': [{u'ip': u'10.1.11.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.1.11.1', u'bridge_name': u't2br1', u'dns': [{u'dnsif': u't2s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't2s1_dnsbrif'}], u'ns_name': u't2ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.11.2/24', u'tenant_ns_ip': u'10.1.11.1/24', u'tenant_ns_if': u't2ns1if', u'tenant_sub_if': u't2s1if', u'tenant_ns_name': u't2'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.1.11.2', u'dsport': 4789, u'dev': u't2s1if', u'tenant_route_ip': u'192.168.2.2', u'remote_route': u'10.2.11.0/24', u'subnet_route': u'10.1.11.0/24', u'v_name': u'vxlan_t2s1', u'id': 42, u'remote_ip': u'10.2.11.2'}]}, {u'mem': 4, u'name': u't2_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't2br1if2', u'vmif': u't2VM2if1'}]) => {"ansible_loop_var": "item", "changed": false, "item": [{"bridge_name": "t2br1", "default_route_ip": "10.1.11.1", "dns": [{"brif": "t2s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.5", "dnsif": "t2s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns1", "route": [{"if": "p1", "ip": "10.1.11.1/24", "ns_if": "t2if", "ns_name": "t2"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t2ns1if", "tenant_ns_ip": "10.1.11.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s1if", "tenant_sub_ip": "10.1.11.2/24"}], "vxlan": [{"dev": "t2s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.11.2", "remote_ip": "10.2.11.2", "remote_route": "10.2.11.0/24", "subnet_route": "10.1.11.0/24", "tenant_route_ip": "192.168.2.2", "v_name": "vxlan_t2s1"}]}, {"brif": "t2br1if2", "disk": "10G", "mem": 4, "name": "t2_VM2", "vcpu": 2, "vmif": "t2VM2if1"}]}

TASK [Attach VM interface] **********************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.11.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.1.11.1', u'bridge_name': u't2br1', u'dns': [{u'dnsif': u't2s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't2s1_dnsbrif'}], u'ns_name': u't2ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.11.2/24', u'tenant_ns_ip': u'10.1.11.1/24', u'tenant_ns_if': u't2ns1if', u'tenant_sub_if': u't2s1if', u'tenant_ns_name': u't2'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.1.11.2', u'dsport': 4789, u'dev': u't2s1if', u'tenant_route_ip': u'192.168.2.2', u'remote_route': u'10.2.11.0/24', u'subnet_route': u'10.1.11.0/24', u'v_name': u'vxlan_t2s1', u'id': 42, u'remote_ip': u'10.2.11.2'}]}, {u'mem': 2, u'name': u't2_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't2br1if1', u'vmif': u't2VM1if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "virsh domiflist \"t2_VM1\" | grep -w 't2VM1if1' ; if [ $? -ne 0 ] ; then virsh attach-interface \"t2_VM1\" direct \"t2VM1if1\" --live --persistent ; fi\n", "delta": "0:00:00.257719", "end": "2019-12-05 17:20:11.930165", "item": [{"bridge_name": "t2br1", "default_route_ip": "10.1.11.1", "dns": [{"brif": "t2s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.5", "dnsif": "t2s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns1", "route": [{"if": "p1", "ip": "10.1.11.1/24", "ns_if": "t2if", "ns_name": "t2"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t2ns1if", "tenant_ns_ip": "10.1.11.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s1if", "tenant_sub_ip": "10.1.11.2/24"}], "vxlan": [{"dev": "t2s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.11.2", "remote_ip": "10.2.11.2", "remote_route": "10.2.11.0/24", "subnet_route": "10.1.11.0/24", "tenant_route_ip": "192.168.2.2", "v_name": "vxlan_t2s1"}]}, {"brif": "t2br1if1", "disk": "10G", "mem": 2, "name": "t2_VM1", "vcpu": 4, "vmif": "t2VM1if1"}], "rc": 0, "start": "2019-12-05 17:20:11.672446", "stderr": "", "stderr_lines": [], "stdout": "Interface attached successfully", "stdout_lines": ["Interface attached successfully"]}
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.11.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.1.11.1', u'bridge_name': u't2br1', u'dns': [{u'dnsif': u't2s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't2s1_dnsbrif'}], u'ns_name': u't2ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.11.2/24', u'tenant_ns_ip': u'10.1.11.1/24', u'tenant_ns_if': u't2ns1if', u'tenant_sub_if': u't2s1if', u'tenant_ns_name': u't2'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.1.11.2', u'dsport': 4789, u'dev': u't2s1if', u'tenant_route_ip': u'192.168.2.2', u'remote_route': u'10.2.11.0/24', u'subnet_route': u'10.1.11.0/24', u'v_name': u'vxlan_t2s1', u'id': 42, u'remote_ip': u'10.2.11.2'}]}, {u'mem': 4, u'name': u't2_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't2br1if2', u'vmif': u't2VM2if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "virsh domiflist \"t2_VM2\" | grep -w 't2VM2if1' ; if [ $? -ne 0 ] ; then virsh attach-interface \"t2_VM2\" direct \"t2VM2if1\" --live --persistent ; fi\n", "delta": "0:00:00.217950", "end": "2019-12-05 17:20:12.301350", "item": [{"bridge_name": "t2br1", "default_route_ip": "10.1.11.1", "dns": [{"brif": "t2s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.5", "dnsif": "t2s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns1", "route": [{"if": "p1", "ip": "10.1.11.1/24", "ns_if": "t2if", "ns_name": "t2"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t2ns1if", "tenant_ns_ip": "10.1.11.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s1if", "tenant_sub_ip": "10.1.11.2/24"}], "vxlan": [{"dev": "t2s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.11.2", "remote_ip": "10.2.11.2", "remote_route": "10.2.11.0/24", "subnet_route": "10.1.11.0/24", "tenant_route_ip": "192.168.2.2", "v_name": "vxlan_t2s1"}]}, {"brif": "t2br1if2", "disk": "10G", "mem": 4, "name": "t2_VM2", "vcpu": 2, "vmif": "t2VM2if1"}], "rc": 0, "start": "2019-12-05 17:20:12.083400", "stderr": "", "stderr_lines": [], "stdout": "Interface attached successfully", "stdout_lines": ["Interface attached successfully"]}

PLAY RECAP **************************************************************************************************************************************************
localhost                  : ok=6    changed=3    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0   

Using /etc/ansible/ansible.cfg as config file

PLAY [worker] ***********************************************************************************************************************************************

TASK [Copy VM image] ****************************************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.11.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.2.11.1', u'bridge_name': u't2br1', u'dns': [{u'dnsif': u't2s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't2s1_dnsbrif'}], u'ns_name': u't2ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.11.2/24', u'tenant_ns_ip': u'10.2.11.1/24', u'tenant_ns_if': u't2ns1if', u'tenant_sub_if': u't2s1if', u'tenant_ns_name': u't2'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.2.11.2', u'dsport': 4789, u'dev': u't2s1if', u'tenant_route_ip': u'192.168.130.2', u'remote_route': u'10.1.11.0/24', u'subnet_route': u'10.2.11.0/24', u'v_name': u'vxlan_t2s1', u'id': 42, u'remote_ip': u'10.1.11.2'}]}, {u'mem': 2, u'name': u't2_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't2br1if1', u'vmif': u't2VM4if1'}]) => {"ansible_loop_var": "item", "changed": true, "checksum": "f8b2ffa2bf201c84196c582f2dec0d33a1eb4b42", "dest": "/var/lib/libvirt/images/t2_VM4.qcow2", "gid": 0, "group": "root", "item": [{"bridge_name": "t2br1", "default_route_ip": "10.2.11.1", "dns": [{"brif": "t2s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.5", "dnsif": "t2s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns1", "route": [{"if": "p1", "ip": "10.2.11.1/24", "ns_if": "t2if", "ns_name": "t2"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t2ns1if", "tenant_ns_ip": "10.2.11.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s1if", "tenant_sub_ip": "10.2.11.2/24"}], "vxlan": [{"dev": "t2s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.11.2", "remote_ip": "10.1.11.2", "remote_route": "10.1.11.0/24", "subnet_route": "10.2.11.0/24", "tenant_route_ip": "192.168.130.2", "v_name": "vxlan_t2s1"}]}, {"brif": "t2br1if1", "disk": "10G", "mem": 2, "name": "t2_VM4", "vcpu": 4, "vmif": "t2VM4if1"}], "md5sum": "e6d5d524b68797ddd748ba1475985d34", "mode": "0644", "owner": "root", "size": 10739318784, "src": "/root/mainVM.qcow2", "state": "file", "uid": 0}
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.12.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.2.12.1', u'bridge_name': u't2br2', u'dns': [{u'dnsif': u't2s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't2s2_dnsbrif'}], u'ns_name': u't2ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.12.2/24', u'tenant_ns_ip': u'10.2.12.1/24', u'tenant_ns_if': u't2ns2if', u'tenant_sub_if': u't2s2if', u'tenant_ns_name': u't2'}], u'subnet_ip': u'2.2.2.0/24', u'vxlan': [{u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}, {u'mem': 3, u'name': u't2_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't2br2if1', u'vmif': u't2VM3if1'}]) => {"ansible_loop_var": "item", "changed": true, "checksum": "f8b2ffa2bf201c84196c582f2dec0d33a1eb4b42", "dest": "/var/lib/libvirt/images/t2_VM3.qcow2", "gid": 0, "group": "root", "item": [{"bridge_name": "t2br2", "default_route_ip": "10.2.12.1", "dns": [{"brif": "t2s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t2s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns2", "route": [{"if": "p1", "ip": "10.2.12.1/24", "ns_if": "t2if", "ns_name": "t2"}], "subnet_ip": "2.2.2.0/24", "tenant_ns": [{"tenant_ns_if": "t2ns2if", "tenant_ns_ip": "10.2.12.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s2if", "tenant_sub_ip": "10.2.12.2/24"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, {"brif": "t2br2if1", "disk": "10G", "mem": 3, "name": "t2_VM3", "vcpu": 2, "vmif": "t2VM3if1"}], "md5sum": "e6d5d524b68797ddd748ba1475985d34", "mode": "0644", "owner": "root", "size": 10739318784, "src": "/root/mainVM.qcow2", "state": "file", "uid": 0}

TASK [Get list of running VMs] ******************************************************************************************************************************
ok: [99.99.99.2] => {"changed": false, "cmd": ["virsh", "list", "--name"], "delta": "0:00:00.032875", "end": "2019-12-05 17:23:28.289247", "rc": 0, "start": "2019-12-05 17:23:28.256372", "stderr": "", "stderr_lines": [], "stdout": "t1_VM4\nt1_VM3", "stdout_lines": ["t1_VM4", "t1_VM3"]}

TASK [Define VM] ********************************************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.11.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.2.11.1', u'bridge_name': u't2br1', u'dns': [{u'dnsif': u't2s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't2s1_dnsbrif'}], u'ns_name': u't2ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.11.2/24', u'tenant_ns_ip': u'10.2.11.1/24', u'tenant_ns_if': u't2ns1if', u'tenant_sub_if': u't2s1if', u'tenant_ns_name': u't2'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.2.11.2', u'dsport': 4789, u'dev': u't2s1if', u'tenant_route_ip': u'192.168.130.2', u'remote_route': u'10.1.11.0/24', u'subnet_route': u'10.2.11.0/24', u'v_name': u'vxlan_t2s1', u'id': 42, u'remote_ip': u'10.1.11.2'}]}, {u'mem': 2, u'name': u't2_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't2br1if1', u'vmif': u't2VM4if1'}]) => {"ansible_loop_var": "item", "changed": true, "created": "t2_VM4", "item": [{"bridge_name": "t2br1", "default_route_ip": "10.2.11.1", "dns": [{"brif": "t2s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.5", "dnsif": "t2s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns1", "route": [{"if": "p1", "ip": "10.2.11.1/24", "ns_if": "t2if", "ns_name": "t2"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t2ns1if", "tenant_ns_ip": "10.2.11.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s1if", "tenant_sub_ip": "10.2.11.2/24"}], "vxlan": [{"dev": "t2s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.11.2", "remote_ip": "10.1.11.2", "remote_route": "10.1.11.0/24", "subnet_route": "10.2.11.0/24", "tenant_route_ip": "192.168.130.2", "v_name": "vxlan_t2s1"}]}, {"brif": "t2br1if1", "disk": "10G", "mem": 2, "name": "t2_VM4", "vcpu": 4, "vmif": "t2VM4if1"}], "warnings": ["'xml' is given - ignoring 'name'"]}
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.12.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.2.12.1', u'bridge_name': u't2br2', u'dns': [{u'dnsif': u't2s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't2s2_dnsbrif'}], u'ns_name': u't2ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.12.2/24', u'tenant_ns_ip': u'10.2.12.1/24', u'tenant_ns_if': u't2ns2if', u'tenant_sub_if': u't2s2if', u'tenant_ns_name': u't2'}], u'subnet_ip': u'2.2.2.0/24', u'vxlan': [{u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}, {u'mem': 3, u'name': u't2_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't2br2if1', u'vmif': u't2VM3if1'}]) => {"ansible_loop_var": "item", "changed": true, "created": "t2_VM3", "item": [{"bridge_name": "t2br2", "default_route_ip": "10.2.12.1", "dns": [{"brif": "t2s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t2s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns2", "route": [{"if": "p1", "ip": "10.2.12.1/24", "ns_if": "t2if", "ns_name": "t2"}], "subnet_ip": "2.2.2.0/24", "tenant_ns": [{"tenant_ns_if": "t2ns2if", "tenant_ns_ip": "10.2.12.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s2if", "tenant_sub_ip": "10.2.12.2/24"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, {"brif": "t2br2if1", "disk": "10G", "mem": 3, "name": "t2_VM3", "vcpu": 2, "vmif": "t2VM3if1"}], "warnings": ["'xml' is given - ignoring 'name'"]}

TASK [Create VM] ********************************************************************************************************************************************
ok: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.11.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.2.11.1', u'bridge_name': u't2br1', u'dns': [{u'dnsif': u't2s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't2s1_dnsbrif'}], u'ns_name': u't2ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.11.2/24', u'tenant_ns_ip': u'10.2.11.1/24', u'tenant_ns_if': u't2ns1if', u'tenant_sub_if': u't2s1if', u'tenant_ns_name': u't2'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.2.11.2', u'dsport': 4789, u'dev': u't2s1if', u'tenant_route_ip': u'192.168.130.2', u'remote_route': u'10.1.11.0/24', u'subnet_route': u'10.2.11.0/24', u'v_name': u'vxlan_t2s1', u'id': 42, u'remote_ip': u'10.1.11.2'}]}, {u'mem': 2, u'name': u't2_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't2br1if1', u'vmif': u't2VM4if1'}]) => {"ansible_loop_var": "item", "changed": false, "create": 0, "item": [{"bridge_name": "t2br1", "default_route_ip": "10.2.11.1", "dns": [{"brif": "t2s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.5", "dnsif": "t2s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns1", "route": [{"if": "p1", "ip": "10.2.11.1/24", "ns_if": "t2if", "ns_name": "t2"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t2ns1if", "tenant_ns_ip": "10.2.11.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s1if", "tenant_sub_ip": "10.2.11.2/24"}], "vxlan": [{"dev": "t2s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.11.2", "remote_ip": "10.1.11.2", "remote_route": "10.1.11.0/24", "subnet_route": "10.2.11.0/24", "tenant_route_ip": "192.168.130.2", "v_name": "vxlan_t2s1"}]}, {"brif": "t2br1if1", "disk": "10G", "mem": 2, "name": "t2_VM4", "vcpu": 4, "vmif": "t2VM4if1"}]}
ok: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.12.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.2.12.1', u'bridge_name': u't2br2', u'dns': [{u'dnsif': u't2s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't2s2_dnsbrif'}], u'ns_name': u't2ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.12.2/24', u'tenant_ns_ip': u'10.2.12.1/24', u'tenant_ns_if': u't2ns2if', u'tenant_sub_if': u't2s2if', u'tenant_ns_name': u't2'}], u'subnet_ip': u'2.2.2.0/24', u'vxlan': [{u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}, {u'mem': 3, u'name': u't2_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't2br2if1', u'vmif': u't2VM3if1'}]) => {"ansible_loop_var": "item", "changed": false, "create": 0, "item": [{"bridge_name": "t2br2", "default_route_ip": "10.2.12.1", "dns": [{"brif": "t2s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t2s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns2", "route": [{"if": "p1", "ip": "10.2.12.1/24", "ns_if": "t2if", "ns_name": "t2"}], "subnet_ip": "2.2.2.0/24", "tenant_ns": [{"tenant_ns_if": "t2ns2if", "tenant_ns_ip": "10.2.12.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s2if", "tenant_sub_ip": "10.2.12.2/24"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, {"brif": "t2br2if1", "disk": "10G", "mem": 3, "name": "t2_VM3", "vcpu": 2, "vmif": "t2VM3if1"}]}

TASK [Start VM] *********************************************************************************************************************************************
ok: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.11.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.2.11.1', u'bridge_name': u't2br1', u'dns': [{u'dnsif': u't2s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't2s1_dnsbrif'}], u'ns_name': u't2ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.11.2/24', u'tenant_ns_ip': u'10.2.11.1/24', u'tenant_ns_if': u't2ns1if', u'tenant_sub_if': u't2s1if', u'tenant_ns_name': u't2'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.2.11.2', u'dsport': 4789, u'dev': u't2s1if', u'tenant_route_ip': u'192.168.130.2', u'remote_route': u'10.1.11.0/24', u'subnet_route': u'10.2.11.0/24', u'v_name': u'vxlan_t2s1', u'id': 42, u'remote_ip': u'10.1.11.2'}]}, {u'mem': 2, u'name': u't2_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't2br1if1', u'vmif': u't2VM4if1'}]) => {"ansible_loop_var": "item", "changed": false, "item": [{"bridge_name": "t2br1", "default_route_ip": "10.2.11.1", "dns": [{"brif": "t2s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.5", "dnsif": "t2s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns1", "route": [{"if": "p1", "ip": "10.2.11.1/24", "ns_if": "t2if", "ns_name": "t2"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t2ns1if", "tenant_ns_ip": "10.2.11.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s1if", "tenant_sub_ip": "10.2.11.2/24"}], "vxlan": [{"dev": "t2s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.11.2", "remote_ip": "10.1.11.2", "remote_route": "10.1.11.0/24", "subnet_route": "10.2.11.0/24", "tenant_route_ip": "192.168.130.2", "v_name": "vxlan_t2s1"}]}, {"brif": "t2br1if1", "disk": "10G", "mem": 2, "name": "t2_VM4", "vcpu": 4, "vmif": "t2VM4if1"}]}
ok: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.12.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.2.12.1', u'bridge_name': u't2br2', u'dns': [{u'dnsif': u't2s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't2s2_dnsbrif'}], u'ns_name': u't2ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.12.2/24', u'tenant_ns_ip': u'10.2.12.1/24', u'tenant_ns_if': u't2ns2if', u'tenant_sub_if': u't2s2if', u'tenant_ns_name': u't2'}], u'subnet_ip': u'2.2.2.0/24', u'vxlan': [{u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}, {u'mem': 3, u'name': u't2_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't2br2if1', u'vmif': u't2VM3if1'}]) => {"ansible_loop_var": "item", "changed": false, "item": [{"bridge_name": "t2br2", "default_route_ip": "10.2.12.1", "dns": [{"brif": "t2s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t2s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns2", "route": [{"if": "p1", "ip": "10.2.12.1/24", "ns_if": "t2if", "ns_name": "t2"}], "subnet_ip": "2.2.2.0/24", "tenant_ns": [{"tenant_ns_if": "t2ns2if", "tenant_ns_ip": "10.2.12.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s2if", "tenant_sub_ip": "10.2.12.2/24"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, {"brif": "t2br2if1", "disk": "10G", "mem": 3, "name": "t2_VM3", "vcpu": 2, "vmif": "t2VM3if1"}]}

TASK [Attach VM interface] **********************************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.11.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.2.11.1', u'bridge_name': u't2br1', u'dns': [{u'dnsif': u't2s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't2s1_dnsbrif'}], u'ns_name': u't2ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.11.2/24', u'tenant_ns_ip': u'10.2.11.1/24', u'tenant_ns_if': u't2ns1if', u'tenant_sub_if': u't2s1if', u'tenant_ns_name': u't2'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.2.11.2', u'dsport': 4789, u'dev': u't2s1if', u'tenant_route_ip': u'192.168.130.2', u'remote_route': u'10.1.11.0/24', u'subnet_route': u'10.2.11.0/24', u'v_name': u'vxlan_t2s1', u'id': 42, u'remote_ip': u'10.1.11.2'}]}, {u'mem': 2, u'name': u't2_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't2br1if1', u'vmif': u't2VM4if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "virsh domiflist \"t2_VM4\" | grep -w 't2VM4if1' ; if [ $? -ne 0 ] ; then virsh attach-interface \"t2_VM4\" direct \"t2VM4if1\" --live --persistent ; fi\n", "delta": "0:00:00.344117", "end": "2019-12-05 17:23:55.581719", "item": [{"bridge_name": "t2br1", "default_route_ip": "10.2.11.1", "dns": [{"brif": "t2s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.5", "dnsif": "t2s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns1", "route": [{"if": "p1", "ip": "10.2.11.1/24", "ns_if": "t2if", "ns_name": "t2"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t2ns1if", "tenant_ns_ip": "10.2.11.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s1if", "tenant_sub_ip": "10.2.11.2/24"}], "vxlan": [{"dev": "t2s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.11.2", "remote_ip": "10.1.11.2", "remote_route": "10.1.11.0/24", "subnet_route": "10.2.11.0/24", "tenant_route_ip": "192.168.130.2", "v_name": "vxlan_t2s1"}]}, {"brif": "t2br1if1", "disk": "10G", "mem": 2, "name": "t2_VM4", "vcpu": 4, "vmif": "t2VM4if1"}], "rc": 0, "start": "2019-12-05 17:23:55.237602", "stderr": "", "stderr_lines": [], "stdout": "Interface attached successfully", "stdout_lines": ["Interface attached successfully"]}
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.12.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.2.12.1', u'bridge_name': u't2br2', u'dns': [{u'dnsif': u't2s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't2s2_dnsbrif'}], u'ns_name': u't2ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.12.2/24', u'tenant_ns_ip': u'10.2.12.1/24', u'tenant_ns_if': u't2ns2if', u'tenant_sub_if': u't2s2if', u'tenant_ns_name': u't2'}], u'subnet_ip': u'2.2.2.0/24', u'vxlan': [{u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}, {u'mem': 3, u'name': u't2_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't2br2if1', u'vmif': u't2VM3if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "virsh domiflist \"t2_VM3\" | grep -w 't2VM3if1' ; if [ $? -ne 0 ] ; then virsh attach-interface \"t2_VM3\" direct \"t2VM3if1\" --live --persistent ; fi\n", "delta": "0:00:00.263837", "end": "2019-12-05 17:23:56.123687", "item": [{"bridge_name": "t2br2", "default_route_ip": "10.2.12.1", "dns": [{"brif": "t2s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t2s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns2", "route": [{"if": "p1", "ip": "10.2.12.1/24", "ns_if": "t2if", "ns_name": "t2"}], "subnet_ip": "2.2.2.0/24", "tenant_ns": [{"tenant_ns_if": "t2ns2if", "tenant_ns_ip": "10.2.12.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s2if", "tenant_sub_ip": "10.2.12.2/24"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, {"brif": "t2br2if1", "disk": "10G", "mem": 3, "name": "t2_VM3", "vcpu": 2, "vmif": "t2VM3if1"}], "rc": 0, "start": "2019-12-05 17:23:55.859850", "stderr": "", "stderr_lines": [], "stdout": "Interface attached successfully", "stdout_lines": ["Interface attached successfully"]}

PLAY RECAP **************************************************************************************************************************************************
99.99.99.2                 : ok=6    changed=3    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0   

INFO:root: 17:41:30.427467 Printing the yaml input file
INFO:root: 17:41:30.427672 {'C1': [{'VM': [{'disk': '10G', 'internet_access': True, 'mem': 2, 'name': 'VM1', 'vcpu': 4}, {'disk': '10G', 'internet_access': False, 'mem': 4, 'name': 'VM2', 'vcpu': 2}], 'subnet_addr': '1.1.1.0/24'}], 'C2': [{'VM': [{'disk': '10G', 'internet_access': True, 'mem': 2, 'name': 'VM4', 'vcpu': 4}], 'subnet_addr': '1.1.1.0/24'}, {'VM': [{'disk': '10G', 'internet_access': True, 'mem': 3, 'name': 'VM3', 'vcpu': 2}], 'subnet_addr': '2.2.2.0/24'}], 'MISC': [{'LOG_ENABLE': True}, {'GUI': True}]}
INFO:root: 17:41:30.427795 Provided subnet in C1: 1.1.1.0/24 is valid
INFO:root: 17:41:30.427847 Provided subnet in C2: 1.1.1.0/24 is valid
INFO:root: 17:41:30.427889 Provided subnet in C2: 2.2.2.0/24 is valid
Using /etc/ansible/ansible.cfg as config file

PLAY [main] *************************************************************************************************************************************************

TASK [Create Tenant Namespace] ******************************************************************************************************************************
changed: [localhost] => (item={u'default_route_ip': u'192.168.3.1', u'name': u't3', u'pns_ip': u'192.168.3.1/24', u'tenant_if': u't3if', u'tenant_ip': u'192.168.3.2/24', u'pns_if': u't3pns_if'}) => {"ansible_loop_var": "item", "changed": true, "cmd": ["ip", "netns", "add", "t3"], "delta": "0:00:00.054646", "end": "2019-12-05 17:41:31.772004", "item": {"default_route_ip": "192.168.3.1", "name": "t3", "pns_if": "t3pns_if", "pns_ip": "192.168.3.1/24", "tenant_if": "t3if", "tenant_ip": "192.168.3.2/24"}, "rc": 0, "start": "2019-12-05 17:41:31.717358", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Create Subnet Namespace] ******************************************************************************************************************************
changed: [localhost] => (item={u'route': [{u'ip': u'10.1.21.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.1.21.1', u'bridge_name': u't3br1', u'dns': [{u'dnsif': u't3s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't3s1_dnsbrif'}], u'ns_name': u't3ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.21.2/24', u'tenant_ns_ip': u'10.1.21.1/24', u'tenant_ns_if': u't3ns1if', u'tenant_ns_name': u't3', u'tenant_sub_if': u't3s1if'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't3_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't3br1if1', u'vmif': u't3VM1if1'}, {u'mem': 4, u'name': u't3_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't3br1if2', u'vmif': u't3VM2if1'}], u'vxlan': [{u'local_ip': u'10.1.21.2', u'tenant_route_ip': u'192.168.3.2', u'dsport': 4789, u'dev': u't3s1if', u'subnet_route': u'10.1.21.0/24', u'remote_route': u'10.2.21.0/24', u'v_name': u'vxlan_t3s1', u'id': 42, u'remote_ip': u'10.2.21.2'}]}) => {"ansible_loop_var": "item", "changed": true, "cmd": ["ip", "netns", "add", "t3ns1"], "delta": "0:00:00.054785", "end": "2019-12-05 17:41:32.135264", "item": {"bridge_name": "t3br1", "default_route_ip": "10.1.21.1", "dns": [{"brif": "t3s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.5", "dnsif": "t3s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t3ns1", "route": [{"if": "p1", "ip": "10.1.21.1/24", "ns_if": "t3if", "ns_name": "t3"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t3ns1if", "tenant_ns_ip": "10.1.21.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s1if", "tenant_sub_ip": "10.1.21.2/24"}], "vms": [{"brif": "t3br1if1", "disk": "10G", "mem": 2, "name": "t3_VM1", "vcpu": 4, "vmif": "t3VM1if1"}, {"brif": "t3br1if2", "disk": "10G", "mem": 4, "name": "t3_VM2", "vcpu": 2, "vmif": "t3VM2if1"}], "vxlan": [{"dev": "t3s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.21.2", "remote_ip": "10.2.21.2", "remote_route": "10.2.21.0/24", "subnet_route": "10.1.21.0/24", "tenant_route_ip": "192.168.3.2", "v_name": "vxlan_t3s1"}]}, "rc": 0, "start": "2019-12-05 17:41:32.080479", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Create Tenant VETH pairs] *****************************************************************************************************************************
changed: [localhost] => (item={u'default_route_ip': u'192.168.3.1', u'name': u't3', u'pns_ip': u'192.168.3.1/24', u'tenant_if': u't3if', u'tenant_ip': u'192.168.3.2/24', u'pns_if': u't3pns_if'}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip link show \"t3if\" ; if [ $? -ne 0 ] ; then ip link add \"t3if\" type veth peer name \"t3pns_if\" ; fi\n", "delta": "0:00:00.030122", "end": "2019-12-05 17:41:32.453733", "item": {"default_route_ip": "192.168.3.1", "name": "t3", "pns_if": "t3pns_if", "pns_ip": "192.168.3.1/24", "tenant_if": "t3if", "tenant_ip": "192.168.3.2/24"}, "rc": 0, "start": "2019-12-05 17:41:32.423611", "stderr": "Device \"t3if\" does not exist.", "stderr_lines": ["Device \"t3if\" does not exist."], "stdout": "", "stdout_lines": []}

TASK [Attach Tenant VETH Pairs] *****************************************************************************************************************************
changed: [localhost] => (item={u'default_route_ip': u'192.168.3.1', u'name': u't3', u'pns_ip': u'192.168.3.1/24', u'tenant_if': u't3if', u'tenant_ip': u'192.168.3.2/24', u'pns_if': u't3pns_if'}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec pns ip link show \"t3pns_if\" ; if [ $? -ne 0 ] ; then ip link set \"t3pns_if\" netns pns ; fi\nip netns exec \"t3\" ip link show \"t3if\" ; if [ $? -ne 0 ] ; then ip link set \"t3if\" netns \"t3\" ; fi\nip netns exec pns ip link set dev \"t3pns_if\" up\nip netns exec \"t3\" ip link set dev \"t3if\" up\n", "delta": "0:00:00.196122", "end": "2019-12-05 17:41:32.954811", "item": {"default_route_ip": "192.168.3.1", "name": "t3", "pns_if": "t3pns_if", "pns_ip": "192.168.3.1/24", "tenant_if": "t3if", "tenant_ip": "192.168.3.2/24"}, "rc": 0, "start": "2019-12-05 17:41:32.758689", "stderr": "Device \"t3pns_if\" does not exist.\nDevice \"t3if\" does not exist.", "stderr_lines": ["Device \"t3pns_if\" does not exist.", "Device \"t3if\" does not exist."], "stdout": "", "stdout_lines": []}

TASK [Add IP addresses to Tenant VETH Pairs] ****************************************************************************************************************
changed: [localhost] => (item={u'default_route_ip': u'192.168.3.1', u'name': u't3', u'pns_ip': u'192.168.3.1/24', u'tenant_if': u't3if', u'tenant_ip': u'192.168.3.2/24', u'pns_if': u't3pns_if'}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec pns ip addr show \"t3pns_if\" | awk 'FNR==3{ print $2 }' | grep -w '^192.168.3.1/24' ; if [ $? -ne 0 ] ; then ip netns exec pns ip addr add \"192.168.3.1/24\" dev \"t3pns_if\" ; fi\nip netns exec \"t3\" ip addr show \"t3if\" | awk 'FNR==3{ print $2 }' | grep -w '^192.168.3.2/24' ; if [ $? -ne 0 ] ; then ip netns exec \"t3\" ip addr add \"192.168.3.2/24\" dev \"t3if\" ; fi\n", "delta": "0:00:00.150752", "end": "2019-12-05 17:41:33.390937", "item": {"default_route_ip": "192.168.3.1", "name": "t3", "pns_if": "t3pns_if", "pns_ip": "192.168.3.1/24", "tenant_if": "t3if", "tenant_ip": "192.168.3.2/24"}, "rc": 0, "start": "2019-12-05 17:41:33.240185", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Create Namespace VETH Pairs] **************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.21.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.1.21.1', u'bridge_name': u't3br1', u'dns': [{u'dnsif': u't3s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't3s1_dnsbrif'}], u'ns_name': u't3ns1', u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't3_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't3br1if1', u'vmif': u't3VM1if1'}, {u'mem': 4, u'name': u't3_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't3br1if2', u'vmif': u't3VM2if1'}], u'vxlan': [{u'local_ip': u'10.1.21.2', u'dsport': 4789, u'dev': u't3s1if', u'tenant_route_ip': u'192.168.3.2', u'remote_route': u'10.2.21.0/24', u'subnet_route': u'10.1.21.0/24', u'v_name': u'vxlan_t3s1', u'id': 42, u'remote_ip': u'10.2.21.2'}]}, {u'tenant_sub_ip': u'10.1.21.2/24', u'tenant_ns_ip': u'10.1.21.1/24', u'tenant_ns_if': u't3ns1if', u'tenant_sub_if': u't3s1if', u'tenant_ns_name': u't3'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip link show \"t3ns1if\" ; if [ $? -ne 0 ] ; then ip link add \"t3ns1if\" type veth peer name \"t3s1if\" ; fi\n", "delta": "0:00:00.012830", "end": "2019-12-05 17:41:33.702284", "item": [{"bridge_name": "t3br1", "default_route_ip": "10.1.21.1", "dns": [{"brif": "t3s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.5", "dnsif": "t3s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t3ns1", "route": [{"if": "p1", "ip": "10.1.21.1/24", "ns_if": "t3if", "ns_name": "t3"}], "subnet_ip": "1.1.1.0/24", "vms": [{"brif": "t3br1if1", "disk": "10G", "mem": 2, "name": "t3_VM1", "vcpu": 4, "vmif": "t3VM1if1"}, {"brif": "t3br1if2", "disk": "10G", "mem": 4, "name": "t3_VM2", "vcpu": 2, "vmif": "t3VM2if1"}], "vxlan": [{"dev": "t3s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.21.2", "remote_ip": "10.2.21.2", "remote_route": "10.2.21.0/24", "subnet_route": "10.1.21.0/24", "tenant_route_ip": "192.168.3.2", "v_name": "vxlan_t3s1"}]}, {"tenant_ns_if": "t3ns1if", "tenant_ns_ip": "10.1.21.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s1if", "tenant_sub_ip": "10.1.21.2/24"}], "rc": 0, "start": "2019-12-05 17:41:33.689454", "stderr": "Device \"t3ns1if\" does not exist.", "stderr_lines": ["Device \"t3ns1if\" does not exist."], "stdout": "", "stdout_lines": []}

TASK [Attach Namespace VETH Pairs] **************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.21.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.1.21.1', u'bridge_name': u't3br1', u'dns': [{u'dnsif': u't3s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't3s1_dnsbrif'}], u'ns_name': u't3ns1', u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't3_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't3br1if1', u'vmif': u't3VM1if1'}, {u'mem': 4, u'name': u't3_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't3br1if2', u'vmif': u't3VM2if1'}], u'vxlan': [{u'local_ip': u'10.1.21.2', u'dsport': 4789, u'dev': u't3s1if', u'tenant_route_ip': u'192.168.3.2', u'remote_route': u'10.2.21.0/24', u'subnet_route': u'10.1.21.0/24', u'v_name': u'vxlan_t3s1', u'id': 42, u'remote_ip': u'10.2.21.2'}]}, {u'tenant_sub_ip': u'10.1.21.2/24', u'tenant_ns_ip': u'10.1.21.1/24', u'tenant_ns_if': u't3ns1if', u'tenant_sub_if': u't3s1if', u'tenant_ns_name': u't3'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t3\" ip link show \"t3ns1if\" ; if [ $? -ne 0 ] ; then ip link set \"t3ns1if\" netns \"t3\" ; fi\nip netns exec \"t3ns1\" ip link show \"t3s1if\" ; if [ $? -ne 0 ] ; then ip link set \"t3s1if\" netns \"t3ns1\" ; fi\n", "delta": "0:00:00.150075", "end": "2019-12-05 17:41:34.177311", "item": [{"bridge_name": "t3br1", "default_route_ip": "10.1.21.1", "dns": [{"brif": "t3s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.5", "dnsif": "t3s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t3ns1", "route": [{"if": "p1", "ip": "10.1.21.1/24", "ns_if": "t3if", "ns_name": "t3"}], "subnet_ip": "1.1.1.0/24", "vms": [{"brif": "t3br1if1", "disk": "10G", "mem": 2, "name": "t3_VM1", "vcpu": 4, "vmif": "t3VM1if1"}, {"brif": "t3br1if2", "disk": "10G", "mem": 4, "name": "t3_VM2", "vcpu": 2, "vmif": "t3VM2if1"}], "vxlan": [{"dev": "t3s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.21.2", "remote_ip": "10.2.21.2", "remote_route": "10.2.21.0/24", "subnet_route": "10.1.21.0/24", "tenant_route_ip": "192.168.3.2", "v_name": "vxlan_t3s1"}]}, {"tenant_ns_if": "t3ns1if", "tenant_ns_ip": "10.1.21.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s1if", "tenant_sub_ip": "10.1.21.2/24"}], "rc": 0, "start": "2019-12-05 17:41:34.027236", "stderr": "Device \"t3ns1if\" does not exist.\nDevice \"t3s1if\" does not exist.", "stderr_lines": ["Device \"t3ns1if\" does not exist.", "Device \"t3s1if\" does not exist."], "stdout": "", "stdout_lines": []}

TASK [Set Namespace VETH Pairs UP] **************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.21.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.1.21.1', u'bridge_name': u't3br1', u'dns': [{u'dnsif': u't3s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't3s1_dnsbrif'}], u'ns_name': u't3ns1', u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't3_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't3br1if1', u'vmif': u't3VM1if1'}, {u'mem': 4, u'name': u't3_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't3br1if2', u'vmif': u't3VM2if1'}], u'vxlan': [{u'local_ip': u'10.1.21.2', u'dsport': 4789, u'dev': u't3s1if', u'tenant_route_ip': u'192.168.3.2', u'remote_route': u'10.2.21.0/24', u'subnet_route': u'10.1.21.0/24', u'v_name': u'vxlan_t3s1', u'id': 42, u'remote_ip': u'10.2.21.2'}]}, {u'tenant_sub_ip': u'10.1.21.2/24', u'tenant_ns_ip': u'10.1.21.1/24', u'tenant_ns_if': u't3ns1if', u'tenant_sub_if': u't3s1if', u'tenant_ns_name': u't3'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t3\" ip link set dev \"t3ns1if\" up\nip netns exec \"t3ns1\" ip link set dev \"t3s1if\" up\n", "delta": "0:00:00.089862", "end": "2019-12-05 17:41:34.582841", "item": [{"bridge_name": "t3br1", "default_route_ip": "10.1.21.1", "dns": [{"brif": "t3s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.5", "dnsif": "t3s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t3ns1", "route": [{"if": "p1", "ip": "10.1.21.1/24", "ns_if": "t3if", "ns_name": "t3"}], "subnet_ip": "1.1.1.0/24", "vms": [{"brif": "t3br1if1", "disk": "10G", "mem": 2, "name": "t3_VM1", "vcpu": 4, "vmif": "t3VM1if1"}, {"brif": "t3br1if2", "disk": "10G", "mem": 4, "name": "t3_VM2", "vcpu": 2, "vmif": "t3VM2if1"}], "vxlan": [{"dev": "t3s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.21.2", "remote_ip": "10.2.21.2", "remote_route": "10.2.21.0/24", "subnet_route": "10.1.21.0/24", "tenant_route_ip": "192.168.3.2", "v_name": "vxlan_t3s1"}]}, {"tenant_ns_if": "t3ns1if", "tenant_ns_ip": "10.1.21.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s1if", "tenant_sub_ip": "10.1.21.2/24"}], "rc": 0, "start": "2019-12-05 17:41:34.492979", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Add IP addresses to Namespace VETH Pairs] *************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.21.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.1.21.1', u'bridge_name': u't3br1', u'dns': [{u'dnsif': u't3s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't3s1_dnsbrif'}], u'ns_name': u't3ns1', u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't3_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't3br1if1', u'vmif': u't3VM1if1'}, {u'mem': 4, u'name': u't3_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't3br1if2', u'vmif': u't3VM2if1'}], u'vxlan': [{u'local_ip': u'10.1.21.2', u'dsport': 4789, u'dev': u't3s1if', u'tenant_route_ip': u'192.168.3.2', u'remote_route': u'10.2.21.0/24', u'subnet_route': u'10.1.21.0/24', u'v_name': u'vxlan_t3s1', u'id': 42, u'remote_ip': u'10.2.21.2'}]}, {u'tenant_sub_ip': u'10.1.21.2/24', u'tenant_ns_ip': u'10.1.21.1/24', u'tenant_ns_if': u't3ns1if', u'tenant_sub_if': u't3s1if', u'tenant_ns_name': u't3'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t3ns1\" ip addr show \"t3s1if\" | awk 'FNR==3{ print $2 }' | grep -w '^10.1.21.2/24' ; if [ $? -ne 0 ] ; then ip netns exec \"t3ns1\" ip addr add \"10.1.21.2/24\" dev \"t3s1if\" ; fi\n\nip netns exec \"t3\" ip addr show \"t3ns1if\" | awk 'FNR==3{ print $2 }' | grep -w '^10.1.21.1/24' ; if [ $? -ne 0 ] ; then ip netns exec \"t3\" ip addr add \"10.1.21.1/24\" dev \"t3ns1if\" ; fi\n", "delta": "0:00:00.153756", "end": "2019-12-05 17:41:35.018767", "item": [{"bridge_name": "t3br1", "default_route_ip": "10.1.21.1", "dns": [{"brif": "t3s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.5", "dnsif": "t3s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t3ns1", "route": [{"if": "p1", "ip": "10.1.21.1/24", "ns_if": "t3if", "ns_name": "t3"}], "subnet_ip": "1.1.1.0/24", "vms": [{"brif": "t3br1if1", "disk": "10G", "mem": 2, "name": "t3_VM1", "vcpu": 4, "vmif": "t3VM1if1"}, {"brif": "t3br1if2", "disk": "10G", "mem": 4, "name": "t3_VM2", "vcpu": 2, "vmif": "t3VM2if1"}], "vxlan": [{"dev": "t3s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.21.2", "remote_ip": "10.2.21.2", "remote_route": "10.2.21.0/24", "subnet_route": "10.1.21.0/24", "tenant_route_ip": "192.168.3.2", "v_name": "vxlan_t3s1"}]}, {"tenant_ns_if": "t3ns1if", "tenant_ns_ip": "10.1.21.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s1if", "tenant_sub_ip": "10.1.21.2/24"}], "rc": 0, "start": "2019-12-05 17:41:34.865011", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Add IP Route to Tenant] *******************************************************************************************************************************
changed: [localhost] => (item={u'default_route_ip': u'192.168.3.1', u'name': u't3', u'pns_ip': u'192.168.3.1/24', u'tenant_if': u't3if', u'tenant_ip': u'192.168.3.2/24', u'pns_if': u't3pns_if'}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t3\" ip route show default | grep -w '[d]efault via 192.168.3.1' ; if [ $? -ne 0 ] ; then ip netns exec \"t3\" ip route add default via \"192.168.3.1\" ; fi\n", "delta": "0:00:00.075875", "end": "2019-12-05 17:41:35.382692", "item": {"default_route_ip": "192.168.3.1", "name": "t3", "pns_if": "t3pns_if", "pns_ip": "192.168.3.1/24", "tenant_if": "t3if", "tenant_ip": "192.168.3.2/24"}, "rc": 0, "start": "2019-12-05 17:41:35.306817", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Add IP Route to Tenant Subnet] ************************************************************************************************************************
changed: [localhost] => (item={u'route': [{u'ip': u'10.1.21.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.1.21.1', u'bridge_name': u't3br1', u'dns': [{u'dnsif': u't3s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't3s1_dnsbrif'}], u'ns_name': u't3ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.21.2/24', u'tenant_ns_ip': u'10.1.21.1/24', u'tenant_ns_if': u't3ns1if', u'tenant_ns_name': u't3', u'tenant_sub_if': u't3s1if'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't3_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't3br1if1', u'vmif': u't3VM1if1'}, {u'mem': 4, u'name': u't3_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't3br1if2', u'vmif': u't3VM2if1'}], u'vxlan': [{u'local_ip': u'10.1.21.2', u'tenant_route_ip': u'192.168.3.2', u'dsport': 4789, u'dev': u't3s1if', u'subnet_route': u'10.1.21.0/24', u'remote_route': u'10.2.21.0/24', u'v_name': u'vxlan_t3s1', u'id': 42, u'remote_ip': u'10.2.21.2'}]}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t3ns1\" ip route show default | grep -w '[d]efault via 10.1.21.1' ; if [ $? -ne 0 ] ; then ip netns exec \"t3ns1\" ip route add default via \"10.1.21.1\" ; fi\n", "delta": "0:00:00.078910", "end": "2019-12-05 17:41:35.762810", "item": {"bridge_name": "t3br1", "default_route_ip": "10.1.21.1", "dns": [{"brif": "t3s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.5", "dnsif": "t3s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t3ns1", "route": [{"if": "p1", "ip": "10.1.21.1/24", "ns_if": "t3if", "ns_name": "t3"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t3ns1if", "tenant_ns_ip": "10.1.21.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s1if", "tenant_sub_ip": "10.1.21.2/24"}], "vms": [{"brif": "t3br1if1", "disk": "10G", "mem": 2, "name": "t3_VM1", "vcpu": 4, "vmif": "t3VM1if1"}, {"brif": "t3br1if2", "disk": "10G", "mem": 4, "name": "t3_VM2", "vcpu": 2, "vmif": "t3VM2if1"}], "vxlan": [{"dev": "t3s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.21.2", "remote_ip": "10.2.21.2", "remote_route": "10.2.21.0/24", "subnet_route": "10.1.21.0/24", "tenant_route_ip": "192.168.3.2", "v_name": "vxlan_t3s1"}]}, "rc": 0, "start": "2019-12-05 17:41:35.683900", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Create bridge inside namespace] ***********************************************************************************************************************
changed: [localhost] => (item={u'route': [{u'ip': u'10.1.21.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.1.21.1', u'bridge_name': u't3br1', u'dns': [{u'dnsif': u't3s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't3s1_dnsbrif'}], u'ns_name': u't3ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.21.2/24', u'tenant_ns_ip': u'10.1.21.1/24', u'tenant_ns_if': u't3ns1if', u'tenant_ns_name': u't3', u'tenant_sub_if': u't3s1if'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't3_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't3br1if1', u'vmif': u't3VM1if1'}, {u'mem': 4, u'name': u't3_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't3br1if2', u'vmif': u't3VM2if1'}], u'vxlan': [{u'local_ip': u'10.1.21.2', u'tenant_route_ip': u'192.168.3.2', u'dsport': 4789, u'dev': u't3s1if', u'subnet_route': u'10.1.21.0/24', u'remote_route': u'10.2.21.0/24', u'v_name': u'vxlan_t3s1', u'id': 42, u'remote_ip': u'10.2.21.2'}]}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t3ns1\" brctl show | grep -w '^t3br1'; if [ $? -ne 0 ] ; then ip netns exec \"t3ns1\" brctl addbr \"t3br1\" ; fi\nip netns exec \"t3ns1\" ip link set dev \"t3br1\" up\n", "delta": "0:00:00.128120", "end": "2019-12-05 17:41:36.194999", "item": {"bridge_name": "t3br1", "default_route_ip": "10.1.21.1", "dns": [{"brif": "t3s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.5", "dnsif": "t3s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t3ns1", "route": [{"if": "p1", "ip": "10.1.21.1/24", "ns_if": "t3if", "ns_name": "t3"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t3ns1if", "tenant_ns_ip": "10.1.21.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s1if", "tenant_sub_ip": "10.1.21.2/24"}], "vms": [{"brif": "t3br1if1", "disk": "10G", "mem": 2, "name": "t3_VM1", "vcpu": 4, "vmif": "t3VM1if1"}, {"brif": "t3br1if2", "disk": "10G", "mem": 4, "name": "t3_VM2", "vcpu": 2, "vmif": "t3VM2if1"}], "vxlan": [{"dev": "t3s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.21.2", "remote_ip": "10.2.21.2", "remote_route": "10.2.21.0/24", "subnet_route": "10.1.21.0/24", "tenant_route_ip": "192.168.3.2", "v_name": "vxlan_t3s1"}]}, "rc": 0, "start": "2019-12-05 17:41:36.066879", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Create DNS VETH Pair] *********************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.21.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.1.21.1', u'bridge_name': u't3br1', u'ns_name': u't3ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.21.2/24', u'tenant_ns_ip': u'10.1.21.1/24', u'tenant_ns_if': u't3ns1if', u'tenant_sub_if': u't3s1if', u'tenant_ns_name': u't3'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't3_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't3br1if1', u'vmif': u't3VM1if1'}, {u'mem': 4, u'name': u't3_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't3br1if2', u'vmif': u't3VM2if1'}], u'vxlan': [{u'local_ip': u'10.1.21.2', u'dsport': 4789, u'dev': u't3s1if', u'tenant_route_ip': u'192.168.3.2', u'remote_route': u'10.2.21.0/24', u'subnet_route': u'10.1.21.0/24', u'v_name': u'vxlan_t3s1', u'id': 42, u'remote_ip': u'10.2.21.2'}]}, {u'dnsif': u't3s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't3s1_dnsbrif'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t3ns1\" ip link show \"t3s1_dnsbrif\" ; if [ $? -ne 0 ] ; then ip netns exec \"t3ns1\" ip link add \"t3s1_dnsbrif\" type veth peer name \"t3s1_dnsif\" ; fi\nip netns exec \"t3ns1\" ip link set dev \"t3s1_dnsbrif\" up\nip netns exec \"t3ns1\" ip link set dev \"t3s1_dnsif\" up\n", "delta": "0:00:00.175766", "end": "2019-12-05 17:41:36.706871", "item": [{"bridge_name": "t3br1", "default_route_ip": "10.1.21.1", "ns_name": "t3ns1", "route": [{"if": "p1", "ip": "10.1.21.1/24", "ns_if": "t3if", "ns_name": "t3"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t3ns1if", "tenant_ns_ip": "10.1.21.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s1if", "tenant_sub_ip": "10.1.21.2/24"}], "vms": [{"brif": "t3br1if1", "disk": "10G", "mem": 2, "name": "t3_VM1", "vcpu": 4, "vmif": "t3VM1if1"}, {"brif": "t3br1if2", "disk": "10G", "mem": 4, "name": "t3_VM2", "vcpu": 2, "vmif": "t3VM2if1"}], "vxlan": [{"dev": "t3s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.21.2", "remote_ip": "10.2.21.2", "remote_route": "10.2.21.0/24", "subnet_route": "10.1.21.0/24", "tenant_route_ip": "192.168.3.2", "v_name": "vxlan_t3s1"}]}, {"brif": "t3s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.5", "dnsif": "t3s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "rc": 0, "start": "2019-12-05 17:41:36.531105", "stderr": "Device \"t3s1_dnsbrif\" does not exist.", "stderr_lines": ["Device \"t3s1_dnsbrif\" does not exist."], "stdout": "", "stdout_lines": []}

TASK [Attach DNS VETH Pair] *********************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.21.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.1.21.1', u'bridge_name': u't3br1', u'ns_name': u't3ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.21.2/24', u'tenant_ns_ip': u'10.1.21.1/24', u'tenant_ns_if': u't3ns1if', u'tenant_sub_if': u't3s1if', u'tenant_ns_name': u't3'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't3_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't3br1if1', u'vmif': u't3VM1if1'}, {u'mem': 4, u'name': u't3_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't3br1if2', u'vmif': u't3VM2if1'}], u'vxlan': [{u'local_ip': u'10.1.21.2', u'dsport': 4789, u'dev': u't3s1if', u'tenant_route_ip': u'192.168.3.2', u'remote_route': u'10.2.21.0/24', u'subnet_route': u'10.1.21.0/24', u'v_name': u'vxlan_t3s1', u'id': 42, u'remote_ip': u'10.2.21.2'}]}, {u'dnsif': u't3s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't3s1_dnsbrif'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t3ns1\" brctl show \"t3br1\" | grep -w 't3s1_dnsbrif' ; if [ $? -ne 0 ] ; then ip netns exec \"t3ns1\" brctl addif \"t3br1\" \"t3s1_dnsbrif\" ; fi\n", "delta": "0:00:00.095165", "end": "2019-12-05 17:41:37.150965", "item": [{"bridge_name": "t3br1", "default_route_ip": "10.1.21.1", "ns_name": "t3ns1", "route": [{"if": "p1", "ip": "10.1.21.1/24", "ns_if": "t3if", "ns_name": "t3"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t3ns1if", "tenant_ns_ip": "10.1.21.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s1if", "tenant_sub_ip": "10.1.21.2/24"}], "vms": [{"brif": "t3br1if1", "disk": "10G", "mem": 2, "name": "t3_VM1", "vcpu": 4, "vmif": "t3VM1if1"}, {"brif": "t3br1if2", "disk": "10G", "mem": 4, "name": "t3_VM2", "vcpu": 2, "vmif": "t3VM2if1"}], "vxlan": [{"dev": "t3s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.21.2", "remote_ip": "10.2.21.2", "remote_route": "10.2.21.0/24", "subnet_route": "10.1.21.0/24", "tenant_route_ip": "192.168.3.2", "v_name": "vxlan_t3s1"}]}, {"brif": "t3s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.5", "dnsif": "t3s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "rc": 0, "start": "2019-12-05 17:41:37.055800", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Create VETH Pairs] ************************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.21.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.1.21.1', u'bridge_name': u't3br1', u'dns': [{u'dnsif': u't3s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't3s1_dnsbrif'}], u'ns_name': u't3ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.21.2/24', u'tenant_ns_ip': u'10.1.21.1/24', u'tenant_ns_if': u't3ns1if', u'tenant_sub_if': u't3s1if', u'tenant_ns_name': u't3'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.1.21.2', u'dsport': 4789, u'dev': u't3s1if', u'tenant_route_ip': u'192.168.3.2', u'remote_route': u'10.2.21.0/24', u'subnet_route': u'10.1.21.0/24', u'v_name': u'vxlan_t3s1', u'id': 42, u'remote_ip': u'10.2.21.2'}]}, {u'mem': 2, u'name': u't3_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't3br1if1', u'vmif': u't3VM1if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip link show \"t3br1if1\" ; if [ $? -ne 0 ] ; then ip link add \"t3VM1if1\" type veth peer name \"t3br1if1\" ; fi\nip link set dev \"t3br1if1\" up\nip link set dev \"t3VM1if1\" up\n", "delta": "0:00:00.017043", "end": "2019-12-05 17:41:37.471499", "item": [{"bridge_name": "t3br1", "default_route_ip": "10.1.21.1", "dns": [{"brif": "t3s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.5", "dnsif": "t3s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t3ns1", "route": [{"if": "p1", "ip": "10.1.21.1/24", "ns_if": "t3if", "ns_name": "t3"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t3ns1if", "tenant_ns_ip": "10.1.21.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s1if", "tenant_sub_ip": "10.1.21.2/24"}], "vxlan": [{"dev": "t3s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.21.2", "remote_ip": "10.2.21.2", "remote_route": "10.2.21.0/24", "subnet_route": "10.1.21.0/24", "tenant_route_ip": "192.168.3.2", "v_name": "vxlan_t3s1"}]}, {"brif": "t3br1if1", "disk": "10G", "mem": 2, "name": "t3_VM1", "vcpu": 4, "vmif": "t3VM1if1"}], "rc": 0, "start": "2019-12-05 17:41:37.454456", "stderr": "Device \"t3br1if1\" does not exist.", "stderr_lines": ["Device \"t3br1if1\" does not exist."], "stdout": "", "stdout_lines": []}
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.21.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.1.21.1', u'bridge_name': u't3br1', u'dns': [{u'dnsif': u't3s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't3s1_dnsbrif'}], u'ns_name': u't3ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.21.2/24', u'tenant_ns_ip': u'10.1.21.1/24', u'tenant_ns_if': u't3ns1if', u'tenant_sub_if': u't3s1if', u'tenant_ns_name': u't3'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.1.21.2', u'dsport': 4789, u'dev': u't3s1if', u'tenant_route_ip': u'192.168.3.2', u'remote_route': u'10.2.21.0/24', u'subnet_route': u'10.1.21.0/24', u'v_name': u'vxlan_t3s1', u'id': 42, u'remote_ip': u'10.2.21.2'}]}, {u'mem': 4, u'name': u't3_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't3br1if2', u'vmif': u't3VM2if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip link show \"t3br1if2\" ; if [ $? -ne 0 ] ; then ip link add \"t3VM2if1\" type veth peer name \"t3br1if2\" ; fi\nip link set dev \"t3br1if2\" up\nip link set dev \"t3VM2if1\" up\n", "delta": "0:00:00.019561", "end": "2019-12-05 17:41:37.738211", "item": [{"bridge_name": "t3br1", "default_route_ip": "10.1.21.1", "dns": [{"brif": "t3s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.5", "dnsif": "t3s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t3ns1", "route": [{"if": "p1", "ip": "10.1.21.1/24", "ns_if": "t3if", "ns_name": "t3"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t3ns1if", "tenant_ns_ip": "10.1.21.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s1if", "tenant_sub_ip": "10.1.21.2/24"}], "vxlan": [{"dev": "t3s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.21.2", "remote_ip": "10.2.21.2", "remote_route": "10.2.21.0/24", "subnet_route": "10.1.21.0/24", "tenant_route_ip": "192.168.3.2", "v_name": "vxlan_t3s1"}]}, {"brif": "t3br1if2", "disk": "10G", "mem": 4, "name": "t3_VM2", "vcpu": 2, "vmif": "t3VM2if1"}], "rc": 0, "start": "2019-12-05 17:41:37.718650", "stderr": "Device \"t3br1if2\" does not exist.", "stderr_lines": ["Device \"t3br1if2\" does not exist."], "stdout": "", "stdout_lines": []}

TASK [Attach VETH Pairs] ************************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.21.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.1.21.1', u'bridge_name': u't3br1', u'dns': [{u'dnsif': u't3s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't3s1_dnsbrif'}], u'ns_name': u't3ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.21.2/24', u'tenant_ns_ip': u'10.1.21.1/24', u'tenant_ns_if': u't3ns1if', u'tenant_sub_if': u't3s1if', u'tenant_ns_name': u't3'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.1.21.2', u'dsport': 4789, u'dev': u't3s1if', u'tenant_route_ip': u'192.168.3.2', u'remote_route': u'10.2.21.0/24', u'subnet_route': u'10.1.21.0/24', u'v_name': u'vxlan_t3s1', u'id': 42, u'remote_ip': u'10.2.21.2'}]}, {u'mem': 2, u'name': u't3_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't3br1if1', u'vmif': u't3VM1if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip link show \"t3br1if1\" ; if [ $? -eq 0 ] ; then ip link set \"t3br1if1\" netns \"t3ns1\" ; fi\nip netns exec \"t3ns1\" brctl show \"t3br1\" | grep -w 't3br1if1' ; if [ $? -ne 0 ] ; then ip netns exec \"t3ns1\" brctl addif \"t3br1\" \"t3br1if1\" ; fi\n", "delta": "0:00:00.087637", "end": "2019-12-05 17:41:38.114787", "item": [{"bridge_name": "t3br1", "default_route_ip": "10.1.21.1", "dns": [{"brif": "t3s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.5", "dnsif": "t3s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t3ns1", "route": [{"if": "p1", "ip": "10.1.21.1/24", "ns_if": "t3if", "ns_name": "t3"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t3ns1if", "tenant_ns_ip": "10.1.21.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s1if", "tenant_sub_ip": "10.1.21.2/24"}], "vxlan": [{"dev": "t3s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.21.2", "remote_ip": "10.2.21.2", "remote_route": "10.2.21.0/24", "subnet_route": "10.1.21.0/24", "tenant_route_ip": "192.168.3.2", "v_name": "vxlan_t3s1"}]}, {"brif": "t3br1if1", "disk": "10G", "mem": 2, "name": "t3_VM1", "vcpu": 4, "vmif": "t3VM1if1"}], "rc": 0, "start": "2019-12-05 17:41:38.027150", "stderr": "", "stderr_lines": [], "stdout": "40: t3br1if1@t3VM1if1: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP mode DEFAULT group default qlen 1000\n    link/ether f2:b2:55:93:e6:ac brd ff:ff:ff:ff:ff:ff", "stdout_lines": ["40: t3br1if1@t3VM1if1: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP mode DEFAULT group default qlen 1000", "    link/ether f2:b2:55:93:e6:ac brd ff:ff:ff:ff:ff:ff"]}
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.21.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.1.21.1', u'bridge_name': u't3br1', u'dns': [{u'dnsif': u't3s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't3s1_dnsbrif'}], u'ns_name': u't3ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.21.2/24', u'tenant_ns_ip': u'10.1.21.1/24', u'tenant_ns_if': u't3ns1if', u'tenant_sub_if': u't3s1if', u'tenant_ns_name': u't3'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.1.21.2', u'dsport': 4789, u'dev': u't3s1if', u'tenant_route_ip': u'192.168.3.2', u'remote_route': u'10.2.21.0/24', u'subnet_route': u'10.1.21.0/24', u'v_name': u'vxlan_t3s1', u'id': 42, u'remote_ip': u'10.2.21.2'}]}, {u'mem': 4, u'name': u't3_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't3br1if2', u'vmif': u't3VM2if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip link show \"t3br1if2\" ; if [ $? -eq 0 ] ; then ip link set \"t3br1if2\" netns \"t3ns1\" ; fi\nip netns exec \"t3ns1\" brctl show \"t3br1\" | grep -w 't3br1if2' ; if [ $? -ne 0 ] ; then ip netns exec \"t3ns1\" brctl addif \"t3br1\" \"t3br1if2\" ; fi\n", "delta": "0:00:00.105753", "end": "2019-12-05 17:41:38.426777", "item": [{"bridge_name": "t3br1", "default_route_ip": "10.1.21.1", "dns": [{"brif": "t3s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.5", "dnsif": "t3s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t3ns1", "route": [{"if": "p1", "ip": "10.1.21.1/24", "ns_if": "t3if", "ns_name": "t3"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t3ns1if", "tenant_ns_ip": "10.1.21.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s1if", "tenant_sub_ip": "10.1.21.2/24"}], "vxlan": [{"dev": "t3s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.21.2", "remote_ip": "10.2.21.2", "remote_route": "10.2.21.0/24", "subnet_route": "10.1.21.0/24", "tenant_route_ip": "192.168.3.2", "v_name": "vxlan_t3s1"}]}, {"brif": "t3br1if2", "disk": "10G", "mem": 4, "name": "t3_VM2", "vcpu": 2, "vmif": "t3VM2if1"}], "rc": 0, "start": "2019-12-05 17:41:38.321024", "stderr": "", "stderr_lines": [], "stdout": "42: t3br1if2@t3VM2if1: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP mode DEFAULT group default qlen 1000\n    link/ether b2:aa:b5:c4:fd:ac brd ff:ff:ff:ff:ff:ff", "stdout_lines": ["42: t3br1if2@t3VM2if1: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP mode DEFAULT group default qlen 1000", "    link/ether b2:aa:b5:c4:fd:ac brd ff:ff:ff:ff:ff:ff"]}

TASK [All interfaces and bridges UP] ************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.21.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.1.21.1', u'bridge_name': u't3br1', u'dns': [{u'dnsif': u't3s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't3s1_dnsbrif'}], u'ns_name': u't3ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.21.2/24', u'tenant_ns_ip': u'10.1.21.1/24', u'tenant_ns_if': u't3ns1if', u'tenant_sub_if': u't3s1if', u'tenant_ns_name': u't3'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.1.21.2', u'dsport': 4789, u'dev': u't3s1if', u'tenant_route_ip': u'192.168.3.2', u'remote_route': u'10.2.21.0/24', u'subnet_route': u'10.1.21.0/24', u'v_name': u'vxlan_t3s1', u'id': 42, u'remote_ip': u'10.2.21.2'}]}, {u'mem': 2, u'name': u't3_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't3br1if1', u'vmif': u't3VM1if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t3ns1\" ip link set \"t3br1if1\" up\nip netns exec \"t3ns1\" ip link set dev \"t3br1\" up\n", "delta": "0:00:00.097220", "end": "2019-12-05 17:41:38.806865", "item": [{"bridge_name": "t3br1", "default_route_ip": "10.1.21.1", "dns": [{"brif": "t3s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.5", "dnsif": "t3s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t3ns1", "route": [{"if": "p1", "ip": "10.1.21.1/24", "ns_if": "t3if", "ns_name": "t3"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t3ns1if", "tenant_ns_ip": "10.1.21.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s1if", "tenant_sub_ip": "10.1.21.2/24"}], "vxlan": [{"dev": "t3s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.21.2", "remote_ip": "10.2.21.2", "remote_route": "10.2.21.0/24", "subnet_route": "10.1.21.0/24", "tenant_route_ip": "192.168.3.2", "v_name": "vxlan_t3s1"}]}, {"brif": "t3br1if1", "disk": "10G", "mem": 2, "name": "t3_VM1", "vcpu": 4, "vmif": "t3VM1if1"}], "rc": 0, "start": "2019-12-05 17:41:38.709645", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.21.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.1.21.1', u'bridge_name': u't3br1', u'dns': [{u'dnsif': u't3s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't3s1_dnsbrif'}], u'ns_name': u't3ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.21.2/24', u'tenant_ns_ip': u'10.1.21.1/24', u'tenant_ns_if': u't3ns1if', u'tenant_sub_if': u't3s1if', u'tenant_ns_name': u't3'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.1.21.2', u'dsport': 4789, u'dev': u't3s1if', u'tenant_route_ip': u'192.168.3.2', u'remote_route': u'10.2.21.0/24', u'subnet_route': u'10.1.21.0/24', u'v_name': u'vxlan_t3s1', u'id': 42, u'remote_ip': u'10.2.21.2'}]}, {u'mem': 4, u'name': u't3_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't3br1if2', u'vmif': u't3VM2if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t3ns1\" ip link set \"t3br1if2\" up\nip netns exec \"t3ns1\" ip link set dev \"t3br1\" up\n", "delta": "0:00:00.074481", "end": "2019-12-05 17:41:39.086761", "item": [{"bridge_name": "t3br1", "default_route_ip": "10.1.21.1", "dns": [{"brif": "t3s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.5", "dnsif": "t3s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t3ns1", "route": [{"if": "p1", "ip": "10.1.21.1/24", "ns_if": "t3if", "ns_name": "t3"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t3ns1if", "tenant_ns_ip": "10.1.21.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s1if", "tenant_sub_ip": "10.1.21.2/24"}], "vxlan": [{"dev": "t3s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.21.2", "remote_ip": "10.2.21.2", "remote_route": "10.2.21.0/24", "subnet_route": "10.1.21.0/24", "tenant_route_ip": "192.168.3.2", "v_name": "vxlan_t3s1"}]}, {"brif": "t3br1if2", "disk": "10G", "mem": 4, "name": "t3_VM2", "vcpu": 2, "vmif": "t3VM2if1"}], "rc": 0, "start": "2019-12-05 17:41:39.012280", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Add IP to DNS Interface] ******************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.21.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.1.21.1', u'bridge_name': u't3br1', u'ns_name': u't3ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.21.2/24', u'tenant_ns_ip': u'10.1.21.1/24', u'tenant_ns_if': u't3ns1if', u'tenant_sub_if': u't3s1if', u'tenant_ns_name': u't3'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't3_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't3br1if1', u'vmif': u't3VM1if1'}, {u'mem': 4, u'name': u't3_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't3br1if2', u'vmif': u't3VM2if1'}], u'vxlan': [{u'local_ip': u'10.1.21.2', u'dsport': 4789, u'dev': u't3s1if', u'tenant_route_ip': u'192.168.3.2', u'remote_route': u'10.2.21.0/24', u'subnet_route': u'10.1.21.0/24', u'v_name': u'vxlan_t3s1', u'id': 42, u'remote_ip': u'10.2.21.2'}]}, {u'dnsif': u't3s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't3s1_dnsbrif'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t3ns1\" ip addr show \"t3s1_dnsif\" | awk 'FNR==3{ print $2 }' | grep -w '^1.1.1.1/24' ; if [ $? -ne 0 ] ; then ip netns exec \"t3ns1\" ip addr add \"1.1.1.1/24\" dev \"t3s1_dnsif\" ; fi\n", "delta": "0:00:00.067702", "end": "2019-12-05 17:41:39.434754", "item": [{"bridge_name": "t3br1", "default_route_ip": "10.1.21.1", "ns_name": "t3ns1", "route": [{"if": "p1", "ip": "10.1.21.1/24", "ns_if": "t3if", "ns_name": "t3"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t3ns1if", "tenant_ns_ip": "10.1.21.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s1if", "tenant_sub_ip": "10.1.21.2/24"}], "vms": [{"brif": "t3br1if1", "disk": "10G", "mem": 2, "name": "t3_VM1", "vcpu": 4, "vmif": "t3VM1if1"}, {"brif": "t3br1if2", "disk": "10G", "mem": 4, "name": "t3_VM2", "vcpu": 2, "vmif": "t3VM2if1"}], "vxlan": [{"dev": "t3s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.21.2", "remote_ip": "10.2.21.2", "remote_route": "10.2.21.0/24", "subnet_route": "10.1.21.0/24", "tenant_route_ip": "192.168.3.2", "v_name": "vxlan_t3s1"}]}, {"brif": "t3s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.5", "dnsif": "t3s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "rc": 0, "start": "2019-12-05 17:41:39.367052", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Install DHCP Server] **********************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.21.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.1.21.1', u'bridge_name': u't3br1', u'ns_name': u't3ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.21.2/24', u'tenant_ns_ip': u'10.1.21.1/24', u'tenant_ns_if': u't3ns1if', u'tenant_sub_if': u't3s1if', u'tenant_ns_name': u't3'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't3_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't3br1if1', u'vmif': u't3VM1if1'}, {u'mem': 4, u'name': u't3_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't3br1if2', u'vmif': u't3VM2if1'}], u'vxlan': [{u'local_ip': u'10.1.21.2', u'dsport': 4789, u'dev': u't3s1if', u'tenant_route_ip': u'192.168.3.2', u'remote_route': u'10.2.21.0/24', u'subnet_route': u'10.1.21.0/24', u'v_name': u'vxlan_t3s1', u'id': 42, u'remote_ip': u'10.2.21.2'}]}, {u'dnsif': u't3s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't3s1_dnsbrif'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t3ns1\" ps aux | grep -w '[d]nsmasq --interface t3s1_dnsif -z --dhcp-range=1.1.1.5,1.1.1.254' ; if [ $? -ne 0 ] ; then ip netns exec \"t3ns1\" dnsmasq --interface \"t3s1_dnsif\" -z --dhcp-range=1.1.1.5,'1.1.1.254' ; fi\n", "delta": "0:00:00.075000", "end": "2019-12-05 17:41:39.819689", "item": [{"bridge_name": "t3br1", "default_route_ip": "10.1.21.1", "ns_name": "t3ns1", "route": [{"if": "p1", "ip": "10.1.21.1/24", "ns_if": "t3if", "ns_name": "t3"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t3ns1if", "tenant_ns_ip": "10.1.21.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s1if", "tenant_sub_ip": "10.1.21.2/24"}], "vms": [{"brif": "t3br1if1", "disk": "10G", "mem": 2, "name": "t3_VM1", "vcpu": 4, "vmif": "t3VM1if1"}, {"brif": "t3br1if2", "disk": "10G", "mem": 4, "name": "t3_VM2", "vcpu": 2, "vmif": "t3VM2if1"}], "vxlan": [{"dev": "t3s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.21.2", "remote_ip": "10.2.21.2", "remote_route": "10.2.21.0/24", "subnet_route": "10.1.21.0/24", "tenant_route_ip": "192.168.3.2", "v_name": "vxlan_t3s1"}]}, {"brif": "t3s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.5", "dnsif": "t3s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "rc": 0, "start": "2019-12-05 17:41:39.744689", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Create VXLAN devices] *********************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.21.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.1.21.1', u'bridge_name': u't3br1', u'dns': [{u'dnsif': u't3s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't3s1_dnsbrif'}], u'ns_name': u't3ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.21.2/24', u'tenant_ns_ip': u'10.1.21.1/24', u'tenant_ns_if': u't3ns1if', u'tenant_sub_if': u't3s1if', u'tenant_ns_name': u't3'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't3_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't3br1if1', u'vmif': u't3VM1if1'}, {u'mem': 4, u'name': u't3_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't3br1if2', u'vmif': u't3VM2if1'}]}, {u'local_ip': u'10.1.21.2', u'dsport': 4789, u'dev': u't3s1if', u'tenant_route_ip': u'192.168.3.2', u'remote_route': u'10.2.21.0/24', u'subnet_route': u'10.1.21.0/24', u'v_name': u'vxlan_t3s1', u'id': 42, u'remote_ip': u'10.2.21.2'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t3ns1\" ip link show \"vxlan_t3s1\" ; if [ $? -ne 0 ] ; then ip netns exec \"t3ns1\" ip link add \"vxlan_t3s1\" type vxlan id \"42\" local \"10.1.21.2\" remote \"10.2.21.2\" dstport \"4789\" dev \"t3s1if\"; ip netns exec \"t3ns1\" ip link set dev \"vxlan_t3s1\" up ; fi\n", "delta": "0:00:00.123983", "end": "2019-12-05 17:41:40.250999", "item": [{"bridge_name": "t3br1", "default_route_ip": "10.1.21.1", "dns": [{"brif": "t3s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.5", "dnsif": "t3s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t3ns1", "route": [{"if": "p1", "ip": "10.1.21.1/24", "ns_if": "t3if", "ns_name": "t3"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t3ns1if", "tenant_ns_ip": "10.1.21.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s1if", "tenant_sub_ip": "10.1.21.2/24"}], "vms": [{"brif": "t3br1if1", "disk": "10G", "mem": 2, "name": "t3_VM1", "vcpu": 4, "vmif": "t3VM1if1"}, {"brif": "t3br1if2", "disk": "10G", "mem": 4, "name": "t3_VM2", "vcpu": 2, "vmif": "t3VM2if1"}]}, {"dev": "t3s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.21.2", "remote_ip": "10.2.21.2", "remote_route": "10.2.21.0/24", "subnet_route": "10.1.21.0/24", "tenant_route_ip": "192.168.3.2", "v_name": "vxlan_t3s1"}], "rc": 0, "start": "2019-12-05 17:41:40.127016", "stderr": "Device \"vxlan_t3s1\" does not exist.", "stderr_lines": ["Device \"vxlan_t3s1\" does not exist."], "stdout": "", "stdout_lines": []}

TASK [Attach VXLANs to bridge] ******************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.21.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.1.21.1', u'bridge_name': u't3br1', u'dns': [{u'dnsif': u't3s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't3s1_dnsbrif'}], u'ns_name': u't3ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.21.2/24', u'tenant_ns_ip': u'10.1.21.1/24', u'tenant_ns_if': u't3ns1if', u'tenant_sub_if': u't3s1if', u'tenant_ns_name': u't3'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't3_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't3br1if1', u'vmif': u't3VM1if1'}, {u'mem': 4, u'name': u't3_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't3br1if2', u'vmif': u't3VM2if1'}]}, {u'local_ip': u'10.1.21.2', u'dsport': 4789, u'dev': u't3s1if', u'tenant_route_ip': u'192.168.3.2', u'remote_route': u'10.2.21.0/24', u'subnet_route': u'10.1.21.0/24', u'v_name': u'vxlan_t3s1', u'id': 42, u'remote_ip': u'10.2.21.2'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t3ns1\" brctl show \"t3br1\" | grep -w 'vxlan_t3s1' ; if [ $? -ne 0 ] ; then ip netns exec \"t3ns1\" brctl addif \"t3br1\" \"vxlan_t3s1\" ; fi\n", "delta": "0:00:00.075302", "end": "2019-12-05 17:41:40.642739", "item": [{"bridge_name": "t3br1", "default_route_ip": "10.1.21.1", "dns": [{"brif": "t3s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.5", "dnsif": "t3s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t3ns1", "route": [{"if": "p1", "ip": "10.1.21.1/24", "ns_if": "t3if", "ns_name": "t3"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t3ns1if", "tenant_ns_ip": "10.1.21.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s1if", "tenant_sub_ip": "10.1.21.2/24"}], "vms": [{"brif": "t3br1if1", "disk": "10G", "mem": 2, "name": "t3_VM1", "vcpu": 4, "vmif": "t3VM1if1"}, {"brif": "t3br1if2", "disk": "10G", "mem": 4, "name": "t3_VM2", "vcpu": 2, "vmif": "t3VM2if1"}]}, {"dev": "t3s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.21.2", "remote_ip": "10.2.21.2", "remote_route": "10.2.21.0/24", "subnet_route": "10.1.21.0/24", "tenant_route_ip": "192.168.3.2", "v_name": "vxlan_t3s1"}], "rc": 0, "start": "2019-12-05 17:41:40.567437", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

PLAY RECAP **************************************************************************************************************************************************
localhost                  : ok=21   changed=21   unreachable=0    failed=0    skipped=0    rescued=0    ignored=0   

Using /etc/ansible/ansible.cfg as config file

PLAY [worker] ***********************************************************************************************************************************************

TASK [Create Tenant Namespace] ******************************************************************************************************************************
changed: [99.99.99.2] => (item={u'default_route_ip': u'192.168.131.1', u'name': u't3', u'pns_ip': u'192.168.131.1/24', u'tenant_if': u't3if', u'tenant_ip': u'192.168.131.2/24', u'pns_if': u't3pns_if'}) => {"ansible_loop_var": "item", "changed": true, "cmd": ["ip", "netns", "add", "t3"], "delta": "0:00:00.053373", "end": "2019-12-05 17:41:42.596279", "item": {"default_route_ip": "192.168.131.1", "name": "t3", "pns_if": "t3pns_if", "pns_ip": "192.168.131.1/24", "tenant_if": "t3if", "tenant_ip": "192.168.131.2/24"}, "rc": 0, "start": "2019-12-05 17:41:42.542906", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Create Subnet Namespace] ******************************************************************************************************************************
changed: [99.99.99.2] => (item={u'route': [{u'ip': u'10.2.21.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.2.21.1', u'bridge_name': u't3br1', u'dns': [{u'dnsif': u't3s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't3s1_dnsbrif'}], u'ns_name': u't3ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.21.2/24', u'tenant_ns_ip': u'10.2.21.1/24', u'tenant_ns_if': u't3ns1if', u'tenant_ns_name': u't3', u'tenant_sub_if': u't3s1if'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't3_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't3br1if1', u'vmif': u't3VM4if1'}], u'vxlan': [{u'local_ip': u'10.2.21.2', u'tenant_route_ip': u'192.168.131.2', u'dsport': 4789, u'dev': u't3s1if', u'subnet_route': u'10.2.21.0/24', u'remote_route': u'10.1.21.0/24', u'v_name': u'vxlan_t3s1', u'id': 42, u'remote_ip': u'10.1.21.2'}]}) => {"ansible_loop_var": "item", "changed": true, "cmd": ["ip", "netns", "add", "t3ns1"], "delta": "0:00:00.052076", "end": "2019-12-05 17:41:43.071152", "item": {"bridge_name": "t3br1", "default_route_ip": "10.2.21.1", "dns": [{"brif": "t3s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.5", "dnsif": "t3s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t3ns1", "route": [{"if": "p1", "ip": "10.2.21.1/24", "ns_if": "t3if", "ns_name": "t3"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t3ns1if", "tenant_ns_ip": "10.2.21.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s1if", "tenant_sub_ip": "10.2.21.2/24"}], "vms": [{"brif": "t3br1if1", "disk": "10G", "mem": 2, "name": "t3_VM4", "vcpu": 4, "vmif": "t3VM4if1"}], "vxlan": [{"dev": "t3s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.21.2", "remote_ip": "10.1.21.2", "remote_route": "10.1.21.0/24", "subnet_route": "10.2.21.0/24", "tenant_route_ip": "192.168.131.2", "v_name": "vxlan_t3s1"}]}, "rc": 0, "start": "2019-12-05 17:41:43.019076", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}
changed: [99.99.99.2] => (item={u'route': [{u'ip': u'10.2.22.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.2.22.1', u'bridge_name': u't3br2', u'dns': [{u'dnsif': u't3s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't3s2_dnsbrif'}], u'ns_name': u't3ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.22.2/24', u'tenant_ns_ip': u'10.2.22.1/24', u'tenant_ns_if': u't3ns2if', u'tenant_ns_name': u't3', u'tenant_sub_if': u't3s2if'}], u'subnet_ip': u'2.2.2.0/24', u'vms': [{u'mem': 3, u'name': u't3_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't3br2if1', u'vmif': u't3VM3if1'}], u'vxlan': [{u'local_ip': [], u'tenant_route_ip': [], u'dsport': [], u'dev': [], u'subnet_route': [], u'remote_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}) => {"ansible_loop_var": "item", "changed": true, "cmd": ["ip", "netns", "add", "t3ns2"], "delta": "0:00:00.058041", "end": "2019-12-05 17:41:43.456338", "item": {"bridge_name": "t3br2", "default_route_ip": "10.2.22.1", "dns": [{"brif": "t3s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t3s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t3ns2", "route": [{"if": "p1", "ip": "10.2.22.1/24", "ns_if": "t3if", "ns_name": "t3"}], "subnet_ip": "2.2.2.0/24", "tenant_ns": [{"tenant_ns_if": "t3ns2if", "tenant_ns_ip": "10.2.22.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s2if", "tenant_sub_ip": "10.2.22.2/24"}], "vms": [{"brif": "t3br2if1", "disk": "10G", "mem": 3, "name": "t3_VM3", "vcpu": 2, "vmif": "t3VM3if1"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, "rc": 0, "start": "2019-12-05 17:41:43.398297", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Create Tenant VETH pairs] *****************************************************************************************************************************
changed: [99.99.99.2] => (item={u'default_route_ip': u'192.168.131.1', u'name': u't3', u'pns_ip': u'192.168.131.1/24', u'tenant_if': u't3if', u'tenant_ip': u'192.168.131.2/24', u'pns_if': u't3pns_if'}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip link show \"t3if\" ; if [ $? -ne 0 ] ; then ip link add \"t3if\" type veth peer name \"t3pns_if\" ; fi\n", "delta": "0:00:00.012282", "end": "2019-12-05 17:41:43.862269", "item": {"default_route_ip": "192.168.131.1", "name": "t3", "pns_if": "t3pns_if", "pns_ip": "192.168.131.1/24", "tenant_if": "t3if", "tenant_ip": "192.168.131.2/24"}, "rc": 0, "start": "2019-12-05 17:41:43.849987", "stderr": "Device \"t3if\" does not exist.", "stderr_lines": ["Device \"t3if\" does not exist."], "stdout": "", "stdout_lines": []}

TASK [Attach Tenant VETH Pairs] *****************************************************************************************************************************
changed: [99.99.99.2] => (item={u'default_route_ip': u'192.168.131.1', u'name': u't3', u'pns_ip': u'192.168.131.1/24', u'tenant_if': u't3if', u'tenant_ip': u'192.168.131.2/24', u'pns_if': u't3pns_if'}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec pns ip link show \"t3pns_if\" ; if [ $? -ne 0 ] ; then ip link set \"t3pns_if\" netns pns ; fi\nip netns exec \"t3\" ip link show \"t3if\" ; if [ $? -ne 0 ] ; then ip link set \"t3if\" netns \"t3\" ; fi\nip netns exec pns ip link set dev \"t3pns_if\" up\nip netns exec \"t3\" ip link set dev \"t3if\" up\n", "delta": "0:00:00.188746", "end": "2019-12-05 17:41:44.442711", "item": {"default_route_ip": "192.168.131.1", "name": "t3", "pns_if": "t3pns_if", "pns_ip": "192.168.131.1/24", "tenant_if": "t3if", "tenant_ip": "192.168.131.2/24"}, "rc": 0, "start": "2019-12-05 17:41:44.253965", "stderr": "Device \"t3pns_if\" does not exist.\nDevice \"t3if\" does not exist.", "stderr_lines": ["Device \"t3pns_if\" does not exist.", "Device \"t3if\" does not exist."], "stdout": "", "stdout_lines": []}

TASK [Add IP addresses to Tenant VETH Pairs] ****************************************************************************************************************
changed: [99.99.99.2] => (item={u'default_route_ip': u'192.168.131.1', u'name': u't3', u'pns_ip': u'192.168.131.1/24', u'tenant_if': u't3if', u'tenant_ip': u'192.168.131.2/24', u'pns_if': u't3pns_if'}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec pns ip addr show \"t3pns_if\" | awk 'FNR==3{ print $2 }' | grep -w '^192.168.131.1/24' ; if [ $? -ne 0 ] ; then ip netns exec pns ip addr add \"192.168.131.1/24\" dev \"t3pns_if\" ; fi\nip netns exec \"t3\" ip addr show \"t3if\" | awk 'FNR==3{ print $2 }' | grep -w '^192.168.131.2/24' ; if [ $? -ne 0 ] ; then ip netns exec \"t3\" ip addr add \"192.168.131.2/24\" dev \"t3if\" ; fi\n", "delta": "0:00:00.148871", "end": "2019-12-05 17:41:44.986574", "item": {"default_route_ip": "192.168.131.1", "name": "t3", "pns_if": "t3pns_if", "pns_ip": "192.168.131.1/24", "tenant_if": "t3if", "tenant_ip": "192.168.131.2/24"}, "rc": 0, "start": "2019-12-05 17:41:44.837703", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Create Namespace VETH Pairs] **************************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.21.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.2.21.1', u'bridge_name': u't3br1', u'dns': [{u'dnsif': u't3s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't3s1_dnsbrif'}], u'ns_name': u't3ns1', u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't3_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't3br1if1', u'vmif': u't3VM4if1'}], u'vxlan': [{u'local_ip': u'10.2.21.2', u'dsport': 4789, u'dev': u't3s1if', u'tenant_route_ip': u'192.168.131.2', u'remote_route': u'10.1.21.0/24', u'subnet_route': u'10.2.21.0/24', u'v_name': u'vxlan_t3s1', u'id': 42, u'remote_ip': u'10.1.21.2'}]}, {u'tenant_sub_ip': u'10.2.21.2/24', u'tenant_ns_ip': u'10.2.21.1/24', u'tenant_ns_if': u't3ns1if', u'tenant_sub_if': u't3s1if', u'tenant_ns_name': u't3'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip link show \"t3ns1if\" ; if [ $? -ne 0 ] ; then ip link add \"t3ns1if\" type veth peer name \"t3s1if\" ; fi\n", "delta": "0:00:00.010130", "end": "2019-12-05 17:41:45.407265", "item": [{"bridge_name": "t3br1", "default_route_ip": "10.2.21.1", "dns": [{"brif": "t3s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.5", "dnsif": "t3s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t3ns1", "route": [{"if": "p1", "ip": "10.2.21.1/24", "ns_if": "t3if", "ns_name": "t3"}], "subnet_ip": "1.1.1.0/24", "vms": [{"brif": "t3br1if1", "disk": "10G", "mem": 2, "name": "t3_VM4", "vcpu": 4, "vmif": "t3VM4if1"}], "vxlan": [{"dev": "t3s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.21.2", "remote_ip": "10.1.21.2", "remote_route": "10.1.21.0/24", "subnet_route": "10.2.21.0/24", "tenant_route_ip": "192.168.131.2", "v_name": "vxlan_t3s1"}]}, {"tenant_ns_if": "t3ns1if", "tenant_ns_ip": "10.2.21.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s1if", "tenant_sub_ip": "10.2.21.2/24"}], "rc": 0, "start": "2019-12-05 17:41:45.397135", "stderr": "Device \"t3ns1if\" does not exist.", "stderr_lines": ["Device \"t3ns1if\" does not exist."], "stdout": "", "stdout_lines": []}
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.22.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.2.22.1', u'bridge_name': u't3br2', u'dns': [{u'dnsif': u't3s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't3s2_dnsbrif'}], u'ns_name': u't3ns2', u'subnet_ip': u'2.2.2.0/24', u'vms': [{u'mem': 3, u'name': u't3_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't3br2if1', u'vmif': u't3VM3if1'}], u'vxlan': [{u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}, {u'tenant_sub_ip': u'10.2.22.2/24', u'tenant_ns_ip': u'10.2.22.1/24', u'tenant_ns_if': u't3ns2if', u'tenant_sub_if': u't3s2if', u'tenant_ns_name': u't3'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip link show \"t3ns2if\" ; if [ $? -ne 0 ] ; then ip link add \"t3ns2if\" type veth peer name \"t3s2if\" ; fi\n", "delta": "0:00:00.013384", "end": "2019-12-05 17:41:45.757638", "item": [{"bridge_name": "t3br2", "default_route_ip": "10.2.22.1", "dns": [{"brif": "t3s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t3s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t3ns2", "route": [{"if": "p1", "ip": "10.2.22.1/24", "ns_if": "t3if", "ns_name": "t3"}], "subnet_ip": "2.2.2.0/24", "vms": [{"brif": "t3br2if1", "disk": "10G", "mem": 3, "name": "t3_VM3", "vcpu": 2, "vmif": "t3VM3if1"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, {"tenant_ns_if": "t3ns2if", "tenant_ns_ip": "10.2.22.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s2if", "tenant_sub_ip": "10.2.22.2/24"}], "rc": 0, "start": "2019-12-05 17:41:45.744254", "stderr": "Device \"t3ns2if\" does not exist.", "stderr_lines": ["Device \"t3ns2if\" does not exist."], "stdout": "", "stdout_lines": []}

TASK [Attach Namespace VETH Pairs] **************************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.21.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.2.21.1', u'bridge_name': u't3br1', u'dns': [{u'dnsif': u't3s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't3s1_dnsbrif'}], u'ns_name': u't3ns1', u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't3_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't3br1if1', u'vmif': u't3VM4if1'}], u'vxlan': [{u'local_ip': u'10.2.21.2', u'dsport': 4789, u'dev': u't3s1if', u'tenant_route_ip': u'192.168.131.2', u'remote_route': u'10.1.21.0/24', u'subnet_route': u'10.2.21.0/24', u'v_name': u'vxlan_t3s1', u'id': 42, u'remote_ip': u'10.1.21.2'}]}, {u'tenant_sub_ip': u'10.2.21.2/24', u'tenant_ns_ip': u'10.2.21.1/24', u'tenant_ns_if': u't3ns1if', u'tenant_sub_if': u't3s1if', u'tenant_ns_name': u't3'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t3\" ip link show \"t3ns1if\" ; if [ $? -ne 0 ] ; then ip link set \"t3ns1if\" netns \"t3\" ; fi\nip netns exec \"t3ns1\" ip link show \"t3s1if\" ; if [ $? -ne 0 ] ; then ip link set \"t3s1if\" netns \"t3ns1\" ; fi\n", "delta": "0:00:00.136305", "end": "2019-12-05 17:41:46.295563", "item": [{"bridge_name": "t3br1", "default_route_ip": "10.2.21.1", "dns": [{"brif": "t3s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.5", "dnsif": "t3s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t3ns1", "route": [{"if": "p1", "ip": "10.2.21.1/24", "ns_if": "t3if", "ns_name": "t3"}], "subnet_ip": "1.1.1.0/24", "vms": [{"brif": "t3br1if1", "disk": "10G", "mem": 2, "name": "t3_VM4", "vcpu": 4, "vmif": "t3VM4if1"}], "vxlan": [{"dev": "t3s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.21.2", "remote_ip": "10.1.21.2", "remote_route": "10.1.21.0/24", "subnet_route": "10.2.21.0/24", "tenant_route_ip": "192.168.131.2", "v_name": "vxlan_t3s1"}]}, {"tenant_ns_if": "t3ns1if", "tenant_ns_ip": "10.2.21.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s1if", "tenant_sub_ip": "10.2.21.2/24"}], "rc": 0, "start": "2019-12-05 17:41:46.159258", "stderr": "Device \"t3ns1if\" does not exist.\nDevice \"t3s1if\" does not exist.", "stderr_lines": ["Device \"t3ns1if\" does not exist.", "Device \"t3s1if\" does not exist."], "stdout": "", "stdout_lines": []}
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.22.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.2.22.1', u'bridge_name': u't3br2', u'dns': [{u'dnsif': u't3s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't3s2_dnsbrif'}], u'ns_name': u't3ns2', u'subnet_ip': u'2.2.2.0/24', u'vms': [{u'mem': 3, u'name': u't3_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't3br2if1', u'vmif': u't3VM3if1'}], u'vxlan': [{u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}, {u'tenant_sub_ip': u'10.2.22.2/24', u'tenant_ns_ip': u'10.2.22.1/24', u'tenant_ns_if': u't3ns2if', u'tenant_sub_if': u't3s2if', u'tenant_ns_name': u't3'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t3\" ip link show \"t3ns2if\" ; if [ $? -ne 0 ] ; then ip link set \"t3ns2if\" netns \"t3\" ; fi\nip netns exec \"t3ns2\" ip link show \"t3s2if\" ; if [ $? -ne 0 ] ; then ip link set \"t3s2if\" netns \"t3ns2\" ; fi\n", "delta": "0:00:00.117301", "end": "2019-12-05 17:41:46.751304", "item": [{"bridge_name": "t3br2", "default_route_ip": "10.2.22.1", "dns": [{"brif": "t3s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t3s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t3ns2", "route": [{"if": "p1", "ip": "10.2.22.1/24", "ns_if": "t3if", "ns_name": "t3"}], "subnet_ip": "2.2.2.0/24", "vms": [{"brif": "t3br2if1", "disk": "10G", "mem": 3, "name": "t3_VM3", "vcpu": 2, "vmif": "t3VM3if1"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, {"tenant_ns_if": "t3ns2if", "tenant_ns_ip": "10.2.22.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s2if", "tenant_sub_ip": "10.2.22.2/24"}], "rc": 0, "start": "2019-12-05 17:41:46.634003", "stderr": "Device \"t3ns2if\" does not exist.\nDevice \"t3s2if\" does not exist.", "stderr_lines": ["Device \"t3ns2if\" does not exist.", "Device \"t3s2if\" does not exist."], "stdout": "", "stdout_lines": []}

TASK [Set Namespace VETH Pairs UP] **************************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.21.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.2.21.1', u'bridge_name': u't3br1', u'dns': [{u'dnsif': u't3s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't3s1_dnsbrif'}], u'ns_name': u't3ns1', u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't3_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't3br1if1', u'vmif': u't3VM4if1'}], u'vxlan': [{u'local_ip': u'10.2.21.2', u'dsport': 4789, u'dev': u't3s1if', u'tenant_route_ip': u'192.168.131.2', u'remote_route': u'10.1.21.0/24', u'subnet_route': u'10.2.21.0/24', u'v_name': u'vxlan_t3s1', u'id': 42, u'remote_ip': u'10.1.21.2'}]}, {u'tenant_sub_ip': u'10.2.21.2/24', u'tenant_ns_ip': u'10.2.21.1/24', u'tenant_ns_if': u't3ns1if', u'tenant_sub_if': u't3s1if', u'tenant_ns_name': u't3'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t3\" ip link set dev \"t3ns1if\" up\nip netns exec \"t3ns1\" ip link set dev \"t3s1if\" up\n", "delta": "0:00:00.074493", "end": "2019-12-05 17:41:47.222615", "item": [{"bridge_name": "t3br1", "default_route_ip": "10.2.21.1", "dns": [{"brif": "t3s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.5", "dnsif": "t3s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t3ns1", "route": [{"if": "p1", "ip": "10.2.21.1/24", "ns_if": "t3if", "ns_name": "t3"}], "subnet_ip": "1.1.1.0/24", "vms": [{"brif": "t3br1if1", "disk": "10G", "mem": 2, "name": "t3_VM4", "vcpu": 4, "vmif": "t3VM4if1"}], "vxlan": [{"dev": "t3s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.21.2", "remote_ip": "10.1.21.2", "remote_route": "10.1.21.0/24", "subnet_route": "10.2.21.0/24", "tenant_route_ip": "192.168.131.2", "v_name": "vxlan_t3s1"}]}, {"tenant_ns_if": "t3ns1if", "tenant_ns_ip": "10.2.21.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s1if", "tenant_sub_ip": "10.2.21.2/24"}], "rc": 0, "start": "2019-12-05 17:41:47.148122", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.22.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.2.22.1', u'bridge_name': u't3br2', u'dns': [{u'dnsif': u't3s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't3s2_dnsbrif'}], u'ns_name': u't3ns2', u'subnet_ip': u'2.2.2.0/24', u'vms': [{u'mem': 3, u'name': u't3_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't3br2if1', u'vmif': u't3VM3if1'}], u'vxlan': [{u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}, {u'tenant_sub_ip': u'10.2.22.2/24', u'tenant_ns_ip': u'10.2.22.1/24', u'tenant_ns_if': u't3ns2if', u'tenant_sub_if': u't3s2if', u'tenant_ns_name': u't3'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t3\" ip link set dev \"t3ns2if\" up\nip netns exec \"t3ns2\" ip link set dev \"t3s2if\" up\n", "delta": "0:00:00.080591", "end": "2019-12-05 17:41:47.626757", "item": [{"bridge_name": "t3br2", "default_route_ip": "10.2.22.1", "dns": [{"brif": "t3s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t3s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t3ns2", "route": [{"if": "p1", "ip": "10.2.22.1/24", "ns_if": "t3if", "ns_name": "t3"}], "subnet_ip": "2.2.2.0/24", "vms": [{"brif": "t3br2if1", "disk": "10G", "mem": 3, "name": "t3_VM3", "vcpu": 2, "vmif": "t3VM3if1"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, {"tenant_ns_if": "t3ns2if", "tenant_ns_ip": "10.2.22.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s2if", "tenant_sub_ip": "10.2.22.2/24"}], "rc": 0, "start": "2019-12-05 17:41:47.546166", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Add IP addresses to Namespace VETH Pairs] *************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.21.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.2.21.1', u'bridge_name': u't3br1', u'dns': [{u'dnsif': u't3s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't3s1_dnsbrif'}], u'ns_name': u't3ns1', u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't3_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't3br1if1', u'vmif': u't3VM4if1'}], u'vxlan': [{u'local_ip': u'10.2.21.2', u'dsport': 4789, u'dev': u't3s1if', u'tenant_route_ip': u'192.168.131.2', u'remote_route': u'10.1.21.0/24', u'subnet_route': u'10.2.21.0/24', u'v_name': u'vxlan_t3s1', u'id': 42, u'remote_ip': u'10.1.21.2'}]}, {u'tenant_sub_ip': u'10.2.21.2/24', u'tenant_ns_ip': u'10.2.21.1/24', u'tenant_ns_if': u't3ns1if', u'tenant_sub_if': u't3s1if', u'tenant_ns_name': u't3'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t3ns1\" ip addr show \"t3s1if\" | awk 'FNR==3{ print $2 }' | grep -w '^10.2.21.2/24' ; if [ $? -ne 0 ] ; then ip netns exec \"t3ns1\" ip addr add \"10.2.21.2/24\" dev \"t3s1if\" ; fi\n\nip netns exec \"t3\" ip addr show \"t3ns1if\" | awk 'FNR==3{ print $2 }' | grep -w '^10.2.21.1/24' ; if [ $? -ne 0 ] ; then ip netns exec \"t3\" ip addr add \"10.2.21.1/24\" dev \"t3ns1if\" ; fi\n", "delta": "0:00:00.153567", "end": "2019-12-05 17:41:48.182554", "item": [{"bridge_name": "t3br1", "default_route_ip": "10.2.21.1", "dns": [{"brif": "t3s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.5", "dnsif": "t3s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t3ns1", "route": [{"if": "p1", "ip": "10.2.21.1/24", "ns_if": "t3if", "ns_name": "t3"}], "subnet_ip": "1.1.1.0/24", "vms": [{"brif": "t3br1if1", "disk": "10G", "mem": 2, "name": "t3_VM4", "vcpu": 4, "vmif": "t3VM4if1"}], "vxlan": [{"dev": "t3s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.21.2", "remote_ip": "10.1.21.2", "remote_route": "10.1.21.0/24", "subnet_route": "10.2.21.0/24", "tenant_route_ip": "192.168.131.2", "v_name": "vxlan_t3s1"}]}, {"tenant_ns_if": "t3ns1if", "tenant_ns_ip": "10.2.21.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s1if", "tenant_sub_ip": "10.2.21.2/24"}], "rc": 0, "start": "2019-12-05 17:41:48.028987", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.22.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.2.22.1', u'bridge_name': u't3br2', u'dns': [{u'dnsif': u't3s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't3s2_dnsbrif'}], u'ns_name': u't3ns2', u'subnet_ip': u'2.2.2.0/24', u'vms': [{u'mem': 3, u'name': u't3_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't3br2if1', u'vmif': u't3VM3if1'}], u'vxlan': [{u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}, {u'tenant_sub_ip': u'10.2.22.2/24', u'tenant_ns_ip': u'10.2.22.1/24', u'tenant_ns_if': u't3ns2if', u'tenant_sub_if': u't3s2if', u'tenant_ns_name': u't3'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t3ns2\" ip addr show \"t3s2if\" | awk 'FNR==3{ print $2 }' | grep -w '^10.2.22.2/24' ; if [ $? -ne 0 ] ; then ip netns exec \"t3ns2\" ip addr add \"10.2.22.2/24\" dev \"t3s2if\" ; fi\n\nip netns exec \"t3\" ip addr show \"t3ns2if\" | awk 'FNR==3{ print $2 }' | grep -w '^10.2.22.1/24' ; if [ $? -ne 0 ] ; then ip netns exec \"t3\" ip addr add \"10.2.22.1/24\" dev \"t3ns2if\" ; fi\n", "delta": "0:00:00.154504", "end": "2019-12-05 17:41:48.678542", "item": [{"bridge_name": "t3br2", "default_route_ip": "10.2.22.1", "dns": [{"brif": "t3s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t3s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t3ns2", "route": [{"if": "p1", "ip": "10.2.22.1/24", "ns_if": "t3if", "ns_name": "t3"}], "subnet_ip": "2.2.2.0/24", "vms": [{"brif": "t3br2if1", "disk": "10G", "mem": 3, "name": "t3_VM3", "vcpu": 2, "vmif": "t3VM3if1"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, {"tenant_ns_if": "t3ns2if", "tenant_ns_ip": "10.2.22.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s2if", "tenant_sub_ip": "10.2.22.2/24"}], "rc": 0, "start": "2019-12-05 17:41:48.524038", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Add IP Route to Tenant] *******************************************************************************************************************************
changed: [99.99.99.2] => (item={u'default_route_ip': u'192.168.131.1', u'name': u't3', u'pns_ip': u'192.168.131.1/24', u'tenant_if': u't3if', u'tenant_ip': u'192.168.131.2/24', u'pns_if': u't3pns_if'}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t3\" ip route show default | grep -w '[d]efault via 192.168.131.1' ; if [ $? -ne 0 ] ; then ip netns exec \"t3\" ip route add default via \"192.168.131.1\" ; fi\n", "delta": "0:00:00.089396", "end": "2019-12-05 17:41:49.158689", "item": {"default_route_ip": "192.168.131.1", "name": "t3", "pns_if": "t3pns_if", "pns_ip": "192.168.131.1/24", "tenant_if": "t3if", "tenant_ip": "192.168.131.2/24"}, "rc": 0, "start": "2019-12-05 17:41:49.069293", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Add IP Route to Tenant Subnet] ************************************************************************************************************************
changed: [99.99.99.2] => (item={u'route': [{u'ip': u'10.2.21.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.2.21.1', u'bridge_name': u't3br1', u'dns': [{u'dnsif': u't3s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't3s1_dnsbrif'}], u'ns_name': u't3ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.21.2/24', u'tenant_ns_ip': u'10.2.21.1/24', u'tenant_ns_if': u't3ns1if', u'tenant_ns_name': u't3', u'tenant_sub_if': u't3s1if'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't3_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't3br1if1', u'vmif': u't3VM4if1'}], u'vxlan': [{u'local_ip': u'10.2.21.2', u'tenant_route_ip': u'192.168.131.2', u'dsport': 4789, u'dev': u't3s1if', u'subnet_route': u'10.2.21.0/24', u'remote_route': u'10.1.21.0/24', u'v_name': u'vxlan_t3s1', u'id': 42, u'remote_ip': u'10.1.21.2'}]}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t3ns1\" ip route show default | grep -w '[d]efault via 10.2.21.1' ; if [ $? -ne 0 ] ; then ip netns exec \"t3ns1\" ip route add default via \"10.2.21.1\" ; fi\n", "delta": "0:00:00.089433", "end": "2019-12-05 17:41:49.650653", "item": {"bridge_name": "t3br1", "default_route_ip": "10.2.21.1", "dns": [{"brif": "t3s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.5", "dnsif": "t3s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t3ns1", "route": [{"if": "p1", "ip": "10.2.21.1/24", "ns_if": "t3if", "ns_name": "t3"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t3ns1if", "tenant_ns_ip": "10.2.21.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s1if", "tenant_sub_ip": "10.2.21.2/24"}], "vms": [{"brif": "t3br1if1", "disk": "10G", "mem": 2, "name": "t3_VM4", "vcpu": 4, "vmif": "t3VM4if1"}], "vxlan": [{"dev": "t3s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.21.2", "remote_ip": "10.1.21.2", "remote_route": "10.1.21.0/24", "subnet_route": "10.2.21.0/24", "tenant_route_ip": "192.168.131.2", "v_name": "vxlan_t3s1"}]}, "rc": 0, "start": "2019-12-05 17:41:49.561220", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}
changed: [99.99.99.2] => (item={u'route': [{u'ip': u'10.2.22.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.2.22.1', u'bridge_name': u't3br2', u'dns': [{u'dnsif': u't3s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't3s2_dnsbrif'}], u'ns_name': u't3ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.22.2/24', u'tenant_ns_ip': u'10.2.22.1/24', u'tenant_ns_if': u't3ns2if', u'tenant_ns_name': u't3', u'tenant_sub_if': u't3s2if'}], u'subnet_ip': u'2.2.2.0/24', u'vms': [{u'mem': 3, u'name': u't3_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't3br2if1', u'vmif': u't3VM3if1'}], u'vxlan': [{u'local_ip': [], u'tenant_route_ip': [], u'dsport': [], u'dev': [], u'subnet_route': [], u'remote_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t3ns2\" ip route show default | grep -w '[d]efault via 10.2.22.1' ; if [ $? -ne 0 ] ; then ip netns exec \"t3ns2\" ip route add default via \"10.2.22.1\" ; fi\n", "delta": "0:00:00.075553", "end": "2019-12-05 17:41:50.042587", "item": {"bridge_name": "t3br2", "default_route_ip": "10.2.22.1", "dns": [{"brif": "t3s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t3s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t3ns2", "route": [{"if": "p1", "ip": "10.2.22.1/24", "ns_if": "t3if", "ns_name": "t3"}], "subnet_ip": "2.2.2.0/24", "tenant_ns": [{"tenant_ns_if": "t3ns2if", "tenant_ns_ip": "10.2.22.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s2if", "tenant_sub_ip": "10.2.22.2/24"}], "vms": [{"brif": "t3br2if1", "disk": "10G", "mem": 3, "name": "t3_VM3", "vcpu": 2, "vmif": "t3VM3if1"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, "rc": 0, "start": "2019-12-05 17:41:49.967034", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Create bridge inside namespace] ***********************************************************************************************************************
changed: [99.99.99.2] => (item={u'route': [{u'ip': u'10.2.21.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.2.21.1', u'bridge_name': u't3br1', u'dns': [{u'dnsif': u't3s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't3s1_dnsbrif'}], u'ns_name': u't3ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.21.2/24', u'tenant_ns_ip': u'10.2.21.1/24', u'tenant_ns_if': u't3ns1if', u'tenant_ns_name': u't3', u'tenant_sub_if': u't3s1if'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't3_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't3br1if1', u'vmif': u't3VM4if1'}], u'vxlan': [{u'local_ip': u'10.2.21.2', u'tenant_route_ip': u'192.168.131.2', u'dsport': 4789, u'dev': u't3s1if', u'subnet_route': u'10.2.21.0/24', u'remote_route': u'10.1.21.0/24', u'v_name': u'vxlan_t3s1', u'id': 42, u'remote_ip': u'10.1.21.2'}]}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t3ns1\" brctl show | grep -w '^t3br1'; if [ $? -ne 0 ] ; then ip netns exec \"t3ns1\" brctl addbr \"t3br1\" ; fi\nip netns exec \"t3ns1\" ip link set dev \"t3br1\" up\n", "delta": "0:00:00.122231", "end": "2019-12-05 17:41:50.558866", "item": {"bridge_name": "t3br1", "default_route_ip": "10.2.21.1", "dns": [{"brif": "t3s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.5", "dnsif": "t3s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t3ns1", "route": [{"if": "p1", "ip": "10.2.21.1/24", "ns_if": "t3if", "ns_name": "t3"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t3ns1if", "tenant_ns_ip": "10.2.21.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s1if", "tenant_sub_ip": "10.2.21.2/24"}], "vms": [{"brif": "t3br1if1", "disk": "10G", "mem": 2, "name": "t3_VM4", "vcpu": 4, "vmif": "t3VM4if1"}], "vxlan": [{"dev": "t3s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.21.2", "remote_ip": "10.1.21.2", "remote_route": "10.1.21.0/24", "subnet_route": "10.2.21.0/24", "tenant_route_ip": "192.168.131.2", "v_name": "vxlan_t3s1"}]}, "rc": 0, "start": "2019-12-05 17:41:50.436635", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}
changed: [99.99.99.2] => (item={u'route': [{u'ip': u'10.2.22.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.2.22.1', u'bridge_name': u't3br2', u'dns': [{u'dnsif': u't3s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't3s2_dnsbrif'}], u'ns_name': u't3ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.22.2/24', u'tenant_ns_ip': u'10.2.22.1/24', u'tenant_ns_if': u't3ns2if', u'tenant_ns_name': u't3', u'tenant_sub_if': u't3s2if'}], u'subnet_ip': u'2.2.2.0/24', u'vms': [{u'mem': 3, u'name': u't3_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't3br2if1', u'vmif': u't3VM3if1'}], u'vxlan': [{u'local_ip': [], u'tenant_route_ip': [], u'dsport': [], u'dev': [], u'subnet_route': [], u'remote_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t3ns2\" brctl show | grep -w '^t3br2'; if [ $? -ne 0 ] ; then ip netns exec \"t3ns2\" brctl addbr \"t3br2\" ; fi\nip netns exec \"t3ns2\" ip link set dev \"t3br2\" up\n", "delta": "0:00:00.117057", "end": "2019-12-05 17:41:51.010796", "item": {"bridge_name": "t3br2", "default_route_ip": "10.2.22.1", "dns": [{"brif": "t3s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t3s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t3ns2", "route": [{"if": "p1", "ip": "10.2.22.1/24", "ns_if": "t3if", "ns_name": "t3"}], "subnet_ip": "2.2.2.0/24", "tenant_ns": [{"tenant_ns_if": "t3ns2if", "tenant_ns_ip": "10.2.22.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s2if", "tenant_sub_ip": "10.2.22.2/24"}], "vms": [{"brif": "t3br2if1", "disk": "10G", "mem": 3, "name": "t3_VM3", "vcpu": 2, "vmif": "t3VM3if1"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, "rc": 0, "start": "2019-12-05 17:41:50.893739", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Create DNS VETH Pair] *********************************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.21.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.2.21.1', u'bridge_name': u't3br1', u'ns_name': u't3ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.21.2/24', u'tenant_ns_ip': u'10.2.21.1/24', u'tenant_ns_if': u't3ns1if', u'tenant_sub_if': u't3s1if', u'tenant_ns_name': u't3'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't3_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't3br1if1', u'vmif': u't3VM4if1'}], u'vxlan': [{u'local_ip': u'10.2.21.2', u'dsport': 4789, u'dev': u't3s1if', u'tenant_route_ip': u'192.168.131.2', u'remote_route': u'10.1.21.0/24', u'subnet_route': u'10.2.21.0/24', u'v_name': u'vxlan_t3s1', u'id': 42, u'remote_ip': u'10.1.21.2'}]}, {u'dnsif': u't3s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't3s1_dnsbrif'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t3ns1\" ip link show \"t3s1_dnsbrif\" ; if [ $? -ne 0 ] ; then ip netns exec \"t3ns1\" ip link add \"t3s1_dnsbrif\" type veth peer name \"t3s1_dnsif\" ; fi\nip netns exec \"t3ns1\" ip link set dev \"t3s1_dnsbrif\" up\nip netns exec \"t3ns1\" ip link set dev \"t3s1_dnsif\" up\n", "delta": "0:00:00.159928", "end": "2019-12-05 17:41:51.590777", "item": [{"bridge_name": "t3br1", "default_route_ip": "10.2.21.1", "ns_name": "t3ns1", "route": [{"if": "p1", "ip": "10.2.21.1/24", "ns_if": "t3if", "ns_name": "t3"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t3ns1if", "tenant_ns_ip": "10.2.21.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s1if", "tenant_sub_ip": "10.2.21.2/24"}], "vms": [{"brif": "t3br1if1", "disk": "10G", "mem": 2, "name": "t3_VM4", "vcpu": 4, "vmif": "t3VM4if1"}], "vxlan": [{"dev": "t3s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.21.2", "remote_ip": "10.1.21.2", "remote_route": "10.1.21.0/24", "subnet_route": "10.2.21.0/24", "tenant_route_ip": "192.168.131.2", "v_name": "vxlan_t3s1"}]}, {"brif": "t3s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.5", "dnsif": "t3s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "rc": 0, "start": "2019-12-05 17:41:51.430849", "stderr": "Device \"t3s1_dnsbrif\" does not exist.", "stderr_lines": ["Device \"t3s1_dnsbrif\" does not exist."], "stdout": "", "stdout_lines": []}
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.22.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.2.22.1', u'bridge_name': u't3br2', u'ns_name': u't3ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.22.2/24', u'tenant_ns_ip': u'10.2.22.1/24', u'tenant_ns_if': u't3ns2if', u'tenant_sub_if': u't3s2if', u'tenant_ns_name': u't3'}], u'subnet_ip': u'2.2.2.0/24', u'vms': [{u'mem': 3, u'name': u't3_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't3br2if1', u'vmif': u't3VM3if1'}], u'vxlan': [{u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}, {u'dnsif': u't3s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't3s2_dnsbrif'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t3ns2\" ip link show \"t3s2_dnsbrif\" ; if [ $? -ne 0 ] ; then ip netns exec \"t3ns2\" ip link add \"t3s2_dnsbrif\" type veth peer name \"t3s2_dnsif\" ; fi\nip netns exec \"t3ns2\" ip link set dev \"t3s2_dnsbrif\" up\nip netns exec \"t3ns2\" ip link set dev \"t3s2_dnsif\" up\n", "delta": "0:00:00.143656", "end": "2019-12-05 17:41:52.090641", "item": [{"bridge_name": "t3br2", "default_route_ip": "10.2.22.1", "ns_name": "t3ns2", "route": [{"if": "p1", "ip": "10.2.22.1/24", "ns_if": "t3if", "ns_name": "t3"}], "subnet_ip": "2.2.2.0/24", "tenant_ns": [{"tenant_ns_if": "t3ns2if", "tenant_ns_ip": "10.2.22.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s2if", "tenant_sub_ip": "10.2.22.2/24"}], "vms": [{"brif": "t3br2if1", "disk": "10G", "mem": 3, "name": "t3_VM3", "vcpu": 2, "vmif": "t3VM3if1"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, {"brif": "t3s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t3s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "rc": 0, "start": "2019-12-05 17:41:51.946985", "stderr": "Device \"t3s2_dnsbrif\" does not exist.", "stderr_lines": ["Device \"t3s2_dnsbrif\" does not exist."], "stdout": "", "stdout_lines": []}

TASK [Attach DNS VETH Pair] *********************************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.21.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.2.21.1', u'bridge_name': u't3br1', u'ns_name': u't3ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.21.2/24', u'tenant_ns_ip': u'10.2.21.1/24', u'tenant_ns_if': u't3ns1if', u'tenant_sub_if': u't3s1if', u'tenant_ns_name': u't3'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't3_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't3br1if1', u'vmif': u't3VM4if1'}], u'vxlan': [{u'local_ip': u'10.2.21.2', u'dsport': 4789, u'dev': u't3s1if', u'tenant_route_ip': u'192.168.131.2', u'remote_route': u'10.1.21.0/24', u'subnet_route': u'10.2.21.0/24', u'v_name': u'vxlan_t3s1', u'id': 42, u'remote_ip': u'10.1.21.2'}]}, {u'dnsif': u't3s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't3s1_dnsbrif'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t3ns1\" brctl show \"t3br1\" | grep -w 't3s1_dnsbrif' ; if [ $? -ne 0 ] ; then ip netns exec \"t3ns1\" brctl addif \"t3br1\" \"t3s1_dnsbrif\" ; fi\n", "delta": "0:00:00.074217", "end": "2019-12-05 17:41:52.582636", "item": [{"bridge_name": "t3br1", "default_route_ip": "10.2.21.1", "ns_name": "t3ns1", "route": [{"if": "p1", "ip": "10.2.21.1/24", "ns_if": "t3if", "ns_name": "t3"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t3ns1if", "tenant_ns_ip": "10.2.21.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s1if", "tenant_sub_ip": "10.2.21.2/24"}], "vms": [{"brif": "t3br1if1", "disk": "10G", "mem": 2, "name": "t3_VM4", "vcpu": 4, "vmif": "t3VM4if1"}], "vxlan": [{"dev": "t3s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.21.2", "remote_ip": "10.1.21.2", "remote_route": "10.1.21.0/24", "subnet_route": "10.2.21.0/24", "tenant_route_ip": "192.168.131.2", "v_name": "vxlan_t3s1"}]}, {"brif": "t3s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.5", "dnsif": "t3s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "rc": 0, "start": "2019-12-05 17:41:52.508419", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.22.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.2.22.1', u'bridge_name': u't3br2', u'ns_name': u't3ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.22.2/24', u'tenant_ns_ip': u'10.2.22.1/24', u'tenant_ns_if': u't3ns2if', u'tenant_sub_if': u't3s2if', u'tenant_ns_name': u't3'}], u'subnet_ip': u'2.2.2.0/24', u'vms': [{u'mem': 3, u'name': u't3_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't3br2if1', u'vmif': u't3VM3if1'}], u'vxlan': [{u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}, {u'dnsif': u't3s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't3s2_dnsbrif'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t3ns2\" brctl show \"t3br2\" | grep -w 't3s2_dnsbrif' ; if [ $? -ne 0 ] ; then ip netns exec \"t3ns2\" brctl addif \"t3br2\" \"t3s2_dnsbrif\" ; fi\n", "delta": "0:00:00.076901", "end": "2019-12-05 17:41:52.994678", "item": [{"bridge_name": "t3br2", "default_route_ip": "10.2.22.1", "ns_name": "t3ns2", "route": [{"if": "p1", "ip": "10.2.22.1/24", "ns_if": "t3if", "ns_name": "t3"}], "subnet_ip": "2.2.2.0/24", "tenant_ns": [{"tenant_ns_if": "t3ns2if", "tenant_ns_ip": "10.2.22.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s2if", "tenant_sub_ip": "10.2.22.2/24"}], "vms": [{"brif": "t3br2if1", "disk": "10G", "mem": 3, "name": "t3_VM3", "vcpu": 2, "vmif": "t3VM3if1"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, {"brif": "t3s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t3s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "rc": 0, "start": "2019-12-05 17:41:52.917777", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Create VETH Pairs] ************************************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.21.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.2.21.1', u'bridge_name': u't3br1', u'dns': [{u'dnsif': u't3s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't3s1_dnsbrif'}], u'ns_name': u't3ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.21.2/24', u'tenant_ns_ip': u'10.2.21.1/24', u'tenant_ns_if': u't3ns1if', u'tenant_sub_if': u't3s1if', u'tenant_ns_name': u't3'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.2.21.2', u'dsport': 4789, u'dev': u't3s1if', u'tenant_route_ip': u'192.168.131.2', u'remote_route': u'10.1.21.0/24', u'subnet_route': u'10.2.21.0/24', u'v_name': u'vxlan_t3s1', u'id': 42, u'remote_ip': u'10.1.21.2'}]}, {u'mem': 2, u'name': u't3_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't3br1if1', u'vmif': u't3VM4if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip link show \"t3br1if1\" ; if [ $? -ne 0 ] ; then ip link add \"t3VM4if1\" type veth peer name \"t3br1if1\" ; fi\nip link set dev \"t3br1if1\" up\nip link set dev \"t3VM4if1\" up\n", "delta": "0:00:00.019570", "end": "2019-12-05 17:41:53.412448", "item": [{"bridge_name": "t3br1", "default_route_ip": "10.2.21.1", "dns": [{"brif": "t3s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.5", "dnsif": "t3s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t3ns1", "route": [{"if": "p1", "ip": "10.2.21.1/24", "ns_if": "t3if", "ns_name": "t3"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t3ns1if", "tenant_ns_ip": "10.2.21.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s1if", "tenant_sub_ip": "10.2.21.2/24"}], "vxlan": [{"dev": "t3s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.21.2", "remote_ip": "10.1.21.2", "remote_route": "10.1.21.0/24", "subnet_route": "10.2.21.0/24", "tenant_route_ip": "192.168.131.2", "v_name": "vxlan_t3s1"}]}, {"brif": "t3br1if1", "disk": "10G", "mem": 2, "name": "t3_VM4", "vcpu": 4, "vmif": "t3VM4if1"}], "rc": 0, "start": "2019-12-05 17:41:53.392878", "stderr": "Device \"t3br1if1\" does not exist.", "stderr_lines": ["Device \"t3br1if1\" does not exist."], "stdout": "", "stdout_lines": []}
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.22.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.2.22.1', u'bridge_name': u't3br2', u'dns': [{u'dnsif': u't3s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't3s2_dnsbrif'}], u'ns_name': u't3ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.22.2/24', u'tenant_ns_ip': u'10.2.22.1/24', u'tenant_ns_if': u't3ns2if', u'tenant_sub_if': u't3s2if', u'tenant_ns_name': u't3'}], u'subnet_ip': u'2.2.2.0/24', u'vxlan': [{u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}, {u'mem': 3, u'name': u't3_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't3br2if1', u'vmif': u't3VM3if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip link show \"t3br2if1\" ; if [ $? -ne 0 ] ; then ip link add \"t3VM3if1\" type veth peer name \"t3br2if1\" ; fi\nip link set dev \"t3br2if1\" up\nip link set dev \"t3VM3if1\" up\n", "delta": "0:00:00.016784", "end": "2019-12-05 17:41:53.781342", "item": [{"bridge_name": "t3br2", "default_route_ip": "10.2.22.1", "dns": [{"brif": "t3s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t3s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t3ns2", "route": [{"if": "p1", "ip": "10.2.22.1/24", "ns_if": "t3if", "ns_name": "t3"}], "subnet_ip": "2.2.2.0/24", "tenant_ns": [{"tenant_ns_if": "t3ns2if", "tenant_ns_ip": "10.2.22.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s2if", "tenant_sub_ip": "10.2.22.2/24"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, {"brif": "t3br2if1", "disk": "10G", "mem": 3, "name": "t3_VM3", "vcpu": 2, "vmif": "t3VM3if1"}], "rc": 0, "start": "2019-12-05 17:41:53.764558", "stderr": "Device \"t3br2if1\" does not exist.", "stderr_lines": ["Device \"t3br2if1\" does not exist."], "stdout": "", "stdout_lines": []}

TASK [Attach VETH Pairs] ************************************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.21.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.2.21.1', u'bridge_name': u't3br1', u'dns': [{u'dnsif': u't3s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't3s1_dnsbrif'}], u'ns_name': u't3ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.21.2/24', u'tenant_ns_ip': u'10.2.21.1/24', u'tenant_ns_if': u't3ns1if', u'tenant_sub_if': u't3s1if', u'tenant_ns_name': u't3'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.2.21.2', u'dsport': 4789, u'dev': u't3s1if', u'tenant_route_ip': u'192.168.131.2', u'remote_route': u'10.1.21.0/24', u'subnet_route': u'10.2.21.0/24', u'v_name': u'vxlan_t3s1', u'id': 42, u'remote_ip': u'10.1.21.2'}]}, {u'mem': 2, u'name': u't3_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't3br1if1', u'vmif': u't3VM4if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip link show \"t3br1if1\" ; if [ $? -eq 0 ] ; then ip link set \"t3br1if1\" netns \"t3ns1\" ; fi\nip netns exec \"t3ns1\" brctl show \"t3br1\" | grep -w 't3br1if1' ; if [ $? -ne 0 ] ; then ip netns exec \"t3ns1\" brctl addif \"t3br1\" \"t3br1if1\" ; fi\n", "delta": "0:00:00.098089", "end": "2019-12-05 17:41:54.290550", "item": [{"bridge_name": "t3br1", "default_route_ip": "10.2.21.1", "dns": [{"brif": "t3s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.5", "dnsif": "t3s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t3ns1", "route": [{"if": "p1", "ip": "10.2.21.1/24", "ns_if": "t3if", "ns_name": "t3"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t3ns1if", "tenant_ns_ip": "10.2.21.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s1if", "tenant_sub_ip": "10.2.21.2/24"}], "vxlan": [{"dev": "t3s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.21.2", "remote_ip": "10.1.21.2", "remote_route": "10.1.21.0/24", "subnet_route": "10.2.21.0/24", "tenant_route_ip": "192.168.131.2", "v_name": "vxlan_t3s1"}]}, {"brif": "t3br1if1", "disk": "10G", "mem": 2, "name": "t3_VM4", "vcpu": 4, "vmif": "t3VM4if1"}], "rc": 0, "start": "2019-12-05 17:41:54.192461", "stderr": "", "stderr_lines": [], "stdout": "21: t3br1if1@t3VM4if1: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP mode DEFAULT group default qlen 1000\n    link/ether e6:85:69:3b:f6:56 brd ff:ff:ff:ff:ff:ff", "stdout_lines": ["21: t3br1if1@t3VM4if1: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP mode DEFAULT group default qlen 1000", "    link/ether e6:85:69:3b:f6:56 brd ff:ff:ff:ff:ff:ff"]}
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.22.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.2.22.1', u'bridge_name': u't3br2', u'dns': [{u'dnsif': u't3s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't3s2_dnsbrif'}], u'ns_name': u't3ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.22.2/24', u'tenant_ns_ip': u'10.2.22.1/24', u'tenant_ns_if': u't3ns2if', u'tenant_sub_if': u't3s2if', u'tenant_ns_name': u't3'}], u'subnet_ip': u'2.2.2.0/24', u'vxlan': [{u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}, {u'mem': 3, u'name': u't3_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't3br2if1', u'vmif': u't3VM3if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip link show \"t3br2if1\" ; if [ $? -eq 0 ] ; then ip link set \"t3br2if1\" netns \"t3ns2\" ; fi\nip netns exec \"t3ns2\" brctl show \"t3br2\" | grep -w 't3br2if1' ; if [ $? -ne 0 ] ; then ip netns exec \"t3ns2\" brctl addif \"t3br2\" \"t3br2if1\" ; fi\n", "delta": "0:00:00.127413", "end": "2019-12-05 17:41:54.758599", "item": [{"bridge_name": "t3br2", "default_route_ip": "10.2.22.1", "dns": [{"brif": "t3s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t3s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t3ns2", "route": [{"if": "p1", "ip": "10.2.22.1/24", "ns_if": "t3if", "ns_name": "t3"}], "subnet_ip": "2.2.2.0/24", "tenant_ns": [{"tenant_ns_if": "t3ns2if", "tenant_ns_ip": "10.2.22.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s2if", "tenant_sub_ip": "10.2.22.2/24"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, {"brif": "t3br2if1", "disk": "10G", "mem": 3, "name": "t3_VM3", "vcpu": 2, "vmif": "t3VM3if1"}], "rc": 0, "start": "2019-12-05 17:41:54.631186", "stderr": "", "stderr_lines": [], "stdout": "23: t3br2if1@t3VM3if1: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP mode DEFAULT group default qlen 1000\n    link/ether b6:8a:de:26:32:d0 brd ff:ff:ff:ff:ff:ff", "stdout_lines": ["23: t3br2if1@t3VM3if1: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP mode DEFAULT group default qlen 1000", "    link/ether b6:8a:de:26:32:d0 brd ff:ff:ff:ff:ff:ff"]}

TASK [All interfaces and bridges UP] ************************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.21.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.2.21.1', u'bridge_name': u't3br1', u'dns': [{u'dnsif': u't3s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't3s1_dnsbrif'}], u'ns_name': u't3ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.21.2/24', u'tenant_ns_ip': u'10.2.21.1/24', u'tenant_ns_if': u't3ns1if', u'tenant_sub_if': u't3s1if', u'tenant_ns_name': u't3'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.2.21.2', u'dsport': 4789, u'dev': u't3s1if', u'tenant_route_ip': u'192.168.131.2', u'remote_route': u'10.1.21.0/24', u'subnet_route': u'10.2.21.0/24', u'v_name': u'vxlan_t3s1', u'id': 42, u'remote_ip': u'10.1.21.2'}]}, {u'mem': 2, u'name': u't3_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't3br1if1', u'vmif': u't3VM4if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t3ns1\" ip link set \"t3br1if1\" up\nip netns exec \"t3ns1\" ip link set dev \"t3br1\" up\n", "delta": "0:00:00.079153", "end": "2019-12-05 17:41:55.242499", "item": [{"bridge_name": "t3br1", "default_route_ip": "10.2.21.1", "dns": [{"brif": "t3s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.5", "dnsif": "t3s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t3ns1", "route": [{"if": "p1", "ip": "10.2.21.1/24", "ns_if": "t3if", "ns_name": "t3"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t3ns1if", "tenant_ns_ip": "10.2.21.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s1if", "tenant_sub_ip": "10.2.21.2/24"}], "vxlan": [{"dev": "t3s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.21.2", "remote_ip": "10.1.21.2", "remote_route": "10.1.21.0/24", "subnet_route": "10.2.21.0/24", "tenant_route_ip": "192.168.131.2", "v_name": "vxlan_t3s1"}]}, {"brif": "t3br1if1", "disk": "10G", "mem": 2, "name": "t3_VM4", "vcpu": 4, "vmif": "t3VM4if1"}], "rc": 0, "start": "2019-12-05 17:41:55.163346", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.22.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.2.22.1', u'bridge_name': u't3br2', u'dns': [{u'dnsif': u't3s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't3s2_dnsbrif'}], u'ns_name': u't3ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.22.2/24', u'tenant_ns_ip': u'10.2.22.1/24', u'tenant_ns_if': u't3ns2if', u'tenant_sub_if': u't3s2if', u'tenant_ns_name': u't3'}], u'subnet_ip': u'2.2.2.0/24', u'vxlan': [{u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}, {u'mem': 3, u'name': u't3_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't3br2if1', u'vmif': u't3VM3if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t3ns2\" ip link set \"t3br2if1\" up\nip netns exec \"t3ns2\" ip link set dev \"t3br2\" up\n", "delta": "0:00:00.077507", "end": "2019-12-05 17:41:55.670684", "item": [{"bridge_name": "t3br2", "default_route_ip": "10.2.22.1", "dns": [{"brif": "t3s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t3s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t3ns2", "route": [{"if": "p1", "ip": "10.2.22.1/24", "ns_if": "t3if", "ns_name": "t3"}], "subnet_ip": "2.2.2.0/24", "tenant_ns": [{"tenant_ns_if": "t3ns2if", "tenant_ns_ip": "10.2.22.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s2if", "tenant_sub_ip": "10.2.22.2/24"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, {"brif": "t3br2if1", "disk": "10G", "mem": 3, "name": "t3_VM3", "vcpu": 2, "vmif": "t3VM3if1"}], "rc": 0, "start": "2019-12-05 17:41:55.593177", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Add IP to DNS Interface] ******************************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.21.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.2.21.1', u'bridge_name': u't3br1', u'ns_name': u't3ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.21.2/24', u'tenant_ns_ip': u'10.2.21.1/24', u'tenant_ns_if': u't3ns1if', u'tenant_sub_if': u't3s1if', u'tenant_ns_name': u't3'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't3_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't3br1if1', u'vmif': u't3VM4if1'}], u'vxlan': [{u'local_ip': u'10.2.21.2', u'dsport': 4789, u'dev': u't3s1if', u'tenant_route_ip': u'192.168.131.2', u'remote_route': u'10.1.21.0/24', u'subnet_route': u'10.2.21.0/24', u'v_name': u'vxlan_t3s1', u'id': 42, u'remote_ip': u'10.1.21.2'}]}, {u'dnsif': u't3s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't3s1_dnsbrif'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t3ns1\" ip addr show \"t3s1_dnsif\" | awk 'FNR==3{ print $2}'| grep -w '^1.1.1.1/24' ; if [ $? -ne 0 ] ; then ip netns exec \"t3ns1\" ip addr add \"1.1.1.1/24\" dev \"t3s1_dnsif\" ; fi\n", "delta": "0:00:00.093415", "end": "2019-12-05 17:41:56.166837", "item": [{"bridge_name": "t3br1", "default_route_ip": "10.2.21.1", "ns_name": "t3ns1", "route": [{"if": "p1", "ip": "10.2.21.1/24", "ns_if": "t3if", "ns_name": "t3"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t3ns1if", "tenant_ns_ip": "10.2.21.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s1if", "tenant_sub_ip": "10.2.21.2/24"}], "vms": [{"brif": "t3br1if1", "disk": "10G", "mem": 2, "name": "t3_VM4", "vcpu": 4, "vmif": "t3VM4if1"}], "vxlan": [{"dev": "t3s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.21.2", "remote_ip": "10.1.21.2", "remote_route": "10.1.21.0/24", "subnet_route": "10.2.21.0/24", "tenant_route_ip": "192.168.131.2", "v_name": "vxlan_t3s1"}]}, {"brif": "t3s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.5", "dnsif": "t3s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "rc": 0, "start": "2019-12-05 17:41:56.073422", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.22.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.2.22.1', u'bridge_name': u't3br2', u'ns_name': u't3ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.22.2/24', u'tenant_ns_ip': u'10.2.22.1/24', u'tenant_ns_if': u't3ns2if', u'tenant_sub_if': u't3s2if', u'tenant_ns_name': u't3'}], u'subnet_ip': u'2.2.2.0/24', u'vms': [{u'mem': 3, u'name': u't3_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't3br2if1', u'vmif': u't3VM3if1'}], u'vxlan': [{u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}, {u'dnsif': u't3s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't3s2_dnsbrif'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t3ns2\" ip addr show \"t3s2_dnsif\" | awk 'FNR==3{ print $2}'| grep -w '^2.2.2.1/24' ; if [ $? -ne 0 ] ; then ip netns exec \"t3ns2\" ip addr add \"2.2.2.1/24\" dev \"t3s2_dnsif\" ; fi\n", "delta": "0:00:00.084178", "end": "2019-12-05 17:41:56.582644", "item": [{"bridge_name": "t3br2", "default_route_ip": "10.2.22.1", "ns_name": "t3ns2", "route": [{"if": "p1", "ip": "10.2.22.1/24", "ns_if": "t3if", "ns_name": "t3"}], "subnet_ip": "2.2.2.0/24", "tenant_ns": [{"tenant_ns_if": "t3ns2if", "tenant_ns_ip": "10.2.22.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s2if", "tenant_sub_ip": "10.2.22.2/24"}], "vms": [{"brif": "t3br2if1", "disk": "10G", "mem": 3, "name": "t3_VM3", "vcpu": 2, "vmif": "t3VM3if1"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, {"brif": "t3s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t3s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "rc": 0, "start": "2019-12-05 17:41:56.498466", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Install DHCP Server] **********************************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.21.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.2.21.1', u'bridge_name': u't3br1', u'ns_name': u't3ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.21.2/24', u'tenant_ns_ip': u'10.2.21.1/24', u'tenant_ns_if': u't3ns1if', u'tenant_sub_if': u't3s1if', u'tenant_ns_name': u't3'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't3_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't3br1if1', u'vmif': u't3VM4if1'}], u'vxlan': [{u'local_ip': u'10.2.21.2', u'dsport': 4789, u'dev': u't3s1if', u'tenant_route_ip': u'192.168.131.2', u'remote_route': u'10.1.21.0/24', u'subnet_route': u'10.2.21.0/24', u'v_name': u'vxlan_t3s1', u'id': 42, u'remote_ip': u'10.1.21.2'}]}, {u'dnsif': u't3s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't3s1_dnsbrif'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t3ns1\" ps aux | grep -w '[d]nsmasq --interface t3s1_dnsif -z --dhcp-range=1.1.1.5,1.1.1.254' ; if [ $? -ne 0 ] ; then ip netns exec \"t3ns1\" dnsmasq --interface \"t3s1_dnsif\" -z --dhcp-range=1.1.1.5,'1.1.1.254' ; fi\n", "delta": "0:00:00.066644", "end": "2019-12-05 17:41:57.067427", "item": [{"bridge_name": "t3br1", "default_route_ip": "10.2.21.1", "ns_name": "t3ns1", "route": [{"if": "p1", "ip": "10.2.21.1/24", "ns_if": "t3if", "ns_name": "t3"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t3ns1if", "tenant_ns_ip": "10.2.21.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s1if", "tenant_sub_ip": "10.2.21.2/24"}], "vms": [{"brif": "t3br1if1", "disk": "10G", "mem": 2, "name": "t3_VM4", "vcpu": 4, "vmif": "t3VM4if1"}], "vxlan": [{"dev": "t3s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.21.2", "remote_ip": "10.1.21.2", "remote_route": "10.1.21.0/24", "subnet_route": "10.2.21.0/24", "tenant_route_ip": "192.168.131.2", "v_name": "vxlan_t3s1"}]}, {"brif": "t3s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.5", "dnsif": "t3s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "rc": 0, "start": "2019-12-05 17:41:57.000783", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.22.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.2.22.1', u'bridge_name': u't3br2', u'ns_name': u't3ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.22.2/24', u'tenant_ns_ip': u'10.2.22.1/24', u'tenant_ns_if': u't3ns2if', u'tenant_sub_if': u't3s2if', u'tenant_ns_name': u't3'}], u'subnet_ip': u'2.2.2.0/24', u'vms': [{u'mem': 3, u'name': u't3_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't3br2if1', u'vmif': u't3VM3if1'}], u'vxlan': [{u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}, {u'dnsif': u't3s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't3s2_dnsbrif'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t3ns2\" ps aux | grep -w '[d]nsmasq --interface t3s2_dnsif -z --dhcp-range=2.2.2.5,2.2.2.254' ; if [ $? -ne 0 ] ; then ip netns exec \"t3ns2\" dnsmasq --interface \"t3s2_dnsif\" -z --dhcp-range=2.2.2.5,'2.2.2.254' ; fi\n", "delta": "0:00:00.065520", "end": "2019-12-05 17:41:57.474935", "item": [{"bridge_name": "t3br2", "default_route_ip": "10.2.22.1", "ns_name": "t3ns2", "route": [{"if": "p1", "ip": "10.2.22.1/24", "ns_if": "t3if", "ns_name": "t3"}], "subnet_ip": "2.2.2.0/24", "tenant_ns": [{"tenant_ns_if": "t3ns2if", "tenant_ns_ip": "10.2.22.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s2if", "tenant_sub_ip": "10.2.22.2/24"}], "vms": [{"brif": "t3br2if1", "disk": "10G", "mem": 3, "name": "t3_VM3", "vcpu": 2, "vmif": "t3VM3if1"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, {"brif": "t3s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t3s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "rc": 0, "start": "2019-12-05 17:41:57.409415", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Create VXLAN devices] *********************************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.21.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.2.21.1', u'bridge_name': u't3br1', u'dns': [{u'dnsif': u't3s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't3s1_dnsbrif'}], u'ns_name': u't3ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.21.2/24', u'tenant_ns_ip': u'10.2.21.1/24', u'tenant_ns_if': u't3ns1if', u'tenant_sub_if': u't3s1if', u'tenant_ns_name': u't3'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't3_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't3br1if1', u'vmif': u't3VM4if1'}]}, {u'local_ip': u'10.2.21.2', u'dsport': 4789, u'dev': u't3s1if', u'tenant_route_ip': u'192.168.131.2', u'remote_route': u'10.1.21.0/24', u'subnet_route': u'10.2.21.0/24', u'v_name': u'vxlan_t3s1', u'id': 42, u'remote_ip': u'10.1.21.2'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t3ns1\" ip link show \"vxlan_t3s1\" ; if [ $? -ne 0 ] ; then ip netns exec \"t3ns1\" ip link add \"vxlan_t3s1\" type vxlan id \"42\" local \"10.2.21.2\" remote \"10.1.21.2\" dstport \"4789\" dev \"t3s1if\" ; ip netns exec \"t3ns1\" ip link set dev \"vxlan_t3s1\" up ; fi\n", "delta": "0:00:00.146139", "end": "2019-12-05 17:41:58.042745", "item": [{"bridge_name": "t3br1", "default_route_ip": "10.2.21.1", "dns": [{"brif": "t3s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.5", "dnsif": "t3s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t3ns1", "route": [{"if": "p1", "ip": "10.2.21.1/24", "ns_if": "t3if", "ns_name": "t3"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t3ns1if", "tenant_ns_ip": "10.2.21.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s1if", "tenant_sub_ip": "10.2.21.2/24"}], "vms": [{"brif": "t3br1if1", "disk": "10G", "mem": 2, "name": "t3_VM4", "vcpu": 4, "vmif": "t3VM4if1"}]}, {"dev": "t3s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.21.2", "remote_ip": "10.1.21.2", "remote_route": "10.1.21.0/24", "subnet_route": "10.2.21.0/24", "tenant_route_ip": "192.168.131.2", "v_name": "vxlan_t3s1"}], "rc": 0, "start": "2019-12-05 17:41:57.896606", "stderr": "Device \"vxlan_t3s1\" does not exist.", "stderr_lines": ["Device \"vxlan_t3s1\" does not exist."], "stdout": "", "stdout_lines": []}
skipping: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.22.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.2.22.1', u'bridge_name': u't3br2', u'dns': [{u'dnsif': u't3s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't3s2_dnsbrif'}], u'ns_name': u't3ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.22.2/24', u'tenant_ns_ip': u'10.2.22.1/24', u'tenant_ns_if': u't3ns2if', u'tenant_sub_if': u't3s2if', u'tenant_ns_name': u't3'}], u'subnet_ip': u'2.2.2.0/24', u'vms': [{u'mem': 3, u'name': u't3_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't3br2if1', u'vmif': u't3VM3if1'}]}, {u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}])  => {"ansible_loop_var": "item", "changed": false, "item": [{"bridge_name": "t3br2", "default_route_ip": "10.2.22.1", "dns": [{"brif": "t3s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t3s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t3ns2", "route": [{"if": "p1", "ip": "10.2.22.1/24", "ns_if": "t3if", "ns_name": "t3"}], "subnet_ip": "2.2.2.0/24", "tenant_ns": [{"tenant_ns_if": "t3ns2if", "tenant_ns_ip": "10.2.22.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s2if", "tenant_sub_ip": "10.2.22.2/24"}], "vms": [{"brif": "t3br2if1", "disk": "10G", "mem": 3, "name": "t3_VM3", "vcpu": 2, "vmif": "t3VM3if1"}]}, {"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}], "skip_reason": "Conditional result was False"}

TASK [Attach VXLANs to bridge] ******************************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.21.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.2.21.1', u'bridge_name': u't3br1', u'dns': [{u'dnsif': u't3s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't3s1_dnsbrif'}], u'ns_name': u't3ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.21.2/24', u'tenant_ns_ip': u'10.2.21.1/24', u'tenant_ns_if': u't3ns1if', u'tenant_sub_if': u't3s1if', u'tenant_ns_name': u't3'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't3_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't3br1if1', u'vmif': u't3VM4if1'}]}, {u'local_ip': u'10.2.21.2', u'dsport': 4789, u'dev': u't3s1if', u'tenant_route_ip': u'192.168.131.2', u'remote_route': u'10.1.21.0/24', u'subnet_route': u'10.2.21.0/24', u'v_name': u'vxlan_t3s1', u'id': 42, u'remote_ip': u'10.1.21.2'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t3ns1\" brctl show \"t3br1\" | grep -w 'vxlan_t3s1' ; if [ $? -ne 0 ] ; then ip netns exec \"t3ns1\" brctl addif \"t3br1\" \"vxlan_t3s1\" ; fi\n", "delta": "0:00:00.065319", "end": "2019-12-05 17:41:58.558635", "item": [{"bridge_name": "t3br1", "default_route_ip": "10.2.21.1", "dns": [{"brif": "t3s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.5", "dnsif": "t3s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t3ns1", "route": [{"if": "p1", "ip": "10.2.21.1/24", "ns_if": "t3if", "ns_name": "t3"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t3ns1if", "tenant_ns_ip": "10.2.21.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s1if", "tenant_sub_ip": "10.2.21.2/24"}], "vms": [{"brif": "t3br1if1", "disk": "10G", "mem": 2, "name": "t3_VM4", "vcpu": 4, "vmif": "t3VM4if1"}]}, {"dev": "t3s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.21.2", "remote_ip": "10.1.21.2", "remote_route": "10.1.21.0/24", "subnet_route": "10.2.21.0/24", "tenant_route_ip": "192.168.131.2", "v_name": "vxlan_t3s1"}], "rc": 0, "start": "2019-12-05 17:41:58.493316", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}
skipping: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.22.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.2.22.1', u'bridge_name': u't3br2', u'dns': [{u'dnsif': u't3s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't3s2_dnsbrif'}], u'ns_name': u't3ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.22.2/24', u'tenant_ns_ip': u'10.2.22.1/24', u'tenant_ns_if': u't3ns2if', u'tenant_sub_if': u't3s2if', u'tenant_ns_name': u't3'}], u'subnet_ip': u'2.2.2.0/24', u'vms': [{u'mem': 3, u'name': u't3_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't3br2if1', u'vmif': u't3VM3if1'}]}, {u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}])  => {"ansible_loop_var": "item", "changed": false, "item": [{"bridge_name": "t3br2", "default_route_ip": "10.2.22.1", "dns": [{"brif": "t3s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t3s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t3ns2", "route": [{"if": "p1", "ip": "10.2.22.1/24", "ns_if": "t3if", "ns_name": "t3"}], "subnet_ip": "2.2.2.0/24", "tenant_ns": [{"tenant_ns_if": "t3ns2if", "tenant_ns_ip": "10.2.22.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s2if", "tenant_sub_ip": "10.2.22.2/24"}], "vms": [{"brif": "t3br2if1", "disk": "10G", "mem": 3, "name": "t3_VM3", "vcpu": 2, "vmif": "t3VM3if1"}]}, {"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}], "skip_reason": "Conditional result was False"}

PLAY RECAP **************************************************************************************************************************************************
99.99.99.2                 : ok=21   changed=21   unreachable=0    failed=0    skipped=0    rescued=0    ignored=0   

Using /etc/ansible/ansible.cfg as config file

PLAY [main] *************************************************************************************************************************************************

TASK [Add VXLAN routes in PNS] ******************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.21.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.1.21.1', u'bridge_name': u't3br1', u'dns': [{u'dnsif': u't3s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't3s1_dnsbrif'}], u'ns_name': u't3ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.21.2/24', u'tenant_ns_ip': u'10.1.21.1/24', u'tenant_ns_if': u't3ns1if', u'tenant_sub_if': u't3s1if', u'tenant_ns_name': u't3'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't3_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't3br1if1', u'vmif': u't3VM1if1'}, {u'mem': 4, u'name': u't3_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't3br1if2', u'vmif': u't3VM2if1'}]}, {u'local_ip': u'10.1.21.2', u'dsport': 4789, u'dev': u't3s1if', u'tenant_route_ip': u'192.168.3.2', u'remote_route': u'10.2.21.0/24', u'subnet_route': u'10.1.21.0/24', u'v_name': u'vxlan_t3s1', u'id': 42, u'remote_ip': u'10.2.21.2'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec pns ip route show \"10.1.21.0/24\" via \"192.168.3.2\" | grep -w '^10.1.21.0/24' ; if [ $? -ne 0 ] ; then ip netns exec pns ip route add \"10.1.21.0/24\" via \"192.168.3.2\" ; fi\n", "delta": "0:00:00.082048", "end": "2019-12-05 17:41:59.763012", "item": [{"bridge_name": "t3br1", "default_route_ip": "10.1.21.1", "dns": [{"brif": "t3s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.5", "dnsif": "t3s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t3ns1", "route": [{"if": "p1", "ip": "10.1.21.1/24", "ns_if": "t3if", "ns_name": "t3"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t3ns1if", "tenant_ns_ip": "10.1.21.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s1if", "tenant_sub_ip": "10.1.21.2/24"}], "vms": [{"brif": "t3br1if1", "disk": "10G", "mem": 2, "name": "t3_VM1", "vcpu": 4, "vmif": "t3VM1if1"}, {"brif": "t3br1if2", "disk": "10G", "mem": 4, "name": "t3_VM2", "vcpu": 2, "vmif": "t3VM2if1"}]}, {"dev": "t3s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.21.2", "remote_ip": "10.2.21.2", "remote_route": "10.2.21.0/24", "subnet_route": "10.1.21.0/24", "tenant_route_ip": "192.168.3.2", "v_name": "vxlan_t3s1"}], "rc": 0, "start": "2019-12-05 17:41:59.680964", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Get PNS ip address] ***********************************************************************************************************************************
ok: [localhost] => {"changed": false, "cmd": "ip netns exec pns ip addr show p1 | awk 'FNR==3{ print $2 }' | awk -F/ '{ print $1 }'\n", "delta": "0:00:00.056851", "end": "2019-12-05 17:42:00.155350", "rc": 0, "start": "2019-12-05 17:42:00.098499", "stderr": "", "stderr_lines": [], "stdout": "192.168.100.238", "stdout_lines": ["192.168.100.238"]}

TASK [Add VXLAN routes to host] *****************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.21.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.1.21.1', u'bridge_name': u't3br1', u'dns': [{u'dnsif': u't3s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't3s1_dnsbrif'}], u'ns_name': u't3ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.21.2/24', u'tenant_ns_ip': u'10.1.21.1/24', u'tenant_ns_if': u't3ns1if', u'tenant_sub_if': u't3s1if', u'tenant_ns_name': u't3'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't3_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't3br1if1', u'vmif': u't3VM1if1'}, {u'mem': 4, u'name': u't3_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't3br1if2', u'vmif': u't3VM2if1'}]}, {u'local_ip': u'10.1.21.2', u'dsport': 4789, u'dev': u't3s1if', u'tenant_route_ip': u'192.168.3.2', u'remote_route': u'10.2.21.0/24', u'subnet_route': u'10.1.21.0/24', u'v_name': u'vxlan_t3s1', u'id': 42, u'remote_ip': u'10.2.21.2'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip route show \"10.1.21.0/24\" via \"192.168.100.238\" | grep -w '^10.1.21.0/24' ; if [ $? -ne 0 ] ; then ip route add \"10.1.21.0/24\" via \"192.168.100.238\" ; fi\nip route show \"10.2.21.0/24\" via 99.99.99.2 | grep -w '^10.2.21.0/24'; if [ $? -ne 0 ] ; then ip route add \"10.2.21.0/24\" via 99.99.99.2 ; fi\n", "delta": "0:00:00.009399", "end": "2019-12-05 17:42:00.494305", "item": [{"bridge_name": "t3br1", "default_route_ip": "10.1.21.1", "dns": [{"brif": "t3s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.5", "dnsif": "t3s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t3ns1", "route": [{"if": "p1", "ip": "10.1.21.1/24", "ns_if": "t3if", "ns_name": "t3"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t3ns1if", "tenant_ns_ip": "10.1.21.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s1if", "tenant_sub_ip": "10.1.21.2/24"}], "vms": [{"brif": "t3br1if1", "disk": "10G", "mem": 2, "name": "t3_VM1", "vcpu": 4, "vmif": "t3VM1if1"}, {"brif": "t3br1if2", "disk": "10G", "mem": 4, "name": "t3_VM2", "vcpu": 2, "vmif": "t3VM2if1"}]}, {"dev": "t3s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.21.2", "remote_ip": "10.2.21.2", "remote_route": "10.2.21.0/24", "subnet_route": "10.1.21.0/24", "tenant_route_ip": "192.168.3.2", "v_name": "vxlan_t3s1"}], "rc": 0, "start": "2019-12-05 17:42:00.484906", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

PLAY RECAP **************************************************************************************************************************************************
localhost                  : ok=3    changed=2    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0   

Using /etc/ansible/ansible.cfg as config file

PLAY [worker] ***********************************************************************************************************************************************

TASK [Add VXLAN routes in PNS] ******************************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.21.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.2.21.1', u'bridge_name': u't3br1', u'dns': [{u'dnsif': u't3s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't3s1_dnsbrif'}], u'ns_name': u't3ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.21.2/24', u'tenant_ns_ip': u'10.2.21.1/24', u'tenant_ns_if': u't3ns1if', u'tenant_sub_if': u't3s1if', u'tenant_ns_name': u't3'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't3_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't3br1if1', u'vmif': u't3VM4if1'}]}, {u'local_ip': u'10.2.21.2', u'dsport': 4789, u'dev': u't3s1if', u'tenant_route_ip': u'192.168.131.2', u'remote_route': u'10.1.21.0/24', u'subnet_route': u'10.2.21.0/24', u'v_name': u'vxlan_t3s1', u'id': 42, u'remote_ip': u'10.1.21.2'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec pns ip route show \"10.2.21.0/24\" via \"192.168.131.2\" | grep -w '^10.2.21.0/24' ; if [ $? -ne 0 ] ; then ip netns exec pns ip route add \"10.2.21.0/24\" via \"192.168.131.2\" ; fi\n", "delta": "0:00:00.081054", "end": "2019-12-05 17:42:01.770768", "item": [{"bridge_name": "t3br1", "default_route_ip": "10.2.21.1", "dns": [{"brif": "t3s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.5", "dnsif": "t3s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t3ns1", "route": [{"if": "p1", "ip": "10.2.21.1/24", "ns_if": "t3if", "ns_name": "t3"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t3ns1if", "tenant_ns_ip": "10.2.21.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s1if", "tenant_sub_ip": "10.2.21.2/24"}], "vms": [{"brif": "t3br1if1", "disk": "10G", "mem": 2, "name": "t3_VM4", "vcpu": 4, "vmif": "t3VM4if1"}]}, {"dev": "t3s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.21.2", "remote_ip": "10.1.21.2", "remote_route": "10.1.21.0/24", "subnet_route": "10.2.21.0/24", "tenant_route_ip": "192.168.131.2", "v_name": "vxlan_t3s1"}], "rc": 0, "start": "2019-12-05 17:42:01.689714", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}
skipping: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.22.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.2.22.1', u'bridge_name': u't3br2', u'dns': [{u'dnsif': u't3s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't3s2_dnsbrif'}], u'ns_name': u't3ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.22.2/24', u'tenant_ns_ip': u'10.2.22.1/24', u'tenant_ns_if': u't3ns2if', u'tenant_sub_if': u't3s2if', u'tenant_ns_name': u't3'}], u'subnet_ip': u'2.2.2.0/24', u'vms': [{u'mem': 3, u'name': u't3_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't3br2if1', u'vmif': u't3VM3if1'}]}, {u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}])  => {"ansible_loop_var": "item", "changed": false, "item": [{"bridge_name": "t3br2", "default_route_ip": "10.2.22.1", "dns": [{"brif": "t3s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t3s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t3ns2", "route": [{"if": "p1", "ip": "10.2.22.1/24", "ns_if": "t3if", "ns_name": "t3"}], "subnet_ip": "2.2.2.0/24", "tenant_ns": [{"tenant_ns_if": "t3ns2if", "tenant_ns_ip": "10.2.22.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s2if", "tenant_sub_ip": "10.2.22.2/24"}], "vms": [{"brif": "t3br2if1", "disk": "10G", "mem": 3, "name": "t3_VM3", "vcpu": 2, "vmif": "t3VM3if1"}]}, {"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}], "skip_reason": "Conditional result was False"}

TASK [Get PNS ip address] ***********************************************************************************************************************************
ok: [99.99.99.2] => {"changed": false, "cmd": "ip netns exec pns ip addr show p1 | awk 'FNR==3{ print $2 }' | awk -F/ '{ print $1 }'\n", "delta": "0:00:00.038497", "end": "2019-12-05 17:42:02.187034", "rc": 0, "start": "2019-12-05 17:42:02.148537", "stderr": "", "stderr_lines": [], "stdout": "192.168.100.50", "stdout_lines": ["192.168.100.50"]}

TASK [Add VXLAN routes to host] *****************************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.21.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.2.21.1', u'bridge_name': u't3br1', u'dns': [{u'dnsif': u't3s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't3s1_dnsbrif'}], u'ns_name': u't3ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.21.2/24', u'tenant_ns_ip': u'10.2.21.1/24', u'tenant_ns_if': u't3ns1if', u'tenant_sub_if': u't3s1if', u'tenant_ns_name': u't3'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't3_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't3br1if1', u'vmif': u't3VM4if1'}]}, {u'local_ip': u'10.2.21.2', u'dsport': 4789, u'dev': u't3s1if', u'tenant_route_ip': u'192.168.131.2', u'remote_route': u'10.1.21.0/24', u'subnet_route': u'10.2.21.0/24', u'v_name': u'vxlan_t3s1', u'id': 42, u'remote_ip': u'10.1.21.2'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip route show \"10.2.21.0/24\" via \"192.168.100.50\" | grep -w '^10.2.21.0/24' ; if [ $? -ne 0 ] ; then ip route add \"10.2.21.0/24\" via \"192.168.100.50\" ; fi\nip route show \"10.1.21.0/24\" via 99.99.99.1 | grep -w '^10.1.21.0/24'; if [ $? -ne 0 ] ; then ip route add \"10.1.21.0/24\" via 99.99.99.1 ; fi\n", "delta": "0:00:00.007545", "end": "2019-12-05 17:42:02.628517", "item": [{"bridge_name": "t3br1", "default_route_ip": "10.2.21.1", "dns": [{"brif": "t3s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.5", "dnsif": "t3s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t3ns1", "route": [{"if": "p1", "ip": "10.2.21.1/24", "ns_if": "t3if", "ns_name": "t3"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t3ns1if", "tenant_ns_ip": "10.2.21.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s1if", "tenant_sub_ip": "10.2.21.2/24"}], "vms": [{"brif": "t3br1if1", "disk": "10G", "mem": 2, "name": "t3_VM4", "vcpu": 4, "vmif": "t3VM4if1"}]}, {"dev": "t3s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.21.2", "remote_ip": "10.1.21.2", "remote_route": "10.1.21.0/24", "subnet_route": "10.2.21.0/24", "tenant_route_ip": "192.168.131.2", "v_name": "vxlan_t3s1"}], "rc": 0, "start": "2019-12-05 17:42:02.620972", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}
skipping: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.22.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.2.22.1', u'bridge_name': u't3br2', u'dns': [{u'dnsif': u't3s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't3s2_dnsbrif'}], u'ns_name': u't3ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.22.2/24', u'tenant_ns_ip': u'10.2.22.1/24', u'tenant_ns_if': u't3ns2if', u'tenant_sub_if': u't3s2if', u'tenant_ns_name': u't3'}], u'subnet_ip': u'2.2.2.0/24', u'vms': [{u'mem': 3, u'name': u't3_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't3br2if1', u'vmif': u't3VM3if1'}]}, {u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}])  => {"ansible_loop_var": "item", "changed": false, "item": [{"bridge_name": "t3br2", "default_route_ip": "10.2.22.1", "dns": [{"brif": "t3s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t3s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t3ns2", "route": [{"if": "p1", "ip": "10.2.22.1/24", "ns_if": "t3if", "ns_name": "t3"}], "subnet_ip": "2.2.2.0/24", "tenant_ns": [{"tenant_ns_if": "t3ns2if", "tenant_ns_ip": "10.2.22.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s2if", "tenant_sub_ip": "10.2.22.2/24"}], "vms": [{"brif": "t3br2if1", "disk": "10G", "mem": 3, "name": "t3_VM3", "vcpu": 2, "vmif": "t3VM3if1"}]}, {"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}], "skip_reason": "Conditional result was False"}

PLAY RECAP **************************************************************************************************************************************************
99.99.99.2                 : ok=3    changed=2    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0   

Using /etc/ansible/ansible.cfg as config file

PLAY [main] *************************************************************************************************************************************************

TASK [Create VM templates (C1)] *****************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.21.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.1.21.1', u'bridge_name': u't3br1', u'dns': [{u'dnsif': u't3s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't3s1_dnsbrif'}], u'ns_name': u't3ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.21.2/24', u'tenant_ns_ip': u'10.1.21.1/24', u'tenant_ns_if': u't3ns1if', u'tenant_sub_if': u't3s1if', u'tenant_ns_name': u't3'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.1.21.2', u'dsport': 4789, u'dev': u't3s1if', u'tenant_route_ip': u'192.168.3.2', u'remote_route': u'10.2.21.0/24', u'subnet_route': u'10.1.21.0/24', u'v_name': u'vxlan_t3s1', u'id': 42, u'remote_ip': u'10.2.21.2'}]}, {u'mem': 2, u'name': u't3_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't3br1if1', u'vmif': u't3VM1if1'}]) => {"ansible_loop_var": "item", "changed": true, "checksum": "350ba870bd31b7f6ee517845c14237910b5af0bf", "dest": "/root/Migration-as-a-Service/etc/t3/VM_templates/t3_VM1.xml.j2", "gid": 0, "group": "root", "item": [{"bridge_name": "t3br1", "default_route_ip": "10.1.21.1", "dns": [{"brif": "t3s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.5", "dnsif": "t3s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t3ns1", "route": [{"if": "p1", "ip": "10.1.21.1/24", "ns_if": "t3if", "ns_name": "t3"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t3ns1if", "tenant_ns_ip": "10.1.21.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s1if", "tenant_sub_ip": "10.1.21.2/24"}], "vxlan": [{"dev": "t3s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.21.2", "remote_ip": "10.2.21.2", "remote_route": "10.2.21.0/24", "subnet_route": "10.1.21.0/24", "tenant_route_ip": "192.168.3.2", "v_name": "vxlan_t3s1"}]}, {"brif": "t3br1if1", "disk": "10G", "mem": 2, "name": "t3_VM1", "vcpu": 4, "vmif": "t3VM1if1"}], "md5sum": "fbfc2eb0c2569531f25eea92c26d3bee", "mode": "0644", "owner": "root", "size": 4091, "src": "/root/.ansible/tmp/ansible-tmp-1575567723.32-18671277048900/source", "state": "file", "uid": 0}
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.21.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.1.21.1', u'bridge_name': u't3br1', u'dns': [{u'dnsif': u't3s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't3s1_dnsbrif'}], u'ns_name': u't3ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.21.2/24', u'tenant_ns_ip': u'10.1.21.1/24', u'tenant_ns_if': u't3ns1if', u'tenant_sub_if': u't3s1if', u'tenant_ns_name': u't3'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.1.21.2', u'dsport': 4789, u'dev': u't3s1if', u'tenant_route_ip': u'192.168.3.2', u'remote_route': u'10.2.21.0/24', u'subnet_route': u'10.1.21.0/24', u'v_name': u'vxlan_t3s1', u'id': 42, u'remote_ip': u'10.2.21.2'}]}, {u'mem': 4, u'name': u't3_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't3br1if2', u'vmif': u't3VM2if1'}]) => {"ansible_loop_var": "item", "changed": true, "checksum": "350ba870bd31b7f6ee517845c14237910b5af0bf", "dest": "/root/Migration-as-a-Service/etc/t3/VM_templates/t3_VM2.xml.j2", "gid": 0, "group": "root", "item": [{"bridge_name": "t3br1", "default_route_ip": "10.1.21.1", "dns": [{"brif": "t3s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.5", "dnsif": "t3s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t3ns1", "route": [{"if": "p1", "ip": "10.1.21.1/24", "ns_if": "t3if", "ns_name": "t3"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t3ns1if", "tenant_ns_ip": "10.1.21.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s1if", "tenant_sub_ip": "10.1.21.2/24"}], "vxlan": [{"dev": "t3s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.21.2", "remote_ip": "10.2.21.2", "remote_route": "10.2.21.0/24", "subnet_route": "10.1.21.0/24", "tenant_route_ip": "192.168.3.2", "v_name": "vxlan_t3s1"}]}, {"brif": "t3br1if2", "disk": "10G", "mem": 4, "name": "t3_VM2", "vcpu": 2, "vmif": "t3VM2if1"}], "md5sum": "fbfc2eb0c2569531f25eea92c26d3bee", "mode": "0644", "owner": "root", "size": 4091, "src": "/root/.ansible/tmp/ansible-tmp-1575567723.89-29087759195845/source", "state": "file", "uid": 0}

PLAY RECAP **************************************************************************************************************************************************
localhost                  : ok=1    changed=1    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0   

Using /etc/ansible/ansible.cfg as config file

PLAY [main] *************************************************************************************************************************************************

TASK [Create VM templates (C2)] *****************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.2.21.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.2.21.1', u'bridge_name': u't3br1', u'dns': [{u'dnsif': u't3s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't3s1_dnsbrif'}], u'ns_name': u't3ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.21.2/24', u'tenant_ns_ip': u'10.2.21.1/24', u'tenant_ns_if': u't3ns1if', u'tenant_sub_if': u't3s1if', u'tenant_ns_name': u't3'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.2.21.2', u'dsport': 4789, u'dev': u't3s1if', u'tenant_route_ip': u'192.168.131.2', u'remote_route': u'10.1.21.0/24', u'subnet_route': u'10.2.21.0/24', u'v_name': u'vxlan_t3s1', u'id': 42, u'remote_ip': u'10.1.21.2'}]}, {u'mem': 2, u'name': u't3_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't3br1if1', u'vmif': u't3VM4if1'}]) => {"ansible_loop_var": "item", "changed": true, "checksum": "350ba870bd31b7f6ee517845c14237910b5af0bf", "dest": "/root/Migration-as-a-Service/etc/t3/VM_templates/t3_VM4.xml.j2", "gid": 0, "group": "root", "item": [{"bridge_name": "t3br1", "default_route_ip": "10.2.21.1", "dns": [{"brif": "t3s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.5", "dnsif": "t3s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t3ns1", "route": [{"if": "p1", "ip": "10.2.21.1/24", "ns_if": "t3if", "ns_name": "t3"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t3ns1if", "tenant_ns_ip": "10.2.21.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s1if", "tenant_sub_ip": "10.2.21.2/24"}], "vxlan": [{"dev": "t3s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.21.2", "remote_ip": "10.1.21.2", "remote_route": "10.1.21.0/24", "subnet_route": "10.2.21.0/24", "tenant_route_ip": "192.168.131.2", "v_name": "vxlan_t3s1"}]}, {"brif": "t3br1if1", "disk": "10G", "mem": 2, "name": "t3_VM4", "vcpu": 4, "vmif": "t3VM4if1"}], "md5sum": "fbfc2eb0c2569531f25eea92c26d3bee", "mode": "0644", "owner": "root", "size": 4091, "src": "/root/.ansible/tmp/ansible-tmp-1575567724.75-16027943077229/source", "state": "file", "uid": 0}
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.2.22.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.2.22.1', u'bridge_name': u't3br2', u'dns': [{u'dnsif': u't3s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't3s2_dnsbrif'}], u'ns_name': u't3ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.22.2/24', u'tenant_ns_ip': u'10.2.22.1/24', u'tenant_ns_if': u't3ns2if', u'tenant_sub_if': u't3s2if', u'tenant_ns_name': u't3'}], u'subnet_ip': u'2.2.2.0/24', u'vxlan': [{u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}, {u'mem': 3, u'name': u't3_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't3br2if1', u'vmif': u't3VM3if1'}]) => {"ansible_loop_var": "item", "changed": true, "checksum": "350ba870bd31b7f6ee517845c14237910b5af0bf", "dest": "/root/Migration-as-a-Service/etc/t3/VM_templates/t3_VM3.xml.j2", "gid": 0, "group": "root", "item": [{"bridge_name": "t3br2", "default_route_ip": "10.2.22.1", "dns": [{"brif": "t3s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t3s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t3ns2", "route": [{"if": "p1", "ip": "10.2.22.1/24", "ns_if": "t3if", "ns_name": "t3"}], "subnet_ip": "2.2.2.0/24", "tenant_ns": [{"tenant_ns_if": "t3ns2if", "tenant_ns_ip": "10.2.22.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s2if", "tenant_sub_ip": "10.2.22.2/24"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, {"brif": "t3br2if1", "disk": "10G", "mem": 3, "name": "t3_VM3", "vcpu": 2, "vmif": "t3VM3if1"}], "md5sum": "fbfc2eb0c2569531f25eea92c26d3bee", "mode": "0644", "owner": "root", "size": 4091, "src": "/root/.ansible/tmp/ansible-tmp-1575567725.34-169576201768076/source", "state": "file", "uid": 0}

PLAY RECAP **************************************************************************************************************************************************
localhost                  : ok=1    changed=1    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0   

Using /etc/ansible/ansible.cfg as config file

PLAY [main] *************************************************************************************************************************************************

TASK [Copy VM image] ****************************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.21.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.1.21.1', u'bridge_name': u't3br1', u'dns': [{u'dnsif': u't3s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't3s1_dnsbrif'}], u'ns_name': u't3ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.21.2/24', u'tenant_ns_ip': u'10.1.21.1/24', u'tenant_ns_if': u't3ns1if', u'tenant_sub_if': u't3s1if', u'tenant_ns_name': u't3'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.1.21.2', u'dsport': 4789, u'dev': u't3s1if', u'tenant_route_ip': u'192.168.3.2', u'remote_route': u'10.2.21.0/24', u'subnet_route': u'10.1.21.0/24', u'v_name': u'vxlan_t3s1', u'id': 42, u'remote_ip': u'10.2.21.2'}]}, {u'mem': 2, u'name': u't3_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't3br1if1', u'vmif': u't3VM1if1'}]) => {"ansible_loop_var": "item", "changed": true, "checksum": "d86d5962370fcd0c3d05943fc209d9e05fdac89f", "dest": "/var/lib/libvirt/images/t3_VM1.qcow2", "gid": 0, "group": "root", "item": [{"bridge_name": "t3br1", "default_route_ip": "10.1.21.1", "dns": [{"brif": "t3s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.5", "dnsif": "t3s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t3ns1", "route": [{"if": "p1", "ip": "10.1.21.1/24", "ns_if": "t3if", "ns_name": "t3"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t3ns1if", "tenant_ns_ip": "10.1.21.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s1if", "tenant_sub_ip": "10.1.21.2/24"}], "vxlan": [{"dev": "t3s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.21.2", "remote_ip": "10.2.21.2", "remote_route": "10.2.21.0/24", "subnet_route": "10.1.21.0/24", "tenant_route_ip": "192.168.3.2", "v_name": "vxlan_t3s1"}]}, {"brif": "t3br1if1", "disk": "10G", "mem": 2, "name": "t3_VM1", "vcpu": 4, "vmif": "t3VM1if1"}], "md5sum": "b977a19124b65f2d544ddc62e407114d", "mode": "0644", "owner": "root", "size": 10739318784, "src": "/root/.ansible/tmp/ansible-tmp-1575567726.31-163507629561229/source", "state": "file", "uid": 0}
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.21.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.1.21.1', u'bridge_name': u't3br1', u'dns': [{u'dnsif': u't3s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't3s1_dnsbrif'}], u'ns_name': u't3ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.21.2/24', u'tenant_ns_ip': u'10.1.21.1/24', u'tenant_ns_if': u't3ns1if', u'tenant_sub_if': u't3s1if', u'tenant_ns_name': u't3'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.1.21.2', u'dsport': 4789, u'dev': u't3s1if', u'tenant_route_ip': u'192.168.3.2', u'remote_route': u'10.2.21.0/24', u'subnet_route': u'10.1.21.0/24', u'v_name': u'vxlan_t3s1', u'id': 42, u'remote_ip': u'10.2.21.2'}]}, {u'mem': 4, u'name': u't3_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't3br1if2', u'vmif': u't3VM2if1'}]) => {"ansible_loop_var": "item", "changed": true, "checksum": "d86d5962370fcd0c3d05943fc209d9e05fdac89f", "dest": "/var/lib/libvirt/images/t3_VM2.qcow2", "gid": 0, "group": "root", "item": [{"bridge_name": "t3br1", "default_route_ip": "10.1.21.1", "dns": [{"brif": "t3s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.5", "dnsif": "t3s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t3ns1", "route": [{"if": "p1", "ip": "10.1.21.1/24", "ns_if": "t3if", "ns_name": "t3"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t3ns1if", "tenant_ns_ip": "10.1.21.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s1if", "tenant_sub_ip": "10.1.21.2/24"}], "vxlan": [{"dev": "t3s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.21.2", "remote_ip": "10.2.21.2", "remote_route": "10.2.21.0/24", "subnet_route": "10.1.21.0/24", "tenant_route_ip": "192.168.3.2", "v_name": "vxlan_t3s1"}]}, {"brif": "t3br1if2", "disk": "10G", "mem": 4, "name": "t3_VM2", "vcpu": 2, "vmif": "t3VM2if1"}], "md5sum": "b977a19124b65f2d544ddc62e407114d", "mode": "0644", "owner": "root", "size": 10739318784, "src": "/root/.ansible/tmp/ansible-tmp-1575567846.63-27465767823121/source", "state": "file", "uid": 0}

TASK [Get list of running VMs] ******************************************************************************************************************************
ok: [localhost] => {"changed": false, "cmd": ["virsh", "list", "--name"], "delta": "0:00:00.051494", "end": "2019-12-05 17:45:39.206797", "rc": 0, "start": "2019-12-05 17:45:39.155303", "stderr": "", "stderr_lines": [], "stdout": "t1_VM1\nt1_VM2\nt2_VM1\nt2_VM2", "stdout_lines": ["t1_VM1", "t1_VM2", "t2_VM1", "t2_VM2"]}

TASK [Define VM] ********************************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.21.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.1.21.1', u'bridge_name': u't3br1', u'dns': [{u'dnsif': u't3s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't3s1_dnsbrif'}], u'ns_name': u't3ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.21.2/24', u'tenant_ns_ip': u'10.1.21.1/24', u'tenant_ns_if': u't3ns1if', u'tenant_sub_if': u't3s1if', u'tenant_ns_name': u't3'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.1.21.2', u'dsport': 4789, u'dev': u't3s1if', u'tenant_route_ip': u'192.168.3.2', u'remote_route': u'10.2.21.0/24', u'subnet_route': u'10.1.21.0/24', u'v_name': u'vxlan_t3s1', u'id': 42, u'remote_ip': u'10.2.21.2'}]}, {u'mem': 2, u'name': u't3_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't3br1if1', u'vmif': u't3VM1if1'}]) => {"ansible_loop_var": "item", "changed": true, "created": "t3_VM1", "item": [{"bridge_name": "t3br1", "default_route_ip": "10.1.21.1", "dns": [{"brif": "t3s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.5", "dnsif": "t3s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t3ns1", "route": [{"if": "p1", "ip": "10.1.21.1/24", "ns_if": "t3if", "ns_name": "t3"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t3ns1if", "tenant_ns_ip": "10.1.21.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s1if", "tenant_sub_ip": "10.1.21.2/24"}], "vxlan": [{"dev": "t3s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.21.2", "remote_ip": "10.2.21.2", "remote_route": "10.2.21.0/24", "subnet_route": "10.1.21.0/24", "tenant_route_ip": "192.168.3.2", "v_name": "vxlan_t3s1"}]}, {"brif": "t3br1if1", "disk": "10G", "mem": 2, "name": "t3_VM1", "vcpu": 4, "vmif": "t3VM1if1"}], "warnings": ["'xml' is given - ignoring 'name'"]}
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.21.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.1.21.1', u'bridge_name': u't3br1', u'dns': [{u'dnsif': u't3s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't3s1_dnsbrif'}], u'ns_name': u't3ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.21.2/24', u'tenant_ns_ip': u'10.1.21.1/24', u'tenant_ns_if': u't3ns1if', u'tenant_sub_if': u't3s1if', u'tenant_ns_name': u't3'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.1.21.2', u'dsport': 4789, u'dev': u't3s1if', u'tenant_route_ip': u'192.168.3.2', u'remote_route': u'10.2.21.0/24', u'subnet_route': u'10.1.21.0/24', u'v_name': u'vxlan_t3s1', u'id': 42, u'remote_ip': u'10.2.21.2'}]}, {u'mem': 4, u'name': u't3_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't3br1if2', u'vmif': u't3VM2if1'}]) => {"ansible_loop_var": "item", "changed": true, "created": "t3_VM2", "item": [{"bridge_name": "t3br1", "default_route_ip": "10.1.21.1", "dns": [{"brif": "t3s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.5", "dnsif": "t3s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t3ns1", "route": [{"if": "p1", "ip": "10.1.21.1/24", "ns_if": "t3if", "ns_name": "t3"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t3ns1if", "tenant_ns_ip": "10.1.21.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s1if", "tenant_sub_ip": "10.1.21.2/24"}], "vxlan": [{"dev": "t3s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.21.2", "remote_ip": "10.2.21.2", "remote_route": "10.2.21.0/24", "subnet_route": "10.1.21.0/24", "tenant_route_ip": "192.168.3.2", "v_name": "vxlan_t3s1"}]}, {"brif": "t3br1if2", "disk": "10G", "mem": 4, "name": "t3_VM2", "vcpu": 2, "vmif": "t3VM2if1"}], "warnings": ["'xml' is given - ignoring 'name'"]}

TASK [Create VM] ********************************************************************************************************************************************
ok: [localhost] => (item=[{u'route': [{u'ip': u'10.1.21.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.1.21.1', u'bridge_name': u't3br1', u'dns': [{u'dnsif': u't3s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't3s1_dnsbrif'}], u'ns_name': u't3ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.21.2/24', u'tenant_ns_ip': u'10.1.21.1/24', u'tenant_ns_if': u't3ns1if', u'tenant_sub_if': u't3s1if', u'tenant_ns_name': u't3'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.1.21.2', u'dsport': 4789, u'dev': u't3s1if', u'tenant_route_ip': u'192.168.3.2', u'remote_route': u'10.2.21.0/24', u'subnet_route': u'10.1.21.0/24', u'v_name': u'vxlan_t3s1', u'id': 42, u'remote_ip': u'10.2.21.2'}]}, {u'mem': 2, u'name': u't3_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't3br1if1', u'vmif': u't3VM1if1'}]) => {"ansible_loop_var": "item", "changed": false, "create": 0, "item": [{"bridge_name": "t3br1", "default_route_ip": "10.1.21.1", "dns": [{"brif": "t3s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.5", "dnsif": "t3s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t3ns1", "route": [{"if": "p1", "ip": "10.1.21.1/24", "ns_if": "t3if", "ns_name": "t3"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t3ns1if", "tenant_ns_ip": "10.1.21.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s1if", "tenant_sub_ip": "10.1.21.2/24"}], "vxlan": [{"dev": "t3s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.21.2", "remote_ip": "10.2.21.2", "remote_route": "10.2.21.0/24", "subnet_route": "10.1.21.0/24", "tenant_route_ip": "192.168.3.2", "v_name": "vxlan_t3s1"}]}, {"brif": "t3br1if1", "disk": "10G", "mem": 2, "name": "t3_VM1", "vcpu": 4, "vmif": "t3VM1if1"}]}
ok: [localhost] => (item=[{u'route': [{u'ip': u'10.1.21.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.1.21.1', u'bridge_name': u't3br1', u'dns': [{u'dnsif': u't3s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't3s1_dnsbrif'}], u'ns_name': u't3ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.21.2/24', u'tenant_ns_ip': u'10.1.21.1/24', u'tenant_ns_if': u't3ns1if', u'tenant_sub_if': u't3s1if', u'tenant_ns_name': u't3'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.1.21.2', u'dsport': 4789, u'dev': u't3s1if', u'tenant_route_ip': u'192.168.3.2', u'remote_route': u'10.2.21.0/24', u'subnet_route': u'10.1.21.0/24', u'v_name': u'vxlan_t3s1', u'id': 42, u'remote_ip': u'10.2.21.2'}]}, {u'mem': 4, u'name': u't3_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't3br1if2', u'vmif': u't3VM2if1'}]) => {"ansible_loop_var": "item", "changed": false, "create": 0, "item": [{"bridge_name": "t3br1", "default_route_ip": "10.1.21.1", "dns": [{"brif": "t3s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.5", "dnsif": "t3s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t3ns1", "route": [{"if": "p1", "ip": "10.1.21.1/24", "ns_if": "t3if", "ns_name": "t3"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t3ns1if", "tenant_ns_ip": "10.1.21.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s1if", "tenant_sub_ip": "10.1.21.2/24"}], "vxlan": [{"dev": "t3s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.21.2", "remote_ip": "10.2.21.2", "remote_route": "10.2.21.0/24", "subnet_route": "10.1.21.0/24", "tenant_route_ip": "192.168.3.2", "v_name": "vxlan_t3s1"}]}, {"brif": "t3br1if2", "disk": "10G", "mem": 4, "name": "t3_VM2", "vcpu": 2, "vmif": "t3VM2if1"}]}

TASK [Start VM] *********************************************************************************************************************************************
ok: [localhost] => (item=[{u'route': [{u'ip': u'10.1.21.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.1.21.1', u'bridge_name': u't3br1', u'dns': [{u'dnsif': u't3s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't3s1_dnsbrif'}], u'ns_name': u't3ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.21.2/24', u'tenant_ns_ip': u'10.1.21.1/24', u'tenant_ns_if': u't3ns1if', u'tenant_sub_if': u't3s1if', u'tenant_ns_name': u't3'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.1.21.2', u'dsport': 4789, u'dev': u't3s1if', u'tenant_route_ip': u'192.168.3.2', u'remote_route': u'10.2.21.0/24', u'subnet_route': u'10.1.21.0/24', u'v_name': u'vxlan_t3s1', u'id': 42, u'remote_ip': u'10.2.21.2'}]}, {u'mem': 2, u'name': u't3_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't3br1if1', u'vmif': u't3VM1if1'}]) => {"ansible_loop_var": "item", "changed": false, "item": [{"bridge_name": "t3br1", "default_route_ip": "10.1.21.1", "dns": [{"brif": "t3s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.5", "dnsif": "t3s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t3ns1", "route": [{"if": "p1", "ip": "10.1.21.1/24", "ns_if": "t3if", "ns_name": "t3"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t3ns1if", "tenant_ns_ip": "10.1.21.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s1if", "tenant_sub_ip": "10.1.21.2/24"}], "vxlan": [{"dev": "t3s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.21.2", "remote_ip": "10.2.21.2", "remote_route": "10.2.21.0/24", "subnet_route": "10.1.21.0/24", "tenant_route_ip": "192.168.3.2", "v_name": "vxlan_t3s1"}]}, {"brif": "t3br1if1", "disk": "10G", "mem": 2, "name": "t3_VM1", "vcpu": 4, "vmif": "t3VM1if1"}]}
ok: [localhost] => (item=[{u'route': [{u'ip': u'10.1.21.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.1.21.1', u'bridge_name': u't3br1', u'dns': [{u'dnsif': u't3s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't3s1_dnsbrif'}], u'ns_name': u't3ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.21.2/24', u'tenant_ns_ip': u'10.1.21.1/24', u'tenant_ns_if': u't3ns1if', u'tenant_sub_if': u't3s1if', u'tenant_ns_name': u't3'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.1.21.2', u'dsport': 4789, u'dev': u't3s1if', u'tenant_route_ip': u'192.168.3.2', u'remote_route': u'10.2.21.0/24', u'subnet_route': u'10.1.21.0/24', u'v_name': u'vxlan_t3s1', u'id': 42, u'remote_ip': u'10.2.21.2'}]}, {u'mem': 4, u'name': u't3_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't3br1if2', u'vmif': u't3VM2if1'}]) => {"ansible_loop_var": "item", "changed": false, "item": [{"bridge_name": "t3br1", "default_route_ip": "10.1.21.1", "dns": [{"brif": "t3s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.5", "dnsif": "t3s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t3ns1", "route": [{"if": "p1", "ip": "10.1.21.1/24", "ns_if": "t3if", "ns_name": "t3"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t3ns1if", "tenant_ns_ip": "10.1.21.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s1if", "tenant_sub_ip": "10.1.21.2/24"}], "vxlan": [{"dev": "t3s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.21.2", "remote_ip": "10.2.21.2", "remote_route": "10.2.21.0/24", "subnet_route": "10.1.21.0/24", "tenant_route_ip": "192.168.3.2", "v_name": "vxlan_t3s1"}]}, {"brif": "t3br1if2", "disk": "10G", "mem": 4, "name": "t3_VM2", "vcpu": 2, "vmif": "t3VM2if1"}]}

TASK [Attach VM interface] **********************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.21.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.1.21.1', u'bridge_name': u't3br1', u'dns': [{u'dnsif': u't3s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't3s1_dnsbrif'}], u'ns_name': u't3ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.21.2/24', u'tenant_ns_ip': u'10.1.21.1/24', u'tenant_ns_if': u't3ns1if', u'tenant_sub_if': u't3s1if', u'tenant_ns_name': u't3'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.1.21.2', u'dsport': 4789, u'dev': u't3s1if', u'tenant_route_ip': u'192.168.3.2', u'remote_route': u'10.2.21.0/24', u'subnet_route': u'10.1.21.0/24', u'v_name': u'vxlan_t3s1', u'id': 42, u'remote_ip': u'10.2.21.2'}]}, {u'mem': 2, u'name': u't3_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't3br1if1', u'vmif': u't3VM1if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "virsh domiflist \"t3_VM1\" | grep -w 't3VM1if1' ; if [ $? -ne 0 ] ; then virsh attach-interface \"t3_VM1\" direct \"t3VM1if1\" --live --persistent ; fi\n", "delta": "0:00:11.350724", "end": "2019-12-05 17:46:07.270594", "item": [{"bridge_name": "t3br1", "default_route_ip": "10.1.21.1", "dns": [{"brif": "t3s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.5", "dnsif": "t3s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t3ns1", "route": [{"if": "p1", "ip": "10.1.21.1/24", "ns_if": "t3if", "ns_name": "t3"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t3ns1if", "tenant_ns_ip": "10.1.21.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s1if", "tenant_sub_ip": "10.1.21.2/24"}], "vxlan": [{"dev": "t3s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.21.2", "remote_ip": "10.2.21.2", "remote_route": "10.2.21.0/24", "subnet_route": "10.1.21.0/24", "tenant_route_ip": "192.168.3.2", "v_name": "vxlan_t3s1"}]}, {"brif": "t3br1if1", "disk": "10G", "mem": 2, "name": "t3_VM1", "vcpu": 4, "vmif": "t3VM1if1"}], "rc": 0, "start": "2019-12-05 17:45:55.919870", "stderr": "", "stderr_lines": [], "stdout": "Interface attached successfully", "stdout_lines": ["Interface attached successfully"]}
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.21.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.1.21.1', u'bridge_name': u't3br1', u'dns': [{u'dnsif': u't3s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't3s1_dnsbrif'}], u'ns_name': u't3ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.21.2/24', u'tenant_ns_ip': u'10.1.21.1/24', u'tenant_ns_if': u't3ns1if', u'tenant_sub_if': u't3s1if', u'tenant_ns_name': u't3'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.1.21.2', u'dsport': 4789, u'dev': u't3s1if', u'tenant_route_ip': u'192.168.3.2', u'remote_route': u'10.2.21.0/24', u'subnet_route': u'10.1.21.0/24', u'v_name': u'vxlan_t3s1', u'id': 42, u'remote_ip': u'10.2.21.2'}]}, {u'mem': 4, u'name': u't3_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't3br1if2', u'vmif': u't3VM2if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "virsh domiflist \"t3_VM2\" | grep -w 't3VM2if1' ; if [ $? -ne 0 ] ; then virsh attach-interface \"t3_VM2\" direct \"t3VM2if1\" --live --persistent ; fi\n", "delta": "0:00:00.267654", "end": "2019-12-05 17:46:07.718503", "item": [{"bridge_name": "t3br1", "default_route_ip": "10.1.21.1", "dns": [{"brif": "t3s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.5", "dnsif": "t3s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t3ns1", "route": [{"if": "p1", "ip": "10.1.21.1/24", "ns_if": "t3if", "ns_name": "t3"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t3ns1if", "tenant_ns_ip": "10.1.21.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s1if", "tenant_sub_ip": "10.1.21.2/24"}], "vxlan": [{"dev": "t3s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.21.2", "remote_ip": "10.2.21.2", "remote_route": "10.2.21.0/24", "subnet_route": "10.1.21.0/24", "tenant_route_ip": "192.168.3.2", "v_name": "vxlan_t3s1"}]}, {"brif": "t3br1if2", "disk": "10G", "mem": 4, "name": "t3_VM2", "vcpu": 2, "vmif": "t3VM2if1"}], "rc": 0, "start": "2019-12-05 17:46:07.450849", "stderr": "", "stderr_lines": [], "stdout": "Interface attached successfully", "stdout_lines": ["Interface attached successfully"]}

PLAY RECAP **************************************************************************************************************************************************
localhost                  : ok=6    changed=3    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0   

Using /etc/ansible/ansible.cfg as config file

PLAY [worker] ***********************************************************************************************************************************************

TASK [Copy VM image] ****************************************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.21.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.2.21.1', u'bridge_name': u't3br1', u'dns': [{u'dnsif': u't3s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't3s1_dnsbrif'}], u'ns_name': u't3ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.21.2/24', u'tenant_ns_ip': u'10.2.21.1/24', u'tenant_ns_if': u't3ns1if', u'tenant_sub_if': u't3s1if', u'tenant_ns_name': u't3'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.2.21.2', u'dsport': 4789, u'dev': u't3s1if', u'tenant_route_ip': u'192.168.131.2', u'remote_route': u'10.1.21.0/24', u'subnet_route': u'10.2.21.0/24', u'v_name': u'vxlan_t3s1', u'id': 42, u'remote_ip': u'10.1.21.2'}]}, {u'mem': 2, u'name': u't3_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't3br1if1', u'vmif': u't3VM4if1'}]) => {"ansible_loop_var": "item", "changed": true, "checksum": "f8b2ffa2bf201c84196c582f2dec0d33a1eb4b42", "dest": "/var/lib/libvirt/images/t3_VM4.qcow2", "gid": 0, "group": "root", "item": [{"bridge_name": "t3br1", "default_route_ip": "10.2.21.1", "dns": [{"brif": "t3s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.5", "dnsif": "t3s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t3ns1", "route": [{"if": "p1", "ip": "10.2.21.1/24", "ns_if": "t3if", "ns_name": "t3"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t3ns1if", "tenant_ns_ip": "10.2.21.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s1if", "tenant_sub_ip": "10.2.21.2/24"}], "vxlan": [{"dev": "t3s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.21.2", "remote_ip": "10.1.21.2", "remote_route": "10.1.21.0/24", "subnet_route": "10.2.21.0/24", "tenant_route_ip": "192.168.131.2", "v_name": "vxlan_t3s1"}]}, {"brif": "t3br1if1", "disk": "10G", "mem": 2, "name": "t3_VM4", "vcpu": 4, "vmif": "t3VM4if1"}], "md5sum": "e6d5d524b68797ddd748ba1475985d34", "mode": "0644", "owner": "root", "size": 10739318784, "src": "/root/mainVM.qcow2", "state": "file", "uid": 0}
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.22.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.2.22.1', u'bridge_name': u't3br2', u'dns': [{u'dnsif': u't3s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't3s2_dnsbrif'}], u'ns_name': u't3ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.22.2/24', u'tenant_ns_ip': u'10.2.22.1/24', u'tenant_ns_if': u't3ns2if', u'tenant_sub_if': u't3s2if', u'tenant_ns_name': u't3'}], u'subnet_ip': u'2.2.2.0/24', u'vxlan': [{u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}, {u'mem': 3, u'name': u't3_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't3br2if1', u'vmif': u't3VM3if1'}]) => {"ansible_loop_var": "item", "changed": true, "checksum": "f8b2ffa2bf201c84196c582f2dec0d33a1eb4b42", "dest": "/var/lib/libvirt/images/t3_VM3.qcow2", "gid": 0, "group": "root", "item": [{"bridge_name": "t3br2", "default_route_ip": "10.2.22.1", "dns": [{"brif": "t3s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t3s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t3ns2", "route": [{"if": "p1", "ip": "10.2.22.1/24", "ns_if": "t3if", "ns_name": "t3"}], "subnet_ip": "2.2.2.0/24", "tenant_ns": [{"tenant_ns_if": "t3ns2if", "tenant_ns_ip": "10.2.22.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s2if", "tenant_sub_ip": "10.2.22.2/24"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, {"brif": "t3br2if1", "disk": "10G", "mem": 3, "name": "t3_VM3", "vcpu": 2, "vmif": "t3VM3if1"}], "md5sum": "e6d5d524b68797ddd748ba1475985d34", "mode": "0644", "owner": "root", "size": 10739318784, "src": "/root/mainVM.qcow2", "state": "file", "uid": 0}

TASK [Get list of running VMs] ******************************************************************************************************************************
ok: [99.99.99.2] => {"changed": false, "cmd": ["virsh", "list", "--name"], "delta": "0:00:00.040869", "end": "2019-12-05 17:49:22.935581", "rc": 0, "start": "2019-12-05 17:49:22.894712", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Define VM] ********************************************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.21.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.2.21.1', u'bridge_name': u't3br1', u'dns': [{u'dnsif': u't3s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't3s1_dnsbrif'}], u'ns_name': u't3ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.21.2/24', u'tenant_ns_ip': u'10.2.21.1/24', u'tenant_ns_if': u't3ns1if', u'tenant_sub_if': u't3s1if', u'tenant_ns_name': u't3'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.2.21.2', u'dsport': 4789, u'dev': u't3s1if', u'tenant_route_ip': u'192.168.131.2', u'remote_route': u'10.1.21.0/24', u'subnet_route': u'10.2.21.0/24', u'v_name': u'vxlan_t3s1', u'id': 42, u'remote_ip': u'10.1.21.2'}]}, {u'mem': 2, u'name': u't3_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't3br1if1', u'vmif': u't3VM4if1'}]) => {"ansible_loop_var": "item", "changed": true, "created": "t3_VM4", "item": [{"bridge_name": "t3br1", "default_route_ip": "10.2.21.1", "dns": [{"brif": "t3s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.5", "dnsif": "t3s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t3ns1", "route": [{"if": "p1", "ip": "10.2.21.1/24", "ns_if": "t3if", "ns_name": "t3"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t3ns1if", "tenant_ns_ip": "10.2.21.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s1if", "tenant_sub_ip": "10.2.21.2/24"}], "vxlan": [{"dev": "t3s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.21.2", "remote_ip": "10.1.21.2", "remote_route": "10.1.21.0/24", "subnet_route": "10.2.21.0/24", "tenant_route_ip": "192.168.131.2", "v_name": "vxlan_t3s1"}]}, {"brif": "t3br1if1", "disk": "10G", "mem": 2, "name": "t3_VM4", "vcpu": 4, "vmif": "t3VM4if1"}], "warnings": ["'xml' is given - ignoring 'name'"]}
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.22.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.2.22.1', u'bridge_name': u't3br2', u'dns': [{u'dnsif': u't3s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't3s2_dnsbrif'}], u'ns_name': u't3ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.22.2/24', u'tenant_ns_ip': u'10.2.22.1/24', u'tenant_ns_if': u't3ns2if', u'tenant_sub_if': u't3s2if', u'tenant_ns_name': u't3'}], u'subnet_ip': u'2.2.2.0/24', u'vxlan': [{u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}, {u'mem': 3, u'name': u't3_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't3br2if1', u'vmif': u't3VM3if1'}]) => {"ansible_loop_var": "item", "changed": true, "created": "t3_VM3", "item": [{"bridge_name": "t3br2", "default_route_ip": "10.2.22.1", "dns": [{"brif": "t3s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t3s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t3ns2", "route": [{"if": "p1", "ip": "10.2.22.1/24", "ns_if": "t3if", "ns_name": "t3"}], "subnet_ip": "2.2.2.0/24", "tenant_ns": [{"tenant_ns_if": "t3ns2if", "tenant_ns_ip": "10.2.22.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s2if", "tenant_sub_ip": "10.2.22.2/24"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, {"brif": "t3br2if1", "disk": "10G", "mem": 3, "name": "t3_VM3", "vcpu": 2, "vmif": "t3VM3if1"}], "warnings": ["'xml' is given - ignoring 'name'"]}

TASK [Create VM] ********************************************************************************************************************************************
ok: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.21.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.2.21.1', u'bridge_name': u't3br1', u'dns': [{u'dnsif': u't3s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't3s1_dnsbrif'}], u'ns_name': u't3ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.21.2/24', u'tenant_ns_ip': u'10.2.21.1/24', u'tenant_ns_if': u't3ns1if', u'tenant_sub_if': u't3s1if', u'tenant_ns_name': u't3'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.2.21.2', u'dsport': 4789, u'dev': u't3s1if', u'tenant_route_ip': u'192.168.131.2', u'remote_route': u'10.1.21.0/24', u'subnet_route': u'10.2.21.0/24', u'v_name': u'vxlan_t3s1', u'id': 42, u'remote_ip': u'10.1.21.2'}]}, {u'mem': 2, u'name': u't3_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't3br1if1', u'vmif': u't3VM4if1'}]) => {"ansible_loop_var": "item", "changed": false, "create": 0, "item": [{"bridge_name": "t3br1", "default_route_ip": "10.2.21.1", "dns": [{"brif": "t3s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.5", "dnsif": "t3s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t3ns1", "route": [{"if": "p1", "ip": "10.2.21.1/24", "ns_if": "t3if", "ns_name": "t3"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t3ns1if", "tenant_ns_ip": "10.2.21.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s1if", "tenant_sub_ip": "10.2.21.2/24"}], "vxlan": [{"dev": "t3s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.21.2", "remote_ip": "10.1.21.2", "remote_route": "10.1.21.0/24", "subnet_route": "10.2.21.0/24", "tenant_route_ip": "192.168.131.2", "v_name": "vxlan_t3s1"}]}, {"brif": "t3br1if1", "disk": "10G", "mem": 2, "name": "t3_VM4", "vcpu": 4, "vmif": "t3VM4if1"}]}
ok: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.22.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.2.22.1', u'bridge_name': u't3br2', u'dns': [{u'dnsif': u't3s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't3s2_dnsbrif'}], u'ns_name': u't3ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.22.2/24', u'tenant_ns_ip': u'10.2.22.1/24', u'tenant_ns_if': u't3ns2if', u'tenant_sub_if': u't3s2if', u'tenant_ns_name': u't3'}], u'subnet_ip': u'2.2.2.0/24', u'vxlan': [{u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}, {u'mem': 3, u'name': u't3_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't3br2if1', u'vmif': u't3VM3if1'}]) => {"ansible_loop_var": "item", "changed": false, "create": 0, "item": [{"bridge_name": "t3br2", "default_route_ip": "10.2.22.1", "dns": [{"brif": "t3s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t3s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t3ns2", "route": [{"if": "p1", "ip": "10.2.22.1/24", "ns_if": "t3if", "ns_name": "t3"}], "subnet_ip": "2.2.2.0/24", "tenant_ns": [{"tenant_ns_if": "t3ns2if", "tenant_ns_ip": "10.2.22.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s2if", "tenant_sub_ip": "10.2.22.2/24"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, {"brif": "t3br2if1", "disk": "10G", "mem": 3, "name": "t3_VM3", "vcpu": 2, "vmif": "t3VM3if1"}]}

TASK [Start VM] *********************************************************************************************************************************************
ok: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.21.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.2.21.1', u'bridge_name': u't3br1', u'dns': [{u'dnsif': u't3s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't3s1_dnsbrif'}], u'ns_name': u't3ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.21.2/24', u'tenant_ns_ip': u'10.2.21.1/24', u'tenant_ns_if': u't3ns1if', u'tenant_sub_if': u't3s1if', u'tenant_ns_name': u't3'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.2.21.2', u'dsport': 4789, u'dev': u't3s1if', u'tenant_route_ip': u'192.168.131.2', u'remote_route': u'10.1.21.0/24', u'subnet_route': u'10.2.21.0/24', u'v_name': u'vxlan_t3s1', u'id': 42, u'remote_ip': u'10.1.21.2'}]}, {u'mem': 2, u'name': u't3_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't3br1if1', u'vmif': u't3VM4if1'}]) => {"ansible_loop_var": "item", "changed": false, "item": [{"bridge_name": "t3br1", "default_route_ip": "10.2.21.1", "dns": [{"brif": "t3s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.5", "dnsif": "t3s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t3ns1", "route": [{"if": "p1", "ip": "10.2.21.1/24", "ns_if": "t3if", "ns_name": "t3"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t3ns1if", "tenant_ns_ip": "10.2.21.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s1if", "tenant_sub_ip": "10.2.21.2/24"}], "vxlan": [{"dev": "t3s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.21.2", "remote_ip": "10.1.21.2", "remote_route": "10.1.21.0/24", "subnet_route": "10.2.21.0/24", "tenant_route_ip": "192.168.131.2", "v_name": "vxlan_t3s1"}]}, {"brif": "t3br1if1", "disk": "10G", "mem": 2, "name": "t3_VM4", "vcpu": 4, "vmif": "t3VM4if1"}]}
ok: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.22.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.2.22.1', u'bridge_name': u't3br2', u'dns': [{u'dnsif': u't3s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't3s2_dnsbrif'}], u'ns_name': u't3ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.22.2/24', u'tenant_ns_ip': u'10.2.22.1/24', u'tenant_ns_if': u't3ns2if', u'tenant_sub_if': u't3s2if', u'tenant_ns_name': u't3'}], u'subnet_ip': u'2.2.2.0/24', u'vxlan': [{u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}, {u'mem': 3, u'name': u't3_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't3br2if1', u'vmif': u't3VM3if1'}]) => {"ansible_loop_var": "item", "changed": false, "item": [{"bridge_name": "t3br2", "default_route_ip": "10.2.22.1", "dns": [{"brif": "t3s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t3s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t3ns2", "route": [{"if": "p1", "ip": "10.2.22.1/24", "ns_if": "t3if", "ns_name": "t3"}], "subnet_ip": "2.2.2.0/24", "tenant_ns": [{"tenant_ns_if": "t3ns2if", "tenant_ns_ip": "10.2.22.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s2if", "tenant_sub_ip": "10.2.22.2/24"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, {"brif": "t3br2if1", "disk": "10G", "mem": 3, "name": "t3_VM3", "vcpu": 2, "vmif": "t3VM3if1"}]}

TASK [Attach VM interface] **********************************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.21.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.2.21.1', u'bridge_name': u't3br1', u'dns': [{u'dnsif': u't3s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't3s1_dnsbrif'}], u'ns_name': u't3ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.21.2/24', u'tenant_ns_ip': u'10.2.21.1/24', u'tenant_ns_if': u't3ns1if', u'tenant_sub_if': u't3s1if', u'tenant_ns_name': u't3'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.2.21.2', u'dsport': 4789, u'dev': u't3s1if', u'tenant_route_ip': u'192.168.131.2', u'remote_route': u'10.1.21.0/24', u'subnet_route': u'10.2.21.0/24', u'v_name': u'vxlan_t3s1', u'id': 42, u'remote_ip': u'10.1.21.2'}]}, {u'mem': 2, u'name': u't3_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't3br1if1', u'vmif': u't3VM4if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "virsh domiflist \"t3_VM4\" | grep -w 't3VM4if1' ; if [ $? -ne 0 ] ; then virsh attach-interface \"t3_VM4\" direct \"t3VM4if1\" --live --persistent ; fi\n", "delta": "0:00:00.291285", "end": "2019-12-05 17:50:01.380545", "item": [{"bridge_name": "t3br1", "default_route_ip": "10.2.21.1", "dns": [{"brif": "t3s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.5", "dnsif": "t3s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t3ns1", "route": [{"if": "p1", "ip": "10.2.21.1/24", "ns_if": "t3if", "ns_name": "t3"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t3ns1if", "tenant_ns_ip": "10.2.21.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s1if", "tenant_sub_ip": "10.2.21.2/24"}], "vxlan": [{"dev": "t3s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.21.2", "remote_ip": "10.1.21.2", "remote_route": "10.1.21.0/24", "subnet_route": "10.2.21.0/24", "tenant_route_ip": "192.168.131.2", "v_name": "vxlan_t3s1"}]}, {"brif": "t3br1if1", "disk": "10G", "mem": 2, "name": "t3_VM4", "vcpu": 4, "vmif": "t3VM4if1"}], "rc": 0, "start": "2019-12-05 17:50:01.089260", "stderr": "", "stderr_lines": [], "stdout": "Interface attached successfully", "stdout_lines": ["Interface attached successfully"]}
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.22.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.2.22.1', u'bridge_name': u't3br2', u'dns': [{u'dnsif': u't3s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't3s2_dnsbrif'}], u'ns_name': u't3ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.22.2/24', u'tenant_ns_ip': u'10.2.22.1/24', u'tenant_ns_if': u't3ns2if', u'tenant_sub_if': u't3s2if', u'tenant_ns_name': u't3'}], u'subnet_ip': u'2.2.2.0/24', u'vxlan': [{u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}, {u'mem': 3, u'name': u't3_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't3br2if1', u'vmif': u't3VM3if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "virsh domiflist \"t3_VM3\" | grep -w 't3VM3if1' ; if [ $? -ne 0 ] ; then virsh attach-interface \"t3_VM3\" direct \"t3VM3if1\" --live --persistent ; fi\n", "delta": "0:00:00.239707", "end": "2019-12-05 17:50:01.886426", "item": [{"bridge_name": "t3br2", "default_route_ip": "10.2.22.1", "dns": [{"brif": "t3s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t3s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t3ns2", "route": [{"if": "p1", "ip": "10.2.22.1/24", "ns_if": "t3if", "ns_name": "t3"}], "subnet_ip": "2.2.2.0/24", "tenant_ns": [{"tenant_ns_if": "t3ns2if", "tenant_ns_ip": "10.2.22.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s2if", "tenant_sub_ip": "10.2.22.2/24"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, {"brif": "t3br2if1", "disk": "10G", "mem": 3, "name": "t3_VM3", "vcpu": 2, "vmif": "t3VM3if1"}], "rc": 0, "start": "2019-12-05 17:50:01.646719", "stderr": "", "stderr_lines": [], "stdout": "Interface attached successfully", "stdout_lines": ["Interface attached successfully"]}

PLAY RECAP **************************************************************************************************************************************************
99.99.99.2                 : ok=6    changed=3    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0   

INFO:root: 17:55:59.257571 The subnet 1.1.1.0/24 is present in Cloud 1
INFO:root: 17:55:59.257722 The subnet 1.1.1.0/24 is present in Cloud 2
INFO:root: 17:55:59.257764 The subnet 2.2.2.0/24 is present in Cloud 2
INFO:root: 17:55:59.257795 The VM VM2 is present in Cloud 1
INFO:root: 17:55:59.257822 The VM VM4 is present in Cloud 2
INFO:root: 17:55:59.257847 The VM VM3 is present in Cloud 2
INFO:root: 17:55:59.257897 The subnet 1.1.1.0/24 is present in destination cloud
INFO:root: 17:55:59.257930 The subnet 1.1.1.0/24 is present in destination cloud
ERROR:root: 17:55:59.257959 The subnet 2.2.2.0/24 is not present in the destination cloud
INFO:root: 17:55:59.544453 source cloud is C1
INFO:root: 17:55:59.546057 source cloud is C2
INFO:paramiko.transport:Connected (version 2.0, client OpenSSH_7.6p1)
INFO:paramiko.transport:Authentication (publickey) successful!
INFO:root: 17:56:00.535439 source cloud is C2
INFO:paramiko.transport:Connected (version 2.0, client OpenSSH_7.6p1)
INFO:paramiko.transport:Authentication (publickey) successful!
INFO:root: 17:59:28.455009 The subnet 1.1.1.0/24 is present in Cloud 1
INFO:root: 17:59:28.455297 The subnet 1.1.1.0/24 is present in Cloud 2
INFO:root: 17:59:28.455349 The subnet 2.2.2.0/24 is present in Cloud 2
INFO:root: 17:59:28.455380 The VM VM2 is present in Cloud 1
INFO:root: 17:59:28.455410 The VM VM4 is present in Cloud 2
INFO:root: 17:59:28.455436 The VM VM3 is present in Cloud 2
INFO:root: 17:59:28.455497 The subnet 1.1.1.0/24 is present in destination cloud
INFO:root: 17:59:28.455530 The subnet 1.1.1.0/24 is present in destination cloud
ERROR:root: 17:59:28.455572 The subnet 2.2.2.0/24 is not present in the destination cloud
INFO:root: 17:59:28.747428 source cloud is C1
INFO:root: 17:59:28.749090 source cloud is C2
INFO:paramiko.transport:Connected (version 2.0, client OpenSSH_7.6p1)
INFO:paramiko.transport:Authentication (publickey) successful!
INFO:root: 17:59:29.638719 source cloud is C2
INFO:paramiko.transport:Connected (version 2.0, client OpenSSH_7.6p1)
INFO:paramiko.transport:Authentication (publickey) successful!
INFO:root: 18:02:28.958021 The subnet 1.1.1.0/24 is present in Cloud 1
INFO:root: 18:02:28.958292 The subnet 1.1.1.0/24 is present in Cloud 2
INFO:root: 18:02:28.958339 The subnet 2.2.2.0/24 is present in Cloud 2
INFO:root: 18:02:28.958371 The VM VM2 is present in Cloud 1
INFO:root: 18:02:28.958399 The VM VM4 is present in Cloud 2
INFO:root: 18:02:28.958425 The VM VM3 is present in Cloud 2
INFO:root: 18:02:28.958485 The subnet 1.1.1.0/24 is present in destination cloud
INFO:root: 18:02:28.958538 The subnet 1.1.1.0/24 is present in destination cloud
ERROR:root: 18:02:28.958578 The subnet 2.2.2.0/24 is not present in the destination cloud
INFO:root: 18:02:29.240660 source cloud is C1
INFO:root: 18:02:29.242815 source cloud is C2
INFO:paramiko.transport:Connected (version 2.0, client OpenSSH_7.6p1)
INFO:paramiko.transport:Authentication (publickey) successful!
INFO:root: 18:02:30.120996 source cloud is C2
INFO:paramiko.transport:Connected (version 2.0, client OpenSSH_7.6p1)
INFO:paramiko.transport:Authentication (publickey) successful!
INFO:root: 18:05:25.322006 The subnet 1.1.1.0/24 is present in Cloud 1
INFO:root: 18:05:25.322200 The subnet 1.1.1.0/24 is present in Cloud 2
INFO:root: 18:05:25.322251 The subnet 2.2.2.0/24 is present in Cloud 2
INFO:root: 18:05:25.322287 The VM VM2 is present in Cloud 1
INFO:root: 18:05:25.322319 The VM VM4 is present in Cloud 2
INFO:root: 18:05:25.322348 The VM VM3 is present in Cloud 2
INFO:root: 18:05:25.322406 The subnet 1.1.1.0/24 is present in destination cloud
INFO:root: 18:05:25.322633 The subnet 1.1.1.0/24 is present in destination cloud
ERROR:root: 18:05:25.322806 The subnet 2.2.2.0/24 is not present in the destination cloud
INFO:root: 18:05:25.568508 source cloud is C1
INFO:root: 18:05:25.570214 source cloud is C2
INFO:paramiko.transport:Connected (version 2.0, client OpenSSH_7.6p1)
INFO:paramiko.transport:Authentication (publickey) successful!
INFO:root: 18:05:26.410319 source cloud is C2
INFO:paramiko.transport:Connected (version 2.0, client OpenSSH_7.6p1)
INFO:paramiko.transport:Authentication (publickey) successful!
INFO:root: 18:18:35.529811 Printing the yaml input file
INFO:root: 18:18:35.530022 {'C1': [{'VM': [{'disk': '10G', 'internet_access': True, 'mem': 2, 'name': 'VM1', 'vcpu': 4}, {'disk': '10G', 'internet_access': False, 'mem': 4, 'name': 'VM2', 'vcpu': 2}], 'subnet_addr': '1.1.1.0/24'}], 'C2': [{'VM': [{'disk': '10G', 'internet_access': True, 'mem': 2, 'name': 'VM4', 'vcpu': 4}], 'subnet_addr': '1.1.1.0/24'}, {'VM': [{'disk': '10G', 'internet_access': True, 'mem': 3, 'name': 'VM3', 'vcpu': 2}], 'subnet_addr': '2.2.2.0/24'}], 'MISC': [{'LOG_ENABLE': True}, {'GUI': True}]}
INFO:root: 18:18:35.530177 Provided subnet in C1: 1.1.1.0/24 is valid
INFO:root: 18:18:35.530248 Provided subnet in C2: 1.1.1.0/24 is valid
INFO:root: 18:18:35.530301 Provided subnet in C2: 2.2.2.0/24 is valid
Using /etc/ansible/ansible.cfg as config file

PLAY [main] *************************************************************************************************************************************************

TASK [Create Tenant Namespace] ******************************************************************************************************************************
changed: [localhost] => (item={u'default_route_ip': u'192.168.4.1', u'name': u't4', u'pns_ip': u'192.168.4.1/24', u'tenant_if': u't4if', u'tenant_ip': u'192.168.4.2/24', u'pns_if': u't4pns_if'}) => {"ansible_loop_var": "item", "changed": true, "cmd": ["ip", "netns", "add", "t4"], "delta": "0:00:00.072899", "end": "2019-12-05 18:18:38.368897", "item": {"default_route_ip": "192.168.4.1", "name": "t4", "pns_if": "t4pns_if", "pns_ip": "192.168.4.1/24", "tenant_if": "t4if", "tenant_ip": "192.168.4.2/24"}, "rc": 0, "start": "2019-12-05 18:18:38.295998", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Create Subnet Namespace] ******************************************************************************************************************************
changed: [localhost] => (item={u'route': [{u'ip': u'10.1.31.1/24', u'ns_name': u't4', u'ns_if': u't4if', u'if': u'p1'}], u'default_route_ip': u'10.1.31.1', u'bridge_name': u't4br1', u'dns': [{u'dnsif': u't4s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't4s1_dnsbrif'}], u'ns_name': u't4ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.31.2/24', u'tenant_ns_ip': u'10.1.31.1/24', u'tenant_ns_if': u't4ns1if', u'tenant_ns_name': u't4', u'tenant_sub_if': u't4s1if'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't4_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't4br1if1', u'vmif': u't4VM1if1'}, {u'mem': 4, u'name': u't4_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't4br1if2', u'vmif': u't4VM2if1'}], u'vxlan': [{u'local_ip': u'10.1.31.2', u'tenant_route_ip': u'192.168.4.2', u'dsport': 4789, u'dev': u't4s1if', u'subnet_route': u'10.1.31.0/24', u'remote_route': u'10.2.31.0/24', u'v_name': u'vxlan_t4s1', u'id': 42, u'remote_ip': u'10.2.31.2'}]}) => {"ansible_loop_var": "item", "changed": true, "cmd": ["ip", "netns", "add", "t4ns1"], "delta": "0:00:00.051535", "end": "2019-12-05 18:18:38.768997", "item": {"bridge_name": "t4br1", "default_route_ip": "10.1.31.1", "dns": [{"brif": "t4s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.5", "dnsif": "t4s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t4ns1", "route": [{"if": "p1", "ip": "10.1.31.1/24", "ns_if": "t4if", "ns_name": "t4"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t4ns1if", "tenant_ns_ip": "10.1.31.1/24", "tenant_ns_name": "t4", "tenant_sub_if": "t4s1if", "tenant_sub_ip": "10.1.31.2/24"}], "vms": [{"brif": "t4br1if1", "disk": "10G", "mem": 2, "name": "t4_VM1", "vcpu": 4, "vmif": "t4VM1if1"}, {"brif": "t4br1if2", "disk": "10G", "mem": 4, "name": "t4_VM2", "vcpu": 2, "vmif": "t4VM2if1"}], "vxlan": [{"dev": "t4s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.31.2", "remote_ip": "10.2.31.2", "remote_route": "10.2.31.0/24", "subnet_route": "10.1.31.0/24", "tenant_route_ip": "192.168.4.2", "v_name": "vxlan_t4s1"}]}, "rc": 0, "start": "2019-12-05 18:18:38.717462", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Create Tenant VETH pairs] *****************************************************************************************************************************
changed: [localhost] => (item={u'default_route_ip': u'192.168.4.1', u'name': u't4', u'pns_ip': u'192.168.4.1/24', u'tenant_if': u't4if', u'tenant_ip': u'192.168.4.2/24', u'pns_if': u't4pns_if'}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip link show \"t4if\" ; if [ $? -ne 0 ] ; then ip link add \"t4if\" type veth peer name \"t4pns_if\" ; fi\n", "delta": "0:00:00.017577", "end": "2019-12-05 18:18:39.080973", "item": {"default_route_ip": "192.168.4.1", "name": "t4", "pns_if": "t4pns_if", "pns_ip": "192.168.4.1/24", "tenant_if": "t4if", "tenant_ip": "192.168.4.2/24"}, "rc": 0, "start": "2019-12-05 18:18:39.063396", "stderr": "Device \"t4if\" does not exist.", "stderr_lines": ["Device \"t4if\" does not exist."], "stdout": "", "stdout_lines": []}

TASK [Attach Tenant VETH Pairs] *****************************************************************************************************************************
changed: [localhost] => (item={u'default_route_ip': u'192.168.4.1', u'name': u't4', u'pns_ip': u'192.168.4.1/24', u'tenant_if': u't4if', u'tenant_ip': u'192.168.4.2/24', u'pns_if': u't4pns_if'}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec pns ip link show \"t4pns_if\" ; if [ $? -ne 0 ] ; then ip link set \"t4pns_if\" netns pns ; fi\nip netns exec \"t4\" ip link show \"t4if\" ; if [ $? -ne 0 ] ; then ip link set \"t4if\" netns \"t4\" ; fi\nip netns exec pns ip link set dev \"t4pns_if\" up\nip netns exec \"t4\" ip link set dev \"t4if\" up\n", "delta": "0:00:00.221584", "end": "2019-12-05 18:18:39.598719", "item": {"default_route_ip": "192.168.4.1", "name": "t4", "pns_if": "t4pns_if", "pns_ip": "192.168.4.1/24", "tenant_if": "t4if", "tenant_ip": "192.168.4.2/24"}, "rc": 0, "start": "2019-12-05 18:18:39.377135", "stderr": "Device \"t4pns_if\" does not exist.\nDevice \"t4if\" does not exist.", "stderr_lines": ["Device \"t4pns_if\" does not exist.", "Device \"t4if\" does not exist."], "stdout": "", "stdout_lines": []}

TASK [Add IP addresses to Tenant VETH Pairs] ****************************************************************************************************************
changed: [localhost] => (item={u'default_route_ip': u'192.168.4.1', u'name': u't4', u'pns_ip': u'192.168.4.1/24', u'tenant_if': u't4if', u'tenant_ip': u'192.168.4.2/24', u'pns_if': u't4pns_if'}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec pns ip addr show \"t4pns_if\" | awk 'FNR==3{ print $2 }' | grep -w '^192.168.4.1/24' ; if [ $? -ne 0 ] ; then ip netns exec pns ip addr add \"192.168.4.1/24\" dev \"t4pns_if\" ; fi\nip netns exec \"t4\" ip addr show \"t4if\" | awk 'FNR==3{ print $2 }' | grep -w '^192.168.4.2/24' ; if [ $? -ne 0 ] ; then ip netns exec \"t4\" ip addr add \"192.168.4.2/24\" dev \"t4if\" ; fi\n", "delta": "0:00:00.216178", "end": "2019-12-05 18:18:40.138788", "item": {"default_route_ip": "192.168.4.1", "name": "t4", "pns_if": "t4pns_if", "pns_ip": "192.168.4.1/24", "tenant_if": "t4if", "tenant_ip": "192.168.4.2/24"}, "rc": 0, "start": "2019-12-05 18:18:39.922610", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Create Namespace VETH Pairs] **************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.31.1/24', u'ns_name': u't4', u'ns_if': u't4if', u'if': u'p1'}], u'default_route_ip': u'10.1.31.1', u'bridge_name': u't4br1', u'dns': [{u'dnsif': u't4s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't4s1_dnsbrif'}], u'ns_name': u't4ns1', u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't4_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't4br1if1', u'vmif': u't4VM1if1'}, {u'mem': 4, u'name': u't4_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't4br1if2', u'vmif': u't4VM2if1'}], u'vxlan': [{u'local_ip': u'10.1.31.2', u'dsport': 4789, u'dev': u't4s1if', u'tenant_route_ip': u'192.168.4.2', u'remote_route': u'10.2.31.0/24', u'subnet_route': u'10.1.31.0/24', u'v_name': u'vxlan_t4s1', u'id': 42, u'remote_ip': u'10.2.31.2'}]}, {u'tenant_sub_ip': u'10.1.31.2/24', u'tenant_ns_ip': u'10.1.31.1/24', u'tenant_ns_if': u't4ns1if', u'tenant_sub_if': u't4s1if', u'tenant_ns_name': u't4'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip link show \"t4ns1if\" ; if [ $? -ne 0 ] ; then ip link add \"t4ns1if\" type veth peer name \"t4s1if\" ; fi\n", "delta": "0:00:00.012253", "end": "2019-12-05 18:18:40.487543", "item": [{"bridge_name": "t4br1", "default_route_ip": "10.1.31.1", "dns": [{"brif": "t4s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.5", "dnsif": "t4s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t4ns1", "route": [{"if": "p1", "ip": "10.1.31.1/24", "ns_if": "t4if", "ns_name": "t4"}], "subnet_ip": "1.1.1.0/24", "vms": [{"brif": "t4br1if1", "disk": "10G", "mem": 2, "name": "t4_VM1", "vcpu": 4, "vmif": "t4VM1if1"}, {"brif": "t4br1if2", "disk": "10G", "mem": 4, "name": "t4_VM2", "vcpu": 2, "vmif": "t4VM2if1"}], "vxlan": [{"dev": "t4s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.31.2", "remote_ip": "10.2.31.2", "remote_route": "10.2.31.0/24", "subnet_route": "10.1.31.0/24", "tenant_route_ip": "192.168.4.2", "v_name": "vxlan_t4s1"}]}, {"tenant_ns_if": "t4ns1if", "tenant_ns_ip": "10.1.31.1/24", "tenant_ns_name": "t4", "tenant_sub_if": "t4s1if", "tenant_sub_ip": "10.1.31.2/24"}], "rc": 0, "start": "2019-12-05 18:18:40.475290", "stderr": "Device \"t4ns1if\" does not exist.", "stderr_lines": ["Device \"t4ns1if\" does not exist."], "stdout": "", "stdout_lines": []}

TASK [Attach Namespace VETH Pairs] **************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.31.1/24', u'ns_name': u't4', u'ns_if': u't4if', u'if': u'p1'}], u'default_route_ip': u'10.1.31.1', u'bridge_name': u't4br1', u'dns': [{u'dnsif': u't4s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't4s1_dnsbrif'}], u'ns_name': u't4ns1', u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't4_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't4br1if1', u'vmif': u't4VM1if1'}, {u'mem': 4, u'name': u't4_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't4br1if2', u'vmif': u't4VM2if1'}], u'vxlan': [{u'local_ip': u'10.1.31.2', u'dsport': 4789, u'dev': u't4s1if', u'tenant_route_ip': u'192.168.4.2', u'remote_route': u'10.2.31.0/24', u'subnet_route': u'10.1.31.0/24', u'v_name': u'vxlan_t4s1', u'id': 42, u'remote_ip': u'10.2.31.2'}]}, {u'tenant_sub_ip': u'10.1.31.2/24', u'tenant_ns_ip': u'10.1.31.1/24', u'tenant_ns_if': u't4ns1if', u'tenant_sub_if': u't4s1if', u'tenant_ns_name': u't4'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t4\" ip link show \"t4ns1if\" ; if [ $? -ne 0 ] ; then ip link set \"t4ns1if\" netns \"t4\" ; fi\nip netns exec \"t4ns1\" ip link show \"t4s1if\" ; if [ $? -ne 0 ] ; then ip link set \"t4s1if\" netns \"t4ns1\" ; fi\n", "delta": "0:00:00.111304", "end": "2019-12-05 18:18:40.923808", "item": [{"bridge_name": "t4br1", "default_route_ip": "10.1.31.1", "dns": [{"brif": "t4s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.5", "dnsif": "t4s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t4ns1", "route": [{"if": "p1", "ip": "10.1.31.1/24", "ns_if": "t4if", "ns_name": "t4"}], "subnet_ip": "1.1.1.0/24", "vms": [{"brif": "t4br1if1", "disk": "10G", "mem": 2, "name": "t4_VM1", "vcpu": 4, "vmif": "t4VM1if1"}, {"brif": "t4br1if2", "disk": "10G", "mem": 4, "name": "t4_VM2", "vcpu": 2, "vmif": "t4VM2if1"}], "vxlan": [{"dev": "t4s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.31.2", "remote_ip": "10.2.31.2", "remote_route": "10.2.31.0/24", "subnet_route": "10.1.31.0/24", "tenant_route_ip": "192.168.4.2", "v_name": "vxlan_t4s1"}]}, {"tenant_ns_if": "t4ns1if", "tenant_ns_ip": "10.1.31.1/24", "tenant_ns_name": "t4", "tenant_sub_if": "t4s1if", "tenant_sub_ip": "10.1.31.2/24"}], "rc": 0, "start": "2019-12-05 18:18:40.812504", "stderr": "Device \"t4ns1if\" does not exist.\nDevice \"t4s1if\" does not exist.", "stderr_lines": ["Device \"t4ns1if\" does not exist.", "Device \"t4s1if\" does not exist."], "stdout": "", "stdout_lines": []}

TASK [Set Namespace VETH Pairs UP] **************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.31.1/24', u'ns_name': u't4', u'ns_if': u't4if', u'if': u'p1'}], u'default_route_ip': u'10.1.31.1', u'bridge_name': u't4br1', u'dns': [{u'dnsif': u't4s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't4s1_dnsbrif'}], u'ns_name': u't4ns1', u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't4_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't4br1if1', u'vmif': u't4VM1if1'}, {u'mem': 4, u'name': u't4_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't4br1if2', u'vmif': u't4VM2if1'}], u'vxlan': [{u'local_ip': u'10.1.31.2', u'dsport': 4789, u'dev': u't4s1if', u'tenant_route_ip': u'192.168.4.2', u'remote_route': u'10.2.31.0/24', u'subnet_route': u'10.1.31.0/24', u'v_name': u'vxlan_t4s1', u'id': 42, u'remote_ip': u'10.2.31.2'}]}, {u'tenant_sub_ip': u'10.1.31.2/24', u'tenant_ns_ip': u'10.1.31.1/24', u'tenant_ns_if': u't4ns1if', u'tenant_sub_if': u't4s1if', u'tenant_ns_name': u't4'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t4\" ip link set dev \"t4ns1if\" up\nip netns exec \"t4ns1\" ip link set dev \"t4s1if\" up\n", "delta": "0:00:00.089001", "end": "2019-12-05 18:18:41.331054", "item": [{"bridge_name": "t4br1", "default_route_ip": "10.1.31.1", "dns": [{"brif": "t4s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.5", "dnsif": "t4s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t4ns1", "route": [{"if": "p1", "ip": "10.1.31.1/24", "ns_if": "t4if", "ns_name": "t4"}], "subnet_ip": "1.1.1.0/24", "vms": [{"brif": "t4br1if1", "disk": "10G", "mem": 2, "name": "t4_VM1", "vcpu": 4, "vmif": "t4VM1if1"}, {"brif": "t4br1if2", "disk": "10G", "mem": 4, "name": "t4_VM2", "vcpu": 2, "vmif": "t4VM2if1"}], "vxlan": [{"dev": "t4s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.31.2", "remote_ip": "10.2.31.2", "remote_route": "10.2.31.0/24", "subnet_route": "10.1.31.0/24", "tenant_route_ip": "192.168.4.2", "v_name": "vxlan_t4s1"}]}, {"tenant_ns_if": "t4ns1if", "tenant_ns_ip": "10.1.31.1/24", "tenant_ns_name": "t4", "tenant_sub_if": "t4s1if", "tenant_sub_ip": "10.1.31.2/24"}], "rc": 0, "start": "2019-12-05 18:18:41.242053", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Add IP addresses to Namespace VETH Pairs] *************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.31.1/24', u'ns_name': u't4', u'ns_if': u't4if', u'if': u'p1'}], u'default_route_ip': u'10.1.31.1', u'bridge_name': u't4br1', u'dns': [{u'dnsif': u't4s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't4s1_dnsbrif'}], u'ns_name': u't4ns1', u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't4_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't4br1if1', u'vmif': u't4VM1if1'}, {u'mem': 4, u'name': u't4_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't4br1if2', u'vmif': u't4VM2if1'}], u'vxlan': [{u'local_ip': u'10.1.31.2', u'dsport': 4789, u'dev': u't4s1if', u'tenant_route_ip': u'192.168.4.2', u'remote_route': u'10.2.31.0/24', u'subnet_route': u'10.1.31.0/24', u'v_name': u'vxlan_t4s1', u'id': 42, u'remote_ip': u'10.2.31.2'}]}, {u'tenant_sub_ip': u'10.1.31.2/24', u'tenant_ns_ip': u'10.1.31.1/24', u'tenant_ns_if': u't4ns1if', u'tenant_sub_if': u't4s1if', u'tenant_ns_name': u't4'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t4ns1\" ip addr show \"t4s1if\" | awk 'FNR==3{ print $2 }' | grep -w '^10.1.31.2/24' ; if [ $? -ne 0 ] ; then ip netns exec \"t4ns1\" ip addr add \"10.1.31.2/24\" dev \"t4s1if\" ; fi\n\nip netns exec \"t4\" ip addr show \"t4ns1if\" | awk 'FNR==3{ print $2 }' | grep -w '^10.1.31.1/24' ; if [ $? -ne 0 ] ; then ip netns exec \"t4\" ip addr add \"10.1.31.1/24\" dev \"t4ns1if\" ; fi\n", "delta": "0:00:00.159950", "end": "2019-12-05 18:18:41.815509", "item": [{"bridge_name": "t4br1", "default_route_ip": "10.1.31.1", "dns": [{"brif": "t4s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.5", "dnsif": "t4s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t4ns1", "route": [{"if": "p1", "ip": "10.1.31.1/24", "ns_if": "t4if", "ns_name": "t4"}], "subnet_ip": "1.1.1.0/24", "vms": [{"brif": "t4br1if1", "disk": "10G", "mem": 2, "name": "t4_VM1", "vcpu": 4, "vmif": "t4VM1if1"}, {"brif": "t4br1if2", "disk": "10G", "mem": 4, "name": "t4_VM2", "vcpu": 2, "vmif": "t4VM2if1"}], "vxlan": [{"dev": "t4s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.31.2", "remote_ip": "10.2.31.2", "remote_route": "10.2.31.0/24", "subnet_route": "10.1.31.0/24", "tenant_route_ip": "192.168.4.2", "v_name": "vxlan_t4s1"}]}, {"tenant_ns_if": "t4ns1if", "tenant_ns_ip": "10.1.31.1/24", "tenant_ns_name": "t4", "tenant_sub_if": "t4s1if", "tenant_sub_ip": "10.1.31.2/24"}], "rc": 0, "start": "2019-12-05 18:18:41.655559", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Add IP Route to Tenant] *******************************************************************************************************************************
changed: [localhost] => (item={u'default_route_ip': u'192.168.4.1', u'name': u't4', u'pns_ip': u'192.168.4.1/24', u'tenant_if': u't4if', u'tenant_ip': u'192.168.4.2/24', u'pns_if': u't4pns_if'}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t4\" ip route show default | grep -w '[d]efault via 192.168.4.1' ; if [ $? -ne 0 ] ; then ip netns exec \"t4\" ip route add default via \"192.168.4.1\" ; fi\n", "delta": "0:00:00.096501", "end": "2019-12-05 18:18:42.194804", "item": {"default_route_ip": "192.168.4.1", "name": "t4", "pns_if": "t4pns_if", "pns_ip": "192.168.4.1/24", "tenant_if": "t4if", "tenant_ip": "192.168.4.2/24"}, "rc": 0, "start": "2019-12-05 18:18:42.098303", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Add IP Route to Tenant Subnet] ************************************************************************************************************************
changed: [localhost] => (item={u'route': [{u'ip': u'10.1.31.1/24', u'ns_name': u't4', u'ns_if': u't4if', u'if': u'p1'}], u'default_route_ip': u'10.1.31.1', u'bridge_name': u't4br1', u'dns': [{u'dnsif': u't4s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't4s1_dnsbrif'}], u'ns_name': u't4ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.31.2/24', u'tenant_ns_ip': u'10.1.31.1/24', u'tenant_ns_if': u't4ns1if', u'tenant_ns_name': u't4', u'tenant_sub_if': u't4s1if'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't4_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't4br1if1', u'vmif': u't4VM1if1'}, {u'mem': 4, u'name': u't4_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't4br1if2', u'vmif': u't4VM2if1'}], u'vxlan': [{u'local_ip': u'10.1.31.2', u'tenant_route_ip': u'192.168.4.2', u'dsport': 4789, u'dev': u't4s1if', u'subnet_route': u'10.1.31.0/24', u'remote_route': u'10.2.31.0/24', u'v_name': u'vxlan_t4s1', u'id': 42, u'remote_ip': u'10.2.31.2'}]}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t4ns1\" ip route show default | grep -w '[d]efault via 10.1.31.1' ; if [ $? -ne 0 ] ; then ip netns exec \"t4ns1\" ip route add default via \"10.1.31.1\" ; fi\n", "delta": "0:00:00.082247", "end": "2019-12-05 18:18:42.570808", "item": {"bridge_name": "t4br1", "default_route_ip": "10.1.31.1", "dns": [{"brif": "t4s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.5", "dnsif": "t4s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t4ns1", "route": [{"if": "p1", "ip": "10.1.31.1/24", "ns_if": "t4if", "ns_name": "t4"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t4ns1if", "tenant_ns_ip": "10.1.31.1/24", "tenant_ns_name": "t4", "tenant_sub_if": "t4s1if", "tenant_sub_ip": "10.1.31.2/24"}], "vms": [{"brif": "t4br1if1", "disk": "10G", "mem": 2, "name": "t4_VM1", "vcpu": 4, "vmif": "t4VM1if1"}, {"brif": "t4br1if2", "disk": "10G", "mem": 4, "name": "t4_VM2", "vcpu": 2, "vmif": "t4VM2if1"}], "vxlan": [{"dev": "t4s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.31.2", "remote_ip": "10.2.31.2", "remote_route": "10.2.31.0/24", "subnet_route": "10.1.31.0/24", "tenant_route_ip": "192.168.4.2", "v_name": "vxlan_t4s1"}]}, "rc": 0, "start": "2019-12-05 18:18:42.488561", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Create bridge inside namespace] ***********************************************************************************************************************
changed: [localhost] => (item={u'route': [{u'ip': u'10.1.31.1/24', u'ns_name': u't4', u'ns_if': u't4if', u'if': u'p1'}], u'default_route_ip': u'10.1.31.1', u'bridge_name': u't4br1', u'dns': [{u'dnsif': u't4s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't4s1_dnsbrif'}], u'ns_name': u't4ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.31.2/24', u'tenant_ns_ip': u'10.1.31.1/24', u'tenant_ns_if': u't4ns1if', u'tenant_ns_name': u't4', u'tenant_sub_if': u't4s1if'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't4_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't4br1if1', u'vmif': u't4VM1if1'}, {u'mem': 4, u'name': u't4_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't4br1if2', u'vmif': u't4VM2if1'}], u'vxlan': [{u'local_ip': u'10.1.31.2', u'tenant_route_ip': u'192.168.4.2', u'dsport': 4789, u'dev': u't4s1if', u'subnet_route': u'10.1.31.0/24', u'remote_route': u'10.2.31.0/24', u'v_name': u'vxlan_t4s1', u'id': 42, u'remote_ip': u'10.2.31.2'}]}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t4ns1\" brctl show | grep -w '^t4br1'; if [ $? -ne 0 ] ; then ip netns exec \"t4ns1\" brctl addbr \"t4br1\" ; fi\nip netns exec \"t4ns1\" ip link set dev \"t4br1\" up\n", "delta": "0:00:00.109166", "end": "2019-12-05 18:18:42.990774", "item": {"bridge_name": "t4br1", "default_route_ip": "10.1.31.1", "dns": [{"brif": "t4s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.5", "dnsif": "t4s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t4ns1", "route": [{"if": "p1", "ip": "10.1.31.1/24", "ns_if": "t4if", "ns_name": "t4"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t4ns1if", "tenant_ns_ip": "10.1.31.1/24", "tenant_ns_name": "t4", "tenant_sub_if": "t4s1if", "tenant_sub_ip": "10.1.31.2/24"}], "vms": [{"brif": "t4br1if1", "disk": "10G", "mem": 2, "name": "t4_VM1", "vcpu": 4, "vmif": "t4VM1if1"}, {"brif": "t4br1if2", "disk": "10G", "mem": 4, "name": "t4_VM2", "vcpu": 2, "vmif": "t4VM2if1"}], "vxlan": [{"dev": "t4s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.31.2", "remote_ip": "10.2.31.2", "remote_route": "10.2.31.0/24", "subnet_route": "10.1.31.0/24", "tenant_route_ip": "192.168.4.2", "v_name": "vxlan_t4s1"}]}, "rc": 0, "start": "2019-12-05 18:18:42.881608", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Create DNS VETH Pair] *********************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.31.1/24', u'ns_name': u't4', u'ns_if': u't4if', u'if': u'p1'}], u'default_route_ip': u'10.1.31.1', u'bridge_name': u't4br1', u'ns_name': u't4ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.31.2/24', u'tenant_ns_ip': u'10.1.31.1/24', u'tenant_ns_if': u't4ns1if', u'tenant_sub_if': u't4s1if', u'tenant_ns_name': u't4'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't4_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't4br1if1', u'vmif': u't4VM1if1'}, {u'mem': 4, u'name': u't4_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't4br1if2', u'vmif': u't4VM2if1'}], u'vxlan': [{u'local_ip': u'10.1.31.2', u'dsport': 4789, u'dev': u't4s1if', u'tenant_route_ip': u'192.168.4.2', u'remote_route': u'10.2.31.0/24', u'subnet_route': u'10.1.31.0/24', u'v_name': u'vxlan_t4s1', u'id': 42, u'remote_ip': u'10.2.31.2'}]}, {u'dnsif': u't4s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't4s1_dnsbrif'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t4ns1\" ip link show \"t4s1_dnsbrif\" ; if [ $? -ne 0 ] ; then ip netns exec \"t4ns1\" ip link add \"t4s1_dnsbrif\" type veth peer name \"t4s1_dnsif\" ; fi\nip netns exec \"t4ns1\" ip link set dev \"t4s1_dnsbrif\" up\nip netns exec \"t4ns1\" ip link set dev \"t4s1_dnsif\" up\n", "delta": "0:00:00.145615", "end": "2019-12-05 18:18:43.426708", "item": [{"bridge_name": "t4br1", "default_route_ip": "10.1.31.1", "ns_name": "t4ns1", "route": [{"if": "p1", "ip": "10.1.31.1/24", "ns_if": "t4if", "ns_name": "t4"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t4ns1if", "tenant_ns_ip": "10.1.31.1/24", "tenant_ns_name": "t4", "tenant_sub_if": "t4s1if", "tenant_sub_ip": "10.1.31.2/24"}], "vms": [{"brif": "t4br1if1", "disk": "10G", "mem": 2, "name": "t4_VM1", "vcpu": 4, "vmif": "t4VM1if1"}, {"brif": "t4br1if2", "disk": "10G", "mem": 4, "name": "t4_VM2", "vcpu": 2, "vmif": "t4VM2if1"}], "vxlan": [{"dev": "t4s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.31.2", "remote_ip": "10.2.31.2", "remote_route": "10.2.31.0/24", "subnet_route": "10.1.31.0/24", "tenant_route_ip": "192.168.4.2", "v_name": "vxlan_t4s1"}]}, {"brif": "t4s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.5", "dnsif": "t4s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "rc": 0, "start": "2019-12-05 18:18:43.281093", "stderr": "Device \"t4s1_dnsbrif\" does not exist.", "stderr_lines": ["Device \"t4s1_dnsbrif\" does not exist."], "stdout": "", "stdout_lines": []}

TASK [Attach DNS VETH Pair] *********************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.31.1/24', u'ns_name': u't4', u'ns_if': u't4if', u'if': u'p1'}], u'default_route_ip': u'10.1.31.1', u'bridge_name': u't4br1', u'ns_name': u't4ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.31.2/24', u'tenant_ns_ip': u'10.1.31.1/24', u'tenant_ns_if': u't4ns1if', u'tenant_sub_if': u't4s1if', u'tenant_ns_name': u't4'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't4_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't4br1if1', u'vmif': u't4VM1if1'}, {u'mem': 4, u'name': u't4_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't4br1if2', u'vmif': u't4VM2if1'}], u'vxlan': [{u'local_ip': u'10.1.31.2', u'dsport': 4789, u'dev': u't4s1if', u'tenant_route_ip': u'192.168.4.2', u'remote_route': u'10.2.31.0/24', u'subnet_route': u'10.1.31.0/24', u'v_name': u'vxlan_t4s1', u'id': 42, u'remote_ip': u'10.2.31.2'}]}, {u'dnsif': u't4s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't4s1_dnsbrif'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t4ns1\" brctl show \"t4br1\" | grep -w 't4s1_dnsbrif' ; if [ $? -ne 0 ] ; then ip netns exec \"t4ns1\" brctl addif \"t4br1\" \"t4s1_dnsbrif\" ; fi\n", "delta": "0:00:00.078758", "end": "2019-12-05 18:18:43.782821", "item": [{"bridge_name": "t4br1", "default_route_ip": "10.1.31.1", "ns_name": "t4ns1", "route": [{"if": "p1", "ip": "10.1.31.1/24", "ns_if": "t4if", "ns_name": "t4"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t4ns1if", "tenant_ns_ip": "10.1.31.1/24", "tenant_ns_name": "t4", "tenant_sub_if": "t4s1if", "tenant_sub_ip": "10.1.31.2/24"}], "vms": [{"brif": "t4br1if1", "disk": "10G", "mem": 2, "name": "t4_VM1", "vcpu": 4, "vmif": "t4VM1if1"}, {"brif": "t4br1if2", "disk": "10G", "mem": 4, "name": "t4_VM2", "vcpu": 2, "vmif": "t4VM2if1"}], "vxlan": [{"dev": "t4s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.31.2", "remote_ip": "10.2.31.2", "remote_route": "10.2.31.0/24", "subnet_route": "10.1.31.0/24", "tenant_route_ip": "192.168.4.2", "v_name": "vxlan_t4s1"}]}, {"brif": "t4s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.5", "dnsif": "t4s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "rc": 0, "start": "2019-12-05 18:18:43.704063", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Create VETH Pairs] ************************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.31.1/24', u'ns_name': u't4', u'ns_if': u't4if', u'if': u'p1'}], u'default_route_ip': u'10.1.31.1', u'bridge_name': u't4br1', u'dns': [{u'dnsif': u't4s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't4s1_dnsbrif'}], u'ns_name': u't4ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.31.2/24', u'tenant_ns_ip': u'10.1.31.1/24', u'tenant_ns_if': u't4ns1if', u'tenant_sub_if': u't4s1if', u'tenant_ns_name': u't4'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.1.31.2', u'dsport': 4789, u'dev': u't4s1if', u'tenant_route_ip': u'192.168.4.2', u'remote_route': u'10.2.31.0/24', u'subnet_route': u'10.1.31.0/24', u'v_name': u'vxlan_t4s1', u'id': 42, u'remote_ip': u'10.2.31.2'}]}, {u'mem': 2, u'name': u't4_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't4br1if1', u'vmif': u't4VM1if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip link show \"t4br1if1\" ; if [ $? -ne 0 ] ; then ip link add \"t4VM1if1\" type veth peer name \"t4br1if1\" ; fi\nip link set dev \"t4br1if1\" up\nip link set dev \"t4VM1if1\" up\n", "delta": "0:00:00.018879", "end": "2019-12-05 18:18:44.105877", "item": [{"bridge_name": "t4br1", "default_route_ip": "10.1.31.1", "dns": [{"brif": "t4s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.5", "dnsif": "t4s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t4ns1", "route": [{"if": "p1", "ip": "10.1.31.1/24", "ns_if": "t4if", "ns_name": "t4"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t4ns1if", "tenant_ns_ip": "10.1.31.1/24", "tenant_ns_name": "t4", "tenant_sub_if": "t4s1if", "tenant_sub_ip": "10.1.31.2/24"}], "vxlan": [{"dev": "t4s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.31.2", "remote_ip": "10.2.31.2", "remote_route": "10.2.31.0/24", "subnet_route": "10.1.31.0/24", "tenant_route_ip": "192.168.4.2", "v_name": "vxlan_t4s1"}]}, {"brif": "t4br1if1", "disk": "10G", "mem": 2, "name": "t4_VM1", "vcpu": 4, "vmif": "t4VM1if1"}], "rc": 0, "start": "2019-12-05 18:18:44.086998", "stderr": "Device \"t4br1if1\" does not exist.", "stderr_lines": ["Device \"t4br1if1\" does not exist."], "stdout": "", "stdout_lines": []}
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.31.1/24', u'ns_name': u't4', u'ns_if': u't4if', u'if': u'p1'}], u'default_route_ip': u'10.1.31.1', u'bridge_name': u't4br1', u'dns': [{u'dnsif': u't4s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't4s1_dnsbrif'}], u'ns_name': u't4ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.31.2/24', u'tenant_ns_ip': u'10.1.31.1/24', u'tenant_ns_if': u't4ns1if', u'tenant_sub_if': u't4s1if', u'tenant_ns_name': u't4'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.1.31.2', u'dsport': 4789, u'dev': u't4s1if', u'tenant_route_ip': u'192.168.4.2', u'remote_route': u'10.2.31.0/24', u'subnet_route': u'10.1.31.0/24', u'v_name': u'vxlan_t4s1', u'id': 42, u'remote_ip': u'10.2.31.2'}]}, {u'mem': 4, u'name': u't4_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't4br1if2', u'vmif': u't4VM2if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip link show \"t4br1if2\" ; if [ $? -ne 0 ] ; then ip link add \"t4VM2if1\" type veth peer name \"t4br1if2\" ; fi\nip link set dev \"t4br1if2\" up\nip link set dev \"t4VM2if1\" up\n", "delta": "0:00:00.017924", "end": "2019-12-05 18:18:44.343536", "item": [{"bridge_name": "t4br1", "default_route_ip": "10.1.31.1", "dns": [{"brif": "t4s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.5", "dnsif": "t4s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t4ns1", "route": [{"if": "p1", "ip": "10.1.31.1/24", "ns_if": "t4if", "ns_name": "t4"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t4ns1if", "tenant_ns_ip": "10.1.31.1/24", "tenant_ns_name": "t4", "tenant_sub_if": "t4s1if", "tenant_sub_ip": "10.1.31.2/24"}], "vxlan": [{"dev": "t4s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.31.2", "remote_ip": "10.2.31.2", "remote_route": "10.2.31.0/24", "subnet_route": "10.1.31.0/24", "tenant_route_ip": "192.168.4.2", "v_name": "vxlan_t4s1"}]}, {"brif": "t4br1if2", "disk": "10G", "mem": 4, "name": "t4_VM2", "vcpu": 2, "vmif": "t4VM2if1"}], "rc": 0, "start": "2019-12-05 18:18:44.325612", "stderr": "Device \"t4br1if2\" does not exist.", "stderr_lines": ["Device \"t4br1if2\" does not exist."], "stdout": "", "stdout_lines": []}

TASK [Attach VETH Pairs] ************************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.31.1/24', u'ns_name': u't4', u'ns_if': u't4if', u'if': u'p1'}], u'default_route_ip': u'10.1.31.1', u'bridge_name': u't4br1', u'dns': [{u'dnsif': u't4s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't4s1_dnsbrif'}], u'ns_name': u't4ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.31.2/24', u'tenant_ns_ip': u'10.1.31.1/24', u'tenant_ns_if': u't4ns1if', u'tenant_sub_if': u't4s1if', u'tenant_ns_name': u't4'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.1.31.2', u'dsport': 4789, u'dev': u't4s1if', u'tenant_route_ip': u'192.168.4.2', u'remote_route': u'10.2.31.0/24', u'subnet_route': u'10.1.31.0/24', u'v_name': u'vxlan_t4s1', u'id': 42, u'remote_ip': u'10.2.31.2'}]}, {u'mem': 2, u'name': u't4_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't4br1if1', u'vmif': u't4VM1if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip link show \"t4br1if1\" ; if [ $? -eq 0 ] ; then ip link set \"t4br1if1\" netns \"t4ns1\" ; fi\nip netns exec \"t4ns1\" brctl show \"t4br1\" | grep -w 't4br1if1' ; if [ $? -ne 0 ] ; then ip netns exec \"t4ns1\" brctl addif \"t4br1\" \"t4br1if1\" ; fi\n", "delta": "0:00:00.123241", "end": "2019-12-05 18:18:44.742660", "item": [{"bridge_name": "t4br1", "default_route_ip": "10.1.31.1", "dns": [{"brif": "t4s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.5", "dnsif": "t4s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t4ns1", "route": [{"if": "p1", "ip": "10.1.31.1/24", "ns_if": "t4if", "ns_name": "t4"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t4ns1if", "tenant_ns_ip": "10.1.31.1/24", "tenant_ns_name": "t4", "tenant_sub_if": "t4s1if", "tenant_sub_ip": "10.1.31.2/24"}], "vxlan": [{"dev": "t4s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.31.2", "remote_ip": "10.2.31.2", "remote_route": "10.2.31.0/24", "subnet_route": "10.1.31.0/24", "tenant_route_ip": "192.168.4.2", "v_name": "vxlan_t4s1"}]}, {"brif": "t4br1if1", "disk": "10G", "mem": 2, "name": "t4_VM1", "vcpu": 4, "vmif": "t4VM1if1"}], "rc": 0, "start": "2019-12-05 18:18:44.619419", "stderr": "", "stderr_lines": [], "stdout": "50: t4br1if1@t4VM1if1: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP mode DEFAULT group default qlen 1000\n    link/ether c2:57:77:45:86:a4 brd ff:ff:ff:ff:ff:ff", "stdout_lines": ["50: t4br1if1@t4VM1if1: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP mode DEFAULT group default qlen 1000", "    link/ether c2:57:77:45:86:a4 brd ff:ff:ff:ff:ff:ff"]}
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.31.1/24', u'ns_name': u't4', u'ns_if': u't4if', u'if': u'p1'}], u'default_route_ip': u'10.1.31.1', u'bridge_name': u't4br1', u'dns': [{u'dnsif': u't4s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't4s1_dnsbrif'}], u'ns_name': u't4ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.31.2/24', u'tenant_ns_ip': u'10.1.31.1/24', u'tenant_ns_if': u't4ns1if', u'tenant_sub_if': u't4s1if', u'tenant_ns_name': u't4'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.1.31.2', u'dsport': 4789, u'dev': u't4s1if', u'tenant_route_ip': u'192.168.4.2', u'remote_route': u'10.2.31.0/24', u'subnet_route': u'10.1.31.0/24', u'v_name': u'vxlan_t4s1', u'id': 42, u'remote_ip': u'10.2.31.2'}]}, {u'mem': 4, u'name': u't4_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't4br1if2', u'vmif': u't4VM2if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip link show \"t4br1if2\" ; if [ $? -eq 0 ] ; then ip link set \"t4br1if2\" netns \"t4ns1\" ; fi\nip netns exec \"t4ns1\" brctl show \"t4br1\" | grep -w 't4br1if2' ; if [ $? -ne 0 ] ; then ip netns exec \"t4ns1\" brctl addif \"t4br1\" \"t4br1if2\" ; fi\n", "delta": "0:00:00.114390", "end": "2019-12-05 18:18:45.098819", "item": [{"bridge_name": "t4br1", "default_route_ip": "10.1.31.1", "dns": [{"brif": "t4s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.5", "dnsif": "t4s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t4ns1", "route": [{"if": "p1", "ip": "10.1.31.1/24", "ns_if": "t4if", "ns_name": "t4"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t4ns1if", "tenant_ns_ip": "10.1.31.1/24", "tenant_ns_name": "t4", "tenant_sub_if": "t4s1if", "tenant_sub_ip": "10.1.31.2/24"}], "vxlan": [{"dev": "t4s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.31.2", "remote_ip": "10.2.31.2", "remote_route": "10.2.31.0/24", "subnet_route": "10.1.31.0/24", "tenant_route_ip": "192.168.4.2", "v_name": "vxlan_t4s1"}]}, {"brif": "t4br1if2", "disk": "10G", "mem": 4, "name": "t4_VM2", "vcpu": 2, "vmif": "t4VM2if1"}], "rc": 0, "start": "2019-12-05 18:18:44.984429", "stderr": "", "stderr_lines": [], "stdout": "52: t4br1if2@t4VM2if1: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP mode DEFAULT group default qlen 1000\n    link/ether 12:bc:a3:c5:25:89 brd ff:ff:ff:ff:ff:ff", "stdout_lines": ["52: t4br1if2@t4VM2if1: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP mode DEFAULT group default qlen 1000", "    link/ether 12:bc:a3:c5:25:89 brd ff:ff:ff:ff:ff:ff"]}

TASK [All interfaces and bridges UP] ************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.31.1/24', u'ns_name': u't4', u'ns_if': u't4if', u'if': u'p1'}], u'default_route_ip': u'10.1.31.1', u'bridge_name': u't4br1', u'dns': [{u'dnsif': u't4s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't4s1_dnsbrif'}], u'ns_name': u't4ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.31.2/24', u'tenant_ns_ip': u'10.1.31.1/24', u'tenant_ns_if': u't4ns1if', u'tenant_sub_if': u't4s1if', u'tenant_ns_name': u't4'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.1.31.2', u'dsport': 4789, u'dev': u't4s1if', u'tenant_route_ip': u'192.168.4.2', u'remote_route': u'10.2.31.0/24', u'subnet_route': u'10.1.31.0/24', u'v_name': u'vxlan_t4s1', u'id': 42, u'remote_ip': u'10.2.31.2'}]}, {u'mem': 2, u'name': u't4_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't4br1if1', u'vmif': u't4VM1if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t4ns1\" ip link set \"t4br1if1\" up\nip netns exec \"t4ns1\" ip link set dev \"t4br1\" up\n", "delta": "0:00:00.069872", "end": "2019-12-05 18:18:45.478894", "item": [{"bridge_name": "t4br1", "default_route_ip": "10.1.31.1", "dns": [{"brif": "t4s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.5", "dnsif": "t4s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t4ns1", "route": [{"if": "p1", "ip": "10.1.31.1/24", "ns_if": "t4if", "ns_name": "t4"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t4ns1if", "tenant_ns_ip": "10.1.31.1/24", "tenant_ns_name": "t4", "tenant_sub_if": "t4s1if", "tenant_sub_ip": "10.1.31.2/24"}], "vxlan": [{"dev": "t4s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.31.2", "remote_ip": "10.2.31.2", "remote_route": "10.2.31.0/24", "subnet_route": "10.1.31.0/24", "tenant_route_ip": "192.168.4.2", "v_name": "vxlan_t4s1"}]}, {"brif": "t4br1if1", "disk": "10G", "mem": 2, "name": "t4_VM1", "vcpu": 4, "vmif": "t4VM1if1"}], "rc": 0, "start": "2019-12-05 18:18:45.409022", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.31.1/24', u'ns_name': u't4', u'ns_if': u't4if', u'if': u'p1'}], u'default_route_ip': u'10.1.31.1', u'bridge_name': u't4br1', u'dns': [{u'dnsif': u't4s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't4s1_dnsbrif'}], u'ns_name': u't4ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.31.2/24', u'tenant_ns_ip': u'10.1.31.1/24', u'tenant_ns_if': u't4ns1if', u'tenant_sub_if': u't4s1if', u'tenant_ns_name': u't4'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.1.31.2', u'dsport': 4789, u'dev': u't4s1if', u'tenant_route_ip': u'192.168.4.2', u'remote_route': u'10.2.31.0/24', u'subnet_route': u'10.1.31.0/24', u'v_name': u'vxlan_t4s1', u'id': 42, u'remote_ip': u'10.2.31.2'}]}, {u'mem': 4, u'name': u't4_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't4br1if2', u'vmif': u't4VM2if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t4ns1\" ip link set \"t4br1if2\" up\nip netns exec \"t4ns1\" ip link set dev \"t4br1\" up\n", "delta": "0:00:00.072582", "end": "2019-12-05 18:18:45.810871", "item": [{"bridge_name": "t4br1", "default_route_ip": "10.1.31.1", "dns": [{"brif": "t4s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.5", "dnsif": "t4s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t4ns1", "route": [{"if": "p1", "ip": "10.1.31.1/24", "ns_if": "t4if", "ns_name": "t4"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t4ns1if", "tenant_ns_ip": "10.1.31.1/24", "tenant_ns_name": "t4", "tenant_sub_if": "t4s1if", "tenant_sub_ip": "10.1.31.2/24"}], "vxlan": [{"dev": "t4s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.31.2", "remote_ip": "10.2.31.2", "remote_route": "10.2.31.0/24", "subnet_route": "10.1.31.0/24", "tenant_route_ip": "192.168.4.2", "v_name": "vxlan_t4s1"}]}, {"brif": "t4br1if2", "disk": "10G", "mem": 4, "name": "t4_VM2", "vcpu": 2, "vmif": "t4VM2if1"}], "rc": 0, "start": "2019-12-05 18:18:45.738289", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Add IP to DNS Interface] ******************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.31.1/24', u'ns_name': u't4', u'ns_if': u't4if', u'if': u'p1'}], u'default_route_ip': u'10.1.31.1', u'bridge_name': u't4br1', u'ns_name': u't4ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.31.2/24', u'tenant_ns_ip': u'10.1.31.1/24', u'tenant_ns_if': u't4ns1if', u'tenant_sub_if': u't4s1if', u'tenant_ns_name': u't4'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't4_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't4br1if1', u'vmif': u't4VM1if1'}, {u'mem': 4, u'name': u't4_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't4br1if2', u'vmif': u't4VM2if1'}], u'vxlan': [{u'local_ip': u'10.1.31.2', u'dsport': 4789, u'dev': u't4s1if', u'tenant_route_ip': u'192.168.4.2', u'remote_route': u'10.2.31.0/24', u'subnet_route': u'10.1.31.0/24', u'v_name': u'vxlan_t4s1', u'id': 42, u'remote_ip': u'10.2.31.2'}]}, {u'dnsif': u't4s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't4s1_dnsbrif'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t4ns1\" ip addr show \"t4s1_dnsif\" | awk 'FNR==3{ print $2 }' | grep -w '^1.1.1.1/24' ; if [ $? -ne 0 ] ; then ip netns exec \"t4ns1\" ip addr add \"1.1.1.1/24\" dev \"t4s1_dnsif\" ; fi\n", "delta": "0:00:00.085996", "end": "2019-12-05 18:18:46.190872", "item": [{"bridge_name": "t4br1", "default_route_ip": "10.1.31.1", "ns_name": "t4ns1", "route": [{"if": "p1", "ip": "10.1.31.1/24", "ns_if": "t4if", "ns_name": "t4"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t4ns1if", "tenant_ns_ip": "10.1.31.1/24", "tenant_ns_name": "t4", "tenant_sub_if": "t4s1if", "tenant_sub_ip": "10.1.31.2/24"}], "vms": [{"brif": "t4br1if1", "disk": "10G", "mem": 2, "name": "t4_VM1", "vcpu": 4, "vmif": "t4VM1if1"}, {"brif": "t4br1if2", "disk": "10G", "mem": 4, "name": "t4_VM2", "vcpu": 2, "vmif": "t4VM2if1"}], "vxlan": [{"dev": "t4s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.31.2", "remote_ip": "10.2.31.2", "remote_route": "10.2.31.0/24", "subnet_route": "10.1.31.0/24", "tenant_route_ip": "192.168.4.2", "v_name": "vxlan_t4s1"}]}, {"brif": "t4s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.5", "dnsif": "t4s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "rc": 0, "start": "2019-12-05 18:18:46.104876", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Install DHCP Server] **********************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.31.1/24', u'ns_name': u't4', u'ns_if': u't4if', u'if': u'p1'}], u'default_route_ip': u'10.1.31.1', u'bridge_name': u't4br1', u'ns_name': u't4ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.31.2/24', u'tenant_ns_ip': u'10.1.31.1/24', u'tenant_ns_if': u't4ns1if', u'tenant_sub_if': u't4s1if', u'tenant_ns_name': u't4'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't4_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't4br1if1', u'vmif': u't4VM1if1'}, {u'mem': 4, u'name': u't4_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't4br1if2', u'vmif': u't4VM2if1'}], u'vxlan': [{u'local_ip': u'10.1.31.2', u'dsport': 4789, u'dev': u't4s1if', u'tenant_route_ip': u'192.168.4.2', u'remote_route': u'10.2.31.0/24', u'subnet_route': u'10.1.31.0/24', u'v_name': u'vxlan_t4s1', u'id': 42, u'remote_ip': u'10.2.31.2'}]}, {u'dnsif': u't4s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't4s1_dnsbrif'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t4ns1\" ps aux | grep -w '[d]nsmasq --interface t4s1_dnsif -z --dhcp-range=1.1.1.5,1.1.1.254' ; if [ $? -ne 0 ] ; then ip netns exec \"t4ns1\" dnsmasq --interface \"t4s1_dnsif\" -z --dhcp-range=1.1.1.5,'1.1.1.254' ; fi\n", "delta": "0:00:00.078680", "end": "2019-12-05 18:18:46.556583", "item": [{"bridge_name": "t4br1", "default_route_ip": "10.1.31.1", "ns_name": "t4ns1", "route": [{"if": "p1", "ip": "10.1.31.1/24", "ns_if": "t4if", "ns_name": "t4"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t4ns1if", "tenant_ns_ip": "10.1.31.1/24", "tenant_ns_name": "t4", "tenant_sub_if": "t4s1if", "tenant_sub_ip": "10.1.31.2/24"}], "vms": [{"brif": "t4br1if1", "disk": "10G", "mem": 2, "name": "t4_VM1", "vcpu": 4, "vmif": "t4VM1if1"}, {"brif": "t4br1if2", "disk": "10G", "mem": 4, "name": "t4_VM2", "vcpu": 2, "vmif": "t4VM2if1"}], "vxlan": [{"dev": "t4s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.31.2", "remote_ip": "10.2.31.2", "remote_route": "10.2.31.0/24", "subnet_route": "10.1.31.0/24", "tenant_route_ip": "192.168.4.2", "v_name": "vxlan_t4s1"}]}, {"brif": "t4s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.5", "dnsif": "t4s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "rc": 0, "start": "2019-12-05 18:18:46.477903", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Create VXLAN devices] *********************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.31.1/24', u'ns_name': u't4', u'ns_if': u't4if', u'if': u'p1'}], u'default_route_ip': u'10.1.31.1', u'bridge_name': u't4br1', u'dns': [{u'dnsif': u't4s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't4s1_dnsbrif'}], u'ns_name': u't4ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.31.2/24', u'tenant_ns_ip': u'10.1.31.1/24', u'tenant_ns_if': u't4ns1if', u'tenant_sub_if': u't4s1if', u'tenant_ns_name': u't4'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't4_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't4br1if1', u'vmif': u't4VM1if1'}, {u'mem': 4, u'name': u't4_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't4br1if2', u'vmif': u't4VM2if1'}]}, {u'local_ip': u'10.1.31.2', u'dsport': 4789, u'dev': u't4s1if', u'tenant_route_ip': u'192.168.4.2', u'remote_route': u'10.2.31.0/24', u'subnet_route': u'10.1.31.0/24', u'v_name': u'vxlan_t4s1', u'id': 42, u'remote_ip': u'10.2.31.2'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t4ns1\" ip link show \"vxlan_t4s1\" ; if [ $? -ne 0 ] ; then ip netns exec \"t4ns1\" ip link add \"vxlan_t4s1\" type vxlan id \"42\" local \"10.1.31.2\" remote \"10.2.31.2\" dstport \"4789\" dev \"t4s1if\"; ip netns exec \"t4ns1\" ip link set dev \"vxlan_t4s1\" up ; fi\n", "delta": "0:00:00.122633", "end": "2019-12-05 18:18:46.963108", "item": [{"bridge_name": "t4br1", "default_route_ip": "10.1.31.1", "dns": [{"brif": "t4s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.5", "dnsif": "t4s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t4ns1", "route": [{"if": "p1", "ip": "10.1.31.1/24", "ns_if": "t4if", "ns_name": "t4"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t4ns1if", "tenant_ns_ip": "10.1.31.1/24", "tenant_ns_name": "t4", "tenant_sub_if": "t4s1if", "tenant_sub_ip": "10.1.31.2/24"}], "vms": [{"brif": "t4br1if1", "disk": "10G", "mem": 2, "name": "t4_VM1", "vcpu": 4, "vmif": "t4VM1if1"}, {"brif": "t4br1if2", "disk": "10G", "mem": 4, "name": "t4_VM2", "vcpu": 2, "vmif": "t4VM2if1"}]}, {"dev": "t4s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.31.2", "remote_ip": "10.2.31.2", "remote_route": "10.2.31.0/24", "subnet_route": "10.1.31.0/24", "tenant_route_ip": "192.168.4.2", "v_name": "vxlan_t4s1"}], "rc": 0, "start": "2019-12-05 18:18:46.840475", "stderr": "Device \"vxlan_t4s1\" does not exist.", "stderr_lines": ["Device \"vxlan_t4s1\" does not exist."], "stdout": "", "stdout_lines": []}

TASK [Attach VXLANs to bridge] ******************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.31.1/24', u'ns_name': u't4', u'ns_if': u't4if', u'if': u'p1'}], u'default_route_ip': u'10.1.31.1', u'bridge_name': u't4br1', u'dns': [{u'dnsif': u't4s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't4s1_dnsbrif'}], u'ns_name': u't4ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.31.2/24', u'tenant_ns_ip': u'10.1.31.1/24', u'tenant_ns_if': u't4ns1if', u'tenant_sub_if': u't4s1if', u'tenant_ns_name': u't4'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't4_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't4br1if1', u'vmif': u't4VM1if1'}, {u'mem': 4, u'name': u't4_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't4br1if2', u'vmif': u't4VM2if1'}]}, {u'local_ip': u'10.1.31.2', u'dsport': 4789, u'dev': u't4s1if', u'tenant_route_ip': u'192.168.4.2', u'remote_route': u'10.2.31.0/24', u'subnet_route': u'10.1.31.0/24', u'v_name': u'vxlan_t4s1', u'id': 42, u'remote_ip': u'10.2.31.2'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t4ns1\" brctl show \"t4br1\" | grep -w 'vxlan_t4s1' ; if [ $? -ne 0 ] ; then ip netns exec \"t4ns1\" brctl addif \"t4br1\" \"vxlan_t4s1\" ; fi\n", "delta": "0:00:00.075658", "end": "2019-12-05 18:18:47.326795", "item": [{"bridge_name": "t4br1", "default_route_ip": "10.1.31.1", "dns": [{"brif": "t4s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.5", "dnsif": "t4s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t4ns1", "route": [{"if": "p1", "ip": "10.1.31.1/24", "ns_if": "t4if", "ns_name": "t4"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t4ns1if", "tenant_ns_ip": "10.1.31.1/24", "tenant_ns_name": "t4", "tenant_sub_if": "t4s1if", "tenant_sub_ip": "10.1.31.2/24"}], "vms": [{"brif": "t4br1if1", "disk": "10G", "mem": 2, "name": "t4_VM1", "vcpu": 4, "vmif": "t4VM1if1"}, {"brif": "t4br1if2", "disk": "10G", "mem": 4, "name": "t4_VM2", "vcpu": 2, "vmif": "t4VM2if1"}]}, {"dev": "t4s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.31.2", "remote_ip": "10.2.31.2", "remote_route": "10.2.31.0/24", "subnet_route": "10.1.31.0/24", "tenant_route_ip": "192.168.4.2", "v_name": "vxlan_t4s1"}], "rc": 0, "start": "2019-12-05 18:18:47.251137", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

PLAY RECAP **************************************************************************************************************************************************
localhost                  : ok=21   changed=21   unreachable=0    failed=0    skipped=0    rescued=0    ignored=0   

Using /etc/ansible/ansible.cfg as config file

PLAY [worker] ***********************************************************************************************************************************************

TASK [Create Tenant Namespace] ******************************************************************************************************************************
changed: [99.99.99.2] => (item={u'default_route_ip': u'192.168.132.1', u'name': u't4', u'pns_ip': u'192.168.132.1/24', u'tenant_if': u't4if', u'tenant_ip': u'192.168.132.2/24', u'pns_if': u't4pns_if'}) => {"ansible_loop_var": "item", "changed": true, "cmd": ["ip", "netns", "add", "t4"], "delta": "0:00:00.054018", "end": "2019-12-05 18:18:49.407577", "item": {"default_route_ip": "192.168.132.1", "name": "t4", "pns_if": "t4pns_if", "pns_ip": "192.168.132.1/24", "tenant_if": "t4if", "tenant_ip": "192.168.132.2/24"}, "rc": 0, "start": "2019-12-05 18:18:49.353559", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Create Subnet Namespace] ******************************************************************************************************************************
changed: [99.99.99.2] => (item={u'route': [{u'ip': u'10.2.31.1/24', u'ns_name': u't4', u'ns_if': u't4if', u'if': u'p1'}], u'default_route_ip': u'10.2.31.1', u'bridge_name': u't4br1', u'dns': [{u'dnsif': u't4s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't4s1_dnsbrif'}], u'ns_name': u't4ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.31.2/24', u'tenant_ns_ip': u'10.2.31.1/24', u'tenant_ns_if': u't4ns1if', u'tenant_ns_name': u't4', u'tenant_sub_if': u't4s1if'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't4_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't4br1if1', u'vmif': u't4VM4if1'}], u'vxlan': [{u'local_ip': u'10.2.31.2', u'tenant_route_ip': u'192.168.132.2', u'dsport': 4789, u'dev': u't4s1if', u'subnet_route': u'10.2.31.0/24', u'remote_route': u'10.1.31.0/24', u'v_name': u'vxlan_t4s1', u'id': 42, u'remote_ip': u'10.1.31.2'}]}) => {"ansible_loop_var": "item", "changed": true, "cmd": ["ip", "netns", "add", "t4ns1"], "delta": "0:00:00.057421", "end": "2019-12-05 18:18:49.901451", "item": {"bridge_name": "t4br1", "default_route_ip": "10.2.31.1", "dns": [{"brif": "t4s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.5", "dnsif": "t4s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t4ns1", "route": [{"if": "p1", "ip": "10.2.31.1/24", "ns_if": "t4if", "ns_name": "t4"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t4ns1if", "tenant_ns_ip": "10.2.31.1/24", "tenant_ns_name": "t4", "tenant_sub_if": "t4s1if", "tenant_sub_ip": "10.2.31.2/24"}], "vms": [{"brif": "t4br1if1", "disk": "10G", "mem": 2, "name": "t4_VM4", "vcpu": 4, "vmif": "t4VM4if1"}], "vxlan": [{"dev": "t4s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.31.2", "remote_ip": "10.1.31.2", "remote_route": "10.1.31.0/24", "subnet_route": "10.2.31.0/24", "tenant_route_ip": "192.168.132.2", "v_name": "vxlan_t4s1"}]}, "rc": 0, "start": "2019-12-05 18:18:49.844030", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}
changed: [99.99.99.2] => (item={u'route': [{u'ip': u'10.2.32.1/24', u'ns_name': u't4', u'ns_if': u't4if', u'if': u'p1'}], u'default_route_ip': u'10.2.32.1', u'bridge_name': u't4br2', u'dns': [{u'dnsif': u't4s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't4s2_dnsbrif'}], u'ns_name': u't4ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.32.2/24', u'tenant_ns_ip': u'10.2.32.1/24', u'tenant_ns_if': u't4ns2if', u'tenant_ns_name': u't4', u'tenant_sub_if': u't4s2if'}], u'subnet_ip': u'2.2.2.0/24', u'vms': [{u'mem': 3, u'name': u't4_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't4br2if1', u'vmif': u't4VM3if1'}], u'vxlan': [{u'local_ip': [], u'tenant_route_ip': [], u'dsport': [], u'dev': [], u'subnet_route': [], u'remote_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}) => {"ansible_loop_var": "item", "changed": true, "cmd": ["ip", "netns", "add", "t4ns2"], "delta": "0:00:00.052363", "end": "2019-12-05 18:18:50.300659", "item": {"bridge_name": "t4br2", "default_route_ip": "10.2.32.1", "dns": [{"brif": "t4s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t4s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t4ns2", "route": [{"if": "p1", "ip": "10.2.32.1/24", "ns_if": "t4if", "ns_name": "t4"}], "subnet_ip": "2.2.2.0/24", "tenant_ns": [{"tenant_ns_if": "t4ns2if", "tenant_ns_ip": "10.2.32.1/24", "tenant_ns_name": "t4", "tenant_sub_if": "t4s2if", "tenant_sub_ip": "10.2.32.2/24"}], "vms": [{"brif": "t4br2if1", "disk": "10G", "mem": 3, "name": "t4_VM3", "vcpu": 2, "vmif": "t4VM3if1"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, "rc": 0, "start": "2019-12-05 18:18:50.248296", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Create Tenant VETH pairs] *****************************************************************************************************************************
changed: [99.99.99.2] => (item={u'default_route_ip': u'192.168.132.1', u'name': u't4', u'pns_ip': u'192.168.132.1/24', u'tenant_if': u't4if', u'tenant_ip': u'192.168.132.2/24', u'pns_if': u't4pns_if'}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip link show \"t4if\" ; if [ $? -ne 0 ] ; then ip link add \"t4if\" type veth peer name \"t4pns_if\" ; fi\n", "delta": "0:00:00.017034", "end": "2019-12-05 18:18:50.732293", "item": {"default_route_ip": "192.168.132.1", "name": "t4", "pns_if": "t4pns_if", "pns_ip": "192.168.132.1/24", "tenant_if": "t4if", "tenant_ip": "192.168.132.2/24"}, "rc": 0, "start": "2019-12-05 18:18:50.715259", "stderr": "Device \"t4if\" does not exist.", "stderr_lines": ["Device \"t4if\" does not exist."], "stdout": "", "stdout_lines": []}

TASK [Attach Tenant VETH Pairs] *****************************************************************************************************************************
changed: [99.99.99.2] => (item={u'default_route_ip': u'192.168.132.1', u'name': u't4', u'pns_ip': u'192.168.132.1/24', u'tenant_if': u't4if', u'tenant_ip': u'192.168.132.2/24', u'pns_if': u't4pns_if'}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec pns ip link show \"t4pns_if\" ; if [ $? -ne 0 ] ; then ip link set \"t4pns_if\" netns pns ; fi\nip netns exec \"t4\" ip link show \"t4if\" ; if [ $? -ne 0 ] ; then ip link set \"t4if\" netns \"t4\" ; fi\nip netns exec pns ip link set dev \"t4pns_if\" up\nip netns exec \"t4\" ip link set dev \"t4if\" up\n", "delta": "0:00:00.234124", "end": "2019-12-05 18:18:51.382629", "item": {"default_route_ip": "192.168.132.1", "name": "t4", "pns_if": "t4pns_if", "pns_ip": "192.168.132.1/24", "tenant_if": "t4if", "tenant_ip": "192.168.132.2/24"}, "rc": 0, "start": "2019-12-05 18:18:51.148505", "stderr": "Device \"t4pns_if\" does not exist.\nDevice \"t4if\" does not exist.", "stderr_lines": ["Device \"t4pns_if\" does not exist.", "Device \"t4if\" does not exist."], "stdout": "", "stdout_lines": []}

TASK [Add IP addresses to Tenant VETH Pairs] ****************************************************************************************************************
changed: [99.99.99.2] => (item={u'default_route_ip': u'192.168.132.1', u'name': u't4', u'pns_ip': u'192.168.132.1/24', u'tenant_if': u't4if', u'tenant_ip': u'192.168.132.2/24', u'pns_if': u't4pns_if'}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec pns ip addr show \"t4pns_if\" | awk 'FNR==3{ print $2 }' | grep -w '^192.168.132.1/24' ; if [ $? -ne 0 ] ; then ip netns exec pns ip addr add \"192.168.132.1/24\" dev \"t4pns_if\" ; fi\nip netns exec \"t4\" ip addr show \"t4if\" | awk 'FNR==3{ print $2 }' | grep -w '^192.168.132.2/24' ; if [ $? -ne 0 ] ; then ip netns exec \"t4\" ip addr add \"192.168.132.2/24\" dev \"t4if\" ; fi\n", "delta": "0:00:00.169999", "end": "2019-12-05 18:18:51.982649", "item": {"default_route_ip": "192.168.132.1", "name": "t4", "pns_if": "t4pns_if", "pns_ip": "192.168.132.1/24", "tenant_if": "t4if", "tenant_ip": "192.168.132.2/24"}, "rc": 0, "start": "2019-12-05 18:18:51.812650", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Create Namespace VETH Pairs] **************************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.31.1/24', u'ns_name': u't4', u'ns_if': u't4if', u'if': u'p1'}], u'default_route_ip': u'10.2.31.1', u'bridge_name': u't4br1', u'dns': [{u'dnsif': u't4s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't4s1_dnsbrif'}], u'ns_name': u't4ns1', u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't4_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't4br1if1', u'vmif': u't4VM4if1'}], u'vxlan': [{u'local_ip': u'10.2.31.2', u'dsport': 4789, u'dev': u't4s1if', u'tenant_route_ip': u'192.168.132.2', u'remote_route': u'10.1.31.0/24', u'subnet_route': u'10.2.31.0/24', u'v_name': u'vxlan_t4s1', u'id': 42, u'remote_ip': u'10.1.31.2'}]}, {u'tenant_sub_ip': u'10.2.31.2/24', u'tenant_ns_ip': u'10.2.31.1/24', u'tenant_ns_if': u't4ns1if', u'tenant_sub_if': u't4s1if', u'tenant_ns_name': u't4'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip link show \"t4ns1if\" ; if [ $? -ne 0 ] ; then ip link add \"t4ns1if\" type veth peer name \"t4s1if\" ; fi\n", "delta": "0:00:00.018085", "end": "2019-12-05 18:18:52.438129", "item": [{"bridge_name": "t4br1", "default_route_ip": "10.2.31.1", "dns": [{"brif": "t4s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.5", "dnsif": "t4s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t4ns1", "route": [{"if": "p1", "ip": "10.2.31.1/24", "ns_if": "t4if", "ns_name": "t4"}], "subnet_ip": "1.1.1.0/24", "vms": [{"brif": "t4br1if1", "disk": "10G", "mem": 2, "name": "t4_VM4", "vcpu": 4, "vmif": "t4VM4if1"}], "vxlan": [{"dev": "t4s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.31.2", "remote_ip": "10.1.31.2", "remote_route": "10.1.31.0/24", "subnet_route": "10.2.31.0/24", "tenant_route_ip": "192.168.132.2", "v_name": "vxlan_t4s1"}]}, {"tenant_ns_if": "t4ns1if", "tenant_ns_ip": "10.2.31.1/24", "tenant_ns_name": "t4", "tenant_sub_if": "t4s1if", "tenant_sub_ip": "10.2.31.2/24"}], "rc": 0, "start": "2019-12-05 18:18:52.420044", "stderr": "Device \"t4ns1if\" does not exist.", "stderr_lines": ["Device \"t4ns1if\" does not exist."], "stdout": "", "stdout_lines": []}
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.32.1/24', u'ns_name': u't4', u'ns_if': u't4if', u'if': u'p1'}], u'default_route_ip': u'10.2.32.1', u'bridge_name': u't4br2', u'dns': [{u'dnsif': u't4s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't4s2_dnsbrif'}], u'ns_name': u't4ns2', u'subnet_ip': u'2.2.2.0/24', u'vms': [{u'mem': 3, u'name': u't4_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't4br2if1', u'vmif': u't4VM3if1'}], u'vxlan': [{u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}, {u'tenant_sub_ip': u'10.2.32.2/24', u'tenant_ns_ip': u'10.2.32.1/24', u'tenant_ns_if': u't4ns2if', u'tenant_sub_if': u't4s2if', u'tenant_ns_name': u't4'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip link show \"t4ns2if\" ; if [ $? -ne 0 ] ; then ip link add \"t4ns2if\" type veth peer name \"t4s2if\" ; fi\n", "delta": "0:00:00.013732", "end": "2019-12-05 18:18:52.814552", "item": [{"bridge_name": "t4br2", "default_route_ip": "10.2.32.1", "dns": [{"brif": "t4s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t4s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t4ns2", "route": [{"if": "p1", "ip": "10.2.32.1/24", "ns_if": "t4if", "ns_name": "t4"}], "subnet_ip": "2.2.2.0/24", "vms": [{"brif": "t4br2if1", "disk": "10G", "mem": 3, "name": "t4_VM3", "vcpu": 2, "vmif": "t4VM3if1"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, {"tenant_ns_if": "t4ns2if", "tenant_ns_ip": "10.2.32.1/24", "tenant_ns_name": "t4", "tenant_sub_if": "t4s2if", "tenant_sub_ip": "10.2.32.2/24"}], "rc": 0, "start": "2019-12-05 18:18:52.800820", "stderr": "Device \"t4ns2if\" does not exist.", "stderr_lines": ["Device \"t4ns2if\" does not exist."], "stdout": "", "stdout_lines": []}

TASK [Attach Namespace VETH Pairs] **************************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.31.1/24', u'ns_name': u't4', u'ns_if': u't4if', u'if': u'p1'}], u'default_route_ip': u'10.2.31.1', u'bridge_name': u't4br1', u'dns': [{u'dnsif': u't4s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't4s1_dnsbrif'}], u'ns_name': u't4ns1', u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't4_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't4br1if1', u'vmif': u't4VM4if1'}], u'vxlan': [{u'local_ip': u'10.2.31.2', u'dsport': 4789, u'dev': u't4s1if', u'tenant_route_ip': u'192.168.132.2', u'remote_route': u'10.1.31.0/24', u'subnet_route': u'10.2.31.0/24', u'v_name': u'vxlan_t4s1', u'id': 42, u'remote_ip': u'10.1.31.2'}]}, {u'tenant_sub_ip': u'10.2.31.2/24', u'tenant_ns_ip': u'10.2.31.1/24', u'tenant_ns_if': u't4ns1if', u'tenant_sub_if': u't4s1if', u'tenant_ns_name': u't4'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t4\" ip link show \"t4ns1if\" ; if [ $? -ne 0 ] ; then ip link set \"t4ns1if\" netns \"t4\" ; fi\nip netns exec \"t4ns1\" ip link show \"t4s1if\" ; if [ $? -ne 0 ] ; then ip link set \"t4s1if\" netns \"t4ns1\" ; fi\n", "delta": "0:00:00.152674", "end": "2019-12-05 18:18:53.408004", "item": [{"bridge_name": "t4br1", "default_route_ip": "10.2.31.1", "dns": [{"brif": "t4s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.5", "dnsif": "t4s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t4ns1", "route": [{"if": "p1", "ip": "10.2.31.1/24", "ns_if": "t4if", "ns_name": "t4"}], "subnet_ip": "1.1.1.0/24", "vms": [{"brif": "t4br1if1", "disk": "10G", "mem": 2, "name": "t4_VM4", "vcpu": 4, "vmif": "t4VM4if1"}], "vxlan": [{"dev": "t4s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.31.2", "remote_ip": "10.1.31.2", "remote_route": "10.1.31.0/24", "subnet_route": "10.2.31.0/24", "tenant_route_ip": "192.168.132.2", "v_name": "vxlan_t4s1"}]}, {"tenant_ns_if": "t4ns1if", "tenant_ns_ip": "10.2.31.1/24", "tenant_ns_name": "t4", "tenant_sub_if": "t4s1if", "tenant_sub_ip": "10.2.31.2/24"}], "rc": 0, "start": "2019-12-05 18:18:53.255330", "stderr": "Device \"t4ns1if\" does not exist.\nDevice \"t4s1if\" does not exist.", "stderr_lines": ["Device \"t4ns1if\" does not exist.", "Device \"t4s1if\" does not exist."], "stdout": "", "stdout_lines": []}
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.32.1/24', u'ns_name': u't4', u'ns_if': u't4if', u'if': u'p1'}], u'default_route_ip': u'10.2.32.1', u'bridge_name': u't4br2', u'dns': [{u'dnsif': u't4s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't4s2_dnsbrif'}], u'ns_name': u't4ns2', u'subnet_ip': u'2.2.2.0/24', u'vms': [{u'mem': 3, u'name': u't4_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't4br2if1', u'vmif': u't4VM3if1'}], u'vxlan': [{u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}, {u'tenant_sub_ip': u'10.2.32.2/24', u'tenant_ns_ip': u'10.2.32.1/24', u'tenant_ns_if': u't4ns2if', u'tenant_sub_if': u't4s2if', u'tenant_ns_name': u't4'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t4\" ip link show \"t4ns2if\" ; if [ $? -ne 0 ] ; then ip link set \"t4ns2if\" netns \"t4\" ; fi\nip netns exec \"t4ns2\" ip link show \"t4s2if\" ; if [ $? -ne 0 ] ; then ip link set \"t4s2if\" netns \"t4ns2\" ; fi\n", "delta": "0:00:00.160590", "end": "2019-12-05 18:18:53.924785", "item": [{"bridge_name": "t4br2", "default_route_ip": "10.2.32.1", "dns": [{"brif": "t4s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t4s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t4ns2", "route": [{"if": "p1", "ip": "10.2.32.1/24", "ns_if": "t4if", "ns_name": "t4"}], "subnet_ip": "2.2.2.0/24", "vms": [{"brif": "t4br2if1", "disk": "10G", "mem": 3, "name": "t4_VM3", "vcpu": 2, "vmif": "t4VM3if1"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, {"tenant_ns_if": "t4ns2if", "tenant_ns_ip": "10.2.32.1/24", "tenant_ns_name": "t4", "tenant_sub_if": "t4s2if", "tenant_sub_ip": "10.2.32.2/24"}], "rc": 0, "start": "2019-12-05 18:18:53.764195", "stderr": "Device \"t4ns2if\" does not exist.\nDevice \"t4s2if\" does not exist.", "stderr_lines": ["Device \"t4ns2if\" does not exist.", "Device \"t4s2if\" does not exist."], "stdout": "", "stdout_lines": []}

TASK [Set Namespace VETH Pairs UP] **************************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.31.1/24', u'ns_name': u't4', u'ns_if': u't4if', u'if': u'p1'}], u'default_route_ip': u'10.2.31.1', u'bridge_name': u't4br1', u'dns': [{u'dnsif': u't4s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't4s1_dnsbrif'}], u'ns_name': u't4ns1', u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't4_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't4br1if1', u'vmif': u't4VM4if1'}], u'vxlan': [{u'local_ip': u'10.2.31.2', u'dsport': 4789, u'dev': u't4s1if', u'tenant_route_ip': u'192.168.132.2', u'remote_route': u'10.1.31.0/24', u'subnet_route': u'10.2.31.0/24', u'v_name': u'vxlan_t4s1', u'id': 42, u'remote_ip': u'10.1.31.2'}]}, {u'tenant_sub_ip': u'10.2.31.2/24', u'tenant_ns_ip': u'10.2.31.1/24', u'tenant_ns_if': u't4ns1if', u'tenant_sub_if': u't4s1if', u'tenant_ns_name': u't4'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t4\" ip link set dev \"t4ns1if\" up\nip netns exec \"t4ns1\" ip link set dev \"t4s1if\" up\n", "delta": "0:00:00.078913", "end": "2019-12-05 18:18:54.418706", "item": [{"bridge_name": "t4br1", "default_route_ip": "10.2.31.1", "dns": [{"brif": "t4s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.5", "dnsif": "t4s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t4ns1", "route": [{"if": "p1", "ip": "10.2.31.1/24", "ns_if": "t4if", "ns_name": "t4"}], "subnet_ip": "1.1.1.0/24", "vms": [{"brif": "t4br1if1", "disk": "10G", "mem": 2, "name": "t4_VM4", "vcpu": 4, "vmif": "t4VM4if1"}], "vxlan": [{"dev": "t4s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.31.2", "remote_ip": "10.1.31.2", "remote_route": "10.1.31.0/24", "subnet_route": "10.2.31.0/24", "tenant_route_ip": "192.168.132.2", "v_name": "vxlan_t4s1"}]}, {"tenant_ns_if": "t4ns1if", "tenant_ns_ip": "10.2.31.1/24", "tenant_ns_name": "t4", "tenant_sub_if": "t4s1if", "tenant_sub_ip": "10.2.31.2/24"}], "rc": 0, "start": "2019-12-05 18:18:54.339793", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.32.1/24', u'ns_name': u't4', u'ns_if': u't4if', u'if': u'p1'}], u'default_route_ip': u'10.2.32.1', u'bridge_name': u't4br2', u'dns': [{u'dnsif': u't4s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't4s2_dnsbrif'}], u'ns_name': u't4ns2', u'subnet_ip': u'2.2.2.0/24', u'vms': [{u'mem': 3, u'name': u't4_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't4br2if1', u'vmif': u't4VM3if1'}], u'vxlan': [{u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}, {u'tenant_sub_ip': u'10.2.32.2/24', u'tenant_ns_ip': u'10.2.32.1/24', u'tenant_ns_if': u't4ns2if', u'tenant_sub_if': u't4s2if', u'tenant_ns_name': u't4'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t4\" ip link set dev \"t4ns2if\" up\nip netns exec \"t4ns2\" ip link set dev \"t4s2if\" up\n", "delta": "0:00:00.082185", "end": "2019-12-05 18:18:54.850736", "item": [{"bridge_name": "t4br2", "default_route_ip": "10.2.32.1", "dns": [{"brif": "t4s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t4s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t4ns2", "route": [{"if": "p1", "ip": "10.2.32.1/24", "ns_if": "t4if", "ns_name": "t4"}], "subnet_ip": "2.2.2.0/24", "vms": [{"brif": "t4br2if1", "disk": "10G", "mem": 3, "name": "t4_VM3", "vcpu": 2, "vmif": "t4VM3if1"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, {"tenant_ns_if": "t4ns2if", "tenant_ns_ip": "10.2.32.1/24", "tenant_ns_name": "t4", "tenant_sub_if": "t4s2if", "tenant_sub_ip": "10.2.32.2/24"}], "rc": 0, "start": "2019-12-05 18:18:54.768551", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Add IP addresses to Namespace VETH Pairs] *************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.31.1/24', u'ns_name': u't4', u'ns_if': u't4if', u'if': u'p1'}], u'default_route_ip': u'10.2.31.1', u'bridge_name': u't4br1', u'dns': [{u'dnsif': u't4s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't4s1_dnsbrif'}], u'ns_name': u't4ns1', u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't4_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't4br1if1', u'vmif': u't4VM4if1'}], u'vxlan': [{u'local_ip': u'10.2.31.2', u'dsport': 4789, u'dev': u't4s1if', u'tenant_route_ip': u'192.168.132.2', u'remote_route': u'10.1.31.0/24', u'subnet_route': u'10.2.31.0/24', u'v_name': u'vxlan_t4s1', u'id': 42, u'remote_ip': u'10.1.31.2'}]}, {u'tenant_sub_ip': u'10.2.31.2/24', u'tenant_ns_ip': u'10.2.31.1/24', u'tenant_ns_if': u't4ns1if', u'tenant_sub_if': u't4s1if', u'tenant_ns_name': u't4'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t4ns1\" ip addr show \"t4s1if\" | awk 'FNR==3{ print $2 }' | grep -w '^10.2.31.2/24' ; if [ $? -ne 0 ] ; then ip netns exec \"t4ns1\" ip addr add \"10.2.31.2/24\" dev \"t4s1if\" ; fi\n\nip netns exec \"t4\" ip addr show \"t4ns1if\" | awk 'FNR==3{ print $2 }' | grep -w '^10.2.31.1/24' ; if [ $? -ne 0 ] ; then ip netns exec \"t4\" ip addr add \"10.2.31.1/24\" dev \"t4ns1if\" ; fi\n", "delta": "0:00:00.154181", "end": "2019-12-05 18:18:55.470618", "item": [{"bridge_name": "t4br1", "default_route_ip": "10.2.31.1", "dns": [{"brif": "t4s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.5", "dnsif": "t4s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t4ns1", "route": [{"if": "p1", "ip": "10.2.31.1/24", "ns_if": "t4if", "ns_name": "t4"}], "subnet_ip": "1.1.1.0/24", "vms": [{"brif": "t4br1if1", "disk": "10G", "mem": 2, "name": "t4_VM4", "vcpu": 4, "vmif": "t4VM4if1"}], "vxlan": [{"dev": "t4s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.31.2", "remote_ip": "10.1.31.2", "remote_route": "10.1.31.0/24", "subnet_route": "10.2.31.0/24", "tenant_route_ip": "192.168.132.2", "v_name": "vxlan_t4s1"}]}, {"tenant_ns_if": "t4ns1if", "tenant_ns_ip": "10.2.31.1/24", "tenant_ns_name": "t4", "tenant_sub_if": "t4s1if", "tenant_sub_ip": "10.2.31.2/24"}], "rc": 0, "start": "2019-12-05 18:18:55.316437", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.32.1/24', u'ns_name': u't4', u'ns_if': u't4if', u'if': u'p1'}], u'default_route_ip': u'10.2.32.1', u'bridge_name': u't4br2', u'dns': [{u'dnsif': u't4s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't4s2_dnsbrif'}], u'ns_name': u't4ns2', u'subnet_ip': u'2.2.2.0/24', u'vms': [{u'mem': 3, u'name': u't4_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't4br2if1', u'vmif': u't4VM3if1'}], u'vxlan': [{u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}, {u'tenant_sub_ip': u'10.2.32.2/24', u'tenant_ns_ip': u'10.2.32.1/24', u'tenant_ns_if': u't4ns2if', u'tenant_sub_if': u't4s2if', u'tenant_ns_name': u't4'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t4ns2\" ip addr show \"t4s2if\" | awk 'FNR==3{ print $2 }' | grep -w '^10.2.32.2/24' ; if [ $? -ne 0 ] ; then ip netns exec \"t4ns2\" ip addr add \"10.2.32.2/24\" dev \"t4s2if\" ; fi\n\nip netns exec \"t4\" ip addr show \"t4ns2if\" | awk 'FNR==3{ print $2 }' | grep -w '^10.2.32.1/24' ; if [ $? -ne 0 ] ; then ip netns exec \"t4\" ip addr add \"10.2.32.1/24\" dev \"t4ns2if\" ; fi\n", "delta": "0:00:00.168515", "end": "2019-12-05 18:18:56.014650", "item": [{"bridge_name": "t4br2", "default_route_ip": "10.2.32.1", "dns": [{"brif": "t4s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t4s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t4ns2", "route": [{"if": "p1", "ip": "10.2.32.1/24", "ns_if": "t4if", "ns_name": "t4"}], "subnet_ip": "2.2.2.0/24", "vms": [{"brif": "t4br2if1", "disk": "10G", "mem": 3, "name": "t4_VM3", "vcpu": 2, "vmif": "t4VM3if1"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, {"tenant_ns_if": "t4ns2if", "tenant_ns_ip": "10.2.32.1/24", "tenant_ns_name": "t4", "tenant_sub_if": "t4s2if", "tenant_sub_ip": "10.2.32.2/24"}], "rc": 0, "start": "2019-12-05 18:18:55.846135", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Add IP Route to Tenant] *******************************************************************************************************************************
changed: [99.99.99.2] => (item={u'default_route_ip': u'192.168.132.1', u'name': u't4', u'pns_ip': u'192.168.132.1/24', u'tenant_if': u't4if', u'tenant_ip': u'192.168.132.2/24', u'pns_if': u't4pns_if'}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t4\" ip route show default | grep -w '[d]efault via 192.168.132.1' ; if [ $? -ne 0 ] ; then ip netns exec \"t4\" ip route add default via \"192.168.132.1\" ; fi\n", "delta": "0:00:00.086602", "end": "2019-12-05 18:18:56.526704", "item": {"default_route_ip": "192.168.132.1", "name": "t4", "pns_if": "t4pns_if", "pns_ip": "192.168.132.1/24", "tenant_if": "t4if", "tenant_ip": "192.168.132.2/24"}, "rc": 0, "start": "2019-12-05 18:18:56.440102", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Add IP Route to Tenant Subnet] ************************************************************************************************************************
changed: [99.99.99.2] => (item={u'route': [{u'ip': u'10.2.31.1/24', u'ns_name': u't4', u'ns_if': u't4if', u'if': u'p1'}], u'default_route_ip': u'10.2.31.1', u'bridge_name': u't4br1', u'dns': [{u'dnsif': u't4s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't4s1_dnsbrif'}], u'ns_name': u't4ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.31.2/24', u'tenant_ns_ip': u'10.2.31.1/24', u'tenant_ns_if': u't4ns1if', u'tenant_ns_name': u't4', u'tenant_sub_if': u't4s1if'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't4_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't4br1if1', u'vmif': u't4VM4if1'}], u'vxlan': [{u'local_ip': u'10.2.31.2', u'tenant_route_ip': u'192.168.132.2', u'dsport': 4789, u'dev': u't4s1if', u'subnet_route': u'10.2.31.0/24', u'remote_route': u'10.1.31.0/24', u'v_name': u'vxlan_t4s1', u'id': 42, u'remote_ip': u'10.1.31.2'}]}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t4ns1\" ip route show default | grep -w '[d]efault via 10.2.31.1' ; if [ $? -ne 0 ] ; then ip netns exec \"t4ns1\" ip route add default via \"10.2.31.1\" ; fi\n", "delta": "0:00:00.084545", "end": "2019-12-05 18:18:57.006568", "item": {"bridge_name": "t4br1", "default_route_ip": "10.2.31.1", "dns": [{"brif": "t4s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.5", "dnsif": "t4s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t4ns1", "route": [{"if": "p1", "ip": "10.2.31.1/24", "ns_if": "t4if", "ns_name": "t4"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t4ns1if", "tenant_ns_ip": "10.2.31.1/24", "tenant_ns_name": "t4", "tenant_sub_if": "t4s1if", "tenant_sub_ip": "10.2.31.2/24"}], "vms": [{"brif": "t4br1if1", "disk": "10G", "mem": 2, "name": "t4_VM4", "vcpu": 4, "vmif": "t4VM4if1"}], "vxlan": [{"dev": "t4s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.31.2", "remote_ip": "10.1.31.2", "remote_route": "10.1.31.0/24", "subnet_route": "10.2.31.0/24", "tenant_route_ip": "192.168.132.2", "v_name": "vxlan_t4s1"}]}, "rc": 0, "start": "2019-12-05 18:18:56.922023", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}
changed: [99.99.99.2] => (item={u'route': [{u'ip': u'10.2.32.1/24', u'ns_name': u't4', u'ns_if': u't4if', u'if': u'p1'}], u'default_route_ip': u'10.2.32.1', u'bridge_name': u't4br2', u'dns': [{u'dnsif': u't4s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't4s2_dnsbrif'}], u'ns_name': u't4ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.32.2/24', u'tenant_ns_ip': u'10.2.32.1/24', u'tenant_ns_if': u't4ns2if', u'tenant_ns_name': u't4', u'tenant_sub_if': u't4s2if'}], u'subnet_ip': u'2.2.2.0/24', u'vms': [{u'mem': 3, u'name': u't4_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't4br2if1', u'vmif': u't4VM3if1'}], u'vxlan': [{u'local_ip': [], u'tenant_route_ip': [], u'dsport': [], u'dev': [], u'subnet_route': [], u'remote_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t4ns2\" ip route show default | grep -w '[d]efault via 10.2.32.1' ; if [ $? -ne 0 ] ; then ip netns exec \"t4ns2\" ip route add default via \"10.2.32.1\" ; fi\n", "delta": "0:00:00.088234", "end": "2019-12-05 18:18:57.410687", "item": {"bridge_name": "t4br2", "default_route_ip": "10.2.32.1", "dns": [{"brif": "t4s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t4s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t4ns2", "route": [{"if": "p1", "ip": "10.2.32.1/24", "ns_if": "t4if", "ns_name": "t4"}], "subnet_ip": "2.2.2.0/24", "tenant_ns": [{"tenant_ns_if": "t4ns2if", "tenant_ns_ip": "10.2.32.1/24", "tenant_ns_name": "t4", "tenant_sub_if": "t4s2if", "tenant_sub_ip": "10.2.32.2/24"}], "vms": [{"brif": "t4br2if1", "disk": "10G", "mem": 3, "name": "t4_VM3", "vcpu": 2, "vmif": "t4VM3if1"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, "rc": 0, "start": "2019-12-05 18:18:57.322453", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Create bridge inside namespace] ***********************************************************************************************************************
changed: [99.99.99.2] => (item={u'route': [{u'ip': u'10.2.31.1/24', u'ns_name': u't4', u'ns_if': u't4if', u'if': u'p1'}], u'default_route_ip': u'10.2.31.1', u'bridge_name': u't4br1', u'dns': [{u'dnsif': u't4s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't4s1_dnsbrif'}], u'ns_name': u't4ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.31.2/24', u'tenant_ns_ip': u'10.2.31.1/24', u'tenant_ns_if': u't4ns1if', u'tenant_ns_name': u't4', u'tenant_sub_if': u't4s1if'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't4_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't4br1if1', u'vmif': u't4VM4if1'}], u'vxlan': [{u'local_ip': u'10.2.31.2', u'tenant_route_ip': u'192.168.132.2', u'dsport': 4789, u'dev': u't4s1if', u'subnet_route': u'10.2.31.0/24', u'remote_route': u'10.1.31.0/24', u'v_name': u'vxlan_t4s1', u'id': 42, u'remote_ip': u'10.1.31.2'}]}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t4ns1\" brctl show | grep -w '^t4br1'; if [ $? -ne 0 ] ; then ip netns exec \"t4ns1\" brctl addbr \"t4br1\" ; fi\nip netns exec \"t4ns1\" ip link set dev \"t4br1\" up\n", "delta": "0:00:00.113286", "end": "2019-12-05 18:18:57.918789", "item": {"bridge_name": "t4br1", "default_route_ip": "10.2.31.1", "dns": [{"brif": "t4s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.5", "dnsif": "t4s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t4ns1", "route": [{"if": "p1", "ip": "10.2.31.1/24", "ns_if": "t4if", "ns_name": "t4"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t4ns1if", "tenant_ns_ip": "10.2.31.1/24", "tenant_ns_name": "t4", "tenant_sub_if": "t4s1if", "tenant_sub_ip": "10.2.31.2/24"}], "vms": [{"brif": "t4br1if1", "disk": "10G", "mem": 2, "name": "t4_VM4", "vcpu": 4, "vmif": "t4VM4if1"}], "vxlan": [{"dev": "t4s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.31.2", "remote_ip": "10.1.31.2", "remote_route": "10.1.31.0/24", "subnet_route": "10.2.31.0/24", "tenant_route_ip": "192.168.132.2", "v_name": "vxlan_t4s1"}]}, "rc": 0, "start": "2019-12-05 18:18:57.805503", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}
changed: [99.99.99.2] => (item={u'route': [{u'ip': u'10.2.32.1/24', u'ns_name': u't4', u'ns_if': u't4if', u'if': u'p1'}], u'default_route_ip': u'10.2.32.1', u'bridge_name': u't4br2', u'dns': [{u'dnsif': u't4s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't4s2_dnsbrif'}], u'ns_name': u't4ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.32.2/24', u'tenant_ns_ip': u'10.2.32.1/24', u'tenant_ns_if': u't4ns2if', u'tenant_ns_name': u't4', u'tenant_sub_if': u't4s2if'}], u'subnet_ip': u'2.2.2.0/24', u'vms': [{u'mem': 3, u'name': u't4_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't4br2if1', u'vmif': u't4VM3if1'}], u'vxlan': [{u'local_ip': [], u'tenant_route_ip': [], u'dsport': [], u'dev': [], u'subnet_route': [], u'remote_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t4ns2\" brctl show | grep -w '^t4br2'; if [ $? -ne 0 ] ; then ip netns exec \"t4ns2\" brctl addbr \"t4br2\" ; fi\nip netns exec \"t4ns2\" ip link set dev \"t4br2\" up\n", "delta": "0:00:00.130800", "end": "2019-12-05 18:18:58.394750", "item": {"bridge_name": "t4br2", "default_route_ip": "10.2.32.1", "dns": [{"brif": "t4s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t4s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t4ns2", "route": [{"if": "p1", "ip": "10.2.32.1/24", "ns_if": "t4if", "ns_name": "t4"}], "subnet_ip": "2.2.2.0/24", "tenant_ns": [{"tenant_ns_if": "t4ns2if", "tenant_ns_ip": "10.2.32.1/24", "tenant_ns_name": "t4", "tenant_sub_if": "t4s2if", "tenant_sub_ip": "10.2.32.2/24"}], "vms": [{"brif": "t4br2if1", "disk": "10G", "mem": 3, "name": "t4_VM3", "vcpu": 2, "vmif": "t4VM3if1"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, "rc": 0, "start": "2019-12-05 18:18:58.263950", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Create DNS VETH Pair] *********************************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.31.1/24', u'ns_name': u't4', u'ns_if': u't4if', u'if': u'p1'}], u'default_route_ip': u'10.2.31.1', u'bridge_name': u't4br1', u'ns_name': u't4ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.31.2/24', u'tenant_ns_ip': u'10.2.31.1/24', u'tenant_ns_if': u't4ns1if', u'tenant_sub_if': u't4s1if', u'tenant_ns_name': u't4'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't4_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't4br1if1', u'vmif': u't4VM4if1'}], u'vxlan': [{u'local_ip': u'10.2.31.2', u'dsport': 4789, u'dev': u't4s1if', u'tenant_route_ip': u'192.168.132.2', u'remote_route': u'10.1.31.0/24', u'subnet_route': u'10.2.31.0/24', u'v_name': u'vxlan_t4s1', u'id': 42, u'remote_ip': u'10.1.31.2'}]}, {u'dnsif': u't4s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't4s1_dnsbrif'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t4ns1\" ip link show \"t4s1_dnsbrif\" ; if [ $? -ne 0 ] ; then ip netns exec \"t4ns1\" ip link add \"t4s1_dnsbrif\" type veth peer name \"t4s1_dnsif\" ; fi\nip netns exec \"t4ns1\" ip link set dev \"t4s1_dnsbrif\" up\nip netns exec \"t4ns1\" ip link set dev \"t4s1_dnsif\" up\n", "delta": "0:00:00.148247", "end": "2019-12-05 18:18:58.974601", "item": [{"bridge_name": "t4br1", "default_route_ip": "10.2.31.1", "ns_name": "t4ns1", "route": [{"if": "p1", "ip": "10.2.31.1/24", "ns_if": "t4if", "ns_name": "t4"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t4ns1if", "tenant_ns_ip": "10.2.31.1/24", "tenant_ns_name": "t4", "tenant_sub_if": "t4s1if", "tenant_sub_ip": "10.2.31.2/24"}], "vms": [{"brif": "t4br1if1", "disk": "10G", "mem": 2, "name": "t4_VM4", "vcpu": 4, "vmif": "t4VM4if1"}], "vxlan": [{"dev": "t4s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.31.2", "remote_ip": "10.1.31.2", "remote_route": "10.1.31.0/24", "subnet_route": "10.2.31.0/24", "tenant_route_ip": "192.168.132.2", "v_name": "vxlan_t4s1"}]}, {"brif": "t4s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.5", "dnsif": "t4s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "rc": 0, "start": "2019-12-05 18:18:58.826354", "stderr": "Device \"t4s1_dnsbrif\" does not exist.", "stderr_lines": ["Device \"t4s1_dnsbrif\" does not exist."], "stdout": "", "stdout_lines": []}
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.32.1/24', u'ns_name': u't4', u'ns_if': u't4if', u'if': u'p1'}], u'default_route_ip': u'10.2.32.1', u'bridge_name': u't4br2', u'ns_name': u't4ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.32.2/24', u'tenant_ns_ip': u'10.2.32.1/24', u'tenant_ns_if': u't4ns2if', u'tenant_sub_if': u't4s2if', u'tenant_ns_name': u't4'}], u'subnet_ip': u'2.2.2.0/24', u'vms': [{u'mem': 3, u'name': u't4_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't4br2if1', u'vmif': u't4VM3if1'}], u'vxlan': [{u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}, {u'dnsif': u't4s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't4s2_dnsbrif'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t4ns2\" ip link show \"t4s2_dnsbrif\" ; if [ $? -ne 0 ] ; then ip netns exec \"t4ns2\" ip link add \"t4s2_dnsbrif\" type veth peer name \"t4s2_dnsif\" ; fi\nip netns exec \"t4ns2\" ip link set dev \"t4s2_dnsbrif\" up\nip netns exec \"t4ns2\" ip link set dev \"t4s2_dnsif\" up\n", "delta": "0:00:00.171961", "end": "2019-12-05 18:18:59.510568", "item": [{"bridge_name": "t4br2", "default_route_ip": "10.2.32.1", "ns_name": "t4ns2", "route": [{"if": "p1", "ip": "10.2.32.1/24", "ns_if": "t4if", "ns_name": "t4"}], "subnet_ip": "2.2.2.0/24", "tenant_ns": [{"tenant_ns_if": "t4ns2if", "tenant_ns_ip": "10.2.32.1/24", "tenant_ns_name": "t4", "tenant_sub_if": "t4s2if", "tenant_sub_ip": "10.2.32.2/24"}], "vms": [{"brif": "t4br2if1", "disk": "10G", "mem": 3, "name": "t4_VM3", "vcpu": 2, "vmif": "t4VM3if1"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, {"brif": "t4s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t4s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "rc": 0, "start": "2019-12-05 18:18:59.338607", "stderr": "Device \"t4s2_dnsbrif\" does not exist.", "stderr_lines": ["Device \"t4s2_dnsbrif\" does not exist."], "stdout": "", "stdout_lines": []}

TASK [Attach DNS VETH Pair] *********************************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.31.1/24', u'ns_name': u't4', u'ns_if': u't4if', u'if': u'p1'}], u'default_route_ip': u'10.2.31.1', u'bridge_name': u't4br1', u'ns_name': u't4ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.31.2/24', u'tenant_ns_ip': u'10.2.31.1/24', u'tenant_ns_if': u't4ns1if', u'tenant_sub_if': u't4s1if', u'tenant_ns_name': u't4'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't4_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't4br1if1', u'vmif': u't4VM4if1'}], u'vxlan': [{u'local_ip': u'10.2.31.2', u'dsport': 4789, u'dev': u't4s1if', u'tenant_route_ip': u'192.168.132.2', u'remote_route': u'10.1.31.0/24', u'subnet_route': u'10.2.31.0/24', u'v_name': u'vxlan_t4s1', u'id': 42, u'remote_ip': u'10.1.31.2'}]}, {u'dnsif': u't4s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't4s1_dnsbrif'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t4ns1\" brctl show \"t4br1\" | grep -w 't4s1_dnsbrif' ; if [ $? -ne 0 ] ; then ip netns exec \"t4ns1\" brctl addif \"t4br1\" \"t4s1_dnsbrif\" ; fi\n", "delta": "0:00:00.073365", "end": "2019-12-05 18:19:00.010774", "item": [{"bridge_name": "t4br1", "default_route_ip": "10.2.31.1", "ns_name": "t4ns1", "route": [{"if": "p1", "ip": "10.2.31.1/24", "ns_if": "t4if", "ns_name": "t4"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t4ns1if", "tenant_ns_ip": "10.2.31.1/24", "tenant_ns_name": "t4", "tenant_sub_if": "t4s1if", "tenant_sub_ip": "10.2.31.2/24"}], "vms": [{"brif": "t4br1if1", "disk": "10G", "mem": 2, "name": "t4_VM4", "vcpu": 4, "vmif": "t4VM4if1"}], "vxlan": [{"dev": "t4s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.31.2", "remote_ip": "10.1.31.2", "remote_route": "10.1.31.0/24", "subnet_route": "10.2.31.0/24", "tenant_route_ip": "192.168.132.2", "v_name": "vxlan_t4s1"}]}, {"brif": "t4s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.5", "dnsif": "t4s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "rc": 0, "start": "2019-12-05 18:18:59.937409", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.32.1/24', u'ns_name': u't4', u'ns_if': u't4if', u'if': u'p1'}], u'default_route_ip': u'10.2.32.1', u'bridge_name': u't4br2', u'ns_name': u't4ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.32.2/24', u'tenant_ns_ip': u'10.2.32.1/24', u'tenant_ns_if': u't4ns2if', u'tenant_sub_if': u't4s2if', u'tenant_ns_name': u't4'}], u'subnet_ip': u'2.2.2.0/24', u'vms': [{u'mem': 3, u'name': u't4_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't4br2if1', u'vmif': u't4VM3if1'}], u'vxlan': [{u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}, {u'dnsif': u't4s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't4s2_dnsbrif'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t4ns2\" brctl show \"t4br2\" | grep -w 't4s2_dnsbrif' ; if [ $? -ne 0 ] ; then ip netns exec \"t4ns2\" brctl addif \"t4br2\" \"t4s2_dnsbrif\" ; fi\n", "delta": "0:00:00.082015", "end": "2019-12-05 18:19:00.442736", "item": [{"bridge_name": "t4br2", "default_route_ip": "10.2.32.1", "ns_name": "t4ns2", "route": [{"if": "p1", "ip": "10.2.32.1/24", "ns_if": "t4if", "ns_name": "t4"}], "subnet_ip": "2.2.2.0/24", "tenant_ns": [{"tenant_ns_if": "t4ns2if", "tenant_ns_ip": "10.2.32.1/24", "tenant_ns_name": "t4", "tenant_sub_if": "t4s2if", "tenant_sub_ip": "10.2.32.2/24"}], "vms": [{"brif": "t4br2if1", "disk": "10G", "mem": 3, "name": "t4_VM3", "vcpu": 2, "vmif": "t4VM3if1"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, {"brif": "t4s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t4s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "rc": 0, "start": "2019-12-05 18:19:00.360721", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Create VETH Pairs] ************************************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.31.1/24', u'ns_name': u't4', u'ns_if': u't4if', u'if': u'p1'}], u'default_route_ip': u'10.2.31.1', u'bridge_name': u't4br1', u'dns': [{u'dnsif': u't4s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't4s1_dnsbrif'}], u'ns_name': u't4ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.31.2/24', u'tenant_ns_ip': u'10.2.31.1/24', u'tenant_ns_if': u't4ns1if', u'tenant_sub_if': u't4s1if', u'tenant_ns_name': u't4'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.2.31.2', u'dsport': 4789, u'dev': u't4s1if', u'tenant_route_ip': u'192.168.132.2', u'remote_route': u'10.1.31.0/24', u'subnet_route': u'10.2.31.0/24', u'v_name': u'vxlan_t4s1', u'id': 42, u'remote_ip': u'10.1.31.2'}]}, {u'mem': 2, u'name': u't4_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't4br1if1', u'vmif': u't4VM4if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip link show \"t4br1if1\" ; if [ $? -ne 0 ] ; then ip link add \"t4VM4if1\" type veth peer name \"t4br1if1\" ; fi\nip link set dev \"t4br1if1\" up\nip link set dev \"t4VM4if1\" up\n", "delta": "0:00:00.019414", "end": "2019-12-05 18:19:00.898824", "item": [{"bridge_name": "t4br1", "default_route_ip": "10.2.31.1", "dns": [{"brif": "t4s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.5", "dnsif": "t4s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t4ns1", "route": [{"if": "p1", "ip": "10.2.31.1/24", "ns_if": "t4if", "ns_name": "t4"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t4ns1if", "tenant_ns_ip": "10.2.31.1/24", "tenant_ns_name": "t4", "tenant_sub_if": "t4s1if", "tenant_sub_ip": "10.2.31.2/24"}], "vxlan": [{"dev": "t4s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.31.2", "remote_ip": "10.1.31.2", "remote_route": "10.1.31.0/24", "subnet_route": "10.2.31.0/24", "tenant_route_ip": "192.168.132.2", "v_name": "vxlan_t4s1"}]}, {"brif": "t4br1if1", "disk": "10G", "mem": 2, "name": "t4_VM4", "vcpu": 4, "vmif": "t4VM4if1"}], "rc": 0, "start": "2019-12-05 18:19:00.879410", "stderr": "Device \"t4br1if1\" does not exist.", "stderr_lines": ["Device \"t4br1if1\" does not exist."], "stdout": "", "stdout_lines": []}
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.32.1/24', u'ns_name': u't4', u'ns_if': u't4if', u'if': u'p1'}], u'default_route_ip': u'10.2.32.1', u'bridge_name': u't4br2', u'dns': [{u'dnsif': u't4s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't4s2_dnsbrif'}], u'ns_name': u't4ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.32.2/24', u'tenant_ns_ip': u'10.2.32.1/24', u'tenant_ns_if': u't4ns2if', u'tenant_sub_if': u't4s2if', u'tenant_ns_name': u't4'}], u'subnet_ip': u'2.2.2.0/24', u'vxlan': [{u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}, {u'mem': 3, u'name': u't4_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't4br2if1', u'vmif': u't4VM3if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip link show \"t4br2if1\" ; if [ $? -ne 0 ] ; then ip link add \"t4VM3if1\" type veth peer name \"t4br2if1\" ; fi\nip link set dev \"t4br2if1\" up\nip link set dev \"t4VM3if1\" up\n", "delta": "0:00:00.023691", "end": "2019-12-05 18:19:01.301255", "item": [{"bridge_name": "t4br2", "default_route_ip": "10.2.32.1", "dns": [{"brif": "t4s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t4s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t4ns2", "route": [{"if": "p1", "ip": "10.2.32.1/24", "ns_if": "t4if", "ns_name": "t4"}], "subnet_ip": "2.2.2.0/24", "tenant_ns": [{"tenant_ns_if": "t4ns2if", "tenant_ns_ip": "10.2.32.1/24", "tenant_ns_name": "t4", "tenant_sub_if": "t4s2if", "tenant_sub_ip": "10.2.32.2/24"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, {"brif": "t4br2if1", "disk": "10G", "mem": 3, "name": "t4_VM3", "vcpu": 2, "vmif": "t4VM3if1"}], "rc": 0, "start": "2019-12-05 18:19:01.277564", "stderr": "Device \"t4br2if1\" does not exist.", "stderr_lines": ["Device \"t4br2if1\" does not exist."], "stdout": "", "stdout_lines": []}

TASK [Attach VETH Pairs] ************************************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.31.1/24', u'ns_name': u't4', u'ns_if': u't4if', u'if': u'p1'}], u'default_route_ip': u'10.2.31.1', u'bridge_name': u't4br1', u'dns': [{u'dnsif': u't4s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't4s1_dnsbrif'}], u'ns_name': u't4ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.31.2/24', u'tenant_ns_ip': u'10.2.31.1/24', u'tenant_ns_if': u't4ns1if', u'tenant_sub_if': u't4s1if', u'tenant_ns_name': u't4'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.2.31.2', u'dsport': 4789, u'dev': u't4s1if', u'tenant_route_ip': u'192.168.132.2', u'remote_route': u'10.1.31.0/24', u'subnet_route': u'10.2.31.0/24', u'v_name': u'vxlan_t4s1', u'id': 42, u'remote_ip': u'10.1.31.2'}]}, {u'mem': 2, u'name': u't4_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't4br1if1', u'vmif': u't4VM4if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip link show \"t4br1if1\" ; if [ $? -eq 0 ] ; then ip link set \"t4br1if1\" netns \"t4ns1\" ; fi\nip netns exec \"t4ns1\" brctl show \"t4br1\" | grep -w 't4br1if1' ; if [ $? -ne 0 ] ; then ip netns exec \"t4ns1\" brctl addif \"t4br1\" \"t4br1if1\" ; fi\n", "delta": "0:00:00.106069", "end": "2019-12-05 18:19:01.870627", "item": [{"bridge_name": "t4br1", "default_route_ip": "10.2.31.1", "dns": [{"brif": "t4s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.5", "dnsif": "t4s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t4ns1", "route": [{"if": "p1", "ip": "10.2.31.1/24", "ns_if": "t4if", "ns_name": "t4"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t4ns1if", "tenant_ns_ip": "10.2.31.1/24", "tenant_ns_name": "t4", "tenant_sub_if": "t4s1if", "tenant_sub_ip": "10.2.31.2/24"}], "vxlan": [{"dev": "t4s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.31.2", "remote_ip": "10.1.31.2", "remote_route": "10.1.31.0/24", "subnet_route": "10.2.31.0/24", "tenant_route_ip": "192.168.132.2", "v_name": "vxlan_t4s1"}]}, {"brif": "t4br1if1", "disk": "10G", "mem": 2, "name": "t4_VM4", "vcpu": 4, "vmif": "t4VM4if1"}], "rc": 0, "start": "2019-12-05 18:19:01.764558", "stderr": "", "stderr_lines": [], "stdout": "36: t4br1if1@t4VM4if1: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP mode DEFAULT group default qlen 1000\n    link/ether 36:2d:2c:d2:01:dd brd ff:ff:ff:ff:ff:ff", "stdout_lines": ["36: t4br1if1@t4VM4if1: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP mode DEFAULT group default qlen 1000", "    link/ether 36:2d:2c:d2:01:dd brd ff:ff:ff:ff:ff:ff"]}
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.32.1/24', u'ns_name': u't4', u'ns_if': u't4if', u'if': u'p1'}], u'default_route_ip': u'10.2.32.1', u'bridge_name': u't4br2', u'dns': [{u'dnsif': u't4s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't4s2_dnsbrif'}], u'ns_name': u't4ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.32.2/24', u'tenant_ns_ip': u'10.2.32.1/24', u'tenant_ns_if': u't4ns2if', u'tenant_sub_if': u't4s2if', u'tenant_ns_name': u't4'}], u'subnet_ip': u'2.2.2.0/24', u'vxlan': [{u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}, {u'mem': 3, u'name': u't4_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't4br2if1', u'vmif': u't4VM3if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip link show \"t4br2if1\" ; if [ $? -eq 0 ] ; then ip link set \"t4br2if1\" netns \"t4ns2\" ; fi\nip netns exec \"t4ns2\" brctl show \"t4br2\" | grep -w 't4br2if1' ; if [ $? -ne 0 ] ; then ip netns exec \"t4ns2\" brctl addif \"t4br2\" \"t4br2if1\" ; fi\n", "delta": "0:00:00.112482", "end": "2019-12-05 18:19:02.386545", "item": [{"bridge_name": "t4br2", "default_route_ip": "10.2.32.1", "dns": [{"brif": "t4s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t4s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t4ns2", "route": [{"if": "p1", "ip": "10.2.32.1/24", "ns_if": "t4if", "ns_name": "t4"}], "subnet_ip": "2.2.2.0/24", "tenant_ns": [{"tenant_ns_if": "t4ns2if", "tenant_ns_ip": "10.2.32.1/24", "tenant_ns_name": "t4", "tenant_sub_if": "t4s2if", "tenant_sub_ip": "10.2.32.2/24"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, {"brif": "t4br2if1", "disk": "10G", "mem": 3, "name": "t4_VM3", "vcpu": 2, "vmif": "t4VM3if1"}], "rc": 0, "start": "2019-12-05 18:19:02.274063", "stderr": "", "stderr_lines": [], "stdout": "38: t4br2if1@t4VM3if1: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP mode DEFAULT group default qlen 1000\n    link/ether 3e:c5:fe:58:58:77 brd ff:ff:ff:ff:ff:ff", "stdout_lines": ["38: t4br2if1@t4VM3if1: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP mode DEFAULT group default qlen 1000", "    link/ether 3e:c5:fe:58:58:77 brd ff:ff:ff:ff:ff:ff"]}

TASK [All interfaces and bridges UP] ************************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.31.1/24', u'ns_name': u't4', u'ns_if': u't4if', u'if': u'p1'}], u'default_route_ip': u'10.2.31.1', u'bridge_name': u't4br1', u'dns': [{u'dnsif': u't4s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't4s1_dnsbrif'}], u'ns_name': u't4ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.31.2/24', u'tenant_ns_ip': u'10.2.31.1/24', u'tenant_ns_if': u't4ns1if', u'tenant_sub_if': u't4s1if', u'tenant_ns_name': u't4'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.2.31.2', u'dsport': 4789, u'dev': u't4s1if', u'tenant_route_ip': u'192.168.132.2', u'remote_route': u'10.1.31.0/24', u'subnet_route': u'10.2.31.0/24', u'v_name': u'vxlan_t4s1', u'id': 42, u'remote_ip': u'10.1.31.2'}]}, {u'mem': 2, u'name': u't4_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't4br1if1', u'vmif': u't4VM4if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t4ns1\" ip link set \"t4br1if1\" up\nip netns exec \"t4ns1\" ip link set dev \"t4br1\" up\n", "delta": "0:00:00.075885", "end": "2019-12-05 18:19:02.942888", "item": [{"bridge_name": "t4br1", "default_route_ip": "10.2.31.1", "dns": [{"brif": "t4s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.5", "dnsif": "t4s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t4ns1", "route": [{"if": "p1", "ip": "10.2.31.1/24", "ns_if": "t4if", "ns_name": "t4"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t4ns1if", "tenant_ns_ip": "10.2.31.1/24", "tenant_ns_name": "t4", "tenant_sub_if": "t4s1if", "tenant_sub_ip": "10.2.31.2/24"}], "vxlan": [{"dev": "t4s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.31.2", "remote_ip": "10.1.31.2", "remote_route": "10.1.31.0/24", "subnet_route": "10.2.31.0/24", "tenant_route_ip": "192.168.132.2", "v_name": "vxlan_t4s1"}]}, {"brif": "t4br1if1", "disk": "10G", "mem": 2, "name": "t4_VM4", "vcpu": 4, "vmif": "t4VM4if1"}], "rc": 0, "start": "2019-12-05 18:19:02.867003", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.32.1/24', u'ns_name': u't4', u'ns_if': u't4if', u'if': u'p1'}], u'default_route_ip': u'10.2.32.1', u'bridge_name': u't4br2', u'dns': [{u'dnsif': u't4s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't4s2_dnsbrif'}], u'ns_name': u't4ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.32.2/24', u'tenant_ns_ip': u'10.2.32.1/24', u'tenant_ns_if': u't4ns2if', u'tenant_sub_if': u't4s2if', u'tenant_ns_name': u't4'}], u'subnet_ip': u'2.2.2.0/24', u'vxlan': [{u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}, {u'mem': 3, u'name': u't4_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't4br2if1', u'vmif': u't4VM3if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t4ns2\" ip link set \"t4br2if1\" up\nip netns exec \"t4ns2\" ip link set dev \"t4br2\" up\n", "delta": "0:00:00.099108", "end": "2019-12-05 18:19:03.434852", "item": [{"bridge_name": "t4br2", "default_route_ip": "10.2.32.1", "dns": [{"brif": "t4s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t4s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t4ns2", "route": [{"if": "p1", "ip": "10.2.32.1/24", "ns_if": "t4if", "ns_name": "t4"}], "subnet_ip": "2.2.2.0/24", "tenant_ns": [{"tenant_ns_if": "t4ns2if", "tenant_ns_ip": "10.2.32.1/24", "tenant_ns_name": "t4", "tenant_sub_if": "t4s2if", "tenant_sub_ip": "10.2.32.2/24"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, {"brif": "t4br2if1", "disk": "10G", "mem": 3, "name": "t4_VM3", "vcpu": 2, "vmif": "t4VM3if1"}], "rc": 0, "start": "2019-12-05 18:19:03.335744", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Add IP to DNS Interface] ******************************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.31.1/24', u'ns_name': u't4', u'ns_if': u't4if', u'if': u'p1'}], u'default_route_ip': u'10.2.31.1', u'bridge_name': u't4br1', u'ns_name': u't4ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.31.2/24', u'tenant_ns_ip': u'10.2.31.1/24', u'tenant_ns_if': u't4ns1if', u'tenant_sub_if': u't4s1if', u'tenant_ns_name': u't4'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't4_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't4br1if1', u'vmif': u't4VM4if1'}], u'vxlan': [{u'local_ip': u'10.2.31.2', u'dsport': 4789, u'dev': u't4s1if', u'tenant_route_ip': u'192.168.132.2', u'remote_route': u'10.1.31.0/24', u'subnet_route': u'10.2.31.0/24', u'v_name': u'vxlan_t4s1', u'id': 42, u'remote_ip': u'10.1.31.2'}]}, {u'dnsif': u't4s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't4s1_dnsbrif'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t4ns1\" ip addr show \"t4s1_dnsif\" | awk 'FNR==3{ print $2}'| grep -w '^1.1.1.1/24' ; if [ $? -ne 0 ] ; then ip netns exec \"t4ns1\" ip addr add \"1.1.1.1/24\" dev \"t4s1_dnsif\" ; fi\n", "delta": "0:00:00.083564", "end": "2019-12-05 18:19:03.958633", "item": [{"bridge_name": "t4br1", "default_route_ip": "10.2.31.1", "ns_name": "t4ns1", "route": [{"if": "p1", "ip": "10.2.31.1/24", "ns_if": "t4if", "ns_name": "t4"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t4ns1if", "tenant_ns_ip": "10.2.31.1/24", "tenant_ns_name": "t4", "tenant_sub_if": "t4s1if", "tenant_sub_ip": "10.2.31.2/24"}], "vms": [{"brif": "t4br1if1", "disk": "10G", "mem": 2, "name": "t4_VM4", "vcpu": 4, "vmif": "t4VM4if1"}], "vxlan": [{"dev": "t4s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.31.2", "remote_ip": "10.1.31.2", "remote_route": "10.1.31.0/24", "subnet_route": "10.2.31.0/24", "tenant_route_ip": "192.168.132.2", "v_name": "vxlan_t4s1"}]}, {"brif": "t4s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.5", "dnsif": "t4s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "rc": 0, "start": "2019-12-05 18:19:03.875069", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.32.1/24', u'ns_name': u't4', u'ns_if': u't4if', u'if': u'p1'}], u'default_route_ip': u'10.2.32.1', u'bridge_name': u't4br2', u'ns_name': u't4ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.32.2/24', u'tenant_ns_ip': u'10.2.32.1/24', u'tenant_ns_if': u't4ns2if', u'tenant_sub_if': u't4s2if', u'tenant_ns_name': u't4'}], u'subnet_ip': u'2.2.2.0/24', u'vms': [{u'mem': 3, u'name': u't4_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't4br2if1', u'vmif': u't4VM3if1'}], u'vxlan': [{u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}, {u'dnsif': u't4s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't4s2_dnsbrif'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t4ns2\" ip addr show \"t4s2_dnsif\" | awk 'FNR==3{ print $2}'| grep -w '^2.2.2.1/24' ; if [ $? -ne 0 ] ; then ip netns exec \"t4ns2\" ip addr add \"2.2.2.1/24\" dev \"t4s2_dnsif\" ; fi\n", "delta": "0:00:00.084633", "end": "2019-12-05 18:19:04.434716", "item": [{"bridge_name": "t4br2", "default_route_ip": "10.2.32.1", "ns_name": "t4ns2", "route": [{"if": "p1", "ip": "10.2.32.1/24", "ns_if": "t4if", "ns_name": "t4"}], "subnet_ip": "2.2.2.0/24", "tenant_ns": [{"tenant_ns_if": "t4ns2if", "tenant_ns_ip": "10.2.32.1/24", "tenant_ns_name": "t4", "tenant_sub_if": "t4s2if", "tenant_sub_ip": "10.2.32.2/24"}], "vms": [{"brif": "t4br2if1", "disk": "10G", "mem": 3, "name": "t4_VM3", "vcpu": 2, "vmif": "t4VM3if1"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, {"brif": "t4s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t4s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "rc": 0, "start": "2019-12-05 18:19:04.350083", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Install DHCP Server] **********************************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.31.1/24', u'ns_name': u't4', u'ns_if': u't4if', u'if': u'p1'}], u'default_route_ip': u'10.2.31.1', u'bridge_name': u't4br1', u'ns_name': u't4ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.31.2/24', u'tenant_ns_ip': u'10.2.31.1/24', u'tenant_ns_if': u't4ns1if', u'tenant_sub_if': u't4s1if', u'tenant_ns_name': u't4'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't4_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't4br1if1', u'vmif': u't4VM4if1'}], u'vxlan': [{u'local_ip': u'10.2.31.2', u'dsport': 4789, u'dev': u't4s1if', u'tenant_route_ip': u'192.168.132.2', u'remote_route': u'10.1.31.0/24', u'subnet_route': u'10.2.31.0/24', u'v_name': u'vxlan_t4s1', u'id': 42, u'remote_ip': u'10.1.31.2'}]}, {u'dnsif': u't4s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't4s1_dnsbrif'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t4ns1\" ps aux | grep -w '[d]nsmasq --interface t4s1_dnsif -z --dhcp-range=1.1.1.5,1.1.1.254' ; if [ $? -ne 0 ] ; then ip netns exec \"t4ns1\" dnsmasq --interface \"t4s1_dnsif\" -z --dhcp-range=1.1.1.5,'1.1.1.254' ; fi\n", "delta": "0:00:00.078775", "end": "2019-12-05 18:19:04.977838", "item": [{"bridge_name": "t4br1", "default_route_ip": "10.2.31.1", "ns_name": "t4ns1", "route": [{"if": "p1", "ip": "10.2.31.1/24", "ns_if": "t4if", "ns_name": "t4"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t4ns1if", "tenant_ns_ip": "10.2.31.1/24", "tenant_ns_name": "t4", "tenant_sub_if": "t4s1if", "tenant_sub_ip": "10.2.31.2/24"}], "vms": [{"brif": "t4br1if1", "disk": "10G", "mem": 2, "name": "t4_VM4", "vcpu": 4, "vmif": "t4VM4if1"}], "vxlan": [{"dev": "t4s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.31.2", "remote_ip": "10.1.31.2", "remote_route": "10.1.31.0/24", "subnet_route": "10.2.31.0/24", "tenant_route_ip": "192.168.132.2", "v_name": "vxlan_t4s1"}]}, {"brif": "t4s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.5", "dnsif": "t4s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "rc": 0, "start": "2019-12-05 18:19:04.899063", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.32.1/24', u'ns_name': u't4', u'ns_if': u't4if', u'if': u'p1'}], u'default_route_ip': u'10.2.32.1', u'bridge_name': u't4br2', u'ns_name': u't4ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.32.2/24', u'tenant_ns_ip': u'10.2.32.1/24', u'tenant_ns_if': u't4ns2if', u'tenant_sub_if': u't4s2if', u'tenant_ns_name': u't4'}], u'subnet_ip': u'2.2.2.0/24', u'vms': [{u'mem': 3, u'name': u't4_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't4br2if1', u'vmif': u't4VM3if1'}], u'vxlan': [{u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}, {u'dnsif': u't4s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't4s2_dnsbrif'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t4ns2\" ps aux | grep -w '[d]nsmasq --interface t4s2_dnsif -z --dhcp-range=2.2.2.5,2.2.2.254' ; if [ $? -ne 0 ] ; then ip netns exec \"t4ns2\" dnsmasq --interface \"t4s2_dnsif\" -z --dhcp-range=2.2.2.5,'2.2.2.254' ; fi\n", "delta": "0:00:00.087257", "end": "2019-12-05 18:19:05.429425", "item": [{"bridge_name": "t4br2", "default_route_ip": "10.2.32.1", "ns_name": "t4ns2", "route": [{"if": "p1", "ip": "10.2.32.1/24", "ns_if": "t4if", "ns_name": "t4"}], "subnet_ip": "2.2.2.0/24", "tenant_ns": [{"tenant_ns_if": "t4ns2if", "tenant_ns_ip": "10.2.32.1/24", "tenant_ns_name": "t4", "tenant_sub_if": "t4s2if", "tenant_sub_ip": "10.2.32.2/24"}], "vms": [{"brif": "t4br2if1", "disk": "10G", "mem": 3, "name": "t4_VM3", "vcpu": 2, "vmif": "t4VM3if1"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, {"brif": "t4s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t4s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "rc": 0, "start": "2019-12-05 18:19:05.342168", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Create VXLAN devices] *********************************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.31.1/24', u'ns_name': u't4', u'ns_if': u't4if', u'if': u'p1'}], u'default_route_ip': u'10.2.31.1', u'bridge_name': u't4br1', u'dns': [{u'dnsif': u't4s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't4s1_dnsbrif'}], u'ns_name': u't4ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.31.2/24', u'tenant_ns_ip': u'10.2.31.1/24', u'tenant_ns_if': u't4ns1if', u'tenant_sub_if': u't4s1if', u'tenant_ns_name': u't4'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't4_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't4br1if1', u'vmif': u't4VM4if1'}]}, {u'local_ip': u'10.2.31.2', u'dsport': 4789, u'dev': u't4s1if', u'tenant_route_ip': u'192.168.132.2', u'remote_route': u'10.1.31.0/24', u'subnet_route': u'10.2.31.0/24', u'v_name': u'vxlan_t4s1', u'id': 42, u'remote_ip': u'10.1.31.2'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t4ns1\" ip link show \"vxlan_t4s1\" ; if [ $? -ne 0 ] ; then ip netns exec \"t4ns1\" ip link add \"vxlan_t4s1\" type vxlan id \"42\" local \"10.2.31.2\" remote \"10.1.31.2\" dstport \"4789\" dev \"t4s1if\" ; ip netns exec \"t4ns1\" ip link set dev \"vxlan_t4s1\" up ; fi\n", "delta": "0:00:00.135180", "end": "2019-12-05 18:19:05.998582", "item": [{"bridge_name": "t4br1", "default_route_ip": "10.2.31.1", "dns": [{"brif": "t4s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.5", "dnsif": "t4s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t4ns1", "route": [{"if": "p1", "ip": "10.2.31.1/24", "ns_if": "t4if", "ns_name": "t4"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t4ns1if", "tenant_ns_ip": "10.2.31.1/24", "tenant_ns_name": "t4", "tenant_sub_if": "t4s1if", "tenant_sub_ip": "10.2.31.2/24"}], "vms": [{"brif": "t4br1if1", "disk": "10G", "mem": 2, "name": "t4_VM4", "vcpu": 4, "vmif": "t4VM4if1"}]}, {"dev": "t4s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.31.2", "remote_ip": "10.1.31.2", "remote_route": "10.1.31.0/24", "subnet_route": "10.2.31.0/24", "tenant_route_ip": "192.168.132.2", "v_name": "vxlan_t4s1"}], "rc": 0, "start": "2019-12-05 18:19:05.863402", "stderr": "Device \"vxlan_t4s1\" does not exist.", "stderr_lines": ["Device \"vxlan_t4s1\" does not exist."], "stdout": "", "stdout_lines": []}
skipping: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.32.1/24', u'ns_name': u't4', u'ns_if': u't4if', u'if': u'p1'}], u'default_route_ip': u'10.2.32.1', u'bridge_name': u't4br2', u'dns': [{u'dnsif': u't4s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't4s2_dnsbrif'}], u'ns_name': u't4ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.32.2/24', u'tenant_ns_ip': u'10.2.32.1/24', u'tenant_ns_if': u't4ns2if', u'tenant_sub_if': u't4s2if', u'tenant_ns_name': u't4'}], u'subnet_ip': u'2.2.2.0/24', u'vms': [{u'mem': 3, u'name': u't4_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't4br2if1', u'vmif': u't4VM3if1'}]}, {u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}])  => {"ansible_loop_var": "item", "changed": false, "item": [{"bridge_name": "t4br2", "default_route_ip": "10.2.32.1", "dns": [{"brif": "t4s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t4s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t4ns2", "route": [{"if": "p1", "ip": "10.2.32.1/24", "ns_if": "t4if", "ns_name": "t4"}], "subnet_ip": "2.2.2.0/24", "tenant_ns": [{"tenant_ns_if": "t4ns2if", "tenant_ns_ip": "10.2.32.1/24", "tenant_ns_name": "t4", "tenant_sub_if": "t4s2if", "tenant_sub_ip": "10.2.32.2/24"}], "vms": [{"brif": "t4br2if1", "disk": "10G", "mem": 3, "name": "t4_VM3", "vcpu": 2, "vmif": "t4VM3if1"}]}, {"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}], "skip_reason": "Conditional result was False"}

TASK [Attach VXLANs to bridge] ******************************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.31.1/24', u'ns_name': u't4', u'ns_if': u't4if', u'if': u'p1'}], u'default_route_ip': u'10.2.31.1', u'bridge_name': u't4br1', u'dns': [{u'dnsif': u't4s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't4s1_dnsbrif'}], u'ns_name': u't4ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.31.2/24', u'tenant_ns_ip': u'10.2.31.1/24', u'tenant_ns_if': u't4ns1if', u'tenant_sub_if': u't4s1if', u'tenant_ns_name': u't4'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't4_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't4br1if1', u'vmif': u't4VM4if1'}]}, {u'local_ip': u'10.2.31.2', u'dsport': 4789, u'dev': u't4s1if', u'tenant_route_ip': u'192.168.132.2', u'remote_route': u'10.1.31.0/24', u'subnet_route': u'10.2.31.0/24', u'v_name': u'vxlan_t4s1', u'id': 42, u'remote_ip': u'10.1.31.2'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t4ns1\" brctl show \"t4br1\" | grep -w 'vxlan_t4s1' ; if [ $? -ne 0 ] ; then ip netns exec \"t4ns1\" brctl addif \"t4br1\" \"vxlan_t4s1\" ; fi\n", "delta": "0:00:00.070818", "end": "2019-12-05 18:19:06.534679", "item": [{"bridge_name": "t4br1", "default_route_ip": "10.2.31.1", "dns": [{"brif": "t4s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.5", "dnsif": "t4s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t4ns1", "route": [{"if": "p1", "ip": "10.2.31.1/24", "ns_if": "t4if", "ns_name": "t4"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t4ns1if", "tenant_ns_ip": "10.2.31.1/24", "tenant_ns_name": "t4", "tenant_sub_if": "t4s1if", "tenant_sub_ip": "10.2.31.2/24"}], "vms": [{"brif": "t4br1if1", "disk": "10G", "mem": 2, "name": "t4_VM4", "vcpu": 4, "vmif": "t4VM4if1"}]}, {"dev": "t4s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.31.2", "remote_ip": "10.1.31.2", "remote_route": "10.1.31.0/24", "subnet_route": "10.2.31.0/24", "tenant_route_ip": "192.168.132.2", "v_name": "vxlan_t4s1"}], "rc": 0, "start": "2019-12-05 18:19:06.463861", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}
skipping: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.32.1/24', u'ns_name': u't4', u'ns_if': u't4if', u'if': u'p1'}], u'default_route_ip': u'10.2.32.1', u'bridge_name': u't4br2', u'dns': [{u'dnsif': u't4s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't4s2_dnsbrif'}], u'ns_name': u't4ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.32.2/24', u'tenant_ns_ip': u'10.2.32.1/24', u'tenant_ns_if': u't4ns2if', u'tenant_sub_if': u't4s2if', u'tenant_ns_name': u't4'}], u'subnet_ip': u'2.2.2.0/24', u'vms': [{u'mem': 3, u'name': u't4_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't4br2if1', u'vmif': u't4VM3if1'}]}, {u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}])  => {"ansible_loop_var": "item", "changed": false, "item": [{"bridge_name": "t4br2", "default_route_ip": "10.2.32.1", "dns": [{"brif": "t4s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t4s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t4ns2", "route": [{"if": "p1", "ip": "10.2.32.1/24", "ns_if": "t4if", "ns_name": "t4"}], "subnet_ip": "2.2.2.0/24", "tenant_ns": [{"tenant_ns_if": "t4ns2if", "tenant_ns_ip": "10.2.32.1/24", "tenant_ns_name": "t4", "tenant_sub_if": "t4s2if", "tenant_sub_ip": "10.2.32.2/24"}], "vms": [{"brif": "t4br2if1", "disk": "10G", "mem": 3, "name": "t4_VM3", "vcpu": 2, "vmif": "t4VM3if1"}]}, {"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}], "skip_reason": "Conditional result was False"}

PLAY RECAP **************************************************************************************************************************************************
99.99.99.2                 : ok=21   changed=21   unreachable=0    failed=0    skipped=0    rescued=0    ignored=0   

Using /etc/ansible/ansible.cfg as config file

PLAY [main] *************************************************************************************************************************************************

TASK [Add VXLAN routes in PNS] ******************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.31.1/24', u'ns_name': u't4', u'ns_if': u't4if', u'if': u'p1'}], u'default_route_ip': u'10.1.31.1', u'bridge_name': u't4br1', u'dns': [{u'dnsif': u't4s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't4s1_dnsbrif'}], u'ns_name': u't4ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.31.2/24', u'tenant_ns_ip': u'10.1.31.1/24', u'tenant_ns_if': u't4ns1if', u'tenant_sub_if': u't4s1if', u'tenant_ns_name': u't4'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't4_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't4br1if1', u'vmif': u't4VM1if1'}, {u'mem': 4, u'name': u't4_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't4br1if2', u'vmif': u't4VM2if1'}]}, {u'local_ip': u'10.1.31.2', u'dsport': 4789, u'dev': u't4s1if', u'tenant_route_ip': u'192.168.4.2', u'remote_route': u'10.2.31.0/24', u'subnet_route': u'10.1.31.0/24', u'v_name': u'vxlan_t4s1', u'id': 42, u'remote_ip': u'10.2.31.2'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec pns ip route show \"10.1.31.0/24\" via \"192.168.4.2\" | grep -w '^10.1.31.0/24' ; if [ $? -ne 0 ] ; then ip netns exec pns ip route add \"10.1.31.0/24\" via \"192.168.4.2\" ; fi\n", "delta": "0:00:00.071754", "end": "2019-12-05 18:19:07.819023", "item": [{"bridge_name": "t4br1", "default_route_ip": "10.1.31.1", "dns": [{"brif": "t4s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.5", "dnsif": "t4s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t4ns1", "route": [{"if": "p1", "ip": "10.1.31.1/24", "ns_if": "t4if", "ns_name": "t4"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t4ns1if", "tenant_ns_ip": "10.1.31.1/24", "tenant_ns_name": "t4", "tenant_sub_if": "t4s1if", "tenant_sub_ip": "10.1.31.2/24"}], "vms": [{"brif": "t4br1if1", "disk": "10G", "mem": 2, "name": "t4_VM1", "vcpu": 4, "vmif": "t4VM1if1"}, {"brif": "t4br1if2", "disk": "10G", "mem": 4, "name": "t4_VM2", "vcpu": 2, "vmif": "t4VM2if1"}]}, {"dev": "t4s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.31.2", "remote_ip": "10.2.31.2", "remote_route": "10.2.31.0/24", "subnet_route": "10.1.31.0/24", "tenant_route_ip": "192.168.4.2", "v_name": "vxlan_t4s1"}], "rc": 0, "start": "2019-12-05 18:19:07.747269", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Get PNS ip address] ***********************************************************************************************************************************
ok: [localhost] => {"changed": false, "cmd": "ip netns exec pns ip addr show p1 | awk 'FNR==3{ print $2 }' | awk -F/ '{ print $1 }'\n", "delta": "0:00:00.037738", "end": "2019-12-05 18:19:08.167979", "rc": 0, "start": "2019-12-05 18:19:08.130241", "stderr": "", "stderr_lines": [], "stdout": "192.168.100.238", "stdout_lines": ["192.168.100.238"]}

TASK [Add VXLAN routes to host] *****************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.31.1/24', u'ns_name': u't4', u'ns_if': u't4if', u'if': u'p1'}], u'default_route_ip': u'10.1.31.1', u'bridge_name': u't4br1', u'dns': [{u'dnsif': u't4s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't4s1_dnsbrif'}], u'ns_name': u't4ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.31.2/24', u'tenant_ns_ip': u'10.1.31.1/24', u'tenant_ns_if': u't4ns1if', u'tenant_sub_if': u't4s1if', u'tenant_ns_name': u't4'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't4_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't4br1if1', u'vmif': u't4VM1if1'}, {u'mem': 4, u'name': u't4_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't4br1if2', u'vmif': u't4VM2if1'}]}, {u'local_ip': u'10.1.31.2', u'dsport': 4789, u'dev': u't4s1if', u'tenant_route_ip': u'192.168.4.2', u'remote_route': u'10.2.31.0/24', u'subnet_route': u'10.1.31.0/24', u'v_name': u'vxlan_t4s1', u'id': 42, u'remote_ip': u'10.2.31.2'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip route show \"10.1.31.0/24\" via \"192.168.100.238\" | grep -w '^10.1.31.0/24' ; if [ $? -ne 0 ] ; then ip route add \"10.1.31.0/24\" via \"192.168.100.238\" ; fi\nip route show \"10.2.31.0/24\" via 99.99.99.2 | grep -w '^10.2.31.0/24'; if [ $? -ne 0 ] ; then ip route add \"10.2.31.0/24\" via 99.99.99.2 ; fi\n", "delta": "0:00:00.011368", "end": "2019-12-05 18:19:08.518990", "item": [{"bridge_name": "t4br1", "default_route_ip": "10.1.31.1", "dns": [{"brif": "t4s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.5", "dnsif": "t4s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t4ns1", "route": [{"if": "p1", "ip": "10.1.31.1/24", "ns_if": "t4if", "ns_name": "t4"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t4ns1if", "tenant_ns_ip": "10.1.31.1/24", "tenant_ns_name": "t4", "tenant_sub_if": "t4s1if", "tenant_sub_ip": "10.1.31.2/24"}], "vms": [{"brif": "t4br1if1", "disk": "10G", "mem": 2, "name": "t4_VM1", "vcpu": 4, "vmif": "t4VM1if1"}, {"brif": "t4br1if2", "disk": "10G", "mem": 4, "name": "t4_VM2", "vcpu": 2, "vmif": "t4VM2if1"}]}, {"dev": "t4s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.31.2", "remote_ip": "10.2.31.2", "remote_route": "10.2.31.0/24", "subnet_route": "10.1.31.0/24", "tenant_route_ip": "192.168.4.2", "v_name": "vxlan_t4s1"}], "rc": 0, "start": "2019-12-05 18:19:08.507622", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

PLAY RECAP **************************************************************************************************************************************************
localhost                  : ok=3    changed=2    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0   

Using /etc/ansible/ansible.cfg as config file

PLAY [worker] ***********************************************************************************************************************************************

TASK [Add VXLAN routes in PNS] ******************************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.31.1/24', u'ns_name': u't4', u'ns_if': u't4if', u'if': u'p1'}], u'default_route_ip': u'10.2.31.1', u'bridge_name': u't4br1', u'dns': [{u'dnsif': u't4s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't4s1_dnsbrif'}], u'ns_name': u't4ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.31.2/24', u'tenant_ns_ip': u'10.2.31.1/24', u'tenant_ns_if': u't4ns1if', u'tenant_sub_if': u't4s1if', u'tenant_ns_name': u't4'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't4_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't4br1if1', u'vmif': u't4VM4if1'}]}, {u'local_ip': u'10.2.31.2', u'dsport': 4789, u'dev': u't4s1if', u'tenant_route_ip': u'192.168.132.2', u'remote_route': u'10.1.31.0/24', u'subnet_route': u'10.2.31.0/24', u'v_name': u'vxlan_t4s1', u'id': 42, u'remote_ip': u'10.1.31.2'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec pns ip route show \"10.2.31.0/24\" via \"192.168.132.2\" | grep -w '^10.2.31.0/24' ; if [ $? -ne 0 ] ; then ip netns exec pns ip route add \"10.2.31.0/24\" via \"192.168.132.2\" ; fi\n", "delta": "0:00:00.089258", "end": "2019-12-05 18:19:09.842600", "item": [{"bridge_name": "t4br1", "default_route_ip": "10.2.31.1", "dns": [{"brif": "t4s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.5", "dnsif": "t4s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t4ns1", "route": [{"if": "p1", "ip": "10.2.31.1/24", "ns_if": "t4if", "ns_name": "t4"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t4ns1if", "tenant_ns_ip": "10.2.31.1/24", "tenant_ns_name": "t4", "tenant_sub_if": "t4s1if", "tenant_sub_ip": "10.2.31.2/24"}], "vms": [{"brif": "t4br1if1", "disk": "10G", "mem": 2, "name": "t4_VM4", "vcpu": 4, "vmif": "t4VM4if1"}]}, {"dev": "t4s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.31.2", "remote_ip": "10.1.31.2", "remote_route": "10.1.31.0/24", "subnet_route": "10.2.31.0/24", "tenant_route_ip": "192.168.132.2", "v_name": "vxlan_t4s1"}], "rc": 0, "start": "2019-12-05 18:19:09.753342", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}
skipping: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.32.1/24', u'ns_name': u't4', u'ns_if': u't4if', u'if': u'p1'}], u'default_route_ip': u'10.2.32.1', u'bridge_name': u't4br2', u'dns': [{u'dnsif': u't4s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't4s2_dnsbrif'}], u'ns_name': u't4ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.32.2/24', u'tenant_ns_ip': u'10.2.32.1/24', u'tenant_ns_if': u't4ns2if', u'tenant_sub_if': u't4s2if', u'tenant_ns_name': u't4'}], u'subnet_ip': u'2.2.2.0/24', u'vms': [{u'mem': 3, u'name': u't4_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't4br2if1', u'vmif': u't4VM3if1'}]}, {u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}])  => {"ansible_loop_var": "item", "changed": false, "item": [{"bridge_name": "t4br2", "default_route_ip": "10.2.32.1", "dns": [{"brif": "t4s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t4s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t4ns2", "route": [{"if": "p1", "ip": "10.2.32.1/24", "ns_if": "t4if", "ns_name": "t4"}], "subnet_ip": "2.2.2.0/24", "tenant_ns": [{"tenant_ns_if": "t4ns2if", "tenant_ns_ip": "10.2.32.1/24", "tenant_ns_name": "t4", "tenant_sub_if": "t4s2if", "tenant_sub_ip": "10.2.32.2/24"}], "vms": [{"brif": "t4br2if1", "disk": "10G", "mem": 3, "name": "t4_VM3", "vcpu": 2, "vmif": "t4VM3if1"}]}, {"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}], "skip_reason": "Conditional result was False"}

TASK [Get PNS ip address] ***********************************************************************************************************************************
ok: [99.99.99.2] => {"changed": false, "cmd": "ip netns exec pns ip addr show p1 | awk 'FNR==3{ print $2 }' | awk -F/ '{ print $1 }'\n", "delta": "0:00:00.045323", "end": "2019-12-05 18:19:10.311095", "rc": 0, "start": "2019-12-05 18:19:10.265772", "stderr": "", "stderr_lines": [], "stdout": "192.168.100.50", "stdout_lines": ["192.168.100.50"]}

TASK [Add VXLAN routes to host] *****************************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.31.1/24', u'ns_name': u't4', u'ns_if': u't4if', u'if': u'p1'}], u'default_route_ip': u'10.2.31.1', u'bridge_name': u't4br1', u'dns': [{u'dnsif': u't4s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't4s1_dnsbrif'}], u'ns_name': u't4ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.31.2/24', u'tenant_ns_ip': u'10.2.31.1/24', u'tenant_ns_if': u't4ns1if', u'tenant_sub_if': u't4s1if', u'tenant_ns_name': u't4'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't4_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't4br1if1', u'vmif': u't4VM4if1'}]}, {u'local_ip': u'10.2.31.2', u'dsport': 4789, u'dev': u't4s1if', u'tenant_route_ip': u'192.168.132.2', u'remote_route': u'10.1.31.0/24', u'subnet_route': u'10.2.31.0/24', u'v_name': u'vxlan_t4s1', u'id': 42, u'remote_ip': u'10.1.31.2'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip route show \"10.2.31.0/24\" via \"192.168.100.50\" | grep -w '^10.2.31.0/24' ; if [ $? -ne 0 ] ; then ip route add \"10.2.31.0/24\" via \"192.168.100.50\" ; fi\nip route show \"10.1.31.0/24\" via 99.99.99.1 | grep -w '^10.1.31.0/24'; if [ $? -ne 0 ] ; then ip route add \"10.1.31.0/24\" via 99.99.99.1 ; fi\n", "delta": "0:00:00.008700", "end": "2019-12-05 18:19:10.770576", "item": [{"bridge_name": "t4br1", "default_route_ip": "10.2.31.1", "dns": [{"brif": "t4s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.5", "dnsif": "t4s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t4ns1", "route": [{"if": "p1", "ip": "10.2.31.1/24", "ns_if": "t4if", "ns_name": "t4"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t4ns1if", "tenant_ns_ip": "10.2.31.1/24", "tenant_ns_name": "t4", "tenant_sub_if": "t4s1if", "tenant_sub_ip": "10.2.31.2/24"}], "vms": [{"brif": "t4br1if1", "disk": "10G", "mem": 2, "name": "t4_VM4", "vcpu": 4, "vmif": "t4VM4if1"}]}, {"dev": "t4s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.31.2", "remote_ip": "10.1.31.2", "remote_route": "10.1.31.0/24", "subnet_route": "10.2.31.0/24", "tenant_route_ip": "192.168.132.2", "v_name": "vxlan_t4s1"}], "rc": 0, "start": "2019-12-05 18:19:10.761876", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}
skipping: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.32.1/24', u'ns_name': u't4', u'ns_if': u't4if', u'if': u'p1'}], u'default_route_ip': u'10.2.32.1', u'bridge_name': u't4br2', u'dns': [{u'dnsif': u't4s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't4s2_dnsbrif'}], u'ns_name': u't4ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.32.2/24', u'tenant_ns_ip': u'10.2.32.1/24', u'tenant_ns_if': u't4ns2if', u'tenant_sub_if': u't4s2if', u'tenant_ns_name': u't4'}], u'subnet_ip': u'2.2.2.0/24', u'vms': [{u'mem': 3, u'name': u't4_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't4br2if1', u'vmif': u't4VM3if1'}]}, {u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}])  => {"ansible_loop_var": "item", "changed": false, "item": [{"bridge_name": "t4br2", "default_route_ip": "10.2.32.1", "dns": [{"brif": "t4s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t4s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t4ns2", "route": [{"if": "p1", "ip": "10.2.32.1/24", "ns_if": "t4if", "ns_name": "t4"}], "subnet_ip": "2.2.2.0/24", "tenant_ns": [{"tenant_ns_if": "t4ns2if", "tenant_ns_ip": "10.2.32.1/24", "tenant_ns_name": "t4", "tenant_sub_if": "t4s2if", "tenant_sub_ip": "10.2.32.2/24"}], "vms": [{"brif": "t4br2if1", "disk": "10G", "mem": 3, "name": "t4_VM3", "vcpu": 2, "vmif": "t4VM3if1"}]}, {"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}], "skip_reason": "Conditional result was False"}

PLAY RECAP **************************************************************************************************************************************************
99.99.99.2                 : ok=3    changed=2    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0   

Using /etc/ansible/ansible.cfg as config file

PLAY [main] *************************************************************************************************************************************************

TASK [Create VM templates (C1)] *****************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.31.1/24', u'ns_name': u't4', u'ns_if': u't4if', u'if': u'p1'}], u'default_route_ip': u'10.1.31.1', u'bridge_name': u't4br1', u'dns': [{u'dnsif': u't4s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't4s1_dnsbrif'}], u'ns_name': u't4ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.31.2/24', u'tenant_ns_ip': u'10.1.31.1/24', u'tenant_ns_if': u't4ns1if', u'tenant_sub_if': u't4s1if', u'tenant_ns_name': u't4'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.1.31.2', u'dsport': 4789, u'dev': u't4s1if', u'tenant_route_ip': u'192.168.4.2', u'remote_route': u'10.2.31.0/24', u'subnet_route': u'10.1.31.0/24', u'v_name': u'vxlan_t4s1', u'id': 42, u'remote_ip': u'10.2.31.2'}]}, {u'mem': 2, u'name': u't4_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't4br1if1', u'vmif': u't4VM1if1'}]) => {"ansible_loop_var": "item", "changed": true, "checksum": "350ba870bd31b7f6ee517845c14237910b5af0bf", "dest": "/root/Migration-as-a-Service/etc/t4/VM_templates/t4_VM1.xml.j2", "gid": 0, "group": "root", "item": [{"bridge_name": "t4br1", "default_route_ip": "10.1.31.1", "dns": [{"brif": "t4s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.5", "dnsif": "t4s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t4ns1", "route": [{"if": "p1", "ip": "10.1.31.1/24", "ns_if": "t4if", "ns_name": "t4"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t4ns1if", "tenant_ns_ip": "10.1.31.1/24", "tenant_ns_name": "t4", "tenant_sub_if": "t4s1if", "tenant_sub_ip": "10.1.31.2/24"}], "vxlan": [{"dev": "t4s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.31.2", "remote_ip": "10.2.31.2", "remote_route": "10.2.31.0/24", "subnet_route": "10.1.31.0/24", "tenant_route_ip": "192.168.4.2", "v_name": "vxlan_t4s1"}]}, {"brif": "t4br1if1", "disk": "10G", "mem": 2, "name": "t4_VM1", "vcpu": 4, "vmif": "t4VM1if1"}], "md5sum": "fbfc2eb0c2569531f25eea92c26d3bee", "mode": "0644", "owner": "root", "size": 4091, "src": "/root/.ansible/tmp/ansible-tmp-1575569951.55-215733294927321/source", "state": "file", "uid": 0}
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.31.1/24', u'ns_name': u't4', u'ns_if': u't4if', u'if': u'p1'}], u'default_route_ip': u'10.1.31.1', u'bridge_name': u't4br1', u'dns': [{u'dnsif': u't4s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't4s1_dnsbrif'}], u'ns_name': u't4ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.31.2/24', u'tenant_ns_ip': u'10.1.31.1/24', u'tenant_ns_if': u't4ns1if', u'tenant_sub_if': u't4s1if', u'tenant_ns_name': u't4'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.1.31.2', u'dsport': 4789, u'dev': u't4s1if', u'tenant_route_ip': u'192.168.4.2', u'remote_route': u'10.2.31.0/24', u'subnet_route': u'10.1.31.0/24', u'v_name': u'vxlan_t4s1', u'id': 42, u'remote_ip': u'10.2.31.2'}]}, {u'mem': 4, u'name': u't4_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't4br1if2', u'vmif': u't4VM2if1'}]) => {"ansible_loop_var": "item", "changed": true, "checksum": "350ba870bd31b7f6ee517845c14237910b5af0bf", "dest": "/root/Migration-as-a-Service/etc/t4/VM_templates/t4_VM2.xml.j2", "gid": 0, "group": "root", "item": [{"bridge_name": "t4br1", "default_route_ip": "10.1.31.1", "dns": [{"brif": "t4s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.5", "dnsif": "t4s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t4ns1", "route": [{"if": "p1", "ip": "10.1.31.1/24", "ns_if": "t4if", "ns_name": "t4"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t4ns1if", "tenant_ns_ip": "10.1.31.1/24", "tenant_ns_name": "t4", "tenant_sub_if": "t4s1if", "tenant_sub_ip": "10.1.31.2/24"}], "vxlan": [{"dev": "t4s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.31.2", "remote_ip": "10.2.31.2", "remote_route": "10.2.31.0/24", "subnet_route": "10.1.31.0/24", "tenant_route_ip": "192.168.4.2", "v_name": "vxlan_t4s1"}]}, {"brif": "t4br1if2", "disk": "10G", "mem": 4, "name": "t4_VM2", "vcpu": 2, "vmif": "t4VM2if1"}], "md5sum": "fbfc2eb0c2569531f25eea92c26d3bee", "mode": "0644", "owner": "root", "size": 4091, "src": "/root/.ansible/tmp/ansible-tmp-1575569952.18-239154246081808/source", "state": "file", "uid": 0}

PLAY RECAP **************************************************************************************************************************************************
localhost                  : ok=1    changed=1    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0   

Using /etc/ansible/ansible.cfg as config file

PLAY [main] *************************************************************************************************************************************************

TASK [Create VM templates (C2)] *****************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.2.31.1/24', u'ns_name': u't4', u'ns_if': u't4if', u'if': u'p1'}], u'default_route_ip': u'10.2.31.1', u'bridge_name': u't4br1', u'dns': [{u'dnsif': u't4s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't4s1_dnsbrif'}], u'ns_name': u't4ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.31.2/24', u'tenant_ns_ip': u'10.2.31.1/24', u'tenant_ns_if': u't4ns1if', u'tenant_sub_if': u't4s1if', u'tenant_ns_name': u't4'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.2.31.2', u'dsport': 4789, u'dev': u't4s1if', u'tenant_route_ip': u'192.168.132.2', u'remote_route': u'10.1.31.0/24', u'subnet_route': u'10.2.31.0/24', u'v_name': u'vxlan_t4s1', u'id': 42, u'remote_ip': u'10.1.31.2'}]}, {u'mem': 2, u'name': u't4_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't4br1if1', u'vmif': u't4VM4if1'}]) => {"ansible_loop_var": "item", "changed": true, "checksum": "350ba870bd31b7f6ee517845c14237910b5af0bf", "dest": "/root/Migration-as-a-Service/etc/t4/VM_templates/t4_VM4.xml.j2", "gid": 0, "group": "root", "item": [{"bridge_name": "t4br1", "default_route_ip": "10.2.31.1", "dns": [{"brif": "t4s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.5", "dnsif": "t4s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t4ns1", "route": [{"if": "p1", "ip": "10.2.31.1/24", "ns_if": "t4if", "ns_name": "t4"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t4ns1if", "tenant_ns_ip": "10.2.31.1/24", "tenant_ns_name": "t4", "tenant_sub_if": "t4s1if", "tenant_sub_ip": "10.2.31.2/24"}], "vxlan": [{"dev": "t4s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.31.2", "remote_ip": "10.1.31.2", "remote_route": "10.1.31.0/24", "subnet_route": "10.2.31.0/24", "tenant_route_ip": "192.168.132.2", "v_name": "vxlan_t4s1"}]}, {"brif": "t4br1if1", "disk": "10G", "mem": 2, "name": "t4_VM4", "vcpu": 4, "vmif": "t4VM4if1"}], "md5sum": "fbfc2eb0c2569531f25eea92c26d3bee", "mode": "0644", "owner": "root", "size": 4091, "src": "/root/.ansible/tmp/ansible-tmp-1575569953.11-235947317910820/source", "state": "file", "uid": 0}
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.2.32.1/24', u'ns_name': u't4', u'ns_if': u't4if', u'if': u'p1'}], u'default_route_ip': u'10.2.32.1', u'bridge_name': u't4br2', u'dns': [{u'dnsif': u't4s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't4s2_dnsbrif'}], u'ns_name': u't4ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.32.2/24', u'tenant_ns_ip': u'10.2.32.1/24', u'tenant_ns_if': u't4ns2if', u'tenant_sub_if': u't4s2if', u'tenant_ns_name': u't4'}], u'subnet_ip': u'2.2.2.0/24', u'vxlan': [{u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}, {u'mem': 3, u'name': u't4_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't4br2if1', u'vmif': u't4VM3if1'}]) => {"ansible_loop_var": "item", "changed": true, "checksum": "350ba870bd31b7f6ee517845c14237910b5af0bf", "dest": "/root/Migration-as-a-Service/etc/t4/VM_templates/t4_VM3.xml.j2", "gid": 0, "group": "root", "item": [{"bridge_name": "t4br2", "default_route_ip": "10.2.32.1", "dns": [{"brif": "t4s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t4s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t4ns2", "route": [{"if": "p1", "ip": "10.2.32.1/24", "ns_if": "t4if", "ns_name": "t4"}], "subnet_ip": "2.2.2.0/24", "tenant_ns": [{"tenant_ns_if": "t4ns2if", "tenant_ns_ip": "10.2.32.1/24", "tenant_ns_name": "t4", "tenant_sub_if": "t4s2if", "tenant_sub_ip": "10.2.32.2/24"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, {"brif": "t4br2if1", "disk": "10G", "mem": 3, "name": "t4_VM3", "vcpu": 2, "vmif": "t4VM3if1"}], "md5sum": "fbfc2eb0c2569531f25eea92c26d3bee", "mode": "0644", "owner": "root", "size": 4091, "src": "/root/.ansible/tmp/ansible-tmp-1575569953.76-165842901350807/source", "state": "file", "uid": 0}

PLAY RECAP **************************************************************************************************************************************************
localhost                  : ok=1    changed=1    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0   

Using /etc/ansible/ansible.cfg as config file

PLAY [main] *************************************************************************************************************************************************

TASK [Copy VM image] ****************************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.31.1/24', u'ns_name': u't4', u'ns_if': u't4if', u'if': u'p1'}], u'default_route_ip': u'10.1.31.1', u'bridge_name': u't4br1', u'dns': [{u'dnsif': u't4s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't4s1_dnsbrif'}], u'ns_name': u't4ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.31.2/24', u'tenant_ns_ip': u'10.1.31.1/24', u'tenant_ns_if': u't4ns1if', u'tenant_sub_if': u't4s1if', u'tenant_ns_name': u't4'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.1.31.2', u'dsport': 4789, u'dev': u't4s1if', u'tenant_route_ip': u'192.168.4.2', u'remote_route': u'10.2.31.0/24', u'subnet_route': u'10.1.31.0/24', u'v_name': u'vxlan_t4s1', u'id': 42, u'remote_ip': u'10.2.31.2'}]}, {u'mem': 2, u'name': u't4_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't4br1if1', u'vmif': u't4VM1if1'}]) => {"ansible_loop_var": "item", "changed": true, "checksum": "d86d5962370fcd0c3d05943fc209d9e05fdac89f", "dest": "/var/lib/libvirt/images/t4_VM1.qcow2", "gid": 0, "group": "root", "item": [{"bridge_name": "t4br1", "default_route_ip": "10.1.31.1", "dns": [{"brif": "t4s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.5", "dnsif": "t4s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t4ns1", "route": [{"if": "p1", "ip": "10.1.31.1/24", "ns_if": "t4if", "ns_name": "t4"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t4ns1if", "tenant_ns_ip": "10.1.31.1/24", "tenant_ns_name": "t4", "tenant_sub_if": "t4s1if", "tenant_sub_ip": "10.1.31.2/24"}], "vxlan": [{"dev": "t4s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.31.2", "remote_ip": "10.2.31.2", "remote_route": "10.2.31.0/24", "subnet_route": "10.1.31.0/24", "tenant_route_ip": "192.168.4.2", "v_name": "vxlan_t4s1"}]}, {"brif": "t4br1if1", "disk": "10G", "mem": 2, "name": "t4_VM1", "vcpu": 4, "vmif": "t4VM1if1"}], "md5sum": "b977a19124b65f2d544ddc62e407114d", "mode": "0644", "owner": "root", "size": 10739318784, "src": "/root/.ansible/tmp/ansible-tmp-1575569954.87-79440827733752/source", "state": "file", "uid": 0}
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.31.1/24', u'ns_name': u't4', u'ns_if': u't4if', u'if': u'p1'}], u'default_route_ip': u'10.1.31.1', u'bridge_name': u't4br1', u'dns': [{u'dnsif': u't4s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't4s1_dnsbrif'}], u'ns_name': u't4ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.31.2/24', u'tenant_ns_ip': u'10.1.31.1/24', u'tenant_ns_if': u't4ns1if', u'tenant_sub_if': u't4s1if', u'tenant_ns_name': u't4'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.1.31.2', u'dsport': 4789, u'dev': u't4s1if', u'tenant_route_ip': u'192.168.4.2', u'remote_route': u'10.2.31.0/24', u'subnet_route': u'10.1.31.0/24', u'v_name': u'vxlan_t4s1', u'id': 42, u'remote_ip': u'10.2.31.2'}]}, {u'mem': 4, u'name': u't4_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't4br1if2', u'vmif': u't4VM2if1'}]) => {"ansible_loop_var": "item", "changed": true, "checksum": "d86d5962370fcd0c3d05943fc209d9e05fdac89f", "dest": "/var/lib/libvirt/images/t4_VM2.qcow2", "gid": 0, "group": "root", "item": [{"bridge_name": "t4br1", "default_route_ip": "10.1.31.1", "dns": [{"brif": "t4s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.5", "dnsif": "t4s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t4ns1", "route": [{"if": "p1", "ip": "10.1.31.1/24", "ns_if": "t4if", "ns_name": "t4"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t4ns1if", "tenant_ns_ip": "10.1.31.1/24", "tenant_ns_name": "t4", "tenant_sub_if": "t4s1if", "tenant_sub_ip": "10.1.31.2/24"}], "vxlan": [{"dev": "t4s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.31.2", "remote_ip": "10.2.31.2", "remote_route": "10.2.31.0/24", "subnet_route": "10.1.31.0/24", "tenant_route_ip": "192.168.4.2", "v_name": "vxlan_t4s1"}]}, {"brif": "t4br1if2", "disk": "10G", "mem": 4, "name": "t4_VM2", "vcpu": 2, "vmif": "t4VM2if1"}], "md5sum": "b977a19124b65f2d544ddc62e407114d", "mode": "0644", "owner": "root", "size": 10739318784, "src": "/root/.ansible/tmp/ansible-tmp-1575570049.63-54031831886859/source", "state": "file", "uid": 0}

TASK [Get list of running VMs] ******************************************************************************************************************************
ok: [localhost] => {"changed": false, "cmd": ["virsh", "list", "--name"], "delta": "0:00:00.023419", "end": "2019-12-05 18:22:21.810506", "rc": 0, "start": "2019-12-05 18:22:21.787087", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Define VM] ********************************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.31.1/24', u'ns_name': u't4', u'ns_if': u't4if', u'if': u'p1'}], u'default_route_ip': u'10.1.31.1', u'bridge_name': u't4br1', u'dns': [{u'dnsif': u't4s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't4s1_dnsbrif'}], u'ns_name': u't4ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.31.2/24', u'tenant_ns_ip': u'10.1.31.1/24', u'tenant_ns_if': u't4ns1if', u'tenant_sub_if': u't4s1if', u'tenant_ns_name': u't4'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.1.31.2', u'dsport': 4789, u'dev': u't4s1if', u'tenant_route_ip': u'192.168.4.2', u'remote_route': u'10.2.31.0/24', u'subnet_route': u'10.1.31.0/24', u'v_name': u'vxlan_t4s1', u'id': 42, u'remote_ip': u'10.2.31.2'}]}, {u'mem': 2, u'name': u't4_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't4br1if1', u'vmif': u't4VM1if1'}]) => {"ansible_loop_var": "item", "changed": true, "created": "t4_VM1", "item": [{"bridge_name": "t4br1", "default_route_ip": "10.1.31.1", "dns": [{"brif": "t4s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.5", "dnsif": "t4s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t4ns1", "route": [{"if": "p1", "ip": "10.1.31.1/24", "ns_if": "t4if", "ns_name": "t4"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t4ns1if", "tenant_ns_ip": "10.1.31.1/24", "tenant_ns_name": "t4", "tenant_sub_if": "t4s1if", "tenant_sub_ip": "10.1.31.2/24"}], "vxlan": [{"dev": "t4s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.31.2", "remote_ip": "10.2.31.2", "remote_route": "10.2.31.0/24", "subnet_route": "10.1.31.0/24", "tenant_route_ip": "192.168.4.2", "v_name": "vxlan_t4s1"}]}, {"brif": "t4br1if1", "disk": "10G", "mem": 2, "name": "t4_VM1", "vcpu": 4, "vmif": "t4VM1if1"}], "warnings": ["'xml' is given - ignoring 'name'"]}
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.31.1/24', u'ns_name': u't4', u'ns_if': u't4if', u'if': u'p1'}], u'default_route_ip': u'10.1.31.1', u'bridge_name': u't4br1', u'dns': [{u'dnsif': u't4s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't4s1_dnsbrif'}], u'ns_name': u't4ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.31.2/24', u'tenant_ns_ip': u'10.1.31.1/24', u'tenant_ns_if': u't4ns1if', u'tenant_sub_if': u't4s1if', u'tenant_ns_name': u't4'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.1.31.2', u'dsport': 4789, u'dev': u't4s1if', u'tenant_route_ip': u'192.168.4.2', u'remote_route': u'10.2.31.0/24', u'subnet_route': u'10.1.31.0/24', u'v_name': u'vxlan_t4s1', u'id': 42, u'remote_ip': u'10.2.31.2'}]}, {u'mem': 4, u'name': u't4_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't4br1if2', u'vmif': u't4VM2if1'}]) => {"ansible_loop_var": "item", "changed": true, "created": "t4_VM2", "item": [{"bridge_name": "t4br1", "default_route_ip": "10.1.31.1", "dns": [{"brif": "t4s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.5", "dnsif": "t4s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t4ns1", "route": [{"if": "p1", "ip": "10.1.31.1/24", "ns_if": "t4if", "ns_name": "t4"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t4ns1if", "tenant_ns_ip": "10.1.31.1/24", "tenant_ns_name": "t4", "tenant_sub_if": "t4s1if", "tenant_sub_ip": "10.1.31.2/24"}], "vxlan": [{"dev": "t4s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.31.2", "remote_ip": "10.2.31.2", "remote_route": "10.2.31.0/24", "subnet_route": "10.1.31.0/24", "tenant_route_ip": "192.168.4.2", "v_name": "vxlan_t4s1"}]}, {"brif": "t4br1if2", "disk": "10G", "mem": 4, "name": "t4_VM2", "vcpu": 2, "vmif": "t4VM2if1"}], "warnings": ["'xml' is given - ignoring 'name'"]}

TASK [Create VM] ********************************************************************************************************************************************
ok: [localhost] => (item=[{u'route': [{u'ip': u'10.1.31.1/24', u'ns_name': u't4', u'ns_if': u't4if', u'if': u'p1'}], u'default_route_ip': u'10.1.31.1', u'bridge_name': u't4br1', u'dns': [{u'dnsif': u't4s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't4s1_dnsbrif'}], u'ns_name': u't4ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.31.2/24', u'tenant_ns_ip': u'10.1.31.1/24', u'tenant_ns_if': u't4ns1if', u'tenant_sub_if': u't4s1if', u'tenant_ns_name': u't4'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.1.31.2', u'dsport': 4789, u'dev': u't4s1if', u'tenant_route_ip': u'192.168.4.2', u'remote_route': u'10.2.31.0/24', u'subnet_route': u'10.1.31.0/24', u'v_name': u'vxlan_t4s1', u'id': 42, u'remote_ip': u'10.2.31.2'}]}, {u'mem': 2, u'name': u't4_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't4br1if1', u'vmif': u't4VM1if1'}]) => {"ansible_loop_var": "item", "changed": false, "create": 0, "item": [{"bridge_name": "t4br1", "default_route_ip": "10.1.31.1", "dns": [{"brif": "t4s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.5", "dnsif": "t4s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t4ns1", "route": [{"if": "p1", "ip": "10.1.31.1/24", "ns_if": "t4if", "ns_name": "t4"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t4ns1if", "tenant_ns_ip": "10.1.31.1/24", "tenant_ns_name": "t4", "tenant_sub_if": "t4s1if", "tenant_sub_ip": "10.1.31.2/24"}], "vxlan": [{"dev": "t4s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.31.2", "remote_ip": "10.2.31.2", "remote_route": "10.2.31.0/24", "subnet_route": "10.1.31.0/24", "tenant_route_ip": "192.168.4.2", "v_name": "vxlan_t4s1"}]}, {"brif": "t4br1if1", "disk": "10G", "mem": 2, "name": "t4_VM1", "vcpu": 4, "vmif": "t4VM1if1"}]}
ok: [localhost] => (item=[{u'route': [{u'ip': u'10.1.31.1/24', u'ns_name': u't4', u'ns_if': u't4if', u'if': u'p1'}], u'default_route_ip': u'10.1.31.1', u'bridge_name': u't4br1', u'dns': [{u'dnsif': u't4s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't4s1_dnsbrif'}], u'ns_name': u't4ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.31.2/24', u'tenant_ns_ip': u'10.1.31.1/24', u'tenant_ns_if': u't4ns1if', u'tenant_sub_if': u't4s1if', u'tenant_ns_name': u't4'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.1.31.2', u'dsport': 4789, u'dev': u't4s1if', u'tenant_route_ip': u'192.168.4.2', u'remote_route': u'10.2.31.0/24', u'subnet_route': u'10.1.31.0/24', u'v_name': u'vxlan_t4s1', u'id': 42, u'remote_ip': u'10.2.31.2'}]}, {u'mem': 4, u'name': u't4_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't4br1if2', u'vmif': u't4VM2if1'}]) => {"ansible_loop_var": "item", "changed": false, "create": 0, "item": [{"bridge_name": "t4br1", "default_route_ip": "10.1.31.1", "dns": [{"brif": "t4s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.5", "dnsif": "t4s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t4ns1", "route": [{"if": "p1", "ip": "10.1.31.1/24", "ns_if": "t4if", "ns_name": "t4"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t4ns1if", "tenant_ns_ip": "10.1.31.1/24", "tenant_ns_name": "t4", "tenant_sub_if": "t4s1if", "tenant_sub_ip": "10.1.31.2/24"}], "vxlan": [{"dev": "t4s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.31.2", "remote_ip": "10.2.31.2", "remote_route": "10.2.31.0/24", "subnet_route": "10.1.31.0/24", "tenant_route_ip": "192.168.4.2", "v_name": "vxlan_t4s1"}]}, {"brif": "t4br1if2", "disk": "10G", "mem": 4, "name": "t4_VM2", "vcpu": 2, "vmif": "t4VM2if1"}]}

TASK [Start VM] *********************************************************************************************************************************************
ok: [localhost] => (item=[{u'route': [{u'ip': u'10.1.31.1/24', u'ns_name': u't4', u'ns_if': u't4if', u'if': u'p1'}], u'default_route_ip': u'10.1.31.1', u'bridge_name': u't4br1', u'dns': [{u'dnsif': u't4s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't4s1_dnsbrif'}], u'ns_name': u't4ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.31.2/24', u'tenant_ns_ip': u'10.1.31.1/24', u'tenant_ns_if': u't4ns1if', u'tenant_sub_if': u't4s1if', u'tenant_ns_name': u't4'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.1.31.2', u'dsport': 4789, u'dev': u't4s1if', u'tenant_route_ip': u'192.168.4.2', u'remote_route': u'10.2.31.0/24', u'subnet_route': u'10.1.31.0/24', u'v_name': u'vxlan_t4s1', u'id': 42, u'remote_ip': u'10.2.31.2'}]}, {u'mem': 2, u'name': u't4_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't4br1if1', u'vmif': u't4VM1if1'}]) => {"ansible_loop_var": "item", "changed": false, "item": [{"bridge_name": "t4br1", "default_route_ip": "10.1.31.1", "dns": [{"brif": "t4s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.5", "dnsif": "t4s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t4ns1", "route": [{"if": "p1", "ip": "10.1.31.1/24", "ns_if": "t4if", "ns_name": "t4"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t4ns1if", "tenant_ns_ip": "10.1.31.1/24", "tenant_ns_name": "t4", "tenant_sub_if": "t4s1if", "tenant_sub_ip": "10.1.31.2/24"}], "vxlan": [{"dev": "t4s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.31.2", "remote_ip": "10.2.31.2", "remote_route": "10.2.31.0/24", "subnet_route": "10.1.31.0/24", "tenant_route_ip": "192.168.4.2", "v_name": "vxlan_t4s1"}]}, {"brif": "t4br1if1", "disk": "10G", "mem": 2, "name": "t4_VM1", "vcpu": 4, "vmif": "t4VM1if1"}]}
ok: [localhost] => (item=[{u'route': [{u'ip': u'10.1.31.1/24', u'ns_name': u't4', u'ns_if': u't4if', u'if': u'p1'}], u'default_route_ip': u'10.1.31.1', u'bridge_name': u't4br1', u'dns': [{u'dnsif': u't4s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't4s1_dnsbrif'}], u'ns_name': u't4ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.31.2/24', u'tenant_ns_ip': u'10.1.31.1/24', u'tenant_ns_if': u't4ns1if', u'tenant_sub_if': u't4s1if', u'tenant_ns_name': u't4'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.1.31.2', u'dsport': 4789, u'dev': u't4s1if', u'tenant_route_ip': u'192.168.4.2', u'remote_route': u'10.2.31.0/24', u'subnet_route': u'10.1.31.0/24', u'v_name': u'vxlan_t4s1', u'id': 42, u'remote_ip': u'10.2.31.2'}]}, {u'mem': 4, u'name': u't4_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't4br1if2', u'vmif': u't4VM2if1'}]) => {"ansible_loop_var": "item", "changed": false, "item": [{"bridge_name": "t4br1", "default_route_ip": "10.1.31.1", "dns": [{"brif": "t4s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.5", "dnsif": "t4s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t4ns1", "route": [{"if": "p1", "ip": "10.1.31.1/24", "ns_if": "t4if", "ns_name": "t4"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t4ns1if", "tenant_ns_ip": "10.1.31.1/24", "tenant_ns_name": "t4", "tenant_sub_if": "t4s1if", "tenant_sub_ip": "10.1.31.2/24"}], "vxlan": [{"dev": "t4s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.31.2", "remote_ip": "10.2.31.2", "remote_route": "10.2.31.0/24", "subnet_route": "10.1.31.0/24", "tenant_route_ip": "192.168.4.2", "v_name": "vxlan_t4s1"}]}, {"brif": "t4br1if2", "disk": "10G", "mem": 4, "name": "t4_VM2", "vcpu": 2, "vmif": "t4VM2if1"}]}

TASK [Attach VM interface] **********************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.31.1/24', u'ns_name': u't4', u'ns_if': u't4if', u'if': u'p1'}], u'default_route_ip': u'10.1.31.1', u'bridge_name': u't4br1', u'dns': [{u'dnsif': u't4s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't4s1_dnsbrif'}], u'ns_name': u't4ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.31.2/24', u'tenant_ns_ip': u'10.1.31.1/24', u'tenant_ns_if': u't4ns1if', u'tenant_sub_if': u't4s1if', u'tenant_ns_name': u't4'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.1.31.2', u'dsport': 4789, u'dev': u't4s1if', u'tenant_route_ip': u'192.168.4.2', u'remote_route': u'10.2.31.0/24', u'subnet_route': u'10.1.31.0/24', u'v_name': u'vxlan_t4s1', u'id': 42, u'remote_ip': u'10.2.31.2'}]}, {u'mem': 2, u'name': u't4_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't4br1if1', u'vmif': u't4VM1if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "virsh domiflist \"t4_VM1\" | grep -w 't4VM1if1' ; if [ $? -ne 0 ] ; then virsh attach-interface \"t4_VM1\" direct \"t4VM1if1\" --live --persistent ; fi\n", "delta": "0:00:08.404489", "end": "2019-12-05 18:22:40.581117", "item": [{"bridge_name": "t4br1", "default_route_ip": "10.1.31.1", "dns": [{"brif": "t4s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.5", "dnsif": "t4s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t4ns1", "route": [{"if": "p1", "ip": "10.1.31.1/24", "ns_if": "t4if", "ns_name": "t4"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t4ns1if", "tenant_ns_ip": "10.1.31.1/24", "tenant_ns_name": "t4", "tenant_sub_if": "t4s1if", "tenant_sub_ip": "10.1.31.2/24"}], "vxlan": [{"dev": "t4s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.31.2", "remote_ip": "10.2.31.2", "remote_route": "10.2.31.0/24", "subnet_route": "10.1.31.0/24", "tenant_route_ip": "192.168.4.2", "v_name": "vxlan_t4s1"}]}, {"brif": "t4br1if1", "disk": "10G", "mem": 2, "name": "t4_VM1", "vcpu": 4, "vmif": "t4VM1if1"}], "rc": 0, "start": "2019-12-05 18:22:32.176628", "stderr": "", "stderr_lines": [], "stdout": "Interface attached successfully", "stdout_lines": ["Interface attached successfully"]}
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.31.1/24', u'ns_name': u't4', u'ns_if': u't4if', u'if': u'p1'}], u'default_route_ip': u'10.1.31.1', u'bridge_name': u't4br1', u'dns': [{u'dnsif': u't4s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't4s1_dnsbrif'}], u'ns_name': u't4ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.31.2/24', u'tenant_ns_ip': u'10.1.31.1/24', u'tenant_ns_if': u't4ns1if', u'tenant_sub_if': u't4s1if', u'tenant_ns_name': u't4'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.1.31.2', u'dsport': 4789, u'dev': u't4s1if', u'tenant_route_ip': u'192.168.4.2', u'remote_route': u'10.2.31.0/24', u'subnet_route': u'10.1.31.0/24', u'v_name': u'vxlan_t4s1', u'id': 42, u'remote_ip': u'10.2.31.2'}]}, {u'mem': 4, u'name': u't4_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't4br1if2', u'vmif': u't4VM2if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "virsh domiflist \"t4_VM2\" | grep -w 't4VM2if1' ; if [ $? -ne 0 ] ; then virsh attach-interface \"t4_VM2\" direct \"t4VM2if1\" --live --persistent ; fi\n", "delta": "0:00:00.232971", "end": "2019-12-05 18:22:41.035798", "item": [{"bridge_name": "t4br1", "default_route_ip": "10.1.31.1", "dns": [{"brif": "t4s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.5", "dnsif": "t4s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t4ns1", "route": [{"if": "p1", "ip": "10.1.31.1/24", "ns_if": "t4if", "ns_name": "t4"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t4ns1if", "tenant_ns_ip": "10.1.31.1/24", "tenant_ns_name": "t4", "tenant_sub_if": "t4s1if", "tenant_sub_ip": "10.1.31.2/24"}], "vxlan": [{"dev": "t4s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.31.2", "remote_ip": "10.2.31.2", "remote_route": "10.2.31.0/24", "subnet_route": "10.1.31.0/24", "tenant_route_ip": "192.168.4.2", "v_name": "vxlan_t4s1"}]}, {"brif": "t4br1if2", "disk": "10G", "mem": 4, "name": "t4_VM2", "vcpu": 2, "vmif": "t4VM2if1"}], "rc": 0, "start": "2019-12-05 18:22:40.802827", "stderr": "", "stderr_lines": [], "stdout": "Interface attached successfully", "stdout_lines": ["Interface attached successfully"]}

PLAY RECAP **************************************************************************************************************************************************
localhost                  : ok=6    changed=3    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0   

Using /etc/ansible/ansible.cfg as config file

PLAY [worker] ***********************************************************************************************************************************************

TASK [Copy VM image] ****************************************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.31.1/24', u'ns_name': u't4', u'ns_if': u't4if', u'if': u'p1'}], u'default_route_ip': u'10.2.31.1', u'bridge_name': u't4br1', u'dns': [{u'dnsif': u't4s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't4s1_dnsbrif'}], u'ns_name': u't4ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.31.2/24', u'tenant_ns_ip': u'10.2.31.1/24', u'tenant_ns_if': u't4ns1if', u'tenant_sub_if': u't4s1if', u'tenant_ns_name': u't4'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.2.31.2', u'dsport': 4789, u'dev': u't4s1if', u'tenant_route_ip': u'192.168.132.2', u'remote_route': u'10.1.31.0/24', u'subnet_route': u'10.2.31.0/24', u'v_name': u'vxlan_t4s1', u'id': 42, u'remote_ip': u'10.1.31.2'}]}, {u'mem': 2, u'name': u't4_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't4br1if1', u'vmif': u't4VM4if1'}]) => {"ansible_loop_var": "item", "changed": true, "checksum": "f8b2ffa2bf201c84196c582f2dec0d33a1eb4b42", "dest": "/var/lib/libvirt/images/t4_VM4.qcow2", "gid": 0, "group": "root", "item": [{"bridge_name": "t4br1", "default_route_ip": "10.2.31.1", "dns": [{"brif": "t4s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.5", "dnsif": "t4s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t4ns1", "route": [{"if": "p1", "ip": "10.2.31.1/24", "ns_if": "t4if", "ns_name": "t4"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t4ns1if", "tenant_ns_ip": "10.2.31.1/24", "tenant_ns_name": "t4", "tenant_sub_if": "t4s1if", "tenant_sub_ip": "10.2.31.2/24"}], "vxlan": [{"dev": "t4s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.31.2", "remote_ip": "10.1.31.2", "remote_route": "10.1.31.0/24", "subnet_route": "10.2.31.0/24", "tenant_route_ip": "192.168.132.2", "v_name": "vxlan_t4s1"}]}, {"brif": "t4br1if1", "disk": "10G", "mem": 2, "name": "t4_VM4", "vcpu": 4, "vmif": "t4VM4if1"}], "md5sum": "e6d5d524b68797ddd748ba1475985d34", "mode": "0644", "owner": "root", "size": 10739318784, "src": "/root/mainVM.qcow2", "state": "file", "uid": 0}
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.32.1/24', u'ns_name': u't4', u'ns_if': u't4if', u'if': u'p1'}], u'default_route_ip': u'10.2.32.1', u'bridge_name': u't4br2', u'dns': [{u'dnsif': u't4s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't4s2_dnsbrif'}], u'ns_name': u't4ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.32.2/24', u'tenant_ns_ip': u'10.2.32.1/24', u'tenant_ns_if': u't4ns2if', u'tenant_sub_if': u't4s2if', u'tenant_ns_name': u't4'}], u'subnet_ip': u'2.2.2.0/24', u'vxlan': [{u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}, {u'mem': 3, u'name': u't4_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't4br2if1', u'vmif': u't4VM3if1'}]) => {"ansible_loop_var": "item", "changed": true, "checksum": "f8b2ffa2bf201c84196c582f2dec0d33a1eb4b42", "dest": "/var/lib/libvirt/images/t4_VM3.qcow2", "gid": 0, "group": "root", "item": [{"bridge_name": "t4br2", "default_route_ip": "10.2.32.1", "dns": [{"brif": "t4s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t4s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t4ns2", "route": [{"if": "p1", "ip": "10.2.32.1/24", "ns_if": "t4if", "ns_name": "t4"}], "subnet_ip": "2.2.2.0/24", "tenant_ns": [{"tenant_ns_if": "t4ns2if", "tenant_ns_ip": "10.2.32.1/24", "tenant_ns_name": "t4", "tenant_sub_if": "t4s2if", "tenant_sub_ip": "10.2.32.2/24"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, {"brif": "t4br2if1", "disk": "10G", "mem": 3, "name": "t4_VM3", "vcpu": 2, "vmif": "t4VM3if1"}], "md5sum": "e6d5d524b68797ddd748ba1475985d34", "mode": "0644", "owner": "root", "size": 10739318784, "src": "/root/mainVM.qcow2", "state": "file", "uid": 0}

TASK [Get list of running VMs] ******************************************************************************************************************************
ok: [99.99.99.2] => {"changed": false, "cmd": ["virsh", "list", "--name"], "delta": "0:00:00.021341", "end": "2019-12-05 18:25:42.144702", "rc": 0, "start": "2019-12-05 18:25:42.123361", "stderr": "", "stderr_lines": [], "stdout": "t3_VM2", "stdout_lines": ["t3_VM2"]}

TASK [Define VM] ********************************************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.31.1/24', u'ns_name': u't4', u'ns_if': u't4if', u'if': u'p1'}], u'default_route_ip': u'10.2.31.1', u'bridge_name': u't4br1', u'dns': [{u'dnsif': u't4s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't4s1_dnsbrif'}], u'ns_name': u't4ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.31.2/24', u'tenant_ns_ip': u'10.2.31.1/24', u'tenant_ns_if': u't4ns1if', u'tenant_sub_if': u't4s1if', u'tenant_ns_name': u't4'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.2.31.2', u'dsport': 4789, u'dev': u't4s1if', u'tenant_route_ip': u'192.168.132.2', u'remote_route': u'10.1.31.0/24', u'subnet_route': u'10.2.31.0/24', u'v_name': u'vxlan_t4s1', u'id': 42, u'remote_ip': u'10.1.31.2'}]}, {u'mem': 2, u'name': u't4_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't4br1if1', u'vmif': u't4VM4if1'}]) => {"ansible_loop_var": "item", "changed": true, "created": "t4_VM4", "item": [{"bridge_name": "t4br1", "default_route_ip": "10.2.31.1", "dns": [{"brif": "t4s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.5", "dnsif": "t4s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t4ns1", "route": [{"if": "p1", "ip": "10.2.31.1/24", "ns_if": "t4if", "ns_name": "t4"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t4ns1if", "tenant_ns_ip": "10.2.31.1/24", "tenant_ns_name": "t4", "tenant_sub_if": "t4s1if", "tenant_sub_ip": "10.2.31.2/24"}], "vxlan": [{"dev": "t4s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.31.2", "remote_ip": "10.1.31.2", "remote_route": "10.1.31.0/24", "subnet_route": "10.2.31.0/24", "tenant_route_ip": "192.168.132.2", "v_name": "vxlan_t4s1"}]}, {"brif": "t4br1if1", "disk": "10G", "mem": 2, "name": "t4_VM4", "vcpu": 4, "vmif": "t4VM4if1"}], "warnings": ["'xml' is given - ignoring 'name'"]}
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.32.1/24', u'ns_name': u't4', u'ns_if': u't4if', u'if': u'p1'}], u'default_route_ip': u'10.2.32.1', u'bridge_name': u't4br2', u'dns': [{u'dnsif': u't4s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't4s2_dnsbrif'}], u'ns_name': u't4ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.32.2/24', u'tenant_ns_ip': u'10.2.32.1/24', u'tenant_ns_if': u't4ns2if', u'tenant_sub_if': u't4s2if', u'tenant_ns_name': u't4'}], u'subnet_ip': u'2.2.2.0/24', u'vxlan': [{u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}, {u'mem': 3, u'name': u't4_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't4br2if1', u'vmif': u't4VM3if1'}]) => {"ansible_loop_var": "item", "changed": true, "created": "t4_VM3", "item": [{"bridge_name": "t4br2", "default_route_ip": "10.2.32.1", "dns": [{"brif": "t4s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t4s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t4ns2", "route": [{"if": "p1", "ip": "10.2.32.1/24", "ns_if": "t4if", "ns_name": "t4"}], "subnet_ip": "2.2.2.0/24", "tenant_ns": [{"tenant_ns_if": "t4ns2if", "tenant_ns_ip": "10.2.32.1/24", "tenant_ns_name": "t4", "tenant_sub_if": "t4s2if", "tenant_sub_ip": "10.2.32.2/24"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, {"brif": "t4br2if1", "disk": "10G", "mem": 3, "name": "t4_VM3", "vcpu": 2, "vmif": "t4VM3if1"}], "warnings": ["'xml' is given - ignoring 'name'"]}

TASK [Create VM] ********************************************************************************************************************************************
ok: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.31.1/24', u'ns_name': u't4', u'ns_if': u't4if', u'if': u'p1'}], u'default_route_ip': u'10.2.31.1', u'bridge_name': u't4br1', u'dns': [{u'dnsif': u't4s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't4s1_dnsbrif'}], u'ns_name': u't4ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.31.2/24', u'tenant_ns_ip': u'10.2.31.1/24', u'tenant_ns_if': u't4ns1if', u'tenant_sub_if': u't4s1if', u'tenant_ns_name': u't4'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.2.31.2', u'dsport': 4789, u'dev': u't4s1if', u'tenant_route_ip': u'192.168.132.2', u'remote_route': u'10.1.31.0/24', u'subnet_route': u'10.2.31.0/24', u'v_name': u'vxlan_t4s1', u'id': 42, u'remote_ip': u'10.1.31.2'}]}, {u'mem': 2, u'name': u't4_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't4br1if1', u'vmif': u't4VM4if1'}]) => {"ansible_loop_var": "item", "changed": false, "create": 0, "item": [{"bridge_name": "t4br1", "default_route_ip": "10.2.31.1", "dns": [{"brif": "t4s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.5", "dnsif": "t4s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t4ns1", "route": [{"if": "p1", "ip": "10.2.31.1/24", "ns_if": "t4if", "ns_name": "t4"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t4ns1if", "tenant_ns_ip": "10.2.31.1/24", "tenant_ns_name": "t4", "tenant_sub_if": "t4s1if", "tenant_sub_ip": "10.2.31.2/24"}], "vxlan": [{"dev": "t4s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.31.2", "remote_ip": "10.1.31.2", "remote_route": "10.1.31.0/24", "subnet_route": "10.2.31.0/24", "tenant_route_ip": "192.168.132.2", "v_name": "vxlan_t4s1"}]}, {"brif": "t4br1if1", "disk": "10G", "mem": 2, "name": "t4_VM4", "vcpu": 4, "vmif": "t4VM4if1"}]}
ok: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.32.1/24', u'ns_name': u't4', u'ns_if': u't4if', u'if': u'p1'}], u'default_route_ip': u'10.2.32.1', u'bridge_name': u't4br2', u'dns': [{u'dnsif': u't4s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't4s2_dnsbrif'}], u'ns_name': u't4ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.32.2/24', u'tenant_ns_ip': u'10.2.32.1/24', u'tenant_ns_if': u't4ns2if', u'tenant_sub_if': u't4s2if', u'tenant_ns_name': u't4'}], u'subnet_ip': u'2.2.2.0/24', u'vxlan': [{u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}, {u'mem': 3, u'name': u't4_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't4br2if1', u'vmif': u't4VM3if1'}]) => {"ansible_loop_var": "item", "changed": false, "create": 0, "item": [{"bridge_name": "t4br2", "default_route_ip": "10.2.32.1", "dns": [{"brif": "t4s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t4s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t4ns2", "route": [{"if": "p1", "ip": "10.2.32.1/24", "ns_if": "t4if", "ns_name": "t4"}], "subnet_ip": "2.2.2.0/24", "tenant_ns": [{"tenant_ns_if": "t4ns2if", "tenant_ns_ip": "10.2.32.1/24", "tenant_ns_name": "t4", "tenant_sub_if": "t4s2if", "tenant_sub_ip": "10.2.32.2/24"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, {"brif": "t4br2if1", "disk": "10G", "mem": 3, "name": "t4_VM3", "vcpu": 2, "vmif": "t4VM3if1"}]}

TASK [Start VM] *********************************************************************************************************************************************
ok: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.31.1/24', u'ns_name': u't4', u'ns_if': u't4if', u'if': u'p1'}], u'default_route_ip': u'10.2.31.1', u'bridge_name': u't4br1', u'dns': [{u'dnsif': u't4s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't4s1_dnsbrif'}], u'ns_name': u't4ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.31.2/24', u'tenant_ns_ip': u'10.2.31.1/24', u'tenant_ns_if': u't4ns1if', u'tenant_sub_if': u't4s1if', u'tenant_ns_name': u't4'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.2.31.2', u'dsport': 4789, u'dev': u't4s1if', u'tenant_route_ip': u'192.168.132.2', u'remote_route': u'10.1.31.0/24', u'subnet_route': u'10.2.31.0/24', u'v_name': u'vxlan_t4s1', u'id': 42, u'remote_ip': u'10.1.31.2'}]}, {u'mem': 2, u'name': u't4_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't4br1if1', u'vmif': u't4VM4if1'}]) => {"ansible_loop_var": "item", "changed": false, "item": [{"bridge_name": "t4br1", "default_route_ip": "10.2.31.1", "dns": [{"brif": "t4s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.5", "dnsif": "t4s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t4ns1", "route": [{"if": "p1", "ip": "10.2.31.1/24", "ns_if": "t4if", "ns_name": "t4"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t4ns1if", "tenant_ns_ip": "10.2.31.1/24", "tenant_ns_name": "t4", "tenant_sub_if": "t4s1if", "tenant_sub_ip": "10.2.31.2/24"}], "vxlan": [{"dev": "t4s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.31.2", "remote_ip": "10.1.31.2", "remote_route": "10.1.31.0/24", "subnet_route": "10.2.31.0/24", "tenant_route_ip": "192.168.132.2", "v_name": "vxlan_t4s1"}]}, {"brif": "t4br1if1", "disk": "10G", "mem": 2, "name": "t4_VM4", "vcpu": 4, "vmif": "t4VM4if1"}]}
ok: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.32.1/24', u'ns_name': u't4', u'ns_if': u't4if', u'if': u'p1'}], u'default_route_ip': u'10.2.32.1', u'bridge_name': u't4br2', u'dns': [{u'dnsif': u't4s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't4s2_dnsbrif'}], u'ns_name': u't4ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.32.2/24', u'tenant_ns_ip': u'10.2.32.1/24', u'tenant_ns_if': u't4ns2if', u'tenant_sub_if': u't4s2if', u'tenant_ns_name': u't4'}], u'subnet_ip': u'2.2.2.0/24', u'vxlan': [{u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}, {u'mem': 3, u'name': u't4_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't4br2if1', u'vmif': u't4VM3if1'}]) => {"ansible_loop_var": "item", "changed": false, "item": [{"bridge_name": "t4br2", "default_route_ip": "10.2.32.1", "dns": [{"brif": "t4s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t4s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t4ns2", "route": [{"if": "p1", "ip": "10.2.32.1/24", "ns_if": "t4if", "ns_name": "t4"}], "subnet_ip": "2.2.2.0/24", "tenant_ns": [{"tenant_ns_if": "t4ns2if", "tenant_ns_ip": "10.2.32.1/24", "tenant_ns_name": "t4", "tenant_sub_if": "t4s2if", "tenant_sub_ip": "10.2.32.2/24"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, {"brif": "t4br2if1", "disk": "10G", "mem": 3, "name": "t4_VM3", "vcpu": 2, "vmif": "t4VM3if1"}]}

TASK [Attach VM interface] **********************************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.31.1/24', u'ns_name': u't4', u'ns_if': u't4if', u'if': u'p1'}], u'default_route_ip': u'10.2.31.1', u'bridge_name': u't4br1', u'dns': [{u'dnsif': u't4s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't4s1_dnsbrif'}], u'ns_name': u't4ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.31.2/24', u'tenant_ns_ip': u'10.2.31.1/24', u'tenant_ns_if': u't4ns1if', u'tenant_sub_if': u't4s1if', u'tenant_ns_name': u't4'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.2.31.2', u'dsport': 4789, u'dev': u't4s1if', u'tenant_route_ip': u'192.168.132.2', u'remote_route': u'10.1.31.0/24', u'subnet_route': u'10.2.31.0/24', u'v_name': u'vxlan_t4s1', u'id': 42, u'remote_ip': u'10.1.31.2'}]}, {u'mem': 2, u'name': u't4_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't4br1if1', u'vmif': u't4VM4if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "virsh domiflist \"t4_VM4\" | grep -w 't4VM4if1' ; if [ $? -ne 0 ] ; then virsh attach-interface \"t4_VM4\" direct \"t4VM4if1\" --live --persistent ; fi\n", "delta": "0:00:00.260630", "end": "2019-12-05 18:26:17.739989", "item": [{"bridge_name": "t4br1", "default_route_ip": "10.2.31.1", "dns": [{"brif": "t4s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.5", "dnsif": "t4s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t4ns1", "route": [{"if": "p1", "ip": "10.2.31.1/24", "ns_if": "t4if", "ns_name": "t4"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t4ns1if", "tenant_ns_ip": "10.2.31.1/24", "tenant_ns_name": "t4", "tenant_sub_if": "t4s1if", "tenant_sub_ip": "10.2.31.2/24"}], "vxlan": [{"dev": "t4s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.31.2", "remote_ip": "10.1.31.2", "remote_route": "10.1.31.0/24", "subnet_route": "10.2.31.0/24", "tenant_route_ip": "192.168.132.2", "v_name": "vxlan_t4s1"}]}, {"brif": "t4br1if1", "disk": "10G", "mem": 2, "name": "t4_VM4", "vcpu": 4, "vmif": "t4VM4if1"}], "rc": 0, "start": "2019-12-05 18:26:17.479359", "stderr": "", "stderr_lines": [], "stdout": "Interface attached successfully", "stdout_lines": ["Interface attached successfully"]}
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.32.1/24', u'ns_name': u't4', u'ns_if': u't4if', u'if': u'p1'}], u'default_route_ip': u'10.2.32.1', u'bridge_name': u't4br2', u'dns': [{u'dnsif': u't4s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't4s2_dnsbrif'}], u'ns_name': u't4ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.32.2/24', u'tenant_ns_ip': u'10.2.32.1/24', u'tenant_ns_if': u't4ns2if', u'tenant_sub_if': u't4s2if', u'tenant_ns_name': u't4'}], u'subnet_ip': u'2.2.2.0/24', u'vxlan': [{u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}, {u'mem': 3, u'name': u't4_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't4br2if1', u'vmif': u't4VM3if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "virsh domiflist \"t4_VM3\" | grep -w 't4VM3if1' ; if [ $? -ne 0 ] ; then virsh attach-interface \"t4_VM3\" direct \"t4VM3if1\" --live --persistent ; fi\n", "delta": "0:00:00.273898", "end": "2019-12-05 18:26:18.286647", "item": [{"bridge_name": "t4br2", "default_route_ip": "10.2.32.1", "dns": [{"brif": "t4s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t4s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t4ns2", "route": [{"if": "p1", "ip": "10.2.32.1/24", "ns_if": "t4if", "ns_name": "t4"}], "subnet_ip": "2.2.2.0/24", "tenant_ns": [{"tenant_ns_if": "t4ns2if", "tenant_ns_ip": "10.2.32.1/24", "tenant_ns_name": "t4", "tenant_sub_if": "t4s2if", "tenant_sub_ip": "10.2.32.2/24"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, {"brif": "t4br2if1", "disk": "10G", "mem": 3, "name": "t4_VM3", "vcpu": 2, "vmif": "t4VM3if1"}], "rc": 0, "start": "2019-12-05 18:26:18.012749", "stderr": "", "stderr_lines": [], "stdout": "Interface attached successfully", "stdout_lines": ["Interface attached successfully"]}

PLAY RECAP **************************************************************************************************************************************************
99.99.99.2                 : ok=6    changed=3    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0   

INFO:root: 18:31:58.994550 The subnet 1.1.1.0/24 is present in Cloud 1
INFO:root: 18:31:58.994884 The subnet 1.1.1.0/24 is present in Cloud 2
INFO:root: 18:31:58.994975 The subnet 2.2.2.0/24 is present in Cloud 2
INFO:root: 18:31:58.995039 The VM VM2 is present in Cloud 1
INFO:root: 18:31:58.995105 The VM VM4 is present in Cloud 2
INFO:root: 18:31:58.995164 The VM VM3 is present in Cloud 2
INFO:root: 18:31:58.995276 The subnet 1.1.1.0/24 is present in destination cloud
INFO:root: 18:31:58.995367 The subnet 1.1.1.0/24 is present in destination cloud
ERROR:root: 18:31:58.995454 The subnet 2.2.2.0/24 is not present in the destination cloud
INFO:root: 18:34:25.802362 The subnet 1.1.1.0/24 is present in Cloud 1
INFO:root: 18:34:25.802569 The subnet 1.1.1.0/24 is present in Cloud 2
INFO:root: 18:34:25.802614 The subnet 2.2.2.0/24 is present in Cloud 2
INFO:root: 18:34:25.802645 The VM VM2 is present in Cloud 1
INFO:root: 18:34:25.802673 The VM VM4 is present in Cloud 2
INFO:root: 18:34:25.802699 The VM VM3 is present in Cloud 2
INFO:root: 18:34:25.802758 The subnet 1.1.1.0/24 is present in destination cloud
INFO:root: 18:34:25.802797 The subnet 1.1.1.0/24 is present in destination cloud
ERROR:root: 18:34:25.803129 The subnet 2.2.2.0/24 is not present in the destination cloud
INFO:root: 18:34:26.110628 source cloud is C1
INFO:root: 18:34:26.112392 source cloud is C2
INFO:paramiko.transport:Connected (version 2.0, client OpenSSH_7.6p1)
INFO:paramiko.transport:Authentication (publickey) successful!
INFO:root: 18:34:27.103695 source cloud is C2
INFO:paramiko.transport:Connected (version 2.0, client OpenSSH_7.6p1)
INFO:paramiko.transport:Authentication (publickey) successful!
