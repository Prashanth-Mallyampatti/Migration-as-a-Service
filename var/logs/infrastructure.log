INFO:root: 06:36:51.373770 Printing the yaml input file
INFO:root: 06:36:51.373938 {'C1': [{'subnet_addr': '1.1.1.0/24', 'VM': [{'name': 'VM1', 'disk': '10G', 'mem': 2, 'vcpu': 4, 'internet_access': True}, {'name': 'VM2', 'disk': '10G', 'mem': 4, 'vcpu': 2, 'internet_access': False}]}, {'subnet_addr': '2.2.2.0/24', 'VM': [{'name': 'VM3', 'disk': '10G', 'mem': 3, 'vcpu': 2, 'internet_access': True}]}], 'C2': [{'subnet_addr': '1.1.1.0/24', 'VM': [{'name': 'VM4', 'disk': '10G', 'mem': 2, 'vcpu': 4, 'internet_access': True}]}]}
INFO:root: 06:36:51.374051 Provided subnet in C1: 1.1.1.0/24 is valid
INFO:root: 06:36:51.374100 Provided subnet in C1: 2.2.2.0/24 is valid
INFO:root: 06:36:51.374144 Provided subnet in C2: 1.1.1.0/24 is valid
Using /etc/ansible/ansible.cfg as config file

PLAY [main] *************************************************************************************************************************************************

TASK [Create Tenant Namespace] ******************************************************************************************************************************
changed: [localhost] => (item={u'default_route_ip': u'192.168.1.1', u'name': u't1', u'pns_ip': u'192.168.1.1/24', u'tenant_if': u't1if', u'tenant_ip': u'192.168.1.2/24', u'pns_if': u't1pns_if'}) => {"ansible_loop_var": "item", "changed": true, "cmd": ["ip", "netns", "add", "t1"], "delta": "0:00:00.056176", "end": "2019-11-22 06:36:52.946348", "item": {"default_route_ip": "192.168.1.1", "name": "t1", "pns_if": "t1pns_if", "pns_ip": "192.168.1.1/24", "tenant_if": "t1if", "tenant_ip": "192.168.1.2/24"}, "rc": 0, "start": "2019-11-22 06:36:52.890172", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Create Subnet Namespace] ******************************************************************************************************************************
changed: [localhost] => (item={u'route': [{u'ip': u'10.1.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.1.2/24', u'tenant_ns_ip': u'10.1.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_ns_name': u't1', u'tenant_sub_if': u't1s1if'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't1_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM1if1'}, {u'mem': 4, u'name': u't1_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br1if2', u'vmif': u't1VM2if1'}], u'vxlan': [{u'local_ip': u'10.1.1.2', u'tenant_route_ip': u'192.168.1.2', u'dsport': 4789, u'dev': u't1s1if', u'subnet_route': u'10.1.1.0/24', u'remote_route': u'10.2.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.2.1.2'}]}) => {"ansible_loop_var": "item", "changed": true, "cmd": ["ip", "netns", "add", "t1ns1"], "delta": "0:00:00.059896", "end": "2019-11-22 06:36:53.288135", "item": {"bridge_name": "t1br1", "default_route_ip": "10.1.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.1.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.1.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.1.1.2/24"}], "vms": [{"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM1", "vcpu": 4, "vmif": "t1VM1if1"}, {"brif": "t1br1if2", "disk": "10G", "mem": 4, "name": "t1_VM2", "vcpu": 2, "vmif": "t1VM2if1"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.1.2", "remote_ip": "10.2.1.2", "remote_route": "10.2.1.0/24", "subnet_route": "10.1.1.0/24", "tenant_route_ip": "192.168.1.2", "v_name": "vxlan_t1s1"}]}, "rc": 0, "start": "2019-11-22 06:36:53.228239", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}
changed: [localhost] => (item={u'route': [{u'ip': u'10.1.2.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.2.1', u'bridge_name': u't1br2', u'dns': [{u'dnsif': u't1s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s2_dnsbrif'}], u'ns_name': u't1ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.2.2/24', u'tenant_ns_ip': u'10.1.2.1/24', u'tenant_ns_if': u't1ns2if', u'tenant_ns_name': u't1', u'tenant_sub_if': u't1s2if'}], u'subnet_ip': u'2.2.2.0/24', u'vms': [{u'mem': 3, u'name': u't1_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br2if1', u'vmif': u't1VM3if1'}], u'vxlan': [{u'local_ip': [], u'tenant_route_ip': [], u'dsport': [], u'dev': [], u'subnet_route': [], u'remote_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}) => {"ansible_loop_var": "item", "changed": true, "cmd": ["ip", "netns", "add", "t1ns2"], "delta": "0:00:00.062284", "end": "2019-11-22 06:36:53.576028", "item": {"bridge_name": "t1br2", "default_route_ip": "10.1.2.1", "dns": [{"brif": "t1s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t1s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns2", "route": [{"if": "p1", "ip": "10.1.2.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "2.2.2.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns2if", "tenant_ns_ip": "10.1.2.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s2if", "tenant_sub_ip": "10.1.2.2/24"}], "vms": [{"brif": "t1br2if1", "disk": "10G", "mem": 3, "name": "t1_VM3", "vcpu": 2, "vmif": "t1VM3if1"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, "rc": 0, "start": "2019-11-22 06:36:53.513744", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Create Tenant VETH pairs] *****************************************************************************************************************************
changed: [localhost] => (item={u'default_route_ip': u'192.168.1.1', u'name': u't1', u'pns_ip': u'192.168.1.1/24', u'tenant_if': u't1if', u'tenant_ip': u'192.168.1.2/24', u'pns_if': u't1pns_if'}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip link show \"t1if\" ; if [ $? -ne 0 ] ; then ip link add \"t1if\" type veth peer name \"t1pns_if\" ; fi\n", "delta": "0:00:00.013421", "end": "2019-11-22 06:36:53.880209", "item": {"default_route_ip": "192.168.1.1", "name": "t1", "pns_if": "t1pns_if", "pns_ip": "192.168.1.1/24", "tenant_if": "t1if", "tenant_ip": "192.168.1.2/24"}, "rc": 0, "start": "2019-11-22 06:36:53.866788", "stderr": "Device \"t1if\" does not exist.", "stderr_lines": ["Device \"t1if\" does not exist."], "stdout": "", "stdout_lines": []}

TASK [Attach Tenant VETH Pairs] *****************************************************************************************************************************
changed: [localhost] => (item={u'default_route_ip': u'192.168.1.1', u'name': u't1', u'pns_ip': u'192.168.1.1/24', u'tenant_if': u't1if', u'tenant_ip': u'192.168.1.2/24', u'pns_if': u't1pns_if'}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec pns ip link show \"t1pns_if\" ; if [ $? -ne 0 ] ; then ip link set \"t1pns_if\" netns pns ; fi\nip netns exec \"t1\" ip link show \"t1if\" ; if [ $? -ne 0 ] ; then ip link set \"t1if\" netns \"t1\" ; fi\nip netns exec pns ip link set dev \"t1pns_if\" up\nip netns exec \"t1\" ip link set dev \"t1if\" up\n", "delta": "0:00:00.224003", "end": "2019-11-22 06:36:54.406433", "item": {"default_route_ip": "192.168.1.1", "name": "t1", "pns_if": "t1pns_if", "pns_ip": "192.168.1.1/24", "tenant_if": "t1if", "tenant_ip": "192.168.1.2/24"}, "rc": 0, "start": "2019-11-22 06:36:54.182430", "stderr": "Device \"t1pns_if\" does not exist.\nDevice \"t1if\" does not exist.", "stderr_lines": ["Device \"t1pns_if\" does not exist.", "Device \"t1if\" does not exist."], "stdout": "", "stdout_lines": []}

TASK [Add IP addresses to Tenant VETH Pairs] ****************************************************************************************************************
changed: [localhost] => (item={u'default_route_ip': u'192.168.1.1', u'name': u't1', u'pns_ip': u'192.168.1.1/24', u'tenant_if': u't1if', u'tenant_ip': u'192.168.1.2/24', u'pns_if': u't1pns_if'}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec pns ip addr show \"t1pns_if\" | awk 'FNR==3{ print $2 }' | grep -w '^192.168.1.1/24' ; if [ $? -ne 0 ] ; then ip netns exec pns ip addr add \"192.168.1.1/24\" dev \"t1pns_if\" ; fi\nip netns exec \"t1\" ip addr show \"t1if\" | awk 'FNR==3{ print $2 }' | grep -w '^192.168.1.2/24' ; if [ $? -ne 0 ] ; then ip netns exec \"t1\" ip addr add \"192.168.1.2/24\" dev \"t1if\" ; fi\n", "delta": "0:00:00.138689", "end": "2019-11-22 06:36:54.846361", "item": {"default_route_ip": "192.168.1.1", "name": "t1", "pns_if": "t1pns_if", "pns_ip": "192.168.1.1/24", "tenant_if": "t1if", "tenant_ip": "192.168.1.2/24"}, "rc": 0, "start": "2019-11-22 06:36:54.707672", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Create Namespace VETH Pairs] **************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't1_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM1if1'}, {u'mem': 4, u'name': u't1_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br1if2', u'vmif': u't1VM2if1'}], u'vxlan': [{u'local_ip': u'10.1.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.1.2', u'remote_route': u'10.2.1.0/24', u'subnet_route': u'10.1.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.2.1.2'}]}, {u'tenant_sub_ip': u'10.1.1.2/24', u'tenant_ns_ip': u'10.1.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip link show \"t1ns1if\" ; if [ $? -ne 0 ] ; then ip link add \"t1ns1if\" type veth peer name \"t1s1if\" ; fi\n", "delta": "0:00:00.009973", "end": "2019-11-22 06:36:55.151006", "item": [{"bridge_name": "t1br1", "default_route_ip": "10.1.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.1.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "vms": [{"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM1", "vcpu": 4, "vmif": "t1VM1if1"}, {"brif": "t1br1if2", "disk": "10G", "mem": 4, "name": "t1_VM2", "vcpu": 2, "vmif": "t1VM2if1"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.1.2", "remote_ip": "10.2.1.2", "remote_route": "10.2.1.0/24", "subnet_route": "10.1.1.0/24", "tenant_route_ip": "192.168.1.2", "v_name": "vxlan_t1s1"}]}, {"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.1.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.1.1.2/24"}], "rc": 0, "start": "2019-11-22 06:36:55.141033", "stderr": "Device \"t1ns1if\" does not exist.", "stderr_lines": ["Device \"t1ns1if\" does not exist."], "stdout": "", "stdout_lines": []}
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.2.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.2.1', u'bridge_name': u't1br2', u'dns': [{u'dnsif': u't1s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s2_dnsbrif'}], u'ns_name': u't1ns2', u'subnet_ip': u'2.2.2.0/24', u'vms': [{u'mem': 3, u'name': u't1_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br2if1', u'vmif': u't1VM3if1'}], u'vxlan': [{u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}, {u'tenant_sub_ip': u'10.1.2.2/24', u'tenant_ns_ip': u'10.1.2.1/24', u'tenant_ns_if': u't1ns2if', u'tenant_sub_if': u't1s2if', u'tenant_ns_name': u't1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip link show \"t1ns2if\" ; if [ $? -ne 0 ] ; then ip link add \"t1ns2if\" type veth peer name \"t1s2if\" ; fi\n", "delta": "0:00:00.008850", "end": "2019-11-22 06:36:55.350427", "item": [{"bridge_name": "t1br2", "default_route_ip": "10.1.2.1", "dns": [{"brif": "t1s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t1s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns2", "route": [{"if": "p1", "ip": "10.1.2.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "2.2.2.0/24", "vms": [{"brif": "t1br2if1", "disk": "10G", "mem": 3, "name": "t1_VM3", "vcpu": 2, "vmif": "t1VM3if1"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, {"tenant_ns_if": "t1ns2if", "tenant_ns_ip": "10.1.2.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s2if", "tenant_sub_ip": "10.1.2.2/24"}], "rc": 0, "start": "2019-11-22 06:36:55.341577", "stderr": "Device \"t1ns2if\" does not exist.", "stderr_lines": ["Device \"t1ns2if\" does not exist."], "stdout": "", "stdout_lines": []}

TASK [Attach Namespace VETH Pairs] **************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't1_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM1if1'}, {u'mem': 4, u'name': u't1_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br1if2', u'vmif': u't1VM2if1'}], u'vxlan': [{u'local_ip': u'10.1.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.1.2', u'remote_route': u'10.2.1.0/24', u'subnet_route': u'10.1.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.2.1.2'}]}, {u'tenant_sub_ip': u'10.1.1.2/24', u'tenant_ns_ip': u'10.1.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t1\" ip link show \"t1ns1if\" ; if [ $? -ne 0 ] ; then ip link set \"t1ns1if\" netns \"t1\" ; fi\nip netns exec \"t1ns1\" ip link show \"t1s1if\" ; if [ $? -ne 0 ] ; then ip link set \"t1s1if\" netns \"t1ns1\" ; fi\n", "delta": "0:00:00.104696", "end": "2019-11-22 06:36:55.716326", "item": [{"bridge_name": "t1br1", "default_route_ip": "10.1.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.1.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "vms": [{"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM1", "vcpu": 4, "vmif": "t1VM1if1"}, {"brif": "t1br1if2", "disk": "10G", "mem": 4, "name": "t1_VM2", "vcpu": 2, "vmif": "t1VM2if1"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.1.2", "remote_ip": "10.2.1.2", "remote_route": "10.2.1.0/24", "subnet_route": "10.1.1.0/24", "tenant_route_ip": "192.168.1.2", "v_name": "vxlan_t1s1"}]}, {"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.1.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.1.1.2/24"}], "rc": 0, "start": "2019-11-22 06:36:55.611630", "stderr": "Device \"t1ns1if\" does not exist.\nDevice \"t1s1if\" does not exist.", "stderr_lines": ["Device \"t1ns1if\" does not exist.", "Device \"t1s1if\" does not exist."], "stdout": "", "stdout_lines": []}
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.2.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.2.1', u'bridge_name': u't1br2', u'dns': [{u'dnsif': u't1s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s2_dnsbrif'}], u'ns_name': u't1ns2', u'subnet_ip': u'2.2.2.0/24', u'vms': [{u'mem': 3, u'name': u't1_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br2if1', u'vmif': u't1VM3if1'}], u'vxlan': [{u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}, {u'tenant_sub_ip': u'10.1.2.2/24', u'tenant_ns_ip': u'10.1.2.1/24', u'tenant_ns_if': u't1ns2if', u'tenant_sub_if': u't1s2if', u'tenant_ns_name': u't1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t1\" ip link show \"t1ns2if\" ; if [ $? -ne 0 ] ; then ip link set \"t1ns2if\" netns \"t1\" ; fi\nip netns exec \"t1ns2\" ip link show \"t1s2if\" ; if [ $? -ne 0 ] ; then ip link set \"t1s2if\" netns \"t1ns2\" ; fi\n", "delta": "0:00:00.123449", "end": "2019-11-22 06:36:56.027022", "item": [{"bridge_name": "t1br2", "default_route_ip": "10.1.2.1", "dns": [{"brif": "t1s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t1s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns2", "route": [{"if": "p1", "ip": "10.1.2.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "2.2.2.0/24", "vms": [{"brif": "t1br2if1", "disk": "10G", "mem": 3, "name": "t1_VM3", "vcpu": 2, "vmif": "t1VM3if1"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, {"tenant_ns_if": "t1ns2if", "tenant_ns_ip": "10.1.2.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s2if", "tenant_sub_ip": "10.1.2.2/24"}], "rc": 0, "start": "2019-11-22 06:36:55.903573", "stderr": "Device \"t1ns2if\" does not exist.\nDevice \"t1s2if\" does not exist.", "stderr_lines": ["Device \"t1ns2if\" does not exist.", "Device \"t1s2if\" does not exist."], "stdout": "", "stdout_lines": []}

TASK [Set Namespace VETH Pairs UP] **************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't1_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM1if1'}, {u'mem': 4, u'name': u't1_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br1if2', u'vmif': u't1VM2if1'}], u'vxlan': [{u'local_ip': u'10.1.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.1.2', u'remote_route': u'10.2.1.0/24', u'subnet_route': u'10.1.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.2.1.2'}]}, {u'tenant_sub_ip': u'10.1.1.2/24', u'tenant_ns_ip': u'10.1.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t1\" ip link set dev \"t1ns1if\" up\nip netns exec \"t1ns1\" ip link set dev \"t1s1if\" up\n", "delta": "0:00:00.085135", "end": "2019-11-22 06:36:56.398294", "item": [{"bridge_name": "t1br1", "default_route_ip": "10.1.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.1.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "vms": [{"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM1", "vcpu": 4, "vmif": "t1VM1if1"}, {"brif": "t1br1if2", "disk": "10G", "mem": 4, "name": "t1_VM2", "vcpu": 2, "vmif": "t1VM2if1"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.1.2", "remote_ip": "10.2.1.2", "remote_route": "10.2.1.0/24", "subnet_route": "10.1.1.0/24", "tenant_route_ip": "192.168.1.2", "v_name": "vxlan_t1s1"}]}, {"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.1.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.1.1.2/24"}], "rc": 0, "start": "2019-11-22 06:36:56.313159", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.2.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.2.1', u'bridge_name': u't1br2', u'dns': [{u'dnsif': u't1s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s2_dnsbrif'}], u'ns_name': u't1ns2', u'subnet_ip': u'2.2.2.0/24', u'vms': [{u'mem': 3, u'name': u't1_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br2if1', u'vmif': u't1VM3if1'}], u'vxlan': [{u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}, {u'tenant_sub_ip': u'10.1.2.2/24', u'tenant_ns_ip': u'10.1.2.1/24', u'tenant_ns_if': u't1ns2if', u'tenant_sub_if': u't1s2if', u'tenant_ns_name': u't1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t1\" ip link set dev \"t1ns2if\" up\nip netns exec \"t1ns2\" ip link set dev \"t1s2if\" up\n", "delta": "0:00:00.079010", "end": "2019-11-22 06:36:56.666267", "item": [{"bridge_name": "t1br2", "default_route_ip": "10.1.2.1", "dns": [{"brif": "t1s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t1s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns2", "route": [{"if": "p1", "ip": "10.1.2.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "2.2.2.0/24", "vms": [{"brif": "t1br2if1", "disk": "10G", "mem": 3, "name": "t1_VM3", "vcpu": 2, "vmif": "t1VM3if1"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, {"tenant_ns_if": "t1ns2if", "tenant_ns_ip": "10.1.2.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s2if", "tenant_sub_ip": "10.1.2.2/24"}], "rc": 0, "start": "2019-11-22 06:36:56.587257", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Add IP addresses to Namespace VETH Pairs] *************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't1_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM1if1'}, {u'mem': 4, u'name': u't1_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br1if2', u'vmif': u't1VM2if1'}], u'vxlan': [{u'local_ip': u'10.1.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.1.2', u'remote_route': u'10.2.1.0/24', u'subnet_route': u'10.1.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.2.1.2'}]}, {u'tenant_sub_ip': u'10.1.1.2/24', u'tenant_ns_ip': u'10.1.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t1ns1\" ip addr show \"t1s1if\" | awk 'FNR==3{ print $2 }' | grep -w '^10.1.1.2/24' ; if [ $? -ne 0 ] ; then ip netns exec \"t1ns1\" ip addr add \"10.1.1.2/24\" dev \"t1s1if\" ; fi\n\nip netns exec \"t1\" ip addr show \"t1ns1if\" | awk 'FNR==3{ print $2 }' | grep -w '^10.1.1.1/24' ; if [ $? -ne 0 ] ; then ip netns exec \"t1\" ip addr add \"10.1.1.1/24\" dev \"t1ns1if\" ; fi\n", "delta": "0:00:00.136778", "end": "2019-11-22 06:36:57.078330", "item": [{"bridge_name": "t1br1", "default_route_ip": "10.1.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.1.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "vms": [{"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM1", "vcpu": 4, "vmif": "t1VM1if1"}, {"brif": "t1br1if2", "disk": "10G", "mem": 4, "name": "t1_VM2", "vcpu": 2, "vmif": "t1VM2if1"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.1.2", "remote_ip": "10.2.1.2", "remote_route": "10.2.1.0/24", "subnet_route": "10.1.1.0/24", "tenant_route_ip": "192.168.1.2", "v_name": "vxlan_t1s1"}]}, {"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.1.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.1.1.2/24"}], "rc": 0, "start": "2019-11-22 06:36:56.941552", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.2.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.2.1', u'bridge_name': u't1br2', u'dns': [{u'dnsif': u't1s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s2_dnsbrif'}], u'ns_name': u't1ns2', u'subnet_ip': u'2.2.2.0/24', u'vms': [{u'mem': 3, u'name': u't1_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br2if1', u'vmif': u't1VM3if1'}], u'vxlan': [{u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}, {u'tenant_sub_ip': u'10.1.2.2/24', u'tenant_ns_ip': u'10.1.2.1/24', u'tenant_ns_if': u't1ns2if', u'tenant_sub_if': u't1s2if', u'tenant_ns_name': u't1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t1ns2\" ip addr show \"t1s2if\" | awk 'FNR==3{ print $2 }' | grep -w '^10.1.2.2/24' ; if [ $? -ne 0 ] ; then ip netns exec \"t1ns2\" ip addr add \"10.1.2.2/24\" dev \"t1s2if\" ; fi\n\nip netns exec \"t1\" ip addr show \"t1ns2if\" | awk 'FNR==3{ print $2 }' | grep -w '^10.1.2.1/24' ; if [ $? -ne 0 ] ; then ip netns exec \"t1\" ip addr add \"10.1.2.1/24\" dev \"t1ns2if\" ; fi\n", "delta": "0:00:00.158062", "end": "2019-11-22 06:36:57.458346", "item": [{"bridge_name": "t1br2", "default_route_ip": "10.1.2.1", "dns": [{"brif": "t1s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t1s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns2", "route": [{"if": "p1", "ip": "10.1.2.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "2.2.2.0/24", "vms": [{"brif": "t1br2if1", "disk": "10G", "mem": 3, "name": "t1_VM3", "vcpu": 2, "vmif": "t1VM3if1"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, {"tenant_ns_if": "t1ns2if", "tenant_ns_ip": "10.1.2.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s2if", "tenant_sub_ip": "10.1.2.2/24"}], "rc": 0, "start": "2019-11-22 06:36:57.300284", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Add IP Route to Tenant] *******************************************************************************************************************************
changed: [localhost] => (item={u'default_route_ip': u'192.168.1.1', u'name': u't1', u'pns_ip': u'192.168.1.1/24', u'tenant_if': u't1if', u'tenant_ip': u'192.168.1.2/24', u'pns_if': u't1pns_if'}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t1\" ip route show default | grep -w '[d]efault via 192.168.1.1' ; if [ $? -ne 0 ] ; then ip netns exec \"t1\" ip route add default via \"192.168.1.1\" ; fi\n", "delta": "0:00:00.076633", "end": "2019-11-22 06:36:57.806497", "item": {"default_route_ip": "192.168.1.1", "name": "t1", "pns_if": "t1pns_if", "pns_ip": "192.168.1.1/24", "tenant_if": "t1if", "tenant_ip": "192.168.1.2/24"}, "rc": 0, "start": "2019-11-22 06:36:57.729864", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Add IP Route to Tenant Subnet] ************************************************************************************************************************
changed: [localhost] => (item={u'route': [{u'ip': u'10.1.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.1.2/24', u'tenant_ns_ip': u'10.1.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_ns_name': u't1', u'tenant_sub_if': u't1s1if'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't1_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM1if1'}, {u'mem': 4, u'name': u't1_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br1if2', u'vmif': u't1VM2if1'}], u'vxlan': [{u'local_ip': u'10.1.1.2', u'tenant_route_ip': u'192.168.1.2', u'dsport': 4789, u'dev': u't1s1if', u'subnet_route': u'10.1.1.0/24', u'remote_route': u'10.2.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.2.1.2'}]}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t1ns1\" ip route show default | grep -w '[d]efault via 10.1.1.1' ; if [ $? -ne 0 ] ; then ip netns exec \"t1ns1\" ip route add default via \"10.1.1.1\" ; fi\n", "delta": "0:00:00.079720", "end": "2019-11-22 06:36:58.186199", "item": {"bridge_name": "t1br1", "default_route_ip": "10.1.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.1.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.1.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.1.1.2/24"}], "vms": [{"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM1", "vcpu": 4, "vmif": "t1VM1if1"}, {"brif": "t1br1if2", "disk": "10G", "mem": 4, "name": "t1_VM2", "vcpu": 2, "vmif": "t1VM2if1"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.1.2", "remote_ip": "10.2.1.2", "remote_route": "10.2.1.0/24", "subnet_route": "10.1.1.0/24", "tenant_route_ip": "192.168.1.2", "v_name": "vxlan_t1s1"}]}, "rc": 0, "start": "2019-11-22 06:36:58.106479", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}
changed: [localhost] => (item={u'route': [{u'ip': u'10.1.2.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.2.1', u'bridge_name': u't1br2', u'dns': [{u'dnsif': u't1s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s2_dnsbrif'}], u'ns_name': u't1ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.2.2/24', u'tenant_ns_ip': u'10.1.2.1/24', u'tenant_ns_if': u't1ns2if', u'tenant_ns_name': u't1', u'tenant_sub_if': u't1s2if'}], u'subnet_ip': u'2.2.2.0/24', u'vms': [{u'mem': 3, u'name': u't1_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br2if1', u'vmif': u't1VM3if1'}], u'vxlan': [{u'local_ip': [], u'tenant_route_ip': [], u'dsport': [], u'dev': [], u'subnet_route': [], u'remote_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t1ns2\" ip route show default | grep -w '[d]efault via 10.1.2.1' ; if [ $? -ne 0 ] ; then ip netns exec \"t1ns2\" ip route add default via \"10.1.2.1\" ; fi\n", "delta": "0:00:00.083719", "end": "2019-11-22 06:36:58.458310", "item": {"bridge_name": "t1br2", "default_route_ip": "10.1.2.1", "dns": [{"brif": "t1s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t1s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns2", "route": [{"if": "p1", "ip": "10.1.2.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "2.2.2.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns2if", "tenant_ns_ip": "10.1.2.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s2if", "tenant_sub_ip": "10.1.2.2/24"}], "vms": [{"brif": "t1br2if1", "disk": "10G", "mem": 3, "name": "t1_VM3", "vcpu": 2, "vmif": "t1VM3if1"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, "rc": 0, "start": "2019-11-22 06:36:58.374591", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Create bridge inside namespace] ***********************************************************************************************************************
changed: [localhost] => (item={u'route': [{u'ip': u'10.1.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.1.2/24', u'tenant_ns_ip': u'10.1.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_ns_name': u't1', u'tenant_sub_if': u't1s1if'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't1_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM1if1'}, {u'mem': 4, u'name': u't1_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br1if2', u'vmif': u't1VM2if1'}], u'vxlan': [{u'local_ip': u'10.1.1.2', u'tenant_route_ip': u'192.168.1.2', u'dsport': 4789, u'dev': u't1s1if', u'subnet_route': u'10.1.1.0/24', u'remote_route': u'10.2.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.2.1.2'}]}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t1ns1\" brctl show | grep -w '^t1br1'; if [ $? -ne 0 ] ; then ip netns exec \"t1ns1\" brctl addbr \"t1br1\" ; fi\nip netns exec \"t1ns1\" ip link set dev \"t1br1\" up\n", "delta": "0:00:00.109820", "end": "2019-11-22 06:36:58.818208", "item": {"bridge_name": "t1br1", "default_route_ip": "10.1.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.1.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.1.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.1.1.2/24"}], "vms": [{"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM1", "vcpu": 4, "vmif": "t1VM1if1"}, {"brif": "t1br1if2", "disk": "10G", "mem": 4, "name": "t1_VM2", "vcpu": 2, "vmif": "t1VM2if1"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.1.2", "remote_ip": "10.2.1.2", "remote_route": "10.2.1.0/24", "subnet_route": "10.1.1.0/24", "tenant_route_ip": "192.168.1.2", "v_name": "vxlan_t1s1"}]}, "rc": 0, "start": "2019-11-22 06:36:58.708388", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}
changed: [localhost] => (item={u'route': [{u'ip': u'10.1.2.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.2.1', u'bridge_name': u't1br2', u'dns': [{u'dnsif': u't1s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s2_dnsbrif'}], u'ns_name': u't1ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.2.2/24', u'tenant_ns_ip': u'10.1.2.1/24', u'tenant_ns_if': u't1ns2if', u'tenant_ns_name': u't1', u'tenant_sub_if': u't1s2if'}], u'subnet_ip': u'2.2.2.0/24', u'vms': [{u'mem': 3, u'name': u't1_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br2if1', u'vmif': u't1VM3if1'}], u'vxlan': [{u'local_ip': [], u'tenant_route_ip': [], u'dsport': [], u'dev': [], u'subnet_route': [], u'remote_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t1ns2\" brctl show | grep -w '^t1br2'; if [ $? -ne 0 ] ; then ip netns exec \"t1ns2\" brctl addbr \"t1br2\" ; fi\nip netns exec \"t1ns2\" ip link set dev \"t1br2\" up\n", "delta": "0:00:00.108208", "end": "2019-11-22 06:36:59.114276", "item": {"bridge_name": "t1br2", "default_route_ip": "10.1.2.1", "dns": [{"brif": "t1s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t1s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns2", "route": [{"if": "p1", "ip": "10.1.2.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "2.2.2.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns2if", "tenant_ns_ip": "10.1.2.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s2if", "tenant_sub_ip": "10.1.2.2/24"}], "vms": [{"brif": "t1br2if1", "disk": "10G", "mem": 3, "name": "t1_VM3", "vcpu": 2, "vmif": "t1VM3if1"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, "rc": 0, "start": "2019-11-22 06:36:59.006068", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Create DNS VETH Pair] *********************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.1.1', u'bridge_name': u't1br1', u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.1.2/24', u'tenant_ns_ip': u'10.1.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't1_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM1if1'}, {u'mem': 4, u'name': u't1_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br1if2', u'vmif': u't1VM2if1'}], u'vxlan': [{u'local_ip': u'10.1.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.1.2', u'remote_route': u'10.2.1.0/24', u'subnet_route': u'10.1.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.2.1.2'}]}, {u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t1ns1\" ip link show \"t1s1_dnsbrif\" ; if [ $? -ne 0 ] ; then ip netns exec \"t1ns1\" ip link add \"t1s1_dnsbrif\" type veth peer name \"t1s1_dnsif\" ; fi\nip netns exec \"t1ns1\" ip link set dev \"t1s1_dnsbrif\" up\nip netns exec \"t1ns1\" ip link set dev \"t1s1_dnsif\" up\n", "delta": "0:00:00.155427", "end": "2019-11-22 06:36:59.586344", "item": [{"bridge_name": "t1br1", "default_route_ip": "10.1.1.1", "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.1.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.1.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.1.1.2/24"}], "vms": [{"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM1", "vcpu": 4, "vmif": "t1VM1if1"}, {"brif": "t1br1if2", "disk": "10G", "mem": 4, "name": "t1_VM2", "vcpu": 2, "vmif": "t1VM2if1"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.1.2", "remote_ip": "10.2.1.2", "remote_route": "10.2.1.0/24", "subnet_route": "10.1.1.0/24", "tenant_route_ip": "192.168.1.2", "v_name": "vxlan_t1s1"}]}, {"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "rc": 0, "start": "2019-11-22 06:36:59.430917", "stderr": "Device \"t1s1_dnsbrif\" does not exist.", "stderr_lines": ["Device \"t1s1_dnsbrif\" does not exist."], "stdout": "", "stdout_lines": []}
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.2.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.2.1', u'bridge_name': u't1br2', u'ns_name': u't1ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.2.2/24', u'tenant_ns_ip': u'10.1.2.1/24', u'tenant_ns_if': u't1ns2if', u'tenant_sub_if': u't1s2if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'2.2.2.0/24', u'vms': [{u'mem': 3, u'name': u't1_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br2if1', u'vmif': u't1VM3if1'}], u'vxlan': [{u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}, {u'dnsif': u't1s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s2_dnsbrif'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t1ns2\" ip link show \"t1s2_dnsbrif\" ; if [ $? -ne 0 ] ; then ip netns exec \"t1ns2\" ip link add \"t1s2_dnsbrif\" type veth peer name \"t1s2_dnsif\" ; fi\nip netns exec \"t1ns2\" ip link set dev \"t1s2_dnsbrif\" up\nip netns exec \"t1ns2\" ip link set dev \"t1s2_dnsif\" up\n", "delta": "0:00:00.156857", "end": "2019-11-22 06:36:59.982409", "item": [{"bridge_name": "t1br2", "default_route_ip": "10.1.2.1", "ns_name": "t1ns2", "route": [{"if": "p1", "ip": "10.1.2.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "2.2.2.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns2if", "tenant_ns_ip": "10.1.2.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s2if", "tenant_sub_ip": "10.1.2.2/24"}], "vms": [{"brif": "t1br2if1", "disk": "10G", "mem": 3, "name": "t1_VM3", "vcpu": 2, "vmif": "t1VM3if1"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, {"brif": "t1s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t1s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "rc": 0, "start": "2019-11-22 06:36:59.825552", "stderr": "Device \"t1s2_dnsbrif\" does not exist.", "stderr_lines": ["Device \"t1s2_dnsbrif\" does not exist."], "stdout": "", "stdout_lines": []}

TASK [Attach DNS VETH Pair] *********************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.1.1', u'bridge_name': u't1br1', u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.1.2/24', u'tenant_ns_ip': u'10.1.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't1_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM1if1'}, {u'mem': 4, u'name': u't1_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br1if2', u'vmif': u't1VM2if1'}], u'vxlan': [{u'local_ip': u'10.1.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.1.2', u'remote_route': u'10.2.1.0/24', u'subnet_route': u'10.1.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.2.1.2'}]}, {u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t1ns1\" brctl show \"t1br1\" | grep -w 't1s1_dnsbrif' ; if [ $? -ne 0 ] ; then ip netns exec \"t1ns1\" brctl addif \"t1br1\" \"t1s1_dnsbrif\" ; fi\n", "delta": "0:00:00.065141", "end": "2019-11-22 06:37:00.354351", "item": [{"bridge_name": "t1br1", "default_route_ip": "10.1.1.1", "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.1.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.1.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.1.1.2/24"}], "vms": [{"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM1", "vcpu": 4, "vmif": "t1VM1if1"}, {"brif": "t1br1if2", "disk": "10G", "mem": 4, "name": "t1_VM2", "vcpu": 2, "vmif": "t1VM2if1"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.1.2", "remote_ip": "10.2.1.2", "remote_route": "10.2.1.0/24", "subnet_route": "10.1.1.0/24", "tenant_route_ip": "192.168.1.2", "v_name": "vxlan_t1s1"}]}, {"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "rc": 0, "start": "2019-11-22 06:37:00.289210", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.2.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.2.1', u'bridge_name': u't1br2', u'ns_name': u't1ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.2.2/24', u'tenant_ns_ip': u'10.1.2.1/24', u'tenant_ns_if': u't1ns2if', u'tenant_sub_if': u't1s2if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'2.2.2.0/24', u'vms': [{u'mem': 3, u'name': u't1_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br2if1', u'vmif': u't1VM3if1'}], u'vxlan': [{u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}, {u'dnsif': u't1s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s2_dnsbrif'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t1ns2\" brctl show \"t1br2\" | grep -w 't1s2_dnsbrif' ; if [ $? -ne 0 ] ; then ip netns exec \"t1ns2\" brctl addif \"t1br2\" \"t1s2_dnsbrif\" ; fi\n", "delta": "0:00:00.076528", "end": "2019-11-22 06:37:00.654387", "item": [{"bridge_name": "t1br2", "default_route_ip": "10.1.2.1", "ns_name": "t1ns2", "route": [{"if": "p1", "ip": "10.1.2.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "2.2.2.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns2if", "tenant_ns_ip": "10.1.2.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s2if", "tenant_sub_ip": "10.1.2.2/24"}], "vms": [{"brif": "t1br2if1", "disk": "10G", "mem": 3, "name": "t1_VM3", "vcpu": 2, "vmif": "t1VM3if1"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, {"brif": "t1s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t1s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "rc": 0, "start": "2019-11-22 06:37:00.577859", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Create VETH Pairs] ************************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.1.2/24', u'tenant_ns_ip': u'10.1.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.1.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.1.2', u'remote_route': u'10.2.1.0/24', u'subnet_route': u'10.1.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.2.1.2'}]}, {u'mem': 2, u'name': u't1_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM1if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip link show \"t1br1if1\" ; if [ $? -ne 0 ] ; then ip link add \"t1VM1if1\" type veth peer name \"t1br1if1\" ; fi\nip link set dev \"t1br1if1\" up\nip link set dev \"t1VM1if1\" up\n", "delta": "0:00:00.015488", "end": "2019-11-22 06:37:00.966681", "item": [{"bridge_name": "t1br1", "default_route_ip": "10.1.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.1.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.1.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.1.1.2/24"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.1.2", "remote_ip": "10.2.1.2", "remote_route": "10.2.1.0/24", "subnet_route": "10.1.1.0/24", "tenant_route_ip": "192.168.1.2", "v_name": "vxlan_t1s1"}]}, {"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM1", "vcpu": 4, "vmif": "t1VM1if1"}], "rc": 0, "start": "2019-11-22 06:37:00.951193", "stderr": "Device \"t1br1if1\" does not exist.", "stderr_lines": ["Device \"t1br1if1\" does not exist."], "stdout": "", "stdout_lines": []}
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.1.2/24', u'tenant_ns_ip': u'10.1.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.1.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.1.2', u'remote_route': u'10.2.1.0/24', u'subnet_route': u'10.1.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.2.1.2'}]}, {u'mem': 4, u'name': u't1_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br1if2', u'vmif': u't1VM2if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip link show \"t1br1if2\" ; if [ $? -ne 0 ] ; then ip link add \"t1VM2if1\" type veth peer name \"t1br1if2\" ; fi\nip link set dev \"t1br1if2\" up\nip link set dev \"t1VM2if1\" up\n", "delta": "0:00:00.016225", "end": "2019-11-22 06:37:01.187783", "item": [{"bridge_name": "t1br1", "default_route_ip": "10.1.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.1.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.1.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.1.1.2/24"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.1.2", "remote_ip": "10.2.1.2", "remote_route": "10.2.1.0/24", "subnet_route": "10.1.1.0/24", "tenant_route_ip": "192.168.1.2", "v_name": "vxlan_t1s1"}]}, {"brif": "t1br1if2", "disk": "10G", "mem": 4, "name": "t1_VM2", "vcpu": 2, "vmif": "t1VM2if1"}], "rc": 0, "start": "2019-11-22 06:37:01.171558", "stderr": "Device \"t1br1if2\" does not exist.", "stderr_lines": ["Device \"t1br1if2\" does not exist."], "stdout": "", "stdout_lines": []}
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.2.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.2.1', u'bridge_name': u't1br2', u'dns': [{u'dnsif': u't1s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s2_dnsbrif'}], u'ns_name': u't1ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.2.2/24', u'tenant_ns_ip': u'10.1.2.1/24', u'tenant_ns_if': u't1ns2if', u'tenant_sub_if': u't1s2if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'2.2.2.0/24', u'vxlan': [{u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}, {u'mem': 3, u'name': u't1_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br2if1', u'vmif': u't1VM3if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip link show \"t1br2if1\" ; if [ $? -ne 0 ] ; then ip link add \"t1VM3if1\" type veth peer name \"t1br2if1\" ; fi\nip link set dev \"t1br2if1\" up\nip link set dev \"t1VM3if1\" up\n", "delta": "0:00:00.015585", "end": "2019-11-22 06:37:01.399598", "item": [{"bridge_name": "t1br2", "default_route_ip": "10.1.2.1", "dns": [{"brif": "t1s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t1s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns2", "route": [{"if": "p1", "ip": "10.1.2.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "2.2.2.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns2if", "tenant_ns_ip": "10.1.2.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s2if", "tenant_sub_ip": "10.1.2.2/24"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, {"brif": "t1br2if1", "disk": "10G", "mem": 3, "name": "t1_VM3", "vcpu": 2, "vmif": "t1VM3if1"}], "rc": 0, "start": "2019-11-22 06:37:01.384013", "stderr": "Device \"t1br2if1\" does not exist.", "stderr_lines": ["Device \"t1br2if1\" does not exist."], "stdout": "", "stdout_lines": []}

TASK [Attach VETH Pairs] ************************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.1.2/24', u'tenant_ns_ip': u'10.1.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.1.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.1.2', u'remote_route': u'10.2.1.0/24', u'subnet_route': u'10.1.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.2.1.2'}]}, {u'mem': 2, u'name': u't1_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM1if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip link show \"t1br1if1\" ; if [ $? -eq 0 ] ; then ip link set \"t1br1if1\" netns \"t1ns1\" ; fi\nip netns exec \"t1ns1\" brctl show \"t1br1\" | grep -w 't1br1if1' ; if [ $? -ne 0 ] ; then ip netns exec \"t1ns1\" brctl addif \"t1br1\" \"t1br1if1\" ; fi\n", "delta": "0:00:00.093348", "end": "2019-11-22 06:37:01.754125", "item": [{"bridge_name": "t1br1", "default_route_ip": "10.1.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.1.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.1.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.1.1.2/24"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.1.2", "remote_ip": "10.2.1.2", "remote_route": "10.2.1.0/24", "subnet_route": "10.1.1.0/24", "tenant_route_ip": "192.168.1.2", "v_name": "vxlan_t1s1"}]}, {"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM1", "vcpu": 4, "vmif": "t1VM1if1"}], "rc": 0, "start": "2019-11-22 06:37:01.660777", "stderr": "", "stderr_lines": [], "stdout": "20: t1br1if1@t1VM1if1: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP mode DEFAULT group default qlen 1000\n    link/ether ea:e8:71:87:56:b2 brd ff:ff:ff:ff:ff:ff", "stdout_lines": ["20: t1br1if1@t1VM1if1: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP mode DEFAULT group default qlen 1000", "    link/ether ea:e8:71:87:56:b2 brd ff:ff:ff:ff:ff:ff"]}
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.1.2/24', u'tenant_ns_ip': u'10.1.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.1.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.1.2', u'remote_route': u'10.2.1.0/24', u'subnet_route': u'10.1.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.2.1.2'}]}, {u'mem': 4, u'name': u't1_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br1if2', u'vmif': u't1VM2if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip link show \"t1br1if2\" ; if [ $? -eq 0 ] ; then ip link set \"t1br1if2\" netns \"t1ns1\" ; fi\nip netns exec \"t1ns1\" brctl show \"t1br1\" | grep -w 't1br1if2' ; if [ $? -ne 0 ] ; then ip netns exec \"t1ns1\" brctl addif \"t1br1\" \"t1br1if2\" ; fi\n", "delta": "0:00:00.112818", "end": "2019-11-22 06:37:02.066235", "item": [{"bridge_name": "t1br1", "default_route_ip": "10.1.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.1.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.1.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.1.1.2/24"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.1.2", "remote_ip": "10.2.1.2", "remote_route": "10.2.1.0/24", "subnet_route": "10.1.1.0/24", "tenant_route_ip": "192.168.1.2", "v_name": "vxlan_t1s1"}]}, {"brif": "t1br1if2", "disk": "10G", "mem": 4, "name": "t1_VM2", "vcpu": 2, "vmif": "t1VM2if1"}], "rc": 0, "start": "2019-11-22 06:37:01.953417", "stderr": "", "stderr_lines": [], "stdout": "22: t1br1if2@t1VM2if1: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP mode DEFAULT group default qlen 1000\n    link/ether 86:eb:35:9e:c3:54 brd ff:ff:ff:ff:ff:ff", "stdout_lines": ["22: t1br1if2@t1VM2if1: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP mode DEFAULT group default qlen 1000", "    link/ether 86:eb:35:9e:c3:54 brd ff:ff:ff:ff:ff:ff"]}
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.2.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.2.1', u'bridge_name': u't1br2', u'dns': [{u'dnsif': u't1s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s2_dnsbrif'}], u'ns_name': u't1ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.2.2/24', u'tenant_ns_ip': u'10.1.2.1/24', u'tenant_ns_if': u't1ns2if', u'tenant_sub_if': u't1s2if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'2.2.2.0/24', u'vxlan': [{u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}, {u'mem': 3, u'name': u't1_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br2if1', u'vmif': u't1VM3if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip link show \"t1br2if1\" ; if [ $? -eq 0 ] ; then ip link set \"t1br2if1\" netns \"t1ns2\" ; fi\nip netns exec \"t1ns2\" brctl show \"t1br2\" | grep -w 't1br2if1' ; if [ $? -ne 0 ] ; then ip netns exec \"t1ns2\" brctl addif \"t1br2\" \"t1br2if1\" ; fi\n", "delta": "0:00:00.110026", "end": "2019-11-22 06:37:02.374144", "item": [{"bridge_name": "t1br2", "default_route_ip": "10.1.2.1", "dns": [{"brif": "t1s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t1s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns2", "route": [{"if": "p1", "ip": "10.1.2.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "2.2.2.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns2if", "tenant_ns_ip": "10.1.2.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s2if", "tenant_sub_ip": "10.1.2.2/24"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, {"brif": "t1br2if1", "disk": "10G", "mem": 3, "name": "t1_VM3", "vcpu": 2, "vmif": "t1VM3if1"}], "rc": 0, "start": "2019-11-22 06:37:02.264118", "stderr": "", "stderr_lines": [], "stdout": "24: t1br2if1@t1VM3if1: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP mode DEFAULT group default qlen 1000\n    link/ether 22:5a:f8:b6:4b:fa brd ff:ff:ff:ff:ff:ff", "stdout_lines": ["24: t1br2if1@t1VM3if1: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP mode DEFAULT group default qlen 1000", "    link/ether 22:5a:f8:b6:4b:fa brd ff:ff:ff:ff:ff:ff"]}

TASK [All interfaces and bridges UP] ************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.1.2/24', u'tenant_ns_ip': u'10.1.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.1.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.1.2', u'remote_route': u'10.2.1.0/24', u'subnet_route': u'10.1.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.2.1.2'}]}, {u'mem': 2, u'name': u't1_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM1if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t1ns1\" ip link set \"t1br1if1\" up\nip netns exec \"t1ns1\" ip link set dev \"t1br1\" up\n", "delta": "0:00:00.072055", "end": "2019-11-22 06:37:02.710294", "item": [{"bridge_name": "t1br1", "default_route_ip": "10.1.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.1.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.1.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.1.1.2/24"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.1.2", "remote_ip": "10.2.1.2", "remote_route": "10.2.1.0/24", "subnet_route": "10.1.1.0/24", "tenant_route_ip": "192.168.1.2", "v_name": "vxlan_t1s1"}]}, {"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM1", "vcpu": 4, "vmif": "t1VM1if1"}], "rc": 0, "start": "2019-11-22 06:37:02.638239", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.1.2/24', u'tenant_ns_ip': u'10.1.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.1.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.1.2', u'remote_route': u'10.2.1.0/24', u'subnet_route': u'10.1.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.2.1.2'}]}, {u'mem': 4, u'name': u't1_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br1if2', u'vmif': u't1VM2if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t1ns1\" ip link set \"t1br1if2\" up\nip netns exec \"t1ns1\" ip link set dev \"t1br1\" up\n", "delta": "0:00:00.081511", "end": "2019-11-22 06:37:02.986575", "item": [{"bridge_name": "t1br1", "default_route_ip": "10.1.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.1.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.1.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.1.1.2/24"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.1.2", "remote_ip": "10.2.1.2", "remote_route": "10.2.1.0/24", "subnet_route": "10.1.1.0/24", "tenant_route_ip": "192.168.1.2", "v_name": "vxlan_t1s1"}]}, {"brif": "t1br1if2", "disk": "10G", "mem": 4, "name": "t1_VM2", "vcpu": 2, "vmif": "t1VM2if1"}], "rc": 0, "start": "2019-11-22 06:37:02.905064", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.2.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.2.1', u'bridge_name': u't1br2', u'dns': [{u'dnsif': u't1s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s2_dnsbrif'}], u'ns_name': u't1ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.2.2/24', u'tenant_ns_ip': u'10.1.2.1/24', u'tenant_ns_if': u't1ns2if', u'tenant_sub_if': u't1s2if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'2.2.2.0/24', u'vxlan': [{u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}, {u'mem': 3, u'name': u't1_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br2if1', u'vmif': u't1VM3if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t1ns2\" ip link set \"t1br2if1\" up\nip netns exec \"t1ns2\" ip link set dev \"t1br2\" up\n", "delta": "0:00:00.078602", "end": "2019-11-22 06:37:03.266114", "item": [{"bridge_name": "t1br2", "default_route_ip": "10.1.2.1", "dns": [{"brif": "t1s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t1s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns2", "route": [{"if": "p1", "ip": "10.1.2.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "2.2.2.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns2if", "tenant_ns_ip": "10.1.2.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s2if", "tenant_sub_ip": "10.1.2.2/24"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, {"brif": "t1br2if1", "disk": "10G", "mem": 3, "name": "t1_VM3", "vcpu": 2, "vmif": "t1VM3if1"}], "rc": 0, "start": "2019-11-22 06:37:03.187512", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Add IP to DNS Interface] ******************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.1.1', u'bridge_name': u't1br1', u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.1.2/24', u'tenant_ns_ip': u'10.1.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't1_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM1if1'}, {u'mem': 4, u'name': u't1_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br1if2', u'vmif': u't1VM2if1'}], u'vxlan': [{u'local_ip': u'10.1.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.1.2', u'remote_route': u'10.2.1.0/24', u'subnet_route': u'10.1.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.2.1.2'}]}, {u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t1ns1\" ip addr show \"t1s1_dnsif\" | awk 'FNR==3{ print $2 }' | grep -w '^1.1.1.1/24' ; if [ $? -ne 0 ] ; then ip netns exec \"t1ns1\" ip addr add \"1.1.1.1/24\" dev \"t1s1_dnsif\" ; fi\n", "delta": "0:00:00.086839", "end": "2019-11-22 06:37:03.606139", "item": [{"bridge_name": "t1br1", "default_route_ip": "10.1.1.1", "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.1.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.1.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.1.1.2/24"}], "vms": [{"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM1", "vcpu": 4, "vmif": "t1VM1if1"}, {"brif": "t1br1if2", "disk": "10G", "mem": 4, "name": "t1_VM2", "vcpu": 2, "vmif": "t1VM2if1"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.1.2", "remote_ip": "10.2.1.2", "remote_route": "10.2.1.0/24", "subnet_route": "10.1.1.0/24", "tenant_route_ip": "192.168.1.2", "v_name": "vxlan_t1s1"}]}, {"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "rc": 0, "start": "2019-11-22 06:37:03.519300", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.2.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.2.1', u'bridge_name': u't1br2', u'ns_name': u't1ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.2.2/24', u'tenant_ns_ip': u'10.1.2.1/24', u'tenant_ns_if': u't1ns2if', u'tenant_sub_if': u't1s2if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'2.2.2.0/24', u'vms': [{u'mem': 3, u'name': u't1_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br2if1', u'vmif': u't1VM3if1'}], u'vxlan': [{u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}, {u'dnsif': u't1s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s2_dnsbrif'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t1ns2\" ip addr show \"t1s2_dnsif\" | awk 'FNR==3{ print $2 }' | grep -w '^2.2.2.1/24' ; if [ $? -ne 0 ] ; then ip netns exec \"t1ns2\" ip addr add \"2.2.2.1/24\" dev \"t1s2_dnsif\" ; fi\n", "delta": "0:00:00.065022", "end": "2019-11-22 06:37:03.874093", "item": [{"bridge_name": "t1br2", "default_route_ip": "10.1.2.1", "ns_name": "t1ns2", "route": [{"if": "p1", "ip": "10.1.2.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "2.2.2.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns2if", "tenant_ns_ip": "10.1.2.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s2if", "tenant_sub_ip": "10.1.2.2/24"}], "vms": [{"brif": "t1br2if1", "disk": "10G", "mem": 3, "name": "t1_VM3", "vcpu": 2, "vmif": "t1VM3if1"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, {"brif": "t1s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t1s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "rc": 0, "start": "2019-11-22 06:37:03.809071", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Install DHCP Server] **********************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.1.1', u'bridge_name': u't1br1', u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.1.2/24', u'tenant_ns_ip': u'10.1.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't1_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM1if1'}, {u'mem': 4, u'name': u't1_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br1if2', u'vmif': u't1VM2if1'}], u'vxlan': [{u'local_ip': u'10.1.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.1.2', u'remote_route': u'10.2.1.0/24', u'subnet_route': u'10.1.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.2.1.2'}]}, {u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t1ns1\" ps aux | grep -w '[d]nsmasq --interface t1s1_dnsif -z --dhcp-range=1.1.1.5,1.1.1.126' ; if [ $? -ne 0 ] ; then ip netns exec \"t1ns1\" dnsmasq --interface \"t1s1_dnsif\" -z --dhcp-range=1.1.1.5,'1.1.1.126' ; fi\n", "delta": "0:00:00.078344", "end": "2019-11-22 06:37:04.203900", "item": [{"bridge_name": "t1br1", "default_route_ip": "10.1.1.1", "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.1.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.1.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.1.1.2/24"}], "vms": [{"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM1", "vcpu": 4, "vmif": "t1VM1if1"}, {"brif": "t1br1if2", "disk": "10G", "mem": 4, "name": "t1_VM2", "vcpu": 2, "vmif": "t1VM2if1"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.1.2", "remote_ip": "10.2.1.2", "remote_route": "10.2.1.0/24", "subnet_route": "10.1.1.0/24", "tenant_route_ip": "192.168.1.2", "v_name": "vxlan_t1s1"}]}, {"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "rc": 0, "start": "2019-11-22 06:37:04.125556", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.2.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.2.1', u'bridge_name': u't1br2', u'ns_name': u't1ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.2.2/24', u'tenant_ns_ip': u'10.1.2.1/24', u'tenant_ns_if': u't1ns2if', u'tenant_sub_if': u't1s2if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'2.2.2.0/24', u'vms': [{u'mem': 3, u'name': u't1_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br2if1', u'vmif': u't1VM3if1'}], u'vxlan': [{u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}, {u'dnsif': u't1s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s2_dnsbrif'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t1ns2\" ps aux | grep -w '[d]nsmasq --interface t1s2_dnsif -z --dhcp-range=2.2.2.5,2.2.2.254' ; if [ $? -ne 0 ] ; then ip netns exec \"t1ns2\" dnsmasq --interface \"t1s2_dnsif\" -z --dhcp-range=2.2.2.5,'2.2.2.254' ; fi\n", "delta": "0:00:00.061099", "end": "2019-11-22 06:37:04.454270", "item": [{"bridge_name": "t1br2", "default_route_ip": "10.1.2.1", "ns_name": "t1ns2", "route": [{"if": "p1", "ip": "10.1.2.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "2.2.2.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns2if", "tenant_ns_ip": "10.1.2.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s2if", "tenant_sub_ip": "10.1.2.2/24"}], "vms": [{"brif": "t1br2if1", "disk": "10G", "mem": 3, "name": "t1_VM3", "vcpu": 2, "vmif": "t1VM3if1"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, {"brif": "t1s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t1s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "rc": 0, "start": "2019-11-22 06:37:04.393171", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Create VXLAN devices] *********************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.1.2/24', u'tenant_ns_ip': u'10.1.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't1_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM1if1'}, {u'mem': 4, u'name': u't1_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br1if2', u'vmif': u't1VM2if1'}]}, {u'local_ip': u'10.1.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.1.2', u'remote_route': u'10.2.1.0/24', u'subnet_route': u'10.1.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.2.1.2'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t1ns1\" ip link show \"vxlan_t1s1\" ; if [ $? -ne 0 ] ; then ip netns exec \"t1ns1\" ip link add \"vxlan_t1s1\" type vxlan id \"42\" local \"10.1.1.2\" remote \"10.2.1.2\" dstport \"4789\" dev \"t1s1if\"; ip netns exec \"t1ns1\" ip link set dev \"vxlan_t1s1\" up ; fi\n", "delta": "0:00:00.111064", "end": "2019-11-22 06:37:04.834299", "item": [{"bridge_name": "t1br1", "default_route_ip": "10.1.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.1.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.1.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.1.1.2/24"}], "vms": [{"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM1", "vcpu": 4, "vmif": "t1VM1if1"}, {"brif": "t1br1if2", "disk": "10G", "mem": 4, "name": "t1_VM2", "vcpu": 2, "vmif": "t1VM2if1"}]}, {"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.1.2", "remote_ip": "10.2.1.2", "remote_route": "10.2.1.0/24", "subnet_route": "10.1.1.0/24", "tenant_route_ip": "192.168.1.2", "v_name": "vxlan_t1s1"}], "rc": 0, "start": "2019-11-22 06:37:04.723235", "stderr": "Device \"vxlan_t1s1\" does not exist.", "stderr_lines": ["Device \"vxlan_t1s1\" does not exist."], "stdout": "", "stdout_lines": []}
skipping: [localhost] => (item=[{u'route': [{u'ip': u'10.1.2.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.2.1', u'bridge_name': u't1br2', u'dns': [{u'dnsif': u't1s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s2_dnsbrif'}], u'ns_name': u't1ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.2.2/24', u'tenant_ns_ip': u'10.1.2.1/24', u'tenant_ns_if': u't1ns2if', u'tenant_sub_if': u't1s2if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'2.2.2.0/24', u'vms': [{u'mem': 3, u'name': u't1_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br2if1', u'vmif': u't1VM3if1'}]}, {u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}])  => {"ansible_loop_var": "item", "changed": false, "item": [{"bridge_name": "t1br2", "default_route_ip": "10.1.2.1", "dns": [{"brif": "t1s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t1s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns2", "route": [{"if": "p1", "ip": "10.1.2.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "2.2.2.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns2if", "tenant_ns_ip": "10.1.2.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s2if", "tenant_sub_ip": "10.1.2.2/24"}], "vms": [{"brif": "t1br2if1", "disk": "10G", "mem": 3, "name": "t1_VM3", "vcpu": 2, "vmif": "t1VM3if1"}]}, {"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}], "skip_reason": "Conditional result was False"}

TASK [Attach VXLANs to bridge] ******************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.1.2/24', u'tenant_ns_ip': u'10.1.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't1_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM1if1'}, {u'mem': 4, u'name': u't1_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br1if2', u'vmif': u't1VM2if1'}]}, {u'local_ip': u'10.1.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.1.2', u'remote_route': u'10.2.1.0/24', u'subnet_route': u'10.1.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.2.1.2'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t1ns1\" brctl show \"t1br1\" | grep -w 'vxlan_t1s1' ; if [ $? -ne 0 ] ; then ip netns exec \"t1ns1\" brctl addif \"t1br1\" \"vxlan_t1s1\" ; fi\n", "delta": "0:00:00.074760", "end": "2019-11-22 06:37:05.182232", "item": [{"bridge_name": "t1br1", "default_route_ip": "10.1.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.1.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.1.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.1.1.2/24"}], "vms": [{"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM1", "vcpu": 4, "vmif": "t1VM1if1"}, {"brif": "t1br1if2", "disk": "10G", "mem": 4, "name": "t1_VM2", "vcpu": 2, "vmif": "t1VM2if1"}]}, {"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.1.2", "remote_ip": "10.2.1.2", "remote_route": "10.2.1.0/24", "subnet_route": "10.1.1.0/24", "tenant_route_ip": "192.168.1.2", "v_name": "vxlan_t1s1"}], "rc": 0, "start": "2019-11-22 06:37:05.107472", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}
skipping: [localhost] => (item=[{u'route': [{u'ip': u'10.1.2.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.2.1', u'bridge_name': u't1br2', u'dns': [{u'dnsif': u't1s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s2_dnsbrif'}], u'ns_name': u't1ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.2.2/24', u'tenant_ns_ip': u'10.1.2.1/24', u'tenant_ns_if': u't1ns2if', u'tenant_sub_if': u't1s2if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'2.2.2.0/24', u'vms': [{u'mem': 3, u'name': u't1_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br2if1', u'vmif': u't1VM3if1'}]}, {u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}])  => {"ansible_loop_var": "item", "changed": false, "item": [{"bridge_name": "t1br2", "default_route_ip": "10.1.2.1", "dns": [{"brif": "t1s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t1s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns2", "route": [{"if": "p1", "ip": "10.1.2.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "2.2.2.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns2if", "tenant_ns_ip": "10.1.2.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s2if", "tenant_sub_ip": "10.1.2.2/24"}], "vms": [{"brif": "t1br2if1", "disk": "10G", "mem": 3, "name": "t1_VM3", "vcpu": 2, "vmif": "t1VM3if1"}]}, {"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}], "skip_reason": "Conditional result was False"}

PLAY RECAP **************************************************************************************************************************************************
localhost                  : ok=21   changed=21   unreachable=0    failed=0    skipped=0    rescued=0    ignored=0   

Using /etc/ansible/ansible.cfg as config file

PLAY [worker] ***********************************************************************************************************************************************

TASK [Create Tenant Namespace] ******************************************************************************************************************************
changed: [99.99.99.2] => (item={u'default_route_ip': u'192.168.129.1', u'name': u't1', u'pns_ip': u'192.168.129.1/24', u'tenant_if': u't1if', u'tenant_ip': u'192.168.129.2/24', u'pns_if': u't1pns_if'}) => {"ansible_loop_var": "item", "changed": true, "cmd": ["ip", "netns", "add", "t1"], "delta": "0:00:00.050713", "end": "2019-11-22 06:37:07.185959", "item": {"default_route_ip": "192.168.129.1", "name": "t1", "pns_if": "t1pns_if", "pns_ip": "192.168.129.1/24", "tenant_if": "t1if", "tenant_ip": "192.168.129.2/24"}, "rc": 0, "start": "2019-11-22 06:37:07.135246", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Create Subnet Namespace] ******************************************************************************************************************************
changed: [99.99.99.2] => (item={u'route': [{u'ip': u'10.2.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.2.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.1.2/24', u'tenant_ns_ip': u'10.2.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_ns_name': u't1', u'tenant_sub_if': u't1s1if'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't1_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM4if1'}], u'vxlan': [{u'local_ip': u'10.2.1.2', u'tenant_route_ip': u'192.168.129.2', u'dsport': 4789, u'dev': u't1s1if', u'subnet_route': u'10.2.1.0/24', u'remote_route': u'10.1.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.1.1.2'}]}) => {"ansible_loop_var": "item", "changed": true, "cmd": ["ip", "netns", "add", "t1ns1"], "delta": "0:00:00.054970", "end": "2019-11-22 06:37:07.608374", "item": {"bridge_name": "t1br1", "default_route_ip": "10.2.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.2.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.2.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.2.1.2/24"}], "vms": [{"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM4", "vcpu": 4, "vmif": "t1VM4if1"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.1.2", "remote_ip": "10.1.1.2", "remote_route": "10.1.1.0/24", "subnet_route": "10.2.1.0/24", "tenant_route_ip": "192.168.129.2", "v_name": "vxlan_t1s1"}]}, "rc": 0, "start": "2019-11-22 06:37:07.553404", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Create Tenant VETH pairs] *****************************************************************************************************************************
changed: [99.99.99.2] => (item={u'default_route_ip': u'192.168.129.1', u'name': u't1', u'pns_ip': u'192.168.129.1/24', u'tenant_if': u't1if', u'tenant_ip': u'192.168.129.2/24', u'pns_if': u't1pns_if'}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip link show \"t1if\" ; if [ $? -ne 0 ] ; then ip link add \"t1if\" type veth peer name \"t1pns_if\" ; fi\n", "delta": "0:00:00.010038", "end": "2019-11-22 06:37:07.991951", "item": {"default_route_ip": "192.168.129.1", "name": "t1", "pns_if": "t1pns_if", "pns_ip": "192.168.129.1/24", "tenant_if": "t1if", "tenant_ip": "192.168.129.2/24"}, "rc": 0, "start": "2019-11-22 06:37:07.981913", "stderr": "Device \"t1if\" does not exist.", "stderr_lines": ["Device \"t1if\" does not exist."], "stdout": "", "stdout_lines": []}

TASK [Attach Tenant VETH Pairs] *****************************************************************************************************************************
changed: [99.99.99.2] => (item={u'default_route_ip': u'192.168.129.1', u'name': u't1', u'pns_ip': u'192.168.129.1/24', u'tenant_if': u't1if', u'tenant_ip': u'192.168.129.2/24', u'pns_if': u't1pns_if'}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec pns ip link show \"t1pns_if\" ; if [ $? -ne 0 ] ; then ip link set \"t1pns_if\" netns pns ; fi\nip netns exec \"t1\" ip link show \"t1if\" ; if [ $? -ne 0 ] ; then ip link set \"t1if\" netns \"t1\" ; fi\nip netns exec pns ip link set dev \"t1pns_if\" up\nip netns exec \"t1\" ip link set dev \"t1if\" up\n", "delta": "0:00:00.172891", "end": "2019-11-22 06:37:08.560064", "item": {"default_route_ip": "192.168.129.1", "name": "t1", "pns_if": "t1pns_if", "pns_ip": "192.168.129.1/24", "tenant_if": "t1if", "tenant_ip": "192.168.129.2/24"}, "rc": 0, "start": "2019-11-22 06:37:08.387173", "stderr": "Device \"t1pns_if\" does not exist.\nDevice \"t1if\" does not exist.", "stderr_lines": ["Device \"t1pns_if\" does not exist.", "Device \"t1if\" does not exist."], "stdout": "", "stdout_lines": []}

TASK [Add IP addresses to Tenant VETH Pairs] ****************************************************************************************************************
changed: [99.99.99.2] => (item={u'default_route_ip': u'192.168.129.1', u'name': u't1', u'pns_ip': u'192.168.129.1/24', u'tenant_if': u't1if', u'tenant_ip': u'192.168.129.2/24', u'pns_if': u't1pns_if'}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec pns ip addr show \"t1pns_if\" | awk 'FNR==3{ print $2 }' | grep -w '^192.168.129.1/24' ; if [ $? -ne 0 ] ; then ip netns exec pns ip addr add \"192.168.129.1/24\" dev \"t1pns_if\" ; fi\nip netns exec \"t1\" ip addr show \"t1if\" | awk 'FNR==3{ print $2 }' | grep -w '^192.168.129.2/24' ; if [ $? -ne 0 ] ; then ip netns exec \"t1\" ip addr add \"192.168.129.2/24\" dev \"t1if\" ; fi\n", "delta": "0:00:00.147356", "end": "2019-11-22 06:37:09.088004", "item": {"default_route_ip": "192.168.129.1", "name": "t1", "pns_if": "t1pns_if", "pns_ip": "192.168.129.1/24", "tenant_if": "t1if", "tenant_ip": "192.168.129.2/24"}, "rc": 0, "start": "2019-11-22 06:37:08.940648", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Create Namespace VETH Pairs] **************************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.2.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't1_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM4if1'}], u'vxlan': [{u'local_ip': u'10.2.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.129.2', u'remote_route': u'10.1.1.0/24', u'subnet_route': u'10.2.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.1.1.2'}]}, {u'tenant_sub_ip': u'10.2.1.2/24', u'tenant_ns_ip': u'10.2.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip link show \"t1ns1if\" ; if [ $? -ne 0 ] ; then ip link add \"t1ns1if\" type veth peer name \"t1s1if\" ; fi\n", "delta": "0:00:00.010301", "end": "2019-11-22 06:37:09.474368", "item": [{"bridge_name": "t1br1", "default_route_ip": "10.2.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.2.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "vms": [{"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM4", "vcpu": 4, "vmif": "t1VM4if1"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.1.2", "remote_ip": "10.1.1.2", "remote_route": "10.1.1.0/24", "subnet_route": "10.2.1.0/24", "tenant_route_ip": "192.168.129.2", "v_name": "vxlan_t1s1"}]}, {"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.2.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.2.1.2/24"}], "rc": 0, "start": "2019-11-22 06:37:09.464067", "stderr": "Device \"t1ns1if\" does not exist.", "stderr_lines": ["Device \"t1ns1if\" does not exist."], "stdout": "", "stdout_lines": []}

TASK [Attach Namespace VETH Pairs] **************************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.2.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't1_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM4if1'}], u'vxlan': [{u'local_ip': u'10.2.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.129.2', u'remote_route': u'10.1.1.0/24', u'subnet_route': u'10.2.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.1.1.2'}]}, {u'tenant_sub_ip': u'10.2.1.2/24', u'tenant_ns_ip': u'10.2.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t1\" ip link show \"t1ns1if\" ; if [ $? -ne 0 ] ; then ip link set \"t1ns1if\" netns \"t1\" ; fi\nip netns exec \"t1ns1\" ip link show \"t1s1if\" ; if [ $? -ne 0 ] ; then ip link set \"t1s1if\" netns \"t1ns1\" ; fi\n", "delta": "0:00:00.129045", "end": "2019-11-22 06:37:09.981934", "item": [{"bridge_name": "t1br1", "default_route_ip": "10.2.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.2.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "vms": [{"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM4", "vcpu": 4, "vmif": "t1VM4if1"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.1.2", "remote_ip": "10.1.1.2", "remote_route": "10.1.1.0/24", "subnet_route": "10.2.1.0/24", "tenant_route_ip": "192.168.129.2", "v_name": "vxlan_t1s1"}]}, {"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.2.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.2.1.2/24"}], "rc": 0, "start": "2019-11-22 06:37:09.852889", "stderr": "Device \"t1ns1if\" does not exist.\nDevice \"t1s1if\" does not exist.", "stderr_lines": ["Device \"t1ns1if\" does not exist.", "Device \"t1s1if\" does not exist."], "stdout": "", "stdout_lines": []}

TASK [Set Namespace VETH Pairs UP] **************************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.2.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't1_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM4if1'}], u'vxlan': [{u'local_ip': u'10.2.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.129.2', u'remote_route': u'10.1.1.0/24', u'subnet_route': u'10.2.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.1.1.2'}]}, {u'tenant_sub_ip': u'10.2.1.2/24', u'tenant_ns_ip': u'10.2.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t1\" ip link set dev \"t1ns1if\" up\nip netns exec \"t1ns1\" ip link set dev \"t1s1if\" up\n", "delta": "0:00:00.076248", "end": "2019-11-22 06:37:10.440094", "item": [{"bridge_name": "t1br1", "default_route_ip": "10.2.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.2.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "vms": [{"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM4", "vcpu": 4, "vmif": "t1VM4if1"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.1.2", "remote_ip": "10.1.1.2", "remote_route": "10.1.1.0/24", "subnet_route": "10.2.1.0/24", "tenant_route_ip": "192.168.129.2", "v_name": "vxlan_t1s1"}]}, {"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.2.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.2.1.2/24"}], "rc": 0, "start": "2019-11-22 06:37:10.363846", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Add IP addresses to Namespace VETH Pairs] *************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.2.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't1_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM4if1'}], u'vxlan': [{u'local_ip': u'10.2.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.129.2', u'remote_route': u'10.1.1.0/24', u'subnet_route': u'10.2.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.1.1.2'}]}, {u'tenant_sub_ip': u'10.2.1.2/24', u'tenant_ns_ip': u'10.2.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t1ns1\" ip addr show \"t1s1if\" | awk 'FNR==3{ print $2 }' | grep -w '^10.2.1.2/24' ; if [ $? -ne 0 ] ; then ip netns exec \"t1ns1\" ip addr add \"10.2.1.2/24\" dev \"t1s1if\" ; fi\n\nip netns exec \"t1\" ip addr show \"t1ns1if\" | awk 'FNR==3{ print $2 }' | grep -w '^10.2.1.1/24' ; if [ $? -ne 0 ] ; then ip netns exec \"t1\" ip addr add \"10.2.1.1/24\" dev \"t1ns1if\" ; fi\n", "delta": "0:00:00.166215", "end": "2019-11-22 06:37:10.995968", "item": [{"bridge_name": "t1br1", "default_route_ip": "10.2.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.2.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "vms": [{"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM4", "vcpu": 4, "vmif": "t1VM4if1"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.1.2", "remote_ip": "10.1.1.2", "remote_route": "10.1.1.0/24", "subnet_route": "10.2.1.0/24", "tenant_route_ip": "192.168.129.2", "v_name": "vxlan_t1s1"}]}, {"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.2.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.2.1.2/24"}], "rc": 0, "start": "2019-11-22 06:37:10.829753", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Add IP Route to Tenant] *******************************************************************************************************************************
changed: [99.99.99.2] => (item={u'default_route_ip': u'192.168.129.1', u'name': u't1', u'pns_ip': u'192.168.129.1/24', u'tenant_if': u't1if', u'tenant_ip': u'192.168.129.2/24', u'pns_if': u't1pns_if'}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t1\" ip route show default | grep -w '[d]efault via 192.168.129.1' ; if [ $? -ne 0 ] ; then ip netns exec \"t1\" ip route add default via \"192.168.129.1\" ; fi\n", "delta": "0:00:00.082012", "end": "2019-11-22 06:37:11.460161", "item": {"default_route_ip": "192.168.129.1", "name": "t1", "pns_if": "t1pns_if", "pns_ip": "192.168.129.1/24", "tenant_if": "t1if", "tenant_ip": "192.168.129.2/24"}, "rc": 0, "start": "2019-11-22 06:37:11.378149", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Add IP Route to Tenant Subnet] ************************************************************************************************************************
changed: [99.99.99.2] => (item={u'route': [{u'ip': u'10.2.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.2.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.1.2/24', u'tenant_ns_ip': u'10.2.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_ns_name': u't1', u'tenant_sub_if': u't1s1if'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't1_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM4if1'}], u'vxlan': [{u'local_ip': u'10.2.1.2', u'tenant_route_ip': u'192.168.129.2', u'dsport': 4789, u'dev': u't1s1if', u'subnet_route': u'10.2.1.0/24', u'remote_route': u'10.1.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.1.1.2'}]}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t1ns1\" ip route show default | grep -w '[d]efault via 10.2.1.1' ; if [ $? -ne 0 ] ; then ip netns exec \"t1ns1\" ip route add default via \"10.2.1.1\" ; fi\n", "delta": "0:00:00.077500", "end": "2019-11-22 06:37:11.912166", "item": {"bridge_name": "t1br1", "default_route_ip": "10.2.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.2.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.2.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.2.1.2/24"}], "vms": [{"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM4", "vcpu": 4, "vmif": "t1VM4if1"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.1.2", "remote_ip": "10.1.1.2", "remote_route": "10.1.1.0/24", "subnet_route": "10.2.1.0/24", "tenant_route_ip": "192.168.129.2", "v_name": "vxlan_t1s1"}]}, "rc": 0, "start": "2019-11-22 06:37:11.834666", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Create bridge inside namespace] ***********************************************************************************************************************
changed: [99.99.99.2] => (item={u'route': [{u'ip': u'10.2.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.2.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.1.2/24', u'tenant_ns_ip': u'10.2.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_ns_name': u't1', u'tenant_sub_if': u't1s1if'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't1_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM4if1'}], u'vxlan': [{u'local_ip': u'10.2.1.2', u'tenant_route_ip': u'192.168.129.2', u'dsport': 4789, u'dev': u't1s1if', u'subnet_route': u'10.2.1.0/24', u'remote_route': u'10.1.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.1.1.2'}]}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t1ns1\" brctl show | grep -w '^t1br1'; if [ $? -ne 0 ] ; then ip netns exec \"t1ns1\" brctl addbr \"t1br1\" ; fi\nip netns exec \"t1ns1\" ip link set dev \"t1br1\" up\n", "delta": "0:00:00.116561", "end": "2019-11-22 06:37:12.404231", "item": {"bridge_name": "t1br1", "default_route_ip": "10.2.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.2.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.2.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.2.1.2/24"}], "vms": [{"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM4", "vcpu": 4, "vmif": "t1VM4if1"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.1.2", "remote_ip": "10.1.1.2", "remote_route": "10.1.1.0/24", "subnet_route": "10.2.1.0/24", "tenant_route_ip": "192.168.129.2", "v_name": "vxlan_t1s1"}]}, "rc": 0, "start": "2019-11-22 06:37:12.287670", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Create DNS VETH Pair] *********************************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.2.1.1', u'bridge_name': u't1br1', u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.1.2/24', u'tenant_ns_ip': u'10.2.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't1_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM4if1'}], u'vxlan': [{u'local_ip': u'10.2.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.129.2', u'remote_route': u'10.1.1.0/24', u'subnet_route': u'10.2.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.1.1.2'}]}, {u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t1ns1\" ip link show \"t1s1_dnsbrif\" ; if [ $? -ne 0 ] ; then ip netns exec \"t1ns1\" ip link add \"t1s1_dnsbrif\" type veth peer name \"t1s1_dnsif\" ; fi\nip netns exec \"t1ns1\" ip link set dev \"t1s1_dnsbrif\" up\nip netns exec \"t1ns1\" ip link set dev \"t1s1_dnsif\" up\n", "delta": "0:00:00.150566", "end": "2019-11-22 06:37:12.939986", "item": [{"bridge_name": "t1br1", "default_route_ip": "10.2.1.1", "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.2.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.2.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.2.1.2/24"}], "vms": [{"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM4", "vcpu": 4, "vmif": "t1VM4if1"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.1.2", "remote_ip": "10.1.1.2", "remote_route": "10.1.1.0/24", "subnet_route": "10.2.1.0/24", "tenant_route_ip": "192.168.129.2", "v_name": "vxlan_t1s1"}]}, {"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "rc": 0, "start": "2019-11-22 06:37:12.789420", "stderr": "Device \"t1s1_dnsbrif\" does not exist.", "stderr_lines": ["Device \"t1s1_dnsbrif\" does not exist."], "stdout": "", "stdout_lines": []}

TASK [Attach DNS VETH Pair] *********************************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.2.1.1', u'bridge_name': u't1br1', u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.1.2/24', u'tenant_ns_ip': u'10.2.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't1_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM4if1'}], u'vxlan': [{u'local_ip': u'10.2.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.129.2', u'remote_route': u'10.1.1.0/24', u'subnet_route': u'10.2.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.1.1.2'}]}, {u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t1ns1\" brctl show \"t1br1\" | grep -w 't1s1_dnsbrif' ; if [ $? -ne 0 ] ; then ip netns exec \"t1ns1\" brctl addif \"t1br1\" \"t1s1_dnsbrif\" ; fi\n", "delta": "0:00:00.077821", "end": "2019-11-22 06:37:13.408168", "item": [{"bridge_name": "t1br1", "default_route_ip": "10.2.1.1", "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.2.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.2.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.2.1.2/24"}], "vms": [{"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM4", "vcpu": 4, "vmif": "t1VM4if1"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.1.2", "remote_ip": "10.1.1.2", "remote_route": "10.1.1.0/24", "subnet_route": "10.2.1.0/24", "tenant_route_ip": "192.168.129.2", "v_name": "vxlan_t1s1"}]}, {"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "rc": 0, "start": "2019-11-22 06:37:13.330347", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Create VETH Pairs] ************************************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.2.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.1.2/24', u'tenant_ns_ip': u'10.2.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.2.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.129.2', u'remote_route': u'10.1.1.0/24', u'subnet_route': u'10.2.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.1.1.2'}]}, {u'mem': 2, u'name': u't1_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM4if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip link show \"t1br1if1\" ; if [ $? -ne 0 ] ; then ip link add \"t1VM4if1\" type veth peer name \"t1br1if1\" ; fi\nip link set dev \"t1br1if1\" up\nip link set dev \"t1VM4if1\" up\n", "delta": "0:00:00.016969", "end": "2019-11-22 06:37:13.822459", "item": [{"bridge_name": "t1br1", "default_route_ip": "10.2.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.2.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.2.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.2.1.2/24"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.1.2", "remote_ip": "10.1.1.2", "remote_route": "10.1.1.0/24", "subnet_route": "10.2.1.0/24", "tenant_route_ip": "192.168.129.2", "v_name": "vxlan_t1s1"}]}, {"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM4", "vcpu": 4, "vmif": "t1VM4if1"}], "rc": 0, "start": "2019-11-22 06:37:13.805490", "stderr": "Device \"t1br1if1\" does not exist.", "stderr_lines": ["Device \"t1br1if1\" does not exist."], "stdout": "", "stdout_lines": []}

TASK [Attach VETH Pairs] ************************************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.2.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.1.2/24', u'tenant_ns_ip': u'10.2.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.2.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.129.2', u'remote_route': u'10.1.1.0/24', u'subnet_route': u'10.2.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.1.1.2'}]}, {u'mem': 2, u'name': u't1_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM4if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip link show \"t1br1if1\" ; if [ $? -eq 0 ] ; then ip link set \"t1br1if1\" netns \"t1ns1\" ; fi\nip netns exec \"t1ns1\" brctl show \"t1br1\" | grep -w 't1br1if1' ; if [ $? -ne 0 ] ; then ip netns exec \"t1ns1\" brctl addif \"t1br1\" \"t1br1if1\" ; fi\n", "delta": "0:00:00.130214", "end": "2019-11-22 06:37:14.348018", "item": [{"bridge_name": "t1br1", "default_route_ip": "10.2.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.2.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.2.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.2.1.2/24"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.1.2", "remote_ip": "10.1.1.2", "remote_route": "10.1.1.0/24", "subnet_route": "10.2.1.0/24", "tenant_route_ip": "192.168.129.2", "v_name": "vxlan_t1s1"}]}, {"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM4", "vcpu": 4, "vmif": "t1VM4if1"}], "rc": 0, "start": "2019-11-22 06:37:14.217804", "stderr": "", "stderr_lines": [], "stdout": "18: t1br1if1@t1VM4if1: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP mode DEFAULT group default qlen 1000\n    link/ether 2e:54:d5:00:69:fa brd ff:ff:ff:ff:ff:ff", "stdout_lines": ["18: t1br1if1@t1VM4if1: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP mode DEFAULT group default qlen 1000", "    link/ether 2e:54:d5:00:69:fa brd ff:ff:ff:ff:ff:ff"]}

TASK [All interfaces and bridges UP] ************************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.2.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.1.2/24', u'tenant_ns_ip': u'10.2.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.2.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.129.2', u'remote_route': u'10.1.1.0/24', u'subnet_route': u'10.2.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.1.1.2'}]}, {u'mem': 2, u'name': u't1_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM4if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t1ns1\" ip link set \"t1br1if1\" up\nip netns exec \"t1ns1\" ip link set dev \"t1br1\" up\n", "delta": "0:00:00.073623", "end": "2019-11-22 06:37:14.824093", "item": [{"bridge_name": "t1br1", "default_route_ip": "10.2.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.2.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.2.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.2.1.2/24"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.1.2", "remote_ip": "10.1.1.2", "remote_route": "10.1.1.0/24", "subnet_route": "10.2.1.0/24", "tenant_route_ip": "192.168.129.2", "v_name": "vxlan_t1s1"}]}, {"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM4", "vcpu": 4, "vmif": "t1VM4if1"}], "rc": 0, "start": "2019-11-22 06:37:14.750470", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Add IP to DNS Interface] ******************************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.2.1.1', u'bridge_name': u't1br1', u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.1.2/24', u'tenant_ns_ip': u'10.2.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't1_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM4if1'}], u'vxlan': [{u'local_ip': u'10.2.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.129.2', u'remote_route': u'10.1.1.0/24', u'subnet_route': u'10.2.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.1.1.2'}]}, {u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t1ns1\" ip addr show \"t1s1_dnsif\" | awk 'FNR==3{ print $2}'| grep -w '^1.1.1.128/24' ; if [ $? -ne 0 ] ; then ip netns exec \"t1ns1\" ip addr add \"1.1.1.128/24\" dev \"t1s1_dnsif\" ; fi\n", "delta": "0:00:00.085084", "end": "2019-11-22 06:37:15.280151", "item": [{"bridge_name": "t1br1", "default_route_ip": "10.2.1.1", "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.2.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.2.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.2.1.2/24"}], "vms": [{"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM4", "vcpu": 4, "vmif": "t1VM4if1"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.1.2", "remote_ip": "10.1.1.2", "remote_route": "10.1.1.0/24", "subnet_route": "10.2.1.0/24", "tenant_route_ip": "192.168.129.2", "v_name": "vxlan_t1s1"}]}, {"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "rc": 0, "start": "2019-11-22 06:37:15.195067", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Install DHCP Server] **********************************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.2.1.1', u'bridge_name': u't1br1', u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.1.2/24', u'tenant_ns_ip': u'10.2.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't1_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM4if1'}], u'vxlan': [{u'local_ip': u'10.2.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.129.2', u'remote_route': u'10.1.1.0/24', u'subnet_route': u'10.2.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.1.1.2'}]}, {u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t1ns1\" ps aux | grep -w '[d]nsmasq --interface t1s1_dnsif -z --dhcp-range=1.1.1.133,1.1.1.254' ; if [ $? -ne 0 ] ; then ip netns exec \"t1ns1\" dnsmasq --interface \"t1s1_dnsif\" -z --dhcp-range=1.1.1.133,'1.1.1.254' ; fi\n", "delta": "0:00:00.088783", "end": "2019-11-22 06:37:15.770028", "item": [{"bridge_name": "t1br1", "default_route_ip": "10.2.1.1", "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.2.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.2.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.2.1.2/24"}], "vms": [{"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM4", "vcpu": 4, "vmif": "t1VM4if1"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.1.2", "remote_ip": "10.1.1.2", "remote_route": "10.1.1.0/24", "subnet_route": "10.2.1.0/24", "tenant_route_ip": "192.168.129.2", "v_name": "vxlan_t1s1"}]}, {"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "rc": 0, "start": "2019-11-22 06:37:15.681245", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Create VXLAN devices] *********************************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.2.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.1.2/24', u'tenant_ns_ip': u'10.2.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't1_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM4if1'}]}, {u'local_ip': u'10.2.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.129.2', u'remote_route': u'10.1.1.0/24', u'subnet_route': u'10.2.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.1.1.2'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t1ns1\" ip link show \"vxlan_t1s1\" ; if [ $? -ne 0 ] ; then ip netns exec \"t1ns1\" ip link add \"vxlan_t1s1\" type vxlan id \"42\" local \"10.2.1.2\" remote \"10.1.1.2\" dstport \"4789\" dev \"t1s1if\" ; ip netns exec \"t1ns1\" ip link set dev \"vxlan_t1s1\" up ; fi\n", "delta": "0:00:00.155988", "end": "2019-11-22 06:37:16.340037", "item": [{"bridge_name": "t1br1", "default_route_ip": "10.2.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.2.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.2.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.2.1.2/24"}], "vms": [{"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM4", "vcpu": 4, "vmif": "t1VM4if1"}]}, {"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.1.2", "remote_ip": "10.1.1.2", "remote_route": "10.1.1.0/24", "subnet_route": "10.2.1.0/24", "tenant_route_ip": "192.168.129.2", "v_name": "vxlan_t1s1"}], "rc": 0, "start": "2019-11-22 06:37:16.184049", "stderr": "Device \"vxlan_t1s1\" does not exist.", "stderr_lines": ["Device \"vxlan_t1s1\" does not exist."], "stdout": "", "stdout_lines": []}

TASK [Attach VXLANs to bridge] ******************************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.2.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.1.2/24', u'tenant_ns_ip': u'10.2.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't1_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM4if1'}]}, {u'local_ip': u'10.2.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.129.2', u'remote_route': u'10.1.1.0/24', u'subnet_route': u'10.2.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.1.1.2'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t1ns1\" brctl show \"t1br1\" | grep -w 'vxlan_t1s1' ; if [ $? -ne 0 ] ; then ip netns exec \"t1ns1\" brctl addif \"t1br1\" \"vxlan_t1s1\" ; fi\n", "delta": "0:00:00.076997", "end": "2019-11-22 06:37:16.844107", "item": [{"bridge_name": "t1br1", "default_route_ip": "10.2.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.2.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.2.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.2.1.2/24"}], "vms": [{"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM4", "vcpu": 4, "vmif": "t1VM4if1"}]}, {"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.1.2", "remote_ip": "10.1.1.2", "remote_route": "10.1.1.0/24", "subnet_route": "10.2.1.0/24", "tenant_route_ip": "192.168.129.2", "v_name": "vxlan_t1s1"}], "rc": 0, "start": "2019-11-22 06:37:16.767110", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

PLAY RECAP **************************************************************************************************************************************************
99.99.99.2                 : ok=21   changed=21   unreachable=0    failed=0    skipped=0    rescued=0    ignored=0   

Using /etc/ansible/ansible.cfg as config file
INFO:root: 06:40:33.251192 Printing the yaml input file
INFO:root: 06:40:33.251448 {'C1': [{'subnet_addr': '1.1.1.0/24', 'VM': [{'name': 'VM1', 'disk': '10G', 'mem': 2, 'vcpu': 4, 'internet_access': True}, {'name': 'VM2', 'disk': '10G', 'mem': 4, 'vcpu': 2, 'internet_access': False}]}, {'subnet_addr': '2.2.2.0/24', 'VM': [{'name': 'VM3', 'disk': '10G', 'mem': 3, 'vcpu': 2, 'internet_access': True}]}], 'C2': [{'subnet_addr': '1.1.1.0/24', 'VM': [{'name': 'VM4', 'disk': '10G', 'mem': 2, 'vcpu': 4, 'internet_access': True}]}]}
INFO:root: 06:40:33.251630 Provided subnet in C1: 1.1.1.0/24 is valid
INFO:root: 06:40:33.251710 Provided subnet in C1: 2.2.2.0/24 is valid
INFO:root: 06:40:33.251863 Provided subnet in C2: 1.1.1.0/24 is valid
Using /etc/ansible/ansible.cfg as config file

PLAY [main] *************************************************************************************************************************************************

TASK [Create Tenant Namespace] ******************************************************************************************************************************
ok: [localhost] => (item={u'default_route_ip': u'192.168.1.1', u'name': u't1', u'pns_ip': u'192.168.1.1/24', u'tenant_if': u't1if', u'tenant_ip': u'192.168.1.2/24', u'pns_if': u't1pns_if'}) => {"ansible_loop_var": "item", "changed": false, "cmd": ["ip", "netns", "add", "t1"], "item": {"default_route_ip": "192.168.1.1", "name": "t1", "pns_if": "t1pns_if", "pns_ip": "192.168.1.1/24", "tenant_if": "t1if", "tenant_ip": "192.168.1.2/24"}, "rc": 0, "stdout": "skipped, since /var/run/netns/t1 exists", "stdout_lines": ["skipped, since /var/run/netns/t1 exists"]}

TASK [Create Subnet Namespace] ******************************************************************************************************************************
ok: [localhost] => (item={u'route': [{u'ip': u'10.1.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.1.2/24', u'tenant_ns_ip': u'10.1.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_ns_name': u't1', u'tenant_sub_if': u't1s1if'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't1_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM1if1'}, {u'mem': 4, u'name': u't1_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br1if2', u'vmif': u't1VM2if1'}], u'vxlan': [{u'local_ip': u'10.1.1.2', u'tenant_route_ip': u'192.168.1.2', u'dsport': 4789, u'dev': u't1s1if', u'subnet_route': u'10.1.1.0/24', u'remote_route': u'10.2.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.2.1.2'}]}) => {"ansible_loop_var": "item", "changed": false, "cmd": ["ip", "netns", "add", "t1ns1"], "item": {"bridge_name": "t1br1", "default_route_ip": "10.1.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.1.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.1.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.1.1.2/24"}], "vms": [{"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM1", "vcpu": 4, "vmif": "t1VM1if1"}, {"brif": "t1br1if2", "disk": "10G", "mem": 4, "name": "t1_VM2", "vcpu": 2, "vmif": "t1VM2if1"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.1.2", "remote_ip": "10.2.1.2", "remote_route": "10.2.1.0/24", "subnet_route": "10.1.1.0/24", "tenant_route_ip": "192.168.1.2", "v_name": "vxlan_t1s1"}]}, "rc": 0, "stdout": "skipped, since /var/run/netns/t1ns1 exists", "stdout_lines": ["skipped, since /var/run/netns/t1ns1 exists"]}
ok: [localhost] => (item={u'route': [{u'ip': u'10.1.2.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.2.1', u'bridge_name': u't1br2', u'dns': [{u'dnsif': u't1s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s2_dnsbrif'}], u'ns_name': u't1ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.2.2/24', u'tenant_ns_ip': u'10.1.2.1/24', u'tenant_ns_if': u't1ns2if', u'tenant_ns_name': u't1', u'tenant_sub_if': u't1s2if'}], u'subnet_ip': u'2.2.2.0/24', u'vms': [{u'mem': 3, u'name': u't1_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br2if1', u'vmif': u't1VM3if1'}], u'vxlan': [{u'local_ip': [], u'tenant_route_ip': [], u'dsport': [], u'dev': [], u'subnet_route': [], u'remote_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}) => {"ansible_loop_var": "item", "changed": false, "cmd": ["ip", "netns", "add", "t1ns2"], "item": {"bridge_name": "t1br2", "default_route_ip": "10.1.2.1", "dns": [{"brif": "t1s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t1s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns2", "route": [{"if": "p1", "ip": "10.1.2.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "2.2.2.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns2if", "tenant_ns_ip": "10.1.2.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s2if", "tenant_sub_ip": "10.1.2.2/24"}], "vms": [{"brif": "t1br2if1", "disk": "10G", "mem": 3, "name": "t1_VM3", "vcpu": 2, "vmif": "t1VM3if1"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, "rc": 0, "stdout": "skipped, since /var/run/netns/t1ns2 exists", "stdout_lines": ["skipped, since /var/run/netns/t1ns2 exists"]}

TASK [Create Tenant VETH pairs] *****************************************************************************************************************************
changed: [localhost] => (item={u'default_route_ip': u'192.168.1.1', u'name': u't1', u'pns_ip': u'192.168.1.1/24', u'tenant_if': u't1if', u'tenant_ip': u'192.168.1.2/24', u'pns_if': u't1pns_if'}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip link show \"t1if\" ; if [ $? -ne 0 ] ; then ip link add \"t1if\" type veth peer name \"t1pns_if\" ; fi\n", "delta": "0:00:00.013045", "end": "2019-11-22 06:40:35.136607", "item": {"default_route_ip": "192.168.1.1", "name": "t1", "pns_if": "t1pns_if", "pns_ip": "192.168.1.1/24", "tenant_if": "t1if", "tenant_ip": "192.168.1.2/24"}, "rc": 0, "start": "2019-11-22 06:40:35.123562", "stderr": "Device \"t1if\" does not exist.", "stderr_lines": ["Device \"t1if\" does not exist."], "stdout": "", "stdout_lines": []}

TASK [Attach Tenant VETH Pairs] *****************************************************************************************************************************
changed: [localhost] => (item={u'default_route_ip': u'192.168.1.1', u'name': u't1', u'pns_ip': u'192.168.1.1/24', u'tenant_if': u't1if', u'tenant_ip': u'192.168.1.2/24', u'pns_if': u't1pns_if'}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec pns ip link show \"t1pns_if\" ; if [ $? -ne 0 ] ; then ip link set \"t1pns_if\" netns pns ; fi\nip netns exec \"t1\" ip link show \"t1if\" ; if [ $? -ne 0 ] ; then ip link set \"t1if\" netns \"t1\" ; fi\nip netns exec pns ip link set dev \"t1pns_if\" up\nip netns exec \"t1\" ip link set dev \"t1if\" up\n", "delta": "0:00:00.133472", "end": "2019-11-22 06:40:35.518248", "item": {"default_route_ip": "192.168.1.1", "name": "t1", "pns_if": "t1pns_if", "pns_ip": "192.168.1.1/24", "tenant_if": "t1if", "tenant_ip": "192.168.1.2/24"}, "rc": 0, "start": "2019-11-22 06:40:35.384776", "stderr": "", "stderr_lines": [], "stdout": "14: t1pns_if@if15: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP mode DEFAULT group default qlen 1000\n    link/ether d6:cc:3c:10:c8:cd brd ff:ff:ff:ff:ff:ff link-netnsid 1\n15: t1if@if14: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP mode DEFAULT group default qlen 1000\n    link/ether 36:f4:e2:3f:e4:d7 brd ff:ff:ff:ff:ff:ff link-netnsid 0", "stdout_lines": ["14: t1pns_if@if15: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP mode DEFAULT group default qlen 1000", "    link/ether d6:cc:3c:10:c8:cd brd ff:ff:ff:ff:ff:ff link-netnsid 1", "15: t1if@if14: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP mode DEFAULT group default qlen 1000", "    link/ether 36:f4:e2:3f:e4:d7 brd ff:ff:ff:ff:ff:ff link-netnsid 0"]}

TASK [Add IP addresses to Tenant VETH Pairs] ****************************************************************************************************************
changed: [localhost] => (item={u'default_route_ip': u'192.168.1.1', u'name': u't1', u'pns_ip': u'192.168.1.1/24', u'tenant_if': u't1if', u'tenant_ip': u'192.168.1.2/24', u'pns_if': u't1pns_if'}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec pns ip addr show \"t1pns_if\" | awk 'FNR==3{ print $2 }' | grep -w '^192.168.1.1/24' ; if [ $? -ne 0 ] ; then ip netns exec pns ip addr add \"192.168.1.1/24\" dev \"t1pns_if\" ; fi\nip netns exec \"t1\" ip addr show \"t1if\" | awk 'FNR==3{ print $2 }' | grep -w '^192.168.1.2/24' ; if [ $? -ne 0 ] ; then ip netns exec \"t1\" ip addr add \"192.168.1.2/24\" dev \"t1if\" ; fi\n", "delta": "0:00:00.070218", "end": "2019-11-22 06:40:35.858781", "item": {"default_route_ip": "192.168.1.1", "name": "t1", "pns_if": "t1pns_if", "pns_ip": "192.168.1.1/24", "tenant_if": "t1if", "tenant_ip": "192.168.1.2/24"}, "rc": 0, "start": "2019-11-22 06:40:35.788563", "stderr": "", "stderr_lines": [], "stdout": "192.168.1.1/24\n192.168.1.2/24", "stdout_lines": ["192.168.1.1/24", "192.168.1.2/24"]}

TASK [Create Namespace VETH Pairs] **************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't1_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM1if1'}, {u'mem': 4, u'name': u't1_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br1if2', u'vmif': u't1VM2if1'}], u'vxlan': [{u'local_ip': u'10.1.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.1.2', u'remote_route': u'10.2.1.0/24', u'subnet_route': u'10.1.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.2.1.2'}]}, {u'tenant_sub_ip': u'10.1.1.2/24', u'tenant_ns_ip': u'10.1.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip link show \"t1ns1if\" ; if [ $? -ne 0 ] ; then ip link add \"t1ns1if\" type veth peer name \"t1s1if\" ; fi\n", "delta": "0:00:00.009897", "end": "2019-11-22 06:40:36.155380", "item": [{"bridge_name": "t1br1", "default_route_ip": "10.1.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.1.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "vms": [{"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM1", "vcpu": 4, "vmif": "t1VM1if1"}, {"brif": "t1br1if2", "disk": "10G", "mem": 4, "name": "t1_VM2", "vcpu": 2, "vmif": "t1VM2if1"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.1.2", "remote_ip": "10.2.1.2", "remote_route": "10.2.1.0/24", "subnet_route": "10.1.1.0/24", "tenant_route_ip": "192.168.1.2", "v_name": "vxlan_t1s1"}]}, {"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.1.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.1.1.2/24"}], "rc": 0, "start": "2019-11-22 06:40:36.145483", "stderr": "Device \"t1ns1if\" does not exist.", "stderr_lines": ["Device \"t1ns1if\" does not exist."], "stdout": "", "stdout_lines": []}
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.2.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.2.1', u'bridge_name': u't1br2', u'dns': [{u'dnsif': u't1s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s2_dnsbrif'}], u'ns_name': u't1ns2', u'subnet_ip': u'2.2.2.0/24', u'vms': [{u'mem': 3, u'name': u't1_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br2if1', u'vmif': u't1VM3if1'}], u'vxlan': [{u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}, {u'tenant_sub_ip': u'10.1.2.2/24', u'tenant_ns_ip': u'10.1.2.1/24', u'tenant_ns_if': u't1ns2if', u'tenant_sub_if': u't1s2if', u'tenant_ns_name': u't1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip link show \"t1ns2if\" ; if [ $? -ne 0 ] ; then ip link add \"t1ns2if\" type veth peer name \"t1s2if\" ; fi\n", "delta": "0:00:00.012695", "end": "2019-11-22 06:40:36.398195", "item": [{"bridge_name": "t1br2", "default_route_ip": "10.1.2.1", "dns": [{"brif": "t1s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t1s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns2", "route": [{"if": "p1", "ip": "10.1.2.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "2.2.2.0/24", "vms": [{"brif": "t1br2if1", "disk": "10G", "mem": 3, "name": "t1_VM3", "vcpu": 2, "vmif": "t1VM3if1"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, {"tenant_ns_if": "t1ns2if", "tenant_ns_ip": "10.1.2.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s2if", "tenant_sub_ip": "10.1.2.2/24"}], "rc": 0, "start": "2019-11-22 06:40:36.385500", "stderr": "Device \"t1ns2if\" does not exist.", "stderr_lines": ["Device \"t1ns2if\" does not exist."], "stdout": "", "stdout_lines": []}

TASK [Attach Namespace VETH Pairs] **************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't1_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM1if1'}, {u'mem': 4, u'name': u't1_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br1if2', u'vmif': u't1VM2if1'}], u'vxlan': [{u'local_ip': u'10.1.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.1.2', u'remote_route': u'10.2.1.0/24', u'subnet_route': u'10.1.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.2.1.2'}]}, {u'tenant_sub_ip': u'10.1.1.2/24', u'tenant_ns_ip': u'10.1.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t1\" ip link show \"t1ns1if\" ; if [ $? -ne 0 ] ; then ip link set \"t1ns1if\" netns \"t1\" ; fi\nip netns exec \"t1ns1\" ip link show \"t1s1if\" ; if [ $? -ne 0 ] ; then ip link set \"t1s1if\" netns \"t1ns1\" ; fi\n", "delta": "0:00:00.080314", "end": "2019-11-22 06:40:36.782309", "item": [{"bridge_name": "t1br1", "default_route_ip": "10.1.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.1.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "vms": [{"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM1", "vcpu": 4, "vmif": "t1VM1if1"}, {"brif": "t1br1if2", "disk": "10G", "mem": 4, "name": "t1_VM2", "vcpu": 2, "vmif": "t1VM2if1"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.1.2", "remote_ip": "10.2.1.2", "remote_route": "10.2.1.0/24", "subnet_route": "10.1.1.0/24", "tenant_route_ip": "192.168.1.2", "v_name": "vxlan_t1s1"}]}, {"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.1.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.1.1.2/24"}], "rc": 0, "start": "2019-11-22 06:40:36.701995", "stderr": "", "stderr_lines": [], "stdout": "17: t1ns1if@if16: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP mode DEFAULT group default qlen 1000\n    link/ether 46:f3:8c:9c:ca:6d brd ff:ff:ff:ff:ff:ff link-netnsid 2\n16: t1s1if@if17: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP mode DEFAULT group default qlen 1000\n    link/ether 62:15:ca:47:3b:1d brd ff:ff:ff:ff:ff:ff link-netnsid 0", "stdout_lines": ["17: t1ns1if@if16: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP mode DEFAULT group default qlen 1000", "    link/ether 46:f3:8c:9c:ca:6d brd ff:ff:ff:ff:ff:ff link-netnsid 2", "16: t1s1if@if17: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP mode DEFAULT group default qlen 1000", "    link/ether 62:15:ca:47:3b:1d brd ff:ff:ff:ff:ff:ff link-netnsid 0"]}
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.2.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.2.1', u'bridge_name': u't1br2', u'dns': [{u'dnsif': u't1s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s2_dnsbrif'}], u'ns_name': u't1ns2', u'subnet_ip': u'2.2.2.0/24', u'vms': [{u'mem': 3, u'name': u't1_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br2if1', u'vmif': u't1VM3if1'}], u'vxlan': [{u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}, {u'tenant_sub_ip': u'10.1.2.2/24', u'tenant_ns_ip': u'10.1.2.1/24', u'tenant_ns_if': u't1ns2if', u'tenant_sub_if': u't1s2if', u'tenant_ns_name': u't1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t1\" ip link show \"t1ns2if\" ; if [ $? -ne 0 ] ; then ip link set \"t1ns2if\" netns \"t1\" ; fi\nip netns exec \"t1ns2\" ip link show \"t1s2if\" ; if [ $? -ne 0 ] ; then ip link set \"t1s2if\" netns \"t1ns2\" ; fi\n", "delta": "0:00:00.081059", "end": "2019-11-22 06:40:37.086255", "item": [{"bridge_name": "t1br2", "default_route_ip": "10.1.2.1", "dns": [{"brif": "t1s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t1s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns2", "route": [{"if": "p1", "ip": "10.1.2.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "2.2.2.0/24", "vms": [{"brif": "t1br2if1", "disk": "10G", "mem": 3, "name": "t1_VM3", "vcpu": 2, "vmif": "t1VM3if1"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, {"tenant_ns_if": "t1ns2if", "tenant_ns_ip": "10.1.2.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s2if", "tenant_sub_ip": "10.1.2.2/24"}], "rc": 0, "start": "2019-11-22 06:40:37.005196", "stderr": "", "stderr_lines": [], "stdout": "19: t1ns2if@if18: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP mode DEFAULT group default qlen 1000\n    link/ether ba:3f:18:27:db:c8 brd ff:ff:ff:ff:ff:ff link-netnsid 3\n18: t1s2if@if19: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP mode DEFAULT group default qlen 1000\n    link/ether d6:f7:39:91:be:e3 brd ff:ff:ff:ff:ff:ff link-netnsid 0", "stdout_lines": ["19: t1ns2if@if18: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP mode DEFAULT group default qlen 1000", "    link/ether ba:3f:18:27:db:c8 brd ff:ff:ff:ff:ff:ff link-netnsid 3", "18: t1s2if@if19: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP mode DEFAULT group default qlen 1000", "    link/ether d6:f7:39:91:be:e3 brd ff:ff:ff:ff:ff:ff link-netnsid 0"]}

TASK [Set Namespace VETH Pairs UP] **************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't1_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM1if1'}, {u'mem': 4, u'name': u't1_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br1if2', u'vmif': u't1VM2if1'}], u'vxlan': [{u'local_ip': u'10.1.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.1.2', u'remote_route': u'10.2.1.0/24', u'subnet_route': u'10.1.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.2.1.2'}]}, {u'tenant_sub_ip': u'10.1.1.2/24', u'tenant_ns_ip': u'10.1.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t1\" ip link set dev \"t1ns1if\" up\nip netns exec \"t1ns1\" ip link set dev \"t1s1if\" up\n", "delta": "0:00:00.070710", "end": "2019-11-22 06:40:37.438526", "item": [{"bridge_name": "t1br1", "default_route_ip": "10.1.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.1.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "vms": [{"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM1", "vcpu": 4, "vmif": "t1VM1if1"}, {"brif": "t1br1if2", "disk": "10G", "mem": 4, "name": "t1_VM2", "vcpu": 2, "vmif": "t1VM2if1"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.1.2", "remote_ip": "10.2.1.2", "remote_route": "10.2.1.0/24", "subnet_route": "10.1.1.0/24", "tenant_route_ip": "192.168.1.2", "v_name": "vxlan_t1s1"}]}, {"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.1.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.1.1.2/24"}], "rc": 0, "start": "2019-11-22 06:40:37.367816", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.2.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.2.1', u'bridge_name': u't1br2', u'dns': [{u'dnsif': u't1s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s2_dnsbrif'}], u'ns_name': u't1ns2', u'subnet_ip': u'2.2.2.0/24', u'vms': [{u'mem': 3, u'name': u't1_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br2if1', u'vmif': u't1VM3if1'}], u'vxlan': [{u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}, {u'tenant_sub_ip': u'10.1.2.2/24', u'tenant_ns_ip': u'10.1.2.1/24', u'tenant_ns_if': u't1ns2if', u'tenant_sub_if': u't1s2if', u'tenant_ns_name': u't1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t1\" ip link set dev \"t1ns2if\" up\nip netns exec \"t1ns2\" ip link set dev \"t1s2if\" up\n", "delta": "0:00:00.065545", "end": "2019-11-22 06:40:37.718122", "item": [{"bridge_name": "t1br2", "default_route_ip": "10.1.2.1", "dns": [{"brif": "t1s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t1s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns2", "route": [{"if": "p1", "ip": "10.1.2.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "2.2.2.0/24", "vms": [{"brif": "t1br2if1", "disk": "10G", "mem": 3, "name": "t1_VM3", "vcpu": 2, "vmif": "t1VM3if1"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, {"tenant_ns_if": "t1ns2if", "tenant_ns_ip": "10.1.2.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s2if", "tenant_sub_ip": "10.1.2.2/24"}], "rc": 0, "start": "2019-11-22 06:40:37.652577", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Add IP addresses to Namespace VETH Pairs] *************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't1_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM1if1'}, {u'mem': 4, u'name': u't1_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br1if2', u'vmif': u't1VM2if1'}], u'vxlan': [{u'local_ip': u'10.1.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.1.2', u'remote_route': u'10.2.1.0/24', u'subnet_route': u'10.1.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.2.1.2'}]}, {u'tenant_sub_ip': u'10.1.1.2/24', u'tenant_ns_ip': u'10.1.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t1ns1\" ip addr show \"t1s1if\" | awk 'FNR==3{ print $2 }' | grep -w '^10.1.1.2/24' ; if [ $? -ne 0 ] ; then ip netns exec \"t1ns1\" ip addr add \"10.1.1.2/24\" dev \"t1s1if\" ; fi\n\nip netns exec \"t1\" ip addr show \"t1ns1if\" | awk 'FNR==3{ print $2 }' | grep -w '^10.1.1.1/24' ; if [ $? -ne 0 ] ; then ip netns exec \"t1\" ip addr add \"10.1.1.1/24\" dev \"t1ns1if\" ; fi\n", "delta": "0:00:00.068076", "end": "2019-11-22 06:40:38.046857", "item": [{"bridge_name": "t1br1", "default_route_ip": "10.1.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.1.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "vms": [{"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM1", "vcpu": 4, "vmif": "t1VM1if1"}, {"brif": "t1br1if2", "disk": "10G", "mem": 4, "name": "t1_VM2", "vcpu": 2, "vmif": "t1VM2if1"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.1.2", "remote_ip": "10.2.1.2", "remote_route": "10.2.1.0/24", "subnet_route": "10.1.1.0/24", "tenant_route_ip": "192.168.1.2", "v_name": "vxlan_t1s1"}]}, {"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.1.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.1.1.2/24"}], "rc": 0, "start": "2019-11-22 06:40:37.978781", "stderr": "", "stderr_lines": [], "stdout": "10.1.1.2/24\n10.1.1.1/24", "stdout_lines": ["10.1.1.2/24", "10.1.1.1/24"]}
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.2.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.2.1', u'bridge_name': u't1br2', u'dns': [{u'dnsif': u't1s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s2_dnsbrif'}], u'ns_name': u't1ns2', u'subnet_ip': u'2.2.2.0/24', u'vms': [{u'mem': 3, u'name': u't1_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br2if1', u'vmif': u't1VM3if1'}], u'vxlan': [{u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}, {u'tenant_sub_ip': u'10.1.2.2/24', u'tenant_ns_ip': u'10.1.2.1/24', u'tenant_ns_if': u't1ns2if', u'tenant_sub_if': u't1s2if', u'tenant_ns_name': u't1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t1ns2\" ip addr show \"t1s2if\" | awk 'FNR==3{ print $2 }' | grep -w '^10.1.2.2/24' ; if [ $? -ne 0 ] ; then ip netns exec \"t1ns2\" ip addr add \"10.1.2.2/24\" dev \"t1s2if\" ; fi\n\nip netns exec \"t1\" ip addr show \"t1ns2if\" | awk 'FNR==3{ print $2 }' | grep -w '^10.1.2.1/24' ; if [ $? -ne 0 ] ; then ip netns exec \"t1\" ip addr add \"10.1.2.1/24\" dev \"t1ns2if\" ; fi\n", "delta": "0:00:00.064138", "end": "2019-11-22 06:40:38.314499", "item": [{"bridge_name": "t1br2", "default_route_ip": "10.1.2.1", "dns": [{"brif": "t1s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t1s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns2", "route": [{"if": "p1", "ip": "10.1.2.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "2.2.2.0/24", "vms": [{"brif": "t1br2if1", "disk": "10G", "mem": 3, "name": "t1_VM3", "vcpu": 2, "vmif": "t1VM3if1"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, {"tenant_ns_if": "t1ns2if", "tenant_ns_ip": "10.1.2.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s2if", "tenant_sub_ip": "10.1.2.2/24"}], "rc": 0, "start": "2019-11-22 06:40:38.250361", "stderr": "", "stderr_lines": [], "stdout": "10.1.2.2/24\n10.1.2.1/24", "stdout_lines": ["10.1.2.2/24", "10.1.2.1/24"]}

TASK [Add IP Route to Tenant] *******************************************************************************************************************************
changed: [localhost] => (item={u'default_route_ip': u'192.168.1.1', u'name': u't1', u'pns_ip': u'192.168.1.1/24', u'tenant_if': u't1if', u'tenant_ip': u'192.168.1.2/24', u'pns_if': u't1pns_if'}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t1\" ip route show default | grep -w '[d]efault via 192.168.1.1' ; if [ $? -ne 0 ] ; then ip netns exec \"t1\" ip route add default via \"192.168.1.1\" ; fi\n", "delta": "0:00:00.038303", "end": "2019-11-22 06:40:38.618485", "item": {"default_route_ip": "192.168.1.1", "name": "t1", "pns_if": "t1pns_if", "pns_ip": "192.168.1.1/24", "tenant_if": "t1if", "tenant_ip": "192.168.1.2/24"}, "rc": 0, "start": "2019-11-22 06:40:38.580182", "stderr": "", "stderr_lines": [], "stdout": "default via 192.168.1.1 dev t1if ", "stdout_lines": ["default via 192.168.1.1 dev t1if "]}

TASK [Add IP Route to Tenant Subnet] ************************************************************************************************************************
changed: [localhost] => (item={u'route': [{u'ip': u'10.1.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.1.2/24', u'tenant_ns_ip': u'10.1.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_ns_name': u't1', u'tenant_sub_if': u't1s1if'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't1_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM1if1'}, {u'mem': 4, u'name': u't1_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br1if2', u'vmif': u't1VM2if1'}], u'vxlan': [{u'local_ip': u'10.1.1.2', u'tenant_route_ip': u'192.168.1.2', u'dsport': 4789, u'dev': u't1s1if', u'subnet_route': u'10.1.1.0/24', u'remote_route': u'10.2.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.2.1.2'}]}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t1ns1\" ip route show default | grep -w '[d]efault via 10.1.1.1' ; if [ $? -ne 0 ] ; then ip netns exec \"t1ns1\" ip route add default via \"10.1.1.1\" ; fi\n", "delta": "0:00:00.052143", "end": "2019-11-22 06:40:38.958424", "item": {"bridge_name": "t1br1", "default_route_ip": "10.1.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.1.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.1.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.1.1.2/24"}], "vms": [{"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM1", "vcpu": 4, "vmif": "t1VM1if1"}, {"brif": "t1br1if2", "disk": "10G", "mem": 4, "name": "t1_VM2", "vcpu": 2, "vmif": "t1VM2if1"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.1.2", "remote_ip": "10.2.1.2", "remote_route": "10.2.1.0/24", "subnet_route": "10.1.1.0/24", "tenant_route_ip": "192.168.1.2", "v_name": "vxlan_t1s1"}]}, "rc": 0, "start": "2019-11-22 06:40:38.906281", "stderr": "", "stderr_lines": [], "stdout": "default via 10.1.1.1 dev t1s1if ", "stdout_lines": ["default via 10.1.1.1 dev t1s1if "]}
changed: [localhost] => (item={u'route': [{u'ip': u'10.1.2.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.2.1', u'bridge_name': u't1br2', u'dns': [{u'dnsif': u't1s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s2_dnsbrif'}], u'ns_name': u't1ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.2.2/24', u'tenant_ns_ip': u'10.1.2.1/24', u'tenant_ns_if': u't1ns2if', u'tenant_ns_name': u't1', u'tenant_sub_if': u't1s2if'}], u'subnet_ip': u'2.2.2.0/24', u'vms': [{u'mem': 3, u'name': u't1_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br2if1', u'vmif': u't1VM3if1'}], u'vxlan': [{u'local_ip': [], u'tenant_route_ip': [], u'dsport': [], u'dev': [], u'subnet_route': [], u'remote_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t1ns2\" ip route show default | grep -w '[d]efault via 10.1.2.1' ; if [ $? -ne 0 ] ; then ip netns exec \"t1ns2\" ip route add default via \"10.1.2.1\" ; fi\n", "delta": "0:00:00.039413", "end": "2019-11-22 06:40:39.214462", "item": {"bridge_name": "t1br2", "default_route_ip": "10.1.2.1", "dns": [{"brif": "t1s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t1s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns2", "route": [{"if": "p1", "ip": "10.1.2.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "2.2.2.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns2if", "tenant_ns_ip": "10.1.2.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s2if", "tenant_sub_ip": "10.1.2.2/24"}], "vms": [{"brif": "t1br2if1", "disk": "10G", "mem": 3, "name": "t1_VM3", "vcpu": 2, "vmif": "t1VM3if1"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, "rc": 0, "start": "2019-11-22 06:40:39.175049", "stderr": "", "stderr_lines": [], "stdout": "default via 10.1.2.1 dev t1s2if ", "stdout_lines": ["default via 10.1.2.1 dev t1s2if "]}

TASK [Create bridge inside namespace] ***********************************************************************************************************************
changed: [localhost] => (item={u'route': [{u'ip': u'10.1.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.1.2/24', u'tenant_ns_ip': u'10.1.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_ns_name': u't1', u'tenant_sub_if': u't1s1if'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't1_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM1if1'}, {u'mem': 4, u'name': u't1_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br1if2', u'vmif': u't1VM2if1'}], u'vxlan': [{u'local_ip': u'10.1.1.2', u'tenant_route_ip': u'192.168.1.2', u'dsport': 4789, u'dev': u't1s1if', u'subnet_route': u'10.1.1.0/24', u'remote_route': u'10.2.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.2.1.2'}]}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t1ns1\" brctl show | grep -w '^t1br1'; if [ $? -ne 0 ] ; then ip netns exec \"t1ns1\" brctl addbr \"t1br1\" ; fi\nip netns exec \"t1ns1\" ip link set dev \"t1br1\" up\n", "delta": "0:00:00.075733", "end": "2019-11-22 06:40:39.574190", "item": {"bridge_name": "t1br1", "default_route_ip": "10.1.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.1.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.1.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.1.1.2/24"}], "vms": [{"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM1", "vcpu": 4, "vmif": "t1VM1if1"}, {"brif": "t1br1if2", "disk": "10G", "mem": 4, "name": "t1_VM2", "vcpu": 2, "vmif": "t1VM2if1"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.1.2", "remote_ip": "10.2.1.2", "remote_route": "10.2.1.0/24", "subnet_route": "10.1.1.0/24", "tenant_route_ip": "192.168.1.2", "v_name": "vxlan_t1s1"}]}, "rc": 0, "start": "2019-11-22 06:40:39.498457", "stderr": "", "stderr_lines": [], "stdout": "t1br1\t\t8000.4679e2aabaf9\tno\t\tt1br1if1", "stdout_lines": ["t1br1\t\t8000.4679e2aabaf9\tno\t\tt1br1if1"]}
changed: [localhost] => (item={u'route': [{u'ip': u'10.1.2.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.2.1', u'bridge_name': u't1br2', u'dns': [{u'dnsif': u't1s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s2_dnsbrif'}], u'ns_name': u't1ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.2.2/24', u'tenant_ns_ip': u'10.1.2.1/24', u'tenant_ns_if': u't1ns2if', u'tenant_ns_name': u't1', u'tenant_sub_if': u't1s2if'}], u'subnet_ip': u'2.2.2.0/24', u'vms': [{u'mem': 3, u'name': u't1_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br2if1', u'vmif': u't1VM3if1'}], u'vxlan': [{u'local_ip': [], u'tenant_route_ip': [], u'dsport': [], u'dev': [], u'subnet_route': [], u'remote_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t1ns2\" brctl show | grep -w '^t1br2'; if [ $? -ne 0 ] ; then ip netns exec \"t1ns2\" brctl addbr \"t1br2\" ; fi\nip netns exec \"t1ns2\" ip link set dev \"t1br2\" up\n", "delta": "0:00:00.079375", "end": "2019-11-22 06:40:39.886405", "item": {"bridge_name": "t1br2", "default_route_ip": "10.1.2.1", "dns": [{"brif": "t1s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t1s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns2", "route": [{"if": "p1", "ip": "10.1.2.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "2.2.2.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns2if", "tenant_ns_ip": "10.1.2.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s2if", "tenant_sub_ip": "10.1.2.2/24"}], "vms": [{"brif": "t1br2if1", "disk": "10G", "mem": 3, "name": "t1_VM3", "vcpu": 2, "vmif": "t1VM3if1"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, "rc": 0, "start": "2019-11-22 06:40:39.807030", "stderr": "", "stderr_lines": [], "stdout": "t1br2\t\t8000.225af8b64bfa\tno\t\tt1br2if1", "stdout_lines": ["t1br2\t\t8000.225af8b64bfa\tno\t\tt1br2if1"]}

TASK [Create DNS VETH Pair] *********************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.1.1', u'bridge_name': u't1br1', u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.1.2/24', u'tenant_ns_ip': u'10.1.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't1_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM1if1'}, {u'mem': 4, u'name': u't1_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br1if2', u'vmif': u't1VM2if1'}], u'vxlan': [{u'local_ip': u'10.1.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.1.2', u'remote_route': u'10.2.1.0/24', u'subnet_route': u'10.1.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.2.1.2'}]}, {u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t1ns1\" ip link show \"t1s1_dnsbrif\" ; if [ $? -ne 0 ] ; then ip netns exec \"t1ns1\" ip link add \"t1s1_dnsbrif\" type veth peer name \"t1s1_dnsif\" ; fi\nip netns exec \"t1ns1\" ip link set dev \"t1s1_dnsbrif\" up\nip netns exec \"t1ns1\" ip link set dev \"t1s1_dnsif\" up\n", "delta": "0:00:00.112485", "end": "2019-11-22 06:40:40.294377", "item": [{"bridge_name": "t1br1", "default_route_ip": "10.1.1.1", "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.1.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.1.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.1.1.2/24"}], "vms": [{"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM1", "vcpu": 4, "vmif": "t1VM1if1"}, {"brif": "t1br1if2", "disk": "10G", "mem": 4, "name": "t1_VM2", "vcpu": 2, "vmif": "t1VM2if1"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.1.2", "remote_ip": "10.2.1.2", "remote_route": "10.2.1.0/24", "subnet_route": "10.1.1.0/24", "tenant_route_ip": "192.168.1.2", "v_name": "vxlan_t1s1"}]}, {"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "rc": 0, "start": "2019-11-22 06:40:40.181892", "stderr": "", "stderr_lines": [], "stdout": "4: t1s1_dnsbrif@t1s1_dnsif: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue master t1br1 state UP mode DEFAULT group default qlen 1000\n    link/ether 4e:a8:79:10:75:b7 brd ff:ff:ff:ff:ff:ff", "stdout_lines": ["4: t1s1_dnsbrif@t1s1_dnsif: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue master t1br1 state UP mode DEFAULT group default qlen 1000", "    link/ether 4e:a8:79:10:75:b7 brd ff:ff:ff:ff:ff:ff"]}
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.2.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.2.1', u'bridge_name': u't1br2', u'ns_name': u't1ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.2.2/24', u'tenant_ns_ip': u'10.1.2.1/24', u'tenant_ns_if': u't1ns2if', u'tenant_sub_if': u't1s2if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'2.2.2.0/24', u'vms': [{u'mem': 3, u'name': u't1_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br2if1', u'vmif': u't1VM3if1'}], u'vxlan': [{u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}, {u'dnsif': u't1s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s2_dnsbrif'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t1ns2\" ip link show \"t1s2_dnsbrif\" ; if [ $? -ne 0 ] ; then ip netns exec \"t1ns2\" ip link add \"t1s2_dnsbrif\" type veth peer name \"t1s2_dnsif\" ; fi\nip netns exec \"t1ns2\" ip link set dev \"t1s2_dnsbrif\" up\nip netns exec \"t1ns2\" ip link set dev \"t1s2_dnsif\" up\n", "delta": "0:00:00.107767", "end": "2019-11-22 06:40:40.630336", "item": [{"bridge_name": "t1br2", "default_route_ip": "10.1.2.1", "ns_name": "t1ns2", "route": [{"if": "p1", "ip": "10.1.2.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "2.2.2.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns2if", "tenant_ns_ip": "10.1.2.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s2if", "tenant_sub_ip": "10.1.2.2/24"}], "vms": [{"brif": "t1br2if1", "disk": "10G", "mem": 3, "name": "t1_VM3", "vcpu": 2, "vmif": "t1VM3if1"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, {"brif": "t1s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t1s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "rc": 0, "start": "2019-11-22 06:40:40.522569", "stderr": "", "stderr_lines": [], "stdout": "4: t1s2_dnsbrif@t1s2_dnsif: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue master t1br2 state UP mode DEFAULT group default qlen 1000\n    link/ether 76:f4:fa:92:f1:18 brd ff:ff:ff:ff:ff:ff", "stdout_lines": ["4: t1s2_dnsbrif@t1s2_dnsif: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue master t1br2 state UP mode DEFAULT group default qlen 1000", "    link/ether 76:f4:fa:92:f1:18 brd ff:ff:ff:ff:ff:ff"]}

TASK [Attach DNS VETH Pair] *********************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.1.1', u'bridge_name': u't1br1', u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.1.2/24', u'tenant_ns_ip': u'10.1.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't1_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM1if1'}, {u'mem': 4, u'name': u't1_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br1if2', u'vmif': u't1VM2if1'}], u'vxlan': [{u'local_ip': u'10.1.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.1.2', u'remote_route': u'10.2.1.0/24', u'subnet_route': u'10.1.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.2.1.2'}]}, {u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t1ns1\" brctl show \"t1br1\" | grep -w 't1s1_dnsbrif' ; if [ $? -ne 0 ] ; then ip netns exec \"t1ns1\" brctl addif \"t1br1\" \"t1s1_dnsbrif\" ; fi\n", "delta": "0:00:00.039842", "end": "2019-11-22 06:40:40.930508", "item": [{"bridge_name": "t1br1", "default_route_ip": "10.1.1.1", "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.1.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.1.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.1.1.2/24"}], "vms": [{"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM1", "vcpu": 4, "vmif": "t1VM1if1"}, {"brif": "t1br1if2", "disk": "10G", "mem": 4, "name": "t1_VM2", "vcpu": 2, "vmif": "t1VM2if1"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.1.2", "remote_ip": "10.2.1.2", "remote_route": "10.2.1.0/24", "subnet_route": "10.1.1.0/24", "tenant_route_ip": "192.168.1.2", "v_name": "vxlan_t1s1"}]}, {"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "rc": 0, "start": "2019-11-22 06:40:40.890666", "stderr": "", "stderr_lines": [], "stdout": "\t\t\t\t\t\t\tt1s1_dnsbrif", "stdout_lines": ["\t\t\t\t\t\t\tt1s1_dnsbrif"]}
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.2.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.2.1', u'bridge_name': u't1br2', u'ns_name': u't1ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.2.2/24', u'tenant_ns_ip': u'10.1.2.1/24', u'tenant_ns_if': u't1ns2if', u'tenant_sub_if': u't1s2if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'2.2.2.0/24', u'vms': [{u'mem': 3, u'name': u't1_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br2if1', u'vmif': u't1VM3if1'}], u'vxlan': [{u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}, {u'dnsif': u't1s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s2_dnsbrif'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t1ns2\" brctl show \"t1br2\" | grep -w 't1s2_dnsbrif' ; if [ $? -ne 0 ] ; then ip netns exec \"t1ns2\" brctl addif \"t1br2\" \"t1s2_dnsbrif\" ; fi\n", "delta": "0:00:00.031874", "end": "2019-11-22 06:40:41.154242", "item": [{"bridge_name": "t1br2", "default_route_ip": "10.1.2.1", "ns_name": "t1ns2", "route": [{"if": "p1", "ip": "10.1.2.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "2.2.2.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns2if", "tenant_ns_ip": "10.1.2.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s2if", "tenant_sub_ip": "10.1.2.2/24"}], "vms": [{"brif": "t1br2if1", "disk": "10G", "mem": 3, "name": "t1_VM3", "vcpu": 2, "vmif": "t1VM3if1"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, {"brif": "t1s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t1s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "rc": 0, "start": "2019-11-22 06:40:41.122368", "stderr": "", "stderr_lines": [], "stdout": "\t\t\t\t\t\t\tt1s2_dnsbrif", "stdout_lines": ["\t\t\t\t\t\t\tt1s2_dnsbrif"]}

TASK [Create VETH Pairs] ************************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.1.2/24', u'tenant_ns_ip': u'10.1.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.1.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.1.2', u'remote_route': u'10.2.1.0/24', u'subnet_route': u'10.1.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.2.1.2'}]}, {u'mem': 2, u'name': u't1_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM1if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip link show \"t1br1if1\" ; if [ $? -ne 0 ] ; then ip link add \"t1VM1if1\" type veth peer name \"t1br1if1\" ; fi\nip link set dev \"t1br1if1\" up\nip link set dev \"t1VM1if1\" up\n", "delta": "0:00:00.011850", "end": "2019-11-22 06:40:41.417135", "item": [{"bridge_name": "t1br1", "default_route_ip": "10.1.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.1.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.1.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.1.1.2/24"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.1.2", "remote_ip": "10.2.1.2", "remote_route": "10.2.1.0/24", "subnet_route": "10.1.1.0/24", "tenant_route_ip": "192.168.1.2", "v_name": "vxlan_t1s1"}]}, {"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM1", "vcpu": 4, "vmif": "t1VM1if1"}], "rc": 0, "start": "2019-11-22 06:40:41.405285", "stderr": "Device \"t1br1if1\" does not exist.\nRTNETLINK answers: File exists\nCannot find device \"t1br1if1\"", "stderr_lines": ["Device \"t1br1if1\" does not exist.", "RTNETLINK answers: File exists", "Cannot find device \"t1br1if1\""], "stdout": "", "stdout_lines": []}
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.1.2/24', u'tenant_ns_ip': u'10.1.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.1.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.1.2', u'remote_route': u'10.2.1.0/24', u'subnet_route': u'10.1.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.2.1.2'}]}, {u'mem': 4, u'name': u't1_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br1if2', u'vmif': u't1VM2if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip link show \"t1br1if2\" ; if [ $? -ne 0 ] ; then ip link add \"t1VM2if1\" type veth peer name \"t1br1if2\" ; fi\nip link set dev \"t1br1if2\" up\nip link set dev \"t1VM2if1\" up\n", "delta": "0:00:00.012975", "end": "2019-11-22 06:40:41.620399", "item": [{"bridge_name": "t1br1", "default_route_ip": "10.1.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.1.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.1.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.1.1.2/24"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.1.2", "remote_ip": "10.2.1.2", "remote_route": "10.2.1.0/24", "subnet_route": "10.1.1.0/24", "tenant_route_ip": "192.168.1.2", "v_name": "vxlan_t1s1"}]}, {"brif": "t1br1if2", "disk": "10G", "mem": 4, "name": "t1_VM2", "vcpu": 2, "vmif": "t1VM2if1"}], "rc": 0, "start": "2019-11-22 06:40:41.607424", "stderr": "Device \"t1br1if2\" does not exist.\nRTNETLINK answers: File exists\nCannot find device \"t1br1if2\"", "stderr_lines": ["Device \"t1br1if2\" does not exist.", "RTNETLINK answers: File exists", "Cannot find device \"t1br1if2\""], "stdout": "", "stdout_lines": []}
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.2.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.2.1', u'bridge_name': u't1br2', u'dns': [{u'dnsif': u't1s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s2_dnsbrif'}], u'ns_name': u't1ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.2.2/24', u'tenant_ns_ip': u'10.1.2.1/24', u'tenant_ns_if': u't1ns2if', u'tenant_sub_if': u't1s2if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'2.2.2.0/24', u'vxlan': [{u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}, {u'mem': 3, u'name': u't1_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br2if1', u'vmif': u't1VM3if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip link show \"t1br2if1\" ; if [ $? -ne 0 ] ; then ip link add \"t1VM3if1\" type veth peer name \"t1br2if1\" ; fi\nip link set dev \"t1br2if1\" up\nip link set dev \"t1VM3if1\" up\n", "delta": "0:00:00.013103", "end": "2019-11-22 06:40:41.839092", "item": [{"bridge_name": "t1br2", "default_route_ip": "10.1.2.1", "dns": [{"brif": "t1s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t1s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns2", "route": [{"if": "p1", "ip": "10.1.2.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "2.2.2.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns2if", "tenant_ns_ip": "10.1.2.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s2if", "tenant_sub_ip": "10.1.2.2/24"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, {"brif": "t1br2if1", "disk": "10G", "mem": 3, "name": "t1_VM3", "vcpu": 2, "vmif": "t1VM3if1"}], "rc": 0, "start": "2019-11-22 06:40:41.825989", "stderr": "Device \"t1br2if1\" does not exist.\nRTNETLINK answers: File exists\nCannot find device \"t1br2if1\"", "stderr_lines": ["Device \"t1br2if1\" does not exist.", "RTNETLINK answers: File exists", "Cannot find device \"t1br2if1\""], "stdout": "", "stdout_lines": []}

TASK [Attach VETH Pairs] ************************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.1.2/24', u'tenant_ns_ip': u'10.1.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.1.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.1.2', u'remote_route': u'10.2.1.0/24', u'subnet_route': u'10.1.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.2.1.2'}]}, {u'mem': 2, u'name': u't1_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM1if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip link show \"t1br1if1\" ; if [ $? -eq 0 ] ; then ip link set \"t1br1if1\" netns \"t1ns1\" ; fi\nip netns exec \"t1ns1\" brctl show \"t1br1\" | grep -w 't1br1if1' ; if [ $? -ne 0 ] ; then ip netns exec \"t1ns1\" brctl addif \"t1br1\" \"t1br1if1\" ; fi\n", "delta": "0:00:00.058468", "end": "2019-11-22 06:40:42.186418", "item": [{"bridge_name": "t1br1", "default_route_ip": "10.1.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.1.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.1.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.1.1.2/24"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.1.2", "remote_ip": "10.2.1.2", "remote_route": "10.2.1.0/24", "subnet_route": "10.1.1.0/24", "tenant_route_ip": "192.168.1.2", "v_name": "vxlan_t1s1"}]}, {"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM1", "vcpu": 4, "vmif": "t1VM1if1"}], "rc": 0, "start": "2019-11-22 06:40:42.127950", "stderr": "Device \"t1br1if1\" does not exist.", "stderr_lines": ["Device \"t1br1if1\" does not exist."], "stdout": "t1br1\t\t8000.4679e2aabaf9\tno\t\tt1br1if1", "stdout_lines": ["t1br1\t\t8000.4679e2aabaf9\tno\t\tt1br1if1"]}
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.1.2/24', u'tenant_ns_ip': u'10.1.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.1.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.1.2', u'remote_route': u'10.2.1.0/24', u'subnet_route': u'10.1.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.2.1.2'}]}, {u'mem': 4, u'name': u't1_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br1if2', u'vmif': u't1VM2if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip link show \"t1br1if2\" ; if [ $? -eq 0 ] ; then ip link set \"t1br1if2\" netns \"t1ns1\" ; fi\nip netns exec \"t1ns1\" brctl show \"t1br1\" | grep -w 't1br1if2' ; if [ $? -ne 0 ] ; then ip netns exec \"t1ns1\" brctl addif \"t1br1\" \"t1br1if2\" ; fi\n", "delta": "0:00:00.047055", "end": "2019-11-22 06:40:42.442391", "item": [{"bridge_name": "t1br1", "default_route_ip": "10.1.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.1.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.1.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.1.1.2/24"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.1.2", "remote_ip": "10.2.1.2", "remote_route": "10.2.1.0/24", "subnet_route": "10.1.1.0/24", "tenant_route_ip": "192.168.1.2", "v_name": "vxlan_t1s1"}]}, {"brif": "t1br1if2", "disk": "10G", "mem": 4, "name": "t1_VM2", "vcpu": 2, "vmif": "t1VM2if1"}], "rc": 0, "start": "2019-11-22 06:40:42.395336", "stderr": "Device \"t1br1if2\" does not exist.", "stderr_lines": ["Device \"t1br1if2\" does not exist."], "stdout": "\t\t\t\t\t\t\tt1br1if2", "stdout_lines": ["\t\t\t\t\t\t\tt1br1if2"]}
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.2.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.2.1', u'bridge_name': u't1br2', u'dns': [{u'dnsif': u't1s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s2_dnsbrif'}], u'ns_name': u't1ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.2.2/24', u'tenant_ns_ip': u'10.1.2.1/24', u'tenant_ns_if': u't1ns2if', u'tenant_sub_if': u't1s2if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'2.2.2.0/24', u'vxlan': [{u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}, {u'mem': 3, u'name': u't1_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br2if1', u'vmif': u't1VM3if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip link show \"t1br2if1\" ; if [ $? -eq 0 ] ; then ip link set \"t1br2if1\" netns \"t1ns2\" ; fi\nip netns exec \"t1ns2\" brctl show \"t1br2\" | grep -w 't1br2if1' ; if [ $? -ne 0 ] ; then ip netns exec \"t1ns2\" brctl addif \"t1br2\" \"t1br2if1\" ; fi\n", "delta": "0:00:00.051954", "end": "2019-11-22 06:40:42.710367", "item": [{"bridge_name": "t1br2", "default_route_ip": "10.1.2.1", "dns": [{"brif": "t1s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t1s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns2", "route": [{"if": "p1", "ip": "10.1.2.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "2.2.2.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns2if", "tenant_ns_ip": "10.1.2.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s2if", "tenant_sub_ip": "10.1.2.2/24"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, {"brif": "t1br2if1", "disk": "10G", "mem": 3, "name": "t1_VM3", "vcpu": 2, "vmif": "t1VM3if1"}], "rc": 0, "start": "2019-11-22 06:40:42.658413", "stderr": "Device \"t1br2if1\" does not exist.", "stderr_lines": ["Device \"t1br2if1\" does not exist."], "stdout": "t1br2\t\t8000.225af8b64bfa\tno\t\tt1br2if1", "stdout_lines": ["t1br2\t\t8000.225af8b64bfa\tno\t\tt1br2if1"]}

TASK [All interfaces and bridges UP] ************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.1.2/24', u'tenant_ns_ip': u'10.1.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.1.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.1.2', u'remote_route': u'10.2.1.0/24', u'subnet_route': u'10.1.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.2.1.2'}]}, {u'mem': 2, u'name': u't1_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM1if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t1ns1\" ip link set \"t1br1if1\" up\nip netns exec \"t1ns1\" ip link set dev \"t1br1\" up\n", "delta": "0:00:00.068102", "end": "2019-11-22 06:40:43.058320", "item": [{"bridge_name": "t1br1", "default_route_ip": "10.1.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.1.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.1.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.1.1.2/24"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.1.2", "remote_ip": "10.2.1.2", "remote_route": "10.2.1.0/24", "subnet_route": "10.1.1.0/24", "tenant_route_ip": "192.168.1.2", "v_name": "vxlan_t1s1"}]}, {"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM1", "vcpu": 4, "vmif": "t1VM1if1"}], "rc": 0, "start": "2019-11-22 06:40:42.990218", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.1.2/24', u'tenant_ns_ip': u'10.1.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.1.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.1.2', u'remote_route': u'10.2.1.0/24', u'subnet_route': u'10.1.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.2.1.2'}]}, {u'mem': 4, u'name': u't1_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br1if2', u'vmif': u't1VM2if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t1ns1\" ip link set \"t1br1if2\" up\nip netns exec \"t1ns1\" ip link set dev \"t1br1\" up\n", "delta": "0:00:00.070405", "end": "2019-11-22 06:40:43.338293", "item": [{"bridge_name": "t1br1", "default_route_ip": "10.1.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.1.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.1.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.1.1.2/24"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.1.2", "remote_ip": "10.2.1.2", "remote_route": "10.2.1.0/24", "subnet_route": "10.1.1.0/24", "tenant_route_ip": "192.168.1.2", "v_name": "vxlan_t1s1"}]}, {"brif": "t1br1if2", "disk": "10G", "mem": 4, "name": "t1_VM2", "vcpu": 2, "vmif": "t1VM2if1"}], "rc": 0, "start": "2019-11-22 06:40:43.267888", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.2.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.2.1', u'bridge_name': u't1br2', u'dns': [{u'dnsif': u't1s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s2_dnsbrif'}], u'ns_name': u't1ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.2.2/24', u'tenant_ns_ip': u'10.1.2.1/24', u'tenant_ns_if': u't1ns2if', u'tenant_sub_if': u't1s2if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'2.2.2.0/24', u'vxlan': [{u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}, {u'mem': 3, u'name': u't1_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br2if1', u'vmif': u't1VM3if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t1ns2\" ip link set \"t1br2if1\" up\nip netns exec \"t1ns2\" ip link set dev \"t1br2\" up\n", "delta": "0:00:00.071009", "end": "2019-11-22 06:40:43.614282", "item": [{"bridge_name": "t1br2", "default_route_ip": "10.1.2.1", "dns": [{"brif": "t1s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t1s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns2", "route": [{"if": "p1", "ip": "10.1.2.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "2.2.2.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns2if", "tenant_ns_ip": "10.1.2.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s2if", "tenant_sub_ip": "10.1.2.2/24"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, {"brif": "t1br2if1", "disk": "10G", "mem": 3, "name": "t1_VM3", "vcpu": 2, "vmif": "t1VM3if1"}], "rc": 0, "start": "2019-11-22 06:40:43.543273", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Add IP to DNS Interface] ******************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.1.1', u'bridge_name': u't1br1', u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.1.2/24', u'tenant_ns_ip': u'10.1.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't1_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM1if1'}, {u'mem': 4, u'name': u't1_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br1if2', u'vmif': u't1VM2if1'}], u'vxlan': [{u'local_ip': u'10.1.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.1.2', u'remote_route': u'10.2.1.0/24', u'subnet_route': u'10.1.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.2.1.2'}]}, {u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t1ns1\" ip addr show \"t1s1_dnsif\" | awk 'FNR==3{ print $2 }' | grep -w '^1.1.1.1/24' ; if [ $? -ne 0 ] ; then ip netns exec \"t1ns1\" ip addr add \"1.1.1.1/24\" dev \"t1s1_dnsif\" ; fi\n", "delta": "0:00:00.033989", "end": "2019-11-22 06:40:43.906433", "item": [{"bridge_name": "t1br1", "default_route_ip": "10.1.1.1", "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.1.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.1.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.1.1.2/24"}], "vms": [{"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM1", "vcpu": 4, "vmif": "t1VM1if1"}, {"brif": "t1br1if2", "disk": "10G", "mem": 4, "name": "t1_VM2", "vcpu": 2, "vmif": "t1VM2if1"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.1.2", "remote_ip": "10.2.1.2", "remote_route": "10.2.1.0/24", "subnet_route": "10.1.1.0/24", "tenant_route_ip": "192.168.1.2", "v_name": "vxlan_t1s1"}]}, {"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "rc": 0, "start": "2019-11-22 06:40:43.872444", "stderr": "", "stderr_lines": [], "stdout": "1.1.1.1/24", "stdout_lines": ["1.1.1.1/24"]}
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.2.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.2.1', u'bridge_name': u't1br2', u'ns_name': u't1ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.2.2/24', u'tenant_ns_ip': u'10.1.2.1/24', u'tenant_ns_if': u't1ns2if', u'tenant_sub_if': u't1s2if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'2.2.2.0/24', u'vms': [{u'mem': 3, u'name': u't1_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br2if1', u'vmif': u't1VM3if1'}], u'vxlan': [{u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}, {u'dnsif': u't1s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s2_dnsbrif'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t1ns2\" ip addr show \"t1s2_dnsif\" | awk 'FNR==3{ print $2 }' | grep -w '^2.2.2.1/24' ; if [ $? -ne 0 ] ; then ip netns exec \"t1ns2\" ip addr add \"2.2.2.1/24\" dev \"t1s2_dnsif\" ; fi\n", "delta": "0:00:00.033282", "end": "2019-11-22 06:40:44.130391", "item": [{"bridge_name": "t1br2", "default_route_ip": "10.1.2.1", "ns_name": "t1ns2", "route": [{"if": "p1", "ip": "10.1.2.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "2.2.2.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns2if", "tenant_ns_ip": "10.1.2.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s2if", "tenant_sub_ip": "10.1.2.2/24"}], "vms": [{"brif": "t1br2if1", "disk": "10G", "mem": 3, "name": "t1_VM3", "vcpu": 2, "vmif": "t1VM3if1"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, {"brif": "t1s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t1s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "rc": 0, "start": "2019-11-22 06:40:44.097109", "stderr": "", "stderr_lines": [], "stdout": "2.2.2.1/24", "stdout_lines": ["2.2.2.1/24"]}

TASK [Install DHCP Server] **********************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.1.1', u'bridge_name': u't1br1', u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.1.2/24', u'tenant_ns_ip': u'10.1.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't1_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM1if1'}, {u'mem': 4, u'name': u't1_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br1if2', u'vmif': u't1VM2if1'}], u'vxlan': [{u'local_ip': u'10.1.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.1.2', u'remote_route': u'10.2.1.0/24', u'subnet_route': u'10.1.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.2.1.2'}]}, {u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t1ns1\" ps aux | grep -w '[d]nsmasq --interface t1s1_dnsif -z --dhcp-range=1.1.1.5,1.1.1.126' ; if [ $? -ne 0 ] ; then ip netns exec \"t1ns1\" dnsmasq --interface \"t1s1_dnsif\" -z --dhcp-range=1.1.1.5,'1.1.1.126' ; fi\n", "delta": "0:00:00.053241", "end": "2019-11-22 06:40:44.438703", "item": [{"bridge_name": "t1br1", "default_route_ip": "10.1.1.1", "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.1.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.1.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.1.1.2/24"}], "vms": [{"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM1", "vcpu": 4, "vmif": "t1VM1if1"}, {"brif": "t1br1if2", "disk": "10G", "mem": 4, "name": "t1_VM2", "vcpu": 2, "vmif": "t1VM2if1"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.1.2", "remote_ip": "10.2.1.2", "remote_route": "10.2.1.0/24", "subnet_route": "10.1.1.0/24", "tenant_route_ip": "192.168.1.2", "v_name": "vxlan_t1s1"}]}, {"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "rc": 0, "start": "2019-11-22 06:40:44.385462", "stderr": "", "stderr_lines": [], "stdout": "nobody    4202  0.0  0.0  51580   384 ?        S    06:37   0:00 dnsmasq --interface t1s1_dnsif -z --dhcp-range=1.1.1.5,1.1.1.126", "stdout_lines": ["nobody    4202  0.0  0.0  51580   384 ?        S    06:37   0:00 dnsmasq --interface t1s1_dnsif -z --dhcp-range=1.1.1.5,1.1.1.126"]}
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.2.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.2.1', u'bridge_name': u't1br2', u'ns_name': u't1ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.2.2/24', u'tenant_ns_ip': u'10.1.2.1/24', u'tenant_ns_if': u't1ns2if', u'tenant_sub_if': u't1s2if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'2.2.2.0/24', u'vms': [{u'mem': 3, u'name': u't1_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br2if1', u'vmif': u't1VM3if1'}], u'vxlan': [{u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}, {u'dnsif': u't1s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s2_dnsbrif'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t1ns2\" ps aux | grep -w '[d]nsmasq --interface t1s2_dnsif -z --dhcp-range=2.2.2.5,2.2.2.254' ; if [ $? -ne 0 ] ; then ip netns exec \"t1ns2\" dnsmasq --interface \"t1s2_dnsif\" -z --dhcp-range=2.2.2.5,'2.2.2.254' ; fi\n", "delta": "0:00:00.057809", "end": "2019-11-22 06:40:44.686398", "item": [{"bridge_name": "t1br2", "default_route_ip": "10.1.2.1", "ns_name": "t1ns2", "route": [{"if": "p1", "ip": "10.1.2.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "2.2.2.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns2if", "tenant_ns_ip": "10.1.2.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s2if", "tenant_sub_ip": "10.1.2.2/24"}], "vms": [{"brif": "t1br2if1", "disk": "10G", "mem": 3, "name": "t1_VM3", "vcpu": 2, "vmif": "t1VM3if1"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, {"brif": "t1s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t1s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "rc": 0, "start": "2019-11-22 06:40:44.628589", "stderr": "", "stderr_lines": [], "stdout": "nobody    4232  0.0  0.0  51580   384 ?        S    06:37   0:00 dnsmasq --interface t1s2_dnsif -z --dhcp-range=2.2.2.5,2.2.2.254", "stdout_lines": ["nobody    4232  0.0  0.0  51580   384 ?        S    06:37   0:00 dnsmasq --interface t1s2_dnsif -z --dhcp-range=2.2.2.5,2.2.2.254"]}

TASK [Create VXLAN devices] *********************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.1.2/24', u'tenant_ns_ip': u'10.1.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't1_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM1if1'}, {u'mem': 4, u'name': u't1_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br1if2', u'vmif': u't1VM2if1'}]}, {u'local_ip': u'10.1.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.1.2', u'remote_route': u'10.2.1.0/24', u'subnet_route': u'10.1.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.2.1.2'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t1ns1\" ip link show \"vxlan_t1s1\" ; if [ $? -ne 0 ] ; then ip netns exec \"t1ns1\" ip link add \"vxlan_t1s1\" type vxlan id \"42\" local \"10.1.1.2\" remote \"10.2.1.2\" dstport \"4789\" dev \"t1s1if\"; ip netns exec \"t1ns1\" ip link set dev \"vxlan_t1s1\" up ; fi\n", "delta": "0:00:00.033902", "end": "2019-11-22 06:40:45.018216", "item": [{"bridge_name": "t1br1", "default_route_ip": "10.1.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.1.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.1.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.1.1.2/24"}], "vms": [{"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM1", "vcpu": 4, "vmif": "t1VM1if1"}, {"brif": "t1br1if2", "disk": "10G", "mem": 4, "name": "t1_VM2", "vcpu": 2, "vmif": "t1VM2if1"}]}, {"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.1.2", "remote_ip": "10.2.1.2", "remote_route": "10.2.1.0/24", "subnet_route": "10.1.1.0/24", "tenant_route_ip": "192.168.1.2", "v_name": "vxlan_t1s1"}], "rc": 0, "start": "2019-11-22 06:40:44.984314", "stderr": "", "stderr_lines": [], "stdout": "5: vxlan_t1s1: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1450 qdisc noqueue master t1br1 state UNKNOWN mode DEFAULT group default qlen 1000\n    link/ether 46:79:e2:aa:ba:f9 brd ff:ff:ff:ff:ff:ff", "stdout_lines": ["5: vxlan_t1s1: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1450 qdisc noqueue master t1br1 state UNKNOWN mode DEFAULT group default qlen 1000", "    link/ether 46:79:e2:aa:ba:f9 brd ff:ff:ff:ff:ff:ff"]}
skipping: [localhost] => (item=[{u'route': [{u'ip': u'10.1.2.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.2.1', u'bridge_name': u't1br2', u'dns': [{u'dnsif': u't1s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s2_dnsbrif'}], u'ns_name': u't1ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.2.2/24', u'tenant_ns_ip': u'10.1.2.1/24', u'tenant_ns_if': u't1ns2if', u'tenant_sub_if': u't1s2if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'2.2.2.0/24', u'vms': [{u'mem': 3, u'name': u't1_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br2if1', u'vmif': u't1VM3if1'}]}, {u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}])  => {"ansible_loop_var": "item", "changed": false, "item": [{"bridge_name": "t1br2", "default_route_ip": "10.1.2.1", "dns": [{"brif": "t1s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t1s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns2", "route": [{"if": "p1", "ip": "10.1.2.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "2.2.2.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns2if", "tenant_ns_ip": "10.1.2.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s2if", "tenant_sub_ip": "10.1.2.2/24"}], "vms": [{"brif": "t1br2if1", "disk": "10G", "mem": 3, "name": "t1_VM3", "vcpu": 2, "vmif": "t1VM3if1"}]}, {"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}], "skip_reason": "Conditional result was False"}

TASK [Attach VXLANs to bridge] ******************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.1.2/24', u'tenant_ns_ip': u'10.1.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't1_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM1if1'}, {u'mem': 4, u'name': u't1_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br1if2', u'vmif': u't1VM2if1'}]}, {u'local_ip': u'10.1.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.1.2', u'remote_route': u'10.2.1.0/24', u'subnet_route': u'10.1.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.2.1.2'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t1ns1\" brctl show \"t1br1\" | grep -w 'vxlan_t1s1' ; if [ $? -ne 0 ] ; then ip netns exec \"t1ns1\" brctl addif \"t1br1\" \"vxlan_t1s1\" ; fi\n", "delta": "0:00:00.043090", "end": "2019-11-22 06:40:45.374408", "item": [{"bridge_name": "t1br1", "default_route_ip": "10.1.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.1.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.1.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.1.1.2/24"}], "vms": [{"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM1", "vcpu": 4, "vmif": "t1VM1if1"}, {"brif": "t1br1if2", "disk": "10G", "mem": 4, "name": "t1_VM2", "vcpu": 2, "vmif": "t1VM2if1"}]}, {"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.1.2", "remote_ip": "10.2.1.2", "remote_route": "10.2.1.0/24", "subnet_route": "10.1.1.0/24", "tenant_route_ip": "192.168.1.2", "v_name": "vxlan_t1s1"}], "rc": 0, "start": "2019-11-22 06:40:45.331318", "stderr": "", "stderr_lines": [], "stdout": "\t\t\t\t\t\t\tvxlan_t1s1", "stdout_lines": ["\t\t\t\t\t\t\tvxlan_t1s1"]}
skipping: [localhost] => (item=[{u'route': [{u'ip': u'10.1.2.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.2.1', u'bridge_name': u't1br2', u'dns': [{u'dnsif': u't1s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s2_dnsbrif'}], u'ns_name': u't1ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.2.2/24', u'tenant_ns_ip': u'10.1.2.1/24', u'tenant_ns_if': u't1ns2if', u'tenant_sub_if': u't1s2if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'2.2.2.0/24', u'vms': [{u'mem': 3, u'name': u't1_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br2if1', u'vmif': u't1VM3if1'}]}, {u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}])  => {"ansible_loop_var": "item", "changed": false, "item": [{"bridge_name": "t1br2", "default_route_ip": "10.1.2.1", "dns": [{"brif": "t1s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t1s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns2", "route": [{"if": "p1", "ip": "10.1.2.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "2.2.2.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns2if", "tenant_ns_ip": "10.1.2.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s2if", "tenant_sub_ip": "10.1.2.2/24"}], "vms": [{"brif": "t1br2if1", "disk": "10G", "mem": 3, "name": "t1_VM3", "vcpu": 2, "vmif": "t1VM3if1"}]}, {"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}], "skip_reason": "Conditional result was False"}

PLAY RECAP **************************************************************************************************************************************************
localhost                  : ok=21   changed=19   unreachable=0    failed=0    skipped=0    rescued=0    ignored=0   

Using /etc/ansible/ansible.cfg as config file

PLAY [worker] ***********************************************************************************************************************************************

TASK [Create Tenant Namespace] ******************************************************************************************************************************
ok: [99.99.99.2] => (item={u'default_route_ip': u'192.168.129.1', u'name': u't1', u'pns_ip': u'192.168.129.1/24', u'tenant_if': u't1if', u'tenant_ip': u'192.168.129.2/24', u'pns_if': u't1pns_if'}) => {"ansible_loop_var": "item", "changed": false, "cmd": ["ip", "netns", "add", "t1"], "item": {"default_route_ip": "192.168.129.1", "name": "t1", "pns_if": "t1pns_if", "pns_ip": "192.168.129.1/24", "tenant_if": "t1if", "tenant_ip": "192.168.129.2/24"}, "rc": 0, "stdout": "skipped, since /var/run/netns/t1 exists", "stdout_lines": ["skipped, since /var/run/netns/t1 exists"]}

TASK [Create Subnet Namespace] ******************************************************************************************************************************
ok: [99.99.99.2] => (item={u'route': [{u'ip': u'10.2.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.2.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.1.2/24', u'tenant_ns_ip': u'10.2.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_ns_name': u't1', u'tenant_sub_if': u't1s1if'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't1_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM4if1'}], u'vxlan': [{u'local_ip': u'10.2.1.2', u'tenant_route_ip': u'192.168.129.2', u'dsport': 4789, u'dev': u't1s1if', u'subnet_route': u'10.2.1.0/24', u'remote_route': u'10.1.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.1.1.2'}]}) => {"ansible_loop_var": "item", "changed": false, "cmd": ["ip", "netns", "add", "t1ns1"], "item": {"bridge_name": "t1br1", "default_route_ip": "10.2.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.2.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.2.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.2.1.2/24"}], "vms": [{"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM4", "vcpu": 4, "vmif": "t1VM4if1"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.1.2", "remote_ip": "10.1.1.2", "remote_route": "10.1.1.0/24", "subnet_route": "10.2.1.0/24", "tenant_route_ip": "192.168.129.2", "v_name": "vxlan_t1s1"}]}, "rc": 0, "stdout": "skipped, since /var/run/netns/t1ns1 exists", "stdout_lines": ["skipped, since /var/run/netns/t1ns1 exists"]}

TASK [Create Tenant VETH pairs] *****************************************************************************************************************************
changed: [99.99.99.2] => (item={u'default_route_ip': u'192.168.129.1', u'name': u't1', u'pns_ip': u'192.168.129.1/24', u'tenant_if': u't1if', u'tenant_ip': u'192.168.129.2/24', u'pns_if': u't1pns_if'}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip link show \"t1if\" ; if [ $? -ne 0 ] ; then ip link add \"t1if\" type veth peer name \"t1pns_if\" ; fi\n", "delta": "0:00:00.013671", "end": "2019-11-22 06:40:48.002421", "item": {"default_route_ip": "192.168.129.1", "name": "t1", "pns_if": "t1pns_if", "pns_ip": "192.168.129.1/24", "tenant_if": "t1if", "tenant_ip": "192.168.129.2/24"}, "rc": 0, "start": "2019-11-22 06:40:47.988750", "stderr": "Device \"t1if\" does not exist.", "stderr_lines": ["Device \"t1if\" does not exist."], "stdout": "", "stdout_lines": []}

TASK [Attach Tenant VETH Pairs] *****************************************************************************************************************************
changed: [99.99.99.2] => (item={u'default_route_ip': u'192.168.129.1', u'name': u't1', u'pns_ip': u'192.168.129.1/24', u'tenant_if': u't1if', u'tenant_ip': u'192.168.129.2/24', u'pns_if': u't1pns_if'}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec pns ip link show \"t1pns_if\" ; if [ $? -ne 0 ] ; then ip link set \"t1pns_if\" netns pns ; fi\nip netns exec \"t1\" ip link show \"t1if\" ; if [ $? -ne 0 ] ; then ip link set \"t1if\" netns \"t1\" ; fi\nip netns exec pns ip link set dev \"t1pns_if\" up\nip netns exec \"t1\" ip link set dev \"t1if\" up\n", "delta": "0:00:00.139145", "end": "2019-11-22 06:40:48.528049", "item": {"default_route_ip": "192.168.129.1", "name": "t1", "pns_if": "t1pns_if", "pns_ip": "192.168.129.1/24", "tenant_if": "t1if", "tenant_ip": "192.168.129.2/24"}, "rc": 0, "start": "2019-11-22 06:40:48.388904", "stderr": "", "stderr_lines": [], "stdout": "14: t1pns_if@if15: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP mode DEFAULT group default qlen 1000\n    link/ether 16:c6:4d:5b:05:70 brd ff:ff:ff:ff:ff:ff link-netnsid 1\n15: t1if@if14: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP mode DEFAULT group default qlen 1000\n    link/ether 7a:ae:34:75:04:0b brd ff:ff:ff:ff:ff:ff link-netnsid 0", "stdout_lines": ["14: t1pns_if@if15: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP mode DEFAULT group default qlen 1000", "    link/ether 16:c6:4d:5b:05:70 brd ff:ff:ff:ff:ff:ff link-netnsid 1", "15: t1if@if14: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP mode DEFAULT group default qlen 1000", "    link/ether 7a:ae:34:75:04:0b brd ff:ff:ff:ff:ff:ff link-netnsid 0"]}

TASK [Add IP addresses to Tenant VETH Pairs] ****************************************************************************************************************
changed: [99.99.99.2] => (item={u'default_route_ip': u'192.168.129.1', u'name': u't1', u'pns_ip': u'192.168.129.1/24', u'tenant_if': u't1if', u'tenant_ip': u'192.168.129.2/24', u'pns_if': u't1pns_if'}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec pns ip addr show \"t1pns_if\" | awk 'FNR==3{ print $2 }' | grep -w '^192.168.129.1/24' ; if [ $? -ne 0 ] ; then ip netns exec pns ip addr add \"192.168.129.1/24\" dev \"t1pns_if\" ; fi\nip netns exec \"t1\" ip addr show \"t1if\" | awk 'FNR==3{ print $2 }' | grep -w '^192.168.129.2/24' ; if [ $? -ne 0 ] ; then ip netns exec \"t1\" ip addr add \"192.168.129.2/24\" dev \"t1if\" ; fi\n", "delta": "0:00:00.084981", "end": "2019-11-22 06:40:49.000227", "item": {"default_route_ip": "192.168.129.1", "name": "t1", "pns_if": "t1pns_if", "pns_ip": "192.168.129.1/24", "tenant_if": "t1if", "tenant_ip": "192.168.129.2/24"}, "rc": 0, "start": "2019-11-22 06:40:48.915246", "stderr": "", "stderr_lines": [], "stdout": "192.168.129.1/24\n192.168.129.2/24", "stdout_lines": ["192.168.129.1/24", "192.168.129.2/24"]}

TASK [Create Namespace VETH Pairs] **************************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.2.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't1_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM4if1'}], u'vxlan': [{u'local_ip': u'10.2.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.129.2', u'remote_route': u'10.1.1.0/24', u'subnet_route': u'10.2.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.1.1.2'}]}, {u'tenant_sub_ip': u'10.2.1.2/24', u'tenant_ns_ip': u'10.2.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip link show \"t1ns1if\" ; if [ $? -ne 0 ] ; then ip link add \"t1ns1if\" type veth peer name \"t1s1if\" ; fi\n", "delta": "0:00:00.012317", "end": "2019-11-22 06:40:49.431509", "item": [{"bridge_name": "t1br1", "default_route_ip": "10.2.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.2.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "vms": [{"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM4", "vcpu": 4, "vmif": "t1VM4if1"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.1.2", "remote_ip": "10.1.1.2", "remote_route": "10.1.1.0/24", "subnet_route": "10.2.1.0/24", "tenant_route_ip": "192.168.129.2", "v_name": "vxlan_t1s1"}]}, {"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.2.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.2.1.2/24"}], "rc": 0, "start": "2019-11-22 06:40:49.419192", "stderr": "Device \"t1ns1if\" does not exist.", "stderr_lines": ["Device \"t1ns1if\" does not exist."], "stdout": "", "stdout_lines": []}

TASK [Attach Namespace VETH Pairs] **************************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.2.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't1_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM4if1'}], u'vxlan': [{u'local_ip': u'10.2.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.129.2', u'remote_route': u'10.1.1.0/24', u'subnet_route': u'10.2.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.1.1.2'}]}, {u'tenant_sub_ip': u'10.2.1.2/24', u'tenant_ns_ip': u'10.2.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t1\" ip link show \"t1ns1if\" ; if [ $? -ne 0 ] ; then ip link set \"t1ns1if\" netns \"t1\" ; fi\nip netns exec \"t1ns1\" ip link show \"t1s1if\" ; if [ $? -ne 0 ] ; then ip link set \"t1s1if\" netns \"t1ns1\" ; fi\n", "delta": "0:00:00.073292", "end": "2019-11-22 06:40:49.888011", "item": [{"bridge_name": "t1br1", "default_route_ip": "10.2.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.2.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "vms": [{"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM4", "vcpu": 4, "vmif": "t1VM4if1"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.1.2", "remote_ip": "10.1.1.2", "remote_route": "10.1.1.0/24", "subnet_route": "10.2.1.0/24", "tenant_route_ip": "192.168.129.2", "v_name": "vxlan_t1s1"}]}, {"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.2.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.2.1.2/24"}], "rc": 0, "start": "2019-11-22 06:40:49.814719", "stderr": "", "stderr_lines": [], "stdout": "17: t1ns1if@if16: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP mode DEFAULT group default qlen 1000\n    link/ether 86:3e:e9:9f:62:e0 brd ff:ff:ff:ff:ff:ff link-netnsid 2\n16: t1s1if@if17: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP mode DEFAULT group default qlen 1000\n    link/ether f2:0b:c2:ed:23:c1 brd ff:ff:ff:ff:ff:ff link-netnsid 0", "stdout_lines": ["17: t1ns1if@if16: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP mode DEFAULT group default qlen 1000", "    link/ether 86:3e:e9:9f:62:e0 brd ff:ff:ff:ff:ff:ff link-netnsid 2", "16: t1s1if@if17: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP mode DEFAULT group default qlen 1000", "    link/ether f2:0b:c2:ed:23:c1 brd ff:ff:ff:ff:ff:ff link-netnsid 0"]}

TASK [Set Namespace VETH Pairs UP] **************************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.2.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't1_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM4if1'}], u'vxlan': [{u'local_ip': u'10.2.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.129.2', u'remote_route': u'10.1.1.0/24', u'subnet_route': u'10.2.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.1.1.2'}]}, {u'tenant_sub_ip': u'10.2.1.2/24', u'tenant_ns_ip': u'10.2.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t1\" ip link set dev \"t1ns1if\" up\nip netns exec \"t1ns1\" ip link set dev \"t1s1if\" up\n", "delta": "0:00:00.078633", "end": "2019-11-22 06:40:50.348129", "item": [{"bridge_name": "t1br1", "default_route_ip": "10.2.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.2.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "vms": [{"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM4", "vcpu": 4, "vmif": "t1VM4if1"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.1.2", "remote_ip": "10.1.1.2", "remote_route": "10.1.1.0/24", "subnet_route": "10.2.1.0/24", "tenant_route_ip": "192.168.129.2", "v_name": "vxlan_t1s1"}]}, {"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.2.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.2.1.2/24"}], "rc": 0, "start": "2019-11-22 06:40:50.269496", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Add IP addresses to Namespace VETH Pairs] *************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.2.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't1_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM4if1'}], u'vxlan': [{u'local_ip': u'10.2.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.129.2', u'remote_route': u'10.1.1.0/24', u'subnet_route': u'10.2.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.1.1.2'}]}, {u'tenant_sub_ip': u'10.2.1.2/24', u'tenant_ns_ip': u'10.2.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t1ns1\" ip addr show \"t1s1if\" | awk 'FNR==3{ print $2 }' | grep -w '^10.2.1.2/24' ; if [ $? -ne 0 ] ; then ip netns exec \"t1ns1\" ip addr add \"10.2.1.2/24\" dev \"t1s1if\" ; fi\n\nip netns exec \"t1\" ip addr show \"t1ns1if\" | awk 'FNR==3{ print $2 }' | grep -w '^10.2.1.1/24' ; if [ $? -ne 0 ] ; then ip netns exec \"t1\" ip addr add \"10.2.1.1/24\" dev \"t1ns1if\" ; fi\n", "delta": "0:00:00.090668", "end": "2019-11-22 06:40:50.820388", "item": [{"bridge_name": "t1br1", "default_route_ip": "10.2.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.2.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "vms": [{"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM4", "vcpu": 4, "vmif": "t1VM4if1"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.1.2", "remote_ip": "10.1.1.2", "remote_route": "10.1.1.0/24", "subnet_route": "10.2.1.0/24", "tenant_route_ip": "192.168.129.2", "v_name": "vxlan_t1s1"}]}, {"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.2.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.2.1.2/24"}], "rc": 0, "start": "2019-11-22 06:40:50.729720", "stderr": "", "stderr_lines": [], "stdout": "10.2.1.2/24\n10.2.1.1/24", "stdout_lines": ["10.2.1.2/24", "10.2.1.1/24"]}

TASK [Add IP Route to Tenant] *******************************************************************************************************************************
changed: [99.99.99.2] => (item={u'default_route_ip': u'192.168.129.1', u'name': u't1', u'pns_ip': u'192.168.129.1/24', u'tenant_if': u't1if', u'tenant_ip': u'192.168.129.2/24', u'pns_if': u't1pns_if'}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t1\" ip route show default | grep -w '[d]efault via 192.168.129.1' ; if [ $? -ne 0 ] ; then ip netns exec \"t1\" ip route add default via \"192.168.129.1\" ; fi\n", "delta": "0:00:00.041890", "end": "2019-11-22 06:40:51.252217", "item": {"default_route_ip": "192.168.129.1", "name": "t1", "pns_if": "t1pns_if", "pns_ip": "192.168.129.1/24", "tenant_if": "t1if", "tenant_ip": "192.168.129.2/24"}, "rc": 0, "start": "2019-11-22 06:40:51.210327", "stderr": "", "stderr_lines": [], "stdout": "default via 192.168.129.1 dev t1if ", "stdout_lines": ["default via 192.168.129.1 dev t1if "]}

TASK [Add IP Route to Tenant Subnet] ************************************************************************************************************************
changed: [99.99.99.2] => (item={u'route': [{u'ip': u'10.2.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.2.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.1.2/24', u'tenant_ns_ip': u'10.2.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_ns_name': u't1', u'tenant_sub_if': u't1s1if'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't1_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM4if1'}], u'vxlan': [{u'local_ip': u'10.2.1.2', u'tenant_route_ip': u'192.168.129.2', u'dsport': 4789, u'dev': u't1s1if', u'subnet_route': u'10.2.1.0/24', u'remote_route': u'10.1.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.1.1.2'}]}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t1ns1\" ip route show default | grep -w '[d]efault via 10.2.1.1' ; if [ $? -ne 0 ] ; then ip netns exec \"t1ns1\" ip route add default via \"10.2.1.1\" ; fi\n", "delta": "0:00:00.034086", "end": "2019-11-22 06:40:51.684066", "item": {"bridge_name": "t1br1", "default_route_ip": "10.2.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.2.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.2.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.2.1.2/24"}], "vms": [{"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM4", "vcpu": 4, "vmif": "t1VM4if1"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.1.2", "remote_ip": "10.1.1.2", "remote_route": "10.1.1.0/24", "subnet_route": "10.2.1.0/24", "tenant_route_ip": "192.168.129.2", "v_name": "vxlan_t1s1"}]}, "rc": 0, "start": "2019-11-22 06:40:51.649980", "stderr": "", "stderr_lines": [], "stdout": "default via 10.2.1.1 dev t1s1if ", "stdout_lines": ["default via 10.2.1.1 dev t1s1if "]}

TASK [Create bridge inside namespace] ***********************************************************************************************************************
changed: [99.99.99.2] => (item={u'route': [{u'ip': u'10.2.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.2.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.1.2/24', u'tenant_ns_ip': u'10.2.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_ns_name': u't1', u'tenant_sub_if': u't1s1if'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't1_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM4if1'}], u'vxlan': [{u'local_ip': u'10.2.1.2', u'tenant_route_ip': u'192.168.129.2', u'dsport': 4789, u'dev': u't1s1if', u'subnet_route': u'10.2.1.0/24', u'remote_route': u'10.1.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.1.1.2'}]}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t1ns1\" brctl show | grep -w '^t1br1'; if [ $? -ne 0 ] ; then ip netns exec \"t1ns1\" brctl addbr \"t1br1\" ; fi\nip netns exec \"t1ns1\" ip link set dev \"t1br1\" up\n", "delta": "0:00:00.064865", "end": "2019-11-22 06:40:52.151917", "item": {"bridge_name": "t1br1", "default_route_ip": "10.2.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.2.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.2.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.2.1.2/24"}], "vms": [{"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM4", "vcpu": 4, "vmif": "t1VM4if1"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.1.2", "remote_ip": "10.1.1.2", "remote_route": "10.1.1.0/24", "subnet_route": "10.2.1.0/24", "tenant_route_ip": "192.168.129.2", "v_name": "vxlan_t1s1"}]}, "rc": 0, "start": "2019-11-22 06:40:52.087052", "stderr": "", "stderr_lines": [], "stdout": "t1br1\t\t8000.2e54d50069fa\tno\t\tt1br1if1", "stdout_lines": ["t1br1\t\t8000.2e54d50069fa\tno\t\tt1br1if1"]}

TASK [Create DNS VETH Pair] *********************************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.2.1.1', u'bridge_name': u't1br1', u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.1.2/24', u'tenant_ns_ip': u'10.2.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't1_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM4if1'}], u'vxlan': [{u'local_ip': u'10.2.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.129.2', u'remote_route': u'10.1.1.0/24', u'subnet_route': u'10.2.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.1.1.2'}]}, {u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t1ns1\" ip link show \"t1s1_dnsbrif\" ; if [ $? -ne 0 ] ; then ip netns exec \"t1ns1\" ip link add \"t1s1_dnsbrif\" type veth peer name \"t1s1_dnsif\" ; fi\nip netns exec \"t1ns1\" ip link set dev \"t1s1_dnsbrif\" up\nip netns exec \"t1ns1\" ip link set dev \"t1s1_dnsif\" up\n", "delta": "0:00:00.105066", "end": "2019-11-22 06:40:52.652101", "item": [{"bridge_name": "t1br1", "default_route_ip": "10.2.1.1", "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.2.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.2.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.2.1.2/24"}], "vms": [{"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM4", "vcpu": 4, "vmif": "t1VM4if1"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.1.2", "remote_ip": "10.1.1.2", "remote_route": "10.1.1.0/24", "subnet_route": "10.2.1.0/24", "tenant_route_ip": "192.168.129.2", "v_name": "vxlan_t1s1"}]}, {"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "rc": 0, "start": "2019-11-22 06:40:52.547035", "stderr": "", "stderr_lines": [], "stdout": "4: t1s1_dnsbrif@t1s1_dnsif: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue master t1br1 state UP mode DEFAULT group default qlen 1000\n    link/ether da:e7:a3:29:98:06 brd ff:ff:ff:ff:ff:ff", "stdout_lines": ["4: t1s1_dnsbrif@t1s1_dnsif: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue master t1br1 state UP mode DEFAULT group default qlen 1000", "    link/ether da:e7:a3:29:98:06 brd ff:ff:ff:ff:ff:ff"]}

TASK [Attach DNS VETH Pair] *********************************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.2.1.1', u'bridge_name': u't1br1', u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.1.2/24', u'tenant_ns_ip': u'10.2.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't1_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM4if1'}], u'vxlan': [{u'local_ip': u'10.2.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.129.2', u'remote_route': u'10.1.1.0/24', u'subnet_route': u'10.2.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.1.1.2'}]}, {u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t1ns1\" brctl show \"t1br1\" | grep -w 't1s1_dnsbrif' ; if [ $? -ne 0 ] ; then ip netns exec \"t1ns1\" brctl addif \"t1br1\" \"t1s1_dnsbrif\" ; fi\n", "delta": "0:00:00.035545", "end": "2019-11-22 06:40:53.096099", "item": [{"bridge_name": "t1br1", "default_route_ip": "10.2.1.1", "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.2.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.2.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.2.1.2/24"}], "vms": [{"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM4", "vcpu": 4, "vmif": "t1VM4if1"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.1.2", "remote_ip": "10.1.1.2", "remote_route": "10.1.1.0/24", "subnet_route": "10.2.1.0/24", "tenant_route_ip": "192.168.129.2", "v_name": "vxlan_t1s1"}]}, {"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "rc": 0, "start": "2019-11-22 06:40:53.060554", "stderr": "", "stderr_lines": [], "stdout": "\t\t\t\t\t\t\tt1s1_dnsbrif", "stdout_lines": ["\t\t\t\t\t\t\tt1s1_dnsbrif"]}

TASK [Create VETH Pairs] ************************************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.2.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.1.2/24', u'tenant_ns_ip': u'10.2.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.2.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.129.2', u'remote_route': u'10.1.1.0/24', u'subnet_route': u'10.2.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.1.1.2'}]}, {u'mem': 2, u'name': u't1_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM4if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip link show \"t1br1if1\" ; if [ $? -ne 0 ] ; then ip link add \"t1VM4if1\" type veth peer name \"t1br1if1\" ; fi\nip link set dev \"t1br1if1\" up\nip link set dev \"t1VM4if1\" up\n", "delta": "0:00:00.012982", "end": "2019-11-22 06:40:53.492820", "item": [{"bridge_name": "t1br1", "default_route_ip": "10.2.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.2.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.2.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.2.1.2/24"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.1.2", "remote_ip": "10.1.1.2", "remote_route": "10.1.1.0/24", "subnet_route": "10.2.1.0/24", "tenant_route_ip": "192.168.129.2", "v_name": "vxlan_t1s1"}]}, {"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM4", "vcpu": 4, "vmif": "t1VM4if1"}], "rc": 0, "start": "2019-11-22 06:40:53.479838", "stderr": "Device \"t1br1if1\" does not exist.\nRTNETLINK answers: File exists\nCannot find device \"t1br1if1\"", "stderr_lines": ["Device \"t1br1if1\" does not exist.", "RTNETLINK answers: File exists", "Cannot find device \"t1br1if1\""], "stdout": "", "stdout_lines": []}

TASK [Attach VETH Pairs] ************************************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.2.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.1.2/24', u'tenant_ns_ip': u'10.2.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.2.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.129.2', u'remote_route': u'10.1.1.0/24', u'subnet_route': u'10.2.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.1.1.2'}]}, {u'mem': 2, u'name': u't1_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM4if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip link show \"t1br1if1\" ; if [ $? -eq 0 ] ; then ip link set \"t1br1if1\" netns \"t1ns1\" ; fi\nip netns exec \"t1ns1\" brctl show \"t1br1\" | grep -w 't1br1if1' ; if [ $? -ne 0 ] ; then ip netns exec \"t1ns1\" brctl addif \"t1br1\" \"t1br1if1\" ; fi\n", "delta": "0:00:00.038230", "end": "2019-11-22 06:40:53.932000", "item": [{"bridge_name": "t1br1", "default_route_ip": "10.2.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.2.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.2.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.2.1.2/24"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.1.2", "remote_ip": "10.1.1.2", "remote_route": "10.1.1.0/24", "subnet_route": "10.2.1.0/24", "tenant_route_ip": "192.168.129.2", "v_name": "vxlan_t1s1"}]}, {"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM4", "vcpu": 4, "vmif": "t1VM4if1"}], "rc": 0, "start": "2019-11-22 06:40:53.893770", "stderr": "Device \"t1br1if1\" does not exist.", "stderr_lines": ["Device \"t1br1if1\" does not exist."], "stdout": "t1br1\t\t8000.2e54d50069fa\tno\t\tt1br1if1", "stdout_lines": ["t1br1\t\t8000.2e54d50069fa\tno\t\tt1br1if1"]}

TASK [All interfaces and bridges UP] ************************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.2.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.1.2/24', u'tenant_ns_ip': u'10.2.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.2.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.129.2', u'remote_route': u'10.1.1.0/24', u'subnet_route': u'10.2.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.1.1.2'}]}, {u'mem': 2, u'name': u't1_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM4if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t1ns1\" ip link set \"t1br1if1\" up\nip netns exec \"t1ns1\" ip link set dev \"t1br1\" up\n", "delta": "0:00:00.075589", "end": "2019-11-22 06:40:54.404139", "item": [{"bridge_name": "t1br1", "default_route_ip": "10.2.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.2.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.2.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.2.1.2/24"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.1.2", "remote_ip": "10.1.1.2", "remote_route": "10.1.1.0/24", "subnet_route": "10.2.1.0/24", "tenant_route_ip": "192.168.129.2", "v_name": "vxlan_t1s1"}]}, {"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM4", "vcpu": 4, "vmif": "t1VM4if1"}], "rc": 0, "start": "2019-11-22 06:40:54.328550", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Add IP to DNS Interface] ******************************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.2.1.1', u'bridge_name': u't1br1', u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.1.2/24', u'tenant_ns_ip': u'10.2.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't1_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM4if1'}], u'vxlan': [{u'local_ip': u'10.2.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.129.2', u'remote_route': u'10.1.1.0/24', u'subnet_route': u'10.2.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.1.1.2'}]}, {u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t1ns1\" ip addr show \"t1s1_dnsif\" | awk 'FNR==3{ print $2}'| grep -w '^1.1.1.128/24' ; if [ $? -ne 0 ] ; then ip netns exec \"t1ns1\" ip addr add \"1.1.1.128/24\" dev \"t1s1_dnsif\" ; fi\n", "delta": "0:00:00.046182", "end": "2019-11-22 06:40:54.840340", "item": [{"bridge_name": "t1br1", "default_route_ip": "10.2.1.1", "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.2.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.2.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.2.1.2/24"}], "vms": [{"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM4", "vcpu": 4, "vmif": "t1VM4if1"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.1.2", "remote_ip": "10.1.1.2", "remote_route": "10.1.1.0/24", "subnet_route": "10.2.1.0/24", "tenant_route_ip": "192.168.129.2", "v_name": "vxlan_t1s1"}]}, {"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "rc": 0, "start": "2019-11-22 06:40:54.794158", "stderr": "", "stderr_lines": [], "stdout": "1.1.1.128/24", "stdout_lines": ["1.1.1.128/24"]}

TASK [Install DHCP Server] **********************************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.2.1.1', u'bridge_name': u't1br1', u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.1.2/24', u'tenant_ns_ip': u'10.2.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't1_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM4if1'}], u'vxlan': [{u'local_ip': u'10.2.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.129.2', u'remote_route': u'10.1.1.0/24', u'subnet_route': u'10.2.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.1.1.2'}]}, {u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t1ns1\" ps aux | grep -w '[d]nsmasq --interface t1s1_dnsif -z --dhcp-range=1.1.1.133,1.1.1.254' ; if [ $? -ne 0 ] ; then ip netns exec \"t1ns1\" dnsmasq --interface \"t1s1_dnsif\" -z --dhcp-range=1.1.1.133,'1.1.1.254' ; fi\n", "delta": "0:00:00.046248", "end": "2019-11-22 06:40:55.280012", "item": [{"bridge_name": "t1br1", "default_route_ip": "10.2.1.1", "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.2.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.2.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.2.1.2/24"}], "vms": [{"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM4", "vcpu": 4, "vmif": "t1VM4if1"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.1.2", "remote_ip": "10.1.1.2", "remote_route": "10.1.1.0/24", "subnet_route": "10.2.1.0/24", "tenant_route_ip": "192.168.129.2", "v_name": "vxlan_t1s1"}]}, {"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "rc": 0, "start": "2019-11-22 06:40:55.233764", "stderr": "", "stderr_lines": [], "stdout": "nobody    3348  0.0  0.0  51580   384 ?        S    06:37   0:00 dnsmasq --interface t1s1_dnsif -z --dhcp-range=1.1.1.133,1.1.1.254", "stdout_lines": ["nobody    3348  0.0  0.0  51580   384 ?        S    06:37   0:00 dnsmasq --interface t1s1_dnsif -z --dhcp-range=1.1.1.133,1.1.1.254"]}

TASK [Create VXLAN devices] *********************************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.2.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.1.2/24', u'tenant_ns_ip': u'10.2.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't1_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM4if1'}]}, {u'local_ip': u'10.2.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.129.2', u'remote_route': u'10.1.1.0/24', u'subnet_route': u'10.2.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.1.1.2'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t1ns1\" ip link show \"vxlan_t1s1\" ; if [ $? -ne 0 ] ; then ip netns exec \"t1ns1\" ip link add \"vxlan_t1s1\" type vxlan id \"42\" local \"10.2.1.2\" remote \"10.1.1.2\" dstport \"4789\" dev \"t1s1if\" ; ip netns exec \"t1ns1\" ip link set dev \"vxlan_t1s1\" up ; fi\n", "delta": "0:00:00.039249", "end": "2019-11-22 06:40:55.724024", "item": [{"bridge_name": "t1br1", "default_route_ip": "10.2.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.2.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.2.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.2.1.2/24"}], "vms": [{"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM4", "vcpu": 4, "vmif": "t1VM4if1"}]}, {"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.1.2", "remote_ip": "10.1.1.2", "remote_route": "10.1.1.0/24", "subnet_route": "10.2.1.0/24", "tenant_route_ip": "192.168.129.2", "v_name": "vxlan_t1s1"}], "rc": 0, "start": "2019-11-22 06:40:55.684775", "stderr": "", "stderr_lines": [], "stdout": "5: vxlan_t1s1: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1450 qdisc noqueue master t1br1 state UNKNOWN mode DEFAULT group default qlen 1000\n    link/ether c6:b5:67:f5:8d:0c brd ff:ff:ff:ff:ff:ff", "stdout_lines": ["5: vxlan_t1s1: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1450 qdisc noqueue master t1br1 state UNKNOWN mode DEFAULT group default qlen 1000", "    link/ether c6:b5:67:f5:8d:0c brd ff:ff:ff:ff:ff:ff"]}

TASK [Attach VXLANs to bridge] ******************************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.2.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.1.2/24', u'tenant_ns_ip': u'10.2.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't1_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM4if1'}]}, {u'local_ip': u'10.2.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.129.2', u'remote_route': u'10.1.1.0/24', u'subnet_route': u'10.2.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.1.1.2'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t1ns1\" brctl show \"t1br1\" | grep -w 'vxlan_t1s1' ; if [ $? -ne 0 ] ; then ip netns exec \"t1ns1\" brctl addif \"t1br1\" \"vxlan_t1s1\" ; fi\n", "delta": "0:00:00.040125", "end": "2019-11-22 06:40:56.160020", "item": [{"bridge_name": "t1br1", "default_route_ip": "10.2.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.2.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.2.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.2.1.2/24"}], "vms": [{"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM4", "vcpu": 4, "vmif": "t1VM4if1"}]}, {"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.1.2", "remote_ip": "10.1.1.2", "remote_route": "10.1.1.0/24", "subnet_route": "10.2.1.0/24", "tenant_route_ip": "192.168.129.2", "v_name": "vxlan_t1s1"}], "rc": 0, "start": "2019-11-22 06:40:56.119895", "stderr": "", "stderr_lines": [], "stdout": "\t\t\t\t\t\t\tvxlan_t1s1", "stdout_lines": ["\t\t\t\t\t\t\tvxlan_t1s1"]}

PLAY RECAP **************************************************************************************************************************************************
99.99.99.2                 : ok=21   changed=19   unreachable=0    failed=0    skipped=0    rescued=0    ignored=0   

Using /etc/ansible/ansible.cfg as config file
INFO:root: 06:41:57.099469 Printing the yaml input file
INFO:root: 06:41:57.099745 {'C1': [{'subnet_addr': '1.1.1.0/24', 'VM': [{'name': 'VM1', 'disk': '10G', 'mem': 2, 'vcpu': 4, 'internet_access': True}, {'name': 'VM2', 'disk': '10G', 'mem': 4, 'vcpu': 2, 'internet_access': False}]}, {'subnet_addr': '2.2.2.0/24', 'VM': [{'name': 'VM3', 'disk': '10G', 'mem': 3, 'vcpu': 2, 'internet_access': True}]}], 'C2': [{'subnet_addr': '1.1.1.0/24', 'VM': [{'name': 'VM4', 'disk': '10G', 'mem': 2, 'vcpu': 4, 'internet_access': True}]}]}
INFO:root: 06:41:57.100198 Provided subnet in C1: 1.1.1.0/24 is valid
INFO:root: 06:41:57.100388 Provided subnet in C1: 2.2.2.0/24 is valid
INFO:root: 06:41:57.100554 Provided subnet in C2: 1.1.1.0/24 is valid
Using /etc/ansible/ansible.cfg as config file

PLAY [main] *************************************************************************************************************************************************

TASK [Create Tenant Namespace] ******************************************************************************************************************************
ok: [localhost] => (item={u'default_route_ip': u'192.168.1.1', u'name': u't1', u'pns_ip': u'192.168.1.1/24', u'tenant_if': u't1if', u'tenant_ip': u'192.168.1.2/24', u'pns_if': u't1pns_if'}) => {"ansible_loop_var": "item", "changed": false, "cmd": ["ip", "netns", "add", "t1"], "item": {"default_route_ip": "192.168.1.1", "name": "t1", "pns_if": "t1pns_if", "pns_ip": "192.168.1.1/24", "tenant_if": "t1if", "tenant_ip": "192.168.1.2/24"}, "rc": 0, "stdout": "skipped, since /var/run/netns/t1 exists", "stdout_lines": ["skipped, since /var/run/netns/t1 exists"]}

TASK [Create Subnet Namespace] ******************************************************************************************************************************
ok: [localhost] => (item={u'route': [{u'ip': u'10.1.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.1.2/24', u'tenant_ns_ip': u'10.1.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_ns_name': u't1', u'tenant_sub_if': u't1s1if'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't1_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM1if1'}, {u'mem': 4, u'name': u't1_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br1if2', u'vmif': u't1VM2if1'}], u'vxlan': [{u'local_ip': u'10.1.1.2', u'tenant_route_ip': u'192.168.1.2', u'dsport': 4789, u'dev': u't1s1if', u'subnet_route': u'10.1.1.0/24', u'remote_route': u'10.2.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.2.1.2'}]}) => {"ansible_loop_var": "item", "changed": false, "cmd": ["ip", "netns", "add", "t1ns1"], "item": {"bridge_name": "t1br1", "default_route_ip": "10.1.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.1.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.1.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.1.1.2/24"}], "vms": [{"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM1", "vcpu": 4, "vmif": "t1VM1if1"}, {"brif": "t1br1if2", "disk": "10G", "mem": 4, "name": "t1_VM2", "vcpu": 2, "vmif": "t1VM2if1"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.1.2", "remote_ip": "10.2.1.2", "remote_route": "10.2.1.0/24", "subnet_route": "10.1.1.0/24", "tenant_route_ip": "192.168.1.2", "v_name": "vxlan_t1s1"}]}, "rc": 0, "stdout": "skipped, since /var/run/netns/t1ns1 exists", "stdout_lines": ["skipped, since /var/run/netns/t1ns1 exists"]}
ok: [localhost] => (item={u'route': [{u'ip': u'10.1.2.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.2.1', u'bridge_name': u't1br2', u'dns': [{u'dnsif': u't1s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s2_dnsbrif'}], u'ns_name': u't1ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.2.2/24', u'tenant_ns_ip': u'10.1.2.1/24', u'tenant_ns_if': u't1ns2if', u'tenant_ns_name': u't1', u'tenant_sub_if': u't1s2if'}], u'subnet_ip': u'2.2.2.0/24', u'vms': [{u'mem': 3, u'name': u't1_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br2if1', u'vmif': u't1VM3if1'}], u'vxlan': [{u'local_ip': [], u'tenant_route_ip': [], u'dsport': [], u'dev': [], u'subnet_route': [], u'remote_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}) => {"ansible_loop_var": "item", "changed": false, "cmd": ["ip", "netns", "add", "t1ns2"], "item": {"bridge_name": "t1br2", "default_route_ip": "10.1.2.1", "dns": [{"brif": "t1s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t1s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns2", "route": [{"if": "p1", "ip": "10.1.2.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "2.2.2.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns2if", "tenant_ns_ip": "10.1.2.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s2if", "tenant_sub_ip": "10.1.2.2/24"}], "vms": [{"brif": "t1br2if1", "disk": "10G", "mem": 3, "name": "t1_VM3", "vcpu": 2, "vmif": "t1VM3if1"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, "rc": 0, "stdout": "skipped, since /var/run/netns/t1ns2 exists", "stdout_lines": ["skipped, since /var/run/netns/t1ns2 exists"]}

TASK [Create Tenant VETH pairs] *****************************************************************************************************************************
changed: [localhost] => (item={u'default_route_ip': u'192.168.1.1', u'name': u't1', u'pns_ip': u'192.168.1.1/24', u'tenant_if': u't1if', u'tenant_ip': u'192.168.1.2/24', u'pns_if': u't1pns_if'}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip link show \"t1if\" ; if [ $? -ne 0 ] ; then ip link add \"t1if\" type veth peer name \"t1pns_if\" ; fi\n", "delta": "0:00:00.004061", "end": "2019-11-22 06:41:58.990806", "item": {"default_route_ip": "192.168.1.1", "name": "t1", "pns_if": "t1pns_if", "pns_ip": "192.168.1.1/24", "tenant_if": "t1if", "tenant_ip": "192.168.1.2/24"}, "rc": 0, "start": "2019-11-22 06:41:58.986745", "stderr": "", "stderr_lines": [], "stdout": "27: t1if@t1pns_if: <BROADCAST,MULTICAST> mtu 1500 qdisc noop state DOWN mode DEFAULT group default qlen 1000\n    link/ether d6:68:49:7d:6c:28 brd ff:ff:ff:ff:ff:ff", "stdout_lines": ["27: t1if@t1pns_if: <BROADCAST,MULTICAST> mtu 1500 qdisc noop state DOWN mode DEFAULT group default qlen 1000", "    link/ether d6:68:49:7d:6c:28 brd ff:ff:ff:ff:ff:ff"]}

TASK [Attach Tenant VETH Pairs] *****************************************************************************************************************************
changed: [localhost] => (item={u'default_route_ip': u'192.168.1.1', u'name': u't1', u'pns_ip': u'192.168.1.1/24', u'tenant_if': u't1if', u'tenant_ip': u'192.168.1.2/24', u'pns_if': u't1pns_if'}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec pns ip link show \"t1pns_if\" ; if [ $? -ne 0 ] ; then ip link set \"t1pns_if\" netns pns ; fi\nip netns exec \"t1\" ip link show \"t1if\" ; if [ $? -ne 0 ] ; then ip link set \"t1if\" netns \"t1\" ; fi\nip netns exec pns ip link set dev \"t1pns_if\" up\nip netns exec \"t1\" ip link set dev \"t1if\" up\n", "delta": "0:00:00.163297", "end": "2019-11-22 06:41:59.406253", "item": {"default_route_ip": "192.168.1.1", "name": "t1", "pns_if": "t1pns_if", "pns_ip": "192.168.1.1/24", "tenant_if": "t1if", "tenant_ip": "192.168.1.2/24"}, "rc": 0, "start": "2019-11-22 06:41:59.242956", "stderr": "", "stderr_lines": [], "stdout": "14: t1pns_if@if15: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP mode DEFAULT group default qlen 1000\n    link/ether d6:cc:3c:10:c8:cd brd ff:ff:ff:ff:ff:ff link-netnsid 1\n15: t1if@if14: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP mode DEFAULT group default qlen 1000\n    link/ether 36:f4:e2:3f:e4:d7 brd ff:ff:ff:ff:ff:ff link-netnsid 0", "stdout_lines": ["14: t1pns_if@if15: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP mode DEFAULT group default qlen 1000", "    link/ether d6:cc:3c:10:c8:cd brd ff:ff:ff:ff:ff:ff link-netnsid 1", "15: t1if@if14: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP mode DEFAULT group default qlen 1000", "    link/ether 36:f4:e2:3f:e4:d7 brd ff:ff:ff:ff:ff:ff link-netnsid 0"]}

TASK [Add IP addresses to Tenant VETH Pairs] ****************************************************************************************************************
changed: [localhost] => (item={u'default_route_ip': u'192.168.1.1', u'name': u't1', u'pns_ip': u'192.168.1.1/24', u'tenant_if': u't1if', u'tenant_ip': u'192.168.1.2/24', u'pns_if': u't1pns_if'}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec pns ip addr show \"t1pns_if\" | awk 'FNR==3{ print $2 }' | grep -w '^192.168.1.1/24' ; if [ $? -ne 0 ] ; then ip netns exec pns ip addr add \"192.168.1.1/24\" dev \"t1pns_if\" ; fi\nip netns exec \"t1\" ip addr show \"t1if\" | awk 'FNR==3{ print $2 }' | grep -w '^192.168.1.2/24' ; if [ $? -ne 0 ] ; then ip netns exec \"t1\" ip addr add \"192.168.1.2/24\" dev \"t1if\" ; fi\n", "delta": "0:00:00.076852", "end": "2019-11-22 06:41:59.734309", "item": {"default_route_ip": "192.168.1.1", "name": "t1", "pns_if": "t1pns_if", "pns_ip": "192.168.1.1/24", "tenant_if": "t1if", "tenant_ip": "192.168.1.2/24"}, "rc": 0, "start": "2019-11-22 06:41:59.657457", "stderr": "", "stderr_lines": [], "stdout": "192.168.1.1/24\n192.168.1.2/24", "stdout_lines": ["192.168.1.1/24", "192.168.1.2/24"]}

TASK [Create Namespace VETH Pairs] **************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't1_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM1if1'}, {u'mem': 4, u'name': u't1_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br1if2', u'vmif': u't1VM2if1'}], u'vxlan': [{u'local_ip': u'10.1.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.1.2', u'remote_route': u'10.2.1.0/24', u'subnet_route': u'10.1.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.2.1.2'}]}, {u'tenant_sub_ip': u'10.1.1.2/24', u'tenant_ns_ip': u'10.1.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip link show \"t1ns1if\" ; if [ $? -ne 0 ] ; then ip link add \"t1ns1if\" type veth peer name \"t1s1if\" ; fi\n", "delta": "0:00:00.004436", "end": "2019-11-22 06:42:00.010358", "item": [{"bridge_name": "t1br1", "default_route_ip": "10.1.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.1.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "vms": [{"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM1", "vcpu": 4, "vmif": "t1VM1if1"}, {"brif": "t1br1if2", "disk": "10G", "mem": 4, "name": "t1_VM2", "vcpu": 2, "vmif": "t1VM2if1"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.1.2", "remote_ip": "10.2.1.2", "remote_route": "10.2.1.0/24", "subnet_route": "10.1.1.0/24", "tenant_route_ip": "192.168.1.2", "v_name": "vxlan_t1s1"}]}, {"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.1.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.1.1.2/24"}], "rc": 0, "start": "2019-11-22 06:42:00.005922", "stderr": "", "stderr_lines": [], "stdout": "29: t1ns1if@t1s1if: <BROADCAST,MULTICAST> mtu 1500 qdisc noop state DOWN mode DEFAULT group default qlen 1000\n    link/ether f6:03:3e:3f:f1:61 brd ff:ff:ff:ff:ff:ff", "stdout_lines": ["29: t1ns1if@t1s1if: <BROADCAST,MULTICAST> mtu 1500 qdisc noop state DOWN mode DEFAULT group default qlen 1000", "    link/ether f6:03:3e:3f:f1:61 brd ff:ff:ff:ff:ff:ff"]}
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.2.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.2.1', u'bridge_name': u't1br2', u'dns': [{u'dnsif': u't1s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s2_dnsbrif'}], u'ns_name': u't1ns2', u'subnet_ip': u'2.2.2.0/24', u'vms': [{u'mem': 3, u'name': u't1_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br2if1', u'vmif': u't1VM3if1'}], u'vxlan': [{u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}, {u'tenant_sub_ip': u'10.1.2.2/24', u'tenant_ns_ip': u'10.1.2.1/24', u'tenant_ns_if': u't1ns2if', u'tenant_sub_if': u't1s2if', u'tenant_ns_name': u't1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip link show \"t1ns2if\" ; if [ $? -ne 0 ] ; then ip link add \"t1ns2if\" type veth peer name \"t1s2if\" ; fi\n", "delta": "0:00:00.004490", "end": "2019-11-22 06:42:00.236571", "item": [{"bridge_name": "t1br2", "default_route_ip": "10.1.2.1", "dns": [{"brif": "t1s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t1s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns2", "route": [{"if": "p1", "ip": "10.1.2.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "2.2.2.0/24", "vms": [{"brif": "t1br2if1", "disk": "10G", "mem": 3, "name": "t1_VM3", "vcpu": 2, "vmif": "t1VM3if1"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, {"tenant_ns_if": "t1ns2if", "tenant_ns_ip": "10.1.2.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s2if", "tenant_sub_ip": "10.1.2.2/24"}], "rc": 0, "start": "2019-11-22 06:42:00.232081", "stderr": "", "stderr_lines": [], "stdout": "31: t1ns2if@t1s2if: <BROADCAST,MULTICAST> mtu 1500 qdisc noop state DOWN mode DEFAULT group default qlen 1000\n    link/ether 8e:fa:0e:8e:23:3f brd ff:ff:ff:ff:ff:ff", "stdout_lines": ["31: t1ns2if@t1s2if: <BROADCAST,MULTICAST> mtu 1500 qdisc noop state DOWN mode DEFAULT group default qlen 1000", "    link/ether 8e:fa:0e:8e:23:3f brd ff:ff:ff:ff:ff:ff"]}

TASK [Attach Namespace VETH Pairs] **************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't1_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM1if1'}, {u'mem': 4, u'name': u't1_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br1if2', u'vmif': u't1VM2if1'}], u'vxlan': [{u'local_ip': u'10.1.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.1.2', u'remote_route': u'10.2.1.0/24', u'subnet_route': u'10.1.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.2.1.2'}]}, {u'tenant_sub_ip': u'10.1.1.2/24', u'tenant_ns_ip': u'10.1.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t1\" ip link show \"t1ns1if\" ; if [ $? -ne 0 ] ; then ip link set \"t1ns1if\" netns \"t1\" ; fi\nip netns exec \"t1ns1\" ip link show \"t1s1if\" ; if [ $? -ne 0 ] ; then ip link set \"t1s1if\" netns \"t1ns1\" ; fi\n", "delta": "0:00:00.068948", "end": "2019-11-22 06:42:00.594278", "item": [{"bridge_name": "t1br1", "default_route_ip": "10.1.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.1.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "vms": [{"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM1", "vcpu": 4, "vmif": "t1VM1if1"}, {"brif": "t1br1if2", "disk": "10G", "mem": 4, "name": "t1_VM2", "vcpu": 2, "vmif": "t1VM2if1"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.1.2", "remote_ip": "10.2.1.2", "remote_route": "10.2.1.0/24", "subnet_route": "10.1.1.0/24", "tenant_route_ip": "192.168.1.2", "v_name": "vxlan_t1s1"}]}, {"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.1.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.1.1.2/24"}], "rc": 0, "start": "2019-11-22 06:42:00.525330", "stderr": "", "stderr_lines": [], "stdout": "17: t1ns1if@if16: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP mode DEFAULT group default qlen 1000\n    link/ether 46:f3:8c:9c:ca:6d brd ff:ff:ff:ff:ff:ff link-netnsid 2\n16: t1s1if@if17: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP mode DEFAULT group default qlen 1000\n    link/ether 62:15:ca:47:3b:1d brd ff:ff:ff:ff:ff:ff link-netnsid 0", "stdout_lines": ["17: t1ns1if@if16: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP mode DEFAULT group default qlen 1000", "    link/ether 46:f3:8c:9c:ca:6d brd ff:ff:ff:ff:ff:ff link-netnsid 2", "16: t1s1if@if17: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP mode DEFAULT group default qlen 1000", "    link/ether 62:15:ca:47:3b:1d brd ff:ff:ff:ff:ff:ff link-netnsid 0"]}
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.2.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.2.1', u'bridge_name': u't1br2', u'dns': [{u'dnsif': u't1s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s2_dnsbrif'}], u'ns_name': u't1ns2', u'subnet_ip': u'2.2.2.0/24', u'vms': [{u'mem': 3, u'name': u't1_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br2if1', u'vmif': u't1VM3if1'}], u'vxlan': [{u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}, {u'tenant_sub_ip': u'10.1.2.2/24', u'tenant_ns_ip': u'10.1.2.1/24', u'tenant_ns_if': u't1ns2if', u'tenant_sub_if': u't1s2if', u'tenant_ns_name': u't1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t1\" ip link show \"t1ns2if\" ; if [ $? -ne 0 ] ; then ip link set \"t1ns2if\" netns \"t1\" ; fi\nip netns exec \"t1ns2\" ip link show \"t1s2if\" ; if [ $? -ne 0 ] ; then ip link set \"t1s2if\" netns \"t1ns2\" ; fi\n", "delta": "0:00:00.065404", "end": "2019-11-22 06:42:00.886383", "item": [{"bridge_name": "t1br2", "default_route_ip": "10.1.2.1", "dns": [{"brif": "t1s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t1s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns2", "route": [{"if": "p1", "ip": "10.1.2.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "2.2.2.0/24", "vms": [{"brif": "t1br2if1", "disk": "10G", "mem": 3, "name": "t1_VM3", "vcpu": 2, "vmif": "t1VM3if1"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, {"tenant_ns_if": "t1ns2if", "tenant_ns_ip": "10.1.2.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s2if", "tenant_sub_ip": "10.1.2.2/24"}], "rc": 0, "start": "2019-11-22 06:42:00.820979", "stderr": "", "stderr_lines": [], "stdout": "19: t1ns2if@if18: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP mode DEFAULT group default qlen 1000\n    link/ether ba:3f:18:27:db:c8 brd ff:ff:ff:ff:ff:ff link-netnsid 3\n18: t1s2if@if19: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP mode DEFAULT group default qlen 1000\n    link/ether d6:f7:39:91:be:e3 brd ff:ff:ff:ff:ff:ff link-netnsid 0", "stdout_lines": ["19: t1ns2if@if18: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP mode DEFAULT group default qlen 1000", "    link/ether ba:3f:18:27:db:c8 brd ff:ff:ff:ff:ff:ff link-netnsid 3", "18: t1s2if@if19: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP mode DEFAULT group default qlen 1000", "    link/ether d6:f7:39:91:be:e3 brd ff:ff:ff:ff:ff:ff link-netnsid 0"]}

TASK [Set Namespace VETH Pairs UP] **************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't1_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM1if1'}, {u'mem': 4, u'name': u't1_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br1if2', u'vmif': u't1VM2if1'}], u'vxlan': [{u'local_ip': u'10.1.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.1.2', u'remote_route': u'10.2.1.0/24', u'subnet_route': u'10.1.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.2.1.2'}]}, {u'tenant_sub_ip': u'10.1.1.2/24', u'tenant_ns_ip': u'10.1.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t1\" ip link set dev \"t1ns1if\" up\nip netns exec \"t1ns1\" ip link set dev \"t1s1if\" up\n", "delta": "0:00:00.068780", "end": "2019-11-22 06:42:01.250405", "item": [{"bridge_name": "t1br1", "default_route_ip": "10.1.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.1.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "vms": [{"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM1", "vcpu": 4, "vmif": "t1VM1if1"}, {"brif": "t1br1if2", "disk": "10G", "mem": 4, "name": "t1_VM2", "vcpu": 2, "vmif": "t1VM2if1"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.1.2", "remote_ip": "10.2.1.2", "remote_route": "10.2.1.0/24", "subnet_route": "10.1.1.0/24", "tenant_route_ip": "192.168.1.2", "v_name": "vxlan_t1s1"}]}, {"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.1.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.1.1.2/24"}], "rc": 0, "start": "2019-11-22 06:42:01.181625", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.2.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.2.1', u'bridge_name': u't1br2', u'dns': [{u'dnsif': u't1s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s2_dnsbrif'}], u'ns_name': u't1ns2', u'subnet_ip': u'2.2.2.0/24', u'vms': [{u'mem': 3, u'name': u't1_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br2if1', u'vmif': u't1VM3if1'}], u'vxlan': [{u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}, {u'tenant_sub_ip': u'10.1.2.2/24', u'tenant_ns_ip': u'10.1.2.1/24', u'tenant_ns_if': u't1ns2if', u'tenant_sub_if': u't1s2if', u'tenant_ns_name': u't1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t1\" ip link set dev \"t1ns2if\" up\nip netns exec \"t1ns2\" ip link set dev \"t1s2if\" up\n", "delta": "0:00:00.079845", "end": "2019-11-22 06:42:01.554381", "item": [{"bridge_name": "t1br2", "default_route_ip": "10.1.2.1", "dns": [{"brif": "t1s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t1s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns2", "route": [{"if": "p1", "ip": "10.1.2.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "2.2.2.0/24", "vms": [{"brif": "t1br2if1", "disk": "10G", "mem": 3, "name": "t1_VM3", "vcpu": 2, "vmif": "t1VM3if1"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, {"tenant_ns_if": "t1ns2if", "tenant_ns_ip": "10.1.2.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s2if", "tenant_sub_ip": "10.1.2.2/24"}], "rc": 0, "start": "2019-11-22 06:42:01.474536", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Add IP addresses to Namespace VETH Pairs] *************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't1_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM1if1'}, {u'mem': 4, u'name': u't1_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br1if2', u'vmif': u't1VM2if1'}], u'vxlan': [{u'local_ip': u'10.1.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.1.2', u'remote_route': u'10.2.1.0/24', u'subnet_route': u'10.1.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.2.1.2'}]}, {u'tenant_sub_ip': u'10.1.1.2/24', u'tenant_ns_ip': u'10.1.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t1ns1\" ip addr show \"t1s1if\" | awk 'FNR==3{ print $2 }' | grep -w '^10.1.1.2/24' ; if [ $? -ne 0 ] ; then ip netns exec \"t1ns1\" ip addr add \"10.1.1.2/24\" dev \"t1s1if\" ; fi\n\nip netns exec \"t1\" ip addr show \"t1ns1if\" | awk 'FNR==3{ print $2 }' | grep -w '^10.1.1.1/24' ; if [ $? -ne 0 ] ; then ip netns exec \"t1\" ip addr add \"10.1.1.1/24\" dev \"t1ns1if\" ; fi\n", "delta": "0:00:00.067799", "end": "2019-11-22 06:42:01.922388", "item": [{"bridge_name": "t1br1", "default_route_ip": "10.1.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.1.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "vms": [{"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM1", "vcpu": 4, "vmif": "t1VM1if1"}, {"brif": "t1br1if2", "disk": "10G", "mem": 4, "name": "t1_VM2", "vcpu": 2, "vmif": "t1VM2if1"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.1.2", "remote_ip": "10.2.1.2", "remote_route": "10.2.1.0/24", "subnet_route": "10.1.1.0/24", "tenant_route_ip": "192.168.1.2", "v_name": "vxlan_t1s1"}]}, {"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.1.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.1.1.2/24"}], "rc": 0, "start": "2019-11-22 06:42:01.854589", "stderr": "", "stderr_lines": [], "stdout": "10.1.1.2/24\n10.1.1.1/24", "stdout_lines": ["10.1.1.2/24", "10.1.1.1/24"]}
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.2.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.2.1', u'bridge_name': u't1br2', u'dns': [{u'dnsif': u't1s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s2_dnsbrif'}], u'ns_name': u't1ns2', u'subnet_ip': u'2.2.2.0/24', u'vms': [{u'mem': 3, u'name': u't1_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br2if1', u'vmif': u't1VM3if1'}], u'vxlan': [{u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}, {u'tenant_sub_ip': u'10.1.2.2/24', u'tenant_ns_ip': u'10.1.2.1/24', u'tenant_ns_if': u't1ns2if', u'tenant_sub_if': u't1s2if', u'tenant_ns_name': u't1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t1ns2\" ip addr show \"t1s2if\" | awk 'FNR==3{ print $2 }' | grep -w '^10.1.2.2/24' ; if [ $? -ne 0 ] ; then ip netns exec \"t1ns2\" ip addr add \"10.1.2.2/24\" dev \"t1s2if\" ; fi\n\nip netns exec \"t1\" ip addr show \"t1ns2if\" | awk 'FNR==3{ print $2 }' | grep -w '^10.1.2.1/24' ; if [ $? -ne 0 ] ; then ip netns exec \"t1\" ip addr add \"10.1.2.1/24\" dev \"t1ns2if\" ; fi\n", "delta": "0:00:00.068964", "end": "2019-11-22 06:42:02.186309", "item": [{"bridge_name": "t1br2", "default_route_ip": "10.1.2.1", "dns": [{"brif": "t1s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t1s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns2", "route": [{"if": "p1", "ip": "10.1.2.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "2.2.2.0/24", "vms": [{"brif": "t1br2if1", "disk": "10G", "mem": 3, "name": "t1_VM3", "vcpu": 2, "vmif": "t1VM3if1"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, {"tenant_ns_if": "t1ns2if", "tenant_ns_ip": "10.1.2.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s2if", "tenant_sub_ip": "10.1.2.2/24"}], "rc": 0, "start": "2019-11-22 06:42:02.117345", "stderr": "", "stderr_lines": [], "stdout": "10.1.2.2/24\n10.1.2.1/24", "stdout_lines": ["10.1.2.2/24", "10.1.2.1/24"]}

TASK [Add IP Route to Tenant] *******************************************************************************************************************************
changed: [localhost] => (item={u'default_route_ip': u'192.168.1.1', u'name': u't1', u'pns_ip': u'192.168.1.1/24', u'tenant_if': u't1if', u'tenant_ip': u'192.168.1.2/24', u'pns_if': u't1pns_if'}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t1\" ip route show default | grep -w '[d]efault via 192.168.1.1' ; if [ $? -ne 0 ] ; then ip netns exec \"t1\" ip route add default via \"192.168.1.1\" ; fi\n", "delta": "0:00:00.042940", "end": "2019-11-22 06:42:02.490466", "item": {"default_route_ip": "192.168.1.1", "name": "t1", "pns_if": "t1pns_if", "pns_ip": "192.168.1.1/24", "tenant_if": "t1if", "tenant_ip": "192.168.1.2/24"}, "rc": 0, "start": "2019-11-22 06:42:02.447526", "stderr": "", "stderr_lines": [], "stdout": "default via 192.168.1.1 dev t1if ", "stdout_lines": ["default via 192.168.1.1 dev t1if "]}

TASK [Add IP Route to Tenant Subnet] ************************************************************************************************************************
changed: [localhost] => (item={u'route': [{u'ip': u'10.1.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.1.2/24', u'tenant_ns_ip': u'10.1.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_ns_name': u't1', u'tenant_sub_if': u't1s1if'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't1_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM1if1'}, {u'mem': 4, u'name': u't1_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br1if2', u'vmif': u't1VM2if1'}], u'vxlan': [{u'local_ip': u'10.1.1.2', u'tenant_route_ip': u'192.168.1.2', u'dsport': 4789, u'dev': u't1s1if', u'subnet_route': u'10.1.1.0/24', u'remote_route': u'10.2.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.2.1.2'}]}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t1ns1\" ip route show default | grep -w '[d]efault via 10.1.1.1' ; if [ $? -ne 0 ] ; then ip netns exec \"t1ns1\" ip route add default via \"10.1.1.1\" ; fi\n", "delta": "0:00:00.040898", "end": "2019-11-22 06:42:02.799221", "item": {"bridge_name": "t1br1", "default_route_ip": "10.1.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.1.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.1.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.1.1.2/24"}], "vms": [{"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM1", "vcpu": 4, "vmif": "t1VM1if1"}, {"brif": "t1br1if2", "disk": "10G", "mem": 4, "name": "t1_VM2", "vcpu": 2, "vmif": "t1VM2if1"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.1.2", "remote_ip": "10.2.1.2", "remote_route": "10.2.1.0/24", "subnet_route": "10.1.1.0/24", "tenant_route_ip": "192.168.1.2", "v_name": "vxlan_t1s1"}]}, "rc": 0, "start": "2019-11-22 06:42:02.758323", "stderr": "", "stderr_lines": [], "stdout": "default via 10.1.1.1 dev t1s1if ", "stdout_lines": ["default via 10.1.1.1 dev t1s1if "]}
changed: [localhost] => (item={u'route': [{u'ip': u'10.1.2.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.2.1', u'bridge_name': u't1br2', u'dns': [{u'dnsif': u't1s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s2_dnsbrif'}], u'ns_name': u't1ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.2.2/24', u'tenant_ns_ip': u'10.1.2.1/24', u'tenant_ns_if': u't1ns2if', u'tenant_ns_name': u't1', u'tenant_sub_if': u't1s2if'}], u'subnet_ip': u'2.2.2.0/24', u'vms': [{u'mem': 3, u'name': u't1_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br2if1', u'vmif': u't1VM3if1'}], u'vxlan': [{u'local_ip': [], u'tenant_route_ip': [], u'dsport': [], u'dev': [], u'subnet_route': [], u'remote_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t1ns2\" ip route show default | grep -w '[d]efault via 10.1.2.1' ; if [ $? -ne 0 ] ; then ip netns exec \"t1ns2\" ip route add default via \"10.1.2.1\" ; fi\n", "delta": "0:00:00.035227", "end": "2019-11-22 06:42:03.062350", "item": {"bridge_name": "t1br2", "default_route_ip": "10.1.2.1", "dns": [{"brif": "t1s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t1s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns2", "route": [{"if": "p1", "ip": "10.1.2.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "2.2.2.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns2if", "tenant_ns_ip": "10.1.2.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s2if", "tenant_sub_ip": "10.1.2.2/24"}], "vms": [{"brif": "t1br2if1", "disk": "10G", "mem": 3, "name": "t1_VM3", "vcpu": 2, "vmif": "t1VM3if1"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, "rc": 0, "start": "2019-11-22 06:42:03.027123", "stderr": "", "stderr_lines": [], "stdout": "default via 10.1.2.1 dev t1s2if ", "stdout_lines": ["default via 10.1.2.1 dev t1s2if "]}

TASK [Create bridge inside namespace] ***********************************************************************************************************************
changed: [localhost] => (item={u'route': [{u'ip': u'10.1.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.1.2/24', u'tenant_ns_ip': u'10.1.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_ns_name': u't1', u'tenant_sub_if': u't1s1if'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't1_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM1if1'}, {u'mem': 4, u'name': u't1_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br1if2', u'vmif': u't1VM2if1'}], u'vxlan': [{u'local_ip': u'10.1.1.2', u'tenant_route_ip': u'192.168.1.2', u'dsport': 4789, u'dev': u't1s1if', u'subnet_route': u'10.1.1.0/24', u'remote_route': u'10.2.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.2.1.2'}]}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t1ns1\" brctl show | grep -w '^t1br1'; if [ $? -ne 0 ] ; then ip netns exec \"t1ns1\" brctl addbr \"t1br1\" ; fi\nip netns exec \"t1ns1\" ip link set dev \"t1br1\" up\n", "delta": "0:00:00.070057", "end": "2019-11-22 06:42:03.442299", "item": {"bridge_name": "t1br1", "default_route_ip": "10.1.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.1.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.1.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.1.1.2/24"}], "vms": [{"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM1", "vcpu": 4, "vmif": "t1VM1if1"}, {"brif": "t1br1if2", "disk": "10G", "mem": 4, "name": "t1_VM2", "vcpu": 2, "vmif": "t1VM2if1"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.1.2", "remote_ip": "10.2.1.2", "remote_route": "10.2.1.0/24", "subnet_route": "10.1.1.0/24", "tenant_route_ip": "192.168.1.2", "v_name": "vxlan_t1s1"}]}, "rc": 0, "start": "2019-11-22 06:42:03.372242", "stderr": "", "stderr_lines": [], "stdout": "t1br1\t\t8000.4679e2aabaf9\tno\t\tt1br1if1", "stdout_lines": ["t1br1\t\t8000.4679e2aabaf9\tno\t\tt1br1if1"]}
changed: [localhost] => (item={u'route': [{u'ip': u'10.1.2.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.2.1', u'bridge_name': u't1br2', u'dns': [{u'dnsif': u't1s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s2_dnsbrif'}], u'ns_name': u't1ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.2.2/24', u'tenant_ns_ip': u'10.1.2.1/24', u'tenant_ns_if': u't1ns2if', u'tenant_ns_name': u't1', u'tenant_sub_if': u't1s2if'}], u'subnet_ip': u'2.2.2.0/24', u'vms': [{u'mem': 3, u'name': u't1_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br2if1', u'vmif': u't1VM3if1'}], u'vxlan': [{u'local_ip': [], u'tenant_route_ip': [], u'dsport': [], u'dev': [], u'subnet_route': [], u'remote_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t1ns2\" brctl show | grep -w '^t1br2'; if [ $? -ne 0 ] ; then ip netns exec \"t1ns2\" brctl addbr \"t1br2\" ; fi\nip netns exec \"t1ns2\" ip link set dev \"t1br2\" up\n", "delta": "0:00:00.075420", "end": "2019-11-22 06:42:03.746313", "item": {"bridge_name": "t1br2", "default_route_ip": "10.1.2.1", "dns": [{"brif": "t1s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t1s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns2", "route": [{"if": "p1", "ip": "10.1.2.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "2.2.2.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns2if", "tenant_ns_ip": "10.1.2.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s2if", "tenant_sub_ip": "10.1.2.2/24"}], "vms": [{"brif": "t1br2if1", "disk": "10G", "mem": 3, "name": "t1_VM3", "vcpu": 2, "vmif": "t1VM3if1"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, "rc": 0, "start": "2019-11-22 06:42:03.670893", "stderr": "", "stderr_lines": [], "stdout": "t1br2\t\t8000.225af8b64bfa\tno\t\tt1br2if1", "stdout_lines": ["t1br2\t\t8000.225af8b64bfa\tno\t\tt1br2if1"]}

TASK [Create DNS VETH Pair] *********************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.1.1', u'bridge_name': u't1br1', u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.1.2/24', u'tenant_ns_ip': u'10.1.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't1_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM1if1'}, {u'mem': 4, u'name': u't1_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br1if2', u'vmif': u't1VM2if1'}], u'vxlan': [{u'local_ip': u'10.1.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.1.2', u'remote_route': u'10.2.1.0/24', u'subnet_route': u'10.1.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.2.1.2'}]}, {u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t1ns1\" ip link show \"t1s1_dnsbrif\" ; if [ $? -ne 0 ] ; then ip netns exec \"t1ns1\" ip link add \"t1s1_dnsbrif\" type veth peer name \"t1s1_dnsif\" ; fi\nip netns exec \"t1ns1\" ip link set dev \"t1s1_dnsbrif\" up\nip netns exec \"t1ns1\" ip link set dev \"t1s1_dnsif\" up\n", "delta": "0:00:00.099085", "end": "2019-11-22 06:42:04.130343", "item": [{"bridge_name": "t1br1", "default_route_ip": "10.1.1.1", "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.1.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.1.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.1.1.2/24"}], "vms": [{"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM1", "vcpu": 4, "vmif": "t1VM1if1"}, {"brif": "t1br1if2", "disk": "10G", "mem": 4, "name": "t1_VM2", "vcpu": 2, "vmif": "t1VM2if1"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.1.2", "remote_ip": "10.2.1.2", "remote_route": "10.2.1.0/24", "subnet_route": "10.1.1.0/24", "tenant_route_ip": "192.168.1.2", "v_name": "vxlan_t1s1"}]}, {"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "rc": 0, "start": "2019-11-22 06:42:04.031258", "stderr": "", "stderr_lines": [], "stdout": "4: t1s1_dnsbrif@t1s1_dnsif: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue master t1br1 state UP mode DEFAULT group default qlen 1000\n    link/ether 4e:a8:79:10:75:b7 brd ff:ff:ff:ff:ff:ff", "stdout_lines": ["4: t1s1_dnsbrif@t1s1_dnsif: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue master t1br1 state UP mode DEFAULT group default qlen 1000", "    link/ether 4e:a8:79:10:75:b7 brd ff:ff:ff:ff:ff:ff"]}
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.2.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.2.1', u'bridge_name': u't1br2', u'ns_name': u't1ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.2.2/24', u'tenant_ns_ip': u'10.1.2.1/24', u'tenant_ns_if': u't1ns2if', u'tenant_sub_if': u't1s2if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'2.2.2.0/24', u'vms': [{u'mem': 3, u'name': u't1_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br2if1', u'vmif': u't1VM3if1'}], u'vxlan': [{u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}, {u'dnsif': u't1s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s2_dnsbrif'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t1ns2\" ip link show \"t1s2_dnsbrif\" ; if [ $? -ne 0 ] ; then ip netns exec \"t1ns2\" ip link add \"t1s2_dnsbrif\" type veth peer name \"t1s2_dnsif\" ; fi\nip netns exec \"t1ns2\" ip link set dev \"t1s2_dnsbrif\" up\nip netns exec \"t1ns2\" ip link set dev \"t1s2_dnsif\" up\n", "delta": "0:00:00.114112", "end": "2019-11-22 06:42:04.482347", "item": [{"bridge_name": "t1br2", "default_route_ip": "10.1.2.1", "ns_name": "t1ns2", "route": [{"if": "p1", "ip": "10.1.2.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "2.2.2.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns2if", "tenant_ns_ip": "10.1.2.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s2if", "tenant_sub_ip": "10.1.2.2/24"}], "vms": [{"brif": "t1br2if1", "disk": "10G", "mem": 3, "name": "t1_VM3", "vcpu": 2, "vmif": "t1VM3if1"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, {"brif": "t1s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t1s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "rc": 0, "start": "2019-11-22 06:42:04.368235", "stderr": "", "stderr_lines": [], "stdout": "4: t1s2_dnsbrif@t1s2_dnsif: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue master t1br2 state UP mode DEFAULT group default qlen 1000\n    link/ether 76:f4:fa:92:f1:18 brd ff:ff:ff:ff:ff:ff", "stdout_lines": ["4: t1s2_dnsbrif@t1s2_dnsif: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue master t1br2 state UP mode DEFAULT group default qlen 1000", "    link/ether 76:f4:fa:92:f1:18 brd ff:ff:ff:ff:ff:ff"]}

TASK [Attach DNS VETH Pair] *********************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.1.1', u'bridge_name': u't1br1', u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.1.2/24', u'tenant_ns_ip': u'10.1.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't1_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM1if1'}, {u'mem': 4, u'name': u't1_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br1if2', u'vmif': u't1VM2if1'}], u'vxlan': [{u'local_ip': u'10.1.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.1.2', u'remote_route': u'10.2.1.0/24', u'subnet_route': u'10.1.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.2.1.2'}]}, {u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t1ns1\" brctl show \"t1br1\" | grep -w 't1s1_dnsbrif' ; if [ $? -ne 0 ] ; then ip netns exec \"t1ns1\" brctl addif \"t1br1\" \"t1s1_dnsbrif\" ; fi\n", "delta": "0:00:00.060084", "end": "2019-11-22 06:42:04.842499", "item": [{"bridge_name": "t1br1", "default_route_ip": "10.1.1.1", "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.1.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.1.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.1.1.2/24"}], "vms": [{"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM1", "vcpu": 4, "vmif": "t1VM1if1"}, {"brif": "t1br1if2", "disk": "10G", "mem": 4, "name": "t1_VM2", "vcpu": 2, "vmif": "t1VM2if1"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.1.2", "remote_ip": "10.2.1.2", "remote_route": "10.2.1.0/24", "subnet_route": "10.1.1.0/24", "tenant_route_ip": "192.168.1.2", "v_name": "vxlan_t1s1"}]}, {"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "rc": 0, "start": "2019-11-22 06:42:04.782415", "stderr": "", "stderr_lines": [], "stdout": "\t\t\t\t\t\t\tt1s1_dnsbrif", "stdout_lines": ["\t\t\t\t\t\t\tt1s1_dnsbrif"]}
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.2.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.2.1', u'bridge_name': u't1br2', u'ns_name': u't1ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.2.2/24', u'tenant_ns_ip': u'10.1.2.1/24', u'tenant_ns_if': u't1ns2if', u'tenant_sub_if': u't1s2if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'2.2.2.0/24', u'vms': [{u'mem': 3, u'name': u't1_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br2if1', u'vmif': u't1VM3if1'}], u'vxlan': [{u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}, {u'dnsif': u't1s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s2_dnsbrif'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t1ns2\" brctl show \"t1br2\" | grep -w 't1s2_dnsbrif' ; if [ $? -ne 0 ] ; then ip netns exec \"t1ns2\" brctl addif \"t1br2\" \"t1s2_dnsbrif\" ; fi\n", "delta": "0:00:00.037667", "end": "2019-11-22 06:42:05.082405", "item": [{"bridge_name": "t1br2", "default_route_ip": "10.1.2.1", "ns_name": "t1ns2", "route": [{"if": "p1", "ip": "10.1.2.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "2.2.2.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns2if", "tenant_ns_ip": "10.1.2.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s2if", "tenant_sub_ip": "10.1.2.2/24"}], "vms": [{"brif": "t1br2if1", "disk": "10G", "mem": 3, "name": "t1_VM3", "vcpu": 2, "vmif": "t1VM3if1"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, {"brif": "t1s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t1s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "rc": 0, "start": "2019-11-22 06:42:05.044738", "stderr": "", "stderr_lines": [], "stdout": "\t\t\t\t\t\t\tt1s2_dnsbrif", "stdout_lines": ["\t\t\t\t\t\t\tt1s2_dnsbrif"]}

TASK [Create VETH Pairs] ************************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.1.2/24', u'tenant_ns_ip': u'10.1.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.1.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.1.2', u'remote_route': u'10.2.1.0/24', u'subnet_route': u'10.1.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.2.1.2'}]}, {u'mem': 2, u'name': u't1_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM1if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip link show \"t1br1if1\" ; if [ $? -ne 0 ] ; then ip link add \"t1VM1if1\" type veth peer name \"t1br1if1\" ; fi\nip link set dev \"t1br1if1\" up\nip link set dev \"t1VM1if1\" up\n", "delta": "0:00:00.012909", "end": "2019-11-22 06:42:05.360446", "item": [{"bridge_name": "t1br1", "default_route_ip": "10.1.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.1.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.1.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.1.1.2/24"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.1.2", "remote_ip": "10.2.1.2", "remote_route": "10.2.1.0/24", "subnet_route": "10.1.1.0/24", "tenant_route_ip": "192.168.1.2", "v_name": "vxlan_t1s1"}]}, {"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM1", "vcpu": 4, "vmif": "t1VM1if1"}], "rc": 0, "start": "2019-11-22 06:42:05.347537", "stderr": "Device \"t1br1if1\" does not exist.\nRTNETLINK answers: File exists\nCannot find device \"t1br1if1\"", "stderr_lines": ["Device \"t1br1if1\" does not exist.", "RTNETLINK answers: File exists", "Cannot find device \"t1br1if1\""], "stdout": "", "stdout_lines": []}
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.1.2/24', u'tenant_ns_ip': u'10.1.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.1.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.1.2', u'remote_route': u'10.2.1.0/24', u'subnet_route': u'10.1.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.2.1.2'}]}, {u'mem': 4, u'name': u't1_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br1if2', u'vmif': u't1VM2if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip link show \"t1br1if2\" ; if [ $? -ne 0 ] ; then ip link add \"t1VM2if1\" type veth peer name \"t1br1if2\" ; fi\nip link set dev \"t1br1if2\" up\nip link set dev \"t1VM2if1\" up\n", "delta": "0:00:00.012057", "end": "2019-11-22 06:42:05.560995", "item": [{"bridge_name": "t1br1", "default_route_ip": "10.1.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.1.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.1.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.1.1.2/24"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.1.2", "remote_ip": "10.2.1.2", "remote_route": "10.2.1.0/24", "subnet_route": "10.1.1.0/24", "tenant_route_ip": "192.168.1.2", "v_name": "vxlan_t1s1"}]}, {"brif": "t1br1if2", "disk": "10G", "mem": 4, "name": "t1_VM2", "vcpu": 2, "vmif": "t1VM2if1"}], "rc": 0, "start": "2019-11-22 06:42:05.548938", "stderr": "Device \"t1br1if2\" does not exist.\nRTNETLINK answers: File exists\nCannot find device \"t1br1if2\"", "stderr_lines": ["Device \"t1br1if2\" does not exist.", "RTNETLINK answers: File exists", "Cannot find device \"t1br1if2\""], "stdout": "", "stdout_lines": []}
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.2.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.2.1', u'bridge_name': u't1br2', u'dns': [{u'dnsif': u't1s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s2_dnsbrif'}], u'ns_name': u't1ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.2.2/24', u'tenant_ns_ip': u'10.1.2.1/24', u'tenant_ns_if': u't1ns2if', u'tenant_sub_if': u't1s2if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'2.2.2.0/24', u'vxlan': [{u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}, {u'mem': 3, u'name': u't1_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br2if1', u'vmif': u't1VM3if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip link show \"t1br2if1\" ; if [ $? -ne 0 ] ; then ip link add \"t1VM3if1\" type veth peer name \"t1br2if1\" ; fi\nip link set dev \"t1br2if1\" up\nip link set dev \"t1VM3if1\" up\n", "delta": "0:00:00.012060", "end": "2019-11-22 06:42:05.767049", "item": [{"bridge_name": "t1br2", "default_route_ip": "10.1.2.1", "dns": [{"brif": "t1s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t1s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns2", "route": [{"if": "p1", "ip": "10.1.2.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "2.2.2.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns2if", "tenant_ns_ip": "10.1.2.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s2if", "tenant_sub_ip": "10.1.2.2/24"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, {"brif": "t1br2if1", "disk": "10G", "mem": 3, "name": "t1_VM3", "vcpu": 2, "vmif": "t1VM3if1"}], "rc": 0, "start": "2019-11-22 06:42:05.754989", "stderr": "Device \"t1br2if1\" does not exist.\nRTNETLINK answers: File exists\nCannot find device \"t1br2if1\"", "stderr_lines": ["Device \"t1br2if1\" does not exist.", "RTNETLINK answers: File exists", "Cannot find device \"t1br2if1\""], "stdout": "", "stdout_lines": []}

TASK [Attach VETH Pairs] ************************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.1.2/24', u'tenant_ns_ip': u'10.1.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.1.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.1.2', u'remote_route': u'10.2.1.0/24', u'subnet_route': u'10.1.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.2.1.2'}]}, {u'mem': 2, u'name': u't1_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM1if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip link show \"t1br1if1\" ; if [ $? -eq 0 ] ; then ip link set \"t1br1if1\" netns \"t1ns1\" ; fi\nip netns exec \"t1ns1\" brctl show \"t1br1\" | grep -w 't1br1if1' ; if [ $? -ne 0 ] ; then ip netns exec \"t1ns1\" brctl addif \"t1br1\" \"t1br1if1\" ; fi\n", "delta": "0:00:00.043201", "end": "2019-11-22 06:42:06.094365", "item": [{"bridge_name": "t1br1", "default_route_ip": "10.1.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.1.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.1.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.1.1.2/24"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.1.2", "remote_ip": "10.2.1.2", "remote_route": "10.2.1.0/24", "subnet_route": "10.1.1.0/24", "tenant_route_ip": "192.168.1.2", "v_name": "vxlan_t1s1"}]}, {"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM1", "vcpu": 4, "vmif": "t1VM1if1"}], "rc": 0, "start": "2019-11-22 06:42:06.051164", "stderr": "Device \"t1br1if1\" does not exist.", "stderr_lines": ["Device \"t1br1if1\" does not exist."], "stdout": "t1br1\t\t8000.4679e2aabaf9\tno\t\tt1br1if1", "stdout_lines": ["t1br1\t\t8000.4679e2aabaf9\tno\t\tt1br1if1"]}
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.1.2/24', u'tenant_ns_ip': u'10.1.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.1.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.1.2', u'remote_route': u'10.2.1.0/24', u'subnet_route': u'10.1.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.2.1.2'}]}, {u'mem': 4, u'name': u't1_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br1if2', u'vmif': u't1VM2if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip link show \"t1br1if2\" ; if [ $? -eq 0 ] ; then ip link set \"t1br1if2\" netns \"t1ns1\" ; fi\nip netns exec \"t1ns1\" brctl show \"t1br1\" | grep -w 't1br1if2' ; if [ $? -ne 0 ] ; then ip netns exec \"t1ns1\" brctl addif \"t1br1\" \"t1br1if2\" ; fi\n", "delta": "0:00:00.041621", "end": "2019-11-22 06:42:06.358383", "item": [{"bridge_name": "t1br1", "default_route_ip": "10.1.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.1.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.1.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.1.1.2/24"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.1.2", "remote_ip": "10.2.1.2", "remote_route": "10.2.1.0/24", "subnet_route": "10.1.1.0/24", "tenant_route_ip": "192.168.1.2", "v_name": "vxlan_t1s1"}]}, {"brif": "t1br1if2", "disk": "10G", "mem": 4, "name": "t1_VM2", "vcpu": 2, "vmif": "t1VM2if1"}], "rc": 0, "start": "2019-11-22 06:42:06.316762", "stderr": "Device \"t1br1if2\" does not exist.", "stderr_lines": ["Device \"t1br1if2\" does not exist."], "stdout": "\t\t\t\t\t\t\tt1br1if2", "stdout_lines": ["\t\t\t\t\t\t\tt1br1if2"]}
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.2.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.2.1', u'bridge_name': u't1br2', u'dns': [{u'dnsif': u't1s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s2_dnsbrif'}], u'ns_name': u't1ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.2.2/24', u'tenant_ns_ip': u'10.1.2.1/24', u'tenant_ns_if': u't1ns2if', u'tenant_sub_if': u't1s2if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'2.2.2.0/24', u'vxlan': [{u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}, {u'mem': 3, u'name': u't1_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br2if1', u'vmif': u't1VM3if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip link show \"t1br2if1\" ; if [ $? -eq 0 ] ; then ip link set \"t1br2if1\" netns \"t1ns2\" ; fi\nip netns exec \"t1ns2\" brctl show \"t1br2\" | grep -w 't1br2if1' ; if [ $? -ne 0 ] ; then ip netns exec \"t1ns2\" brctl addif \"t1br2\" \"t1br2if1\" ; fi\n", "delta": "0:00:00.033039", "end": "2019-11-22 06:42:06.598451", "item": [{"bridge_name": "t1br2", "default_route_ip": "10.1.2.1", "dns": [{"brif": "t1s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t1s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns2", "route": [{"if": "p1", "ip": "10.1.2.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "2.2.2.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns2if", "tenant_ns_ip": "10.1.2.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s2if", "tenant_sub_ip": "10.1.2.2/24"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, {"brif": "t1br2if1", "disk": "10G", "mem": 3, "name": "t1_VM3", "vcpu": 2, "vmif": "t1VM3if1"}], "rc": 0, "start": "2019-11-22 06:42:06.565412", "stderr": "Device \"t1br2if1\" does not exist.", "stderr_lines": ["Device \"t1br2if1\" does not exist."], "stdout": "t1br2\t\t8000.225af8b64bfa\tno\t\tt1br2if1", "stdout_lines": ["t1br2\t\t8000.225af8b64bfa\tno\t\tt1br2if1"]}

TASK [All interfaces and bridges UP] ************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.1.2/24', u'tenant_ns_ip': u'10.1.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.1.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.1.2', u'remote_route': u'10.2.1.0/24', u'subnet_route': u'10.1.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.2.1.2'}]}, {u'mem': 2, u'name': u't1_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM1if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t1ns1\" ip link set \"t1br1if1\" up\nip netns exec \"t1ns1\" ip link set dev \"t1br1\" up\n", "delta": "0:00:00.076289", "end": "2019-11-22 06:42:06.970393", "item": [{"bridge_name": "t1br1", "default_route_ip": "10.1.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.1.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.1.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.1.1.2/24"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.1.2", "remote_ip": "10.2.1.2", "remote_route": "10.2.1.0/24", "subnet_route": "10.1.1.0/24", "tenant_route_ip": "192.168.1.2", "v_name": "vxlan_t1s1"}]}, {"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM1", "vcpu": 4, "vmif": "t1VM1if1"}], "rc": 0, "start": "2019-11-22 06:42:06.894104", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.1.2/24', u'tenant_ns_ip': u'10.1.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.1.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.1.2', u'remote_route': u'10.2.1.0/24', u'subnet_route': u'10.1.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.2.1.2'}]}, {u'mem': 4, u'name': u't1_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br1if2', u'vmif': u't1VM2if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t1ns1\" ip link set \"t1br1if2\" up\nip netns exec \"t1ns1\" ip link set dev \"t1br1\" up\n", "delta": "0:00:00.068582", "end": "2019-11-22 06:42:07.258322", "item": [{"bridge_name": "t1br1", "default_route_ip": "10.1.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.1.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.1.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.1.1.2/24"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.1.2", "remote_ip": "10.2.1.2", "remote_route": "10.2.1.0/24", "subnet_route": "10.1.1.0/24", "tenant_route_ip": "192.168.1.2", "v_name": "vxlan_t1s1"}]}, {"brif": "t1br1if2", "disk": "10G", "mem": 4, "name": "t1_VM2", "vcpu": 2, "vmif": "t1VM2if1"}], "rc": 0, "start": "2019-11-22 06:42:07.189740", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.2.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.2.1', u'bridge_name': u't1br2', u'dns': [{u'dnsif': u't1s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s2_dnsbrif'}], u'ns_name': u't1ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.2.2/24', u'tenant_ns_ip': u'10.1.2.1/24', u'tenant_ns_if': u't1ns2if', u'tenant_sub_if': u't1s2if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'2.2.2.0/24', u'vxlan': [{u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}, {u'mem': 3, u'name': u't1_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br2if1', u'vmif': u't1VM3if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t1ns2\" ip link set \"t1br2if1\" up\nip netns exec \"t1ns2\" ip link set dev \"t1br2\" up\n", "delta": "0:00:00.068298", "end": "2019-11-22 06:42:07.546386", "item": [{"bridge_name": "t1br2", "default_route_ip": "10.1.2.1", "dns": [{"brif": "t1s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t1s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns2", "route": [{"if": "p1", "ip": "10.1.2.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "2.2.2.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns2if", "tenant_ns_ip": "10.1.2.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s2if", "tenant_sub_ip": "10.1.2.2/24"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, {"brif": "t1br2if1", "disk": "10G", "mem": 3, "name": "t1_VM3", "vcpu": 2, "vmif": "t1VM3if1"}], "rc": 0, "start": "2019-11-22 06:42:07.478088", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Add IP to DNS Interface] ******************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.1.1', u'bridge_name': u't1br1', u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.1.2/24', u'tenant_ns_ip': u'10.1.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't1_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM1if1'}, {u'mem': 4, u'name': u't1_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br1if2', u'vmif': u't1VM2if1'}], u'vxlan': [{u'local_ip': u'10.1.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.1.2', u'remote_route': u'10.2.1.0/24', u'subnet_route': u'10.1.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.2.1.2'}]}, {u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t1ns1\" ip addr show \"t1s1_dnsif\" | awk 'FNR==3{ print $2 }' | grep -w '^1.1.1.1/24' ; if [ $? -ne 0 ] ; then ip netns exec \"t1ns1\" ip addr add \"1.1.1.1/24\" dev \"t1s1_dnsif\" ; fi\n", "delta": "0:00:00.033503", "end": "2019-11-22 06:42:07.878741", "item": [{"bridge_name": "t1br1", "default_route_ip": "10.1.1.1", "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.1.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.1.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.1.1.2/24"}], "vms": [{"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM1", "vcpu": 4, "vmif": "t1VM1if1"}, {"brif": "t1br1if2", "disk": "10G", "mem": 4, "name": "t1_VM2", "vcpu": 2, "vmif": "t1VM2if1"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.1.2", "remote_ip": "10.2.1.2", "remote_route": "10.2.1.0/24", "subnet_route": "10.1.1.0/24", "tenant_route_ip": "192.168.1.2", "v_name": "vxlan_t1s1"}]}, {"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "rc": 0, "start": "2019-11-22 06:42:07.845238", "stderr": "", "stderr_lines": [], "stdout": "1.1.1.1/24", "stdout_lines": ["1.1.1.1/24"]}
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.2.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.2.1', u'bridge_name': u't1br2', u'ns_name': u't1ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.2.2/24', u'tenant_ns_ip': u'10.1.2.1/24', u'tenant_ns_if': u't1ns2if', u'tenant_sub_if': u't1s2if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'2.2.2.0/24', u'vms': [{u'mem': 3, u'name': u't1_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br2if1', u'vmif': u't1VM3if1'}], u'vxlan': [{u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}, {u'dnsif': u't1s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s2_dnsbrif'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t1ns2\" ip addr show \"t1s2_dnsif\" | awk 'FNR==3{ print $2 }' | grep -w '^2.2.2.1/24' ; if [ $? -ne 0 ] ; then ip netns exec \"t1ns2\" ip addr add \"2.2.2.1/24\" dev \"t1s2_dnsif\" ; fi\n", "delta": "0:00:00.032488", "end": "2019-11-22 06:42:08.102477", "item": [{"bridge_name": "t1br2", "default_route_ip": "10.1.2.1", "ns_name": "t1ns2", "route": [{"if": "p1", "ip": "10.1.2.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "2.2.2.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns2if", "tenant_ns_ip": "10.1.2.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s2if", "tenant_sub_ip": "10.1.2.2/24"}], "vms": [{"brif": "t1br2if1", "disk": "10G", "mem": 3, "name": "t1_VM3", "vcpu": 2, "vmif": "t1VM3if1"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, {"brif": "t1s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t1s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "rc": 0, "start": "2019-11-22 06:42:08.069989", "stderr": "", "stderr_lines": [], "stdout": "2.2.2.1/24", "stdout_lines": ["2.2.2.1/24"]}

TASK [Install DHCP Server] **********************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.1.1', u'bridge_name': u't1br1', u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.1.2/24', u'tenant_ns_ip': u'10.1.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't1_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM1if1'}, {u'mem': 4, u'name': u't1_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br1if2', u'vmif': u't1VM2if1'}], u'vxlan': [{u'local_ip': u'10.1.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.1.2', u'remote_route': u'10.2.1.0/24', u'subnet_route': u'10.1.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.2.1.2'}]}, {u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t1ns1\" ps aux | grep -w '[d]nsmasq --interface t1s1_dnsif -z --dhcp-range=1.1.1.5,1.1.1.126' ; if [ $? -ne 0 ] ; then ip netns exec \"t1ns1\" dnsmasq --interface \"t1s1_dnsif\" -z --dhcp-range=1.1.1.5,'1.1.1.126' ; fi\n", "delta": "0:00:00.048724", "end": "2019-11-22 06:42:08.402197", "item": [{"bridge_name": "t1br1", "default_route_ip": "10.1.1.1", "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.1.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.1.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.1.1.2/24"}], "vms": [{"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM1", "vcpu": 4, "vmif": "t1VM1if1"}, {"brif": "t1br1if2", "disk": "10G", "mem": 4, "name": "t1_VM2", "vcpu": 2, "vmif": "t1VM2if1"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.1.2", "remote_ip": "10.2.1.2", "remote_route": "10.2.1.0/24", "subnet_route": "10.1.1.0/24", "tenant_route_ip": "192.168.1.2", "v_name": "vxlan_t1s1"}]}, {"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "rc": 0, "start": "2019-11-22 06:42:08.353473", "stderr": "", "stderr_lines": [], "stdout": "nobody    4202  0.0  0.0  51580   384 ?        S    06:37   0:00 dnsmasq --interface t1s1_dnsif -z --dhcp-range=1.1.1.5,1.1.1.126", "stdout_lines": ["nobody    4202  0.0  0.0  51580   384 ?        S    06:37   0:00 dnsmasq --interface t1s1_dnsif -z --dhcp-range=1.1.1.5,1.1.1.126"]}
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.2.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.2.1', u'bridge_name': u't1br2', u'ns_name': u't1ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.2.2/24', u'tenant_ns_ip': u'10.1.2.1/24', u'tenant_ns_if': u't1ns2if', u'tenant_sub_if': u't1s2if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'2.2.2.0/24', u'vms': [{u'mem': 3, u'name': u't1_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br2if1', u'vmif': u't1VM3if1'}], u'vxlan': [{u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}, {u'dnsif': u't1s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s2_dnsbrif'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t1ns2\" ps aux | grep -w '[d]nsmasq --interface t1s2_dnsif -z --dhcp-range=2.2.2.5,2.2.2.254' ; if [ $? -ne 0 ] ; then ip netns exec \"t1ns2\" dnsmasq --interface \"t1s2_dnsif\" -z --dhcp-range=2.2.2.5,'2.2.2.254' ; fi\n", "delta": "0:00:00.051461", "end": "2019-11-22 06:42:08.642269", "item": [{"bridge_name": "t1br2", "default_route_ip": "10.1.2.1", "ns_name": "t1ns2", "route": [{"if": "p1", "ip": "10.1.2.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "2.2.2.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns2if", "tenant_ns_ip": "10.1.2.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s2if", "tenant_sub_ip": "10.1.2.2/24"}], "vms": [{"brif": "t1br2if1", "disk": "10G", "mem": 3, "name": "t1_VM3", "vcpu": 2, "vmif": "t1VM3if1"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, {"brif": "t1s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t1s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "rc": 0, "start": "2019-11-22 06:42:08.590808", "stderr": "", "stderr_lines": [], "stdout": "nobody    4232  0.0  0.0  51580   384 ?        S    06:37   0:00 dnsmasq --interface t1s2_dnsif -z --dhcp-range=2.2.2.5,2.2.2.254", "stdout_lines": ["nobody    4232  0.0  0.0  51580   384 ?        S    06:37   0:00 dnsmasq --interface t1s2_dnsif -z --dhcp-range=2.2.2.5,2.2.2.254"]}

TASK [Create VXLAN devices] *********************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.1.2/24', u'tenant_ns_ip': u'10.1.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't1_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM1if1'}, {u'mem': 4, u'name': u't1_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br1if2', u'vmif': u't1VM2if1'}]}, {u'local_ip': u'10.1.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.1.2', u'remote_route': u'10.2.1.0/24', u'subnet_route': u'10.1.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.2.1.2'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t1ns1\" ip link show \"vxlan_t1s1\" ; if [ $? -ne 0 ] ; then ip netns exec \"t1ns1\" ip link add \"vxlan_t1s1\" type vxlan id \"42\" local \"10.1.1.2\" remote \"10.2.1.2\" dstport \"4789\" dev \"t1s1if\"; ip netns exec \"t1ns1\" ip link set dev \"vxlan_t1s1\" up ; fi\n", "delta": "0:00:00.034923", "end": "2019-11-22 06:42:08.950402", "item": [{"bridge_name": "t1br1", "default_route_ip": "10.1.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.1.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.1.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.1.1.2/24"}], "vms": [{"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM1", "vcpu": 4, "vmif": "t1VM1if1"}, {"brif": "t1br1if2", "disk": "10G", "mem": 4, "name": "t1_VM2", "vcpu": 2, "vmif": "t1VM2if1"}]}, {"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.1.2", "remote_ip": "10.2.1.2", "remote_route": "10.2.1.0/24", "subnet_route": "10.1.1.0/24", "tenant_route_ip": "192.168.1.2", "v_name": "vxlan_t1s1"}], "rc": 0, "start": "2019-11-22 06:42:08.915479", "stderr": "", "stderr_lines": [], "stdout": "5: vxlan_t1s1: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1450 qdisc noqueue master t1br1 state UNKNOWN mode DEFAULT group default qlen 1000\n    link/ether 46:79:e2:aa:ba:f9 brd ff:ff:ff:ff:ff:ff", "stdout_lines": ["5: vxlan_t1s1: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1450 qdisc noqueue master t1br1 state UNKNOWN mode DEFAULT group default qlen 1000", "    link/ether 46:79:e2:aa:ba:f9 brd ff:ff:ff:ff:ff:ff"]}
skipping: [localhost] => (item=[{u'route': [{u'ip': u'10.1.2.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.2.1', u'bridge_name': u't1br2', u'dns': [{u'dnsif': u't1s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s2_dnsbrif'}], u'ns_name': u't1ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.2.2/24', u'tenant_ns_ip': u'10.1.2.1/24', u'tenant_ns_if': u't1ns2if', u'tenant_sub_if': u't1s2if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'2.2.2.0/24', u'vms': [{u'mem': 3, u'name': u't1_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br2if1', u'vmif': u't1VM3if1'}]}, {u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}])  => {"ansible_loop_var": "item", "changed": false, "item": [{"bridge_name": "t1br2", "default_route_ip": "10.1.2.1", "dns": [{"brif": "t1s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t1s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns2", "route": [{"if": "p1", "ip": "10.1.2.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "2.2.2.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns2if", "tenant_ns_ip": "10.1.2.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s2if", "tenant_sub_ip": "10.1.2.2/24"}], "vms": [{"brif": "t1br2if1", "disk": "10G", "mem": 3, "name": "t1_VM3", "vcpu": 2, "vmif": "t1VM3if1"}]}, {"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}], "skip_reason": "Conditional result was False"}

TASK [Attach VXLANs to bridge] ******************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.1.2/24', u'tenant_ns_ip': u'10.1.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't1_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM1if1'}, {u'mem': 4, u'name': u't1_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br1if2', u'vmif': u't1VM2if1'}]}, {u'local_ip': u'10.1.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.1.2', u'remote_route': u'10.2.1.0/24', u'subnet_route': u'10.1.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.2.1.2'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t1ns1\" brctl show \"t1br1\" | grep -w 'vxlan_t1s1' ; if [ $? -ne 0 ] ; then ip netns exec \"t1ns1\" brctl addif \"t1br1\" \"vxlan_t1s1\" ; fi\n", "delta": "0:00:00.039132", "end": "2019-11-22 06:42:09.306379", "item": [{"bridge_name": "t1br1", "default_route_ip": "10.1.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.1.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.1.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.1.1.2/24"}], "vms": [{"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM1", "vcpu": 4, "vmif": "t1VM1if1"}, {"brif": "t1br1if2", "disk": "10G", "mem": 4, "name": "t1_VM2", "vcpu": 2, "vmif": "t1VM2if1"}]}, {"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.1.2", "remote_ip": "10.2.1.2", "remote_route": "10.2.1.0/24", "subnet_route": "10.1.1.0/24", "tenant_route_ip": "192.168.1.2", "v_name": "vxlan_t1s1"}], "rc": 0, "start": "2019-11-22 06:42:09.267247", "stderr": "", "stderr_lines": [], "stdout": "\t\t\t\t\t\t\tvxlan_t1s1", "stdout_lines": ["\t\t\t\t\t\t\tvxlan_t1s1"]}
skipping: [localhost] => (item=[{u'route': [{u'ip': u'10.1.2.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.2.1', u'bridge_name': u't1br2', u'dns': [{u'dnsif': u't1s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s2_dnsbrif'}], u'ns_name': u't1ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.2.2/24', u'tenant_ns_ip': u'10.1.2.1/24', u'tenant_ns_if': u't1ns2if', u'tenant_sub_if': u't1s2if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'2.2.2.0/24', u'vms': [{u'mem': 3, u'name': u't1_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br2if1', u'vmif': u't1VM3if1'}]}, {u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}])  => {"ansible_loop_var": "item", "changed": false, "item": [{"bridge_name": "t1br2", "default_route_ip": "10.1.2.1", "dns": [{"brif": "t1s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t1s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns2", "route": [{"if": "p1", "ip": "10.1.2.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "2.2.2.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns2if", "tenant_ns_ip": "10.1.2.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s2if", "tenant_sub_ip": "10.1.2.2/24"}], "vms": [{"brif": "t1br2if1", "disk": "10G", "mem": 3, "name": "t1_VM3", "vcpu": 2, "vmif": "t1VM3if1"}]}, {"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}], "skip_reason": "Conditional result was False"}

PLAY RECAP **************************************************************************************************************************************************
localhost                  : ok=21   changed=19   unreachable=0    failed=0    skipped=0    rescued=0    ignored=0   

Using /etc/ansible/ansible.cfg as config file

PLAY [worker] ***********************************************************************************************************************************************

TASK [Create Tenant Namespace] ******************************************************************************************************************************
ok: [99.99.99.2] => (item={u'default_route_ip': u'192.168.129.1', u'name': u't1', u'pns_ip': u'192.168.129.1/24', u'tenant_if': u't1if', u'tenant_ip': u'192.168.129.2/24', u'pns_if': u't1pns_if'}) => {"ansible_loop_var": "item", "changed": false, "cmd": ["ip", "netns", "add", "t1"], "item": {"default_route_ip": "192.168.129.1", "name": "t1", "pns_if": "t1pns_if", "pns_ip": "192.168.129.1/24", "tenant_if": "t1if", "tenant_ip": "192.168.129.2/24"}, "rc": 0, "stdout": "skipped, since /var/run/netns/t1 exists", "stdout_lines": ["skipped, since /var/run/netns/t1 exists"]}

TASK [Create Subnet Namespace] ******************************************************************************************************************************
ok: [99.99.99.2] => (item={u'route': [{u'ip': u'10.2.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.2.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.1.2/24', u'tenant_ns_ip': u'10.2.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_ns_name': u't1', u'tenant_sub_if': u't1s1if'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't1_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM4if1'}], u'vxlan': [{u'local_ip': u'10.2.1.2', u'tenant_route_ip': u'192.168.129.2', u'dsport': 4789, u'dev': u't1s1if', u'subnet_route': u'10.2.1.0/24', u'remote_route': u'10.1.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.1.1.2'}]}) => {"ansible_loop_var": "item", "changed": false, "cmd": ["ip", "netns", "add", "t1ns1"], "item": {"bridge_name": "t1br1", "default_route_ip": "10.2.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.2.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.2.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.2.1.2/24"}], "vms": [{"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM4", "vcpu": 4, "vmif": "t1VM4if1"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.1.2", "remote_ip": "10.1.1.2", "remote_route": "10.1.1.0/24", "subnet_route": "10.2.1.0/24", "tenant_route_ip": "192.168.129.2", "v_name": "vxlan_t1s1"}]}, "rc": 0, "stdout": "skipped, since /var/run/netns/t1ns1 exists", "stdout_lines": ["skipped, since /var/run/netns/t1ns1 exists"]}

TASK [Create Tenant VETH pairs] *****************************************************************************************************************************
changed: [99.99.99.2] => (item={u'default_route_ip': u'192.168.129.1', u'name': u't1', u'pns_ip': u'192.168.129.1/24', u'tenant_if': u't1if', u'tenant_ip': u'192.168.129.2/24', u'pns_if': u't1pns_if'}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip link show \"t1if\" ; if [ $? -ne 0 ] ; then ip link add \"t1if\" type veth peer name \"t1pns_if\" ; fi\n", "delta": "0:00:00.004409", "end": "2019-11-22 06:42:11.952524", "item": {"default_route_ip": "192.168.129.1", "name": "t1", "pns_if": "t1pns_if", "pns_ip": "192.168.129.1/24", "tenant_if": "t1if", "tenant_ip": "192.168.129.2/24"}, "rc": 0, "start": "2019-11-22 06:42:11.948115", "stderr": "", "stderr_lines": [], "stdout": "21: t1if@t1pns_if: <BROADCAST,MULTICAST> mtu 1500 qdisc noop state DOWN mode DEFAULT group default qlen 1000\n    link/ether d2:c2:82:92:3e:7a brd ff:ff:ff:ff:ff:ff", "stdout_lines": ["21: t1if@t1pns_if: <BROADCAST,MULTICAST> mtu 1500 qdisc noop state DOWN mode DEFAULT group default qlen 1000", "    link/ether d2:c2:82:92:3e:7a brd ff:ff:ff:ff:ff:ff"]}

TASK [Attach Tenant VETH Pairs] *****************************************************************************************************************************
changed: [99.99.99.2] => (item={u'default_route_ip': u'192.168.129.1', u'name': u't1', u'pns_ip': u'192.168.129.1/24', u'tenant_if': u't1if', u'tenant_ip': u'192.168.129.2/24', u'pns_if': u't1pns_if'}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec pns ip link show \"t1pns_if\" ; if [ $? -ne 0 ] ; then ip link set \"t1pns_if\" netns pns ; fi\nip netns exec \"t1\" ip link show \"t1if\" ; if [ $? -ne 0 ] ; then ip link set \"t1if\" netns \"t1\" ; fi\nip netns exec pns ip link set dev \"t1pns_if\" up\nip netns exec \"t1\" ip link set dev \"t1if\" up\n", "delta": "0:00:00.141959", "end": "2019-11-22 06:42:12.480034", "item": {"default_route_ip": "192.168.129.1", "name": "t1", "pns_if": "t1pns_if", "pns_ip": "192.168.129.1/24", "tenant_if": "t1if", "tenant_ip": "192.168.129.2/24"}, "rc": 0, "start": "2019-11-22 06:42:12.338075", "stderr": "", "stderr_lines": [], "stdout": "14: t1pns_if@if15: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP mode DEFAULT group default qlen 1000\n    link/ether 16:c6:4d:5b:05:70 brd ff:ff:ff:ff:ff:ff link-netnsid 1\n15: t1if@if14: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP mode DEFAULT group default qlen 1000\n    link/ether 7a:ae:34:75:04:0b brd ff:ff:ff:ff:ff:ff link-netnsid 0", "stdout_lines": ["14: t1pns_if@if15: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP mode DEFAULT group default qlen 1000", "    link/ether 16:c6:4d:5b:05:70 brd ff:ff:ff:ff:ff:ff link-netnsid 1", "15: t1if@if14: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP mode DEFAULT group default qlen 1000", "    link/ether 7a:ae:34:75:04:0b brd ff:ff:ff:ff:ff:ff link-netnsid 0"]}

TASK [Add IP addresses to Tenant VETH Pairs] ****************************************************************************************************************
changed: [99.99.99.2] => (item={u'default_route_ip': u'192.168.129.1', u'name': u't1', u'pns_ip': u'192.168.129.1/24', u'tenant_if': u't1if', u'tenant_ip': u'192.168.129.2/24', u'pns_if': u't1pns_if'}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec pns ip addr show \"t1pns_if\" | awk 'FNR==3{ print $2 }' | grep -w '^192.168.129.1/24' ; if [ $? -ne 0 ] ; then ip netns exec pns ip addr add \"192.168.129.1/24\" dev \"t1pns_if\" ; fi\nip netns exec \"t1\" ip addr show \"t1if\" | awk 'FNR==3{ print $2 }' | grep -w '^192.168.129.2/24' ; if [ $? -ne 0 ] ; then ip netns exec \"t1\" ip addr add \"192.168.129.2/24\" dev \"t1if\" ; fi\n", "delta": "0:00:00.082818", "end": "2019-11-22 06:42:12.964232", "item": {"default_route_ip": "192.168.129.1", "name": "t1", "pns_if": "t1pns_if", "pns_ip": "192.168.129.1/24", "tenant_if": "t1if", "tenant_ip": "192.168.129.2/24"}, "rc": 0, "start": "2019-11-22 06:42:12.881414", "stderr": "", "stderr_lines": [], "stdout": "192.168.129.1/24\n192.168.129.2/24", "stdout_lines": ["192.168.129.1/24", "192.168.129.2/24"]}

TASK [Create Namespace VETH Pairs] **************************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.2.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't1_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM4if1'}], u'vxlan': [{u'local_ip': u'10.2.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.129.2', u'remote_route': u'10.1.1.0/24', u'subnet_route': u'10.2.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.1.1.2'}]}, {u'tenant_sub_ip': u'10.2.1.2/24', u'tenant_ns_ip': u'10.2.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip link show \"t1ns1if\" ; if [ $? -ne 0 ] ; then ip link add \"t1ns1if\" type veth peer name \"t1s1if\" ; fi\n", "delta": "0:00:00.003854", "end": "2019-11-22 06:42:13.351593", "item": [{"bridge_name": "t1br1", "default_route_ip": "10.2.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.2.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "vms": [{"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM4", "vcpu": 4, "vmif": "t1VM4if1"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.1.2", "remote_ip": "10.1.1.2", "remote_route": "10.1.1.0/24", "subnet_route": "10.2.1.0/24", "tenant_route_ip": "192.168.129.2", "v_name": "vxlan_t1s1"}]}, {"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.2.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.2.1.2/24"}], "rc": 0, "start": "2019-11-22 06:42:13.347739", "stderr": "", "stderr_lines": [], "stdout": "23: t1ns1if@t1s1if: <BROADCAST,MULTICAST> mtu 1500 qdisc noop state DOWN mode DEFAULT group default qlen 1000\n    link/ether de:69:54:59:68:26 brd ff:ff:ff:ff:ff:ff", "stdout_lines": ["23: t1ns1if@t1s1if: <BROADCAST,MULTICAST> mtu 1500 qdisc noop state DOWN mode DEFAULT group default qlen 1000", "    link/ether de:69:54:59:68:26 brd ff:ff:ff:ff:ff:ff"]}

TASK [Attach Namespace VETH Pairs] **************************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.2.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't1_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM4if1'}], u'vxlan': [{u'local_ip': u'10.2.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.129.2', u'remote_route': u'10.1.1.0/24', u'subnet_route': u'10.2.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.1.1.2'}]}, {u'tenant_sub_ip': u'10.2.1.2/24', u'tenant_ns_ip': u'10.2.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t1\" ip link show \"t1ns1if\" ; if [ $? -ne 0 ] ; then ip link set \"t1ns1if\" netns \"t1\" ; fi\nip netns exec \"t1ns1\" ip link show \"t1s1if\" ; if [ $? -ne 0 ] ; then ip link set \"t1s1if\" netns \"t1ns1\" ; fi\n", "delta": "0:00:00.077906", "end": "2019-11-22 06:42:13.819939", "item": [{"bridge_name": "t1br1", "default_route_ip": "10.2.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.2.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "vms": [{"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM4", "vcpu": 4, "vmif": "t1VM4if1"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.1.2", "remote_ip": "10.1.1.2", "remote_route": "10.1.1.0/24", "subnet_route": "10.2.1.0/24", "tenant_route_ip": "192.168.129.2", "v_name": "vxlan_t1s1"}]}, {"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.2.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.2.1.2/24"}], "rc": 0, "start": "2019-11-22 06:42:13.742033", "stderr": "", "stderr_lines": [], "stdout": "17: t1ns1if@if16: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP mode DEFAULT group default qlen 1000\n    link/ether 86:3e:e9:9f:62:e0 brd ff:ff:ff:ff:ff:ff link-netnsid 2\n16: t1s1if@if17: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP mode DEFAULT group default qlen 1000\n    link/ether f2:0b:c2:ed:23:c1 brd ff:ff:ff:ff:ff:ff link-netnsid 0", "stdout_lines": ["17: t1ns1if@if16: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP mode DEFAULT group default qlen 1000", "    link/ether 86:3e:e9:9f:62:e0 brd ff:ff:ff:ff:ff:ff link-netnsid 2", "16: t1s1if@if17: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP mode DEFAULT group default qlen 1000", "    link/ether f2:0b:c2:ed:23:c1 brd ff:ff:ff:ff:ff:ff link-netnsid 0"]}

TASK [Set Namespace VETH Pairs UP] **************************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.2.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't1_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM4if1'}], u'vxlan': [{u'local_ip': u'10.2.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.129.2', u'remote_route': u'10.1.1.0/24', u'subnet_route': u'10.2.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.1.1.2'}]}, {u'tenant_sub_ip': u'10.2.1.2/24', u'tenant_ns_ip': u'10.2.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t1\" ip link set dev \"t1ns1if\" up\nip netns exec \"t1ns1\" ip link set dev \"t1s1if\" up\n", "delta": "0:00:00.096578", "end": "2019-11-22 06:42:14.287961", "item": [{"bridge_name": "t1br1", "default_route_ip": "10.2.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.2.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "vms": [{"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM4", "vcpu": 4, "vmif": "t1VM4if1"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.1.2", "remote_ip": "10.1.1.2", "remote_route": "10.1.1.0/24", "subnet_route": "10.2.1.0/24", "tenant_route_ip": "192.168.129.2", "v_name": "vxlan_t1s1"}]}, {"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.2.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.2.1.2/24"}], "rc": 0, "start": "2019-11-22 06:42:14.191383", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Add IP addresses to Namespace VETH Pairs] *************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.2.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't1_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM4if1'}], u'vxlan': [{u'local_ip': u'10.2.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.129.2', u'remote_route': u'10.1.1.0/24', u'subnet_route': u'10.2.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.1.1.2'}]}, {u'tenant_sub_ip': u'10.2.1.2/24', u'tenant_ns_ip': u'10.2.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t1ns1\" ip addr show \"t1s1if\" | awk 'FNR==3{ print $2 }' | grep -w '^10.2.1.2/24' ; if [ $? -ne 0 ] ; then ip netns exec \"t1ns1\" ip addr add \"10.2.1.2/24\" dev \"t1s1if\" ; fi\n\nip netns exec \"t1\" ip addr show \"t1ns1if\" | awk 'FNR==3{ print $2 }' | grep -w '^10.2.1.1/24' ; if [ $? -ne 0 ] ; then ip netns exec \"t1\" ip addr add \"10.2.1.1/24\" dev \"t1ns1if\" ; fi\n", "delta": "0:00:00.066627", "end": "2019-11-22 06:42:14.732117", "item": [{"bridge_name": "t1br1", "default_route_ip": "10.2.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.2.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "vms": [{"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM4", "vcpu": 4, "vmif": "t1VM4if1"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.1.2", "remote_ip": "10.1.1.2", "remote_route": "10.1.1.0/24", "subnet_route": "10.2.1.0/24", "tenant_route_ip": "192.168.129.2", "v_name": "vxlan_t1s1"}]}, {"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.2.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.2.1.2/24"}], "rc": 0, "start": "2019-11-22 06:42:14.665490", "stderr": "", "stderr_lines": [], "stdout": "10.2.1.2/24\n10.2.1.1/24", "stdout_lines": ["10.2.1.2/24", "10.2.1.1/24"]}

TASK [Add IP Route to Tenant] *******************************************************************************************************************************
changed: [99.99.99.2] => (item={u'default_route_ip': u'192.168.129.1', u'name': u't1', u'pns_ip': u'192.168.129.1/24', u'tenant_if': u't1if', u'tenant_ip': u'192.168.129.2/24', u'pns_if': u't1pns_if'}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t1\" ip route show default | grep -w '[d]efault via 192.168.129.1' ; if [ $? -ne 0 ] ; then ip netns exec \"t1\" ip route add default via \"192.168.129.1\" ; fi\n", "delta": "0:00:00.035998", "end": "2019-11-22 06:42:15.135985", "item": {"default_route_ip": "192.168.129.1", "name": "t1", "pns_if": "t1pns_if", "pns_ip": "192.168.129.1/24", "tenant_if": "t1if", "tenant_ip": "192.168.129.2/24"}, "rc": 0, "start": "2019-11-22 06:42:15.099987", "stderr": "", "stderr_lines": [], "stdout": "default via 192.168.129.1 dev t1if ", "stdout_lines": ["default via 192.168.129.1 dev t1if "]}

TASK [Add IP Route to Tenant Subnet] ************************************************************************************************************************
changed: [99.99.99.2] => (item={u'route': [{u'ip': u'10.2.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.2.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.1.2/24', u'tenant_ns_ip': u'10.2.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_ns_name': u't1', u'tenant_sub_if': u't1s1if'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't1_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM4if1'}], u'vxlan': [{u'local_ip': u'10.2.1.2', u'tenant_route_ip': u'192.168.129.2', u'dsport': 4789, u'dev': u't1s1if', u'subnet_route': u'10.2.1.0/24', u'remote_route': u'10.1.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.1.1.2'}]}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t1ns1\" ip route show default | grep -w '[d]efault via 10.2.1.1' ; if [ $? -ne 0 ] ; then ip netns exec \"t1ns1\" ip route add default via \"10.2.1.1\" ; fi\n", "delta": "0:00:00.043262", "end": "2019-11-22 06:42:15.559895", "item": {"bridge_name": "t1br1", "default_route_ip": "10.2.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.2.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.2.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.2.1.2/24"}], "vms": [{"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM4", "vcpu": 4, "vmif": "t1VM4if1"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.1.2", "remote_ip": "10.1.1.2", "remote_route": "10.1.1.0/24", "subnet_route": "10.2.1.0/24", "tenant_route_ip": "192.168.129.2", "v_name": "vxlan_t1s1"}]}, "rc": 0, "start": "2019-11-22 06:42:15.516633", "stderr": "", "stderr_lines": [], "stdout": "default via 10.2.1.1 dev t1s1if ", "stdout_lines": ["default via 10.2.1.1 dev t1s1if "]}

TASK [Create bridge inside namespace] ***********************************************************************************************************************
changed: [99.99.99.2] => (item={u'route': [{u'ip': u'10.2.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.2.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.1.2/24', u'tenant_ns_ip': u'10.2.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_ns_name': u't1', u'tenant_sub_if': u't1s1if'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't1_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM4if1'}], u'vxlan': [{u'local_ip': u'10.2.1.2', u'tenant_route_ip': u'192.168.129.2', u'dsport': 4789, u'dev': u't1s1if', u'subnet_route': u'10.2.1.0/24', u'remote_route': u'10.1.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.1.1.2'}]}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t1ns1\" brctl show | grep -w '^t1br1'; if [ $? -ne 0 ] ; then ip netns exec \"t1ns1\" brctl addbr \"t1br1\" ; fi\nip netns exec \"t1ns1\" ip link set dev \"t1br1\" up\n", "delta": "0:00:00.072794", "end": "2019-11-22 06:42:16.028074", "item": {"bridge_name": "t1br1", "default_route_ip": "10.2.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.2.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.2.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.2.1.2/24"}], "vms": [{"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM4", "vcpu": 4, "vmif": "t1VM4if1"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.1.2", "remote_ip": "10.1.1.2", "remote_route": "10.1.1.0/24", "subnet_route": "10.2.1.0/24", "tenant_route_ip": "192.168.129.2", "v_name": "vxlan_t1s1"}]}, "rc": 0, "start": "2019-11-22 06:42:15.955280", "stderr": "", "stderr_lines": [], "stdout": "t1br1\t\t8000.2e54d50069fa\tno\t\tt1br1if1", "stdout_lines": ["t1br1\t\t8000.2e54d50069fa\tno\t\tt1br1if1"]}

TASK [Create DNS VETH Pair] *********************************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.2.1.1', u'bridge_name': u't1br1', u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.1.2/24', u'tenant_ns_ip': u'10.2.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't1_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM4if1'}], u'vxlan': [{u'local_ip': u'10.2.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.129.2', u'remote_route': u'10.1.1.0/24', u'subnet_route': u'10.2.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.1.1.2'}]}, {u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t1ns1\" ip link show \"t1s1_dnsbrif\" ; if [ $? -ne 0 ] ; then ip netns exec \"t1ns1\" ip link add \"t1s1_dnsbrif\" type veth peer name \"t1s1_dnsif\" ; fi\nip netns exec \"t1ns1\" ip link set dev \"t1s1_dnsbrif\" up\nip netns exec \"t1ns1\" ip link set dev \"t1s1_dnsif\" up\n", "delta": "0:00:00.117731", "end": "2019-11-22 06:42:16.551990", "item": [{"bridge_name": "t1br1", "default_route_ip": "10.2.1.1", "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.2.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.2.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.2.1.2/24"}], "vms": [{"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM4", "vcpu": 4, "vmif": "t1VM4if1"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.1.2", "remote_ip": "10.1.1.2", "remote_route": "10.1.1.0/24", "subnet_route": "10.2.1.0/24", "tenant_route_ip": "192.168.129.2", "v_name": "vxlan_t1s1"}]}, {"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "rc": 0, "start": "2019-11-22 06:42:16.434259", "stderr": "", "stderr_lines": [], "stdout": "4: t1s1_dnsbrif@t1s1_dnsif: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue master t1br1 state UP mode DEFAULT group default qlen 1000\n    link/ether da:e7:a3:29:98:06 brd ff:ff:ff:ff:ff:ff", "stdout_lines": ["4: t1s1_dnsbrif@t1s1_dnsif: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue master t1br1 state UP mode DEFAULT group default qlen 1000", "    link/ether da:e7:a3:29:98:06 brd ff:ff:ff:ff:ff:ff"]}

TASK [Attach DNS VETH Pair] *********************************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.2.1.1', u'bridge_name': u't1br1', u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.1.2/24', u'tenant_ns_ip': u'10.2.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't1_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM4if1'}], u'vxlan': [{u'local_ip': u'10.2.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.129.2', u'remote_route': u'10.1.1.0/24', u'subnet_route': u'10.2.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.1.1.2'}]}, {u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t1ns1\" brctl show \"t1br1\" | grep -w 't1s1_dnsbrif' ; if [ $? -ne 0 ] ; then ip netns exec \"t1ns1\" brctl addif \"t1br1\" \"t1s1_dnsbrif\" ; fi\n", "delta": "0:00:00.044404", "end": "2019-11-22 06:42:16.980120", "item": [{"bridge_name": "t1br1", "default_route_ip": "10.2.1.1", "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.2.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.2.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.2.1.2/24"}], "vms": [{"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM4", "vcpu": 4, "vmif": "t1VM4if1"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.1.2", "remote_ip": "10.1.1.2", "remote_route": "10.1.1.0/24", "subnet_route": "10.2.1.0/24", "tenant_route_ip": "192.168.129.2", "v_name": "vxlan_t1s1"}]}, {"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "rc": 0, "start": "2019-11-22 06:42:16.935716", "stderr": "", "stderr_lines": [], "stdout": "\t\t\t\t\t\t\tt1s1_dnsbrif", "stdout_lines": ["\t\t\t\t\t\t\tt1s1_dnsbrif"]}

TASK [Create VETH Pairs] ************************************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.2.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.1.2/24', u'tenant_ns_ip': u'10.2.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.2.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.129.2', u'remote_route': u'10.1.1.0/24', u'subnet_route': u'10.2.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.1.1.2'}]}, {u'mem': 2, u'name': u't1_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM4if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip link show \"t1br1if1\" ; if [ $? -ne 0 ] ; then ip link add \"t1VM4if1\" type veth peer name \"t1br1if1\" ; fi\nip link set dev \"t1br1if1\" up\nip link set dev \"t1VM4if1\" up\n", "delta": "0:00:00.015704", "end": "2019-11-22 06:42:17.374893", "item": [{"bridge_name": "t1br1", "default_route_ip": "10.2.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.2.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.2.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.2.1.2/24"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.1.2", "remote_ip": "10.1.1.2", "remote_route": "10.1.1.0/24", "subnet_route": "10.2.1.0/24", "tenant_route_ip": "192.168.129.2", "v_name": "vxlan_t1s1"}]}, {"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM4", "vcpu": 4, "vmif": "t1VM4if1"}], "rc": 0, "start": "2019-11-22 06:42:17.359189", "stderr": "Device \"t1br1if1\" does not exist.\nRTNETLINK answers: File exists\nCannot find device \"t1br1if1\"", "stderr_lines": ["Device \"t1br1if1\" does not exist.", "RTNETLINK answers: File exists", "Cannot find device \"t1br1if1\""], "stdout": "", "stdout_lines": []}

TASK [Attach VETH Pairs] ************************************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.2.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.1.2/24', u'tenant_ns_ip': u'10.2.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.2.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.129.2', u'remote_route': u'10.1.1.0/24', u'subnet_route': u'10.2.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.1.1.2'}]}, {u'mem': 2, u'name': u't1_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM4if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip link show \"t1br1if1\" ; if [ $? -eq 0 ] ; then ip link set \"t1br1if1\" netns \"t1ns1\" ; fi\nip netns exec \"t1ns1\" brctl show \"t1br1\" | grep -w 't1br1if1' ; if [ $? -ne 0 ] ; then ip netns exec \"t1ns1\" brctl addif \"t1br1\" \"t1br1if1\" ; fi\n", "delta": "0:00:00.036124", "end": "2019-11-22 06:42:17.803994", "item": [{"bridge_name": "t1br1", "default_route_ip": "10.2.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.2.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.2.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.2.1.2/24"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.1.2", "remote_ip": "10.1.1.2", "remote_route": "10.1.1.0/24", "subnet_route": "10.2.1.0/24", "tenant_route_ip": "192.168.129.2", "v_name": "vxlan_t1s1"}]}, {"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM4", "vcpu": 4, "vmif": "t1VM4if1"}], "rc": 0, "start": "2019-11-22 06:42:17.767870", "stderr": "Device \"t1br1if1\" does not exist.", "stderr_lines": ["Device \"t1br1if1\" does not exist."], "stdout": "t1br1\t\t8000.2e54d50069fa\tno\t\tt1br1if1", "stdout_lines": ["t1br1\t\t8000.2e54d50069fa\tno\t\tt1br1if1"]}

TASK [All interfaces and bridges UP] ************************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.2.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.1.2/24', u'tenant_ns_ip': u'10.2.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.2.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.129.2', u'remote_route': u'10.1.1.0/24', u'subnet_route': u'10.2.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.1.1.2'}]}, {u'mem': 2, u'name': u't1_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM4if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t1ns1\" ip link set \"t1br1if1\" up\nip netns exec \"t1ns1\" ip link set dev \"t1br1\" up\n", "delta": "0:00:00.071073", "end": "2019-11-22 06:42:18.251966", "item": [{"bridge_name": "t1br1", "default_route_ip": "10.2.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.2.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.2.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.2.1.2/24"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.1.2", "remote_ip": "10.1.1.2", "remote_route": "10.1.1.0/24", "subnet_route": "10.2.1.0/24", "tenant_route_ip": "192.168.129.2", "v_name": "vxlan_t1s1"}]}, {"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM4", "vcpu": 4, "vmif": "t1VM4if1"}], "rc": 0, "start": "2019-11-22 06:42:18.180893", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Add IP to DNS Interface] ******************************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.2.1.1', u'bridge_name': u't1br1', u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.1.2/24', u'tenant_ns_ip': u'10.2.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't1_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM4if1'}], u'vxlan': [{u'local_ip': u'10.2.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.129.2', u'remote_route': u'10.1.1.0/24', u'subnet_route': u'10.2.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.1.1.2'}]}, {u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t1ns1\" ip addr show \"t1s1_dnsif\" | awk 'FNR==3{ print $2}'| grep -w '^1.1.1.128/24' ; if [ $? -ne 0 ] ; then ip netns exec \"t1ns1\" ip addr add \"1.1.1.128/24\" dev \"t1s1_dnsif\" ; fi\n", "delta": "0:00:00.036437", "end": "2019-11-22 06:42:18.672160", "item": [{"bridge_name": "t1br1", "default_route_ip": "10.2.1.1", "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.2.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.2.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.2.1.2/24"}], "vms": [{"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM4", "vcpu": 4, "vmif": "t1VM4if1"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.1.2", "remote_ip": "10.1.1.2", "remote_route": "10.1.1.0/24", "subnet_route": "10.2.1.0/24", "tenant_route_ip": "192.168.129.2", "v_name": "vxlan_t1s1"}]}, {"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "rc": 0, "start": "2019-11-22 06:42:18.635723", "stderr": "", "stderr_lines": [], "stdout": "1.1.1.128/24", "stdout_lines": ["1.1.1.128/24"]}

TASK [Install DHCP Server] **********************************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.2.1.1', u'bridge_name': u't1br1', u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.1.2/24', u'tenant_ns_ip': u'10.2.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't1_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM4if1'}], u'vxlan': [{u'local_ip': u'10.2.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.129.2', u'remote_route': u'10.1.1.0/24', u'subnet_route': u'10.2.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.1.1.2'}]}, {u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t1ns1\" ps aux | grep -w '[d]nsmasq --interface t1s1_dnsif -z --dhcp-range=1.1.1.133,1.1.1.254' ; if [ $? -ne 0 ] ; then ip netns exec \"t1ns1\" dnsmasq --interface \"t1s1_dnsif\" -z --dhcp-range=1.1.1.133,'1.1.1.254' ; fi\n", "delta": "0:00:00.050832", "end": "2019-11-22 06:42:19.111869", "item": [{"bridge_name": "t1br1", "default_route_ip": "10.2.1.1", "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.2.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.2.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.2.1.2/24"}], "vms": [{"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM4", "vcpu": 4, "vmif": "t1VM4if1"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.1.2", "remote_ip": "10.1.1.2", "remote_route": "10.1.1.0/24", "subnet_route": "10.2.1.0/24", "tenant_route_ip": "192.168.129.2", "v_name": "vxlan_t1s1"}]}, {"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "rc": 0, "start": "2019-11-22 06:42:19.061037", "stderr": "", "stderr_lines": [], "stdout": "nobody    3348  0.0  0.0  51580   384 ?        S    06:37   0:00 dnsmasq --interface t1s1_dnsif -z --dhcp-range=1.1.1.133,1.1.1.254", "stdout_lines": ["nobody    3348  0.0  0.0  51580   384 ?        S    06:37   0:00 dnsmasq --interface t1s1_dnsif -z --dhcp-range=1.1.1.133,1.1.1.254"]}

TASK [Create VXLAN devices] *********************************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.2.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.1.2/24', u'tenant_ns_ip': u'10.2.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't1_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM4if1'}]}, {u'local_ip': u'10.2.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.129.2', u'remote_route': u'10.1.1.0/24', u'subnet_route': u'10.2.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.1.1.2'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t1ns1\" ip link show \"vxlan_t1s1\" ; if [ $? -ne 0 ] ; then ip netns exec \"t1ns1\" ip link add \"vxlan_t1s1\" type vxlan id \"42\" local \"10.2.1.2\" remote \"10.1.1.2\" dstport \"4789\" dev \"t1s1if\" ; ip netns exec \"t1ns1\" ip link set dev \"vxlan_t1s1\" up ; fi\n", "delta": "0:00:00.044677", "end": "2019-11-22 06:42:19.552035", "item": [{"bridge_name": "t1br1", "default_route_ip": "10.2.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.2.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.2.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.2.1.2/24"}], "vms": [{"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM4", "vcpu": 4, "vmif": "t1VM4if1"}]}, {"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.1.2", "remote_ip": "10.1.1.2", "remote_route": "10.1.1.0/24", "subnet_route": "10.2.1.0/24", "tenant_route_ip": "192.168.129.2", "v_name": "vxlan_t1s1"}], "rc": 0, "start": "2019-11-22 06:42:19.507358", "stderr": "", "stderr_lines": [], "stdout": "5: vxlan_t1s1: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1450 qdisc noqueue master t1br1 state UNKNOWN mode DEFAULT group default qlen 1000\n    link/ether c6:b5:67:f5:8d:0c brd ff:ff:ff:ff:ff:ff", "stdout_lines": ["5: vxlan_t1s1: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1450 qdisc noqueue master t1br1 state UNKNOWN mode DEFAULT group default qlen 1000", "    link/ether c6:b5:67:f5:8d:0c brd ff:ff:ff:ff:ff:ff"]}

TASK [Attach VXLANs to bridge] ******************************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.2.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.1.2/24', u'tenant_ns_ip': u'10.2.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't1_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM4if1'}]}, {u'local_ip': u'10.2.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.129.2', u'remote_route': u'10.1.1.0/24', u'subnet_route': u'10.2.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.1.1.2'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t1ns1\" brctl show \"t1br1\" | grep -w 'vxlan_t1s1' ; if [ $? -ne 0 ] ; then ip netns exec \"t1ns1\" brctl addif \"t1br1\" \"vxlan_t1s1\" ; fi\n", "delta": "0:00:00.035235", "end": "2019-11-22 06:42:20.000001", "item": [{"bridge_name": "t1br1", "default_route_ip": "10.2.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.2.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.2.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.2.1.2/24"}], "vms": [{"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM4", "vcpu": 4, "vmif": "t1VM4if1"}]}, {"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.1.2", "remote_ip": "10.1.1.2", "remote_route": "10.1.1.0/24", "subnet_route": "10.2.1.0/24", "tenant_route_ip": "192.168.129.2", "v_name": "vxlan_t1s1"}], "rc": 0, "start": "2019-11-22 06:42:19.964766", "stderr": "", "stderr_lines": [], "stdout": "\t\t\t\t\t\t\tvxlan_t1s1", "stdout_lines": ["\t\t\t\t\t\t\tvxlan_t1s1"]}

PLAY RECAP **************************************************************************************************************************************************
99.99.99.2                 : ok=21   changed=19   unreachable=0    failed=0    skipped=0    rescued=0    ignored=0   

Using /etc/ansible/ansible.cfg as config file

PLAY [main] *************************************************************************************************************************************************

TASK [Add VXLAN routes in PNS] ******************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.1.2/24', u'tenant_ns_ip': u'10.1.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't1_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM1if1'}, {u'mem': 4, u'name': u't1_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br1if2', u'vmif': u't1VM2if1'}]}, {u'local_ip': u'10.1.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.1.2', u'remote_route': u'10.2.1.0/24', u'subnet_route': u'10.1.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.2.1.2'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec pns ip route show \"10.1.1.0/24\" via \"192.168.1.2\" | grep -w '^10.1.1.0/24' ; if [ $? -ne 0 ] ; then ip netns exec pns ip route add \"10.1.1.0/24\" via \"192.168.1.2\" ; fi\n", "delta": "0:00:00.067095", "end": "2019-11-22 06:42:21.138243", "item": [{"bridge_name": "t1br1", "default_route_ip": "10.1.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.1.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.1.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.1.1.2/24"}], "vms": [{"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM1", "vcpu": 4, "vmif": "t1VM1if1"}, {"brif": "t1br1if2", "disk": "10G", "mem": 4, "name": "t1_VM2", "vcpu": 2, "vmif": "t1VM2if1"}]}, {"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.1.2", "remote_ip": "10.2.1.2", "remote_route": "10.2.1.0/24", "subnet_route": "10.1.1.0/24", "tenant_route_ip": "192.168.1.2", "v_name": "vxlan_t1s1"}], "rc": 0, "start": "2019-11-22 06:42:21.071148", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}
skipping: [localhost] => (item=[{u'route': [{u'ip': u'10.1.2.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.2.1', u'bridge_name': u't1br2', u'dns': [{u'dnsif': u't1s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s2_dnsbrif'}], u'ns_name': u't1ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.2.2/24', u'tenant_ns_ip': u'10.1.2.1/24', u'tenant_ns_if': u't1ns2if', u'tenant_sub_if': u't1s2if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'2.2.2.0/24', u'vms': [{u'mem': 3, u'name': u't1_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br2if1', u'vmif': u't1VM3if1'}]}, {u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}])  => {"ansible_loop_var": "item", "changed": false, "item": [{"bridge_name": "t1br2", "default_route_ip": "10.1.2.1", "dns": [{"brif": "t1s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t1s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns2", "route": [{"if": "p1", "ip": "10.1.2.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "2.2.2.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns2if", "tenant_ns_ip": "10.1.2.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s2if", "tenant_sub_ip": "10.1.2.2/24"}], "vms": [{"brif": "t1br2if1", "disk": "10G", "mem": 3, "name": "t1_VM3", "vcpu": 2, "vmif": "t1VM3if1"}]}, {"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}], "skip_reason": "Conditional result was False"}

TASK [Get PNS ip address] ***********************************************************************************************************************************
ok: [localhost] => {"changed": false, "cmd": "ip netns exec pns ip addr show p1 | awk 'FNR==3{ print $2 }' | awk -F/ '{ print $1 }'\n", "delta": "0:00:00.044904", "end": "2019-11-22 06:42:21.462786", "rc": 0, "start": "2019-11-22 06:42:21.417882", "stderr": "", "stderr_lines": [], "stdout": "192.168.100.238", "stdout_lines": ["192.168.100.238"]}

TASK [Add VXLAN routes to host] *****************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.1.2/24', u'tenant_ns_ip': u'10.1.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't1_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM1if1'}, {u'mem': 4, u'name': u't1_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br1if2', u'vmif': u't1VM2if1'}]}, {u'local_ip': u'10.1.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.1.2', u'remote_route': u'10.2.1.0/24', u'subnet_route': u'10.1.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.2.1.2'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip route show \"10.1.1.0/24\" via \"192.168.100.238\" | grep -w '^10.1.1.0/24' ; if [ $? -ne 0 ] ; then ip route add \"10.1.1.0/24\" via \"192.168.100.238\" ; fi\nip route show \"10.2.1.0/24\" via 99.99.99.2 | grep -w '^10.2.1.0/24'; if [ $? -ne 0 ] ; then ip route add \"10.2.1.0/24\" via 99.99.99.2 ; fi\n", "delta": "0:00:00.009770", "end": "2019-11-22 06:42:21.794548", "item": [{"bridge_name": "t1br1", "default_route_ip": "10.1.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.1.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.1.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.1.1.2/24"}], "vms": [{"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM1", "vcpu": 4, "vmif": "t1VM1if1"}, {"brif": "t1br1if2", "disk": "10G", "mem": 4, "name": "t1_VM2", "vcpu": 2, "vmif": "t1VM2if1"}]}, {"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.1.2", "remote_ip": "10.2.1.2", "remote_route": "10.2.1.0/24", "subnet_route": "10.1.1.0/24", "tenant_route_ip": "192.168.1.2", "v_name": "vxlan_t1s1"}], "rc": 0, "start": "2019-11-22 06:42:21.784778", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}
skipping: [localhost] => (item=[{u'route': [{u'ip': u'10.1.2.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.2.1', u'bridge_name': u't1br2', u'dns': [{u'dnsif': u't1s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s2_dnsbrif'}], u'ns_name': u't1ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.2.2/24', u'tenant_ns_ip': u'10.1.2.1/24', u'tenant_ns_if': u't1ns2if', u'tenant_sub_if': u't1s2if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'2.2.2.0/24', u'vms': [{u'mem': 3, u'name': u't1_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br2if1', u'vmif': u't1VM3if1'}]}, {u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}])  => {"ansible_loop_var": "item", "changed": false, "item": [{"bridge_name": "t1br2", "default_route_ip": "10.1.2.1", "dns": [{"brif": "t1s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t1s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns2", "route": [{"if": "p1", "ip": "10.1.2.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "2.2.2.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns2if", "tenant_ns_ip": "10.1.2.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s2if", "tenant_sub_ip": "10.1.2.2/24"}], "vms": [{"brif": "t1br2if1", "disk": "10G", "mem": 3, "name": "t1_VM3", "vcpu": 2, "vmif": "t1VM3if1"}]}, {"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}], "skip_reason": "Conditional result was False"}

PLAY RECAP **************************************************************************************************************************************************
localhost                  : ok=3    changed=2    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0   

Using /etc/ansible/ansible.cfg as config file

PLAY [worker] ***********************************************************************************************************************************************

TASK [Add VXLAN routes in PNS] ******************************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.2.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.1.2/24', u'tenant_ns_ip': u'10.2.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't1_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM4if1'}]}, {u'local_ip': u'10.2.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.129.2', u'remote_route': u'10.1.1.0/24', u'subnet_route': u'10.2.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.1.1.2'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec pns ip route show \"10.2.1.0/24\" via \"192.168.129.2\" | grep -w '^10.2.1.0/24' ; if [ $? -ne 0 ] ; then ip netns exec pns ip route add \"10.2.1.0/24\" via \"192.168.129.2\" ; fi\n", "delta": "0:00:00.068337", "end": "2019-11-22 06:42:23.080008", "item": [{"bridge_name": "t1br1", "default_route_ip": "10.2.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.2.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.2.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.2.1.2/24"}], "vms": [{"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM4", "vcpu": 4, "vmif": "t1VM4if1"}]}, {"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.1.2", "remote_ip": "10.1.1.2", "remote_route": "10.1.1.0/24", "subnet_route": "10.2.1.0/24", "tenant_route_ip": "192.168.129.2", "v_name": "vxlan_t1s1"}], "rc": 0, "start": "2019-11-22 06:42:23.011671", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Get PNS ip address] ***********************************************************************************************************************************
ok: [99.99.99.2] => {"changed": false, "cmd": "ip netns exec pns ip addr show p1 | awk 'FNR==3{ print $2 }' | awk -F/ '{ print $1 }'\n", "delta": "0:00:00.040854", "end": "2019-11-22 06:42:23.480437", "rc": 0, "start": "2019-11-22 06:42:23.439583", "stderr": "", "stderr_lines": [], "stdout": "192.168.100.50", "stdout_lines": ["192.168.100.50"]}

TASK [Add VXLAN routes to host] *****************************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.2.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.1.2/24', u'tenant_ns_ip': u'10.2.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't1_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM4if1'}]}, {u'local_ip': u'10.2.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.129.2', u'remote_route': u'10.1.1.0/24', u'subnet_route': u'10.2.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.1.1.2'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip route show \"10.2.1.0/24\" via \"192.168.100.50\" | grep -w '^10.2.1.0/24' ; if [ $? -ne 0 ] ; then ip route add \"10.2.1.0/24\" via \"192.168.100.50\" ; fi\nip route show \"10.1.1.0/24\" via 99.99.99.1 | grep -w '^10.1.1.0/24'; if [ $? -ne 0 ] ; then ip route add \"10.1.1.0/24\" via 99.99.99.1 ; fi\n", "delta": "0:00:00.010134", "end": "2019-11-22 06:42:23.873838", "item": [{"bridge_name": "t1br1", "default_route_ip": "10.2.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.2.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.2.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.2.1.2/24"}], "vms": [{"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM4", "vcpu": 4, "vmif": "t1VM4if1"}]}, {"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.1.2", "remote_ip": "10.1.1.2", "remote_route": "10.1.1.0/24", "subnet_route": "10.2.1.0/24", "tenant_route_ip": "192.168.129.2", "v_name": "vxlan_t1s1"}], "rc": 0, "start": "2019-11-22 06:42:23.863704", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

PLAY RECAP **************************************************************************************************************************************************
99.99.99.2                 : ok=3    changed=2    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0   

Using /etc/ansible/ansible.cfg as config file

PLAY [main] *************************************************************************************************************************************************

TASK [Create VM templates (C1)] *****************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.1.2/24', u'tenant_ns_ip': u'10.1.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.1.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.1.2', u'remote_route': u'10.2.1.0/24', u'subnet_route': u'10.1.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.2.1.2'}]}, {u'mem': 2, u'name': u't1_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM1if1'}]) => {"ansible_loop_var": "item", "changed": true, "checksum": "350ba870bd31b7f6ee517845c14237910b5af0bf", "dest": "/root/Migration-as-a-Service/etc/t1/VM_templates/t1_VM1.xml.j2", "gid": 0, "group": "root", "item": [{"bridge_name": "t1br1", "default_route_ip": "10.1.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.1.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.1.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.1.1.2/24"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.1.2", "remote_ip": "10.2.1.2", "remote_route": "10.2.1.0/24", "subnet_route": "10.1.1.0/24", "tenant_route_ip": "192.168.1.2", "v_name": "vxlan_t1s1"}]}, {"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM1", "vcpu": 4, "vmif": "t1VM1if1"}], "md5sum": "fbfc2eb0c2569531f25eea92c26d3bee", "mode": "0644", "owner": "root", "size": 4091, "src": "/root/.ansible/tmp/ansible-tmp-1574404944.57-30853264210700/source", "state": "file", "uid": 0}
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.1.2/24', u'tenant_ns_ip': u'10.1.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.1.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.1.2', u'remote_route': u'10.2.1.0/24', u'subnet_route': u'10.1.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.2.1.2'}]}, {u'mem': 4, u'name': u't1_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br1if2', u'vmif': u't1VM2if1'}]) => {"ansible_loop_var": "item", "changed": true, "checksum": "350ba870bd31b7f6ee517845c14237910b5af0bf", "dest": "/root/Migration-as-a-Service/etc/t1/VM_templates/t1_VM2.xml.j2", "gid": 0, "group": "root", "item": [{"bridge_name": "t1br1", "default_route_ip": "10.1.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.1.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.1.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.1.1.2/24"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.1.2", "remote_ip": "10.2.1.2", "remote_route": "10.2.1.0/24", "subnet_route": "10.1.1.0/24", "tenant_route_ip": "192.168.1.2", "v_name": "vxlan_t1s1"}]}, {"brif": "t1br1if2", "disk": "10G", "mem": 4, "name": "t1_VM2", "vcpu": 2, "vmif": "t1VM2if1"}], "md5sum": "fbfc2eb0c2569531f25eea92c26d3bee", "mode": "0644", "owner": "root", "size": 4091, "src": "/root/.ansible/tmp/ansible-tmp-1574404945.16-39669649368059/source", "state": "file", "uid": 0}
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.2.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.2.1', u'bridge_name': u't1br2', u'dns': [{u'dnsif': u't1s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s2_dnsbrif'}], u'ns_name': u't1ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.2.2/24', u'tenant_ns_ip': u'10.1.2.1/24', u'tenant_ns_if': u't1ns2if', u'tenant_sub_if': u't1s2if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'2.2.2.0/24', u'vxlan': [{u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}, {u'mem': 3, u'name': u't1_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br2if1', u'vmif': u't1VM3if1'}]) => {"ansible_loop_var": "item", "changed": true, "checksum": "350ba870bd31b7f6ee517845c14237910b5af0bf", "dest": "/root/Migration-as-a-Service/etc/t1/VM_templates/t1_VM3.xml.j2", "gid": 0, "group": "root", "item": [{"bridge_name": "t1br2", "default_route_ip": "10.1.2.1", "dns": [{"brif": "t1s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t1s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns2", "route": [{"if": "p1", "ip": "10.1.2.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "2.2.2.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns2if", "tenant_ns_ip": "10.1.2.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s2if", "tenant_sub_ip": "10.1.2.2/24"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, {"brif": "t1br2if1", "disk": "10G", "mem": 3, "name": "t1_VM3", "vcpu": 2, "vmif": "t1VM3if1"}], "md5sum": "fbfc2eb0c2569531f25eea92c26d3bee", "mode": "0644", "owner": "root", "size": 4091, "src": "/root/.ansible/tmp/ansible-tmp-1574404945.41-75040640787712/source", "state": "file", "uid": 0}

PLAY RECAP **************************************************************************************************************************************************
localhost                  : ok=1    changed=1    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0   

Using /etc/ansible/ansible.cfg as config file

PLAY [main] *************************************************************************************************************************************************

TASK [Create VM templates (C2)] *****************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.2.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.2.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.1.2/24', u'tenant_ns_ip': u'10.2.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.2.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.129.2', u'remote_route': u'10.1.1.0/24', u'subnet_route': u'10.2.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.1.1.2'}]}, {u'mem': 2, u'name': u't1_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM4if1'}]) => {"ansible_loop_var": "item", "changed": true, "checksum": "350ba870bd31b7f6ee517845c14237910b5af0bf", "dest": "/root/Migration-as-a-Service/etc/t1/VM_templates/t1_VM4.xml.j2", "gid": 0, "group": "root", "item": [{"bridge_name": "t1br1", "default_route_ip": "10.2.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.2.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.2.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.2.1.2/24"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.1.2", "remote_ip": "10.1.1.2", "remote_route": "10.1.1.0/24", "subnet_route": "10.2.1.0/24", "tenant_route_ip": "192.168.129.2", "v_name": "vxlan_t1s1"}]}, {"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM4", "vcpu": 4, "vmif": "t1VM4if1"}], "md5sum": "fbfc2eb0c2569531f25eea92c26d3bee", "mode": "0644", "owner": "root", "size": 4091, "src": "/root/.ansible/tmp/ansible-tmp-1574404946.28-71218340721943/source", "state": "file", "uid": 0}

PLAY RECAP **************************************************************************************************************************************************
localhost                  : ok=1    changed=1    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0   

Using /etc/ansible/ansible.cfg as config file
INFO:root: 06:43:52.820387 Printing the yaml input file
INFO:root: 06:43:52.820649 {'C1': [{'subnet_addr': '1.1.1.0/24', 'VM': [{'name': 'VM1', 'disk': '10G', 'mem': 2, 'vcpu': 4, 'internet_access': True}, {'name': 'VM2', 'disk': '10G', 'mem': 4, 'vcpu': 2, 'internet_access': False}]}, {'subnet_addr': '2.2.2.0/24', 'VM': [{'name': 'VM3', 'disk': '10G', 'mem': 3, 'vcpu': 2, 'internet_access': True}]}], 'C2': [{'subnet_addr': '1.1.1.0/24', 'VM': [{'name': 'VM4', 'disk': '10G', 'mem': 2, 'vcpu': 4, 'internet_access': True}]}]}
INFO:root: 06:43:52.820970 Provided subnet in C1: 1.1.1.0/24 is valid
INFO:root: 06:43:52.821123 Provided subnet in C1: 2.2.2.0/24 is valid
INFO:root: 06:43:52.821252 Provided subnet in C2: 1.1.1.0/24 is valid
Using /etc/ansible/ansible.cfg as config file

PLAY [main] *************************************************************************************************************************************************

TASK [Create Tenant Namespace] ******************************************************************************************************************************
ok: [localhost] => (item={u'default_route_ip': u'192.168.1.1', u'name': u't1', u'pns_ip': u'192.168.1.1/24', u'tenant_if': u't1if', u'tenant_ip': u'192.168.1.2/24', u'pns_if': u't1pns_if'}) => {"ansible_loop_var": "item", "changed": false, "cmd": ["ip", "netns", "add", "t1"], "item": {"default_route_ip": "192.168.1.1", "name": "t1", "pns_if": "t1pns_if", "pns_ip": "192.168.1.1/24", "tenant_if": "t1if", "tenant_ip": "192.168.1.2/24"}, "rc": 0, "stdout": "skipped, since /var/run/netns/t1 exists", "stdout_lines": ["skipped, since /var/run/netns/t1 exists"]}

TASK [Create Subnet Namespace] ******************************************************************************************************************************
ok: [localhost] => (item={u'route': [{u'ip': u'10.1.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.1.2/24', u'tenant_ns_ip': u'10.1.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_ns_name': u't1', u'tenant_sub_if': u't1s1if'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't1_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM1if1'}, {u'mem': 4, u'name': u't1_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br1if2', u'vmif': u't1VM2if1'}], u'vxlan': [{u'local_ip': u'10.1.1.2', u'tenant_route_ip': u'192.168.1.2', u'dsport': 4789, u'dev': u't1s1if', u'subnet_route': u'10.1.1.0/24', u'remote_route': u'10.2.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.2.1.2'}]}) => {"ansible_loop_var": "item", "changed": false, "cmd": ["ip", "netns", "add", "t1ns1"], "item": {"bridge_name": "t1br1", "default_route_ip": "10.1.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.1.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.1.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.1.1.2/24"}], "vms": [{"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM1", "vcpu": 4, "vmif": "t1VM1if1"}, {"brif": "t1br1if2", "disk": "10G", "mem": 4, "name": "t1_VM2", "vcpu": 2, "vmif": "t1VM2if1"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.1.2", "remote_ip": "10.2.1.2", "remote_route": "10.2.1.0/24", "subnet_route": "10.1.1.0/24", "tenant_route_ip": "192.168.1.2", "v_name": "vxlan_t1s1"}]}, "rc": 0, "stdout": "skipped, since /var/run/netns/t1ns1 exists", "stdout_lines": ["skipped, since /var/run/netns/t1ns1 exists"]}
ok: [localhost] => (item={u'route': [{u'ip': u'10.1.2.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.2.1', u'bridge_name': u't1br2', u'dns': [{u'dnsif': u't1s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s2_dnsbrif'}], u'ns_name': u't1ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.2.2/24', u'tenant_ns_ip': u'10.1.2.1/24', u'tenant_ns_if': u't1ns2if', u'tenant_ns_name': u't1', u'tenant_sub_if': u't1s2if'}], u'subnet_ip': u'2.2.2.0/24', u'vms': [{u'mem': 3, u'name': u't1_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br2if1', u'vmif': u't1VM3if1'}], u'vxlan': [{u'local_ip': [], u'tenant_route_ip': [], u'dsport': [], u'dev': [], u'subnet_route': [], u'remote_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}) => {"ansible_loop_var": "item", "changed": false, "cmd": ["ip", "netns", "add", "t1ns2"], "item": {"bridge_name": "t1br2", "default_route_ip": "10.1.2.1", "dns": [{"brif": "t1s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t1s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns2", "route": [{"if": "p1", "ip": "10.1.2.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "2.2.2.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns2if", "tenant_ns_ip": "10.1.2.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s2if", "tenant_sub_ip": "10.1.2.2/24"}], "vms": [{"brif": "t1br2if1", "disk": "10G", "mem": 3, "name": "t1_VM3", "vcpu": 2, "vmif": "t1VM3if1"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, "rc": 0, "stdout": "skipped, since /var/run/netns/t1ns2 exists", "stdout_lines": ["skipped, since /var/run/netns/t1ns2 exists"]}

TASK [Create Tenant VETH pairs] *****************************************************************************************************************************
changed: [localhost] => (item={u'default_route_ip': u'192.168.1.1', u'name': u't1', u'pns_ip': u'192.168.1.1/24', u'tenant_if': u't1if', u'tenant_ip': u'192.168.1.2/24', u'pns_if': u't1pns_if'}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip link show \"t1if\" ; if [ $? -ne 0 ] ; then ip link add \"t1if\" type veth peer name \"t1pns_if\" ; fi\n", "delta": "0:00:00.003584", "end": "2019-11-22 06:43:54.542811", "item": {"default_route_ip": "192.168.1.1", "name": "t1", "pns_if": "t1pns_if", "pns_ip": "192.168.1.1/24", "tenant_if": "t1if", "tenant_ip": "192.168.1.2/24"}, "rc": 0, "start": "2019-11-22 06:43:54.539227", "stderr": "", "stderr_lines": [], "stdout": "27: t1if@t1pns_if: <BROADCAST,MULTICAST> mtu 1500 qdisc noop state DOWN mode DEFAULT group default qlen 1000\n    link/ether d6:68:49:7d:6c:28 brd ff:ff:ff:ff:ff:ff", "stdout_lines": ["27: t1if@t1pns_if: <BROADCAST,MULTICAST> mtu 1500 qdisc noop state DOWN mode DEFAULT group default qlen 1000", "    link/ether d6:68:49:7d:6c:28 brd ff:ff:ff:ff:ff:ff"]}

TASK [Attach Tenant VETH Pairs] *****************************************************************************************************************************
changed: [localhost] => (item={u'default_route_ip': u'192.168.1.1', u'name': u't1', u'pns_ip': u'192.168.1.1/24', u'tenant_if': u't1if', u'tenant_ip': u'192.168.1.2/24', u'pns_if': u't1pns_if'}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec pns ip link show \"t1pns_if\" ; if [ $? -ne 0 ] ; then ip link set \"t1pns_if\" netns pns ; fi\nip netns exec \"t1\" ip link show \"t1if\" ; if [ $? -ne 0 ] ; then ip link set \"t1if\" netns \"t1\" ; fi\nip netns exec pns ip link set dev \"t1pns_if\" up\nip netns exec \"t1\" ip link set dev \"t1if\" up\n", "delta": "0:00:00.145794", "end": "2019-11-22 06:43:54.934260", "item": {"default_route_ip": "192.168.1.1", "name": "t1", "pns_if": "t1pns_if", "pns_ip": "192.168.1.1/24", "tenant_if": "t1if", "tenant_ip": "192.168.1.2/24"}, "rc": 0, "start": "2019-11-22 06:43:54.788466", "stderr": "", "stderr_lines": [], "stdout": "14: t1pns_if@if15: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP mode DEFAULT group default qlen 1000\n    link/ether d6:cc:3c:10:c8:cd brd ff:ff:ff:ff:ff:ff link-netnsid 1\n15: t1if@if14: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP mode DEFAULT group default qlen 1000\n    link/ether 36:f4:e2:3f:e4:d7 brd ff:ff:ff:ff:ff:ff link-netnsid 0", "stdout_lines": ["14: t1pns_if@if15: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP mode DEFAULT group default qlen 1000", "    link/ether d6:cc:3c:10:c8:cd brd ff:ff:ff:ff:ff:ff link-netnsid 1", "15: t1if@if14: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP mode DEFAULT group default qlen 1000", "    link/ether 36:f4:e2:3f:e4:d7 brd ff:ff:ff:ff:ff:ff link-netnsid 0"]}

TASK [Add IP addresses to Tenant VETH Pairs] ****************************************************************************************************************
changed: [localhost] => (item={u'default_route_ip': u'192.168.1.1', u'name': u't1', u'pns_ip': u'192.168.1.1/24', u'tenant_if': u't1if', u'tenant_ip': u'192.168.1.2/24', u'pns_if': u't1pns_if'}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec pns ip addr show \"t1pns_if\" | awk 'FNR==3{ print $2 }' | grep -w '^192.168.1.1/24' ; if [ $? -ne 0 ] ; then ip netns exec pns ip addr add \"192.168.1.1/24\" dev \"t1pns_if\" ; fi\nip netns exec \"t1\" ip addr show \"t1if\" | awk 'FNR==3{ print $2 }' | grep -w '^192.168.1.2/24' ; if [ $? -ne 0 ] ; then ip netns exec \"t1\" ip addr add \"192.168.1.2/24\" dev \"t1if\" ; fi\n", "delta": "0:00:00.068904", "end": "2019-11-22 06:43:55.294466", "item": {"default_route_ip": "192.168.1.1", "name": "t1", "pns_if": "t1pns_if", "pns_ip": "192.168.1.1/24", "tenant_if": "t1if", "tenant_ip": "192.168.1.2/24"}, "rc": 0, "start": "2019-11-22 06:43:55.225562", "stderr": "", "stderr_lines": [], "stdout": "192.168.1.1/24\n192.168.1.2/24", "stdout_lines": ["192.168.1.1/24", "192.168.1.2/24"]}

TASK [Create Namespace VETH Pairs] **************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't1_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM1if1'}, {u'mem': 4, u'name': u't1_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br1if2', u'vmif': u't1VM2if1'}], u'vxlan': [{u'local_ip': u'10.1.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.1.2', u'remote_route': u'10.2.1.0/24', u'subnet_route': u'10.1.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.2.1.2'}]}, {u'tenant_sub_ip': u'10.1.1.2/24', u'tenant_ns_ip': u'10.1.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip link show \"t1ns1if\" ; if [ $? -ne 0 ] ; then ip link add \"t1ns1if\" type veth peer name \"t1s1if\" ; fi\n", "delta": "0:00:00.004157", "end": "2019-11-22 06:43:55.574523", "item": [{"bridge_name": "t1br1", "default_route_ip": "10.1.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.1.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "vms": [{"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM1", "vcpu": 4, "vmif": "t1VM1if1"}, {"brif": "t1br1if2", "disk": "10G", "mem": 4, "name": "t1_VM2", "vcpu": 2, "vmif": "t1VM2if1"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.1.2", "remote_ip": "10.2.1.2", "remote_route": "10.2.1.0/24", "subnet_route": "10.1.1.0/24", "tenant_route_ip": "192.168.1.2", "v_name": "vxlan_t1s1"}]}, {"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.1.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.1.1.2/24"}], "rc": 0, "start": "2019-11-22 06:43:55.570366", "stderr": "", "stderr_lines": [], "stdout": "29: t1ns1if@t1s1if: <BROADCAST,MULTICAST> mtu 1500 qdisc noop state DOWN mode DEFAULT group default qlen 1000\n    link/ether f6:03:3e:3f:f1:61 brd ff:ff:ff:ff:ff:ff", "stdout_lines": ["29: t1ns1if@t1s1if: <BROADCAST,MULTICAST> mtu 1500 qdisc noop state DOWN mode DEFAULT group default qlen 1000", "    link/ether f6:03:3e:3f:f1:61 brd ff:ff:ff:ff:ff:ff"]}
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.2.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.2.1', u'bridge_name': u't1br2', u'dns': [{u'dnsif': u't1s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s2_dnsbrif'}], u'ns_name': u't1ns2', u'subnet_ip': u'2.2.2.0/24', u'vms': [{u'mem': 3, u'name': u't1_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br2if1', u'vmif': u't1VM3if1'}], u'vxlan': [{u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}, {u'tenant_sub_ip': u'10.1.2.2/24', u'tenant_ns_ip': u'10.1.2.1/24', u'tenant_ns_if': u't1ns2if', u'tenant_sub_if': u't1s2if', u'tenant_ns_name': u't1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip link show \"t1ns2if\" ; if [ $? -ne 0 ] ; then ip link add \"t1ns2if\" type veth peer name \"t1s2if\" ; fi\n", "delta": "0:00:00.004139", "end": "2019-11-22 06:43:55.770819", "item": [{"bridge_name": "t1br2", "default_route_ip": "10.1.2.1", "dns": [{"brif": "t1s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t1s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns2", "route": [{"if": "p1", "ip": "10.1.2.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "2.2.2.0/24", "vms": [{"brif": "t1br2if1", "disk": "10G", "mem": 3, "name": "t1_VM3", "vcpu": 2, "vmif": "t1VM3if1"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, {"tenant_ns_if": "t1ns2if", "tenant_ns_ip": "10.1.2.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s2if", "tenant_sub_ip": "10.1.2.2/24"}], "rc": 0, "start": "2019-11-22 06:43:55.766680", "stderr": "", "stderr_lines": [], "stdout": "31: t1ns2if@t1s2if: <BROADCAST,MULTICAST> mtu 1500 qdisc noop state DOWN mode DEFAULT group default qlen 1000\n    link/ether 8e:fa:0e:8e:23:3f brd ff:ff:ff:ff:ff:ff", "stdout_lines": ["31: t1ns2if@t1s2if: <BROADCAST,MULTICAST> mtu 1500 qdisc noop state DOWN mode DEFAULT group default qlen 1000", "    link/ether 8e:fa:0e:8e:23:3f brd ff:ff:ff:ff:ff:ff"]}

TASK [Attach Namespace VETH Pairs] **************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't1_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM1if1'}, {u'mem': 4, u'name': u't1_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br1if2', u'vmif': u't1VM2if1'}], u'vxlan': [{u'local_ip': u'10.1.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.1.2', u'remote_route': u'10.2.1.0/24', u'subnet_route': u'10.1.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.2.1.2'}]}, {u'tenant_sub_ip': u'10.1.1.2/24', u'tenant_ns_ip': u'10.1.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t1\" ip link show \"t1ns1if\" ; if [ $? -ne 0 ] ; then ip link set \"t1ns1if\" netns \"t1\" ; fi\nip netns exec \"t1ns1\" ip link show \"t1s1if\" ; if [ $? -ne 0 ] ; then ip link set \"t1s1if\" netns \"t1ns1\" ; fi\n", "delta": "0:00:00.068778", "end": "2019-11-22 06:43:56.094299", "item": [{"bridge_name": "t1br1", "default_route_ip": "10.1.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.1.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "vms": [{"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM1", "vcpu": 4, "vmif": "t1VM1if1"}, {"brif": "t1br1if2", "disk": "10G", "mem": 4, "name": "t1_VM2", "vcpu": 2, "vmif": "t1VM2if1"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.1.2", "remote_ip": "10.2.1.2", "remote_route": "10.2.1.0/24", "subnet_route": "10.1.1.0/24", "tenant_route_ip": "192.168.1.2", "v_name": "vxlan_t1s1"}]}, {"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.1.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.1.1.2/24"}], "rc": 0, "start": "2019-11-22 06:43:56.025521", "stderr": "", "stderr_lines": [], "stdout": "17: t1ns1if@if16: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP mode DEFAULT group default qlen 1000\n    link/ether 46:f3:8c:9c:ca:6d brd ff:ff:ff:ff:ff:ff link-netnsid 2\n16: t1s1if@if17: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP mode DEFAULT group default qlen 1000\n    link/ether 62:15:ca:47:3b:1d brd ff:ff:ff:ff:ff:ff link-netnsid 0", "stdout_lines": ["17: t1ns1if@if16: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP mode DEFAULT group default qlen 1000", "    link/ether 46:f3:8c:9c:ca:6d brd ff:ff:ff:ff:ff:ff link-netnsid 2", "16: t1s1if@if17: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP mode DEFAULT group default qlen 1000", "    link/ether 62:15:ca:47:3b:1d brd ff:ff:ff:ff:ff:ff link-netnsid 0"]}
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.2.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.2.1', u'bridge_name': u't1br2', u'dns': [{u'dnsif': u't1s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s2_dnsbrif'}], u'ns_name': u't1ns2', u'subnet_ip': u'2.2.2.0/24', u'vms': [{u'mem': 3, u'name': u't1_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br2if1', u'vmif': u't1VM3if1'}], u'vxlan': [{u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}, {u'tenant_sub_ip': u'10.1.2.2/24', u'tenant_ns_ip': u'10.1.2.1/24', u'tenant_ns_if': u't1ns2if', u'tenant_sub_if': u't1s2if', u'tenant_ns_name': u't1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t1\" ip link show \"t1ns2if\" ; if [ $? -ne 0 ] ; then ip link set \"t1ns2if\" netns \"t1\" ; fi\nip netns exec \"t1ns2\" ip link show \"t1s2if\" ; if [ $? -ne 0 ] ; then ip link set \"t1s2if\" netns \"t1ns2\" ; fi\n", "delta": "0:00:00.068783", "end": "2019-11-22 06:43:56.350283", "item": [{"bridge_name": "t1br2", "default_route_ip": "10.1.2.1", "dns": [{"brif": "t1s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t1s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns2", "route": [{"if": "p1", "ip": "10.1.2.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "2.2.2.0/24", "vms": [{"brif": "t1br2if1", "disk": "10G", "mem": 3, "name": "t1_VM3", "vcpu": 2, "vmif": "t1VM3if1"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, {"tenant_ns_if": "t1ns2if", "tenant_ns_ip": "10.1.2.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s2if", "tenant_sub_ip": "10.1.2.2/24"}], "rc": 0, "start": "2019-11-22 06:43:56.281500", "stderr": "", "stderr_lines": [], "stdout": "19: t1ns2if@if18: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP mode DEFAULT group default qlen 1000\n    link/ether ba:3f:18:27:db:c8 brd ff:ff:ff:ff:ff:ff link-netnsid 3\n18: t1s2if@if19: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP mode DEFAULT group default qlen 1000\n    link/ether d6:f7:39:91:be:e3 brd ff:ff:ff:ff:ff:ff link-netnsid 0", "stdout_lines": ["19: t1ns2if@if18: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP mode DEFAULT group default qlen 1000", "    link/ether ba:3f:18:27:db:c8 brd ff:ff:ff:ff:ff:ff link-netnsid 3", "18: t1s2if@if19: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP mode DEFAULT group default qlen 1000", "    link/ether d6:f7:39:91:be:e3 brd ff:ff:ff:ff:ff:ff link-netnsid 0"]}

TASK [Set Namespace VETH Pairs UP] **************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't1_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM1if1'}, {u'mem': 4, u'name': u't1_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br1if2', u'vmif': u't1VM2if1'}], u'vxlan': [{u'local_ip': u'10.1.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.1.2', u'remote_route': u'10.2.1.0/24', u'subnet_route': u'10.1.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.2.1.2'}]}, {u'tenant_sub_ip': u'10.1.1.2/24', u'tenant_ns_ip': u'10.1.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t1\" ip link set dev \"t1ns1if\" up\nip netns exec \"t1ns1\" ip link set dev \"t1s1if\" up\n", "delta": "0:00:00.079433", "end": "2019-11-22 06:43:56.678402", "item": [{"bridge_name": "t1br1", "default_route_ip": "10.1.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.1.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "vms": [{"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM1", "vcpu": 4, "vmif": "t1VM1if1"}, {"brif": "t1br1if2", "disk": "10G", "mem": 4, "name": "t1_VM2", "vcpu": 2, "vmif": "t1VM2if1"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.1.2", "remote_ip": "10.2.1.2", "remote_route": "10.2.1.0/24", "subnet_route": "10.1.1.0/24", "tenant_route_ip": "192.168.1.2", "v_name": "vxlan_t1s1"}]}, {"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.1.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.1.1.2/24"}], "rc": 0, "start": "2019-11-22 06:43:56.598969", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.2.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.2.1', u'bridge_name': u't1br2', u'dns': [{u'dnsif': u't1s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s2_dnsbrif'}], u'ns_name': u't1ns2', u'subnet_ip': u'2.2.2.0/24', u'vms': [{u'mem': 3, u'name': u't1_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br2if1', u'vmif': u't1VM3if1'}], u'vxlan': [{u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}, {u'tenant_sub_ip': u'10.1.2.2/24', u'tenant_ns_ip': u'10.1.2.1/24', u'tenant_ns_if': u't1ns2if', u'tenant_sub_if': u't1s2if', u'tenant_ns_name': u't1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t1\" ip link set dev \"t1ns2if\" up\nip netns exec \"t1ns2\" ip link set dev \"t1s2if\" up\n", "delta": "0:00:00.069458", "end": "2019-11-22 06:43:56.930627", "item": [{"bridge_name": "t1br2", "default_route_ip": "10.1.2.1", "dns": [{"brif": "t1s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t1s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns2", "route": [{"if": "p1", "ip": "10.1.2.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "2.2.2.0/24", "vms": [{"brif": "t1br2if1", "disk": "10G", "mem": 3, "name": "t1_VM3", "vcpu": 2, "vmif": "t1VM3if1"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, {"tenant_ns_if": "t1ns2if", "tenant_ns_ip": "10.1.2.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s2if", "tenant_sub_ip": "10.1.2.2/24"}], "rc": 0, "start": "2019-11-22 06:43:56.861169", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Add IP addresses to Namespace VETH Pairs] *************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't1_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM1if1'}, {u'mem': 4, u'name': u't1_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br1if2', u'vmif': u't1VM2if1'}], u'vxlan': [{u'local_ip': u'10.1.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.1.2', u'remote_route': u'10.2.1.0/24', u'subnet_route': u'10.1.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.2.1.2'}]}, {u'tenant_sub_ip': u'10.1.1.2/24', u'tenant_ns_ip': u'10.1.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t1ns1\" ip addr show \"t1s1if\" | awk 'FNR==3{ print $2 }' | grep -w '^10.1.1.2/24' ; if [ $? -ne 0 ] ; then ip netns exec \"t1ns1\" ip addr add \"10.1.1.2/24\" dev \"t1s1if\" ; fi\n\nip netns exec \"t1\" ip addr show \"t1ns1if\" | awk 'FNR==3{ print $2 }' | grep -w '^10.1.1.1/24' ; if [ $? -ne 0 ] ; then ip netns exec \"t1\" ip addr add \"10.1.1.1/24\" dev \"t1ns1if\" ; fi\n", "delta": "0:00:00.071776", "end": "2019-11-22 06:43:57.250344", "item": [{"bridge_name": "t1br1", "default_route_ip": "10.1.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.1.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "vms": [{"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM1", "vcpu": 4, "vmif": "t1VM1if1"}, {"brif": "t1br1if2", "disk": "10G", "mem": 4, "name": "t1_VM2", "vcpu": 2, "vmif": "t1VM2if1"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.1.2", "remote_ip": "10.2.1.2", "remote_route": "10.2.1.0/24", "subnet_route": "10.1.1.0/24", "tenant_route_ip": "192.168.1.2", "v_name": "vxlan_t1s1"}]}, {"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.1.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.1.1.2/24"}], "rc": 0, "start": "2019-11-22 06:43:57.178568", "stderr": "", "stderr_lines": [], "stdout": "10.1.1.2/24\n10.1.1.1/24", "stdout_lines": ["10.1.1.2/24", "10.1.1.1/24"]}
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.2.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.2.1', u'bridge_name': u't1br2', u'dns': [{u'dnsif': u't1s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s2_dnsbrif'}], u'ns_name': u't1ns2', u'subnet_ip': u'2.2.2.0/24', u'vms': [{u'mem': 3, u'name': u't1_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br2if1', u'vmif': u't1VM3if1'}], u'vxlan': [{u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}, {u'tenant_sub_ip': u'10.1.2.2/24', u'tenant_ns_ip': u'10.1.2.1/24', u'tenant_ns_if': u't1ns2if', u'tenant_sub_if': u't1s2if', u'tenant_ns_name': u't1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t1ns2\" ip addr show \"t1s2if\" | awk 'FNR==3{ print $2 }' | grep -w '^10.1.2.2/24' ; if [ $? -ne 0 ] ; then ip netns exec \"t1ns2\" ip addr add \"10.1.2.2/24\" dev \"t1s2if\" ; fi\n\nip netns exec \"t1\" ip addr show \"t1ns2if\" | awk 'FNR==3{ print $2 }' | grep -w '^10.1.2.1/24' ; if [ $? -ne 0 ] ; then ip netns exec \"t1\" ip addr add \"10.1.2.1/24\" dev \"t1ns2if\" ; fi\n", "delta": "0:00:00.076433", "end": "2019-11-22 06:43:57.518482", "item": [{"bridge_name": "t1br2", "default_route_ip": "10.1.2.1", "dns": [{"brif": "t1s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t1s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns2", "route": [{"if": "p1", "ip": "10.1.2.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "2.2.2.0/24", "vms": [{"brif": "t1br2if1", "disk": "10G", "mem": 3, "name": "t1_VM3", "vcpu": 2, "vmif": "t1VM3if1"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, {"tenant_ns_if": "t1ns2if", "tenant_ns_ip": "10.1.2.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s2if", "tenant_sub_ip": "10.1.2.2/24"}], "rc": 0, "start": "2019-11-22 06:43:57.442049", "stderr": "", "stderr_lines": [], "stdout": "10.1.2.2/24\n10.1.2.1/24", "stdout_lines": ["10.1.2.2/24", "10.1.2.1/24"]}

TASK [Add IP Route to Tenant] *******************************************************************************************************************************
changed: [localhost] => (item={u'default_route_ip': u'192.168.1.1', u'name': u't1', u'pns_ip': u'192.168.1.1/24', u'tenant_if': u't1if', u'tenant_ip': u'192.168.1.2/24', u'pns_if': u't1pns_if'}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t1\" ip route show default | grep -w '[d]efault via 192.168.1.1' ; if [ $? -ne 0 ] ; then ip netns exec \"t1\" ip route add default via \"192.168.1.1\" ; fi\n", "delta": "0:00:00.034739", "end": "2019-11-22 06:43:57.842482", "item": {"default_route_ip": "192.168.1.1", "name": "t1", "pns_if": "t1pns_if", "pns_ip": "192.168.1.1/24", "tenant_if": "t1if", "tenant_ip": "192.168.1.2/24"}, "rc": 0, "start": "2019-11-22 06:43:57.807743", "stderr": "", "stderr_lines": [], "stdout": "default via 192.168.1.1 dev t1if ", "stdout_lines": ["default via 192.168.1.1 dev t1if "]}

TASK [Add IP Route to Tenant Subnet] ************************************************************************************************************************
changed: [localhost] => (item={u'route': [{u'ip': u'10.1.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.1.2/24', u'tenant_ns_ip': u'10.1.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_ns_name': u't1', u'tenant_sub_if': u't1s1if'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't1_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM1if1'}, {u'mem': 4, u'name': u't1_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br1if2', u'vmif': u't1VM2if1'}], u'vxlan': [{u'local_ip': u'10.1.1.2', u'tenant_route_ip': u'192.168.1.2', u'dsport': 4789, u'dev': u't1s1if', u'subnet_route': u'10.1.1.0/24', u'remote_route': u'10.2.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.2.1.2'}]}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t1ns1\" ip route show default | grep -w '[d]efault via 10.1.1.1' ; if [ $? -ne 0 ] ; then ip netns exec \"t1ns1\" ip route add default via \"10.1.1.1\" ; fi\n", "delta": "0:00:00.043158", "end": "2019-11-22 06:43:58.170432", "item": {"bridge_name": "t1br1", "default_route_ip": "10.1.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.1.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.1.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.1.1.2/24"}], "vms": [{"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM1", "vcpu": 4, "vmif": "t1VM1if1"}, {"brif": "t1br1if2", "disk": "10G", "mem": 4, "name": "t1_VM2", "vcpu": 2, "vmif": "t1VM2if1"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.1.2", "remote_ip": "10.2.1.2", "remote_route": "10.2.1.0/24", "subnet_route": "10.1.1.0/24", "tenant_route_ip": "192.168.1.2", "v_name": "vxlan_t1s1"}]}, "rc": 0, "start": "2019-11-22 06:43:58.127274", "stderr": "", "stderr_lines": [], "stdout": "default via 10.1.1.1 dev t1s1if ", "stdout_lines": ["default via 10.1.1.1 dev t1s1if "]}
changed: [localhost] => (item={u'route': [{u'ip': u'10.1.2.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.2.1', u'bridge_name': u't1br2', u'dns': [{u'dnsif': u't1s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s2_dnsbrif'}], u'ns_name': u't1ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.2.2/24', u'tenant_ns_ip': u'10.1.2.1/24', u'tenant_ns_if': u't1ns2if', u'tenant_ns_name': u't1', u'tenant_sub_if': u't1s2if'}], u'subnet_ip': u'2.2.2.0/24', u'vms': [{u'mem': 3, u'name': u't1_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br2if1', u'vmif': u't1VM3if1'}], u'vxlan': [{u'local_ip': [], u'tenant_route_ip': [], u'dsport': [], u'dev': [], u'subnet_route': [], u'remote_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t1ns2\" ip route show default | grep -w '[d]efault via 10.1.2.1' ; if [ $? -ne 0 ] ; then ip netns exec \"t1ns2\" ip route add default via \"10.1.2.1\" ; fi\n", "delta": "0:00:00.034802", "end": "2019-11-22 06:43:58.422373", "item": {"bridge_name": "t1br2", "default_route_ip": "10.1.2.1", "dns": [{"brif": "t1s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t1s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns2", "route": [{"if": "p1", "ip": "10.1.2.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "2.2.2.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns2if", "tenant_ns_ip": "10.1.2.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s2if", "tenant_sub_ip": "10.1.2.2/24"}], "vms": [{"brif": "t1br2if1", "disk": "10G", "mem": 3, "name": "t1_VM3", "vcpu": 2, "vmif": "t1VM3if1"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, "rc": 0, "start": "2019-11-22 06:43:58.387571", "stderr": "", "stderr_lines": [], "stdout": "default via 10.1.2.1 dev t1s2if ", "stdout_lines": ["default via 10.1.2.1 dev t1s2if "]}

TASK [Create bridge inside namespace] ***********************************************************************************************************************
changed: [localhost] => (item={u'route': [{u'ip': u'10.1.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.1.2/24', u'tenant_ns_ip': u'10.1.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_ns_name': u't1', u'tenant_sub_if': u't1s1if'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't1_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM1if1'}, {u'mem': 4, u'name': u't1_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br1if2', u'vmif': u't1VM2if1'}], u'vxlan': [{u'local_ip': u'10.1.1.2', u'tenant_route_ip': u'192.168.1.2', u'dsport': 4789, u'dev': u't1s1if', u'subnet_route': u'10.1.1.0/24', u'remote_route': u'10.2.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.2.1.2'}]}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t1ns1\" brctl show | grep -w '^t1br1'; if [ $? -ne 0 ] ; then ip netns exec \"t1ns1\" brctl addbr \"t1br1\" ; fi\nip netns exec \"t1ns1\" ip link set dev \"t1br1\" up\n", "delta": "0:00:00.088379", "end": "2019-11-22 06:43:58.794400", "item": {"bridge_name": "t1br1", "default_route_ip": "10.1.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.1.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.1.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.1.1.2/24"}], "vms": [{"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM1", "vcpu": 4, "vmif": "t1VM1if1"}, {"brif": "t1br1if2", "disk": "10G", "mem": 4, "name": "t1_VM2", "vcpu": 2, "vmif": "t1VM2if1"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.1.2", "remote_ip": "10.2.1.2", "remote_route": "10.2.1.0/24", "subnet_route": "10.1.1.0/24", "tenant_route_ip": "192.168.1.2", "v_name": "vxlan_t1s1"}]}, "rc": 0, "start": "2019-11-22 06:43:58.706021", "stderr": "", "stderr_lines": [], "stdout": "t1br1\t\t8000.4679e2aabaf9\tno\t\tt1br1if1", "stdout_lines": ["t1br1\t\t8000.4679e2aabaf9\tno\t\tt1br1if1"]}
changed: [localhost] => (item={u'route': [{u'ip': u'10.1.2.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.2.1', u'bridge_name': u't1br2', u'dns': [{u'dnsif': u't1s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s2_dnsbrif'}], u'ns_name': u't1ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.2.2/24', u'tenant_ns_ip': u'10.1.2.1/24', u'tenant_ns_if': u't1ns2if', u'tenant_ns_name': u't1', u'tenant_sub_if': u't1s2if'}], u'subnet_ip': u'2.2.2.0/24', u'vms': [{u'mem': 3, u'name': u't1_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br2if1', u'vmif': u't1VM3if1'}], u'vxlan': [{u'local_ip': [], u'tenant_route_ip': [], u'dsport': [], u'dev': [], u'subnet_route': [], u'remote_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t1ns2\" brctl show | grep -w '^t1br2'; if [ $? -ne 0 ] ; then ip netns exec \"t1ns2\" brctl addbr \"t1br2\" ; fi\nip netns exec \"t1ns2\" ip link set dev \"t1br2\" up\n", "delta": "0:00:00.091039", "end": "2019-11-22 06:43:59.110365", "item": {"bridge_name": "t1br2", "default_route_ip": "10.1.2.1", "dns": [{"brif": "t1s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t1s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns2", "route": [{"if": "p1", "ip": "10.1.2.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "2.2.2.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns2if", "tenant_ns_ip": "10.1.2.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s2if", "tenant_sub_ip": "10.1.2.2/24"}], "vms": [{"brif": "t1br2if1", "disk": "10G", "mem": 3, "name": "t1_VM3", "vcpu": 2, "vmif": "t1VM3if1"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, "rc": 0, "start": "2019-11-22 06:43:59.019326", "stderr": "", "stderr_lines": [], "stdout": "t1br2\t\t8000.225af8b64bfa\tno\t\tt1br2if1", "stdout_lines": ["t1br2\t\t8000.225af8b64bfa\tno\t\tt1br2if1"]}

TASK [Create DNS VETH Pair] *********************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.1.1', u'bridge_name': u't1br1', u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.1.2/24', u'tenant_ns_ip': u'10.1.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't1_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM1if1'}, {u'mem': 4, u'name': u't1_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br1if2', u'vmif': u't1VM2if1'}], u'vxlan': [{u'local_ip': u'10.1.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.1.2', u'remote_route': u'10.2.1.0/24', u'subnet_route': u'10.1.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.2.1.2'}]}, {u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t1ns1\" ip link show \"t1s1_dnsbrif\" ; if [ $? -ne 0 ] ; then ip netns exec \"t1ns1\" ip link add \"t1s1_dnsbrif\" type veth peer name \"t1s1_dnsif\" ; fi\nip netns exec \"t1ns1\" ip link set dev \"t1s1_dnsbrif\" up\nip netns exec \"t1ns1\" ip link set dev \"t1s1_dnsif\" up\n", "delta": "0:00:00.097746", "end": "2019-11-22 06:43:59.466460", "item": [{"bridge_name": "t1br1", "default_route_ip": "10.1.1.1", "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.1.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.1.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.1.1.2/24"}], "vms": [{"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM1", "vcpu": 4, "vmif": "t1VM1if1"}, {"brif": "t1br1if2", "disk": "10G", "mem": 4, "name": "t1_VM2", "vcpu": 2, "vmif": "t1VM2if1"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.1.2", "remote_ip": "10.2.1.2", "remote_route": "10.2.1.0/24", "subnet_route": "10.1.1.0/24", "tenant_route_ip": "192.168.1.2", "v_name": "vxlan_t1s1"}]}, {"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "rc": 0, "start": "2019-11-22 06:43:59.368714", "stderr": "", "stderr_lines": [], "stdout": "4: t1s1_dnsbrif@t1s1_dnsif: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue master t1br1 state UP mode DEFAULT group default qlen 1000\n    link/ether 4e:a8:79:10:75:b7 brd ff:ff:ff:ff:ff:ff", "stdout_lines": ["4: t1s1_dnsbrif@t1s1_dnsif: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue master t1br1 state UP mode DEFAULT group default qlen 1000", "    link/ether 4e:a8:79:10:75:b7 brd ff:ff:ff:ff:ff:ff"]}
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.2.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.2.1', u'bridge_name': u't1br2', u'ns_name': u't1ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.2.2/24', u'tenant_ns_ip': u'10.1.2.1/24', u'tenant_ns_if': u't1ns2if', u'tenant_sub_if': u't1s2if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'2.2.2.0/24', u'vms': [{u'mem': 3, u'name': u't1_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br2if1', u'vmif': u't1VM3if1'}], u'vxlan': [{u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}, {u'dnsif': u't1s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s2_dnsbrif'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t1ns2\" ip link show \"t1s2_dnsbrif\" ; if [ $? -ne 0 ] ; then ip netns exec \"t1ns2\" ip link add \"t1s2_dnsbrif\" type veth peer name \"t1s2_dnsif\" ; fi\nip netns exec \"t1ns2\" ip link set dev \"t1s2_dnsbrif\" up\nip netns exec \"t1ns2\" ip link set dev \"t1s2_dnsif\" up\n", "delta": "0:00:00.115564", "end": "2019-11-22 06:43:59.774230", "item": [{"bridge_name": "t1br2", "default_route_ip": "10.1.2.1", "ns_name": "t1ns2", "route": [{"if": "p1", "ip": "10.1.2.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "2.2.2.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns2if", "tenant_ns_ip": "10.1.2.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s2if", "tenant_sub_ip": "10.1.2.2/24"}], "vms": [{"brif": "t1br2if1", "disk": "10G", "mem": 3, "name": "t1_VM3", "vcpu": 2, "vmif": "t1VM3if1"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, {"brif": "t1s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t1s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "rc": 0, "start": "2019-11-22 06:43:59.658666", "stderr": "", "stderr_lines": [], "stdout": "4: t1s2_dnsbrif@t1s2_dnsif: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue master t1br2 state UP mode DEFAULT group default qlen 1000\n    link/ether 76:f4:fa:92:f1:18 brd ff:ff:ff:ff:ff:ff", "stdout_lines": ["4: t1s2_dnsbrif@t1s2_dnsif: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue master t1br2 state UP mode DEFAULT group default qlen 1000", "    link/ether 76:f4:fa:92:f1:18 brd ff:ff:ff:ff:ff:ff"]}

TASK [Attach DNS VETH Pair] *********************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.1.1', u'bridge_name': u't1br1', u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.1.2/24', u'tenant_ns_ip': u'10.1.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't1_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM1if1'}, {u'mem': 4, u'name': u't1_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br1if2', u'vmif': u't1VM2if1'}], u'vxlan': [{u'local_ip': u'10.1.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.1.2', u'remote_route': u'10.2.1.0/24', u'subnet_route': u'10.1.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.2.1.2'}]}, {u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t1ns1\" brctl show \"t1br1\" | grep -w 't1s1_dnsbrif' ; if [ $? -ne 0 ] ; then ip netns exec \"t1ns1\" brctl addif \"t1br1\" \"t1s1_dnsbrif\" ; fi\n", "delta": "0:00:00.034986", "end": "2019-11-22 06:44:00.086383", "item": [{"bridge_name": "t1br1", "default_route_ip": "10.1.1.1", "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.1.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.1.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.1.1.2/24"}], "vms": [{"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM1", "vcpu": 4, "vmif": "t1VM1if1"}, {"brif": "t1br1if2", "disk": "10G", "mem": 4, "name": "t1_VM2", "vcpu": 2, "vmif": "t1VM2if1"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.1.2", "remote_ip": "10.2.1.2", "remote_route": "10.2.1.0/24", "subnet_route": "10.1.1.0/24", "tenant_route_ip": "192.168.1.2", "v_name": "vxlan_t1s1"}]}, {"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "rc": 0, "start": "2019-11-22 06:44:00.051397", "stderr": "", "stderr_lines": [], "stdout": "\t\t\t\t\t\t\tt1s1_dnsbrif", "stdout_lines": ["\t\t\t\t\t\t\tt1s1_dnsbrif"]}
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.2.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.2.1', u'bridge_name': u't1br2', u'ns_name': u't1ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.2.2/24', u'tenant_ns_ip': u'10.1.2.1/24', u'tenant_ns_if': u't1ns2if', u'tenant_sub_if': u't1s2if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'2.2.2.0/24', u'vms': [{u'mem': 3, u'name': u't1_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br2if1', u'vmif': u't1VM3if1'}], u'vxlan': [{u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}, {u'dnsif': u't1s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s2_dnsbrif'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t1ns2\" brctl show \"t1br2\" | grep -w 't1s2_dnsbrif' ; if [ $? -ne 0 ] ; then ip netns exec \"t1ns2\" brctl addif \"t1br2\" \"t1s2_dnsbrif\" ; fi\n", "delta": "0:00:00.033133", "end": "2019-11-22 06:44:00.310304", "item": [{"bridge_name": "t1br2", "default_route_ip": "10.1.2.1", "ns_name": "t1ns2", "route": [{"if": "p1", "ip": "10.1.2.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "2.2.2.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns2if", "tenant_ns_ip": "10.1.2.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s2if", "tenant_sub_ip": "10.1.2.2/24"}], "vms": [{"brif": "t1br2if1", "disk": "10G", "mem": 3, "name": "t1_VM3", "vcpu": 2, "vmif": "t1VM3if1"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, {"brif": "t1s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t1s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "rc": 0, "start": "2019-11-22 06:44:00.277171", "stderr": "", "stderr_lines": [], "stdout": "\t\t\t\t\t\t\tt1s2_dnsbrif", "stdout_lines": ["\t\t\t\t\t\t\tt1s2_dnsbrif"]}

TASK [Create VETH Pairs] ************************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.1.2/24', u'tenant_ns_ip': u'10.1.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.1.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.1.2', u'remote_route': u'10.2.1.0/24', u'subnet_route': u'10.1.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.2.1.2'}]}, {u'mem': 2, u'name': u't1_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM1if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip link show \"t1br1if1\" ; if [ $? -ne 0 ] ; then ip link add \"t1VM1if1\" type veth peer name \"t1br1if1\" ; fi\nip link set dev \"t1br1if1\" up\nip link set dev \"t1VM1if1\" up\n", "delta": "0:00:00.012200", "end": "2019-11-22 06:44:00.603023", "item": [{"bridge_name": "t1br1", "default_route_ip": "10.1.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.1.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.1.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.1.1.2/24"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.1.2", "remote_ip": "10.2.1.2", "remote_route": "10.2.1.0/24", "subnet_route": "10.1.1.0/24", "tenant_route_ip": "192.168.1.2", "v_name": "vxlan_t1s1"}]}, {"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM1", "vcpu": 4, "vmif": "t1VM1if1"}], "rc": 0, "start": "2019-11-22 06:44:00.590823", "stderr": "Device \"t1br1if1\" does not exist.\nRTNETLINK answers: File exists\nCannot find device \"t1br1if1\"", "stderr_lines": ["Device \"t1br1if1\" does not exist.", "RTNETLINK answers: File exists", "Cannot find device \"t1br1if1\""], "stdout": "", "stdout_lines": []}
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.1.2/24', u'tenant_ns_ip': u'10.1.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.1.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.1.2', u'remote_route': u'10.2.1.0/24', u'subnet_route': u'10.1.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.2.1.2'}]}, {u'mem': 4, u'name': u't1_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br1if2', u'vmif': u't1VM2if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip link show \"t1br1if2\" ; if [ $? -ne 0 ] ; then ip link add \"t1VM2if1\" type veth peer name \"t1br1if2\" ; fi\nip link set dev \"t1br1if2\" up\nip link set dev \"t1VM2if1\" up\n", "delta": "0:00:00.013089", "end": "2019-11-22 06:44:00.811920", "item": [{"bridge_name": "t1br1", "default_route_ip": "10.1.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.1.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.1.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.1.1.2/24"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.1.2", "remote_ip": "10.2.1.2", "remote_route": "10.2.1.0/24", "subnet_route": "10.1.1.0/24", "tenant_route_ip": "192.168.1.2", "v_name": "vxlan_t1s1"}]}, {"brif": "t1br1if2", "disk": "10G", "mem": 4, "name": "t1_VM2", "vcpu": 2, "vmif": "t1VM2if1"}], "rc": 0, "start": "2019-11-22 06:44:00.798831", "stderr": "Device \"t1br1if2\" does not exist.\nRTNETLINK answers: File exists\nCannot find device \"t1br1if2\"", "stderr_lines": ["Device \"t1br1if2\" does not exist.", "RTNETLINK answers: File exists", "Cannot find device \"t1br1if2\""], "stdout": "", "stdout_lines": []}
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.2.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.2.1', u'bridge_name': u't1br2', u'dns': [{u'dnsif': u't1s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s2_dnsbrif'}], u'ns_name': u't1ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.2.2/24', u'tenant_ns_ip': u'10.1.2.1/24', u'tenant_ns_if': u't1ns2if', u'tenant_sub_if': u't1s2if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'2.2.2.0/24', u'vxlan': [{u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}, {u'mem': 3, u'name': u't1_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br2if1', u'vmif': u't1VM3if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip link show \"t1br2if1\" ; if [ $? -ne 0 ] ; then ip link add \"t1VM3if1\" type veth peer name \"t1br2if1\" ; fi\nip link set dev \"t1br2if1\" up\nip link set dev \"t1VM3if1\" up\n", "delta": "0:00:00.012146", "end": "2019-11-22 06:44:01.013257", "item": [{"bridge_name": "t1br2", "default_route_ip": "10.1.2.1", "dns": [{"brif": "t1s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t1s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns2", "route": [{"if": "p1", "ip": "10.1.2.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "2.2.2.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns2if", "tenant_ns_ip": "10.1.2.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s2if", "tenant_sub_ip": "10.1.2.2/24"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, {"brif": "t1br2if1", "disk": "10G", "mem": 3, "name": "t1_VM3", "vcpu": 2, "vmif": "t1VM3if1"}], "rc": 0, "start": "2019-11-22 06:44:01.001111", "stderr": "Device \"t1br2if1\" does not exist.\nRTNETLINK answers: File exists\nCannot find device \"t1br2if1\"", "stderr_lines": ["Device \"t1br2if1\" does not exist.", "RTNETLINK answers: File exists", "Cannot find device \"t1br2if1\""], "stdout": "", "stdout_lines": []}

TASK [Attach VETH Pairs] ************************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.1.2/24', u'tenant_ns_ip': u'10.1.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.1.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.1.2', u'remote_route': u'10.2.1.0/24', u'subnet_route': u'10.1.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.2.1.2'}]}, {u'mem': 2, u'name': u't1_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM1if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip link show \"t1br1if1\" ; if [ $? -eq 0 ] ; then ip link set \"t1br1if1\" netns \"t1ns1\" ; fi\nip netns exec \"t1ns1\" brctl show \"t1br1\" | grep -w 't1br1if1' ; if [ $? -ne 0 ] ; then ip netns exec \"t1ns1\" brctl addif \"t1br1\" \"t1br1if1\" ; fi\n", "delta": "0:00:00.037932", "end": "2019-11-22 06:44:01.314399", "item": [{"bridge_name": "t1br1", "default_route_ip": "10.1.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.1.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.1.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.1.1.2/24"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.1.2", "remote_ip": "10.2.1.2", "remote_route": "10.2.1.0/24", "subnet_route": "10.1.1.0/24", "tenant_route_ip": "192.168.1.2", "v_name": "vxlan_t1s1"}]}, {"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM1", "vcpu": 4, "vmif": "t1VM1if1"}], "rc": 0, "start": "2019-11-22 06:44:01.276467", "stderr": "Device \"t1br1if1\" does not exist.", "stderr_lines": ["Device \"t1br1if1\" does not exist."], "stdout": "t1br1\t\t8000.4679e2aabaf9\tno\t\tt1br1if1", "stdout_lines": ["t1br1\t\t8000.4679e2aabaf9\tno\t\tt1br1if1"]}
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.1.2/24', u'tenant_ns_ip': u'10.1.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.1.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.1.2', u'remote_route': u'10.2.1.0/24', u'subnet_route': u'10.1.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.2.1.2'}]}, {u'mem': 4, u'name': u't1_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br1if2', u'vmif': u't1VM2if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip link show \"t1br1if2\" ; if [ $? -eq 0 ] ; then ip link set \"t1br1if2\" netns \"t1ns1\" ; fi\nip netns exec \"t1ns1\" brctl show \"t1br1\" | grep -w 't1br1if2' ; if [ $? -ne 0 ] ; then ip netns exec \"t1ns1\" brctl addif \"t1br1\" \"t1br1if2\" ; fi\n", "delta": "0:00:00.035470", "end": "2019-11-22 06:44:01.550207", "item": [{"bridge_name": "t1br1", "default_route_ip": "10.1.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.1.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.1.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.1.1.2/24"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.1.2", "remote_ip": "10.2.1.2", "remote_route": "10.2.1.0/24", "subnet_route": "10.1.1.0/24", "tenant_route_ip": "192.168.1.2", "v_name": "vxlan_t1s1"}]}, {"brif": "t1br1if2", "disk": "10G", "mem": 4, "name": "t1_VM2", "vcpu": 2, "vmif": "t1VM2if1"}], "rc": 0, "start": "2019-11-22 06:44:01.514737", "stderr": "Device \"t1br1if2\" does not exist.", "stderr_lines": ["Device \"t1br1if2\" does not exist."], "stdout": "\t\t\t\t\t\t\tt1br1if2", "stdout_lines": ["\t\t\t\t\t\t\tt1br1if2"]}
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.2.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.2.1', u'bridge_name': u't1br2', u'dns': [{u'dnsif': u't1s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s2_dnsbrif'}], u'ns_name': u't1ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.2.2/24', u'tenant_ns_ip': u'10.1.2.1/24', u'tenant_ns_if': u't1ns2if', u'tenant_sub_if': u't1s2if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'2.2.2.0/24', u'vxlan': [{u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}, {u'mem': 3, u'name': u't1_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br2if1', u'vmif': u't1VM3if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip link show \"t1br2if1\" ; if [ $? -eq 0 ] ; then ip link set \"t1br2if1\" netns \"t1ns2\" ; fi\nip netns exec \"t1ns2\" brctl show \"t1br2\" | grep -w 't1br2if1' ; if [ $? -ne 0 ] ; then ip netns exec \"t1ns2\" brctl addif \"t1br2\" \"t1br2if1\" ; fi\n", "delta": "0:00:00.040428", "end": "2019-11-22 06:44:01.778380", "item": [{"bridge_name": "t1br2", "default_route_ip": "10.1.2.1", "dns": [{"brif": "t1s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t1s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns2", "route": [{"if": "p1", "ip": "10.1.2.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "2.2.2.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns2if", "tenant_ns_ip": "10.1.2.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s2if", "tenant_sub_ip": "10.1.2.2/24"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, {"brif": "t1br2if1", "disk": "10G", "mem": 3, "name": "t1_VM3", "vcpu": 2, "vmif": "t1VM3if1"}], "rc": 0, "start": "2019-11-22 06:44:01.737952", "stderr": "Device \"t1br2if1\" does not exist.", "stderr_lines": ["Device \"t1br2if1\" does not exist."], "stdout": "t1br2\t\t8000.225af8b64bfa\tno\t\tt1br2if1", "stdout_lines": ["t1br2\t\t8000.225af8b64bfa\tno\t\tt1br2if1"]}

TASK [All interfaces and bridges UP] ************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.1.2/24', u'tenant_ns_ip': u'10.1.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.1.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.1.2', u'remote_route': u'10.2.1.0/24', u'subnet_route': u'10.1.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.2.1.2'}]}, {u'mem': 2, u'name': u't1_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM1if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t1ns1\" ip link set \"t1br1if1\" up\nip netns exec \"t1ns1\" ip link set dev \"t1br1\" up\n", "delta": "0:00:00.068196", "end": "2019-11-22 06:44:02.122095", "item": [{"bridge_name": "t1br1", "default_route_ip": "10.1.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.1.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.1.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.1.1.2/24"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.1.2", "remote_ip": "10.2.1.2", "remote_route": "10.2.1.0/24", "subnet_route": "10.1.1.0/24", "tenant_route_ip": "192.168.1.2", "v_name": "vxlan_t1s1"}]}, {"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM1", "vcpu": 4, "vmif": "t1VM1if1"}], "rc": 0, "start": "2019-11-22 06:44:02.053899", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.1.2/24', u'tenant_ns_ip': u'10.1.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.1.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.1.2', u'remote_route': u'10.2.1.0/24', u'subnet_route': u'10.1.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.2.1.2'}]}, {u'mem': 4, u'name': u't1_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br1if2', u'vmif': u't1VM2if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t1ns1\" ip link set \"t1br1if2\" up\nip netns exec \"t1ns1\" ip link set dev \"t1br1\" up\n", "delta": "0:00:00.068221", "end": "2019-11-22 06:44:02.386368", "item": [{"bridge_name": "t1br1", "default_route_ip": "10.1.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.1.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.1.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.1.1.2/24"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.1.2", "remote_ip": "10.2.1.2", "remote_route": "10.2.1.0/24", "subnet_route": "10.1.1.0/24", "tenant_route_ip": "192.168.1.2", "v_name": "vxlan_t1s1"}]}, {"brif": "t1br1if2", "disk": "10G", "mem": 4, "name": "t1_VM2", "vcpu": 2, "vmif": "t1VM2if1"}], "rc": 0, "start": "2019-11-22 06:44:02.318147", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.2.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.2.1', u'bridge_name': u't1br2', u'dns': [{u'dnsif': u't1s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s2_dnsbrif'}], u'ns_name': u't1ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.2.2/24', u'tenant_ns_ip': u'10.1.2.1/24', u'tenant_ns_if': u't1ns2if', u'tenant_sub_if': u't1s2if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'2.2.2.0/24', u'vxlan': [{u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}, {u'mem': 3, u'name': u't1_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br2if1', u'vmif': u't1VM3if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t1ns2\" ip link set \"t1br2if1\" up\nip netns exec \"t1ns2\" ip link set dev \"t1br2\" up\n", "delta": "0:00:00.076365", "end": "2019-11-22 06:44:02.654527", "item": [{"bridge_name": "t1br2", "default_route_ip": "10.1.2.1", "dns": [{"brif": "t1s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t1s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns2", "route": [{"if": "p1", "ip": "10.1.2.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "2.2.2.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns2if", "tenant_ns_ip": "10.1.2.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s2if", "tenant_sub_ip": "10.1.2.2/24"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, {"brif": "t1br2if1", "disk": "10G", "mem": 3, "name": "t1_VM3", "vcpu": 2, "vmif": "t1VM3if1"}], "rc": 0, "start": "2019-11-22 06:44:02.578162", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Add IP to DNS Interface] ******************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.1.1', u'bridge_name': u't1br1', u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.1.2/24', u'tenant_ns_ip': u'10.1.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't1_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM1if1'}, {u'mem': 4, u'name': u't1_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br1if2', u'vmif': u't1VM2if1'}], u'vxlan': [{u'local_ip': u'10.1.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.1.2', u'remote_route': u'10.2.1.0/24', u'subnet_route': u'10.1.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.2.1.2'}]}, {u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t1ns1\" ip addr show \"t1s1_dnsif\" | awk 'FNR==3{ print $2 }' | grep -w '^1.1.1.1/24' ; if [ $? -ne 0 ] ; then ip netns exec \"t1ns1\" ip addr add \"1.1.1.1/24\" dev \"t1s1_dnsif\" ; fi\n", "delta": "0:00:00.042751", "end": "2019-11-22 06:44:02.966488", "item": [{"bridge_name": "t1br1", "default_route_ip": "10.1.1.1", "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.1.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.1.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.1.1.2/24"}], "vms": [{"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM1", "vcpu": 4, "vmif": "t1VM1if1"}, {"brif": "t1br1if2", "disk": "10G", "mem": 4, "name": "t1_VM2", "vcpu": 2, "vmif": "t1VM2if1"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.1.2", "remote_ip": "10.2.1.2", "remote_route": "10.2.1.0/24", "subnet_route": "10.1.1.0/24", "tenant_route_ip": "192.168.1.2", "v_name": "vxlan_t1s1"}]}, {"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "rc": 0, "start": "2019-11-22 06:44:02.923737", "stderr": "", "stderr_lines": [], "stdout": "1.1.1.1/24", "stdout_lines": ["1.1.1.1/24"]}
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.2.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.2.1', u'bridge_name': u't1br2', u'ns_name': u't1ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.2.2/24', u'tenant_ns_ip': u'10.1.2.1/24', u'tenant_ns_if': u't1ns2if', u'tenant_sub_if': u't1s2if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'2.2.2.0/24', u'vms': [{u'mem': 3, u'name': u't1_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br2if1', u'vmif': u't1VM3if1'}], u'vxlan': [{u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}, {u'dnsif': u't1s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s2_dnsbrif'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t1ns2\" ip addr show \"t1s2_dnsif\" | awk 'FNR==3{ print $2 }' | grep -w '^2.2.2.1/24' ; if [ $? -ne 0 ] ; then ip netns exec \"t1ns2\" ip addr add \"2.2.2.1/24\" dev \"t1s2_dnsif\" ; fi\n", "delta": "0:00:00.036154", "end": "2019-11-22 06:44:03.210549", "item": [{"bridge_name": "t1br2", "default_route_ip": "10.1.2.1", "ns_name": "t1ns2", "route": [{"if": "p1", "ip": "10.1.2.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "2.2.2.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns2if", "tenant_ns_ip": "10.1.2.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s2if", "tenant_sub_ip": "10.1.2.2/24"}], "vms": [{"brif": "t1br2if1", "disk": "10G", "mem": 3, "name": "t1_VM3", "vcpu": 2, "vmif": "t1VM3if1"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, {"brif": "t1s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t1s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "rc": 0, "start": "2019-11-22 06:44:03.174395", "stderr": "", "stderr_lines": [], "stdout": "2.2.2.1/24", "stdout_lines": ["2.2.2.1/24"]}

TASK [Install DHCP Server] **********************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.1.1', u'bridge_name': u't1br1', u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.1.2/24', u'tenant_ns_ip': u'10.1.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't1_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM1if1'}, {u'mem': 4, u'name': u't1_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br1if2', u'vmif': u't1VM2if1'}], u'vxlan': [{u'local_ip': u'10.1.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.1.2', u'remote_route': u'10.2.1.0/24', u'subnet_route': u'10.1.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.2.1.2'}]}, {u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t1ns1\" ps aux | grep -w '[d]nsmasq --interface t1s1_dnsif -z --dhcp-range=1.1.1.5,1.1.1.126' ; if [ $? -ne 0 ] ; then ip netns exec \"t1ns1\" dnsmasq --interface \"t1s1_dnsif\" -z --dhcp-range=1.1.1.5,'1.1.1.126' ; fi\n", "delta": "0:00:00.041437", "end": "2019-11-22 06:44:03.526348", "item": [{"bridge_name": "t1br1", "default_route_ip": "10.1.1.1", "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.1.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.1.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.1.1.2/24"}], "vms": [{"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM1", "vcpu": 4, "vmif": "t1VM1if1"}, {"brif": "t1br1if2", "disk": "10G", "mem": 4, "name": "t1_VM2", "vcpu": 2, "vmif": "t1VM2if1"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.1.2", "remote_ip": "10.2.1.2", "remote_route": "10.2.1.0/24", "subnet_route": "10.1.1.0/24", "tenant_route_ip": "192.168.1.2", "v_name": "vxlan_t1s1"}]}, {"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "rc": 0, "start": "2019-11-22 06:44:03.484911", "stderr": "", "stderr_lines": [], "stdout": "nobody    4202  0.0  0.0  51580   384 ?        S    06:37   0:00 dnsmasq --interface t1s1_dnsif -z --dhcp-range=1.1.1.5,1.1.1.126", "stdout_lines": ["nobody    4202  0.0  0.0  51580   384 ?        S    06:37   0:00 dnsmasq --interface t1s1_dnsif -z --dhcp-range=1.1.1.5,1.1.1.126"]}
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.2.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.2.1', u'bridge_name': u't1br2', u'ns_name': u't1ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.2.2/24', u'tenant_ns_ip': u'10.1.2.1/24', u'tenant_ns_if': u't1ns2if', u'tenant_sub_if': u't1s2if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'2.2.2.0/24', u'vms': [{u'mem': 3, u'name': u't1_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br2if1', u'vmif': u't1VM3if1'}], u'vxlan': [{u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}, {u'dnsif': u't1s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s2_dnsbrif'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t1ns2\" ps aux | grep -w '[d]nsmasq --interface t1s2_dnsif -z --dhcp-range=2.2.2.5,2.2.2.254' ; if [ $? -ne 0 ] ; then ip netns exec \"t1ns2\" dnsmasq --interface \"t1s2_dnsif\" -z --dhcp-range=2.2.2.5,'2.2.2.254' ; fi\n", "delta": "0:00:00.046670", "end": "2019-11-22 06:44:03.774184", "item": [{"bridge_name": "t1br2", "default_route_ip": "10.1.2.1", "ns_name": "t1ns2", "route": [{"if": "p1", "ip": "10.1.2.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "2.2.2.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns2if", "tenant_ns_ip": "10.1.2.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s2if", "tenant_sub_ip": "10.1.2.2/24"}], "vms": [{"brif": "t1br2if1", "disk": "10G", "mem": 3, "name": "t1_VM3", "vcpu": 2, "vmif": "t1VM3if1"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, {"brif": "t1s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t1s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "rc": 0, "start": "2019-11-22 06:44:03.727514", "stderr": "", "stderr_lines": [], "stdout": "nobody    4232  0.0  0.0  51580   384 ?        S    06:37   0:00 dnsmasq --interface t1s2_dnsif -z --dhcp-range=2.2.2.5,2.2.2.254", "stdout_lines": ["nobody    4232  0.0  0.0  51580   384 ?        S    06:37   0:00 dnsmasq --interface t1s2_dnsif -z --dhcp-range=2.2.2.5,2.2.2.254"]}

TASK [Create VXLAN devices] *********************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.1.2/24', u'tenant_ns_ip': u'10.1.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't1_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM1if1'}, {u'mem': 4, u'name': u't1_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br1if2', u'vmif': u't1VM2if1'}]}, {u'local_ip': u'10.1.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.1.2', u'remote_route': u'10.2.1.0/24', u'subnet_route': u'10.1.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.2.1.2'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t1ns1\" ip link show \"vxlan_t1s1\" ; if [ $? -ne 0 ] ; then ip netns exec \"t1ns1\" ip link add \"vxlan_t1s1\" type vxlan id \"42\" local \"10.1.1.2\" remote \"10.2.1.2\" dstport \"4789\" dev \"t1s1if\"; ip netns exec \"t1ns1\" ip link set dev \"vxlan_t1s1\" up ; fi\n", "delta": "0:00:00.035364", "end": "2019-11-22 06:44:04.078114", "item": [{"bridge_name": "t1br1", "default_route_ip": "10.1.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.1.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.1.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.1.1.2/24"}], "vms": [{"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM1", "vcpu": 4, "vmif": "t1VM1if1"}, {"brif": "t1br1if2", "disk": "10G", "mem": 4, "name": "t1_VM2", "vcpu": 2, "vmif": "t1VM2if1"}]}, {"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.1.2", "remote_ip": "10.2.1.2", "remote_route": "10.2.1.0/24", "subnet_route": "10.1.1.0/24", "tenant_route_ip": "192.168.1.2", "v_name": "vxlan_t1s1"}], "rc": 0, "start": "2019-11-22 06:44:04.042750", "stderr": "", "stderr_lines": [], "stdout": "5: vxlan_t1s1: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1450 qdisc noqueue master t1br1 state UNKNOWN mode DEFAULT group default qlen 1000\n    link/ether 46:79:e2:aa:ba:f9 brd ff:ff:ff:ff:ff:ff", "stdout_lines": ["5: vxlan_t1s1: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1450 qdisc noqueue master t1br1 state UNKNOWN mode DEFAULT group default qlen 1000", "    link/ether 46:79:e2:aa:ba:f9 brd ff:ff:ff:ff:ff:ff"]}
skipping: [localhost] => (item=[{u'route': [{u'ip': u'10.1.2.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.2.1', u'bridge_name': u't1br2', u'dns': [{u'dnsif': u't1s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s2_dnsbrif'}], u'ns_name': u't1ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.2.2/24', u'tenant_ns_ip': u'10.1.2.1/24', u'tenant_ns_if': u't1ns2if', u'tenant_sub_if': u't1s2if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'2.2.2.0/24', u'vms': [{u'mem': 3, u'name': u't1_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br2if1', u'vmif': u't1VM3if1'}]}, {u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}])  => {"ansible_loop_var": "item", "changed": false, "item": [{"bridge_name": "t1br2", "default_route_ip": "10.1.2.1", "dns": [{"brif": "t1s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t1s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns2", "route": [{"if": "p1", "ip": "10.1.2.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "2.2.2.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns2if", "tenant_ns_ip": "10.1.2.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s2if", "tenant_sub_ip": "10.1.2.2/24"}], "vms": [{"brif": "t1br2if1", "disk": "10G", "mem": 3, "name": "t1_VM3", "vcpu": 2, "vmif": "t1VM3if1"}]}, {"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}], "skip_reason": "Conditional result was False"}

TASK [Attach VXLANs to bridge] ******************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.1.2/24', u'tenant_ns_ip': u'10.1.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't1_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM1if1'}, {u'mem': 4, u'name': u't1_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br1if2', u'vmif': u't1VM2if1'}]}, {u'local_ip': u'10.1.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.1.2', u'remote_route': u'10.2.1.0/24', u'subnet_route': u'10.1.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.2.1.2'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t1ns1\" brctl show \"t1br1\" | grep -w 'vxlan_t1s1' ; if [ $? -ne 0 ] ; then ip netns exec \"t1ns1\" brctl addif \"t1br1\" \"vxlan_t1s1\" ; fi\n", "delta": "0:00:00.035126", "end": "2019-11-22 06:44:04.390167", "item": [{"bridge_name": "t1br1", "default_route_ip": "10.1.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.1.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.1.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.1.1.2/24"}], "vms": [{"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM1", "vcpu": 4, "vmif": "t1VM1if1"}, {"brif": "t1br1if2", "disk": "10G", "mem": 4, "name": "t1_VM2", "vcpu": 2, "vmif": "t1VM2if1"}]}, {"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.1.2", "remote_ip": "10.2.1.2", "remote_route": "10.2.1.0/24", "subnet_route": "10.1.1.0/24", "tenant_route_ip": "192.168.1.2", "v_name": "vxlan_t1s1"}], "rc": 0, "start": "2019-11-22 06:44:04.355041", "stderr": "", "stderr_lines": [], "stdout": "\t\t\t\t\t\t\tvxlan_t1s1", "stdout_lines": ["\t\t\t\t\t\t\tvxlan_t1s1"]}
skipping: [localhost] => (item=[{u'route': [{u'ip': u'10.1.2.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.2.1', u'bridge_name': u't1br2', u'dns': [{u'dnsif': u't1s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s2_dnsbrif'}], u'ns_name': u't1ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.2.2/24', u'tenant_ns_ip': u'10.1.2.1/24', u'tenant_ns_if': u't1ns2if', u'tenant_sub_if': u't1s2if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'2.2.2.0/24', u'vms': [{u'mem': 3, u'name': u't1_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br2if1', u'vmif': u't1VM3if1'}]}, {u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}])  => {"ansible_loop_var": "item", "changed": false, "item": [{"bridge_name": "t1br2", "default_route_ip": "10.1.2.1", "dns": [{"brif": "t1s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t1s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns2", "route": [{"if": "p1", "ip": "10.1.2.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "2.2.2.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns2if", "tenant_ns_ip": "10.1.2.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s2if", "tenant_sub_ip": "10.1.2.2/24"}], "vms": [{"brif": "t1br2if1", "disk": "10G", "mem": 3, "name": "t1_VM3", "vcpu": 2, "vmif": "t1VM3if1"}]}, {"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}], "skip_reason": "Conditional result was False"}

PLAY RECAP **************************************************************************************************************************************************
localhost                  : ok=21   changed=19   unreachable=0    failed=0    skipped=0    rescued=0    ignored=0   

Using /etc/ansible/ansible.cfg as config file

PLAY [worker] ***********************************************************************************************************************************************

TASK [Create Tenant Namespace] ******************************************************************************************************************************
ok: [99.99.99.2] => (item={u'default_route_ip': u'192.168.129.1', u'name': u't1', u'pns_ip': u'192.168.129.1/24', u'tenant_if': u't1if', u'tenant_ip': u'192.168.129.2/24', u'pns_if': u't1pns_if'}) => {"ansible_loop_var": "item", "changed": false, "cmd": ["ip", "netns", "add", "t1"], "item": {"default_route_ip": "192.168.129.1", "name": "t1", "pns_if": "t1pns_if", "pns_ip": "192.168.129.1/24", "tenant_if": "t1if", "tenant_ip": "192.168.129.2/24"}, "rc": 0, "stdout": "skipped, since /var/run/netns/t1 exists", "stdout_lines": ["skipped, since /var/run/netns/t1 exists"]}

TASK [Create Subnet Namespace] ******************************************************************************************************************************
ok: [99.99.99.2] => (item={u'route': [{u'ip': u'10.2.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.2.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.1.2/24', u'tenant_ns_ip': u'10.2.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_ns_name': u't1', u'tenant_sub_if': u't1s1if'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't1_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM4if1'}], u'vxlan': [{u'local_ip': u'10.2.1.2', u'tenant_route_ip': u'192.168.129.2', u'dsport': 4789, u'dev': u't1s1if', u'subnet_route': u'10.2.1.0/24', u'remote_route': u'10.1.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.1.1.2'}]}) => {"ansible_loop_var": "item", "changed": false, "cmd": ["ip", "netns", "add", "t1ns1"], "item": {"bridge_name": "t1br1", "default_route_ip": "10.2.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.2.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.2.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.2.1.2/24"}], "vms": [{"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM4", "vcpu": 4, "vmif": "t1VM4if1"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.1.2", "remote_ip": "10.1.1.2", "remote_route": "10.1.1.0/24", "subnet_route": "10.2.1.0/24", "tenant_route_ip": "192.168.129.2", "v_name": "vxlan_t1s1"}]}, "rc": 0, "stdout": "skipped, since /var/run/netns/t1ns1 exists", "stdout_lines": ["skipped, since /var/run/netns/t1ns1 exists"]}

TASK [Create Tenant VETH pairs] *****************************************************************************************************************************
changed: [99.99.99.2] => (item={u'default_route_ip': u'192.168.129.1', u'name': u't1', u'pns_ip': u'192.168.129.1/24', u'tenant_if': u't1if', u'tenant_ip': u'192.168.129.2/24', u'pns_if': u't1pns_if'}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip link show \"t1if\" ; if [ $? -ne 0 ] ; then ip link add \"t1if\" type veth peer name \"t1pns_if\" ; fi\n", "delta": "0:00:00.004352", "end": "2019-11-22 06:44:06.961694", "item": {"default_route_ip": "192.168.129.1", "name": "t1", "pns_if": "t1pns_if", "pns_ip": "192.168.129.1/24", "tenant_if": "t1if", "tenant_ip": "192.168.129.2/24"}, "rc": 0, "start": "2019-11-22 06:44:06.957342", "stderr": "", "stderr_lines": [], "stdout": "21: t1if@t1pns_if: <BROADCAST,MULTICAST> mtu 1500 qdisc noop state DOWN mode DEFAULT group default qlen 1000\n    link/ether d2:c2:82:92:3e:7a brd ff:ff:ff:ff:ff:ff", "stdout_lines": ["21: t1if@t1pns_if: <BROADCAST,MULTICAST> mtu 1500 qdisc noop state DOWN mode DEFAULT group default qlen 1000", "    link/ether d2:c2:82:92:3e:7a brd ff:ff:ff:ff:ff:ff"]}

TASK [Attach Tenant VETH Pairs] *****************************************************************************************************************************
changed: [99.99.99.2] => (item={u'default_route_ip': u'192.168.129.1', u'name': u't1', u'pns_ip': u'192.168.129.1/24', u'tenant_if': u't1if', u'tenant_ip': u'192.168.129.2/24', u'pns_if': u't1pns_if'}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec pns ip link show \"t1pns_if\" ; if [ $? -ne 0 ] ; then ip link set \"t1pns_if\" netns pns ; fi\nip netns exec \"t1\" ip link show \"t1if\" ; if [ $? -ne 0 ] ; then ip link set \"t1if\" netns \"t1\" ; fi\nip netns exec pns ip link set dev \"t1pns_if\" up\nip netns exec \"t1\" ip link set dev \"t1if\" up\n", "delta": "0:00:00.139326", "end": "2019-11-22 06:44:07.476078", "item": {"default_route_ip": "192.168.129.1", "name": "t1", "pns_if": "t1pns_if", "pns_ip": "192.168.129.1/24", "tenant_if": "t1if", "tenant_ip": "192.168.129.2/24"}, "rc": 0, "start": "2019-11-22 06:44:07.336752", "stderr": "", "stderr_lines": [], "stdout": "14: t1pns_if@if15: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP mode DEFAULT group default qlen 1000\n    link/ether 16:c6:4d:5b:05:70 brd ff:ff:ff:ff:ff:ff link-netnsid 1\n15: t1if@if14: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP mode DEFAULT group default qlen 1000\n    link/ether 7a:ae:34:75:04:0b brd ff:ff:ff:ff:ff:ff link-netnsid 0", "stdout_lines": ["14: t1pns_if@if15: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP mode DEFAULT group default qlen 1000", "    link/ether 16:c6:4d:5b:05:70 brd ff:ff:ff:ff:ff:ff link-netnsid 1", "15: t1if@if14: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP mode DEFAULT group default qlen 1000", "    link/ether 7a:ae:34:75:04:0b brd ff:ff:ff:ff:ff:ff link-netnsid 0"]}

TASK [Add IP addresses to Tenant VETH Pairs] ****************************************************************************************************************
changed: [99.99.99.2] => (item={u'default_route_ip': u'192.168.129.1', u'name': u't1', u'pns_ip': u'192.168.129.1/24', u'tenant_if': u't1if', u'tenant_ip': u'192.168.129.2/24', u'pns_if': u't1pns_if'}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec pns ip addr show \"t1pns_if\" | awk 'FNR==3{ print $2 }' | grep -w '^192.168.129.1/24' ; if [ $? -ne 0 ] ; then ip netns exec pns ip addr add \"192.168.129.1/24\" dev \"t1pns_if\" ; fi\nip netns exec \"t1\" ip addr show \"t1if\" | awk 'FNR==3{ print $2 }' | grep -w '^192.168.129.2/24' ; if [ $? -ne 0 ] ; then ip netns exec \"t1\" ip addr add \"192.168.129.2/24\" dev \"t1if\" ; fi\n", "delta": "0:00:00.072221", "end": "2019-11-22 06:44:07.928268", "item": {"default_route_ip": "192.168.129.1", "name": "t1", "pns_if": "t1pns_if", "pns_ip": "192.168.129.1/24", "tenant_if": "t1if", "tenant_ip": "192.168.129.2/24"}, "rc": 0, "start": "2019-11-22 06:44:07.856047", "stderr": "", "stderr_lines": [], "stdout": "192.168.129.1/24\n192.168.129.2/24", "stdout_lines": ["192.168.129.1/24", "192.168.129.2/24"]}

TASK [Create Namespace VETH Pairs] **************************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.2.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't1_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM4if1'}], u'vxlan': [{u'local_ip': u'10.2.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.129.2', u'remote_route': u'10.1.1.0/24', u'subnet_route': u'10.2.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.1.1.2'}]}, {u'tenant_sub_ip': u'10.2.1.2/24', u'tenant_ns_ip': u'10.2.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip link show \"t1ns1if\" ; if [ $? -ne 0 ] ; then ip link add \"t1ns1if\" type veth peer name \"t1s1if\" ; fi\n", "delta": "0:00:00.004500", "end": "2019-11-22 06:44:08.330370", "item": [{"bridge_name": "t1br1", "default_route_ip": "10.2.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.2.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "vms": [{"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM4", "vcpu": 4, "vmif": "t1VM4if1"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.1.2", "remote_ip": "10.1.1.2", "remote_route": "10.1.1.0/24", "subnet_route": "10.2.1.0/24", "tenant_route_ip": "192.168.129.2", "v_name": "vxlan_t1s1"}]}, {"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.2.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.2.1.2/24"}], "rc": 0, "start": "2019-11-22 06:44:08.325870", "stderr": "", "stderr_lines": [], "stdout": "23: t1ns1if@t1s1if: <BROADCAST,MULTICAST> mtu 1500 qdisc noop state DOWN mode DEFAULT group default qlen 1000\n    link/ether de:69:54:59:68:26 brd ff:ff:ff:ff:ff:ff", "stdout_lines": ["23: t1ns1if@t1s1if: <BROADCAST,MULTICAST> mtu 1500 qdisc noop state DOWN mode DEFAULT group default qlen 1000", "    link/ether de:69:54:59:68:26 brd ff:ff:ff:ff:ff:ff"]}

TASK [Attach Namespace VETH Pairs] **************************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.2.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't1_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM4if1'}], u'vxlan': [{u'local_ip': u'10.2.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.129.2', u'remote_route': u'10.1.1.0/24', u'subnet_route': u'10.2.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.1.1.2'}]}, {u'tenant_sub_ip': u'10.2.1.2/24', u'tenant_ns_ip': u'10.2.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t1\" ip link show \"t1ns1if\" ; if [ $? -ne 0 ] ; then ip link set \"t1ns1if\" netns \"t1\" ; fi\nip netns exec \"t1ns1\" ip link show \"t1s1if\" ; if [ $? -ne 0 ] ; then ip link set \"t1s1if\" netns \"t1ns1\" ; fi\n", "delta": "0:00:00.075612", "end": "2019-11-22 06:44:08.784105", "item": [{"bridge_name": "t1br1", "default_route_ip": "10.2.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.2.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "vms": [{"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM4", "vcpu": 4, "vmif": "t1VM4if1"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.1.2", "remote_ip": "10.1.1.2", "remote_route": "10.1.1.0/24", "subnet_route": "10.2.1.0/24", "tenant_route_ip": "192.168.129.2", "v_name": "vxlan_t1s1"}]}, {"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.2.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.2.1.2/24"}], "rc": 0, "start": "2019-11-22 06:44:08.708493", "stderr": "", "stderr_lines": [], "stdout": "17: t1ns1if@if16: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP mode DEFAULT group default qlen 1000\n    link/ether 86:3e:e9:9f:62:e0 brd ff:ff:ff:ff:ff:ff link-netnsid 2\n16: t1s1if@if17: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP mode DEFAULT group default qlen 1000\n    link/ether f2:0b:c2:ed:23:c1 brd ff:ff:ff:ff:ff:ff link-netnsid 0", "stdout_lines": ["17: t1ns1if@if16: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP mode DEFAULT group default qlen 1000", "    link/ether 86:3e:e9:9f:62:e0 brd ff:ff:ff:ff:ff:ff link-netnsid 2", "16: t1s1if@if17: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP mode DEFAULT group default qlen 1000", "    link/ether f2:0b:c2:ed:23:c1 brd ff:ff:ff:ff:ff:ff link-netnsid 0"]}

TASK [Set Namespace VETH Pairs UP] **************************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.2.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't1_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM4if1'}], u'vxlan': [{u'local_ip': u'10.2.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.129.2', u'remote_route': u'10.1.1.0/24', u'subnet_route': u'10.2.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.1.1.2'}]}, {u'tenant_sub_ip': u'10.2.1.2/24', u'tenant_ns_ip': u'10.2.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t1\" ip link set dev \"t1ns1if\" up\nip netns exec \"t1ns1\" ip link set dev \"t1s1if\" up\n", "delta": "0:00:00.084871", "end": "2019-11-22 06:44:09.248067", "item": [{"bridge_name": "t1br1", "default_route_ip": "10.2.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.2.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "vms": [{"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM4", "vcpu": 4, "vmif": "t1VM4if1"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.1.2", "remote_ip": "10.1.1.2", "remote_route": "10.1.1.0/24", "subnet_route": "10.2.1.0/24", "tenant_route_ip": "192.168.129.2", "v_name": "vxlan_t1s1"}]}, {"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.2.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.2.1.2/24"}], "rc": 0, "start": "2019-11-22 06:44:09.163196", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Add IP addresses to Namespace VETH Pairs] *************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.2.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't1_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM4if1'}], u'vxlan': [{u'local_ip': u'10.2.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.129.2', u'remote_route': u'10.1.1.0/24', u'subnet_route': u'10.2.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.1.1.2'}]}, {u'tenant_sub_ip': u'10.2.1.2/24', u'tenant_ns_ip': u'10.2.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t1ns1\" ip addr show \"t1s1if\" | awk 'FNR==3{ print $2 }' | grep -w '^10.2.1.2/24' ; if [ $? -ne 0 ] ; then ip netns exec \"t1ns1\" ip addr add \"10.2.1.2/24\" dev \"t1s1if\" ; fi\n\nip netns exec \"t1\" ip addr show \"t1ns1if\" | awk 'FNR==3{ print $2 }' | grep -w '^10.2.1.1/24' ; if [ $? -ne 0 ] ; then ip netns exec \"t1\" ip addr add \"10.2.1.1/24\" dev \"t1ns1if\" ; fi\n", "delta": "0:00:00.072412", "end": "2019-11-22 06:44:09.692223", "item": [{"bridge_name": "t1br1", "default_route_ip": "10.2.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.2.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "vms": [{"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM4", "vcpu": 4, "vmif": "t1VM4if1"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.1.2", "remote_ip": "10.1.1.2", "remote_route": "10.1.1.0/24", "subnet_route": "10.2.1.0/24", "tenant_route_ip": "192.168.129.2", "v_name": "vxlan_t1s1"}]}, {"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.2.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.2.1.2/24"}], "rc": 0, "start": "2019-11-22 06:44:09.619811", "stderr": "", "stderr_lines": [], "stdout": "10.2.1.2/24\n10.2.1.1/24", "stdout_lines": ["10.2.1.2/24", "10.2.1.1/24"]}

TASK [Add IP Route to Tenant] *******************************************************************************************************************************
changed: [99.99.99.2] => (item={u'default_route_ip': u'192.168.129.1', u'name': u't1', u'pns_ip': u'192.168.129.1/24', u'tenant_if': u't1if', u'tenant_ip': u'192.168.129.2/24', u'pns_if': u't1pns_if'}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t1\" ip route show default | grep -w '[d]efault via 192.168.129.1' ; if [ $? -ne 0 ] ; then ip netns exec \"t1\" ip route add default via \"192.168.129.1\" ; fi\n", "delta": "0:00:00.036572", "end": "2019-11-22 06:44:10.116138", "item": {"default_route_ip": "192.168.129.1", "name": "t1", "pns_if": "t1pns_if", "pns_ip": "192.168.129.1/24", "tenant_if": "t1if", "tenant_ip": "192.168.129.2/24"}, "rc": 0, "start": "2019-11-22 06:44:10.079566", "stderr": "", "stderr_lines": [], "stdout": "default via 192.168.129.1 dev t1if ", "stdout_lines": ["default via 192.168.129.1 dev t1if "]}

TASK [Add IP Route to Tenant Subnet] ************************************************************************************************************************
changed: [99.99.99.2] => (item={u'route': [{u'ip': u'10.2.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.2.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.1.2/24', u'tenant_ns_ip': u'10.2.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_ns_name': u't1', u'tenant_sub_if': u't1s1if'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't1_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM4if1'}], u'vxlan': [{u'local_ip': u'10.2.1.2', u'tenant_route_ip': u'192.168.129.2', u'dsport': 4789, u'dev': u't1s1if', u'subnet_route': u'10.2.1.0/24', u'remote_route': u'10.1.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.1.1.2'}]}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t1ns1\" ip route show default | grep -w '[d]efault via 10.2.1.1' ; if [ $? -ne 0 ] ; then ip netns exec \"t1ns1\" ip route add default via \"10.2.1.1\" ; fi\n", "delta": "0:00:00.045909", "end": "2019-11-22 06:44:10.560014", "item": {"bridge_name": "t1br1", "default_route_ip": "10.2.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.2.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.2.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.2.1.2/24"}], "vms": [{"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM4", "vcpu": 4, "vmif": "t1VM4if1"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.1.2", "remote_ip": "10.1.1.2", "remote_route": "10.1.1.0/24", "subnet_route": "10.2.1.0/24", "tenant_route_ip": "192.168.129.2", "v_name": "vxlan_t1s1"}]}, "rc": 0, "start": "2019-11-22 06:44:10.514105", "stderr": "", "stderr_lines": [], "stdout": "default via 10.2.1.1 dev t1s1if ", "stdout_lines": ["default via 10.2.1.1 dev t1s1if "]}

TASK [Create bridge inside namespace] ***********************************************************************************************************************
changed: [99.99.99.2] => (item={u'route': [{u'ip': u'10.2.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.2.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.1.2/24', u'tenant_ns_ip': u'10.2.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_ns_name': u't1', u'tenant_sub_if': u't1s1if'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't1_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM4if1'}], u'vxlan': [{u'local_ip': u'10.2.1.2', u'tenant_route_ip': u'192.168.129.2', u'dsport': 4789, u'dev': u't1s1if', u'subnet_route': u'10.2.1.0/24', u'remote_route': u'10.1.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.1.1.2'}]}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t1ns1\" brctl show | grep -w '^t1br1'; if [ $? -ne 0 ] ; then ip netns exec \"t1ns1\" brctl addbr \"t1br1\" ; fi\nip netns exec \"t1ns1\" ip link set dev \"t1br1\" up\n", "delta": "0:00:00.072020", "end": "2019-11-22 06:44:11.032047", "item": {"bridge_name": "t1br1", "default_route_ip": "10.2.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.2.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.2.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.2.1.2/24"}], "vms": [{"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM4", "vcpu": 4, "vmif": "t1VM4if1"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.1.2", "remote_ip": "10.1.1.2", "remote_route": "10.1.1.0/24", "subnet_route": "10.2.1.0/24", "tenant_route_ip": "192.168.129.2", "v_name": "vxlan_t1s1"}]}, "rc": 0, "start": "2019-11-22 06:44:10.960027", "stderr": "", "stderr_lines": [], "stdout": "t1br1\t\t8000.2e54d50069fa\tno\t\tt1br1if1", "stdout_lines": ["t1br1\t\t8000.2e54d50069fa\tno\t\tt1br1if1"]}

TASK [Create DNS VETH Pair] *********************************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.2.1.1', u'bridge_name': u't1br1', u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.1.2/24', u'tenant_ns_ip': u'10.2.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't1_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM4if1'}], u'vxlan': [{u'local_ip': u'10.2.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.129.2', u'remote_route': u'10.1.1.0/24', u'subnet_route': u'10.2.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.1.1.2'}]}, {u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t1ns1\" ip link show \"t1s1_dnsbrif\" ; if [ $? -ne 0 ] ; then ip netns exec \"t1ns1\" ip link add \"t1s1_dnsbrif\" type veth peer name \"t1s1_dnsif\" ; fi\nip netns exec \"t1ns1\" ip link set dev \"t1s1_dnsbrif\" up\nip netns exec \"t1ns1\" ip link set dev \"t1s1_dnsif\" up\n", "delta": "0:00:00.106376", "end": "2019-11-22 06:44:11.531971", "item": [{"bridge_name": "t1br1", "default_route_ip": "10.2.1.1", "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.2.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.2.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.2.1.2/24"}], "vms": [{"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM4", "vcpu": 4, "vmif": "t1VM4if1"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.1.2", "remote_ip": "10.1.1.2", "remote_route": "10.1.1.0/24", "subnet_route": "10.2.1.0/24", "tenant_route_ip": "192.168.129.2", "v_name": "vxlan_t1s1"}]}, {"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "rc": 0, "start": "2019-11-22 06:44:11.425595", "stderr": "", "stderr_lines": [], "stdout": "4: t1s1_dnsbrif@t1s1_dnsif: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue master t1br1 state UP mode DEFAULT group default qlen 1000\n    link/ether da:e7:a3:29:98:06 brd ff:ff:ff:ff:ff:ff", "stdout_lines": ["4: t1s1_dnsbrif@t1s1_dnsif: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue master t1br1 state UP mode DEFAULT group default qlen 1000", "    link/ether da:e7:a3:29:98:06 brd ff:ff:ff:ff:ff:ff"]}

TASK [Attach DNS VETH Pair] *********************************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.2.1.1', u'bridge_name': u't1br1', u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.1.2/24', u'tenant_ns_ip': u'10.2.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't1_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM4if1'}], u'vxlan': [{u'local_ip': u'10.2.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.129.2', u'remote_route': u'10.1.1.0/24', u'subnet_route': u'10.2.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.1.1.2'}]}, {u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t1ns1\" brctl show \"t1br1\" | grep -w 't1s1_dnsbrif' ; if [ $? -ne 0 ] ; then ip netns exec \"t1ns1\" brctl addif \"t1br1\" \"t1s1_dnsbrif\" ; fi\n", "delta": "0:00:00.035878", "end": "2019-11-22 06:44:11.944022", "item": [{"bridge_name": "t1br1", "default_route_ip": "10.2.1.1", "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.2.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.2.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.2.1.2/24"}], "vms": [{"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM4", "vcpu": 4, "vmif": "t1VM4if1"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.1.2", "remote_ip": "10.1.1.2", "remote_route": "10.1.1.0/24", "subnet_route": "10.2.1.0/24", "tenant_route_ip": "192.168.129.2", "v_name": "vxlan_t1s1"}]}, {"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "rc": 0, "start": "2019-11-22 06:44:11.908144", "stderr": "", "stderr_lines": [], "stdout": "\t\t\t\t\t\t\tt1s1_dnsbrif", "stdout_lines": ["\t\t\t\t\t\t\tt1s1_dnsbrif"]}

TASK [Create VETH Pairs] ************************************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.2.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.1.2/24', u'tenant_ns_ip': u'10.2.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.2.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.129.2', u'remote_route': u'10.1.1.0/24', u'subnet_route': u'10.2.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.1.1.2'}]}, {u'mem': 2, u'name': u't1_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM4if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip link show \"t1br1if1\" ; if [ $? -ne 0 ] ; then ip link add \"t1VM4if1\" type veth peer name \"t1br1if1\" ; fi\nip link set dev \"t1br1if1\" up\nip link set dev \"t1VM4if1\" up\n", "delta": "0:00:00.014327", "end": "2019-11-22 06:44:12.346936", "item": [{"bridge_name": "t1br1", "default_route_ip": "10.2.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.2.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.2.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.2.1.2/24"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.1.2", "remote_ip": "10.1.1.2", "remote_route": "10.1.1.0/24", "subnet_route": "10.2.1.0/24", "tenant_route_ip": "192.168.129.2", "v_name": "vxlan_t1s1"}]}, {"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM4", "vcpu": 4, "vmif": "t1VM4if1"}], "rc": 0, "start": "2019-11-22 06:44:12.332609", "stderr": "Device \"t1br1if1\" does not exist.\nRTNETLINK answers: File exists\nCannot find device \"t1br1if1\"", "stderr_lines": ["Device \"t1br1if1\" does not exist.", "RTNETLINK answers: File exists", "Cannot find device \"t1br1if1\""], "stdout": "", "stdout_lines": []}

TASK [Attach VETH Pairs] ************************************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.2.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.1.2/24', u'tenant_ns_ip': u'10.2.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.2.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.129.2', u'remote_route': u'10.1.1.0/24', u'subnet_route': u'10.2.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.1.1.2'}]}, {u'mem': 2, u'name': u't1_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM4if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip link show \"t1br1if1\" ; if [ $? -eq 0 ] ; then ip link set \"t1br1if1\" netns \"t1ns1\" ; fi\nip netns exec \"t1ns1\" brctl show \"t1br1\" | grep -w 't1br1if1' ; if [ $? -ne 0 ] ; then ip netns exec \"t1ns1\" brctl addif \"t1br1\" \"t1br1if1\" ; fi\n", "delta": "0:00:00.048162", "end": "2019-11-22 06:44:12.780129", "item": [{"bridge_name": "t1br1", "default_route_ip": "10.2.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.2.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.2.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.2.1.2/24"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.1.2", "remote_ip": "10.1.1.2", "remote_route": "10.1.1.0/24", "subnet_route": "10.2.1.0/24", "tenant_route_ip": "192.168.129.2", "v_name": "vxlan_t1s1"}]}, {"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM4", "vcpu": 4, "vmif": "t1VM4if1"}], "rc": 0, "start": "2019-11-22 06:44:12.731967", "stderr": "Device \"t1br1if1\" does not exist.", "stderr_lines": ["Device \"t1br1if1\" does not exist."], "stdout": "t1br1\t\t8000.2e54d50069fa\tno\t\tt1br1if1", "stdout_lines": ["t1br1\t\t8000.2e54d50069fa\tno\t\tt1br1if1"]}

TASK [All interfaces and bridges UP] ************************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.2.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.1.2/24', u'tenant_ns_ip': u'10.2.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.2.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.129.2', u'remote_route': u'10.1.1.0/24', u'subnet_route': u'10.2.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.1.1.2'}]}, {u'mem': 2, u'name': u't1_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM4if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t1ns1\" ip link set \"t1br1if1\" up\nip netns exec \"t1ns1\" ip link set dev \"t1br1\" up\n", "delta": "0:00:00.068161", "end": "2019-11-22 06:44:13.236060", "item": [{"bridge_name": "t1br1", "default_route_ip": "10.2.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.2.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.2.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.2.1.2/24"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.1.2", "remote_ip": "10.1.1.2", "remote_route": "10.1.1.0/24", "subnet_route": "10.2.1.0/24", "tenant_route_ip": "192.168.129.2", "v_name": "vxlan_t1s1"}]}, {"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM4", "vcpu": 4, "vmif": "t1VM4if1"}], "rc": 0, "start": "2019-11-22 06:44:13.167899", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Add IP to DNS Interface] ******************************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.2.1.1', u'bridge_name': u't1br1', u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.1.2/24', u'tenant_ns_ip': u'10.2.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't1_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM4if1'}], u'vxlan': [{u'local_ip': u'10.2.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.129.2', u'remote_route': u'10.1.1.0/24', u'subnet_route': u'10.2.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.1.1.2'}]}, {u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t1ns1\" ip addr show \"t1s1_dnsif\" | awk 'FNR==3{ print $2}'| grep -w '^1.1.1.128/24' ; if [ $? -ne 0 ] ; then ip netns exec \"t1ns1\" ip addr add \"1.1.1.128/24\" dev \"t1s1_dnsif\" ; fi\n", "delta": "0:00:00.042428", "end": "2019-11-22 06:44:13.676331", "item": [{"bridge_name": "t1br1", "default_route_ip": "10.2.1.1", "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.2.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.2.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.2.1.2/24"}], "vms": [{"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM4", "vcpu": 4, "vmif": "t1VM4if1"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.1.2", "remote_ip": "10.1.1.2", "remote_route": "10.1.1.0/24", "subnet_route": "10.2.1.0/24", "tenant_route_ip": "192.168.129.2", "v_name": "vxlan_t1s1"}]}, {"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "rc": 0, "start": "2019-11-22 06:44:13.633903", "stderr": "", "stderr_lines": [], "stdout": "1.1.1.128/24", "stdout_lines": ["1.1.1.128/24"]}

TASK [Install DHCP Server] **********************************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.2.1.1', u'bridge_name': u't1br1', u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.1.2/24', u'tenant_ns_ip': u'10.2.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't1_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM4if1'}], u'vxlan': [{u'local_ip': u'10.2.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.129.2', u'remote_route': u'10.1.1.0/24', u'subnet_route': u'10.2.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.1.1.2'}]}, {u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t1ns1\" ps aux | grep -w '[d]nsmasq --interface t1s1_dnsif -z --dhcp-range=1.1.1.133,1.1.1.254' ; if [ $? -ne 0 ] ; then ip netns exec \"t1ns1\" dnsmasq --interface \"t1s1_dnsif\" -z --dhcp-range=1.1.1.133,'1.1.1.254' ; fi\n", "delta": "0:00:00.040537", "end": "2019-11-22 06:44:14.112019", "item": [{"bridge_name": "t1br1", "default_route_ip": "10.2.1.1", "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.2.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.2.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.2.1.2/24"}], "vms": [{"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM4", "vcpu": 4, "vmif": "t1VM4if1"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.1.2", "remote_ip": "10.1.1.2", "remote_route": "10.1.1.0/24", "subnet_route": "10.2.1.0/24", "tenant_route_ip": "192.168.129.2", "v_name": "vxlan_t1s1"}]}, {"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "rc": 0, "start": "2019-11-22 06:44:14.071482", "stderr": "", "stderr_lines": [], "stdout": "nobody    3348  0.0  0.0  51580   384 ?        S    06:37   0:00 dnsmasq --interface t1s1_dnsif -z --dhcp-range=1.1.1.133,1.1.1.254", "stdout_lines": ["nobody    3348  0.0  0.0  51580   384 ?        S    06:37   0:00 dnsmasq --interface t1s1_dnsif -z --dhcp-range=1.1.1.133,1.1.1.254"]}

TASK [Create VXLAN devices] *********************************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.2.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.1.2/24', u'tenant_ns_ip': u'10.2.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't1_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM4if1'}]}, {u'local_ip': u'10.2.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.129.2', u'remote_route': u'10.1.1.0/24', u'subnet_route': u'10.2.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.1.1.2'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t1ns1\" ip link show \"vxlan_t1s1\" ; if [ $? -ne 0 ] ; then ip netns exec \"t1ns1\" ip link add \"vxlan_t1s1\" type vxlan id \"42\" local \"10.2.1.2\" remote \"10.1.1.2\" dstport \"4789\" dev \"t1s1if\" ; ip netns exec \"t1ns1\" ip link set dev \"vxlan_t1s1\" up ; fi\n", "delta": "0:00:00.034094", "end": "2019-11-22 06:44:14.556050", "item": [{"bridge_name": "t1br1", "default_route_ip": "10.2.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.2.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.2.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.2.1.2/24"}], "vms": [{"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM4", "vcpu": 4, "vmif": "t1VM4if1"}]}, {"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.1.2", "remote_ip": "10.1.1.2", "remote_route": "10.1.1.0/24", "subnet_route": "10.2.1.0/24", "tenant_route_ip": "192.168.129.2", "v_name": "vxlan_t1s1"}], "rc": 0, "start": "2019-11-22 06:44:14.521956", "stderr": "", "stderr_lines": [], "stdout": "5: vxlan_t1s1: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1450 qdisc noqueue master t1br1 state UNKNOWN mode DEFAULT group default qlen 1000\n    link/ether c6:b5:67:f5:8d:0c brd ff:ff:ff:ff:ff:ff", "stdout_lines": ["5: vxlan_t1s1: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1450 qdisc noqueue master t1br1 state UNKNOWN mode DEFAULT group default qlen 1000", "    link/ether c6:b5:67:f5:8d:0c brd ff:ff:ff:ff:ff:ff"]}

TASK [Attach VXLANs to bridge] ******************************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.2.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.1.2/24', u'tenant_ns_ip': u'10.2.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't1_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM4if1'}]}, {u'local_ip': u'10.2.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.129.2', u'remote_route': u'10.1.1.0/24', u'subnet_route': u'10.2.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.1.1.2'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t1ns1\" brctl show \"t1br1\" | grep -w 'vxlan_t1s1' ; if [ $? -ne 0 ] ; then ip netns exec \"t1ns1\" brctl addif \"t1br1\" \"vxlan_t1s1\" ; fi\n", "delta": "0:00:00.048885", "end": "2019-11-22 06:44:15.012087", "item": [{"bridge_name": "t1br1", "default_route_ip": "10.2.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.2.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.2.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.2.1.2/24"}], "vms": [{"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM4", "vcpu": 4, "vmif": "t1VM4if1"}]}, {"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.1.2", "remote_ip": "10.1.1.2", "remote_route": "10.1.1.0/24", "subnet_route": "10.2.1.0/24", "tenant_route_ip": "192.168.129.2", "v_name": "vxlan_t1s1"}], "rc": 0, "start": "2019-11-22 06:44:14.963202", "stderr": "", "stderr_lines": [], "stdout": "\t\t\t\t\t\t\tvxlan_t1s1", "stdout_lines": ["\t\t\t\t\t\t\tvxlan_t1s1"]}

PLAY RECAP **************************************************************************************************************************************************
99.99.99.2                 : ok=21   changed=19   unreachable=0    failed=0    skipped=0    rescued=0    ignored=0   

Using /etc/ansible/ansible.cfg as config file

PLAY [main] *************************************************************************************************************************************************

TASK [Add VXLAN routes in PNS] ******************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.1.2/24', u'tenant_ns_ip': u'10.1.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't1_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM1if1'}, {u'mem': 4, u'name': u't1_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br1if2', u'vmif': u't1VM2if1'}]}, {u'local_ip': u'10.1.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.1.2', u'remote_route': u'10.2.1.0/24', u'subnet_route': u'10.1.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.2.1.2'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec pns ip route show \"10.1.1.0/24\" via \"192.168.1.2\" | grep -w '^10.1.1.0/24' ; if [ $? -ne 0 ] ; then ip netns exec pns ip route add \"10.1.1.0/24\" via \"192.168.1.2\" ; fi\n", "delta": "0:00:00.037233", "end": "2019-11-22 06:44:16.158460", "item": [{"bridge_name": "t1br1", "default_route_ip": "10.1.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.1.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.1.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.1.1.2/24"}], "vms": [{"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM1", "vcpu": 4, "vmif": "t1VM1if1"}, {"brif": "t1br1if2", "disk": "10G", "mem": 4, "name": "t1_VM2", "vcpu": 2, "vmif": "t1VM2if1"}]}, {"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.1.2", "remote_ip": "10.2.1.2", "remote_route": "10.2.1.0/24", "subnet_route": "10.1.1.0/24", "tenant_route_ip": "192.168.1.2", "v_name": "vxlan_t1s1"}], "rc": 0, "start": "2019-11-22 06:44:16.121227", "stderr": "", "stderr_lines": [], "stdout": "10.1.1.0/24 dev t1pns_if ", "stdout_lines": ["10.1.1.0/24 dev t1pns_if "]}
skipping: [localhost] => (item=[{u'route': [{u'ip': u'10.1.2.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.2.1', u'bridge_name': u't1br2', u'dns': [{u'dnsif': u't1s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s2_dnsbrif'}], u'ns_name': u't1ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.2.2/24', u'tenant_ns_ip': u'10.1.2.1/24', u'tenant_ns_if': u't1ns2if', u'tenant_sub_if': u't1s2if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'2.2.2.0/24', u'vms': [{u'mem': 3, u'name': u't1_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br2if1', u'vmif': u't1VM3if1'}]}, {u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}])  => {"ansible_loop_var": "item", "changed": false, "item": [{"bridge_name": "t1br2", "default_route_ip": "10.1.2.1", "dns": [{"brif": "t1s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t1s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns2", "route": [{"if": "p1", "ip": "10.1.2.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "2.2.2.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns2if", "tenant_ns_ip": "10.1.2.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s2if", "tenant_sub_ip": "10.1.2.2/24"}], "vms": [{"brif": "t1br2if1", "disk": "10G", "mem": 3, "name": "t1_VM3", "vcpu": 2, "vmif": "t1VM3if1"}]}, {"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}], "skip_reason": "Conditional result was False"}

TASK [Get PNS ip address] ***********************************************************************************************************************************
ok: [localhost] => {"changed": false, "cmd": "ip netns exec pns ip addr show p1 | awk 'FNR==3{ print $2 }' | awk -F/ '{ print $1 }'\n", "delta": "0:00:00.058990", "end": "2019-11-22 06:44:16.502740", "rc": 0, "start": "2019-11-22 06:44:16.443750", "stderr": "", "stderr_lines": [], "stdout": "192.168.100.238", "stdout_lines": ["192.168.100.238"]}

TASK [Add VXLAN routes to host] *****************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.1.2/24', u'tenant_ns_ip': u'10.1.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't1_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM1if1'}, {u'mem': 4, u'name': u't1_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br1if2', u'vmif': u't1VM2if1'}]}, {u'local_ip': u'10.1.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.1.2', u'remote_route': u'10.2.1.0/24', u'subnet_route': u'10.1.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.2.1.2'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip route show \"10.1.1.0/24\" via \"192.168.100.238\" | grep -w '^10.1.1.0/24' ; if [ $? -ne 0 ] ; then ip route add \"10.1.1.0/24\" via \"192.168.100.238\" ; fi\nip route show \"10.2.1.0/24\" via 99.99.99.2 | grep -w '^10.2.1.0/24'; if [ $? -ne 0 ] ; then ip route add \"10.2.1.0/24\" via 99.99.99.2 ; fi\n", "delta": "0:00:00.005588", "end": "2019-11-22 06:44:16.810134", "item": [{"bridge_name": "t1br1", "default_route_ip": "10.1.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.1.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.1.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.1.1.2/24"}], "vms": [{"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM1", "vcpu": 4, "vmif": "t1VM1if1"}, {"brif": "t1br1if2", "disk": "10G", "mem": 4, "name": "t1_VM2", "vcpu": 2, "vmif": "t1VM2if1"}]}, {"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.1.2", "remote_ip": "10.2.1.2", "remote_route": "10.2.1.0/24", "subnet_route": "10.1.1.0/24", "tenant_route_ip": "192.168.1.2", "v_name": "vxlan_t1s1"}], "rc": 0, "start": "2019-11-22 06:44:16.804546", "stderr": "", "stderr_lines": [], "stdout": "10.1.1.0/24 dev testBR \n10.2.1.0/24 dev ens4 ", "stdout_lines": ["10.1.1.0/24 dev testBR ", "10.2.1.0/24 dev ens4 "]}
skipping: [localhost] => (item=[{u'route': [{u'ip': u'10.1.2.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.2.1', u'bridge_name': u't1br2', u'dns': [{u'dnsif': u't1s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s2_dnsbrif'}], u'ns_name': u't1ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.2.2/24', u'tenant_ns_ip': u'10.1.2.1/24', u'tenant_ns_if': u't1ns2if', u'tenant_sub_if': u't1s2if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'2.2.2.0/24', u'vms': [{u'mem': 3, u'name': u't1_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br2if1', u'vmif': u't1VM3if1'}]}, {u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}])  => {"ansible_loop_var": "item", "changed": false, "item": [{"bridge_name": "t1br2", "default_route_ip": "10.1.2.1", "dns": [{"brif": "t1s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t1s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns2", "route": [{"if": "p1", "ip": "10.1.2.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "2.2.2.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns2if", "tenant_ns_ip": "10.1.2.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s2if", "tenant_sub_ip": "10.1.2.2/24"}], "vms": [{"brif": "t1br2if1", "disk": "10G", "mem": 3, "name": "t1_VM3", "vcpu": 2, "vmif": "t1VM3if1"}]}, {"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}], "skip_reason": "Conditional result was False"}

PLAY RECAP **************************************************************************************************************************************************
localhost                  : ok=3    changed=2    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0   

Using /etc/ansible/ansible.cfg as config file

PLAY [worker] ***********************************************************************************************************************************************

TASK [Add VXLAN routes in PNS] ******************************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.2.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.1.2/24', u'tenant_ns_ip': u'10.2.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't1_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM4if1'}]}, {u'local_ip': u'10.2.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.129.2', u'remote_route': u'10.1.1.0/24', u'subnet_route': u'10.2.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.1.1.2'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec pns ip route show \"10.2.1.0/24\" via \"192.168.129.2\" | grep -w '^10.2.1.0/24' ; if [ $? -ne 0 ] ; then ip netns exec pns ip route add \"10.2.1.0/24\" via \"192.168.129.2\" ; fi\n", "delta": "0:00:00.033209", "end": "2019-11-22 06:44:18.020044", "item": [{"bridge_name": "t1br1", "default_route_ip": "10.2.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.2.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.2.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.2.1.2/24"}], "vms": [{"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM4", "vcpu": 4, "vmif": "t1VM4if1"}]}, {"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.1.2", "remote_ip": "10.1.1.2", "remote_route": "10.1.1.0/24", "subnet_route": "10.2.1.0/24", "tenant_route_ip": "192.168.129.2", "v_name": "vxlan_t1s1"}], "rc": 0, "start": "2019-11-22 06:44:17.986835", "stderr": "", "stderr_lines": [], "stdout": "10.2.1.0/24 dev t1pns_if ", "stdout_lines": ["10.2.1.0/24 dev t1pns_if "]}

TASK [Get PNS ip address] ***********************************************************************************************************************************
ok: [99.99.99.2] => {"changed": false, "cmd": "ip netns exec pns ip addr show p1 | awk 'FNR==3{ print $2 }' | awk -F/ '{ print $1 }'\n", "delta": "0:00:00.036902", "end": "2019-11-22 06:44:18.444415", "rc": 0, "start": "2019-11-22 06:44:18.407513", "stderr": "", "stderr_lines": [], "stdout": "192.168.100.50", "stdout_lines": ["192.168.100.50"]}

TASK [Add VXLAN routes to host] *****************************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.2.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.1.2/24', u'tenant_ns_ip': u'10.2.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't1_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM4if1'}]}, {u'local_ip': u'10.2.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.129.2', u'remote_route': u'10.1.1.0/24', u'subnet_route': u'10.2.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.1.1.2'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip route show \"10.2.1.0/24\" via \"192.168.100.50\" | grep -w '^10.2.1.0/24' ; if [ $? -ne 0 ] ; then ip route add \"10.2.1.0/24\" via \"192.168.100.50\" ; fi\nip route show \"10.1.1.0/24\" via 99.99.99.1 | grep -w '^10.1.1.0/24'; if [ $? -ne 0 ] ; then ip route add \"10.1.1.0/24\" via 99.99.99.1 ; fi\n", "delta": "0:00:00.005827", "end": "2019-11-22 06:44:18.882988", "item": [{"bridge_name": "t1br1", "default_route_ip": "10.2.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.2.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.2.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.2.1.2/24"}], "vms": [{"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM4", "vcpu": 4, "vmif": "t1VM4if1"}]}, {"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.1.2", "remote_ip": "10.1.1.2", "remote_route": "10.1.1.0/24", "subnet_route": "10.2.1.0/24", "tenant_route_ip": "192.168.129.2", "v_name": "vxlan_t1s1"}], "rc": 0, "start": "2019-11-22 06:44:18.877161", "stderr": "", "stderr_lines": [], "stdout": "10.2.1.0/24 dev testBR \n10.1.1.0/24 dev ens4 ", "stdout_lines": ["10.2.1.0/24 dev testBR ", "10.1.1.0/24 dev ens4 "]}

PLAY RECAP **************************************************************************************************************************************************
99.99.99.2                 : ok=3    changed=2    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0   

Using /etc/ansible/ansible.cfg as config file

PLAY [main] *************************************************************************************************************************************************

TASK [Create VM templates (C1)] *****************************************************************************************************************************
ok: [localhost] => (item=[{u'route': [{u'ip': u'10.1.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.1.2/24', u'tenant_ns_ip': u'10.1.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.1.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.1.2', u'remote_route': u'10.2.1.0/24', u'subnet_route': u'10.1.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.2.1.2'}]}, {u'mem': 2, u'name': u't1_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM1if1'}]) => {"ansible_loop_var": "item", "changed": false, "checksum": "350ba870bd31b7f6ee517845c14237910b5af0bf", "dest": "/root/Migration-as-a-Service/etc/t1/VM_templates/t1_VM1.xml.j2", "gid": 0, "group": "root", "item": [{"bridge_name": "t1br1", "default_route_ip": "10.1.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.1.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.1.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.1.1.2/24"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.1.2", "remote_ip": "10.2.1.2", "remote_route": "10.2.1.0/24", "subnet_route": "10.1.1.0/24", "tenant_route_ip": "192.168.1.2", "v_name": "vxlan_t1s1"}]}, {"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM1", "vcpu": 4, "vmif": "t1VM1if1"}], "mode": "0644", "owner": "root", "path": "/root/Migration-as-a-Service/etc/t1/VM_templates/t1_VM1.xml.j2", "size": 4091, "state": "file", "uid": 0}
ok: [localhost] => (item=[{u'route': [{u'ip': u'10.1.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.1.2/24', u'tenant_ns_ip': u'10.1.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.1.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.1.2', u'remote_route': u'10.2.1.0/24', u'subnet_route': u'10.1.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.2.1.2'}]}, {u'mem': 4, u'name': u't1_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br1if2', u'vmif': u't1VM2if1'}]) => {"ansible_loop_var": "item", "changed": false, "checksum": "350ba870bd31b7f6ee517845c14237910b5af0bf", "dest": "/root/Migration-as-a-Service/etc/t1/VM_templates/t1_VM2.xml.j2", "gid": 0, "group": "root", "item": [{"bridge_name": "t1br1", "default_route_ip": "10.1.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.1.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.1.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.1.1.2/24"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.1.2", "remote_ip": "10.2.1.2", "remote_route": "10.2.1.0/24", "subnet_route": "10.1.1.0/24", "tenant_route_ip": "192.168.1.2", "v_name": "vxlan_t1s1"}]}, {"brif": "t1br1if2", "disk": "10G", "mem": 4, "name": "t1_VM2", "vcpu": 2, "vmif": "t1VM2if1"}], "mode": "0644", "owner": "root", "path": "/root/Migration-as-a-Service/etc/t1/VM_templates/t1_VM2.xml.j2", "size": 4091, "state": "file", "uid": 0}
ok: [localhost] => (item=[{u'route': [{u'ip': u'10.1.2.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.2.1', u'bridge_name': u't1br2', u'dns': [{u'dnsif': u't1s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s2_dnsbrif'}], u'ns_name': u't1ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.2.2/24', u'tenant_ns_ip': u'10.1.2.1/24', u'tenant_ns_if': u't1ns2if', u'tenant_sub_if': u't1s2if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'2.2.2.0/24', u'vxlan': [{u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}, {u'mem': 3, u'name': u't1_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br2if1', u'vmif': u't1VM3if1'}]) => {"ansible_loop_var": "item", "changed": false, "checksum": "350ba870bd31b7f6ee517845c14237910b5af0bf", "dest": "/root/Migration-as-a-Service/etc/t1/VM_templates/t1_VM3.xml.j2", "gid": 0, "group": "root", "item": [{"bridge_name": "t1br2", "default_route_ip": "10.1.2.1", "dns": [{"brif": "t1s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t1s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns2", "route": [{"if": "p1", "ip": "10.1.2.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "2.2.2.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns2if", "tenant_ns_ip": "10.1.2.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s2if", "tenant_sub_ip": "10.1.2.2/24"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, {"brif": "t1br2if1", "disk": "10G", "mem": 3, "name": "t1_VM3", "vcpu": 2, "vmif": "t1VM3if1"}], "mode": "0644", "owner": "root", "path": "/root/Migration-as-a-Service/etc/t1/VM_templates/t1_VM3.xml.j2", "size": 4091, "state": "file", "uid": 0}

PLAY RECAP **************************************************************************************************************************************************
localhost                  : ok=1    changed=0    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0   

Using /etc/ansible/ansible.cfg as config file

PLAY [main] *************************************************************************************************************************************************

TASK [Create VM templates (C2)] *****************************************************************************************************************************
ok: [localhost] => (item=[{u'route': [{u'ip': u'10.2.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.2.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.1.2/24', u'tenant_ns_ip': u'10.2.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.2.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.129.2', u'remote_route': u'10.1.1.0/24', u'subnet_route': u'10.2.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.1.1.2'}]}, {u'mem': 2, u'name': u't1_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM4if1'}]) => {"ansible_loop_var": "item", "changed": false, "checksum": "350ba870bd31b7f6ee517845c14237910b5af0bf", "dest": "/root/Migration-as-a-Service/etc/t1/VM_templates/t1_VM4.xml.j2", "gid": 0, "group": "root", "item": [{"bridge_name": "t1br1", "default_route_ip": "10.2.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.2.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.2.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.2.1.2/24"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.1.2", "remote_ip": "10.1.1.2", "remote_route": "10.1.1.0/24", "subnet_route": "10.2.1.0/24", "tenant_route_ip": "192.168.129.2", "v_name": "vxlan_t1s1"}]}, {"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM4", "vcpu": 4, "vmif": "t1VM4if1"}], "mode": "0644", "owner": "root", "path": "/root/Migration-as-a-Service/etc/t1/VM_templates/t1_VM4.xml.j2", "size": 4091, "state": "file", "uid": 0}

PLAY RECAP **************************************************************************************************************************************************
localhost                  : ok=1    changed=0    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0   

Using /etc/ansible/ansible.cfg as config file

PLAY [main] *************************************************************************************************************************************************

TASK [Copy VM image] ****************************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.1.2/24', u'tenant_ns_ip': u'10.1.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.1.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.1.2', u'remote_route': u'10.2.1.0/24', u'subnet_route': u'10.1.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.2.1.2'}]}, {u'mem': 2, u'name': u't1_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM1if1'}]) => {"ansible_loop_var": "item", "changed": true, "checksum": "d86d5962370fcd0c3d05943fc209d9e05fdac89f", "dest": "/var/lib/libvirt/images/t1_VM1.qcow2", "gid": 0, "group": "root", "item": [{"bridge_name": "t1br1", "default_route_ip": "10.1.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.1.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.1.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.1.1.2/24"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.1.2", "remote_ip": "10.2.1.2", "remote_route": "10.2.1.0/24", "subnet_route": "10.1.1.0/24", "tenant_route_ip": "192.168.1.2", "v_name": "vxlan_t1s1"}]}, {"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM1", "vcpu": 4, "vmif": "t1VM1if1"}], "md5sum": "b977a19124b65f2d544ddc62e407114d", "mode": "0644", "owner": "root", "size": 10739318784, "src": "/root/.ansible/tmp/ansible-tmp-1574405062.39-253164217694045/source", "state": "file", "uid": 0}
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.1.2/24', u'tenant_ns_ip': u'10.1.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.1.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.1.2', u'remote_route': u'10.2.1.0/24', u'subnet_route': u'10.1.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.2.1.2'}]}, {u'mem': 4, u'name': u't1_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br1if2', u'vmif': u't1VM2if1'}]) => {"ansible_loop_var": "item", "changed": true, "checksum": "d86d5962370fcd0c3d05943fc209d9e05fdac89f", "dest": "/var/lib/libvirt/images/t1_VM2.qcow2", "gid": 0, "group": "root", "item": [{"bridge_name": "t1br1", "default_route_ip": "10.1.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.1.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.1.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.1.1.2/24"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.1.2", "remote_ip": "10.2.1.2", "remote_route": "10.2.1.0/24", "subnet_route": "10.1.1.0/24", "tenant_route_ip": "192.168.1.2", "v_name": "vxlan_t1s1"}]}, {"brif": "t1br1if2", "disk": "10G", "mem": 4, "name": "t1_VM2", "vcpu": 2, "vmif": "t1VM2if1"}], "md5sum": "b977a19124b65f2d544ddc62e407114d", "mode": "0644", "owner": "root", "size": 10739318784, "src": "/root/.ansible/tmp/ansible-tmp-1574405177.0-222327439647791/source", "state": "file", "uid": 0}
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.2.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.2.1', u'bridge_name': u't1br2', u'dns': [{u'dnsif': u't1s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s2_dnsbrif'}], u'ns_name': u't1ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.2.2/24', u'tenant_ns_ip': u'10.1.2.1/24', u'tenant_ns_if': u't1ns2if', u'tenant_sub_if': u't1s2if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'2.2.2.0/24', u'vxlan': [{u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}, {u'mem': 3, u'name': u't1_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br2if1', u'vmif': u't1VM3if1'}]) => {"ansible_loop_var": "item", "changed": true, "checksum": "d86d5962370fcd0c3d05943fc209d9e05fdac89f", "dest": "/var/lib/libvirt/images/t1_VM3.qcow2", "gid": 0, "group": "root", "item": [{"bridge_name": "t1br2", "default_route_ip": "10.1.2.1", "dns": [{"brif": "t1s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t1s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns2", "route": [{"if": "p1", "ip": "10.1.2.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "2.2.2.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns2if", "tenant_ns_ip": "10.1.2.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s2if", "tenant_sub_ip": "10.1.2.2/24"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, {"brif": "t1br2if1", "disk": "10G", "mem": 3, "name": "t1_VM3", "vcpu": 2, "vmif": "t1VM3if1"}], "md5sum": "b977a19124b65f2d544ddc62e407114d", "mode": "0644", "owner": "root", "size": 10739318784, "src": "/root/.ansible/tmp/ansible-tmp-1574405275.69-197604663159024/source", "state": "file", "uid": 0}

TASK [Get list of running VMs] ******************************************************************************************************************************
ok: [localhost] => {"changed": false, "cmd": ["virsh", "list", "--name"], "delta": "0:00:00.649391", "end": "2019-11-22 06:49:51.013886", "rc": 0, "start": "2019-11-22 06:49:50.364495", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Define VM] ********************************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.1.2/24', u'tenant_ns_ip': u'10.1.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.1.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.1.2', u'remote_route': u'10.2.1.0/24', u'subnet_route': u'10.1.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.2.1.2'}]}, {u'mem': 2, u'name': u't1_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM1if1'}]) => {"ansible_loop_var": "item", "changed": true, "created": "t1_VM1", "item": [{"bridge_name": "t1br1", "default_route_ip": "10.1.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.1.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.1.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.1.1.2/24"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.1.2", "remote_ip": "10.2.1.2", "remote_route": "10.2.1.0/24", "subnet_route": "10.1.1.0/24", "tenant_route_ip": "192.168.1.2", "v_name": "vxlan_t1s1"}]}, {"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM1", "vcpu": 4, "vmif": "t1VM1if1"}], "warnings": ["'xml' is given - ignoring 'name'"]}
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.1.2/24', u'tenant_ns_ip': u'10.1.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.1.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.1.2', u'remote_route': u'10.2.1.0/24', u'subnet_route': u'10.1.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.2.1.2'}]}, {u'mem': 4, u'name': u't1_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br1if2', u'vmif': u't1VM2if1'}]) => {"ansible_loop_var": "item", "changed": true, "created": "t1_VM2", "item": [{"bridge_name": "t1br1", "default_route_ip": "10.1.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.1.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.1.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.1.1.2/24"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.1.2", "remote_ip": "10.2.1.2", "remote_route": "10.2.1.0/24", "subnet_route": "10.1.1.0/24", "tenant_route_ip": "192.168.1.2", "v_name": "vxlan_t1s1"}]}, {"brif": "t1br1if2", "disk": "10G", "mem": 4, "name": "t1_VM2", "vcpu": 2, "vmif": "t1VM2if1"}], "warnings": ["'xml' is given - ignoring 'name'"]}
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.2.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.2.1', u'bridge_name': u't1br2', u'dns': [{u'dnsif': u't1s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s2_dnsbrif'}], u'ns_name': u't1ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.2.2/24', u'tenant_ns_ip': u'10.1.2.1/24', u'tenant_ns_if': u't1ns2if', u'tenant_sub_if': u't1s2if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'2.2.2.0/24', u'vxlan': [{u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}, {u'mem': 3, u'name': u't1_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br2if1', u'vmif': u't1VM3if1'}]) => {"ansible_loop_var": "item", "changed": true, "created": "t1_VM3", "item": [{"bridge_name": "t1br2", "default_route_ip": "10.1.2.1", "dns": [{"brif": "t1s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t1s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns2", "route": [{"if": "p1", "ip": "10.1.2.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "2.2.2.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns2if", "tenant_ns_ip": "10.1.2.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s2if", "tenant_sub_ip": "10.1.2.2/24"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, {"brif": "t1br2if1", "disk": "10G", "mem": 3, "name": "t1_VM3", "vcpu": 2, "vmif": "t1VM3if1"}], "warnings": ["'xml' is given - ignoring 'name'"]}

TASK [Create VM] ********************************************************************************************************************************************
ok: [localhost] => (item=[{u'route': [{u'ip': u'10.1.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.1.2/24', u'tenant_ns_ip': u'10.1.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.1.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.1.2', u'remote_route': u'10.2.1.0/24', u'subnet_route': u'10.1.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.2.1.2'}]}, {u'mem': 2, u'name': u't1_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM1if1'}]) => {"ansible_loop_var": "item", "changed": false, "create": 0, "item": [{"bridge_name": "t1br1", "default_route_ip": "10.1.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.1.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.1.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.1.1.2/24"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.1.2", "remote_ip": "10.2.1.2", "remote_route": "10.2.1.0/24", "subnet_route": "10.1.1.0/24", "tenant_route_ip": "192.168.1.2", "v_name": "vxlan_t1s1"}]}, {"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM1", "vcpu": 4, "vmif": "t1VM1if1"}]}
ok: [localhost] => (item=[{u'route': [{u'ip': u'10.1.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.1.2/24', u'tenant_ns_ip': u'10.1.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.1.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.1.2', u'remote_route': u'10.2.1.0/24', u'subnet_route': u'10.1.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.2.1.2'}]}, {u'mem': 4, u'name': u't1_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br1if2', u'vmif': u't1VM2if1'}]) => {"ansible_loop_var": "item", "changed": false, "create": 0, "item": [{"bridge_name": "t1br1", "default_route_ip": "10.1.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.1.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.1.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.1.1.2/24"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.1.2", "remote_ip": "10.2.1.2", "remote_route": "10.2.1.0/24", "subnet_route": "10.1.1.0/24", "tenant_route_ip": "192.168.1.2", "v_name": "vxlan_t1s1"}]}, {"brif": "t1br1if2", "disk": "10G", "mem": 4, "name": "t1_VM2", "vcpu": 2, "vmif": "t1VM2if1"}]}
ok: [localhost] => (item=[{u'route': [{u'ip': u'10.1.2.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.2.1', u'bridge_name': u't1br2', u'dns': [{u'dnsif': u't1s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s2_dnsbrif'}], u'ns_name': u't1ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.2.2/24', u'tenant_ns_ip': u'10.1.2.1/24', u'tenant_ns_if': u't1ns2if', u'tenant_sub_if': u't1s2if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'2.2.2.0/24', u'vxlan': [{u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}, {u'mem': 3, u'name': u't1_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br2if1', u'vmif': u't1VM3if1'}]) => {"ansible_loop_var": "item", "changed": false, "create": 0, "item": [{"bridge_name": "t1br2", "default_route_ip": "10.1.2.1", "dns": [{"brif": "t1s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t1s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns2", "route": [{"if": "p1", "ip": "10.1.2.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "2.2.2.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns2if", "tenant_ns_ip": "10.1.2.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s2if", "tenant_sub_ip": "10.1.2.2/24"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, {"brif": "t1br2if1", "disk": "10G", "mem": 3, "name": "t1_VM3", "vcpu": 2, "vmif": "t1VM3if1"}]}

TASK [Start VM] *********************************************************************************************************************************************
ok: [localhost] => (item=[{u'route': [{u'ip': u'10.1.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.1.2/24', u'tenant_ns_ip': u'10.1.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.1.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.1.2', u'remote_route': u'10.2.1.0/24', u'subnet_route': u'10.1.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.2.1.2'}]}, {u'mem': 2, u'name': u't1_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM1if1'}]) => {"ansible_loop_var": "item", "changed": false, "item": [{"bridge_name": "t1br1", "default_route_ip": "10.1.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.1.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.1.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.1.1.2/24"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.1.2", "remote_ip": "10.2.1.2", "remote_route": "10.2.1.0/24", "subnet_route": "10.1.1.0/24", "tenant_route_ip": "192.168.1.2", "v_name": "vxlan_t1s1"}]}, {"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM1", "vcpu": 4, "vmif": "t1VM1if1"}]}
ok: [localhost] => (item=[{u'route': [{u'ip': u'10.1.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.1.2/24', u'tenant_ns_ip': u'10.1.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.1.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.1.2', u'remote_route': u'10.2.1.0/24', u'subnet_route': u'10.1.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.2.1.2'}]}, {u'mem': 4, u'name': u't1_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br1if2', u'vmif': u't1VM2if1'}]) => {"ansible_loop_var": "item", "changed": false, "item": [{"bridge_name": "t1br1", "default_route_ip": "10.1.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.1.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.1.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.1.1.2/24"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.1.2", "remote_ip": "10.2.1.2", "remote_route": "10.2.1.0/24", "subnet_route": "10.1.1.0/24", "tenant_route_ip": "192.168.1.2", "v_name": "vxlan_t1s1"}]}, {"brif": "t1br1if2", "disk": "10G", "mem": 4, "name": "t1_VM2", "vcpu": 2, "vmif": "t1VM2if1"}]}
ok: [localhost] => (item=[{u'route': [{u'ip': u'10.1.2.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.2.1', u'bridge_name': u't1br2', u'dns': [{u'dnsif': u't1s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s2_dnsbrif'}], u'ns_name': u't1ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.2.2/24', u'tenant_ns_ip': u'10.1.2.1/24', u'tenant_ns_if': u't1ns2if', u'tenant_sub_if': u't1s2if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'2.2.2.0/24', u'vxlan': [{u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}, {u'mem': 3, u'name': u't1_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br2if1', u'vmif': u't1VM3if1'}]) => {"ansible_loop_var": "item", "changed": false, "item": [{"bridge_name": "t1br2", "default_route_ip": "10.1.2.1", "dns": [{"brif": "t1s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t1s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns2", "route": [{"if": "p1", "ip": "10.1.2.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "2.2.2.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns2if", "tenant_ns_ip": "10.1.2.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s2if", "tenant_sub_ip": "10.1.2.2/24"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, {"brif": "t1br2if1", "disk": "10G", "mem": 3, "name": "t1_VM3", "vcpu": 2, "vmif": "t1VM3if1"}]}

TASK [Attach VM interface] **********************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.1.2/24', u'tenant_ns_ip': u'10.1.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.1.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.1.2', u'remote_route': u'10.2.1.0/24', u'subnet_route': u'10.1.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.2.1.2'}]}, {u'mem': 2, u'name': u't1_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM1if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "virsh domiflist \"t1_VM1\" | grep -w 't1VM1if1' ; if [ $? -ne 0 ] ; then virsh attach-interface \"t1_VM1\" direct \"t1VM1if1\" --live --persistent ; fi\n", "delta": "0:00:00.301355", "end": "2019-11-22 06:49:57.989743", "item": [{"bridge_name": "t1br1", "default_route_ip": "10.1.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.1.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.1.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.1.1.2/24"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.1.2", "remote_ip": "10.2.1.2", "remote_route": "10.2.1.0/24", "subnet_route": "10.1.1.0/24", "tenant_route_ip": "192.168.1.2", "v_name": "vxlan_t1s1"}]}, {"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM1", "vcpu": 4, "vmif": "t1VM1if1"}], "rc": 0, "start": "2019-11-22 06:49:57.688388", "stderr": "", "stderr_lines": [], "stdout": "Interface attached successfully", "stdout_lines": ["Interface attached successfully"]}
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.1.2/24', u'tenant_ns_ip': u'10.1.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.1.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.1.2', u'remote_route': u'10.2.1.0/24', u'subnet_route': u'10.1.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.2.1.2'}]}, {u'mem': 4, u'name': u't1_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br1if2', u'vmif': u't1VM2if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "virsh domiflist \"t1_VM2\" | grep -w 't1VM2if1' ; if [ $? -ne 0 ] ; then virsh attach-interface \"t1_VM2\" direct \"t1VM2if1\" --live --persistent ; fi\n", "delta": "0:00:00.238662", "end": "2019-11-22 06:49:58.357391", "item": [{"bridge_name": "t1br1", "default_route_ip": "10.1.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.1.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.1.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.1.1.2/24"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.1.2", "remote_ip": "10.2.1.2", "remote_route": "10.2.1.0/24", "subnet_route": "10.1.1.0/24", "tenant_route_ip": "192.168.1.2", "v_name": "vxlan_t1s1"}]}, {"brif": "t1br1if2", "disk": "10G", "mem": 4, "name": "t1_VM2", "vcpu": 2, "vmif": "t1VM2if1"}], "rc": 0, "start": "2019-11-22 06:49:58.118729", "stderr": "", "stderr_lines": [], "stdout": "Interface attached successfully", "stdout_lines": ["Interface attached successfully"]}
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.2.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.2.1', u'bridge_name': u't1br2', u'dns': [{u'dnsif': u't1s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s2_dnsbrif'}], u'ns_name': u't1ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.2.2/24', u'tenant_ns_ip': u'10.1.2.1/24', u'tenant_ns_if': u't1ns2if', u'tenant_sub_if': u't1s2if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'2.2.2.0/24', u'vxlan': [{u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}, {u'mem': 3, u'name': u't1_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br2if1', u'vmif': u't1VM3if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "virsh domiflist \"t1_VM3\" | grep -w 't1VM3if1' ; if [ $? -ne 0 ] ; then virsh attach-interface \"t1_VM3\" direct \"t1VM3if1\" --live --persistent ; fi\n", "delta": "0:00:00.261404", "end": "2019-11-22 06:49:58.770316", "item": [{"bridge_name": "t1br2", "default_route_ip": "10.1.2.1", "dns": [{"brif": "t1s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t1s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns2", "route": [{"if": "p1", "ip": "10.1.2.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "2.2.2.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns2if", "tenant_ns_ip": "10.1.2.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s2if", "tenant_sub_ip": "10.1.2.2/24"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, {"brif": "t1br2if1", "disk": "10G", "mem": 3, "name": "t1_VM3", "vcpu": 2, "vmif": "t1VM3if1"}], "rc": 0, "start": "2019-11-22 06:49:58.508912", "stderr": "", "stderr_lines": [], "stdout": "Interface attached successfully", "stdout_lines": ["Interface attached successfully"]}

PLAY RECAP **************************************************************************************************************************************************
localhost                  : ok=6    changed=3    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0   

Using /etc/ansible/ansible.cfg as config file

PLAY [worker] ***********************************************************************************************************************************************

TASK [Copy VM image] ****************************************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.2.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.1.2/24', u'tenant_ns_ip': u'10.2.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.2.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.129.2', u'remote_route': u'10.1.1.0/24', u'subnet_route': u'10.2.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.1.1.2'}]}, {u'mem': 2, u'name': u't1_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM4if1'}]) => {"ansible_loop_var": "item", "changed": true, "checksum": "f8b2ffa2bf201c84196c582f2dec0d33a1eb4b42", "dest": "/var/lib/libvirt/images/t1_VM4.qcow2", "gid": 0, "group": "root", "item": [{"bridge_name": "t1br1", "default_route_ip": "10.2.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.2.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.2.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.2.1.2/24"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.1.2", "remote_ip": "10.1.1.2", "remote_route": "10.1.1.0/24", "subnet_route": "10.2.1.0/24", "tenant_route_ip": "192.168.129.2", "v_name": "vxlan_t1s1"}]}, {"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM4", "vcpu": 4, "vmif": "t1VM4if1"}], "md5sum": "e6d5d524b68797ddd748ba1475985d34", "mode": "0644", "owner": "root", "size": 10739318784, "src": "/root/mainVM.qcow2", "state": "file", "uid": 0}

TASK [Get list of running VMs] ******************************************************************************************************************************
ok: [99.99.99.2] => {"changed": false, "cmd": ["virsh", "list", "--name"], "delta": "0:00:00.038594", "end": "2019-11-22 06:52:04.192292", "rc": 0, "start": "2019-11-22 06:52:04.153698", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Define VM] ********************************************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.2.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.1.2/24', u'tenant_ns_ip': u'10.2.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.2.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.129.2', u'remote_route': u'10.1.1.0/24', u'subnet_route': u'10.2.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.1.1.2'}]}, {u'mem': 2, u'name': u't1_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM4if1'}]) => {"ansible_loop_var": "item", "changed": true, "created": "t1_VM4", "item": [{"bridge_name": "t1br1", "default_route_ip": "10.2.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.2.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.2.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.2.1.2/24"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.1.2", "remote_ip": "10.1.1.2", "remote_route": "10.1.1.0/24", "subnet_route": "10.2.1.0/24", "tenant_route_ip": "192.168.129.2", "v_name": "vxlan_t1s1"}]}, {"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM4", "vcpu": 4, "vmif": "t1VM4if1"}], "warnings": ["'xml' is given - ignoring 'name'"]}

TASK [Create VM] ********************************************************************************************************************************************
ok: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.2.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.1.2/24', u'tenant_ns_ip': u'10.2.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.2.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.129.2', u'remote_route': u'10.1.1.0/24', u'subnet_route': u'10.2.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.1.1.2'}]}, {u'mem': 2, u'name': u't1_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM4if1'}]) => {"ansible_loop_var": "item", "changed": false, "create": 0, "item": [{"bridge_name": "t1br1", "default_route_ip": "10.2.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.2.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.2.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.2.1.2/24"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.1.2", "remote_ip": "10.1.1.2", "remote_route": "10.1.1.0/24", "subnet_route": "10.2.1.0/24", "tenant_route_ip": "192.168.129.2", "v_name": "vxlan_t1s1"}]}, {"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM4", "vcpu": 4, "vmif": "t1VM4if1"}]}

TASK [Start VM] *********************************************************************************************************************************************
ok: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.2.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.1.2/24', u'tenant_ns_ip': u'10.2.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.2.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.129.2', u'remote_route': u'10.1.1.0/24', u'subnet_route': u'10.2.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.1.1.2'}]}, {u'mem': 2, u'name': u't1_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM4if1'}]) => {"ansible_loop_var": "item", "changed": false, "item": [{"bridge_name": "t1br1", "default_route_ip": "10.2.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.2.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.2.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.2.1.2/24"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.1.2", "remote_ip": "10.1.1.2", "remote_route": "10.1.1.0/24", "subnet_route": "10.2.1.0/24", "tenant_route_ip": "192.168.129.2", "v_name": "vxlan_t1s1"}]}, {"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM4", "vcpu": 4, "vmif": "t1VM4if1"}]}

TASK [Attach VM interface] **********************************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.2.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.1.2/24', u'tenant_ns_ip': u'10.2.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.2.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.129.2', u'remote_route': u'10.1.1.0/24', u'subnet_route': u'10.2.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.1.1.2'}]}, {u'mem': 2, u'name': u't1_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM4if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "virsh domiflist \"t1_VM4\" | grep -w 't1VM4if1' ; if [ $? -ne 0 ] ; then virsh attach-interface \"t1_VM4\" direct \"t1VM4if1\" --live --persistent ; fi\n", "delta": "0:00:00.278405", "end": "2019-11-22 06:52:15.209370", "item": [{"bridge_name": "t1br1", "default_route_ip": "10.2.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.2.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.2.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.2.1.2/24"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.1.2", "remote_ip": "10.1.1.2", "remote_route": "10.1.1.0/24", "subnet_route": "10.2.1.0/24", "tenant_route_ip": "192.168.129.2", "v_name": "vxlan_t1s1"}]}, {"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM4", "vcpu": 4, "vmif": "t1VM4if1"}], "rc": 0, "start": "2019-11-22 06:52:14.930965", "stderr": "", "stderr_lines": [], "stdout": "Interface attached successfully", "stdout_lines": ["Interface attached successfully"]}

PLAY RECAP **************************************************************************************************************************************************
<<<<<<< HEAD
99.99.99.2                 : ok=6    changed=2    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0   

INFO:root: 03:50:20.996061 Unable to open user input yaml file
INFO:root: 03:50:21.252305 Unable to open user input yaml file
INFO:root: 03:50:48.547665 Printing the yaml input file
INFO:root: 03:50:48.547908 {'C1': [{'subnet_addr': '1.1.1.0/24', 'VM': [{'name': 'VM1', 'disk': '10G', 'mem': 2, 'vcpu': 4, 'internet_access': True}, {'name': 'VM2', 'disk': '10G', 'mem': 4, 'vcpu': 2, 'internet_access': False}]}, {'subnet_addr': '2.2.2.0/24', 'VM': [{'name': 'VM3', 'disk': '10G', 'mem': 3, 'vcpu': 2, 'internet_access': True}]}], 'C2': [{'subnet_addr': '1.1.1.0/24', 'VM': [{'name': 'VM4', 'disk': '10G', 'mem': 2, 'vcpu': 4, 'internet_access': True}]}], 'LOG_ENABLE': True}
INFO:root: 03:51:53.278337 Printing the yaml input file
INFO:root: 03:51:53.278490 {'C1': [{'subnet_addr': '1.1.1.0/24', 'VM': [{'name': 'VM1', 'disk': '10G', 'mem': 2, 'vcpu': 4, 'internet_access': True}, {'name': 'VM2', 'disk': '10G', 'mem': 4, 'vcpu': 2, 'internet_access': False}]}, {'subnet_addr': '2.2.2.0/24', 'VM': [{'name': 'VM3', 'disk': '10G', 'mem': 3, 'vcpu': 2, 'internet_access': True}]}], 'C2': [{'subnet_addr': '1.1.1.0/24', 'VM': [{'name': 'VM4', 'disk': '10G', 'mem': 2, 'vcpu': 4, 'internet_access': True}]}], 'LOG_ENABLE': True, 'GUI': True}
INFO:root: 03:52:36.641062 Printing the yaml input file
INFO:root: 03:52:36.641168 {'C1': [{'subnet_addr': '1.1.1.0/24', 'VM': [{'name': 'VM1', 'disk': '10G', 'mem': 2, 'vcpu': 4, 'internet_access': True}, {'name': 'VM2', 'disk': '10G', 'mem': 4, 'vcpu': 2, 'internet_access': False}]}, {'subnet_addr': '2.2.2.0/24', 'VM': [{'name': 'VM3', 'disk': '10G', 'mem': 3, 'vcpu': 2, 'internet_access': True}]}], 'C2': [{'subnet_addr': '1.1.1.0/24', 'VM': [{'name': 'VM4', 'disk': '10G', 'mem': 2, 'vcpu': 4, 'internet_access': True}]}], 'LOG_ENABLE': True, 'GUI': True}
INFO:root: 04:06:00.624891 Unable to open user input yaml file
INFO:root: 04:06:00.847270 Unable to open user input yaml file
INFO:root: 06:40:13.757007 Unable to open user input yaml file
INFO:root: 06:40:13.962695 Unable to open user input yaml file
INFO:root: 06:40:14.014894 Unable to open user input yaml file
INFO:root: 06:40:25.139193 Unable to open user input yaml file
INFO:root: 07:06:48.438019 Printing the yaml input file
INFO:root: 07:06:48.438143 {'C1': [{'subnet_addr': '1.1.1.0/24', 'VM': [{'name': 'VM1', 'disk': '10G', 'mem': 2, 'vcpu': 4, 'internet_access': True}, {'name': 'VM2', 'disk': '10G', 'mem': 4, 'vcpu': 2, 'internet_access': False}]}], 'C2': [{'subnet_addr': '1.1.1.0/24', 'VM': [{'name': 'VM4', 'disk': '10G', 'mem': 2, 'vcpu': 4, 'internet_access': True}]}, {'subnet_addr': '2.2.2.0/24', 'VM': [{'name': 'VM3', 'disk': '10G', 'mem': 3, 'vcpu': 2, 'internet_access': True}]}], 'LOG_ENABLE': True, 'GUI': True}
INFO:root: 07:06:48.583954 Printing the yaml input file
INFO:root: 07:06:48.584050 {'C1': [{'subnet_addr': '1.1.1.0/24', 'VM': [{'name': 'VM1', 'disk': '10G', 'mem': 2, 'vcpu': 4, 'internet_access': True}, {'name': 'VM2', 'disk': '10G', 'mem': 4, 'vcpu': 2, 'internet_access': False}]}], 'C2': [{'subnet_addr': '1.1.1.0/24', 'VM': [{'name': 'VM4', 'disk': '10G', 'mem': 2, 'vcpu': 4, 'internet_access': True}]}, {'subnet_addr': '2.2.2.0/24', 'VM': [{'name': 'VM3', 'disk': '10G', 'mem': 3, 'vcpu': 2, 'internet_access': True}]}], 'LOG_ENABLE': True, 'GUI': True}
INFO:root: 07:08:30.123220 Printing the yaml input file
INFO:root: 07:08:30.123389 {'C1': [{'subnet_addr': '1.1.1.0/24', 'VM': [{'name': 'VM1', 'disk': '10G', 'mem': 2, 'vcpu': 4, 'internet_access': True}, {'name': 'VM2', 'disk': '10G', 'mem': 4, 'vcpu': 2, 'internet_access': False}]}], 'C2': [{'subnet_addr': '1.1.1.0/24', 'VM': [{'name': 'VM4', 'disk': '10G', 'mem': 2, 'vcpu': 4, 'internet_access': True}]}, {'subnet_addr': '2.2.2.0/24', 'VM': [{'name': 'VM3', 'disk': '10G', 'mem': 3, 'vcpu': 2, 'internet_access': True}]}], 'LOG_ENABLE': True, 'GUI': True}
INFO:root: 07:08:30.282756 Printing the yaml input file
INFO:root: 07:08:30.282871 {'C1': [{'subnet_addr': '1.1.1.0/24', 'VM': [{'name': 'VM1', 'disk': '10G', 'mem': 2, 'vcpu': 4, 'internet_access': True}, {'name': 'VM2', 'disk': '10G', 'mem': 4, 'vcpu': 2, 'internet_access': False}]}], 'C2': [{'subnet_addr': '1.1.1.0/24', 'VM': [{'name': 'VM4', 'disk': '10G', 'mem': 2, 'vcpu': 4, 'internet_access': True}]}, {'subnet_addr': '2.2.2.0/24', 'VM': [{'name': 'VM3', 'disk': '10G', 'mem': 3, 'vcpu': 2, 'internet_access': True}]}], 'LOG_ENABLE': True, 'GUI': True}
INFO:root: 07:10:15.085040 Printing the yaml input file
INFO:root: 07:10:15.085155 {'C1': [{'subnet_addr': '1.1.1.0/24', 'VM': [{'name': 'VM1', 'disk': '10G', 'mem': 2, 'vcpu': 4, 'internet_access': True}, {'name': 'VM2', 'disk': '10G', 'mem': 4, 'vcpu': 2, 'internet_access': False}]}], 'C2': [{'subnet_addr': '1.1.1.0/24', 'VM': [{'name': 'VM4', 'disk': '10G', 'mem': 2, 'vcpu': 4, 'internet_access': True}]}, {'subnet_addr': '2.2.2.0/24', 'VM': [{'name': 'VM3', 'disk': '10G', 'mem': 3, 'vcpu': 2, 'internet_access': True}]}], 'LOG_ENABLE': True, 'GUI': True}
INFO:root: 07:10:15.230243 Printing the yaml input file
INFO:root: 07:10:15.230361 {'C1': [{'subnet_addr': '1.1.1.0/24', 'VM': [{'name': 'VM1', 'disk': '10G', 'mem': 2, 'vcpu': 4, 'internet_access': True}, {'name': 'VM2', 'disk': '10G', 'mem': 4, 'vcpu': 2, 'internet_access': False}]}], 'C2': [{'subnet_addr': '1.1.1.0/24', 'VM': [{'name': 'VM4', 'disk': '10G', 'mem': 2, 'vcpu': 4, 'internet_access': True}]}, {'subnet_addr': '2.2.2.0/24', 'VM': [{'name': 'VM3', 'disk': '10G', 'mem': 3, 'vcpu': 2, 'internet_access': True}]}], 'LOG_ENABLE': True, 'GUI': True}
INFO:root: 07:11:40.211413 Printing the yaml input file
INFO:root: 07:11:40.211586 {'C1': [{'subnet_addr': '1.1.1.0/24', 'VM': [{'name': 'VM1', 'disk': '10G', 'mem': 2, 'vcpu': 4, 'internet_access': True}, {'name': 'VM2', 'disk': '10G', 'mem': 4, 'vcpu': 2, 'internet_access': False}]}], 'C2': [{'subnet_addr': '1.1.1.0/24', 'VM': [{'name': 'VM4', 'disk': '10G', 'mem': 2, 'vcpu': 4, 'internet_access': True}]}, {'subnet_addr': '2.2.2.0/24', 'VM': [{'name': 'VM3', 'disk': '10G', 'mem': 3, 'vcpu': 2, 'internet_access': True}]}], 'LOG_ENABLE': True, 'GUI': True}
INFO:root: 07:11:40.367034 Printing the yaml input file
INFO:root: 07:11:40.367196 {'C1': [{'subnet_addr': '1.1.1.0/24', 'VM': [{'name': 'VM1', 'disk': '10G', 'mem': 2, 'vcpu': 4, 'internet_access': True}, {'name': 'VM2', 'disk': '10G', 'mem': 4, 'vcpu': 2, 'internet_access': False}]}], 'C2': [{'subnet_addr': '1.1.1.0/24', 'VM': [{'name': 'VM4', 'disk': '10G', 'mem': 2, 'vcpu': 4, 'internet_access': True}]}, {'subnet_addr': '2.2.2.0/24', 'VM': [{'name': 'VM3', 'disk': '10G', 'mem': 3, 'vcpu': 2, 'internet_access': True}]}], 'LOG_ENABLE': True, 'GUI': True}
INFO:root: 07:14:58.468717 Printing the yaml input file
INFO:root: 07:14:58.468873 {'C1': [{'subnet_addr': '1.1.1.0/24', 'VM': [{'name': 'VM1', 'disk': '10G', 'mem': 2, 'vcpu': 4, 'internet_access': True}, {'name': 'VM2', 'disk': '10G', 'mem': 4, 'vcpu': 2, 'internet_access': False}]}], 'C2': [{'subnet_addr': '1.1.1.0/24', 'VM': [{'name': 'VM4', 'disk': '10G', 'mem': 2, 'vcpu': 4, 'internet_access': True}]}, {'subnet_addr': '2.2.2.0/24', 'VM': [{'name': 'VM3', 'disk': '10G', 'mem': 3, 'vcpu': 2, 'internet_access': True}]}], 'MISC': [{'LOG_ENABLE': True}, {'GUI': True}]}
INFO:root: 07:14:58.468990 Provided subnet in C1: 1.1.1.0/24 is valid
INFO:root: 07:14:58.469041 Provided subnet in C2: 1.1.1.0/24 is valid
INFO:root: 07:14:58.469082 Provided subnet in C2: 2.2.2.0/24 is valid
Using /etc/ansible/ansible.cfg as config file

PLAY [main] *************************************************************************************************************************************************

TASK [Create Tenant Namespace] ******************************************************************************************************************************
changed: [localhost] => (item={u'default_route_ip': u'192.168.8.1', u'name': u't8', u'pns_ip': u'192.168.8.1/24', u'tenant_if': u't8if', u'tenant_ip': u'192.168.8.2/24', u'pns_if': u't8pns_if'}) => {"ansible_loop_var": "item", "changed": true, "cmd": ["ip", "netns", "add", "t8"], "delta": "0:00:00.053035", "end": "2019-12-05 07:15:00.051272", "item": {"default_route_ip": "192.168.8.1", "name": "t8", "pns_if": "t8pns_if", "pns_ip": "192.168.8.1/24", "tenant_if": "t8if", "tenant_ip": "192.168.8.2/24"}, "rc": 0, "start": "2019-12-05 07:14:59.998237", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Create Subnet Namespace] ******************************************************************************************************************************
changed: [localhost] => (item={u'route': [{u'ip': u'10.1.71.1/24', u'ns_name': u't8', u'ns_if': u't8if', u'if': u'p1'}], u'default_route_ip': u'10.1.71.1', u'bridge_name': u't8br1', u'dns': [{u'dnsif': u't8s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't8s1_dnsbrif'}], u'ns_name': u't8ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.71.2/24', u'tenant_ns_ip': u'10.1.71.1/24', u'tenant_ns_if': u't8ns1if', u'tenant_ns_name': u't8', u'tenant_sub_if': u't8s1if'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't8_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't8br1if1', u'vmif': u't8VM1if1'}, {u'mem': 4, u'name': u't8_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't8br1if2', u'vmif': u't8VM2if1'}], u'vxlan': [{u'local_ip': u'10.1.71.2', u'tenant_route_ip': u'192.168.8.2', u'dsport': 4789, u'dev': u't8s1if', u'subnet_route': u'10.1.71.0/24', u'remote_route': u'10.2.71.0/24', u'v_name': u'vxlan_t8s1', u'id': 42, u'remote_ip': u'10.2.71.2'}]}) => {"ansible_loop_var": "item", "changed": true, "cmd": ["ip", "netns", "add", "t8ns1"], "delta": "0:00:00.054355", "end": "2019-12-05 07:15:00.381837", "item": {"bridge_name": "t8br1", "default_route_ip": "10.1.71.1", "dns": [{"brif": "t8s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.5", "dnsif": "t8s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t8ns1", "route": [{"if": "p1", "ip": "10.1.71.1/24", "ns_if": "t8if", "ns_name": "t8"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t8ns1if", "tenant_ns_ip": "10.1.71.1/24", "tenant_ns_name": "t8", "tenant_sub_if": "t8s1if", "tenant_sub_ip": "10.1.71.2/24"}], "vms": [{"brif": "t8br1if1", "disk": "10G", "mem": 2, "name": "t8_VM1", "vcpu": 4, "vmif": "t8VM1if1"}, {"brif": "t8br1if2", "disk": "10G", "mem": 4, "name": "t8_VM2", "vcpu": 2, "vmif": "t8VM2if1"}], "vxlan": [{"dev": "t8s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.71.2", "remote_ip": "10.2.71.2", "remote_route": "10.2.71.0/24", "subnet_route": "10.1.71.0/24", "tenant_route_ip": "192.168.8.2", "v_name": "vxlan_t8s1"}]}, "rc": 0, "start": "2019-12-05 07:15:00.327482", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Create Tenant VETH pairs] *****************************************************************************************************************************
changed: [localhost] => (item={u'default_route_ip': u'192.168.8.1', u'name': u't8', u'pns_ip': u'192.168.8.1/24', u'tenant_if': u't8if', u'tenant_ip': u'192.168.8.2/24', u'pns_if': u't8pns_if'}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip link show \"t8if\" ; if [ $? -ne 0 ] ; then ip link add \"t8if\" type veth peer name \"t8pns_if\" ; fi\n", "delta": "0:00:00.015903", "end": "2019-12-05 07:15:00.677475", "item": {"default_route_ip": "192.168.8.1", "name": "t8", "pns_if": "t8pns_if", "pns_ip": "192.168.8.1/24", "tenant_if": "t8if", "tenant_ip": "192.168.8.2/24"}, "rc": 0, "start": "2019-12-05 07:15:00.661572", "stderr": "Device \"t8if\" does not exist.", "stderr_lines": ["Device \"t8if\" does not exist."], "stdout": "", "stdout_lines": []}

TASK [Attach Tenant VETH Pairs] *****************************************************************************************************************************
changed: [localhost] => (item={u'default_route_ip': u'192.168.8.1', u'name': u't8', u'pns_ip': u'192.168.8.1/24', u'tenant_if': u't8if', u'tenant_ip': u'192.168.8.2/24', u'pns_if': u't8pns_if'}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec pns ip link show \"t8pns_if\" ; if [ $? -ne 0 ] ; then ip link set \"t8pns_if\" netns pns ; fi\nip netns exec \"t8\" ip link show \"t8if\" ; if [ $? -ne 0 ] ; then ip link set \"t8if\" netns \"t8\" ; fi\nip netns exec pns ip link set dev \"t8pns_if\" up\nip netns exec \"t8\" ip link set dev \"t8if\" up\n", "delta": "0:00:00.200880", "end": "2019-12-05 07:15:01.145037", "item": {"default_route_ip": "192.168.8.1", "name": "t8", "pns_if": "t8pns_if", "pns_ip": "192.168.8.1/24", "tenant_if": "t8if", "tenant_ip": "192.168.8.2/24"}, "rc": 0, "start": "2019-12-05 07:15:00.944157", "stderr": "Device \"t8pns_if\" does not exist.\nDevice \"t8if\" does not exist.", "stderr_lines": ["Device \"t8pns_if\" does not exist.", "Device \"t8if\" does not exist."], "stdout": "", "stdout_lines": []}

TASK [Add IP addresses to Tenant VETH Pairs] ****************************************************************************************************************
changed: [localhost] => (item={u'default_route_ip': u'192.168.8.1', u'name': u't8', u'pns_ip': u'192.168.8.1/24', u'tenant_if': u't8if', u'tenant_ip': u'192.168.8.2/24', u'pns_if': u't8pns_if'}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec pns ip addr show \"t8pns_if\" | awk 'FNR==3{ print $2 }' | grep -w '^192.168.8.1/24' ; if [ $? -ne 0 ] ; then ip netns exec pns ip addr add \"192.168.8.1/24\" dev \"t8pns_if\" ; fi\nip netns exec \"t8\" ip addr show \"t8if\" | awk 'FNR==3{ print $2 }' | grep -w '^192.168.8.2/24' ; if [ $? -ne 0 ] ; then ip netns exec \"t8\" ip addr add \"192.168.8.2/24\" dev \"t8if\" ; fi\n", "delta": "0:00:00.152057", "end": "2019-12-05 07:15:01.577016", "item": {"default_route_ip": "192.168.8.1", "name": "t8", "pns_if": "t8pns_if", "pns_ip": "192.168.8.1/24", "tenant_if": "t8if", "tenant_ip": "192.168.8.2/24"}, "rc": 0, "start": "2019-12-05 07:15:01.424959", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Create Namespace VETH Pairs] **************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.71.1/24', u'ns_name': u't8', u'ns_if': u't8if', u'if': u'p1'}], u'default_route_ip': u'10.1.71.1', u'bridge_name': u't8br1', u'dns': [{u'dnsif': u't8s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't8s1_dnsbrif'}], u'ns_name': u't8ns1', u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't8_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't8br1if1', u'vmif': u't8VM1if1'}, {u'mem': 4, u'name': u't8_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't8br1if2', u'vmif': u't8VM2if1'}], u'vxlan': [{u'local_ip': u'10.1.71.2', u'dsport': 4789, u'dev': u't8s1if', u'tenant_route_ip': u'192.168.8.2', u'remote_route': u'10.2.71.0/24', u'subnet_route': u'10.1.71.0/24', u'v_name': u'vxlan_t8s1', u'id': 42, u'remote_ip': u'10.2.71.2'}]}, {u'tenant_sub_ip': u'10.1.71.2/24', u'tenant_ns_ip': u'10.1.71.1/24', u'tenant_ns_if': u't8ns1if', u'tenant_sub_if': u't8s1if', u'tenant_ns_name': u't8'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip link show \"t8ns1if\" ; if [ $? -ne 0 ] ; then ip link add \"t8ns1if\" type veth peer name \"t8s1if\" ; fi\n", "delta": "0:00:00.021209", "end": "2019-12-05 07:15:01.882421", "item": [{"bridge_name": "t8br1", "default_route_ip": "10.1.71.1", "dns": [{"brif": "t8s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.5", "dnsif": "t8s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t8ns1", "route": [{"if": "p1", "ip": "10.1.71.1/24", "ns_if": "t8if", "ns_name": "t8"}], "subnet_ip": "1.1.1.0/24", "vms": [{"brif": "t8br1if1", "disk": "10G", "mem": 2, "name": "t8_VM1", "vcpu": 4, "vmif": "t8VM1if1"}, {"brif": "t8br1if2", "disk": "10G", "mem": 4, "name": "t8_VM2", "vcpu": 2, "vmif": "t8VM2if1"}], "vxlan": [{"dev": "t8s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.71.2", "remote_ip": "10.2.71.2", "remote_route": "10.2.71.0/24", "subnet_route": "10.1.71.0/24", "tenant_route_ip": "192.168.8.2", "v_name": "vxlan_t8s1"}]}, {"tenant_ns_if": "t8ns1if", "tenant_ns_ip": "10.1.71.1/24", "tenant_ns_name": "t8", "tenant_sub_if": "t8s1if", "tenant_sub_ip": "10.1.71.2/24"}], "rc": 0, "start": "2019-12-05 07:15:01.861212", "stderr": "Device \"t8ns1if\" does not exist.", "stderr_lines": ["Device \"t8ns1if\" does not exist."], "stdout": "", "stdout_lines": []}

TASK [Attach Namespace VETH Pairs] **************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.71.1/24', u'ns_name': u't8', u'ns_if': u't8if', u'if': u'p1'}], u'default_route_ip': u'10.1.71.1', u'bridge_name': u't8br1', u'dns': [{u'dnsif': u't8s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't8s1_dnsbrif'}], u'ns_name': u't8ns1', u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't8_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't8br1if1', u'vmif': u't8VM1if1'}, {u'mem': 4, u'name': u't8_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't8br1if2', u'vmif': u't8VM2if1'}], u'vxlan': [{u'local_ip': u'10.1.71.2', u'dsport': 4789, u'dev': u't8s1if', u'tenant_route_ip': u'192.168.8.2', u'remote_route': u'10.2.71.0/24', u'subnet_route': u'10.1.71.0/24', u'v_name': u'vxlan_t8s1', u'id': 42, u'remote_ip': u'10.2.71.2'}]}, {u'tenant_sub_ip': u'10.1.71.2/24', u'tenant_ns_ip': u'10.1.71.1/24', u'tenant_ns_if': u't8ns1if', u'tenant_sub_if': u't8s1if', u'tenant_ns_name': u't8'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t8\" ip link show \"t8ns1if\" ; if [ $? -ne 0 ] ; then ip link set \"t8ns1if\" netns \"t8\" ; fi\nip netns exec \"t8ns1\" ip link show \"t8s1if\" ; if [ $? -ne 0 ] ; then ip link set \"t8s1if\" netns \"t8ns1\" ; fi\n", "delta": "0:00:00.113948", "end": "2019-12-05 07:15:02.314276", "item": [{"bridge_name": "t8br1", "default_route_ip": "10.1.71.1", "dns": [{"brif": "t8s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.5", "dnsif": "t8s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t8ns1", "route": [{"if": "p1", "ip": "10.1.71.1/24", "ns_if": "t8if", "ns_name": "t8"}], "subnet_ip": "1.1.1.0/24", "vms": [{"brif": "t8br1if1", "disk": "10G", "mem": 2, "name": "t8_VM1", "vcpu": 4, "vmif": "t8VM1if1"}, {"brif": "t8br1if2", "disk": "10G", "mem": 4, "name": "t8_VM2", "vcpu": 2, "vmif": "t8VM2if1"}], "vxlan": [{"dev": "t8s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.71.2", "remote_ip": "10.2.71.2", "remote_route": "10.2.71.0/24", "subnet_route": "10.1.71.0/24", "tenant_route_ip": "192.168.8.2", "v_name": "vxlan_t8s1"}]}, {"tenant_ns_if": "t8ns1if", "tenant_ns_ip": "10.1.71.1/24", "tenant_ns_name": "t8", "tenant_sub_if": "t8s1if", "tenant_sub_ip": "10.1.71.2/24"}], "rc": 0, "start": "2019-12-05 07:15:02.200328", "stderr": "Device \"t8ns1if\" does not exist.\nDevice \"t8s1if\" does not exist.", "stderr_lines": ["Device \"t8ns1if\" does not exist.", "Device \"t8s1if\" does not exist."], "stdout": "", "stdout_lines": []}

TASK [Set Namespace VETH Pairs UP] **************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.71.1/24', u'ns_name': u't8', u'ns_if': u't8if', u'if': u'p1'}], u'default_route_ip': u'10.1.71.1', u'bridge_name': u't8br1', u'dns': [{u'dnsif': u't8s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't8s1_dnsbrif'}], u'ns_name': u't8ns1', u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't8_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't8br1if1', u'vmif': u't8VM1if1'}, {u'mem': 4, u'name': u't8_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't8br1if2', u'vmif': u't8VM2if1'}], u'vxlan': [{u'local_ip': u'10.1.71.2', u'dsport': 4789, u'dev': u't8s1if', u'tenant_route_ip': u'192.168.8.2', u'remote_route': u'10.2.71.0/24', u'subnet_route': u'10.1.71.0/24', u'v_name': u'vxlan_t8s1', u'id': 42, u'remote_ip': u'10.2.71.2'}]}, {u'tenant_sub_ip': u'10.1.71.2/24', u'tenant_ns_ip': u'10.1.71.1/24', u'tenant_ns_if': u't8ns1if', u'tenant_sub_if': u't8s1if', u'tenant_ns_name': u't8'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t8\" ip link set dev \"t8ns1if\" up\nip netns exec \"t8ns1\" ip link set dev \"t8s1if\" up\n", "delta": "0:00:00.083220", "end": "2019-12-05 07:15:02.657115", "item": [{"bridge_name": "t8br1", "default_route_ip": "10.1.71.1", "dns": [{"brif": "t8s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.5", "dnsif": "t8s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t8ns1", "route": [{"if": "p1", "ip": "10.1.71.1/24", "ns_if": "t8if", "ns_name": "t8"}], "subnet_ip": "1.1.1.0/24", "vms": [{"brif": "t8br1if1", "disk": "10G", "mem": 2, "name": "t8_VM1", "vcpu": 4, "vmif": "t8VM1if1"}, {"brif": "t8br1if2", "disk": "10G", "mem": 4, "name": "t8_VM2", "vcpu": 2, "vmif": "t8VM2if1"}], "vxlan": [{"dev": "t8s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.71.2", "remote_ip": "10.2.71.2", "remote_route": "10.2.71.0/24", "subnet_route": "10.1.71.0/24", "tenant_route_ip": "192.168.8.2", "v_name": "vxlan_t8s1"}]}, {"tenant_ns_if": "t8ns1if", "tenant_ns_ip": "10.1.71.1/24", "tenant_ns_name": "t8", "tenant_sub_if": "t8s1if", "tenant_sub_ip": "10.1.71.2/24"}], "rc": 0, "start": "2019-12-05 07:15:02.573895", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Add IP addresses to Namespace VETH Pairs] *************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.71.1/24', u'ns_name': u't8', u'ns_if': u't8if', u'if': u'p1'}], u'default_route_ip': u'10.1.71.1', u'bridge_name': u't8br1', u'dns': [{u'dnsif': u't8s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't8s1_dnsbrif'}], u'ns_name': u't8ns1', u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't8_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't8br1if1', u'vmif': u't8VM1if1'}, {u'mem': 4, u'name': u't8_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't8br1if2', u'vmif': u't8VM2if1'}], u'vxlan': [{u'local_ip': u'10.1.71.2', u'dsport': 4789, u'dev': u't8s1if', u'tenant_route_ip': u'192.168.8.2', u'remote_route': u'10.2.71.0/24', u'subnet_route': u'10.1.71.0/24', u'v_name': u'vxlan_t8s1', u'id': 42, u'remote_ip': u'10.2.71.2'}]}, {u'tenant_sub_ip': u'10.1.71.2/24', u'tenant_ns_ip': u'10.1.71.1/24', u'tenant_ns_if': u't8ns1if', u'tenant_sub_if': u't8s1if', u'tenant_ns_name': u't8'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t8ns1\" ip addr show \"t8s1if\" | awk 'FNR==3{ print $2 }' | grep -w '^10.1.71.2/24' ; if [ $? -ne 0 ] ; then ip netns exec \"t8ns1\" ip addr add \"10.1.71.2/24\" dev \"t8s1if\" ; fi\n\nip netns exec \"t8\" ip addr show \"t8ns1if\" | awk 'FNR==3{ print $2 }' | grep -w '^10.1.71.1/24' ; if [ $? -ne 0 ] ; then ip netns exec \"t8\" ip addr add \"10.1.71.1/24\" dev \"t8ns1if\" ; fi\n", "delta": "0:00:00.152544", "end": "2019-12-05 07:15:03.084999", "item": [{"bridge_name": "t8br1", "default_route_ip": "10.1.71.1", "dns": [{"brif": "t8s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.5", "dnsif": "t8s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t8ns1", "route": [{"if": "p1", "ip": "10.1.71.1/24", "ns_if": "t8if", "ns_name": "t8"}], "subnet_ip": "1.1.1.0/24", "vms": [{"brif": "t8br1if1", "disk": "10G", "mem": 2, "name": "t8_VM1", "vcpu": 4, "vmif": "t8VM1if1"}, {"brif": "t8br1if2", "disk": "10G", "mem": 4, "name": "t8_VM2", "vcpu": 2, "vmif": "t8VM2if1"}], "vxlan": [{"dev": "t8s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.71.2", "remote_ip": "10.2.71.2", "remote_route": "10.2.71.0/24", "subnet_route": "10.1.71.0/24", "tenant_route_ip": "192.168.8.2", "v_name": "vxlan_t8s1"}]}, {"tenant_ns_if": "t8ns1if", "tenant_ns_ip": "10.1.71.1/24", "tenant_ns_name": "t8", "tenant_sub_if": "t8s1if", "tenant_sub_ip": "10.1.71.2/24"}], "rc": 0, "start": "2019-12-05 07:15:02.932455", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Add IP Route to Tenant] *******************************************************************************************************************************
changed: [localhost] => (item={u'default_route_ip': u'192.168.8.1', u'name': u't8', u'pns_ip': u'192.168.8.1/24', u'tenant_if': u't8if', u'tenant_ip': u'192.168.8.2/24', u'pns_if': u't8pns_if'}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t8\" ip route show default | grep -w '[d]efault via 192.168.8.1' ; if [ $? -ne 0 ] ; then ip netns exec \"t8\" ip route add default via \"192.168.8.1\" ; fi\n", "delta": "0:00:00.091185", "end": "2019-12-05 07:15:03.441259", "item": {"default_route_ip": "192.168.8.1", "name": "t8", "pns_if": "t8pns_if", "pns_ip": "192.168.8.1/24", "tenant_if": "t8if", "tenant_ip": "192.168.8.2/24"}, "rc": 0, "start": "2019-12-05 07:15:03.350074", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Add IP Route to Tenant Subnet] ************************************************************************************************************************
changed: [localhost] => (item={u'route': [{u'ip': u'10.1.71.1/24', u'ns_name': u't8', u'ns_if': u't8if', u'if': u'p1'}], u'default_route_ip': u'10.1.71.1', u'bridge_name': u't8br1', u'dns': [{u'dnsif': u't8s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't8s1_dnsbrif'}], u'ns_name': u't8ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.71.2/24', u'tenant_ns_ip': u'10.1.71.1/24', u'tenant_ns_if': u't8ns1if', u'tenant_ns_name': u't8', u'tenant_sub_if': u't8s1if'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't8_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't8br1if1', u'vmif': u't8VM1if1'}, {u'mem': 4, u'name': u't8_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't8br1if2', u'vmif': u't8VM2if1'}], u'vxlan': [{u'local_ip': u'10.1.71.2', u'tenant_route_ip': u'192.168.8.2', u'dsport': 4789, u'dev': u't8s1if', u'subnet_route': u'10.1.71.0/24', u'remote_route': u'10.2.71.0/24', u'v_name': u'vxlan_t8s1', u'id': 42, u'remote_ip': u'10.2.71.2'}]}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t8ns1\" ip route show default | grep -w '[d]efault via 10.1.71.1' ; if [ $? -ne 0 ] ; then ip netns exec \"t8ns1\" ip route add default via \"10.1.71.1\" ; fi\n", "delta": "0:00:00.089273", "end": "2019-12-05 07:15:03.801140", "item": {"bridge_name": "t8br1", "default_route_ip": "10.1.71.1", "dns": [{"brif": "t8s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.5", "dnsif": "t8s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t8ns1", "route": [{"if": "p1", "ip": "10.1.71.1/24", "ns_if": "t8if", "ns_name": "t8"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t8ns1if", "tenant_ns_ip": "10.1.71.1/24", "tenant_ns_name": "t8", "tenant_sub_if": "t8s1if", "tenant_sub_ip": "10.1.71.2/24"}], "vms": [{"brif": "t8br1if1", "disk": "10G", "mem": 2, "name": "t8_VM1", "vcpu": 4, "vmif": "t8VM1if1"}, {"brif": "t8br1if2", "disk": "10G", "mem": 4, "name": "t8_VM2", "vcpu": 2, "vmif": "t8VM2if1"}], "vxlan": [{"dev": "t8s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.71.2", "remote_ip": "10.2.71.2", "remote_route": "10.2.71.0/24", "subnet_route": "10.1.71.0/24", "tenant_route_ip": "192.168.8.2", "v_name": "vxlan_t8s1"}]}, "rc": 0, "start": "2019-12-05 07:15:03.711867", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Create bridge inside namespace] ***********************************************************************************************************************
changed: [localhost] => (item={u'route': [{u'ip': u'10.1.71.1/24', u'ns_name': u't8', u'ns_if': u't8if', u'if': u'p1'}], u'default_route_ip': u'10.1.71.1', u'bridge_name': u't8br1', u'dns': [{u'dnsif': u't8s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't8s1_dnsbrif'}], u'ns_name': u't8ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.71.2/24', u'tenant_ns_ip': u'10.1.71.1/24', u'tenant_ns_if': u't8ns1if', u'tenant_ns_name': u't8', u'tenant_sub_if': u't8s1if'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't8_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't8br1if1', u'vmif': u't8VM1if1'}, {u'mem': 4, u'name': u't8_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't8br1if2', u'vmif': u't8VM2if1'}], u'vxlan': [{u'local_ip': u'10.1.71.2', u'tenant_route_ip': u'192.168.8.2', u'dsport': 4789, u'dev': u't8s1if', u'subnet_route': u'10.1.71.0/24', u'remote_route': u'10.2.71.0/24', u'v_name': u'vxlan_t8s1', u'id': 42, u'remote_ip': u'10.2.71.2'}]}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t8ns1\" brctl show | grep -w '^t8br1'; if [ $? -ne 0 ] ; then ip netns exec \"t8ns1\" brctl addbr \"t8br1\" ; fi\nip netns exec \"t8ns1\" ip link set dev \"t8br1\" up\n", "delta": "0:00:00.101049", "end": "2019-12-05 07:15:04.177125", "item": {"bridge_name": "t8br1", "default_route_ip": "10.1.71.1", "dns": [{"brif": "t8s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.5", "dnsif": "t8s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t8ns1", "route": [{"if": "p1", "ip": "10.1.71.1/24", "ns_if": "t8if", "ns_name": "t8"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t8ns1if", "tenant_ns_ip": "10.1.71.1/24", "tenant_ns_name": "t8", "tenant_sub_if": "t8s1if", "tenant_sub_ip": "10.1.71.2/24"}], "vms": [{"brif": "t8br1if1", "disk": "10G", "mem": 2, "name": "t8_VM1", "vcpu": 4, "vmif": "t8VM1if1"}, {"brif": "t8br1if2", "disk": "10G", "mem": 4, "name": "t8_VM2", "vcpu": 2, "vmif": "t8VM2if1"}], "vxlan": [{"dev": "t8s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.71.2", "remote_ip": "10.2.71.2", "remote_route": "10.2.71.0/24", "subnet_route": "10.1.71.0/24", "tenant_route_ip": "192.168.8.2", "v_name": "vxlan_t8s1"}]}, "rc": 0, "start": "2019-12-05 07:15:04.076076", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Create DNS VETH Pair] *********************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.71.1/24', u'ns_name': u't8', u'ns_if': u't8if', u'if': u'p1'}], u'default_route_ip': u'10.1.71.1', u'bridge_name': u't8br1', u'ns_name': u't8ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.71.2/24', u'tenant_ns_ip': u'10.1.71.1/24', u'tenant_ns_if': u't8ns1if', u'tenant_sub_if': u't8s1if', u'tenant_ns_name': u't8'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't8_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't8br1if1', u'vmif': u't8VM1if1'}, {u'mem': 4, u'name': u't8_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't8br1if2', u'vmif': u't8VM2if1'}], u'vxlan': [{u'local_ip': u'10.1.71.2', u'dsport': 4789, u'dev': u't8s1if', u'tenant_route_ip': u'192.168.8.2', u'remote_route': u'10.2.71.0/24', u'subnet_route': u'10.1.71.0/24', u'v_name': u'vxlan_t8s1', u'id': 42, u'remote_ip': u'10.2.71.2'}]}, {u'dnsif': u't8s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't8s1_dnsbrif'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t8ns1\" ip link show \"t8s1_dnsbrif\" ; if [ $? -ne 0 ] ; then ip netns exec \"t8ns1\" ip link add \"t8s1_dnsbrif\" type veth peer name \"t8s1_dnsif\" ; fi\nip netns exec \"t8ns1\" ip link set dev \"t8s1_dnsbrif\" up\nip netns exec \"t8ns1\" ip link set dev \"t8s1_dnsif\" up\n", "delta": "0:00:00.140873", "end": "2019-12-05 07:15:04.637182", "item": [{"bridge_name": "t8br1", "default_route_ip": "10.1.71.1", "ns_name": "t8ns1", "route": [{"if": "p1", "ip": "10.1.71.1/24", "ns_if": "t8if", "ns_name": "t8"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t8ns1if", "tenant_ns_ip": "10.1.71.1/24", "tenant_ns_name": "t8", "tenant_sub_if": "t8s1if", "tenant_sub_ip": "10.1.71.2/24"}], "vms": [{"brif": "t8br1if1", "disk": "10G", "mem": 2, "name": "t8_VM1", "vcpu": 4, "vmif": "t8VM1if1"}, {"brif": "t8br1if2", "disk": "10G", "mem": 4, "name": "t8_VM2", "vcpu": 2, "vmif": "t8VM2if1"}], "vxlan": [{"dev": "t8s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.71.2", "remote_ip": "10.2.71.2", "remote_route": "10.2.71.0/24", "subnet_route": "10.1.71.0/24", "tenant_route_ip": "192.168.8.2", "v_name": "vxlan_t8s1"}]}, {"brif": "t8s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.5", "dnsif": "t8s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "rc": 0, "start": "2019-12-05 07:15:04.496309", "stderr": "Device \"t8s1_dnsbrif\" does not exist.", "stderr_lines": ["Device \"t8s1_dnsbrif\" does not exist."], "stdout": "", "stdout_lines": []}

TASK [Attach DNS VETH Pair] *********************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.71.1/24', u'ns_name': u't8', u'ns_if': u't8if', u'if': u'p1'}], u'default_route_ip': u'10.1.71.1', u'bridge_name': u't8br1', u'ns_name': u't8ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.71.2/24', u'tenant_ns_ip': u'10.1.71.1/24', u'tenant_ns_if': u't8ns1if', u'tenant_sub_if': u't8s1if', u'tenant_ns_name': u't8'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't8_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't8br1if1', u'vmif': u't8VM1if1'}, {u'mem': 4, u'name': u't8_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't8br1if2', u'vmif': u't8VM2if1'}], u'vxlan': [{u'local_ip': u'10.1.71.2', u'dsport': 4789, u'dev': u't8s1if', u'tenant_route_ip': u'192.168.8.2', u'remote_route': u'10.2.71.0/24', u'subnet_route': u'10.1.71.0/24', u'v_name': u'vxlan_t8s1', u'id': 42, u'remote_ip': u'10.2.71.2'}]}, {u'dnsif': u't8s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't8s1_dnsbrif'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t8ns1\" brctl show \"t8br1\" | grep -w 't8s1_dnsbrif' ; if [ $? -ne 0 ] ; then ip netns exec \"t8ns1\" brctl addif \"t8br1\" \"t8s1_dnsbrif\" ; fi\n", "delta": "0:00:00.089519", "end": "2019-12-05 07:15:05.013079", "item": [{"bridge_name": "t8br1", "default_route_ip": "10.1.71.1", "ns_name": "t8ns1", "route": [{"if": "p1", "ip": "10.1.71.1/24", "ns_if": "t8if", "ns_name": "t8"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t8ns1if", "tenant_ns_ip": "10.1.71.1/24", "tenant_ns_name": "t8", "tenant_sub_if": "t8s1if", "tenant_sub_ip": "10.1.71.2/24"}], "vms": [{"brif": "t8br1if1", "disk": "10G", "mem": 2, "name": "t8_VM1", "vcpu": 4, "vmif": "t8VM1if1"}, {"brif": "t8br1if2", "disk": "10G", "mem": 4, "name": "t8_VM2", "vcpu": 2, "vmif": "t8VM2if1"}], "vxlan": [{"dev": "t8s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.71.2", "remote_ip": "10.2.71.2", "remote_route": "10.2.71.0/24", "subnet_route": "10.1.71.0/24", "tenant_route_ip": "192.168.8.2", "v_name": "vxlan_t8s1"}]}, {"brif": "t8s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.5", "dnsif": "t8s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "rc": 0, "start": "2019-12-05 07:15:04.923560", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Create VETH Pairs] ************************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.71.1/24', u'ns_name': u't8', u'ns_if': u't8if', u'if': u'p1'}], u'default_route_ip': u'10.1.71.1', u'bridge_name': u't8br1', u'dns': [{u'dnsif': u't8s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't8s1_dnsbrif'}], u'ns_name': u't8ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.71.2/24', u'tenant_ns_ip': u'10.1.71.1/24', u'tenant_ns_if': u't8ns1if', u'tenant_sub_if': u't8s1if', u'tenant_ns_name': u't8'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.1.71.2', u'dsport': 4789, u'dev': u't8s1if', u'tenant_route_ip': u'192.168.8.2', u'remote_route': u'10.2.71.0/24', u'subnet_route': u'10.1.71.0/24', u'v_name': u'vxlan_t8s1', u'id': 42, u'remote_ip': u'10.2.71.2'}]}, {u'mem': 2, u'name': u't8_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't8br1if1', u'vmif': u't8VM1if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip link show \"t8br1if1\" ; if [ $? -ne 0 ] ; then ip link add \"t8VM1if1\" type veth peer name \"t8br1if1\" ; fi\nip link set dev \"t8br1if1\" up\nip link set dev \"t8VM1if1\" up\n", "delta": "0:00:00.021457", "end": "2019-12-05 07:15:05.323237", "item": [{"bridge_name": "t8br1", "default_route_ip": "10.1.71.1", "dns": [{"brif": "t8s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.5", "dnsif": "t8s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t8ns1", "route": [{"if": "p1", "ip": "10.1.71.1/24", "ns_if": "t8if", "ns_name": "t8"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t8ns1if", "tenant_ns_ip": "10.1.71.1/24", "tenant_ns_name": "t8", "tenant_sub_if": "t8s1if", "tenant_sub_ip": "10.1.71.2/24"}], "vxlan": [{"dev": "t8s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.71.2", "remote_ip": "10.2.71.2", "remote_route": "10.2.71.0/24", "subnet_route": "10.1.71.0/24", "tenant_route_ip": "192.168.8.2", "v_name": "vxlan_t8s1"}]}, {"brif": "t8br1if1", "disk": "10G", "mem": 2, "name": "t8_VM1", "vcpu": 4, "vmif": "t8VM1if1"}], "rc": 0, "start": "2019-12-05 07:15:05.301780", "stderr": "Device \"t8br1if1\" does not exist.", "stderr_lines": ["Device \"t8br1if1\" does not exist."], "stdout": "", "stdout_lines": []}
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.71.1/24', u'ns_name': u't8', u'ns_if': u't8if', u'if': u'p1'}], u'default_route_ip': u'10.1.71.1', u'bridge_name': u't8br1', u'dns': [{u'dnsif': u't8s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't8s1_dnsbrif'}], u'ns_name': u't8ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.71.2/24', u'tenant_ns_ip': u'10.1.71.1/24', u'tenant_ns_if': u't8ns1if', u'tenant_sub_if': u't8s1if', u'tenant_ns_name': u't8'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.1.71.2', u'dsport': 4789, u'dev': u't8s1if', u'tenant_route_ip': u'192.168.8.2', u'remote_route': u'10.2.71.0/24', u'subnet_route': u'10.1.71.0/24', u'v_name': u'vxlan_t8s1', u'id': 42, u'remote_ip': u'10.2.71.2'}]}, {u'mem': 4, u'name': u't8_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't8br1if2', u'vmif': u't8VM2if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip link show \"t8br1if2\" ; if [ $? -ne 0 ] ; then ip link add \"t8VM2if1\" type veth peer name \"t8br1if2\" ; fi\nip link set dev \"t8br1if2\" up\nip link set dev \"t8VM2if1\" up\n", "delta": "0:00:00.019350", "end": "2019-12-05 07:15:05.568576", "item": [{"bridge_name": "t8br1", "default_route_ip": "10.1.71.1", "dns": [{"brif": "t8s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.5", "dnsif": "t8s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t8ns1", "route": [{"if": "p1", "ip": "10.1.71.1/24", "ns_if": "t8if", "ns_name": "t8"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t8ns1if", "tenant_ns_ip": "10.1.71.1/24", "tenant_ns_name": "t8", "tenant_sub_if": "t8s1if", "tenant_sub_ip": "10.1.71.2/24"}], "vxlan": [{"dev": "t8s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.71.2", "remote_ip": "10.2.71.2", "remote_route": "10.2.71.0/24", "subnet_route": "10.1.71.0/24", "tenant_route_ip": "192.168.8.2", "v_name": "vxlan_t8s1"}]}, {"brif": "t8br1if2", "disk": "10G", "mem": 4, "name": "t8_VM2", "vcpu": 2, "vmif": "t8VM2if1"}], "rc": 0, "start": "2019-12-05 07:15:05.549226", "stderr": "Device \"t8br1if2\" does not exist.", "stderr_lines": ["Device \"t8br1if2\" does not exist."], "stdout": "", "stdout_lines": []}

TASK [Attach VETH Pairs] ************************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.71.1/24', u'ns_name': u't8', u'ns_if': u't8if', u'if': u'p1'}], u'default_route_ip': u'10.1.71.1', u'bridge_name': u't8br1', u'dns': [{u'dnsif': u't8s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't8s1_dnsbrif'}], u'ns_name': u't8ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.71.2/24', u'tenant_ns_ip': u'10.1.71.1/24', u'tenant_ns_if': u't8ns1if', u'tenant_sub_if': u't8s1if', u'tenant_ns_name': u't8'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.1.71.2', u'dsport': 4789, u'dev': u't8s1if', u'tenant_route_ip': u'192.168.8.2', u'remote_route': u'10.2.71.0/24', u'subnet_route': u'10.1.71.0/24', u'v_name': u'vxlan_t8s1', u'id': 42, u'remote_ip': u'10.2.71.2'}]}, {u'mem': 2, u'name': u't8_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't8br1if1', u'vmif': u't8VM1if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip link show \"t8br1if1\" ; if [ $? -eq 0 ] ; then ip link set \"t8br1if1\" netns \"t8ns1\" ; fi\nip netns exec \"t8ns1\" brctl show \"t8br1\" | grep -w 't8br1if1' ; if [ $? -ne 0 ] ; then ip netns exec \"t8ns1\" brctl addif \"t8br1\" \"t8br1if1\" ; fi\n", "delta": "0:00:00.091278", "end": "2019-12-05 07:15:05.937048", "item": [{"bridge_name": "t8br1", "default_route_ip": "10.1.71.1", "dns": [{"brif": "t8s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.5", "dnsif": "t8s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t8ns1", "route": [{"if": "p1", "ip": "10.1.71.1/24", "ns_if": "t8if", "ns_name": "t8"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t8ns1if", "tenant_ns_ip": "10.1.71.1/24", "tenant_ns_name": "t8", "tenant_sub_if": "t8s1if", "tenant_sub_ip": "10.1.71.2/24"}], "vxlan": [{"dev": "t8s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.71.2", "remote_ip": "10.2.71.2", "remote_route": "10.2.71.0/24", "subnet_route": "10.1.71.0/24", "tenant_route_ip": "192.168.8.2", "v_name": "vxlan_t8s1"}]}, {"brif": "t8br1if1", "disk": "10G", "mem": 2, "name": "t8_VM1", "vcpu": 4, "vmif": "t8VM1if1"}], "rc": 0, "start": "2019-12-05 07:15:05.845770", "stderr": "", "stderr_lines": [], "stdout": "59: t8br1if1@t8VM1if1: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP mode DEFAULT group default qlen 1000\n    link/ether d6:3e:2b:38:02:2a brd ff:ff:ff:ff:ff:ff", "stdout_lines": ["59: t8br1if1@t8VM1if1: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP mode DEFAULT group default qlen 1000", "    link/ether d6:3e:2b:38:02:2a brd ff:ff:ff:ff:ff:ff"]}
INFO:root: 07:15:06.149761 Printing the yaml input file
INFO:root: 07:15:06.149859 {'C1': [{'subnet_addr': '1.1.1.0/24', 'VM': [{'name': 'VM1', 'disk': '10G', 'mem': 2, 'vcpu': 4, 'internet_access': True}, {'name': 'VM2', 'disk': '10G', 'mem': 4, 'vcpu': 2, 'internet_access': False}]}], 'C2': [{'subnet_addr': '1.1.1.0/24', 'VM': [{'name': 'VM4', 'disk': '10G', 'mem': 2, 'vcpu': 4, 'internet_access': True}]}, {'subnet_addr': '2.2.2.0/24', 'VM': [{'name': 'VM3', 'disk': '10G', 'mem': 3, 'vcpu': 2, 'internet_access': True}]}], 'MISC': [{'LOG_ENABLE': True}, {'GUI': True}]}
INFO:root: 07:15:06.149945 Provided subnet in C1: 1.1.1.0/24 is valid
INFO:root: 07:15:06.149991 Provided subnet in C2: 1.1.1.0/24 is valid
INFO:root: 07:15:06.150029 Provided subnet in C2: 2.2.2.0/24 is valid
INFO:root: 07:20:26.304899 Printing the yaml input file
INFO:root: 07:20:26.305052 {'C1': [{'subnet_addr': '1.1.1.0/24', 'VM': [{'name': 'VM1', 'disk': '10G', 'mem': 2, 'vcpu': 4, 'internet_access': True}, {'name': 'VM2', 'disk': '10G', 'mem': 4, 'vcpu': 2, 'internet_access': False}]}], 'C2': [{'subnet_addr': '1.1.1.0/24', 'VM': [{'name': 'VM4', 'disk': '10G', 'mem': 2, 'vcpu': 4, 'internet_access': True}]}, {'subnet_addr': '2.2.2.0/24', 'VM': [{'name': 'VM3', 'disk': '10G', 'mem': 3, 'vcpu': 2, 'internet_access': True}]}], 'MISC': [{'LOG_ENABLE': True}, {'GUI': True}]}
INFO:root: 07:20:26.305160 Provided subnet in C1: 1.1.1.0/24 is valid
INFO:root: 07:20:26.305212 Provided subnet in C2: 1.1.1.0/24 is valid
INFO:root: 07:20:26.305255 Provided subnet in C2: 2.2.2.0/24 is valid
Using /etc/ansible/ansible.cfg as config file

PLAY [main] *************************************************************************************************************************************************

TASK [Create Tenant Namespace] ******************************************************************************************************************************
changed: [localhost] => (item={u'default_route_ip': u'192.168.9.1', u'name': u't9', u'pns_ip': u'192.168.9.1/24', u'tenant_if': u't9if', u'tenant_ip': u'192.168.9.2/24', u'pns_if': u't9pns_if'}) => {"ansible_loop_var": "item", "changed": true, "cmd": ["ip", "netns", "add", "t9"], "delta": "0:00:00.078262", "end": "2019-12-05 07:20:27.509853", "item": {"default_route_ip": "192.168.9.1", "name": "t9", "pns_if": "t9pns_if", "pns_ip": "192.168.9.1/24", "tenant_if": "t9if", "tenant_ip": "192.168.9.2/24"}, "rc": 0, "start": "2019-12-05 07:20:27.431591", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Create Subnet Namespace] ******************************************************************************************************************************
changed: [localhost] => (item={u'route': [{u'ip': u'10.1.81.1/24', u'ns_name': u't9', u'ns_if': u't9if', u'if': u'p1'}], u'default_route_ip': u'10.1.81.1', u'bridge_name': u't9br1', u'dns': [{u'dnsif': u't9s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't9s1_dnsbrif'}], u'ns_name': u't9ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.81.2/24', u'tenant_ns_ip': u'10.1.81.1/24', u'tenant_ns_if': u't9ns1if', u'tenant_ns_name': u't9', u'tenant_sub_if': u't9s1if'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't9_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't9br1if1', u'vmif': u't9VM1if1'}, {u'mem': 4, u'name': u't9_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't9br1if2', u'vmif': u't9VM2if1'}], u'vxlan': [{u'local_ip': u'10.1.81.2', u'tenant_route_ip': u'192.168.9.2', u'dsport': 4789, u'dev': u't9s1if', u'subnet_route': u'10.1.81.0/24', u'remote_route': u'10.2.81.0/24', u'v_name': u'vxlan_t9s1', u'id': 42, u'remote_ip': u'10.2.81.2'}]}) => {"ansible_loop_var": "item", "changed": true, "cmd": ["ip", "netns", "add", "t9ns1"], "delta": "0:00:00.074138", "end": "2019-12-05 07:20:27.848057", "item": {"bridge_name": "t9br1", "default_route_ip": "10.1.81.1", "dns": [{"brif": "t9s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.5", "dnsif": "t9s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t9ns1", "route": [{"if": "p1", "ip": "10.1.81.1/24", "ns_if": "t9if", "ns_name": "t9"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t9ns1if", "tenant_ns_ip": "10.1.81.1/24", "tenant_ns_name": "t9", "tenant_sub_if": "t9s1if", "tenant_sub_ip": "10.1.81.2/24"}], "vms": [{"brif": "t9br1if1", "disk": "10G", "mem": 2, "name": "t9_VM1", "vcpu": 4, "vmif": "t9VM1if1"}, {"brif": "t9br1if2", "disk": "10G", "mem": 4, "name": "t9_VM2", "vcpu": 2, "vmif": "t9VM2if1"}], "vxlan": [{"dev": "t9s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.81.2", "remote_ip": "10.2.81.2", "remote_route": "10.2.81.0/24", "subnet_route": "10.1.81.0/24", "tenant_route_ip": "192.168.9.2", "v_name": "vxlan_t9s1"}]}, "rc": 0, "start": "2019-12-05 07:20:27.773919", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Create Tenant VETH pairs] *****************************************************************************************************************************
changed: [localhost] => (item={u'default_route_ip': u'192.168.9.1', u'name': u't9', u'pns_ip': u'192.168.9.1/24', u'tenant_if': u't9if', u'tenant_ip': u'192.168.9.2/24', u'pns_if': u't9pns_if'}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip link show \"t9if\" ; if [ $? -ne 0 ] ; then ip link add \"t9if\" type veth peer name \"t9pns_if\" ; fi\n", "delta": "0:00:00.019213", "end": "2019-12-05 07:20:28.131997", "item": {"default_route_ip": "192.168.9.1", "name": "t9", "pns_if": "t9pns_if", "pns_ip": "192.168.9.1/24", "tenant_if": "t9if", "tenant_ip": "192.168.9.2/24"}, "rc": 0, "start": "2019-12-05 07:20:28.112784", "stderr": "Device \"t9if\" does not exist.", "stderr_lines": ["Device \"t9if\" does not exist."], "stdout": "", "stdout_lines": []}

TASK [Attach Tenant VETH Pairs] *****************************************************************************************************************************
changed: [localhost] => (item={u'default_route_ip': u'192.168.9.1', u'name': u't9', u'pns_ip': u'192.168.9.1/24', u'tenant_if': u't9if', u'tenant_ip': u'192.168.9.2/24', u'pns_if': u't9pns_if'}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec pns ip link show \"t9pns_if\" ; if [ $? -ne 0 ] ; then ip link set \"t9pns_if\" netns pns ; fi\nip netns exec \"t9\" ip link show \"t9if\" ; if [ $? -ne 0 ] ; then ip link set \"t9if\" netns \"t9\" ; fi\nip netns exec pns ip link set dev \"t9pns_if\" up\nip netns exec \"t9\" ip link set dev \"t9if\" up\n", "delta": "0:00:00.231886", "end": "2019-12-05 07:20:28.641114", "item": {"default_route_ip": "192.168.9.1", "name": "t9", "pns_if": "t9pns_if", "pns_ip": "192.168.9.1/24", "tenant_if": "t9if", "tenant_ip": "192.168.9.2/24"}, "rc": 0, "start": "2019-12-05 07:20:28.409228", "stderr": "Device \"t9pns_if\" does not exist.\nDevice \"t9if\" does not exist.", "stderr_lines": ["Device \"t9pns_if\" does not exist.", "Device \"t9if\" does not exist."], "stdout": "", "stdout_lines": []}

TASK [Add IP addresses to Tenant VETH Pairs] ****************************************************************************************************************
changed: [localhost] => (item={u'default_route_ip': u'192.168.9.1', u'name': u't9', u'pns_ip': u'192.168.9.1/24', u'tenant_if': u't9if', u'tenant_ip': u'192.168.9.2/24', u'pns_if': u't9pns_if'}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec pns ip addr show \"t9pns_if\" | awk 'FNR==3{ print $2 }' | grep -w '^192.168.9.1/24' ; if [ $? -ne 0 ] ; then ip netns exec pns ip addr add \"192.168.9.1/24\" dev \"t9pns_if\" ; fi\nip netns exec \"t9\" ip addr show \"t9if\" | awk 'FNR==3{ print $2 }' | grep -w '^192.168.9.2/24' ; if [ $? -ne 0 ] ; then ip netns exec \"t9\" ip addr add \"192.168.9.2/24\" dev \"t9if\" ; fi\n", "delta": "0:00:00.148205", "end": "2019-12-05 07:20:29.061193", "item": {"default_route_ip": "192.168.9.1", "name": "t9", "pns_if": "t9pns_if", "pns_ip": "192.168.9.1/24", "tenant_if": "t9if", "tenant_ip": "192.168.9.2/24"}, "rc": 0, "start": "2019-12-05 07:20:28.912988", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Create Namespace VETH Pairs] **************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.81.1/24', u'ns_name': u't9', u'ns_if': u't9if', u'if': u'p1'}], u'default_route_ip': u'10.1.81.1', u'bridge_name': u't9br1', u'dns': [{u'dnsif': u't9s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't9s1_dnsbrif'}], u'ns_name': u't9ns1', u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't9_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't9br1if1', u'vmif': u't9VM1if1'}, {u'mem': 4, u'name': u't9_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't9br1if2', u'vmif': u't9VM2if1'}], u'vxlan': [{u'local_ip': u'10.1.81.2', u'dsport': 4789, u'dev': u't9s1if', u'tenant_route_ip': u'192.168.9.2', u'remote_route': u'10.2.81.0/24', u'subnet_route': u'10.1.81.0/24', u'v_name': u'vxlan_t9s1', u'id': 42, u'remote_ip': u'10.2.81.2'}]}, {u'tenant_sub_ip': u'10.1.81.2/24', u'tenant_ns_ip': u'10.1.81.1/24', u'tenant_ns_if': u't9ns1if', u'tenant_sub_if': u't9s1if', u'tenant_ns_name': u't9'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip link show \"t9ns1if\" ; if [ $? -ne 0 ] ; then ip link add \"t9ns1if\" type veth peer name \"t9s1if\" ; fi\n", "delta": "0:00:00.014528", "end": "2019-12-05 07:20:29.351814", "item": [{"bridge_name": "t9br1", "default_route_ip": "10.1.81.1", "dns": [{"brif": "t9s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.5", "dnsif": "t9s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t9ns1", "route": [{"if": "p1", "ip": "10.1.81.1/24", "ns_if": "t9if", "ns_name": "t9"}], "subnet_ip": "1.1.1.0/24", "vms": [{"brif": "t9br1if1", "disk": "10G", "mem": 2, "name": "t9_VM1", "vcpu": 4, "vmif": "t9VM1if1"}, {"brif": "t9br1if2", "disk": "10G", "mem": 4, "name": "t9_VM2", "vcpu": 2, "vmif": "t9VM2if1"}], "vxlan": [{"dev": "t9s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.81.2", "remote_ip": "10.2.81.2", "remote_route": "10.2.81.0/24", "subnet_route": "10.1.81.0/24", "tenant_route_ip": "192.168.9.2", "v_name": "vxlan_t9s1"}]}, {"tenant_ns_if": "t9ns1if", "tenant_ns_ip": "10.1.81.1/24", "tenant_ns_name": "t9", "tenant_sub_if": "t9s1if", "tenant_sub_ip": "10.1.81.2/24"}], "rc": 0, "start": "2019-12-05 07:20:29.337286", "stderr": "Device \"t9ns1if\" does not exist.", "stderr_lines": ["Device \"t9ns1if\" does not exist."], "stdout": "", "stdout_lines": []}

TASK [Attach Namespace VETH Pairs] **************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.81.1/24', u'ns_name': u't9', u'ns_if': u't9if', u'if': u'p1'}], u'default_route_ip': u'10.1.81.1', u'bridge_name': u't9br1', u'dns': [{u'dnsif': u't9s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't9s1_dnsbrif'}], u'ns_name': u't9ns1', u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't9_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't9br1if1', u'vmif': u't9VM1if1'}, {u'mem': 4, u'name': u't9_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't9br1if2', u'vmif': u't9VM2if1'}], u'vxlan': [{u'local_ip': u'10.1.81.2', u'dsport': 4789, u'dev': u't9s1if', u'tenant_route_ip': u'192.168.9.2', u'remote_route': u'10.2.81.0/24', u'subnet_route': u'10.1.81.0/24', u'v_name': u'vxlan_t9s1', u'id': 42, u'remote_ip': u'10.2.81.2'}]}, {u'tenant_sub_ip': u'10.1.81.2/24', u'tenant_ns_ip': u'10.1.81.1/24', u'tenant_ns_if': u't9ns1if', u'tenant_sub_if': u't9s1if', u'tenant_ns_name': u't9'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t9\" ip link show \"t9ns1if\" ; if [ $? -ne 0 ] ; then ip link set \"t9ns1if\" netns \"t9\" ; fi\nip netns exec \"t9ns1\" ip link show \"t9s1if\" ; if [ $? -ne 0 ] ; then ip link set \"t9s1if\" netns \"t9ns1\" ; fi\n", "delta": "0:00:00.130006", "end": "2019-12-05 07:20:29.749493", "item": [{"bridge_name": "t9br1", "default_route_ip": "10.1.81.1", "dns": [{"brif": "t9s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.5", "dnsif": "t9s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t9ns1", "route": [{"if": "p1", "ip": "10.1.81.1/24", "ns_if": "t9if", "ns_name": "t9"}], "subnet_ip": "1.1.1.0/24", "vms": [{"brif": "t9br1if1", "disk": "10G", "mem": 2, "name": "t9_VM1", "vcpu": 4, "vmif": "t9VM1if1"}, {"brif": "t9br1if2", "disk": "10G", "mem": 4, "name": "t9_VM2", "vcpu": 2, "vmif": "t9VM2if1"}], "vxlan": [{"dev": "t9s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.81.2", "remote_ip": "10.2.81.2", "remote_route": "10.2.81.0/24", "subnet_route": "10.1.81.0/24", "tenant_route_ip": "192.168.9.2", "v_name": "vxlan_t9s1"}]}, {"tenant_ns_if": "t9ns1if", "tenant_ns_ip": "10.1.81.1/24", "tenant_ns_name": "t9", "tenant_sub_if": "t9s1if", "tenant_sub_ip": "10.1.81.2/24"}], "rc": 0, "start": "2019-12-05 07:20:29.619487", "stderr": "Device \"t9ns1if\" does not exist.\nDevice \"t9s1if\" does not exist.", "stderr_lines": ["Device \"t9ns1if\" does not exist.", "Device \"t9s1if\" does not exist."], "stdout": "", "stdout_lines": []}

TASK [Set Namespace VETH Pairs UP] **************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.81.1/24', u'ns_name': u't9', u'ns_if': u't9if', u'if': u'p1'}], u'default_route_ip': u'10.1.81.1', u'bridge_name': u't9br1', u'dns': [{u'dnsif': u't9s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't9s1_dnsbrif'}], u'ns_name': u't9ns1', u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't9_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't9br1if1', u'vmif': u't9VM1if1'}, {u'mem': 4, u'name': u't9_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't9br1if2', u'vmif': u't9VM2if1'}], u'vxlan': [{u'local_ip': u'10.1.81.2', u'dsport': 4789, u'dev': u't9s1if', u'tenant_route_ip': u'192.168.9.2', u'remote_route': u'10.2.81.0/24', u'subnet_route': u'10.1.81.0/24', u'v_name': u'vxlan_t9s1', u'id': 42, u'remote_ip': u'10.2.81.2'}]}, {u'tenant_sub_ip': u'10.1.81.2/24', u'tenant_ns_ip': u'10.1.81.1/24', u'tenant_ns_if': u't9ns1if', u'tenant_sub_if': u't9s1if', u'tenant_ns_name': u't9'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t9\" ip link set dev \"t9ns1if\" up\nip netns exec \"t9ns1\" ip link set dev \"t9s1if\" up\n", "delta": "0:00:00.080869", "end": "2019-12-05 07:20:30.101158", "item": [{"bridge_name": "t9br1", "default_route_ip": "10.1.81.1", "dns": [{"brif": "t9s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.5", "dnsif": "t9s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t9ns1", "route": [{"if": "p1", "ip": "10.1.81.1/24", "ns_if": "t9if", "ns_name": "t9"}], "subnet_ip": "1.1.1.0/24", "vms": [{"brif": "t9br1if1", "disk": "10G", "mem": 2, "name": "t9_VM1", "vcpu": 4, "vmif": "t9VM1if1"}, {"brif": "t9br1if2", "disk": "10G", "mem": 4, "name": "t9_VM2", "vcpu": 2, "vmif": "t9VM2if1"}], "vxlan": [{"dev": "t9s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.81.2", "remote_ip": "10.2.81.2", "remote_route": "10.2.81.0/24", "subnet_route": "10.1.81.0/24", "tenant_route_ip": "192.168.9.2", "v_name": "vxlan_t9s1"}]}, {"tenant_ns_if": "t9ns1if", "tenant_ns_ip": "10.1.81.1/24", "tenant_ns_name": "t9", "tenant_sub_if": "t9s1if", "tenant_sub_ip": "10.1.81.2/24"}], "rc": 0, "start": "2019-12-05 07:20:30.020289", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Add IP addresses to Namespace VETH Pairs] *************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.81.1/24', u'ns_name': u't9', u'ns_if': u't9if', u'if': u'p1'}], u'default_route_ip': u'10.1.81.1', u'bridge_name': u't9br1', u'dns': [{u'dnsif': u't9s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't9s1_dnsbrif'}], u'ns_name': u't9ns1', u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't9_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't9br1if1', u'vmif': u't9VM1if1'}, {u'mem': 4, u'name': u't9_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't9br1if2', u'vmif': u't9VM2if1'}], u'vxlan': [{u'local_ip': u'10.1.81.2', u'dsport': 4789, u'dev': u't9s1if', u'tenant_route_ip': u'192.168.9.2', u'remote_route': u'10.2.81.0/24', u'subnet_route': u'10.1.81.0/24', u'v_name': u'vxlan_t9s1', u'id': 42, u'remote_ip': u'10.2.81.2'}]}, {u'tenant_sub_ip': u'10.1.81.2/24', u'tenant_ns_ip': u'10.1.81.1/24', u'tenant_ns_if': u't9ns1if', u'tenant_sub_if': u't9s1if', u'tenant_ns_name': u't9'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t9ns1\" ip addr show \"t9s1if\" | awk 'FNR==3{ print $2 }' | grep -w '^10.1.81.2/24' ; if [ $? -ne 0 ] ; then ip netns exec \"t9ns1\" ip addr add \"10.1.81.2/24\" dev \"t9s1if\" ; fi\n\nip netns exec \"t9\" ip addr show \"t9ns1if\" | awk 'FNR==3{ print $2 }' | grep -w '^10.1.81.1/24' ; if [ $? -ne 0 ] ; then ip netns exec \"t9\" ip addr add \"10.1.81.1/24\" dev \"t9ns1if\" ; fi\n", "delta": "0:00:00.148946", "end": "2019-12-05 07:20:30.513082", "item": [{"bridge_name": "t9br1", "default_route_ip": "10.1.81.1", "dns": [{"brif": "t9s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.5", "dnsif": "t9s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t9ns1", "route": [{"if": "p1", "ip": "10.1.81.1/24", "ns_if": "t9if", "ns_name": "t9"}], "subnet_ip": "1.1.1.0/24", "vms": [{"brif": "t9br1if1", "disk": "10G", "mem": 2, "name": "t9_VM1", "vcpu": 4, "vmif": "t9VM1if1"}, {"brif": "t9br1if2", "disk": "10G", "mem": 4, "name": "t9_VM2", "vcpu": 2, "vmif": "t9VM2if1"}], "vxlan": [{"dev": "t9s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.81.2", "remote_ip": "10.2.81.2", "remote_route": "10.2.81.0/24", "subnet_route": "10.1.81.0/24", "tenant_route_ip": "192.168.9.2", "v_name": "vxlan_t9s1"}]}, {"tenant_ns_if": "t9ns1if", "tenant_ns_ip": "10.1.81.1/24", "tenant_ns_name": "t9", "tenant_sub_if": "t9s1if", "tenant_sub_ip": "10.1.81.2/24"}], "rc": 0, "start": "2019-12-05 07:20:30.364136", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Add IP Route to Tenant] *******************************************************************************************************************************
changed: [localhost] => (item={u'default_route_ip': u'192.168.9.1', u'name': u't9', u'pns_ip': u'192.168.9.1/24', u'tenant_if': u't9if', u'tenant_ip': u'192.168.9.2/24', u'pns_if': u't9pns_if'}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t9\" ip route show default | grep -w '[d]efault via 192.168.9.1' ; if [ $? -ne 0 ] ; then ip netns exec \"t9\" ip route add default via \"192.168.9.1\" ; fi\n", "delta": "0:00:00.087880", "end": "2019-12-05 07:20:30.857041", "item": {"default_route_ip": "192.168.9.1", "name": "t9", "pns_if": "t9pns_if", "pns_ip": "192.168.9.1/24", "tenant_if": "t9if", "tenant_ip": "192.168.9.2/24"}, "rc": 0, "start": "2019-12-05 07:20:30.769161", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Add IP Route to Tenant Subnet] ************************************************************************************************************************
changed: [localhost] => (item={u'route': [{u'ip': u'10.1.81.1/24', u'ns_name': u't9', u'ns_if': u't9if', u'if': u'p1'}], u'default_route_ip': u'10.1.81.1', u'bridge_name': u't9br1', u'dns': [{u'dnsif': u't9s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't9s1_dnsbrif'}], u'ns_name': u't9ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.81.2/24', u'tenant_ns_ip': u'10.1.81.1/24', u'tenant_ns_if': u't9ns1if', u'tenant_ns_name': u't9', u'tenant_sub_if': u't9s1if'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't9_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't9br1if1', u'vmif': u't9VM1if1'}, {u'mem': 4, u'name': u't9_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't9br1if2', u'vmif': u't9VM2if1'}], u'vxlan': [{u'local_ip': u'10.1.81.2', u'tenant_route_ip': u'192.168.9.2', u'dsport': 4789, u'dev': u't9s1if', u'subnet_route': u'10.1.81.0/24', u'remote_route': u'10.2.81.0/24', u'v_name': u'vxlan_t9s1', u'id': 42, u'remote_ip': u'10.2.81.2'}]}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t9ns1\" ip route show default | grep -w '[d]efault via 10.1.81.1' ; if [ $? -ne 0 ] ; then ip netns exec \"t9ns1\" ip route add default via \"10.1.81.1\" ; fi\n", "delta": "0:00:00.091497", "end": "2019-12-05 07:20:31.209155", "item": {"bridge_name": "t9br1", "default_route_ip": "10.1.81.1", "dns": [{"brif": "t9s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.5", "dnsif": "t9s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t9ns1", "route": [{"if": "p1", "ip": "10.1.81.1/24", "ns_if": "t9if", "ns_name": "t9"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t9ns1if", "tenant_ns_ip": "10.1.81.1/24", "tenant_ns_name": "t9", "tenant_sub_if": "t9s1if", "tenant_sub_ip": "10.1.81.2/24"}], "vms": [{"brif": "t9br1if1", "disk": "10G", "mem": 2, "name": "t9_VM1", "vcpu": 4, "vmif": "t9VM1if1"}, {"brif": "t9br1if2", "disk": "10G", "mem": 4, "name": "t9_VM2", "vcpu": 2, "vmif": "t9VM2if1"}], "vxlan": [{"dev": "t9s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.81.2", "remote_ip": "10.2.81.2", "remote_route": "10.2.81.0/24", "subnet_route": "10.1.81.0/24", "tenant_route_ip": "192.168.9.2", "v_name": "vxlan_t9s1"}]}, "rc": 0, "start": "2019-12-05 07:20:31.117658", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Create bridge inside namespace] ***********************************************************************************************************************
changed: [localhost] => (item={u'route': [{u'ip': u'10.1.81.1/24', u'ns_name': u't9', u'ns_if': u't9if', u'if': u'p1'}], u'default_route_ip': u'10.1.81.1', u'bridge_name': u't9br1', u'dns': [{u'dnsif': u't9s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't9s1_dnsbrif'}], u'ns_name': u't9ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.81.2/24', u'tenant_ns_ip': u'10.1.81.1/24', u'tenant_ns_if': u't9ns1if', u'tenant_ns_name': u't9', u'tenant_sub_if': u't9s1if'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't9_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't9br1if1', u'vmif': u't9VM1if1'}, {u'mem': 4, u'name': u't9_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't9br1if2', u'vmif': u't9VM2if1'}], u'vxlan': [{u'local_ip': u'10.1.81.2', u'tenant_route_ip': u'192.168.9.2', u'dsport': 4789, u'dev': u't9s1if', u'subnet_route': u'10.1.81.0/24', u'remote_route': u'10.2.81.0/24', u'v_name': u'vxlan_t9s1', u'id': 42, u'remote_ip': u'10.2.81.2'}]}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t9ns1\" brctl show | grep -w '^t9br1'; if [ $? -ne 0 ] ; then ip netns exec \"t9ns1\" brctl addbr \"t9br1\" ; fi\nip netns exec \"t9ns1\" ip link set dev \"t9br1\" up\n", "delta": "0:00:00.104922", "end": "2019-12-05 07:20:31.597054", "item": {"bridge_name": "t9br1", "default_route_ip": "10.1.81.1", "dns": [{"brif": "t9s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.5", "dnsif": "t9s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t9ns1", "route": [{"if": "p1", "ip": "10.1.81.1/24", "ns_if": "t9if", "ns_name": "t9"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t9ns1if", "tenant_ns_ip": "10.1.81.1/24", "tenant_ns_name": "t9", "tenant_sub_if": "t9s1if", "tenant_sub_ip": "10.1.81.2/24"}], "vms": [{"brif": "t9br1if1", "disk": "10G", "mem": 2, "name": "t9_VM1", "vcpu": 4, "vmif": "t9VM1if1"}, {"brif": "t9br1if2", "disk": "10G", "mem": 4, "name": "t9_VM2", "vcpu": 2, "vmif": "t9VM2if1"}], "vxlan": [{"dev": "t9s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.81.2", "remote_ip": "10.2.81.2", "remote_route": "10.2.81.0/24", "subnet_route": "10.1.81.0/24", "tenant_route_ip": "192.168.9.2", "v_name": "vxlan_t9s1"}]}, "rc": 0, "start": "2019-12-05 07:20:31.492132", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Create DNS VETH Pair] *********************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.81.1/24', u'ns_name': u't9', u'ns_if': u't9if', u'if': u'p1'}], u'default_route_ip': u'10.1.81.1', u'bridge_name': u't9br1', u'ns_name': u't9ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.81.2/24', u'tenant_ns_ip': u'10.1.81.1/24', u'tenant_ns_if': u't9ns1if', u'tenant_sub_if': u't9s1if', u'tenant_ns_name': u't9'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't9_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't9br1if1', u'vmif': u't9VM1if1'}, {u'mem': 4, u'name': u't9_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't9br1if2', u'vmif': u't9VM2if1'}], u'vxlan': [{u'local_ip': u'10.1.81.2', u'dsport': 4789, u'dev': u't9s1if', u'tenant_route_ip': u'192.168.9.2', u'remote_route': u'10.2.81.0/24', u'subnet_route': u'10.1.81.0/24', u'v_name': u'vxlan_t9s1', u'id': 42, u'remote_ip': u'10.2.81.2'}]}, {u'dnsif': u't9s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't9s1_dnsbrif'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t9ns1\" ip link show \"t9s1_dnsbrif\" ; if [ $? -ne 0 ] ; then ip netns exec \"t9ns1\" ip link add \"t9s1_dnsbrif\" type veth peer name \"t9s1_dnsif\" ; fi\nip netns exec \"t9ns1\" ip link set dev \"t9s1_dnsbrif\" up\nip netns exec \"t9ns1\" ip link set dev \"t9s1_dnsif\" up\n", "delta": "0:00:00.155432", "end": "2019-12-05 07:20:32.069246", "item": [{"bridge_name": "t9br1", "default_route_ip": "10.1.81.1", "ns_name": "t9ns1", "route": [{"if": "p1", "ip": "10.1.81.1/24", "ns_if": "t9if", "ns_name": "t9"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t9ns1if", "tenant_ns_ip": "10.1.81.1/24", "tenant_ns_name": "t9", "tenant_sub_if": "t9s1if", "tenant_sub_ip": "10.1.81.2/24"}], "vms": [{"brif": "t9br1if1", "disk": "10G", "mem": 2, "name": "t9_VM1", "vcpu": 4, "vmif": "t9VM1if1"}, {"brif": "t9br1if2", "disk": "10G", "mem": 4, "name": "t9_VM2", "vcpu": 2, "vmif": "t9VM2if1"}], "vxlan": [{"dev": "t9s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.81.2", "remote_ip": "10.2.81.2", "remote_route": "10.2.81.0/24", "subnet_route": "10.1.81.0/24", "tenant_route_ip": "192.168.9.2", "v_name": "vxlan_t9s1"}]}, {"brif": "t9s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.5", "dnsif": "t9s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "rc": 0, "start": "2019-12-05 07:20:31.913814", "stderr": "Device \"t9s1_dnsbrif\" does not exist.", "stderr_lines": ["Device \"t9s1_dnsbrif\" does not exist."], "stdout": "", "stdout_lines": []}

TASK [Attach DNS VETH Pair] *********************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.81.1/24', u'ns_name': u't9', u'ns_if': u't9if', u'if': u'p1'}], u'default_route_ip': u'10.1.81.1', u'bridge_name': u't9br1', u'ns_name': u't9ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.81.2/24', u'tenant_ns_ip': u'10.1.81.1/24', u'tenant_ns_if': u't9ns1if', u'tenant_sub_if': u't9s1if', u'tenant_ns_name': u't9'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't9_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't9br1if1', u'vmif': u't9VM1if1'}, {u'mem': 4, u'name': u't9_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't9br1if2', u'vmif': u't9VM2if1'}], u'vxlan': [{u'local_ip': u'10.1.81.2', u'dsport': 4789, u'dev': u't9s1if', u'tenant_route_ip': u'192.168.9.2', u'remote_route': u'10.2.81.0/24', u'subnet_route': u'10.1.81.0/24', u'v_name': u'vxlan_t9s1', u'id': 42, u'remote_ip': u'10.2.81.2'}]}, {u'dnsif': u't9s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't9s1_dnsbrif'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t9ns1\" brctl show \"t9br1\" | grep -w 't9s1_dnsbrif' ; if [ $? -ne 0 ] ; then ip netns exec \"t9ns1\" brctl addif \"t9br1\" \"t9s1_dnsbrif\" ; fi\n", "delta": "0:00:00.075246", "end": "2019-12-05 07:20:32.478466", "item": [{"bridge_name": "t9br1", "default_route_ip": "10.1.81.1", "ns_name": "t9ns1", "route": [{"if": "p1", "ip": "10.1.81.1/24", "ns_if": "t9if", "ns_name": "t9"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t9ns1if", "tenant_ns_ip": "10.1.81.1/24", "tenant_ns_name": "t9", "tenant_sub_if": "t9s1if", "tenant_sub_ip": "10.1.81.2/24"}], "vms": [{"brif": "t9br1if1", "disk": "10G", "mem": 2, "name": "t9_VM1", "vcpu": 4, "vmif": "t9VM1if1"}, {"brif": "t9br1if2", "disk": "10G", "mem": 4, "name": "t9_VM2", "vcpu": 2, "vmif": "t9VM2if1"}], "vxlan": [{"dev": "t9s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.81.2", "remote_ip": "10.2.81.2", "remote_route": "10.2.81.0/24", "subnet_route": "10.1.81.0/24", "tenant_route_ip": "192.168.9.2", "v_name": "vxlan_t9s1"}]}, {"brif": "t9s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.5", "dnsif": "t9s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "rc": 0, "start": "2019-12-05 07:20:32.403220", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Create VETH Pairs] ************************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.81.1/24', u'ns_name': u't9', u'ns_if': u't9if', u'if': u'p1'}], u'default_route_ip': u'10.1.81.1', u'bridge_name': u't9br1', u'dns': [{u'dnsif': u't9s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't9s1_dnsbrif'}], u'ns_name': u't9ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.81.2/24', u'tenant_ns_ip': u'10.1.81.1/24', u'tenant_ns_if': u't9ns1if', u'tenant_sub_if': u't9s1if', u'tenant_ns_name': u't9'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.1.81.2', u'dsport': 4789, u'dev': u't9s1if', u'tenant_route_ip': u'192.168.9.2', u'remote_route': u'10.2.81.0/24', u'subnet_route': u'10.1.81.0/24', u'v_name': u'vxlan_t9s1', u'id': 42, u'remote_ip': u'10.2.81.2'}]}, {u'mem': 2, u'name': u't9_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't9br1if1', u'vmif': u't9VM1if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip link show \"t9br1if1\" ; if [ $? -ne 0 ] ; then ip link add \"t9VM1if1\" type veth peer name \"t9br1if1\" ; fi\nip link set dev \"t9br1if1\" up\nip link set dev \"t9VM1if1\" up\n", "delta": "0:00:00.022195", "end": "2019-12-05 07:20:32.824320", "item": [{"bridge_name": "t9br1", "default_route_ip": "10.1.81.1", "dns": [{"brif": "t9s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.5", "dnsif": "t9s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t9ns1", "route": [{"if": "p1", "ip": "10.1.81.1/24", "ns_if": "t9if", "ns_name": "t9"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t9ns1if", "tenant_ns_ip": "10.1.81.1/24", "tenant_ns_name": "t9", "tenant_sub_if": "t9s1if", "tenant_sub_ip": "10.1.81.2/24"}], "vxlan": [{"dev": "t9s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.81.2", "remote_ip": "10.2.81.2", "remote_route": "10.2.81.0/24", "subnet_route": "10.1.81.0/24", "tenant_route_ip": "192.168.9.2", "v_name": "vxlan_t9s1"}]}, {"brif": "t9br1if1", "disk": "10G", "mem": 2, "name": "t9_VM1", "vcpu": 4, "vmif": "t9VM1if1"}], "rc": 0, "start": "2019-12-05 07:20:32.802125", "stderr": "Device \"t9br1if1\" does not exist.", "stderr_lines": ["Device \"t9br1if1\" does not exist."], "stdout": "", "stdout_lines": []}
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.81.1/24', u'ns_name': u't9', u'ns_if': u't9if', u'if': u'p1'}], u'default_route_ip': u'10.1.81.1', u'bridge_name': u't9br1', u'dns': [{u'dnsif': u't9s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't9s1_dnsbrif'}], u'ns_name': u't9ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.81.2/24', u'tenant_ns_ip': u'10.1.81.1/24', u'tenant_ns_if': u't9ns1if', u'tenant_sub_if': u't9s1if', u'tenant_ns_name': u't9'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.1.81.2', u'dsport': 4789, u'dev': u't9s1if', u'tenant_route_ip': u'192.168.9.2', u'remote_route': u'10.2.81.0/24', u'subnet_route': u'10.1.81.0/24', u'v_name': u'vxlan_t9s1', u'id': 42, u'remote_ip': u'10.2.81.2'}]}, {u'mem': 4, u'name': u't9_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't9br1if2', u'vmif': u't9VM2if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip link show \"t9br1if2\" ; if [ $? -ne 0 ] ; then ip link add \"t9VM2if1\" type veth peer name \"t9br1if2\" ; fi\nip link set dev \"t9br1if2\" up\nip link set dev \"t9VM2if1\" up\n", "delta": "0:00:00.017021", "end": "2019-12-05 07:20:33.076846", "item": [{"bridge_name": "t9br1", "default_route_ip": "10.1.81.1", "dns": [{"brif": "t9s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.5", "dnsif": "t9s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t9ns1", "route": [{"if": "p1", "ip": "10.1.81.1/24", "ns_if": "t9if", "ns_name": "t9"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t9ns1if", "tenant_ns_ip": "10.1.81.1/24", "tenant_ns_name": "t9", "tenant_sub_if": "t9s1if", "tenant_sub_ip": "10.1.81.2/24"}], "vxlan": [{"dev": "t9s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.81.2", "remote_ip": "10.2.81.2", "remote_route": "10.2.81.0/24", "subnet_route": "10.1.81.0/24", "tenant_route_ip": "192.168.9.2", "v_name": "vxlan_t9s1"}]}, {"brif": "t9br1if2", "disk": "10G", "mem": 4, "name": "t9_VM2", "vcpu": 2, "vmif": "t9VM2if1"}], "rc": 0, "start": "2019-12-05 07:20:33.059825", "stderr": "Device \"t9br1if2\" does not exist.", "stderr_lines": ["Device \"t9br1if2\" does not exist."], "stdout": "", "stdout_lines": []}

TASK [Attach VETH Pairs] ************************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.81.1/24', u'ns_name': u't9', u'ns_if': u't9if', u'if': u'p1'}], u'default_route_ip': u'10.1.81.1', u'bridge_name': u't9br1', u'dns': [{u'dnsif': u't9s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't9s1_dnsbrif'}], u'ns_name': u't9ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.81.2/24', u'tenant_ns_ip': u'10.1.81.1/24', u'tenant_ns_if': u't9ns1if', u'tenant_sub_if': u't9s1if', u'tenant_ns_name': u't9'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.1.81.2', u'dsport': 4789, u'dev': u't9s1if', u'tenant_route_ip': u'192.168.9.2', u'remote_route': u'10.2.81.0/24', u'subnet_route': u'10.1.81.0/24', u'v_name': u'vxlan_t9s1', u'id': 42, u'remote_ip': u'10.2.81.2'}]}, {u'mem': 2, u'name': u't9_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't9br1if1', u'vmif': u't9VM1if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip link show \"t9br1if1\" ; if [ $? -eq 0 ] ; then ip link set \"t9br1if1\" netns \"t9ns1\" ; fi\nip netns exec \"t9ns1\" brctl show \"t9br1\" | grep -w 't9br1if1' ; if [ $? -ne 0 ] ; then ip netns exec \"t9ns1\" brctl addif \"t9br1\" \"t9br1if1\" ; fi\n", "delta": "0:00:00.094810", "end": "2019-12-05 07:20:33.457023", "item": [{"bridge_name": "t9br1", "default_route_ip": "10.1.81.1", "dns": [{"brif": "t9s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.5", "dnsif": "t9s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t9ns1", "route": [{"if": "p1", "ip": "10.1.81.1/24", "ns_if": "t9if", "ns_name": "t9"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t9ns1if", "tenant_ns_ip": "10.1.81.1/24", "tenant_ns_name": "t9", "tenant_sub_if": "t9s1if", "tenant_sub_ip": "10.1.81.2/24"}], "vxlan": [{"dev": "t9s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.81.2", "remote_ip": "10.2.81.2", "remote_route": "10.2.81.0/24", "subnet_route": "10.1.81.0/24", "tenant_route_ip": "192.168.9.2", "v_name": "vxlan_t9s1"}]}, {"brif": "t9br1if1", "disk": "10G", "mem": 2, "name": "t9_VM1", "vcpu": 4, "vmif": "t9VM1if1"}], "rc": 0, "start": "2019-12-05 07:20:33.362213", "stderr": "", "stderr_lines": [], "stdout": "67: t9br1if1@t9VM1if1: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP mode DEFAULT group default qlen 1000\n    link/ether da:65:6a:03:92:b8 brd ff:ff:ff:ff:ff:ff", "stdout_lines": ["67: t9br1if1@t9VM1if1: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP mode DEFAULT group default qlen 1000", "    link/ether da:65:6a:03:92:b8 brd ff:ff:ff:ff:ff:ff"]}
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.81.1/24', u'ns_name': u't9', u'ns_if': u't9if', u'if': u'p1'}], u'default_route_ip': u'10.1.81.1', u'bridge_name': u't9br1', u'dns': [{u'dnsif': u't9s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't9s1_dnsbrif'}], u'ns_name': u't9ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.81.2/24', u'tenant_ns_ip': u'10.1.81.1/24', u'tenant_ns_if': u't9ns1if', u'tenant_sub_if': u't9s1if', u'tenant_ns_name': u't9'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.1.81.2', u'dsport': 4789, u'dev': u't9s1if', u'tenant_route_ip': u'192.168.9.2', u'remote_route': u'10.2.81.0/24', u'subnet_route': u'10.1.81.0/24', u'v_name': u'vxlan_t9s1', u'id': 42, u'remote_ip': u'10.2.81.2'}]}, {u'mem': 4, u'name': u't9_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't9br1if2', u'vmif': u't9VM2if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip link show \"t9br1if2\" ; if [ $? -eq 0 ] ; then ip link set \"t9br1if2\" netns \"t9ns1\" ; fi\nip netns exec \"t9ns1\" brctl show \"t9br1\" | grep -w 't9br1if2' ; if [ $? -ne 0 ] ; then ip netns exec \"t9ns1\" brctl addif \"t9br1\" \"t9br1if2\" ; fi\n", "delta": "0:00:00.113483", "end": "2019-12-05 07:20:33.797051", "item": [{"bridge_name": "t9br1", "default_route_ip": "10.1.81.1", "dns": [{"brif": "t9s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.5", "dnsif": "t9s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t9ns1", "route": [{"if": "p1", "ip": "10.1.81.1/24", "ns_if": "t9if", "ns_name": "t9"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t9ns1if", "tenant_ns_ip": "10.1.81.1/24", "tenant_ns_name": "t9", "tenant_sub_if": "t9s1if", "tenant_sub_ip": "10.1.81.2/24"}], "vxlan": [{"dev": "t9s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.81.2", "remote_ip": "10.2.81.2", "remote_route": "10.2.81.0/24", "subnet_route": "10.1.81.0/24", "tenant_route_ip": "192.168.9.2", "v_name": "vxlan_t9s1"}]}, {"brif": "t9br1if2", "disk": "10G", "mem": 4, "name": "t9_VM2", "vcpu": 2, "vmif": "t9VM2if1"}], "rc": 0, "start": "2019-12-05 07:20:33.683568", "stderr": "", "stderr_lines": [], "stdout": "69: t9br1if2@t9VM2if1: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP mode DEFAULT group default qlen 1000\n    link/ether e6:c1:55:e8:07:0f brd ff:ff:ff:ff:ff:ff", "stdout_lines": ["69: t9br1if2@t9VM2if1: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP mode DEFAULT group default qlen 1000", "    link/ether e6:c1:55:e8:07:0f brd ff:ff:ff:ff:ff:ff"]}

TASK [All interfaces and bridges UP] ************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.81.1/24', u'ns_name': u't9', u'ns_if': u't9if', u'if': u'p1'}], u'default_route_ip': u'10.1.81.1', u'bridge_name': u't9br1', u'dns': [{u'dnsif': u't9s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't9s1_dnsbrif'}], u'ns_name': u't9ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.81.2/24', u'tenant_ns_ip': u'10.1.81.1/24', u'tenant_ns_if': u't9ns1if', u'tenant_sub_if': u't9s1if', u'tenant_ns_name': u't9'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.1.81.2', u'dsport': 4789, u'dev': u't9s1if', u'tenant_route_ip': u'192.168.9.2', u'remote_route': u'10.2.81.0/24', u'subnet_route': u'10.1.81.0/24', u'v_name': u'vxlan_t9s1', u'id': 42, u'remote_ip': u'10.2.81.2'}]}, {u'mem': 2, u'name': u't9_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't9br1if1', u'vmif': u't9VM1if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t9ns1\" ip link set \"t9br1if1\" up\nip netns exec \"t9ns1\" ip link set dev \"t9br1\" up\n", "delta": "0:00:00.101484", "end": "2019-12-05 07:20:34.173150", "item": [{"bridge_name": "t9br1", "default_route_ip": "10.1.81.1", "dns": [{"brif": "t9s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.5", "dnsif": "t9s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t9ns1", "route": [{"if": "p1", "ip": "10.1.81.1/24", "ns_if": "t9if", "ns_name": "t9"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t9ns1if", "tenant_ns_ip": "10.1.81.1/24", "tenant_ns_name": "t9", "tenant_sub_if": "t9s1if", "tenant_sub_ip": "10.1.81.2/24"}], "vxlan": [{"dev": "t9s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.81.2", "remote_ip": "10.2.81.2", "remote_route": "10.2.81.0/24", "subnet_route": "10.1.81.0/24", "tenant_route_ip": "192.168.9.2", "v_name": "vxlan_t9s1"}]}, {"brif": "t9br1if1", "disk": "10G", "mem": 2, "name": "t9_VM1", "vcpu": 4, "vmif": "t9VM1if1"}], "rc": 0, "start": "2019-12-05 07:20:34.071666", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.81.1/24', u'ns_name': u't9', u'ns_if': u't9if', u'if': u'p1'}], u'default_route_ip': u'10.1.81.1', u'bridge_name': u't9br1', u'dns': [{u'dnsif': u't9s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't9s1_dnsbrif'}], u'ns_name': u't9ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.81.2/24', u'tenant_ns_ip': u'10.1.81.1/24', u'tenant_ns_if': u't9ns1if', u'tenant_sub_if': u't9s1if', u'tenant_ns_name': u't9'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.1.81.2', u'dsport': 4789, u'dev': u't9s1if', u'tenant_route_ip': u'192.168.9.2', u'remote_route': u'10.2.81.0/24', u'subnet_route': u'10.1.81.0/24', u'v_name': u'vxlan_t9s1', u'id': 42, u'remote_ip': u'10.2.81.2'}]}, {u'mem': 4, u'name': u't9_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't9br1if2', u'vmif': u't9VM2if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t9ns1\" ip link set \"t9br1if2\" up\nip netns exec \"t9ns1\" ip link set dev \"t9br1\" up\n", "delta": "0:00:00.085717", "end": "2019-12-05 07:20:34.489411", "item": [{"bridge_name": "t9br1", "default_route_ip": "10.1.81.1", "dns": [{"brif": "t9s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.5", "dnsif": "t9s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t9ns1", "route": [{"if": "p1", "ip": "10.1.81.1/24", "ns_if": "t9if", "ns_name": "t9"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t9ns1if", "tenant_ns_ip": "10.1.81.1/24", "tenant_ns_name": "t9", "tenant_sub_if": "t9s1if", "tenant_sub_ip": "10.1.81.2/24"}], "vxlan": [{"dev": "t9s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.81.2", "remote_ip": "10.2.81.2", "remote_route": "10.2.81.0/24", "subnet_route": "10.1.81.0/24", "tenant_route_ip": "192.168.9.2", "v_name": "vxlan_t9s1"}]}, {"brif": "t9br1if2", "disk": "10G", "mem": 4, "name": "t9_VM2", "vcpu": 2, "vmif": "t9VM2if1"}], "rc": 0, "start": "2019-12-05 07:20:34.403694", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Add IP to DNS Interface] ******************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.81.1/24', u'ns_name': u't9', u'ns_if': u't9if', u'if': u'p1'}], u'default_route_ip': u'10.1.81.1', u'bridge_name': u't9br1', u'ns_name': u't9ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.81.2/24', u'tenant_ns_ip': u'10.1.81.1/24', u'tenant_ns_if': u't9ns1if', u'tenant_sub_if': u't9s1if', u'tenant_ns_name': u't9'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't9_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't9br1if1', u'vmif': u't9VM1if1'}, {u'mem': 4, u'name': u't9_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't9br1if2', u'vmif': u't9VM2if1'}], u'vxlan': [{u'local_ip': u'10.1.81.2', u'dsport': 4789, u'dev': u't9s1if', u'tenant_route_ip': u'192.168.9.2', u'remote_route': u'10.2.81.0/24', u'subnet_route': u'10.1.81.0/24', u'v_name': u'vxlan_t9s1', u'id': 42, u'remote_ip': u'10.2.81.2'}]}, {u'dnsif': u't9s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't9s1_dnsbrif'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t9ns1\" ip addr show \"t9s1_dnsif\" | awk 'FNR==3{ print $2 }' | grep -w '^1.1.1.1/24' ; if [ $? -ne 0 ] ; then ip netns exec \"t9ns1\" ip addr add \"1.1.1.1/24\" dev \"t9s1_dnsif\" ; fi\n", "delta": "0:00:00.076346", "end": "2019-12-05 07:20:34.889252", "item": [{"bridge_name": "t9br1", "default_route_ip": "10.1.81.1", "ns_name": "t9ns1", "route": [{"if": "p1", "ip": "10.1.81.1/24", "ns_if": "t9if", "ns_name": "t9"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t9ns1if", "tenant_ns_ip": "10.1.81.1/24", "tenant_ns_name": "t9", "tenant_sub_if": "t9s1if", "tenant_sub_ip": "10.1.81.2/24"}], "vms": [{"brif": "t9br1if1", "disk": "10G", "mem": 2, "name": "t9_VM1", "vcpu": 4, "vmif": "t9VM1if1"}, {"brif": "t9br1if2", "disk": "10G", "mem": 4, "name": "t9_VM2", "vcpu": 2, "vmif": "t9VM2if1"}], "vxlan": [{"dev": "t9s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.81.2", "remote_ip": "10.2.81.2", "remote_route": "10.2.81.0/24", "subnet_route": "10.1.81.0/24", "tenant_route_ip": "192.168.9.2", "v_name": "vxlan_t9s1"}]}, {"brif": "t9s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.5", "dnsif": "t9s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "rc": 0, "start": "2019-12-05 07:20:34.812906", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Install DHCP Server] **********************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.81.1/24', u'ns_name': u't9', u'ns_if': u't9if', u'if': u'p1'}], u'default_route_ip': u'10.1.81.1', u'bridge_name': u't9br1', u'ns_name': u't9ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.81.2/24', u'tenant_ns_ip': u'10.1.81.1/24', u'tenant_ns_if': u't9ns1if', u'tenant_sub_if': u't9s1if', u'tenant_ns_name': u't9'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't9_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't9br1if1', u'vmif': u't9VM1if1'}, {u'mem': 4, u'name': u't9_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't9br1if2', u'vmif': u't9VM2if1'}], u'vxlan': [{u'local_ip': u'10.1.81.2', u'dsport': 4789, u'dev': u't9s1if', u'tenant_route_ip': u'192.168.9.2', u'remote_route': u'10.2.81.0/24', u'subnet_route': u'10.1.81.0/24', u'v_name': u'vxlan_t9s1', u'id': 42, u'remote_ip': u'10.2.81.2'}]}, {u'dnsif': u't9s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't9s1_dnsbrif'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t9ns1\" ps aux | grep -w '[d]nsmasq --interface t9s1_dnsif -z --dhcp-range=1.1.1.5,1.1.1.254' ; if [ $? -ne 0 ] ; then ip netns exec \"t9ns1\" dnsmasq --interface \"t9s1_dnsif\" -z --dhcp-range=1.1.1.5,'1.1.1.254' ; fi\n", "delta": "0:00:00.116153", "end": "2019-12-05 07:20:35.306421", "item": [{"bridge_name": "t9br1", "default_route_ip": "10.1.81.1", "ns_name": "t9ns1", "route": [{"if": "p1", "ip": "10.1.81.1/24", "ns_if": "t9if", "ns_name": "t9"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t9ns1if", "tenant_ns_ip": "10.1.81.1/24", "tenant_ns_name": "t9", "tenant_sub_if": "t9s1if", "tenant_sub_ip": "10.1.81.2/24"}], "vms": [{"brif": "t9br1if1", "disk": "10G", "mem": 2, "name": "t9_VM1", "vcpu": 4, "vmif": "t9VM1if1"}, {"brif": "t9br1if2", "disk": "10G", "mem": 4, "name": "t9_VM2", "vcpu": 2, "vmif": "t9VM2if1"}], "vxlan": [{"dev": "t9s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.81.2", "remote_ip": "10.2.81.2", "remote_route": "10.2.81.0/24", "subnet_route": "10.1.81.0/24", "tenant_route_ip": "192.168.9.2", "v_name": "vxlan_t9s1"}]}, {"brif": "t9s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.5", "dnsif": "t9s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "rc": 0, "start": "2019-12-05 07:20:35.190268", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Create VXLAN devices] *********************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.81.1/24', u'ns_name': u't9', u'ns_if': u't9if', u'if': u'p1'}], u'default_route_ip': u'10.1.81.1', u'bridge_name': u't9br1', u'dns': [{u'dnsif': u't9s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't9s1_dnsbrif'}], u'ns_name': u't9ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.81.2/24', u'tenant_ns_ip': u'10.1.81.1/24', u'tenant_ns_if': u't9ns1if', u'tenant_sub_if': u't9s1if', u'tenant_ns_name': u't9'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't9_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't9br1if1', u'vmif': u't9VM1if1'}, {u'mem': 4, u'name': u't9_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't9br1if2', u'vmif': u't9VM2if1'}]}, {u'local_ip': u'10.1.81.2', u'dsport': 4789, u'dev': u't9s1if', u'tenant_route_ip': u'192.168.9.2', u'remote_route': u'10.2.81.0/24', u'subnet_route': u'10.1.81.0/24', u'v_name': u'vxlan_t9s1', u'id': 42, u'remote_ip': u'10.2.81.2'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t9ns1\" ip link show \"vxlan_t9s1\" ; if [ $? -ne 0 ] ; then ip netns exec \"t9ns1\" ip link add \"vxlan_t9s1\" type vxlan id \"42\" local \"10.1.81.2\" remote \"10.2.81.2\" dstport \"4789\" dev \"t9s1if\"; ip netns exec \"t9ns1\" ip link set dev \"vxlan_t9s1\" up ; fi\n", "delta": "0:00:00.111163", "end": "2019-12-05 07:20:35.765145", "item": [{"bridge_name": "t9br1", "default_route_ip": "10.1.81.1", "dns": [{"brif": "t9s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.5", "dnsif": "t9s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t9ns1", "route": [{"if": "p1", "ip": "10.1.81.1/24", "ns_if": "t9if", "ns_name": "t9"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t9ns1if", "tenant_ns_ip": "10.1.81.1/24", "tenant_ns_name": "t9", "tenant_sub_if": "t9s1if", "tenant_sub_ip": "10.1.81.2/24"}], "vms": [{"brif": "t9br1if1", "disk": "10G", "mem": 2, "name": "t9_VM1", "vcpu": 4, "vmif": "t9VM1if1"}, {"brif": "t9br1if2", "disk": "10G", "mem": 4, "name": "t9_VM2", "vcpu": 2, "vmif": "t9VM2if1"}]}, {"dev": "t9s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.81.2", "remote_ip": "10.2.81.2", "remote_route": "10.2.81.0/24", "subnet_route": "10.1.81.0/24", "tenant_route_ip": "192.168.9.2", "v_name": "vxlan_t9s1"}], "rc": 0, "start": "2019-12-05 07:20:35.653982", "stderr": "Device \"vxlan_t9s1\" does not exist.", "stderr_lines": ["Device \"vxlan_t9s1\" does not exist."], "stdout": "", "stdout_lines": []}

TASK [Attach VXLANs to bridge] ******************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.81.1/24', u'ns_name': u't9', u'ns_if': u't9if', u'if': u'p1'}], u'default_route_ip': u'10.1.81.1', u'bridge_name': u't9br1', u'dns': [{u'dnsif': u't9s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't9s1_dnsbrif'}], u'ns_name': u't9ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.81.2/24', u'tenant_ns_ip': u'10.1.81.1/24', u'tenant_ns_if': u't9ns1if', u'tenant_sub_if': u't9s1if', u'tenant_ns_name': u't9'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't9_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't9br1if1', u'vmif': u't9VM1if1'}, {u'mem': 4, u'name': u't9_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't9br1if2', u'vmif': u't9VM2if1'}]}, {u'local_ip': u'10.1.81.2', u'dsport': 4789, u'dev': u't9s1if', u'tenant_route_ip': u'192.168.9.2', u'remote_route': u'10.2.81.0/24', u'subnet_route': u'10.1.81.0/24', u'v_name': u'vxlan_t9s1', u'id': 42, u'remote_ip': u'10.2.81.2'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t9ns1\" brctl show \"t9br1\" | grep -w 'vxlan_t9s1' ; if [ $? -ne 0 ] ; then ip netns exec \"t9ns1\" brctl addif \"t9br1\" \"vxlan_t9s1\" ; fi\n", "delta": "0:00:00.075696", "end": "2019-12-05 07:20:36.185241", "item": [{"bridge_name": "t9br1", "default_route_ip": "10.1.81.1", "dns": [{"brif": "t9s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.5", "dnsif": "t9s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t9ns1", "route": [{"if": "p1", "ip": "10.1.81.1/24", "ns_if": "t9if", "ns_name": "t9"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t9ns1if", "tenant_ns_ip": "10.1.81.1/24", "tenant_ns_name": "t9", "tenant_sub_if": "t9s1if", "tenant_sub_ip": "10.1.81.2/24"}], "vms": [{"brif": "t9br1if1", "disk": "10G", "mem": 2, "name": "t9_VM1", "vcpu": 4, "vmif": "t9VM1if1"}, {"brif": "t9br1if2", "disk": "10G", "mem": 4, "name": "t9_VM2", "vcpu": 2, "vmif": "t9VM2if1"}]}, {"dev": "t9s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.81.2", "remote_ip": "10.2.81.2", "remote_route": "10.2.81.0/24", "subnet_route": "10.1.81.0/24", "tenant_route_ip": "192.168.9.2", "v_name": "vxlan_t9s1"}], "rc": 0, "start": "2019-12-05 07:20:36.109545", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

PLAY RECAP **************************************************************************************************************************************************
localhost                  : ok=21   changed=21   unreachable=0    failed=0    skipped=0    rescued=0    ignored=0   

Using /etc/ansible/ansible.cfg as config file

PLAY [worker] ***********************************************************************************************************************************************

TASK [Create Tenant Namespace] ******************************************************************************************************************************
changed: [99.99.99.2] => (item={u'default_route_ip': u'192.168.137.1', u'name': u't9', u'pns_ip': u'192.168.137.1/24', u'tenant_if': u't9if', u'tenant_ip': u'192.168.137.2/24', u'pns_if': u't9pns_if'}) => {"ansible_loop_var": "item", "changed": true, "cmd": ["ip", "netns", "add", "t9"], "delta": "0:00:00.052615", "end": "2019-12-05 07:20:38.215349", "item": {"default_route_ip": "192.168.137.1", "name": "t9", "pns_if": "t9pns_if", "pns_ip": "192.168.137.1/24", "tenant_if": "t9if", "tenant_ip": "192.168.137.2/24"}, "rc": 0, "start": "2019-12-05 07:20:38.162734", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Create Subnet Namespace] ******************************************************************************************************************************
changed: [99.99.99.2] => (item={u'route': [{u'ip': u'10.2.81.1/24', u'ns_name': u't9', u'ns_if': u't9if', u'if': u'p1'}], u'default_route_ip': u'10.2.81.1', u'bridge_name': u't9br1', u'dns': [{u'dnsif': [], u'dhcp_start': [], u'dhcp_end': [], u'dnsif_ip': [], u'net_mask': [], u'brif': []}], u'ns_name': u't9ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.81.2/24', u'tenant_ns_ip': u'10.2.81.1/24', u'tenant_ns_if': u't9ns1if', u'tenant_ns_name': u't9', u'tenant_sub_if': u't9s1if'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't9_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't9br1if1', u'vmif': u't9VM4if1'}], u'vxlan': [{u'local_ip': u'10.2.81.2', u'tenant_route_ip': u'192.168.137.2', u'dsport': 4789, u'dev': u't9s1if', u'subnet_route': u'10.2.81.0/24', u'remote_route': u'10.1.81.0/24', u'v_name': u'vxlan_t9s1', u'id': 42, u'remote_ip': u'10.1.81.2'}]}) => {"ansible_loop_var": "item", "changed": true, "cmd": ["ip", "netns", "add", "t9ns1"], "delta": "0:00:00.065828", "end": "2019-12-05 07:20:38.742954", "item": {"bridge_name": "t9br1", "default_route_ip": "10.2.81.1", "dns": [{"brif": [], "dhcp_end": [], "dhcp_start": [], "dnsif": [], "dnsif_ip": [], "net_mask": []}], "ns_name": "t9ns1", "route": [{"if": "p1", "ip": "10.2.81.1/24", "ns_if": "t9if", "ns_name": "t9"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t9ns1if", "tenant_ns_ip": "10.2.81.1/24", "tenant_ns_name": "t9", "tenant_sub_if": "t9s1if", "tenant_sub_ip": "10.2.81.2/24"}], "vms": [{"brif": "t9br1if1", "disk": "10G", "mem": 2, "name": "t9_VM4", "vcpu": 4, "vmif": "t9VM4if1"}], "vxlan": [{"dev": "t9s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.81.2", "remote_ip": "10.1.81.2", "remote_route": "10.1.81.0/24", "subnet_route": "10.2.81.0/24", "tenant_route_ip": "192.168.137.2", "v_name": "vxlan_t9s1"}]}, "rc": 0, "start": "2019-12-05 07:20:38.677126", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}
changed: [99.99.99.2] => (item={u'route': [{u'ip': u'10.2.82.1/24', u'ns_name': u't9', u'ns_if': u't9if', u'if': u'p1'}], u'default_route_ip': u'10.2.82.1', u'bridge_name': u't9br2', u'dns': [{u'dnsif': u't9s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't9s2_dnsbrif'}], u'ns_name': u't9ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.82.2/24', u'tenant_ns_ip': u'10.2.82.1/24', u'tenant_ns_if': u't9ns2if', u'tenant_ns_name': u't9', u'tenant_sub_if': u't9s2if'}], u'subnet_ip': u'2.2.2.0/24', u'vms': [{u'mem': 3, u'name': u't9_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't9br2if1', u'vmif': u't9VM3if1'}], u'vxlan': [{u'local_ip': [], u'tenant_route_ip': [], u'dsport': [], u'dev': [], u'subnet_route': [], u'remote_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}) => {"ansible_loop_var": "item", "changed": true, "cmd": ["ip", "netns", "add", "t9ns2"], "delta": "0:00:00.058763", "end": "2019-12-05 07:20:39.159337", "item": {"bridge_name": "t9br2", "default_route_ip": "10.2.82.1", "dns": [{"brif": "t9s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t9s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t9ns2", "route": [{"if": "p1", "ip": "10.2.82.1/24", "ns_if": "t9if", "ns_name": "t9"}], "subnet_ip": "2.2.2.0/24", "tenant_ns": [{"tenant_ns_if": "t9ns2if", "tenant_ns_ip": "10.2.82.1/24", "tenant_ns_name": "t9", "tenant_sub_if": "t9s2if", "tenant_sub_ip": "10.2.82.2/24"}], "vms": [{"brif": "t9br2if1", "disk": "10G", "mem": 3, "name": "t9_VM3", "vcpu": 2, "vmif": "t9VM3if1"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, "rc": 0, "start": "2019-12-05 07:20:39.100574", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Create Tenant VETH pairs] *****************************************************************************************************************************
changed: [99.99.99.2] => (item={u'default_route_ip': u'192.168.137.1', u'name': u't9', u'pns_ip': u'192.168.137.1/24', u'tenant_if': u't9if', u'tenant_ip': u'192.168.137.2/24', u'pns_if': u't9pns_if'}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip link show \"t9if\" ; if [ $? -ne 0 ] ; then ip link add \"t9if\" type veth peer name \"t9pns_if\" ; fi\n", "delta": "0:00:00.013323", "end": "2019-12-05 07:20:39.579560", "item": {"default_route_ip": "192.168.137.1", "name": "t9", "pns_if": "t9pns_if", "pns_ip": "192.168.137.1/24", "tenant_if": "t9if", "tenant_ip": "192.168.137.2/24"}, "rc": 0, "start": "2019-12-05 07:20:39.566237", "stderr": "Device \"t9if\" does not exist.", "stderr_lines": ["Device \"t9if\" does not exist."], "stdout": "", "stdout_lines": []}

TASK [Attach Tenant VETH Pairs] *****************************************************************************************************************************
changed: [99.99.99.2] => (item={u'default_route_ip': u'192.168.137.1', u'name': u't9', u'pns_ip': u'192.168.137.1/24', u'tenant_if': u't9if', u'tenant_ip': u'192.168.137.2/24', u'pns_if': u't9pns_if'}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec pns ip link show \"t9pns_if\" ; if [ $? -ne 0 ] ; then ip link set \"t9pns_if\" netns pns ; fi\nip netns exec \"t9\" ip link show \"t9if\" ; if [ $? -ne 0 ] ; then ip link set \"t9if\" netns \"t9\" ; fi\nip netns exec pns ip link set dev \"t9pns_if\" up\nip netns exec \"t9\" ip link set dev \"t9if\" up\n", "delta": "0:00:00.221337", "end": "2019-12-05 07:20:40.192355", "item": {"default_route_ip": "192.168.137.1", "name": "t9", "pns_if": "t9pns_if", "pns_ip": "192.168.137.1/24", "tenant_if": "t9if", "tenant_ip": "192.168.137.2/24"}, "rc": 0, "start": "2019-12-05 07:20:39.971018", "stderr": "Device \"t9pns_if\" does not exist.\nDevice \"t9if\" does not exist.", "stderr_lines": ["Device \"t9pns_if\" does not exist.", "Device \"t9if\" does not exist."], "stdout": "", "stdout_lines": []}

TASK [Add IP addresses to Tenant VETH Pairs] ****************************************************************************************************************
changed: [99.99.99.2] => (item={u'default_route_ip': u'192.168.137.1', u'name': u't9', u'pns_ip': u'192.168.137.1/24', u'tenant_if': u't9if', u'tenant_ip': u'192.168.137.2/24', u'pns_if': u't9pns_if'}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec pns ip addr show \"t9pns_if\" | awk 'FNR==3{ print $2 }' | grep -w '^192.168.137.1/24' ; if [ $? -ne 0 ] ; then ip netns exec pns ip addr add \"192.168.137.1/24\" dev \"t9pns_if\" ; fi\nip netns exec \"t9\" ip addr show \"t9if\" | awk 'FNR==3{ print $2 }' | grep -w '^192.168.137.2/24' ; if [ $? -ne 0 ] ; then ip netns exec \"t9\" ip addr add \"192.168.137.2/24\" dev \"t9if\" ; fi\n", "delta": "0:00:00.151828", "end": "2019-12-05 07:20:40.748494", "item": {"default_route_ip": "192.168.137.1", "name": "t9", "pns_if": "t9pns_if", "pns_ip": "192.168.137.1/24", "tenant_if": "t9if", "tenant_ip": "192.168.137.2/24"}, "rc": 0, "start": "2019-12-05 07:20:40.596666", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Create Namespace VETH Pairs] **************************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.81.1/24', u'ns_name': u't9', u'ns_if': u't9if', u'if': u'p1'}], u'default_route_ip': u'10.2.81.1', u'bridge_name': u't9br1', u'dns': [{u'dnsif': [], u'dhcp_start': [], u'dhcp_end': [], u'dnsif_ip': [], u'net_mask': [], u'brif': []}], u'ns_name': u't9ns1', u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't9_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't9br1if1', u'vmif': u't9VM4if1'}], u'vxlan': [{u'local_ip': u'10.2.81.2', u'dsport': 4789, u'dev': u't9s1if', u'tenant_route_ip': u'192.168.137.2', u'remote_route': u'10.1.81.0/24', u'subnet_route': u'10.2.81.0/24', u'v_name': u'vxlan_t9s1', u'id': 42, u'remote_ip': u'10.1.81.2'}]}, {u'tenant_sub_ip': u'10.2.81.2/24', u'tenant_ns_ip': u'10.2.81.1/24', u'tenant_ns_if': u't9ns1if', u'tenant_sub_if': u't9s1if', u'tenant_ns_name': u't9'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip link show \"t9ns1if\" ; if [ $? -ne 0 ] ; then ip link add \"t9ns1if\" type veth peer name \"t9s1if\" ; fi\n", "delta": "0:00:00.013286", "end": "2019-12-05 07:20:41.169703", "item": [{"bridge_name": "t9br1", "default_route_ip": "10.2.81.1", "dns": [{"brif": [], "dhcp_end": [], "dhcp_start": [], "dnsif": [], "dnsif_ip": [], "net_mask": []}], "ns_name": "t9ns1", "route": [{"if": "p1", "ip": "10.2.81.1/24", "ns_if": "t9if", "ns_name": "t9"}], "subnet_ip": "1.1.1.0/24", "vms": [{"brif": "t9br1if1", "disk": "10G", "mem": 2, "name": "t9_VM4", "vcpu": 4, "vmif": "t9VM4if1"}], "vxlan": [{"dev": "t9s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.81.2", "remote_ip": "10.1.81.2", "remote_route": "10.1.81.0/24", "subnet_route": "10.2.81.0/24", "tenant_route_ip": "192.168.137.2", "v_name": "vxlan_t9s1"}]}, {"tenant_ns_if": "t9ns1if", "tenant_ns_ip": "10.2.81.1/24", "tenant_ns_name": "t9", "tenant_sub_if": "t9s1if", "tenant_sub_ip": "10.2.81.2/24"}], "rc": 0, "start": "2019-12-05 07:20:41.156417", "stderr": "Device \"t9ns1if\" does not exist.", "stderr_lines": ["Device \"t9ns1if\" does not exist."], "stdout": "", "stdout_lines": []}
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.82.1/24', u'ns_name': u't9', u'ns_if': u't9if', u'if': u'p1'}], u'default_route_ip': u'10.2.82.1', u'bridge_name': u't9br2', u'dns': [{u'dnsif': u't9s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't9s2_dnsbrif'}], u'ns_name': u't9ns2', u'subnet_ip': u'2.2.2.0/24', u'vms': [{u'mem': 3, u'name': u't9_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't9br2if1', u'vmif': u't9VM3if1'}], u'vxlan': [{u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}, {u'tenant_sub_ip': u'10.2.82.2/24', u'tenant_ns_ip': u'10.2.82.1/24', u'tenant_ns_if': u't9ns2if', u'tenant_sub_if': u't9s2if', u'tenant_ns_name': u't9'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip link show \"t9ns2if\" ; if [ $? -ne 0 ] ; then ip link add \"t9ns2if\" type veth peer name \"t9s2if\" ; fi\n", "delta": "0:00:00.012057", "end": "2019-12-05 07:20:41.542439", "item": [{"bridge_name": "t9br2", "default_route_ip": "10.2.82.1", "dns": [{"brif": "t9s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t9s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t9ns2", "route": [{"if": "p1", "ip": "10.2.82.1/24", "ns_if": "t9if", "ns_name": "t9"}], "subnet_ip": "2.2.2.0/24", "vms": [{"brif": "t9br2if1", "disk": "10G", "mem": 3, "name": "t9_VM3", "vcpu": 2, "vmif": "t9VM3if1"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, {"tenant_ns_if": "t9ns2if", "tenant_ns_ip": "10.2.82.1/24", "tenant_ns_name": "t9", "tenant_sub_if": "t9s2if", "tenant_sub_ip": "10.2.82.2/24"}], "rc": 0, "start": "2019-12-05 07:20:41.530382", "stderr": "Device \"t9ns2if\" does not exist.", "stderr_lines": ["Device \"t9ns2if\" does not exist."], "stdout": "", "stdout_lines": []}

TASK [Attach Namespace VETH Pairs] **************************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.81.1/24', u'ns_name': u't9', u'ns_if': u't9if', u'if': u'p1'}], u'default_route_ip': u'10.2.81.1', u'bridge_name': u't9br1', u'dns': [{u'dnsif': [], u'dhcp_start': [], u'dhcp_end': [], u'dnsif_ip': [], u'net_mask': [], u'brif': []}], u'ns_name': u't9ns1', u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't9_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't9br1if1', u'vmif': u't9VM4if1'}], u'vxlan': [{u'local_ip': u'10.2.81.2', u'dsport': 4789, u'dev': u't9s1if', u'tenant_route_ip': u'192.168.137.2', u'remote_route': u'10.1.81.0/24', u'subnet_route': u'10.2.81.0/24', u'v_name': u'vxlan_t9s1', u'id': 42, u'remote_ip': u'10.1.81.2'}]}, {u'tenant_sub_ip': u'10.2.81.2/24', u'tenant_ns_ip': u'10.2.81.1/24', u'tenant_ns_if': u't9ns1if', u'tenant_sub_if': u't9s1if', u'tenant_ns_name': u't9'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t9\" ip link show \"t9ns1if\" ; if [ $? -ne 0 ] ; then ip link set \"t9ns1if\" netns \"t9\" ; fi\nip netns exec \"t9ns1\" ip link show \"t9s1if\" ; if [ $? -ne 0 ] ; then ip link set \"t9s1if\" netns \"t9ns1\" ; fi\n", "delta": "0:00:00.125446", "end": "2019-12-05 07:20:42.108988", "item": [{"bridge_name": "t9br1", "default_route_ip": "10.2.81.1", "dns": [{"brif": [], "dhcp_end": [], "dhcp_start": [], "dnsif": [], "dnsif_ip": [], "net_mask": []}], "ns_name": "t9ns1", "route": [{"if": "p1", "ip": "10.2.81.1/24", "ns_if": "t9if", "ns_name": "t9"}], "subnet_ip": "1.1.1.0/24", "vms": [{"brif": "t9br1if1", "disk": "10G", "mem": 2, "name": "t9_VM4", "vcpu": 4, "vmif": "t9VM4if1"}], "vxlan": [{"dev": "t9s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.81.2", "remote_ip": "10.1.81.2", "remote_route": "10.1.81.0/24", "subnet_route": "10.2.81.0/24", "tenant_route_ip": "192.168.137.2", "v_name": "vxlan_t9s1"}]}, {"tenant_ns_if": "t9ns1if", "tenant_ns_ip": "10.2.81.1/24", "tenant_ns_name": "t9", "tenant_sub_if": "t9s1if", "tenant_sub_ip": "10.2.81.2/24"}], "rc": 0, "start": "2019-12-05 07:20:41.983542", "stderr": "Device \"t9ns1if\" does not exist.\nDevice \"t9s1if\" does not exist.", "stderr_lines": ["Device \"t9ns1if\" does not exist.", "Device \"t9s1if\" does not exist."], "stdout": "", "stdout_lines": []}
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.82.1/24', u'ns_name': u't9', u'ns_if': u't9if', u'if': u'p1'}], u'default_route_ip': u'10.2.82.1', u'bridge_name': u't9br2', u'dns': [{u'dnsif': u't9s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't9s2_dnsbrif'}], u'ns_name': u't9ns2', u'subnet_ip': u'2.2.2.0/24', u'vms': [{u'mem': 3, u'name': u't9_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't9br2if1', u'vmif': u't9VM3if1'}], u'vxlan': [{u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}, {u'tenant_sub_ip': u'10.2.82.2/24', u'tenant_ns_ip': u'10.2.82.1/24', u'tenant_ns_if': u't9ns2if', u'tenant_sub_if': u't9s2if', u'tenant_ns_name': u't9'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t9\" ip link show \"t9ns2if\" ; if [ $? -ne 0 ] ; then ip link set \"t9ns2if\" netns \"t9\" ; fi\nip netns exec \"t9ns2\" ip link show \"t9s2if\" ; if [ $? -ne 0 ] ; then ip link set \"t9s2if\" netns \"t9ns2\" ; fi\n", "delta": "0:00:00.116777", "end": "2019-12-05 07:20:42.558730", "item": [{"bridge_name": "t9br2", "default_route_ip": "10.2.82.1", "dns": [{"brif": "t9s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t9s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t9ns2", "route": [{"if": "p1", "ip": "10.2.82.1/24", "ns_if": "t9if", "ns_name": "t9"}], "subnet_ip": "2.2.2.0/24", "vms": [{"brif": "t9br2if1", "disk": "10G", "mem": 3, "name": "t9_VM3", "vcpu": 2, "vmif": "t9VM3if1"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, {"tenant_ns_if": "t9ns2if", "tenant_ns_ip": "10.2.82.1/24", "tenant_ns_name": "t9", "tenant_sub_if": "t9s2if", "tenant_sub_ip": "10.2.82.2/24"}], "rc": 0, "start": "2019-12-05 07:20:42.441953", "stderr": "Device \"t9ns2if\" does not exist.\nDevice \"t9s2if\" does not exist.", "stderr_lines": ["Device \"t9ns2if\" does not exist.", "Device \"t9s2if\" does not exist."], "stdout": "", "stdout_lines": []}

TASK [Set Namespace VETH Pairs UP] **************************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.81.1/24', u'ns_name': u't9', u'ns_if': u't9if', u'if': u'p1'}], u'default_route_ip': u'10.2.81.1', u'bridge_name': u't9br1', u'dns': [{u'dnsif': [], u'dhcp_start': [], u'dhcp_end': [], u'dnsif_ip': [], u'net_mask': [], u'brif': []}], u'ns_name': u't9ns1', u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't9_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't9br1if1', u'vmif': u't9VM4if1'}], u'vxlan': [{u'local_ip': u'10.2.81.2', u'dsport': 4789, u'dev': u't9s1if', u'tenant_route_ip': u'192.168.137.2', u'remote_route': u'10.1.81.0/24', u'subnet_route': u'10.2.81.0/24', u'v_name': u'vxlan_t9s1', u'id': 42, u'remote_ip': u'10.1.81.2'}]}, {u'tenant_sub_ip': u'10.2.81.2/24', u'tenant_ns_ip': u'10.2.81.1/24', u'tenant_ns_if': u't9ns1if', u'tenant_sub_if': u't9s1if', u'tenant_ns_name': u't9'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t9\" ip link set dev \"t9ns1if\" up\nip netns exec \"t9ns1\" ip link set dev \"t9s1if\" up\n", "delta": "0:00:00.074298", "end": "2019-12-05 07:20:43.036549", "item": [{"bridge_name": "t9br1", "default_route_ip": "10.2.81.1", "dns": [{"brif": [], "dhcp_end": [], "dhcp_start": [], "dnsif": [], "dnsif_ip": [], "net_mask": []}], "ns_name": "t9ns1", "route": [{"if": "p1", "ip": "10.2.81.1/24", "ns_if": "t9if", "ns_name": "t9"}], "subnet_ip": "1.1.1.0/24", "vms": [{"brif": "t9br1if1", "disk": "10G", "mem": 2, "name": "t9_VM4", "vcpu": 4, "vmif": "t9VM4if1"}], "vxlan": [{"dev": "t9s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.81.2", "remote_ip": "10.1.81.2", "remote_route": "10.1.81.0/24", "subnet_route": "10.2.81.0/24", "tenant_route_ip": "192.168.137.2", "v_name": "vxlan_t9s1"}]}, {"tenant_ns_if": "t9ns1if", "tenant_ns_ip": "10.2.81.1/24", "tenant_ns_name": "t9", "tenant_sub_if": "t9s1if", "tenant_sub_ip": "10.2.81.2/24"}], "rc": 0, "start": "2019-12-05 07:20:42.962251", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.82.1/24', u'ns_name': u't9', u'ns_if': u't9if', u'if': u'p1'}], u'default_route_ip': u'10.2.82.1', u'bridge_name': u't9br2', u'dns': [{u'dnsif': u't9s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't9s2_dnsbrif'}], u'ns_name': u't9ns2', u'subnet_ip': u'2.2.2.0/24', u'vms': [{u'mem': 3, u'name': u't9_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't9br2if1', u'vmif': u't9VM3if1'}], u'vxlan': [{u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}, {u'tenant_sub_ip': u'10.2.82.2/24', u'tenant_ns_ip': u'10.2.82.1/24', u'tenant_ns_if': u't9ns2if', u'tenant_sub_if': u't9s2if', u'tenant_ns_name': u't9'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t9\" ip link set dev \"t9ns2if\" up\nip netns exec \"t9ns2\" ip link set dev \"t9s2if\" up\n", "delta": "0:00:00.079710", "end": "2019-12-05 07:20:43.456593", "item": [{"bridge_name": "t9br2", "default_route_ip": "10.2.82.1", "dns": [{"brif": "t9s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t9s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t9ns2", "route": [{"if": "p1", "ip": "10.2.82.1/24", "ns_if": "t9if", "ns_name": "t9"}], "subnet_ip": "2.2.2.0/24", "vms": [{"brif": "t9br2if1", "disk": "10G", "mem": 3, "name": "t9_VM3", "vcpu": 2, "vmif": "t9VM3if1"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, {"tenant_ns_if": "t9ns2if", "tenant_ns_ip": "10.2.82.1/24", "tenant_ns_name": "t9", "tenant_sub_if": "t9s2if", "tenant_sub_ip": "10.2.82.2/24"}], "rc": 0, "start": "2019-12-05 07:20:43.376883", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Add IP addresses to Namespace VETH Pairs] *************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.81.1/24', u'ns_name': u't9', u'ns_if': u't9if', u'if': u'p1'}], u'default_route_ip': u'10.2.81.1', u'bridge_name': u't9br1', u'dns': [{u'dnsif': [], u'dhcp_start': [], u'dhcp_end': [], u'dnsif_ip': [], u'net_mask': [], u'brif': []}], u'ns_name': u't9ns1', u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't9_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't9br1if1', u'vmif': u't9VM4if1'}], u'vxlan': [{u'local_ip': u'10.2.81.2', u'dsport': 4789, u'dev': u't9s1if', u'tenant_route_ip': u'192.168.137.2', u'remote_route': u'10.1.81.0/24', u'subnet_route': u'10.2.81.0/24', u'v_name': u'vxlan_t9s1', u'id': 42, u'remote_ip': u'10.1.81.2'}]}, {u'tenant_sub_ip': u'10.2.81.2/24', u'tenant_ns_ip': u'10.2.81.1/24', u'tenant_ns_if': u't9ns1if', u'tenant_sub_if': u't9s1if', u'tenant_ns_name': u't9'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t9ns1\" ip addr show \"t9s1if\" | awk 'FNR==3{ print $2 }' | grep -w '^10.2.81.2/24' ; if [ $? -ne 0 ] ; then ip netns exec \"t9ns1\" ip addr add \"10.2.81.2/24\" dev \"t9s1if\" ; fi\n\nip netns exec \"t9\" ip addr show \"t9ns1if\" | awk 'FNR==3{ print $2 }' | grep -w '^10.2.81.1/24' ; if [ $? -ne 0 ] ; then ip netns exec \"t9\" ip addr add \"10.2.81.1/24\" dev \"t9ns1if\" ; fi\n", "delta": "0:00:00.155693", "end": "2019-12-05 07:20:44.036503", "item": [{"bridge_name": "t9br1", "default_route_ip": "10.2.81.1", "dns": [{"brif": [], "dhcp_end": [], "dhcp_start": [], "dnsif": [], "dnsif_ip": [], "net_mask": []}], "ns_name": "t9ns1", "route": [{"if": "p1", "ip": "10.2.81.1/24", "ns_if": "t9if", "ns_name": "t9"}], "subnet_ip": "1.1.1.0/24", "vms": [{"brif": "t9br1if1", "disk": "10G", "mem": 2, "name": "t9_VM4", "vcpu": 4, "vmif": "t9VM4if1"}], "vxlan": [{"dev": "t9s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.81.2", "remote_ip": "10.1.81.2", "remote_route": "10.1.81.0/24", "subnet_route": "10.2.81.0/24", "tenant_route_ip": "192.168.137.2", "v_name": "vxlan_t9s1"}]}, {"tenant_ns_if": "t9ns1if", "tenant_ns_ip": "10.2.81.1/24", "tenant_ns_name": "t9", "tenant_sub_if": "t9s1if", "tenant_sub_ip": "10.2.81.2/24"}], "rc": 0, "start": "2019-12-05 07:20:43.880810", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.82.1/24', u'ns_name': u't9', u'ns_if': u't9if', u'if': u'p1'}], u'default_route_ip': u'10.2.82.1', u'bridge_name': u't9br2', u'dns': [{u'dnsif': u't9s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't9s2_dnsbrif'}], u'ns_name': u't9ns2', u'subnet_ip': u'2.2.2.0/24', u'vms': [{u'mem': 3, u'name': u't9_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't9br2if1', u'vmif': u't9VM3if1'}], u'vxlan': [{u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}, {u'tenant_sub_ip': u'10.2.82.2/24', u'tenant_ns_ip': u'10.2.82.1/24', u'tenant_ns_if': u't9ns2if', u'tenant_sub_if': u't9s2if', u'tenant_ns_name': u't9'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t9ns2\" ip addr show \"t9s2if\" | awk 'FNR==3{ print $2 }' | grep -w '^10.2.82.2/24' ; if [ $? -ne 0 ] ; then ip netns exec \"t9ns2\" ip addr add \"10.2.82.2/24\" dev \"t9s2if\" ; fi\n\nip netns exec \"t9\" ip addr show \"t9ns2if\" | awk 'FNR==3{ print $2 }' | grep -w '^10.2.82.1/24' ; if [ $? -ne 0 ] ; then ip netns exec \"t9\" ip addr add \"10.2.82.1/24\" dev \"t9ns2if\" ; fi\n", "delta": "0:00:00.155852", "end": "2019-12-05 07:20:44.556355", "item": [{"bridge_name": "t9br2", "default_route_ip": "10.2.82.1", "dns": [{"brif": "t9s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t9s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t9ns2", "route": [{"if": "p1", "ip": "10.2.82.1/24", "ns_if": "t9if", "ns_name": "t9"}], "subnet_ip": "2.2.2.0/24", "vms": [{"brif": "t9br2if1", "disk": "10G", "mem": 3, "name": "t9_VM3", "vcpu": 2, "vmif": "t9VM3if1"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, {"tenant_ns_if": "t9ns2if", "tenant_ns_ip": "10.2.82.1/24", "tenant_ns_name": "t9", "tenant_sub_if": "t9s2if", "tenant_sub_ip": "10.2.82.2/24"}], "rc": 0, "start": "2019-12-05 07:20:44.400503", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Add IP Route to Tenant] *******************************************************************************************************************************
changed: [99.99.99.2] => (item={u'default_route_ip': u'192.168.137.1', u'name': u't9', u'pns_ip': u'192.168.137.1/24', u'tenant_if': u't9if', u'tenant_ip': u'192.168.137.2/24', u'pns_if': u't9pns_if'}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t9\" ip route show default | grep -w '[d]efault via 192.168.137.1' ; if [ $? -ne 0 ] ; then ip netns exec \"t9\" ip route add default via \"192.168.137.1\" ; fi\n", "delta": "0:00:00.077135", "end": "2019-12-05 07:20:45.064611", "item": {"default_route_ip": "192.168.137.1", "name": "t9", "pns_if": "t9pns_if", "pns_ip": "192.168.137.1/24", "tenant_if": "t9if", "tenant_ip": "192.168.137.2/24"}, "rc": 0, "start": "2019-12-05 07:20:44.987476", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Add IP Route to Tenant Subnet] ************************************************************************************************************************
changed: [99.99.99.2] => (item={u'route': [{u'ip': u'10.2.81.1/24', u'ns_name': u't9', u'ns_if': u't9if', u'if': u'p1'}], u'default_route_ip': u'10.2.81.1', u'bridge_name': u't9br1', u'dns': [{u'dnsif': [], u'dhcp_start': [], u'dhcp_end': [], u'dnsif_ip': [], u'net_mask': [], u'brif': []}], u'ns_name': u't9ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.81.2/24', u'tenant_ns_ip': u'10.2.81.1/24', u'tenant_ns_if': u't9ns1if', u'tenant_ns_name': u't9', u'tenant_sub_if': u't9s1if'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't9_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't9br1if1', u'vmif': u't9VM4if1'}], u'vxlan': [{u'local_ip': u'10.2.81.2', u'tenant_route_ip': u'192.168.137.2', u'dsport': 4789, u'dev': u't9s1if', u'subnet_route': u'10.2.81.0/24', u'remote_route': u'10.1.81.0/24', u'v_name': u'vxlan_t9s1', u'id': 42, u'remote_ip': u'10.1.81.2'}]}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t9ns1\" ip route show default | grep -w '[d]efault via 10.2.81.1' ; if [ $? -ne 0 ] ; then ip netns exec \"t9ns1\" ip route add default via \"10.2.81.1\" ; fi\n", "delta": "0:00:00.080772", "end": "2019-12-05 07:20:45.564422", "item": {"bridge_name": "t9br1", "default_route_ip": "10.2.81.1", "dns": [{"brif": [], "dhcp_end": [], "dhcp_start": [], "dnsif": [], "dnsif_ip": [], "net_mask": []}], "ns_name": "t9ns1", "route": [{"if": "p1", "ip": "10.2.81.1/24", "ns_if": "t9if", "ns_name": "t9"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t9ns1if", "tenant_ns_ip": "10.2.81.1/24", "tenant_ns_name": "t9", "tenant_sub_if": "t9s1if", "tenant_sub_ip": "10.2.81.2/24"}], "vms": [{"brif": "t9br1if1", "disk": "10G", "mem": 2, "name": "t9_VM4", "vcpu": 4, "vmif": "t9VM4if1"}], "vxlan": [{"dev": "t9s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.81.2", "remote_ip": "10.1.81.2", "remote_route": "10.1.81.0/24", "subnet_route": "10.2.81.0/24", "tenant_route_ip": "192.168.137.2", "v_name": "vxlan_t9s1"}]}, "rc": 0, "start": "2019-12-05 07:20:45.483650", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}
changed: [99.99.99.2] => (item={u'route': [{u'ip': u'10.2.82.1/24', u'ns_name': u't9', u'ns_if': u't9if', u'if': u'p1'}], u'default_route_ip': u'10.2.82.1', u'bridge_name': u't9br2', u'dns': [{u'dnsif': u't9s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't9s2_dnsbrif'}], u'ns_name': u't9ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.82.2/24', u'tenant_ns_ip': u'10.2.82.1/24', u'tenant_ns_if': u't9ns2if', u'tenant_ns_name': u't9', u'tenant_sub_if': u't9s2if'}], u'subnet_ip': u'2.2.2.0/24', u'vms': [{u'mem': 3, u'name': u't9_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't9br2if1', u'vmif': u't9VM3if1'}], u'vxlan': [{u'local_ip': [], u'tenant_route_ip': [], u'dsport': [], u'dev': [], u'subnet_route': [], u'remote_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t9ns2\" ip route show default | grep -w '[d]efault via 10.2.82.1' ; if [ $? -ne 0 ] ; then ip netns exec \"t9ns2\" ip route add default via \"10.2.82.1\" ; fi\n", "delta": "0:00:00.081525", "end": "2019-12-05 07:20:45.960473", "item": {"bridge_name": "t9br2", "default_route_ip": "10.2.82.1", "dns": [{"brif": "t9s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t9s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t9ns2", "route": [{"if": "p1", "ip": "10.2.82.1/24", "ns_if": "t9if", "ns_name": "t9"}], "subnet_ip": "2.2.2.0/24", "tenant_ns": [{"tenant_ns_if": "t9ns2if", "tenant_ns_ip": "10.2.82.1/24", "tenant_ns_name": "t9", "tenant_sub_if": "t9s2if", "tenant_sub_ip": "10.2.82.2/24"}], "vms": [{"brif": "t9br2if1", "disk": "10G", "mem": 3, "name": "t9_VM3", "vcpu": 2, "vmif": "t9VM3if1"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, "rc": 0, "start": "2019-12-05 07:20:45.878948", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Create bridge inside namespace] ***********************************************************************************************************************
changed: [99.99.99.2] => (item={u'route': [{u'ip': u'10.2.81.1/24', u'ns_name': u't9', u'ns_if': u't9if', u'if': u'p1'}], u'default_route_ip': u'10.2.81.1', u'bridge_name': u't9br1', u'dns': [{u'dnsif': [], u'dhcp_start': [], u'dhcp_end': [], u'dnsif_ip': [], u'net_mask': [], u'brif': []}], u'ns_name': u't9ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.81.2/24', u'tenant_ns_ip': u'10.2.81.1/24', u'tenant_ns_if': u't9ns1if', u'tenant_ns_name': u't9', u'tenant_sub_if': u't9s1if'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't9_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't9br1if1', u'vmif': u't9VM4if1'}], u'vxlan': [{u'local_ip': u'10.2.81.2', u'tenant_route_ip': u'192.168.137.2', u'dsport': 4789, u'dev': u't9s1if', u'subnet_route': u'10.2.81.0/24', u'remote_route': u'10.1.81.0/24', u'v_name': u'vxlan_t9s1', u'id': 42, u'remote_ip': u'10.1.81.2'}]}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t9ns1\" brctl show | grep -w '^t9br1'; if [ $? -ne 0 ] ; then ip netns exec \"t9ns1\" brctl addbr \"t9br1\" ; fi\nip netns exec \"t9ns1\" ip link set dev \"t9br1\" up\n", "delta": "0:00:00.147110", "end": "2019-12-05 07:20:46.500494", "item": {"bridge_name": "t9br1", "default_route_ip": "10.2.81.1", "dns": [{"brif": [], "dhcp_end": [], "dhcp_start": [], "dnsif": [], "dnsif_ip": [], "net_mask": []}], "ns_name": "t9ns1", "route": [{"if": "p1", "ip": "10.2.81.1/24", "ns_if": "t9if", "ns_name": "t9"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t9ns1if", "tenant_ns_ip": "10.2.81.1/24", "tenant_ns_name": "t9", "tenant_sub_if": "t9s1if", "tenant_sub_ip": "10.2.81.2/24"}], "vms": [{"brif": "t9br1if1", "disk": "10G", "mem": 2, "name": "t9_VM4", "vcpu": 4, "vmif": "t9VM4if1"}], "vxlan": [{"dev": "t9s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.81.2", "remote_ip": "10.1.81.2", "remote_route": "10.1.81.0/24", "subnet_route": "10.2.81.0/24", "tenant_route_ip": "192.168.137.2", "v_name": "vxlan_t9s1"}]}, "rc": 0, "start": "2019-12-05 07:20:46.353384", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}
changed: [99.99.99.2] => (item={u'route': [{u'ip': u'10.2.82.1/24', u'ns_name': u't9', u'ns_if': u't9if', u'if': u'p1'}], u'default_route_ip': u'10.2.82.1', u'bridge_name': u't9br2', u'dns': [{u'dnsif': u't9s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't9s2_dnsbrif'}], u'ns_name': u't9ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.82.2/24', u'tenant_ns_ip': u'10.2.82.1/24', u'tenant_ns_if': u't9ns2if', u'tenant_ns_name': u't9', u'tenant_sub_if': u't9s2if'}], u'subnet_ip': u'2.2.2.0/24', u'vms': [{u'mem': 3, u'name': u't9_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't9br2if1', u'vmif': u't9VM3if1'}], u'vxlan': [{u'local_ip': [], u'tenant_route_ip': [], u'dsport': [], u'dev': [], u'subnet_route': [], u'remote_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t9ns2\" brctl show | grep -w '^t9br2'; if [ $? -ne 0 ] ; then ip netns exec \"t9ns2\" brctl addbr \"t9br2\" ; fi\nip netns exec \"t9ns2\" ip link set dev \"t9br2\" up\n", "delta": "0:00:00.114885", "end": "2019-12-05 07:20:46.940705", "item": {"bridge_name": "t9br2", "default_route_ip": "10.2.82.1", "dns": [{"brif": "t9s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t9s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t9ns2", "route": [{"if": "p1", "ip": "10.2.82.1/24", "ns_if": "t9if", "ns_name": "t9"}], "subnet_ip": "2.2.2.0/24", "tenant_ns": [{"tenant_ns_if": "t9ns2if", "tenant_ns_ip": "10.2.82.1/24", "tenant_ns_name": "t9", "tenant_sub_if": "t9s2if", "tenant_sub_ip": "10.2.82.2/24"}], "vms": [{"brif": "t9br2if1", "disk": "10G", "mem": 3, "name": "t9_VM3", "vcpu": 2, "vmif": "t9VM3if1"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, "rc": 0, "start": "2019-12-05 07:20:46.825820", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Create DNS VETH Pair] *********************************************************************************************************************************
failed: [99.99.99.2] (item=[{u'route': [{u'ip': u'10.2.81.1/24', u'ns_name': u't9', u'ns_if': u't9if', u'if': u'p1'}], u'default_route_ip': u'10.2.81.1', u'bridge_name': u't9br1', u'ns_name': u't9ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.81.2/24', u'tenant_ns_ip': u'10.2.81.1/24', u'tenant_ns_if': u't9ns1if', u'tenant_sub_if': u't9s1if', u'tenant_ns_name': u't9'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't9_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't9br1if1', u'vmif': u't9VM4if1'}], u'vxlan': [{u'local_ip': u'10.2.81.2', u'dsport': 4789, u'dev': u't9s1if', u'tenant_route_ip': u'192.168.137.2', u'remote_route': u'10.1.81.0/24', u'subnet_route': u'10.2.81.0/24', u'v_name': u'vxlan_t9s1', u'id': 42, u'remote_ip': u'10.1.81.2'}]}, {u'dnsif': [], u'dhcp_start': [], u'dhcp_end': [], u'dnsif_ip': [], u'net_mask': [], u'brif': []}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t9ns1\" ip link show \"[]\" ; if [ $? -ne 0 ] ; then ip netns exec \"t9ns1\" ip link add \"[]\" type veth peer name \"[]\" ; fi\nip netns exec \"t9ns1\" ip link set dev \"[]\" up\nip netns exec \"t9ns1\" ip link set dev \"[]\" up\n", "delta": "0:00:00.234446", "end": "2019-12-05 07:20:47.584392", "item": [{"bridge_name": "t9br1", "default_route_ip": "10.2.81.1", "ns_name": "t9ns1", "route": [{"if": "p1", "ip": "10.2.81.1/24", "ns_if": "t9if", "ns_name": "t9"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t9ns1if", "tenant_ns_ip": "10.2.81.1/24", "tenant_ns_name": "t9", "tenant_sub_if": "t9s1if", "tenant_sub_ip": "10.2.81.2/24"}], "vms": [{"brif": "t9br1if1", "disk": "10G", "mem": 2, "name": "t9_VM4", "vcpu": 4, "vmif": "t9VM4if1"}], "vxlan": [{"dev": "t9s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.81.2", "remote_ip": "10.1.81.2", "remote_route": "10.1.81.0/24", "subnet_route": "10.2.81.0/24", "tenant_route_ip": "192.168.137.2", "v_name": "vxlan_t9s1"}]}, {"brif": [], "dhcp_end": [], "dhcp_start": [], "dnsif": [], "dnsif_ip": [], "net_mask": []}], "msg": "non-zero return code", "rc": 1, "start": "2019-12-05 07:20:47.349946", "stderr": "Device \"[]\" does not exist.\nRTNETLINK answers: File exists\nCannot find device \"[]\"\nCannot find device \"[]\"", "stderr_lines": ["Device \"[]\" does not exist.", "RTNETLINK answers: File exists", "Cannot find device \"[]\"", "Cannot find device \"[]\""], "stdout": "", "stdout_lines": []}
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.82.1/24', u'ns_name': u't9', u'ns_if': u't9if', u'if': u'p1'}], u'default_route_ip': u'10.2.82.1', u'bridge_name': u't9br2', u'ns_name': u't9ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.82.2/24', u'tenant_ns_ip': u'10.2.82.1/24', u'tenant_ns_if': u't9ns2if', u'tenant_sub_if': u't9s2if', u'tenant_ns_name': u't9'}], u'subnet_ip': u'2.2.2.0/24', u'vms': [{u'mem': 3, u'name': u't9_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't9br2if1', u'vmif': u't9VM3if1'}], u'vxlan': [{u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}, {u'dnsif': u't9s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't9s2_dnsbrif'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t9ns2\" ip link show \"t9s2_dnsbrif\" ; if [ $? -ne 0 ] ; then ip netns exec \"t9ns2\" ip link add \"t9s2_dnsbrif\" type veth peer name \"t9s2_dnsif\" ; fi\nip netns exec \"t9ns2\" ip link set dev \"t9s2_dnsbrif\" up\nip netns exec \"t9ns2\" ip link set dev \"t9s2_dnsif\" up\n", "delta": "0:00:00.133306", "end": "2019-12-05 07:20:48.048473", "item": [{"bridge_name": "t9br2", "default_route_ip": "10.2.82.1", "ns_name": "t9ns2", "route": [{"if": "p1", "ip": "10.2.82.1/24", "ns_if": "t9if", "ns_name": "t9"}], "subnet_ip": "2.2.2.0/24", "tenant_ns": [{"tenant_ns_if": "t9ns2if", "tenant_ns_ip": "10.2.82.1/24", "tenant_ns_name": "t9", "tenant_sub_if": "t9s2if", "tenant_sub_ip": "10.2.82.2/24"}], "vms": [{"brif": "t9br2if1", "disk": "10G", "mem": 3, "name": "t9_VM3", "vcpu": 2, "vmif": "t9VM3if1"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, {"brif": "t9s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t9s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "rc": 0, "start": "2019-12-05 07:20:47.915167", "stderr": "Device \"t9s2_dnsbrif\" does not exist.", "stderr_lines": ["Device \"t9s2_dnsbrif\" does not exist."], "stdout": "", "stdout_lines": []}

PLAY RECAP **************************************************************************************************************************************************
99.99.99.2                 : ok=12   changed=12   unreachable=0    failed=1    skipped=0    rescued=0    ignored=0   

INFO:root: 07:21:57.145723 Printing the yaml input file
INFO:root: 07:21:57.145838 {'C1': [{'subnet_addr': '1.1.1.0/24', 'VM': [{'name': 'VM1', 'disk': '10G', 'mem': 2, 'vcpu': 4, 'internet_access': True}, {'name': 'VM2', 'disk': '10G', 'mem': 4, 'vcpu': 2, 'internet_access': False}]}], 'C2': [{'subnet_addr': '1.1.1.0/24', 'VM': [{'name': 'VM4', 'disk': '10G', 'mem': 2, 'vcpu': 4, 'internet_access': True}]}, {'subnet_addr': '2.2.2.0/24', 'VM': [{'name': 'VM3', 'disk': '10G', 'mem': 3, 'vcpu': 2, 'internet_access': True}]}], 'MISC': [{'LOG_ENABLE': True}, {'GUI': True}]}
INFO:root: 07:21:57.145929 Provided subnet in C1: 1.1.1.0/24 is valid
INFO:root: 07:21:57.145977 Provided subnet in C2: 1.1.1.0/24 is valid
INFO:root: 07:21:57.146017 Provided subnet in C2: 2.2.2.0/24 is valid
Using /etc/ansible/ansible.cfg as config file

PLAY [main] *************************************************************************************************************************************************

TASK [Create Tenant Namespace] ******************************************************************************************************************************
changed: [localhost] => (item={u'default_route_ip': u'192.168.0.1', u'name': u't10', u'pns_ip': u'192.168.0.1/24', u'tenant_if': u't10if', u'tenant_ip': u'192.168.0.2/24', u'pns_if': u't10pns_if'}) => {"ansible_loop_var": "item", "changed": true, "cmd": ["ip", "netns", "add", "t10"], "delta": "0:00:00.070252", "end": "2019-12-05 07:21:58.305611", "item": {"default_route_ip": "192.168.0.1", "name": "t10", "pns_if": "t10pns_if", "pns_ip": "192.168.0.1/24", "tenant_if": "t10if", "tenant_ip": "192.168.0.2/24"}, "rc": 0, "start": "2019-12-05 07:21:58.235359", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Create Subnet Namespace] ******************************************************************************************************************************
changed: [localhost] => (item={u'route': [{u'ip': u'10.1.-9.1/24', u'ns_name': u't10', u'ns_if': u't10if', u'if': u'p1'}], u'default_route_ip': u'10.1.-9.1', u'bridge_name': u't10br1', u'dns': [{u'dnsif': u't10s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't10s1_dnsbrif'}], u'ns_name': u't10ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.-9.2/24', u'tenant_ns_ip': u'10.1.-9.1/24', u'tenant_ns_if': u't10ns1if', u'tenant_ns_name': u't10', u'tenant_sub_if': u't10s1if'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't10_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't10br1if1', u'vmif': u't10VM1if1'}, {u'mem': 4, u'name': u't10_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't10br1if2', u'vmif': u't10VM2if1'}], u'vxlan': [{u'local_ip': u'10.1.-9.2', u'tenant_route_ip': u'192.168.0.2', u'dsport': 4789, u'dev': u't10s1if', u'subnet_route': u'10.1.-9.0/24', u'remote_route': u'10.2.-9.0/24', u'v_name': u'vxlan_t10s1', u'id': 42, u'remote_ip': u'10.2.-9.2'}]}) => {"ansible_loop_var": "item", "changed": true, "cmd": ["ip", "netns", "add", "t10ns1"], "delta": "0:00:00.061666", "end": "2019-12-05 07:21:58.625812", "item": {"bridge_name": "t10br1", "default_route_ip": "10.1.-9.1", "dns": [{"brif": "t10s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.5", "dnsif": "t10s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t10ns1", "route": [{"if": "p1", "ip": "10.1.-9.1/24", "ns_if": "t10if", "ns_name": "t10"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t10ns1if", "tenant_ns_ip": "10.1.-9.1/24", "tenant_ns_name": "t10", "tenant_sub_if": "t10s1if", "tenant_sub_ip": "10.1.-9.2/24"}], "vms": [{"brif": "t10br1if1", "disk": "10G", "mem": 2, "name": "t10_VM1", "vcpu": 4, "vmif": "t10VM1if1"}, {"brif": "t10br1if2", "disk": "10G", "mem": 4, "name": "t10_VM2", "vcpu": 2, "vmif": "t10VM2if1"}], "vxlan": [{"dev": "t10s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.-9.2", "remote_ip": "10.2.-9.2", "remote_route": "10.2.-9.0/24", "subnet_route": "10.1.-9.0/24", "tenant_route_ip": "192.168.0.2", "v_name": "vxlan_t10s1"}]}, "rc": 0, "start": "2019-12-05 07:21:58.564146", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Create Tenant VETH pairs] *****************************************************************************************************************************
changed: [localhost] => (item={u'default_route_ip': u'192.168.0.1', u'name': u't10', u'pns_ip': u'192.168.0.1/24', u'tenant_if': u't10if', u'tenant_ip': u'192.168.0.2/24', u'pns_if': u't10pns_if'}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip link show \"t10if\" ; if [ $? -ne 0 ] ; then ip link add \"t10if\" type veth peer name \"t10pns_if\" ; fi\n", "delta": "0:00:00.015824", "end": "2019-12-05 07:21:58.944824", "item": {"default_route_ip": "192.168.0.1", "name": "t10", "pns_if": "t10pns_if", "pns_ip": "192.168.0.1/24", "tenant_if": "t10if", "tenant_ip": "192.168.0.2/24"}, "rc": 0, "start": "2019-12-05 07:21:58.929000", "stderr": "Device \"t10if\" does not exist.", "stderr_lines": ["Device \"t10if\" does not exist."], "stdout": "", "stdout_lines": []}

TASK [Attach Tenant VETH Pairs] *****************************************************************************************************************************
changed: [localhost] => (item={u'default_route_ip': u'192.168.0.1', u'name': u't10', u'pns_ip': u'192.168.0.1/24', u'tenant_if': u't10if', u'tenant_ip': u'192.168.0.2/24', u'pns_if': u't10pns_if'}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec pns ip link show \"t10pns_if\" ; if [ $? -ne 0 ] ; then ip link set \"t10pns_if\" netns pns ; fi\nip netns exec \"t10\" ip link show \"t10if\" ; if [ $? -ne 0 ] ; then ip link set \"t10if\" netns \"t10\" ; fi\nip netns exec pns ip link set dev \"t10pns_if\" up\nip netns exec \"t10\" ip link set dev \"t10if\" up\n", "delta": "0:00:00.205751", "end": "2019-12-05 07:21:59.437108", "item": {"default_route_ip": "192.168.0.1", "name": "t10", "pns_if": "t10pns_if", "pns_ip": "192.168.0.1/24", "tenant_if": "t10if", "tenant_ip": "192.168.0.2/24"}, "rc": 0, "start": "2019-12-05 07:21:59.231357", "stderr": "Device \"t10pns_if\" does not exist.\nDevice \"t10if\" does not exist.", "stderr_lines": ["Device \"t10pns_if\" does not exist.", "Device \"t10if\" does not exist."], "stdout": "", "stdout_lines": []}

TASK [Add IP addresses to Tenant VETH Pairs] ****************************************************************************************************************
changed: [localhost] => (item={u'default_route_ip': u'192.168.0.1', u'name': u't10', u'pns_ip': u'192.168.0.1/24', u'tenant_if': u't10if', u'tenant_ip': u'192.168.0.2/24', u'pns_if': u't10pns_if'}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec pns ip addr show \"t10pns_if\" | awk 'FNR==3{ print $2 }' | grep -w '^192.168.0.1/24' ; if [ $? -ne 0 ] ; then ip netns exec pns ip addr add \"192.168.0.1/24\" dev \"t10pns_if\" ; fi\nip netns exec \"t10\" ip addr show \"t10if\" | awk 'FNR==3{ print $2 }' | grep -w '^192.168.0.2/24' ; if [ $? -ne 0 ] ; then ip netns exec \"t10\" ip addr add \"192.168.0.2/24\" dev \"t10if\" ; fi\n", "delta": "0:00:00.140619", "end": "2019-12-05 07:21:59.869201", "item": {"default_route_ip": "192.168.0.1", "name": "t10", "pns_if": "t10pns_if", "pns_ip": "192.168.0.1/24", "tenant_if": "t10if", "tenant_ip": "192.168.0.2/24"}, "rc": 0, "start": "2019-12-05 07:21:59.728582", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Create Namespace VETH Pairs] **************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.-9.1/24', u'ns_name': u't10', u'ns_if': u't10if', u'if': u'p1'}], u'default_route_ip': u'10.1.-9.1', u'bridge_name': u't10br1', u'dns': [{u'dnsif': u't10s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't10s1_dnsbrif'}], u'ns_name': u't10ns1', u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't10_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't10br1if1', u'vmif': u't10VM1if1'}, {u'mem': 4, u'name': u't10_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't10br1if2', u'vmif': u't10VM2if1'}], u'vxlan': [{u'local_ip': u'10.1.-9.2', u'dsport': 4789, u'dev': u't10s1if', u'tenant_route_ip': u'192.168.0.2', u'remote_route': u'10.2.-9.0/24', u'subnet_route': u'10.1.-9.0/24', u'v_name': u'vxlan_t10s1', u'id': 42, u'remote_ip': u'10.2.-9.2'}]}, {u'tenant_sub_ip': u'10.1.-9.2/24', u'tenant_ns_ip': u'10.1.-9.1/24', u'tenant_ns_if': u't10ns1if', u'tenant_sub_if': u't10s1if', u'tenant_ns_name': u't10'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip link show \"t10ns1if\" ; if [ $? -ne 0 ] ; then ip link add \"t10ns1if\" type veth peer name \"t10s1if\" ; fi\n", "delta": "0:00:00.012593", "end": "2019-12-05 07:22:00.157567", "item": [{"bridge_name": "t10br1", "default_route_ip": "10.1.-9.1", "dns": [{"brif": "t10s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.5", "dnsif": "t10s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t10ns1", "route": [{"if": "p1", "ip": "10.1.-9.1/24", "ns_if": "t10if", "ns_name": "t10"}], "subnet_ip": "1.1.1.0/24", "vms": [{"brif": "t10br1if1", "disk": "10G", "mem": 2, "name": "t10_VM1", "vcpu": 4, "vmif": "t10VM1if1"}, {"brif": "t10br1if2", "disk": "10G", "mem": 4, "name": "t10_VM2", "vcpu": 2, "vmif": "t10VM2if1"}], "vxlan": [{"dev": "t10s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.-9.2", "remote_ip": "10.2.-9.2", "remote_route": "10.2.-9.0/24", "subnet_route": "10.1.-9.0/24", "tenant_route_ip": "192.168.0.2", "v_name": "vxlan_t10s1"}]}, {"tenant_ns_if": "t10ns1if", "tenant_ns_ip": "10.1.-9.1/24", "tenant_ns_name": "t10", "tenant_sub_if": "t10s1if", "tenant_sub_ip": "10.1.-9.2/24"}], "rc": 0, "start": "2019-12-05 07:22:00.144974", "stderr": "Device \"t10ns1if\" does not exist.", "stderr_lines": ["Device \"t10ns1if\" does not exist."], "stdout": "", "stdout_lines": []}

TASK [Attach Namespace VETH Pairs] **************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.-9.1/24', u'ns_name': u't10', u'ns_if': u't10if', u'if': u'p1'}], u'default_route_ip': u'10.1.-9.1', u'bridge_name': u't10br1', u'dns': [{u'dnsif': u't10s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't10s1_dnsbrif'}], u'ns_name': u't10ns1', u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't10_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't10br1if1', u'vmif': u't10VM1if1'}, {u'mem': 4, u'name': u't10_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't10br1if2', u'vmif': u't10VM2if1'}], u'vxlan': [{u'local_ip': u'10.1.-9.2', u'dsport': 4789, u'dev': u't10s1if', u'tenant_route_ip': u'192.168.0.2', u'remote_route': u'10.2.-9.0/24', u'subnet_route': u'10.1.-9.0/24', u'v_name': u'vxlan_t10s1', u'id': 42, u'remote_ip': u'10.2.-9.2'}]}, {u'tenant_sub_ip': u'10.1.-9.2/24', u'tenant_ns_ip': u'10.1.-9.1/24', u'tenant_ns_if': u't10ns1if', u'tenant_sub_if': u't10s1if', u'tenant_ns_name': u't10'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t10\" ip link show \"t10ns1if\" ; if [ $? -ne 0 ] ; then ip link set \"t10ns1if\" netns \"t10\" ; fi\nip netns exec \"t10ns1\" ip link show \"t10s1if\" ; if [ $? -ne 0 ] ; then ip link set \"t10s1if\" netns \"t10ns1\" ; fi\n", "delta": "0:00:00.140158", "end": "2019-12-05 07:22:00.605318", "item": [{"bridge_name": "t10br1", "default_route_ip": "10.1.-9.1", "dns": [{"brif": "t10s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.5", "dnsif": "t10s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t10ns1", "route": [{"if": "p1", "ip": "10.1.-9.1/24", "ns_if": "t10if", "ns_name": "t10"}], "subnet_ip": "1.1.1.0/24", "vms": [{"brif": "t10br1if1", "disk": "10G", "mem": 2, "name": "t10_VM1", "vcpu": 4, "vmif": "t10VM1if1"}, {"brif": "t10br1if2", "disk": "10G", "mem": 4, "name": "t10_VM2", "vcpu": 2, "vmif": "t10VM2if1"}], "vxlan": [{"dev": "t10s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.-9.2", "remote_ip": "10.2.-9.2", "remote_route": "10.2.-9.0/24", "subnet_route": "10.1.-9.0/24", "tenant_route_ip": "192.168.0.2", "v_name": "vxlan_t10s1"}]}, {"tenant_ns_if": "t10ns1if", "tenant_ns_ip": "10.1.-9.1/24", "tenant_ns_name": "t10", "tenant_sub_if": "t10s1if", "tenant_sub_ip": "10.1.-9.2/24"}], "rc": 0, "start": "2019-12-05 07:22:00.465160", "stderr": "Device \"t10ns1if\" does not exist.\nDevice \"t10s1if\" does not exist.", "stderr_lines": ["Device \"t10ns1if\" does not exist.", "Device \"t10s1if\" does not exist."], "stdout": "", "stdout_lines": []}

TASK [Set Namespace VETH Pairs UP] **************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.-9.1/24', u'ns_name': u't10', u'ns_if': u't10if', u'if': u'p1'}], u'default_route_ip': u'10.1.-9.1', u'bridge_name': u't10br1', u'dns': [{u'dnsif': u't10s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't10s1_dnsbrif'}], u'ns_name': u't10ns1', u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't10_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't10br1if1', u'vmif': u't10VM1if1'}, {u'mem': 4, u'name': u't10_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't10br1if2', u'vmif': u't10VM2if1'}], u'vxlan': [{u'local_ip': u'10.1.-9.2', u'dsport': 4789, u'dev': u't10s1if', u'tenant_route_ip': u'192.168.0.2', u'remote_route': u'10.2.-9.0/24', u'subnet_route': u'10.1.-9.0/24', u'v_name': u'vxlan_t10s1', u'id': 42, u'remote_ip': u'10.2.-9.2'}]}, {u'tenant_sub_ip': u'10.1.-9.2/24', u'tenant_ns_ip': u'10.1.-9.1/24', u'tenant_ns_if': u't10ns1if', u'tenant_sub_if': u't10s1if', u'tenant_ns_name': u't10'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t10\" ip link set dev \"t10ns1if\" up\nip netns exec \"t10ns1\" ip link set dev \"t10s1if\" up\n", "delta": "0:00:00.071471", "end": "2019-12-05 07:22:00.973153", "item": [{"bridge_name": "t10br1", "default_route_ip": "10.1.-9.1", "dns": [{"brif": "t10s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.5", "dnsif": "t10s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t10ns1", "route": [{"if": "p1", "ip": "10.1.-9.1/24", "ns_if": "t10if", "ns_name": "t10"}], "subnet_ip": "1.1.1.0/24", "vms": [{"brif": "t10br1if1", "disk": "10G", "mem": 2, "name": "t10_VM1", "vcpu": 4, "vmif": "t10VM1if1"}, {"brif": "t10br1if2", "disk": "10G", "mem": 4, "name": "t10_VM2", "vcpu": 2, "vmif": "t10VM2if1"}], "vxlan": [{"dev": "t10s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.-9.2", "remote_ip": "10.2.-9.2", "remote_route": "10.2.-9.0/24", "subnet_route": "10.1.-9.0/24", "tenant_route_ip": "192.168.0.2", "v_name": "vxlan_t10s1"}]}, {"tenant_ns_if": "t10ns1if", "tenant_ns_ip": "10.1.-9.1/24", "tenant_ns_name": "t10", "tenant_sub_if": "t10s1if", "tenant_sub_ip": "10.1.-9.2/24"}], "rc": 0, "start": "2019-12-05 07:22:00.901682", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Add IP addresses to Namespace VETH Pairs] *************************************************************************************************************
failed: [localhost] (item=[{u'route': [{u'ip': u'10.1.-9.1/24', u'ns_name': u't10', u'ns_if': u't10if', u'if': u'p1'}], u'default_route_ip': u'10.1.-9.1', u'bridge_name': u't10br1', u'dns': [{u'dnsif': u't10s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't10s1_dnsbrif'}], u'ns_name': u't10ns1', u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't10_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't10br1if1', u'vmif': u't10VM1if1'}, {u'mem': 4, u'name': u't10_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't10br1if2', u'vmif': u't10VM2if1'}], u'vxlan': [{u'local_ip': u'10.1.-9.2', u'dsport': 4789, u'dev': u't10s1if', u'tenant_route_ip': u'192.168.0.2', u'remote_route': u'10.2.-9.0/24', u'subnet_route': u'10.1.-9.0/24', u'v_name': u'vxlan_t10s1', u'id': 42, u'remote_ip': u'10.2.-9.2'}]}, {u'tenant_sub_ip': u'10.1.-9.2/24', u'tenant_ns_ip': u'10.1.-9.1/24', u'tenant_ns_if': u't10ns1if', u'tenant_sub_if': u't10s1if', u'tenant_ns_name': u't10'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t10ns1\" ip addr show \"t10s1if\" | awk 'FNR==3{ print $2 }' | grep -w '^10.1.-9.2/24' ; if [ $? -ne 0 ] ; then ip netns exec \"t10ns1\" ip addr add \"10.1.-9.2/24\" dev \"t10s1if\" ; fi\n\nip netns exec \"t10\" ip addr show \"t10ns1if\" | awk 'FNR==3{ print $2 }' | grep -w '^10.1.-9.1/24' ; if [ $? -ne 0 ] ; then ip netns exec \"t10\" ip addr add \"10.1.-9.1/24\" dev \"t10ns1if\" ; fi\n", "delta": "0:00:00.155856", "end": "2019-12-05 07:22:01.393089", "item": [{"bridge_name": "t10br1", "default_route_ip": "10.1.-9.1", "dns": [{"brif": "t10s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.5", "dnsif": "t10s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t10ns1", "route": [{"if": "p1", "ip": "10.1.-9.1/24", "ns_if": "t10if", "ns_name": "t10"}], "subnet_ip": "1.1.1.0/24", "vms": [{"brif": "t10br1if1", "disk": "10G", "mem": 2, "name": "t10_VM1", "vcpu": 4, "vmif": "t10VM1if1"}, {"brif": "t10br1if2", "disk": "10G", "mem": 4, "name": "t10_VM2", "vcpu": 2, "vmif": "t10VM2if1"}], "vxlan": [{"dev": "t10s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.-9.2", "remote_ip": "10.2.-9.2", "remote_route": "10.2.-9.0/24", "subnet_route": "10.1.-9.0/24", "tenant_route_ip": "192.168.0.2", "v_name": "vxlan_t10s1"}]}, {"tenant_ns_if": "t10ns1if", "tenant_ns_ip": "10.1.-9.1/24", "tenant_ns_name": "t10", "tenant_sub_if": "t10s1if", "tenant_sub_ip": "10.1.-9.2/24"}], "msg": "non-zero return code", "rc": 1, "start": "2019-12-05 07:22:01.237233", "stderr": "Error: any valid prefix is expected rather than \"10.1.-9.2/24\".\nError: any valid prefix is expected rather than \"10.1.-9.1/24\".", "stderr_lines": ["Error: any valid prefix is expected rather than \"10.1.-9.2/24\".", "Error: any valid prefix is expected rather than \"10.1.-9.1/24\"."], "stdout": "", "stdout_lines": []}

PLAY RECAP **************************************************************************************************************************************************
localhost                  : ok=8    changed=8    unreachable=0    failed=1    skipped=0    rescued=0    ignored=0   

INFO:root: 07:23:06.394885 Printing the yaml input file
INFO:root: 07:23:06.395025 {'C1': [{'subnet_addr': '1.1.1.0/24', 'VM': [{'name': 'VM1', 'disk': '10G', 'mem': 2, 'vcpu': 4, 'internet_access': True}, {'name': 'VM2', 'disk': '10G', 'mem': 4, 'vcpu': 2, 'internet_access': False}]}], 'C2': [{'subnet_addr': '1.1.1.0/24', 'VM': [{'name': 'VM4', 'disk': '10G', 'mem': 2, 'vcpu': 4, 'internet_access': True}]}, {'subnet_addr': '2.2.2.0/24', 'VM': [{'name': 'VM3', 'disk': '10G', 'mem': 3, 'vcpu': 2, 'internet_access': True}]}], 'MISC': [{'LOG_ENABLE': True}, {'GUI': True}]}
INFO:root: 07:23:06.395127 Provided subnet in C1: 1.1.1.0/24 is valid
INFO:root: 07:23:06.395248 Provided subnet in C2: 1.1.1.0/24 is valid
INFO:root: 07:23:06.395367 Provided subnet in C2: 2.2.2.0/24 is valid
Using /etc/ansible/ansible.cfg as config file

PLAY [main] *************************************************************************************************************************************************

TASK [Create Tenant Namespace] ******************************************************************************************************************************
changed: [localhost] => (item={u'default_route_ip': u'192.168.1.1', u'name': u't11', u'pns_ip': u'192.168.1.1/24', u'tenant_if': u't11if', u'tenant_ip': u'192.168.1.2/24', u'pns_if': u't11pns_if'}) => {"ansible_loop_var": "item", "changed": true, "cmd": ["ip", "netns", "add", "t11"], "delta": "0:00:00.053677", "end": "2019-12-05 07:23:07.537933", "item": {"default_route_ip": "192.168.1.1", "name": "t11", "pns_if": "t11pns_if", "pns_ip": "192.168.1.1/24", "tenant_if": "t11if", "tenant_ip": "192.168.1.2/24"}, "rc": 0, "start": "2019-12-05 07:23:07.484256", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Create Subnet Namespace] ******************************************************************************************************************************
changed: [localhost] => (item={u'route': [{u'ip': u'10.1.1.1/24', u'ns_name': u't11', u'ns_if': u't11if', u'if': u'p1'}], u'default_route_ip': u'10.1.1.1', u'bridge_name': u't11br1', u'dns': [{u'dnsif': u't11s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't11s1_dnsbrif'}], u'ns_name': u't11ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.1.2/24', u'tenant_ns_ip': u'10.1.1.1/24', u'tenant_ns_if': u't11ns1if', u'tenant_ns_name': u't11', u'tenant_sub_if': u't11s1if'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't11_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't11br1if1', u'vmif': u't11VM1if1'}, {u'mem': 4, u'name': u't11_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't11br1if2', u'vmif': u't11VM2if1'}], u'vxlan': [{u'local_ip': u'10.1.1.2', u'tenant_route_ip': u'192.168.1.2', u'dsport': 4789, u'dev': u't11s1if', u'subnet_route': u'10.1.1.0/24', u'remote_route': u'10.2.1.0/24', u'v_name': u'vxlan_t11s1', u'id': 42, u'remote_ip': u'10.2.1.2'}]}) => {"ansible_loop_var": "item", "changed": true, "cmd": ["ip", "netns", "add", "t11ns1"], "delta": "0:00:00.052776", "end": "2019-12-05 07:23:07.896089", "item": {"bridge_name": "t11br1", "default_route_ip": "10.1.1.1", "dns": [{"brif": "t11s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.5", "dnsif": "t11s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t11ns1", "route": [{"if": "p1", "ip": "10.1.1.1/24", "ns_if": "t11if", "ns_name": "t11"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t11ns1if", "tenant_ns_ip": "10.1.1.1/24", "tenant_ns_name": "t11", "tenant_sub_if": "t11s1if", "tenant_sub_ip": "10.1.1.2/24"}], "vms": [{"brif": "t11br1if1", "disk": "10G", "mem": 2, "name": "t11_VM1", "vcpu": 4, "vmif": "t11VM1if1"}, {"brif": "t11br1if2", "disk": "10G", "mem": 4, "name": "t11_VM2", "vcpu": 2, "vmif": "t11VM2if1"}], "vxlan": [{"dev": "t11s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.1.2", "remote_ip": "10.2.1.2", "remote_route": "10.2.1.0/24", "subnet_route": "10.1.1.0/24", "tenant_route_ip": "192.168.1.2", "v_name": "vxlan_t11s1"}]}, "rc": 0, "start": "2019-12-05 07:23:07.843313", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Create Tenant VETH pairs] *****************************************************************************************************************************
changed: [localhost] => (item={u'default_route_ip': u'192.168.1.1', u'name': u't11', u'pns_ip': u'192.168.1.1/24', u'tenant_if': u't11if', u'tenant_ip': u'192.168.1.2/24', u'pns_if': u't11pns_if'}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip link show \"t11if\" ; if [ $? -ne 0 ] ; then ip link add \"t11if\" type veth peer name \"t11pns_if\" ; fi\n", "delta": "0:00:00.010318", "end": "2019-12-05 07:23:08.221846", "item": {"default_route_ip": "192.168.1.1", "name": "t11", "pns_if": "t11pns_if", "pns_ip": "192.168.1.1/24", "tenant_if": "t11if", "tenant_ip": "192.168.1.2/24"}, "rc": 0, "start": "2019-12-05 07:23:08.211528", "stderr": "Device \"t11if\" does not exist.", "stderr_lines": ["Device \"t11if\" does not exist."], "stdout": "", "stdout_lines": []}

TASK [Attach Tenant VETH Pairs] *****************************************************************************************************************************
changed: [localhost] => (item={u'default_route_ip': u'192.168.1.1', u'name': u't11', u'pns_ip': u'192.168.1.1/24', u'tenant_if': u't11if', u'tenant_ip': u'192.168.1.2/24', u'pns_if': u't11pns_if'}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec pns ip link show \"t11pns_if\" ; if [ $? -ne 0 ] ; then ip link set \"t11pns_if\" netns pns ; fi\nip netns exec \"t11\" ip link show \"t11if\" ; if [ $? -ne 0 ] ; then ip link set \"t11if\" netns \"t11\" ; fi\nip netns exec pns ip link set dev \"t11pns_if\" up\nip netns exec \"t11\" ip link set dev \"t11if\" up\n", "delta": "0:00:00.260540", "end": "2019-12-05 07:23:08.781104", "item": {"default_route_ip": "192.168.1.1", "name": "t11", "pns_if": "t11pns_if", "pns_ip": "192.168.1.1/24", "tenant_if": "t11if", "tenant_ip": "192.168.1.2/24"}, "rc": 0, "start": "2019-12-05 07:23:08.520564", "stderr": "Device \"t11pns_if\" does not exist.\nDevice \"t11if\" does not exist.", "stderr_lines": ["Device \"t11pns_if\" does not exist.", "Device \"t11if\" does not exist."], "stdout": "", "stdout_lines": []}

TASK [Add IP addresses to Tenant VETH Pairs] ****************************************************************************************************************
changed: [localhost] => (item={u'default_route_ip': u'192.168.1.1', u'name': u't11', u'pns_ip': u'192.168.1.1/24', u'tenant_if': u't11if', u'tenant_ip': u'192.168.1.2/24', u'pns_if': u't11pns_if'}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec pns ip addr show \"t11pns_if\" | awk 'FNR==3{ print $2 }' | grep -w '^192.168.1.1/24' ; if [ $? -ne 0 ] ; then ip netns exec pns ip addr add \"192.168.1.1/24\" dev \"t11pns_if\" ; fi\nip netns exec \"t11\" ip addr show \"t11if\" | awk 'FNR==3{ print $2 }' | grep -w '^192.168.1.2/24' ; if [ $? -ne 0 ] ; then ip netns exec \"t11\" ip addr add \"192.168.1.2/24\" dev \"t11if\" ; fi\n", "delta": "0:00:00.166704", "end": "2019-12-05 07:23:09.253668", "item": {"default_route_ip": "192.168.1.1", "name": "t11", "pns_if": "t11pns_if", "pns_ip": "192.168.1.1/24", "tenant_if": "t11if", "tenant_ip": "192.168.1.2/24"}, "rc": 0, "start": "2019-12-05 07:23:09.086964", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Create Namespace VETH Pairs] **************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.1.1/24', u'ns_name': u't11', u'ns_if': u't11if', u'if': u'p1'}], u'default_route_ip': u'10.1.1.1', u'bridge_name': u't11br1', u'dns': [{u'dnsif': u't11s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't11s1_dnsbrif'}], u'ns_name': u't11ns1', u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't11_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't11br1if1', u'vmif': u't11VM1if1'}, {u'mem': 4, u'name': u't11_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't11br1if2', u'vmif': u't11VM2if1'}], u'vxlan': [{u'local_ip': u'10.1.1.2', u'dsport': 4789, u'dev': u't11s1if', u'tenant_route_ip': u'192.168.1.2', u'remote_route': u'10.2.1.0/24', u'subnet_route': u'10.1.1.0/24', u'v_name': u'vxlan_t11s1', u'id': 42, u'remote_ip': u'10.2.1.2'}]}, {u'tenant_sub_ip': u'10.1.1.2/24', u'tenant_ns_ip': u'10.1.1.1/24', u'tenant_ns_if': u't11ns1if', u'tenant_sub_if': u't11s1if', u'tenant_ns_name': u't11'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip link show \"t11ns1if\" ; if [ $? -ne 0 ] ; then ip link add \"t11ns1if\" type veth peer name \"t11s1if\" ; fi\n", "delta": "0:00:00.014250", "end": "2019-12-05 07:23:09.585760", "item": [{"bridge_name": "t11br1", "default_route_ip": "10.1.1.1", "dns": [{"brif": "t11s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.5", "dnsif": "t11s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t11ns1", "route": [{"if": "p1", "ip": "10.1.1.1/24", "ns_if": "t11if", "ns_name": "t11"}], "subnet_ip": "1.1.1.0/24", "vms": [{"brif": "t11br1if1", "disk": "10G", "mem": 2, "name": "t11_VM1", "vcpu": 4, "vmif": "t11VM1if1"}, {"brif": "t11br1if2", "disk": "10G", "mem": 4, "name": "t11_VM2", "vcpu": 2, "vmif": "t11VM2if1"}], "vxlan": [{"dev": "t11s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.1.2", "remote_ip": "10.2.1.2", "remote_route": "10.2.1.0/24", "subnet_route": "10.1.1.0/24", "tenant_route_ip": "192.168.1.2", "v_name": "vxlan_t11s1"}]}, {"tenant_ns_if": "t11ns1if", "tenant_ns_ip": "10.1.1.1/24", "tenant_ns_name": "t11", "tenant_sub_if": "t11s1if", "tenant_sub_ip": "10.1.1.2/24"}], "rc": 0, "start": "2019-12-05 07:23:09.571510", "stderr": "Device \"t11ns1if\" does not exist.", "stderr_lines": ["Device \"t11ns1if\" does not exist."], "stdout": "", "stdout_lines": []}

TASK [Attach Namespace VETH Pairs] **************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.1.1/24', u'ns_name': u't11', u'ns_if': u't11if', u'if': u'p1'}], u'default_route_ip': u'10.1.1.1', u'bridge_name': u't11br1', u'dns': [{u'dnsif': u't11s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't11s1_dnsbrif'}], u'ns_name': u't11ns1', u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't11_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't11br1if1', u'vmif': u't11VM1if1'}, {u'mem': 4, u'name': u't11_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't11br1if2', u'vmif': u't11VM2if1'}], u'vxlan': [{u'local_ip': u'10.1.1.2', u'dsport': 4789, u'dev': u't11s1if', u'tenant_route_ip': u'192.168.1.2', u'remote_route': u'10.2.1.0/24', u'subnet_route': u'10.1.1.0/24', u'v_name': u'vxlan_t11s1', u'id': 42, u'remote_ip': u'10.2.1.2'}]}, {u'tenant_sub_ip': u'10.1.1.2/24', u'tenant_ns_ip': u'10.1.1.1/24', u'tenant_ns_if': u't11ns1if', u'tenant_sub_if': u't11s1if', u'tenant_ns_name': u't11'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t11\" ip link show \"t11ns1if\" ; if [ $? -ne 0 ] ; then ip link set \"t11ns1if\" netns \"t11\" ; fi\nip netns exec \"t11ns1\" ip link show \"t11s1if\" ; if [ $? -ne 0 ] ; then ip link set \"t11s1if\" netns \"t11ns1\" ; fi\n", "delta": "0:00:00.120131", "end": "2019-12-05 07:23:10.003799", "item": [{"bridge_name": "t11br1", "default_route_ip": "10.1.1.1", "dns": [{"brif": "t11s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.5", "dnsif": "t11s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t11ns1", "route": [{"if": "p1", "ip": "10.1.1.1/24", "ns_if": "t11if", "ns_name": "t11"}], "subnet_ip": "1.1.1.0/24", "vms": [{"brif": "t11br1if1", "disk": "10G", "mem": 2, "name": "t11_VM1", "vcpu": 4, "vmif": "t11VM1if1"}, {"brif": "t11br1if2", "disk": "10G", "mem": 4, "name": "t11_VM2", "vcpu": 2, "vmif": "t11VM2if1"}], "vxlan": [{"dev": "t11s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.1.2", "remote_ip": "10.2.1.2", "remote_route": "10.2.1.0/24", "subnet_route": "10.1.1.0/24", "tenant_route_ip": "192.168.1.2", "v_name": "vxlan_t11s1"}]}, {"tenant_ns_if": "t11ns1if", "tenant_ns_ip": "10.1.1.1/24", "tenant_ns_name": "t11", "tenant_sub_if": "t11s1if", "tenant_sub_ip": "10.1.1.2/24"}], "rc": 0, "start": "2019-12-05 07:23:09.883668", "stderr": "Device \"t11ns1if\" does not exist.\nDevice \"t11s1if\" does not exist.", "stderr_lines": ["Device \"t11ns1if\" does not exist.", "Device \"t11s1if\" does not exist."], "stdout": "", "stdout_lines": []}

TASK [Set Namespace VETH Pairs UP] **************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.1.1/24', u'ns_name': u't11', u'ns_if': u't11if', u'if': u'p1'}], u'default_route_ip': u'10.1.1.1', u'bridge_name': u't11br1', u'dns': [{u'dnsif': u't11s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't11s1_dnsbrif'}], u'ns_name': u't11ns1', u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't11_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't11br1if1', u'vmif': u't11VM1if1'}, {u'mem': 4, u'name': u't11_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't11br1if2', u'vmif': u't11VM2if1'}], u'vxlan': [{u'local_ip': u'10.1.1.2', u'dsport': 4789, u'dev': u't11s1if', u'tenant_route_ip': u'192.168.1.2', u'remote_route': u'10.2.1.0/24', u'subnet_route': u'10.1.1.0/24', u'v_name': u'vxlan_t11s1', u'id': 42, u'remote_ip': u'10.2.1.2'}]}, {u'tenant_sub_ip': u'10.1.1.2/24', u'tenant_ns_ip': u'10.1.1.1/24', u'tenant_ns_if': u't11ns1if', u'tenant_sub_if': u't11s1if', u'tenant_ns_name': u't11'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t11\" ip link set dev \"t11ns1if\" up\nip netns exec \"t11ns1\" ip link set dev \"t11s1if\" up\n", "delta": "0:00:00.073196", "end": "2019-12-05 07:23:10.373279", "item": [{"bridge_name": "t11br1", "default_route_ip": "10.1.1.1", "dns": [{"brif": "t11s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.5", "dnsif": "t11s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t11ns1", "route": [{"if": "p1", "ip": "10.1.1.1/24", "ns_if": "t11if", "ns_name": "t11"}], "subnet_ip": "1.1.1.0/24", "vms": [{"brif": "t11br1if1", "disk": "10G", "mem": 2, "name": "t11_VM1", "vcpu": 4, "vmif": "t11VM1if1"}, {"brif": "t11br1if2", "disk": "10G", "mem": 4, "name": "t11_VM2", "vcpu": 2, "vmif": "t11VM2if1"}], "vxlan": [{"dev": "t11s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.1.2", "remote_ip": "10.2.1.2", "remote_route": "10.2.1.0/24", "subnet_route": "10.1.1.0/24", "tenant_route_ip": "192.168.1.2", "v_name": "vxlan_t11s1"}]}, {"tenant_ns_if": "t11ns1if", "tenant_ns_ip": "10.1.1.1/24", "tenant_ns_name": "t11", "tenant_sub_if": "t11s1if", "tenant_sub_ip": "10.1.1.2/24"}], "rc": 0, "start": "2019-12-05 07:23:10.300083", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Add IP addresses to Namespace VETH Pairs] *************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.1.1/24', u'ns_name': u't11', u'ns_if': u't11if', u'if': u'p1'}], u'default_route_ip': u'10.1.1.1', u'bridge_name': u't11br1', u'dns': [{u'dnsif': u't11s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't11s1_dnsbrif'}], u'ns_name': u't11ns1', u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't11_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't11br1if1', u'vmif': u't11VM1if1'}, {u'mem': 4, u'name': u't11_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't11br1if2', u'vmif': u't11VM2if1'}], u'vxlan': [{u'local_ip': u'10.1.1.2', u'dsport': 4789, u'dev': u't11s1if', u'tenant_route_ip': u'192.168.1.2', u'remote_route': u'10.2.1.0/24', u'subnet_route': u'10.1.1.0/24', u'v_name': u'vxlan_t11s1', u'id': 42, u'remote_ip': u'10.2.1.2'}]}, {u'tenant_sub_ip': u'10.1.1.2/24', u'tenant_ns_ip': u'10.1.1.1/24', u'tenant_ns_if': u't11ns1if', u'tenant_sub_if': u't11s1if', u'tenant_ns_name': u't11'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t11ns1\" ip addr show \"t11s1if\" | awk 'FNR==3{ print $2 }' | grep -w '^10.1.1.2/24' ; if [ $? -ne 0 ] ; then ip netns exec \"t11ns1\" ip addr add \"10.1.1.2/24\" dev \"t11s1if\" ; fi\n\nip netns exec \"t11\" ip addr show \"t11ns1if\" | awk 'FNR==3{ print $2 }' | grep -w '^10.1.1.1/24' ; if [ $? -ne 0 ] ; then ip netns exec \"t11\" ip addr add \"10.1.1.1/24\" dev \"t11ns1if\" ; fi\n", "delta": "0:00:00.153066", "end": "2019-12-05 07:23:10.833297", "item": [{"bridge_name": "t11br1", "default_route_ip": "10.1.1.1", "dns": [{"brif": "t11s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.5", "dnsif": "t11s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t11ns1", "route": [{"if": "p1", "ip": "10.1.1.1/24", "ns_if": "t11if", "ns_name": "t11"}], "subnet_ip": "1.1.1.0/24", "vms": [{"brif": "t11br1if1", "disk": "10G", "mem": 2, "name": "t11_VM1", "vcpu": 4, "vmif": "t11VM1if1"}, {"brif": "t11br1if2", "disk": "10G", "mem": 4, "name": "t11_VM2", "vcpu": 2, "vmif": "t11VM2if1"}], "vxlan": [{"dev": "t11s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.1.2", "remote_ip": "10.2.1.2", "remote_route": "10.2.1.0/24", "subnet_route": "10.1.1.0/24", "tenant_route_ip": "192.168.1.2", "v_name": "vxlan_t11s1"}]}, {"tenant_ns_if": "t11ns1if", "tenant_ns_ip": "10.1.1.1/24", "tenant_ns_name": "t11", "tenant_sub_if": "t11s1if", "tenant_sub_ip": "10.1.1.2/24"}], "rc": 0, "start": "2019-12-05 07:23:10.680231", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Add IP Route to Tenant] *******************************************************************************************************************************
changed: [localhost] => (item={u'default_route_ip': u'192.168.1.1', u'name': u't11', u'pns_ip': u'192.168.1.1/24', u'tenant_if': u't11if', u'tenant_ip': u'192.168.1.2/24', u'pns_if': u't11pns_if'}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t11\" ip route show default | grep -w '[d]efault via 192.168.1.1' ; if [ $? -ne 0 ] ; then ip netns exec \"t11\" ip route add default via \"192.168.1.1\" ; fi\n", "delta": "0:00:00.070469", "end": "2019-12-05 07:23:11.209249", "item": {"default_route_ip": "192.168.1.1", "name": "t11", "pns_if": "t11pns_if", "pns_ip": "192.168.1.1/24", "tenant_if": "t11if", "tenant_ip": "192.168.1.2/24"}, "rc": 0, "start": "2019-12-05 07:23:11.138780", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Add IP Route to Tenant Subnet] ************************************************************************************************************************
changed: [localhost] => (item={u'route': [{u'ip': u'10.1.1.1/24', u'ns_name': u't11', u'ns_if': u't11if', u'if': u'p1'}], u'default_route_ip': u'10.1.1.1', u'bridge_name': u't11br1', u'dns': [{u'dnsif': u't11s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't11s1_dnsbrif'}], u'ns_name': u't11ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.1.2/24', u'tenant_ns_ip': u'10.1.1.1/24', u'tenant_ns_if': u't11ns1if', u'tenant_ns_name': u't11', u'tenant_sub_if': u't11s1if'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't11_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't11br1if1', u'vmif': u't11VM1if1'}, {u'mem': 4, u'name': u't11_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't11br1if2', u'vmif': u't11VM2if1'}], u'vxlan': [{u'local_ip': u'10.1.1.2', u'tenant_route_ip': u'192.168.1.2', u'dsport': 4789, u'dev': u't11s1if', u'subnet_route': u'10.1.1.0/24', u'remote_route': u'10.2.1.0/24', u'v_name': u'vxlan_t11s1', u'id': 42, u'remote_ip': u'10.2.1.2'}]}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t11ns1\" ip route show default | grep -w '[d]efault via 10.1.1.1' ; if [ $? -ne 0 ] ; then ip netns exec \"t11ns1\" ip route add default via \"10.1.1.1\" ; fi\n", "delta": "0:00:00.075613", "end": "2019-12-05 07:23:11.597256", "item": {"bridge_name": "t11br1", "default_route_ip": "10.1.1.1", "dns": [{"brif": "t11s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.5", "dnsif": "t11s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t11ns1", "route": [{"if": "p1", "ip": "10.1.1.1/24", "ns_if": "t11if", "ns_name": "t11"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t11ns1if", "tenant_ns_ip": "10.1.1.1/24", "tenant_ns_name": "t11", "tenant_sub_if": "t11s1if", "tenant_sub_ip": "10.1.1.2/24"}], "vms": [{"brif": "t11br1if1", "disk": "10G", "mem": 2, "name": "t11_VM1", "vcpu": 4, "vmif": "t11VM1if1"}, {"brif": "t11br1if2", "disk": "10G", "mem": 4, "name": "t11_VM2", "vcpu": 2, "vmif": "t11VM2if1"}], "vxlan": [{"dev": "t11s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.1.2", "remote_ip": "10.2.1.2", "remote_route": "10.2.1.0/24", "subnet_route": "10.1.1.0/24", "tenant_route_ip": "192.168.1.2", "v_name": "vxlan_t11s1"}]}, "rc": 0, "start": "2019-12-05 07:23:11.521643", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Create bridge inside namespace] ***********************************************************************************************************************
changed: [localhost] => (item={u'route': [{u'ip': u'10.1.1.1/24', u'ns_name': u't11', u'ns_if': u't11if', u'if': u'p1'}], u'default_route_ip': u'10.1.1.1', u'bridge_name': u't11br1', u'dns': [{u'dnsif': u't11s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't11s1_dnsbrif'}], u'ns_name': u't11ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.1.2/24', u'tenant_ns_ip': u'10.1.1.1/24', u'tenant_ns_if': u't11ns1if', u'tenant_ns_name': u't11', u'tenant_sub_if': u't11s1if'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't11_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't11br1if1', u'vmif': u't11VM1if1'}, {u'mem': 4, u'name': u't11_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't11br1if2', u'vmif': u't11VM2if1'}], u'vxlan': [{u'local_ip': u'10.1.1.2', u'tenant_route_ip': u'192.168.1.2', u'dsport': 4789, u'dev': u't11s1if', u'subnet_route': u'10.1.1.0/24', u'remote_route': u'10.2.1.0/24', u'v_name': u'vxlan_t11s1', u'id': 42, u'remote_ip': u'10.2.1.2'}]}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t11ns1\" brctl show | grep -w '^t11br1'; if [ $? -ne 0 ] ; then ip netns exec \"t11ns1\" brctl addbr \"t11br1\" ; fi\nip netns exec \"t11ns1\" ip link set dev \"t11br1\" up\n", "delta": "0:00:00.090430", "end": "2019-12-05 07:23:12.029240", "item": {"bridge_name": "t11br1", "default_route_ip": "10.1.1.1", "dns": [{"brif": "t11s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.5", "dnsif": "t11s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t11ns1", "route": [{"if": "p1", "ip": "10.1.1.1/24", "ns_if": "t11if", "ns_name": "t11"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t11ns1if", "tenant_ns_ip": "10.1.1.1/24", "tenant_ns_name": "t11", "tenant_sub_if": "t11s1if", "tenant_sub_ip": "10.1.1.2/24"}], "vms": [{"brif": "t11br1if1", "disk": "10G", "mem": 2, "name": "t11_VM1", "vcpu": 4, "vmif": "t11VM1if1"}, {"brif": "t11br1if2", "disk": "10G", "mem": 4, "name": "t11_VM2", "vcpu": 2, "vmif": "t11VM2if1"}], "vxlan": [{"dev": "t11s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.1.2", "remote_ip": "10.2.1.2", "remote_route": "10.2.1.0/24", "subnet_route": "10.1.1.0/24", "tenant_route_ip": "192.168.1.2", "v_name": "vxlan_t11s1"}]}, "rc": 0, "start": "2019-12-05 07:23:11.938810", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Create DNS VETH Pair] *********************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.1.1/24', u'ns_name': u't11', u'ns_if': u't11if', u'if': u'p1'}], u'default_route_ip': u'10.1.1.1', u'bridge_name': u't11br1', u'ns_name': u't11ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.1.2/24', u'tenant_ns_ip': u'10.1.1.1/24', u'tenant_ns_if': u't11ns1if', u'tenant_sub_if': u't11s1if', u'tenant_ns_name': u't11'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't11_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't11br1if1', u'vmif': u't11VM1if1'}, {u'mem': 4, u'name': u't11_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't11br1if2', u'vmif': u't11VM2if1'}], u'vxlan': [{u'local_ip': u'10.1.1.2', u'dsport': 4789, u'dev': u't11s1if', u'tenant_route_ip': u'192.168.1.2', u'remote_route': u'10.2.1.0/24', u'subnet_route': u'10.1.1.0/24', u'v_name': u'vxlan_t11s1', u'id': 42, u'remote_ip': u'10.2.1.2'}]}, {u'dnsif': u't11s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't11s1_dnsbrif'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t11ns1\" ip link show \"t11s1_dnsbrif\" ; if [ $? -ne 0 ] ; then ip netns exec \"t11ns1\" ip link add \"t11s1_dnsbrif\" type veth peer name \"t11s1_dnsif\" ; fi\nip netns exec \"t11ns1\" ip link set dev \"t11s1_dnsbrif\" up\nip netns exec \"t11ns1\" ip link set dev \"t11s1_dnsif\" up\n", "delta": "0:00:00.146892", "end": "2019-12-05 07:23:12.529451", "item": [{"bridge_name": "t11br1", "default_route_ip": "10.1.1.1", "ns_name": "t11ns1", "route": [{"if": "p1", "ip": "10.1.1.1/24", "ns_if": "t11if", "ns_name": "t11"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t11ns1if", "tenant_ns_ip": "10.1.1.1/24", "tenant_ns_name": "t11", "tenant_sub_if": "t11s1if", "tenant_sub_ip": "10.1.1.2/24"}], "vms": [{"brif": "t11br1if1", "disk": "10G", "mem": 2, "name": "t11_VM1", "vcpu": 4, "vmif": "t11VM1if1"}, {"brif": "t11br1if2", "disk": "10G", "mem": 4, "name": "t11_VM2", "vcpu": 2, "vmif": "t11VM2if1"}], "vxlan": [{"dev": "t11s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.1.2", "remote_ip": "10.2.1.2", "remote_route": "10.2.1.0/24", "subnet_route": "10.1.1.0/24", "tenant_route_ip": "192.168.1.2", "v_name": "vxlan_t11s1"}]}, {"brif": "t11s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.5", "dnsif": "t11s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "rc": 0, "start": "2019-12-05 07:23:12.382559", "stderr": "Device \"t11s1_dnsbrif\" does not exist.", "stderr_lines": ["Device \"t11s1_dnsbrif\" does not exist."], "stdout": "", "stdout_lines": []}

TASK [Attach DNS VETH Pair] *********************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.1.1/24', u'ns_name': u't11', u'ns_if': u't11if', u'if': u'p1'}], u'default_route_ip': u'10.1.1.1', u'bridge_name': u't11br1', u'ns_name': u't11ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.1.2/24', u'tenant_ns_ip': u'10.1.1.1/24', u'tenant_ns_if': u't11ns1if', u'tenant_sub_if': u't11s1if', u'tenant_ns_name': u't11'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't11_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't11br1if1', u'vmif': u't11VM1if1'}, {u'mem': 4, u'name': u't11_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't11br1if2', u'vmif': u't11VM2if1'}], u'vxlan': [{u'local_ip': u'10.1.1.2', u'dsport': 4789, u'dev': u't11s1if', u'tenant_route_ip': u'192.168.1.2', u'remote_route': u'10.2.1.0/24', u'subnet_route': u'10.1.1.0/24', u'v_name': u'vxlan_t11s1', u'id': 42, u'remote_ip': u'10.2.1.2'}]}, {u'dnsif': u't11s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't11s1_dnsbrif'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t11ns1\" brctl show \"t11br1\" | grep -w 't11s1_dnsbrif' ; if [ $? -ne 0 ] ; then ip netns exec \"t11ns1\" brctl addif \"t11br1\" \"t11s1_dnsbrif\" ; fi\n", "delta": "0:00:00.087701", "end": "2019-12-05 07:23:12.945007", "item": [{"bridge_name": "t11br1", "default_route_ip": "10.1.1.1", "ns_name": "t11ns1", "route": [{"if": "p1", "ip": "10.1.1.1/24", "ns_if": "t11if", "ns_name": "t11"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t11ns1if", "tenant_ns_ip": "10.1.1.1/24", "tenant_ns_name": "t11", "tenant_sub_if": "t11s1if", "tenant_sub_ip": "10.1.1.2/24"}], "vms": [{"brif": "t11br1if1", "disk": "10G", "mem": 2, "name": "t11_VM1", "vcpu": 4, "vmif": "t11VM1if1"}, {"brif": "t11br1if2", "disk": "10G", "mem": 4, "name": "t11_VM2", "vcpu": 2, "vmif": "t11VM2if1"}], "vxlan": [{"dev": "t11s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.1.2", "remote_ip": "10.2.1.2", "remote_route": "10.2.1.0/24", "subnet_route": "10.1.1.0/24", "tenant_route_ip": "192.168.1.2", "v_name": "vxlan_t11s1"}]}, {"brif": "t11s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.5", "dnsif": "t11s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "rc": 0, "start": "2019-12-05 07:23:12.857306", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Create VETH Pairs] ************************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.1.1/24', u'ns_name': u't11', u'ns_if': u't11if', u'if': u'p1'}], u'default_route_ip': u'10.1.1.1', u'bridge_name': u't11br1', u'dns': [{u'dnsif': u't11s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't11s1_dnsbrif'}], u'ns_name': u't11ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.1.2/24', u'tenant_ns_ip': u'10.1.1.1/24', u'tenant_ns_if': u't11ns1if', u'tenant_sub_if': u't11s1if', u'tenant_ns_name': u't11'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.1.1.2', u'dsport': 4789, u'dev': u't11s1if', u'tenant_route_ip': u'192.168.1.2', u'remote_route': u'10.2.1.0/24', u'subnet_route': u'10.1.1.0/24', u'v_name': u'vxlan_t11s1', u'id': 42, u'remote_ip': u'10.2.1.2'}]}, {u'mem': 2, u'name': u't11_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't11br1if1', u'vmif': u't11VM1if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip link show \"t11br1if1\" ; if [ $? -ne 0 ] ; then ip link add \"t11VM1if1\" type veth peer name \"t11br1if1\" ; fi\nip link set dev \"t11br1if1\" up\nip link set dev \"t11VM1if1\" up\n", "delta": "0:00:00.015634", "end": "2019-12-05 07:23:13.224448", "item": [{"bridge_name": "t11br1", "default_route_ip": "10.1.1.1", "dns": [{"brif": "t11s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.5", "dnsif": "t11s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t11ns1", "route": [{"if": "p1", "ip": "10.1.1.1/24", "ns_if": "t11if", "ns_name": "t11"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t11ns1if", "tenant_ns_ip": "10.1.1.1/24", "tenant_ns_name": "t11", "tenant_sub_if": "t11s1if", "tenant_sub_ip": "10.1.1.2/24"}], "vxlan": [{"dev": "t11s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.1.2", "remote_ip": "10.2.1.2", "remote_route": "10.2.1.0/24", "subnet_route": "10.1.1.0/24", "tenant_route_ip": "192.168.1.2", "v_name": "vxlan_t11s1"}]}, {"brif": "t11br1if1", "disk": "10G", "mem": 2, "name": "t11_VM1", "vcpu": 4, "vmif": "t11VM1if1"}], "rc": 0, "start": "2019-12-05 07:23:13.208814", "stderr": "Device \"t11br1if1\" does not exist.", "stderr_lines": ["Device \"t11br1if1\" does not exist."], "stdout": "", "stdout_lines": []}
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.1.1/24', u'ns_name': u't11', u'ns_if': u't11if', u'if': u'p1'}], u'default_route_ip': u'10.1.1.1', u'bridge_name': u't11br1', u'dns': [{u'dnsif': u't11s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't11s1_dnsbrif'}], u'ns_name': u't11ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.1.2/24', u'tenant_ns_ip': u'10.1.1.1/24', u'tenant_ns_if': u't11ns1if', u'tenant_sub_if': u't11s1if', u'tenant_ns_name': u't11'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.1.1.2', u'dsport': 4789, u'dev': u't11s1if', u'tenant_route_ip': u'192.168.1.2', u'remote_route': u'10.2.1.0/24', u'subnet_route': u'10.1.1.0/24', u'v_name': u'vxlan_t11s1', u'id': 42, u'remote_ip': u'10.2.1.2'}]}, {u'mem': 4, u'name': u't11_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't11br1if2', u'vmif': u't11VM2if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip link show \"t11br1if2\" ; if [ $? -ne 0 ] ; then ip link add \"t11VM2if1\" type veth peer name \"t11br1if2\" ; fi\nip link set dev \"t11br1if2\" up\nip link set dev \"t11VM2if1\" up\n", "delta": "0:00:00.018712", "end": "2019-12-05 07:23:13.457491", "item": [{"bridge_name": "t11br1", "default_route_ip": "10.1.1.1", "dns": [{"brif": "t11s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.5", "dnsif": "t11s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t11ns1", "route": [{"if": "p1", "ip": "10.1.1.1/24", "ns_if": "t11if", "ns_name": "t11"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t11ns1if", "tenant_ns_ip": "10.1.1.1/24", "tenant_ns_name": "t11", "tenant_sub_if": "t11s1if", "tenant_sub_ip": "10.1.1.2/24"}], "vxlan": [{"dev": "t11s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.1.2", "remote_ip": "10.2.1.2", "remote_route": "10.2.1.0/24", "subnet_route": "10.1.1.0/24", "tenant_route_ip": "192.168.1.2", "v_name": "vxlan_t11s1"}]}, {"brif": "t11br1if2", "disk": "10G", "mem": 4, "name": "t11_VM2", "vcpu": 2, "vmif": "t11VM2if1"}], "rc": 0, "start": "2019-12-05 07:23:13.438779", "stderr": "Device \"t11br1if2\" does not exist.", "stderr_lines": ["Device \"t11br1if2\" does not exist."], "stdout": "", "stdout_lines": []}

TASK [Attach VETH Pairs] ************************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.1.1/24', u'ns_name': u't11', u'ns_if': u't11if', u'if': u'p1'}], u'default_route_ip': u'10.1.1.1', u'bridge_name': u't11br1', u'dns': [{u'dnsif': u't11s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't11s1_dnsbrif'}], u'ns_name': u't11ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.1.2/24', u'tenant_ns_ip': u'10.1.1.1/24', u'tenant_ns_if': u't11ns1if', u'tenant_sub_if': u't11s1if', u'tenant_ns_name': u't11'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.1.1.2', u'dsport': 4789, u'dev': u't11s1if', u'tenant_route_ip': u'192.168.1.2', u'remote_route': u'10.2.1.0/24', u'subnet_route': u'10.1.1.0/24', u'v_name': u'vxlan_t11s1', u'id': 42, u'remote_ip': u'10.2.1.2'}]}, {u'mem': 2, u'name': u't11_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't11br1if1', u'vmif': u't11VM1if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip link show \"t11br1if1\" ; if [ $? -eq 0 ] ; then ip link set \"t11br1if1\" netns \"t11ns1\" ; fi\nip netns exec \"t11ns1\" brctl show \"t11br1\" | grep -w 't11br1if1' ; if [ $? -ne 0 ] ; then ip netns exec \"t11ns1\" brctl addif \"t11br1\" \"t11br1if1\" ; fi\n", "delta": "0:00:00.110089", "end": "2019-12-05 07:23:13.865339", "item": [{"bridge_name": "t11br1", "default_route_ip": "10.1.1.1", "dns": [{"brif": "t11s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.5", "dnsif": "t11s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t11ns1", "route": [{"if": "p1", "ip": "10.1.1.1/24", "ns_if": "t11if", "ns_name": "t11"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t11ns1if", "tenant_ns_ip": "10.1.1.1/24", "tenant_ns_name": "t11", "tenant_sub_if": "t11s1if", "tenant_sub_ip": "10.1.1.2/24"}], "vxlan": [{"dev": "t11s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.1.2", "remote_ip": "10.2.1.2", "remote_route": "10.2.1.0/24", "subnet_route": "10.1.1.0/24", "tenant_route_ip": "192.168.1.2", "v_name": "vxlan_t11s1"}]}, {"brif": "t11br1if1", "disk": "10G", "mem": 2, "name": "t11_VM1", "vcpu": 4, "vmif": "t11VM1if1"}], "rc": 0, "start": "2019-12-05 07:23:13.755250", "stderr": "", "stderr_lines": [], "stdout": "79: t11br1if1@t11VM1if1: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP mode DEFAULT group default qlen 1000\n    link/ether 8a:16:a9:75:75:9f brd ff:ff:ff:ff:ff:ff", "stdout_lines": ["79: t11br1if1@t11VM1if1: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP mode DEFAULT group default qlen 1000", "    link/ether 8a:16:a9:75:75:9f brd ff:ff:ff:ff:ff:ff"]}
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.1.1/24', u'ns_name': u't11', u'ns_if': u't11if', u'if': u'p1'}], u'default_route_ip': u'10.1.1.1', u'bridge_name': u't11br1', u'dns': [{u'dnsif': u't11s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't11s1_dnsbrif'}], u'ns_name': u't11ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.1.2/24', u'tenant_ns_ip': u'10.1.1.1/24', u'tenant_ns_if': u't11ns1if', u'tenant_sub_if': u't11s1if', u'tenant_ns_name': u't11'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.1.1.2', u'dsport': 4789, u'dev': u't11s1if', u'tenant_route_ip': u'192.168.1.2', u'remote_route': u'10.2.1.0/24', u'subnet_route': u'10.1.1.0/24', u'v_name': u'vxlan_t11s1', u'id': 42, u'remote_ip': u'10.2.1.2'}]}, {u'mem': 4, u'name': u't11_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't11br1if2', u'vmif': u't11VM2if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip link show \"t11br1if2\" ; if [ $? -eq 0 ] ; then ip link set \"t11br1if2\" netns \"t11ns1\" ; fi\nip netns exec \"t11ns1\" brctl show \"t11br1\" | grep -w 't11br1if2' ; if [ $? -ne 0 ] ; then ip netns exec \"t11ns1\" brctl addif \"t11br1\" \"t11br1if2\" ; fi\n", "delta": "0:00:00.123555", "end": "2019-12-05 07:23:14.237259", "item": [{"bridge_name": "t11br1", "default_route_ip": "10.1.1.1", "dns": [{"brif": "t11s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.5", "dnsif": "t11s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t11ns1", "route": [{"if": "p1", "ip": "10.1.1.1/24", "ns_if": "t11if", "ns_name": "t11"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t11ns1if", "tenant_ns_ip": "10.1.1.1/24", "tenant_ns_name": "t11", "tenant_sub_if": "t11s1if", "tenant_sub_ip": "10.1.1.2/24"}], "vxlan": [{"dev": "t11s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.1.2", "remote_ip": "10.2.1.2", "remote_route": "10.2.1.0/24", "subnet_route": "10.1.1.0/24", "tenant_route_ip": "192.168.1.2", "v_name": "vxlan_t11s1"}]}, {"brif": "t11br1if2", "disk": "10G", "mem": 4, "name": "t11_VM2", "vcpu": 2, "vmif": "t11VM2if1"}], "rc": 0, "start": "2019-12-05 07:23:14.113704", "stderr": "", "stderr_lines": [], "stdout": "81: t11br1if2@t11VM2if1: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP mode DEFAULT group default qlen 1000\n    link/ether da:ca:ee:49:6a:1d brd ff:ff:ff:ff:ff:ff", "stdout_lines": ["81: t11br1if2@t11VM2if1: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP mode DEFAULT group default qlen 1000", "    link/ether da:ca:ee:49:6a:1d brd ff:ff:ff:ff:ff:ff"]}

TASK [All interfaces and bridges UP] ************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.1.1/24', u'ns_name': u't11', u'ns_if': u't11if', u'if': u'p1'}], u'default_route_ip': u'10.1.1.1', u'bridge_name': u't11br1', u'dns': [{u'dnsif': u't11s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't11s1_dnsbrif'}], u'ns_name': u't11ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.1.2/24', u'tenant_ns_ip': u'10.1.1.1/24', u'tenant_ns_if': u't11ns1if', u'tenant_sub_if': u't11s1if', u'tenant_ns_name': u't11'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.1.1.2', u'dsport': 4789, u'dev': u't11s1if', u'tenant_route_ip': u'192.168.1.2', u'remote_route': u'10.2.1.0/24', u'subnet_route': u'10.1.1.0/24', u'v_name': u'vxlan_t11s1', u'id': 42, u'remote_ip': u'10.2.1.2'}]}, {u'mem': 2, u'name': u't11_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't11br1if1', u'vmif': u't11VM1if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t11ns1\" ip link set \"t11br1if1\" up\nip netns exec \"t11ns1\" ip link set dev \"t11br1\" up\n", "delta": "0:00:00.070815", "end": "2019-12-05 07:23:14.613235", "item": [{"bridge_name": "t11br1", "default_route_ip": "10.1.1.1", "dns": [{"brif": "t11s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.5", "dnsif": "t11s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t11ns1", "route": [{"if": "p1", "ip": "10.1.1.1/24", "ns_if": "t11if", "ns_name": "t11"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t11ns1if", "tenant_ns_ip": "10.1.1.1/24", "tenant_ns_name": "t11", "tenant_sub_if": "t11s1if", "tenant_sub_ip": "10.1.1.2/24"}], "vxlan": [{"dev": "t11s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.1.2", "remote_ip": "10.2.1.2", "remote_route": "10.2.1.0/24", "subnet_route": "10.1.1.0/24", "tenant_route_ip": "192.168.1.2", "v_name": "vxlan_t11s1"}]}, {"brif": "t11br1if1", "disk": "10G", "mem": 2, "name": "t11_VM1", "vcpu": 4, "vmif": "t11VM1if1"}], "rc": 0, "start": "2019-12-05 07:23:14.542420", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.1.1/24', u'ns_name': u't11', u'ns_if': u't11if', u'if': u'p1'}], u'default_route_ip': u'10.1.1.1', u'bridge_name': u't11br1', u'dns': [{u'dnsif': u't11s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't11s1_dnsbrif'}], u'ns_name': u't11ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.1.2/24', u'tenant_ns_ip': u'10.1.1.1/24', u'tenant_ns_if': u't11ns1if', u'tenant_sub_if': u't11s1if', u'tenant_ns_name': u't11'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.1.1.2', u'dsport': 4789, u'dev': u't11s1if', u'tenant_route_ip': u'192.168.1.2', u'remote_route': u'10.2.1.0/24', u'subnet_route': u'10.1.1.0/24', u'v_name': u'vxlan_t11s1', u'id': 42, u'remote_ip': u'10.2.1.2'}]}, {u'mem': 4, u'name': u't11_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't11br1if2', u'vmif': u't11VM2if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t11ns1\" ip link set \"t11br1if2\" up\nip netns exec \"t11ns1\" ip link set dev \"t11br1\" up\n", "delta": "0:00:00.089933", "end": "2019-12-05 07:23:14.937254", "item": [{"bridge_name": "t11br1", "default_route_ip": "10.1.1.1", "dns": [{"brif": "t11s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.5", "dnsif": "t11s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t11ns1", "route": [{"if": "p1", "ip": "10.1.1.1/24", "ns_if": "t11if", "ns_name": "t11"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t11ns1if", "tenant_ns_ip": "10.1.1.1/24", "tenant_ns_name": "t11", "tenant_sub_if": "t11s1if", "tenant_sub_ip": "10.1.1.2/24"}], "vxlan": [{"dev": "t11s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.1.2", "remote_ip": "10.2.1.2", "remote_route": "10.2.1.0/24", "subnet_route": "10.1.1.0/24", "tenant_route_ip": "192.168.1.2", "v_name": "vxlan_t11s1"}]}, {"brif": "t11br1if2", "disk": "10G", "mem": 4, "name": "t11_VM2", "vcpu": 2, "vmif": "t11VM2if1"}], "rc": 0, "start": "2019-12-05 07:23:14.847321", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Add IP to DNS Interface] ******************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.1.1/24', u'ns_name': u't11', u'ns_if': u't11if', u'if': u'p1'}], u'default_route_ip': u'10.1.1.1', u'bridge_name': u't11br1', u'ns_name': u't11ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.1.2/24', u'tenant_ns_ip': u'10.1.1.1/24', u'tenant_ns_if': u't11ns1if', u'tenant_sub_if': u't11s1if', u'tenant_ns_name': u't11'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't11_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't11br1if1', u'vmif': u't11VM1if1'}, {u'mem': 4, u'name': u't11_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't11br1if2', u'vmif': u't11VM2if1'}], u'vxlan': [{u'local_ip': u'10.1.1.2', u'dsport': 4789, u'dev': u't11s1if', u'tenant_route_ip': u'192.168.1.2', u'remote_route': u'10.2.1.0/24', u'subnet_route': u'10.1.1.0/24', u'v_name': u'vxlan_t11s1', u'id': 42, u'remote_ip': u'10.2.1.2'}]}, {u'dnsif': u't11s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't11s1_dnsbrif'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t11ns1\" ip addr show \"t11s1_dnsif\" | awk 'FNR==3{ print $2 }' | grep -w '^1.1.1.1/24' ; if [ $? -ne 0 ] ; then ip netns exec \"t11ns1\" ip addr add \"1.1.1.1/24\" dev \"t11s1_dnsif\" ; fi\n", "delta": "0:00:00.104469", "end": "2019-12-05 07:23:15.373419", "item": [{"bridge_name": "t11br1", "default_route_ip": "10.1.1.1", "ns_name": "t11ns1", "route": [{"if": "p1", "ip": "10.1.1.1/24", "ns_if": "t11if", "ns_name": "t11"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t11ns1if", "tenant_ns_ip": "10.1.1.1/24", "tenant_ns_name": "t11", "tenant_sub_if": "t11s1if", "tenant_sub_ip": "10.1.1.2/24"}], "vms": [{"brif": "t11br1if1", "disk": "10G", "mem": 2, "name": "t11_VM1", "vcpu": 4, "vmif": "t11VM1if1"}, {"brif": "t11br1if2", "disk": "10G", "mem": 4, "name": "t11_VM2", "vcpu": 2, "vmif": "t11VM2if1"}], "vxlan": [{"dev": "t11s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.1.2", "remote_ip": "10.2.1.2", "remote_route": "10.2.1.0/24", "subnet_route": "10.1.1.0/24", "tenant_route_ip": "192.168.1.2", "v_name": "vxlan_t11s1"}]}, {"brif": "t11s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.5", "dnsif": "t11s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "rc": 0, "start": "2019-12-05 07:23:15.268950", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Install DHCP Server] **********************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.1.1/24', u'ns_name': u't11', u'ns_if': u't11if', u'if': u'p1'}], u'default_route_ip': u'10.1.1.1', u'bridge_name': u't11br1', u'ns_name': u't11ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.1.2/24', u'tenant_ns_ip': u'10.1.1.1/24', u'tenant_ns_if': u't11ns1if', u'tenant_sub_if': u't11s1if', u'tenant_ns_name': u't11'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't11_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't11br1if1', u'vmif': u't11VM1if1'}, {u'mem': 4, u'name': u't11_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't11br1if2', u'vmif': u't11VM2if1'}], u'vxlan': [{u'local_ip': u'10.1.1.2', u'dsport': 4789, u'dev': u't11s1if', u'tenant_route_ip': u'192.168.1.2', u'remote_route': u'10.2.1.0/24', u'subnet_route': u'10.1.1.0/24', u'v_name': u'vxlan_t11s1', u'id': 42, u'remote_ip': u'10.2.1.2'}]}, {u'dnsif': u't11s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't11s1_dnsbrif'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t11ns1\" ps aux | grep -w '[d]nsmasq --interface t11s1_dnsif -z --dhcp-range=1.1.1.5,1.1.1.254' ; if [ $? -ne 0 ] ; then ip netns exec \"t11ns1\" dnsmasq --interface \"t11s1_dnsif\" -z --dhcp-range=1.1.1.5,'1.1.1.254' ; fi\n", "delta": "0:00:00.080695", "end": "2019-12-05 07:23:15.751342", "item": [{"bridge_name": "t11br1", "default_route_ip": "10.1.1.1", "ns_name": "t11ns1", "route": [{"if": "p1", "ip": "10.1.1.1/24", "ns_if": "t11if", "ns_name": "t11"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t11ns1if", "tenant_ns_ip": "10.1.1.1/24", "tenant_ns_name": "t11", "tenant_sub_if": "t11s1if", "tenant_sub_ip": "10.1.1.2/24"}], "vms": [{"brif": "t11br1if1", "disk": "10G", "mem": 2, "name": "t11_VM1", "vcpu": 4, "vmif": "t11VM1if1"}, {"brif": "t11br1if2", "disk": "10G", "mem": 4, "name": "t11_VM2", "vcpu": 2, "vmif": "t11VM2if1"}], "vxlan": [{"dev": "t11s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.1.2", "remote_ip": "10.2.1.2", "remote_route": "10.2.1.0/24", "subnet_route": "10.1.1.0/24", "tenant_route_ip": "192.168.1.2", "v_name": "vxlan_t11s1"}]}, {"brif": "t11s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.5", "dnsif": "t11s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "rc": 0, "start": "2019-12-05 07:23:15.670647", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Create VXLAN devices] *********************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.1.1/24', u'ns_name': u't11', u'ns_if': u't11if', u'if': u'p1'}], u'default_route_ip': u'10.1.1.1', u'bridge_name': u't11br1', u'dns': [{u'dnsif': u't11s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't11s1_dnsbrif'}], u'ns_name': u't11ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.1.2/24', u'tenant_ns_ip': u'10.1.1.1/24', u'tenant_ns_if': u't11ns1if', u'tenant_sub_if': u't11s1if', u'tenant_ns_name': u't11'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't11_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't11br1if1', u'vmif': u't11VM1if1'}, {u'mem': 4, u'name': u't11_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't11br1if2', u'vmif': u't11VM2if1'}]}, {u'local_ip': u'10.1.1.2', u'dsport': 4789, u'dev': u't11s1if', u'tenant_route_ip': u'192.168.1.2', u'remote_route': u'10.2.1.0/24', u'subnet_route': u'10.1.1.0/24', u'v_name': u'vxlan_t11s1', u'id': 42, u'remote_ip': u'10.2.1.2'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t11ns1\" ip link show \"vxlan_t11s1\" ; if [ $? -ne 0 ] ; then ip netns exec \"t11ns1\" ip link add \"vxlan_t11s1\" type vxlan id \"42\" local \"10.1.1.2\" remote \"10.2.1.2\" dstport \"4789\" dev \"t11s1if\"; ip netns exec \"t11ns1\" ip link set dev \"vxlan_t11s1\" up ; fi\n", "delta": "0:00:00.120221", "end": "2019-12-05 07:23:16.181241", "item": [{"bridge_name": "t11br1", "default_route_ip": "10.1.1.1", "dns": [{"brif": "t11s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.5", "dnsif": "t11s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t11ns1", "route": [{"if": "p1", "ip": "10.1.1.1/24", "ns_if": "t11if", "ns_name": "t11"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t11ns1if", "tenant_ns_ip": "10.1.1.1/24", "tenant_ns_name": "t11", "tenant_sub_if": "t11s1if", "tenant_sub_ip": "10.1.1.2/24"}], "vms": [{"brif": "t11br1if1", "disk": "10G", "mem": 2, "name": "t11_VM1", "vcpu": 4, "vmif": "t11VM1if1"}, {"brif": "t11br1if2", "disk": "10G", "mem": 4, "name": "t11_VM2", "vcpu": 2, "vmif": "t11VM2if1"}]}, {"dev": "t11s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.1.2", "remote_ip": "10.2.1.2", "remote_route": "10.2.1.0/24", "subnet_route": "10.1.1.0/24", "tenant_route_ip": "192.168.1.2", "v_name": "vxlan_t11s1"}], "rc": 0, "start": "2019-12-05 07:23:16.061020", "stderr": "Device \"vxlan_t11s1\" does not exist.", "stderr_lines": ["Device \"vxlan_t11s1\" does not exist."], "stdout": "", "stdout_lines": []}

TASK [Attach VXLANs to bridge] ******************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.1.1/24', u'ns_name': u't11', u'ns_if': u't11if', u'if': u'p1'}], u'default_route_ip': u'10.1.1.1', u'bridge_name': u't11br1', u'dns': [{u'dnsif': u't11s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't11s1_dnsbrif'}], u'ns_name': u't11ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.1.2/24', u'tenant_ns_ip': u'10.1.1.1/24', u'tenant_ns_if': u't11ns1if', u'tenant_sub_if': u't11s1if', u'tenant_ns_name': u't11'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't11_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't11br1if1', u'vmif': u't11VM1if1'}, {u'mem': 4, u'name': u't11_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't11br1if2', u'vmif': u't11VM2if1'}]}, {u'local_ip': u'10.1.1.2', u'dsport': 4789, u'dev': u't11s1if', u'tenant_route_ip': u'192.168.1.2', u'remote_route': u'10.2.1.0/24', u'subnet_route': u'10.1.1.0/24', u'v_name': u'vxlan_t11s1', u'id': 42, u'remote_ip': u'10.2.1.2'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t11ns1\" brctl show \"t11br1\" | grep -w 'vxlan_t11s1' ; if [ $? -ne 0 ] ; then ip netns exec \"t11ns1\" brctl addif \"t11br1\" \"vxlan_t11s1\" ; fi\n", "delta": "0:00:00.067653", "end": "2019-12-05 07:23:16.569082", "item": [{"bridge_name": "t11br1", "default_route_ip": "10.1.1.1", "dns": [{"brif": "t11s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.5", "dnsif": "t11s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t11ns1", "route": [{"if": "p1", "ip": "10.1.1.1/24", "ns_if": "t11if", "ns_name": "t11"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t11ns1if", "tenant_ns_ip": "10.1.1.1/24", "tenant_ns_name": "t11", "tenant_sub_if": "t11s1if", "tenant_sub_ip": "10.1.1.2/24"}], "vms": [{"brif": "t11br1if1", "disk": "10G", "mem": 2, "name": "t11_VM1", "vcpu": 4, "vmif": "t11VM1if1"}, {"brif": "t11br1if2", "disk": "10G", "mem": 4, "name": "t11_VM2", "vcpu": 2, "vmif": "t11VM2if1"}]}, {"dev": "t11s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.1.2", "remote_ip": "10.2.1.2", "remote_route": "10.2.1.0/24", "subnet_route": "10.1.1.0/24", "tenant_route_ip": "192.168.1.2", "v_name": "vxlan_t11s1"}], "rc": 0, "start": "2019-12-05 07:23:16.501429", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

PLAY RECAP **************************************************************************************************************************************************
localhost                  : ok=21   changed=21   unreachable=0    failed=0    skipped=0    rescued=0    ignored=0   

Using /etc/ansible/ansible.cfg as config file

PLAY [worker] ***********************************************************************************************************************************************

TASK [Create Tenant Namespace] ******************************************************************************************************************************
changed: [99.99.99.2] => (item={u'default_route_ip': u'192.168.129.1', u'name': u't11', u'pns_ip': u'192.168.129.1/24', u'tenant_if': u't11if', u'tenant_ip': u'192.168.129.2/24', u'pns_if': u't11pns_if'}) => {"ansible_loop_var": "item", "changed": true, "cmd": ["ip", "netns", "add", "t11"], "delta": "0:00:00.058860", "end": "2019-12-05 07:23:18.655498", "item": {"default_route_ip": "192.168.129.1", "name": "t11", "pns_if": "t11pns_if", "pns_ip": "192.168.129.1/24", "tenant_if": "t11if", "tenant_ip": "192.168.129.2/24"}, "rc": 0, "start": "2019-12-05 07:23:18.596638", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Create Subnet Namespace] ******************************************************************************************************************************
changed: [99.99.99.2] => (item={u'route': [{u'ip': u'10.2.1.1/24', u'ns_name': u't11', u'ns_if': u't11if', u'if': u'p1'}], u'default_route_ip': u'10.2.1.1', u'bridge_name': u't11br1', u'dns': [{u'dnsif': [], u'dhcp_start': [], u'dhcp_end': [], u'dnsif_ip': [], u'net_mask': [], u'brif': []}], u'ns_name': u't11ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.1.2/24', u'tenant_ns_ip': u'10.2.1.1/24', u'tenant_ns_if': u't11ns1if', u'tenant_ns_name': u't11', u'tenant_sub_if': u't11s1if'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't11_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't11br1if1', u'vmif': u't11VM4if1'}], u'vxlan': [{u'local_ip': u'10.2.1.2', u'tenant_route_ip': u'192.168.129.2', u'dsport': 4789, u'dev': u't11s1if', u'subnet_route': u'10.2.1.0/24', u'remote_route': u'10.1.1.0/24', u'v_name': u'vxlan_t11s1', u'id': 42, u'remote_ip': u'10.1.1.2'}]}) => {"ansible_loop_var": "item", "changed": true, "cmd": ["ip", "netns", "add", "t11ns1"], "delta": "0:00:00.066075", "end": "2019-12-05 07:23:19.191227", "item": {"bridge_name": "t11br1", "default_route_ip": "10.2.1.1", "dns": [{"brif": [], "dhcp_end": [], "dhcp_start": [], "dnsif": [], "dnsif_ip": [], "net_mask": []}], "ns_name": "t11ns1", "route": [{"if": "p1", "ip": "10.2.1.1/24", "ns_if": "t11if", "ns_name": "t11"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t11ns1if", "tenant_ns_ip": "10.2.1.1/24", "tenant_ns_name": "t11", "tenant_sub_if": "t11s1if", "tenant_sub_ip": "10.2.1.2/24"}], "vms": [{"brif": "t11br1if1", "disk": "10G", "mem": 2, "name": "t11_VM4", "vcpu": 4, "vmif": "t11VM4if1"}], "vxlan": [{"dev": "t11s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.1.2", "remote_ip": "10.1.1.2", "remote_route": "10.1.1.0/24", "subnet_route": "10.2.1.0/24", "tenant_route_ip": "192.168.129.2", "v_name": "vxlan_t11s1"}]}, "rc": 0, "start": "2019-12-05 07:23:19.125152", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}
changed: [99.99.99.2] => (item={u'route': [{u'ip': u'10.2.2.1/24', u'ns_name': u't11', u'ns_if': u't11if', u'if': u'p1'}], u'default_route_ip': u'10.2.2.1', u'bridge_name': u't11br2', u'dns': [{u'dnsif': u't11s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't11s2_dnsbrif'}], u'ns_name': u't11ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.2.2/24', u'tenant_ns_ip': u'10.2.2.1/24', u'tenant_ns_if': u't11ns2if', u'tenant_ns_name': u't11', u'tenant_sub_if': u't11s2if'}], u'subnet_ip': u'2.2.2.0/24', u'vms': [{u'mem': 3, u'name': u't11_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't11br2if1', u'vmif': u't11VM3if1'}], u'vxlan': [{u'local_ip': [], u'tenant_route_ip': [], u'dsport': [], u'dev': [], u'subnet_route': [], u'remote_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}) => {"ansible_loop_var": "item", "changed": true, "cmd": ["ip", "netns", "add", "t11ns2"], "delta": "0:00:00.053548", "end": "2019-12-05 07:23:19.587636", "item": {"bridge_name": "t11br2", "default_route_ip": "10.2.2.1", "dns": [{"brif": "t11s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t11s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t11ns2", "route": [{"if": "p1", "ip": "10.2.2.1/24", "ns_if": "t11if", "ns_name": "t11"}], "subnet_ip": "2.2.2.0/24", "tenant_ns": [{"tenant_ns_if": "t11ns2if", "tenant_ns_ip": "10.2.2.1/24", "tenant_ns_name": "t11", "tenant_sub_if": "t11s2if", "tenant_sub_ip": "10.2.2.2/24"}], "vms": [{"brif": "t11br2if1", "disk": "10G", "mem": 3, "name": "t11_VM3", "vcpu": 2, "vmif": "t11VM3if1"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, "rc": 0, "start": "2019-12-05 07:23:19.534088", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Create Tenant VETH pairs] *****************************************************************************************************************************
changed: [99.99.99.2] => (item={u'default_route_ip': u'192.168.129.1', u'name': u't11', u'pns_ip': u'192.168.129.1/24', u'tenant_if': u't11if', u'tenant_ip': u'192.168.129.2/24', u'pns_if': u't11pns_if'}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip link show \"t11if\" ; if [ $? -ne 0 ] ; then ip link add \"t11if\" type veth peer name \"t11pns_if\" ; fi\n", "delta": "0:00:00.013307", "end": "2019-12-05 07:23:19.996839", "item": {"default_route_ip": "192.168.129.1", "name": "t11", "pns_if": "t11pns_if", "pns_ip": "192.168.129.1/24", "tenant_if": "t11if", "tenant_ip": "192.168.129.2/24"}, "rc": 0, "start": "2019-12-05 07:23:19.983532", "stderr": "Device \"t11if\" does not exist.", "stderr_lines": ["Device \"t11if\" does not exist."], "stdout": "", "stdout_lines": []}

TASK [Attach Tenant VETH Pairs] *****************************************************************************************************************************
changed: [99.99.99.2] => (item={u'default_route_ip': u'192.168.129.1', u'name': u't11', u'pns_ip': u'192.168.129.1/24', u'tenant_if': u't11if', u'tenant_ip': u'192.168.129.2/24', u'pns_if': u't11pns_if'}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec pns ip link show \"t11pns_if\" ; if [ $? -ne 0 ] ; then ip link set \"t11pns_if\" netns pns ; fi\nip netns exec \"t11\" ip link show \"t11if\" ; if [ $? -ne 0 ] ; then ip link set \"t11if\" netns \"t11\" ; fi\nip netns exec pns ip link set dev \"t11pns_if\" up\nip netns exec \"t11\" ip link set dev \"t11if\" up\n", "delta": "0:00:00.203780", "end": "2019-12-05 07:23:20.632431", "item": {"default_route_ip": "192.168.129.1", "name": "t11", "pns_if": "t11pns_if", "pns_ip": "192.168.129.1/24", "tenant_if": "t11if", "tenant_ip": "192.168.129.2/24"}, "rc": 0, "start": "2019-12-05 07:23:20.428651", "stderr": "Device \"t11pns_if\" does not exist.\nDevice \"t11if\" does not exist.", "stderr_lines": ["Device \"t11pns_if\" does not exist.", "Device \"t11if\" does not exist."], "stdout": "", "stdout_lines": []}

TASK [Add IP addresses to Tenant VETH Pairs] ****************************************************************************************************************
changed: [99.99.99.2] => (item={u'default_route_ip': u'192.168.129.1', u'name': u't11', u'pns_ip': u'192.168.129.1/24', u'tenant_if': u't11if', u'tenant_ip': u'192.168.129.2/24', u'pns_if': u't11pns_if'}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec pns ip addr show \"t11pns_if\" | awk 'FNR==3{ print $2 }' | grep -w '^192.168.129.1/24' ; if [ $? -ne 0 ] ; then ip netns exec pns ip addr add \"192.168.129.1/24\" dev \"t11pns_if\" ; fi\nip netns exec \"t11\" ip addr show \"t11if\" | awk 'FNR==3{ print $2 }' | grep -w '^192.168.129.2/24' ; if [ $? -ne 0 ] ; then ip netns exec \"t11\" ip addr add \"192.168.129.2/24\" dev \"t11if\" ; fi\n", "delta": "0:00:00.151596", "end": "2019-12-05 07:23:21.192421", "item": {"default_route_ip": "192.168.129.1", "name": "t11", "pns_if": "t11pns_if", "pns_ip": "192.168.129.1/24", "tenant_if": "t11if", "tenant_ip": "192.168.129.2/24"}, "rc": 0, "start": "2019-12-05 07:23:21.040825", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Create Namespace VETH Pairs] **************************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.1.1/24', u'ns_name': u't11', u'ns_if': u't11if', u'if': u'p1'}], u'default_route_ip': u'10.2.1.1', u'bridge_name': u't11br1', u'dns': [{u'dnsif': [], u'dhcp_start': [], u'dhcp_end': [], u'dnsif_ip': [], u'net_mask': [], u'brif': []}], u'ns_name': u't11ns1', u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't11_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't11br1if1', u'vmif': u't11VM4if1'}], u'vxlan': [{u'local_ip': u'10.2.1.2', u'dsport': 4789, u'dev': u't11s1if', u'tenant_route_ip': u'192.168.129.2', u'remote_route': u'10.1.1.0/24', u'subnet_route': u'10.2.1.0/24', u'v_name': u'vxlan_t11s1', u'id': 42, u'remote_ip': u'10.1.1.2'}]}, {u'tenant_sub_ip': u'10.2.1.2/24', u'tenant_ns_ip': u'10.2.1.1/24', u'tenant_ns_if': u't11ns1if', u'tenant_sub_if': u't11s1if', u'tenant_ns_name': u't11'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip link show \"t11ns1if\" ; if [ $? -ne 0 ] ; then ip link add \"t11ns1if\" type veth peer name \"t11s1if\" ; fi\n", "delta": "0:00:00.012557", "end": "2019-12-05 07:23:21.599413", "item": [{"bridge_name": "t11br1", "default_route_ip": "10.2.1.1", "dns": [{"brif": [], "dhcp_end": [], "dhcp_start": [], "dnsif": [], "dnsif_ip": [], "net_mask": []}], "ns_name": "t11ns1", "route": [{"if": "p1", "ip": "10.2.1.1/24", "ns_if": "t11if", "ns_name": "t11"}], "subnet_ip": "1.1.1.0/24", "vms": [{"brif": "t11br1if1", "disk": "10G", "mem": 2, "name": "t11_VM4", "vcpu": 4, "vmif": "t11VM4if1"}], "vxlan": [{"dev": "t11s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.1.2", "remote_ip": "10.1.1.2", "remote_route": "10.1.1.0/24", "subnet_route": "10.2.1.0/24", "tenant_route_ip": "192.168.129.2", "v_name": "vxlan_t11s1"}]}, {"tenant_ns_if": "t11ns1if", "tenant_ns_ip": "10.2.1.1/24", "tenant_ns_name": "t11", "tenant_sub_if": "t11s1if", "tenant_sub_ip": "10.2.1.2/24"}], "rc": 0, "start": "2019-12-05 07:23:21.586856", "stderr": "Device \"t11ns1if\" does not exist.", "stderr_lines": ["Device \"t11ns1if\" does not exist."], "stdout": "", "stdout_lines": []}
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.2.1/24', u'ns_name': u't11', u'ns_if': u't11if', u'if': u'p1'}], u'default_route_ip': u'10.2.2.1', u'bridge_name': u't11br2', u'dns': [{u'dnsif': u't11s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't11s2_dnsbrif'}], u'ns_name': u't11ns2', u'subnet_ip': u'2.2.2.0/24', u'vms': [{u'mem': 3, u'name': u't11_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't11br2if1', u'vmif': u't11VM3if1'}], u'vxlan': [{u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}, {u'tenant_sub_ip': u'10.2.2.2/24', u'tenant_ns_ip': u'10.2.2.1/24', u'tenant_ns_if': u't11ns2if', u'tenant_sub_if': u't11s2if', u'tenant_ns_name': u't11'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip link show \"t11ns2if\" ; if [ $? -ne 0 ] ; then ip link add \"t11ns2if\" type veth peer name \"t11s2if\" ; fi\n", "delta": "0:00:00.014632", "end": "2019-12-05 07:23:21.938950", "item": [{"bridge_name": "t11br2", "default_route_ip": "10.2.2.1", "dns": [{"brif": "t11s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t11s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t11ns2", "route": [{"if": "p1", "ip": "10.2.2.1/24", "ns_if": "t11if", "ns_name": "t11"}], "subnet_ip": "2.2.2.0/24", "vms": [{"brif": "t11br2if1", "disk": "10G", "mem": 3, "name": "t11_VM3", "vcpu": 2, "vmif": "t11VM3if1"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, {"tenant_ns_if": "t11ns2if", "tenant_ns_ip": "10.2.2.1/24", "tenant_ns_name": "t11", "tenant_sub_if": "t11s2if", "tenant_sub_ip": "10.2.2.2/24"}], "rc": 0, "start": "2019-12-05 07:23:21.924318", "stderr": "Device \"t11ns2if\" does not exist.", "stderr_lines": ["Device \"t11ns2if\" does not exist."], "stdout": "", "stdout_lines": []}

TASK [Attach Namespace VETH Pairs] **************************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.1.1/24', u'ns_name': u't11', u'ns_if': u't11if', u'if': u'p1'}], u'default_route_ip': u'10.2.1.1', u'bridge_name': u't11br1', u'dns': [{u'dnsif': [], u'dhcp_start': [], u'dhcp_end': [], u'dnsif_ip': [], u'net_mask': [], u'brif': []}], u'ns_name': u't11ns1', u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't11_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't11br1if1', u'vmif': u't11VM4if1'}], u'vxlan': [{u'local_ip': u'10.2.1.2', u'dsport': 4789, u'dev': u't11s1if', u'tenant_route_ip': u'192.168.129.2', u'remote_route': u'10.1.1.0/24', u'subnet_route': u'10.2.1.0/24', u'v_name': u'vxlan_t11s1', u'id': 42, u'remote_ip': u'10.1.1.2'}]}, {u'tenant_sub_ip': u'10.2.1.2/24', u'tenant_ns_ip': u'10.2.1.1/24', u'tenant_ns_if': u't11ns1if', u'tenant_sub_if': u't11s1if', u'tenant_ns_name': u't11'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t11\" ip link show \"t11ns1if\" ; if [ $? -ne 0 ] ; then ip link set \"t11ns1if\" netns \"t11\" ; fi\nip netns exec \"t11ns1\" ip link show \"t11s1if\" ; if [ $? -ne 0 ] ; then ip link set \"t11s1if\" netns \"t11ns1\" ; fi\n", "delta": "0:00:00.130541", "end": "2019-12-05 07:23:22.447021", "item": [{"bridge_name": "t11br1", "default_route_ip": "10.2.1.1", "dns": [{"brif": [], "dhcp_end": [], "dhcp_start": [], "dnsif": [], "dnsif_ip": [], "net_mask": []}], "ns_name": "t11ns1", "route": [{"if": "p1", "ip": "10.2.1.1/24", "ns_if": "t11if", "ns_name": "t11"}], "subnet_ip": "1.1.1.0/24", "vms": [{"brif": "t11br1if1", "disk": "10G", "mem": 2, "name": "t11_VM4", "vcpu": 4, "vmif": "t11VM4if1"}], "vxlan": [{"dev": "t11s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.1.2", "remote_ip": "10.1.1.2", "remote_route": "10.1.1.0/24", "subnet_route": "10.2.1.0/24", "tenant_route_ip": "192.168.129.2", "v_name": "vxlan_t11s1"}]}, {"tenant_ns_if": "t11ns1if", "tenant_ns_ip": "10.2.1.1/24", "tenant_ns_name": "t11", "tenant_sub_if": "t11s1if", "tenant_sub_ip": "10.2.1.2/24"}], "rc": 0, "start": "2019-12-05 07:23:22.316480", "stderr": "Device \"t11ns1if\" does not exist.\nDevice \"t11s1if\" does not exist.", "stderr_lines": ["Device \"t11ns1if\" does not exist.", "Device \"t11s1if\" does not exist."], "stdout": "", "stdout_lines": []}
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.2.1/24', u'ns_name': u't11', u'ns_if': u't11if', u'if': u'p1'}], u'default_route_ip': u'10.2.2.1', u'bridge_name': u't11br2', u'dns': [{u'dnsif': u't11s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't11s2_dnsbrif'}], u'ns_name': u't11ns2', u'subnet_ip': u'2.2.2.0/24', u'vms': [{u'mem': 3, u'name': u't11_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't11br2if1', u'vmif': u't11VM3if1'}], u'vxlan': [{u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}, {u'tenant_sub_ip': u'10.2.2.2/24', u'tenant_ns_ip': u'10.2.2.1/24', u'tenant_ns_if': u't11ns2if', u'tenant_sub_if': u't11s2if', u'tenant_ns_name': u't11'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t11\" ip link show \"t11ns2if\" ; if [ $? -ne 0 ] ; then ip link set \"t11ns2if\" netns \"t11\" ; fi\nip netns exec \"t11ns2\" ip link show \"t11s2if\" ; if [ $? -ne 0 ] ; then ip link set \"t11s2if\" netns \"t11ns2\" ; fi\n", "delta": "0:00:00.123795", "end": "2019-12-05 07:23:22.909387", "item": [{"bridge_name": "t11br2", "default_route_ip": "10.2.2.1", "dns": [{"brif": "t11s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t11s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t11ns2", "route": [{"if": "p1", "ip": "10.2.2.1/24", "ns_if": "t11if", "ns_name": "t11"}], "subnet_ip": "2.2.2.0/24", "vms": [{"brif": "t11br2if1", "disk": "10G", "mem": 3, "name": "t11_VM3", "vcpu": 2, "vmif": "t11VM3if1"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, {"tenant_ns_if": "t11ns2if", "tenant_ns_ip": "10.2.2.1/24", "tenant_ns_name": "t11", "tenant_sub_if": "t11s2if", "tenant_sub_ip": "10.2.2.2/24"}], "rc": 0, "start": "2019-12-05 07:23:22.785592", "stderr": "Device \"t11ns2if\" does not exist.\nDevice \"t11s2if\" does not exist.", "stderr_lines": ["Device \"t11ns2if\" does not exist.", "Device \"t11s2if\" does not exist."], "stdout": "", "stdout_lines": []}

TASK [Set Namespace VETH Pairs UP] **************************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.1.1/24', u'ns_name': u't11', u'ns_if': u't11if', u'if': u'p1'}], u'default_route_ip': u'10.2.1.1', u'bridge_name': u't11br1', u'dns': [{u'dnsif': [], u'dhcp_start': [], u'dhcp_end': [], u'dnsif_ip': [], u'net_mask': [], u'brif': []}], u'ns_name': u't11ns1', u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't11_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't11br1if1', u'vmif': u't11VM4if1'}], u'vxlan': [{u'local_ip': u'10.2.1.2', u'dsport': 4789, u'dev': u't11s1if', u'tenant_route_ip': u'192.168.129.2', u'remote_route': u'10.1.1.0/24', u'subnet_route': u'10.2.1.0/24', u'v_name': u'vxlan_t11s1', u'id': 42, u'remote_ip': u'10.1.1.2'}]}, {u'tenant_sub_ip': u'10.2.1.2/24', u'tenant_ns_ip': u'10.2.1.1/24', u'tenant_ns_if': u't11ns1if', u'tenant_sub_if': u't11s1if', u'tenant_ns_name': u't11'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t11\" ip link set dev \"t11ns1if\" up\nip netns exec \"t11ns1\" ip link set dev \"t11s1if\" up\n", "delta": "0:00:00.075347", "end": "2019-12-05 07:23:23.408572", "item": [{"bridge_name": "t11br1", "default_route_ip": "10.2.1.1", "dns": [{"brif": [], "dhcp_end": [], "dhcp_start": [], "dnsif": [], "dnsif_ip": [], "net_mask": []}], "ns_name": "t11ns1", "route": [{"if": "p1", "ip": "10.2.1.1/24", "ns_if": "t11if", "ns_name": "t11"}], "subnet_ip": "1.1.1.0/24", "vms": [{"brif": "t11br1if1", "disk": "10G", "mem": 2, "name": "t11_VM4", "vcpu": 4, "vmif": "t11VM4if1"}], "vxlan": [{"dev": "t11s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.1.2", "remote_ip": "10.1.1.2", "remote_route": "10.1.1.0/24", "subnet_route": "10.2.1.0/24", "tenant_route_ip": "192.168.129.2", "v_name": "vxlan_t11s1"}]}, {"tenant_ns_if": "t11ns1if", "tenant_ns_ip": "10.2.1.1/24", "tenant_ns_name": "t11", "tenant_sub_if": "t11s1if", "tenant_sub_ip": "10.2.1.2/24"}], "rc": 0, "start": "2019-12-05 07:23:23.333225", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.2.1/24', u'ns_name': u't11', u'ns_if': u't11if', u'if': u'p1'}], u'default_route_ip': u'10.2.2.1', u'bridge_name': u't11br2', u'dns': [{u'dnsif': u't11s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't11s2_dnsbrif'}], u'ns_name': u't11ns2', u'subnet_ip': u'2.2.2.0/24', u'vms': [{u'mem': 3, u'name': u't11_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't11br2if1', u'vmif': u't11VM3if1'}], u'vxlan': [{u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}, {u'tenant_sub_ip': u'10.2.2.2/24', u'tenant_ns_ip': u'10.2.2.1/24', u'tenant_ns_if': u't11ns2if', u'tenant_sub_if': u't11s2if', u'tenant_ns_name': u't11'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t11\" ip link set dev \"t11ns2if\" up\nip netns exec \"t11ns2\" ip link set dev \"t11s2if\" up\n", "delta": "0:00:00.088863", "end": "2019-12-05 07:23:23.820539", "item": [{"bridge_name": "t11br2", "default_route_ip": "10.2.2.1", "dns": [{"brif": "t11s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t11s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t11ns2", "route": [{"if": "p1", "ip": "10.2.2.1/24", "ns_if": "t11if", "ns_name": "t11"}], "subnet_ip": "2.2.2.0/24", "vms": [{"brif": "t11br2if1", "disk": "10G", "mem": 3, "name": "t11_VM3", "vcpu": 2, "vmif": "t11VM3if1"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, {"tenant_ns_if": "t11ns2if", "tenant_ns_ip": "10.2.2.1/24", "tenant_ns_name": "t11", "tenant_sub_if": "t11s2if", "tenant_sub_ip": "10.2.2.2/24"}], "rc": 0, "start": "2019-12-05 07:23:23.731676", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Add IP addresses to Namespace VETH Pairs] *************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.1.1/24', u'ns_name': u't11', u'ns_if': u't11if', u'if': u'p1'}], u'default_route_ip': u'10.2.1.1', u'bridge_name': u't11br1', u'dns': [{u'dnsif': [], u'dhcp_start': [], u'dhcp_end': [], u'dnsif_ip': [], u'net_mask': [], u'brif': []}], u'ns_name': u't11ns1', u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't11_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't11br1if1', u'vmif': u't11VM4if1'}], u'vxlan': [{u'local_ip': u'10.2.1.2', u'dsport': 4789, u'dev': u't11s1if', u'tenant_route_ip': u'192.168.129.2', u'remote_route': u'10.1.1.0/24', u'subnet_route': u'10.2.1.0/24', u'v_name': u'vxlan_t11s1', u'id': 42, u'remote_ip': u'10.1.1.2'}]}, {u'tenant_sub_ip': u'10.2.1.2/24', u'tenant_ns_ip': u'10.2.1.1/24', u'tenant_ns_if': u't11ns1if', u'tenant_sub_if': u't11s1if', u'tenant_ns_name': u't11'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t11ns1\" ip addr show \"t11s1if\" | awk 'FNR==3{ print $2 }' | grep -w '^10.2.1.2/24' ; if [ $? -ne 0 ] ; then ip netns exec \"t11ns1\" ip addr add \"10.2.1.2/24\" dev \"t11s1if\" ; fi\n\nip netns exec \"t11\" ip addr show \"t11ns1if\" | awk 'FNR==3{ print $2 }' | grep -w '^10.2.1.1/24' ; if [ $? -ne 0 ] ; then ip netns exec \"t11\" ip addr add \"10.2.1.1/24\" dev \"t11ns1if\" ; fi\n", "delta": "0:00:00.141936", "end": "2019-12-05 07:23:24.380514", "item": [{"bridge_name": "t11br1", "default_route_ip": "10.2.1.1", "dns": [{"brif": [], "dhcp_end": [], "dhcp_start": [], "dnsif": [], "dnsif_ip": [], "net_mask": []}], "ns_name": "t11ns1", "route": [{"if": "p1", "ip": "10.2.1.1/24", "ns_if": "t11if", "ns_name": "t11"}], "subnet_ip": "1.1.1.0/24", "vms": [{"brif": "t11br1if1", "disk": "10G", "mem": 2, "name": "t11_VM4", "vcpu": 4, "vmif": "t11VM4if1"}], "vxlan": [{"dev": "t11s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.1.2", "remote_ip": "10.1.1.2", "remote_route": "10.1.1.0/24", "subnet_route": "10.2.1.0/24", "tenant_route_ip": "192.168.129.2", "v_name": "vxlan_t11s1"}]}, {"tenant_ns_if": "t11ns1if", "tenant_ns_ip": "10.2.1.1/24", "tenant_ns_name": "t11", "tenant_sub_if": "t11s1if", "tenant_sub_ip": "10.2.1.2/24"}], "rc": 0, "start": "2019-12-05 07:23:24.238578", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.2.1/24', u'ns_name': u't11', u'ns_if': u't11if', u'if': u'p1'}], u'default_route_ip': u'10.2.2.1', u'bridge_name': u't11br2', u'dns': [{u'dnsif': u't11s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't11s2_dnsbrif'}], u'ns_name': u't11ns2', u'subnet_ip': u'2.2.2.0/24', u'vms': [{u'mem': 3, u'name': u't11_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't11br2if1', u'vmif': u't11VM3if1'}], u'vxlan': [{u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}, {u'tenant_sub_ip': u'10.2.2.2/24', u'tenant_ns_ip': u'10.2.2.1/24', u'tenant_ns_if': u't11ns2if', u'tenant_sub_if': u't11s2if', u'tenant_ns_name': u't11'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t11ns2\" ip addr show \"t11s2if\" | awk 'FNR==3{ print $2 }' | grep -w '^10.2.2.2/24' ; if [ $? -ne 0 ] ; then ip netns exec \"t11ns2\" ip addr add \"10.2.2.2/24\" dev \"t11s2if\" ; fi\n\nip netns exec \"t11\" ip addr show \"t11ns2if\" | awk 'FNR==3{ print $2 }' | grep -w '^10.2.2.1/24' ; if [ $? -ne 0 ] ; then ip netns exec \"t11\" ip addr add \"10.2.2.1/24\" dev \"t11ns2if\" ; fi\n", "delta": "0:00:00.168623", "end": "2019-12-05 07:23:24.916384", "item": [{"bridge_name": "t11br2", "default_route_ip": "10.2.2.1", "dns": [{"brif": "t11s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t11s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t11ns2", "route": [{"if": "p1", "ip": "10.2.2.1/24", "ns_if": "t11if", "ns_name": "t11"}], "subnet_ip": "2.2.2.0/24", "vms": [{"brif": "t11br2if1", "disk": "10G", "mem": 3, "name": "t11_VM3", "vcpu": 2, "vmif": "t11VM3if1"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, {"tenant_ns_if": "t11ns2if", "tenant_ns_ip": "10.2.2.1/24", "tenant_ns_name": "t11", "tenant_sub_if": "t11s2if", "tenant_sub_ip": "10.2.2.2/24"}], "rc": 0, "start": "2019-12-05 07:23:24.747761", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Add IP Route to Tenant] *******************************************************************************************************************************
changed: [99.99.99.2] => (item={u'default_route_ip': u'192.168.129.1', u'name': u't11', u'pns_ip': u'192.168.129.1/24', u'tenant_if': u't11if', u'tenant_ip': u'192.168.129.2/24', u'pns_if': u't11pns_if'}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t11\" ip route show default | grep -w '[d]efault via 192.168.129.1' ; if [ $? -ne 0 ] ; then ip netns exec \"t11\" ip route add default via \"192.168.129.1\" ; fi\n", "delta": "0:00:00.088880", "end": "2019-12-05 07:23:25.412749", "item": {"default_route_ip": "192.168.129.1", "name": "t11", "pns_if": "t11pns_if", "pns_ip": "192.168.129.1/24", "tenant_if": "t11if", "tenant_ip": "192.168.129.2/24"}, "rc": 0, "start": "2019-12-05 07:23:25.323869", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Add IP Route to Tenant Subnet] ************************************************************************************************************************
changed: [99.99.99.2] => (item={u'route': [{u'ip': u'10.2.1.1/24', u'ns_name': u't11', u'ns_if': u't11if', u'if': u'p1'}], u'default_route_ip': u'10.2.1.1', u'bridge_name': u't11br1', u'dns': [{u'dnsif': [], u'dhcp_start': [], u'dhcp_end': [], u'dnsif_ip': [], u'net_mask': [], u'brif': []}], u'ns_name': u't11ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.1.2/24', u'tenant_ns_ip': u'10.2.1.1/24', u'tenant_ns_if': u't11ns1if', u'tenant_ns_name': u't11', u'tenant_sub_if': u't11s1if'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't11_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't11br1if1', u'vmif': u't11VM4if1'}], u'vxlan': [{u'local_ip': u'10.2.1.2', u'tenant_route_ip': u'192.168.129.2', u'dsport': 4789, u'dev': u't11s1if', u'subnet_route': u'10.2.1.0/24', u'remote_route': u'10.1.1.0/24', u'v_name': u'vxlan_t11s1', u'id': 42, u'remote_ip': u'10.1.1.2'}]}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t11ns1\" ip route show default | grep -w '[d]efault via 10.2.1.1' ; if [ $? -ne 0 ] ; then ip netns exec \"t11ns1\" ip route add default via \"10.2.1.1\" ; fi\n", "delta": "0:00:00.074050", "end": "2019-12-05 07:23:25.908641", "item": {"bridge_name": "t11br1", "default_route_ip": "10.2.1.1", "dns": [{"brif": [], "dhcp_end": [], "dhcp_start": [], "dnsif": [], "dnsif_ip": [], "net_mask": []}], "ns_name": "t11ns1", "route": [{"if": "p1", "ip": "10.2.1.1/24", "ns_if": "t11if", "ns_name": "t11"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t11ns1if", "tenant_ns_ip": "10.2.1.1/24", "tenant_ns_name": "t11", "tenant_sub_if": "t11s1if", "tenant_sub_ip": "10.2.1.2/24"}], "vms": [{"brif": "t11br1if1", "disk": "10G", "mem": 2, "name": "t11_VM4", "vcpu": 4, "vmif": "t11VM4if1"}], "vxlan": [{"dev": "t11s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.1.2", "remote_ip": "10.1.1.2", "remote_route": "10.1.1.0/24", "subnet_route": "10.2.1.0/24", "tenant_route_ip": "192.168.129.2", "v_name": "vxlan_t11s1"}]}, "rc": 0, "start": "2019-12-05 07:23:25.834591", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}
changed: [99.99.99.2] => (item={u'route': [{u'ip': u'10.2.2.1/24', u'ns_name': u't11', u'ns_if': u't11if', u'if': u'p1'}], u'default_route_ip': u'10.2.2.1', u'bridge_name': u't11br2', u'dns': [{u'dnsif': u't11s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't11s2_dnsbrif'}], u'ns_name': u't11ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.2.2/24', u'tenant_ns_ip': u'10.2.2.1/24', u'tenant_ns_if': u't11ns2if', u'tenant_ns_name': u't11', u'tenant_sub_if': u't11s2if'}], u'subnet_ip': u'2.2.2.0/24', u'vms': [{u'mem': 3, u'name': u't11_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't11br2if1', u'vmif': u't11VM3if1'}], u'vxlan': [{u'local_ip': [], u'tenant_route_ip': [], u'dsport': [], u'dev': [], u'subnet_route': [], u'remote_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t11ns2\" ip route show default | grep -w '[d]efault via 10.2.2.1' ; if [ $? -ne 0 ] ; then ip netns exec \"t11ns2\" ip route add default via \"10.2.2.1\" ; fi\n", "delta": "0:00:00.074351", "end": "2019-12-05 07:23:26.324576", "item": {"bridge_name": "t11br2", "default_route_ip": "10.2.2.1", "dns": [{"brif": "t11s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t11s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t11ns2", "route": [{"if": "p1", "ip": "10.2.2.1/24", "ns_if": "t11if", "ns_name": "t11"}], "subnet_ip": "2.2.2.0/24", "tenant_ns": [{"tenant_ns_if": "t11ns2if", "tenant_ns_ip": "10.2.2.1/24", "tenant_ns_name": "t11", "tenant_sub_if": "t11s2if", "tenant_sub_ip": "10.2.2.2/24"}], "vms": [{"brif": "t11br2if1", "disk": "10G", "mem": 3, "name": "t11_VM3", "vcpu": 2, "vmif": "t11VM3if1"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, "rc": 0, "start": "2019-12-05 07:23:26.250225", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Create bridge inside namespace] ***********************************************************************************************************************
changed: [99.99.99.2] => (item={u'route': [{u'ip': u'10.2.1.1/24', u'ns_name': u't11', u'ns_if': u't11if', u'if': u'p1'}], u'default_route_ip': u'10.2.1.1', u'bridge_name': u't11br1', u'dns': [{u'dnsif': [], u'dhcp_start': [], u'dhcp_end': [], u'dnsif_ip': [], u'net_mask': [], u'brif': []}], u'ns_name': u't11ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.1.2/24', u'tenant_ns_ip': u'10.2.1.1/24', u'tenant_ns_if': u't11ns1if', u'tenant_ns_name': u't11', u'tenant_sub_if': u't11s1if'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't11_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't11br1if1', u'vmif': u't11VM4if1'}], u'vxlan': [{u'local_ip': u'10.2.1.2', u'tenant_route_ip': u'192.168.129.2', u'dsport': 4789, u'dev': u't11s1if', u'subnet_route': u'10.2.1.0/24', u'remote_route': u'10.1.1.0/24', u'v_name': u'vxlan_t11s1', u'id': 42, u'remote_ip': u'10.1.1.2'}]}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t11ns1\" brctl show | grep -w '^t11br1'; if [ $? -ne 0 ] ; then ip netns exec \"t11ns1\" brctl addbr \"t11br1\" ; fi\nip netns exec \"t11ns1\" ip link set dev \"t11br1\" up\n", "delta": "0:00:00.126498", "end": "2019-12-05 07:23:26.884597", "item": {"bridge_name": "t11br1", "default_route_ip": "10.2.1.1", "dns": [{"brif": [], "dhcp_end": [], "dhcp_start": [], "dnsif": [], "dnsif_ip": [], "net_mask": []}], "ns_name": "t11ns1", "route": [{"if": "p1", "ip": "10.2.1.1/24", "ns_if": "t11if", "ns_name": "t11"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t11ns1if", "tenant_ns_ip": "10.2.1.1/24", "tenant_ns_name": "t11", "tenant_sub_if": "t11s1if", "tenant_sub_ip": "10.2.1.2/24"}], "vms": [{"brif": "t11br1if1", "disk": "10G", "mem": 2, "name": "t11_VM4", "vcpu": 4, "vmif": "t11VM4if1"}], "vxlan": [{"dev": "t11s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.1.2", "remote_ip": "10.1.1.2", "remote_route": "10.1.1.0/24", "subnet_route": "10.2.1.0/24", "tenant_route_ip": "192.168.129.2", "v_name": "vxlan_t11s1"}]}, "rc": 0, "start": "2019-12-05 07:23:26.758099", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}
changed: [99.99.99.2] => (item={u'route': [{u'ip': u'10.2.2.1/24', u'ns_name': u't11', u'ns_if': u't11if', u'if': u'p1'}], u'default_route_ip': u'10.2.2.1', u'bridge_name': u't11br2', u'dns': [{u'dnsif': u't11s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't11s2_dnsbrif'}], u'ns_name': u't11ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.2.2/24', u'tenant_ns_ip': u'10.2.2.1/24', u'tenant_ns_if': u't11ns2if', u'tenant_ns_name': u't11', u'tenant_sub_if': u't11s2if'}], u'subnet_ip': u'2.2.2.0/24', u'vms': [{u'mem': 3, u'name': u't11_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't11br2if1', u'vmif': u't11VM3if1'}], u'vxlan': [{u'local_ip': [], u'tenant_route_ip': [], u'dsport': [], u'dev': [], u'subnet_route': [], u'remote_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t11ns2\" brctl show | grep -w '^t11br2'; if [ $? -ne 0 ] ; then ip netns exec \"t11ns2\" brctl addbr \"t11br2\" ; fi\nip netns exec \"t11ns2\" ip link set dev \"t11br2\" up\n", "delta": "0:00:00.108601", "end": "2019-12-05 07:23:27.368561", "item": {"bridge_name": "t11br2", "default_route_ip": "10.2.2.1", "dns": [{"brif": "t11s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t11s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t11ns2", "route": [{"if": "p1", "ip": "10.2.2.1/24", "ns_if": "t11if", "ns_name": "t11"}], "subnet_ip": "2.2.2.0/24", "tenant_ns": [{"tenant_ns_if": "t11ns2if", "tenant_ns_ip": "10.2.2.1/24", "tenant_ns_name": "t11", "tenant_sub_if": "t11s2if", "tenant_sub_ip": "10.2.2.2/24"}], "vms": [{"brif": "t11br2if1", "disk": "10G", "mem": 3, "name": "t11_VM3", "vcpu": 2, "vmif": "t11VM3if1"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, "rc": 0, "start": "2019-12-05 07:23:27.259960", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Create DNS VETH Pair] *********************************************************************************************************************************
failed: [99.99.99.2] (item=[{u'route': [{u'ip': u'10.2.1.1/24', u'ns_name': u't11', u'ns_if': u't11if', u'if': u'p1'}], u'default_route_ip': u'10.2.1.1', u'bridge_name': u't11br1', u'ns_name': u't11ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.1.2/24', u'tenant_ns_ip': u'10.2.1.1/24', u'tenant_ns_if': u't11ns1if', u'tenant_sub_if': u't11s1if', u'tenant_ns_name': u't11'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't11_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't11br1if1', u'vmif': u't11VM4if1'}], u'vxlan': [{u'local_ip': u'10.2.1.2', u'dsport': 4789, u'dev': u't11s1if', u'tenant_route_ip': u'192.168.129.2', u'remote_route': u'10.1.1.0/24', u'subnet_route': u'10.2.1.0/24', u'v_name': u'vxlan_t11s1', u'id': 42, u'remote_ip': u'10.1.1.2'}]}, {u'dnsif': [], u'dhcp_start': [], u'dhcp_end': [], u'dnsif_ip': [], u'net_mask': [], u'brif': []}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t11ns1\" ip link show \"[]\" ; if [ $? -ne 0 ] ; then ip netns exec \"t11ns1\" ip link add \"[]\" type veth peer name \"[]\" ; fi\nip netns exec \"t11ns1\" ip link set dev \"[]\" up\nip netns exec \"t11ns1\" ip link set dev \"[]\" up\n", "delta": "0:00:00.191637", "end": "2019-12-05 07:23:28.000368", "item": [{"bridge_name": "t11br1", "default_route_ip": "10.2.1.1", "ns_name": "t11ns1", "route": [{"if": "p1", "ip": "10.2.1.1/24", "ns_if": "t11if", "ns_name": "t11"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t11ns1if", "tenant_ns_ip": "10.2.1.1/24", "tenant_ns_name": "t11", "tenant_sub_if": "t11s1if", "tenant_sub_ip": "10.2.1.2/24"}], "vms": [{"brif": "t11br1if1", "disk": "10G", "mem": 2, "name": "t11_VM4", "vcpu": 4, "vmif": "t11VM4if1"}], "vxlan": [{"dev": "t11s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.1.2", "remote_ip": "10.1.1.2", "remote_route": "10.1.1.0/24", "subnet_route": "10.2.1.0/24", "tenant_route_ip": "192.168.129.2", "v_name": "vxlan_t11s1"}]}, {"brif": [], "dhcp_end": [], "dhcp_start": [], "dnsif": [], "dnsif_ip": [], "net_mask": []}], "msg": "non-zero return code", "rc": 1, "start": "2019-12-05 07:23:27.808731", "stderr": "Device \"[]\" does not exist.\nRTNETLINK answers: File exists\nCannot find device \"[]\"\nCannot find device \"[]\"", "stderr_lines": ["Device \"[]\" does not exist.", "RTNETLINK answers: File exists", "Cannot find device \"[]\"", "Cannot find device \"[]\""], "stdout": "", "stdout_lines": []}
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.2.1/24', u'ns_name': u't11', u'ns_if': u't11if', u'if': u'p1'}], u'default_route_ip': u'10.2.2.1', u'bridge_name': u't11br2', u'ns_name': u't11ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.2.2/24', u'tenant_ns_ip': u'10.2.2.1/24', u'tenant_ns_if': u't11ns2if', u'tenant_sub_if': u't11s2if', u'tenant_ns_name': u't11'}], u'subnet_ip': u'2.2.2.0/24', u'vms': [{u'mem': 3, u'name': u't11_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't11br2if1', u'vmif': u't11VM3if1'}], u'vxlan': [{u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}, {u'dnsif': u't11s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't11s2_dnsbrif'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t11ns2\" ip link show \"t11s2_dnsbrif\" ; if [ $? -ne 0 ] ; then ip netns exec \"t11ns2\" ip link add \"t11s2_dnsbrif\" type veth peer name \"t11s2_dnsif\" ; fi\nip netns exec \"t11ns2\" ip link set dev \"t11s2_dnsbrif\" up\nip netns exec \"t11ns2\" ip link set dev \"t11s2_dnsif\" up\n", "delta": "0:00:00.179939", "end": "2019-12-05 07:23:28.500534", "item": [{"bridge_name": "t11br2", "default_route_ip": "10.2.2.1", "ns_name": "t11ns2", "route": [{"if": "p1", "ip": "10.2.2.1/24", "ns_if": "t11if", "ns_name": "t11"}], "subnet_ip": "2.2.2.0/24", "tenant_ns": [{"tenant_ns_if": "t11ns2if", "tenant_ns_ip": "10.2.2.1/24", "tenant_ns_name": "t11", "tenant_sub_if": "t11s2if", "tenant_sub_ip": "10.2.2.2/24"}], "vms": [{"brif": "t11br2if1", "disk": "10G", "mem": 3, "name": "t11_VM3", "vcpu": 2, "vmif": "t11VM3if1"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, {"brif": "t11s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t11s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "rc": 0, "start": "2019-12-05 07:23:28.320595", "stderr": "Device \"t11s2_dnsbrif\" does not exist.", "stderr_lines": ["Device \"t11s2_dnsbrif\" does not exist."], "stdout": "", "stdout_lines": []}

PLAY RECAP **************************************************************************************************************************************************
99.99.99.2                 : ok=12   changed=12   unreachable=0    failed=1    skipped=0    rescued=0    ignored=0   

INFO:root: 07:25:49.920791 Printing the yaml input file
INFO:root: 07:25:49.920892 {'C1': [{'subnet_addr': '1.1.1.0/24', 'VM': [{'name': 'VM1', 'disk': '10G', 'mem': 2, 'vcpu': 4, 'internet_access': True}, {'name': 'VM2', 'disk': '10G', 'mem': 4, 'vcpu': 2, 'internet_access': False}]}], 'C2': [{'subnet_addr': '1.1.1.0/24', 'VM': [{'name': 'VM4', 'disk': '10G', 'mem': 2, 'vcpu': 4, 'internet_access': True}]}, {'subnet_addr': '2.2.2.0/24', 'VM': [{'name': 'VM3', 'disk': '10G', 'mem': 3, 'vcpu': 2, 'internet_access': True}]}], 'MISC': [{'LOG_ENABLE': True}, {'GUI': True}]}
INFO:root: 07:25:49.920981 Provided subnet in C1: 1.1.1.0/24 is valid
INFO:root: 07:25:49.921027 Provided subnet in C2: 1.1.1.0/24 is valid
INFO:root: 07:25:49.921066 Provided subnet in C2: 2.2.2.0/24 is valid
Using /etc/ansible/ansible.cfg as config file

PLAY [main] *************************************************************************************************************************************************

TASK [Create Tenant Namespace] ******************************************************************************************************************************
changed: [localhost] => (item={u'default_route_ip': u'192.168.3.1', u'name': u't3', u'pns_ip': u'192.168.3.1/24', u'tenant_if': u't3if', u'tenant_ip': u'192.168.3.2/24', u'pns_if': u't3pns_if'}) => {"ansible_loop_var": "item", "changed": true, "cmd": ["ip", "netns", "add", "t3"], "delta": "0:00:00.051292", "end": "2019-12-05 07:25:51.194438", "item": {"default_route_ip": "192.168.3.1", "name": "t3", "pns_if": "t3pns_if", "pns_ip": "192.168.3.1/24", "tenant_if": "t3if", "tenant_ip": "192.168.3.2/24"}, "rc": 0, "start": "2019-12-05 07:25:51.143146", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Create Subnet Namespace] ******************************************************************************************************************************
changed: [localhost] => (item={u'route': [{u'ip': u'10.1.21.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.1.21.1', u'bridge_name': u't3br1', u'dns': [{u'dnsif': u't3s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't3s1_dnsbrif'}], u'ns_name': u't3ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.21.2/24', u'tenant_ns_ip': u'10.1.21.1/24', u'tenant_ns_if': u't3ns1if', u'tenant_ns_name': u't3', u'tenant_sub_if': u't3s1if'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't3_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't3br1if1', u'vmif': u't3VM1if1'}, {u'mem': 4, u'name': u't3_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't3br1if2', u'vmif': u't3VM2if1'}], u'vxlan': [{u'local_ip': u'10.1.21.2', u'tenant_route_ip': u'192.168.3.2', u'dsport': 4789, u'dev': u't3s1if', u'subnet_route': u'10.1.21.0/24', u'remote_route': u'10.2.21.0/24', u'v_name': u'vxlan_t3s1', u'id': 42, u'remote_ip': u'10.2.21.2'}]}) => {"ansible_loop_var": "item", "changed": true, "cmd": ["ip", "netns", "add", "t3ns1"], "delta": "0:00:00.055302", "end": "2019-12-05 07:25:51.558182", "item": {"bridge_name": "t3br1", "default_route_ip": "10.1.21.1", "dns": [{"brif": "t3s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.5", "dnsif": "t3s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t3ns1", "route": [{"if": "p1", "ip": "10.1.21.1/24", "ns_if": "t3if", "ns_name": "t3"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t3ns1if", "tenant_ns_ip": "10.1.21.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s1if", "tenant_sub_ip": "10.1.21.2/24"}], "vms": [{"brif": "t3br1if1", "disk": "10G", "mem": 2, "name": "t3_VM1", "vcpu": 4, "vmif": "t3VM1if1"}, {"brif": "t3br1if2", "disk": "10G", "mem": 4, "name": "t3_VM2", "vcpu": 2, "vmif": "t3VM2if1"}], "vxlan": [{"dev": "t3s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.21.2", "remote_ip": "10.2.21.2", "remote_route": "10.2.21.0/24", "subnet_route": "10.1.21.0/24", "tenant_route_ip": "192.168.3.2", "v_name": "vxlan_t3s1"}]}, "rc": 0, "start": "2019-12-05 07:25:51.502880", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Create Tenant VETH pairs] *****************************************************************************************************************************
changed: [localhost] => (item={u'default_route_ip': u'192.168.3.1', u'name': u't3', u'pns_ip': u'192.168.3.1/24', u'tenant_if': u't3if', u'tenant_ip': u'192.168.3.2/24', u'pns_if': u't3pns_if'}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip link show \"t3if\" ; if [ $? -ne 0 ] ; then ip link add \"t3if\" type veth peer name \"t3pns_if\" ; fi\n", "delta": "0:00:00.018546", "end": "2019-12-05 07:25:51.906566", "item": {"default_route_ip": "192.168.3.1", "name": "t3", "pns_if": "t3pns_if", "pns_ip": "192.168.3.1/24", "tenant_if": "t3if", "tenant_ip": "192.168.3.2/24"}, "rc": 0, "start": "2019-12-05 07:25:51.888020", "stderr": "Device \"t3if\" does not exist.", "stderr_lines": ["Device \"t3if\" does not exist."], "stdout": "", "stdout_lines": []}

TASK [Attach Tenant VETH Pairs] *****************************************************************************************************************************
changed: [localhost] => (item={u'default_route_ip': u'192.168.3.1', u'name': u't3', u'pns_ip': u'192.168.3.1/24', u'tenant_if': u't3if', u'tenant_ip': u'192.168.3.2/24', u'pns_if': u't3pns_if'}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec pns ip link show \"t3pns_if\" ; if [ $? -ne 0 ] ; then ip link set \"t3pns_if\" netns pns ; fi\nip netns exec \"t3\" ip link show \"t3if\" ; if [ $? -ne 0 ] ; then ip link set \"t3if\" netns \"t3\" ; fi\nip netns exec pns ip link set dev \"t3pns_if\" up\nip netns exec \"t3\" ip link set dev \"t3if\" up\n", "delta": "0:00:00.219517", "end": "2019-12-05 07:25:52.417414", "item": {"default_route_ip": "192.168.3.1", "name": "t3", "pns_if": "t3pns_if", "pns_ip": "192.168.3.1/24", "tenant_if": "t3if", "tenant_ip": "192.168.3.2/24"}, "rc": 0, "start": "2019-12-05 07:25:52.197897", "stderr": "Device \"t3pns_if\" does not exist.\nDevice \"t3if\" does not exist.", "stderr_lines": ["Device \"t3pns_if\" does not exist.", "Device \"t3if\" does not exist."], "stdout": "", "stdout_lines": []}

TASK [Add IP addresses to Tenant VETH Pairs] ****************************************************************************************************************
changed: [localhost] => (item={u'default_route_ip': u'192.168.3.1', u'name': u't3', u'pns_ip': u'192.168.3.1/24', u'tenant_if': u't3if', u'tenant_ip': u'192.168.3.2/24', u'pns_if': u't3pns_if'}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec pns ip addr show \"t3pns_if\" | awk 'FNR==3{ print $2 }' | grep -w '^192.168.3.1/24' ; if [ $? -ne 0 ] ; then ip netns exec pns ip addr add \"192.168.3.1/24\" dev \"t3pns_if\" ; fi\nip netns exec \"t3\" ip addr show \"t3if\" | awk 'FNR==3{ print $2 }' | grep -w '^192.168.3.2/24' ; if [ $? -ne 0 ] ; then ip netns exec \"t3\" ip addr add \"192.168.3.2/24\" dev \"t3if\" ; fi\n", "delta": "0:00:00.134055", "end": "2019-12-05 07:25:52.845430", "item": {"default_route_ip": "192.168.3.1", "name": "t3", "pns_if": "t3pns_if", "pns_ip": "192.168.3.1/24", "tenant_if": "t3if", "tenant_ip": "192.168.3.2/24"}, "rc": 0, "start": "2019-12-05 07:25:52.711375", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Create Namespace VETH Pairs] **************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.21.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.1.21.1', u'bridge_name': u't3br1', u'dns': [{u'dnsif': u't3s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't3s1_dnsbrif'}], u'ns_name': u't3ns1', u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't3_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't3br1if1', u'vmif': u't3VM1if1'}, {u'mem': 4, u'name': u't3_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't3br1if2', u'vmif': u't3VM2if1'}], u'vxlan': [{u'local_ip': u'10.1.21.2', u'dsport': 4789, u'dev': u't3s1if', u'tenant_route_ip': u'192.168.3.2', u'remote_route': u'10.2.21.0/24', u'subnet_route': u'10.1.21.0/24', u'v_name': u'vxlan_t3s1', u'id': 42, u'remote_ip': u'10.2.21.2'}]}, {u'tenant_sub_ip': u'10.1.21.2/24', u'tenant_ns_ip': u'10.1.21.1/24', u'tenant_ns_if': u't3ns1if', u'tenant_sub_if': u't3s1if', u'tenant_ns_name': u't3'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip link show \"t3ns1if\" ; if [ $? -ne 0 ] ; then ip link add \"t3ns1if\" type veth peer name \"t3s1if\" ; fi\n", "delta": "0:00:00.012083", "end": "2019-12-05 07:25:53.122648", "item": [{"bridge_name": "t3br1", "default_route_ip": "10.1.21.1", "dns": [{"brif": "t3s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.5", "dnsif": "t3s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t3ns1", "route": [{"if": "p1", "ip": "10.1.21.1/24", "ns_if": "t3if", "ns_name": "t3"}], "subnet_ip": "1.1.1.0/24", "vms": [{"brif": "t3br1if1", "disk": "10G", "mem": 2, "name": "t3_VM1", "vcpu": 4, "vmif": "t3VM1if1"}, {"brif": "t3br1if2", "disk": "10G", "mem": 4, "name": "t3_VM2", "vcpu": 2, "vmif": "t3VM2if1"}], "vxlan": [{"dev": "t3s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.21.2", "remote_ip": "10.2.21.2", "remote_route": "10.2.21.0/24", "subnet_route": "10.1.21.0/24", "tenant_route_ip": "192.168.3.2", "v_name": "vxlan_t3s1"}]}, {"tenant_ns_if": "t3ns1if", "tenant_ns_ip": "10.1.21.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s1if", "tenant_sub_ip": "10.1.21.2/24"}], "rc": 0, "start": "2019-12-05 07:25:53.110565", "stderr": "Device \"t3ns1if\" does not exist.", "stderr_lines": ["Device \"t3ns1if\" does not exist."], "stdout": "", "stdout_lines": []}

TASK [Attach Namespace VETH Pairs] **************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.21.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.1.21.1', u'bridge_name': u't3br1', u'dns': [{u'dnsif': u't3s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't3s1_dnsbrif'}], u'ns_name': u't3ns1', u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't3_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't3br1if1', u'vmif': u't3VM1if1'}, {u'mem': 4, u'name': u't3_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't3br1if2', u'vmif': u't3VM2if1'}], u'vxlan': [{u'local_ip': u'10.1.21.2', u'dsport': 4789, u'dev': u't3s1if', u'tenant_route_ip': u'192.168.3.2', u'remote_route': u'10.2.21.0/24', u'subnet_route': u'10.1.21.0/24', u'v_name': u'vxlan_t3s1', u'id': 42, u'remote_ip': u'10.2.21.2'}]}, {u'tenant_sub_ip': u'10.1.21.2/24', u'tenant_ns_ip': u'10.1.21.1/24', u'tenant_ns_if': u't3ns1if', u'tenant_sub_if': u't3s1if', u'tenant_ns_name': u't3'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t3\" ip link show \"t3ns1if\" ; if [ $? -ne 0 ] ; then ip link set \"t3ns1if\" netns \"t3\" ; fi\nip netns exec \"t3ns1\" ip link show \"t3s1if\" ; if [ $? -ne 0 ] ; then ip link set \"t3s1if\" netns \"t3ns1\" ; fi\n", "delta": "0:00:00.125049", "end": "2019-12-05 07:25:53.557649", "item": [{"bridge_name": "t3br1", "default_route_ip": "10.1.21.1", "dns": [{"brif": "t3s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.5", "dnsif": "t3s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t3ns1", "route": [{"if": "p1", "ip": "10.1.21.1/24", "ns_if": "t3if", "ns_name": "t3"}], "subnet_ip": "1.1.1.0/24", "vms": [{"brif": "t3br1if1", "disk": "10G", "mem": 2, "name": "t3_VM1", "vcpu": 4, "vmif": "t3VM1if1"}, {"brif": "t3br1if2", "disk": "10G", "mem": 4, "name": "t3_VM2", "vcpu": 2, "vmif": "t3VM2if1"}], "vxlan": [{"dev": "t3s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.21.2", "remote_ip": "10.2.21.2", "remote_route": "10.2.21.0/24", "subnet_route": "10.1.21.0/24", "tenant_route_ip": "192.168.3.2", "v_name": "vxlan_t3s1"}]}, {"tenant_ns_if": "t3ns1if", "tenant_ns_ip": "10.1.21.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s1if", "tenant_sub_ip": "10.1.21.2/24"}], "rc": 0, "start": "2019-12-05 07:25:53.432600", "stderr": "Device \"t3ns1if\" does not exist.\nDevice \"t3s1if\" does not exist.", "stderr_lines": ["Device \"t3ns1if\" does not exist.", "Device \"t3s1if\" does not exist."], "stdout": "", "stdout_lines": []}

TASK [Set Namespace VETH Pairs UP] **************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.21.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.1.21.1', u'bridge_name': u't3br1', u'dns': [{u'dnsif': u't3s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't3s1_dnsbrif'}], u'ns_name': u't3ns1', u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't3_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't3br1if1', u'vmif': u't3VM1if1'}, {u'mem': 4, u'name': u't3_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't3br1if2', u'vmif': u't3VM2if1'}], u'vxlan': [{u'local_ip': u'10.1.21.2', u'dsport': 4789, u'dev': u't3s1if', u'tenant_route_ip': u'192.168.3.2', u'remote_route': u'10.2.21.0/24', u'subnet_route': u'10.1.21.0/24', u'v_name': u'vxlan_t3s1', u'id': 42, u'remote_ip': u'10.2.21.2'}]}, {u'tenant_sub_ip': u'10.1.21.2/24', u'tenant_ns_ip': u'10.1.21.1/24', u'tenant_ns_if': u't3ns1if', u'tenant_sub_if': u't3s1if', u'tenant_ns_name': u't3'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t3\" ip link set dev \"t3ns1if\" up\nip netns exec \"t3ns1\" ip link set dev \"t3s1if\" up\n", "delta": "0:00:00.070373", "end": "2019-12-05 07:25:53.953304", "item": [{"bridge_name": "t3br1", "default_route_ip": "10.1.21.1", "dns": [{"brif": "t3s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.5", "dnsif": "t3s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t3ns1", "route": [{"if": "p1", "ip": "10.1.21.1/24", "ns_if": "t3if", "ns_name": "t3"}], "subnet_ip": "1.1.1.0/24", "vms": [{"brif": "t3br1if1", "disk": "10G", "mem": 2, "name": "t3_VM1", "vcpu": 4, "vmif": "t3VM1if1"}, {"brif": "t3br1if2", "disk": "10G", "mem": 4, "name": "t3_VM2", "vcpu": 2, "vmif": "t3VM2if1"}], "vxlan": [{"dev": "t3s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.21.2", "remote_ip": "10.2.21.2", "remote_route": "10.2.21.0/24", "subnet_route": "10.1.21.0/24", "tenant_route_ip": "192.168.3.2", "v_name": "vxlan_t3s1"}]}, {"tenant_ns_if": "t3ns1if", "tenant_ns_ip": "10.1.21.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s1if", "tenant_sub_ip": "10.1.21.2/24"}], "rc": 0, "start": "2019-12-05 07:25:53.882931", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Add IP addresses to Namespace VETH Pairs] *************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.21.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.1.21.1', u'bridge_name': u't3br1', u'dns': [{u'dnsif': u't3s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't3s1_dnsbrif'}], u'ns_name': u't3ns1', u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't3_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't3br1if1', u'vmif': u't3VM1if1'}, {u'mem': 4, u'name': u't3_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't3br1if2', u'vmif': u't3VM2if1'}], u'vxlan': [{u'local_ip': u'10.1.21.2', u'dsport': 4789, u'dev': u't3s1if', u'tenant_route_ip': u'192.168.3.2', u'remote_route': u'10.2.21.0/24', u'subnet_route': u'10.1.21.0/24', u'v_name': u'vxlan_t3s1', u'id': 42, u'remote_ip': u'10.2.21.2'}]}, {u'tenant_sub_ip': u'10.1.21.2/24', u'tenant_ns_ip': u'10.1.21.1/24', u'tenant_ns_if': u't3ns1if', u'tenant_sub_if': u't3s1if', u'tenant_ns_name': u't3'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t3ns1\" ip addr show \"t3s1if\" | awk 'FNR==3{ print $2 }' | grep -w '^10.1.21.2/24' ; if [ $? -ne 0 ] ; then ip netns exec \"t3ns1\" ip addr add \"10.1.21.2/24\" dev \"t3s1if\" ; fi\n\nip netns exec \"t3\" ip addr show \"t3ns1if\" | awk 'FNR==3{ print $2 }' | grep -w '^10.1.21.1/24' ; if [ $? -ne 0 ] ; then ip netns exec \"t3\" ip addr add \"10.1.21.1/24\" dev \"t3ns1if\" ; fi\n", "delta": "0:00:00.131603", "end": "2019-12-05 07:25:54.405418", "item": [{"bridge_name": "t3br1", "default_route_ip": "10.1.21.1", "dns": [{"brif": "t3s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.5", "dnsif": "t3s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t3ns1", "route": [{"if": "p1", "ip": "10.1.21.1/24", "ns_if": "t3if", "ns_name": "t3"}], "subnet_ip": "1.1.1.0/24", "vms": [{"brif": "t3br1if1", "disk": "10G", "mem": 2, "name": "t3_VM1", "vcpu": 4, "vmif": "t3VM1if1"}, {"brif": "t3br1if2", "disk": "10G", "mem": 4, "name": "t3_VM2", "vcpu": 2, "vmif": "t3VM2if1"}], "vxlan": [{"dev": "t3s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.21.2", "remote_ip": "10.2.21.2", "remote_route": "10.2.21.0/24", "subnet_route": "10.1.21.0/24", "tenant_route_ip": "192.168.3.2", "v_name": "vxlan_t3s1"}]}, {"tenant_ns_if": "t3ns1if", "tenant_ns_ip": "10.1.21.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s1if", "tenant_sub_ip": "10.1.21.2/24"}], "rc": 0, "start": "2019-12-05 07:25:54.273815", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Add IP Route to Tenant] *******************************************************************************************************************************
changed: [localhost] => (item={u'default_route_ip': u'192.168.3.1', u'name': u't3', u'pns_ip': u'192.168.3.1/24', u'tenant_if': u't3if', u'tenant_ip': u'192.168.3.2/24', u'pns_if': u't3pns_if'}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t3\" ip route show default | grep -w '[d]efault via 192.168.3.1' ; if [ $? -ne 0 ] ; then ip netns exec \"t3\" ip route add default via \"192.168.3.1\" ; fi\n", "delta": "0:00:00.070501", "end": "2019-12-05 07:25:54.773866", "item": {"default_route_ip": "192.168.3.1", "name": "t3", "pns_if": "t3pns_if", "pns_ip": "192.168.3.1/24", "tenant_if": "t3if", "tenant_ip": "192.168.3.2/24"}, "rc": 0, "start": "2019-12-05 07:25:54.703365", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Add IP Route to Tenant Subnet] ************************************************************************************************************************
changed: [localhost] => (item={u'route': [{u'ip': u'10.1.21.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.1.21.1', u'bridge_name': u't3br1', u'dns': [{u'dnsif': u't3s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't3s1_dnsbrif'}], u'ns_name': u't3ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.21.2/24', u'tenant_ns_ip': u'10.1.21.1/24', u'tenant_ns_if': u't3ns1if', u'tenant_ns_name': u't3', u'tenant_sub_if': u't3s1if'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't3_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't3br1if1', u'vmif': u't3VM1if1'}, {u'mem': 4, u'name': u't3_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't3br1if2', u'vmif': u't3VM2if1'}], u'vxlan': [{u'local_ip': u'10.1.21.2', u'tenant_route_ip': u'192.168.3.2', u'dsport': 4789, u'dev': u't3s1if', u'subnet_route': u'10.1.21.0/24', u'remote_route': u'10.2.21.0/24', u'v_name': u'vxlan_t3s1', u'id': 42, u'remote_ip': u'10.2.21.2'}]}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t3ns1\" ip route show default | grep -w '[d]efault via 10.1.21.1' ; if [ $? -ne 0 ] ; then ip netns exec \"t3ns1\" ip route add default via \"10.1.21.1\" ; fi\n", "delta": "0:00:00.084718", "end": "2019-12-05 07:25:55.165095", "item": {"bridge_name": "t3br1", "default_route_ip": "10.1.21.1", "dns": [{"brif": "t3s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.5", "dnsif": "t3s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t3ns1", "route": [{"if": "p1", "ip": "10.1.21.1/24", "ns_if": "t3if", "ns_name": "t3"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t3ns1if", "tenant_ns_ip": "10.1.21.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s1if", "tenant_sub_ip": "10.1.21.2/24"}], "vms": [{"brif": "t3br1if1", "disk": "10G", "mem": 2, "name": "t3_VM1", "vcpu": 4, "vmif": "t3VM1if1"}, {"brif": "t3br1if2", "disk": "10G", "mem": 4, "name": "t3_VM2", "vcpu": 2, "vmif": "t3VM2if1"}], "vxlan": [{"dev": "t3s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.21.2", "remote_ip": "10.2.21.2", "remote_route": "10.2.21.0/24", "subnet_route": "10.1.21.0/24", "tenant_route_ip": "192.168.3.2", "v_name": "vxlan_t3s1"}]}, "rc": 0, "start": "2019-12-05 07:25:55.080377", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Create bridge inside namespace] ***********************************************************************************************************************
changed: [localhost] => (item={u'route': [{u'ip': u'10.1.21.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.1.21.1', u'bridge_name': u't3br1', u'dns': [{u'dnsif': u't3s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't3s1_dnsbrif'}], u'ns_name': u't3ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.21.2/24', u'tenant_ns_ip': u'10.1.21.1/24', u'tenant_ns_if': u't3ns1if', u'tenant_ns_name': u't3', u'tenant_sub_if': u't3s1if'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't3_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't3br1if1', u'vmif': u't3VM1if1'}, {u'mem': 4, u'name': u't3_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't3br1if2', u'vmif': u't3VM2if1'}], u'vxlan': [{u'local_ip': u'10.1.21.2', u'tenant_route_ip': u'192.168.3.2', u'dsport': 4789, u'dev': u't3s1if', u'subnet_route': u'10.1.21.0/24', u'remote_route': u'10.2.21.0/24', u'v_name': u'vxlan_t3s1', u'id': 42, u'remote_ip': u'10.2.21.2'}]}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t3ns1\" brctl show | grep -w '^t3br1'; if [ $? -ne 0 ] ; then ip netns exec \"t3ns1\" brctl addbr \"t3br1\" ; fi\nip netns exec \"t3ns1\" ip link set dev \"t3br1\" up\n", "delta": "0:00:00.115671", "end": "2019-12-05 07:25:55.561134", "item": {"bridge_name": "t3br1", "default_route_ip": "10.1.21.1", "dns": [{"brif": "t3s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.5", "dnsif": "t3s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t3ns1", "route": [{"if": "p1", "ip": "10.1.21.1/24", "ns_if": "t3if", "ns_name": "t3"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t3ns1if", "tenant_ns_ip": "10.1.21.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s1if", "tenant_sub_ip": "10.1.21.2/24"}], "vms": [{"brif": "t3br1if1", "disk": "10G", "mem": 2, "name": "t3_VM1", "vcpu": 4, "vmif": "t3VM1if1"}, {"brif": "t3br1if2", "disk": "10G", "mem": 4, "name": "t3_VM2", "vcpu": 2, "vmif": "t3VM2if1"}], "vxlan": [{"dev": "t3s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.21.2", "remote_ip": "10.2.21.2", "remote_route": "10.2.21.0/24", "subnet_route": "10.1.21.0/24", "tenant_route_ip": "192.168.3.2", "v_name": "vxlan_t3s1"}]}, "rc": 0, "start": "2019-12-05 07:25:55.445463", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Create DNS VETH Pair] *********************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.21.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.1.21.1', u'bridge_name': u't3br1', u'ns_name': u't3ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.21.2/24', u'tenant_ns_ip': u'10.1.21.1/24', u'tenant_ns_if': u't3ns1if', u'tenant_sub_if': u't3s1if', u'tenant_ns_name': u't3'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't3_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't3br1if1', u'vmif': u't3VM1if1'}, {u'mem': 4, u'name': u't3_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't3br1if2', u'vmif': u't3VM2if1'}], u'vxlan': [{u'local_ip': u'10.1.21.2', u'dsport': 4789, u'dev': u't3s1if', u'tenant_route_ip': u'192.168.3.2', u'remote_route': u'10.2.21.0/24', u'subnet_route': u'10.1.21.0/24', u'v_name': u'vxlan_t3s1', u'id': 42, u'remote_ip': u'10.2.21.2'}]}, {u'dnsif': u't3s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't3s1_dnsbrif'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t3ns1\" ip link show \"t3s1_dnsbrif\" ; if [ $? -ne 0 ] ; then ip netns exec \"t3ns1\" ip link add \"t3s1_dnsbrif\" type veth peer name \"t3s1_dnsif\" ; fi\nip netns exec \"t3ns1\" ip link set dev \"t3s1_dnsbrif\" up\nip netns exec \"t3ns1\" ip link set dev \"t3s1_dnsif\" up\n", "delta": "0:00:00.141083", "end": "2019-12-05 07:25:55.985093", "item": [{"bridge_name": "t3br1", "default_route_ip": "10.1.21.1", "ns_name": "t3ns1", "route": [{"if": "p1", "ip": "10.1.21.1/24", "ns_if": "t3if", "ns_name": "t3"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t3ns1if", "tenant_ns_ip": "10.1.21.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s1if", "tenant_sub_ip": "10.1.21.2/24"}], "vms": [{"brif": "t3br1if1", "disk": "10G", "mem": 2, "name": "t3_VM1", "vcpu": 4, "vmif": "t3VM1if1"}, {"brif": "t3br1if2", "disk": "10G", "mem": 4, "name": "t3_VM2", "vcpu": 2, "vmif": "t3VM2if1"}], "vxlan": [{"dev": "t3s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.21.2", "remote_ip": "10.2.21.2", "remote_route": "10.2.21.0/24", "subnet_route": "10.1.21.0/24", "tenant_route_ip": "192.168.3.2", "v_name": "vxlan_t3s1"}]}, {"brif": "t3s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.5", "dnsif": "t3s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "rc": 0, "start": "2019-12-05 07:25:55.844010", "stderr": "Device \"t3s1_dnsbrif\" does not exist.", "stderr_lines": ["Device \"t3s1_dnsbrif\" does not exist."], "stdout": "", "stdout_lines": []}

TASK [Attach DNS VETH Pair] *********************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.21.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.1.21.1', u'bridge_name': u't3br1', u'ns_name': u't3ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.21.2/24', u'tenant_ns_ip': u'10.1.21.1/24', u'tenant_ns_if': u't3ns1if', u'tenant_sub_if': u't3s1if', u'tenant_ns_name': u't3'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't3_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't3br1if1', u'vmif': u't3VM1if1'}, {u'mem': 4, u'name': u't3_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't3br1if2', u'vmif': u't3VM2if1'}], u'vxlan': [{u'local_ip': u'10.1.21.2', u'dsport': 4789, u'dev': u't3s1if', u'tenant_route_ip': u'192.168.3.2', u'remote_route': u'10.2.21.0/24', u'subnet_route': u'10.1.21.0/24', u'v_name': u'vxlan_t3s1', u'id': 42, u'remote_ip': u'10.2.21.2'}]}, {u'dnsif': u't3s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't3s1_dnsbrif'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t3ns1\" brctl show \"t3br1\" | grep -w 't3s1_dnsbrif' ; if [ $? -ne 0 ] ; then ip netns exec \"t3ns1\" brctl addif \"t3br1\" \"t3s1_dnsbrif\" ; fi\n", "delta": "0:00:00.087185", "end": "2019-12-05 07:25:56.369140", "item": [{"bridge_name": "t3br1", "default_route_ip": "10.1.21.1", "ns_name": "t3ns1", "route": [{"if": "p1", "ip": "10.1.21.1/24", "ns_if": "t3if", "ns_name": "t3"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t3ns1if", "tenant_ns_ip": "10.1.21.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s1if", "tenant_sub_ip": "10.1.21.2/24"}], "vms": [{"brif": "t3br1if1", "disk": "10G", "mem": 2, "name": "t3_VM1", "vcpu": 4, "vmif": "t3VM1if1"}, {"brif": "t3br1if2", "disk": "10G", "mem": 4, "name": "t3_VM2", "vcpu": 2, "vmif": "t3VM2if1"}], "vxlan": [{"dev": "t3s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.21.2", "remote_ip": "10.2.21.2", "remote_route": "10.2.21.0/24", "subnet_route": "10.1.21.0/24", "tenant_route_ip": "192.168.3.2", "v_name": "vxlan_t3s1"}]}, {"brif": "t3s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.5", "dnsif": "t3s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "rc": 0, "start": "2019-12-05 07:25:56.281955", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Create VETH Pairs] ************************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.21.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.1.21.1', u'bridge_name': u't3br1', u'dns': [{u'dnsif': u't3s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't3s1_dnsbrif'}], u'ns_name': u't3ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.21.2/24', u'tenant_ns_ip': u'10.1.21.1/24', u'tenant_ns_if': u't3ns1if', u'tenant_sub_if': u't3s1if', u'tenant_ns_name': u't3'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.1.21.2', u'dsport': 4789, u'dev': u't3s1if', u'tenant_route_ip': u'192.168.3.2', u'remote_route': u'10.2.21.0/24', u'subnet_route': u'10.1.21.0/24', u'v_name': u'vxlan_t3s1', u'id': 42, u'remote_ip': u'10.2.21.2'}]}, {u'mem': 2, u'name': u't3_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't3br1if1', u'vmif': u't3VM1if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip link show \"t3br1if1\" ; if [ $? -ne 0 ] ; then ip link add \"t3VM1if1\" type veth peer name \"t3br1if1\" ; fi\nip link set dev \"t3br1if1\" up\nip link set dev \"t3VM1if1\" up\n", "delta": "0:00:00.018113", "end": "2019-12-05 07:25:56.673402", "item": [{"bridge_name": "t3br1", "default_route_ip": "10.1.21.1", "dns": [{"brif": "t3s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.5", "dnsif": "t3s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t3ns1", "route": [{"if": "p1", "ip": "10.1.21.1/24", "ns_if": "t3if", "ns_name": "t3"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t3ns1if", "tenant_ns_ip": "10.1.21.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s1if", "tenant_sub_ip": "10.1.21.2/24"}], "vxlan": [{"dev": "t3s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.21.2", "remote_ip": "10.2.21.2", "remote_route": "10.2.21.0/24", "subnet_route": "10.1.21.0/24", "tenant_route_ip": "192.168.3.2", "v_name": "vxlan_t3s1"}]}, {"brif": "t3br1if1", "disk": "10G", "mem": 2, "name": "t3_VM1", "vcpu": 4, "vmif": "t3VM1if1"}], "rc": 0, "start": "2019-12-05 07:25:56.655289", "stderr": "Device \"t3br1if1\" does not exist.", "stderr_lines": ["Device \"t3br1if1\" does not exist."], "stdout": "", "stdout_lines": []}
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.21.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.1.21.1', u'bridge_name': u't3br1', u'dns': [{u'dnsif': u't3s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't3s1_dnsbrif'}], u'ns_name': u't3ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.21.2/24', u'tenant_ns_ip': u'10.1.21.1/24', u'tenant_ns_if': u't3ns1if', u'tenant_sub_if': u't3s1if', u'tenant_ns_name': u't3'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.1.21.2', u'dsport': 4789, u'dev': u't3s1if', u'tenant_route_ip': u'192.168.3.2', u'remote_route': u'10.2.21.0/24', u'subnet_route': u'10.1.21.0/24', u'v_name': u'vxlan_t3s1', u'id': 42, u'remote_ip': u'10.2.21.2'}]}, {u'mem': 4, u'name': u't3_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't3br1if2', u'vmif': u't3VM2if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip link show \"t3br1if2\" ; if [ $? -ne 0 ] ; then ip link add \"t3VM2if1\" type veth peer name \"t3br1if2\" ; fi\nip link set dev \"t3br1if2\" up\nip link set dev \"t3VM2if1\" up\n", "delta": "0:00:00.026853", "end": "2019-12-05 07:25:56.925371", "item": [{"bridge_name": "t3br1", "default_route_ip": "10.1.21.1", "dns": [{"brif": "t3s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.5", "dnsif": "t3s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t3ns1", "route": [{"if": "p1", "ip": "10.1.21.1/24", "ns_if": "t3if", "ns_name": "t3"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t3ns1if", "tenant_ns_ip": "10.1.21.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s1if", "tenant_sub_ip": "10.1.21.2/24"}], "vxlan": [{"dev": "t3s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.21.2", "remote_ip": "10.2.21.2", "remote_route": "10.2.21.0/24", "subnet_route": "10.1.21.0/24", "tenant_route_ip": "192.168.3.2", "v_name": "vxlan_t3s1"}]}, {"brif": "t3br1if2", "disk": "10G", "mem": 4, "name": "t3_VM2", "vcpu": 2, "vmif": "t3VM2if1"}], "rc": 0, "start": "2019-12-05 07:25:56.898518", "stderr": "Device \"t3br1if2\" does not exist.", "stderr_lines": ["Device \"t3br1if2\" does not exist."], "stdout": "", "stdout_lines": []}

TASK [Attach VETH Pairs] ************************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.21.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.1.21.1', u'bridge_name': u't3br1', u'dns': [{u'dnsif': u't3s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't3s1_dnsbrif'}], u'ns_name': u't3ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.21.2/24', u'tenant_ns_ip': u'10.1.21.1/24', u'tenant_ns_if': u't3ns1if', u'tenant_sub_if': u't3s1if', u'tenant_ns_name': u't3'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.1.21.2', u'dsport': 4789, u'dev': u't3s1if', u'tenant_route_ip': u'192.168.3.2', u'remote_route': u'10.2.21.0/24', u'subnet_route': u'10.1.21.0/24', u'v_name': u'vxlan_t3s1', u'id': 42, u'remote_ip': u'10.2.21.2'}]}, {u'mem': 2, u'name': u't3_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't3br1if1', u'vmif': u't3VM1if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip link show \"t3br1if1\" ; if [ $? -eq 0 ] ; then ip link set \"t3br1if1\" netns \"t3ns1\" ; fi\nip netns exec \"t3ns1\" brctl show \"t3br1\" | grep -w 't3br1if1' ; if [ $? -ne 0 ] ; then ip netns exec \"t3ns1\" brctl addif \"t3br1\" \"t3br1if1\" ; fi\n", "delta": "0:00:00.097741", "end": "2019-12-05 07:25:57.285095", "item": [{"bridge_name": "t3br1", "default_route_ip": "10.1.21.1", "dns": [{"brif": "t3s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.5", "dnsif": "t3s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t3ns1", "route": [{"if": "p1", "ip": "10.1.21.1/24", "ns_if": "t3if", "ns_name": "t3"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t3ns1if", "tenant_ns_ip": "10.1.21.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s1if", "tenant_sub_ip": "10.1.21.2/24"}], "vxlan": [{"dev": "t3s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.21.2", "remote_ip": "10.2.21.2", "remote_route": "10.2.21.0/24", "subnet_route": "10.1.21.0/24", "tenant_route_ip": "192.168.3.2", "v_name": "vxlan_t3s1"}]}, {"brif": "t3br1if1", "disk": "10G", "mem": 2, "name": "t3_VM1", "vcpu": 4, "vmif": "t3VM1if1"}], "rc": 0, "start": "2019-12-05 07:25:57.187354", "stderr": "", "stderr_lines": [], "stdout": "87: t3br1if1@t3VM1if1: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP mode DEFAULT group default qlen 1000\n    link/ether de:cc:17:38:d7:68 brd ff:ff:ff:ff:ff:ff", "stdout_lines": ["87: t3br1if1@t3VM1if1: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP mode DEFAULT group default qlen 1000", "    link/ether de:cc:17:38:d7:68 brd ff:ff:ff:ff:ff:ff"]}
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.21.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.1.21.1', u'bridge_name': u't3br1', u'dns': [{u'dnsif': u't3s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't3s1_dnsbrif'}], u'ns_name': u't3ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.21.2/24', u'tenant_ns_ip': u'10.1.21.1/24', u'tenant_ns_if': u't3ns1if', u'tenant_sub_if': u't3s1if', u'tenant_ns_name': u't3'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.1.21.2', u'dsport': 4789, u'dev': u't3s1if', u'tenant_route_ip': u'192.168.3.2', u'remote_route': u'10.2.21.0/24', u'subnet_route': u'10.1.21.0/24', u'v_name': u'vxlan_t3s1', u'id': 42, u'remote_ip': u'10.2.21.2'}]}, {u'mem': 4, u'name': u't3_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't3br1if2', u'vmif': u't3VM2if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip link show \"t3br1if2\" ; if [ $? -eq 0 ] ; then ip link set \"t3br1if2\" netns \"t3ns1\" ; fi\nip netns exec \"t3ns1\" brctl show \"t3br1\" | grep -w 't3br1if2' ; if [ $? -ne 0 ] ; then ip netns exec \"t3ns1\" brctl addif \"t3br1\" \"t3br1if2\" ; fi\n", "delta": "0:00:00.098866", "end": "2019-12-05 07:25:57.589254", "item": [{"bridge_name": "t3br1", "default_route_ip": "10.1.21.1", "dns": [{"brif": "t3s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.5", "dnsif": "t3s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t3ns1", "route": [{"if": "p1", "ip": "10.1.21.1/24", "ns_if": "t3if", "ns_name": "t3"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t3ns1if", "tenant_ns_ip": "10.1.21.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s1if", "tenant_sub_ip": "10.1.21.2/24"}], "vxlan": [{"dev": "t3s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.21.2", "remote_ip": "10.2.21.2", "remote_route": "10.2.21.0/24", "subnet_route": "10.1.21.0/24", "tenant_route_ip": "192.168.3.2", "v_name": "vxlan_t3s1"}]}, {"brif": "t3br1if2", "disk": "10G", "mem": 4, "name": "t3_VM2", "vcpu": 2, "vmif": "t3VM2if1"}], "rc": 0, "start": "2019-12-05 07:25:57.490388", "stderr": "", "stderr_lines": [], "stdout": "89: t3br1if2@t3VM2if1: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP mode DEFAULT group default qlen 1000\n    link/ether da:09:c5:f4:4c:1a brd ff:ff:ff:ff:ff:ff", "stdout_lines": ["89: t3br1if2@t3VM2if1: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP mode DEFAULT group default qlen 1000", "    link/ether da:09:c5:f4:4c:1a brd ff:ff:ff:ff:ff:ff"]}

TASK [All interfaces and bridges UP] ************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.21.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.1.21.1', u'bridge_name': u't3br1', u'dns': [{u'dnsif': u't3s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't3s1_dnsbrif'}], u'ns_name': u't3ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.21.2/24', u'tenant_ns_ip': u'10.1.21.1/24', u'tenant_ns_if': u't3ns1if', u'tenant_sub_if': u't3s1if', u'tenant_ns_name': u't3'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.1.21.2', u'dsport': 4789, u'dev': u't3s1if', u'tenant_route_ip': u'192.168.3.2', u'remote_route': u'10.2.21.0/24', u'subnet_route': u'10.1.21.0/24', u'v_name': u'vxlan_t3s1', u'id': 42, u'remote_ip': u'10.2.21.2'}]}, {u'mem': 2, u'name': u't3_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't3br1if1', u'vmif': u't3VM1if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t3ns1\" ip link set \"t3br1if1\" up\nip netns exec \"t3ns1\" ip link set dev \"t3br1\" up\n", "delta": "0:00:00.081481", "end": "2019-12-05 07:25:57.953468", "item": [{"bridge_name": "t3br1", "default_route_ip": "10.1.21.1", "dns": [{"brif": "t3s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.5", "dnsif": "t3s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t3ns1", "route": [{"if": "p1", "ip": "10.1.21.1/24", "ns_if": "t3if", "ns_name": "t3"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t3ns1if", "tenant_ns_ip": "10.1.21.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s1if", "tenant_sub_ip": "10.1.21.2/24"}], "vxlan": [{"dev": "t3s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.21.2", "remote_ip": "10.2.21.2", "remote_route": "10.2.21.0/24", "subnet_route": "10.1.21.0/24", "tenant_route_ip": "192.168.3.2", "v_name": "vxlan_t3s1"}]}, {"brif": "t3br1if1", "disk": "10G", "mem": 2, "name": "t3_VM1", "vcpu": 4, "vmif": "t3VM1if1"}], "rc": 0, "start": "2019-12-05 07:25:57.871987", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.21.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.1.21.1', u'bridge_name': u't3br1', u'dns': [{u'dnsif': u't3s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't3s1_dnsbrif'}], u'ns_name': u't3ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.21.2/24', u'tenant_ns_ip': u'10.1.21.1/24', u'tenant_ns_if': u't3ns1if', u'tenant_sub_if': u't3s1if', u'tenant_ns_name': u't3'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.1.21.2', u'dsport': 4789, u'dev': u't3s1if', u'tenant_route_ip': u'192.168.3.2', u'remote_route': u'10.2.21.0/24', u'subnet_route': u'10.1.21.0/24', u'v_name': u'vxlan_t3s1', u'id': 42, u'remote_ip': u'10.2.21.2'}]}, {u'mem': 4, u'name': u't3_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't3br1if2', u'vmif': u't3VM2if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t3ns1\" ip link set \"t3br1if2\" up\nip netns exec \"t3ns1\" ip link set dev \"t3br1\" up\n", "delta": "0:00:00.072604", "end": "2019-12-05 07:25:58.233040", "item": [{"bridge_name": "t3br1", "default_route_ip": "10.1.21.1", "dns": [{"brif": "t3s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.5", "dnsif": "t3s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t3ns1", "route": [{"if": "p1", "ip": "10.1.21.1/24", "ns_if": "t3if", "ns_name": "t3"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t3ns1if", "tenant_ns_ip": "10.1.21.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s1if", "tenant_sub_ip": "10.1.21.2/24"}], "vxlan": [{"dev": "t3s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.21.2", "remote_ip": "10.2.21.2", "remote_route": "10.2.21.0/24", "subnet_route": "10.1.21.0/24", "tenant_route_ip": "192.168.3.2", "v_name": "vxlan_t3s1"}]}, {"brif": "t3br1if2", "disk": "10G", "mem": 4, "name": "t3_VM2", "vcpu": 2, "vmif": "t3VM2if1"}], "rc": 0, "start": "2019-12-05 07:25:58.160436", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Add IP to DNS Interface] ******************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.21.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.1.21.1', u'bridge_name': u't3br1', u'ns_name': u't3ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.21.2/24', u'tenant_ns_ip': u'10.1.21.1/24', u'tenant_ns_if': u't3ns1if', u'tenant_sub_if': u't3s1if', u'tenant_ns_name': u't3'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't3_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't3br1if1', u'vmif': u't3VM1if1'}, {u'mem': 4, u'name': u't3_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't3br1if2', u'vmif': u't3VM2if1'}], u'vxlan': [{u'local_ip': u'10.1.21.2', u'dsport': 4789, u'dev': u't3s1if', u'tenant_route_ip': u'192.168.3.2', u'remote_route': u'10.2.21.0/24', u'subnet_route': u'10.1.21.0/24', u'v_name': u'vxlan_t3s1', u'id': 42, u'remote_ip': u'10.2.21.2'}]}, {u'dnsif': u't3s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't3s1_dnsbrif'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t3ns1\" ip addr show \"t3s1_dnsif\" | awk 'FNR==3{ print $2 }' | grep -w '^1.1.1.1/24' ; if [ $? -ne 0 ] ; then ip netns exec \"t3ns1\" ip addr add \"1.1.1.1/24\" dev \"t3s1_dnsif\" ; fi\n", "delta": "0:00:00.075598", "end": "2019-12-05 07:25:58.589394", "item": [{"bridge_name": "t3br1", "default_route_ip": "10.1.21.1", "ns_name": "t3ns1", "route": [{"if": "p1", "ip": "10.1.21.1/24", "ns_if": "t3if", "ns_name": "t3"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t3ns1if", "tenant_ns_ip": "10.1.21.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s1if", "tenant_sub_ip": "10.1.21.2/24"}], "vms": [{"brif": "t3br1if1", "disk": "10G", "mem": 2, "name": "t3_VM1", "vcpu": 4, "vmif": "t3VM1if1"}, {"brif": "t3br1if2", "disk": "10G", "mem": 4, "name": "t3_VM2", "vcpu": 2, "vmif": "t3VM2if1"}], "vxlan": [{"dev": "t3s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.21.2", "remote_ip": "10.2.21.2", "remote_route": "10.2.21.0/24", "subnet_route": "10.1.21.0/24", "tenant_route_ip": "192.168.3.2", "v_name": "vxlan_t3s1"}]}, {"brif": "t3s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.5", "dnsif": "t3s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "rc": 0, "start": "2019-12-05 07:25:58.513796", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Install DHCP Server] **********************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.21.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.1.21.1', u'bridge_name': u't3br1', u'ns_name': u't3ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.21.2/24', u'tenant_ns_ip': u'10.1.21.1/24', u'tenant_ns_if': u't3ns1if', u'tenant_sub_if': u't3s1if', u'tenant_ns_name': u't3'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't3_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't3br1if1', u'vmif': u't3VM1if1'}, {u'mem': 4, u'name': u't3_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't3br1if2', u'vmif': u't3VM2if1'}], u'vxlan': [{u'local_ip': u'10.1.21.2', u'dsport': 4789, u'dev': u't3s1if', u'tenant_route_ip': u'192.168.3.2', u'remote_route': u'10.2.21.0/24', u'subnet_route': u'10.1.21.0/24', u'v_name': u'vxlan_t3s1', u'id': 42, u'remote_ip': u'10.2.21.2'}]}, {u'dnsif': u't3s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't3s1_dnsbrif'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t3ns1\" ps aux | grep -w '[d]nsmasq --interface t3s1_dnsif -z --dhcp-range=1.1.1.5,1.1.1.254' ; if [ $? -ne 0 ] ; then ip netns exec \"t3ns1\" dnsmasq --interface \"t3s1_dnsif\" -z --dhcp-range=1.1.1.5,'1.1.1.254' ; fi\n", "delta": "0:00:00.076746", "end": "2019-12-05 07:25:58.937297", "item": [{"bridge_name": "t3br1", "default_route_ip": "10.1.21.1", "ns_name": "t3ns1", "route": [{"if": "p1", "ip": "10.1.21.1/24", "ns_if": "t3if", "ns_name": "t3"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t3ns1if", "tenant_ns_ip": "10.1.21.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s1if", "tenant_sub_ip": "10.1.21.2/24"}], "vms": [{"brif": "t3br1if1", "disk": "10G", "mem": 2, "name": "t3_VM1", "vcpu": 4, "vmif": "t3VM1if1"}, {"brif": "t3br1if2", "disk": "10G", "mem": 4, "name": "t3_VM2", "vcpu": 2, "vmif": "t3VM2if1"}], "vxlan": [{"dev": "t3s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.21.2", "remote_ip": "10.2.21.2", "remote_route": "10.2.21.0/24", "subnet_route": "10.1.21.0/24", "tenant_route_ip": "192.168.3.2", "v_name": "vxlan_t3s1"}]}, {"brif": "t3s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.5", "dnsif": "t3s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "rc": 0, "start": "2019-12-05 07:25:58.860551", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Create VXLAN devices] *********************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.21.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.1.21.1', u'bridge_name': u't3br1', u'dns': [{u'dnsif': u't3s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't3s1_dnsbrif'}], u'ns_name': u't3ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.21.2/24', u'tenant_ns_ip': u'10.1.21.1/24', u'tenant_ns_if': u't3ns1if', u'tenant_sub_if': u't3s1if', u'tenant_ns_name': u't3'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't3_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't3br1if1', u'vmif': u't3VM1if1'}, {u'mem': 4, u'name': u't3_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't3br1if2', u'vmif': u't3VM2if1'}]}, {u'local_ip': u'10.1.21.2', u'dsport': 4789, u'dev': u't3s1if', u'tenant_route_ip': u'192.168.3.2', u'remote_route': u'10.2.21.0/24', u'subnet_route': u'10.1.21.0/24', u'v_name': u'vxlan_t3s1', u'id': 42, u'remote_ip': u'10.2.21.2'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t3ns1\" ip link show \"vxlan_t3s1\" ; if [ $? -ne 0 ] ; then ip netns exec \"t3ns1\" ip link add \"vxlan_t3s1\" type vxlan id \"42\" local \"10.1.21.2\" remote \"10.2.21.2\" dstport \"4789\" dev \"t3s1if\"; ip netns exec \"t3ns1\" ip link set dev \"vxlan_t3s1\" up ; fi\n", "delta": "0:00:00.120189", "end": "2019-12-05 07:25:59.337143", "item": [{"bridge_name": "t3br1", "default_route_ip": "10.1.21.1", "dns": [{"brif": "t3s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.5", "dnsif": "t3s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t3ns1", "route": [{"if": "p1", "ip": "10.1.21.1/24", "ns_if": "t3if", "ns_name": "t3"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t3ns1if", "tenant_ns_ip": "10.1.21.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s1if", "tenant_sub_ip": "10.1.21.2/24"}], "vms": [{"brif": "t3br1if1", "disk": "10G", "mem": 2, "name": "t3_VM1", "vcpu": 4, "vmif": "t3VM1if1"}, {"brif": "t3br1if2", "disk": "10G", "mem": 4, "name": "t3_VM2", "vcpu": 2, "vmif": "t3VM2if1"}]}, {"dev": "t3s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.21.2", "remote_ip": "10.2.21.2", "remote_route": "10.2.21.0/24", "subnet_route": "10.1.21.0/24", "tenant_route_ip": "192.168.3.2", "v_name": "vxlan_t3s1"}], "rc": 0, "start": "2019-12-05 07:25:59.216954", "stderr": "Device \"vxlan_t3s1\" does not exist.", "stderr_lines": ["Device \"vxlan_t3s1\" does not exist."], "stdout": "", "stdout_lines": []}

TASK [Attach VXLANs to bridge] ******************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.21.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.1.21.1', u'bridge_name': u't3br1', u'dns': [{u'dnsif': u't3s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't3s1_dnsbrif'}], u'ns_name': u't3ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.21.2/24', u'tenant_ns_ip': u'10.1.21.1/24', u'tenant_ns_if': u't3ns1if', u'tenant_sub_if': u't3s1if', u'tenant_ns_name': u't3'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't3_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't3br1if1', u'vmif': u't3VM1if1'}, {u'mem': 4, u'name': u't3_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't3br1if2', u'vmif': u't3VM2if1'}]}, {u'local_ip': u'10.1.21.2', u'dsport': 4789, u'dev': u't3s1if', u'tenant_route_ip': u'192.168.3.2', u'remote_route': u'10.2.21.0/24', u'subnet_route': u'10.1.21.0/24', u'v_name': u'vxlan_t3s1', u'id': 42, u'remote_ip': u'10.2.21.2'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t3ns1\" brctl show \"t3br1\" | grep -w 'vxlan_t3s1' ; if [ $? -ne 0 ] ; then ip netns exec \"t3ns1\" brctl addif \"t3br1\" \"vxlan_t3s1\" ; fi\n", "delta": "0:00:00.085664", "end": "2019-12-05 07:25:59.713184", "item": [{"bridge_name": "t3br1", "default_route_ip": "10.1.21.1", "dns": [{"brif": "t3s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.5", "dnsif": "t3s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t3ns1", "route": [{"if": "p1", "ip": "10.1.21.1/24", "ns_if": "t3if", "ns_name": "t3"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t3ns1if", "tenant_ns_ip": "10.1.21.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s1if", "tenant_sub_ip": "10.1.21.2/24"}], "vms": [{"brif": "t3br1if1", "disk": "10G", "mem": 2, "name": "t3_VM1", "vcpu": 4, "vmif": "t3VM1if1"}, {"brif": "t3br1if2", "disk": "10G", "mem": 4, "name": "t3_VM2", "vcpu": 2, "vmif": "t3VM2if1"}]}, {"dev": "t3s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.21.2", "remote_ip": "10.2.21.2", "remote_route": "10.2.21.0/24", "subnet_route": "10.1.21.0/24", "tenant_route_ip": "192.168.3.2", "v_name": "vxlan_t3s1"}], "rc": 0, "start": "2019-12-05 07:25:59.627520", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

PLAY RECAP **************************************************************************************************************************************************
localhost                  : ok=21   changed=21   unreachable=0    failed=0    skipped=0    rescued=0    ignored=0   

Using /etc/ansible/ansible.cfg as config file

PLAY [worker] ***********************************************************************************************************************************************

TASK [Create Tenant Namespace] ******************************************************************************************************************************
changed: [99.99.99.2] => (item={u'default_route_ip': u'192.168.131.1', u'name': u't3', u'pns_ip': u'192.168.131.1/24', u'tenant_if': u't3if', u'tenant_ip': u'192.168.131.2/24', u'pns_if': u't3pns_if'}) => {"ansible_loop_var": "item", "changed": true, "cmd": ["ip", "netns", "add", "t3"], "delta": "0:00:00.051983", "end": "2019-12-05 07:26:01.595222", "item": {"default_route_ip": "192.168.131.1", "name": "t3", "pns_if": "t3pns_if", "pns_ip": "192.168.131.1/24", "tenant_if": "t3if", "tenant_ip": "192.168.131.2/24"}, "rc": 0, "start": "2019-12-05 07:26:01.543239", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Create Subnet Namespace] ******************************************************************************************************************************
changed: [99.99.99.2] => (item={u'route': [{u'ip': u'10.2.21.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.2.21.1', u'bridge_name': u't3br1', u'dns': [{u'dnsif': [], u'dhcp_start': [], u'dhcp_end': [], u'dnsif_ip': [], u'net_mask': [], u'brif': []}], u'ns_name': u't3ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.21.2/24', u'tenant_ns_ip': u'10.2.21.1/24', u'tenant_ns_if': u't3ns1if', u'tenant_ns_name': u't3', u'tenant_sub_if': u't3s1if'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't3_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't3br1if1', u'vmif': u't3VM4if1'}], u'vxlan': [{u'local_ip': u'10.2.21.2', u'tenant_route_ip': u'192.168.131.2', u'dsport': 4789, u'dev': u't3s1if', u'subnet_route': u'10.2.21.0/24', u'remote_route': u'10.1.21.0/24', u'v_name': u'vxlan_t3s1', u'id': 42, u'remote_ip': u'10.1.21.2'}]}) => {"ansible_loop_var": "item", "changed": true, "cmd": ["ip", "netns", "add", "t3ns1"], "delta": "0:00:00.059140", "end": "2019-12-05 07:26:02.049242", "item": {"bridge_name": "t3br1", "default_route_ip": "10.2.21.1", "dns": [{"brif": [], "dhcp_end": [], "dhcp_start": [], "dnsif": [], "dnsif_ip": [], "net_mask": []}], "ns_name": "t3ns1", "route": [{"if": "p1", "ip": "10.2.21.1/24", "ns_if": "t3if", "ns_name": "t3"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t3ns1if", "tenant_ns_ip": "10.2.21.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s1if", "tenant_sub_ip": "10.2.21.2/24"}], "vms": [{"brif": "t3br1if1", "disk": "10G", "mem": 2, "name": "t3_VM4", "vcpu": 4, "vmif": "t3VM4if1"}], "vxlan": [{"dev": "t3s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.21.2", "remote_ip": "10.1.21.2", "remote_route": "10.1.21.0/24", "subnet_route": "10.2.21.0/24", "tenant_route_ip": "192.168.131.2", "v_name": "vxlan_t3s1"}]}, "rc": 0, "start": "2019-12-05 07:26:01.990102", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}
changed: [99.99.99.2] => (item={u'route': [{u'ip': u'10.2.22.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.2.22.1', u'bridge_name': u't3br2', u'dns': [{u'dnsif': u't3s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't3s2_dnsbrif'}], u'ns_name': u't3ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.22.2/24', u'tenant_ns_ip': u'10.2.22.1/24', u'tenant_ns_if': u't3ns2if', u'tenant_ns_name': u't3', u'tenant_sub_if': u't3s2if'}], u'subnet_ip': u'2.2.2.0/24', u'vms': [{u'mem': 3, u'name': u't3_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't3br2if1', u'vmif': u't3VM3if1'}], u'vxlan': [{u'local_ip': [], u'tenant_route_ip': [], u'dsport': [], u'dev': [], u'subnet_route': [], u'remote_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}) => {"ansible_loop_var": "item", "changed": true, "cmd": ["ip", "netns", "add", "t3ns2"], "delta": "0:00:00.064456", "end": "2019-12-05 07:26:02.439352", "item": {"bridge_name": "t3br2", "default_route_ip": "10.2.22.1", "dns": [{"brif": "t3s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t3s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t3ns2", "route": [{"if": "p1", "ip": "10.2.22.1/24", "ns_if": "t3if", "ns_name": "t3"}], "subnet_ip": "2.2.2.0/24", "tenant_ns": [{"tenant_ns_if": "t3ns2if", "tenant_ns_ip": "10.2.22.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s2if", "tenant_sub_ip": "10.2.22.2/24"}], "vms": [{"brif": "t3br2if1", "disk": "10G", "mem": 3, "name": "t3_VM3", "vcpu": 2, "vmif": "t3VM3if1"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, "rc": 0, "start": "2019-12-05 07:26:02.374896", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Create Tenant VETH pairs] *****************************************************************************************************************************
changed: [99.99.99.2] => (item={u'default_route_ip': u'192.168.131.1', u'name': u't3', u'pns_ip': u'192.168.131.1/24', u'tenant_if': u't3if', u'tenant_ip': u'192.168.131.2/24', u'pns_if': u't3pns_if'}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip link show \"t3if\" ; if [ $? -ne 0 ] ; then ip link add \"t3if\" type veth peer name \"t3pns_if\" ; fi\n", "delta": "0:00:00.012300", "end": "2019-12-05 07:26:02.923385", "item": {"default_route_ip": "192.168.131.1", "name": "t3", "pns_if": "t3pns_if", "pns_ip": "192.168.131.1/24", "tenant_if": "t3if", "tenant_ip": "192.168.131.2/24"}, "rc": 0, "start": "2019-12-05 07:26:02.911085", "stderr": "Device \"t3if\" does not exist.", "stderr_lines": ["Device \"t3if\" does not exist."], "stdout": "", "stdout_lines": []}

TASK [Attach Tenant VETH Pairs] *****************************************************************************************************************************
changed: [99.99.99.2] => (item={u'default_route_ip': u'192.168.131.1', u'name': u't3', u'pns_ip': u'192.168.131.1/24', u'tenant_if': u't3if', u'tenant_ip': u'192.168.131.2/24', u'pns_if': u't3pns_if'}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec pns ip link show \"t3pns_if\" ; if [ $? -ne 0 ] ; then ip link set \"t3pns_if\" netns pns ; fi\nip netns exec \"t3\" ip link show \"t3if\" ; if [ $? -ne 0 ] ; then ip link set \"t3if\" netns \"t3\" ; fi\nip netns exec pns ip link set dev \"t3pns_if\" up\nip netns exec \"t3\" ip link set dev \"t3if\" up\n", "delta": "0:00:00.197601", "end": "2019-12-05 07:26:03.532559", "item": {"default_route_ip": "192.168.131.1", "name": "t3", "pns_if": "t3pns_if", "pns_ip": "192.168.131.1/24", "tenant_if": "t3if", "tenant_ip": "192.168.131.2/24"}, "rc": 0, "start": "2019-12-05 07:26:03.334958", "stderr": "Device \"t3pns_if\" does not exist.\nDevice \"t3if\" does not exist.", "stderr_lines": ["Device \"t3pns_if\" does not exist.", "Device \"t3if\" does not exist."], "stdout": "", "stdout_lines": []}

TASK [Add IP addresses to Tenant VETH Pairs] ****************************************************************************************************************
changed: [99.99.99.2] => (item={u'default_route_ip': u'192.168.131.1', u'name': u't3', u'pns_ip': u'192.168.131.1/24', u'tenant_if': u't3if', u'tenant_ip': u'192.168.131.2/24', u'pns_if': u't3pns_if'}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec pns ip addr show \"t3pns_if\" | awk 'FNR==3{ print $2 }' | grep -w '^192.168.131.1/24' ; if [ $? -ne 0 ] ; then ip netns exec pns ip addr add \"192.168.131.1/24\" dev \"t3pns_if\" ; fi\nip netns exec \"t3\" ip addr show \"t3if\" | awk 'FNR==3{ print $2 }' | grep -w '^192.168.131.2/24' ; if [ $? -ne 0 ] ; then ip netns exec \"t3\" ip addr add \"192.168.131.2/24\" dev \"t3if\" ; fi\n", "delta": "0:00:00.136330", "end": "2019-12-05 07:26:04.068546", "item": {"default_route_ip": "192.168.131.1", "name": "t3", "pns_if": "t3pns_if", "pns_ip": "192.168.131.1/24", "tenant_if": "t3if", "tenant_ip": "192.168.131.2/24"}, "rc": 0, "start": "2019-12-05 07:26:03.932216", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Create Namespace VETH Pairs] **************************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.21.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.2.21.1', u'bridge_name': u't3br1', u'dns': [{u'dnsif': [], u'dhcp_start': [], u'dhcp_end': [], u'dnsif_ip': [], u'net_mask': [], u'brif': []}], u'ns_name': u't3ns1', u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't3_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't3br1if1', u'vmif': u't3VM4if1'}], u'vxlan': [{u'local_ip': u'10.2.21.2', u'dsport': 4789, u'dev': u't3s1if', u'tenant_route_ip': u'192.168.131.2', u'remote_route': u'10.1.21.0/24', u'subnet_route': u'10.2.21.0/24', u'v_name': u'vxlan_t3s1', u'id': 42, u'remote_ip': u'10.1.21.2'}]}, {u'tenant_sub_ip': u'10.2.21.2/24', u'tenant_ns_ip': u'10.2.21.1/24', u'tenant_ns_if': u't3ns1if', u'tenant_sub_if': u't3s1if', u'tenant_ns_name': u't3'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip link show \"t3ns1if\" ; if [ $? -ne 0 ] ; then ip link add \"t3ns1if\" type veth peer name \"t3s1if\" ; fi\n", "delta": "0:00:00.010903", "end": "2019-12-05 07:26:04.506920", "item": [{"bridge_name": "t3br1", "default_route_ip": "10.2.21.1", "dns": [{"brif": [], "dhcp_end": [], "dhcp_start": [], "dnsif": [], "dnsif_ip": [], "net_mask": []}], "ns_name": "t3ns1", "route": [{"if": "p1", "ip": "10.2.21.1/24", "ns_if": "t3if", "ns_name": "t3"}], "subnet_ip": "1.1.1.0/24", "vms": [{"brif": "t3br1if1", "disk": "10G", "mem": 2, "name": "t3_VM4", "vcpu": 4, "vmif": "t3VM4if1"}], "vxlan": [{"dev": "t3s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.21.2", "remote_ip": "10.1.21.2", "remote_route": "10.1.21.0/24", "subnet_route": "10.2.21.0/24", "tenant_route_ip": "192.168.131.2", "v_name": "vxlan_t3s1"}]}, {"tenant_ns_if": "t3ns1if", "tenant_ns_ip": "10.2.21.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s1if", "tenant_sub_ip": "10.2.21.2/24"}], "rc": 0, "start": "2019-12-05 07:26:04.496017", "stderr": "Device \"t3ns1if\" does not exist.", "stderr_lines": ["Device \"t3ns1if\" does not exist."], "stdout": "", "stdout_lines": []}
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.22.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.2.22.1', u'bridge_name': u't3br2', u'dns': [{u'dnsif': u't3s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't3s2_dnsbrif'}], u'ns_name': u't3ns2', u'subnet_ip': u'2.2.2.0/24', u'vms': [{u'mem': 3, u'name': u't3_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't3br2if1', u'vmif': u't3VM3if1'}], u'vxlan': [{u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}, {u'tenant_sub_ip': u'10.2.22.2/24', u'tenant_ns_ip': u'10.2.22.1/24', u'tenant_ns_if': u't3ns2if', u'tenant_sub_if': u't3s2if', u'tenant_ns_name': u't3'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip link show \"t3ns2if\" ; if [ $? -ne 0 ] ; then ip link add \"t3ns2if\" type veth peer name \"t3s2if\" ; fi\n", "delta": "0:00:00.012827", "end": "2019-12-05 07:26:04.854431", "item": [{"bridge_name": "t3br2", "default_route_ip": "10.2.22.1", "dns": [{"brif": "t3s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t3s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t3ns2", "route": [{"if": "p1", "ip": "10.2.22.1/24", "ns_if": "t3if", "ns_name": "t3"}], "subnet_ip": "2.2.2.0/24", "vms": [{"brif": "t3br2if1", "disk": "10G", "mem": 3, "name": "t3_VM3", "vcpu": 2, "vmif": "t3VM3if1"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, {"tenant_ns_if": "t3ns2if", "tenant_ns_ip": "10.2.22.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s2if", "tenant_sub_ip": "10.2.22.2/24"}], "rc": 0, "start": "2019-12-05 07:26:04.841604", "stderr": "Device \"t3ns2if\" does not exist.", "stderr_lines": ["Device \"t3ns2if\" does not exist."], "stdout": "", "stdout_lines": []}

TASK [Attach Namespace VETH Pairs] **************************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.21.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.2.21.1', u'bridge_name': u't3br1', u'dns': [{u'dnsif': [], u'dhcp_start': [], u'dhcp_end': [], u'dnsif_ip': [], u'net_mask': [], u'brif': []}], u'ns_name': u't3ns1', u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't3_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't3br1if1', u'vmif': u't3VM4if1'}], u'vxlan': [{u'local_ip': u'10.2.21.2', u'dsport': 4789, u'dev': u't3s1if', u'tenant_route_ip': u'192.168.131.2', u'remote_route': u'10.1.21.0/24', u'subnet_route': u'10.2.21.0/24', u'v_name': u'vxlan_t3s1', u'id': 42, u'remote_ip': u'10.1.21.2'}]}, {u'tenant_sub_ip': u'10.2.21.2/24', u'tenant_ns_ip': u'10.2.21.1/24', u'tenant_ns_if': u't3ns1if', u'tenant_sub_if': u't3s1if', u'tenant_ns_name': u't3'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t3\" ip link show \"t3ns1if\" ; if [ $? -ne 0 ] ; then ip link set \"t3ns1if\" netns \"t3\" ; fi\nip netns exec \"t3ns1\" ip link show \"t3s1if\" ; if [ $? -ne 0 ] ; then ip link set \"t3s1if\" netns \"t3ns1\" ; fi\n", "delta": "0:00:00.148205", "end": "2019-12-05 07:26:05.391436", "item": [{"bridge_name": "t3br1", "default_route_ip": "10.2.21.1", "dns": [{"brif": [], "dhcp_end": [], "dhcp_start": [], "dnsif": [], "dnsif_ip": [], "net_mask": []}], "ns_name": "t3ns1", "route": [{"if": "p1", "ip": "10.2.21.1/24", "ns_if": "t3if", "ns_name": "t3"}], "subnet_ip": "1.1.1.0/24", "vms": [{"brif": "t3br1if1", "disk": "10G", "mem": 2, "name": "t3_VM4", "vcpu": 4, "vmif": "t3VM4if1"}], "vxlan": [{"dev": "t3s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.21.2", "remote_ip": "10.1.21.2", "remote_route": "10.1.21.0/24", "subnet_route": "10.2.21.0/24", "tenant_route_ip": "192.168.131.2", "v_name": "vxlan_t3s1"}]}, {"tenant_ns_if": "t3ns1if", "tenant_ns_ip": "10.2.21.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s1if", "tenant_sub_ip": "10.2.21.2/24"}], "rc": 0, "start": "2019-12-05 07:26:05.243231", "stderr": "Device \"t3ns1if\" does not exist.\nDevice \"t3s1if\" does not exist.", "stderr_lines": ["Device \"t3ns1if\" does not exist.", "Device \"t3s1if\" does not exist."], "stdout": "", "stdout_lines": []}
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.22.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.2.22.1', u'bridge_name': u't3br2', u'dns': [{u'dnsif': u't3s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't3s2_dnsbrif'}], u'ns_name': u't3ns2', u'subnet_ip': u'2.2.2.0/24', u'vms': [{u'mem': 3, u'name': u't3_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't3br2if1', u'vmif': u't3VM3if1'}], u'vxlan': [{u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}, {u'tenant_sub_ip': u'10.2.22.2/24', u'tenant_ns_ip': u'10.2.22.1/24', u'tenant_ns_if': u't3ns2if', u'tenant_sub_if': u't3s2if', u'tenant_ns_name': u't3'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t3\" ip link show \"t3ns2if\" ; if [ $? -ne 0 ] ; then ip link set \"t3ns2if\" netns \"t3\" ; fi\nip netns exec \"t3ns2\" ip link show \"t3s2if\" ; if [ $? -ne 0 ] ; then ip link set \"t3s2if\" netns \"t3ns2\" ; fi\n", "delta": "0:00:00.148168", "end": "2019-12-05 07:26:05.876845", "item": [{"bridge_name": "t3br2", "default_route_ip": "10.2.22.1", "dns": [{"brif": "t3s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t3s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t3ns2", "route": [{"if": "p1", "ip": "10.2.22.1/24", "ns_if": "t3if", "ns_name": "t3"}], "subnet_ip": "2.2.2.0/24", "vms": [{"brif": "t3br2if1", "disk": "10G", "mem": 3, "name": "t3_VM3", "vcpu": 2, "vmif": "t3VM3if1"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, {"tenant_ns_if": "t3ns2if", "tenant_ns_ip": "10.2.22.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s2if", "tenant_sub_ip": "10.2.22.2/24"}], "rc": 0, "start": "2019-12-05 07:26:05.728677", "stderr": "Device \"t3ns2if\" does not exist.\nDevice \"t3s2if\" does not exist.", "stderr_lines": ["Device \"t3ns2if\" does not exist.", "Device \"t3s2if\" does not exist."], "stdout": "", "stdout_lines": []}

TASK [Set Namespace VETH Pairs UP] **************************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.21.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.2.21.1', u'bridge_name': u't3br1', u'dns': [{u'dnsif': [], u'dhcp_start': [], u'dhcp_end': [], u'dnsif_ip': [], u'net_mask': [], u'brif': []}], u'ns_name': u't3ns1', u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't3_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't3br1if1', u'vmif': u't3VM4if1'}], u'vxlan': [{u'local_ip': u'10.2.21.2', u'dsport': 4789, u'dev': u't3s1if', u'tenant_route_ip': u'192.168.131.2', u'remote_route': u'10.1.21.0/24', u'subnet_route': u'10.2.21.0/24', u'v_name': u'vxlan_t3s1', u'id': 42, u'remote_ip': u'10.1.21.2'}]}, {u'tenant_sub_ip': u'10.2.21.2/24', u'tenant_ns_ip': u'10.2.21.1/24', u'tenant_ns_if': u't3ns1if', u'tenant_sub_if': u't3s1if', u'tenant_ns_name': u't3'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t3\" ip link set dev \"t3ns1if\" up\nip netns exec \"t3ns1\" ip link set dev \"t3s1if\" up\n", "delta": "0:00:00.087019", "end": "2019-12-05 07:26:06.392570", "item": [{"bridge_name": "t3br1", "default_route_ip": "10.2.21.1", "dns": [{"brif": [], "dhcp_end": [], "dhcp_start": [], "dnsif": [], "dnsif_ip": [], "net_mask": []}], "ns_name": "t3ns1", "route": [{"if": "p1", "ip": "10.2.21.1/24", "ns_if": "t3if", "ns_name": "t3"}], "subnet_ip": "1.1.1.0/24", "vms": [{"brif": "t3br1if1", "disk": "10G", "mem": 2, "name": "t3_VM4", "vcpu": 4, "vmif": "t3VM4if1"}], "vxlan": [{"dev": "t3s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.21.2", "remote_ip": "10.1.21.2", "remote_route": "10.1.21.0/24", "subnet_route": "10.2.21.0/24", "tenant_route_ip": "192.168.131.2", "v_name": "vxlan_t3s1"}]}, {"tenant_ns_if": "t3ns1if", "tenant_ns_ip": "10.2.21.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s1if", "tenant_sub_ip": "10.2.21.2/24"}], "rc": 0, "start": "2019-12-05 07:26:06.305551", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.22.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.2.22.1', u'bridge_name': u't3br2', u'dns': [{u'dnsif': u't3s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't3s2_dnsbrif'}], u'ns_name': u't3ns2', u'subnet_ip': u'2.2.2.0/24', u'vms': [{u'mem': 3, u'name': u't3_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't3br2if1', u'vmif': u't3VM3if1'}], u'vxlan': [{u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}, {u'tenant_sub_ip': u'10.2.22.2/24', u'tenant_ns_ip': u'10.2.22.1/24', u'tenant_ns_if': u't3ns2if', u'tenant_sub_if': u't3s2if', u'tenant_ns_name': u't3'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t3\" ip link set dev \"t3ns2if\" up\nip netns exec \"t3ns2\" ip link set dev \"t3s2if\" up\n", "delta": "0:00:00.068953", "end": "2019-12-05 07:26:06.808481", "item": [{"bridge_name": "t3br2", "default_route_ip": "10.2.22.1", "dns": [{"brif": "t3s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t3s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t3ns2", "route": [{"if": "p1", "ip": "10.2.22.1/24", "ns_if": "t3if", "ns_name": "t3"}], "subnet_ip": "2.2.2.0/24", "vms": [{"brif": "t3br2if1", "disk": "10G", "mem": 3, "name": "t3_VM3", "vcpu": 2, "vmif": "t3VM3if1"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, {"tenant_ns_if": "t3ns2if", "tenant_ns_ip": "10.2.22.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s2if", "tenant_sub_ip": "10.2.22.2/24"}], "rc": 0, "start": "2019-12-05 07:26:06.739528", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Add IP addresses to Namespace VETH Pairs] *************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.21.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.2.21.1', u'bridge_name': u't3br1', u'dns': [{u'dnsif': [], u'dhcp_start': [], u'dhcp_end': [], u'dnsif_ip': [], u'net_mask': [], u'brif': []}], u'ns_name': u't3ns1', u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't3_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't3br1if1', u'vmif': u't3VM4if1'}], u'vxlan': [{u'local_ip': u'10.2.21.2', u'dsport': 4789, u'dev': u't3s1if', u'tenant_route_ip': u'192.168.131.2', u'remote_route': u'10.1.21.0/24', u'subnet_route': u'10.2.21.0/24', u'v_name': u'vxlan_t3s1', u'id': 42, u'remote_ip': u'10.1.21.2'}]}, {u'tenant_sub_ip': u'10.2.21.2/24', u'tenant_ns_ip': u'10.2.21.1/24', u'tenant_ns_if': u't3ns1if', u'tenant_sub_if': u't3s1if', u'tenant_ns_name': u't3'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t3ns1\" ip addr show \"t3s1if\" | awk 'FNR==3{ print $2 }' | grep -w '^10.2.21.2/24' ; if [ $? -ne 0 ] ; then ip netns exec \"t3ns1\" ip addr add \"10.2.21.2/24\" dev \"t3s1if\" ; fi\n\nip netns exec \"t3\" ip addr show \"t3ns1if\" | awk 'FNR==3{ print $2 }' | grep -w '^10.2.21.1/24' ; if [ $? -ne 0 ] ; then ip netns exec \"t3\" ip addr add \"10.2.21.1/24\" dev \"t3ns1if\" ; fi\n", "delta": "0:00:00.154425", "end": "2019-12-05 07:26:07.344527", "item": [{"bridge_name": "t3br1", "default_route_ip": "10.2.21.1", "dns": [{"brif": [], "dhcp_end": [], "dhcp_start": [], "dnsif": [], "dnsif_ip": [], "net_mask": []}], "ns_name": "t3ns1", "route": [{"if": "p1", "ip": "10.2.21.1/24", "ns_if": "t3if", "ns_name": "t3"}], "subnet_ip": "1.1.1.0/24", "vms": [{"brif": "t3br1if1", "disk": "10G", "mem": 2, "name": "t3_VM4", "vcpu": 4, "vmif": "t3VM4if1"}], "vxlan": [{"dev": "t3s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.21.2", "remote_ip": "10.1.21.2", "remote_route": "10.1.21.0/24", "subnet_route": "10.2.21.0/24", "tenant_route_ip": "192.168.131.2", "v_name": "vxlan_t3s1"}]}, {"tenant_ns_if": "t3ns1if", "tenant_ns_ip": "10.2.21.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s1if", "tenant_sub_ip": "10.2.21.2/24"}], "rc": 0, "start": "2019-12-05 07:26:07.190102", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.22.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.2.22.1', u'bridge_name': u't3br2', u'dns': [{u'dnsif': u't3s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't3s2_dnsbrif'}], u'ns_name': u't3ns2', u'subnet_ip': u'2.2.2.0/24', u'vms': [{u'mem': 3, u'name': u't3_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't3br2if1', u'vmif': u't3VM3if1'}], u'vxlan': [{u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}, {u'tenant_sub_ip': u'10.2.22.2/24', u'tenant_ns_ip': u'10.2.22.1/24', u'tenant_ns_if': u't3ns2if', u'tenant_sub_if': u't3s2if', u'tenant_ns_name': u't3'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t3ns2\" ip addr show \"t3s2if\" | awk 'FNR==3{ print $2 }' | grep -w '^10.2.22.2/24' ; if [ $? -ne 0 ] ; then ip netns exec \"t3ns2\" ip addr add \"10.2.22.2/24\" dev \"t3s2if\" ; fi\n\nip netns exec \"t3\" ip addr show \"t3ns2if\" | awk 'FNR==3{ print $2 }' | grep -w '^10.2.22.1/24' ; if [ $? -ne 0 ] ; then ip netns exec \"t3\" ip addr add \"10.2.22.1/24\" dev \"t3ns2if\" ; fi\n", "delta": "0:00:00.144490", "end": "2019-12-05 07:26:07.840439", "item": [{"bridge_name": "t3br2", "default_route_ip": "10.2.22.1", "dns": [{"brif": "t3s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t3s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t3ns2", "route": [{"if": "p1", "ip": "10.2.22.1/24", "ns_if": "t3if", "ns_name": "t3"}], "subnet_ip": "2.2.2.0/24", "vms": [{"brif": "t3br2if1", "disk": "10G", "mem": 3, "name": "t3_VM3", "vcpu": 2, "vmif": "t3VM3if1"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, {"tenant_ns_if": "t3ns2if", "tenant_ns_ip": "10.2.22.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s2if", "tenant_sub_ip": "10.2.22.2/24"}], "rc": 0, "start": "2019-12-05 07:26:07.695949", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Add IP Route to Tenant] *******************************************************************************************************************************
changed: [99.99.99.2] => (item={u'default_route_ip': u'192.168.131.1', u'name': u't3', u'pns_ip': u'192.168.131.1/24', u'tenant_if': u't3if', u'tenant_ip': u'192.168.131.2/24', u'pns_if': u't3pns_if'}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t3\" ip route show default | grep -w '[d]efault via 192.168.131.1' ; if [ $? -ne 0 ] ; then ip netns exec \"t3\" ip route add default via \"192.168.131.1\" ; fi\n", "delta": "0:00:00.079288", "end": "2019-12-05 07:26:08.308479", "item": {"default_route_ip": "192.168.131.1", "name": "t3", "pns_if": "t3pns_if", "pns_ip": "192.168.131.1/24", "tenant_if": "t3if", "tenant_ip": "192.168.131.2/24"}, "rc": 0, "start": "2019-12-05 07:26:08.229191", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Add IP Route to Tenant Subnet] ************************************************************************************************************************
changed: [99.99.99.2] => (item={u'route': [{u'ip': u'10.2.21.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.2.21.1', u'bridge_name': u't3br1', u'dns': [{u'dnsif': [], u'dhcp_start': [], u'dhcp_end': [], u'dnsif_ip': [], u'net_mask': [], u'brif': []}], u'ns_name': u't3ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.21.2/24', u'tenant_ns_ip': u'10.2.21.1/24', u'tenant_ns_if': u't3ns1if', u'tenant_ns_name': u't3', u'tenant_sub_if': u't3s1if'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't3_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't3br1if1', u'vmif': u't3VM4if1'}], u'vxlan': [{u'local_ip': u'10.2.21.2', u'tenant_route_ip': u'192.168.131.2', u'dsport': 4789, u'dev': u't3s1if', u'subnet_route': u'10.2.21.0/24', u'remote_route': u'10.1.21.0/24', u'v_name': u'vxlan_t3s1', u'id': 42, u'remote_ip': u'10.1.21.2'}]}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t3ns1\" ip route show default | grep -w '[d]efault via 10.2.21.1' ; if [ $? -ne 0 ] ; then ip netns exec \"t3ns1\" ip route add default via \"10.2.21.1\" ; fi\n", "delta": "0:00:00.067733", "end": "2019-12-05 07:26:08.776439", "item": {"bridge_name": "t3br1", "default_route_ip": "10.2.21.1", "dns": [{"brif": [], "dhcp_end": [], "dhcp_start": [], "dnsif": [], "dnsif_ip": [], "net_mask": []}], "ns_name": "t3ns1", "route": [{"if": "p1", "ip": "10.2.21.1/24", "ns_if": "t3if", "ns_name": "t3"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t3ns1if", "tenant_ns_ip": "10.2.21.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s1if", "tenant_sub_ip": "10.2.21.2/24"}], "vms": [{"brif": "t3br1if1", "disk": "10G", "mem": 2, "name": "t3_VM4", "vcpu": 4, "vmif": "t3VM4if1"}], "vxlan": [{"dev": "t3s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.21.2", "remote_ip": "10.1.21.2", "remote_route": "10.1.21.0/24", "subnet_route": "10.2.21.0/24", "tenant_route_ip": "192.168.131.2", "v_name": "vxlan_t3s1"}]}, "rc": 0, "start": "2019-12-05 07:26:08.708706", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}
changed: [99.99.99.2] => (item={u'route': [{u'ip': u'10.2.22.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.2.22.1', u'bridge_name': u't3br2', u'dns': [{u'dnsif': u't3s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't3s2_dnsbrif'}], u'ns_name': u't3ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.22.2/24', u'tenant_ns_ip': u'10.2.22.1/24', u'tenant_ns_if': u't3ns2if', u'tenant_ns_name': u't3', u'tenant_sub_if': u't3s2if'}], u'subnet_ip': u'2.2.2.0/24', u'vms': [{u'mem': 3, u'name': u't3_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't3br2if1', u'vmif': u't3VM3if1'}], u'vxlan': [{u'local_ip': [], u'tenant_route_ip': [], u'dsport': [], u'dev': [], u'subnet_route': [], u'remote_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t3ns2\" ip route show default | grep -w '[d]efault via 10.2.22.1' ; if [ $? -ne 0 ] ; then ip netns exec \"t3ns2\" ip route add default via \"10.2.22.1\" ; fi\n", "delta": "0:00:00.070696", "end": "2019-12-05 07:26:09.212484", "item": {"bridge_name": "t3br2", "default_route_ip": "10.2.22.1", "dns": [{"brif": "t3s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t3s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t3ns2", "route": [{"if": "p1", "ip": "10.2.22.1/24", "ns_if": "t3if", "ns_name": "t3"}], "subnet_ip": "2.2.2.0/24", "tenant_ns": [{"tenant_ns_if": "t3ns2if", "tenant_ns_ip": "10.2.22.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s2if", "tenant_sub_ip": "10.2.22.2/24"}], "vms": [{"brif": "t3br2if1", "disk": "10G", "mem": 3, "name": "t3_VM3", "vcpu": 2, "vmif": "t3VM3if1"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, "rc": 0, "start": "2019-12-05 07:26:09.141788", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Create bridge inside namespace] ***********************************************************************************************************************
changed: [99.99.99.2] => (item={u'route': [{u'ip': u'10.2.21.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.2.21.1', u'bridge_name': u't3br1', u'dns': [{u'dnsif': [], u'dhcp_start': [], u'dhcp_end': [], u'dnsif_ip': [], u'net_mask': [], u'brif': []}], u'ns_name': u't3ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.21.2/24', u'tenant_ns_ip': u'10.2.21.1/24', u'tenant_ns_if': u't3ns1if', u'tenant_ns_name': u't3', u'tenant_sub_if': u't3s1if'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't3_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't3br1if1', u'vmif': u't3VM4if1'}], u'vxlan': [{u'local_ip': u'10.2.21.2', u'tenant_route_ip': u'192.168.131.2', u'dsport': 4789, u'dev': u't3s1if', u'subnet_route': u'10.2.21.0/24', u'remote_route': u'10.1.21.0/24', u'v_name': u'vxlan_t3s1', u'id': 42, u'remote_ip': u'10.1.21.2'}]}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t3ns1\" brctl show | grep -w '^t3br1'; if [ $? -ne 0 ] ; then ip netns exec \"t3ns1\" brctl addbr \"t3br1\" ; fi\nip netns exec \"t3ns1\" ip link set dev \"t3br1\" up\n", "delta": "0:00:00.109198", "end": "2019-12-05 07:26:09.708488", "item": {"bridge_name": "t3br1", "default_route_ip": "10.2.21.1", "dns": [{"brif": [], "dhcp_end": [], "dhcp_start": [], "dnsif": [], "dnsif_ip": [], "net_mask": []}], "ns_name": "t3ns1", "route": [{"if": "p1", "ip": "10.2.21.1/24", "ns_if": "t3if", "ns_name": "t3"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t3ns1if", "tenant_ns_ip": "10.2.21.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s1if", "tenant_sub_ip": "10.2.21.2/24"}], "vms": [{"brif": "t3br1if1", "disk": "10G", "mem": 2, "name": "t3_VM4", "vcpu": 4, "vmif": "t3VM4if1"}], "vxlan": [{"dev": "t3s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.21.2", "remote_ip": "10.1.21.2", "remote_route": "10.1.21.0/24", "subnet_route": "10.2.21.0/24", "tenant_route_ip": "192.168.131.2", "v_name": "vxlan_t3s1"}]}, "rc": 0, "start": "2019-12-05 07:26:09.599290", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}
changed: [99.99.99.2] => (item={u'route': [{u'ip': u'10.2.22.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.2.22.1', u'bridge_name': u't3br2', u'dns': [{u'dnsif': u't3s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't3s2_dnsbrif'}], u'ns_name': u't3ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.22.2/24', u'tenant_ns_ip': u'10.2.22.1/24', u'tenant_ns_if': u't3ns2if', u'tenant_ns_name': u't3', u'tenant_sub_if': u't3s2if'}], u'subnet_ip': u'2.2.2.0/24', u'vms': [{u'mem': 3, u'name': u't3_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't3br2if1', u'vmif': u't3VM3if1'}], u'vxlan': [{u'local_ip': [], u'tenant_route_ip': [], u'dsport': [], u'dev': [], u'subnet_route': [], u'remote_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t3ns2\" brctl show | grep -w '^t3br2'; if [ $? -ne 0 ] ; then ip netns exec \"t3ns2\" brctl addbr \"t3br2\" ; fi\nip netns exec \"t3ns2\" ip link set dev \"t3br2\" up\n", "delta": "0:00:00.119857", "end": "2019-12-05 07:26:10.148647", "item": {"bridge_name": "t3br2", "default_route_ip": "10.2.22.1", "dns": [{"brif": "t3s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t3s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t3ns2", "route": [{"if": "p1", "ip": "10.2.22.1/24", "ns_if": "t3if", "ns_name": "t3"}], "subnet_ip": "2.2.2.0/24", "tenant_ns": [{"tenant_ns_if": "t3ns2if", "tenant_ns_ip": "10.2.22.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s2if", "tenant_sub_ip": "10.2.22.2/24"}], "vms": [{"brif": "t3br2if1", "disk": "10G", "mem": 3, "name": "t3_VM3", "vcpu": 2, "vmif": "t3VM3if1"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, "rc": 0, "start": "2019-12-05 07:26:10.028790", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Create DNS VETH Pair] *********************************************************************************************************************************
failed: [99.99.99.2] (item=[{u'route': [{u'ip': u'10.2.21.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.2.21.1', u'bridge_name': u't3br1', u'ns_name': u't3ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.21.2/24', u'tenant_ns_ip': u'10.2.21.1/24', u'tenant_ns_if': u't3ns1if', u'tenant_sub_if': u't3s1if', u'tenant_ns_name': u't3'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't3_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't3br1if1', u'vmif': u't3VM4if1'}], u'vxlan': [{u'local_ip': u'10.2.21.2', u'dsport': 4789, u'dev': u't3s1if', u'tenant_route_ip': u'192.168.131.2', u'remote_route': u'10.1.21.0/24', u'subnet_route': u'10.2.21.0/24', u'v_name': u'vxlan_t3s1', u'id': 42, u'remote_ip': u'10.1.21.2'}]}, {u'dnsif': [], u'dhcp_start': [], u'dhcp_end': [], u'dnsif_ip': [], u'net_mask': [], u'brif': []}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t3ns1\" ip link show \"[]\" ; if [ $? -ne 0 ] ; then ip netns exec \"t3ns1\" ip link add \"[]\" type veth peer name \"[]\" ; fi\nip netns exec \"t3ns1\" ip link set dev \"[]\" up\nip netns exec \"t3ns1\" ip link set dev \"[]\" up\n", "delta": "0:00:00.199480", "end": "2019-12-05 07:26:10.760489", "item": [{"bridge_name": "t3br1", "default_route_ip": "10.2.21.1", "ns_name": "t3ns1", "route": [{"if": "p1", "ip": "10.2.21.1/24", "ns_if": "t3if", "ns_name": "t3"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t3ns1if", "tenant_ns_ip": "10.2.21.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s1if", "tenant_sub_ip": "10.2.21.2/24"}], "vms": [{"brif": "t3br1if1", "disk": "10G", "mem": 2, "name": "t3_VM4", "vcpu": 4, "vmif": "t3VM4if1"}], "vxlan": [{"dev": "t3s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.21.2", "remote_ip": "10.1.21.2", "remote_route": "10.1.21.0/24", "subnet_route": "10.2.21.0/24", "tenant_route_ip": "192.168.131.2", "v_name": "vxlan_t3s1"}]}, {"brif": [], "dhcp_end": [], "dhcp_start": [], "dnsif": [], "dnsif_ip": [], "net_mask": []}], "msg": "non-zero return code", "rc": 1, "start": "2019-12-05 07:26:10.561009", "stderr": "Device \"[]\" does not exist.\nRTNETLINK answers: File exists\nCannot find device \"[]\"\nCannot find device \"[]\"", "stderr_lines": ["Device \"[]\" does not exist.", "RTNETLINK answers: File exists", "Cannot find device \"[]\"", "Cannot find device \"[]\""], "stdout": "", "stdout_lines": []}
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.22.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.2.22.1', u'bridge_name': u't3br2', u'ns_name': u't3ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.22.2/24', u'tenant_ns_ip': u'10.2.22.1/24', u'tenant_ns_if': u't3ns2if', u'tenant_sub_if': u't3s2if', u'tenant_ns_name': u't3'}], u'subnet_ip': u'2.2.2.0/24', u'vms': [{u'mem': 3, u'name': u't3_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't3br2if1', u'vmif': u't3VM3if1'}], u'vxlan': [{u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}, {u'dnsif': u't3s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't3s2_dnsbrif'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t3ns2\" ip link show \"t3s2_dnsbrif\" ; if [ $? -ne 0 ] ; then ip netns exec \"t3ns2\" ip link add \"t3s2_dnsbrif\" type veth peer name \"t3s2_dnsif\" ; fi\nip netns exec \"t3ns2\" ip link set dev \"t3s2_dnsbrif\" up\nip netns exec \"t3ns2\" ip link set dev \"t3s2_dnsif\" up\n", "delta": "0:00:00.172321", "end": "2019-12-05 07:26:11.272479", "item": [{"bridge_name": "t3br2", "default_route_ip": "10.2.22.1", "ns_name": "t3ns2", "route": [{"if": "p1", "ip": "10.2.22.1/24", "ns_if": "t3if", "ns_name": "t3"}], "subnet_ip": "2.2.2.0/24", "tenant_ns": [{"tenant_ns_if": "t3ns2if", "tenant_ns_ip": "10.2.22.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s2if", "tenant_sub_ip": "10.2.22.2/24"}], "vms": [{"brif": "t3br2if1", "disk": "10G", "mem": 3, "name": "t3_VM3", "vcpu": 2, "vmif": "t3VM3if1"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, {"brif": "t3s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t3s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "rc": 0, "start": "2019-12-05 07:26:11.100158", "stderr": "Device \"t3s2_dnsbrif\" does not exist.", "stderr_lines": ["Device \"t3s2_dnsbrif\" does not exist."], "stdout": "", "stdout_lines": []}

PLAY RECAP **************************************************************************************************************************************************
99.99.99.2                 : ok=12   changed=12   unreachable=0    failed=1    skipped=0    rescued=0    ignored=0   

INFO:root: 07:40:44.613455 Printing the yaml input file
INFO:root: 07:40:44.613589 {'C1': [{'subnet_addr': '1.1.1.0/24', 'VM': [{'name': 'VM1', 'disk': '10G', 'mem': 2, 'vcpu': 4, 'internet_access': True}, {'name': 'VM2', 'disk': '10G', 'mem': 4, 'vcpu': 2, 'internet_access': False}]}], 'C2': [{'subnet_addr': '1.1.1.0/24', 'VM': [{'name': 'VM4', 'disk': '10G', 'mem': 2, 'vcpu': 4, 'internet_access': True}]}, {'subnet_addr': '2.2.2.0/24', 'VM': [{'name': 'VM3', 'disk': '10G', 'mem': 3, 'vcpu': 2, 'internet_access': True}]}], 'MISC': [{'LOG_ENABLE': True}, {'GUI': True}]}
INFO:root: 07:40:44.613690 Provided subnet in C1: 1.1.1.0/24 is valid
INFO:root: 07:40:44.613740 Provided subnet in C2: 1.1.1.0/24 is valid
INFO:root: 07:40:44.613782 Provided subnet in C2: 2.2.2.0/24 is valid
Using /etc/ansible/ansible.cfg as config file

PLAY [main] *************************************************************************************************************************************************

TASK [Create Tenant Namespace] ******************************************************************************************************************************
ok: [localhost] => (item={u'default_route_ip': u'192.168.1.1', u'name': u't11', u'pns_ip': u'192.168.1.1/24', u'tenant_if': u't11if', u'tenant_ip': u'192.168.1.2/24', u'pns_if': u't11pns_if'}) => {"ansible_loop_var": "item", "changed": false, "cmd": ["ip", "netns", "add", "t11"], "item": {"default_route_ip": "192.168.1.1", "name": "t11", "pns_if": "t11pns_if", "pns_ip": "192.168.1.1/24", "tenant_if": "t11if", "tenant_ip": "192.168.1.2/24"}, "rc": 0, "stdout": "skipped, since /var/run/netns/t11 exists", "stdout_lines": ["skipped, since /var/run/netns/t11 exists"]}

TASK [Create Subnet Namespace] ******************************************************************************************************************************
ok: [localhost] => (item={u'route': [{u'ip': u'10.1.1.1/24', u'ns_name': u't11', u'ns_if': u't11if', u'if': u'p1'}], u'default_route_ip': u'10.1.1.1', u'bridge_name': u't11br1', u'dns': [{u'dnsif': u't11s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't11s1_dnsbrif'}], u'ns_name': u't11ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.1.2/24', u'tenant_ns_ip': u'10.1.1.1/24', u'tenant_ns_if': u't11ns1if', u'tenant_ns_name': u't11', u'tenant_sub_if': u't11s1if'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't11_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't11br1if1', u'vmif': u't11VM1if1'}, {u'mem': 4, u'name': u't11_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't11br1if2', u'vmif': u't11VM2if1'}], u'vxlan': [{u'local_ip': u'10.1.1.2', u'tenant_route_ip': u'192.168.1.2', u'dsport': 4789, u'dev': u't11s1if', u'subnet_route': u'10.1.1.0/24', u'remote_route': u'10.2.1.0/24', u'v_name': u'vxlan_t11s1', u'id': 42, u'remote_ip': u'10.2.1.2'}]}) => {"ansible_loop_var": "item", "changed": false, "cmd": ["ip", "netns", "add", "t11ns1"], "item": {"bridge_name": "t11br1", "default_route_ip": "10.1.1.1", "dns": [{"brif": "t11s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.5", "dnsif": "t11s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t11ns1", "route": [{"if": "p1", "ip": "10.1.1.1/24", "ns_if": "t11if", "ns_name": "t11"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t11ns1if", "tenant_ns_ip": "10.1.1.1/24", "tenant_ns_name": "t11", "tenant_sub_if": "t11s1if", "tenant_sub_ip": "10.1.1.2/24"}], "vms": [{"brif": "t11br1if1", "disk": "10G", "mem": 2, "name": "t11_VM1", "vcpu": 4, "vmif": "t11VM1if1"}, {"brif": "t11br1if2", "disk": "10G", "mem": 4, "name": "t11_VM2", "vcpu": 2, "vmif": "t11VM2if1"}], "vxlan": [{"dev": "t11s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.1.2", "remote_ip": "10.2.1.2", "remote_route": "10.2.1.0/24", "subnet_route": "10.1.1.0/24", "tenant_route_ip": "192.168.1.2", "v_name": "vxlan_t11s1"}]}, "rc": 0, "stdout": "skipped, since /var/run/netns/t11ns1 exists", "stdout_lines": ["skipped, since /var/run/netns/t11ns1 exists"]}

TASK [Create Tenant VETH pairs] *****************************************************************************************************************************
changed: [localhost] => (item={u'default_route_ip': u'192.168.1.1', u'name': u't11', u'pns_ip': u'192.168.1.1/24', u'tenant_if': u't11if', u'tenant_ip': u'192.168.1.2/24', u'pns_if': u't11pns_if'}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip link show \"t11if\" ; if [ $? -ne 0 ] ; then ip link add \"t11if\" type veth peer name \"t11pns_if\" ; fi\n", "delta": "0:00:00.015476", "end": "2019-12-05 07:40:46.338326", "item": {"default_route_ip": "192.168.1.1", "name": "t11", "pns_if": "t11pns_if", "pns_ip": "192.168.1.1/24", "tenant_if": "t11if", "tenant_ip": "192.168.1.2/24"}, "rc": 0, "start": "2019-12-05 07:40:46.322850", "stderr": "Device \"t11if\" does not exist.", "stderr_lines": ["Device \"t11if\" does not exist."], "stdout": "", "stdout_lines": []}

TASK [Attach Tenant VETH Pairs] *****************************************************************************************************************************
changed: [localhost] => (item={u'default_route_ip': u'192.168.1.1', u'name': u't11', u'pns_ip': u'192.168.1.1/24', u'tenant_if': u't11if', u'tenant_ip': u'192.168.1.2/24', u'pns_if': u't11pns_if'}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec pns ip link show \"t11pns_if\" ; if [ $? -ne 0 ] ; then ip link set \"t11pns_if\" netns pns ; fi\nip netns exec \"t11\" ip link show \"t11if\" ; if [ $? -ne 0 ] ; then ip link set \"t11if\" netns \"t11\" ; fi\nip netns exec pns ip link set dev \"t11pns_if\" up\nip netns exec \"t11\" ip link set dev \"t11if\" up\n", "delta": "0:00:00.149946", "end": "2019-12-05 07:40:46.757338", "item": {"default_route_ip": "192.168.1.1", "name": "t11", "pns_if": "t11pns_if", "pns_ip": "192.168.1.1/24", "tenant_if": "t11if", "tenant_ip": "192.168.1.2/24"}, "rc": 0, "start": "2019-12-05 07:40:46.607392", "stderr": "", "stderr_lines": [], "stdout": "75: t11pns_if@if76: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP mode DEFAULT group default qlen 1000\n    link/ether 0a:27:bd:88:50:51 brd ff:ff:ff:ff:ff:ff link-netnsid 6\n76: t11if@if75: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP mode DEFAULT group default qlen 1000\n    link/ether 86:b2:52:fe:48:af brd ff:ff:ff:ff:ff:ff link-netnsid 0", "stdout_lines": ["75: t11pns_if@if76: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP mode DEFAULT group default qlen 1000", "    link/ether 0a:27:bd:88:50:51 brd ff:ff:ff:ff:ff:ff link-netnsid 6", "76: t11if@if75: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP mode DEFAULT group default qlen 1000", "    link/ether 86:b2:52:fe:48:af brd ff:ff:ff:ff:ff:ff link-netnsid 0"]}

TASK [Add IP addresses to Tenant VETH Pairs] ****************************************************************************************************************
changed: [localhost] => (item={u'default_route_ip': u'192.168.1.1', u'name': u't11', u'pns_ip': u'192.168.1.1/24', u'tenant_if': u't11if', u'tenant_ip': u'192.168.1.2/24', u'pns_if': u't11pns_if'}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec pns ip addr show \"t11pns_if\" | awk 'FNR==3{ print $2 }' | grep -w '^192.168.1.1/24' ; if [ $? -ne 0 ] ; then ip netns exec pns ip addr add \"192.168.1.1/24\" dev \"t11pns_if\" ; fi\nip netns exec \"t11\" ip addr show \"t11if\" | awk 'FNR==3{ print $2 }' | grep -w '^192.168.1.2/24' ; if [ $? -ne 0 ] ; then ip netns exec \"t11\" ip addr add \"192.168.1.2/24\" dev \"t11if\" ; fi\n", "delta": "0:00:00.074312", "end": "2019-12-05 07:40:47.113270", "item": {"default_route_ip": "192.168.1.1", "name": "t11", "pns_if": "t11pns_if", "pns_ip": "192.168.1.1/24", "tenant_if": "t11if", "tenant_ip": "192.168.1.2/24"}, "rc": 0, "start": "2019-12-05 07:40:47.038958", "stderr": "", "stderr_lines": [], "stdout": "192.168.1.1/24\n192.168.1.2/24", "stdout_lines": ["192.168.1.1/24", "192.168.1.2/24"]}

TASK [Create Namespace VETH Pairs] **************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.1.1/24', u'ns_name': u't11', u'ns_if': u't11if', u'if': u'p1'}], u'default_route_ip': u'10.1.1.1', u'bridge_name': u't11br1', u'dns': [{u'dnsif': u't11s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't11s1_dnsbrif'}], u'ns_name': u't11ns1', u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't11_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't11br1if1', u'vmif': u't11VM1if1'}, {u'mem': 4, u'name': u't11_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't11br1if2', u'vmif': u't11VM2if1'}], u'vxlan': [{u'local_ip': u'10.1.1.2', u'dsport': 4789, u'dev': u't11s1if', u'tenant_route_ip': u'192.168.1.2', u'remote_route': u'10.2.1.0/24', u'subnet_route': u'10.1.1.0/24', u'v_name': u'vxlan_t11s1', u'id': 42, u'remote_ip': u'10.2.1.2'}]}, {u'tenant_sub_ip': u'10.1.1.2/24', u'tenant_ns_ip': u'10.1.1.1/24', u'tenant_ns_if': u't11ns1if', u'tenant_sub_if': u't11s1if', u'tenant_ns_name': u't11'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip link show \"t11ns1if\" ; if [ $? -ne 0 ] ; then ip link add \"t11ns1if\" type veth peer name \"t11s1if\" ; fi\n", "delta": "0:00:00.012426", "end": "2019-12-05 07:40:47.393307", "item": [{"bridge_name": "t11br1", "default_route_ip": "10.1.1.1", "dns": [{"brif": "t11s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.5", "dnsif": "t11s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t11ns1", "route": [{"if": "p1", "ip": "10.1.1.1/24", "ns_if": "t11if", "ns_name": "t11"}], "subnet_ip": "1.1.1.0/24", "vms": [{"brif": "t11br1if1", "disk": "10G", "mem": 2, "name": "t11_VM1", "vcpu": 4, "vmif": "t11VM1if1"}, {"brif": "t11br1if2", "disk": "10G", "mem": 4, "name": "t11_VM2", "vcpu": 2, "vmif": "t11VM2if1"}], "vxlan": [{"dev": "t11s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.1.2", "remote_ip": "10.2.1.2", "remote_route": "10.2.1.0/24", "subnet_route": "10.1.1.0/24", "tenant_route_ip": "192.168.1.2", "v_name": "vxlan_t11s1"}]}, {"tenant_ns_if": "t11ns1if", "tenant_ns_ip": "10.1.1.1/24", "tenant_ns_name": "t11", "tenant_sub_if": "t11s1if", "tenant_sub_ip": "10.1.1.2/24"}], "rc": 0, "start": "2019-12-05 07:40:47.380881", "stderr": "Device \"t11ns1if\" does not exist.", "stderr_lines": ["Device \"t11ns1if\" does not exist."], "stdout": "", "stdout_lines": []}

TASK [Attach Namespace VETH Pairs] **************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.1.1/24', u'ns_name': u't11', u'ns_if': u't11if', u'if': u'p1'}], u'default_route_ip': u'10.1.1.1', u'bridge_name': u't11br1', u'dns': [{u'dnsif': u't11s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't11s1_dnsbrif'}], u'ns_name': u't11ns1', u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't11_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't11br1if1', u'vmif': u't11VM1if1'}, {u'mem': 4, u'name': u't11_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't11br1if2', u'vmif': u't11VM2if1'}], u'vxlan': [{u'local_ip': u'10.1.1.2', u'dsport': 4789, u'dev': u't11s1if', u'tenant_route_ip': u'192.168.1.2', u'remote_route': u'10.2.1.0/24', u'subnet_route': u'10.1.1.0/24', u'v_name': u'vxlan_t11s1', u'id': 42, u'remote_ip': u'10.2.1.2'}]}, {u'tenant_sub_ip': u'10.1.1.2/24', u'tenant_ns_ip': u'10.1.1.1/24', u'tenant_ns_if': u't11ns1if', u'tenant_sub_if': u't11s1if', u'tenant_ns_name': u't11'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t11\" ip link show \"t11ns1if\" ; if [ $? -ne 0 ] ; then ip link set \"t11ns1if\" netns \"t11\" ; fi\nip netns exec \"t11ns1\" ip link show \"t11s1if\" ; if [ $? -ne 0 ] ; then ip link set \"t11s1if\" netns \"t11ns1\" ; fi\n", "delta": "0:00:00.077414", "end": "2019-12-05 07:40:47.768991", "item": [{"bridge_name": "t11br1", "default_route_ip": "10.1.1.1", "dns": [{"brif": "t11s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.5", "dnsif": "t11s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t11ns1", "route": [{"if": "p1", "ip": "10.1.1.1/24", "ns_if": "t11if", "ns_name": "t11"}], "subnet_ip": "1.1.1.0/24", "vms": [{"brif": "t11br1if1", "disk": "10G", "mem": 2, "name": "t11_VM1", "vcpu": 4, "vmif": "t11VM1if1"}, {"brif": "t11br1if2", "disk": "10G", "mem": 4, "name": "t11_VM2", "vcpu": 2, "vmif": "t11VM2if1"}], "vxlan": [{"dev": "t11s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.1.2", "remote_ip": "10.2.1.2", "remote_route": "10.2.1.0/24", "subnet_route": "10.1.1.0/24", "tenant_route_ip": "192.168.1.2", "v_name": "vxlan_t11s1"}]}, {"tenant_ns_if": "t11ns1if", "tenant_ns_ip": "10.1.1.1/24", "tenant_ns_name": "t11", "tenant_sub_if": "t11s1if", "tenant_sub_ip": "10.1.1.2/24"}], "rc": 0, "start": "2019-12-05 07:40:47.691577", "stderr": "", "stderr_lines": [], "stdout": "78: t11ns1if@if77: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP mode DEFAULT group default qlen 1000\n    link/ether f6:a9:12:e7:36:93 brd ff:ff:ff:ff:ff:ff link-netnsid 2\n77: t11s1if@if78: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP mode DEFAULT group default qlen 1000\n    link/ether c2:10:06:f1:97:ea brd ff:ff:ff:ff:ff:ff link-netnsid 0", "stdout_lines": ["78: t11ns1if@if77: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP mode DEFAULT group default qlen 1000", "    link/ether f6:a9:12:e7:36:93 brd ff:ff:ff:ff:ff:ff link-netnsid 2", "77: t11s1if@if78: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP mode DEFAULT group default qlen 1000", "    link/ether c2:10:06:f1:97:ea brd ff:ff:ff:ff:ff:ff link-netnsid 0"]}

TASK [Set Namespace VETH Pairs UP] **************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.1.1/24', u'ns_name': u't11', u'ns_if': u't11if', u'if': u'p1'}], u'default_route_ip': u'10.1.1.1', u'bridge_name': u't11br1', u'dns': [{u'dnsif': u't11s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't11s1_dnsbrif'}], u'ns_name': u't11ns1', u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't11_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't11br1if1', u'vmif': u't11VM1if1'}, {u'mem': 4, u'name': u't11_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't11br1if2', u'vmif': u't11VM2if1'}], u'vxlan': [{u'local_ip': u'10.1.1.2', u'dsport': 4789, u'dev': u't11s1if', u'tenant_route_ip': u'192.168.1.2', u'remote_route': u'10.2.1.0/24', u'subnet_route': u'10.1.1.0/24', u'v_name': u'vxlan_t11s1', u'id': 42, u'remote_ip': u'10.2.1.2'}]}, {u'tenant_sub_ip': u'10.1.1.2/24', u'tenant_ns_ip': u'10.1.1.1/24', u'tenant_ns_if': u't11ns1if', u'tenant_sub_if': u't11s1if', u'tenant_ns_name': u't11'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t11\" ip link set dev \"t11ns1if\" up\nip netns exec \"t11ns1\" ip link set dev \"t11s1if\" up\n", "delta": "0:00:00.089060", "end": "2019-12-05 07:40:48.157123", "item": [{"bridge_name": "t11br1", "default_route_ip": "10.1.1.1", "dns": [{"brif": "t11s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.5", "dnsif": "t11s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t11ns1", "route": [{"if": "p1", "ip": "10.1.1.1/24", "ns_if": "t11if", "ns_name": "t11"}], "subnet_ip": "1.1.1.0/24", "vms": [{"brif": "t11br1if1", "disk": "10G", "mem": 2, "name": "t11_VM1", "vcpu": 4, "vmif": "t11VM1if1"}, {"brif": "t11br1if2", "disk": "10G", "mem": 4, "name": "t11_VM2", "vcpu": 2, "vmif": "t11VM2if1"}], "vxlan": [{"dev": "t11s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.1.2", "remote_ip": "10.2.1.2", "remote_route": "10.2.1.0/24", "subnet_route": "10.1.1.0/24", "tenant_route_ip": "192.168.1.2", "v_name": "vxlan_t11s1"}]}, {"tenant_ns_if": "t11ns1if", "tenant_ns_ip": "10.1.1.1/24", "tenant_ns_name": "t11", "tenant_sub_if": "t11s1if", "tenant_sub_ip": "10.1.1.2/24"}], "rc": 0, "start": "2019-12-05 07:40:48.068063", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Add IP addresses to Namespace VETH Pairs] *************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.1.1/24', u'ns_name': u't11', u'ns_if': u't11if', u'if': u'p1'}], u'default_route_ip': u'10.1.1.1', u'bridge_name': u't11br1', u'dns': [{u'dnsif': u't11s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't11s1_dnsbrif'}], u'ns_name': u't11ns1', u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't11_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't11br1if1', u'vmif': u't11VM1if1'}, {u'mem': 4, u'name': u't11_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't11br1if2', u'vmif': u't11VM2if1'}], u'vxlan': [{u'local_ip': u'10.1.1.2', u'dsport': 4789, u'dev': u't11s1if', u'tenant_route_ip': u'192.168.1.2', u'remote_route': u'10.2.1.0/24', u'subnet_route': u'10.1.1.0/24', u'v_name': u'vxlan_t11s1', u'id': 42, u'remote_ip': u'10.2.1.2'}]}, {u'tenant_sub_ip': u'10.1.1.2/24', u'tenant_ns_ip': u'10.1.1.1/24', u'tenant_ns_if': u't11ns1if', u'tenant_sub_if': u't11s1if', u'tenant_ns_name': u't11'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t11ns1\" ip addr show \"t11s1if\" | awk 'FNR==3{ print $2 }' | grep -w '^10.1.1.2/24' ; if [ $? -ne 0 ] ; then ip netns exec \"t11ns1\" ip addr add \"10.1.1.2/24\" dev \"t11s1if\" ; fi\n\nip netns exec \"t11\" ip addr show \"t11ns1if\" | awk 'FNR==3{ print $2 }' | grep -w '^10.1.1.1/24' ; if [ $? -ne 0 ] ; then ip netns exec \"t11\" ip addr add \"10.1.1.1/24\" dev \"t11ns1if\" ; fi\n", "delta": "0:00:00.066850", "end": "2019-12-05 07:40:48.505502", "item": [{"bridge_name": "t11br1", "default_route_ip": "10.1.1.1", "dns": [{"brif": "t11s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.5", "dnsif": "t11s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t11ns1", "route": [{"if": "p1", "ip": "10.1.1.1/24", "ns_if": "t11if", "ns_name": "t11"}], "subnet_ip": "1.1.1.0/24", "vms": [{"brif": "t11br1if1", "disk": "10G", "mem": 2, "name": "t11_VM1", "vcpu": 4, "vmif": "t11VM1if1"}, {"brif": "t11br1if2", "disk": "10G", "mem": 4, "name": "t11_VM2", "vcpu": 2, "vmif": "t11VM2if1"}], "vxlan": [{"dev": "t11s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.1.2", "remote_ip": "10.2.1.2", "remote_route": "10.2.1.0/24", "subnet_route": "10.1.1.0/24", "tenant_route_ip": "192.168.1.2", "v_name": "vxlan_t11s1"}]}, {"tenant_ns_if": "t11ns1if", "tenant_ns_ip": "10.1.1.1/24", "tenant_ns_name": "t11", "tenant_sub_if": "t11s1if", "tenant_sub_ip": "10.1.1.2/24"}], "rc": 0, "start": "2019-12-05 07:40:48.438652", "stderr": "", "stderr_lines": [], "stdout": "10.1.1.2/24\n10.1.1.1/24", "stdout_lines": ["10.1.1.2/24", "10.1.1.1/24"]}

TASK [Add IP Route to Tenant] *******************************************************************************************************************************
changed: [localhost] => (item={u'default_route_ip': u'192.168.1.1', u'name': u't11', u'pns_ip': u'192.168.1.1/24', u'tenant_if': u't11if', u'tenant_ip': u'192.168.1.2/24', u'pns_if': u't11pns_if'}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t11\" ip route show default | grep -w '[d]efault via 192.168.1.1' ; if [ $? -ne 0 ] ; then ip netns exec \"t11\" ip route add default via \"192.168.1.1\" ; fi\n", "delta": "0:00:00.044797", "end": "2019-12-05 07:40:48.837435", "item": {"default_route_ip": "192.168.1.1", "name": "t11", "pns_if": "t11pns_if", "pns_ip": "192.168.1.1/24", "tenant_if": "t11if", "tenant_ip": "192.168.1.2/24"}, "rc": 0, "start": "2019-12-05 07:40:48.792638", "stderr": "", "stderr_lines": [], "stdout": "default via 192.168.1.1 dev t11if ", "stdout_lines": ["default via 192.168.1.1 dev t11if "]}

TASK [Add IP Route to Tenant Subnet] ************************************************************************************************************************
changed: [localhost] => (item={u'route': [{u'ip': u'10.1.1.1/24', u'ns_name': u't11', u'ns_if': u't11if', u'if': u'p1'}], u'default_route_ip': u'10.1.1.1', u'bridge_name': u't11br1', u'dns': [{u'dnsif': u't11s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't11s1_dnsbrif'}], u'ns_name': u't11ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.1.2/24', u'tenant_ns_ip': u'10.1.1.1/24', u'tenant_ns_if': u't11ns1if', u'tenant_ns_name': u't11', u'tenant_sub_if': u't11s1if'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't11_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't11br1if1', u'vmif': u't11VM1if1'}, {u'mem': 4, u'name': u't11_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't11br1if2', u'vmif': u't11VM2if1'}], u'vxlan': [{u'local_ip': u'10.1.1.2', u'tenant_route_ip': u'192.168.1.2', u'dsport': 4789, u'dev': u't11s1if', u'subnet_route': u'10.1.1.0/24', u'remote_route': u'10.2.1.0/24', u'v_name': u'vxlan_t11s1', u'id': 42, u'remote_ip': u'10.2.1.2'}]}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t11ns1\" ip route show default | grep -w '[d]efault via 10.1.1.1' ; if [ $? -ne 0 ] ; then ip netns exec \"t11ns1\" ip route add default via \"10.1.1.1\" ; fi\n", "delta": "0:00:00.034645", "end": "2019-12-05 07:40:49.189223", "item": {"bridge_name": "t11br1", "default_route_ip": "10.1.1.1", "dns": [{"brif": "t11s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.5", "dnsif": "t11s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t11ns1", "route": [{"if": "p1", "ip": "10.1.1.1/24", "ns_if": "t11if", "ns_name": "t11"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t11ns1if", "tenant_ns_ip": "10.1.1.1/24", "tenant_ns_name": "t11", "tenant_sub_if": "t11s1if", "tenant_sub_ip": "10.1.1.2/24"}], "vms": [{"brif": "t11br1if1", "disk": "10G", "mem": 2, "name": "t11_VM1", "vcpu": 4, "vmif": "t11VM1if1"}, {"brif": "t11br1if2", "disk": "10G", "mem": 4, "name": "t11_VM2", "vcpu": 2, "vmif": "t11VM2if1"}], "vxlan": [{"dev": "t11s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.1.2", "remote_ip": "10.2.1.2", "remote_route": "10.2.1.0/24", "subnet_route": "10.1.1.0/24", "tenant_route_ip": "192.168.1.2", "v_name": "vxlan_t11s1"}]}, "rc": 0, "start": "2019-12-05 07:40:49.154578", "stderr": "", "stderr_lines": [], "stdout": "default via 10.1.1.1 dev t11s1if ", "stdout_lines": ["default via 10.1.1.1 dev t11s1if "]}

TASK [Create bridge inside namespace] ***********************************************************************************************************************
changed: [localhost] => (item={u'route': [{u'ip': u'10.1.1.1/24', u'ns_name': u't11', u'ns_if': u't11if', u'if': u'p1'}], u'default_route_ip': u'10.1.1.1', u'bridge_name': u't11br1', u'dns': [{u'dnsif': u't11s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't11s1_dnsbrif'}], u'ns_name': u't11ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.1.2/24', u'tenant_ns_ip': u'10.1.1.1/24', u'tenant_ns_if': u't11ns1if', u'tenant_ns_name': u't11', u'tenant_sub_if': u't11s1if'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't11_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't11br1if1', u'vmif': u't11VM1if1'}, {u'mem': 4, u'name': u't11_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't11br1if2', u'vmif': u't11VM2if1'}], u'vxlan': [{u'local_ip': u'10.1.1.2', u'tenant_route_ip': u'192.168.1.2', u'dsport': 4789, u'dev': u't11s1if', u'subnet_route': u'10.1.1.0/24', u'remote_route': u'10.2.1.0/24', u'v_name': u'vxlan_t11s1', u'id': 42, u'remote_ip': u'10.2.1.2'}]}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t11ns1\" brctl show | grep -w '^t11br1'; if [ $? -ne 0 ] ; then ip netns exec \"t11ns1\" brctl addbr \"t11br1\" ; fi\nip netns exec \"t11ns1\" ip link set dev \"t11br1\" up\n", "delta": "0:00:00.080971", "end": "2019-12-05 07:40:49.577004", "item": {"bridge_name": "t11br1", "default_route_ip": "10.1.1.1", "dns": [{"brif": "t11s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.5", "dnsif": "t11s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t11ns1", "route": [{"if": "p1", "ip": "10.1.1.1/24", "ns_if": "t11if", "ns_name": "t11"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t11ns1if", "tenant_ns_ip": "10.1.1.1/24", "tenant_ns_name": "t11", "tenant_sub_if": "t11s1if", "tenant_sub_ip": "10.1.1.2/24"}], "vms": [{"brif": "t11br1if1", "disk": "10G", "mem": 2, "name": "t11_VM1", "vcpu": 4, "vmif": "t11VM1if1"}, {"brif": "t11br1if2", "disk": "10G", "mem": 4, "name": "t11_VM2", "vcpu": 2, "vmif": "t11VM2if1"}], "vxlan": [{"dev": "t11s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.1.2", "remote_ip": "10.2.1.2", "remote_route": "10.2.1.0/24", "subnet_route": "10.1.1.0/24", "tenant_route_ip": "192.168.1.2", "v_name": "vxlan_t11s1"}]}, "rc": 0, "start": "2019-12-05 07:40:49.496033", "stderr": "", "stderr_lines": [], "stdout": "t11br1\t\t8000.12e9f79e5ae8\tno\t\tt11br1if1", "stdout_lines": ["t11br1\t\t8000.12e9f79e5ae8\tno\t\tt11br1if1"]}

TASK [Create DNS VETH Pair] *********************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.1.1/24', u'ns_name': u't11', u'ns_if': u't11if', u'if': u'p1'}], u'default_route_ip': u'10.1.1.1', u'bridge_name': u't11br1', u'ns_name': u't11ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.1.2/24', u'tenant_ns_ip': u'10.1.1.1/24', u'tenant_ns_if': u't11ns1if', u'tenant_sub_if': u't11s1if', u'tenant_ns_name': u't11'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't11_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't11br1if1', u'vmif': u't11VM1if1'}, {u'mem': 4, u'name': u't11_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't11br1if2', u'vmif': u't11VM2if1'}], u'vxlan': [{u'local_ip': u'10.1.1.2', u'dsport': 4789, u'dev': u't11s1if', u'tenant_route_ip': u'192.168.1.2', u'remote_route': u'10.2.1.0/24', u'subnet_route': u'10.1.1.0/24', u'v_name': u'vxlan_t11s1', u'id': 42, u'remote_ip': u'10.2.1.2'}]}, {u'dnsif': u't11s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't11s1_dnsbrif'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t11ns1\" ip link show \"t11s1_dnsbrif\" ; if [ $? -ne 0 ] ; then ip netns exec \"t11ns1\" ip link add \"t11s1_dnsbrif\" type veth peer name \"t11s1_dnsif\" ; fi\nip netns exec \"t11ns1\" ip link set dev \"t11s1_dnsbrif\" up\nip netns exec \"t11ns1\" ip link set dev \"t11s1_dnsif\" up\n", "delta": "0:00:00.111189", "end": "2019-12-05 07:40:49.973072", "item": [{"bridge_name": "t11br1", "default_route_ip": "10.1.1.1", "ns_name": "t11ns1", "route": [{"if": "p1", "ip": "10.1.1.1/24", "ns_if": "t11if", "ns_name": "t11"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t11ns1if", "tenant_ns_ip": "10.1.1.1/24", "tenant_ns_name": "t11", "tenant_sub_if": "t11s1if", "tenant_sub_ip": "10.1.1.2/24"}], "vms": [{"brif": "t11br1if1", "disk": "10G", "mem": 2, "name": "t11_VM1", "vcpu": 4, "vmif": "t11VM1if1"}, {"brif": "t11br1if2", "disk": "10G", "mem": 4, "name": "t11_VM2", "vcpu": 2, "vmif": "t11VM2if1"}], "vxlan": [{"dev": "t11s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.1.2", "remote_ip": "10.2.1.2", "remote_route": "10.2.1.0/24", "subnet_route": "10.1.1.0/24", "tenant_route_ip": "192.168.1.2", "v_name": "vxlan_t11s1"}]}, {"brif": "t11s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.5", "dnsif": "t11s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "rc": 0, "start": "2019-12-05 07:40:49.861883", "stderr": "", "stderr_lines": [], "stdout": "7: t11s1_dnsbrif@t11s1_dnsif: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue master t11br1 state UP mode DEFAULT group default qlen 1000\n    link/ether 2e:38:31:50:58:af brd ff:ff:ff:ff:ff:ff", "stdout_lines": ["7: t11s1_dnsbrif@t11s1_dnsif: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue master t11br1 state UP mode DEFAULT group default qlen 1000", "    link/ether 2e:38:31:50:58:af brd ff:ff:ff:ff:ff:ff"]}

TASK [Attach DNS VETH Pair] *********************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.1.1/24', u'ns_name': u't11', u'ns_if': u't11if', u'if': u'p1'}], u'default_route_ip': u'10.1.1.1', u'bridge_name': u't11br1', u'ns_name': u't11ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.1.2/24', u'tenant_ns_ip': u'10.1.1.1/24', u'tenant_ns_if': u't11ns1if', u'tenant_sub_if': u't11s1if', u'tenant_ns_name': u't11'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't11_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't11br1if1', u'vmif': u't11VM1if1'}, {u'mem': 4, u'name': u't11_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't11br1if2', u'vmif': u't11VM2if1'}], u'vxlan': [{u'local_ip': u'10.1.1.2', u'dsport': 4789, u'dev': u't11s1if', u'tenant_route_ip': u'192.168.1.2', u'remote_route': u'10.2.1.0/24', u'subnet_route': u'10.1.1.0/24', u'v_name': u'vxlan_t11s1', u'id': 42, u'remote_ip': u'10.2.1.2'}]}, {u'dnsif': u't11s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't11s1_dnsbrif'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t11ns1\" brctl show \"t11br1\" | grep -w 't11s1_dnsbrif' ; if [ $? -ne 0 ] ; then ip netns exec \"t11ns1\" brctl addif \"t11br1\" \"t11s1_dnsbrif\" ; fi\n", "delta": "0:00:00.041967", "end": "2019-12-05 07:40:50.277135", "item": [{"bridge_name": "t11br1", "default_route_ip": "10.1.1.1", "ns_name": "t11ns1", "route": [{"if": "p1", "ip": "10.1.1.1/24", "ns_if": "t11if", "ns_name": "t11"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t11ns1if", "tenant_ns_ip": "10.1.1.1/24", "tenant_ns_name": "t11", "tenant_sub_if": "t11s1if", "tenant_sub_ip": "10.1.1.2/24"}], "vms": [{"brif": "t11br1if1", "disk": "10G", "mem": 2, "name": "t11_VM1", "vcpu": 4, "vmif": "t11VM1if1"}, {"brif": "t11br1if2", "disk": "10G", "mem": 4, "name": "t11_VM2", "vcpu": 2, "vmif": "t11VM2if1"}], "vxlan": [{"dev": "t11s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.1.2", "remote_ip": "10.2.1.2", "remote_route": "10.2.1.0/24", "subnet_route": "10.1.1.0/24", "tenant_route_ip": "192.168.1.2", "v_name": "vxlan_t11s1"}]}, {"brif": "t11s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.5", "dnsif": "t11s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "rc": 0, "start": "2019-12-05 07:40:50.235168", "stderr": "", "stderr_lines": [], "stdout": "\t\t\t\t\t\t\tt11s1_dnsbrif", "stdout_lines": ["\t\t\t\t\t\t\tt11s1_dnsbrif"]}

TASK [Create VETH Pairs] ************************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.1.1/24', u'ns_name': u't11', u'ns_if': u't11if', u'if': u'p1'}], u'default_route_ip': u'10.1.1.1', u'bridge_name': u't11br1', u'dns': [{u'dnsif': u't11s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't11s1_dnsbrif'}], u'ns_name': u't11ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.1.2/24', u'tenant_ns_ip': u'10.1.1.1/24', u'tenant_ns_if': u't11ns1if', u'tenant_sub_if': u't11s1if', u'tenant_ns_name': u't11'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.1.1.2', u'dsport': 4789, u'dev': u't11s1if', u'tenant_route_ip': u'192.168.1.2', u'remote_route': u'10.2.1.0/24', u'subnet_route': u'10.1.1.0/24', u'v_name': u'vxlan_t11s1', u'id': 42, u'remote_ip': u'10.2.1.2'}]}, {u'mem': 2, u'name': u't11_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't11br1if1', u'vmif': u't11VM1if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip link show \"t11br1if1\" ; if [ $? -ne 0 ] ; then ip link add \"t11VM1if1\" type veth peer name \"t11br1if1\" ; fi\nip link set dev \"t11br1if1\" up\nip link set dev \"t11VM1if1\" up\n", "delta": "0:00:00.012999", "end": "2019-12-05 07:40:50.557328", "item": [{"bridge_name": "t11br1", "default_route_ip": "10.1.1.1", "dns": [{"brif": "t11s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.5", "dnsif": "t11s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t11ns1", "route": [{"if": "p1", "ip": "10.1.1.1/24", "ns_if": "t11if", "ns_name": "t11"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t11ns1if", "tenant_ns_ip": "10.1.1.1/24", "tenant_ns_name": "t11", "tenant_sub_if": "t11s1if", "tenant_sub_ip": "10.1.1.2/24"}], "vxlan": [{"dev": "t11s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.1.2", "remote_ip": "10.2.1.2", "remote_route": "10.2.1.0/24", "subnet_route": "10.1.1.0/24", "tenant_route_ip": "192.168.1.2", "v_name": "vxlan_t11s1"}]}, {"brif": "t11br1if1", "disk": "10G", "mem": 2, "name": "t11_VM1", "vcpu": 4, "vmif": "t11VM1if1"}], "rc": 0, "start": "2019-12-05 07:40:50.544329", "stderr": "Device \"t11br1if1\" does not exist.\nRTNETLINK answers: File exists\nCannot find device \"t11br1if1\"", "stderr_lines": ["Device \"t11br1if1\" does not exist.", "RTNETLINK answers: File exists", "Cannot find device \"t11br1if1\""], "stdout": "", "stdout_lines": []}
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.1.1/24', u'ns_name': u't11', u'ns_if': u't11if', u'if': u'p1'}], u'default_route_ip': u'10.1.1.1', u'bridge_name': u't11br1', u'dns': [{u'dnsif': u't11s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't11s1_dnsbrif'}], u'ns_name': u't11ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.1.2/24', u'tenant_ns_ip': u'10.1.1.1/24', u'tenant_ns_if': u't11ns1if', u'tenant_sub_if': u't11s1if', u'tenant_ns_name': u't11'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.1.1.2', u'dsport': 4789, u'dev': u't11s1if', u'tenant_route_ip': u'192.168.1.2', u'remote_route': u'10.2.1.0/24', u'subnet_route': u'10.1.1.0/24', u'v_name': u'vxlan_t11s1', u'id': 42, u'remote_ip': u'10.2.1.2'}]}, {u'mem': 4, u'name': u't11_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't11br1if2', u'vmif': u't11VM2if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip link show \"t11br1if2\" ; if [ $? -ne 0 ] ; then ip link add \"t11VM2if1\" type veth peer name \"t11br1if2\" ; fi\nip link set dev \"t11br1if2\" up\nip link set dev \"t11VM2if1\" up\n", "delta": "0:00:00.012771", "end": "2019-12-05 07:40:50.768703", "item": [{"bridge_name": "t11br1", "default_route_ip": "10.1.1.1", "dns": [{"brif": "t11s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.5", "dnsif": "t11s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t11ns1", "route": [{"if": "p1", "ip": "10.1.1.1/24", "ns_if": "t11if", "ns_name": "t11"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t11ns1if", "tenant_ns_ip": "10.1.1.1/24", "tenant_ns_name": "t11", "tenant_sub_if": "t11s1if", "tenant_sub_ip": "10.1.1.2/24"}], "vxlan": [{"dev": "t11s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.1.2", "remote_ip": "10.2.1.2", "remote_route": "10.2.1.0/24", "subnet_route": "10.1.1.0/24", "tenant_route_ip": "192.168.1.2", "v_name": "vxlan_t11s1"}]}, {"brif": "t11br1if2", "disk": "10G", "mem": 4, "name": "t11_VM2", "vcpu": 2, "vmif": "t11VM2if1"}], "rc": 0, "start": "2019-12-05 07:40:50.755932", "stderr": "Device \"t11br1if2\" does not exist.\nRTNETLINK answers: File exists\nCannot find device \"t11br1if2\"", "stderr_lines": ["Device \"t11br1if2\" does not exist.", "RTNETLINK answers: File exists", "Cannot find device \"t11br1if2\""], "stdout": "", "stdout_lines": []}

TASK [Attach VETH Pairs] ************************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.1.1/24', u'ns_name': u't11', u'ns_if': u't11if', u'if': u'p1'}], u'default_route_ip': u'10.1.1.1', u'bridge_name': u't11br1', u'dns': [{u'dnsif': u't11s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't11s1_dnsbrif'}], u'ns_name': u't11ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.1.2/24', u'tenant_ns_ip': u'10.1.1.1/24', u'tenant_ns_if': u't11ns1if', u'tenant_sub_if': u't11s1if', u'tenant_ns_name': u't11'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.1.1.2', u'dsport': 4789, u'dev': u't11s1if', u'tenant_route_ip': u'192.168.1.2', u'remote_route': u'10.2.1.0/24', u'subnet_route': u'10.1.1.0/24', u'v_name': u'vxlan_t11s1', u'id': 42, u'remote_ip': u'10.2.1.2'}]}, {u'mem': 2, u'name': u't11_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't11br1if1', u'vmif': u't11VM1if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip link show \"t11br1if1\" ; if [ $? -eq 0 ] ; then ip link set \"t11br1if1\" netns \"t11ns1\" ; fi\nip netns exec \"t11ns1\" brctl show \"t11br1\" | grep -w 't11br1if1' ; if [ $? -ne 0 ] ; then ip netns exec \"t11ns1\" brctl addif \"t11br1\" \"t11br1if1\" ; fi\n", "delta": "0:00:00.041599", "end": "2019-12-05 07:40:51.093216", "item": [{"bridge_name": "t11br1", "default_route_ip": "10.1.1.1", "dns": [{"brif": "t11s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.5", "dnsif": "t11s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t11ns1", "route": [{"if": "p1", "ip": "10.1.1.1/24", "ns_if": "t11if", "ns_name": "t11"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t11ns1if", "tenant_ns_ip": "10.1.1.1/24", "tenant_ns_name": "t11", "tenant_sub_if": "t11s1if", "tenant_sub_ip": "10.1.1.2/24"}], "vxlan": [{"dev": "t11s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.1.2", "remote_ip": "10.2.1.2", "remote_route": "10.2.1.0/24", "subnet_route": "10.1.1.0/24", "tenant_route_ip": "192.168.1.2", "v_name": "vxlan_t11s1"}]}, {"brif": "t11br1if1", "disk": "10G", "mem": 2, "name": "t11_VM1", "vcpu": 4, "vmif": "t11VM1if1"}], "rc": 0, "start": "2019-12-05 07:40:51.051617", "stderr": "Device \"t11br1if1\" does not exist.", "stderr_lines": ["Device \"t11br1if1\" does not exist."], "stdout": "t11br1\t\t8000.12e9f79e5ae8\tno\t\tt11br1if1", "stdout_lines": ["t11br1\t\t8000.12e9f79e5ae8\tno\t\tt11br1if1"]}
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.1.1/24', u'ns_name': u't11', u'ns_if': u't11if', u'if': u'p1'}], u'default_route_ip': u'10.1.1.1', u'bridge_name': u't11br1', u'dns': [{u'dnsif': u't11s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't11s1_dnsbrif'}], u'ns_name': u't11ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.1.2/24', u'tenant_ns_ip': u'10.1.1.1/24', u'tenant_ns_if': u't11ns1if', u'tenant_sub_if': u't11s1if', u'tenant_ns_name': u't11'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.1.1.2', u'dsport': 4789, u'dev': u't11s1if', u'tenant_route_ip': u'192.168.1.2', u'remote_route': u'10.2.1.0/24', u'subnet_route': u'10.1.1.0/24', u'v_name': u'vxlan_t11s1', u'id': 42, u'remote_ip': u'10.2.1.2'}]}, {u'mem': 4, u'name': u't11_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't11br1if2', u'vmif': u't11VM2if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip link show \"t11br1if2\" ; if [ $? -eq 0 ] ; then ip link set \"t11br1if2\" netns \"t11ns1\" ; fi\nip netns exec \"t11ns1\" brctl show \"t11br1\" | grep -w 't11br1if2' ; if [ $? -ne 0 ] ; then ip netns exec \"t11ns1\" brctl addif \"t11br1\" \"t11br1if2\" ; fi\n", "delta": "0:00:00.046094", "end": "2019-12-05 07:40:51.357366", "item": [{"bridge_name": "t11br1", "default_route_ip": "10.1.1.1", "dns": [{"brif": "t11s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.5", "dnsif": "t11s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t11ns1", "route": [{"if": "p1", "ip": "10.1.1.1/24", "ns_if": "t11if", "ns_name": "t11"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t11ns1if", "tenant_ns_ip": "10.1.1.1/24", "tenant_ns_name": "t11", "tenant_sub_if": "t11s1if", "tenant_sub_ip": "10.1.1.2/24"}], "vxlan": [{"dev": "t11s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.1.2", "remote_ip": "10.2.1.2", "remote_route": "10.2.1.0/24", "subnet_route": "10.1.1.0/24", "tenant_route_ip": "192.168.1.2", "v_name": "vxlan_t11s1"}]}, {"brif": "t11br1if2", "disk": "10G", "mem": 4, "name": "t11_VM2", "vcpu": 2, "vmif": "t11VM2if1"}], "rc": 0, "start": "2019-12-05 07:40:51.311272", "stderr": "Device \"t11br1if2\" does not exist.", "stderr_lines": ["Device \"t11br1if2\" does not exist."], "stdout": "\t\t\t\t\t\t\tt11br1if2", "stdout_lines": ["\t\t\t\t\t\t\tt11br1if2"]}

TASK [All interfaces and bridges UP] ************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.1.1/24', u'ns_name': u't11', u'ns_if': u't11if', u'if': u'p1'}], u'default_route_ip': u'10.1.1.1', u'bridge_name': u't11br1', u'dns': [{u'dnsif': u't11s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't11s1_dnsbrif'}], u'ns_name': u't11ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.1.2/24', u'tenant_ns_ip': u'10.1.1.1/24', u'tenant_ns_if': u't11ns1if', u'tenant_sub_if': u't11s1if', u'tenant_ns_name': u't11'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.1.1.2', u'dsport': 4789, u'dev': u't11s1if', u'tenant_route_ip': u'192.168.1.2', u'remote_route': u'10.2.1.0/24', u'subnet_route': u'10.1.1.0/24', u'v_name': u'vxlan_t11s1', u'id': 42, u'remote_ip': u'10.2.1.2'}]}, {u'mem': 2, u'name': u't11_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't11br1if1', u'vmif': u't11VM1if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t11ns1\" ip link set \"t11br1if1\" up\nip netns exec \"t11ns1\" ip link set dev \"t11br1\" up\n", "delta": "0:00:00.086882", "end": "2019-12-05 07:40:51.733111", "item": [{"bridge_name": "t11br1", "default_route_ip": "10.1.1.1", "dns": [{"brif": "t11s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.5", "dnsif": "t11s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t11ns1", "route": [{"if": "p1", "ip": "10.1.1.1/24", "ns_if": "t11if", "ns_name": "t11"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t11ns1if", "tenant_ns_ip": "10.1.1.1/24", "tenant_ns_name": "t11", "tenant_sub_if": "t11s1if", "tenant_sub_ip": "10.1.1.2/24"}], "vxlan": [{"dev": "t11s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.1.2", "remote_ip": "10.2.1.2", "remote_route": "10.2.1.0/24", "subnet_route": "10.1.1.0/24", "tenant_route_ip": "192.168.1.2", "v_name": "vxlan_t11s1"}]}, {"brif": "t11br1if1", "disk": "10G", "mem": 2, "name": "t11_VM1", "vcpu": 4, "vmif": "t11VM1if1"}], "rc": 0, "start": "2019-12-05 07:40:51.646229", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.1.1/24', u'ns_name': u't11', u'ns_if': u't11if', u'if': u'p1'}], u'default_route_ip': u'10.1.1.1', u'bridge_name': u't11br1', u'dns': [{u'dnsif': u't11s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't11s1_dnsbrif'}], u'ns_name': u't11ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.1.2/24', u'tenant_ns_ip': u'10.1.1.1/24', u'tenant_ns_if': u't11ns1if', u'tenant_sub_if': u't11s1if', u'tenant_ns_name': u't11'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.1.1.2', u'dsport': 4789, u'dev': u't11s1if', u'tenant_route_ip': u'192.168.1.2', u'remote_route': u'10.2.1.0/24', u'subnet_route': u'10.1.1.0/24', u'v_name': u'vxlan_t11s1', u'id': 42, u'remote_ip': u'10.2.1.2'}]}, {u'mem': 4, u'name': u't11_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't11br1if2', u'vmif': u't11VM2if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t11ns1\" ip link set \"t11br1if2\" up\nip netns exec \"t11ns1\" ip link set dev \"t11br1\" up\n", "delta": "0:00:00.108210", "end": "2019-12-05 07:40:52.081374", "item": [{"bridge_name": "t11br1", "default_route_ip": "10.1.1.1", "dns": [{"brif": "t11s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.5", "dnsif": "t11s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t11ns1", "route": [{"if": "p1", "ip": "10.1.1.1/24", "ns_if": "t11if", "ns_name": "t11"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t11ns1if", "tenant_ns_ip": "10.1.1.1/24", "tenant_ns_name": "t11", "tenant_sub_if": "t11s1if", "tenant_sub_ip": "10.1.1.2/24"}], "vxlan": [{"dev": "t11s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.1.2", "remote_ip": "10.2.1.2", "remote_route": "10.2.1.0/24", "subnet_route": "10.1.1.0/24", "tenant_route_ip": "192.168.1.2", "v_name": "vxlan_t11s1"}]}, {"brif": "t11br1if2", "disk": "10G", "mem": 4, "name": "t11_VM2", "vcpu": 2, "vmif": "t11VM2if1"}], "rc": 0, "start": "2019-12-05 07:40:51.973164", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Add IP to DNS Interface] ******************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.1.1/24', u'ns_name': u't11', u'ns_if': u't11if', u'if': u'p1'}], u'default_route_ip': u'10.1.1.1', u'bridge_name': u't11br1', u'ns_name': u't11ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.1.2/24', u'tenant_ns_ip': u'10.1.1.1/24', u'tenant_ns_if': u't11ns1if', u'tenant_sub_if': u't11s1if', u'tenant_ns_name': u't11'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't11_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't11br1if1', u'vmif': u't11VM1if1'}, {u'mem': 4, u'name': u't11_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't11br1if2', u'vmif': u't11VM2if1'}], u'vxlan': [{u'local_ip': u'10.1.1.2', u'dsport': 4789, u'dev': u't11s1if', u'tenant_route_ip': u'192.168.1.2', u'remote_route': u'10.2.1.0/24', u'subnet_route': u'10.1.1.0/24', u'v_name': u'vxlan_t11s1', u'id': 42, u'remote_ip': u'10.2.1.2'}]}, {u'dnsif': u't11s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't11s1_dnsbrif'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t11ns1\" ip addr show \"t11s1_dnsif\" | awk 'FNR==3{ print $2 }' | grep -w '^1.1.1.1/24' ; if [ $? -ne 0 ] ; then ip netns exec \"t11ns1\" ip addr add \"1.1.1.1/24\" dev \"t11s1_dnsif\" ; fi\n", "delta": "0:00:00.041304", "end": "2019-12-05 07:40:52.413516", "item": [{"bridge_name": "t11br1", "default_route_ip": "10.1.1.1", "ns_name": "t11ns1", "route": [{"if": "p1", "ip": "10.1.1.1/24", "ns_if": "t11if", "ns_name": "t11"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t11ns1if", "tenant_ns_ip": "10.1.1.1/24", "tenant_ns_name": "t11", "tenant_sub_if": "t11s1if", "tenant_sub_ip": "10.1.1.2/24"}], "vms": [{"brif": "t11br1if1", "disk": "10G", "mem": 2, "name": "t11_VM1", "vcpu": 4, "vmif": "t11VM1if1"}, {"brif": "t11br1if2", "disk": "10G", "mem": 4, "name": "t11_VM2", "vcpu": 2, "vmif": "t11VM2if1"}], "vxlan": [{"dev": "t11s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.1.2", "remote_ip": "10.2.1.2", "remote_route": "10.2.1.0/24", "subnet_route": "10.1.1.0/24", "tenant_route_ip": "192.168.1.2", "v_name": "vxlan_t11s1"}]}, {"brif": "t11s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.5", "dnsif": "t11s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "rc": 0, "start": "2019-12-05 07:40:52.372212", "stderr": "", "stderr_lines": [], "stdout": "1.1.1.1/24", "stdout_lines": ["1.1.1.1/24"]}

TASK [Install DHCP Server] **********************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.1.1/24', u'ns_name': u't11', u'ns_if': u't11if', u'if': u'p1'}], u'default_route_ip': u'10.1.1.1', u'bridge_name': u't11br1', u'ns_name': u't11ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.1.2/24', u'tenant_ns_ip': u'10.1.1.1/24', u'tenant_ns_if': u't11ns1if', u'tenant_sub_if': u't11s1if', u'tenant_ns_name': u't11'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't11_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't11br1if1', u'vmif': u't11VM1if1'}, {u'mem': 4, u'name': u't11_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't11br1if2', u'vmif': u't11VM2if1'}], u'vxlan': [{u'local_ip': u'10.1.1.2', u'dsport': 4789, u'dev': u't11s1if', u'tenant_route_ip': u'192.168.1.2', u'remote_route': u'10.2.1.0/24', u'subnet_route': u'10.1.1.0/24', u'v_name': u'vxlan_t11s1', u'id': 42, u'remote_ip': u'10.2.1.2'}]}, {u'dnsif': u't11s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't11s1_dnsbrif'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t11ns1\" ps aux | grep -w '[d]nsmasq --interface t11s1_dnsif -z --dhcp-range=1.1.1.5,1.1.1.254' ; if [ $? -ne 0 ] ; then ip netns exec \"t11ns1\" dnsmasq --interface \"t11s1_dnsif\" -z --dhcp-range=1.1.1.5,'1.1.1.254' ; fi\n", "delta": "0:00:00.057223", "end": "2019-12-05 07:40:52.773047", "item": [{"bridge_name": "t11br1", "default_route_ip": "10.1.1.1", "ns_name": "t11ns1", "route": [{"if": "p1", "ip": "10.1.1.1/24", "ns_if": "t11if", "ns_name": "t11"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t11ns1if", "tenant_ns_ip": "10.1.1.1/24", "tenant_ns_name": "t11", "tenant_sub_if": "t11s1if", "tenant_sub_ip": "10.1.1.2/24"}], "vms": [{"brif": "t11br1if1", "disk": "10G", "mem": 2, "name": "t11_VM1", "vcpu": 4, "vmif": "t11VM1if1"}, {"brif": "t11br1if2", "disk": "10G", "mem": 4, "name": "t11_VM2", "vcpu": 2, "vmif": "t11VM2if1"}], "vxlan": [{"dev": "t11s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.1.2", "remote_ip": "10.2.1.2", "remote_route": "10.2.1.0/24", "subnet_route": "10.1.1.0/24", "tenant_route_ip": "192.168.1.2", "v_name": "vxlan_t11s1"}]}, {"brif": "t11s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.5", "dnsif": "t11s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "rc": 0, "start": "2019-12-05 07:40:52.715824", "stderr": "", "stderr_lines": [], "stdout": "nobody   31230  0.0  0.0  51580   384 ?        S    07:23   0:00 dnsmasq --interface t11s1_dnsif -z --dhcp-range=1.1.1.5,1.1.1.254", "stdout_lines": ["nobody   31230  0.0  0.0  51580   384 ?        S    07:23   0:00 dnsmasq --interface t11s1_dnsif -z --dhcp-range=1.1.1.5,1.1.1.254"]}

TASK [Create VXLAN devices] *********************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.1.1/24', u'ns_name': u't11', u'ns_if': u't11if', u'if': u'p1'}], u'default_route_ip': u'10.1.1.1', u'bridge_name': u't11br1', u'dns': [{u'dnsif': u't11s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't11s1_dnsbrif'}], u'ns_name': u't11ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.1.2/24', u'tenant_ns_ip': u'10.1.1.1/24', u'tenant_ns_if': u't11ns1if', u'tenant_sub_if': u't11s1if', u'tenant_ns_name': u't11'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't11_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't11br1if1', u'vmif': u't11VM1if1'}, {u'mem': 4, u'name': u't11_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't11br1if2', u'vmif': u't11VM2if1'}]}, {u'local_ip': u'10.1.1.2', u'dsport': 4789, u'dev': u't11s1if', u'tenant_route_ip': u'192.168.1.2', u'remote_route': u'10.2.1.0/24', u'subnet_route': u'10.1.1.0/24', u'v_name': u'vxlan_t11s1', u'id': 42, u'remote_ip': u'10.2.1.2'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t11ns1\" ip link show \"vxlan_t11s1\" ; if [ $? -ne 0 ] ; then ip netns exec \"t11ns1\" ip link add \"vxlan_t11s1\" type vxlan id \"42\" local \"10.1.1.2\" remote \"10.2.1.2\" dstport \"4789\" dev \"t11s1if\"; ip netns exec \"t11ns1\" ip link set dev \"vxlan_t11s1\" up ; fi\n", "delta": "0:00:00.042536", "end": "2019-12-05 07:40:53.102288", "item": [{"bridge_name": "t11br1", "default_route_ip": "10.1.1.1", "dns": [{"brif": "t11s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.5", "dnsif": "t11s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t11ns1", "route": [{"if": "p1", "ip": "10.1.1.1/24", "ns_if": "t11if", "ns_name": "t11"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t11ns1if", "tenant_ns_ip": "10.1.1.1/24", "tenant_ns_name": "t11", "tenant_sub_if": "t11s1if", "tenant_sub_ip": "10.1.1.2/24"}], "vms": [{"brif": "t11br1if1", "disk": "10G", "mem": 2, "name": "t11_VM1", "vcpu": 4, "vmif": "t11VM1if1"}, {"brif": "t11br1if2", "disk": "10G", "mem": 4, "name": "t11_VM2", "vcpu": 2, "vmif": "t11VM2if1"}]}, {"dev": "t11s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.1.2", "remote_ip": "10.2.1.2", "remote_route": "10.2.1.0/24", "subnet_route": "10.1.1.0/24", "tenant_route_ip": "192.168.1.2", "v_name": "vxlan_t11s1"}], "rc": 0, "start": "2019-12-05 07:40:53.059752", "stderr": "", "stderr_lines": [], "stdout": "8: vxlan_t11s1: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1450 qdisc noqueue master t11br1 state UNKNOWN mode DEFAULT group default qlen 1000\n    link/ether 12:e9:f7:9e:5a:e8 brd ff:ff:ff:ff:ff:ff", "stdout_lines": ["8: vxlan_t11s1: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1450 qdisc noqueue master t11br1 state UNKNOWN mode DEFAULT group default qlen 1000", "    link/ether 12:e9:f7:9e:5a:e8 brd ff:ff:ff:ff:ff:ff"]}

TASK [Attach VXLANs to bridge] ******************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.1.1/24', u'ns_name': u't11', u'ns_if': u't11if', u'if': u'p1'}], u'default_route_ip': u'10.1.1.1', u'bridge_name': u't11br1', u'dns': [{u'dnsif': u't11s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't11s1_dnsbrif'}], u'ns_name': u't11ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.1.2/24', u'tenant_ns_ip': u'10.1.1.1/24', u'tenant_ns_if': u't11ns1if', u'tenant_sub_if': u't11s1if', u'tenant_ns_name': u't11'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't11_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't11br1if1', u'vmif': u't11VM1if1'}, {u'mem': 4, u'name': u't11_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't11br1if2', u'vmif': u't11VM2if1'}]}, {u'local_ip': u'10.1.1.2', u'dsport': 4789, u'dev': u't11s1if', u'tenant_route_ip': u'192.168.1.2', u'remote_route': u'10.2.1.0/24', u'subnet_route': u'10.1.1.0/24', u'v_name': u'vxlan_t11s1', u'id': 42, u'remote_ip': u'10.2.1.2'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t11ns1\" brctl show \"t11br1\" | grep -w 'vxlan_t11s1' ; if [ $? -ne 0 ] ; then ip netns exec \"t11ns1\" brctl addif \"t11br1\" \"vxlan_t11s1\" ; fi\n", "delta": "0:00:00.045760", "end": "2019-12-05 07:40:53.469352", "item": [{"bridge_name": "t11br1", "default_route_ip": "10.1.1.1", "dns": [{"brif": "t11s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.5", "dnsif": "t11s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t11ns1", "route": [{"if": "p1", "ip": "10.1.1.1/24", "ns_if": "t11if", "ns_name": "t11"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t11ns1if", "tenant_ns_ip": "10.1.1.1/24", "tenant_ns_name": "t11", "tenant_sub_if": "t11s1if", "tenant_sub_ip": "10.1.1.2/24"}], "vms": [{"brif": "t11br1if1", "disk": "10G", "mem": 2, "name": "t11_VM1", "vcpu": 4, "vmif": "t11VM1if1"}, {"brif": "t11br1if2", "disk": "10G", "mem": 4, "name": "t11_VM2", "vcpu": 2, "vmif": "t11VM2if1"}]}, {"dev": "t11s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.1.2", "remote_ip": "10.2.1.2", "remote_route": "10.2.1.0/24", "subnet_route": "10.1.1.0/24", "tenant_route_ip": "192.168.1.2", "v_name": "vxlan_t11s1"}], "rc": 0, "start": "2019-12-05 07:40:53.423592", "stderr": "", "stderr_lines": [], "stdout": "\t\t\t\t\t\t\tvxlan_t11s1", "stdout_lines": ["\t\t\t\t\t\t\tvxlan_t11s1"]}

PLAY RECAP **************************************************************************************************************************************************
localhost                  : ok=21   changed=19   unreachable=0    failed=0    skipped=0    rescued=0    ignored=0   

Using /etc/ansible/ansible.cfg as config file
INFO:root: 07:41:47.997293 Printing the yaml input file
INFO:root: 07:41:47.997399 {'C1': [{'subnet_addr': '1.1.1.0/24', 'VM': [{'name': 'VM1', 'disk': '10G', 'mem': 2, 'vcpu': 4, 'internet_access': True}, {'name': 'VM2', 'disk': '10G', 'mem': 4, 'vcpu': 2, 'internet_access': False}]}], 'C2': [{'subnet_addr': '1.1.1.0/24', 'VM': [{'name': 'VM4', 'disk': '10G', 'mem': 2, 'vcpu': 4, 'internet_access': True}]}, {'subnet_addr': '2.2.2.0/24', 'VM': [{'name': 'VM3', 'disk': '10G', 'mem': 3, 'vcpu': 2, 'internet_access': True}]}], 'MISC': [{'LOG_ENABLE': True}, {'GUI': True}]}
INFO:root: 07:41:47.997487 Provided subnet in C1: 1.1.1.0/24 is valid
INFO:root: 07:41:47.997533 Provided subnet in C2: 1.1.1.0/24 is valid
INFO:root: 07:41:47.997572 Provided subnet in C2: 2.2.2.0/24 is valid
Using /etc/ansible/ansible.cfg as config file

PLAY [main] *************************************************************************************************************************************************

TASK [Create Tenant Namespace] ******************************************************************************************************************************
changed: [localhost] => (item={u'default_route_ip': u'192.168.2.1', u'name': u't12', u'pns_ip': u'192.168.2.1/24', u'tenant_if': u't12if', u'tenant_ip': u'192.168.2.2/24', u'pns_if': u't12pns_if'}) => {"ansible_loop_var": "item", "changed": true, "cmd": ["ip", "netns", "add", "t12"], "delta": "0:00:00.072441", "end": "2019-12-05 07:41:49.308074", "item": {"default_route_ip": "192.168.2.1", "name": "t12", "pns_if": "t12pns_if", "pns_ip": "192.168.2.1/24", "tenant_if": "t12if", "tenant_ip": "192.168.2.2/24"}, "rc": 0, "start": "2019-12-05 07:41:49.235633", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Create Subnet Namespace] ******************************************************************************************************************************
changed: [localhost] => (item={u'route': [{u'ip': u'10.1.11.1/24', u'ns_name': u't12', u'ns_if': u't12if', u'if': u'p1'}], u'default_route_ip': u'10.1.11.1', u'bridge_name': u't12br1', u'dns': [{u'dnsif': u't12s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't12s1_dnsbrif'}], u'ns_name': u't12ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.11.2/24', u'tenant_ns_ip': u'10.1.11.1/24', u'tenant_ns_if': u't12ns1if', u'tenant_ns_name': u't12', u'tenant_sub_if': u't12s1if'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't12_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't12br1if1', u'vmif': u't12VM1if1'}, {u'mem': 4, u'name': u't12_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't12br1if2', u'vmif': u't12VM2if1'}], u'vxlan': [{u'local_ip': u'10.1.11.2', u'tenant_route_ip': u'192.168.2.2', u'dsport': 4789, u'dev': u't12s1if', u'subnet_route': u'10.1.11.0/24', u'remote_route': u'10.2.11.0/24', u'v_name': u'vxlan_t12s1', u'id': 42, u'remote_ip': u'10.2.11.2'}]}) => {"ansible_loop_var": "item", "changed": true, "cmd": ["ip", "netns", "add", "t12ns1"], "delta": "0:00:00.050312", "end": "2019-12-05 07:41:49.613764", "item": {"bridge_name": "t12br1", "default_route_ip": "10.1.11.1", "dns": [{"brif": "t12s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.5", "dnsif": "t12s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t12ns1", "route": [{"if": "p1", "ip": "10.1.11.1/24", "ns_if": "t12if", "ns_name": "t12"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t12ns1if", "tenant_ns_ip": "10.1.11.1/24", "tenant_ns_name": "t12", "tenant_sub_if": "t12s1if", "tenant_sub_ip": "10.1.11.2/24"}], "vms": [{"brif": "t12br1if1", "disk": "10G", "mem": 2, "name": "t12_VM1", "vcpu": 4, "vmif": "t12VM1if1"}, {"brif": "t12br1if2", "disk": "10G", "mem": 4, "name": "t12_VM2", "vcpu": 2, "vmif": "t12VM2if1"}], "vxlan": [{"dev": "t12s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.11.2", "remote_ip": "10.2.11.2", "remote_route": "10.2.11.0/24", "subnet_route": "10.1.11.0/24", "tenant_route_ip": "192.168.2.2", "v_name": "vxlan_t12s1"}]}, "rc": 0, "start": "2019-12-05 07:41:49.563452", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Create Tenant VETH pairs] *****************************************************************************************************************************
changed: [localhost] => (item={u'default_route_ip': u'192.168.2.1', u'name': u't12', u'pns_ip': u'192.168.2.1/24', u'tenant_if': u't12if', u'tenant_ip': u'192.168.2.2/24', u'pns_if': u't12pns_if'}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip link show \"t12if\" ; if [ $? -ne 0 ] ; then ip link add \"t12if\" type veth peer name \"t12pns_if\" ; fi\n", "delta": "0:00:00.010205", "end": "2019-12-05 07:41:49.922155", "item": {"default_route_ip": "192.168.2.1", "name": "t12", "pns_if": "t12pns_if", "pns_ip": "192.168.2.1/24", "tenant_if": "t12if", "tenant_ip": "192.168.2.2/24"}, "rc": 0, "start": "2019-12-05 07:41:49.911950", "stderr": "Device \"t12if\" does not exist.", "stderr_lines": ["Device \"t12if\" does not exist."], "stdout": "", "stdout_lines": []}

TASK [Attach Tenant VETH Pairs] *****************************************************************************************************************************
changed: [localhost] => (item={u'default_route_ip': u'192.168.2.1', u'name': u't12', u'pns_ip': u'192.168.2.1/24', u'tenant_if': u't12if', u'tenant_ip': u'192.168.2.2/24', u'pns_if': u't12pns_if'}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec pns ip link show \"t12pns_if\" ; if [ $? -ne 0 ] ; then ip link set \"t12pns_if\" netns pns ; fi\nip netns exec \"t12\" ip link show \"t12if\" ; if [ $? -ne 0 ] ; then ip link set \"t12if\" netns \"t12\" ; fi\nip netns exec pns ip link set dev \"t12pns_if\" up\nip netns exec \"t12\" ip link set dev \"t12if\" up\n", "delta": "0:00:00.237411", "end": "2019-12-05 07:41:50.425302", "item": {"default_route_ip": "192.168.2.1", "name": "t12", "pns_if": "t12pns_if", "pns_ip": "192.168.2.1/24", "tenant_if": "t12if", "tenant_ip": "192.168.2.2/24"}, "rc": 0, "start": "2019-12-05 07:41:50.187891", "stderr": "Device \"t12pns_if\" does not exist.\nDevice \"t12if\" does not exist.", "stderr_lines": ["Device \"t12pns_if\" does not exist.", "Device \"t12if\" does not exist."], "stdout": "", "stdout_lines": []}

TASK [Add IP addresses to Tenant VETH Pairs] ****************************************************************************************************************
changed: [localhost] => (item={u'default_route_ip': u'192.168.2.1', u'name': u't12', u'pns_ip': u'192.168.2.1/24', u'tenant_if': u't12if', u'tenant_ip': u'192.168.2.2/24', u'pns_if': u't12pns_if'}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec pns ip addr show \"t12pns_if\" | awk 'FNR==3{ print $2 }' | grep -w '^192.168.2.1/24' ; if [ $? -ne 0 ] ; then ip netns exec pns ip addr add \"192.168.2.1/24\" dev \"t12pns_if\" ; fi\nip netns exec \"t12\" ip addr show \"t12if\" | awk 'FNR==3{ print $2 }' | grep -w '^192.168.2.2/24' ; if [ $? -ne 0 ] ; then ip netns exec \"t12\" ip addr add \"192.168.2.2/24\" dev \"t12if\" ; fi\n", "delta": "0:00:00.140426", "end": "2019-12-05 07:41:50.881428", "item": {"default_route_ip": "192.168.2.1", "name": "t12", "pns_if": "t12pns_if", "pns_ip": "192.168.2.1/24", "tenant_if": "t12if", "tenant_ip": "192.168.2.2/24"}, "rc": 0, "start": "2019-12-05 07:41:50.741002", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Create Namespace VETH Pairs] **************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.11.1/24', u'ns_name': u't12', u'ns_if': u't12if', u'if': u'p1'}], u'default_route_ip': u'10.1.11.1', u'bridge_name': u't12br1', u'dns': [{u'dnsif': u't12s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't12s1_dnsbrif'}], u'ns_name': u't12ns1', u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't12_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't12br1if1', u'vmif': u't12VM1if1'}, {u'mem': 4, u'name': u't12_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't12br1if2', u'vmif': u't12VM2if1'}], u'vxlan': [{u'local_ip': u'10.1.11.2', u'dsport': 4789, u'dev': u't12s1if', u'tenant_route_ip': u'192.168.2.2', u'remote_route': u'10.2.11.0/24', u'subnet_route': u'10.1.11.0/24', u'v_name': u'vxlan_t12s1', u'id': 42, u'remote_ip': u'10.2.11.2'}]}, {u'tenant_sub_ip': u'10.1.11.2/24', u'tenant_ns_ip': u'10.1.11.1/24', u'tenant_ns_if': u't12ns1if', u'tenant_sub_if': u't12s1if', u'tenant_ns_name': u't12'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip link show \"t12ns1if\" ; if [ $? -ne 0 ] ; then ip link add \"t12ns1if\" type veth peer name \"t12s1if\" ; fi\n", "delta": "0:00:00.016001", "end": "2019-12-05 07:41:51.200582", "item": [{"bridge_name": "t12br1", "default_route_ip": "10.1.11.1", "dns": [{"brif": "t12s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.5", "dnsif": "t12s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t12ns1", "route": [{"if": "p1", "ip": "10.1.11.1/24", "ns_if": "t12if", "ns_name": "t12"}], "subnet_ip": "1.1.1.0/24", "vms": [{"brif": "t12br1if1", "disk": "10G", "mem": 2, "name": "t12_VM1", "vcpu": 4, "vmif": "t12VM1if1"}, {"brif": "t12br1if2", "disk": "10G", "mem": 4, "name": "t12_VM2", "vcpu": 2, "vmif": "t12VM2if1"}], "vxlan": [{"dev": "t12s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.11.2", "remote_ip": "10.2.11.2", "remote_route": "10.2.11.0/24", "subnet_route": "10.1.11.0/24", "tenant_route_ip": "192.168.2.2", "v_name": "vxlan_t12s1"}]}, {"tenant_ns_if": "t12ns1if", "tenant_ns_ip": "10.1.11.1/24", "tenant_ns_name": "t12", "tenant_sub_if": "t12s1if", "tenant_sub_ip": "10.1.11.2/24"}], "rc": 0, "start": "2019-12-05 07:41:51.184581", "stderr": "Device \"t12ns1if\" does not exist.", "stderr_lines": ["Device \"t12ns1if\" does not exist."], "stdout": "", "stdout_lines": []}

TASK [Attach Namespace VETH Pairs] **************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.11.1/24', u'ns_name': u't12', u'ns_if': u't12if', u'if': u'p1'}], u'default_route_ip': u'10.1.11.1', u'bridge_name': u't12br1', u'dns': [{u'dnsif': u't12s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't12s1_dnsbrif'}], u'ns_name': u't12ns1', u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't12_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't12br1if1', u'vmif': u't12VM1if1'}, {u'mem': 4, u'name': u't12_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't12br1if2', u'vmif': u't12VM2if1'}], u'vxlan': [{u'local_ip': u'10.1.11.2', u'dsport': 4789, u'dev': u't12s1if', u'tenant_route_ip': u'192.168.2.2', u'remote_route': u'10.2.11.0/24', u'subnet_route': u'10.1.11.0/24', u'v_name': u'vxlan_t12s1', u'id': 42, u'remote_ip': u'10.2.11.2'}]}, {u'tenant_sub_ip': u'10.1.11.2/24', u'tenant_ns_ip': u'10.1.11.1/24', u'tenant_ns_if': u't12ns1if', u'tenant_sub_if': u't12s1if', u'tenant_ns_name': u't12'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t12\" ip link show \"t12ns1if\" ; if [ $? -ne 0 ] ; then ip link set \"t12ns1if\" netns \"t12\" ; fi\nip netns exec \"t12ns1\" ip link show \"t12s1if\" ; if [ $? -ne 0 ] ; then ip link set \"t12s1if\" netns \"t12ns1\" ; fi\n", "delta": "0:00:00.135683", "end": "2019-12-05 07:41:51.673949", "item": [{"bridge_name": "t12br1", "default_route_ip": "10.1.11.1", "dns": [{"brif": "t12s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.5", "dnsif": "t12s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t12ns1", "route": [{"if": "p1", "ip": "10.1.11.1/24", "ns_if": "t12if", "ns_name": "t12"}], "subnet_ip": "1.1.1.0/24", "vms": [{"brif": "t12br1if1", "disk": "10G", "mem": 2, "name": "t12_VM1", "vcpu": 4, "vmif": "t12VM1if1"}, {"brif": "t12br1if2", "disk": "10G", "mem": 4, "name": "t12_VM2", "vcpu": 2, "vmif": "t12VM2if1"}], "vxlan": [{"dev": "t12s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.11.2", "remote_ip": "10.2.11.2", "remote_route": "10.2.11.0/24", "subnet_route": "10.1.11.0/24", "tenant_route_ip": "192.168.2.2", "v_name": "vxlan_t12s1"}]}, {"tenant_ns_if": "t12ns1if", "tenant_ns_ip": "10.1.11.1/24", "tenant_ns_name": "t12", "tenant_sub_if": "t12s1if", "tenant_sub_ip": "10.1.11.2/24"}], "rc": 0, "start": "2019-12-05 07:41:51.538266", "stderr": "Device \"t12ns1if\" does not exist.\nDevice \"t12s1if\" does not exist.", "stderr_lines": ["Device \"t12ns1if\" does not exist.", "Device \"t12s1if\" does not exist."], "stdout": "", "stdout_lines": []}

TASK [Set Namespace VETH Pairs UP] **************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.11.1/24', u'ns_name': u't12', u'ns_if': u't12if', u'if': u'p1'}], u'default_route_ip': u'10.1.11.1', u'bridge_name': u't12br1', u'dns': [{u'dnsif': u't12s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't12s1_dnsbrif'}], u'ns_name': u't12ns1', u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't12_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't12br1if1', u'vmif': u't12VM1if1'}, {u'mem': 4, u'name': u't12_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't12br1if2', u'vmif': u't12VM2if1'}], u'vxlan': [{u'local_ip': u'10.1.11.2', u'dsport': 4789, u'dev': u't12s1if', u'tenant_route_ip': u'192.168.2.2', u'remote_route': u'10.2.11.0/24', u'subnet_route': u'10.1.11.0/24', u'v_name': u'vxlan_t12s1', u'id': 42, u'remote_ip': u'10.2.11.2'}]}, {u'tenant_sub_ip': u'10.1.11.2/24', u'tenant_ns_ip': u'10.1.11.1/24', u'tenant_ns_if': u't12ns1if', u'tenant_sub_if': u't12s1if', u'tenant_ns_name': u't12'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t12\" ip link set dev \"t12ns1if\" up\nip netns exec \"t12ns1\" ip link set dev \"t12s1if\" up\n", "delta": "0:00:00.081648", "end": "2019-12-05 07:41:52.101170", "item": [{"bridge_name": "t12br1", "default_route_ip": "10.1.11.1", "dns": [{"brif": "t12s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.5", "dnsif": "t12s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t12ns1", "route": [{"if": "p1", "ip": "10.1.11.1/24", "ns_if": "t12if", "ns_name": "t12"}], "subnet_ip": "1.1.1.0/24", "vms": [{"brif": "t12br1if1", "disk": "10G", "mem": 2, "name": "t12_VM1", "vcpu": 4, "vmif": "t12VM1if1"}, {"brif": "t12br1if2", "disk": "10G", "mem": 4, "name": "t12_VM2", "vcpu": 2, "vmif": "t12VM2if1"}], "vxlan": [{"dev": "t12s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.11.2", "remote_ip": "10.2.11.2", "remote_route": "10.2.11.0/24", "subnet_route": "10.1.11.0/24", "tenant_route_ip": "192.168.2.2", "v_name": "vxlan_t12s1"}]}, {"tenant_ns_if": "t12ns1if", "tenant_ns_ip": "10.1.11.1/24", "tenant_ns_name": "t12", "tenant_sub_if": "t12s1if", "tenant_sub_ip": "10.1.11.2/24"}], "rc": 0, "start": "2019-12-05 07:41:52.019522", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Add IP addresses to Namespace VETH Pairs] *************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.11.1/24', u'ns_name': u't12', u'ns_if': u't12if', u'if': u'p1'}], u'default_route_ip': u'10.1.11.1', u'bridge_name': u't12br1', u'dns': [{u'dnsif': u't12s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't12s1_dnsbrif'}], u'ns_name': u't12ns1', u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't12_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't12br1if1', u'vmif': u't12VM1if1'}, {u'mem': 4, u'name': u't12_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't12br1if2', u'vmif': u't12VM2if1'}], u'vxlan': [{u'local_ip': u'10.1.11.2', u'dsport': 4789, u'dev': u't12s1if', u'tenant_route_ip': u'192.168.2.2', u'remote_route': u'10.2.11.0/24', u'subnet_route': u'10.1.11.0/24', u'v_name': u'vxlan_t12s1', u'id': 42, u'remote_ip': u'10.2.11.2'}]}, {u'tenant_sub_ip': u'10.1.11.2/24', u'tenant_ns_ip': u'10.1.11.1/24', u'tenant_ns_if': u't12ns1if', u'tenant_sub_if': u't12s1if', u'tenant_ns_name': u't12'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t12ns1\" ip addr show \"t12s1if\" | awk 'FNR==3{ print $2 }' | grep -w '^10.1.11.2/24' ; if [ $? -ne 0 ] ; then ip netns exec \"t12ns1\" ip addr add \"10.1.11.2/24\" dev \"t12s1if\" ; fi\n\nip netns exec \"t12\" ip addr show \"t12ns1if\" | awk 'FNR==3{ print $2 }' | grep -w '^10.1.11.1/24' ; if [ $? -ne 0 ] ; then ip netns exec \"t12\" ip addr add \"10.1.11.1/24\" dev \"t12ns1if\" ; fi\n", "delta": "0:00:00.140996", "end": "2019-12-05 07:41:52.533111", "item": [{"bridge_name": "t12br1", "default_route_ip": "10.1.11.1", "dns": [{"brif": "t12s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.5", "dnsif": "t12s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t12ns1", "route": [{"if": "p1", "ip": "10.1.11.1/24", "ns_if": "t12if", "ns_name": "t12"}], "subnet_ip": "1.1.1.0/24", "vms": [{"brif": "t12br1if1", "disk": "10G", "mem": 2, "name": "t12_VM1", "vcpu": 4, "vmif": "t12VM1if1"}, {"brif": "t12br1if2", "disk": "10G", "mem": 4, "name": "t12_VM2", "vcpu": 2, "vmif": "t12VM2if1"}], "vxlan": [{"dev": "t12s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.11.2", "remote_ip": "10.2.11.2", "remote_route": "10.2.11.0/24", "subnet_route": "10.1.11.0/24", "tenant_route_ip": "192.168.2.2", "v_name": "vxlan_t12s1"}]}, {"tenant_ns_if": "t12ns1if", "tenant_ns_ip": "10.1.11.1/24", "tenant_ns_name": "t12", "tenant_sub_if": "t12s1if", "tenant_sub_ip": "10.1.11.2/24"}], "rc": 0, "start": "2019-12-05 07:41:52.392115", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Add IP Route to Tenant] *******************************************************************************************************************************
changed: [localhost] => (item={u'default_route_ip': u'192.168.2.1', u'name': u't12', u'pns_ip': u'192.168.2.1/24', u'tenant_if': u't12if', u'tenant_ip': u'192.168.2.2/24', u'pns_if': u't12pns_if'}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t12\" ip route show default | grep -w '[d]efault via 192.168.2.1' ; if [ $? -ne 0 ] ; then ip netns exec \"t12\" ip route add default via \"192.168.2.1\" ; fi\n", "delta": "0:00:00.072419", "end": "2019-12-05 07:41:52.893669", "item": {"default_route_ip": "192.168.2.1", "name": "t12", "pns_if": "t12pns_if", "pns_ip": "192.168.2.1/24", "tenant_if": "t12if", "tenant_ip": "192.168.2.2/24"}, "rc": 0, "start": "2019-12-05 07:41:52.821250", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Add IP Route to Tenant Subnet] ************************************************************************************************************************
changed: [localhost] => (item={u'route': [{u'ip': u'10.1.11.1/24', u'ns_name': u't12', u'ns_if': u't12if', u'if': u'p1'}], u'default_route_ip': u'10.1.11.1', u'bridge_name': u't12br1', u'dns': [{u'dnsif': u't12s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't12s1_dnsbrif'}], u'ns_name': u't12ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.11.2/24', u'tenant_ns_ip': u'10.1.11.1/24', u'tenant_ns_if': u't12ns1if', u'tenant_ns_name': u't12', u'tenant_sub_if': u't12s1if'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't12_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't12br1if1', u'vmif': u't12VM1if1'}, {u'mem': 4, u'name': u't12_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't12br1if2', u'vmif': u't12VM2if1'}], u'vxlan': [{u'local_ip': u'10.1.11.2', u'tenant_route_ip': u'192.168.2.2', u'dsport': 4789, u'dev': u't12s1if', u'subnet_route': u'10.1.11.0/24', u'remote_route': u'10.2.11.0/24', u'v_name': u'vxlan_t12s1', u'id': 42, u'remote_ip': u'10.2.11.2'}]}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t12ns1\" ip route show default | grep -w '[d]efault via 10.1.11.1' ; if [ $? -ne 0 ] ; then ip netns exec \"t12ns1\" ip route add default via \"10.1.11.1\" ; fi\n", "delta": "0:00:00.084211", "end": "2019-12-05 07:41:53.240988", "item": {"bridge_name": "t12br1", "default_route_ip": "10.1.11.1", "dns": [{"brif": "t12s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.5", "dnsif": "t12s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t12ns1", "route": [{"if": "p1", "ip": "10.1.11.1/24", "ns_if": "t12if", "ns_name": "t12"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t12ns1if", "tenant_ns_ip": "10.1.11.1/24", "tenant_ns_name": "t12", "tenant_sub_if": "t12s1if", "tenant_sub_ip": "10.1.11.2/24"}], "vms": [{"brif": "t12br1if1", "disk": "10G", "mem": 2, "name": "t12_VM1", "vcpu": 4, "vmif": "t12VM1if1"}, {"brif": "t12br1if2", "disk": "10G", "mem": 4, "name": "t12_VM2", "vcpu": 2, "vmif": "t12VM2if1"}], "vxlan": [{"dev": "t12s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.11.2", "remote_ip": "10.2.11.2", "remote_route": "10.2.11.0/24", "subnet_route": "10.1.11.0/24", "tenant_route_ip": "192.168.2.2", "v_name": "vxlan_t12s1"}]}, "rc": 0, "start": "2019-12-05 07:41:53.156777", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Create bridge inside namespace] ***********************************************************************************************************************
changed: [localhost] => (item={u'route': [{u'ip': u'10.1.11.1/24', u'ns_name': u't12', u'ns_if': u't12if', u'if': u'p1'}], u'default_route_ip': u'10.1.11.1', u'bridge_name': u't12br1', u'dns': [{u'dnsif': u't12s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't12s1_dnsbrif'}], u'ns_name': u't12ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.11.2/24', u'tenant_ns_ip': u'10.1.11.1/24', u'tenant_ns_if': u't12ns1if', u'tenant_ns_name': u't12', u'tenant_sub_if': u't12s1if'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't12_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't12br1if1', u'vmif': u't12VM1if1'}, {u'mem': 4, u'name': u't12_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't12br1if2', u'vmif': u't12VM2if1'}], u'vxlan': [{u'local_ip': u'10.1.11.2', u'tenant_route_ip': u'192.168.2.2', u'dsport': 4789, u'dev': u't12s1if', u'subnet_route': u'10.1.11.0/24', u'remote_route': u'10.2.11.0/24', u'v_name': u'vxlan_t12s1', u'id': 42, u'remote_ip': u'10.2.11.2'}]}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t12ns1\" brctl show | grep -w '^t12br1'; if [ $? -ne 0 ] ; then ip netns exec \"t12ns1\" brctl addbr \"t12br1\" ; fi\nip netns exec \"t12ns1\" ip link set dev \"t12br1\" up\n", "delta": "0:00:00.130591", "end": "2019-12-05 07:41:53.689357", "item": {"bridge_name": "t12br1", "default_route_ip": "10.1.11.1", "dns": [{"brif": "t12s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.5", "dnsif": "t12s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t12ns1", "route": [{"if": "p1", "ip": "10.1.11.1/24", "ns_if": "t12if", "ns_name": "t12"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t12ns1if", "tenant_ns_ip": "10.1.11.1/24", "tenant_ns_name": "t12", "tenant_sub_if": "t12s1if", "tenant_sub_ip": "10.1.11.2/24"}], "vms": [{"brif": "t12br1if1", "disk": "10G", "mem": 2, "name": "t12_VM1", "vcpu": 4, "vmif": "t12VM1if1"}, {"brif": "t12br1if2", "disk": "10G", "mem": 4, "name": "t12_VM2", "vcpu": 2, "vmif": "t12VM2if1"}], "vxlan": [{"dev": "t12s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.11.2", "remote_ip": "10.2.11.2", "remote_route": "10.2.11.0/24", "subnet_route": "10.1.11.0/24", "tenant_route_ip": "192.168.2.2", "v_name": "vxlan_t12s1"}]}, "rc": 0, "start": "2019-12-05 07:41:53.558766", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Create DNS VETH Pair] *********************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.11.1/24', u'ns_name': u't12', u'ns_if': u't12if', u'if': u'p1'}], u'default_route_ip': u'10.1.11.1', u'bridge_name': u't12br1', u'ns_name': u't12ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.11.2/24', u'tenant_ns_ip': u'10.1.11.1/24', u'tenant_ns_if': u't12ns1if', u'tenant_sub_if': u't12s1if', u'tenant_ns_name': u't12'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't12_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't12br1if1', u'vmif': u't12VM1if1'}, {u'mem': 4, u'name': u't12_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't12br1if2', u'vmif': u't12VM2if1'}], u'vxlan': [{u'local_ip': u'10.1.11.2', u'dsport': 4789, u'dev': u't12s1if', u'tenant_route_ip': u'192.168.2.2', u'remote_route': u'10.2.11.0/24', u'subnet_route': u'10.1.11.0/24', u'v_name': u'vxlan_t12s1', u'id': 42, u'remote_ip': u'10.2.11.2'}]}, {u'dnsif': u't12s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't12s1_dnsbrif'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t12ns1\" ip link show \"t12s1_dnsbrif\" ; if [ $? -ne 0 ] ; then ip netns exec \"t12ns1\" ip link add \"t12s1_dnsbrif\" type veth peer name \"t12s1_dnsif\" ; fi\nip netns exec \"t12ns1\" ip link set dev \"t12s1_dnsbrif\" up\nip netns exec \"t12ns1\" ip link set dev \"t12s1_dnsif\" up\n", "delta": "0:00:00.181877", "end": "2019-12-05 07:41:54.181318", "item": [{"bridge_name": "t12br1", "default_route_ip": "10.1.11.1", "ns_name": "t12ns1", "route": [{"if": "p1", "ip": "10.1.11.1/24", "ns_if": "t12if", "ns_name": "t12"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t12ns1if", "tenant_ns_ip": "10.1.11.1/24", "tenant_ns_name": "t12", "tenant_sub_if": "t12s1if", "tenant_sub_ip": "10.1.11.2/24"}], "vms": [{"brif": "t12br1if1", "disk": "10G", "mem": 2, "name": "t12_VM1", "vcpu": 4, "vmif": "t12VM1if1"}, {"brif": "t12br1if2", "disk": "10G", "mem": 4, "name": "t12_VM2", "vcpu": 2, "vmif": "t12VM2if1"}], "vxlan": [{"dev": "t12s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.11.2", "remote_ip": "10.2.11.2", "remote_route": "10.2.11.0/24", "subnet_route": "10.1.11.0/24", "tenant_route_ip": "192.168.2.2", "v_name": "vxlan_t12s1"}]}, {"brif": "t12s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.5", "dnsif": "t12s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "rc": 0, "start": "2019-12-05 07:41:53.999441", "stderr": "Device \"t12s1_dnsbrif\" does not exist.", "stderr_lines": ["Device \"t12s1_dnsbrif\" does not exist."], "stdout": "", "stdout_lines": []}

TASK [Attach DNS VETH Pair] *********************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.11.1/24', u'ns_name': u't12', u'ns_if': u't12if', u'if': u'p1'}], u'default_route_ip': u'10.1.11.1', u'bridge_name': u't12br1', u'ns_name': u't12ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.11.2/24', u'tenant_ns_ip': u'10.1.11.1/24', u'tenant_ns_if': u't12ns1if', u'tenant_sub_if': u't12s1if', u'tenant_ns_name': u't12'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't12_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't12br1if1', u'vmif': u't12VM1if1'}, {u'mem': 4, u'name': u't12_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't12br1if2', u'vmif': u't12VM2if1'}], u'vxlan': [{u'local_ip': u'10.1.11.2', u'dsport': 4789, u'dev': u't12s1if', u'tenant_route_ip': u'192.168.2.2', u'remote_route': u'10.2.11.0/24', u'subnet_route': u'10.1.11.0/24', u'v_name': u'vxlan_t12s1', u'id': 42, u'remote_ip': u'10.2.11.2'}]}, {u'dnsif': u't12s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't12s1_dnsbrif'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t12ns1\" brctl show \"t12br1\" | grep -w 't12s1_dnsbrif' ; if [ $? -ne 0 ] ; then ip netns exec \"t12ns1\" brctl addif \"t12br1\" \"t12s1_dnsbrif\" ; fi\n", "delta": "0:00:00.078086", "end": "2019-12-05 07:41:54.593213", "item": [{"bridge_name": "t12br1", "default_route_ip": "10.1.11.1", "ns_name": "t12ns1", "route": [{"if": "p1", "ip": "10.1.11.1/24", "ns_if": "t12if", "ns_name": "t12"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t12ns1if", "tenant_ns_ip": "10.1.11.1/24", "tenant_ns_name": "t12", "tenant_sub_if": "t12s1if", "tenant_sub_ip": "10.1.11.2/24"}], "vms": [{"brif": "t12br1if1", "disk": "10G", "mem": 2, "name": "t12_VM1", "vcpu": 4, "vmif": "t12VM1if1"}, {"brif": "t12br1if2", "disk": "10G", "mem": 4, "name": "t12_VM2", "vcpu": 2, "vmif": "t12VM2if1"}], "vxlan": [{"dev": "t12s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.11.2", "remote_ip": "10.2.11.2", "remote_route": "10.2.11.0/24", "subnet_route": "10.1.11.0/24", "tenant_route_ip": "192.168.2.2", "v_name": "vxlan_t12s1"}]}, {"brif": "t12s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.5", "dnsif": "t12s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "rc": 0, "start": "2019-12-05 07:41:54.515127", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Create VETH Pairs] ************************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.11.1/24', u'ns_name': u't12', u'ns_if': u't12if', u'if': u'p1'}], u'default_route_ip': u'10.1.11.1', u'bridge_name': u't12br1', u'dns': [{u'dnsif': u't12s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't12s1_dnsbrif'}], u'ns_name': u't12ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.11.2/24', u'tenant_ns_ip': u'10.1.11.1/24', u'tenant_ns_if': u't12ns1if', u'tenant_sub_if': u't12s1if', u'tenant_ns_name': u't12'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.1.11.2', u'dsport': 4789, u'dev': u't12s1if', u'tenant_route_ip': u'192.168.2.2', u'remote_route': u'10.2.11.0/24', u'subnet_route': u'10.1.11.0/24', u'v_name': u'vxlan_t12s1', u'id': 42, u'remote_ip': u'10.2.11.2'}]}, {u'mem': 2, u'name': u't12_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't12br1if1', u'vmif': u't12VM1if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip link show \"t12br1if1\" ; if [ $? -ne 0 ] ; then ip link add \"t12VM1if1\" type veth peer name \"t12br1if1\" ; fi\nip link set dev \"t12br1if1\" up\nip link set dev \"t12VM1if1\" up\n", "delta": "0:00:00.022404", "end": "2019-12-05 07:41:54.923994", "item": [{"bridge_name": "t12br1", "default_route_ip": "10.1.11.1", "dns": [{"brif": "t12s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.5", "dnsif": "t12s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t12ns1", "route": [{"if": "p1", "ip": "10.1.11.1/24", "ns_if": "t12if", "ns_name": "t12"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t12ns1if", "tenant_ns_ip": "10.1.11.1/24", "tenant_ns_name": "t12", "tenant_sub_if": "t12s1if", "tenant_sub_ip": "10.1.11.2/24"}], "vxlan": [{"dev": "t12s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.11.2", "remote_ip": "10.2.11.2", "remote_route": "10.2.11.0/24", "subnet_route": "10.1.11.0/24", "tenant_route_ip": "192.168.2.2", "v_name": "vxlan_t12s1"}]}, {"brif": "t12br1if1", "disk": "10G", "mem": 2, "name": "t12_VM1", "vcpu": 4, "vmif": "t12VM1if1"}], "rc": 0, "start": "2019-12-05 07:41:54.901590", "stderr": "Device \"t12br1if1\" does not exist.", "stderr_lines": ["Device \"t12br1if1\" does not exist."], "stdout": "", "stdout_lines": []}
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.11.1/24', u'ns_name': u't12', u'ns_if': u't12if', u'if': u'p1'}], u'default_route_ip': u'10.1.11.1', u'bridge_name': u't12br1', u'dns': [{u'dnsif': u't12s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't12s1_dnsbrif'}], u'ns_name': u't12ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.11.2/24', u'tenant_ns_ip': u'10.1.11.1/24', u'tenant_ns_if': u't12ns1if', u'tenant_sub_if': u't12s1if', u'tenant_ns_name': u't12'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.1.11.2', u'dsport': 4789, u'dev': u't12s1if', u'tenant_route_ip': u'192.168.2.2', u'remote_route': u'10.2.11.0/24', u'subnet_route': u'10.1.11.0/24', u'v_name': u'vxlan_t12s1', u'id': 42, u'remote_ip': u'10.2.11.2'}]}, {u'mem': 4, u'name': u't12_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't12br1if2', u'vmif': u't12VM2if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip link show \"t12br1if2\" ; if [ $? -ne 0 ] ; then ip link add \"t12VM2if1\" type veth peer name \"t12br1if2\" ; fi\nip link set dev \"t12br1if2\" up\nip link set dev \"t12VM2if1\" up\n", "delta": "0:00:00.024381", "end": "2019-12-05 07:41:55.189897", "item": [{"bridge_name": "t12br1", "default_route_ip": "10.1.11.1", "dns": [{"brif": "t12s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.5", "dnsif": "t12s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t12ns1", "route": [{"if": "p1", "ip": "10.1.11.1/24", "ns_if": "t12if", "ns_name": "t12"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t12ns1if", "tenant_ns_ip": "10.1.11.1/24", "tenant_ns_name": "t12", "tenant_sub_if": "t12s1if", "tenant_sub_ip": "10.1.11.2/24"}], "vxlan": [{"dev": "t12s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.11.2", "remote_ip": "10.2.11.2", "remote_route": "10.2.11.0/24", "subnet_route": "10.1.11.0/24", "tenant_route_ip": "192.168.2.2", "v_name": "vxlan_t12s1"}]}, {"brif": "t12br1if2", "disk": "10G", "mem": 4, "name": "t12_VM2", "vcpu": 2, "vmif": "t12VM2if1"}], "rc": 0, "start": "2019-12-05 07:41:55.165516", "stderr": "Device \"t12br1if2\" does not exist.", "stderr_lines": ["Device \"t12br1if2\" does not exist."], "stdout": "", "stdout_lines": []}

TASK [Attach VETH Pairs] ************************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.11.1/24', u'ns_name': u't12', u'ns_if': u't12if', u'if': u'p1'}], u'default_route_ip': u'10.1.11.1', u'bridge_name': u't12br1', u'dns': [{u'dnsif': u't12s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't12s1_dnsbrif'}], u'ns_name': u't12ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.11.2/24', u'tenant_ns_ip': u'10.1.11.1/24', u'tenant_ns_if': u't12ns1if', u'tenant_sub_if': u't12s1if', u'tenant_ns_name': u't12'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.1.11.2', u'dsport': 4789, u'dev': u't12s1if', u'tenant_route_ip': u'192.168.2.2', u'remote_route': u'10.2.11.0/24', u'subnet_route': u'10.1.11.0/24', u'v_name': u'vxlan_t12s1', u'id': 42, u'remote_ip': u'10.2.11.2'}]}, {u'mem': 2, u'name': u't12_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't12br1if1', u'vmif': u't12VM1if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip link show \"t12br1if1\" ; if [ $? -eq 0 ] ; then ip link set \"t12br1if1\" netns \"t12ns1\" ; fi\nip netns exec \"t12ns1\" brctl show \"t12br1\" | grep -w 't12br1if1' ; if [ $? -ne 0 ] ; then ip netns exec \"t12ns1\" brctl addif \"t12br1\" \"t12br1if1\" ; fi\n", "delta": "0:00:00.151574", "end": "2019-12-05 07:41:55.661146", "item": [{"bridge_name": "t12br1", "default_route_ip": "10.1.11.1", "dns": [{"brif": "t12s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.5", "dnsif": "t12s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t12ns1", "route": [{"if": "p1", "ip": "10.1.11.1/24", "ns_if": "t12if", "ns_name": "t12"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t12ns1if", "tenant_ns_ip": "10.1.11.1/24", "tenant_ns_name": "t12", "tenant_sub_if": "t12s1if", "tenant_sub_ip": "10.1.11.2/24"}], "vxlan": [{"dev": "t12s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.11.2", "remote_ip": "10.2.11.2", "remote_route": "10.2.11.0/24", "subnet_route": "10.1.11.0/24", "tenant_route_ip": "192.168.2.2", "v_name": "vxlan_t12s1"}]}, {"brif": "t12br1if1", "disk": "10G", "mem": 2, "name": "t12_VM1", "vcpu": 4, "vmif": "t12VM1if1"}], "rc": 0, "start": "2019-12-05 07:41:55.509572", "stderr": "", "stderr_lines": [], "stdout": "99: t12br1if1@t12VM1if1: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP mode DEFAULT group default qlen 1000\n    link/ether 3a:b7:91:e7:22:50 brd ff:ff:ff:ff:ff:ff", "stdout_lines": ["99: t12br1if1@t12VM1if1: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP mode DEFAULT group default qlen 1000", "    link/ether 3a:b7:91:e7:22:50 brd ff:ff:ff:ff:ff:ff"]}
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.11.1/24', u'ns_name': u't12', u'ns_if': u't12if', u'if': u'p1'}], u'default_route_ip': u'10.1.11.1', u'bridge_name': u't12br1', u'dns': [{u'dnsif': u't12s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't12s1_dnsbrif'}], u'ns_name': u't12ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.11.2/24', u'tenant_ns_ip': u'10.1.11.1/24', u'tenant_ns_if': u't12ns1if', u'tenant_sub_if': u't12s1if', u'tenant_ns_name': u't12'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.1.11.2', u'dsport': 4789, u'dev': u't12s1if', u'tenant_route_ip': u'192.168.2.2', u'remote_route': u'10.2.11.0/24', u'subnet_route': u'10.1.11.0/24', u'v_name': u'vxlan_t12s1', u'id': 42, u'remote_ip': u'10.2.11.2'}]}, {u'mem': 4, u'name': u't12_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't12br1if2', u'vmif': u't12VM2if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip link show \"t12br1if2\" ; if [ $? -eq 0 ] ; then ip link set \"t12br1if2\" netns \"t12ns1\" ; fi\nip netns exec \"t12ns1\" brctl show \"t12br1\" | grep -w 't12br1if2' ; if [ $? -ne 0 ] ; then ip netns exec \"t12ns1\" brctl addif \"t12br1\" \"t12br1if2\" ; fi\n", "delta": "0:00:00.109339", "end": "2019-12-05 07:41:55.980978", "item": [{"bridge_name": "t12br1", "default_route_ip": "10.1.11.1", "dns": [{"brif": "t12s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.5", "dnsif": "t12s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t12ns1", "route": [{"if": "p1", "ip": "10.1.11.1/24", "ns_if": "t12if", "ns_name": "t12"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t12ns1if", "tenant_ns_ip": "10.1.11.1/24", "tenant_ns_name": "t12", "tenant_sub_if": "t12s1if", "tenant_sub_ip": "10.1.11.2/24"}], "vxlan": [{"dev": "t12s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.11.2", "remote_ip": "10.2.11.2", "remote_route": "10.2.11.0/24", "subnet_route": "10.1.11.0/24", "tenant_route_ip": "192.168.2.2", "v_name": "vxlan_t12s1"}]}, {"brif": "t12br1if2", "disk": "10G", "mem": 4, "name": "t12_VM2", "vcpu": 2, "vmif": "t12VM2if1"}], "rc": 0, "start": "2019-12-05 07:41:55.871639", "stderr": "", "stderr_lines": [], "stdout": "101: t12br1if2@t12VM2if1: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP mode DEFAULT group default qlen 1000\n    link/ether 66:14:64:1a:c6:56 brd ff:ff:ff:ff:ff:ff", "stdout_lines": ["101: t12br1if2@t12VM2if1: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP mode DEFAULT group default qlen 1000", "    link/ether 66:14:64:1a:c6:56 brd ff:ff:ff:ff:ff:ff"]}

TASK [All interfaces and bridges UP] ************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.11.1/24', u'ns_name': u't12', u'ns_if': u't12if', u'if': u'p1'}], u'default_route_ip': u'10.1.11.1', u'bridge_name': u't12br1', u'dns': [{u'dnsif': u't12s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't12s1_dnsbrif'}], u'ns_name': u't12ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.11.2/24', u'tenant_ns_ip': u'10.1.11.1/24', u'tenant_ns_if': u't12ns1if', u'tenant_sub_if': u't12s1if', u'tenant_ns_name': u't12'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.1.11.2', u'dsport': 4789, u'dev': u't12s1if', u'tenant_route_ip': u'192.168.2.2', u'remote_route': u'10.2.11.0/24', u'subnet_route': u'10.1.11.0/24', u'v_name': u'vxlan_t12s1', u'id': 42, u'remote_ip': u'10.2.11.2'}]}, {u'mem': 2, u'name': u't12_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't12br1if1', u'vmif': u't12VM1if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t12ns1\" ip link set \"t12br1if1\" up\nip netns exec \"t12ns1\" ip link set dev \"t12br1\" up\n", "delta": "0:00:00.073525", "end": "2019-12-05 07:41:56.329116", "item": [{"bridge_name": "t12br1", "default_route_ip": "10.1.11.1", "dns": [{"brif": "t12s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.5", "dnsif": "t12s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t12ns1", "route": [{"if": "p1", "ip": "10.1.11.1/24", "ns_if": "t12if", "ns_name": "t12"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t12ns1if", "tenant_ns_ip": "10.1.11.1/24", "tenant_ns_name": "t12", "tenant_sub_if": "t12s1if", "tenant_sub_ip": "10.1.11.2/24"}], "vxlan": [{"dev": "t12s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.11.2", "remote_ip": "10.2.11.2", "remote_route": "10.2.11.0/24", "subnet_route": "10.1.11.0/24", "tenant_route_ip": "192.168.2.2", "v_name": "vxlan_t12s1"}]}, {"brif": "t12br1if1", "disk": "10G", "mem": 2, "name": "t12_VM1", "vcpu": 4, "vmif": "t12VM1if1"}], "rc": 0, "start": "2019-12-05 07:41:56.255591", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}
INFO:root: 07:42:22.291064 Printing the yaml input file
INFO:root: 07:42:22.291192 {'C1': [{'subnet_addr': '1.1.1.0/24', 'VM': [{'name': 'VM1', 'disk': '10G', 'mem': 2, 'vcpu': 4, 'internet_access': True}, {'name': 'VM2', 'disk': '10G', 'mem': 4, 'vcpu': 2, 'internet_access': False}]}], 'C2': [{'subnet_addr': '1.1.1.0/24', 'VM': [{'name': 'VM4', 'disk': '10G', 'mem': 2, 'vcpu': 4, 'internet_access': True}]}, {'subnet_addr': '2.2.2.0/24', 'VM': [{'name': 'VM3', 'disk': '10G', 'mem': 3, 'vcpu': 2, 'internet_access': True}]}], 'MISC': [{'LOG_ENABLE': True}, {'GUI': True}]}
INFO:root: 07:42:22.291292 Provided subnet in C1: 1.1.1.0/24 is valid
INFO:root: 07:42:22.291345 Provided subnet in C2: 1.1.1.0/24 is valid
INFO:root: 07:42:22.291389 Provided subnet in C2: 2.2.2.0/24 is valid
Using /etc/ansible/ansible.cfg as config file

PLAY [main] *************************************************************************************************************************************************

TASK [Create Tenant Namespace] ******************************************************************************************************************************
changed: [localhost] => (item={u'default_route_ip': u'192.168.3.1', u'name': u't13', u'pns_ip': u'192.168.3.1/24', u'tenant_if': u't13if', u'tenant_ip': u'192.168.3.2/24', u'pns_if': u't13pns_if'}) => {"ansible_loop_var": "item", "changed": true, "cmd": ["ip", "netns", "add", "t13"], "delta": "0:00:00.056073", "end": "2019-12-05 07:42:23.425505", "item": {"default_route_ip": "192.168.3.1", "name": "t13", "pns_if": "t13pns_if", "pns_ip": "192.168.3.1/24", "tenant_if": "t13if", "tenant_ip": "192.168.3.2/24"}, "rc": 0, "start": "2019-12-05 07:42:23.369432", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Create Subnet Namespace] ******************************************************************************************************************************
changed: [localhost] => (item={u'route': [{u'ip': u'10.1.21.1/24', u'ns_name': u't13', u'ns_if': u't13if', u'if': u'p1'}], u'default_route_ip': u'10.1.21.1', u'bridge_name': u't13br1', u'dns': [{u'dnsif': u't13s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't13s1_dnsbrif'}], u'ns_name': u't13ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.21.2/24', u'tenant_ns_ip': u'10.1.21.1/24', u'tenant_ns_if': u't13ns1if', u'tenant_ns_name': u't13', u'tenant_sub_if': u't13s1if'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't13_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't13br1if1', u'vmif': u't13VM1if1'}, {u'mem': 4, u'name': u't13_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't13br1if2', u'vmif': u't13VM2if1'}], u'vxlan': [{u'local_ip': u'10.1.21.2', u'tenant_route_ip': u'192.168.3.2', u'dsport': 4789, u'dev': u't13s1if', u'subnet_route': u'10.1.21.0/24', u'remote_route': u'10.2.21.0/24', u'v_name': u'vxlan_t13s1', u'id': 42, u'remote_ip': u'10.2.21.2'}]}) => {"ansible_loop_var": "item", "changed": true, "cmd": ["ip", "netns", "add", "t13ns1"], "delta": "0:00:00.077121", "end": "2019-12-05 07:42:23.826164", "item": {"bridge_name": "t13br1", "default_route_ip": "10.1.21.1", "dns": [{"brif": "t13s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.5", "dnsif": "t13s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t13ns1", "route": [{"if": "p1", "ip": "10.1.21.1/24", "ns_if": "t13if", "ns_name": "t13"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t13ns1if", "tenant_ns_ip": "10.1.21.1/24", "tenant_ns_name": "t13", "tenant_sub_if": "t13s1if", "tenant_sub_ip": "10.1.21.2/24"}], "vms": [{"brif": "t13br1if1", "disk": "10G", "mem": 2, "name": "t13_VM1", "vcpu": 4, "vmif": "t13VM1if1"}, {"brif": "t13br1if2", "disk": "10G", "mem": 4, "name": "t13_VM2", "vcpu": 2, "vmif": "t13VM2if1"}], "vxlan": [{"dev": "t13s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.21.2", "remote_ip": "10.2.21.2", "remote_route": "10.2.21.0/24", "subnet_route": "10.1.21.0/24", "tenant_route_ip": "192.168.3.2", "v_name": "vxlan_t13s1"}]}, "rc": 0, "start": "2019-12-05 07:42:23.749043", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Create Tenant VETH pairs] *****************************************************************************************************************************
changed: [localhost] => (item={u'default_route_ip': u'192.168.3.1', u'name': u't13', u'pns_ip': u'192.168.3.1/24', u'tenant_if': u't13if', u'tenant_ip': u'192.168.3.2/24', u'pns_if': u't13pns_if'}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip link show \"t13if\" ; if [ $? -ne 0 ] ; then ip link add \"t13if\" type veth peer name \"t13pns_if\" ; fi\n", "delta": "0:00:00.017819", "end": "2019-12-05 07:42:24.173898", "item": {"default_route_ip": "192.168.3.1", "name": "t13", "pns_if": "t13pns_if", "pns_ip": "192.168.3.1/24", "tenant_if": "t13if", "tenant_ip": "192.168.3.2/24"}, "rc": 0, "start": "2019-12-05 07:42:24.156079", "stderr": "Device \"t13if\" does not exist.", "stderr_lines": ["Device \"t13if\" does not exist."], "stdout": "", "stdout_lines": []}

TASK [Attach Tenant VETH Pairs] *****************************************************************************************************************************
changed: [localhost] => (item={u'default_route_ip': u'192.168.3.1', u'name': u't13', u'pns_ip': u'192.168.3.1/24', u'tenant_if': u't13if', u'tenant_ip': u'192.168.3.2/24', u'pns_if': u't13pns_if'}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec pns ip link show \"t13pns_if\" ; if [ $? -ne 0 ] ; then ip link set \"t13pns_if\" netns pns ; fi\nip netns exec \"t13\" ip link show \"t13if\" ; if [ $? -ne 0 ] ; then ip link set \"t13if\" netns \"t13\" ; fi\nip netns exec pns ip link set dev \"t13pns_if\" up\nip netns exec \"t13\" ip link set dev \"t13if\" up\n", "delta": "0:00:00.219319", "end": "2019-12-05 07:42:24.765220", "item": {"default_route_ip": "192.168.3.1", "name": "t13", "pns_if": "t13pns_if", "pns_ip": "192.168.3.1/24", "tenant_if": "t13if", "tenant_ip": "192.168.3.2/24"}, "rc": 0, "start": "2019-12-05 07:42:24.545901", "stderr": "Device \"t13pns_if\" does not exist.\nDevice \"t13if\" does not exist.", "stderr_lines": ["Device \"t13pns_if\" does not exist.", "Device \"t13if\" does not exist."], "stdout": "", "stdout_lines": []}

TASK [Add IP addresses to Tenant VETH Pairs] ****************************************************************************************************************
INFO:root: 07:43:33.287462 Printing the yaml input file
INFO:root: 07:43:33.287575 {'C1': [{'subnet_addr': '1.1.1.0/24', 'VM': [{'name': 'VM1', 'disk': '10G', 'mem': 2, 'vcpu': 4, 'internet_access': True}, {'name': 'VM2', 'disk': '10G', 'mem': 4, 'vcpu': 2, 'internet_access': False}]}], 'C2': [{'subnet_addr': '1.1.1.0/24', 'VM': [{'name': 'VM4', 'disk': '10G', 'mem': 2, 'vcpu': 4, 'internet_access': True}]}, {'subnet_addr': '2.2.2.0/24', 'VM': [{'name': 'VM3', 'disk': '10G', 'mem': 3, 'vcpu': 2, 'internet_access': True}]}], 'MISC': [{'LOG_ENABLE': True}, {'GUI': True}]}
INFO:root: 07:43:33.287668 Provided subnet in C1: 1.1.1.0/24 is valid
INFO:root: 07:43:33.287719 Provided subnet in C2: 1.1.1.0/24 is valid
INFO:root: 07:43:33.287761 Provided subnet in C2: 2.2.2.0/24 is valid
Using /etc/ansible/ansible.cfg as config file

PLAY [main] *************************************************************************************************************************************************

TASK [Create Tenant Namespace] ******************************************************************************************************************************
changed: [localhost] => (item={u'default_route_ip': u'192.168.5.1', u'name': u't15', u'pns_ip': u'192.168.5.1/24', u'tenant_if': u't15if', u'tenant_ip': u'192.168.5.2/24', u'pns_if': u't15pns_if'}) => {"ansible_loop_var": "item", "changed": true, "cmd": ["ip", "netns", "add", "t15"], "delta": "0:00:00.054248", "end": "2019-12-05 07:43:34.486396", "item": {"default_route_ip": "192.168.5.1", "name": "t15", "pns_if": "t15pns_if", "pns_ip": "192.168.5.1/24", "tenant_if": "t15if", "tenant_ip": "192.168.5.2/24"}, "rc": 0, "start": "2019-12-05 07:43:34.432148", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Create Subnet Namespace] ******************************************************************************************************************************
changed: [localhost] => (item={u'route': [{u'ip': u'10.1.41.1/24', u'ns_name': u't15', u'ns_if': u't15if', u'if': u'p1'}], u'default_route_ip': u'10.1.41.1', u'bridge_name': u't15br1', u'dns': [{u'dnsif': u't15s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't15s1_dnsbrif'}], u'ns_name': u't15ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.41.2/24', u'tenant_ns_ip': u'10.1.41.1/24', u'tenant_ns_if': u't15ns1if', u'tenant_ns_name': u't15', u'tenant_sub_if': u't15s1if'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't15_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't15br1if1', u'vmif': u't15VM1if1'}, {u'mem': 4, u'name': u't15_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't15br1if2', u'vmif': u't15VM2if1'}], u'vxlan': [{u'local_ip': u'10.1.41.2', u'tenant_route_ip': u'192.168.5.2', u'dsport': 4789, u'dev': u't15s1if', u'subnet_route': u'10.1.41.0/24', u'remote_route': u'10.2.41.0/24', u'v_name': u'vxlan_t15s1', u'id': 42, u'remote_ip': u'10.2.41.2'}]}) => {"ansible_loop_var": "item", "changed": true, "cmd": ["ip", "netns", "add", "t15ns1"], "delta": "0:00:00.058359", "end": "2019-12-05 07:43:34.834046", "item": {"bridge_name": "t15br1", "default_route_ip": "10.1.41.1", "dns": [{"brif": "t15s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.5", "dnsif": "t15s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t15ns1", "route": [{"if": "p1", "ip": "10.1.41.1/24", "ns_if": "t15if", "ns_name": "t15"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t15ns1if", "tenant_ns_ip": "10.1.41.1/24", "tenant_ns_name": "t15", "tenant_sub_if": "t15s1if", "tenant_sub_ip": "10.1.41.2/24"}], "vms": [{"brif": "t15br1if1", "disk": "10G", "mem": 2, "name": "t15_VM1", "vcpu": 4, "vmif": "t15VM1if1"}, {"brif": "t15br1if2", "disk": "10G", "mem": 4, "name": "t15_VM2", "vcpu": 2, "vmif": "t15VM2if1"}], "vxlan": [{"dev": "t15s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.41.2", "remote_ip": "10.2.41.2", "remote_route": "10.2.41.0/24", "subnet_route": "10.1.41.0/24", "tenant_route_ip": "192.168.5.2", "v_name": "vxlan_t15s1"}]}, "rc": 0, "start": "2019-12-05 07:43:34.775687", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Create Tenant VETH pairs] *****************************************************************************************************************************
changed: [localhost] => (item={u'default_route_ip': u'192.168.5.1', u'name': u't15', u'pns_ip': u'192.168.5.1/24', u'tenant_if': u't15if', u'tenant_ip': u'192.168.5.2/24', u'pns_if': u't15pns_if'}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip link show \"t15if\" ; if [ $? -ne 0 ] ; then ip link add \"t15if\" type veth peer name \"t15pns_if\" ; fi\n", "delta": "0:00:00.011850", "end": "2019-12-05 07:43:35.145627", "item": {"default_route_ip": "192.168.5.1", "name": "t15", "pns_if": "t15pns_if", "pns_ip": "192.168.5.1/24", "tenant_if": "t15if", "tenant_ip": "192.168.5.2/24"}, "rc": 0, "start": "2019-12-05 07:43:35.133777", "stderr": "Device \"t15if\" does not exist.", "stderr_lines": ["Device \"t15if\" does not exist."], "stdout": "", "stdout_lines": []}

TASK [Attach Tenant VETH Pairs] *****************************************************************************************************************************
changed: [localhost] => (item={u'default_route_ip': u'192.168.5.1', u'name': u't15', u'pns_ip': u'192.168.5.1/24', u'tenant_if': u't15if', u'tenant_ip': u'192.168.5.2/24', u'pns_if': u't15pns_if'}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec pns ip link show \"t15pns_if\" ; if [ $? -ne 0 ] ; then ip link set \"t15pns_if\" netns pns ; fi\nip netns exec \"t15\" ip link show \"t15if\" ; if [ $? -ne 0 ] ; then ip link set \"t15if\" netns \"t15\" ; fi\nip netns exec pns ip link set dev \"t15pns_if\" up\nip netns exec \"t15\" ip link set dev \"t15if\" up\n", "delta": "0:00:00.223925", "end": "2019-12-05 07:43:35.649120", "item": {"default_route_ip": "192.168.5.1", "name": "t15", "pns_if": "t15pns_if", "pns_ip": "192.168.5.1/24", "tenant_if": "t15if", "tenant_ip": "192.168.5.2/24"}, "rc": 0, "start": "2019-12-05 07:43:35.425195", "stderr": "Device \"t15pns_if\" does not exist.\nDevice \"t15if\" does not exist.", "stderr_lines": ["Device \"t15pns_if\" does not exist.", "Device \"t15if\" does not exist."], "stdout": "", "stdout_lines": []}

TASK [Add IP addresses to Tenant VETH Pairs] ****************************************************************************************************************
changed: [localhost] => (item={u'default_route_ip': u'192.168.5.1', u'name': u't15', u'pns_ip': u'192.168.5.1/24', u'tenant_if': u't15if', u'tenant_ip': u'192.168.5.2/24', u'pns_if': u't15pns_if'}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec pns ip addr show \"t15pns_if\" | awk 'FNR==3{ print $2 }' | grep -w '^192.168.5.1/24' ; if [ $? -ne 0 ] ; then ip netns exec pns ip addr add \"192.168.5.1/24\" dev \"t15pns_if\" ; fi\nip netns exec \"t15\" ip addr show \"t15if\" | awk 'FNR==3{ print $2 }' | grep -w '^192.168.5.2/24' ; if [ $? -ne 0 ] ; then ip netns exec \"t15\" ip addr add \"192.168.5.2/24\" dev \"t15if\" ; fi\n", "delta": "0:00:00.165787", "end": "2019-12-05 07:43:36.073204", "item": {"default_route_ip": "192.168.5.1", "name": "t15", "pns_if": "t15pns_if", "pns_ip": "192.168.5.1/24", "tenant_if": "t15if", "tenant_ip": "192.168.5.2/24"}, "rc": 0, "start": "2019-12-05 07:43:35.907417", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Create Namespace VETH Pairs] **************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.41.1/24', u'ns_name': u't15', u'ns_if': u't15if', u'if': u'p1'}], u'default_route_ip': u'10.1.41.1', u'bridge_name': u't15br1', u'dns': [{u'dnsif': u't15s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't15s1_dnsbrif'}], u'ns_name': u't15ns1', u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't15_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't15br1if1', u'vmif': u't15VM1if1'}, {u'mem': 4, u'name': u't15_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't15br1if2', u'vmif': u't15VM2if1'}], u'vxlan': [{u'local_ip': u'10.1.41.2', u'dsport': 4789, u'dev': u't15s1if', u'tenant_route_ip': u'192.168.5.2', u'remote_route': u'10.2.41.0/24', u'subnet_route': u'10.1.41.0/24', u'v_name': u'vxlan_t15s1', u'id': 42, u'remote_ip': u'10.2.41.2'}]}, {u'tenant_sub_ip': u'10.1.41.2/24', u'tenant_ns_ip': u'10.1.41.1/24', u'tenant_ns_if': u't15ns1if', u'tenant_sub_if': u't15s1if', u'tenant_ns_name': u't15'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip link show \"t15ns1if\" ; if [ $? -ne 0 ] ; then ip link add \"t15ns1if\" type veth peer name \"t15s1if\" ; fi\n", "delta": "0:00:00.015197", "end": "2019-12-05 07:43:36.365220", "item": [{"bridge_name": "t15br1", "default_route_ip": "10.1.41.1", "dns": [{"brif": "t15s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.5", "dnsif": "t15s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t15ns1", "route": [{"if": "p1", "ip": "10.1.41.1/24", "ns_if": "t15if", "ns_name": "t15"}], "subnet_ip": "1.1.1.0/24", "vms": [{"brif": "t15br1if1", "disk": "10G", "mem": 2, "name": "t15_VM1", "vcpu": 4, "vmif": "t15VM1if1"}, {"brif": "t15br1if2", "disk": "10G", "mem": 4, "name": "t15_VM2", "vcpu": 2, "vmif": "t15VM2if1"}], "vxlan": [{"dev": "t15s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.41.2", "remote_ip": "10.2.41.2", "remote_route": "10.2.41.0/24", "subnet_route": "10.1.41.0/24", "tenant_route_ip": "192.168.5.2", "v_name": "vxlan_t15s1"}]}, {"tenant_ns_if": "t15ns1if", "tenant_ns_ip": "10.1.41.1/24", "tenant_ns_name": "t15", "tenant_sub_if": "t15s1if", "tenant_sub_ip": "10.1.41.2/24"}], "rc": 0, "start": "2019-12-05 07:43:36.350023", "stderr": "Device \"t15ns1if\" does not exist.", "stderr_lines": ["Device \"t15ns1if\" does not exist."], "stdout": "", "stdout_lines": []}

TASK [Attach Namespace VETH Pairs] **************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.41.1/24', u'ns_name': u't15', u'ns_if': u't15if', u'if': u'p1'}], u'default_route_ip': u'10.1.41.1', u'bridge_name': u't15br1', u'dns': [{u'dnsif': u't15s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't15s1_dnsbrif'}], u'ns_name': u't15ns1', u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't15_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't15br1if1', u'vmif': u't15VM1if1'}, {u'mem': 4, u'name': u't15_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't15br1if2', u'vmif': u't15VM2if1'}], u'vxlan': [{u'local_ip': u'10.1.41.2', u'dsport': 4789, u'dev': u't15s1if', u'tenant_route_ip': u'192.168.5.2', u'remote_route': u'10.2.41.0/24', u'subnet_route': u'10.1.41.0/24', u'v_name': u'vxlan_t15s1', u'id': 42, u'remote_ip': u'10.2.41.2'}]}, {u'tenant_sub_ip': u'10.1.41.2/24', u'tenant_ns_ip': u'10.1.41.1/24', u'tenant_ns_if': u't15ns1if', u'tenant_sub_if': u't15s1if', u'tenant_ns_name': u't15'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t15\" ip link show \"t15ns1if\" ; if [ $? -ne 0 ] ; then ip link set \"t15ns1if\" netns \"t15\" ; fi\nip netns exec \"t15ns1\" ip link show \"t15s1if\" ; if [ $? -ne 0 ] ; then ip link set \"t15s1if\" netns \"t15ns1\" ; fi\n", "delta": "0:00:00.125518", "end": "2019-12-05 07:43:36.761533", "item": [{"bridge_name": "t15br1", "default_route_ip": "10.1.41.1", "dns": [{"brif": "t15s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.5", "dnsif": "t15s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t15ns1", "route": [{"if": "p1", "ip": "10.1.41.1/24", "ns_if": "t15if", "ns_name": "t15"}], "subnet_ip": "1.1.1.0/24", "vms": [{"brif": "t15br1if1", "disk": "10G", "mem": 2, "name": "t15_VM1", "vcpu": 4, "vmif": "t15VM1if1"}, {"brif": "t15br1if2", "disk": "10G", "mem": 4, "name": "t15_VM2", "vcpu": 2, "vmif": "t15VM2if1"}], "vxlan": [{"dev": "t15s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.41.2", "remote_ip": "10.2.41.2", "remote_route": "10.2.41.0/24", "subnet_route": "10.1.41.0/24", "tenant_route_ip": "192.168.5.2", "v_name": "vxlan_t15s1"}]}, {"tenant_ns_if": "t15ns1if", "tenant_ns_ip": "10.1.41.1/24", "tenant_ns_name": "t15", "tenant_sub_if": "t15s1if", "tenant_sub_ip": "10.1.41.2/24"}], "rc": 0, "start": "2019-12-05 07:43:36.636015", "stderr": "Device \"t15ns1if\" does not exist.\nDevice \"t15s1if\" does not exist.", "stderr_lines": ["Device \"t15ns1if\" does not exist.", "Device \"t15s1if\" does not exist."], "stdout": "", "stdout_lines": []}

TASK [Set Namespace VETH Pairs UP] **************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.41.1/24', u'ns_name': u't15', u'ns_if': u't15if', u'if': u'p1'}], u'default_route_ip': u'10.1.41.1', u'bridge_name': u't15br1', u'dns': [{u'dnsif': u't15s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't15s1_dnsbrif'}], u'ns_name': u't15ns1', u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't15_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't15br1if1', u'vmif': u't15VM1if1'}, {u'mem': 4, u'name': u't15_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't15br1if2', u'vmif': u't15VM2if1'}], u'vxlan': [{u'local_ip': u'10.1.41.2', u'dsport': 4789, u'dev': u't15s1if', u'tenant_route_ip': u'192.168.5.2', u'remote_route': u'10.2.41.0/24', u'subnet_route': u'10.1.41.0/24', u'v_name': u'vxlan_t15s1', u'id': 42, u'remote_ip': u'10.2.41.2'}]}, {u'tenant_sub_ip': u'10.1.41.2/24', u'tenant_ns_ip': u'10.1.41.1/24', u'tenant_ns_if': u't15ns1if', u'tenant_sub_if': u't15s1if', u'tenant_ns_name': u't15'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t15\" ip link set dev \"t15ns1if\" up\nip netns exec \"t15ns1\" ip link set dev \"t15s1if\" up\n", "delta": "0:00:00.087806", "end": "2019-12-05 07:43:37.113225", "item": [{"bridge_name": "t15br1", "default_route_ip": "10.1.41.1", "dns": [{"brif": "t15s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.5", "dnsif": "t15s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t15ns1", "route": [{"if": "p1", "ip": "10.1.41.1/24", "ns_if": "t15if", "ns_name": "t15"}], "subnet_ip": "1.1.1.0/24", "vms": [{"brif": "t15br1if1", "disk": "10G", "mem": 2, "name": "t15_VM1", "vcpu": 4, "vmif": "t15VM1if1"}, {"brif": "t15br1if2", "disk": "10G", "mem": 4, "name": "t15_VM2", "vcpu": 2, "vmif": "t15VM2if1"}], "vxlan": [{"dev": "t15s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.41.2", "remote_ip": "10.2.41.2", "remote_route": "10.2.41.0/24", "subnet_route": "10.1.41.0/24", "tenant_route_ip": "192.168.5.2", "v_name": "vxlan_t15s1"}]}, {"tenant_ns_if": "t15ns1if", "tenant_ns_ip": "10.1.41.1/24", "tenant_ns_name": "t15", "tenant_sub_if": "t15s1if", "tenant_sub_ip": "10.1.41.2/24"}], "rc": 0, "start": "2019-12-05 07:43:37.025419", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Add IP addresses to Namespace VETH Pairs] *************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.41.1/24', u'ns_name': u't15', u'ns_if': u't15if', u'if': u'p1'}], u'default_route_ip': u'10.1.41.1', u'bridge_name': u't15br1', u'dns': [{u'dnsif': u't15s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't15s1_dnsbrif'}], u'ns_name': u't15ns1', u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't15_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't15br1if1', u'vmif': u't15VM1if1'}, {u'mem': 4, u'name': u't15_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't15br1if2', u'vmif': u't15VM2if1'}], u'vxlan': [{u'local_ip': u'10.1.41.2', u'dsport': 4789, u'dev': u't15s1if', u'tenant_route_ip': u'192.168.5.2', u'remote_route': u'10.2.41.0/24', u'subnet_route': u'10.1.41.0/24', u'v_name': u'vxlan_t15s1', u'id': 42, u'remote_ip': u'10.2.41.2'}]}, {u'tenant_sub_ip': u'10.1.41.2/24', u'tenant_ns_ip': u'10.1.41.1/24', u'tenant_ns_if': u't15ns1if', u'tenant_sub_if': u't15s1if', u'tenant_ns_name': u't15'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t15ns1\" ip addr show \"t15s1if\" | awk 'FNR==3{ print $2 }' | grep -w '^10.1.41.2/24' ; if [ $? -ne 0 ] ; then ip netns exec \"t15ns1\" ip addr add \"10.1.41.2/24\" dev \"t15s1if\" ; fi\n\nip netns exec \"t15\" ip addr show \"t15ns1if\" | awk 'FNR==3{ print $2 }' | grep -w '^10.1.41.1/24' ; if [ $? -ne 0 ] ; then ip netns exec \"t15\" ip addr add \"10.1.41.1/24\" dev \"t15ns1if\" ; fi\n", "delta": "0:00:00.152729", "end": "2019-12-05 07:43:37.553354", "item": [{"bridge_name": "t15br1", "default_route_ip": "10.1.41.1", "dns": [{"brif": "t15s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.5", "dnsif": "t15s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t15ns1", "route": [{"if": "p1", "ip": "10.1.41.1/24", "ns_if": "t15if", "ns_name": "t15"}], "subnet_ip": "1.1.1.0/24", "vms": [{"brif": "t15br1if1", "disk": "10G", "mem": 2, "name": "t15_VM1", "vcpu": 4, "vmif": "t15VM1if1"}, {"brif": "t15br1if2", "disk": "10G", "mem": 4, "name": "t15_VM2", "vcpu": 2, "vmif": "t15VM2if1"}], "vxlan": [{"dev": "t15s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.41.2", "remote_ip": "10.2.41.2", "remote_route": "10.2.41.0/24", "subnet_route": "10.1.41.0/24", "tenant_route_ip": "192.168.5.2", "v_name": "vxlan_t15s1"}]}, {"tenant_ns_if": "t15ns1if", "tenant_ns_ip": "10.1.41.1/24", "tenant_ns_name": "t15", "tenant_sub_if": "t15s1if", "tenant_sub_ip": "10.1.41.2/24"}], "rc": 0, "start": "2019-12-05 07:43:37.400625", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Add IP Route to Tenant] *******************************************************************************************************************************
changed: [localhost] => (item={u'default_route_ip': u'192.168.5.1', u'name': u't15', u'pns_ip': u'192.168.5.1/24', u'tenant_if': u't15if', u'tenant_ip': u'192.168.5.2/24', u'pns_if': u't15pns_if'}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t15\" ip route show default | grep -w '[d]efault via 192.168.5.1' ; if [ $? -ne 0 ] ; then ip netns exec \"t15\" ip route add default via \"192.168.5.1\" ; fi\n", "delta": "0:00:00.080520", "end": "2019-12-05 07:43:37.893116", "item": {"default_route_ip": "192.168.5.1", "name": "t15", "pns_if": "t15pns_if", "pns_ip": "192.168.5.1/24", "tenant_if": "t15if", "tenant_ip": "192.168.5.2/24"}, "rc": 0, "start": "2019-12-05 07:43:37.812596", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Add IP Route to Tenant Subnet] ************************************************************************************************************************
changed: [localhost] => (item={u'route': [{u'ip': u'10.1.41.1/24', u'ns_name': u't15', u'ns_if': u't15if', u'if': u'p1'}], u'default_route_ip': u'10.1.41.1', u'bridge_name': u't15br1', u'dns': [{u'dnsif': u't15s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't15s1_dnsbrif'}], u'ns_name': u't15ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.41.2/24', u'tenant_ns_ip': u'10.1.41.1/24', u'tenant_ns_if': u't15ns1if', u'tenant_ns_name': u't15', u'tenant_sub_if': u't15s1if'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't15_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't15br1if1', u'vmif': u't15VM1if1'}, {u'mem': 4, u'name': u't15_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't15br1if2', u'vmif': u't15VM2if1'}], u'vxlan': [{u'local_ip': u'10.1.41.2', u'tenant_route_ip': u'192.168.5.2', u'dsport': 4789, u'dev': u't15s1if', u'subnet_route': u'10.1.41.0/24', u'remote_route': u'10.2.41.0/24', u'v_name': u'vxlan_t15s1', u'id': 42, u'remote_ip': u'10.2.41.2'}]}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t15ns1\" ip route show default | grep -w '[d]efault via 10.1.41.1' ; if [ $? -ne 0 ] ; then ip netns exec \"t15ns1\" ip route add default via \"10.1.41.1\" ; fi\n", "delta": "0:00:00.068108", "end": "2019-12-05 07:43:38.237140", "item": {"bridge_name": "t15br1", "default_route_ip": "10.1.41.1", "dns": [{"brif": "t15s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.5", "dnsif": "t15s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t15ns1", "route": [{"if": "p1", "ip": "10.1.41.1/24", "ns_if": "t15if", "ns_name": "t15"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t15ns1if", "tenant_ns_ip": "10.1.41.1/24", "tenant_ns_name": "t15", "tenant_sub_if": "t15s1if", "tenant_sub_ip": "10.1.41.2/24"}], "vms": [{"brif": "t15br1if1", "disk": "10G", "mem": 2, "name": "t15_VM1", "vcpu": 4, "vmif": "t15VM1if1"}, {"brif": "t15br1if2", "disk": "10G", "mem": 4, "name": "t15_VM2", "vcpu": 2, "vmif": "t15VM2if1"}], "vxlan": [{"dev": "t15s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.41.2", "remote_ip": "10.2.41.2", "remote_route": "10.2.41.0/24", "subnet_route": "10.1.41.0/24", "tenant_route_ip": "192.168.5.2", "v_name": "vxlan_t15s1"}]}, "rc": 0, "start": "2019-12-05 07:43:38.169032", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Create bridge inside namespace] ***********************************************************************************************************************
changed: [localhost] => (item={u'route': [{u'ip': u'10.1.41.1/24', u'ns_name': u't15', u'ns_if': u't15if', u'if': u'p1'}], u'default_route_ip': u'10.1.41.1', u'bridge_name': u't15br1', u'dns': [{u'dnsif': u't15s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't15s1_dnsbrif'}], u'ns_name': u't15ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.41.2/24', u'tenant_ns_ip': u'10.1.41.1/24', u'tenant_ns_if': u't15ns1if', u'tenant_ns_name': u't15', u'tenant_sub_if': u't15s1if'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't15_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't15br1if1', u'vmif': u't15VM1if1'}, {u'mem': 4, u'name': u't15_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't15br1if2', u'vmif': u't15VM2if1'}], u'vxlan': [{u'local_ip': u'10.1.41.2', u'tenant_route_ip': u'192.168.5.2', u'dsport': 4789, u'dev': u't15s1if', u'subnet_route': u'10.1.41.0/24', u'remote_route': u'10.2.41.0/24', u'v_name': u'vxlan_t15s1', u'id': 42, u'remote_ip': u'10.2.41.2'}]}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t15ns1\" brctl show | grep -w '^t15br1'; if [ $? -ne 0 ] ; then ip netns exec \"t15ns1\" brctl addbr \"t15br1\" ; fi\nip netns exec \"t15ns1\" ip link set dev \"t15br1\" up\n", "delta": "0:00:00.120504", "end": "2019-12-05 07:43:38.621144", "item": {"bridge_name": "t15br1", "default_route_ip": "10.1.41.1", "dns": [{"brif": "t15s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.5", "dnsif": "t15s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t15ns1", "route": [{"if": "p1", "ip": "10.1.41.1/24", "ns_if": "t15if", "ns_name": "t15"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t15ns1if", "tenant_ns_ip": "10.1.41.1/24", "tenant_ns_name": "t15", "tenant_sub_if": "t15s1if", "tenant_sub_ip": "10.1.41.2/24"}], "vms": [{"brif": "t15br1if1", "disk": "10G", "mem": 2, "name": "t15_VM1", "vcpu": 4, "vmif": "t15VM1if1"}, {"brif": "t15br1if2", "disk": "10G", "mem": 4, "name": "t15_VM2", "vcpu": 2, "vmif": "t15VM2if1"}], "vxlan": [{"dev": "t15s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.41.2", "remote_ip": "10.2.41.2", "remote_route": "10.2.41.0/24", "subnet_route": "10.1.41.0/24", "tenant_route_ip": "192.168.5.2", "v_name": "vxlan_t15s1"}]}, "rc": 0, "start": "2019-12-05 07:43:38.500640", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Create DNS VETH Pair] *********************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.41.1/24', u'ns_name': u't15', u'ns_if': u't15if', u'if': u'p1'}], u'default_route_ip': u'10.1.41.1', u'bridge_name': u't15br1', u'ns_name': u't15ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.41.2/24', u'tenant_ns_ip': u'10.1.41.1/24', u'tenant_ns_if': u't15ns1if', u'tenant_sub_if': u't15s1if', u'tenant_ns_name': u't15'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't15_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't15br1if1', u'vmif': u't15VM1if1'}, {u'mem': 4, u'name': u't15_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't15br1if2', u'vmif': u't15VM2if1'}], u'vxlan': [{u'local_ip': u'10.1.41.2', u'dsport': 4789, u'dev': u't15s1if', u'tenant_route_ip': u'192.168.5.2', u'remote_route': u'10.2.41.0/24', u'subnet_route': u'10.1.41.0/24', u'v_name': u'vxlan_t15s1', u'id': 42, u'remote_ip': u'10.2.41.2'}]}, {u'dnsif': u't15s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't15s1_dnsbrif'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t15ns1\" ip link show \"t15s1_dnsbrif\" ; if [ $? -ne 0 ] ; then ip netns exec \"t15ns1\" ip link add \"t15s1_dnsbrif\" type veth peer name \"t15s1_dnsif\" ; fi\nip netns exec \"t15ns1\" ip link set dev \"t15s1_dnsbrif\" up\nip netns exec \"t15ns1\" ip link set dev \"t15s1_dnsif\" up\n", "delta": "0:00:00.145638", "end": "2019-12-05 07:43:39.045332", "item": [{"bridge_name": "t15br1", "default_route_ip": "10.1.41.1", "ns_name": "t15ns1", "route": [{"if": "p1", "ip": "10.1.41.1/24", "ns_if": "t15if", "ns_name": "t15"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t15ns1if", "tenant_ns_ip": "10.1.41.1/24", "tenant_ns_name": "t15", "tenant_sub_if": "t15s1if", "tenant_sub_ip": "10.1.41.2/24"}], "vms": [{"brif": "t15br1if1", "disk": "10G", "mem": 2, "name": "t15_VM1", "vcpu": 4, "vmif": "t15VM1if1"}, {"brif": "t15br1if2", "disk": "10G", "mem": 4, "name": "t15_VM2", "vcpu": 2, "vmif": "t15VM2if1"}], "vxlan": [{"dev": "t15s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.41.2", "remote_ip": "10.2.41.2", "remote_route": "10.2.41.0/24", "subnet_route": "10.1.41.0/24", "tenant_route_ip": "192.168.5.2", "v_name": "vxlan_t15s1"}]}, {"brif": "t15s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.5", "dnsif": "t15s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "rc": 0, "start": "2019-12-05 07:43:38.899694", "stderr": "Device \"t15s1_dnsbrif\" does not exist.", "stderr_lines": ["Device \"t15s1_dnsbrif\" does not exist."], "stdout": "", "stdout_lines": []}

TASK [Attach DNS VETH Pair] *********************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.41.1/24', u'ns_name': u't15', u'ns_if': u't15if', u'if': u'p1'}], u'default_route_ip': u'10.1.41.1', u'bridge_name': u't15br1', u'ns_name': u't15ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.41.2/24', u'tenant_ns_ip': u'10.1.41.1/24', u'tenant_ns_if': u't15ns1if', u'tenant_sub_if': u't15s1if', u'tenant_ns_name': u't15'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't15_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't15br1if1', u'vmif': u't15VM1if1'}, {u'mem': 4, u'name': u't15_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't15br1if2', u'vmif': u't15VM2if1'}], u'vxlan': [{u'local_ip': u'10.1.41.2', u'dsport': 4789, u'dev': u't15s1if', u'tenant_route_ip': u'192.168.5.2', u'remote_route': u'10.2.41.0/24', u'subnet_route': u'10.1.41.0/24', u'v_name': u'vxlan_t15s1', u'id': 42, u'remote_ip': u'10.2.41.2'}]}, {u'dnsif': u't15s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't15s1_dnsbrif'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t15ns1\" brctl show \"t15br1\" | grep -w 't15s1_dnsbrif' ; if [ $? -ne 0 ] ; then ip netns exec \"t15ns1\" brctl addif \"t15br1\" \"t15s1_dnsbrif\" ; fi\n", "delta": "0:00:00.097854", "end": "2019-12-05 07:43:39.425178", "item": [{"bridge_name": "t15br1", "default_route_ip": "10.1.41.1", "ns_name": "t15ns1", "route": [{"if": "p1", "ip": "10.1.41.1/24", "ns_if": "t15if", "ns_name": "t15"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t15ns1if", "tenant_ns_ip": "10.1.41.1/24", "tenant_ns_name": "t15", "tenant_sub_if": "t15s1if", "tenant_sub_ip": "10.1.41.2/24"}], "vms": [{"brif": "t15br1if1", "disk": "10G", "mem": 2, "name": "t15_VM1", "vcpu": 4, "vmif": "t15VM1if1"}, {"brif": "t15br1if2", "disk": "10G", "mem": 4, "name": "t15_VM2", "vcpu": 2, "vmif": "t15VM2if1"}], "vxlan": [{"dev": "t15s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.41.2", "remote_ip": "10.2.41.2", "remote_route": "10.2.41.0/24", "subnet_route": "10.1.41.0/24", "tenant_route_ip": "192.168.5.2", "v_name": "vxlan_t15s1"}]}, {"brif": "t15s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.5", "dnsif": "t15s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "rc": 0, "start": "2019-12-05 07:43:39.327324", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Create VETH Pairs] ************************************************************************************************************************************
INFO:root: 07:45:10.088491 Printing the yaml input file
INFO:root: 07:45:10.088605 {'C1': [{'subnet_addr': '1.1.1.0/24', 'VM': [{'name': 'VM1', 'disk': '10G', 'mem': 2, 'vcpu': 4, 'internet_access': True}, {'name': 'VM2', 'disk': '10G', 'mem': 4, 'vcpu': 2, 'internet_access': False}]}], 'C2': [{'subnet_addr': '1.1.1.0/24', 'VM': [{'name': 'VM4', 'disk': '10G', 'mem': 2, 'vcpu': 4, 'internet_access': True}]}, {'subnet_addr': '2.2.2.0/24', 'VM': [{'name': 'VM3', 'disk': '10G', 'mem': 3, 'vcpu': 2, 'internet_access': True}]}], 'MISC': [{'LOG_ENABLE': True}, {'GUI': True}]}
INFO:root: 07:45:10.088698 Provided subnet in C1: 1.1.1.0/24 is valid
INFO:root: 07:45:10.088748 Provided subnet in C2: 1.1.1.0/24 is valid
INFO:root: 07:45:10.088790 Provided subnet in C2: 2.2.2.0/24 is valid
Using /etc/ansible/ansible.cfg as config file

PLAY [main] *************************************************************************************************************************************************

TASK [Create Tenant Namespace] ******************************************************************************************************************************
changed: [localhost] => (item={u'default_route_ip': u'192.168.6.1', u'name': u't16', u'pns_ip': u'192.168.6.1/24', u'tenant_if': u't16if', u'tenant_ip': u'192.168.6.2/24', u'pns_if': u't16pns_if'}) => {"ansible_loop_var": "item", "changed": true, "cmd": ["ip", "netns", "add", "t16"], "delta": "0:00:00.054756", "end": "2019-12-05 07:45:11.262384", "item": {"default_route_ip": "192.168.6.1", "name": "t16", "pns_if": "t16pns_if", "pns_ip": "192.168.6.1/24", "tenant_if": "t16if", "tenant_ip": "192.168.6.2/24"}, "rc": 0, "start": "2019-12-05 07:45:11.207628", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Create Subnet Namespace] ******************************************************************************************************************************
changed: [localhost] => (item={u'route': [{u'ip': u'10.1.51.1/24', u'ns_name': u't16', u'ns_if': u't16if', u'if': u'p1'}], u'default_route_ip': u'10.1.51.1', u'bridge_name': u't16br1', u'dns': [{u'dnsif': u't16s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't16s1_dnsbrif'}], u'ns_name': u't16ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.51.2/24', u'tenant_ns_ip': u'10.1.51.1/24', u'tenant_ns_if': u't16ns1if', u'tenant_ns_name': u't16', u'tenant_sub_if': u't16s1if'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't16_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't16br1if1', u'vmif': u't16VM1if1'}, {u'mem': 4, u'name': u't16_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't16br1if2', u'vmif': u't16VM2if1'}], u'vxlan': [{u'local_ip': u'10.1.51.2', u'tenant_route_ip': u'192.168.6.2', u'dsport': 4789, u'dev': u't16s1if', u'subnet_route': u'10.1.51.0/24', u'remote_route': u'10.2.51.0/24', u'v_name': u'vxlan_t16s1', u'id': 42, u'remote_ip': u'10.2.51.2'}]}) => {"ansible_loop_var": "item", "changed": true, "cmd": ["ip", "netns", "add", "t16ns1"], "delta": "0:00:00.051546", "end": "2019-12-05 07:45:11.594916", "item": {"bridge_name": "t16br1", "default_route_ip": "10.1.51.1", "dns": [{"brif": "t16s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.5", "dnsif": "t16s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t16ns1", "route": [{"if": "p1", "ip": "10.1.51.1/24", "ns_if": "t16if", "ns_name": "t16"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t16ns1if", "tenant_ns_ip": "10.1.51.1/24", "tenant_ns_name": "t16", "tenant_sub_if": "t16s1if", "tenant_sub_ip": "10.1.51.2/24"}], "vms": [{"brif": "t16br1if1", "disk": "10G", "mem": 2, "name": "t16_VM1", "vcpu": 4, "vmif": "t16VM1if1"}, {"brif": "t16br1if2", "disk": "10G", "mem": 4, "name": "t16_VM2", "vcpu": 2, "vmif": "t16VM2if1"}], "vxlan": [{"dev": "t16s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.51.2", "remote_ip": "10.2.51.2", "remote_route": "10.2.51.0/24", "subnet_route": "10.1.51.0/24", "tenant_route_ip": "192.168.6.2", "v_name": "vxlan_t16s1"}]}, "rc": 0, "start": "2019-12-05 07:45:11.543370", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Create Tenant VETH pairs] *****************************************************************************************************************************
changed: [localhost] => (item={u'default_route_ip': u'192.168.6.1', u'name': u't16', u'pns_ip': u'192.168.6.1/24', u'tenant_if': u't16if', u'tenant_ip': u'192.168.6.2/24', u'pns_if': u't16pns_if'}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip link show \"t16if\" ; if [ $? -ne 0 ] ; then ip link add \"t16if\" type veth peer name \"t16pns_if\" ; fi\n", "delta": "0:00:00.017189", "end": "2019-12-05 07:45:11.895725", "item": {"default_route_ip": "192.168.6.1", "name": "t16", "pns_if": "t16pns_if", "pns_ip": "192.168.6.1/24", "tenant_if": "t16if", "tenant_ip": "192.168.6.2/24"}, "rc": 0, "start": "2019-12-05 07:45:11.878536", "stderr": "Device \"t16if\" does not exist.", "stderr_lines": ["Device \"t16if\" does not exist."], "stdout": "", "stdout_lines": []}

TASK [Attach Tenant VETH Pairs] *****************************************************************************************************************************
changed: [localhost] => (item={u'default_route_ip': u'192.168.6.1', u'name': u't16', u'pns_ip': u'192.168.6.1/24', u'tenant_if': u't16if', u'tenant_ip': u'192.168.6.2/24', u'pns_if': u't16pns_if'}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec pns ip link show \"t16pns_if\" ; if [ $? -ne 0 ] ; then ip link set \"t16pns_if\" netns pns ; fi\nip netns exec \"t16\" ip link show \"t16if\" ; if [ $? -ne 0 ] ; then ip link set \"t16if\" netns \"t16\" ; fi\nip netns exec pns ip link set dev \"t16pns_if\" up\nip netns exec \"t16\" ip link set dev \"t16if\" up\n", "delta": "0:00:00.216945", "end": "2019-12-05 07:45:12.437223", "item": {"default_route_ip": "192.168.6.1", "name": "t16", "pns_if": "t16pns_if", "pns_ip": "192.168.6.1/24", "tenant_if": "t16if", "tenant_ip": "192.168.6.2/24"}, "rc": 0, "start": "2019-12-05 07:45:12.220278", "stderr": "Device \"t16pns_if\" does not exist.\nDevice \"t16if\" does not exist.", "stderr_lines": ["Device \"t16pns_if\" does not exist.", "Device \"t16if\" does not exist."], "stdout": "", "stdout_lines": []}

TASK [Add IP addresses to Tenant VETH Pairs] ****************************************************************************************************************
changed: [localhost] => (item={u'default_route_ip': u'192.168.6.1', u'name': u't16', u'pns_ip': u'192.168.6.1/24', u'tenant_if': u't16if', u'tenant_ip': u'192.168.6.2/24', u'pns_if': u't16pns_if'}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec pns ip addr show \"t16pns_if\" | awk 'FNR==3{ print $2 }' | grep -w '^192.168.6.1/24' ; if [ $? -ne 0 ] ; then ip netns exec pns ip addr add \"192.168.6.1/24\" dev \"t16pns_if\" ; fi\nip netns exec \"t16\" ip addr show \"t16if\" | awk 'FNR==3{ print $2 }' | grep -w '^192.168.6.2/24' ; if [ $? -ne 0 ] ; then ip netns exec \"t16\" ip addr add \"192.168.6.2/24\" dev \"t16if\" ; fi\n", "delta": "0:00:00.148805", "end": "2019-12-05 07:45:12.925347", "item": {"default_route_ip": "192.168.6.1", "name": "t16", "pns_if": "t16pns_if", "pns_ip": "192.168.6.1/24", "tenant_if": "t16if", "tenant_ip": "192.168.6.2/24"}, "rc": 0, "start": "2019-12-05 07:45:12.776542", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Create Namespace VETH Pairs] **************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.51.1/24', u'ns_name': u't16', u'ns_if': u't16if', u'if': u'p1'}], u'default_route_ip': u'10.1.51.1', u'bridge_name': u't16br1', u'dns': [{u'dnsif': u't16s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't16s1_dnsbrif'}], u'ns_name': u't16ns1', u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't16_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't16br1if1', u'vmif': u't16VM1if1'}, {u'mem': 4, u'name': u't16_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't16br1if2', u'vmif': u't16VM2if1'}], u'vxlan': [{u'local_ip': u'10.1.51.2', u'dsport': 4789, u'dev': u't16s1if', u'tenant_route_ip': u'192.168.6.2', u'remote_route': u'10.2.51.0/24', u'subnet_route': u'10.1.51.0/24', u'v_name': u'vxlan_t16s1', u'id': 42, u'remote_ip': u'10.2.51.2'}]}, {u'tenant_sub_ip': u'10.1.51.2/24', u'tenant_ns_ip': u'10.1.51.1/24', u'tenant_ns_if': u't16ns1if', u'tenant_sub_if': u't16s1if', u'tenant_ns_name': u't16'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip link show \"t16ns1if\" ; if [ $? -ne 0 ] ; then ip link add \"t16ns1if\" type veth peer name \"t16s1if\" ; fi\n", "delta": "0:00:00.015470", "end": "2019-12-05 07:45:13.253167", "item": [{"bridge_name": "t16br1", "default_route_ip": "10.1.51.1", "dns": [{"brif": "t16s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.5", "dnsif": "t16s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t16ns1", "route": [{"if": "p1", "ip": "10.1.51.1/24", "ns_if": "t16if", "ns_name": "t16"}], "subnet_ip": "1.1.1.0/24", "vms": [{"brif": "t16br1if1", "disk": "10G", "mem": 2, "name": "t16_VM1", "vcpu": 4, "vmif": "t16VM1if1"}, {"brif": "t16br1if2", "disk": "10G", "mem": 4, "name": "t16_VM2", "vcpu": 2, "vmif": "t16VM2if1"}], "vxlan": [{"dev": "t16s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.51.2", "remote_ip": "10.2.51.2", "remote_route": "10.2.51.0/24", "subnet_route": "10.1.51.0/24", "tenant_route_ip": "192.168.6.2", "v_name": "vxlan_t16s1"}]}, {"tenant_ns_if": "t16ns1if", "tenant_ns_ip": "10.1.51.1/24", "tenant_ns_name": "t16", "tenant_sub_if": "t16s1if", "tenant_sub_ip": "10.1.51.2/24"}], "rc": 0, "start": "2019-12-05 07:45:13.237697", "stderr": "Device \"t16ns1if\" does not exist.", "stderr_lines": ["Device \"t16ns1if\" does not exist."], "stdout": "", "stdout_lines": []}

TASK [Attach Namespace VETH Pairs] **************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.51.1/24', u'ns_name': u't16', u'ns_if': u't16if', u'if': u'p1'}], u'default_route_ip': u'10.1.51.1', u'bridge_name': u't16br1', u'dns': [{u'dnsif': u't16s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't16s1_dnsbrif'}], u'ns_name': u't16ns1', u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't16_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't16br1if1', u'vmif': u't16VM1if1'}, {u'mem': 4, u'name': u't16_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't16br1if2', u'vmif': u't16VM2if1'}], u'vxlan': [{u'local_ip': u'10.1.51.2', u'dsport': 4789, u'dev': u't16s1if', u'tenant_route_ip': u'192.168.6.2', u'remote_route': u'10.2.51.0/24', u'subnet_route': u'10.1.51.0/24', u'v_name': u'vxlan_t16s1', u'id': 42, u'remote_ip': u'10.2.51.2'}]}, {u'tenant_sub_ip': u'10.1.51.2/24', u'tenant_ns_ip': u'10.1.51.1/24', u'tenant_ns_if': u't16ns1if', u'tenant_sub_if': u't16s1if', u'tenant_ns_name': u't16'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t16\" ip link show \"t16ns1if\" ; if [ $? -ne 0 ] ; then ip link set \"t16ns1if\" netns \"t16\" ; fi\nip netns exec \"t16ns1\" ip link show \"t16s1if\" ; if [ $? -ne 0 ] ; then ip link set \"t16s1if\" netns \"t16ns1\" ; fi\n", "delta": "0:00:00.132442", "end": "2019-12-05 07:45:13.686049", "item": [{"bridge_name": "t16br1", "default_route_ip": "10.1.51.1", "dns": [{"brif": "t16s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.5", "dnsif": "t16s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t16ns1", "route": [{"if": "p1", "ip": "10.1.51.1/24", "ns_if": "t16if", "ns_name": "t16"}], "subnet_ip": "1.1.1.0/24", "vms": [{"brif": "t16br1if1", "disk": "10G", "mem": 2, "name": "t16_VM1", "vcpu": 4, "vmif": "t16VM1if1"}, {"brif": "t16br1if2", "disk": "10G", "mem": 4, "name": "t16_VM2", "vcpu": 2, "vmif": "t16VM2if1"}], "vxlan": [{"dev": "t16s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.51.2", "remote_ip": "10.2.51.2", "remote_route": "10.2.51.0/24", "subnet_route": "10.1.51.0/24", "tenant_route_ip": "192.168.6.2", "v_name": "vxlan_t16s1"}]}, {"tenant_ns_if": "t16ns1if", "tenant_ns_ip": "10.1.51.1/24", "tenant_ns_name": "t16", "tenant_sub_if": "t16s1if", "tenant_sub_ip": "10.1.51.2/24"}], "rc": 0, "start": "2019-12-05 07:45:13.553607", "stderr": "Device \"t16ns1if\" does not exist.\nDevice \"t16s1if\" does not exist.", "stderr_lines": ["Device \"t16ns1if\" does not exist.", "Device \"t16s1if\" does not exist."], "stdout": "", "stdout_lines": []}

TASK [Set Namespace VETH Pairs UP] **************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.51.1/24', u'ns_name': u't16', u'ns_if': u't16if', u'if': u'p1'}], u'default_route_ip': u'10.1.51.1', u'bridge_name': u't16br1', u'dns': [{u'dnsif': u't16s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't16s1_dnsbrif'}], u'ns_name': u't16ns1', u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't16_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't16br1if1', u'vmif': u't16VM1if1'}, {u'mem': 4, u'name': u't16_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't16br1if2', u'vmif': u't16VM2if1'}], u'vxlan': [{u'local_ip': u'10.1.51.2', u'dsport': 4789, u'dev': u't16s1if', u'tenant_route_ip': u'192.168.6.2', u'remote_route': u'10.2.51.0/24', u'subnet_route': u'10.1.51.0/24', u'v_name': u'vxlan_t16s1', u'id': 42, u'remote_ip': u'10.2.51.2'}]}, {u'tenant_sub_ip': u'10.1.51.2/24', u'tenant_ns_ip': u'10.1.51.1/24', u'tenant_ns_if': u't16ns1if', u'tenant_sub_if': u't16s1if', u'tenant_ns_name': u't16'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t16\" ip link set dev \"t16ns1if\" up\nip netns exec \"t16ns1\" ip link set dev \"t16s1if\" up\n", "delta": "0:00:00.075850", "end": "2019-12-05 07:45:14.089292", "item": [{"bridge_name": "t16br1", "default_route_ip": "10.1.51.1", "dns": [{"brif": "t16s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.5", "dnsif": "t16s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t16ns1", "route": [{"if": "p1", "ip": "10.1.51.1/24", "ns_if": "t16if", "ns_name": "t16"}], "subnet_ip": "1.1.1.0/24", "vms": [{"brif": "t16br1if1", "disk": "10G", "mem": 2, "name": "t16_VM1", "vcpu": 4, "vmif": "t16VM1if1"}, {"brif": "t16br1if2", "disk": "10G", "mem": 4, "name": "t16_VM2", "vcpu": 2, "vmif": "t16VM2if1"}], "vxlan": [{"dev": "t16s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.51.2", "remote_ip": "10.2.51.2", "remote_route": "10.2.51.0/24", "subnet_route": "10.1.51.0/24", "tenant_route_ip": "192.168.6.2", "v_name": "vxlan_t16s1"}]}, {"tenant_ns_if": "t16ns1if", "tenant_ns_ip": "10.1.51.1/24", "tenant_ns_name": "t16", "tenant_sub_if": "t16s1if", "tenant_sub_ip": "10.1.51.2/24"}], "rc": 0, "start": "2019-12-05 07:45:14.013442", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Add IP addresses to Namespace VETH Pairs] *************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.51.1/24', u'ns_name': u't16', u'ns_if': u't16if', u'if': u'p1'}], u'default_route_ip': u'10.1.51.1', u'bridge_name': u't16br1', u'dns': [{u'dnsif': u't16s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't16s1_dnsbrif'}], u'ns_name': u't16ns1', u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't16_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't16br1if1', u'vmif': u't16VM1if1'}, {u'mem': 4, u'name': u't16_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't16br1if2', u'vmif': u't16VM2if1'}], u'vxlan': [{u'local_ip': u'10.1.51.2', u'dsport': 4789, u'dev': u't16s1if', u'tenant_route_ip': u'192.168.6.2', u'remote_route': u'10.2.51.0/24', u'subnet_route': u'10.1.51.0/24', u'v_name': u'vxlan_t16s1', u'id': 42, u'remote_ip': u'10.2.51.2'}]}, {u'tenant_sub_ip': u'10.1.51.2/24', u'tenant_ns_ip': u'10.1.51.1/24', u'tenant_ns_if': u't16ns1if', u'tenant_sub_if': u't16s1if', u'tenant_ns_name': u't16'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t16ns1\" ip addr show \"t16s1if\" | awk 'FNR==3{ print $2 }' | grep -w '^10.1.51.2/24' ; if [ $? -ne 0 ] ; then ip netns exec \"t16ns1\" ip addr add \"10.1.51.2/24\" dev \"t16s1if\" ; fi\n\nip netns exec \"t16\" ip addr show \"t16ns1if\" | awk 'FNR==3{ print $2 }' | grep -w '^10.1.51.1/24' ; if [ $? -ne 0 ] ; then ip netns exec \"t16\" ip addr add \"10.1.51.1/24\" dev \"t16ns1if\" ; fi\n", "delta": "0:00:00.161697", "end": "2019-12-05 07:45:14.545311", "item": [{"bridge_name": "t16br1", "default_route_ip": "10.1.51.1", "dns": [{"brif": "t16s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.5", "dnsif": "t16s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t16ns1", "route": [{"if": "p1", "ip": "10.1.51.1/24", "ns_if": "t16if", "ns_name": "t16"}], "subnet_ip": "1.1.1.0/24", "vms": [{"brif": "t16br1if1", "disk": "10G", "mem": 2, "name": "t16_VM1", "vcpu": 4, "vmif": "t16VM1if1"}, {"brif": "t16br1if2", "disk": "10G", "mem": 4, "name": "t16_VM2", "vcpu": 2, "vmif": "t16VM2if1"}], "vxlan": [{"dev": "t16s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.51.2", "remote_ip": "10.2.51.2", "remote_route": "10.2.51.0/24", "subnet_route": "10.1.51.0/24", "tenant_route_ip": "192.168.6.2", "v_name": "vxlan_t16s1"}]}, {"tenant_ns_if": "t16ns1if", "tenant_ns_ip": "10.1.51.1/24", "tenant_ns_name": "t16", "tenant_sub_if": "t16s1if", "tenant_sub_ip": "10.1.51.2/24"}], "rc": 0, "start": "2019-12-05 07:45:14.383614", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}
INFO:root: 07:54:47.638340 Printing the yaml input file
INFO:root: 07:54:47.638467 {'C1': [{'subnet_addr': '1.1.1.0/24', 'VM': [{'name': 'VM1', 'disk': '10G', 'mem': 2, 'vcpu': 4, 'internet_access': True}, {'name': 'VM2', 'disk': '10G', 'mem': 4, 'vcpu': 2, 'internet_access': False}]}], 'C2': [{'subnet_addr': '1.1.1.0/24', 'VM': [{'name': 'VM4', 'disk': '10G', 'mem': 2, 'vcpu': 4, 'internet_access': True}]}, {'subnet_addr': '2.2.2.0/24', 'VM': [{'name': 'VM3', 'disk': '10G', 'mem': 3, 'vcpu': 2, 'internet_access': True}]}], 'MISC': [{'LOG_ENABLE': True}, {'GUI': True}]}
INFO:root: 07:54:47.638585 Provided subnet in C1: 1.1.1.0/24 is valid
INFO:root: 07:54:47.638635 Provided subnet in C2: 1.1.1.0/24 is valid
INFO:root: 07:54:47.638675 Provided subnet in C2: 2.2.2.0/24 is valid
Using /etc/ansible/ansible.cfg as config file

PLAY [main] *************************************************************************************************************************************************

TASK [Create Tenant Namespace] ******************************************************************************************************************************
changed: [localhost] => (item={u'default_route_ip': u'192.168.7.1', u'name': u't17', u'pns_ip': u'192.168.7.1/24', u'tenant_if': u't17if', u'tenant_ip': u'192.168.7.2/24', u'pns_if': u't17pns_if'}) => {"ansible_loop_var": "item", "changed": true, "cmd": ["ip", "netns", "add", "t17"], "delta": "0:00:00.059455", "end": "2019-12-05 07:54:48.903066", "item": {"default_route_ip": "192.168.7.1", "name": "t17", "pns_if": "t17pns_if", "pns_ip": "192.168.7.1/24", "tenant_if": "t17if", "tenant_ip": "192.168.7.2/24"}, "rc": 0, "start": "2019-12-05 07:54:48.843611", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Create Subnet Namespace] ******************************************************************************************************************************
changed: [localhost] => (item={u'route': [{u'ip': u'10.1.61.1/24', u'ns_name': u't17', u'ns_if': u't17if', u'if': u'p1'}], u'default_route_ip': u'10.1.61.1', u'bridge_name': u't17br1', u'dns': [{u'dnsif': u't17s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't17s1_dnsbrif'}], u'ns_name': u't17ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.61.2/24', u'tenant_ns_ip': u'10.1.61.1/24', u'tenant_ns_if': u't17ns1if', u'tenant_ns_name': u't17', u'tenant_sub_if': u't17s1if'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't17_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't17br1if1', u'vmif': u't17VM1if1'}, {u'mem': 4, u'name': u't17_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't17br1if2', u'vmif': u't17VM2if1'}], u'vxlan': [{u'local_ip': u'10.1.61.2', u'tenant_route_ip': u'192.168.7.2', u'dsport': 4789, u'dev': u't17s1if', u'subnet_route': u'10.1.61.0/24', u'remote_route': u'10.2.61.0/24', u'v_name': u'vxlan_t17s1', u'id': 42, u'remote_ip': u'10.2.61.2'}]}) => {"ansible_loop_var": "item", "changed": true, "cmd": ["ip", "netns", "add", "t17ns1"], "delta": "0:00:00.068081", "end": "2019-12-05 07:54:49.265975", "item": {"bridge_name": "t17br1", "default_route_ip": "10.1.61.1", "dns": [{"brif": "t17s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.5", "dnsif": "t17s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t17ns1", "route": [{"if": "p1", "ip": "10.1.61.1/24", "ns_if": "t17if", "ns_name": "t17"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t17ns1if", "tenant_ns_ip": "10.1.61.1/24", "tenant_ns_name": "t17", "tenant_sub_if": "t17s1if", "tenant_sub_ip": "10.1.61.2/24"}], "vms": [{"brif": "t17br1if1", "disk": "10G", "mem": 2, "name": "t17_VM1", "vcpu": 4, "vmif": "t17VM1if1"}, {"brif": "t17br1if2", "disk": "10G", "mem": 4, "name": "t17_VM2", "vcpu": 2, "vmif": "t17VM2if1"}], "vxlan": [{"dev": "t17s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.61.2", "remote_ip": "10.2.61.2", "remote_route": "10.2.61.0/24", "subnet_route": "10.1.61.0/24", "tenant_route_ip": "192.168.7.2", "v_name": "vxlan_t17s1"}]}, "rc": 0, "start": "2019-12-05 07:54:49.197894", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Create Tenant VETH pairs] *****************************************************************************************************************************
changed: [localhost] => (item={u'default_route_ip': u'192.168.7.1', u'name': u't17', u'pns_ip': u'192.168.7.1/24', u'tenant_if': u't17if', u'tenant_ip': u'192.168.7.2/24', u'pns_if': u't17pns_if'}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip link show \"t17if\" ; if [ $? -ne 0 ] ; then ip link add \"t17if\" type veth peer name \"t17pns_if\" ; fi\n", "delta": "0:00:00.018986", "end": "2019-12-05 07:54:49.562853", "item": {"default_route_ip": "192.168.7.1", "name": "t17", "pns_if": "t17pns_if", "pns_ip": "192.168.7.1/24", "tenant_if": "t17if", "tenant_ip": "192.168.7.2/24"}, "rc": 0, "start": "2019-12-05 07:54:49.543867", "stderr": "Device \"t17if\" does not exist.", "stderr_lines": ["Device \"t17if\" does not exist."], "stdout": "", "stdout_lines": []}

TASK [Attach Tenant VETH Pairs] *****************************************************************************************************************************
changed: [localhost] => (item={u'default_route_ip': u'192.168.7.1', u'name': u't17', u'pns_ip': u'192.168.7.1/24', u'tenant_if': u't17if', u'tenant_ip': u'192.168.7.2/24', u'pns_if': u't17pns_if'}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec pns ip link show \"t17pns_if\" ; if [ $? -ne 0 ] ; then ip link set \"t17pns_if\" netns pns ; fi\nip netns exec \"t17\" ip link show \"t17if\" ; if [ $? -ne 0 ] ; then ip link set \"t17if\" netns \"t17\" ; fi\nip netns exec pns ip link set dev \"t17pns_if\" up\nip netns exec \"t17\" ip link set dev \"t17if\" up\n", "delta": "0:00:00.207774", "end": "2019-12-05 07:54:50.041200", "item": {"default_route_ip": "192.168.7.1", "name": "t17", "pns_if": "t17pns_if", "pns_ip": "192.168.7.1/24", "tenant_if": "t17if", "tenant_ip": "192.168.7.2/24"}, "rc": 0, "start": "2019-12-05 07:54:49.833426", "stderr": "Device \"t17pns_if\" does not exist.\nDevice \"t17if\" does not exist.", "stderr_lines": ["Device \"t17pns_if\" does not exist.", "Device \"t17if\" does not exist."], "stdout": "", "stdout_lines": []}

TASK [Add IP addresses to Tenant VETH Pairs] ****************************************************************************************************************
changed: [localhost] => (item={u'default_route_ip': u'192.168.7.1', u'name': u't17', u'pns_ip': u'192.168.7.1/24', u'tenant_if': u't17if', u'tenant_ip': u'192.168.7.2/24', u'pns_if': u't17pns_if'}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec pns ip addr show \"t17pns_if\" | awk 'FNR==3{ print $2 }' | grep -w '^192.168.7.1/24' ; if [ $? -ne 0 ] ; then ip netns exec pns ip addr add \"192.168.7.1/24\" dev \"t17pns_if\" ; fi\nip netns exec \"t17\" ip addr show \"t17if\" | awk 'FNR==3{ print $2 }' | grep -w '^192.168.7.2/24' ; if [ $? -ne 0 ] ; then ip netns exec \"t17\" ip addr add \"192.168.7.2/24\" dev \"t17if\" ; fi\n", "delta": "0:00:00.173202", "end": "2019-12-05 07:54:50.537265", "item": {"default_route_ip": "192.168.7.1", "name": "t17", "pns_if": "t17pns_if", "pns_ip": "192.168.7.1/24", "tenant_if": "t17if", "tenant_ip": "192.168.7.2/24"}, "rc": 0, "start": "2019-12-05 07:54:50.364063", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Create Namespace VETH Pairs] **************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.61.1/24', u'ns_name': u't17', u'ns_if': u't17if', u'if': u'p1'}], u'default_route_ip': u'10.1.61.1', u'bridge_name': u't17br1', u'dns': [{u'dnsif': u't17s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't17s1_dnsbrif'}], u'ns_name': u't17ns1', u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't17_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't17br1if1', u'vmif': u't17VM1if1'}, {u'mem': 4, u'name': u't17_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't17br1if2', u'vmif': u't17VM2if1'}], u'vxlan': [{u'local_ip': u'10.1.61.2', u'dsport': 4789, u'dev': u't17s1if', u'tenant_route_ip': u'192.168.7.2', u'remote_route': u'10.2.61.0/24', u'subnet_route': u'10.1.61.0/24', u'v_name': u'vxlan_t17s1', u'id': 42, u'remote_ip': u'10.2.61.2'}]}, {u'tenant_sub_ip': u'10.1.61.2/24', u'tenant_ns_ip': u'10.1.61.1/24', u'tenant_ns_if': u't17ns1if', u'tenant_sub_if': u't17s1if', u'tenant_ns_name': u't17'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip link show \"t17ns1if\" ; if [ $? -ne 0 ] ; then ip link add \"t17ns1if\" type veth peer name \"t17s1if\" ; fi\n", "delta": "0:00:00.017580", "end": "2019-12-05 07:54:50.873665", "item": [{"bridge_name": "t17br1", "default_route_ip": "10.1.61.1", "dns": [{"brif": "t17s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.5", "dnsif": "t17s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t17ns1", "route": [{"if": "p1", "ip": "10.1.61.1/24", "ns_if": "t17if", "ns_name": "t17"}], "subnet_ip": "1.1.1.0/24", "vms": [{"brif": "t17br1if1", "disk": "10G", "mem": 2, "name": "t17_VM1", "vcpu": 4, "vmif": "t17VM1if1"}, {"brif": "t17br1if2", "disk": "10G", "mem": 4, "name": "t17_VM2", "vcpu": 2, "vmif": "t17VM2if1"}], "vxlan": [{"dev": "t17s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.61.2", "remote_ip": "10.2.61.2", "remote_route": "10.2.61.0/24", "subnet_route": "10.1.61.0/24", "tenant_route_ip": "192.168.7.2", "v_name": "vxlan_t17s1"}]}, {"tenant_ns_if": "t17ns1if", "tenant_ns_ip": "10.1.61.1/24", "tenant_ns_name": "t17", "tenant_sub_if": "t17s1if", "tenant_sub_ip": "10.1.61.2/24"}], "rc": 0, "start": "2019-12-05 07:54:50.856085", "stderr": "Device \"t17ns1if\" does not exist.", "stderr_lines": ["Device \"t17ns1if\" does not exist."], "stdout": "", "stdout_lines": []}

TASK [Attach Namespace VETH Pairs] **************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.61.1/24', u'ns_name': u't17', u'ns_if': u't17if', u'if': u'p1'}], u'default_route_ip': u'10.1.61.1', u'bridge_name': u't17br1', u'dns': [{u'dnsif': u't17s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't17s1_dnsbrif'}], u'ns_name': u't17ns1', u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't17_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't17br1if1', u'vmif': u't17VM1if1'}, {u'mem': 4, u'name': u't17_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't17br1if2', u'vmif': u't17VM2if1'}], u'vxlan': [{u'local_ip': u'10.1.61.2', u'dsport': 4789, u'dev': u't17s1if', u'tenant_route_ip': u'192.168.7.2', u'remote_route': u'10.2.61.0/24', u'subnet_route': u'10.1.61.0/24', u'v_name': u'vxlan_t17s1', u'id': 42, u'remote_ip': u'10.2.61.2'}]}, {u'tenant_sub_ip': u'10.1.61.2/24', u'tenant_ns_ip': u'10.1.61.1/24', u'tenant_ns_if': u't17ns1if', u'tenant_sub_if': u't17s1if', u'tenant_ns_name': u't17'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t17\" ip link show \"t17ns1if\" ; if [ $? -ne 0 ] ; then ip link set \"t17ns1if\" netns \"t17\" ; fi\nip netns exec \"t17ns1\" ip link show \"t17s1if\" ; if [ $? -ne 0 ] ; then ip link set \"t17s1if\" netns \"t17ns1\" ; fi\n", "delta": "0:00:00.134772", "end": "2019-12-05 07:54:51.334228", "item": [{"bridge_name": "t17br1", "default_route_ip": "10.1.61.1", "dns": [{"brif": "t17s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.5", "dnsif": "t17s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t17ns1", "route": [{"if": "p1", "ip": "10.1.61.1/24", "ns_if": "t17if", "ns_name": "t17"}], "subnet_ip": "1.1.1.0/24", "vms": [{"brif": "t17br1if1", "disk": "10G", "mem": 2, "name": "t17_VM1", "vcpu": 4, "vmif": "t17VM1if1"}, {"brif": "t17br1if2", "disk": "10G", "mem": 4, "name": "t17_VM2", "vcpu": 2, "vmif": "t17VM2if1"}], "vxlan": [{"dev": "t17s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.61.2", "remote_ip": "10.2.61.2", "remote_route": "10.2.61.0/24", "subnet_route": "10.1.61.0/24", "tenant_route_ip": "192.168.7.2", "v_name": "vxlan_t17s1"}]}, {"tenant_ns_if": "t17ns1if", "tenant_ns_ip": "10.1.61.1/24", "tenant_ns_name": "t17", "tenant_sub_if": "t17s1if", "tenant_sub_ip": "10.1.61.2/24"}], "rc": 0, "start": "2019-12-05 07:54:51.199456", "stderr": "Device \"t17ns1if\" does not exist.\nDevice \"t17s1if\" does not exist.", "stderr_lines": ["Device \"t17ns1if\" does not exist.", "Device \"t17s1if\" does not exist."], "stdout": "", "stdout_lines": []}

TASK [Set Namespace VETH Pairs UP] **************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.61.1/24', u'ns_name': u't17', u'ns_if': u't17if', u'if': u'p1'}], u'default_route_ip': u'10.1.61.1', u'bridge_name': u't17br1', u'dns': [{u'dnsif': u't17s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't17s1_dnsbrif'}], u'ns_name': u't17ns1', u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't17_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't17br1if1', u'vmif': u't17VM1if1'}, {u'mem': 4, u'name': u't17_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't17br1if2', u'vmif': u't17VM2if1'}], u'vxlan': [{u'local_ip': u'10.1.61.2', u'dsport': 4789, u'dev': u't17s1if', u'tenant_route_ip': u'192.168.7.2', u'remote_route': u'10.2.61.0/24', u'subnet_route': u'10.1.61.0/24', u'v_name': u'vxlan_t17s1', u'id': 42, u'remote_ip': u'10.2.61.2'}]}, {u'tenant_sub_ip': u'10.1.61.2/24', u'tenant_ns_ip': u'10.1.61.1/24', u'tenant_ns_if': u't17ns1if', u'tenant_sub_if': u't17s1if', u'tenant_ns_name': u't17'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t17\" ip link set dev \"t17ns1if\" up\nip netns exec \"t17ns1\" ip link set dev \"t17s1if\" up\n", "delta": "0:00:00.082066", "end": "2019-12-05 07:54:51.773365", "item": [{"bridge_name": "t17br1", "default_route_ip": "10.1.61.1", "dns": [{"brif": "t17s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.5", "dnsif": "t17s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t17ns1", "route": [{"if": "p1", "ip": "10.1.61.1/24", "ns_if": "t17if", "ns_name": "t17"}], "subnet_ip": "1.1.1.0/24", "vms": [{"brif": "t17br1if1", "disk": "10G", "mem": 2, "name": "t17_VM1", "vcpu": 4, "vmif": "t17VM1if1"}, {"brif": "t17br1if2", "disk": "10G", "mem": 4, "name": "t17_VM2", "vcpu": 2, "vmif": "t17VM2if1"}], "vxlan": [{"dev": "t17s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.61.2", "remote_ip": "10.2.61.2", "remote_route": "10.2.61.0/24", "subnet_route": "10.1.61.0/24", "tenant_route_ip": "192.168.7.2", "v_name": "vxlan_t17s1"}]}, {"tenant_ns_if": "t17ns1if", "tenant_ns_ip": "10.1.61.1/24", "tenant_ns_name": "t17", "tenant_sub_if": "t17s1if", "tenant_sub_ip": "10.1.61.2/24"}], "rc": 0, "start": "2019-12-05 07:54:51.691299", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Add IP addresses to Namespace VETH Pairs] *************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.61.1/24', u'ns_name': u't17', u'ns_if': u't17if', u'if': u'p1'}], u'default_route_ip': u'10.1.61.1', u'bridge_name': u't17br1', u'dns': [{u'dnsif': u't17s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't17s1_dnsbrif'}], u'ns_name': u't17ns1', u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't17_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't17br1if1', u'vmif': u't17VM1if1'}, {u'mem': 4, u'name': u't17_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't17br1if2', u'vmif': u't17VM2if1'}], u'vxlan': [{u'local_ip': u'10.1.61.2', u'dsport': 4789, u'dev': u't17s1if', u'tenant_route_ip': u'192.168.7.2', u'remote_route': u'10.2.61.0/24', u'subnet_route': u'10.1.61.0/24', u'v_name': u'vxlan_t17s1', u'id': 42, u'remote_ip': u'10.2.61.2'}]}, {u'tenant_sub_ip': u'10.1.61.2/24', u'tenant_ns_ip': u'10.1.61.1/24', u'tenant_ns_if': u't17ns1if', u'tenant_sub_if': u't17s1if', u'tenant_ns_name': u't17'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t17ns1\" ip addr show \"t17s1if\" | awk 'FNR==3{ print $2 }' | grep -w '^10.1.61.2/24' ; if [ $? -ne 0 ] ; then ip netns exec \"t17ns1\" ip addr add \"10.1.61.2/24\" dev \"t17s1if\" ; fi\n\nip netns exec \"t17\" ip addr show \"t17ns1if\" | awk 'FNR==3{ print $2 }' | grep -w '^10.1.61.1/24' ; if [ $? -ne 0 ] ; then ip netns exec \"t17\" ip addr add \"10.1.61.1/24\" dev \"t17ns1if\" ; fi\n", "delta": "0:00:00.180626", "end": "2019-12-05 07:54:52.273151", "item": [{"bridge_name": "t17br1", "default_route_ip": "10.1.61.1", "dns": [{"brif": "t17s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.5", "dnsif": "t17s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t17ns1", "route": [{"if": "p1", "ip": "10.1.61.1/24", "ns_if": "t17if", "ns_name": "t17"}], "subnet_ip": "1.1.1.0/24", "vms": [{"brif": "t17br1if1", "disk": "10G", "mem": 2, "name": "t17_VM1", "vcpu": 4, "vmif": "t17VM1if1"}, {"brif": "t17br1if2", "disk": "10G", "mem": 4, "name": "t17_VM2", "vcpu": 2, "vmif": "t17VM2if1"}], "vxlan": [{"dev": "t17s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.61.2", "remote_ip": "10.2.61.2", "remote_route": "10.2.61.0/24", "subnet_route": "10.1.61.0/24", "tenant_route_ip": "192.168.7.2", "v_name": "vxlan_t17s1"}]}, {"tenant_ns_if": "t17ns1if", "tenant_ns_ip": "10.1.61.1/24", "tenant_ns_name": "t17", "tenant_sub_if": "t17s1if", "tenant_sub_ip": "10.1.61.2/24"}], "rc": 0, "start": "2019-12-05 07:54:52.092525", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Add IP Route to Tenant] *******************************************************************************************************************************
changed: [localhost] => (item={u'default_route_ip': u'192.168.7.1', u'name': u't17', u'pns_ip': u'192.168.7.1/24', u'tenant_if': u't17if', u'tenant_ip': u'192.168.7.2/24', u'pns_if': u't17pns_if'}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t17\" ip route show default | grep -w '[d]efault via 192.168.7.1' ; if [ $? -ne 0 ] ; then ip netns exec \"t17\" ip route add default via \"192.168.7.1\" ; fi\n", "delta": "0:00:00.070607", "end": "2019-12-05 07:54:52.621177", "item": {"default_route_ip": "192.168.7.1", "name": "t17", "pns_if": "t17pns_if", "pns_ip": "192.168.7.1/24", "tenant_if": "t17if", "tenant_ip": "192.168.7.2/24"}, "rc": 0, "start": "2019-12-05 07:54:52.550570", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Add IP Route to Tenant Subnet] ************************************************************************************************************************
changed: [localhost] => (item={u'route': [{u'ip': u'10.1.61.1/24', u'ns_name': u't17', u'ns_if': u't17if', u'if': u'p1'}], u'default_route_ip': u'10.1.61.1', u'bridge_name': u't17br1', u'dns': [{u'dnsif': u't17s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't17s1_dnsbrif'}], u'ns_name': u't17ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.61.2/24', u'tenant_ns_ip': u'10.1.61.1/24', u'tenant_ns_if': u't17ns1if', u'tenant_ns_name': u't17', u'tenant_sub_if': u't17s1if'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't17_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't17br1if1', u'vmif': u't17VM1if1'}, {u'mem': 4, u'name': u't17_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't17br1if2', u'vmif': u't17VM2if1'}], u'vxlan': [{u'local_ip': u'10.1.61.2', u'tenant_route_ip': u'192.168.7.2', u'dsport': 4789, u'dev': u't17s1if', u'subnet_route': u'10.1.61.0/24', u'remote_route': u'10.2.61.0/24', u'v_name': u'vxlan_t17s1', u'id': 42, u'remote_ip': u'10.2.61.2'}]}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t17ns1\" ip route show default | grep -w '[d]efault via 10.1.61.1' ; if [ $? -ne 0 ] ; then ip netns exec \"t17ns1\" ip route add default via \"10.1.61.1\" ; fi\n", "delta": "0:00:00.084907", "end": "2019-12-05 07:54:52.985317", "item": {"bridge_name": "t17br1", "default_route_ip": "10.1.61.1", "dns": [{"brif": "t17s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.5", "dnsif": "t17s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t17ns1", "route": [{"if": "p1", "ip": "10.1.61.1/24", "ns_if": "t17if", "ns_name": "t17"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t17ns1if", "tenant_ns_ip": "10.1.61.1/24", "tenant_ns_name": "t17", "tenant_sub_if": "t17s1if", "tenant_sub_ip": "10.1.61.2/24"}], "vms": [{"brif": "t17br1if1", "disk": "10G", "mem": 2, "name": "t17_VM1", "vcpu": 4, "vmif": "t17VM1if1"}, {"brif": "t17br1if2", "disk": "10G", "mem": 4, "name": "t17_VM2", "vcpu": 2, "vmif": "t17VM2if1"}], "vxlan": [{"dev": "t17s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.61.2", "remote_ip": "10.2.61.2", "remote_route": "10.2.61.0/24", "subnet_route": "10.1.61.0/24", "tenant_route_ip": "192.168.7.2", "v_name": "vxlan_t17s1"}]}, "rc": 0, "start": "2019-12-05 07:54:52.900410", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Create bridge inside namespace] ***********************************************************************************************************************
changed: [localhost] => (item={u'route': [{u'ip': u'10.1.61.1/24', u'ns_name': u't17', u'ns_if': u't17if', u'if': u'p1'}], u'default_route_ip': u'10.1.61.1', u'bridge_name': u't17br1', u'dns': [{u'dnsif': u't17s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't17s1_dnsbrif'}], u'ns_name': u't17ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.61.2/24', u'tenant_ns_ip': u'10.1.61.1/24', u'tenant_ns_if': u't17ns1if', u'tenant_ns_name': u't17', u'tenant_sub_if': u't17s1if'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't17_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't17br1if1', u'vmif': u't17VM1if1'}, {u'mem': 4, u'name': u't17_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't17br1if2', u'vmif': u't17VM2if1'}], u'vxlan': [{u'local_ip': u'10.1.61.2', u'tenant_route_ip': u'192.168.7.2', u'dsport': 4789, u'dev': u't17s1if', u'subnet_route': u'10.1.61.0/24', u'remote_route': u'10.2.61.0/24', u'v_name': u'vxlan_t17s1', u'id': 42, u'remote_ip': u'10.2.61.2'}]}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t17ns1\" brctl show | grep -w '^t17br1'; if [ $? -ne 0 ] ; then ip netns exec \"t17ns1\" brctl addbr \"t17br1\" ; fi\nip netns exec \"t17ns1\" ip link set dev \"t17br1\" up\n", "delta": "0:00:00.129517", "end": "2019-12-05 07:54:53.425362", "item": {"bridge_name": "t17br1", "default_route_ip": "10.1.61.1", "dns": [{"brif": "t17s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.5", "dnsif": "t17s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t17ns1", "route": [{"if": "p1", "ip": "10.1.61.1/24", "ns_if": "t17if", "ns_name": "t17"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t17ns1if", "tenant_ns_ip": "10.1.61.1/24", "tenant_ns_name": "t17", "tenant_sub_if": "t17s1if", "tenant_sub_ip": "10.1.61.2/24"}], "vms": [{"brif": "t17br1if1", "disk": "10G", "mem": 2, "name": "t17_VM1", "vcpu": 4, "vmif": "t17VM1if1"}, {"brif": "t17br1if2", "disk": "10G", "mem": 4, "name": "t17_VM2", "vcpu": 2, "vmif": "t17VM2if1"}], "vxlan": [{"dev": "t17s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.61.2", "remote_ip": "10.2.61.2", "remote_route": "10.2.61.0/24", "subnet_route": "10.1.61.0/24", "tenant_route_ip": "192.168.7.2", "v_name": "vxlan_t17s1"}]}, "rc": 0, "start": "2019-12-05 07:54:53.295845", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Create DNS VETH Pair] *********************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.61.1/24', u'ns_name': u't17', u'ns_if': u't17if', u'if': u'p1'}], u'default_route_ip': u'10.1.61.1', u'bridge_name': u't17br1', u'ns_name': u't17ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.61.2/24', u'tenant_ns_ip': u'10.1.61.1/24', u'tenant_ns_if': u't17ns1if', u'tenant_sub_if': u't17s1if', u'tenant_ns_name': u't17'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't17_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't17br1if1', u'vmif': u't17VM1if1'}, {u'mem': 4, u'name': u't17_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't17br1if2', u'vmif': u't17VM2if1'}], u'vxlan': [{u'local_ip': u'10.1.61.2', u'dsport': 4789, u'dev': u't17s1if', u'tenant_route_ip': u'192.168.7.2', u'remote_route': u'10.2.61.0/24', u'subnet_route': u'10.1.61.0/24', u'v_name': u'vxlan_t17s1', u'id': 42, u'remote_ip': u'10.2.61.2'}]}, {u'dnsif': u't17s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't17s1_dnsbrif'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t17ns1\" ip link show \"t17s1_dnsbrif\" ; if [ $? -ne 0 ] ; then ip netns exec \"t17ns1\" ip link add \"t17s1_dnsbrif\" type veth peer name \"t17s1_dnsif\" ; fi\nip netns exec \"t17ns1\" ip link set dev \"t17s1_dnsbrif\" up\nip netns exec \"t17ns1\" ip link set dev \"t17s1_dnsif\" up\n", "delta": "0:00:00.153208", "end": "2019-12-05 07:54:53.889322", "item": [{"bridge_name": "t17br1", "default_route_ip": "10.1.61.1", "ns_name": "t17ns1", "route": [{"if": "p1", "ip": "10.1.61.1/24", "ns_if": "t17if", "ns_name": "t17"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t17ns1if", "tenant_ns_ip": "10.1.61.1/24", "tenant_ns_name": "t17", "tenant_sub_if": "t17s1if", "tenant_sub_ip": "10.1.61.2/24"}], "vms": [{"brif": "t17br1if1", "disk": "10G", "mem": 2, "name": "t17_VM1", "vcpu": 4, "vmif": "t17VM1if1"}, {"brif": "t17br1if2", "disk": "10G", "mem": 4, "name": "t17_VM2", "vcpu": 2, "vmif": "t17VM2if1"}], "vxlan": [{"dev": "t17s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.61.2", "remote_ip": "10.2.61.2", "remote_route": "10.2.61.0/24", "subnet_route": "10.1.61.0/24", "tenant_route_ip": "192.168.7.2", "v_name": "vxlan_t17s1"}]}, {"brif": "t17s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.5", "dnsif": "t17s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "rc": 0, "start": "2019-12-05 07:54:53.736114", "stderr": "Device \"t17s1_dnsbrif\" does not exist.", "stderr_lines": ["Device \"t17s1_dnsbrif\" does not exist."], "stdout": "", "stdout_lines": []}

TASK [Attach DNS VETH Pair] *********************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.61.1/24', u'ns_name': u't17', u'ns_if': u't17if', u'if': u'p1'}], u'default_route_ip': u'10.1.61.1', u'bridge_name': u't17br1', u'ns_name': u't17ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.61.2/24', u'tenant_ns_ip': u'10.1.61.1/24', u'tenant_ns_if': u't17ns1if', u'tenant_sub_if': u't17s1if', u'tenant_ns_name': u't17'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't17_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't17br1if1', u'vmif': u't17VM1if1'}, {u'mem': 4, u'name': u't17_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't17br1if2', u'vmif': u't17VM2if1'}], u'vxlan': [{u'local_ip': u'10.1.61.2', u'dsport': 4789, u'dev': u't17s1if', u'tenant_route_ip': u'192.168.7.2', u'remote_route': u'10.2.61.0/24', u'subnet_route': u'10.1.61.0/24', u'v_name': u'vxlan_t17s1', u'id': 42, u'remote_ip': u'10.2.61.2'}]}, {u'dnsif': u't17s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't17s1_dnsbrif'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t17ns1\" brctl show \"t17br1\" | grep -w 't17s1_dnsbrif' ; if [ $? -ne 0 ] ; then ip netns exec \"t17ns1\" brctl addif \"t17br1\" \"t17s1_dnsbrif\" ; fi\n", "delta": "0:00:00.099638", "end": "2019-12-05 07:54:54.297405", "item": [{"bridge_name": "t17br1", "default_route_ip": "10.1.61.1", "ns_name": "t17ns1", "route": [{"if": "p1", "ip": "10.1.61.1/24", "ns_if": "t17if", "ns_name": "t17"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t17ns1if", "tenant_ns_ip": "10.1.61.1/24", "tenant_ns_name": "t17", "tenant_sub_if": "t17s1if", "tenant_sub_ip": "10.1.61.2/24"}], "vms": [{"brif": "t17br1if1", "disk": "10G", "mem": 2, "name": "t17_VM1", "vcpu": 4, "vmif": "t17VM1if1"}, {"brif": "t17br1if2", "disk": "10G", "mem": 4, "name": "t17_VM2", "vcpu": 2, "vmif": "t17VM2if1"}], "vxlan": [{"dev": "t17s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.61.2", "remote_ip": "10.2.61.2", "remote_route": "10.2.61.0/24", "subnet_route": "10.1.61.0/24", "tenant_route_ip": "192.168.7.2", "v_name": "vxlan_t17s1"}]}, {"brif": "t17s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.5", "dnsif": "t17s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "rc": 0, "start": "2019-12-05 07:54:54.197767", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Create VETH Pairs] ************************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.61.1/24', u'ns_name': u't17', u'ns_if': u't17if', u'if': u'p1'}], u'default_route_ip': u'10.1.61.1', u'bridge_name': u't17br1', u'dns': [{u'dnsif': u't17s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't17s1_dnsbrif'}], u'ns_name': u't17ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.61.2/24', u'tenant_ns_ip': u'10.1.61.1/24', u'tenant_ns_if': u't17ns1if', u'tenant_sub_if': u't17s1if', u'tenant_ns_name': u't17'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.1.61.2', u'dsport': 4789, u'dev': u't17s1if', u'tenant_route_ip': u'192.168.7.2', u'remote_route': u'10.2.61.0/24', u'subnet_route': u'10.1.61.0/24', u'v_name': u'vxlan_t17s1', u'id': 42, u'remote_ip': u'10.2.61.2'}]}, {u'mem': 2, u'name': u't17_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't17br1if1', u'vmif': u't17VM1if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip link show \"t17br1if1\" ; if [ $? -ne 0 ] ; then ip link add \"t17VM1if1\" type veth peer name \"t17br1if1\" ; fi\nip link set dev \"t17br1if1\" up\nip link set dev \"t17VM1if1\" up\n", "delta": "0:00:00.022428", "end": "2019-12-05 07:54:54.658931", "item": [{"bridge_name": "t17br1", "default_route_ip": "10.1.61.1", "dns": [{"brif": "t17s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.5", "dnsif": "t17s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t17ns1", "route": [{"if": "p1", "ip": "10.1.61.1/24", "ns_if": "t17if", "ns_name": "t17"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t17ns1if", "tenant_ns_ip": "10.1.61.1/24", "tenant_ns_name": "t17", "tenant_sub_if": "t17s1if", "tenant_sub_ip": "10.1.61.2/24"}], "vxlan": [{"dev": "t17s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.61.2", "remote_ip": "10.2.61.2", "remote_route": "10.2.61.0/24", "subnet_route": "10.1.61.0/24", "tenant_route_ip": "192.168.7.2", "v_name": "vxlan_t17s1"}]}, {"brif": "t17br1if1", "disk": "10G", "mem": 2, "name": "t17_VM1", "vcpu": 4, "vmif": "t17VM1if1"}], "rc": 0, "start": "2019-12-05 07:54:54.636503", "stderr": "Device \"t17br1if1\" does not exist.", "stderr_lines": ["Device \"t17br1if1\" does not exist."], "stdout": "", "stdout_lines": []}
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.61.1/24', u'ns_name': u't17', u'ns_if': u't17if', u'if': u'p1'}], u'default_route_ip': u'10.1.61.1', u'bridge_name': u't17br1', u'dns': [{u'dnsif': u't17s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't17s1_dnsbrif'}], u'ns_name': u't17ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.61.2/24', u'tenant_ns_ip': u'10.1.61.1/24', u'tenant_ns_if': u't17ns1if', u'tenant_sub_if': u't17s1if', u'tenant_ns_name': u't17'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.1.61.2', u'dsport': 4789, u'dev': u't17s1if', u'tenant_route_ip': u'192.168.7.2', u'remote_route': u'10.2.61.0/24', u'subnet_route': u'10.1.61.0/24', u'v_name': u'vxlan_t17s1', u'id': 42, u'remote_ip': u'10.2.61.2'}]}, {u'mem': 4, u'name': u't17_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't17br1if2', u'vmif': u't17VM2if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip link show \"t17br1if2\" ; if [ $? -ne 0 ] ; then ip link add \"t17VM2if1\" type veth peer name \"t17br1if2\" ; fi\nip link set dev \"t17br1if2\" up\nip link set dev \"t17VM2if1\" up\n", "delta": "0:00:00.022502", "end": "2019-12-05 07:54:54.916365", "item": [{"bridge_name": "t17br1", "default_route_ip": "10.1.61.1", "dns": [{"brif": "t17s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.5", "dnsif": "t17s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t17ns1", "route": [{"if": "p1", "ip": "10.1.61.1/24", "ns_if": "t17if", "ns_name": "t17"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t17ns1if", "tenant_ns_ip": "10.1.61.1/24", "tenant_ns_name": "t17", "tenant_sub_if": "t17s1if", "tenant_sub_ip": "10.1.61.2/24"}], "vxlan": [{"dev": "t17s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.61.2", "remote_ip": "10.2.61.2", "remote_route": "10.2.61.0/24", "subnet_route": "10.1.61.0/24", "tenant_route_ip": "192.168.7.2", "v_name": "vxlan_t17s1"}]}, {"brif": "t17br1if2", "disk": "10G", "mem": 4, "name": "t17_VM2", "vcpu": 2, "vmif": "t17VM2if1"}], "rc": 0, "start": "2019-12-05 07:54:54.893863", "stderr": "Device \"t17br1if2\" does not exist.", "stderr_lines": ["Device \"t17br1if2\" does not exist."], "stdout": "", "stdout_lines": []}

TASK [Attach VETH Pairs] ************************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.61.1/24', u'ns_name': u't17', u'ns_if': u't17if', u'if': u'p1'}], u'default_route_ip': u'10.1.61.1', u'bridge_name': u't17br1', u'dns': [{u'dnsif': u't17s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't17s1_dnsbrif'}], u'ns_name': u't17ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.61.2/24', u'tenant_ns_ip': u'10.1.61.1/24', u'tenant_ns_if': u't17ns1if', u'tenant_sub_if': u't17s1if', u'tenant_ns_name': u't17'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.1.61.2', u'dsport': 4789, u'dev': u't17s1if', u'tenant_route_ip': u'192.168.7.2', u'remote_route': u'10.2.61.0/24', u'subnet_route': u'10.1.61.0/24', u'v_name': u'vxlan_t17s1', u'id': 42, u'remote_ip': u'10.2.61.2'}]}, {u'mem': 2, u'name': u't17_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't17br1if1', u'vmif': u't17VM1if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip link show \"t17br1if1\" ; if [ $? -eq 0 ] ; then ip link set \"t17br1if1\" netns \"t17ns1\" ; fi\nip netns exec \"t17ns1\" brctl show \"t17br1\" | grep -w 't17br1if1' ; if [ $? -ne 0 ] ; then ip netns exec \"t17ns1\" brctl addif \"t17br1\" \"t17br1if1\" ; fi\n", "delta": "0:00:00.141600", "end": "2019-12-05 07:54:55.373070", "item": [{"bridge_name": "t17br1", "default_route_ip": "10.1.61.1", "dns": [{"brif": "t17s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.5", "dnsif": "t17s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t17ns1", "route": [{"if": "p1", "ip": "10.1.61.1/24", "ns_if": "t17if", "ns_name": "t17"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t17ns1if", "tenant_ns_ip": "10.1.61.1/24", "tenant_ns_name": "t17", "tenant_sub_if": "t17s1if", "tenant_sub_ip": "10.1.61.2/24"}], "vxlan": [{"dev": "t17s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.61.2", "remote_ip": "10.2.61.2", "remote_route": "10.2.61.0/24", "subnet_route": "10.1.61.0/24", "tenant_route_ip": "192.168.7.2", "v_name": "vxlan_t17s1"}]}, {"brif": "t17br1if1", "disk": "10G", "mem": 2, "name": "t17_VM1", "vcpu": 4, "vmif": "t17VM1if1"}], "rc": 0, "start": "2019-12-05 07:54:55.231470", "stderr": "", "stderr_lines": [], "stdout": "117: t17br1if1@t17VM1if1: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP mode DEFAULT group default qlen 1000\n    link/ether ba:3b:8e:a7:ff:b6 brd ff:ff:ff:ff:ff:ff", "stdout_lines": ["117: t17br1if1@t17VM1if1: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP mode DEFAULT group default qlen 1000", "    link/ether ba:3b:8e:a7:ff:b6 brd ff:ff:ff:ff:ff:ff"]}
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.61.1/24', u'ns_name': u't17', u'ns_if': u't17if', u'if': u'p1'}], u'default_route_ip': u'10.1.61.1', u'bridge_name': u't17br1', u'dns': [{u'dnsif': u't17s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't17s1_dnsbrif'}], u'ns_name': u't17ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.61.2/24', u'tenant_ns_ip': u'10.1.61.1/24', u'tenant_ns_if': u't17ns1if', u'tenant_sub_if': u't17s1if', u'tenant_ns_name': u't17'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.1.61.2', u'dsport': 4789, u'dev': u't17s1if', u'tenant_route_ip': u'192.168.7.2', u'remote_route': u'10.2.61.0/24', u'subnet_route': u'10.1.61.0/24', u'v_name': u'vxlan_t17s1', u'id': 42, u'remote_ip': u'10.2.61.2'}]}, {u'mem': 4, u'name': u't17_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't17br1if2', u'vmif': u't17VM2if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip link show \"t17br1if2\" ; if [ $? -eq 0 ] ; then ip link set \"t17br1if2\" netns \"t17ns1\" ; fi\nip netns exec \"t17ns1\" brctl show \"t17br1\" | grep -w 't17br1if2' ; if [ $? -ne 0 ] ; then ip netns exec \"t17ns1\" brctl addif \"t17br1\" \"t17br1if2\" ; fi\n", "delta": "0:00:00.102235", "end": "2019-12-05 07:54:55.685097", "item": [{"bridge_name": "t17br1", "default_route_ip": "10.1.61.1", "dns": [{"brif": "t17s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.5", "dnsif": "t17s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t17ns1", "route": [{"if": "p1", "ip": "10.1.61.1/24", "ns_if": "t17if", "ns_name": "t17"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t17ns1if", "tenant_ns_ip": "10.1.61.1/24", "tenant_ns_name": "t17", "tenant_sub_if": "t17s1if", "tenant_sub_ip": "10.1.61.2/24"}], "vxlan": [{"dev": "t17s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.61.2", "remote_ip": "10.2.61.2", "remote_route": "10.2.61.0/24", "subnet_route": "10.1.61.0/24", "tenant_route_ip": "192.168.7.2", "v_name": "vxlan_t17s1"}]}, {"brif": "t17br1if2", "disk": "10G", "mem": 4, "name": "t17_VM2", "vcpu": 2, "vmif": "t17VM2if1"}], "rc": 0, "start": "2019-12-05 07:54:55.582862", "stderr": "", "stderr_lines": [], "stdout": "119: t17br1if2@t17VM2if1: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP mode DEFAULT group default qlen 1000\n    link/ether 92:da:c6:62:53:0c brd ff:ff:ff:ff:ff:ff", "stdout_lines": ["119: t17br1if2@t17VM2if1: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP mode DEFAULT group default qlen 1000", "    link/ether 92:da:c6:62:53:0c brd ff:ff:ff:ff:ff:ff"]}

TASK [All interfaces and bridges UP] ************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.61.1/24', u'ns_name': u't17', u'ns_if': u't17if', u'if': u'p1'}], u'default_route_ip': u'10.1.61.1', u'bridge_name': u't17br1', u'dns': [{u'dnsif': u't17s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't17s1_dnsbrif'}], u'ns_name': u't17ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.61.2/24', u'tenant_ns_ip': u'10.1.61.1/24', u'tenant_ns_if': u't17ns1if', u'tenant_sub_if': u't17s1if', u'tenant_ns_name': u't17'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.1.61.2', u'dsport': 4789, u'dev': u't17s1if', u'tenant_route_ip': u'192.168.7.2', u'remote_route': u'10.2.61.0/24', u'subnet_route': u'10.1.61.0/24', u'v_name': u'vxlan_t17s1', u'id': 42, u'remote_ip': u'10.2.61.2'}]}, {u'mem': 2, u'name': u't17_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't17br1if1', u'vmif': u't17VM1if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t17ns1\" ip link set \"t17br1if1\" up\nip netns exec \"t17ns1\" ip link set dev \"t17br1\" up\n", "delta": "0:00:00.071666", "end": "2019-12-05 07:54:56.029269", "item": [{"bridge_name": "t17br1", "default_route_ip": "10.1.61.1", "dns": [{"brif": "t17s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.5", "dnsif": "t17s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t17ns1", "route": [{"if": "p1", "ip": "10.1.61.1/24", "ns_if": "t17if", "ns_name": "t17"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t17ns1if", "tenant_ns_ip": "10.1.61.1/24", "tenant_ns_name": "t17", "tenant_sub_if": "t17s1if", "tenant_sub_ip": "10.1.61.2/24"}], "vxlan": [{"dev": "t17s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.61.2", "remote_ip": "10.2.61.2", "remote_route": "10.2.61.0/24", "subnet_route": "10.1.61.0/24", "tenant_route_ip": "192.168.7.2", "v_name": "vxlan_t17s1"}]}, {"brif": "t17br1if1", "disk": "10G", "mem": 2, "name": "t17_VM1", "vcpu": 4, "vmif": "t17VM1if1"}], "rc": 0, "start": "2019-12-05 07:54:55.957603", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.61.1/24', u'ns_name': u't17', u'ns_if': u't17if', u'if': u'p1'}], u'default_route_ip': u'10.1.61.1', u'bridge_name': u't17br1', u'dns': [{u'dnsif': u't17s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't17s1_dnsbrif'}], u'ns_name': u't17ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.61.2/24', u'tenant_ns_ip': u'10.1.61.1/24', u'tenant_ns_if': u't17ns1if', u'tenant_sub_if': u't17s1if', u'tenant_ns_name': u't17'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.1.61.2', u'dsport': 4789, u'dev': u't17s1if', u'tenant_route_ip': u'192.168.7.2', u'remote_route': u'10.2.61.0/24', u'subnet_route': u'10.1.61.0/24', u'v_name': u'vxlan_t17s1', u'id': 42, u'remote_ip': u'10.2.61.2'}]}, {u'mem': 4, u'name': u't17_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't17br1if2', u'vmif': u't17VM2if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t17ns1\" ip link set \"t17br1if2\" up\nip netns exec \"t17ns1\" ip link set dev \"t17br1\" up\n", "delta": "0:00:00.074313", "end": "2019-12-05 07:54:56.337274", "item": [{"bridge_name": "t17br1", "default_route_ip": "10.1.61.1", "dns": [{"brif": "t17s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.5", "dnsif": "t17s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t17ns1", "route": [{"if": "p1", "ip": "10.1.61.1/24", "ns_if": "t17if", "ns_name": "t17"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t17ns1if", "tenant_ns_ip": "10.1.61.1/24", "tenant_ns_name": "t17", "tenant_sub_if": "t17s1if", "tenant_sub_ip": "10.1.61.2/24"}], "vxlan": [{"dev": "t17s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.61.2", "remote_ip": "10.2.61.2", "remote_route": "10.2.61.0/24", "subnet_route": "10.1.61.0/24", "tenant_route_ip": "192.168.7.2", "v_name": "vxlan_t17s1"}]}, {"brif": "t17br1if2", "disk": "10G", "mem": 4, "name": "t17_VM2", "vcpu": 2, "vmif": "t17VM2if1"}], "rc": 0, "start": "2019-12-05 07:54:56.262961", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Add IP to DNS Interface] ******************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.61.1/24', u'ns_name': u't17', u'ns_if': u't17if', u'if': u'p1'}], u'default_route_ip': u'10.1.61.1', u'bridge_name': u't17br1', u'ns_name': u't17ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.61.2/24', u'tenant_ns_ip': u'10.1.61.1/24', u'tenant_ns_if': u't17ns1if', u'tenant_sub_if': u't17s1if', u'tenant_ns_name': u't17'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't17_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't17br1if1', u'vmif': u't17VM1if1'}, {u'mem': 4, u'name': u't17_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't17br1if2', u'vmif': u't17VM2if1'}], u'vxlan': [{u'local_ip': u'10.1.61.2', u'dsport': 4789, u'dev': u't17s1if', u'tenant_route_ip': u'192.168.7.2', u'remote_route': u'10.2.61.0/24', u'subnet_route': u'10.1.61.0/24', u'v_name': u'vxlan_t17s1', u'id': 42, u'remote_ip': u'10.2.61.2'}]}, {u'dnsif': u't17s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't17s1_dnsbrif'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t17ns1\" ip addr show \"t17s1_dnsif\" | awk 'FNR==3{ print $2 }' | grep -w '^1.1.1.1/24' ; if [ $? -ne 0 ] ; then ip netns exec \"t17ns1\" ip addr add \"1.1.1.1/24\" dev \"t17s1_dnsif\" ; fi\n", "delta": "0:00:00.099228", "end": "2019-12-05 07:54:56.729152", "item": [{"bridge_name": "t17br1", "default_route_ip": "10.1.61.1", "ns_name": "t17ns1", "route": [{"if": "p1", "ip": "10.1.61.1/24", "ns_if": "t17if", "ns_name": "t17"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t17ns1if", "tenant_ns_ip": "10.1.61.1/24", "tenant_ns_name": "t17", "tenant_sub_if": "t17s1if", "tenant_sub_ip": "10.1.61.2/24"}], "vms": [{"brif": "t17br1if1", "disk": "10G", "mem": 2, "name": "t17_VM1", "vcpu": 4, "vmif": "t17VM1if1"}, {"brif": "t17br1if2", "disk": "10G", "mem": 4, "name": "t17_VM2", "vcpu": 2, "vmif": "t17VM2if1"}], "vxlan": [{"dev": "t17s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.61.2", "remote_ip": "10.2.61.2", "remote_route": "10.2.61.0/24", "subnet_route": "10.1.61.0/24", "tenant_route_ip": "192.168.7.2", "v_name": "vxlan_t17s1"}]}, {"brif": "t17s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.5", "dnsif": "t17s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "rc": 0, "start": "2019-12-05 07:54:56.629924", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Install DHCP Server] **********************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.61.1/24', u'ns_name': u't17', u'ns_if': u't17if', u'if': u'p1'}], u'default_route_ip': u'10.1.61.1', u'bridge_name': u't17br1', u'ns_name': u't17ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.61.2/24', u'tenant_ns_ip': u'10.1.61.1/24', u'tenant_ns_if': u't17ns1if', u'tenant_sub_if': u't17s1if', u'tenant_ns_name': u't17'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't17_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't17br1if1', u'vmif': u't17VM1if1'}, {u'mem': 4, u'name': u't17_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't17br1if2', u'vmif': u't17VM2if1'}], u'vxlan': [{u'local_ip': u'10.1.61.2', u'dsport': 4789, u'dev': u't17s1if', u'tenant_route_ip': u'192.168.7.2', u'remote_route': u'10.2.61.0/24', u'subnet_route': u'10.1.61.0/24', u'v_name': u'vxlan_t17s1', u'id': 42, u'remote_ip': u'10.2.61.2'}]}, {u'dnsif': u't17s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't17s1_dnsbrif'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t17ns1\" ps aux | grep -w '[d]nsmasq --interface t17s1_dnsif -z --dhcp-range=1.1.1.5,1.1.1.254' ; if [ $? -ne 0 ] ; then ip netns exec \"t17ns1\" dnsmasq --interface \"t17s1_dnsif\" -z --dhcp-range=1.1.1.5,'1.1.1.254' ; fi\n", "delta": "0:00:00.075665", "end": "2019-12-05 07:54:57.089689", "item": [{"bridge_name": "t17br1", "default_route_ip": "10.1.61.1", "ns_name": "t17ns1", "route": [{"if": "p1", "ip": "10.1.61.1/24", "ns_if": "t17if", "ns_name": "t17"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t17ns1if", "tenant_ns_ip": "10.1.61.1/24", "tenant_ns_name": "t17", "tenant_sub_if": "t17s1if", "tenant_sub_ip": "10.1.61.2/24"}], "vms": [{"brif": "t17br1if1", "disk": "10G", "mem": 2, "name": "t17_VM1", "vcpu": 4, "vmif": "t17VM1if1"}, {"brif": "t17br1if2", "disk": "10G", "mem": 4, "name": "t17_VM2", "vcpu": 2, "vmif": "t17VM2if1"}], "vxlan": [{"dev": "t17s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.61.2", "remote_ip": "10.2.61.2", "remote_route": "10.2.61.0/24", "subnet_route": "10.1.61.0/24", "tenant_route_ip": "192.168.7.2", "v_name": "vxlan_t17s1"}]}, {"brif": "t17s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.5", "dnsif": "t17s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "rc": 0, "start": "2019-12-05 07:54:57.014024", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Create VXLAN devices] *********************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.61.1/24', u'ns_name': u't17', u'ns_if': u't17if', u'if': u'p1'}], u'default_route_ip': u'10.1.61.1', u'bridge_name': u't17br1', u'dns': [{u'dnsif': u't17s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't17s1_dnsbrif'}], u'ns_name': u't17ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.61.2/24', u'tenant_ns_ip': u'10.1.61.1/24', u'tenant_ns_if': u't17ns1if', u'tenant_sub_if': u't17s1if', u'tenant_ns_name': u't17'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't17_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't17br1if1', u'vmif': u't17VM1if1'}, {u'mem': 4, u'name': u't17_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't17br1if2', u'vmif': u't17VM2if1'}]}, {u'local_ip': u'10.1.61.2', u'dsport': 4789, u'dev': u't17s1if', u'tenant_route_ip': u'192.168.7.2', u'remote_route': u'10.2.61.0/24', u'subnet_route': u'10.1.61.0/24', u'v_name': u'vxlan_t17s1', u'id': 42, u'remote_ip': u'10.2.61.2'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t17ns1\" ip link show \"vxlan_t17s1\" ; if [ $? -ne 0 ] ; then ip netns exec \"t17ns1\" ip link add \"vxlan_t17s1\" type vxlan id \"42\" local \"10.1.61.2\" remote \"10.2.61.2\" dstport \"4789\" dev \"t17s1if\"; ip netns exec \"t17ns1\" ip link set dev \"vxlan_t17s1\" up ; fi\n", "delta": "0:00:00.103870", "end": "2019-12-05 07:54:57.473150", "item": [{"bridge_name": "t17br1", "default_route_ip": "10.1.61.1", "dns": [{"brif": "t17s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.5", "dnsif": "t17s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t17ns1", "route": [{"if": "p1", "ip": "10.1.61.1/24", "ns_if": "t17if", "ns_name": "t17"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t17ns1if", "tenant_ns_ip": "10.1.61.1/24", "tenant_ns_name": "t17", "tenant_sub_if": "t17s1if", "tenant_sub_ip": "10.1.61.2/24"}], "vms": [{"brif": "t17br1if1", "disk": "10G", "mem": 2, "name": "t17_VM1", "vcpu": 4, "vmif": "t17VM1if1"}, {"brif": "t17br1if2", "disk": "10G", "mem": 4, "name": "t17_VM2", "vcpu": 2, "vmif": "t17VM2if1"}]}, {"dev": "t17s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.61.2", "remote_ip": "10.2.61.2", "remote_route": "10.2.61.0/24", "subnet_route": "10.1.61.0/24", "tenant_route_ip": "192.168.7.2", "v_name": "vxlan_t17s1"}], "rc": 0, "start": "2019-12-05 07:54:57.369280", "stderr": "Device \"vxlan_t17s1\" does not exist.", "stderr_lines": ["Device \"vxlan_t17s1\" does not exist."], "stdout": "", "stdout_lines": []}

TASK [Attach VXLANs to bridge] ******************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.61.1/24', u'ns_name': u't17', u'ns_if': u't17if', u'if': u'p1'}], u'default_route_ip': u'10.1.61.1', u'bridge_name': u't17br1', u'dns': [{u'dnsif': u't17s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't17s1_dnsbrif'}], u'ns_name': u't17ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.61.2/24', u'tenant_ns_ip': u'10.1.61.1/24', u'tenant_ns_if': u't17ns1if', u'tenant_sub_if': u't17s1if', u'tenant_ns_name': u't17'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't17_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't17br1if1', u'vmif': u't17VM1if1'}, {u'mem': 4, u'name': u't17_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't17br1if2', u'vmif': u't17VM2if1'}]}, {u'local_ip': u'10.1.61.2', u'dsport': 4789, u'dev': u't17s1if', u'tenant_route_ip': u'192.168.7.2', u'remote_route': u'10.2.61.0/24', u'subnet_route': u'10.1.61.0/24', u'v_name': u'vxlan_t17s1', u'id': 42, u'remote_ip': u'10.2.61.2'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t17ns1\" brctl show \"t17br1\" | grep -w 'vxlan_t17s1' ; if [ $? -ne 0 ] ; then ip netns exec \"t17ns1\" brctl addif \"t17br1\" \"vxlan_t17s1\" ; fi\n", "delta": "0:00:00.084572", "end": "2019-12-05 07:54:57.841213", "item": [{"bridge_name": "t17br1", "default_route_ip": "10.1.61.1", "dns": [{"brif": "t17s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.5", "dnsif": "t17s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t17ns1", "route": [{"if": "p1", "ip": "10.1.61.1/24", "ns_if": "t17if", "ns_name": "t17"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t17ns1if", "tenant_ns_ip": "10.1.61.1/24", "tenant_ns_name": "t17", "tenant_sub_if": "t17s1if", "tenant_sub_ip": "10.1.61.2/24"}], "vms": [{"brif": "t17br1if1", "disk": "10G", "mem": 2, "name": "t17_VM1", "vcpu": 4, "vmif": "t17VM1if1"}, {"brif": "t17br1if2", "disk": "10G", "mem": 4, "name": "t17_VM2", "vcpu": 2, "vmif": "t17VM2if1"}]}, {"dev": "t17s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.61.2", "remote_ip": "10.2.61.2", "remote_route": "10.2.61.0/24", "subnet_route": "10.1.61.0/24", "tenant_route_ip": "192.168.7.2", "v_name": "vxlan_t17s1"}], "rc": 0, "start": "2019-12-05 07:54:57.756641", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

PLAY RECAP **************************************************************************************************************************************************
localhost                  : ok=21   changed=21   unreachable=0    failed=0    skipped=0    rescued=0    ignored=0   

Using /etc/ansible/ansible.cfg as config file

PLAY [worker] ***********************************************************************************************************************************************

TASK [Create Tenant Namespace] ******************************************************************************************************************************
changed: [99.99.99.2] => (item={u'default_route_ip': u'192.168.135.1', u'name': u't17', u'pns_ip': u'192.168.135.1/24', u'tenant_if': u't17if', u'tenant_ip': u'192.168.135.2/24', u'pns_if': u't17pns_if'}) => {"ansible_loop_var": "item", "changed": true, "cmd": ["ip", "netns", "add", "t17"], "delta": "0:00:00.069666", "end": "2019-12-05 07:54:59.905818", "item": {"default_route_ip": "192.168.135.1", "name": "t17", "pns_if": "t17pns_if", "pns_ip": "192.168.135.1/24", "tenant_if": "t17if", "tenant_ip": "192.168.135.2/24"}, "rc": 0, "start": "2019-12-05 07:54:59.836152", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Create Subnet Namespace] ******************************************************************************************************************************
changed: [99.99.99.2] => (item={u'route': [{u'ip': u'10.2.61.1/24', u'ns_name': u't17', u'ns_if': u't17if', u'if': u'p1'}], u'default_route_ip': u'10.2.61.1', u'bridge_name': u't17br1', u'dns': [{u'dnsif': [], u'dhcp_start': [], u'dhcp_end': [], u'dnsif_ip': [], u'net_mask': [], u'brif': []}], u'ns_name': u't17ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.61.2/24', u'tenant_ns_ip': u'10.2.61.1/24', u'tenant_ns_if': u't17ns1if', u'tenant_ns_name': u't17', u'tenant_sub_if': u't17s1if'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't17_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't17br1if1', u'vmif': u't17VM4if1'}], u'vxlan': [{u'local_ip': u'10.2.61.2', u'tenant_route_ip': u'192.168.135.2', u'dsport': 4789, u'dev': u't17s1if', u'subnet_route': u'10.2.61.0/24', u'remote_route': u'10.1.61.0/24', u'v_name': u'vxlan_t17s1', u'id': 42, u'remote_ip': u'10.1.61.2'}]}) => {"ansible_loop_var": "item", "changed": true, "cmd": ["ip", "netns", "add", "t17ns1"], "delta": "0:00:00.065146", "end": "2019-12-05 07:55:00.397527", "item": {"bridge_name": "t17br1", "default_route_ip": "10.2.61.1", "dns": [{"brif": [], "dhcp_end": [], "dhcp_start": [], "dnsif": [], "dnsif_ip": [], "net_mask": []}], "ns_name": "t17ns1", "route": [{"if": "p1", "ip": "10.2.61.1/24", "ns_if": "t17if", "ns_name": "t17"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t17ns1if", "tenant_ns_ip": "10.2.61.1/24", "tenant_ns_name": "t17", "tenant_sub_if": "t17s1if", "tenant_sub_ip": "10.2.61.2/24"}], "vms": [{"brif": "t17br1if1", "disk": "10G", "mem": 2, "name": "t17_VM4", "vcpu": 4, "vmif": "t17VM4if1"}], "vxlan": [{"dev": "t17s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.61.2", "remote_ip": "10.1.61.2", "remote_route": "10.1.61.0/24", "subnet_route": "10.2.61.0/24", "tenant_route_ip": "192.168.135.2", "v_name": "vxlan_t17s1"}]}, "rc": 0, "start": "2019-12-05 07:55:00.332381", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}
changed: [99.99.99.2] => (item={u'route': [{u'ip': u'10.2.62.1/24', u'ns_name': u't17', u'ns_if': u't17if', u'if': u'p1'}], u'default_route_ip': u'10.2.62.1', u'bridge_name': u't17br2', u'dns': [{u'dnsif': u't17s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't17s2_dnsbrif'}], u'ns_name': u't17ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.62.2/24', u'tenant_ns_ip': u'10.2.62.1/24', u'tenant_ns_if': u't17ns2if', u'tenant_ns_name': u't17', u'tenant_sub_if': u't17s2if'}], u'subnet_ip': u'2.2.2.0/24', u'vms': [{u'mem': 3, u'name': u't17_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't17br2if1', u'vmif': u't17VM3if1'}], u'vxlan': [{u'local_ip': [], u'tenant_route_ip': [], u'dsport': [], u'dev': [], u'subnet_route': [], u'remote_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}) => {"ansible_loop_var": "item", "changed": true, "cmd": ["ip", "netns", "add", "t17ns2"], "delta": "0:00:00.061062", "end": "2019-12-05 07:55:00.807463", "item": {"bridge_name": "t17br2", "default_route_ip": "10.2.62.1", "dns": [{"brif": "t17s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t17s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t17ns2", "route": [{"if": "p1", "ip": "10.2.62.1/24", "ns_if": "t17if", "ns_name": "t17"}], "subnet_ip": "2.2.2.0/24", "tenant_ns": [{"tenant_ns_if": "t17ns2if", "tenant_ns_ip": "10.2.62.1/24", "tenant_ns_name": "t17", "tenant_sub_if": "t17s2if", "tenant_sub_ip": "10.2.62.2/24"}], "vms": [{"brif": "t17br2if1", "disk": "10G", "mem": 3, "name": "t17_VM3", "vcpu": 2, "vmif": "t17VM3if1"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, "rc": 0, "start": "2019-12-05 07:55:00.746401", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Create Tenant VETH pairs] *****************************************************************************************************************************
changed: [99.99.99.2] => (item={u'default_route_ip': u'192.168.135.1', u'name': u't17', u'pns_ip': u'192.168.135.1/24', u'tenant_if': u't17if', u'tenant_ip': u'192.168.135.2/24', u'pns_if': u't17pns_if'}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip link show \"t17if\" ; if [ $? -ne 0 ] ; then ip link add \"t17if\" type veth peer name \"t17pns_if\" ; fi\n", "delta": "0:00:00.017140", "end": "2019-12-05 07:55:01.230072", "item": {"default_route_ip": "192.168.135.1", "name": "t17", "pns_if": "t17pns_if", "pns_ip": "192.168.135.1/24", "tenant_if": "t17if", "tenant_ip": "192.168.135.2/24"}, "rc": 0, "start": "2019-12-05 07:55:01.212932", "stderr": "Device \"t17if\" does not exist.", "stderr_lines": ["Device \"t17if\" does not exist."], "stdout": "", "stdout_lines": []}

TASK [Attach Tenant VETH Pairs] *****************************************************************************************************************************
changed: [99.99.99.2] => (item={u'default_route_ip': u'192.168.135.1', u'name': u't17', u'pns_ip': u'192.168.135.1/24', u'tenant_if': u't17if', u'tenant_ip': u'192.168.135.2/24', u'pns_if': u't17pns_if'}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec pns ip link show \"t17pns_if\" ; if [ $? -ne 0 ] ; then ip link set \"t17pns_if\" netns pns ; fi\nip netns exec \"t17\" ip link show \"t17if\" ; if [ $? -ne 0 ] ; then ip link set \"t17if\" netns \"t17\" ; fi\nip netns exec pns ip link set dev \"t17pns_if\" up\nip netns exec \"t17\" ip link set dev \"t17if\" up\n", "delta": "0:00:00.205378", "end": "2019-12-05 07:55:01.872503", "item": {"default_route_ip": "192.168.135.1", "name": "t17", "pns_if": "t17pns_if", "pns_ip": "192.168.135.1/24", "tenant_if": "t17if", "tenant_ip": "192.168.135.2/24"}, "rc": 0, "start": "2019-12-05 07:55:01.667125", "stderr": "Device \"t17pns_if\" does not exist.\nDevice \"t17if\" does not exist.", "stderr_lines": ["Device \"t17pns_if\" does not exist.", "Device \"t17if\" does not exist."], "stdout": "", "stdout_lines": []}

TASK [Add IP addresses to Tenant VETH Pairs] ****************************************************************************************************************
changed: [99.99.99.2] => (item={u'default_route_ip': u'192.168.135.1', u'name': u't17', u'pns_ip': u'192.168.135.1/24', u'tenant_if': u't17if', u'tenant_ip': u'192.168.135.2/24', u'pns_if': u't17pns_if'}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec pns ip addr show \"t17pns_if\" | awk 'FNR==3{ print $2 }' | grep -w '^192.168.135.1/24' ; if [ $? -ne 0 ] ; then ip netns exec pns ip addr add \"192.168.135.1/24\" dev \"t17pns_if\" ; fi\nip netns exec \"t17\" ip addr show \"t17if\" | awk 'FNR==3{ print $2 }' | grep -w '^192.168.135.2/24' ; if [ $? -ne 0 ] ; then ip netns exec \"t17\" ip addr add \"192.168.135.2/24\" dev \"t17if\" ; fi\n", "delta": "0:00:00.160411", "end": "2019-12-05 07:55:02.460573", "item": {"default_route_ip": "192.168.135.1", "name": "t17", "pns_if": "t17pns_if", "pns_ip": "192.168.135.1/24", "tenant_if": "t17if", "tenant_ip": "192.168.135.2/24"}, "rc": 0, "start": "2019-12-05 07:55:02.300162", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Create Namespace VETH Pairs] **************************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.61.1/24', u'ns_name': u't17', u'ns_if': u't17if', u'if': u'p1'}], u'default_route_ip': u'10.2.61.1', u'bridge_name': u't17br1', u'dns': [{u'dnsif': [], u'dhcp_start': [], u'dhcp_end': [], u'dnsif_ip': [], u'net_mask': [], u'brif': []}], u'ns_name': u't17ns1', u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't17_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't17br1if1', u'vmif': u't17VM4if1'}], u'vxlan': [{u'local_ip': u'10.2.61.2', u'dsport': 4789, u'dev': u't17s1if', u'tenant_route_ip': u'192.168.135.2', u'remote_route': u'10.1.61.0/24', u'subnet_route': u'10.2.61.0/24', u'v_name': u'vxlan_t17s1', u'id': 42, u'remote_ip': u'10.1.61.2'}]}, {u'tenant_sub_ip': u'10.2.61.2/24', u'tenant_ns_ip': u'10.2.61.1/24', u'tenant_ns_if': u't17ns1if', u'tenant_sub_if': u't17s1if', u'tenant_ns_name': u't17'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip link show \"t17ns1if\" ; if [ $? -ne 0 ] ; then ip link add \"t17ns1if\" type veth peer name \"t17s1if\" ; fi\n", "delta": "0:00:00.015631", "end": "2019-12-05 07:55:02.912385", "item": [{"bridge_name": "t17br1", "default_route_ip": "10.2.61.1", "dns": [{"brif": [], "dhcp_end": [], "dhcp_start": [], "dnsif": [], "dnsif_ip": [], "net_mask": []}], "ns_name": "t17ns1", "route": [{"if": "p1", "ip": "10.2.61.1/24", "ns_if": "t17if", "ns_name": "t17"}], "subnet_ip": "1.1.1.0/24", "vms": [{"brif": "t17br1if1", "disk": "10G", "mem": 2, "name": "t17_VM4", "vcpu": 4, "vmif": "t17VM4if1"}], "vxlan": [{"dev": "t17s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.61.2", "remote_ip": "10.1.61.2", "remote_route": "10.1.61.0/24", "subnet_route": "10.2.61.0/24", "tenant_route_ip": "192.168.135.2", "v_name": "vxlan_t17s1"}]}, {"tenant_ns_if": "t17ns1if", "tenant_ns_ip": "10.2.61.1/24", "tenant_ns_name": "t17", "tenant_sub_if": "t17s1if", "tenant_sub_ip": "10.2.61.2/24"}], "rc": 0, "start": "2019-12-05 07:55:02.896754", "stderr": "Device \"t17ns1if\" does not exist.", "stderr_lines": ["Device \"t17ns1if\" does not exist."], "stdout": "", "stdout_lines": []}
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.62.1/24', u'ns_name': u't17', u'ns_if': u't17if', u'if': u'p1'}], u'default_route_ip': u'10.2.62.1', u'bridge_name': u't17br2', u'dns': [{u'dnsif': u't17s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't17s2_dnsbrif'}], u'ns_name': u't17ns2', u'subnet_ip': u'2.2.2.0/24', u'vms': [{u'mem': 3, u'name': u't17_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't17br2if1', u'vmif': u't17VM3if1'}], u'vxlan': [{u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}, {u'tenant_sub_ip': u'10.2.62.2/24', u'tenant_ns_ip': u'10.2.62.1/24', u'tenant_ns_if': u't17ns2if', u'tenant_sub_if': u't17s2if', u'tenant_ns_name': u't17'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip link show \"t17ns2if\" ; if [ $? -ne 0 ] ; then ip link add \"t17ns2if\" type veth peer name \"t17s2if\" ; fi\n", "delta": "0:00:00.015035", "end": "2019-12-05 07:55:03.315472", "item": [{"bridge_name": "t17br2", "default_route_ip": "10.2.62.1", "dns": [{"brif": "t17s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t17s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t17ns2", "route": [{"if": "p1", "ip": "10.2.62.1/24", "ns_if": "t17if", "ns_name": "t17"}], "subnet_ip": "2.2.2.0/24", "vms": [{"brif": "t17br2if1", "disk": "10G", "mem": 3, "name": "t17_VM3", "vcpu": 2, "vmif": "t17VM3if1"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, {"tenant_ns_if": "t17ns2if", "tenant_ns_ip": "10.2.62.1/24", "tenant_ns_name": "t17", "tenant_sub_if": "t17s2if", "tenant_sub_ip": "10.2.62.2/24"}], "rc": 0, "start": "2019-12-05 07:55:03.300437", "stderr": "Device \"t17ns2if\" does not exist.", "stderr_lines": ["Device \"t17ns2if\" does not exist."], "stdout": "", "stdout_lines": []}

TASK [Attach Namespace VETH Pairs] **************************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.61.1/24', u'ns_name': u't17', u'ns_if': u't17if', u'if': u'p1'}], u'default_route_ip': u'10.2.61.1', u'bridge_name': u't17br1', u'dns': [{u'dnsif': [], u'dhcp_start': [], u'dhcp_end': [], u'dnsif_ip': [], u'net_mask': [], u'brif': []}], u'ns_name': u't17ns1', u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't17_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't17br1if1', u'vmif': u't17VM4if1'}], u'vxlan': [{u'local_ip': u'10.2.61.2', u'dsport': 4789, u'dev': u't17s1if', u'tenant_route_ip': u'192.168.135.2', u'remote_route': u'10.1.61.0/24', u'subnet_route': u'10.2.61.0/24', u'v_name': u'vxlan_t17s1', u'id': 42, u'remote_ip': u'10.1.61.2'}]}, {u'tenant_sub_ip': u'10.2.61.2/24', u'tenant_ns_ip': u'10.2.61.1/24', u'tenant_ns_if': u't17ns1if', u'tenant_sub_if': u't17s1if', u'tenant_ns_name': u't17'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t17\" ip link show \"t17ns1if\" ; if [ $? -ne 0 ] ; then ip link set \"t17ns1if\" netns \"t17\" ; fi\nip netns exec \"t17ns1\" ip link show \"t17s1if\" ; if [ $? -ne 0 ] ; then ip link set \"t17s1if\" netns \"t17ns1\" ; fi\n", "delta": "0:00:00.120380", "end": "2019-12-05 07:55:03.870822", "item": [{"bridge_name": "t17br1", "default_route_ip": "10.2.61.1", "dns": [{"brif": [], "dhcp_end": [], "dhcp_start": [], "dnsif": [], "dnsif_ip": [], "net_mask": []}], "ns_name": "t17ns1", "route": [{"if": "p1", "ip": "10.2.61.1/24", "ns_if": "t17if", "ns_name": "t17"}], "subnet_ip": "1.1.1.0/24", "vms": [{"brif": "t17br1if1", "disk": "10G", "mem": 2, "name": "t17_VM4", "vcpu": 4, "vmif": "t17VM4if1"}], "vxlan": [{"dev": "t17s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.61.2", "remote_ip": "10.1.61.2", "remote_route": "10.1.61.0/24", "subnet_route": "10.2.61.0/24", "tenant_route_ip": "192.168.135.2", "v_name": "vxlan_t17s1"}]}, {"tenant_ns_if": "t17ns1if", "tenant_ns_ip": "10.2.61.1/24", "tenant_ns_name": "t17", "tenant_sub_if": "t17s1if", "tenant_sub_ip": "10.2.61.2/24"}], "rc": 0, "start": "2019-12-05 07:55:03.750442", "stderr": "Device \"t17ns1if\" does not exist.\nDevice \"t17s1if\" does not exist.", "stderr_lines": ["Device \"t17ns1if\" does not exist.", "Device \"t17s1if\" does not exist."], "stdout": "", "stdout_lines": []}
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.62.1/24', u'ns_name': u't17', u'ns_if': u't17if', u'if': u'p1'}], u'default_route_ip': u'10.2.62.1', u'bridge_name': u't17br2', u'dns': [{u'dnsif': u't17s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't17s2_dnsbrif'}], u'ns_name': u't17ns2', u'subnet_ip': u'2.2.2.0/24', u'vms': [{u'mem': 3, u'name': u't17_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't17br2if1', u'vmif': u't17VM3if1'}], u'vxlan': [{u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}, {u'tenant_sub_ip': u'10.2.62.2/24', u'tenant_ns_ip': u'10.2.62.1/24', u'tenant_ns_if': u't17ns2if', u'tenant_sub_if': u't17s2if', u'tenant_ns_name': u't17'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t17\" ip link show \"t17ns2if\" ; if [ $? -ne 0 ] ; then ip link set \"t17ns2if\" netns \"t17\" ; fi\nip netns exec \"t17ns2\" ip link show \"t17s2if\" ; if [ $? -ne 0 ] ; then ip link set \"t17s2if\" netns \"t17ns2\" ; fi\n", "delta": "0:00:00.118128", "end": "2019-12-05 07:55:04.337184", "item": [{"bridge_name": "t17br2", "default_route_ip": "10.2.62.1", "dns": [{"brif": "t17s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t17s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t17ns2", "route": [{"if": "p1", "ip": "10.2.62.1/24", "ns_if": "t17if", "ns_name": "t17"}], "subnet_ip": "2.2.2.0/24", "vms": [{"brif": "t17br2if1", "disk": "10G", "mem": 3, "name": "t17_VM3", "vcpu": 2, "vmif": "t17VM3if1"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, {"tenant_ns_if": "t17ns2if", "tenant_ns_ip": "10.2.62.1/24", "tenant_ns_name": "t17", "tenant_sub_if": "t17s2if", "tenant_sub_ip": "10.2.62.2/24"}], "rc": 0, "start": "2019-12-05 07:55:04.219056", "stderr": "Device \"t17ns2if\" does not exist.\nDevice \"t17s2if\" does not exist.", "stderr_lines": ["Device \"t17ns2if\" does not exist.", "Device \"t17s2if\" does not exist."], "stdout": "", "stdout_lines": []}

TASK [Set Namespace VETH Pairs UP] **************************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.61.1/24', u'ns_name': u't17', u'ns_if': u't17if', u'if': u'p1'}], u'default_route_ip': u'10.2.61.1', u'bridge_name': u't17br1', u'dns': [{u'dnsif': [], u'dhcp_start': [], u'dhcp_end': [], u'dnsif_ip': [], u'net_mask': [], u'brif': []}], u'ns_name': u't17ns1', u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't17_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't17br1if1', u'vmif': u't17VM4if1'}], u'vxlan': [{u'local_ip': u'10.2.61.2', u'dsport': 4789, u'dev': u't17s1if', u'tenant_route_ip': u'192.168.135.2', u'remote_route': u'10.1.61.0/24', u'subnet_route': u'10.2.61.0/24', u'v_name': u'vxlan_t17s1', u'id': 42, u'remote_ip': u'10.1.61.2'}]}, {u'tenant_sub_ip': u'10.2.61.2/24', u'tenant_ns_ip': u'10.2.61.1/24', u'tenant_ns_if': u't17ns1if', u'tenant_sub_if': u't17s1if', u'tenant_ns_name': u't17'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t17\" ip link set dev \"t17ns1if\" up\nip netns exec \"t17ns1\" ip link set dev \"t17s1if\" up\n", "delta": "0:00:00.103999", "end": "2019-12-05 07:55:04.860551", "item": [{"bridge_name": "t17br1", "default_route_ip": "10.2.61.1", "dns": [{"brif": [], "dhcp_end": [], "dhcp_start": [], "dnsif": [], "dnsif_ip": [], "net_mask": []}], "ns_name": "t17ns1", "route": [{"if": "p1", "ip": "10.2.61.1/24", "ns_if": "t17if", "ns_name": "t17"}], "subnet_ip": "1.1.1.0/24", "vms": [{"brif": "t17br1if1", "disk": "10G", "mem": 2, "name": "t17_VM4", "vcpu": 4, "vmif": "t17VM4if1"}], "vxlan": [{"dev": "t17s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.61.2", "remote_ip": "10.1.61.2", "remote_route": "10.1.61.0/24", "subnet_route": "10.2.61.0/24", "tenant_route_ip": "192.168.135.2", "v_name": "vxlan_t17s1"}]}, {"tenant_ns_if": "t17ns1if", "tenant_ns_ip": "10.2.61.1/24", "tenant_ns_name": "t17", "tenant_sub_if": "t17s1if", "tenant_sub_ip": "10.2.61.2/24"}], "rc": 0, "start": "2019-12-05 07:55:04.756552", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.62.1/24', u'ns_name': u't17', u'ns_if': u't17if', u'if': u'p1'}], u'default_route_ip': u'10.2.62.1', u'bridge_name': u't17br2', u'dns': [{u'dnsif': u't17s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't17s2_dnsbrif'}], u'ns_name': u't17ns2', u'subnet_ip': u'2.2.2.0/24', u'vms': [{u'mem': 3, u'name': u't17_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't17br2if1', u'vmif': u't17VM3if1'}], u'vxlan': [{u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}, {u'tenant_sub_ip': u'10.2.62.2/24', u'tenant_ns_ip': u'10.2.62.1/24', u'tenant_ns_if': u't17ns2if', u'tenant_sub_if': u't17s2if', u'tenant_ns_name': u't17'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t17\" ip link set dev \"t17ns2if\" up\nip netns exec \"t17ns2\" ip link set dev \"t17s2if\" up\n", "delta": "0:00:00.079659", "end": "2019-12-05 07:55:05.280550", "item": [{"bridge_name": "t17br2", "default_route_ip": "10.2.62.1", "dns": [{"brif": "t17s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t17s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t17ns2", "route": [{"if": "p1", "ip": "10.2.62.1/24", "ns_if": "t17if", "ns_name": "t17"}], "subnet_ip": "2.2.2.0/24", "vms": [{"brif": "t17br2if1", "disk": "10G", "mem": 3, "name": "t17_VM3", "vcpu": 2, "vmif": "t17VM3if1"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, {"tenant_ns_if": "t17ns2if", "tenant_ns_ip": "10.2.62.1/24", "tenant_ns_name": "t17", "tenant_sub_if": "t17s2if", "tenant_sub_ip": "10.2.62.2/24"}], "rc": 0, "start": "2019-12-05 07:55:05.200891", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Add IP addresses to Namespace VETH Pairs] *************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.61.1/24', u'ns_name': u't17', u'ns_if': u't17if', u'if': u'p1'}], u'default_route_ip': u'10.2.61.1', u'bridge_name': u't17br1', u'dns': [{u'dnsif': [], u'dhcp_start': [], u'dhcp_end': [], u'dnsif_ip': [], u'net_mask': [], u'brif': []}], u'ns_name': u't17ns1', u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't17_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't17br1if1', u'vmif': u't17VM4if1'}], u'vxlan': [{u'local_ip': u'10.2.61.2', u'dsport': 4789, u'dev': u't17s1if', u'tenant_route_ip': u'192.168.135.2', u'remote_route': u'10.1.61.0/24', u'subnet_route': u'10.2.61.0/24', u'v_name': u'vxlan_t17s1', u'id': 42, u'remote_ip': u'10.1.61.2'}]}, {u'tenant_sub_ip': u'10.2.61.2/24', u'tenant_ns_ip': u'10.2.61.1/24', u'tenant_ns_if': u't17ns1if', u'tenant_sub_if': u't17s1if', u'tenant_ns_name': u't17'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t17ns1\" ip addr show \"t17s1if\" | awk 'FNR==3{ print $2 }' | grep -w '^10.2.61.2/24' ; if [ $? -ne 0 ] ; then ip netns exec \"t17ns1\" ip addr add \"10.2.61.2/24\" dev \"t17s1if\" ; fi\n\nip netns exec \"t17\" ip addr show \"t17ns1if\" | awk 'FNR==3{ print $2 }' | grep -w '^10.2.61.1/24' ; if [ $? -ne 0 ] ; then ip netns exec \"t17\" ip addr add \"10.2.61.1/24\" dev \"t17ns1if\" ; fi\n", "delta": "0:00:00.168264", "end": "2019-12-05 07:55:05.896454", "item": [{"bridge_name": "t17br1", "default_route_ip": "10.2.61.1", "dns": [{"brif": [], "dhcp_end": [], "dhcp_start": [], "dnsif": [], "dnsif_ip": [], "net_mask": []}], "ns_name": "t17ns1", "route": [{"if": "p1", "ip": "10.2.61.1/24", "ns_if": "t17if", "ns_name": "t17"}], "subnet_ip": "1.1.1.0/24", "vms": [{"brif": "t17br1if1", "disk": "10G", "mem": 2, "name": "t17_VM4", "vcpu": 4, "vmif": "t17VM4if1"}], "vxlan": [{"dev": "t17s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.61.2", "remote_ip": "10.1.61.2", "remote_route": "10.1.61.0/24", "subnet_route": "10.2.61.0/24", "tenant_route_ip": "192.168.135.2", "v_name": "vxlan_t17s1"}]}, {"tenant_ns_if": "t17ns1if", "tenant_ns_ip": "10.2.61.1/24", "tenant_ns_name": "t17", "tenant_sub_if": "t17s1if", "tenant_sub_ip": "10.2.61.2/24"}], "rc": 0, "start": "2019-12-05 07:55:05.728190", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.62.1/24', u'ns_name': u't17', u'ns_if': u't17if', u'if': u'p1'}], u'default_route_ip': u'10.2.62.1', u'bridge_name': u't17br2', u'dns': [{u'dnsif': u't17s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't17s2_dnsbrif'}], u'ns_name': u't17ns2', u'subnet_ip': u'2.2.2.0/24', u'vms': [{u'mem': 3, u'name': u't17_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't17br2if1', u'vmif': u't17VM3if1'}], u'vxlan': [{u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}, {u'tenant_sub_ip': u'10.2.62.2/24', u'tenant_ns_ip': u'10.2.62.1/24', u'tenant_ns_if': u't17ns2if', u'tenant_sub_if': u't17s2if', u'tenant_ns_name': u't17'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t17ns2\" ip addr show \"t17s2if\" | awk 'FNR==3{ print $2 }' | grep -w '^10.2.62.2/24' ; if [ $? -ne 0 ] ; then ip netns exec \"t17ns2\" ip addr add \"10.2.62.2/24\" dev \"t17s2if\" ; fi\n\nip netns exec \"t17\" ip addr show \"t17ns2if\" | awk 'FNR==3{ print $2 }' | grep -w '^10.2.62.1/24' ; if [ $? -ne 0 ] ; then ip netns exec \"t17\" ip addr add \"10.2.62.1/24\" dev \"t17ns2if\" ; fi\n", "delta": "0:00:00.161540", "end": "2019-12-05 07:55:06.408457", "item": [{"bridge_name": "t17br2", "default_route_ip": "10.2.62.1", "dns": [{"brif": "t17s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t17s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t17ns2", "route": [{"if": "p1", "ip": "10.2.62.1/24", "ns_if": "t17if", "ns_name": "t17"}], "subnet_ip": "2.2.2.0/24", "vms": [{"brif": "t17br2if1", "disk": "10G", "mem": 3, "name": "t17_VM3", "vcpu": 2, "vmif": "t17VM3if1"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, {"tenant_ns_if": "t17ns2if", "tenant_ns_ip": "10.2.62.1/24", "tenant_ns_name": "t17", "tenant_sub_if": "t17s2if", "tenant_sub_ip": "10.2.62.2/24"}], "rc": 0, "start": "2019-12-05 07:55:06.246917", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Add IP Route to Tenant] *******************************************************************************************************************************
changed: [99.99.99.2] => (item={u'default_route_ip': u'192.168.135.1', u'name': u't17', u'pns_ip': u'192.168.135.1/24', u'tenant_if': u't17if', u'tenant_ip': u'192.168.135.2/24', u'pns_if': u't17pns_if'}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t17\" ip route show default | grep -w '[d]efault via 192.168.135.1' ; if [ $? -ne 0 ] ; then ip netns exec \"t17\" ip route add default via \"192.168.135.1\" ; fi\n", "delta": "0:00:00.091644", "end": "2019-12-05 07:55:06.912547", "item": {"default_route_ip": "192.168.135.1", "name": "t17", "pns_if": "t17pns_if", "pns_ip": "192.168.135.1/24", "tenant_if": "t17if", "tenant_ip": "192.168.135.2/24"}, "rc": 0, "start": "2019-12-05 07:55:06.820903", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Add IP Route to Tenant Subnet] ************************************************************************************************************************
changed: [99.99.99.2] => (item={u'route': [{u'ip': u'10.2.61.1/24', u'ns_name': u't17', u'ns_if': u't17if', u'if': u'p1'}], u'default_route_ip': u'10.2.61.1', u'bridge_name': u't17br1', u'dns': [{u'dnsif': [], u'dhcp_start': [], u'dhcp_end': [], u'dnsif_ip': [], u'net_mask': [], u'brif': []}], u'ns_name': u't17ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.61.2/24', u'tenant_ns_ip': u'10.2.61.1/24', u'tenant_ns_if': u't17ns1if', u'tenant_ns_name': u't17', u'tenant_sub_if': u't17s1if'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't17_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't17br1if1', u'vmif': u't17VM4if1'}], u'vxlan': [{u'local_ip': u'10.2.61.2', u'tenant_route_ip': u'192.168.135.2', u'dsport': 4789, u'dev': u't17s1if', u'subnet_route': u'10.2.61.0/24', u'remote_route': u'10.1.61.0/24', u'v_name': u'vxlan_t17s1', u'id': 42, u'remote_ip': u'10.1.61.2'}]}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t17ns1\" ip route show default | grep -w '[d]efault via 10.2.61.1' ; if [ $? -ne 0 ] ; then ip netns exec \"t17ns1\" ip route add default via \"10.2.61.1\" ; fi\n", "delta": "0:00:00.076570", "end": "2019-12-05 07:55:07.408575", "item": {"bridge_name": "t17br1", "default_route_ip": "10.2.61.1", "dns": [{"brif": [], "dhcp_end": [], "dhcp_start": [], "dnsif": [], "dnsif_ip": [], "net_mask": []}], "ns_name": "t17ns1", "route": [{"if": "p1", "ip": "10.2.61.1/24", "ns_if": "t17if", "ns_name": "t17"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t17ns1if", "tenant_ns_ip": "10.2.61.1/24", "tenant_ns_name": "t17", "tenant_sub_if": "t17s1if", "tenant_sub_ip": "10.2.61.2/24"}], "vms": [{"brif": "t17br1if1", "disk": "10G", "mem": 2, "name": "t17_VM4", "vcpu": 4, "vmif": "t17VM4if1"}], "vxlan": [{"dev": "t17s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.61.2", "remote_ip": "10.1.61.2", "remote_route": "10.1.61.0/24", "subnet_route": "10.2.61.0/24", "tenant_route_ip": "192.168.135.2", "v_name": "vxlan_t17s1"}]}, "rc": 0, "start": "2019-12-05 07:55:07.332005", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}
changed: [99.99.99.2] => (item={u'route': [{u'ip': u'10.2.62.1/24', u'ns_name': u't17', u'ns_if': u't17if', u'if': u'p1'}], u'default_route_ip': u'10.2.62.1', u'bridge_name': u't17br2', u'dns': [{u'dnsif': u't17s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't17s2_dnsbrif'}], u'ns_name': u't17ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.62.2/24', u'tenant_ns_ip': u'10.2.62.1/24', u'tenant_ns_if': u't17ns2if', u'tenant_ns_name': u't17', u'tenant_sub_if': u't17s2if'}], u'subnet_ip': u'2.2.2.0/24', u'vms': [{u'mem': 3, u'name': u't17_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't17br2if1', u'vmif': u't17VM3if1'}], u'vxlan': [{u'local_ip': [], u'tenant_route_ip': [], u'dsport': [], u'dev': [], u'subnet_route': [], u'remote_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t17ns2\" ip route show default | grep -w '[d]efault via 10.2.62.1' ; if [ $? -ne 0 ] ; then ip netns exec \"t17ns2\" ip route add default via \"10.2.62.1\" ; fi\n", "delta": "0:00:00.074825", "end": "2019-12-05 07:55:07.824498", "item": {"bridge_name": "t17br2", "default_route_ip": "10.2.62.1", "dns": [{"brif": "t17s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t17s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t17ns2", "route": [{"if": "p1", "ip": "10.2.62.1/24", "ns_if": "t17if", "ns_name": "t17"}], "subnet_ip": "2.2.2.0/24", "tenant_ns": [{"tenant_ns_if": "t17ns2if", "tenant_ns_ip": "10.2.62.1/24", "tenant_ns_name": "t17", "tenant_sub_if": "t17s2if", "tenant_sub_ip": "10.2.62.2/24"}], "vms": [{"brif": "t17br2if1", "disk": "10G", "mem": 3, "name": "t17_VM3", "vcpu": 2, "vmif": "t17VM3if1"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, "rc": 0, "start": "2019-12-05 07:55:07.749673", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Create bridge inside namespace] ***********************************************************************************************************************
changed: [99.99.99.2] => (item={u'route': [{u'ip': u'10.2.61.1/24', u'ns_name': u't17', u'ns_if': u't17if', u'if': u'p1'}], u'default_route_ip': u'10.2.61.1', u'bridge_name': u't17br1', u'dns': [{u'dnsif': [], u'dhcp_start': [], u'dhcp_end': [], u'dnsif_ip': [], u'net_mask': [], u'brif': []}], u'ns_name': u't17ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.61.2/24', u'tenant_ns_ip': u'10.2.61.1/24', u'tenant_ns_if': u't17ns1if', u'tenant_ns_name': u't17', u'tenant_sub_if': u't17s1if'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't17_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't17br1if1', u'vmif': u't17VM4if1'}], u'vxlan': [{u'local_ip': u'10.2.61.2', u'tenant_route_ip': u'192.168.135.2', u'dsport': 4789, u'dev': u't17s1if', u'subnet_route': u'10.2.61.0/24', u'remote_route': u'10.1.61.0/24', u'v_name': u'vxlan_t17s1', u'id': 42, u'remote_ip': u'10.1.61.2'}]}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t17ns1\" brctl show | grep -w '^t17br1'; if [ $? -ne 0 ] ; then ip netns exec \"t17ns1\" brctl addbr \"t17br1\" ; fi\nip netns exec \"t17ns1\" ip link set dev \"t17br1\" up\n", "delta": "0:00:00.105829", "end": "2019-12-05 07:55:08.352510", "item": {"bridge_name": "t17br1", "default_route_ip": "10.2.61.1", "dns": [{"brif": [], "dhcp_end": [], "dhcp_start": [], "dnsif": [], "dnsif_ip": [], "net_mask": []}], "ns_name": "t17ns1", "route": [{"if": "p1", "ip": "10.2.61.1/24", "ns_if": "t17if", "ns_name": "t17"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t17ns1if", "tenant_ns_ip": "10.2.61.1/24", "tenant_ns_name": "t17", "tenant_sub_if": "t17s1if", "tenant_sub_ip": "10.2.61.2/24"}], "vms": [{"brif": "t17br1if1", "disk": "10G", "mem": 2, "name": "t17_VM4", "vcpu": 4, "vmif": "t17VM4if1"}], "vxlan": [{"dev": "t17s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.61.2", "remote_ip": "10.1.61.2", "remote_route": "10.1.61.0/24", "subnet_route": "10.2.61.0/24", "tenant_route_ip": "192.168.135.2", "v_name": "vxlan_t17s1"}]}, "rc": 0, "start": "2019-12-05 07:55:08.246681", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}
changed: [99.99.99.2] => (item={u'route': [{u'ip': u'10.2.62.1/24', u'ns_name': u't17', u'ns_if': u't17if', u'if': u'p1'}], u'default_route_ip': u'10.2.62.1', u'bridge_name': u't17br2', u'dns': [{u'dnsif': u't17s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't17s2_dnsbrif'}], u'ns_name': u't17ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.62.2/24', u'tenant_ns_ip': u'10.2.62.1/24', u'tenant_ns_if': u't17ns2if', u'tenant_ns_name': u't17', u'tenant_sub_if': u't17s2if'}], u'subnet_ip': u'2.2.2.0/24', u'vms': [{u'mem': 3, u'name': u't17_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't17br2if1', u'vmif': u't17VM3if1'}], u'vxlan': [{u'local_ip': [], u'tenant_route_ip': [], u'dsport': [], u'dev': [], u'subnet_route': [], u'remote_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t17ns2\" brctl show | grep -w '^t17br2'; if [ $? -ne 0 ] ; then ip netns exec \"t17ns2\" brctl addbr \"t17br2\" ; fi\nip netns exec \"t17ns2\" ip link set dev \"t17br2\" up\n", "delta": "0:00:00.106286", "end": "2019-12-05 07:55:08.809009", "item": {"bridge_name": "t17br2", "default_route_ip": "10.2.62.1", "dns": [{"brif": "t17s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t17s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t17ns2", "route": [{"if": "p1", "ip": "10.2.62.1/24", "ns_if": "t17if", "ns_name": "t17"}], "subnet_ip": "2.2.2.0/24", "tenant_ns": [{"tenant_ns_if": "t17ns2if", "tenant_ns_ip": "10.2.62.1/24", "tenant_ns_name": "t17", "tenant_sub_if": "t17s2if", "tenant_sub_ip": "10.2.62.2/24"}], "vms": [{"brif": "t17br2if1", "disk": "10G", "mem": 3, "name": "t17_VM3", "vcpu": 2, "vmif": "t17VM3if1"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, "rc": 0, "start": "2019-12-05 07:55:08.702723", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Create DNS VETH Pair] *********************************************************************************************************************************
failed: [99.99.99.2] (item=[{u'route': [{u'ip': u'10.2.61.1/24', u'ns_name': u't17', u'ns_if': u't17if', u'if': u'p1'}], u'default_route_ip': u'10.2.61.1', u'bridge_name': u't17br1', u'ns_name': u't17ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.61.2/24', u'tenant_ns_ip': u'10.2.61.1/24', u'tenant_ns_if': u't17ns1if', u'tenant_sub_if': u't17s1if', u'tenant_ns_name': u't17'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't17_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't17br1if1', u'vmif': u't17VM4if1'}], u'vxlan': [{u'local_ip': u'10.2.61.2', u'dsport': 4789, u'dev': u't17s1if', u'tenant_route_ip': u'192.168.135.2', u'remote_route': u'10.1.61.0/24', u'subnet_route': u'10.2.61.0/24', u'v_name': u'vxlan_t17s1', u'id': 42, u'remote_ip': u'10.1.61.2'}]}, {u'dnsif': [], u'dhcp_start': [], u'dhcp_end': [], u'dnsif_ip': [], u'net_mask': [], u'brif': []}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t17ns1\" ip link show \"[]\" ; if [ $? -ne 0 ] ; then ip netns exec \"t17ns1\" ip link add \"[]\" type veth peer name \"[]\" ; fi\nip netns exec \"t17ns1\" ip link set dev \"[]\" up\nip netns exec \"t17ns1\" ip link set dev \"[]\" up\n", "delta": "0:00:00.214913", "end": "2019-12-05 07:55:09.408425", "item": [{"bridge_name": "t17br1", "default_route_ip": "10.2.61.1", "ns_name": "t17ns1", "route": [{"if": "p1", "ip": "10.2.61.1/24", "ns_if": "t17if", "ns_name": "t17"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t17ns1if", "tenant_ns_ip": "10.2.61.1/24", "tenant_ns_name": "t17", "tenant_sub_if": "t17s1if", "tenant_sub_ip": "10.2.61.2/24"}], "vms": [{"brif": "t17br1if1", "disk": "10G", "mem": 2, "name": "t17_VM4", "vcpu": 4, "vmif": "t17VM4if1"}], "vxlan": [{"dev": "t17s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.61.2", "remote_ip": "10.1.61.2", "remote_route": "10.1.61.0/24", "subnet_route": "10.2.61.0/24", "tenant_route_ip": "192.168.135.2", "v_name": "vxlan_t17s1"}]}, {"brif": [], "dhcp_end": [], "dhcp_start": [], "dnsif": [], "dnsif_ip": [], "net_mask": []}], "msg": "non-zero return code", "rc": 1, "start": "2019-12-05 07:55:09.193512", "stderr": "Device \"[]\" does not exist.\nRTNETLINK answers: File exists\nCannot find device \"[]\"\nCannot find device \"[]\"", "stderr_lines": ["Device \"[]\" does not exist.", "RTNETLINK answers: File exists", "Cannot find device \"[]\"", "Cannot find device \"[]\""], "stdout": "", "stdout_lines": []}
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.62.1/24', u'ns_name': u't17', u'ns_if': u't17if', u'if': u'p1'}], u'default_route_ip': u'10.2.62.1', u'bridge_name': u't17br2', u'ns_name': u't17ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.62.2/24', u'tenant_ns_ip': u'10.2.62.1/24', u'tenant_ns_if': u't17ns2if', u'tenant_sub_if': u't17s2if', u'tenant_ns_name': u't17'}], u'subnet_ip': u'2.2.2.0/24', u'vms': [{u'mem': 3, u'name': u't17_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't17br2if1', u'vmif': u't17VM3if1'}], u'vxlan': [{u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}, {u'dnsif': u't17s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't17s2_dnsbrif'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t17ns2\" ip link show \"t17s2_dnsbrif\" ; if [ $? -ne 0 ] ; then ip netns exec \"t17ns2\" ip link add \"t17s2_dnsbrif\" type veth peer name \"t17s2_dnsif\" ; fi\nip netns exec \"t17ns2\" ip link set dev \"t17s2_dnsbrif\" up\nip netns exec \"t17ns2\" ip link set dev \"t17s2_dnsif\" up\n", "delta": "0:00:00.176893", "end": "2019-12-05 07:55:09.916741", "item": [{"bridge_name": "t17br2", "default_route_ip": "10.2.62.1", "ns_name": "t17ns2", "route": [{"if": "p1", "ip": "10.2.62.1/24", "ns_if": "t17if", "ns_name": "t17"}], "subnet_ip": "2.2.2.0/24", "tenant_ns": [{"tenant_ns_if": "t17ns2if", "tenant_ns_ip": "10.2.62.1/24", "tenant_ns_name": "t17", "tenant_sub_if": "t17s2if", "tenant_sub_ip": "10.2.62.2/24"}], "vms": [{"brif": "t17br2if1", "disk": "10G", "mem": 3, "name": "t17_VM3", "vcpu": 2, "vmif": "t17VM3if1"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, {"brif": "t17s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t17s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "rc": 0, "start": "2019-12-05 07:55:09.739848", "stderr": "Device \"t17s2_dnsbrif\" does not exist.", "stderr_lines": ["Device \"t17s2_dnsbrif\" does not exist."], "stdout": "", "stdout_lines": []}

PLAY RECAP **************************************************************************************************************************************************
99.99.99.2                 : ok=12   changed=12   unreachable=0    failed=1    skipped=0    rescued=0    ignored=0   

INFO:root: 07:55:10.079291 Printing the yaml input file
INFO:root: 07:55:10.079405 {'C1': [{'subnet_addr': '1.1.1.0/24', 'VM': [{'name': 'VM1', 'disk': '10G', 'mem': 2, 'vcpu': 4, 'internet_access': True}, {'name': 'VM2', 'disk': '10G', 'mem': 4, 'vcpu': 2, 'internet_access': False}]}], 'C2': [{'subnet_addr': '1.1.1.0/24', 'VM': [{'name': 'VM4', 'disk': '10G', 'mem': 2, 'vcpu': 4, 'internet_access': True}]}, {'subnet_addr': '2.2.2.0/24', 'VM': [{'name': 'VM3', 'disk': '10G', 'mem': 3, 'vcpu': 2, 'internet_access': True}]}], 'MISC': [{'LOG_ENABLE': True}, {'GUI': True}]}
INFO:root: 07:55:10.079497 Provided subnet in C1: 1.1.1.0/24 is valid
INFO:root: 07:55:10.079547 Provided subnet in C2: 1.1.1.0/24 is valid
INFO:root: 07:55:10.079589 Provided subnet in C2: 2.2.2.0/24 is valid
INFO:root: 08:04:54.495895 Printing the yaml input file
INFO:root: 08:04:54.496003 {'C1': [{'subnet_addr': '1.1.1.0/24', 'VM': [{'name': 'VM1', 'disk': '10G', 'mem': 2, 'vcpu': 4, 'internet_access': True}, {'name': 'VM2', 'disk': '10G', 'mem': 4, 'vcpu': 2, 'internet_access': False}]}], 'C2': [{'subnet_addr': '1.1.1.0/24', 'VM': [{'name': 'VM4', 'disk': '10G', 'mem': 2, 'vcpu': 4, 'internet_access': True}]}, {'subnet_addr': '2.2.2.0/24', 'VM': [{'name': 'VM3', 'disk': '10G', 'mem': 3, 'vcpu': 2, 'internet_access': True}]}], 'MISC': [{'LOG_ENABLE': True}, {'GUI': True}]}
INFO:root: 08:04:54.496091 Provided subnet in C1: 1.1.1.0/24 is valid
INFO:root: 08:04:54.496138 Provided subnet in C2: 1.1.1.0/24 is valid
INFO:root: 08:04:54.496176 Provided subnet in C2: 2.2.2.0/24 is valid
Using /etc/ansible/ansible.cfg as config file

PLAY [main] **********************************************************************************************************

TASK [Create Tenant Namespace] ***************************************************************************************
changed: [localhost] => (item={u'default_route_ip': u'192.168.6.1', u'name': u't6', u'pns_ip': u'192.168.6.1/24', u'tenant_if': u't6if', u'tenant_ip': u'192.168.6.2/24', u'pns_if': u't6pns_if'}) => {"ansible_loop_var": "item", "changed": true, "cmd": ["ip", "netns", "add", "t6"], "delta": "0:00:00.079164", "end": "2019-12-05 08:04:55.759512", "item": {"default_route_ip": "192.168.6.1", "name": "t6", "pns_if": "t6pns_if", "pns_ip": "192.168.6.1/24", "tenant_if": "t6if", "tenant_ip": "192.168.6.2/24"}, "rc": 0, "start": "2019-12-05 08:04:55.680348", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Create Subnet Namespace] ***************************************************************************************
changed: [localhost] => (item={u'route': [{u'ip': u'10.1.51.1/24', u'ns_name': u't6', u'ns_if': u't6if', u'if': u'p1'}], u'default_route_ip': u'10.1.51.1', u'bridge_name': u't6br1', u'dns': [{u'dnsif': u't6s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't6s1_dnsbrif'}], u'ns_name': u't6ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.51.2/24', u'tenant_ns_ip': u'10.1.51.1/24', u'tenant_ns_if': u't6ns1if', u'tenant_ns_name': u't6', u'tenant_sub_if': u't6s1if'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't6_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't6br1if1', u'vmif': u't6VM1if1'}, {u'mem': 4, u'name': u't6_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't6br1if2', u'vmif': u't6VM2if1'}], u'vxlan': [{u'local_ip': u'10.1.51.2', u'tenant_route_ip': u'192.168.6.2', u'dsport': 4789, u'dev': u't6s1if', u'subnet_route': u'10.1.51.0/24', u'remote_route': u'10.2.51.0/24', u'v_name': u'vxlan_t6s1', u'id': 42, u'remote_ip': u'10.2.51.2'}]}) => {"ansible_loop_var": "item", "changed": true, "cmd": ["ip", "netns", "add", "t6ns1"], "delta": "0:00:00.065805", "end": "2019-12-05 08:04:56.148045", "item": {"bridge_name": "t6br1", "default_route_ip": "10.1.51.1", "dns": [{"brif": "t6s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.5", "dnsif": "t6s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t6ns1", "route": [{"if": "p1", "ip": "10.1.51.1/24", "ns_if": "t6if", "ns_name": "t6"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t6ns1if", "tenant_ns_ip": "10.1.51.1/24", "tenant_ns_name": "t6", "tenant_sub_if": "t6s1if", "tenant_sub_ip": "10.1.51.2/24"}], "vms": [{"brif": "t6br1if1", "disk": "10G", "mem": 2, "name": "t6_VM1", "vcpu": 4, "vmif": "t6VM1if1"}, {"brif": "t6br1if2", "disk": "10G", "mem": 4, "name": "t6_VM2", "vcpu": 2, "vmif": "t6VM2if1"}], "vxlan": [{"dev": "t6s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.51.2", "remote_ip": "10.2.51.2", "remote_route": "10.2.51.0/24", "subnet_route": "10.1.51.0/24", "tenant_route_ip": "192.168.6.2", "v_name": "vxlan_t6s1"}]}, "rc": 0, "start": "2019-12-05 08:04:56.082240", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Create Tenant VETH pairs] **************************************************************************************
changed: [localhost] => (item={u'default_route_ip': u'192.168.6.1', u'name': u't6', u'pns_ip': u'192.168.6.1/24', u'tenant_if': u't6if', u'tenant_ip': u'192.168.6.2/24', u'pns_if': u't6pns_if'}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip link show \"t6if\" ; if [ $? -ne 0 ] ; then ip link add \"t6if\" type veth peer name \"t6pns_if\" ; fi\n", "delta": "0:00:00.012806", "end": "2019-12-05 08:04:56.504609", "item": {"default_route_ip": "192.168.6.1", "name": "t6", "pns_if": "t6pns_if", "pns_ip": "192.168.6.1/24", "tenant_if": "t6if", "tenant_ip": "192.168.6.2/24"}, "rc": 0, "start": "2019-12-05 08:04:56.491803", "stderr": "Device \"t6if\" does not exist.", "stderr_lines": ["Device \"t6if\" does not exist."], "stdout": "", "stdout_lines": []}

TASK [Attach Tenant VETH Pairs] **************************************************************************************
changed: [localhost] => (item={u'default_route_ip': u'192.168.6.1', u'name': u't6', u'pns_ip': u'192.168.6.1/24', u'tenant_if': u't6if', u'tenant_ip': u'192.168.6.2/24', u'pns_if': u't6pns_if'}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec pns ip link show \"t6pns_if\" ; if [ $? -ne 0 ] ; then ip link set \"t6pns_if\" netns pns ; fi\nip netns exec \"t6\" ip link show \"t6if\" ; if [ $? -ne 0 ] ; then ip link set \"t6if\" netns \"t6\" ; fi\nip netns exec pns ip link set dev \"t6pns_if\" up\nip netns exec \"t6\" ip link set dev \"t6if\" up\n", "delta": "0:00:00.220188", "end": "2019-12-05 08:04:57.037175", "item": {"default_route_ip": "192.168.6.1", "name": "t6", "pns_if": "t6pns_if", "pns_ip": "192.168.6.1/24", "tenant_if": "t6if", "tenant_ip": "192.168.6.2/24"}, "rc": 0, "start": "2019-12-05 08:04:56.816987", "stderr": "Device \"t6pns_if\" does not exist.\nDevice \"t6if\" does not exist.", "stderr_lines": ["Device \"t6pns_if\" does not exist.", "Device \"t6if\" does not exist."], "stdout": "", "stdout_lines": []}

TASK [Add IP addresses to Tenant VETH Pairs] *************************************************************************
changed: [localhost] => (item={u'default_route_ip': u'192.168.6.1', u'name': u't6', u'pns_ip': u'192.168.6.1/24', u'tenant_if': u't6if', u'tenant_ip': u'192.168.6.2/24', u'pns_if': u't6pns_if'}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec pns ip addr show \"t6pns_if\" | awk 'FNR==3{ print $2 }' | grep -w '^192.168.6.1/24' ; if [ $? -ne 0 ] ; then ip netns exec pns ip addr add \"192.168.6.1/24\" dev \"t6pns_if\" ; fi\nip netns exec \"t6\" ip addr show \"t6if\" | awk 'FNR==3{ print $2 }' | grep -w '^192.168.6.2/24' ; if [ $? -ne 0 ] ; then ip netns exec \"t6\" ip addr add \"192.168.6.2/24\" dev \"t6if\" ; fi\n", "delta": "0:00:00.157181", "end": "2019-12-05 08:04:57.469320", "item": {"default_route_ip": "192.168.6.1", "name": "t6", "pns_if": "t6pns_if", "pns_ip": "192.168.6.1/24", "tenant_if": "t6if", "tenant_ip": "192.168.6.2/24"}, "rc": 0, "start": "2019-12-05 08:04:57.312139", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Create Namespace VETH Pairs] ***********************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.51.1/24', u'ns_name': u't6', u'ns_if': u't6if', u'if': u'p1'}], u'default_route_ip': u'10.1.51.1', u'bridge_name': u't6br1', u'dns': [{u'dnsif': u't6s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't6s1_dnsbrif'}], u'ns_name': u't6ns1', u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't6_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't6br1if1', u'vmif': u't6VM1if1'}, {u'mem': 4, u'name': u't6_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't6br1if2', u'vmif': u't6VM2if1'}], u'vxlan': [{u'local_ip': u'10.1.51.2', u'dsport': 4789, u'dev': u't6s1if', u'tenant_route_ip': u'192.168.6.2', u'remote_route': u'10.2.51.0/24', u'subnet_route': u'10.1.51.0/24', u'v_name': u'vxlan_t6s1', u'id': 42, u'remote_ip': u'10.2.51.2'}]}, {u'tenant_sub_ip': u'10.1.51.2/24', u'tenant_ns_ip': u'10.1.51.1/24', u'tenant_ns_if': u't6ns1if', u'tenant_sub_if': u't6s1if', u'tenant_ns_name': u't6'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip link show \"t6ns1if\" ; if [ $? -ne 0 ] ; then ip link add \"t6ns1if\" type veth peer name \"t6s1if\" ; fi\n", "delta": "0:00:00.016283", "end": "2019-12-05 08:04:57.753804", "item": [{"bridge_name": "t6br1", "default_route_ip": "10.1.51.1", "dns": [{"brif": "t6s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.5", "dnsif": "t6s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t6ns1", "route": [{"if": "p1", "ip": "10.1.51.1/24", "ns_if": "t6if", "ns_name": "t6"}], "subnet_ip": "1.1.1.0/24", "vms": [{"brif": "t6br1if1", "disk": "10G", "mem": 2, "name": "t6_VM1", "vcpu": 4, "vmif": "t6VM1if1"}, {"brif": "t6br1if2", "disk": "10G", "mem": 4, "name": "t6_VM2", "vcpu": 2, "vmif": "t6VM2if1"}], "vxlan": [{"dev": "t6s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.51.2", "remote_ip": "10.2.51.2", "remote_route": "10.2.51.0/24", "subnet_route": "10.1.51.0/24", "tenant_route_ip": "192.168.6.2", "v_name": "vxlan_t6s1"}]}, {"tenant_ns_if": "t6ns1if", "tenant_ns_ip": "10.1.51.1/24", "tenant_ns_name": "t6", "tenant_sub_if": "t6s1if", "tenant_sub_ip": "10.1.51.2/24"}], "rc": 0, "start": "2019-12-05 08:04:57.737521", "stderr": "Device \"t6ns1if\" does not exist.", "stderr_lines": ["Device \"t6ns1if\" does not exist."], "stdout": "", "stdout_lines": []}

TASK [Attach Namespace VETH Pairs] ***********************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.51.1/24', u'ns_name': u't6', u'ns_if': u't6if', u'if': u'p1'}], u'default_route_ip': u'10.1.51.1', u'bridge_name': u't6br1', u'dns': [{u'dnsif': u't6s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't6s1_dnsbrif'}], u'ns_name': u't6ns1', u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't6_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't6br1if1', u'vmif': u't6VM1if1'}, {u'mem': 4, u'name': u't6_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't6br1if2', u'vmif': u't6VM2if1'}], u'vxlan': [{u'local_ip': u'10.1.51.2', u'dsport': 4789, u'dev': u't6s1if', u'tenant_route_ip': u'192.168.6.2', u'remote_route': u'10.2.51.0/24', u'subnet_route': u'10.1.51.0/24', u'v_name': u'vxlan_t6s1', u'id': 42, u'remote_ip': u'10.2.51.2'}]}, {u'tenant_sub_ip': u'10.1.51.2/24', u'tenant_ns_ip': u'10.1.51.1/24', u'tenant_ns_if': u't6ns1if', u'tenant_sub_if': u't6s1if', u'tenant_ns_name': u't6'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t6\" ip link show \"t6ns1if\" ; if [ $? -ne 0 ] ; then ip link set \"t6ns1if\" netns \"t6\" ; fi\nip netns exec \"t6ns1\" ip link show \"t6s1if\" ; if [ $? -ne 0 ] ; then ip link set \"t6s1if\" netns \"t6ns1\" ; fi\n", "delta": "0:00:00.135719", "end": "2019-12-05 08:04:58.166636", "item": [{"bridge_name": "t6br1", "default_route_ip": "10.1.51.1", "dns": [{"brif": "t6s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.5", "dnsif": "t6s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t6ns1", "route": [{"if": "p1", "ip": "10.1.51.1/24", "ns_if": "t6if", "ns_name": "t6"}], "subnet_ip": "1.1.1.0/24", "vms": [{"brif": "t6br1if1", "disk": "10G", "mem": 2, "name": "t6_VM1", "vcpu": 4, "vmif": "t6VM1if1"}, {"brif": "t6br1if2", "disk": "10G", "mem": 4, "name": "t6_VM2", "vcpu": 2, "vmif": "t6VM2if1"}], "vxlan": [{"dev": "t6s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.51.2", "remote_ip": "10.2.51.2", "remote_route": "10.2.51.0/24", "subnet_route": "10.1.51.0/24", "tenant_route_ip": "192.168.6.2", "v_name": "vxlan_t6s1"}]}, {"tenant_ns_if": "t6ns1if", "tenant_ns_ip": "10.1.51.1/24", "tenant_ns_name": "t6", "tenant_sub_if": "t6s1if", "tenant_sub_ip": "10.1.51.2/24"}], "rc": 0, "start": "2019-12-05 08:04:58.030917", "stderr": "Device \"t6ns1if\" does not exist.\nDevice \"t6s1if\" does not exist.", "stderr_lines": ["Device \"t6ns1if\" does not exist.", "Device \"t6s1if\" does not exist."], "stdout": "", "stdout_lines": []}

TASK [Set Namespace VETH Pairs UP] ***********************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.51.1/24', u'ns_name': u't6', u'ns_if': u't6if', u'if': u'p1'}], u'default_route_ip': u'10.1.51.1', u'bridge_name': u't6br1', u'dns': [{u'dnsif': u't6s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't6s1_dnsbrif'}], u'ns_name': u't6ns1', u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't6_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't6br1if1', u'vmif': u't6VM1if1'}, {u'mem': 4, u'name': u't6_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't6br1if2', u'vmif': u't6VM2if1'}], u'vxlan': [{u'local_ip': u'10.1.51.2', u'dsport': 4789, u'dev': u't6s1if', u'tenant_route_ip': u'192.168.6.2', u'remote_route': u'10.2.51.0/24', u'subnet_route': u'10.1.51.0/24', u'v_name': u'vxlan_t6s1', u'id': 42, u'remote_ip': u'10.2.51.2'}]}, {u'tenant_sub_ip': u'10.1.51.2/24', u'tenant_ns_ip': u'10.1.51.1/24', u'tenant_ns_if': u't6ns1if', u'tenant_sub_if': u't6s1if', u'tenant_ns_name': u't6'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t6\" ip link set dev \"t6ns1if\" up\nip netns exec \"t6ns1\" ip link set dev \"t6s1if\" up\n", "delta": "0:00:00.069952", "end": "2019-12-05 08:04:58.497233", "item": [{"bridge_name": "t6br1", "default_route_ip": "10.1.51.1", "dns": [{"brif": "t6s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.5", "dnsif": "t6s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t6ns1", "route": [{"if": "p1", "ip": "10.1.51.1/24", "ns_if": "t6if", "ns_name": "t6"}], "subnet_ip": "1.1.1.0/24", "vms": [{"brif": "t6br1if1", "disk": "10G", "mem": 2, "name": "t6_VM1", "vcpu": 4, "vmif": "t6VM1if1"}, {"brif": "t6br1if2", "disk": "10G", "mem": 4, "name": "t6_VM2", "vcpu": 2, "vmif": "t6VM2if1"}], "vxlan": [{"dev": "t6s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.51.2", "remote_ip": "10.2.51.2", "remote_route": "10.2.51.0/24", "subnet_route": "10.1.51.0/24", "tenant_route_ip": "192.168.6.2", "v_name": "vxlan_t6s1"}]}, {"tenant_ns_if": "t6ns1if", "tenant_ns_ip": "10.1.51.1/24", "tenant_ns_name": "t6", "tenant_sub_if": "t6s1if", "tenant_sub_ip": "10.1.51.2/24"}], "rc": 0, "start": "2019-12-05 08:04:58.427281", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Add IP addresses to Namespace VETH Pairs] **********************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.51.1/24', u'ns_name': u't6', u'ns_if': u't6if', u'if': u'p1'}], u'default_route_ip': u'10.1.51.1', u'bridge_name': u't6br1', u'dns': [{u'dnsif': u't6s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't6s1_dnsbrif'}], u'ns_name': u't6ns1', u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't6_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't6br1if1', u'vmif': u't6VM1if1'}, {u'mem': 4, u'name': u't6_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't6br1if2', u'vmif': u't6VM2if1'}], u'vxlan': [{u'local_ip': u'10.1.51.2', u'dsport': 4789, u'dev': u't6s1if', u'tenant_route_ip': u'192.168.6.2', u'remote_route': u'10.2.51.0/24', u'subnet_route': u'10.1.51.0/24', u'v_name': u'vxlan_t6s1', u'id': 42, u'remote_ip': u'10.2.51.2'}]}, {u'tenant_sub_ip': u'10.1.51.2/24', u'tenant_ns_ip': u'10.1.51.1/24', u'tenant_ns_if': u't6ns1if', u'tenant_sub_if': u't6s1if', u'tenant_ns_name': u't6'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t6ns1\" ip addr show \"t6s1if\" | awk 'FNR==3{ print $2 }' | grep -w '^10.1.51.2/24' ; if [ $? -ne 0 ] ; then ip netns exec \"t6ns1\" ip addr add \"10.1.51.2/24\" dev \"t6s1if\" ; fi\n\nip netns exec \"t6\" ip addr show \"t6ns1if\" | awk 'FNR==3{ print $2 }' | grep -w '^10.1.51.1/24' ; if [ $? -ne 0 ] ; then ip netns exec \"t6\" ip addr add \"10.1.51.1/24\" dev \"t6ns1if\" ; fi\n", "delta": "0:00:00.170854", "end": "2019-12-05 08:04:58.953156", "item": [{"bridge_name": "t6br1", "default_route_ip": "10.1.51.1", "dns": [{"brif": "t6s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.5", "dnsif": "t6s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t6ns1", "route": [{"if": "p1", "ip": "10.1.51.1/24", "ns_if": "t6if", "ns_name": "t6"}], "subnet_ip": "1.1.1.0/24", "vms": [{"brif": "t6br1if1", "disk": "10G", "mem": 2, "name": "t6_VM1", "vcpu": 4, "vmif": "t6VM1if1"}, {"brif": "t6br1if2", "disk": "10G", "mem": 4, "name": "t6_VM2", "vcpu": 2, "vmif": "t6VM2if1"}], "vxlan": [{"dev": "t6s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.51.2", "remote_ip": "10.2.51.2", "remote_route": "10.2.51.0/24", "subnet_route": "10.1.51.0/24", "tenant_route_ip": "192.168.6.2", "v_name": "vxlan_t6s1"}]}, {"tenant_ns_if": "t6ns1if", "tenant_ns_ip": "10.1.51.1/24", "tenant_ns_name": "t6", "tenant_sub_if": "t6s1if", "tenant_sub_ip": "10.1.51.2/24"}], "rc": 0, "start": "2019-12-05 08:04:58.782302", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Add IP Route to Tenant] ****************************************************************************************
changed: [localhost] => (item={u'default_route_ip': u'192.168.6.1', u'name': u't6', u'pns_ip': u'192.168.6.1/24', u'tenant_if': u't6if', u'tenant_ip': u'192.168.6.2/24', u'pns_if': u't6pns_if'}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t6\" ip route show default | grep -w '[d]efault via 192.168.6.1' ; if [ $? -ne 0 ] ; then ip netns exec \"t6\" ip route add default via \"192.168.6.1\" ; fi\n", "delta": "0:00:00.071777", "end": "2019-12-05 08:04:59.341274", "item": {"default_route_ip": "192.168.6.1", "name": "t6", "pns_if": "t6pns_if", "pns_ip": "192.168.6.1/24", "tenant_if": "t6if", "tenant_ip": "192.168.6.2/24"}, "rc": 0, "start": "2019-12-05 08:04:59.269497", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Add IP Route to Tenant Subnet] *********************************************************************************
changed: [localhost] => (item={u'route': [{u'ip': u'10.1.51.1/24', u'ns_name': u't6', u'ns_if': u't6if', u'if': u'p1'}], u'default_route_ip': u'10.1.51.1', u'bridge_name': u't6br1', u'dns': [{u'dnsif': u't6s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't6s1_dnsbrif'}], u'ns_name': u't6ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.51.2/24', u'tenant_ns_ip': u'10.1.51.1/24', u'tenant_ns_if': u't6ns1if', u'tenant_ns_name': u't6', u'tenant_sub_if': u't6s1if'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't6_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't6br1if1', u'vmif': u't6VM1if1'}, {u'mem': 4, u'name': u't6_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't6br1if2', u'vmif': u't6VM2if1'}], u'vxlan': [{u'local_ip': u'10.1.51.2', u'tenant_route_ip': u'192.168.6.2', u'dsport': 4789, u'dev': u't6s1if', u'subnet_route': u'10.1.51.0/24', u'remote_route': u'10.2.51.0/24', u'v_name': u'vxlan_t6s1', u'id': 42, u'remote_ip': u'10.2.51.2'}]}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t6ns1\" ip route show default | grep -w '[d]efault via 10.1.51.1' ; if [ $? -ne 0 ] ; then ip netns exec \"t6ns1\" ip route add default via \"10.1.51.1\" ; fi\n", "delta": "0:00:00.077235", "end": "2019-12-05 08:04:59.741304", "item": {"bridge_name": "t6br1", "default_route_ip": "10.1.51.1", "dns": [{"brif": "t6s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.5", "dnsif": "t6s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t6ns1", "route": [{"if": "p1", "ip": "10.1.51.1/24", "ns_if": "t6if", "ns_name": "t6"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t6ns1if", "tenant_ns_ip": "10.1.51.1/24", "tenant_ns_name": "t6", "tenant_sub_if": "t6s1if", "tenant_sub_ip": "10.1.51.2/24"}], "vms": [{"brif": "t6br1if1", "disk": "10G", "mem": 2, "name": "t6_VM1", "vcpu": 4, "vmif": "t6VM1if1"}, {"brif": "t6br1if2", "disk": "10G", "mem": 4, "name": "t6_VM2", "vcpu": 2, "vmif": "t6VM2if1"}], "vxlan": [{"dev": "t6s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.51.2", "remote_ip": "10.2.51.2", "remote_route": "10.2.51.0/24", "subnet_route": "10.1.51.0/24", "tenant_route_ip": "192.168.6.2", "v_name": "vxlan_t6s1"}]}, "rc": 0, "start": "2019-12-05 08:04:59.664069", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Create bridge inside namespace] ********************************************************************************
changed: [localhost] => (item={u'route': [{u'ip': u'10.1.51.1/24', u'ns_name': u't6', u'ns_if': u't6if', u'if': u'p1'}], u'default_route_ip': u'10.1.51.1', u'bridge_name': u't6br1', u'dns': [{u'dnsif': u't6s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't6s1_dnsbrif'}], u'ns_name': u't6ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.51.2/24', u'tenant_ns_ip': u'10.1.51.1/24', u'tenant_ns_if': u't6ns1if', u'tenant_ns_name': u't6', u'tenant_sub_if': u't6s1if'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't6_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't6br1if1', u'vmif': u't6VM1if1'}, {u'mem': 4, u'name': u't6_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't6br1if2', u'vmif': u't6VM2if1'}], u'vxlan': [{u'local_ip': u'10.1.51.2', u'tenant_route_ip': u'192.168.6.2', u'dsport': 4789, u'dev': u't6s1if', u'subnet_route': u'10.1.51.0/24', u'remote_route': u'10.2.51.0/24', u'v_name': u'vxlan_t6s1', u'id': 42, u'remote_ip': u'10.2.51.2'}]}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t6ns1\" brctl show | grep -w '^t6br1'; if [ $? -ne 0 ] ; then ip netns exec \"t6ns1\" brctl addbr \"t6br1\" ; fi\nip netns exec \"t6ns1\" ip link set dev \"t6br1\" up\n", "delta": "0:00:00.114095", "end": "2019-12-05 08:05:00.165132", "item": {"bridge_name": "t6br1", "default_route_ip": "10.1.51.1", "dns": [{"brif": "t6s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.5", "dnsif": "t6s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t6ns1", "route": [{"if": "p1", "ip": "10.1.51.1/24", "ns_if": "t6if", "ns_name": "t6"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t6ns1if", "tenant_ns_ip": "10.1.51.1/24", "tenant_ns_name": "t6", "tenant_sub_if": "t6s1if", "tenant_sub_ip": "10.1.51.2/24"}], "vms": [{"brif": "t6br1if1", "disk": "10G", "mem": 2, "name": "t6_VM1", "vcpu": 4, "vmif": "t6VM1if1"}, {"brif": "t6br1if2", "disk": "10G", "mem": 4, "name": "t6_VM2", "vcpu": 2, "vmif": "t6VM2if1"}], "vxlan": [{"dev": "t6s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.51.2", "remote_ip": "10.2.51.2", "remote_route": "10.2.51.0/24", "subnet_route": "10.1.51.0/24", "tenant_route_ip": "192.168.6.2", "v_name": "vxlan_t6s1"}]}, "rc": 0, "start": "2019-12-05 08:05:00.051037", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Create DNS VETH Pair] ******************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.51.1/24', u'ns_name': u't6', u'ns_if': u't6if', u'if': u'p1'}], u'default_route_ip': u'10.1.51.1', u'bridge_name': u't6br1', u'ns_name': u't6ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.51.2/24', u'tenant_ns_ip': u'10.1.51.1/24', u'tenant_ns_if': u't6ns1if', u'tenant_sub_if': u't6s1if', u'tenant_ns_name': u't6'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't6_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't6br1if1', u'vmif': u't6VM1if1'}, {u'mem': 4, u'name': u't6_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't6br1if2', u'vmif': u't6VM2if1'}], u'vxlan': [{u'local_ip': u'10.1.51.2', u'dsport': 4789, u'dev': u't6s1if', u'tenant_route_ip': u'192.168.6.2', u'remote_route': u'10.2.51.0/24', u'subnet_route': u'10.1.51.0/24', u'v_name': u'vxlan_t6s1', u'id': 42, u'remote_ip': u'10.2.51.2'}]}, {u'dnsif': u't6s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't6s1_dnsbrif'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t6ns1\" ip link show \"t6s1_dnsbrif\" ; if [ $? -ne 0 ] ; then ip netns exec \"t6ns1\" ip link add \"t6s1_dnsbrif\" type veth peer name \"t6s1_dnsif\" ; fi\nip netns exec \"t6ns1\" ip link set dev \"t6s1_dnsbrif\" up\nip netns exec \"t6ns1\" ip link set dev \"t6s1_dnsif\" up\n", "delta": "0:00:00.150113", "end": "2019-12-05 08:05:00.597217", "item": [{"bridge_name": "t6br1", "default_route_ip": "10.1.51.1", "ns_name": "t6ns1", "route": [{"if": "p1", "ip": "10.1.51.1/24", "ns_if": "t6if", "ns_name": "t6"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t6ns1if", "tenant_ns_ip": "10.1.51.1/24", "tenant_ns_name": "t6", "tenant_sub_if": "t6s1if", "tenant_sub_ip": "10.1.51.2/24"}], "vms": [{"brif": "t6br1if1", "disk": "10G", "mem": 2, "name": "t6_VM1", "vcpu": 4, "vmif": "t6VM1if1"}, {"brif": "t6br1if2", "disk": "10G", "mem": 4, "name": "t6_VM2", "vcpu": 2, "vmif": "t6VM2if1"}], "vxlan": [{"dev": "t6s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.51.2", "remote_ip": "10.2.51.2", "remote_route": "10.2.51.0/24", "subnet_route": "10.1.51.0/24", "tenant_route_ip": "192.168.6.2", "v_name": "vxlan_t6s1"}]}, {"brif": "t6s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.5", "dnsif": "t6s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "rc": 0, "start": "2019-12-05 08:05:00.447104", "stderr": "Device \"t6s1_dnsbrif\" does not exist.", "stderr_lines": ["Device \"t6s1_dnsbrif\" does not exist."], "stdout": "", "stdout_lines": []}

TASK [Attach DNS VETH Pair] ******************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.51.1/24', u'ns_name': u't6', u'ns_if': u't6if', u'if': u'p1'}], u'default_route_ip': u'10.1.51.1', u'bridge_name': u't6br1', u'ns_name': u't6ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.51.2/24', u'tenant_ns_ip': u'10.1.51.1/24', u'tenant_ns_if': u't6ns1if', u'tenant_sub_if': u't6s1if', u'tenant_ns_name': u't6'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't6_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't6br1if1', u'vmif': u't6VM1if1'}, {u'mem': 4, u'name': u't6_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't6br1if2', u'vmif': u't6VM2if1'}], u'vxlan': [{u'local_ip': u'10.1.51.2', u'dsport': 4789, u'dev': u't6s1if', u'tenant_route_ip': u'192.168.6.2', u'remote_route': u'10.2.51.0/24', u'subnet_route': u'10.1.51.0/24', u'v_name': u'vxlan_t6s1', u'id': 42, u'remote_ip': u'10.2.51.2'}]}, {u'dnsif': u't6s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't6s1_dnsbrif'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t6ns1\" brctl show \"t6br1\" | grep -w 't6s1_dnsbrif' ; if [ $? -ne 0 ] ; then ip netns exec \"t6ns1\" brctl addif \"t6br1\" \"t6s1_dnsbrif\" ; fi\n", "delta": "0:00:00.092843", "end": "2019-12-05 08:05:00.973331", "item": [{"bridge_name": "t6br1", "default_route_ip": "10.1.51.1", "ns_name": "t6ns1", "route": [{"if": "p1", "ip": "10.1.51.1/24", "ns_if": "t6if", "ns_name": "t6"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t6ns1if", "tenant_ns_ip": "10.1.51.1/24", "tenant_ns_name": "t6", "tenant_sub_if": "t6s1if", "tenant_sub_ip": "10.1.51.2/24"}], "vms": [{"brif": "t6br1if1", "disk": "10G", "mem": 2, "name": "t6_VM1", "vcpu": 4, "vmif": "t6VM1if1"}, {"brif": "t6br1if2", "disk": "10G", "mem": 4, "name": "t6_VM2", "vcpu": 2, "vmif": "t6VM2if1"}], "vxlan": [{"dev": "t6s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.51.2", "remote_ip": "10.2.51.2", "remote_route": "10.2.51.0/24", "subnet_route": "10.1.51.0/24", "tenant_route_ip": "192.168.6.2", "v_name": "vxlan_t6s1"}]}, {"brif": "t6s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.5", "dnsif": "t6s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "rc": 0, "start": "2019-12-05 08:05:00.880488", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Create VETH Pairs] *********************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.51.1/24', u'ns_name': u't6', u'ns_if': u't6if', u'if': u'p1'}], u'default_route_ip': u'10.1.51.1', u'bridge_name': u't6br1', u'dns': [{u'dnsif': u't6s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't6s1_dnsbrif'}], u'ns_name': u't6ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.51.2/24', u'tenant_ns_ip': u'10.1.51.1/24', u'tenant_ns_if': u't6ns1if', u'tenant_sub_if': u't6s1if', u'tenant_ns_name': u't6'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.1.51.2', u'dsport': 4789, u'dev': u't6s1if', u'tenant_route_ip': u'192.168.6.2', u'remote_route': u'10.2.51.0/24', u'subnet_route': u'10.1.51.0/24', u'v_name': u'vxlan_t6s1', u'id': 42, u'remote_ip': u'10.2.51.2'}]}, {u'mem': 2, u'name': u't6_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't6br1if1', u'vmif': u't6VM1if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip link show \"t6br1if1\" ; if [ $? -ne 0 ] ; then ip link add \"t6VM1if1\" type veth peer name \"t6br1if1\" ; fi\nip link set dev \"t6br1if1\" up\nip link set dev \"t6VM1if1\" up\n", "delta": "0:00:00.017802", "end": "2019-12-05 08:05:01.311564", "item": [{"bridge_name": "t6br1", "default_route_ip": "10.1.51.1", "dns": [{"brif": "t6s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.5", "dnsif": "t6s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t6ns1", "route": [{"if": "p1", "ip": "10.1.51.1/24", "ns_if": "t6if", "ns_name": "t6"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t6ns1if", "tenant_ns_ip": "10.1.51.1/24", "tenant_ns_name": "t6", "tenant_sub_if": "t6s1if", "tenant_sub_ip": "10.1.51.2/24"}], "vxlan": [{"dev": "t6s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.51.2", "remote_ip": "10.2.51.2", "remote_route": "10.2.51.0/24", "subnet_route": "10.1.51.0/24", "tenant_route_ip": "192.168.6.2", "v_name": "vxlan_t6s1"}]}, {"brif": "t6br1if1", "disk": "10G", "mem": 2, "name": "t6_VM1", "vcpu": 4, "vmif": "t6VM1if1"}], "rc": 0, "start": "2019-12-05 08:05:01.293762", "stderr": "Device \"t6br1if1\" does not exist.", "stderr_lines": ["Device \"t6br1if1\" does not exist."], "stdout": "", "stdout_lines": []}
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.51.1/24', u'ns_name': u't6', u'ns_if': u't6if', u'if': u'p1'}], u'default_route_ip': u'10.1.51.1', u'bridge_name': u't6br1', u'dns': [{u'dnsif': u't6s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't6s1_dnsbrif'}], u'ns_name': u't6ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.51.2/24', u'tenant_ns_ip': u'10.1.51.1/24', u'tenant_ns_if': u't6ns1if', u'tenant_sub_if': u't6s1if', u'tenant_ns_name': u't6'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.1.51.2', u'dsport': 4789, u'dev': u't6s1if', u'tenant_route_ip': u'192.168.6.2', u'remote_route': u'10.2.51.0/24', u'subnet_route': u'10.1.51.0/24', u'v_name': u'vxlan_t6s1', u'id': 42, u'remote_ip': u'10.2.51.2'}]}, {u'mem': 4, u'name': u't6_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't6br1if2', u'vmif': u't6VM2if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip link show \"t6br1if2\" ; if [ $? -ne 0 ] ; then ip link add \"t6VM2if1\" type veth peer name \"t6br1if2\" ; fi\nip link set dev \"t6br1if2\" up\nip link set dev \"t6VM2if1\" up\n", "delta": "0:00:00.021041", "end": "2019-12-05 08:05:01.558631", "item": [{"bridge_name": "t6br1", "default_route_ip": "10.1.51.1", "dns": [{"brif": "t6s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.5", "dnsif": "t6s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t6ns1", "route": [{"if": "p1", "ip": "10.1.51.1/24", "ns_if": "t6if", "ns_name": "t6"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t6ns1if", "tenant_ns_ip": "10.1.51.1/24", "tenant_ns_name": "t6", "tenant_sub_if": "t6s1if", "tenant_sub_ip": "10.1.51.2/24"}], "vxlan": [{"dev": "t6s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.51.2", "remote_ip": "10.2.51.2", "remote_route": "10.2.51.0/24", "subnet_route": "10.1.51.0/24", "tenant_route_ip": "192.168.6.2", "v_name": "vxlan_t6s1"}]}, {"brif": "t6br1if2", "disk": "10G", "mem": 4, "name": "t6_VM2", "vcpu": 2, "vmif": "t6VM2if1"}], "rc": 0, "start": "2019-12-05 08:05:01.537590", "stderr": "Device \"t6br1if2\" does not exist.", "stderr_lines": ["Device \"t6br1if2\" does not exist."], "stdout": "", "stdout_lines": []}

TASK [Attach VETH Pairs] *********************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.51.1/24', u'ns_name': u't6', u'ns_if': u't6if', u'if': u'p1'}], u'default_route_ip': u'10.1.51.1', u'bridge_name': u't6br1', u'dns': [{u'dnsif': u't6s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't6s1_dnsbrif'}], u'ns_name': u't6ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.51.2/24', u'tenant_ns_ip': u'10.1.51.1/24', u'tenant_ns_if': u't6ns1if', u'tenant_sub_if': u't6s1if', u'tenant_ns_name': u't6'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.1.51.2', u'dsport': 4789, u'dev': u't6s1if', u'tenant_route_ip': u'192.168.6.2', u'remote_route': u'10.2.51.0/24', u'subnet_route': u'10.1.51.0/24', u'v_name': u'vxlan_t6s1', u'id': 42, u'remote_ip': u'10.2.51.2'}]}, {u'mem': 2, u'name': u't6_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't6br1if1', u'vmif': u't6VM1if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip link show \"t6br1if1\" ; if [ $? -eq 0 ] ; then ip link set \"t6br1if1\" netns \"t6ns1\" ; fi\nip netns exec \"t6ns1\" brctl show \"t6br1\" | grep -w 't6br1if1' ; if [ $? -ne 0 ] ; then ip netns exec \"t6ns1\" brctl addif \"t6br1\" \"t6br1if1\" ; fi\n", "delta": "0:00:00.106975", "end": "2019-12-05 08:05:02.033510", "item": [{"bridge_name": "t6br1", "default_route_ip": "10.1.51.1", "dns": [{"brif": "t6s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.5", "dnsif": "t6s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t6ns1", "route": [{"if": "p1", "ip": "10.1.51.1/24", "ns_if": "t6if", "ns_name": "t6"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t6ns1if", "tenant_ns_ip": "10.1.51.1/24", "tenant_ns_name": "t6", "tenant_sub_if": "t6s1if", "tenant_sub_ip": "10.1.51.2/24"}], "vxlan": [{"dev": "t6s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.51.2", "remote_ip": "10.2.51.2", "remote_route": "10.2.51.0/24", "subnet_route": "10.1.51.0/24", "tenant_route_ip": "192.168.6.2", "v_name": "vxlan_t6s1"}]}, {"brif": "t6br1if1", "disk": "10G", "mem": 2, "name": "t6_VM1", "vcpu": 4, "vmif": "t6VM1if1"}], "rc": 0, "start": "2019-12-05 08:05:01.926535", "stderr": "", "stderr_lines": [], "stdout": "125: t6br1if1@t6VM1if1: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP mode DEFAULT group default qlen 1000\n    link/ether 5e:e1:63:0c:bf:43 brd ff:ff:ff:ff:ff:ff", "stdout_lines": ["125: t6br1if1@t6VM1if1: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP mode DEFAULT group default qlen 1000", "    link/ether 5e:e1:63:0c:bf:43 brd ff:ff:ff:ff:ff:ff"]}
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.51.1/24', u'ns_name': u't6', u'ns_if': u't6if', u'if': u'p1'}], u'default_route_ip': u'10.1.51.1', u'bridge_name': u't6br1', u'dns': [{u'dnsif': u't6s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't6s1_dnsbrif'}], u'ns_name': u't6ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.51.2/24', u'tenant_ns_ip': u'10.1.51.1/24', u'tenant_ns_if': u't6ns1if', u'tenant_sub_if': u't6s1if', u'tenant_ns_name': u't6'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.1.51.2', u'dsport': 4789, u'dev': u't6s1if', u'tenant_route_ip': u'192.168.6.2', u'remote_route': u'10.2.51.0/24', u'subnet_route': u'10.1.51.0/24', u'v_name': u'vxlan_t6s1', u'id': 42, u'remote_ip': u'10.2.51.2'}]}, {u'mem': 4, u'name': u't6_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't6br1if2', u'vmif': u't6VM2if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip link show \"t6br1if2\" ; if [ $? -eq 0 ] ; then ip link set \"t6br1if2\" netns \"t6ns1\" ; fi\nip netns exec \"t6ns1\" brctl show \"t6br1\" | grep -w 't6br1if2' ; if [ $? -ne 0 ] ; then ip netns exec \"t6ns1\" brctl addif \"t6br1\" \"t6br1if2\" ; fi\n", "delta": "0:00:00.108034", "end": "2019-12-05 08:05:02.385254", "item": [{"bridge_name": "t6br1", "default_route_ip": "10.1.51.1", "dns": [{"brif": "t6s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.5", "dnsif": "t6s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t6ns1", "route": [{"if": "p1", "ip": "10.1.51.1/24", "ns_if": "t6if", "ns_name": "t6"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t6ns1if", "tenant_ns_ip": "10.1.51.1/24", "tenant_ns_name": "t6", "tenant_sub_if": "t6s1if", "tenant_sub_ip": "10.1.51.2/24"}], "vxlan": [{"dev": "t6s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.51.2", "remote_ip": "10.2.51.2", "remote_route": "10.2.51.0/24", "subnet_route": "10.1.51.0/24", "tenant_route_ip": "192.168.6.2", "v_name": "vxlan_t6s1"}]}, {"brif": "t6br1if2", "disk": "10G", "mem": 4, "name": "t6_VM2", "vcpu": 2, "vmif": "t6VM2if1"}], "rc": 0, "start": "2019-12-05 08:05:02.277220", "stderr": "", "stderr_lines": [], "stdout": "127: t6br1if2@t6VM2if1: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP mode DEFAULT group default qlen 1000\n    link/ether 7e:4f:21:4d:c1:6c brd ff:ff:ff:ff:ff:ff", "stdout_lines": ["127: t6br1if2@t6VM2if1: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP mode DEFAULT group default qlen 1000", "    link/ether 7e:4f:21:4d:c1:6c brd ff:ff:ff:ff:ff:ff"]}

TASK [All interfaces and bridges UP] *********************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.51.1/24', u'ns_name': u't6', u'ns_if': u't6if', u'if': u'p1'}], u'default_route_ip': u'10.1.51.1', u'bridge_name': u't6br1', u'dns': [{u'dnsif': u't6s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't6s1_dnsbrif'}], u'ns_name': u't6ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.51.2/24', u'tenant_ns_ip': u'10.1.51.1/24', u'tenant_ns_if': u't6ns1if', u'tenant_sub_if': u't6s1if', u'tenant_ns_name': u't6'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.1.51.2', u'dsport': 4789, u'dev': u't6s1if', u'tenant_route_ip': u'192.168.6.2', u'remote_route': u'10.2.51.0/24', u'subnet_route': u'10.1.51.0/24', u'v_name': u'vxlan_t6s1', u'id': 42, u'remote_ip': u'10.2.51.2'}]}, {u'mem': 2, u'name': u't6_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't6br1if1', u'vmif': u't6VM1if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t6ns1\" ip link set \"t6br1if1\" up\nip netns exec \"t6ns1\" ip link set dev \"t6br1\" up\n", "delta": "0:00:00.085325", "end": "2019-12-05 08:05:02.781299", "item": [{"bridge_name": "t6br1", "default_route_ip": "10.1.51.1", "dns": [{"brif": "t6s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.5", "dnsif": "t6s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t6ns1", "route": [{"if": "p1", "ip": "10.1.51.1/24", "ns_if": "t6if", "ns_name": "t6"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t6ns1if", "tenant_ns_ip": "10.1.51.1/24", "tenant_ns_name": "t6", "tenant_sub_if": "t6s1if", "tenant_sub_ip": "10.1.51.2/24"}], "vxlan": [{"dev": "t6s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.51.2", "remote_ip": "10.2.51.2", "remote_route": "10.2.51.0/24", "subnet_route": "10.1.51.0/24", "tenant_route_ip": "192.168.6.2", "v_name": "vxlan_t6s1"}]}, {"brif": "t6br1if1", "disk": "10G", "mem": 2, "name": "t6_VM1", "vcpu": 4, "vmif": "t6VM1if1"}], "rc": 0, "start": "2019-12-05 08:05:02.695974", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.51.1/24', u'ns_name': u't6', u'ns_if': u't6if', u'if': u'p1'}], u'default_route_ip': u'10.1.51.1', u'bridge_name': u't6br1', u'dns': [{u'dnsif': u't6s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't6s1_dnsbrif'}], u'ns_name': u't6ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.51.2/24', u'tenant_ns_ip': u'10.1.51.1/24', u'tenant_ns_if': u't6ns1if', u'tenant_sub_if': u't6s1if', u'tenant_ns_name': u't6'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.1.51.2', u'dsport': 4789, u'dev': u't6s1if', u'tenant_route_ip': u'192.168.6.2', u'remote_route': u'10.2.51.0/24', u'subnet_route': u'10.1.51.0/24', u'v_name': u'vxlan_t6s1', u'id': 42, u'remote_ip': u'10.2.51.2'}]}, {u'mem': 4, u'name': u't6_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't6br1if2', u'vmif': u't6VM2if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t6ns1\" ip link set \"t6br1if2\" up\nip netns exec \"t6ns1\" ip link set dev \"t6br1\" up\n", "delta": "0:00:00.069987", "end": "2019-12-05 08:05:03.093145", "item": [{"bridge_name": "t6br1", "default_route_ip": "10.1.51.1", "dns": [{"brif": "t6s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.5", "dnsif": "t6s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t6ns1", "route": [{"if": "p1", "ip": "10.1.51.1/24", "ns_if": "t6if", "ns_name": "t6"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t6ns1if", "tenant_ns_ip": "10.1.51.1/24", "tenant_ns_name": "t6", "tenant_sub_if": "t6s1if", "tenant_sub_ip": "10.1.51.2/24"}], "vxlan": [{"dev": "t6s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.51.2", "remote_ip": "10.2.51.2", "remote_route": "10.2.51.0/24", "subnet_route": "10.1.51.0/24", "tenant_route_ip": "192.168.6.2", "v_name": "vxlan_t6s1"}]}, {"brif": "t6br1if2", "disk": "10G", "mem": 4, "name": "t6_VM2", "vcpu": 2, "vmif": "t6VM2if1"}], "rc": 0, "start": "2019-12-05 08:05:03.023158", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Add IP to DNS Interface] ***************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.51.1/24', u'ns_name': u't6', u'ns_if': u't6if', u'if': u'p1'}], u'default_route_ip': u'10.1.51.1', u'bridge_name': u't6br1', u'ns_name': u't6ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.51.2/24', u'tenant_ns_ip': u'10.1.51.1/24', u'tenant_ns_if': u't6ns1if', u'tenant_sub_if': u't6s1if', u'tenant_ns_name': u't6'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't6_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't6br1if1', u'vmif': u't6VM1if1'}, {u'mem': 4, u'name': u't6_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't6br1if2', u'vmif': u't6VM2if1'}], u'vxlan': [{u'local_ip': u'10.1.51.2', u'dsport': 4789, u'dev': u't6s1if', u'tenant_route_ip': u'192.168.6.2', u'remote_route': u'10.2.51.0/24', u'subnet_route': u'10.1.51.0/24', u'v_name': u'vxlan_t6s1', u'id': 42, u'remote_ip': u'10.2.51.2'}]}, {u'dnsif': u't6s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't6s1_dnsbrif'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t6ns1\" ip addr show \"t6s1_dnsif\" | awk 'FNR==3{ print $2 }' | grep -w '^1.1.1.1/24' ; if [ $? -ne 0 ] ; then ip netns exec \"t6ns1\" ip addr add \"1.1.1.1/24\" dev \"t6s1_dnsif\" ; fi\n", "delta": "0:00:00.070176", "end": "2019-12-05 08:05:03.441323", "item": [{"bridge_name": "t6br1", "default_route_ip": "10.1.51.1", "ns_name": "t6ns1", "route": [{"if": "p1", "ip": "10.1.51.1/24", "ns_if": "t6if", "ns_name": "t6"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t6ns1if", "tenant_ns_ip": "10.1.51.1/24", "tenant_ns_name": "t6", "tenant_sub_if": "t6s1if", "tenant_sub_ip": "10.1.51.2/24"}], "vms": [{"brif": "t6br1if1", "disk": "10G", "mem": 2, "name": "t6_VM1", "vcpu": 4, "vmif": "t6VM1if1"}, {"brif": "t6br1if2", "disk": "10G", "mem": 4, "name": "t6_VM2", "vcpu": 2, "vmif": "t6VM2if1"}], "vxlan": [{"dev": "t6s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.51.2", "remote_ip": "10.2.51.2", "remote_route": "10.2.51.0/24", "subnet_route": "10.1.51.0/24", "tenant_route_ip": "192.168.6.2", "v_name": "vxlan_t6s1"}]}, {"brif": "t6s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.5", "dnsif": "t6s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "rc": 0, "start": "2019-12-05 08:05:03.371147", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Install DHCP Server] *******************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.51.1/24', u'ns_name': u't6', u'ns_if': u't6if', u'if': u'p1'}], u'default_route_ip': u'10.1.51.1', u'bridge_name': u't6br1', u'ns_name': u't6ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.51.2/24', u'tenant_ns_ip': u'10.1.51.1/24', u'tenant_ns_if': u't6ns1if', u'tenant_sub_if': u't6s1if', u'tenant_ns_name': u't6'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't6_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't6br1if1', u'vmif': u't6VM1if1'}, {u'mem': 4, u'name': u't6_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't6br1if2', u'vmif': u't6VM2if1'}], u'vxlan': [{u'local_ip': u'10.1.51.2', u'dsport': 4789, u'dev': u't6s1if', u'tenant_route_ip': u'192.168.6.2', u'remote_route': u'10.2.51.0/24', u'subnet_route': u'10.1.51.0/24', u'v_name': u'vxlan_t6s1', u'id': 42, u'remote_ip': u'10.2.51.2'}]}, {u'dnsif': u't6s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't6s1_dnsbrif'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t6ns1\" ps aux | grep -w '[d]nsmasq --interface t6s1_dnsif -z --dhcp-range=1.1.1.5,1.1.1.254' ; if [ $? -ne 0 ] ; then ip netns exec \"t6ns1\" dnsmasq --interface \"t6s1_dnsif\" -z --dhcp-range=1.1.1.5,'1.1.1.254' ; fi\n", "delta": "0:00:00.075814", "end": "2019-12-05 08:05:03.793448", "item": [{"bridge_name": "t6br1", "default_route_ip": "10.1.51.1", "ns_name": "t6ns1", "route": [{"if": "p1", "ip": "10.1.51.1/24", "ns_if": "t6if", "ns_name": "t6"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t6ns1if", "tenant_ns_ip": "10.1.51.1/24", "tenant_ns_name": "t6", "tenant_sub_if": "t6s1if", "tenant_sub_ip": "10.1.51.2/24"}], "vms": [{"brif": "t6br1if1", "disk": "10G", "mem": 2, "name": "t6_VM1", "vcpu": 4, "vmif": "t6VM1if1"}, {"brif": "t6br1if2", "disk": "10G", "mem": 4, "name": "t6_VM2", "vcpu": 2, "vmif": "t6VM2if1"}], "vxlan": [{"dev": "t6s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.51.2", "remote_ip": "10.2.51.2", "remote_route": "10.2.51.0/24", "subnet_route": "10.1.51.0/24", "tenant_route_ip": "192.168.6.2", "v_name": "vxlan_t6s1"}]}, {"brif": "t6s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.5", "dnsif": "t6s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "rc": 0, "start": "2019-12-05 08:05:03.717634", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Create VXLAN devices] ******************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.51.1/24', u'ns_name': u't6', u'ns_if': u't6if', u'if': u'p1'}], u'default_route_ip': u'10.1.51.1', u'bridge_name': u't6br1', u'dns': [{u'dnsif': u't6s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't6s1_dnsbrif'}], u'ns_name': u't6ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.51.2/24', u'tenant_ns_ip': u'10.1.51.1/24', u'tenant_ns_if': u't6ns1if', u'tenant_sub_if': u't6s1if', u'tenant_ns_name': u't6'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't6_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't6br1if1', u'vmif': u't6VM1if1'}, {u'mem': 4, u'name': u't6_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't6br1if2', u'vmif': u't6VM2if1'}]}, {u'local_ip': u'10.1.51.2', u'dsport': 4789, u'dev': u't6s1if', u'tenant_route_ip': u'192.168.6.2', u'remote_route': u'10.2.51.0/24', u'subnet_route': u'10.1.51.0/24', u'v_name': u'vxlan_t6s1', u'id': 42, u'remote_ip': u'10.2.51.2'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t6ns1\" ip link show \"vxlan_t6s1\" ; if [ $? -ne 0 ] ; then ip netns exec \"t6ns1\" ip link add \"vxlan_t6s1\" type vxlan id \"42\" local \"10.1.51.2\" remote \"10.2.51.2\" dstport \"4789\" dev \"t6s1if\"; ip netns exec \"t6ns1\" ip link set dev \"vxlan_t6s1\" up ; fi\n", "delta": "0:00:00.116195", "end": "2019-12-05 08:05:04.197295", "item": [{"bridge_name": "t6br1", "default_route_ip": "10.1.51.1", "dns": [{"brif": "t6s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.5", "dnsif": "t6s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t6ns1", "route": [{"if": "p1", "ip": "10.1.51.1/24", "ns_if": "t6if", "ns_name": "t6"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t6ns1if", "tenant_ns_ip": "10.1.51.1/24", "tenant_ns_name": "t6", "tenant_sub_if": "t6s1if", "tenant_sub_ip": "10.1.51.2/24"}], "vms": [{"brif": "t6br1if1", "disk": "10G", "mem": 2, "name": "t6_VM1", "vcpu": 4, "vmif": "t6VM1if1"}, {"brif": "t6br1if2", "disk": "10G", "mem": 4, "name": "t6_VM2", "vcpu": 2, "vmif": "t6VM2if1"}]}, {"dev": "t6s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.51.2", "remote_ip": "10.2.51.2", "remote_route": "10.2.51.0/24", "subnet_route": "10.1.51.0/24", "tenant_route_ip": "192.168.6.2", "v_name": "vxlan_t6s1"}], "rc": 0, "start": "2019-12-05 08:05:04.081100", "stderr": "Device \"vxlan_t6s1\" does not exist.", "stderr_lines": ["Device \"vxlan_t6s1\" does not exist."], "stdout": "", "stdout_lines": []}

TASK [Attach VXLANs to bridge] ***************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.51.1/24', u'ns_name': u't6', u'ns_if': u't6if', u'if': u'p1'}], u'default_route_ip': u'10.1.51.1', u'bridge_name': u't6br1', u'dns': [{u'dnsif': u't6s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't6s1_dnsbrif'}], u'ns_name': u't6ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.51.2/24', u'tenant_ns_ip': u'10.1.51.1/24', u'tenant_ns_if': u't6ns1if', u'tenant_sub_if': u't6s1if', u'tenant_ns_name': u't6'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't6_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't6br1if1', u'vmif': u't6VM1if1'}, {u'mem': 4, u'name': u't6_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't6br1if2', u'vmif': u't6VM2if1'}]}, {u'local_ip': u'10.1.51.2', u'dsport': 4789, u'dev': u't6s1if', u'tenant_route_ip': u'192.168.6.2', u'remote_route': u'10.2.51.0/24', u'subnet_route': u'10.1.51.0/24', u'v_name': u'vxlan_t6s1', u'id': 42, u'remote_ip': u'10.2.51.2'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t6ns1\" brctl show \"t6br1\" | grep -w 'vxlan_t6s1' ; if [ $? -ne 0 ] ; then ip netns exec \"t6ns1\" brctl addif \"t6br1\" \"vxlan_t6s1\" ; fi\n", "delta": "0:00:00.077342", "end": "2019-12-05 08:05:04.629491", "item": [{"bridge_name": "t6br1", "default_route_ip": "10.1.51.1", "dns": [{"brif": "t6s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.5", "dnsif": "t6s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t6ns1", "route": [{"if": "p1", "ip": "10.1.51.1/24", "ns_if": "t6if", "ns_name": "t6"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t6ns1if", "tenant_ns_ip": "10.1.51.1/24", "tenant_ns_name": "t6", "tenant_sub_if": "t6s1if", "tenant_sub_ip": "10.1.51.2/24"}], "vms": [{"brif": "t6br1if1", "disk": "10G", "mem": 2, "name": "t6_VM1", "vcpu": 4, "vmif": "t6VM1if1"}, {"brif": "t6br1if2", "disk": "10G", "mem": 4, "name": "t6_VM2", "vcpu": 2, "vmif": "t6VM2if1"}]}, {"dev": "t6s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.51.2", "remote_ip": "10.2.51.2", "remote_route": "10.2.51.0/24", "subnet_route": "10.1.51.0/24", "tenant_route_ip": "192.168.6.2", "v_name": "vxlan_t6s1"}], "rc": 0, "start": "2019-12-05 08:05:04.552149", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

PLAY RECAP ***********************************************************************************************************
localhost                  : ok=21   changed=21   unreachable=0    failed=0    skipped=0    rescued=0    ignored=0   

Using /etc/ansible/ansible.cfg as config file

PLAY [worker] ********************************************************************************************************

TASK [Create Tenant Namespace] ***************************************************************************************
changed: [99.99.99.2] => (item={u'default_route_ip': u'192.168.134.1', u'name': u't6', u'pns_ip': u'192.168.134.1/24', u'tenant_if': u't6if', u'tenant_ip': u'192.168.134.2/24', u'pns_if': u't6pns_if'}) => {"ansible_loop_var": "item", "changed": true, "cmd": ["ip", "netns", "add", "t6"], "delta": "0:00:00.052042", "end": "2019-12-05 08:05:06.660735", "item": {"default_route_ip": "192.168.134.1", "name": "t6", "pns_if": "t6pns_if", "pns_ip": "192.168.134.1/24", "tenant_if": "t6if", "tenant_ip": "192.168.134.2/24"}, "rc": 0, "start": "2019-12-05 08:05:06.608693", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Create Subnet Namespace] ***************************************************************************************
changed: [99.99.99.2] => (item={u'route': [{u'ip': u'10.2.51.1/24', u'ns_name': u't6', u'ns_if': u't6if', u'if': u'p1'}], u'default_route_ip': u'10.2.51.1', u'bridge_name': u't6br1', u'dns': [{u'dnsif': [], u'dhcp_start': [], u'dhcp_end': [], u'dnsif_ip': [], u'net_mask': [], u'brif': []}], u'ns_name': u't6ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.51.2/24', u'tenant_ns_ip': u'10.2.51.1/24', u'tenant_ns_if': u't6ns1if', u'tenant_ns_name': u't6', u'tenant_sub_if': u't6s1if'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't6_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't6br1if1', u'vmif': u't6VM4if1'}], u'vxlan': [{u'local_ip': u'10.2.51.2', u'tenant_route_ip': u'192.168.134.2', u'dsport': 4789, u'dev': u't6s1if', u'subnet_route': u'10.2.51.0/24', u'remote_route': u'10.1.51.0/24', u'v_name': u'vxlan_t6s1', u'id': 42, u'remote_ip': u'10.1.51.2'}]}) => {"ansible_loop_var": "item", "changed": true, "cmd": ["ip", "netns", "add", "t6ns1"], "delta": "0:00:00.057198", "end": "2019-12-05 08:05:07.165926", "item": {"bridge_name": "t6br1", "default_route_ip": "10.2.51.1", "dns": [{"brif": [], "dhcp_end": [], "dhcp_start": [], "dnsif": [], "dnsif_ip": [], "net_mask": []}], "ns_name": "t6ns1", "route": [{"if": "p1", "ip": "10.2.51.1/24", "ns_if": "t6if", "ns_name": "t6"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t6ns1if", "tenant_ns_ip": "10.2.51.1/24", "tenant_ns_name": "t6", "tenant_sub_if": "t6s1if", "tenant_sub_ip": "10.2.51.2/24"}], "vms": [{"brif": "t6br1if1", "disk": "10G", "mem": 2, "name": "t6_VM4", "vcpu": 4, "vmif": "t6VM4if1"}], "vxlan": [{"dev": "t6s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.51.2", "remote_ip": "10.1.51.2", "remote_route": "10.1.51.0/24", "subnet_route": "10.2.51.0/24", "tenant_route_ip": "192.168.134.2", "v_name": "vxlan_t6s1"}]}, "rc": 0, "start": "2019-12-05 08:05:07.108728", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}
changed: [99.99.99.2] => (item={u'route': [{u'ip': u'10.2.52.1/24', u'ns_name': u't6', u'ns_if': u't6if', u'if': u'p1'}], u'default_route_ip': u'10.2.52.1', u'bridge_name': u't6br2', u'dns': [{u'dnsif': u't6s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't6s2_dnsbrif'}], u'ns_name': u't6ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.52.2/24', u'tenant_ns_ip': u'10.2.52.1/24', u'tenant_ns_if': u't6ns2if', u'tenant_ns_name': u't6', u'tenant_sub_if': u't6s2if'}], u'subnet_ip': u'2.2.2.0/24', u'vms': [{u'mem': 3, u'name': u't6_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't6br2if1', u'vmif': u't6VM3if1'}], u'vxlan': [{u'local_ip': [], u'tenant_route_ip': [], u'dsport': [], u'dev': [], u'subnet_route': [], u'remote_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}) => {"ansible_loop_var": "item", "changed": true, "cmd": ["ip", "netns", "add", "t6ns2"], "delta": "0:00:00.057726", "end": "2019-12-05 08:05:07.560796", "item": {"bridge_name": "t6br2", "default_route_ip": "10.2.52.1", "dns": [{"brif": "t6s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t6s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t6ns2", "route": [{"if": "p1", "ip": "10.2.52.1/24", "ns_if": "t6if", "ns_name": "t6"}], "subnet_ip": "2.2.2.0/24", "tenant_ns": [{"tenant_ns_if": "t6ns2if", "tenant_ns_ip": "10.2.52.1/24", "tenant_ns_name": "t6", "tenant_sub_if": "t6s2if", "tenant_sub_ip": "10.2.52.2/24"}], "vms": [{"brif": "t6br2if1", "disk": "10G", "mem": 3, "name": "t6_VM3", "vcpu": 2, "vmif": "t6VM3if1"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, "rc": 0, "start": "2019-12-05 08:05:07.503070", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Create Tenant VETH pairs] **************************************************************************************
changed: [99.99.99.2] => (item={u'default_route_ip': u'192.168.134.1', u'name': u't6', u'pns_ip': u'192.168.134.1/24', u'tenant_if': u't6if', u'tenant_ip': u'192.168.134.2/24', u'pns_if': u't6pns_if'}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip link show \"t6if\" ; if [ $? -ne 0 ] ; then ip link add \"t6if\" type veth peer name \"t6pns_if\" ; fi\n", "delta": "0:00:00.015642", "end": "2019-12-05 08:05:08.061056", "item": {"default_route_ip": "192.168.134.1", "name": "t6", "pns_if": "t6pns_if", "pns_ip": "192.168.134.1/24", "tenant_if": "t6if", "tenant_ip": "192.168.134.2/24"}, "rc": 0, "start": "2019-12-05 08:05:08.045414", "stderr": "Device \"t6if\" does not exist.", "stderr_lines": ["Device \"t6if\" does not exist."], "stdout": "", "stdout_lines": []}

TASK [Attach Tenant VETH Pairs] **************************************************************************************
changed: [99.99.99.2] => (item={u'default_route_ip': u'192.168.134.1', u'name': u't6', u'pns_ip': u'192.168.134.1/24', u'tenant_if': u't6if', u'tenant_ip': u'192.168.134.2/24', u'pns_if': u't6pns_if'}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec pns ip link show \"t6pns_if\" ; if [ $? -ne 0 ] ; then ip link set \"t6pns_if\" netns pns ; fi\nip netns exec \"t6\" ip link show \"t6if\" ; if [ $? -ne 0 ] ; then ip link set \"t6if\" netns \"t6\" ; fi\nip netns exec pns ip link set dev \"t6pns_if\" up\nip netns exec \"t6\" ip link set dev \"t6if\" up\n", "delta": "0:00:00.234734", "end": "2019-12-05 08:05:08.720539", "item": {"default_route_ip": "192.168.134.1", "name": "t6", "pns_if": "t6pns_if", "pns_ip": "192.168.134.1/24", "tenant_if": "t6if", "tenant_ip": "192.168.134.2/24"}, "rc": 0, "start": "2019-12-05 08:05:08.485805", "stderr": "Device \"t6pns_if\" does not exist.\nDevice \"t6if\" does not exist.", "stderr_lines": ["Device \"t6pns_if\" does not exist.", "Device \"t6if\" does not exist."], "stdout": "", "stdout_lines": []}

TASK [Add IP addresses to Tenant VETH Pairs] *************************************************************************
changed: [99.99.99.2] => (item={u'default_route_ip': u'192.168.134.1', u'name': u't6', u'pns_ip': u'192.168.134.1/24', u'tenant_if': u't6if', u'tenant_ip': u'192.168.134.2/24', u'pns_if': u't6pns_if'}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec pns ip addr show \"t6pns_if\" | awk 'FNR==3{ print $2 }' | grep -w '^192.168.134.1/24' ; if [ $? -ne 0 ] ; then ip netns exec pns ip addr add \"192.168.134.1/24\" dev \"t6pns_if\" ; fi\nip netns exec \"t6\" ip addr show \"t6if\" | awk 'FNR==3{ print $2 }' | grep -w '^192.168.134.2/24' ; if [ $? -ne 0 ] ; then ip netns exec \"t6\" ip addr add \"192.168.134.2/24\" dev \"t6if\" ; fi\n", "delta": "0:00:00.173926", "end": "2019-12-05 08:05:09.352566", "item": {"default_route_ip": "192.168.134.1", "name": "t6", "pns_if": "t6pns_if", "pns_ip": "192.168.134.1/24", "tenant_if": "t6if", "tenant_ip": "192.168.134.2/24"}, "rc": 0, "start": "2019-12-05 08:05:09.178640", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Create Namespace VETH Pairs] ***********************************************************************************
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.51.1/24', u'ns_name': u't6', u'ns_if': u't6if', u'if': u'p1'}], u'default_route_ip': u'10.2.51.1', u'bridge_name': u't6br1', u'dns': [{u'dnsif': [], u'dhcp_start': [], u'dhcp_end': [], u'dnsif_ip': [], u'net_mask': [], u'brif': []}], u'ns_name': u't6ns1', u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't6_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't6br1if1', u'vmif': u't6VM4if1'}], u'vxlan': [{u'local_ip': u'10.2.51.2', u'dsport': 4789, u'dev': u't6s1if', u'tenant_route_ip': u'192.168.134.2', u'remote_route': u'10.1.51.0/24', u'subnet_route': u'10.2.51.0/24', u'v_name': u'vxlan_t6s1', u'id': 42, u'remote_ip': u'10.1.51.2'}]}, {u'tenant_sub_ip': u'10.2.51.2/24', u'tenant_ns_ip': u'10.2.51.1/24', u'tenant_ns_if': u't6ns1if', u'tenant_sub_if': u't6s1if', u'tenant_ns_name': u't6'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip link show \"t6ns1if\" ; if [ $? -ne 0 ] ; then ip link add \"t6ns1if\" type veth peer name \"t6s1if\" ; fi\n", "delta": "0:00:00.019785", "end": "2019-12-05 08:05:09.801656", "item": [{"bridge_name": "t6br1", "default_route_ip": "10.2.51.1", "dns": [{"brif": [], "dhcp_end": [], "dhcp_start": [], "dnsif": [], "dnsif_ip": [], "net_mask": []}], "ns_name": "t6ns1", "route": [{"if": "p1", "ip": "10.2.51.1/24", "ns_if": "t6if", "ns_name": "t6"}], "subnet_ip": "1.1.1.0/24", "vms": [{"brif": "t6br1if1", "disk": "10G", "mem": 2, "name": "t6_VM4", "vcpu": 4, "vmif": "t6VM4if1"}], "vxlan": [{"dev": "t6s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.51.2", "remote_ip": "10.1.51.2", "remote_route": "10.1.51.0/24", "subnet_route": "10.2.51.0/24", "tenant_route_ip": "192.168.134.2", "v_name": "vxlan_t6s1"}]}, {"tenant_ns_if": "t6ns1if", "tenant_ns_ip": "10.2.51.1/24", "tenant_ns_name": "t6", "tenant_sub_if": "t6s1if", "tenant_sub_ip": "10.2.51.2/24"}], "rc": 0, "start": "2019-12-05 08:05:09.781871", "stderr": "Device \"t6ns1if\" does not exist.", "stderr_lines": ["Device \"t6ns1if\" does not exist."], "stdout": "", "stdout_lines": []}
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.52.1/24', u'ns_name': u't6', u'ns_if': u't6if', u'if': u'p1'}], u'default_route_ip': u'10.2.52.1', u'bridge_name': u't6br2', u'dns': [{u'dnsif': u't6s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't6s2_dnsbrif'}], u'ns_name': u't6ns2', u'subnet_ip': u'2.2.2.0/24', u'vms': [{u'mem': 3, u'name': u't6_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't6br2if1', u'vmif': u't6VM3if1'}], u'vxlan': [{u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}, {u'tenant_sub_ip': u'10.2.52.2/24', u'tenant_ns_ip': u'10.2.52.1/24', u'tenant_ns_if': u't6ns2if', u'tenant_sub_if': u't6s2if', u'tenant_ns_name': u't6'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip link show \"t6ns2if\" ; if [ $? -ne 0 ] ; then ip link add \"t6ns2if\" type veth peer name \"t6s2if\" ; fi\n", "delta": "0:00:00.014020", "end": "2019-12-05 08:05:10.190680", "item": [{"bridge_name": "t6br2", "default_route_ip": "10.2.52.1", "dns": [{"brif": "t6s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t6s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t6ns2", "route": [{"if": "p1", "ip": "10.2.52.1/24", "ns_if": "t6if", "ns_name": "t6"}], "subnet_ip": "2.2.2.0/24", "vms": [{"brif": "t6br2if1", "disk": "10G", "mem": 3, "name": "t6_VM3", "vcpu": 2, "vmif": "t6VM3if1"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, {"tenant_ns_if": "t6ns2if", "tenant_ns_ip": "10.2.52.1/24", "tenant_ns_name": "t6", "tenant_sub_if": "t6s2if", "tenant_sub_ip": "10.2.52.2/24"}], "rc": 0, "start": "2019-12-05 08:05:10.176660", "stderr": "Device \"t6ns2if\" does not exist.", "stderr_lines": ["Device \"t6ns2if\" does not exist."], "stdout": "", "stdout_lines": []}

TASK [Attach Namespace VETH Pairs] ***********************************************************************************
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.51.1/24', u'ns_name': u't6', u'ns_if': u't6if', u'if': u'p1'}], u'default_route_ip': u'10.2.51.1', u'bridge_name': u't6br1', u'dns': [{u'dnsif': [], u'dhcp_start': [], u'dhcp_end': [], u'dnsif_ip': [], u'net_mask': [], u'brif': []}], u'ns_name': u't6ns1', u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't6_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't6br1if1', u'vmif': u't6VM4if1'}], u'vxlan': [{u'local_ip': u'10.2.51.2', u'dsport': 4789, u'dev': u't6s1if', u'tenant_route_ip': u'192.168.134.2', u'remote_route': u'10.1.51.0/24', u'subnet_route': u'10.2.51.0/24', u'v_name': u'vxlan_t6s1', u'id': 42, u'remote_ip': u'10.1.51.2'}]}, {u'tenant_sub_ip': u'10.2.51.2/24', u'tenant_ns_ip': u'10.2.51.1/24', u'tenant_ns_if': u't6ns1if', u'tenant_sub_if': u't6s1if', u'tenant_ns_name': u't6'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t6\" ip link show \"t6ns1if\" ; if [ $? -ne 0 ] ; then ip link set \"t6ns1if\" netns \"t6\" ; fi\nip netns exec \"t6ns1\" ip link show \"t6s1if\" ; if [ $? -ne 0 ] ; then ip link set \"t6s1if\" netns \"t6ns1\" ; fi\n", "delta": "0:00:00.139235", "end": "2019-12-05 08:05:10.755594", "item": [{"bridge_name": "t6br1", "default_route_ip": "10.2.51.1", "dns": [{"brif": [], "dhcp_end": [], "dhcp_start": [], "dnsif": [], "dnsif_ip": [], "net_mask": []}], "ns_name": "t6ns1", "route": [{"if": "p1", "ip": "10.2.51.1/24", "ns_if": "t6if", "ns_name": "t6"}], "subnet_ip": "1.1.1.0/24", "vms": [{"brif": "t6br1if1", "disk": "10G", "mem": 2, "name": "t6_VM4", "vcpu": 4, "vmif": "t6VM4if1"}], "vxlan": [{"dev": "t6s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.51.2", "remote_ip": "10.1.51.2", "remote_route": "10.1.51.0/24", "subnet_route": "10.2.51.0/24", "tenant_route_ip": "192.168.134.2", "v_name": "vxlan_t6s1"}]}, {"tenant_ns_if": "t6ns1if", "tenant_ns_ip": "10.2.51.1/24", "tenant_ns_name": "t6", "tenant_sub_if": "t6s1if", "tenant_sub_ip": "10.2.51.2/24"}], "rc": 0, "start": "2019-12-05 08:05:10.616359", "stderr": "Device \"t6ns1if\" does not exist.\nDevice \"t6s1if\" does not exist.", "stderr_lines": ["Device \"t6ns1if\" does not exist.", "Device \"t6s1if\" does not exist."], "stdout": "", "stdout_lines": []}
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.52.1/24', u'ns_name': u't6', u'ns_if': u't6if', u'if': u'p1'}], u'default_route_ip': u'10.2.52.1', u'bridge_name': u't6br2', u'dns': [{u'dnsif': u't6s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't6s2_dnsbrif'}], u'ns_name': u't6ns2', u'subnet_ip': u'2.2.2.0/24', u'vms': [{u'mem': 3, u'name': u't6_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't6br2if1', u'vmif': u't6VM3if1'}], u'vxlan': [{u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}, {u'tenant_sub_ip': u'10.2.52.2/24', u'tenant_ns_ip': u'10.2.52.1/24', u'tenant_ns_if': u't6ns2if', u'tenant_sub_if': u't6s2if', u'tenant_ns_name': u't6'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t6\" ip link show \"t6ns2if\" ; if [ $? -ne 0 ] ; then ip link set \"t6ns2if\" netns \"t6\" ; fi\nip netns exec \"t6ns2\" ip link show \"t6s2if\" ; if [ $? -ne 0 ] ; then ip link set \"t6s2if\" netns \"t6ns2\" ; fi\n", "delta": "0:00:00.154589", "end": "2019-12-05 08:05:11.276753", "item": [{"bridge_name": "t6br2", "default_route_ip": "10.2.52.1", "dns": [{"brif": "t6s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t6s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t6ns2", "route": [{"if": "p1", "ip": "10.2.52.1/24", "ns_if": "t6if", "ns_name": "t6"}], "subnet_ip": "2.2.2.0/24", "vms": [{"brif": "t6br2if1", "disk": "10G", "mem": 3, "name": "t6_VM3", "vcpu": 2, "vmif": "t6VM3if1"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, {"tenant_ns_if": "t6ns2if", "tenant_ns_ip": "10.2.52.1/24", "tenant_ns_name": "t6", "tenant_sub_if": "t6s2if", "tenant_sub_ip": "10.2.52.2/24"}], "rc": 0, "start": "2019-12-05 08:05:11.122164", "stderr": "Device \"t6ns2if\" does not exist.\nDevice \"t6s2if\" does not exist.", "stderr_lines": ["Device \"t6ns2if\" does not exist.", "Device \"t6s2if\" does not exist."], "stdout": "", "stdout_lines": []}

TASK [Set Namespace VETH Pairs UP] ***********************************************************************************
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.51.1/24', u'ns_name': u't6', u'ns_if': u't6if', u'if': u'p1'}], u'default_route_ip': u'10.2.51.1', u'bridge_name': u't6br1', u'dns': [{u'dnsif': [], u'dhcp_start': [], u'dhcp_end': [], u'dnsif_ip': [], u'net_mask': [], u'brif': []}], u'ns_name': u't6ns1', u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't6_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't6br1if1', u'vmif': u't6VM4if1'}], u'vxlan': [{u'local_ip': u'10.2.51.2', u'dsport': 4789, u'dev': u't6s1if', u'tenant_route_ip': u'192.168.134.2', u'remote_route': u'10.1.51.0/24', u'subnet_route': u'10.2.51.0/24', u'v_name': u'vxlan_t6s1', u'id': 42, u'remote_ip': u'10.1.51.2'}]}, {u'tenant_sub_ip': u'10.2.51.2/24', u'tenant_ns_ip': u'10.2.51.1/24', u'tenant_ns_if': u't6ns1if', u'tenant_sub_if': u't6s1if', u'tenant_ns_name': u't6'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t6\" ip link set dev \"t6ns1if\" up\nip netns exec \"t6ns1\" ip link set dev \"t6s1if\" up\n", "delta": "0:00:00.074497", "end": "2019-12-05 08:05:11.776508", "item": [{"bridge_name": "t6br1", "default_route_ip": "10.2.51.1", "dns": [{"brif": [], "dhcp_end": [], "dhcp_start": [], "dnsif": [], "dnsif_ip": [], "net_mask": []}], "ns_name": "t6ns1", "route": [{"if": "p1", "ip": "10.2.51.1/24", "ns_if": "t6if", "ns_name": "t6"}], "subnet_ip": "1.1.1.0/24", "vms": [{"brif": "t6br1if1", "disk": "10G", "mem": 2, "name": "t6_VM4", "vcpu": 4, "vmif": "t6VM4if1"}], "vxlan": [{"dev": "t6s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.51.2", "remote_ip": "10.1.51.2", "remote_route": "10.1.51.0/24", "subnet_route": "10.2.51.0/24", "tenant_route_ip": "192.168.134.2", "v_name": "vxlan_t6s1"}]}, {"tenant_ns_if": "t6ns1if", "tenant_ns_ip": "10.2.51.1/24", "tenant_ns_name": "t6", "tenant_sub_if": "t6s1if", "tenant_sub_ip": "10.2.51.2/24"}], "rc": 0, "start": "2019-12-05 08:05:11.702011", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.52.1/24', u'ns_name': u't6', u'ns_if': u't6if', u'if': u'p1'}], u'default_route_ip': u'10.2.52.1', u'bridge_name': u't6br2', u'dns': [{u'dnsif': u't6s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't6s2_dnsbrif'}], u'ns_name': u't6ns2', u'subnet_ip': u'2.2.2.0/24', u'vms': [{u'mem': 3, u'name': u't6_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't6br2if1', u'vmif': u't6VM3if1'}], u'vxlan': [{u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}, {u'tenant_sub_ip': u'10.2.52.2/24', u'tenant_ns_ip': u'10.2.52.1/24', u'tenant_ns_if': u't6ns2if', u'tenant_sub_if': u't6s2if', u'tenant_ns_name': u't6'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t6\" ip link set dev \"t6ns2if\" up\nip netns exec \"t6ns2\" ip link set dev \"t6s2if\" up\n", "delta": "0:00:00.087522", "end": "2019-12-05 08:05:12.208548", "item": [{"bridge_name": "t6br2", "default_route_ip": "10.2.52.1", "dns": [{"brif": "t6s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t6s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t6ns2", "route": [{"if": "p1", "ip": "10.2.52.1/24", "ns_if": "t6if", "ns_name": "t6"}], "subnet_ip": "2.2.2.0/24", "vms": [{"brif": "t6br2if1", "disk": "10G", "mem": 3, "name": "t6_VM3", "vcpu": 2, "vmif": "t6VM3if1"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, {"tenant_ns_if": "t6ns2if", "tenant_ns_ip": "10.2.52.1/24", "tenant_ns_name": "t6", "tenant_sub_if": "t6s2if", "tenant_sub_ip": "10.2.52.2/24"}], "rc": 0, "start": "2019-12-05 08:05:12.121026", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Add IP addresses to Namespace VETH Pairs] **********************************************************************
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.51.1/24', u'ns_name': u't6', u'ns_if': u't6if', u'if': u'p1'}], u'default_route_ip': u'10.2.51.1', u'bridge_name': u't6br1', u'dns': [{u'dnsif': [], u'dhcp_start': [], u'dhcp_end': [], u'dnsif_ip': [], u'net_mask': [], u'brif': []}], u'ns_name': u't6ns1', u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't6_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't6br1if1', u'vmif': u't6VM4if1'}], u'vxlan': [{u'local_ip': u'10.2.51.2', u'dsport': 4789, u'dev': u't6s1if', u'tenant_route_ip': u'192.168.134.2', u'remote_route': u'10.1.51.0/24', u'subnet_route': u'10.2.51.0/24', u'v_name': u'vxlan_t6s1', u'id': 42, u'remote_ip': u'10.1.51.2'}]}, {u'tenant_sub_ip': u'10.2.51.2/24', u'tenant_ns_ip': u'10.2.51.1/24', u'tenant_ns_if': u't6ns1if', u'tenant_sub_if': u't6s1if', u'tenant_ns_name': u't6'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t6ns1\" ip addr show \"t6s1if\" | awk 'FNR==3{ print $2 }' | grep -w '^10.2.51.2/24' ; if [ $? -ne 0 ] ; then ip netns exec \"t6ns1\" ip addr add \"10.2.51.2/24\" dev \"t6s1if\" ; fi\n\nip netns exec \"t6\" ip addr show \"t6ns1if\" | awk 'FNR==3{ print $2 }' | grep -w '^10.2.51.1/24' ; if [ $? -ne 0 ] ; then ip netns exec \"t6\" ip addr add \"10.2.51.1/24\" dev \"t6ns1if\" ; fi\n", "delta": "0:00:00.142256", "end": "2019-12-05 08:05:12.792732", "item": [{"bridge_name": "t6br1", "default_route_ip": "10.2.51.1", "dns": [{"brif": [], "dhcp_end": [], "dhcp_start": [], "dnsif": [], "dnsif_ip": [], "net_mask": []}], "ns_name": "t6ns1", "route": [{"if": "p1", "ip": "10.2.51.1/24", "ns_if": "t6if", "ns_name": "t6"}], "subnet_ip": "1.1.1.0/24", "vms": [{"brif": "t6br1if1", "disk": "10G", "mem": 2, "name": "t6_VM4", "vcpu": 4, "vmif": "t6VM4if1"}], "vxlan": [{"dev": "t6s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.51.2", "remote_ip": "10.1.51.2", "remote_route": "10.1.51.0/24", "subnet_route": "10.2.51.0/24", "tenant_route_ip": "192.168.134.2", "v_name": "vxlan_t6s1"}]}, {"tenant_ns_if": "t6ns1if", "tenant_ns_ip": "10.2.51.1/24", "tenant_ns_name": "t6", "tenant_sub_if": "t6s1if", "tenant_sub_ip": "10.2.51.2/24"}], "rc": 0, "start": "2019-12-05 08:05:12.650476", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.52.1/24', u'ns_name': u't6', u'ns_if': u't6if', u'if': u'p1'}], u'default_route_ip': u'10.2.52.1', u'bridge_name': u't6br2', u'dns': [{u'dnsif': u't6s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't6s2_dnsbrif'}], u'ns_name': u't6ns2', u'subnet_ip': u'2.2.2.0/24', u'vms': [{u'mem': 3, u'name': u't6_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't6br2if1', u'vmif': u't6VM3if1'}], u'vxlan': [{u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}, {u'tenant_sub_ip': u'10.2.52.2/24', u'tenant_ns_ip': u'10.2.52.1/24', u'tenant_ns_if': u't6ns2if', u'tenant_sub_if': u't6s2if', u'tenant_ns_name': u't6'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t6ns2\" ip addr show \"t6s2if\" | awk 'FNR==3{ print $2 }' | grep -w '^10.2.52.2/24' ; if [ $? -ne 0 ] ; then ip netns exec \"t6ns2\" ip addr add \"10.2.52.2/24\" dev \"t6s2if\" ; fi\n\nip netns exec \"t6\" ip addr show \"t6ns2if\" | awk 'FNR==3{ print $2 }' | grep -w '^10.2.52.1/24' ; if [ $? -ne 0 ] ; then ip netns exec \"t6\" ip addr add \"10.2.52.1/24\" dev \"t6ns2if\" ; fi\n", "delta": "0:00:00.141361", "end": "2019-12-05 08:05:13.280542", "item": [{"bridge_name": "t6br2", "default_route_ip": "10.2.52.1", "dns": [{"brif": "t6s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t6s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t6ns2", "route": [{"if": "p1", "ip": "10.2.52.1/24", "ns_if": "t6if", "ns_name": "t6"}], "subnet_ip": "2.2.2.0/24", "vms": [{"brif": "t6br2if1", "disk": "10G", "mem": 3, "name": "t6_VM3", "vcpu": 2, "vmif": "t6VM3if1"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, {"tenant_ns_if": "t6ns2if", "tenant_ns_ip": "10.2.52.1/24", "tenant_ns_name": "t6", "tenant_sub_if": "t6s2if", "tenant_sub_ip": "10.2.52.2/24"}], "rc": 0, "start": "2019-12-05 08:05:13.139181", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Add IP Route to Tenant] ****************************************************************************************
changed: [99.99.99.2] => (item={u'default_route_ip': u'192.168.134.1', u'name': u't6', u'pns_ip': u'192.168.134.1/24', u'tenant_if': u't6if', u'tenant_ip': u'192.168.134.2/24', u'pns_if': u't6pns_if'}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t6\" ip route show default | grep -w '[d]efault via 192.168.134.1' ; if [ $? -ne 0 ] ; then ip netns exec \"t6\" ip route add default via \"192.168.134.1\" ; fi\n", "delta": "0:00:00.082556", "end": "2019-12-05 08:05:13.796472", "item": {"default_route_ip": "192.168.134.1", "name": "t6", "pns_if": "t6pns_if", "pns_ip": "192.168.134.1/24", "tenant_if": "t6if", "tenant_ip": "192.168.134.2/24"}, "rc": 0, "start": "2019-12-05 08:05:13.713916", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Add IP Route to Tenant Subnet] *********************************************************************************
changed: [99.99.99.2] => (item={u'route': [{u'ip': u'10.2.51.1/24', u'ns_name': u't6', u'ns_if': u't6if', u'if': u'p1'}], u'default_route_ip': u'10.2.51.1', u'bridge_name': u't6br1', u'dns': [{u'dnsif': [], u'dhcp_start': [], u'dhcp_end': [], u'dnsif_ip': [], u'net_mask': [], u'brif': []}], u'ns_name': u't6ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.51.2/24', u'tenant_ns_ip': u'10.2.51.1/24', u'tenant_ns_if': u't6ns1if', u'tenant_ns_name': u't6', u'tenant_sub_if': u't6s1if'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't6_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't6br1if1', u'vmif': u't6VM4if1'}], u'vxlan': [{u'local_ip': u'10.2.51.2', u'tenant_route_ip': u'192.168.134.2', u'dsport': 4789, u'dev': u't6s1if', u'subnet_route': u'10.2.51.0/24', u'remote_route': u'10.1.51.0/24', u'v_name': u'vxlan_t6s1', u'id': 42, u'remote_ip': u'10.1.51.2'}]}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t6ns1\" ip route show default | grep -w '[d]efault via 10.2.51.1' ; if [ $? -ne 0 ] ; then ip netns exec \"t6ns1\" ip route add default via \"10.2.51.1\" ; fi\n", "delta": "0:00:00.073162", "end": "2019-12-05 08:05:14.280458", "item": {"bridge_name": "t6br1", "default_route_ip": "10.2.51.1", "dns": [{"brif": [], "dhcp_end": [], "dhcp_start": [], "dnsif": [], "dnsif_ip": [], "net_mask": []}], "ns_name": "t6ns1", "route": [{"if": "p1", "ip": "10.2.51.1/24", "ns_if": "t6if", "ns_name": "t6"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t6ns1if", "tenant_ns_ip": "10.2.51.1/24", "tenant_ns_name": "t6", "tenant_sub_if": "t6s1if", "tenant_sub_ip": "10.2.51.2/24"}], "vms": [{"brif": "t6br1if1", "disk": "10G", "mem": 2, "name": "t6_VM4", "vcpu": 4, "vmif": "t6VM4if1"}], "vxlan": [{"dev": "t6s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.51.2", "remote_ip": "10.1.51.2", "remote_route": "10.1.51.0/24", "subnet_route": "10.2.51.0/24", "tenant_route_ip": "192.168.134.2", "v_name": "vxlan_t6s1"}]}, "rc": 0, "start": "2019-12-05 08:05:14.207296", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}
changed: [99.99.99.2] => (item={u'route': [{u'ip': u'10.2.52.1/24', u'ns_name': u't6', u'ns_if': u't6if', u'if': u'p1'}], u'default_route_ip': u'10.2.52.1', u'bridge_name': u't6br2', u'dns': [{u'dnsif': u't6s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't6s2_dnsbrif'}], u'ns_name': u't6ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.52.2/24', u'tenant_ns_ip': u'10.2.52.1/24', u'tenant_ns_if': u't6ns2if', u'tenant_ns_name': u't6', u'tenant_sub_if': u't6s2if'}], u'subnet_ip': u'2.2.2.0/24', u'vms': [{u'mem': 3, u'name': u't6_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't6br2if1', u'vmif': u't6VM3if1'}], u'vxlan': [{u'local_ip': [], u'tenant_route_ip': [], u'dsport': [], u'dev': [], u'subnet_route': [], u'remote_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t6ns2\" ip route show default | grep -w '[d]efault via 10.2.52.1' ; if [ $? -ne 0 ] ; then ip netns exec \"t6ns2\" ip route add default via \"10.2.52.1\" ; fi\n", "delta": "0:00:00.089489", "end": "2019-12-05 08:05:14.712442", "item": {"bridge_name": "t6br2", "default_route_ip": "10.2.52.1", "dns": [{"brif": "t6s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t6s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t6ns2", "route": [{"if": "p1", "ip": "10.2.52.1/24", "ns_if": "t6if", "ns_name": "t6"}], "subnet_ip": "2.2.2.0/24", "tenant_ns": [{"tenant_ns_if": "t6ns2if", "tenant_ns_ip": "10.2.52.1/24", "tenant_ns_name": "t6", "tenant_sub_if": "t6s2if", "tenant_sub_ip": "10.2.52.2/24"}], "vms": [{"brif": "t6br2if1", "disk": "10G", "mem": 3, "name": "t6_VM3", "vcpu": 2, "vmif": "t6VM3if1"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, "rc": 0, "start": "2019-12-05 08:05:14.622953", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Create bridge inside namespace] ********************************************************************************
changed: [99.99.99.2] => (item={u'route': [{u'ip': u'10.2.51.1/24', u'ns_name': u't6', u'ns_if': u't6if', u'if': u'p1'}], u'default_route_ip': u'10.2.51.1', u'bridge_name': u't6br1', u'dns': [{u'dnsif': [], u'dhcp_start': [], u'dhcp_end': [], u'dnsif_ip': [], u'net_mask': [], u'brif': []}], u'ns_name': u't6ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.51.2/24', u'tenant_ns_ip': u'10.2.51.1/24', u'tenant_ns_if': u't6ns1if', u'tenant_ns_name': u't6', u'tenant_sub_if': u't6s1if'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't6_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't6br1if1', u'vmif': u't6VM4if1'}], u'vxlan': [{u'local_ip': u'10.2.51.2', u'tenant_route_ip': u'192.168.134.2', u'dsport': 4789, u'dev': u't6s1if', u'subnet_route': u'10.2.51.0/24', u'remote_route': u'10.1.51.0/24', u'v_name': u'vxlan_t6s1', u'id': 42, u'remote_ip': u'10.1.51.2'}]}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t6ns1\" brctl show | grep -w '^t6br1'; if [ $? -ne 0 ] ; then ip netns exec \"t6ns1\" brctl addbr \"t6br1\" ; fi\nip netns exec \"t6ns1\" ip link set dev \"t6br1\" up\n", "delta": "0:00:00.119746", "end": "2019-12-05 08:05:15.248626", "item": {"bridge_name": "t6br1", "default_route_ip": "10.2.51.1", "dns": [{"brif": [], "dhcp_end": [], "dhcp_start": [], "dnsif": [], "dnsif_ip": [], "net_mask": []}], "ns_name": "t6ns1", "route": [{"if": "p1", "ip": "10.2.51.1/24", "ns_if": "t6if", "ns_name": "t6"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t6ns1if", "tenant_ns_ip": "10.2.51.1/24", "tenant_ns_name": "t6", "tenant_sub_if": "t6s1if", "tenant_sub_ip": "10.2.51.2/24"}], "vms": [{"brif": "t6br1if1", "disk": "10G", "mem": 2, "name": "t6_VM4", "vcpu": 4, "vmif": "t6VM4if1"}], "vxlan": [{"dev": "t6s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.51.2", "remote_ip": "10.1.51.2", "remote_route": "10.1.51.0/24", "subnet_route": "10.2.51.0/24", "tenant_route_ip": "192.168.134.2", "v_name": "vxlan_t6s1"}]}, "rc": 0, "start": "2019-12-05 08:05:15.128880", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}
changed: [99.99.99.2] => (item={u'route': [{u'ip': u'10.2.52.1/24', u'ns_name': u't6', u'ns_if': u't6if', u'if': u'p1'}], u'default_route_ip': u'10.2.52.1', u'bridge_name': u't6br2', u'dns': [{u'dnsif': u't6s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't6s2_dnsbrif'}], u'ns_name': u't6ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.52.2/24', u'tenant_ns_ip': u'10.2.52.1/24', u'tenant_ns_if': u't6ns2if', u'tenant_ns_name': u't6', u'tenant_sub_if': u't6s2if'}], u'subnet_ip': u'2.2.2.0/24', u'vms': [{u'mem': 3, u'name': u't6_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't6br2if1', u'vmif': u't6VM3if1'}], u'vxlan': [{u'local_ip': [], u'tenant_route_ip': [], u'dsport': [], u'dev': [], u'subnet_route': [], u'remote_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t6ns2\" brctl show | grep -w '^t6br2'; if [ $? -ne 0 ] ; then ip netns exec \"t6ns2\" brctl addbr \"t6br2\" ; fi\nip netns exec \"t6ns2\" ip link set dev \"t6br2\" up\n", "delta": "0:00:00.130775", "end": "2019-12-05 08:05:15.728585", "item": {"bridge_name": "t6br2", "default_route_ip": "10.2.52.1", "dns": [{"brif": "t6s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t6s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t6ns2", "route": [{"if": "p1", "ip": "10.2.52.1/24", "ns_if": "t6if", "ns_name": "t6"}], "subnet_ip": "2.2.2.0/24", "tenant_ns": [{"tenant_ns_if": "t6ns2if", "tenant_ns_ip": "10.2.52.1/24", "tenant_ns_name": "t6", "tenant_sub_if": "t6s2if", "tenant_sub_ip": "10.2.52.2/24"}], "vms": [{"brif": "t6br2if1", "disk": "10G", "mem": 3, "name": "t6_VM3", "vcpu": 2, "vmif": "t6VM3if1"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, "rc": 0, "start": "2019-12-05 08:05:15.597810", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Create DNS VETH Pair] ******************************************************************************************
failed: [99.99.99.2] (item=[{u'route': [{u'ip': u'10.2.51.1/24', u'ns_name': u't6', u'ns_if': u't6if', u'if': u'p1'}], u'default_route_ip': u'10.2.51.1', u'bridge_name': u't6br1', u'ns_name': u't6ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.51.2/24', u'tenant_ns_ip': u'10.2.51.1/24', u'tenant_ns_if': u't6ns1if', u'tenant_sub_if': u't6s1if', u'tenant_ns_name': u't6'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't6_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't6br1if1', u'vmif': u't6VM4if1'}], u'vxlan': [{u'local_ip': u'10.2.51.2', u'dsport': 4789, u'dev': u't6s1if', u'tenant_route_ip': u'192.168.134.2', u'remote_route': u'10.1.51.0/24', u'subnet_route': u'10.2.51.0/24', u'v_name': u'vxlan_t6s1', u'id': 42, u'remote_ip': u'10.1.51.2'}]}, {u'dnsif': [], u'dhcp_start': [], u'dhcp_end': [], u'dnsif_ip': [], u'net_mask': [], u'brif': []}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t6ns1\" ip link show \"[]\" ; if [ $? -ne 0 ] ; then ip netns exec \"t6ns1\" ip link add \"[]\" type veth peer name \"[]\" ; fi\nip netns exec \"t6ns1\" ip link set dev \"[]\" up\nip netns exec \"t6ns1\" ip link set dev \"[]\" up\n", "delta": "0:00:00.181817", "end": "2019-12-05 08:05:16.320397", "item": [{"bridge_name": "t6br1", "default_route_ip": "10.2.51.1", "ns_name": "t6ns1", "route": [{"if": "p1", "ip": "10.2.51.1/24", "ns_if": "t6if", "ns_name": "t6"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t6ns1if", "tenant_ns_ip": "10.2.51.1/24", "tenant_ns_name": "t6", "tenant_sub_if": "t6s1if", "tenant_sub_ip": "10.2.51.2/24"}], "vms": [{"brif": "t6br1if1", "disk": "10G", "mem": 2, "name": "t6_VM4", "vcpu": 4, "vmif": "t6VM4if1"}], "vxlan": [{"dev": "t6s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.51.2", "remote_ip": "10.1.51.2", "remote_route": "10.1.51.0/24", "subnet_route": "10.2.51.0/24", "tenant_route_ip": "192.168.134.2", "v_name": "vxlan_t6s1"}]}, {"brif": [], "dhcp_end": [], "dhcp_start": [], "dnsif": [], "dnsif_ip": [], "net_mask": []}], "msg": "non-zero return code", "rc": 1, "start": "2019-12-05 08:05:16.138580", "stderr": "Device \"[]\" does not exist.\nRTNETLINK answers: File exists\nCannot find device \"[]\"\nCannot find device \"[]\"", "stderr_lines": ["Device \"[]\" does not exist.", "RTNETLINK answers: File exists", "Cannot find device \"[]\"", "Cannot find device \"[]\""], "stdout": "", "stdout_lines": []}
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.52.1/24', u'ns_name': u't6', u'ns_if': u't6if', u'if': u'p1'}], u'default_route_ip': u'10.2.52.1', u'bridge_name': u't6br2', u'ns_name': u't6ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.52.2/24', u'tenant_ns_ip': u'10.2.52.1/24', u'tenant_ns_if': u't6ns2if', u'tenant_sub_if': u't6s2if', u'tenant_ns_name': u't6'}], u'subnet_ip': u'2.2.2.0/24', u'vms': [{u'mem': 3, u'name': u't6_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't6br2if1', u'vmif': u't6VM3if1'}], u'vxlan': [{u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}, {u'dnsif': u't6s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't6s2_dnsbrif'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t6ns2\" ip link show \"t6s2_dnsbrif\" ; if [ $? -ne 0 ] ; then ip netns exec \"t6ns2\" ip link add \"t6s2_dnsbrif\" type veth peer name \"t6s2_dnsif\" ; fi\nip netns exec \"t6ns2\" ip link set dev \"t6s2_dnsbrif\" up\nip netns exec \"t6ns2\" ip link set dev \"t6s2_dnsif\" up\n", "delta": "0:00:00.191331", "end": "2019-12-05 08:05:16.868621", "item": [{"bridge_name": "t6br2", "default_route_ip": "10.2.52.1", "ns_name": "t6ns2", "route": [{"if": "p1", "ip": "10.2.52.1/24", "ns_if": "t6if", "ns_name": "t6"}], "subnet_ip": "2.2.2.0/24", "tenant_ns": [{"tenant_ns_if": "t6ns2if", "tenant_ns_ip": "10.2.52.1/24", "tenant_ns_name": "t6", "tenant_sub_if": "t6s2if", "tenant_sub_ip": "10.2.52.2/24"}], "vms": [{"brif": "t6br2if1", "disk": "10G", "mem": 3, "name": "t6_VM3", "vcpu": 2, "vmif": "t6VM3if1"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, {"brif": "t6s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t6s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "rc": 0, "start": "2019-12-05 08:05:16.677290", "stderr": "Device \"t6s2_dnsbrif\" does not exist.", "stderr_lines": ["Device \"t6s2_dnsbrif\" does not exist."], "stdout": "", "stdout_lines": []}

PLAY RECAP ***********************************************************************************************************
99.99.99.2                 : ok=12   changed=12   unreachable=0    failed=1    skipped=0    rescued=0    ignored=0   

INFO:root: 08:06:08.403084 Printing the yaml input file
INFO:root: 08:06:08.403255 {'C1': [{'subnet_addr': '1.1.1.0/24', 'VM': [{'name': 'VM1', 'disk': '10G', 'mem': 2, 'vcpu': 4, 'internet_access': True}, {'name': 'VM2', 'disk': '10G', 'mem': 4, 'vcpu': 2, 'internet_access': False}]}], 'C2': [{'subnet_addr': '1.1.1.0/24', 'VM': [{'name': 'VM4', 'disk': '10G', 'mem': 2, 'vcpu': 4, 'internet_access': True}]}, {'subnet_addr': '2.2.2.0/24', 'VM': [{'name': 'VM3', 'disk': '10G', 'mem': 3, 'vcpu': 2, 'internet_access': True}]}], 'MISC': [{'LOG_ENABLE': True}, {'GUI': True}]}
INFO:root: 08:06:08.403539 Provided subnet in C1: 1.1.1.0/24 is valid
INFO:root: 08:06:08.403607 Provided subnet in C2: 1.1.1.0/24 is valid
INFO:root: 08:06:08.403655 Provided subnet in C2: 2.2.2.0/24 is valid
Using /etc/ansible/ansible.cfg as config file

PLAY [main] **********************************************************************************************************

TASK [Create Tenant Namespace] ***************************************************************************************
changed: [localhost] => (item={u'default_route_ip': u'192.168.7.1', u'name': u't7', u'pns_ip': u'192.168.7.1/24', u'tenant_if': u't7if', u'tenant_ip': u'192.168.7.2/24', u'pns_if': u't7pns_if'}) => {"ansible_loop_var": "item", "changed": true, "cmd": ["ip", "netns", "add", "t7"], "delta": "0:00:00.061457", "end": "2019-12-05 08:06:09.682272", "item": {"default_route_ip": "192.168.7.1", "name": "t7", "pns_if": "t7pns_if", "pns_ip": "192.168.7.1/24", "tenant_if": "t7if", "tenant_ip": "192.168.7.2/24"}, "rc": 0, "start": "2019-12-05 08:06:09.620815", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Create Subnet Namespace] ***************************************************************************************
changed: [localhost] => (item={u'route': [{u'ip': u'10.1.61.1/24', u'ns_name': u't7', u'ns_if': u't7if', u'if': u'p1'}], u'default_route_ip': u'10.1.61.1', u'bridge_name': u't7br1', u'dns': [{u'dnsif': u't7s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't7s1_dnsbrif'}], u'ns_name': u't7ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.61.2/24', u'tenant_ns_ip': u'10.1.61.1/24', u'tenant_ns_if': u't7ns1if', u'tenant_ns_name': u't7', u'tenant_sub_if': u't7s1if'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't7_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't7br1if1', u'vmif': u't7VM1if1'}, {u'mem': 4, u'name': u't7_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't7br1if2', u'vmif': u't7VM2if1'}], u'vxlan': [{u'local_ip': u'10.1.61.2', u'tenant_route_ip': u'192.168.7.2', u'dsport': 4789, u'dev': u't7s1if', u'subnet_route': u'10.1.61.0/24', u'remote_route': u'10.2.61.0/24', u'v_name': u'vxlan_t7s1', u'id': 42, u'remote_ip': u'10.2.61.2'}]}) => {"ansible_loop_var": "item", "changed": true, "cmd": ["ip", "netns", "add", "t7ns1"], "delta": "0:00:00.058881", "end": "2019-12-05 08:06:09.997869", "item": {"bridge_name": "t7br1", "default_route_ip": "10.1.61.1", "dns": [{"brif": "t7s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.5", "dnsif": "t7s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t7ns1", "route": [{"if": "p1", "ip": "10.1.61.1/24", "ns_if": "t7if", "ns_name": "t7"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t7ns1if", "tenant_ns_ip": "10.1.61.1/24", "tenant_ns_name": "t7", "tenant_sub_if": "t7s1if", "tenant_sub_ip": "10.1.61.2/24"}], "vms": [{"brif": "t7br1if1", "disk": "10G", "mem": 2, "name": "t7_VM1", "vcpu": 4, "vmif": "t7VM1if1"}, {"brif": "t7br1if2", "disk": "10G", "mem": 4, "name": "t7_VM2", "vcpu": 2, "vmif": "t7VM2if1"}], "vxlan": [{"dev": "t7s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.61.2", "remote_ip": "10.2.61.2", "remote_route": "10.2.61.0/24", "subnet_route": "10.1.61.0/24", "tenant_route_ip": "192.168.7.2", "v_name": "vxlan_t7s1"}]}, "rc": 0, "start": "2019-12-05 08:06:09.938988", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Create Tenant VETH pairs] **************************************************************************************
changed: [localhost] => (item={u'default_route_ip': u'192.168.7.1', u'name': u't7', u'pns_ip': u'192.168.7.1/24', u'tenant_if': u't7if', u'tenant_ip': u'192.168.7.2/24', u'pns_if': u't7pns_if'}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip link show \"t7if\" ; if [ $? -ne 0 ] ; then ip link add \"t7if\" type veth peer name \"t7pns_if\" ; fi\n", "delta": "0:00:00.012428", "end": "2019-12-05 08:06:10.278282", "item": {"default_route_ip": "192.168.7.1", "name": "t7", "pns_if": "t7pns_if", "pns_ip": "192.168.7.1/24", "tenant_if": "t7if", "tenant_ip": "192.168.7.2/24"}, "rc": 0, "start": "2019-12-05 08:06:10.265854", "stderr": "Device \"t7if\" does not exist.", "stderr_lines": ["Device \"t7if\" does not exist."], "stdout": "", "stdout_lines": []}

TASK [Attach Tenant VETH Pairs] **************************************************************************************
changed: [localhost] => (item={u'default_route_ip': u'192.168.7.1', u'name': u't7', u'pns_ip': u'192.168.7.1/24', u'tenant_if': u't7if', u'tenant_ip': u'192.168.7.2/24', u'pns_if': u't7pns_if'}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec pns ip link show \"t7pns_if\" ; if [ $? -ne 0 ] ; then ip link set \"t7pns_if\" netns pns ; fi\nip netns exec \"t7\" ip link show \"t7if\" ; if [ $? -ne 0 ] ; then ip link set \"t7if\" netns \"t7\" ; fi\nip netns exec pns ip link set dev \"t7pns_if\" up\nip netns exec \"t7\" ip link set dev \"t7if\" up\n", "delta": "0:00:00.190276", "end": "2019-12-05 08:06:10.757240", "item": {"default_route_ip": "192.168.7.1", "name": "t7", "pns_if": "t7pns_if", "pns_ip": "192.168.7.1/24", "tenant_if": "t7if", "tenant_ip": "192.168.7.2/24"}, "rc": 0, "start": "2019-12-05 08:06:10.566964", "stderr": "Device \"t7pns_if\" does not exist.\nDevice \"t7if\" does not exist.", "stderr_lines": ["Device \"t7pns_if\" does not exist.", "Device \"t7if\" does not exist."], "stdout": "", "stdout_lines": []}

TASK [Add IP addresses to Tenant VETH Pairs] *************************************************************************
changed: [localhost] => (item={u'default_route_ip': u'192.168.7.1', u'name': u't7', u'pns_ip': u'192.168.7.1/24', u'tenant_if': u't7if', u'tenant_ip': u'192.168.7.2/24', u'pns_if': u't7pns_if'}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec pns ip addr show \"t7pns_if\" | awk 'FNR==3{ print $2 }' | grep -w '^192.168.7.1/24' ; if [ $? -ne 0 ] ; then ip netns exec pns ip addr add \"192.168.7.1/24\" dev \"t7pns_if\" ; fi\nip netns exec \"t7\" ip addr show \"t7if\" | awk 'FNR==3{ print $2 }' | grep -w '^192.168.7.2/24' ; if [ $? -ne 0 ] ; then ip netns exec \"t7\" ip addr add \"192.168.7.2/24\" dev \"t7if\" ; fi\n", "delta": "0:00:00.160655", "end": "2019-12-05 08:06:11.205091", "item": {"default_route_ip": "192.168.7.1", "name": "t7", "pns_if": "t7pns_if", "pns_ip": "192.168.7.1/24", "tenant_if": "t7if", "tenant_ip": "192.168.7.2/24"}, "rc": 0, "start": "2019-12-05 08:06:11.044436", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Create Namespace VETH Pairs] ***********************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.61.1/24', u'ns_name': u't7', u'ns_if': u't7if', u'if': u'p1'}], u'default_route_ip': u'10.1.61.1', u'bridge_name': u't7br1', u'dns': [{u'dnsif': u't7s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't7s1_dnsbrif'}], u'ns_name': u't7ns1', u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't7_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't7br1if1', u'vmif': u't7VM1if1'}, {u'mem': 4, u'name': u't7_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't7br1if2', u'vmif': u't7VM2if1'}], u'vxlan': [{u'local_ip': u'10.1.61.2', u'dsport': 4789, u'dev': u't7s1if', u'tenant_route_ip': u'192.168.7.2', u'remote_route': u'10.2.61.0/24', u'subnet_route': u'10.1.61.0/24', u'v_name': u'vxlan_t7s1', u'id': 42, u'remote_ip': u'10.2.61.2'}]}, {u'tenant_sub_ip': u'10.1.61.2/24', u'tenant_ns_ip': u'10.1.61.1/24', u'tenant_ns_if': u't7ns1if', u'tenant_sub_if': u't7s1if', u'tenant_ns_name': u't7'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip link show \"t7ns1if\" ; if [ $? -ne 0 ] ; then ip link add \"t7ns1if\" type veth peer name \"t7s1if\" ; fi\n", "delta": "0:00:00.015211", "end": "2019-12-05 08:06:11.491049", "item": [{"bridge_name": "t7br1", "default_route_ip": "10.1.61.1", "dns": [{"brif": "t7s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.5", "dnsif": "t7s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t7ns1", "route": [{"if": "p1", "ip": "10.1.61.1/24", "ns_if": "t7if", "ns_name": "t7"}], "subnet_ip": "1.1.1.0/24", "vms": [{"brif": "t7br1if1", "disk": "10G", "mem": 2, "name": "t7_VM1", "vcpu": 4, "vmif": "t7VM1if1"}, {"brif": "t7br1if2", "disk": "10G", "mem": 4, "name": "t7_VM2", "vcpu": 2, "vmif": "t7VM2if1"}], "vxlan": [{"dev": "t7s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.61.2", "remote_ip": "10.2.61.2", "remote_route": "10.2.61.0/24", "subnet_route": "10.1.61.0/24", "tenant_route_ip": "192.168.7.2", "v_name": "vxlan_t7s1"}]}, {"tenant_ns_if": "t7ns1if", "tenant_ns_ip": "10.1.61.1/24", "tenant_ns_name": "t7", "tenant_sub_if": "t7s1if", "tenant_sub_ip": "10.1.61.2/24"}], "rc": 0, "start": "2019-12-05 08:06:11.475838", "stderr": "Device \"t7ns1if\" does not exist.", "stderr_lines": ["Device \"t7ns1if\" does not exist."], "stdout": "", "stdout_lines": []}

TASK [Attach Namespace VETH Pairs] ***********************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.61.1/24', u'ns_name': u't7', u'ns_if': u't7if', u'if': u'p1'}], u'default_route_ip': u'10.1.61.1', u'bridge_name': u't7br1', u'dns': [{u'dnsif': u't7s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't7s1_dnsbrif'}], u'ns_name': u't7ns1', u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't7_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't7br1if1', u'vmif': u't7VM1if1'}, {u'mem': 4, u'name': u't7_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't7br1if2', u'vmif': u't7VM2if1'}], u'vxlan': [{u'local_ip': u'10.1.61.2', u'dsport': 4789, u'dev': u't7s1if', u'tenant_route_ip': u'192.168.7.2', u'remote_route': u'10.2.61.0/24', u'subnet_route': u'10.1.61.0/24', u'v_name': u'vxlan_t7s1', u'id': 42, u'remote_ip': u'10.2.61.2'}]}, {u'tenant_sub_ip': u'10.1.61.2/24', u'tenant_ns_ip': u'10.1.61.1/24', u'tenant_ns_if': u't7ns1if', u'tenant_sub_if': u't7s1if', u'tenant_ns_name': u't7'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t7\" ip link show \"t7ns1if\" ; if [ $? -ne 0 ] ; then ip link set \"t7ns1if\" netns \"t7\" ; fi\nip netns exec \"t7ns1\" ip link show \"t7s1if\" ; if [ $? -ne 0 ] ; then ip link set \"t7s1if\" netns \"t7ns1\" ; fi\n", "delta": "0:00:00.132647", "end": "2019-12-05 08:06:11.906757", "item": [{"bridge_name": "t7br1", "default_route_ip": "10.1.61.1", "dns": [{"brif": "t7s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.5", "dnsif": "t7s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t7ns1", "route": [{"if": "p1", "ip": "10.1.61.1/24", "ns_if": "t7if", "ns_name": "t7"}], "subnet_ip": "1.1.1.0/24", "vms": [{"brif": "t7br1if1", "disk": "10G", "mem": 2, "name": "t7_VM1", "vcpu": 4, "vmif": "t7VM1if1"}, {"brif": "t7br1if2", "disk": "10G", "mem": 4, "name": "t7_VM2", "vcpu": 2, "vmif": "t7VM2if1"}], "vxlan": [{"dev": "t7s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.61.2", "remote_ip": "10.2.61.2", "remote_route": "10.2.61.0/24", "subnet_route": "10.1.61.0/24", "tenant_route_ip": "192.168.7.2", "v_name": "vxlan_t7s1"}]}, {"tenant_ns_if": "t7ns1if", "tenant_ns_ip": "10.1.61.1/24", "tenant_ns_name": "t7", "tenant_sub_if": "t7s1if", "tenant_sub_ip": "10.1.61.2/24"}], "rc": 0, "start": "2019-12-05 08:06:11.774110", "stderr": "Device \"t7ns1if\" does not exist.\nDevice \"t7s1if\" does not exist.", "stderr_lines": ["Device \"t7ns1if\" does not exist.", "Device \"t7s1if\" does not exist."], "stdout": "", "stdout_lines": []}

TASK [Set Namespace VETH Pairs UP] ***********************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.61.1/24', u'ns_name': u't7', u'ns_if': u't7if', u'if': u'p1'}], u'default_route_ip': u'10.1.61.1', u'bridge_name': u't7br1', u'dns': [{u'dnsif': u't7s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't7s1_dnsbrif'}], u'ns_name': u't7ns1', u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't7_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't7br1if1', u'vmif': u't7VM1if1'}, {u'mem': 4, u'name': u't7_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't7br1if2', u'vmif': u't7VM2if1'}], u'vxlan': [{u'local_ip': u'10.1.61.2', u'dsport': 4789, u'dev': u't7s1if', u'tenant_route_ip': u'192.168.7.2', u'remote_route': u'10.2.61.0/24', u'subnet_route': u'10.1.61.0/24', u'v_name': u'vxlan_t7s1', u'id': 42, u'remote_ip': u'10.2.61.2'}]}, {u'tenant_sub_ip': u'10.1.61.2/24', u'tenant_ns_ip': u'10.1.61.1/24', u'tenant_ns_if': u't7ns1if', u'tenant_sub_if': u't7s1if', u'tenant_ns_name': u't7'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t7\" ip link set dev \"t7ns1if\" up\nip netns exec \"t7ns1\" ip link set dev \"t7s1if\" up\n", "delta": "0:00:00.068748", "end": "2019-12-05 08:06:12.293614", "item": [{"bridge_name": "t7br1", "default_route_ip": "10.1.61.1", "dns": [{"brif": "t7s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.5", "dnsif": "t7s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t7ns1", "route": [{"if": "p1", "ip": "10.1.61.1/24", "ns_if": "t7if", "ns_name": "t7"}], "subnet_ip": "1.1.1.0/24", "vms": [{"brif": "t7br1if1", "disk": "10G", "mem": 2, "name": "t7_VM1", "vcpu": 4, "vmif": "t7VM1if1"}, {"brif": "t7br1if2", "disk": "10G", "mem": 4, "name": "t7_VM2", "vcpu": 2, "vmif": "t7VM2if1"}], "vxlan": [{"dev": "t7s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.61.2", "remote_ip": "10.2.61.2", "remote_route": "10.2.61.0/24", "subnet_route": "10.1.61.0/24", "tenant_route_ip": "192.168.7.2", "v_name": "vxlan_t7s1"}]}, {"tenant_ns_if": "t7ns1if", "tenant_ns_ip": "10.1.61.1/24", "tenant_ns_name": "t7", "tenant_sub_if": "t7s1if", "tenant_sub_ip": "10.1.61.2/24"}], "rc": 0, "start": "2019-12-05 08:06:12.224866", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Add IP addresses to Namespace VETH Pairs] **********************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.61.1/24', u'ns_name': u't7', u'ns_if': u't7if', u'if': u'p1'}], u'default_route_ip': u'10.1.61.1', u'bridge_name': u't7br1', u'dns': [{u'dnsif': u't7s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't7s1_dnsbrif'}], u'ns_name': u't7ns1', u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't7_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't7br1if1', u'vmif': u't7VM1if1'}, {u'mem': 4, u'name': u't7_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't7br1if2', u'vmif': u't7VM2if1'}], u'vxlan': [{u'local_ip': u'10.1.61.2', u'dsport': 4789, u'dev': u't7s1if', u'tenant_route_ip': u'192.168.7.2', u'remote_route': u'10.2.61.0/24', u'subnet_route': u'10.1.61.0/24', u'v_name': u'vxlan_t7s1', u'id': 42, u'remote_ip': u'10.2.61.2'}]}, {u'tenant_sub_ip': u'10.1.61.2/24', u'tenant_ns_ip': u'10.1.61.1/24', u'tenant_ns_if': u't7ns1if', u'tenant_sub_if': u't7s1if', u'tenant_ns_name': u't7'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t7ns1\" ip addr show \"t7s1if\" | awk 'FNR==3{ print $2 }' | grep -w '^10.1.61.2/24' ; if [ $? -ne 0 ] ; then ip netns exec \"t7ns1\" ip addr add \"10.1.61.2/24\" dev \"t7s1if\" ; fi\n\nip netns exec \"t7\" ip addr show \"t7ns1if\" | awk 'FNR==3{ print $2 }' | grep -w '^10.1.61.1/24' ; if [ $? -ne 0 ] ; then ip netns exec \"t7\" ip addr add \"10.1.61.1/24\" dev \"t7ns1if\" ; fi\n", "delta": "0:00:00.146558", "end": "2019-12-05 08:06:12.733377", "item": [{"bridge_name": "t7br1", "default_route_ip": "10.1.61.1", "dns": [{"brif": "t7s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.5", "dnsif": "t7s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t7ns1", "route": [{"if": "p1", "ip": "10.1.61.1/24", "ns_if": "t7if", "ns_name": "t7"}], "subnet_ip": "1.1.1.0/24", "vms": [{"brif": "t7br1if1", "disk": "10G", "mem": 2, "name": "t7_VM1", "vcpu": 4, "vmif": "t7VM1if1"}, {"brif": "t7br1if2", "disk": "10G", "mem": 4, "name": "t7_VM2", "vcpu": 2, "vmif": "t7VM2if1"}], "vxlan": [{"dev": "t7s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.61.2", "remote_ip": "10.2.61.2", "remote_route": "10.2.61.0/24", "subnet_route": "10.1.61.0/24", "tenant_route_ip": "192.168.7.2", "v_name": "vxlan_t7s1"}]}, {"tenant_ns_if": "t7ns1if", "tenant_ns_ip": "10.1.61.1/24", "tenant_ns_name": "t7", "tenant_sub_if": "t7s1if", "tenant_sub_ip": "10.1.61.2/24"}], "rc": 0, "start": "2019-12-05 08:06:12.586819", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Add IP Route to Tenant] ****************************************************************************************
changed: [localhost] => (item={u'default_route_ip': u'192.168.7.1', u'name': u't7', u'pns_ip': u'192.168.7.1/24', u'tenant_if': u't7if', u'tenant_ip': u'192.168.7.2/24', u'pns_if': u't7pns_if'}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t7\" ip route show default | grep -w '[d]efault via 192.168.7.1' ; if [ $? -ne 0 ] ; then ip netns exec \"t7\" ip route add default via \"192.168.7.1\" ; fi\n", "delta": "0:00:00.070983", "end": "2019-12-05 08:06:13.089125", "item": {"default_route_ip": "192.168.7.1", "name": "t7", "pns_if": "t7pns_if", "pns_ip": "192.168.7.1/24", "tenant_if": "t7if", "tenant_ip": "192.168.7.2/24"}, "rc": 0, "start": "2019-12-05 08:06:13.018142", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Add IP Route to Tenant Subnet] *********************************************************************************
changed: [localhost] => (item={u'route': [{u'ip': u'10.1.61.1/24', u'ns_name': u't7', u'ns_if': u't7if', u'if': u'p1'}], u'default_route_ip': u'10.1.61.1', u'bridge_name': u't7br1', u'dns': [{u'dnsif': u't7s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't7s1_dnsbrif'}], u'ns_name': u't7ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.61.2/24', u'tenant_ns_ip': u'10.1.61.1/24', u'tenant_ns_if': u't7ns1if', u'tenant_ns_name': u't7', u'tenant_sub_if': u't7s1if'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't7_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't7br1if1', u'vmif': u't7VM1if1'}, {u'mem': 4, u'name': u't7_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't7br1if2', u'vmif': u't7VM2if1'}], u'vxlan': [{u'local_ip': u'10.1.61.2', u'tenant_route_ip': u'192.168.7.2', u'dsport': 4789, u'dev': u't7s1if', u'subnet_route': u'10.1.61.0/24', u'remote_route': u'10.2.61.0/24', u'v_name': u'vxlan_t7s1', u'id': 42, u'remote_ip': u'10.2.61.2'}]}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t7ns1\" ip route show default | grep -w '[d]efault via 10.1.61.1' ; if [ $? -ne 0 ] ; then ip netns exec \"t7ns1\" ip route add default via \"10.1.61.1\" ; fi\n", "delta": "0:00:00.093330", "end": "2019-12-05 08:06:13.465493", "item": {"bridge_name": "t7br1", "default_route_ip": "10.1.61.1", "dns": [{"brif": "t7s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.5", "dnsif": "t7s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t7ns1", "route": [{"if": "p1", "ip": "10.1.61.1/24", "ns_if": "t7if", "ns_name": "t7"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t7ns1if", "tenant_ns_ip": "10.1.61.1/24", "tenant_ns_name": "t7", "tenant_sub_if": "t7s1if", "tenant_sub_ip": "10.1.61.2/24"}], "vms": [{"brif": "t7br1if1", "disk": "10G", "mem": 2, "name": "t7_VM1", "vcpu": 4, "vmif": "t7VM1if1"}, {"brif": "t7br1if2", "disk": "10G", "mem": 4, "name": "t7_VM2", "vcpu": 2, "vmif": "t7VM2if1"}], "vxlan": [{"dev": "t7s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.61.2", "remote_ip": "10.2.61.2", "remote_route": "10.2.61.0/24", "subnet_route": "10.1.61.0/24", "tenant_route_ip": "192.168.7.2", "v_name": "vxlan_t7s1"}]}, "rc": 0, "start": "2019-12-05 08:06:13.372163", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Create bridge inside namespace] ********************************************************************************
changed: [localhost] => (item={u'route': [{u'ip': u'10.1.61.1/24', u'ns_name': u't7', u'ns_if': u't7if', u'if': u'p1'}], u'default_route_ip': u'10.1.61.1', u'bridge_name': u't7br1', u'dns': [{u'dnsif': u't7s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't7s1_dnsbrif'}], u'ns_name': u't7ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.61.2/24', u'tenant_ns_ip': u'10.1.61.1/24', u'tenant_ns_if': u't7ns1if', u'tenant_ns_name': u't7', u'tenant_sub_if': u't7s1if'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't7_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't7br1if1', u'vmif': u't7VM1if1'}, {u'mem': 4, u'name': u't7_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't7br1if2', u'vmif': u't7VM2if1'}], u'vxlan': [{u'local_ip': u'10.1.61.2', u'tenant_route_ip': u'192.168.7.2', u'dsport': 4789, u'dev': u't7s1if', u'subnet_route': u'10.1.61.0/24', u'remote_route': u'10.2.61.0/24', u'v_name': u'vxlan_t7s1', u'id': 42, u'remote_ip': u'10.2.61.2'}]}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t7ns1\" brctl show | grep -w '^t7br1'; if [ $? -ne 0 ] ; then ip netns exec \"t7ns1\" brctl addbr \"t7br1\" ; fi\nip netns exec \"t7ns1\" ip link set dev \"t7br1\" up\n", "delta": "0:00:00.102759", "end": "2019-12-05 08:06:13.889269", "item": {"bridge_name": "t7br1", "default_route_ip": "10.1.61.1", "dns": [{"brif": "t7s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.5", "dnsif": "t7s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t7ns1", "route": [{"if": "p1", "ip": "10.1.61.1/24", "ns_if": "t7if", "ns_name": "t7"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t7ns1if", "tenant_ns_ip": "10.1.61.1/24", "tenant_ns_name": "t7", "tenant_sub_if": "t7s1if", "tenant_sub_ip": "10.1.61.2/24"}], "vms": [{"brif": "t7br1if1", "disk": "10G", "mem": 2, "name": "t7_VM1", "vcpu": 4, "vmif": "t7VM1if1"}, {"brif": "t7br1if2", "disk": "10G", "mem": 4, "name": "t7_VM2", "vcpu": 2, "vmif": "t7VM2if1"}], "vxlan": [{"dev": "t7s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.61.2", "remote_ip": "10.2.61.2", "remote_route": "10.2.61.0/24", "subnet_route": "10.1.61.0/24", "tenant_route_ip": "192.168.7.2", "v_name": "vxlan_t7s1"}]}, "rc": 0, "start": "2019-12-05 08:06:13.786510", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Create DNS VETH Pair] ******************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.61.1/24', u'ns_name': u't7', u'ns_if': u't7if', u'if': u'p1'}], u'default_route_ip': u'10.1.61.1', u'bridge_name': u't7br1', u'ns_name': u't7ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.61.2/24', u'tenant_ns_ip': u'10.1.61.1/24', u'tenant_ns_if': u't7ns1if', u'tenant_sub_if': u't7s1if', u'tenant_ns_name': u't7'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't7_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't7br1if1', u'vmif': u't7VM1if1'}, {u'mem': 4, u'name': u't7_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't7br1if2', u'vmif': u't7VM2if1'}], u'vxlan': [{u'local_ip': u'10.1.61.2', u'dsport': 4789, u'dev': u't7s1if', u'tenant_route_ip': u'192.168.7.2', u'remote_route': u'10.2.61.0/24', u'subnet_route': u'10.1.61.0/24', u'v_name': u'vxlan_t7s1', u'id': 42, u'remote_ip': u'10.2.61.2'}]}, {u'dnsif': u't7s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't7s1_dnsbrif'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t7ns1\" ip link show \"t7s1_dnsbrif\" ; if [ $? -ne 0 ] ; then ip netns exec \"t7ns1\" ip link add \"t7s1_dnsbrif\" type veth peer name \"t7s1_dnsif\" ; fi\nip netns exec \"t7ns1\" ip link set dev \"t7s1_dnsbrif\" up\nip netns exec \"t7ns1\" ip link set dev \"t7s1_dnsif\" up\n", "delta": "0:00:00.154310", "end": "2019-12-05 08:06:14.373484", "item": [{"bridge_name": "t7br1", "default_route_ip": "10.1.61.1", "ns_name": "t7ns1", "route": [{"if": "p1", "ip": "10.1.61.1/24", "ns_if": "t7if", "ns_name": "t7"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t7ns1if", "tenant_ns_ip": "10.1.61.1/24", "tenant_ns_name": "t7", "tenant_sub_if": "t7s1if", "tenant_sub_ip": "10.1.61.2/24"}], "vms": [{"brif": "t7br1if1", "disk": "10G", "mem": 2, "name": "t7_VM1", "vcpu": 4, "vmif": "t7VM1if1"}, {"brif": "t7br1if2", "disk": "10G", "mem": 4, "name": "t7_VM2", "vcpu": 2, "vmif": "t7VM2if1"}], "vxlan": [{"dev": "t7s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.61.2", "remote_ip": "10.2.61.2", "remote_route": "10.2.61.0/24", "subnet_route": "10.1.61.0/24", "tenant_route_ip": "192.168.7.2", "v_name": "vxlan_t7s1"}]}, {"brif": "t7s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.5", "dnsif": "t7s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "rc": 0, "start": "2019-12-05 08:06:14.219174", "stderr": "Device \"t7s1_dnsbrif\" does not exist.", "stderr_lines": ["Device \"t7s1_dnsbrif\" does not exist."], "stdout": "", "stdout_lines": []}

TASK [Attach DNS VETH Pair] ******************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.61.1/24', u'ns_name': u't7', u'ns_if': u't7if', u'if': u'p1'}], u'default_route_ip': u'10.1.61.1', u'bridge_name': u't7br1', u'ns_name': u't7ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.61.2/24', u'tenant_ns_ip': u'10.1.61.1/24', u'tenant_ns_if': u't7ns1if', u'tenant_sub_if': u't7s1if', u'tenant_ns_name': u't7'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't7_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't7br1if1', u'vmif': u't7VM1if1'}, {u'mem': 4, u'name': u't7_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't7br1if2', u'vmif': u't7VM2if1'}], u'vxlan': [{u'local_ip': u'10.1.61.2', u'dsport': 4789, u'dev': u't7s1if', u'tenant_route_ip': u'192.168.7.2', u'remote_route': u'10.2.61.0/24', u'subnet_route': u'10.1.61.0/24', u'v_name': u'vxlan_t7s1', u'id': 42, u'remote_ip': u'10.2.61.2'}]}, {u'dnsif': u't7s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't7s1_dnsbrif'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t7ns1\" brctl show \"t7br1\" | grep -w 't7s1_dnsbrif' ; if [ $? -ne 0 ] ; then ip netns exec \"t7ns1\" brctl addif \"t7br1\" \"t7s1_dnsbrif\" ; fi\n", "delta": "0:00:00.072092", "end": "2019-12-05 08:06:14.773574", "item": [{"bridge_name": "t7br1", "default_route_ip": "10.1.61.1", "ns_name": "t7ns1", "route": [{"if": "p1", "ip": "10.1.61.1/24", "ns_if": "t7if", "ns_name": "t7"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t7ns1if", "tenant_ns_ip": "10.1.61.1/24", "tenant_ns_name": "t7", "tenant_sub_if": "t7s1if", "tenant_sub_ip": "10.1.61.2/24"}], "vms": [{"brif": "t7br1if1", "disk": "10G", "mem": 2, "name": "t7_VM1", "vcpu": 4, "vmif": "t7VM1if1"}, {"brif": "t7br1if2", "disk": "10G", "mem": 4, "name": "t7_VM2", "vcpu": 2, "vmif": "t7VM2if1"}], "vxlan": [{"dev": "t7s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.61.2", "remote_ip": "10.2.61.2", "remote_route": "10.2.61.0/24", "subnet_route": "10.1.61.0/24", "tenant_route_ip": "192.168.7.2", "v_name": "vxlan_t7s1"}]}, {"brif": "t7s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.5", "dnsif": "t7s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "rc": 0, "start": "2019-12-05 08:06:14.701482", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Create VETH Pairs] *********************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.61.1/24', u'ns_name': u't7', u'ns_if': u't7if', u'if': u'p1'}], u'default_route_ip': u'10.1.61.1', u'bridge_name': u't7br1', u'dns': [{u'dnsif': u't7s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't7s1_dnsbrif'}], u'ns_name': u't7ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.61.2/24', u'tenant_ns_ip': u'10.1.61.1/24', u'tenant_ns_if': u't7ns1if', u'tenant_sub_if': u't7s1if', u'tenant_ns_name': u't7'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.1.61.2', u'dsport': 4789, u'dev': u't7s1if', u'tenant_route_ip': u'192.168.7.2', u'remote_route': u'10.2.61.0/24', u'subnet_route': u'10.1.61.0/24', u'v_name': u'vxlan_t7s1', u'id': 42, u'remote_ip': u'10.2.61.2'}]}, {u'mem': 2, u'name': u't7_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't7br1if1', u'vmif': u't7VM1if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip link show \"t7br1if1\" ; if [ $? -ne 0 ] ; then ip link add \"t7VM1if1\" type veth peer name \"t7br1if1\" ; fi\nip link set dev \"t7br1if1\" up\nip link set dev \"t7VM1if1\" up\n", "delta": "0:00:00.016866", "end": "2019-12-05 08:06:15.103713", "item": [{"bridge_name": "t7br1", "default_route_ip": "10.1.61.1", "dns": [{"brif": "t7s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.5", "dnsif": "t7s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t7ns1", "route": [{"if": "p1", "ip": "10.1.61.1/24", "ns_if": "t7if", "ns_name": "t7"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t7ns1if", "tenant_ns_ip": "10.1.61.1/24", "tenant_ns_name": "t7", "tenant_sub_if": "t7s1if", "tenant_sub_ip": "10.1.61.2/24"}], "vxlan": [{"dev": "t7s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.61.2", "remote_ip": "10.2.61.2", "remote_route": "10.2.61.0/24", "subnet_route": "10.1.61.0/24", "tenant_route_ip": "192.168.7.2", "v_name": "vxlan_t7s1"}]}, {"brif": "t7br1if1", "disk": "10G", "mem": 2, "name": "t7_VM1", "vcpu": 4, "vmif": "t7VM1if1"}], "rc": 0, "start": "2019-12-05 08:06:15.086847", "stderr": "Device \"t7br1if1\" does not exist.", "stderr_lines": ["Device \"t7br1if1\" does not exist."], "stdout": "", "stdout_lines": []}
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.61.1/24', u'ns_name': u't7', u'ns_if': u't7if', u'if': u'p1'}], u'default_route_ip': u'10.1.61.1', u'bridge_name': u't7br1', u'dns': [{u'dnsif': u't7s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't7s1_dnsbrif'}], u'ns_name': u't7ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.61.2/24', u'tenant_ns_ip': u'10.1.61.1/24', u'tenant_ns_if': u't7ns1if', u'tenant_sub_if': u't7s1if', u'tenant_ns_name': u't7'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.1.61.2', u'dsport': 4789, u'dev': u't7s1if', u'tenant_route_ip': u'192.168.7.2', u'remote_route': u'10.2.61.0/24', u'subnet_route': u'10.1.61.0/24', u'v_name': u'vxlan_t7s1', u'id': 42, u'remote_ip': u'10.2.61.2'}]}, {u'mem': 4, u'name': u't7_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't7br1if2', u'vmif': u't7VM2if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip link show \"t7br1if2\" ; if [ $? -ne 0 ] ; then ip link add \"t7VM2if1\" type veth peer name \"t7br1if2\" ; fi\nip link set dev \"t7br1if2\" up\nip link set dev \"t7VM2if1\" up\n", "delta": "0:00:00.015043", "end": "2019-12-05 08:06:15.349827", "item": [{"bridge_name": "t7br1", "default_route_ip": "10.1.61.1", "dns": [{"brif": "t7s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.5", "dnsif": "t7s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t7ns1", "route": [{"if": "p1", "ip": "10.1.61.1/24", "ns_if": "t7if", "ns_name": "t7"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t7ns1if", "tenant_ns_ip": "10.1.61.1/24", "tenant_ns_name": "t7", "tenant_sub_if": "t7s1if", "tenant_sub_ip": "10.1.61.2/24"}], "vxlan": [{"dev": "t7s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.61.2", "remote_ip": "10.2.61.2", "remote_route": "10.2.61.0/24", "subnet_route": "10.1.61.0/24", "tenant_route_ip": "192.168.7.2", "v_name": "vxlan_t7s1"}]}, {"brif": "t7br1if2", "disk": "10G", "mem": 4, "name": "t7_VM2", "vcpu": 2, "vmif": "t7VM2if1"}], "rc": 0, "start": "2019-12-05 08:06:15.334784", "stderr": "Device \"t7br1if2\" does not exist.", "stderr_lines": ["Device \"t7br1if2\" does not exist."], "stdout": "", "stdout_lines": []}

TASK [Attach VETH Pairs] *********************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.61.1/24', u'ns_name': u't7', u'ns_if': u't7if', u'if': u'p1'}], u'default_route_ip': u'10.1.61.1', u'bridge_name': u't7br1', u'dns': [{u'dnsif': u't7s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't7s1_dnsbrif'}], u'ns_name': u't7ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.61.2/24', u'tenant_ns_ip': u'10.1.61.1/24', u'tenant_ns_if': u't7ns1if', u'tenant_sub_if': u't7s1if', u'tenant_ns_name': u't7'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.1.61.2', u'dsport': 4789, u'dev': u't7s1if', u'tenant_route_ip': u'192.168.7.2', u'remote_route': u'10.2.61.0/24', u'subnet_route': u'10.1.61.0/24', u'v_name': u'vxlan_t7s1', u'id': 42, u'remote_ip': u'10.2.61.2'}]}, {u'mem': 2, u'name': u't7_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't7br1if1', u'vmif': u't7VM1if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip link show \"t7br1if1\" ; if [ $? -eq 0 ] ; then ip link set \"t7br1if1\" netns \"t7ns1\" ; fi\nip netns exec \"t7ns1\" brctl show \"t7br1\" | grep -w 't7br1if1' ; if [ $? -ne 0 ] ; then ip netns exec \"t7ns1\" brctl addif \"t7br1\" \"t7br1if1\" ; fi\n", "delta": "0:00:00.113748", "end": "2019-12-05 08:06:15.741195", "item": [{"bridge_name": "t7br1", "default_route_ip": "10.1.61.1", "dns": [{"brif": "t7s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.5", "dnsif": "t7s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t7ns1", "route": [{"if": "p1", "ip": "10.1.61.1/24", "ns_if": "t7if", "ns_name": "t7"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t7ns1if", "tenant_ns_ip": "10.1.61.1/24", "tenant_ns_name": "t7", "tenant_sub_if": "t7s1if", "tenant_sub_ip": "10.1.61.2/24"}], "vxlan": [{"dev": "t7s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.61.2", "remote_ip": "10.2.61.2", "remote_route": "10.2.61.0/24", "subnet_route": "10.1.61.0/24", "tenant_route_ip": "192.168.7.2", "v_name": "vxlan_t7s1"}]}, {"brif": "t7br1if1", "disk": "10G", "mem": 2, "name": "t7_VM1", "vcpu": 4, "vmif": "t7VM1if1"}], "rc": 0, "start": "2019-12-05 08:06:15.627447", "stderr": "", "stderr_lines": [], "stdout": "133: t7br1if1@t7VM1if1: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP mode DEFAULT group default qlen 1000\n    link/ether d2:24:21:1d:92:90 brd ff:ff:ff:ff:ff:ff", "stdout_lines": ["133: t7br1if1@t7VM1if1: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP mode DEFAULT group default qlen 1000", "    link/ether d2:24:21:1d:92:90 brd ff:ff:ff:ff:ff:ff"]}
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.61.1/24', u'ns_name': u't7', u'ns_if': u't7if', u'if': u'p1'}], u'default_route_ip': u'10.1.61.1', u'bridge_name': u't7br1', u'dns': [{u'dnsif': u't7s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't7s1_dnsbrif'}], u'ns_name': u't7ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.61.2/24', u'tenant_ns_ip': u'10.1.61.1/24', u'tenant_ns_if': u't7ns1if', u'tenant_sub_if': u't7s1if', u'tenant_ns_name': u't7'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.1.61.2', u'dsport': 4789, u'dev': u't7s1if', u'tenant_route_ip': u'192.168.7.2', u'remote_route': u'10.2.61.0/24', u'subnet_route': u'10.1.61.0/24', u'v_name': u'vxlan_t7s1', u'id': 42, u'remote_ip': u'10.2.61.2'}]}, {u'mem': 4, u'name': u't7_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't7br1if2', u'vmif': u't7VM2if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip link show \"t7br1if2\" ; if [ $? -eq 0 ] ; then ip link set \"t7br1if2\" netns \"t7ns1\" ; fi\nip netns exec \"t7ns1\" brctl show \"t7br1\" | grep -w 't7br1if2' ; if [ $? -ne 0 ] ; then ip netns exec \"t7ns1\" brctl addif \"t7br1\" \"t7br1if2\" ; fi\n", "delta": "0:00:00.098044", "end": "2019-12-05 08:06:16.041196", "item": [{"bridge_name": "t7br1", "default_route_ip": "10.1.61.1", "dns": [{"brif": "t7s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.5", "dnsif": "t7s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t7ns1", "route": [{"if": "p1", "ip": "10.1.61.1/24", "ns_if": "t7if", "ns_name": "t7"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t7ns1if", "tenant_ns_ip": "10.1.61.1/24", "tenant_ns_name": "t7", "tenant_sub_if": "t7s1if", "tenant_sub_ip": "10.1.61.2/24"}], "vxlan": [{"dev": "t7s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.61.2", "remote_ip": "10.2.61.2", "remote_route": "10.2.61.0/24", "subnet_route": "10.1.61.0/24", "tenant_route_ip": "192.168.7.2", "v_name": "vxlan_t7s1"}]}, {"brif": "t7br1if2", "disk": "10G", "mem": 4, "name": "t7_VM2", "vcpu": 2, "vmif": "t7VM2if1"}], "rc": 0, "start": "2019-12-05 08:06:15.943152", "stderr": "", "stderr_lines": [], "stdout": "135: t7br1if2@t7VM2if1: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP mode DEFAULT group default qlen 1000\n    link/ether de:d8:ec:55:35:2e brd ff:ff:ff:ff:ff:ff", "stdout_lines": ["135: t7br1if2@t7VM2if1: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP mode DEFAULT group default qlen 1000", "    link/ether de:d8:ec:55:35:2e brd ff:ff:ff:ff:ff:ff"]}

TASK [All interfaces and bridges UP] *********************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.61.1/24', u'ns_name': u't7', u'ns_if': u't7if', u'if': u'p1'}], u'default_route_ip': u'10.1.61.1', u'bridge_name': u't7br1', u'dns': [{u'dnsif': u't7s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't7s1_dnsbrif'}], u'ns_name': u't7ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.61.2/24', u'tenant_ns_ip': u'10.1.61.1/24', u'tenant_ns_if': u't7ns1if', u'tenant_sub_if': u't7s1if', u'tenant_ns_name': u't7'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.1.61.2', u'dsport': 4789, u'dev': u't7s1if', u'tenant_route_ip': u'192.168.7.2', u'remote_route': u'10.2.61.0/24', u'subnet_route': u'10.1.61.0/24', u'v_name': u'vxlan_t7s1', u'id': 42, u'remote_ip': u'10.2.61.2'}]}, {u'mem': 2, u'name': u't7_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't7br1if1', u'vmif': u't7VM1if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t7ns1\" ip link set \"t7br1if1\" up\nip netns exec \"t7ns1\" ip link set dev \"t7br1\" up\n", "delta": "0:00:00.088722", "end": "2019-12-05 08:06:16.401280", "item": [{"bridge_name": "t7br1", "default_route_ip": "10.1.61.1", "dns": [{"brif": "t7s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.5", "dnsif": "t7s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t7ns1", "route": [{"if": "p1", "ip": "10.1.61.1/24", "ns_if": "t7if", "ns_name": "t7"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t7ns1if", "tenant_ns_ip": "10.1.61.1/24", "tenant_ns_name": "t7", "tenant_sub_if": "t7s1if", "tenant_sub_ip": "10.1.61.2/24"}], "vxlan": [{"dev": "t7s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.61.2", "remote_ip": "10.2.61.2", "remote_route": "10.2.61.0/24", "subnet_route": "10.1.61.0/24", "tenant_route_ip": "192.168.7.2", "v_name": "vxlan_t7s1"}]}, {"brif": "t7br1if1", "disk": "10G", "mem": 2, "name": "t7_VM1", "vcpu": 4, "vmif": "t7VM1if1"}], "rc": 0, "start": "2019-12-05 08:06:16.312558", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.61.1/24', u'ns_name': u't7', u'ns_if': u't7if', u'if': u'p1'}], u'default_route_ip': u'10.1.61.1', u'bridge_name': u't7br1', u'dns': [{u'dnsif': u't7s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't7s1_dnsbrif'}], u'ns_name': u't7ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.61.2/24', u'tenant_ns_ip': u'10.1.61.1/24', u'tenant_ns_if': u't7ns1if', u'tenant_sub_if': u't7s1if', u'tenant_ns_name': u't7'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.1.61.2', u'dsport': 4789, u'dev': u't7s1if', u'tenant_route_ip': u'192.168.7.2', u'remote_route': u'10.2.61.0/24', u'subnet_route': u'10.1.61.0/24', u'v_name': u'vxlan_t7s1', u'id': 42, u'remote_ip': u'10.2.61.2'}]}, {u'mem': 4, u'name': u't7_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't7br1if2', u'vmif': u't7VM2if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t7ns1\" ip link set \"t7br1if2\" up\nip netns exec \"t7ns1\" ip link set dev \"t7br1\" up\n", "delta": "0:00:00.065530", "end": "2019-12-05 08:06:16.685216", "item": [{"bridge_name": "t7br1", "default_route_ip": "10.1.61.1", "dns": [{"brif": "t7s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.5", "dnsif": "t7s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t7ns1", "route": [{"if": "p1", "ip": "10.1.61.1/24", "ns_if": "t7if", "ns_name": "t7"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t7ns1if", "tenant_ns_ip": "10.1.61.1/24", "tenant_ns_name": "t7", "tenant_sub_if": "t7s1if", "tenant_sub_ip": "10.1.61.2/24"}], "vxlan": [{"dev": "t7s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.61.2", "remote_ip": "10.2.61.2", "remote_route": "10.2.61.0/24", "subnet_route": "10.1.61.0/24", "tenant_route_ip": "192.168.7.2", "v_name": "vxlan_t7s1"}]}, {"brif": "t7br1if2", "disk": "10G", "mem": 4, "name": "t7_VM2", "vcpu": 2, "vmif": "t7VM2if1"}], "rc": 0, "start": "2019-12-05 08:06:16.619686", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Add IP to DNS Interface] ***************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.61.1/24', u'ns_name': u't7', u'ns_if': u't7if', u'if': u'p1'}], u'default_route_ip': u'10.1.61.1', u'bridge_name': u't7br1', u'ns_name': u't7ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.61.2/24', u'tenant_ns_ip': u'10.1.61.1/24', u'tenant_ns_if': u't7ns1if', u'tenant_sub_if': u't7s1if', u'tenant_ns_name': u't7'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't7_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't7br1if1', u'vmif': u't7VM1if1'}, {u'mem': 4, u'name': u't7_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't7br1if2', u'vmif': u't7VM2if1'}], u'vxlan': [{u'local_ip': u'10.1.61.2', u'dsport': 4789, u'dev': u't7s1if', u'tenant_route_ip': u'192.168.7.2', u'remote_route': u'10.2.61.0/24', u'subnet_route': u'10.1.61.0/24', u'v_name': u'vxlan_t7s1', u'id': 42, u'remote_ip': u'10.2.61.2'}]}, {u'dnsif': u't7s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't7s1_dnsbrif'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t7ns1\" ip addr show \"t7s1_dnsif\" | awk 'FNR==3{ print $2 }' | grep -w '^1.1.1.1/24' ; if [ $? -ne 0 ] ; then ip netns exec \"t7ns1\" ip addr add \"1.1.1.1/24\" dev \"t7s1_dnsif\" ; fi\n", "delta": "0:00:00.076548", "end": "2019-12-05 08:06:17.053317", "item": [{"bridge_name": "t7br1", "default_route_ip": "10.1.61.1", "ns_name": "t7ns1", "route": [{"if": "p1", "ip": "10.1.61.1/24", "ns_if": "t7if", "ns_name": "t7"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t7ns1if", "tenant_ns_ip": "10.1.61.1/24", "tenant_ns_name": "t7", "tenant_sub_if": "t7s1if", "tenant_sub_ip": "10.1.61.2/24"}], "vms": [{"brif": "t7br1if1", "disk": "10G", "mem": 2, "name": "t7_VM1", "vcpu": 4, "vmif": "t7VM1if1"}, {"brif": "t7br1if2", "disk": "10G", "mem": 4, "name": "t7_VM2", "vcpu": 2, "vmif": "t7VM2if1"}], "vxlan": [{"dev": "t7s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.61.2", "remote_ip": "10.2.61.2", "remote_route": "10.2.61.0/24", "subnet_route": "10.1.61.0/24", "tenant_route_ip": "192.168.7.2", "v_name": "vxlan_t7s1"}]}, {"brif": "t7s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.5", "dnsif": "t7s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "rc": 0, "start": "2019-12-05 08:06:16.976769", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Install DHCP Server] *******************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.61.1/24', u'ns_name': u't7', u'ns_if': u't7if', u'if': u'p1'}], u'default_route_ip': u'10.1.61.1', u'bridge_name': u't7br1', u'ns_name': u't7ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.61.2/24', u'tenant_ns_ip': u'10.1.61.1/24', u'tenant_ns_if': u't7ns1if', u'tenant_sub_if': u't7s1if', u'tenant_ns_name': u't7'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't7_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't7br1if1', u'vmif': u't7VM1if1'}, {u'mem': 4, u'name': u't7_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't7br1if2', u'vmif': u't7VM2if1'}], u'vxlan': [{u'local_ip': u'10.1.61.2', u'dsport': 4789, u'dev': u't7s1if', u'tenant_route_ip': u'192.168.7.2', u'remote_route': u'10.2.61.0/24', u'subnet_route': u'10.1.61.0/24', u'v_name': u'vxlan_t7s1', u'id': 42, u'remote_ip': u'10.2.61.2'}]}, {u'dnsif': u't7s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't7s1_dnsbrif'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t7ns1\" ps aux | grep -w '[d]nsmasq --interface t7s1_dnsif -z --dhcp-range=1.1.1.5,1.1.1.254' ; if [ $? -ne 0 ] ; then ip netns exec \"t7ns1\" dnsmasq --interface \"t7s1_dnsif\" -z --dhcp-range=1.1.1.5,'1.1.1.254' ; fi\n", "delta": "0:00:00.081439", "end": "2019-12-05 08:06:17.414313", "item": [{"bridge_name": "t7br1", "default_route_ip": "10.1.61.1", "ns_name": "t7ns1", "route": [{"if": "p1", "ip": "10.1.61.1/24", "ns_if": "t7if", "ns_name": "t7"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t7ns1if", "tenant_ns_ip": "10.1.61.1/24", "tenant_ns_name": "t7", "tenant_sub_if": "t7s1if", "tenant_sub_ip": "10.1.61.2/24"}], "vms": [{"brif": "t7br1if1", "disk": "10G", "mem": 2, "name": "t7_VM1", "vcpu": 4, "vmif": "t7VM1if1"}, {"brif": "t7br1if2", "disk": "10G", "mem": 4, "name": "t7_VM2", "vcpu": 2, "vmif": "t7VM2if1"}], "vxlan": [{"dev": "t7s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.61.2", "remote_ip": "10.2.61.2", "remote_route": "10.2.61.0/24", "subnet_route": "10.1.61.0/24", "tenant_route_ip": "192.168.7.2", "v_name": "vxlan_t7s1"}]}, {"brif": "t7s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.5", "dnsif": "t7s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "rc": 0, "start": "2019-12-05 08:06:17.332874", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Create VXLAN devices] ******************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.61.1/24', u'ns_name': u't7', u'ns_if': u't7if', u'if': u'p1'}], u'default_route_ip': u'10.1.61.1', u'bridge_name': u't7br1', u'dns': [{u'dnsif': u't7s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't7s1_dnsbrif'}], u'ns_name': u't7ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.61.2/24', u'tenant_ns_ip': u'10.1.61.1/24', u'tenant_ns_if': u't7ns1if', u'tenant_sub_if': u't7s1if', u'tenant_ns_name': u't7'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't7_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't7br1if1', u'vmif': u't7VM1if1'}, {u'mem': 4, u'name': u't7_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't7br1if2', u'vmif': u't7VM2if1'}]}, {u'local_ip': u'10.1.61.2', u'dsport': 4789, u'dev': u't7s1if', u'tenant_route_ip': u'192.168.7.2', u'remote_route': u'10.2.61.0/24', u'subnet_route': u'10.1.61.0/24', u'v_name': u'vxlan_t7s1', u'id': 42, u'remote_ip': u'10.2.61.2'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t7ns1\" ip link show \"vxlan_t7s1\" ; if [ $? -ne 0 ] ; then ip netns exec \"t7ns1\" ip link add \"vxlan_t7s1\" type vxlan id \"42\" local \"10.1.61.2\" remote \"10.2.61.2\" dstport \"4789\" dev \"t7s1if\"; ip netns exec \"t7ns1\" ip link set dev \"vxlan_t7s1\" up ; fi\n", "delta": "0:00:00.121028", "end": "2019-12-05 08:06:17.821121", "item": [{"bridge_name": "t7br1", "default_route_ip": "10.1.61.1", "dns": [{"brif": "t7s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.5", "dnsif": "t7s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t7ns1", "route": [{"if": "p1", "ip": "10.1.61.1/24", "ns_if": "t7if", "ns_name": "t7"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t7ns1if", "tenant_ns_ip": "10.1.61.1/24", "tenant_ns_name": "t7", "tenant_sub_if": "t7s1if", "tenant_sub_ip": "10.1.61.2/24"}], "vms": [{"brif": "t7br1if1", "disk": "10G", "mem": 2, "name": "t7_VM1", "vcpu": 4, "vmif": "t7VM1if1"}, {"brif": "t7br1if2", "disk": "10G", "mem": 4, "name": "t7_VM2", "vcpu": 2, "vmif": "t7VM2if1"}]}, {"dev": "t7s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.61.2", "remote_ip": "10.2.61.2", "remote_route": "10.2.61.0/24", "subnet_route": "10.1.61.0/24", "tenant_route_ip": "192.168.7.2", "v_name": "vxlan_t7s1"}], "rc": 0, "start": "2019-12-05 08:06:17.700093", "stderr": "Device \"vxlan_t7s1\" does not exist.", "stderr_lines": ["Device \"vxlan_t7s1\" does not exist."], "stdout": "", "stdout_lines": []}

TASK [Attach VXLANs to bridge] ***************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.61.1/24', u'ns_name': u't7', u'ns_if': u't7if', u'if': u'p1'}], u'default_route_ip': u'10.1.61.1', u'bridge_name': u't7br1', u'dns': [{u'dnsif': u't7s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't7s1_dnsbrif'}], u'ns_name': u't7ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.61.2/24', u'tenant_ns_ip': u'10.1.61.1/24', u'tenant_ns_if': u't7ns1if', u'tenant_sub_if': u't7s1if', u'tenant_ns_name': u't7'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't7_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't7br1if1', u'vmif': u't7VM1if1'}, {u'mem': 4, u'name': u't7_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't7br1if2', u'vmif': u't7VM2if1'}]}, {u'local_ip': u'10.1.61.2', u'dsport': 4789, u'dev': u't7s1if', u'tenant_route_ip': u'192.168.7.2', u'remote_route': u'10.2.61.0/24', u'subnet_route': u'10.1.61.0/24', u'v_name': u'vxlan_t7s1', u'id': 42, u'remote_ip': u'10.2.61.2'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t7ns1\" brctl show \"t7br1\" | grep -w 'vxlan_t7s1' ; if [ $? -ne 0 ] ; then ip netns exec \"t7ns1\" brctl addif \"t7br1\" \"vxlan_t7s1\" ; fi\n", "delta": "0:00:00.075994", "end": "2019-12-05 08:06:18.201111", "item": [{"bridge_name": "t7br1", "default_route_ip": "10.1.61.1", "dns": [{"brif": "t7s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.5", "dnsif": "t7s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t7ns1", "route": [{"if": "p1", "ip": "10.1.61.1/24", "ns_if": "t7if", "ns_name": "t7"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t7ns1if", "tenant_ns_ip": "10.1.61.1/24", "tenant_ns_name": "t7", "tenant_sub_if": "t7s1if", "tenant_sub_ip": "10.1.61.2/24"}], "vms": [{"brif": "t7br1if1", "disk": "10G", "mem": 2, "name": "t7_VM1", "vcpu": 4, "vmif": "t7VM1if1"}, {"brif": "t7br1if2", "disk": "10G", "mem": 4, "name": "t7_VM2", "vcpu": 2, "vmif": "t7VM2if1"}]}, {"dev": "t7s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.61.2", "remote_ip": "10.2.61.2", "remote_route": "10.2.61.0/24", "subnet_route": "10.1.61.0/24", "tenant_route_ip": "192.168.7.2", "v_name": "vxlan_t7s1"}], "rc": 0, "start": "2019-12-05 08:06:18.125117", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

PLAY RECAP ***********************************************************************************************************
localhost                  : ok=21   changed=21   unreachable=0    failed=0    skipped=0    rescued=0    ignored=0   

Using /etc/ansible/ansible.cfg as config file

PLAY [worker] ********************************************************************************************************

TASK [Create Tenant Namespace] ***************************************************************************************
changed: [99.99.99.2] => (item={u'default_route_ip': u'192.168.135.1', u'name': u't7', u'pns_ip': u'192.168.135.1/24', u'tenant_if': u't7if', u'tenant_ip': u'192.168.135.2/24', u'pns_if': u't7pns_if'}) => {"ansible_loop_var": "item", "changed": true, "cmd": ["ip", "netns", "add", "t7"], "delta": "0:00:00.057275", "end": "2019-12-05 08:06:20.228738", "item": {"default_route_ip": "192.168.135.1", "name": "t7", "pns_if": "t7pns_if", "pns_ip": "192.168.135.1/24", "tenant_if": "t7if", "tenant_ip": "192.168.135.2/24"}, "rc": 0, "start": "2019-12-05 08:06:20.171463", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Create Subnet Namespace] ***************************************************************************************
changed: [99.99.99.2] => (item={u'route': [{u'ip': u'10.2.61.1/24', u'ns_name': u't7', u'ns_if': u't7if', u'if': u'p1'}], u'default_route_ip': u'10.2.61.1', u'bridge_name': u't7br1', u'dns': [{u'dnsif': [], u'dhcp_start': [], u'dhcp_end': [], u'dnsif_ip': [], u'net_mask': [], u'brif': []}], u'ns_name': u't7ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.61.2/24', u'tenant_ns_ip': u'10.2.61.1/24', u'tenant_ns_if': u't7ns1if', u'tenant_ns_name': u't7', u'tenant_sub_if': u't7s1if'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't7_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't7br1if1', u'vmif': u't7VM4if1'}], u'vxlan': [{u'local_ip': u'10.2.61.2', u'tenant_route_ip': u'192.168.135.2', u'dsport': 4789, u'dev': u't7s1if', u'subnet_route': u'10.2.61.0/24', u'remote_route': u'10.1.61.0/24', u'v_name': u'vxlan_t7s1', u'id': 42, u'remote_ip': u'10.1.61.2'}]}) => {"ansible_loop_var": "item", "changed": true, "cmd": ["ip", "netns", "add", "t7ns1"], "delta": "0:00:00.071461", "end": "2019-12-05 08:06:20.764409", "item": {"bridge_name": "t7br1", "default_route_ip": "10.2.61.1", "dns": [{"brif": [], "dhcp_end": [], "dhcp_start": [], "dnsif": [], "dnsif_ip": [], "net_mask": []}], "ns_name": "t7ns1", "route": [{"if": "p1", "ip": "10.2.61.1/24", "ns_if": "t7if", "ns_name": "t7"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t7ns1if", "tenant_ns_ip": "10.2.61.1/24", "tenant_ns_name": "t7", "tenant_sub_if": "t7s1if", "tenant_sub_ip": "10.2.61.2/24"}], "vms": [{"brif": "t7br1if1", "disk": "10G", "mem": 2, "name": "t7_VM4", "vcpu": 4, "vmif": "t7VM4if1"}], "vxlan": [{"dev": "t7s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.61.2", "remote_ip": "10.1.61.2", "remote_route": "10.1.61.0/24", "subnet_route": "10.2.61.0/24", "tenant_route_ip": "192.168.135.2", "v_name": "vxlan_t7s1"}]}, "rc": 0, "start": "2019-12-05 08:06:20.692948", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}
changed: [99.99.99.2] => (item={u'route': [{u'ip': u'10.2.62.1/24', u'ns_name': u't7', u'ns_if': u't7if', u'if': u'p1'}], u'default_route_ip': u'10.2.62.1', u'bridge_name': u't7br2', u'dns': [{u'dnsif': u't7s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't7s2_dnsbrif'}], u'ns_name': u't7ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.62.2/24', u'tenant_ns_ip': u'10.2.62.1/24', u'tenant_ns_if': u't7ns2if', u'tenant_ns_name': u't7', u'tenant_sub_if': u't7s2if'}], u'subnet_ip': u'2.2.2.0/24', u'vms': [{u'mem': 3, u'name': u't7_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't7br2if1', u'vmif': u't7VM3if1'}], u'vxlan': [{u'local_ip': [], u'tenant_route_ip': [], u'dsport': [], u'dev': [], u'subnet_route': [], u'remote_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}) => {"ansible_loop_var": "item", "changed": true, "cmd": ["ip", "netns", "add", "t7ns2"], "delta": "0:00:00.059416", "end": "2019-12-05 08:06:21.164315", "item": {"bridge_name": "t7br2", "default_route_ip": "10.2.62.1", "dns": [{"brif": "t7s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t7s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t7ns2", "route": [{"if": "p1", "ip": "10.2.62.1/24", "ns_if": "t7if", "ns_name": "t7"}], "subnet_ip": "2.2.2.0/24", "tenant_ns": [{"tenant_ns_if": "t7ns2if", "tenant_ns_ip": "10.2.62.1/24", "tenant_ns_name": "t7", "tenant_sub_if": "t7s2if", "tenant_sub_ip": "10.2.62.2/24"}], "vms": [{"brif": "t7br2if1", "disk": "10G", "mem": 3, "name": "t7_VM3", "vcpu": 2, "vmif": "t7VM3if1"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, "rc": 0, "start": "2019-12-05 08:06:21.104899", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Create Tenant VETH pairs] **************************************************************************************
changed: [99.99.99.2] => (item={u'default_route_ip': u'192.168.135.1', u'name': u't7', u'pns_ip': u'192.168.135.1/24', u'tenant_if': u't7if', u'tenant_ip': u'192.168.135.2/24', u'pns_if': u't7pns_if'}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip link show \"t7if\" ; if [ $? -ne 0 ] ; then ip link add \"t7if\" type veth peer name \"t7pns_if\" ; fi\n", "delta": "0:00:00.014695", "end": "2019-12-05 08:06:21.584489", "item": {"default_route_ip": "192.168.135.1", "name": "t7", "pns_if": "t7pns_if", "pns_ip": "192.168.135.1/24", "tenant_if": "t7if", "tenant_ip": "192.168.135.2/24"}, "rc": 0, "start": "2019-12-05 08:06:21.569794", "stderr": "Device \"t7if\" does not exist.", "stderr_lines": ["Device \"t7if\" does not exist."], "stdout": "", "stdout_lines": []}

TASK [Attach Tenant VETH Pairs] **************************************************************************************
changed: [99.99.99.2] => (item={u'default_route_ip': u'192.168.135.1', u'name': u't7', u'pns_ip': u'192.168.135.1/24', u'tenant_if': u't7if', u'tenant_ip': u'192.168.135.2/24', u'pns_if': u't7pns_if'}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec pns ip link show \"t7pns_if\" ; if [ $? -ne 0 ] ; then ip link set \"t7pns_if\" netns pns ; fi\nip netns exec \"t7\" ip link show \"t7if\" ; if [ $? -ne 0 ] ; then ip link set \"t7if\" netns \"t7\" ; fi\nip netns exec pns ip link set dev \"t7pns_if\" up\nip netns exec \"t7\" ip link set dev \"t7if\" up\n", "delta": "0:00:00.222026", "end": "2019-12-05 08:06:22.204472", "item": {"default_route_ip": "192.168.135.1", "name": "t7", "pns_if": "t7pns_if", "pns_ip": "192.168.135.1/24", "tenant_if": "t7if", "tenant_ip": "192.168.135.2/24"}, "rc": 0, "start": "2019-12-05 08:06:21.982446", "stderr": "Device \"t7pns_if\" does not exist.\nDevice \"t7if\" does not exist.", "stderr_lines": ["Device \"t7pns_if\" does not exist.", "Device \"t7if\" does not exist."], "stdout": "", "stdout_lines": []}

TASK [Add IP addresses to Tenant VETH Pairs] *************************************************************************
changed: [99.99.99.2] => (item={u'default_route_ip': u'192.168.135.1', u'name': u't7', u'pns_ip': u'192.168.135.1/24', u'tenant_if': u't7if', u'tenant_ip': u'192.168.135.2/24', u'pns_if': u't7pns_if'}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec pns ip addr show \"t7pns_if\" | awk 'FNR==3{ print $2 }' | grep -w '^192.168.135.1/24' ; if [ $? -ne 0 ] ; then ip netns exec pns ip addr add \"192.168.135.1/24\" dev \"t7pns_if\" ; fi\nip netns exec \"t7\" ip addr show \"t7if\" | awk 'FNR==3{ print $2 }' | grep -w '^192.168.135.2/24' ; if [ $? -ne 0 ] ; then ip netns exec \"t7\" ip addr add \"192.168.135.2/24\" dev \"t7if\" ; fi\n", "delta": "0:00:00.163079", "end": "2019-12-05 08:06:22.772490", "item": {"default_route_ip": "192.168.135.1", "name": "t7", "pns_if": "t7pns_if", "pns_ip": "192.168.135.1/24", "tenant_if": "t7if", "tenant_ip": "192.168.135.2/24"}, "rc": 0, "start": "2019-12-05 08:06:22.609411", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Create Namespace VETH Pairs] ***********************************************************************************
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.61.1/24', u'ns_name': u't7', u'ns_if': u't7if', u'if': u'p1'}], u'default_route_ip': u'10.2.61.1', u'bridge_name': u't7br1', u'dns': [{u'dnsif': [], u'dhcp_start': [], u'dhcp_end': [], u'dnsif_ip': [], u'net_mask': [], u'brif': []}], u'ns_name': u't7ns1', u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't7_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't7br1if1', u'vmif': u't7VM4if1'}], u'vxlan': [{u'local_ip': u'10.2.61.2', u'dsport': 4789, u'dev': u't7s1if', u'tenant_route_ip': u'192.168.135.2', u'remote_route': u'10.1.61.0/24', u'subnet_route': u'10.2.61.0/24', u'v_name': u'vxlan_t7s1', u'id': 42, u'remote_ip': u'10.1.61.2'}]}, {u'tenant_sub_ip': u'10.2.61.2/24', u'tenant_ns_ip': u'10.2.61.1/24', u'tenant_ns_if': u't7ns1if', u'tenant_sub_if': u't7s1if', u'tenant_ns_name': u't7'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip link show \"t7ns1if\" ; if [ $? -ne 0 ] ; then ip link add \"t7ns1if\" type veth peer name \"t7s1if\" ; fi\n", "delta": "0:00:00.012383", "end": "2019-12-05 08:06:23.183885", "item": [{"bridge_name": "t7br1", "default_route_ip": "10.2.61.1", "dns": [{"brif": [], "dhcp_end": [], "dhcp_start": [], "dnsif": [], "dnsif_ip": [], "net_mask": []}], "ns_name": "t7ns1", "route": [{"if": "p1", "ip": "10.2.61.1/24", "ns_if": "t7if", "ns_name": "t7"}], "subnet_ip": "1.1.1.0/24", "vms": [{"brif": "t7br1if1", "disk": "10G", "mem": 2, "name": "t7_VM4", "vcpu": 4, "vmif": "t7VM4if1"}], "vxlan": [{"dev": "t7s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.61.2", "remote_ip": "10.1.61.2", "remote_route": "10.1.61.0/24", "subnet_route": "10.2.61.0/24", "tenant_route_ip": "192.168.135.2", "v_name": "vxlan_t7s1"}]}, {"tenant_ns_if": "t7ns1if", "tenant_ns_ip": "10.2.61.1/24", "tenant_ns_name": "t7", "tenant_sub_if": "t7s1if", "tenant_sub_ip": "10.2.61.2/24"}], "rc": 0, "start": "2019-12-05 08:06:23.171502", "stderr": "Device \"t7ns1if\" does not exist.", "stderr_lines": ["Device \"t7ns1if\" does not exist."], "stdout": "", "stdout_lines": []}
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.62.1/24', u'ns_name': u't7', u'ns_if': u't7if', u'if': u'p1'}], u'default_route_ip': u'10.2.62.1', u'bridge_name': u't7br2', u'dns': [{u'dnsif': u't7s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't7s2_dnsbrif'}], u'ns_name': u't7ns2', u'subnet_ip': u'2.2.2.0/24', u'vms': [{u'mem': 3, u'name': u't7_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't7br2if1', u'vmif': u't7VM3if1'}], u'vxlan': [{u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}, {u'tenant_sub_ip': u'10.2.62.2/24', u'tenant_ns_ip': u'10.2.62.1/24', u'tenant_ns_if': u't7ns2if', u'tenant_sub_if': u't7s2if', u'tenant_ns_name': u't7'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip link show \"t7ns2if\" ; if [ $? -ne 0 ] ; then ip link add \"t7ns2if\" type veth peer name \"t7s2if\" ; fi\n", "delta": "0:00:00.014344", "end": "2019-12-05 08:06:23.542324", "item": [{"bridge_name": "t7br2", "default_route_ip": "10.2.62.1", "dns": [{"brif": "t7s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t7s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t7ns2", "route": [{"if": "p1", "ip": "10.2.62.1/24", "ns_if": "t7if", "ns_name": "t7"}], "subnet_ip": "2.2.2.0/24", "vms": [{"brif": "t7br2if1", "disk": "10G", "mem": 3, "name": "t7_VM3", "vcpu": 2, "vmif": "t7VM3if1"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, {"tenant_ns_if": "t7ns2if", "tenant_ns_ip": "10.2.62.1/24", "tenant_ns_name": "t7", "tenant_sub_if": "t7s2if", "tenant_sub_ip": "10.2.62.2/24"}], "rc": 0, "start": "2019-12-05 08:06:23.527980", "stderr": "Device \"t7ns2if\" does not exist.", "stderr_lines": ["Device \"t7ns2if\" does not exist."], "stdout": "", "stdout_lines": []}

TASK [Attach Namespace VETH Pairs] ***********************************************************************************
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.61.1/24', u'ns_name': u't7', u'ns_if': u't7if', u'if': u'p1'}], u'default_route_ip': u'10.2.61.1', u'bridge_name': u't7br1', u'dns': [{u'dnsif': [], u'dhcp_start': [], u'dhcp_end': [], u'dnsif_ip': [], u'net_mask': [], u'brif': []}], u'ns_name': u't7ns1', u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't7_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't7br1if1', u'vmif': u't7VM4if1'}], u'vxlan': [{u'local_ip': u'10.2.61.2', u'dsport': 4789, u'dev': u't7s1if', u'tenant_route_ip': u'192.168.135.2', u'remote_route': u'10.1.61.0/24', u'subnet_route': u'10.2.61.0/24', u'v_name': u'vxlan_t7s1', u'id': 42, u'remote_ip': u'10.1.61.2'}]}, {u'tenant_sub_ip': u'10.2.61.2/24', u'tenant_ns_ip': u'10.2.61.1/24', u'tenant_ns_if': u't7ns1if', u'tenant_sub_if': u't7s1if', u'tenant_ns_name': u't7'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t7\" ip link show \"t7ns1if\" ; if [ $? -ne 0 ] ; then ip link set \"t7ns1if\" netns \"t7\" ; fi\nip netns exec \"t7ns1\" ip link show \"t7s1if\" ; if [ $? -ne 0 ] ; then ip link set \"t7s1if\" netns \"t7ns1\" ; fi\n", "delta": "0:00:00.146784", "end": "2019-12-05 08:06:24.115657", "item": [{"bridge_name": "t7br1", "default_route_ip": "10.2.61.1", "dns": [{"brif": [], "dhcp_end": [], "dhcp_start": [], "dnsif": [], "dnsif_ip": [], "net_mask": []}], "ns_name": "t7ns1", "route": [{"if": "p1", "ip": "10.2.61.1/24", "ns_if": "t7if", "ns_name": "t7"}], "subnet_ip": "1.1.1.0/24", "vms": [{"brif": "t7br1if1", "disk": "10G", "mem": 2, "name": "t7_VM4", "vcpu": 4, "vmif": "t7VM4if1"}], "vxlan": [{"dev": "t7s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.61.2", "remote_ip": "10.1.61.2", "remote_route": "10.1.61.0/24", "subnet_route": "10.2.61.0/24", "tenant_route_ip": "192.168.135.2", "v_name": "vxlan_t7s1"}]}, {"tenant_ns_if": "t7ns1if", "tenant_ns_ip": "10.2.61.1/24", "tenant_ns_name": "t7", "tenant_sub_if": "t7s1if", "tenant_sub_ip": "10.2.61.2/24"}], "rc": 0, "start": "2019-12-05 08:06:23.968873", "stderr": "Device \"t7ns1if\" does not exist.\nDevice \"t7s1if\" does not exist.", "stderr_lines": ["Device \"t7ns1if\" does not exist.", "Device \"t7s1if\" does not exist."], "stdout": "", "stdout_lines": []}
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.62.1/24', u'ns_name': u't7', u'ns_if': u't7if', u'if': u'p1'}], u'default_route_ip': u'10.2.62.1', u'bridge_name': u't7br2', u'dns': [{u'dnsif': u't7s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't7s2_dnsbrif'}], u'ns_name': u't7ns2', u'subnet_ip': u'2.2.2.0/24', u'vms': [{u'mem': 3, u'name': u't7_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't7br2if1', u'vmif': u't7VM3if1'}], u'vxlan': [{u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}, {u'tenant_sub_ip': u'10.2.62.2/24', u'tenant_ns_ip': u'10.2.62.1/24', u'tenant_ns_if': u't7ns2if', u'tenant_sub_if': u't7s2if', u'tenant_ns_name': u't7'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t7\" ip link show \"t7ns2if\" ; if [ $? -ne 0 ] ; then ip link set \"t7ns2if\" netns \"t7\" ; fi\nip netns exec \"t7ns2\" ip link show \"t7s2if\" ; if [ $? -ne 0 ] ; then ip link set \"t7s2if\" netns \"t7ns2\" ; fi\n", "delta": "0:00:00.130862", "end": "2019-12-05 08:06:24.593258", "item": [{"bridge_name": "t7br2", "default_route_ip": "10.2.62.1", "dns": [{"brif": "t7s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t7s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t7ns2", "route": [{"if": "p1", "ip": "10.2.62.1/24", "ns_if": "t7if", "ns_name": "t7"}], "subnet_ip": "2.2.2.0/24", "vms": [{"brif": "t7br2if1", "disk": "10G", "mem": 3, "name": "t7_VM3", "vcpu": 2, "vmif": "t7VM3if1"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, {"tenant_ns_if": "t7ns2if", "tenant_ns_ip": "10.2.62.1/24", "tenant_ns_name": "t7", "tenant_sub_if": "t7s2if", "tenant_sub_ip": "10.2.62.2/24"}], "rc": 0, "start": "2019-12-05 08:06:24.462396", "stderr": "Device \"t7ns2if\" does not exist.\nDevice \"t7s2if\" does not exist.", "stderr_lines": ["Device \"t7ns2if\" does not exist.", "Device \"t7s2if\" does not exist."], "stdout": "", "stdout_lines": []}

TASK [Set Namespace VETH Pairs UP] ***********************************************************************************
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.61.1/24', u'ns_name': u't7', u'ns_if': u't7if', u'if': u'p1'}], u'default_route_ip': u'10.2.61.1', u'bridge_name': u't7br1', u'dns': [{u'dnsif': [], u'dhcp_start': [], u'dhcp_end': [], u'dnsif_ip': [], u'net_mask': [], u'brif': []}], u'ns_name': u't7ns1', u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't7_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't7br1if1', u'vmif': u't7VM4if1'}], u'vxlan': [{u'local_ip': u'10.2.61.2', u'dsport': 4789, u'dev': u't7s1if', u'tenant_route_ip': u'192.168.135.2', u'remote_route': u'10.1.61.0/24', u'subnet_route': u'10.2.61.0/24', u'v_name': u'vxlan_t7s1', u'id': 42, u'remote_ip': u'10.1.61.2'}]}, {u'tenant_sub_ip': u'10.2.61.2/24', u'tenant_ns_ip': u'10.2.61.1/24', u'tenant_ns_if': u't7ns1if', u'tenant_sub_if': u't7s1if', u'tenant_ns_name': u't7'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t7\" ip link set dev \"t7ns1if\" up\nip netns exec \"t7ns1\" ip link set dev \"t7s1if\" up\n", "delta": "0:00:00.094257", "end": "2019-12-05 08:06:25.092559", "item": [{"bridge_name": "t7br1", "default_route_ip": "10.2.61.1", "dns": [{"brif": [], "dhcp_end": [], "dhcp_start": [], "dnsif": [], "dnsif_ip": [], "net_mask": []}], "ns_name": "t7ns1", "route": [{"if": "p1", "ip": "10.2.61.1/24", "ns_if": "t7if", "ns_name": "t7"}], "subnet_ip": "1.1.1.0/24", "vms": [{"brif": "t7br1if1", "disk": "10G", "mem": 2, "name": "t7_VM4", "vcpu": 4, "vmif": "t7VM4if1"}], "vxlan": [{"dev": "t7s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.61.2", "remote_ip": "10.1.61.2", "remote_route": "10.1.61.0/24", "subnet_route": "10.2.61.0/24", "tenant_route_ip": "192.168.135.2", "v_name": "vxlan_t7s1"}]}, {"tenant_ns_if": "t7ns1if", "tenant_ns_ip": "10.2.61.1/24", "tenant_ns_name": "t7", "tenant_sub_if": "t7s1if", "tenant_sub_ip": "10.2.61.2/24"}], "rc": 0, "start": "2019-12-05 08:06:24.998302", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.62.1/24', u'ns_name': u't7', u'ns_if': u't7if', u'if': u'p1'}], u'default_route_ip': u'10.2.62.1', u'bridge_name': u't7br2', u'dns': [{u'dnsif': u't7s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't7s2_dnsbrif'}], u'ns_name': u't7ns2', u'subnet_ip': u'2.2.2.0/24', u'vms': [{u'mem': 3, u'name': u't7_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't7br2if1', u'vmif': u't7VM3if1'}], u'vxlan': [{u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}, {u'tenant_sub_ip': u'10.2.62.2/24', u'tenant_ns_ip': u'10.2.62.1/24', u'tenant_ns_if': u't7ns2if', u'tenant_sub_if': u't7s2if', u'tenant_ns_name': u't7'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t7\" ip link set dev \"t7ns2if\" up\nip netns exec \"t7ns2\" ip link set dev \"t7s2if\" up\n", "delta": "0:00:00.083976", "end": "2019-12-05 08:06:25.508708", "item": [{"bridge_name": "t7br2", "default_route_ip": "10.2.62.1", "dns": [{"brif": "t7s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t7s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t7ns2", "route": [{"if": "p1", "ip": "10.2.62.1/24", "ns_if": "t7if", "ns_name": "t7"}], "subnet_ip": "2.2.2.0/24", "vms": [{"brif": "t7br2if1", "disk": "10G", "mem": 3, "name": "t7_VM3", "vcpu": 2, "vmif": "t7VM3if1"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, {"tenant_ns_if": "t7ns2if", "tenant_ns_ip": "10.2.62.1/24", "tenant_ns_name": "t7", "tenant_sub_if": "t7s2if", "tenant_sub_ip": "10.2.62.2/24"}], "rc": 0, "start": "2019-12-05 08:06:25.424732", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Add IP addresses to Namespace VETH Pairs] **********************************************************************
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.61.1/24', u'ns_name': u't7', u'ns_if': u't7if', u'if': u'p1'}], u'default_route_ip': u'10.2.61.1', u'bridge_name': u't7br1', u'dns': [{u'dnsif': [], u'dhcp_start': [], u'dhcp_end': [], u'dnsif_ip': [], u'net_mask': [], u'brif': []}], u'ns_name': u't7ns1', u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't7_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't7br1if1', u'vmif': u't7VM4if1'}], u'vxlan': [{u'local_ip': u'10.2.61.2', u'dsport': 4789, u'dev': u't7s1if', u'tenant_route_ip': u'192.168.135.2', u'remote_route': u'10.1.61.0/24', u'subnet_route': u'10.2.61.0/24', u'v_name': u'vxlan_t7s1', u'id': 42, u'remote_ip': u'10.1.61.2'}]}, {u'tenant_sub_ip': u'10.2.61.2/24', u'tenant_ns_ip': u'10.2.61.1/24', u'tenant_ns_if': u't7ns1if', u'tenant_sub_if': u't7s1if', u'tenant_ns_name': u't7'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t7ns1\" ip addr show \"t7s1if\" | awk 'FNR==3{ print $2 }' | grep -w '^10.2.61.2/24' ; if [ $? -ne 0 ] ; then ip netns exec \"t7ns1\" ip addr add \"10.2.61.2/24\" dev \"t7s1if\" ; fi\n\nip netns exec \"t7\" ip addr show \"t7ns1if\" | awk 'FNR==3{ print $2 }' | grep -w '^10.2.61.1/24' ; if [ $? -ne 0 ] ; then ip netns exec \"t7\" ip addr add \"10.2.61.1/24\" dev \"t7ns1if\" ; fi\n", "delta": "0:00:00.162321", "end": "2019-12-05 08:06:26.108606", "item": [{"bridge_name": "t7br1", "default_route_ip": "10.2.61.1", "dns": [{"brif": [], "dhcp_end": [], "dhcp_start": [], "dnsif": [], "dnsif_ip": [], "net_mask": []}], "ns_name": "t7ns1", "route": [{"if": "p1", "ip": "10.2.61.1/24", "ns_if": "t7if", "ns_name": "t7"}], "subnet_ip": "1.1.1.0/24", "vms": [{"brif": "t7br1if1", "disk": "10G", "mem": 2, "name": "t7_VM4", "vcpu": 4, "vmif": "t7VM4if1"}], "vxlan": [{"dev": "t7s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.61.2", "remote_ip": "10.1.61.2", "remote_route": "10.1.61.0/24", "subnet_route": "10.2.61.0/24", "tenant_route_ip": "192.168.135.2", "v_name": "vxlan_t7s1"}]}, {"tenant_ns_if": "t7ns1if", "tenant_ns_ip": "10.2.61.1/24", "tenant_ns_name": "t7", "tenant_sub_if": "t7s1if", "tenant_sub_ip": "10.2.61.2/24"}], "rc": 0, "start": "2019-12-05 08:06:25.946285", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.62.1/24', u'ns_name': u't7', u'ns_if': u't7if', u'if': u'p1'}], u'default_route_ip': u'10.2.62.1', u'bridge_name': u't7br2', u'dns': [{u'dnsif': u't7s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't7s2_dnsbrif'}], u'ns_name': u't7ns2', u'subnet_ip': u'2.2.2.0/24', u'vms': [{u'mem': 3, u'name': u't7_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't7br2if1', u'vmif': u't7VM3if1'}], u'vxlan': [{u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}, {u'tenant_sub_ip': u'10.2.62.2/24', u'tenant_ns_ip': u'10.2.62.1/24', u'tenant_ns_if': u't7ns2if', u'tenant_sub_if': u't7s2if', u'tenant_ns_name': u't7'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t7ns2\" ip addr show \"t7s2if\" | awk 'FNR==3{ print $2 }' | grep -w '^10.2.62.2/24' ; if [ $? -ne 0 ] ; then ip netns exec \"t7ns2\" ip addr add \"10.2.62.2/24\" dev \"t7s2if\" ; fi\n\nip netns exec \"t7\" ip addr show \"t7ns2if\" | awk 'FNR==3{ print $2 }' | grep -w '^10.2.62.1/24' ; if [ $? -ne 0 ] ; then ip netns exec \"t7\" ip addr add \"10.2.62.1/24\" dev \"t7ns2if\" ; fi\n", "delta": "0:00:00.150235", "end": "2019-12-05 08:06:26.612480", "item": [{"bridge_name": "t7br2", "default_route_ip": "10.2.62.1", "dns": [{"brif": "t7s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t7s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t7ns2", "route": [{"if": "p1", "ip": "10.2.62.1/24", "ns_if": "t7if", "ns_name": "t7"}], "subnet_ip": "2.2.2.0/24", "vms": [{"brif": "t7br2if1", "disk": "10G", "mem": 3, "name": "t7_VM3", "vcpu": 2, "vmif": "t7VM3if1"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, {"tenant_ns_if": "t7ns2if", "tenant_ns_ip": "10.2.62.1/24", "tenant_ns_name": "t7", "tenant_sub_if": "t7s2if", "tenant_sub_ip": "10.2.62.2/24"}], "rc": 0, "start": "2019-12-05 08:06:26.462245", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Add IP Route to Tenant] ****************************************************************************************
changed: [99.99.99.2] => (item={u'default_route_ip': u'192.168.135.1', u'name': u't7', u'pns_ip': u'192.168.135.1/24', u'tenant_if': u't7if', u'tenant_ip': u'192.168.135.2/24', u'pns_if': u't7pns_if'}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t7\" ip route show default | grep -w '[d]efault via 192.168.135.1' ; if [ $? -ne 0 ] ; then ip netns exec \"t7\" ip route add default via \"192.168.135.1\" ; fi\n", "delta": "0:00:00.073100", "end": "2019-12-05 08:06:27.112687", "item": {"default_route_ip": "192.168.135.1", "name": "t7", "pns_if": "t7pns_if", "pns_ip": "192.168.135.1/24", "tenant_if": "t7if", "tenant_ip": "192.168.135.2/24"}, "rc": 0, "start": "2019-12-05 08:06:27.039587", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Add IP Route to Tenant Subnet] *********************************************************************************
changed: [99.99.99.2] => (item={u'route': [{u'ip': u'10.2.61.1/24', u'ns_name': u't7', u'ns_if': u't7if', u'if': u'p1'}], u'default_route_ip': u'10.2.61.1', u'bridge_name': u't7br1', u'dns': [{u'dnsif': [], u'dhcp_start': [], u'dhcp_end': [], u'dnsif_ip': [], u'net_mask': [], u'brif': []}], u'ns_name': u't7ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.61.2/24', u'tenant_ns_ip': u'10.2.61.1/24', u'tenant_ns_if': u't7ns1if', u'tenant_ns_name': u't7', u'tenant_sub_if': u't7s1if'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't7_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't7br1if1', u'vmif': u't7VM4if1'}], u'vxlan': [{u'local_ip': u'10.2.61.2', u'tenant_route_ip': u'192.168.135.2', u'dsport': 4789, u'dev': u't7s1if', u'subnet_route': u'10.2.61.0/24', u'remote_route': u'10.1.61.0/24', u'v_name': u'vxlan_t7s1', u'id': 42, u'remote_ip': u'10.1.61.2'}]}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t7ns1\" ip route show default | grep -w '[d]efault via 10.2.61.1' ; if [ $? -ne 0 ] ; then ip netns exec \"t7ns1\" ip route add default via \"10.2.61.1\" ; fi\n", "delta": "0:00:00.071883", "end": "2019-12-05 08:06:27.592539", "item": {"bridge_name": "t7br1", "default_route_ip": "10.2.61.1", "dns": [{"brif": [], "dhcp_end": [], "dhcp_start": [], "dnsif": [], "dnsif_ip": [], "net_mask": []}], "ns_name": "t7ns1", "route": [{"if": "p1", "ip": "10.2.61.1/24", "ns_if": "t7if", "ns_name": "t7"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t7ns1if", "tenant_ns_ip": "10.2.61.1/24", "tenant_ns_name": "t7", "tenant_sub_if": "t7s1if", "tenant_sub_ip": "10.2.61.2/24"}], "vms": [{"brif": "t7br1if1", "disk": "10G", "mem": 2, "name": "t7_VM4", "vcpu": 4, "vmif": "t7VM4if1"}], "vxlan": [{"dev": "t7s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.61.2", "remote_ip": "10.1.61.2", "remote_route": "10.1.61.0/24", "subnet_route": "10.2.61.0/24", "tenant_route_ip": "192.168.135.2", "v_name": "vxlan_t7s1"}]}, "rc": 0, "start": "2019-12-05 08:06:27.520656", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}
INFO:root: 08:06:27.971906 Printing the yaml input file
INFO:root: 08:06:27.972018 {'C1': [{'subnet_addr': '1.1.1.0/24', 'VM': [{'name': 'VM1', 'disk': '10G', 'mem': 2, 'vcpu': 4, 'internet_access': True}, {'name': 'VM2', 'disk': '10G', 'mem': 4, 'vcpu': 2, 'internet_access': False}]}], 'C2': [{'subnet_addr': '1.1.1.0/24', 'VM': [{'name': 'VM4', 'disk': '10G', 'mem': 2, 'vcpu': 4, 'internet_access': True}]}, {'subnet_addr': '2.2.2.0/24', 'VM': [{'name': 'VM3', 'disk': '10G', 'mem': 3, 'vcpu': 2, 'internet_access': True}]}], 'MISC': [{'LOG_ENABLE': True}, {'GUI': True}]}
INFO:root: 08:06:27.972127 Provided subnet in C1: 1.1.1.0/24 is valid
INFO:root: 08:06:27.972179 Provided subnet in C2: 1.1.1.0/24 is valid
INFO:root: 08:06:27.972221 Provided subnet in C2: 2.2.2.0/24 is valid
INFO:root: 08:06:39.579057 Printing the yaml input file
INFO:root: 08:06:39.579169 {'C1': [{'subnet_addr': '1.1.1.0/24', 'VM': [{'name': 'VM1', 'disk': '10G', 'mem': 2, 'vcpu': 4, 'internet_access': True}, {'name': 'VM2', 'disk': '10G', 'mem': 4, 'vcpu': 2, 'internet_access': False}]}], 'C2': [{'subnet_addr': '1.1.1.0/24', 'VM': [{'name': 'VM4', 'disk': '10G', 'mem': 2, 'vcpu': 4, 'internet_access': True}]}, {'subnet_addr': '2.2.2.0/24', 'VM': [{'name': 'VM3', 'disk': '10G', 'mem': 3, 'vcpu': 2, 'internet_access': True}]}], 'MISC': [{'LOG_ENABLE': True}, {'GUI': True}]}
INFO:root: 08:06:39.579261 Provided subnet in C1: 1.1.1.0/24 is valid
INFO:root: 08:06:39.579310 Provided subnet in C2: 1.1.1.0/24 is valid
INFO:root: 08:06:39.579352 Provided subnet in C2: 2.2.2.0/24 is valid
Using /etc/ansible/ansible.cfg as config file

PLAY [main] *************************************************************************************************************************************************

TASK [Create Tenant Namespace] ******************************************************************************************************************************
ok: [localhost] => (item={u'default_route_ip': u'192.168.9.1', u'name': u't9', u'pns_ip': u'192.168.9.1/24', u'tenant_if': u't9if', u'tenant_ip': u'192.168.9.2/24', u'pns_if': u't9pns_if'}) => {"ansible_loop_var": "item", "changed": false, "cmd": ["ip", "netns", "add", "t9"], "item": {"default_route_ip": "192.168.9.1", "name": "t9", "pns_if": "t9pns_if", "pns_ip": "192.168.9.1/24", "tenant_if": "t9if", "tenant_ip": "192.168.9.2/24"}, "rc": 0, "stdout": "skipped, since /var/run/netns/t9 exists", "stdout_lines": ["skipped, since /var/run/netns/t9 exists"]}

TASK [Create Subnet Namespace] ******************************************************************************************************************************
ok: [localhost] => (item={u'route': [{u'ip': u'10.1.81.1/24', u'ns_name': u't9', u'ns_if': u't9if', u'if': u'p1'}], u'default_route_ip': u'10.1.81.1', u'bridge_name': u't9br1', u'dns': [{u'dnsif': u't9s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't9s1_dnsbrif'}], u'ns_name': u't9ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.81.2/24', u'tenant_ns_ip': u'10.1.81.1/24', u'tenant_ns_if': u't9ns1if', u'tenant_ns_name': u't9', u'tenant_sub_if': u't9s1if'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't9_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't9br1if1', u'vmif': u't9VM1if1'}, {u'mem': 4, u'name': u't9_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't9br1if2', u'vmif': u't9VM2if1'}], u'vxlan': [{u'local_ip': u'10.1.81.2', u'tenant_route_ip': u'192.168.9.2', u'dsport': 4789, u'dev': u't9s1if', u'subnet_route': u'10.1.81.0/24', u'remote_route': u'10.2.81.0/24', u'v_name': u'vxlan_t9s1', u'id': 42, u'remote_ip': u'10.2.81.2'}]}) => {"ansible_loop_var": "item", "changed": false, "cmd": ["ip", "netns", "add", "t9ns1"], "item": {"bridge_name": "t9br1", "default_route_ip": "10.1.81.1", "dns": [{"brif": "t9s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.5", "dnsif": "t9s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t9ns1", "route": [{"if": "p1", "ip": "10.1.81.1/24", "ns_if": "t9if", "ns_name": "t9"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t9ns1if", "tenant_ns_ip": "10.1.81.1/24", "tenant_ns_name": "t9", "tenant_sub_if": "t9s1if", "tenant_sub_ip": "10.1.81.2/24"}], "vms": [{"brif": "t9br1if1", "disk": "10G", "mem": 2, "name": "t9_VM1", "vcpu": 4, "vmif": "t9VM1if1"}, {"brif": "t9br1if2", "disk": "10G", "mem": 4, "name": "t9_VM2", "vcpu": 2, "vmif": "t9VM2if1"}], "vxlan": [{"dev": "t9s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.81.2", "remote_ip": "10.2.81.2", "remote_route": "10.2.81.0/24", "subnet_route": "10.1.81.0/24", "tenant_route_ip": "192.168.9.2", "v_name": "vxlan_t9s1"}]}, "rc": 0, "stdout": "skipped, since /var/run/netns/t9ns1 exists", "stdout_lines": ["skipped, since /var/run/netns/t9ns1 exists"]}

TASK [Create Tenant VETH pairs] *****************************************************************************************************************************
changed: [localhost] => (item={u'default_route_ip': u'192.168.9.1', u'name': u't9', u'pns_ip': u'192.168.9.1/24', u'tenant_if': u't9if', u'tenant_ip': u'192.168.9.2/24', u'pns_if': u't9pns_if'}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip link show \"t9if\" ; if [ $? -ne 0 ] ; then ip link add \"t9if\" type veth peer name \"t9pns_if\" ; fi\n", "delta": "0:00:00.011130", "end": "2019-12-05 08:06:41.217876", "item": {"default_route_ip": "192.168.9.1", "name": "t9", "pns_if": "t9pns_if", "pns_ip": "192.168.9.1/24", "tenant_if": "t9if", "tenant_ip": "192.168.9.2/24"}, "rc": 0, "start": "2019-12-05 08:06:41.206746", "stderr": "Device \"t9if\" does not exist.", "stderr_lines": ["Device \"t9if\" does not exist."], "stdout": "", "stdout_lines": []}

TASK [Attach Tenant VETH Pairs] *****************************************************************************************************************************
changed: [localhost] => (item={u'default_route_ip': u'192.168.9.1', u'name': u't9', u'pns_ip': u'192.168.9.1/24', u'tenant_if': u't9if', u'tenant_ip': u'192.168.9.2/24', u'pns_if': u't9pns_if'}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec pns ip link show \"t9pns_if\" ; if [ $? -ne 0 ] ; then ip link set \"t9pns_if\" netns pns ; fi\nip netns exec \"t9\" ip link show \"t9if\" ; if [ $? -ne 0 ] ; then ip link set \"t9if\" netns \"t9\" ; fi\nip netns exec pns ip link set dev \"t9pns_if\" up\nip netns exec \"t9\" ip link set dev \"t9if\" up\n", "delta": "0:00:00.165230", "end": "2019-12-05 08:06:41.661163", "item": {"default_route_ip": "192.168.9.1", "name": "t9", "pns_if": "t9pns_if", "pns_ip": "192.168.9.1/24", "tenant_if": "t9if", "tenant_ip": "192.168.9.2/24"}, "rc": 0, "start": "2019-12-05 08:06:41.495933", "stderr": "", "stderr_lines": [], "stdout": "63: t9pns_if@if64: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP mode DEFAULT group default qlen 1000\n    link/ether 9a:8f:94:a4:88:1c brd ff:ff:ff:ff:ff:ff link-netnsid 4\n64: t9if@if63: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP mode DEFAULT group default qlen 1000\n    link/ether fa:2e:c2:35:b4:cd brd ff:ff:ff:ff:ff:ff link-netnsid 0", "stdout_lines": ["63: t9pns_if@if64: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP mode DEFAULT group default qlen 1000", "    link/ether 9a:8f:94:a4:88:1c brd ff:ff:ff:ff:ff:ff link-netnsid 4", "64: t9if@if63: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP mode DEFAULT group default qlen 1000", "    link/ether fa:2e:c2:35:b4:cd brd ff:ff:ff:ff:ff:ff link-netnsid 0"]}

TASK [Add IP addresses to Tenant VETH Pairs] ****************************************************************************************************************
changed: [localhost] => (item={u'default_route_ip': u'192.168.9.1', u'name': u't9', u'pns_ip': u'192.168.9.1/24', u'tenant_if': u't9if', u'tenant_ip': u'192.168.9.2/24', u'pns_if': u't9pns_if'}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec pns ip addr show \"t9pns_if\" | awk 'FNR==3{ print $2 }' | grep -w '^192.168.9.1/24' ; if [ $? -ne 0 ] ; then ip netns exec pns ip addr add \"192.168.9.1/24\" dev \"t9pns_if\" ; fi\nip netns exec \"t9\" ip addr show \"t9if\" | awk 'FNR==3{ print $2 }' | grep -w '^192.168.9.2/24' ; if [ $? -ne 0 ] ; then ip netns exec \"t9\" ip addr add \"192.168.9.2/24\" dev \"t9if\" ; fi\n", "delta": "0:00:00.081318", "end": "2019-12-05 08:06:42.009624", "item": {"default_route_ip": "192.168.9.1", "name": "t9", "pns_if": "t9pns_if", "pns_ip": "192.168.9.1/24", "tenant_if": "t9if", "tenant_ip": "192.168.9.2/24"}, "rc": 0, "start": "2019-12-05 08:06:41.928306", "stderr": "", "stderr_lines": [], "stdout": "192.168.9.1/24\n192.168.9.2/24", "stdout_lines": ["192.168.9.1/24", "192.168.9.2/24"]}

TASK [Create Namespace VETH Pairs] **************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.81.1/24', u'ns_name': u't9', u'ns_if': u't9if', u'if': u'p1'}], u'default_route_ip': u'10.1.81.1', u'bridge_name': u't9br1', u'dns': [{u'dnsif': u't9s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't9s1_dnsbrif'}], u'ns_name': u't9ns1', u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't9_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't9br1if1', u'vmif': u't9VM1if1'}, {u'mem': 4, u'name': u't9_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't9br1if2', u'vmif': u't9VM2if1'}], u'vxlan': [{u'local_ip': u'10.1.81.2', u'dsport': 4789, u'dev': u't9s1if', u'tenant_route_ip': u'192.168.9.2', u'remote_route': u'10.2.81.0/24', u'subnet_route': u'10.1.81.0/24', u'v_name': u'vxlan_t9s1', u'id': 42, u'remote_ip': u'10.2.81.2'}]}, {u'tenant_sub_ip': u'10.1.81.2/24', u'tenant_ns_ip': u'10.1.81.1/24', u'tenant_ns_if': u't9ns1if', u'tenant_sub_if': u't9s1if', u'tenant_ns_name': u't9'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip link show \"t9ns1if\" ; if [ $? -ne 0 ] ; then ip link add \"t9ns1if\" type veth peer name \"t9s1if\" ; fi\n", "delta": "0:00:00.015175", "end": "2019-12-05 08:06:42.305296", "item": [{"bridge_name": "t9br1", "default_route_ip": "10.1.81.1", "dns": [{"brif": "t9s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.5", "dnsif": "t9s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t9ns1", "route": [{"if": "p1", "ip": "10.1.81.1/24", "ns_if": "t9if", "ns_name": "t9"}], "subnet_ip": "1.1.1.0/24", "vms": [{"brif": "t9br1if1", "disk": "10G", "mem": 2, "name": "t9_VM1", "vcpu": 4, "vmif": "t9VM1if1"}, {"brif": "t9br1if2", "disk": "10G", "mem": 4, "name": "t9_VM2", "vcpu": 2, "vmif": "t9VM2if1"}], "vxlan": [{"dev": "t9s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.81.2", "remote_ip": "10.2.81.2", "remote_route": "10.2.81.0/24", "subnet_route": "10.1.81.0/24", "tenant_route_ip": "192.168.9.2", "v_name": "vxlan_t9s1"}]}, {"tenant_ns_if": "t9ns1if", "tenant_ns_ip": "10.1.81.1/24", "tenant_ns_name": "t9", "tenant_sub_if": "t9s1if", "tenant_sub_ip": "10.1.81.2/24"}], "rc": 0, "start": "2019-12-05 08:06:42.290121", "stderr": "Device \"t9ns1if\" does not exist.", "stderr_lines": ["Device \"t9ns1if\" does not exist."], "stdout": "", "stdout_lines": []}

TASK [Attach Namespace VETH Pairs] **************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.81.1/24', u'ns_name': u't9', u'ns_if': u't9if', u'if': u'p1'}], u'default_route_ip': u'10.1.81.1', u'bridge_name': u't9br1', u'dns': [{u'dnsif': u't9s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't9s1_dnsbrif'}], u'ns_name': u't9ns1', u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't9_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't9br1if1', u'vmif': u't9VM1if1'}, {u'mem': 4, u'name': u't9_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't9br1if2', u'vmif': u't9VM2if1'}], u'vxlan': [{u'local_ip': u'10.1.81.2', u'dsport': 4789, u'dev': u't9s1if', u'tenant_route_ip': u'192.168.9.2', u'remote_route': u'10.2.81.0/24', u'subnet_route': u'10.1.81.0/24', u'v_name': u'vxlan_t9s1', u'id': 42, u'remote_ip': u'10.2.81.2'}]}, {u'tenant_sub_ip': u'10.1.81.2/24', u'tenant_ns_ip': u'10.1.81.1/24', u'tenant_ns_if': u't9ns1if', u'tenant_sub_if': u't9s1if', u'tenant_ns_name': u't9'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t9\" ip link show \"t9ns1if\" ; if [ $? -ne 0 ] ; then ip link set \"t9ns1if\" netns \"t9\" ; fi\nip netns exec \"t9ns1\" ip link show \"t9s1if\" ; if [ $? -ne 0 ] ; then ip link set \"t9s1if\" netns \"t9ns1\" ; fi\n", "delta": "0:00:00.074285", "end": "2019-12-05 08:06:42.697256", "item": [{"bridge_name": "t9br1", "default_route_ip": "10.1.81.1", "dns": [{"brif": "t9s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.5", "dnsif": "t9s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t9ns1", "route": [{"if": "p1", "ip": "10.1.81.1/24", "ns_if": "t9if", "ns_name": "t9"}], "subnet_ip": "1.1.1.0/24", "vms": [{"brif": "t9br1if1", "disk": "10G", "mem": 2, "name": "t9_VM1", "vcpu": 4, "vmif": "t9VM1if1"}, {"brif": "t9br1if2", "disk": "10G", "mem": 4, "name": "t9_VM2", "vcpu": 2, "vmif": "t9VM2if1"}], "vxlan": [{"dev": "t9s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.81.2", "remote_ip": "10.2.81.2", "remote_route": "10.2.81.0/24", "subnet_route": "10.1.81.0/24", "tenant_route_ip": "192.168.9.2", "v_name": "vxlan_t9s1"}]}, {"tenant_ns_if": "t9ns1if", "tenant_ns_ip": "10.1.81.1/24", "tenant_ns_name": "t9", "tenant_sub_if": "t9s1if", "tenant_sub_ip": "10.1.81.2/24"}], "rc": 0, "start": "2019-12-05 08:06:42.622971", "stderr": "", "stderr_lines": [], "stdout": "66: t9ns1if@if65: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP mode DEFAULT group default qlen 1000\n    link/ether 9e:46:95:0d:d4:74 brd ff:ff:ff:ff:ff:ff link-netnsid 2\n65: t9s1if@if66: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP mode DEFAULT group default qlen 1000\n    link/ether be:31:30:99:3c:64 brd ff:ff:ff:ff:ff:ff link-netnsid 0", "stdout_lines": ["66: t9ns1if@if65: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP mode DEFAULT group default qlen 1000", "    link/ether 9e:46:95:0d:d4:74 brd ff:ff:ff:ff:ff:ff link-netnsid 2", "65: t9s1if@if66: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP mode DEFAULT group default qlen 1000", "    link/ether be:31:30:99:3c:64 brd ff:ff:ff:ff:ff:ff link-netnsid 0"]}

TASK [Set Namespace VETH Pairs UP] **************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.81.1/24', u'ns_name': u't9', u'ns_if': u't9if', u'if': u'p1'}], u'default_route_ip': u'10.1.81.1', u'bridge_name': u't9br1', u'dns': [{u'dnsif': u't9s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't9s1_dnsbrif'}], u'ns_name': u't9ns1', u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't9_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't9br1if1', u'vmif': u't9VM1if1'}, {u'mem': 4, u'name': u't9_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't9br1if2', u'vmif': u't9VM2if1'}], u'vxlan': [{u'local_ip': u'10.1.81.2', u'dsport': 4789, u'dev': u't9s1if', u'tenant_route_ip': u'192.168.9.2', u'remote_route': u'10.2.81.0/24', u'subnet_route': u'10.1.81.0/24', u'v_name': u'vxlan_t9s1', u'id': 42, u'remote_ip': u'10.2.81.2'}]}, {u'tenant_sub_ip': u'10.1.81.2/24', u'tenant_ns_ip': u'10.1.81.1/24', u'tenant_ns_if': u't9ns1if', u'tenant_sub_if': u't9s1if', u'tenant_ns_name': u't9'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t9\" ip link set dev \"t9ns1if\" up\nip netns exec \"t9ns1\" ip link set dev \"t9s1if\" up\n", "delta": "0:00:00.078305", "end": "2019-12-05 08:06:43.065159", "item": [{"bridge_name": "t9br1", "default_route_ip": "10.1.81.1", "dns": [{"brif": "t9s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.5", "dnsif": "t9s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t9ns1", "route": [{"if": "p1", "ip": "10.1.81.1/24", "ns_if": "t9if", "ns_name": "t9"}], "subnet_ip": "1.1.1.0/24", "vms": [{"brif": "t9br1if1", "disk": "10G", "mem": 2, "name": "t9_VM1", "vcpu": 4, "vmif": "t9VM1if1"}, {"brif": "t9br1if2", "disk": "10G", "mem": 4, "name": "t9_VM2", "vcpu": 2, "vmif": "t9VM2if1"}], "vxlan": [{"dev": "t9s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.81.2", "remote_ip": "10.2.81.2", "remote_route": "10.2.81.0/24", "subnet_route": "10.1.81.0/24", "tenant_route_ip": "192.168.9.2", "v_name": "vxlan_t9s1"}]}, {"tenant_ns_if": "t9ns1if", "tenant_ns_ip": "10.1.81.1/24", "tenant_ns_name": "t9", "tenant_sub_if": "t9s1if", "tenant_sub_ip": "10.1.81.2/24"}], "rc": 0, "start": "2019-12-05 08:06:42.986854", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Add IP addresses to Namespace VETH Pairs] *************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.81.1/24', u'ns_name': u't9', u'ns_if': u't9if', u'if': u'p1'}], u'default_route_ip': u'10.1.81.1', u'bridge_name': u't9br1', u'dns': [{u'dnsif': u't9s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't9s1_dnsbrif'}], u'ns_name': u't9ns1', u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't9_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't9br1if1', u'vmif': u't9VM1if1'}, {u'mem': 4, u'name': u't9_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't9br1if2', u'vmif': u't9VM2if1'}], u'vxlan': [{u'local_ip': u'10.1.81.2', u'dsport': 4789, u'dev': u't9s1if', u'tenant_route_ip': u'192.168.9.2', u'remote_route': u'10.2.81.0/24', u'subnet_route': u'10.1.81.0/24', u'v_name': u'vxlan_t9s1', u'id': 42, u'remote_ip': u'10.2.81.2'}]}, {u'tenant_sub_ip': u'10.1.81.2/24', u'tenant_ns_ip': u'10.1.81.1/24', u'tenant_ns_if': u't9ns1if', u'tenant_sub_if': u't9s1if', u'tenant_ns_name': u't9'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t9ns1\" ip addr show \"t9s1if\" | awk 'FNR==3{ print $2 }' | grep -w '^10.1.81.2/24' ; if [ $? -ne 0 ] ; then ip netns exec \"t9ns1\" ip addr add \"10.1.81.2/24\" dev \"t9s1if\" ; fi\n\nip netns exec \"t9\" ip addr show \"t9ns1if\" | awk 'FNR==3{ print $2 }' | grep -w '^10.1.81.1/24' ; if [ $? -ne 0 ] ; then ip netns exec \"t9\" ip addr add \"10.1.81.1/24\" dev \"t9ns1if\" ; fi\n", "delta": "0:00:00.073196", "end": "2019-12-05 08:06:43.409723", "item": [{"bridge_name": "t9br1", "default_route_ip": "10.1.81.1", "dns": [{"brif": "t9s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.5", "dnsif": "t9s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t9ns1", "route": [{"if": "p1", "ip": "10.1.81.1/24", "ns_if": "t9if", "ns_name": "t9"}], "subnet_ip": "1.1.1.0/24", "vms": [{"brif": "t9br1if1", "disk": "10G", "mem": 2, "name": "t9_VM1", "vcpu": 4, "vmif": "t9VM1if1"}, {"brif": "t9br1if2", "disk": "10G", "mem": 4, "name": "t9_VM2", "vcpu": 2, "vmif": "t9VM2if1"}], "vxlan": [{"dev": "t9s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.81.2", "remote_ip": "10.2.81.2", "remote_route": "10.2.81.0/24", "subnet_route": "10.1.81.0/24", "tenant_route_ip": "192.168.9.2", "v_name": "vxlan_t9s1"}]}, {"tenant_ns_if": "t9ns1if", "tenant_ns_ip": "10.1.81.1/24", "tenant_ns_name": "t9", "tenant_sub_if": "t9s1if", "tenant_sub_ip": "10.1.81.2/24"}], "rc": 0, "start": "2019-12-05 08:06:43.336527", "stderr": "", "stderr_lines": [], "stdout": "10.1.81.2/24\n10.1.81.1/24", "stdout_lines": ["10.1.81.2/24", "10.1.81.1/24"]}

TASK [Add IP Route to Tenant] *******************************************************************************************************************************
changed: [localhost] => (item={u'default_route_ip': u'192.168.9.1', u'name': u't9', u'pns_ip': u'192.168.9.1/24', u'tenant_if': u't9if', u'tenant_ip': u'192.168.9.2/24', u'pns_if': u't9pns_if'}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t9\" ip route show default | grep -w '[d]efault via 192.168.9.1' ; if [ $? -ne 0 ] ; then ip netns exec \"t9\" ip route add default via \"192.168.9.1\" ; fi\n", "delta": "0:00:00.048233", "end": "2019-12-05 08:06:43.769627", "item": {"default_route_ip": "192.168.9.1", "name": "t9", "pns_if": "t9pns_if", "pns_ip": "192.168.9.1/24", "tenant_if": "t9if", "tenant_ip": "192.168.9.2/24"}, "rc": 0, "start": "2019-12-05 08:06:43.721394", "stderr": "", "stderr_lines": [], "stdout": "default via 192.168.9.1 dev t9if ", "stdout_lines": ["default via 192.168.9.1 dev t9if "]}

TASK [Add IP Route to Tenant Subnet] ************************************************************************************************************************
INFO:root: 08:07:22.124364 Printing the yaml input file
INFO:root: 08:07:22.124511 {'C1': [{'subnet_addr': '1.1.1.0/24', 'VM': [{'name': 'VM1', 'disk': '10G', 'mem': 2, 'vcpu': 4, 'internet_access': True}, {'name': 'VM2', 'disk': '10G', 'mem': 4, 'vcpu': 2, 'internet_access': False}]}], 'C2': [{'subnet_addr': '1.1.1.0/24', 'VM': [{'name': 'VM4', 'disk': '10G', 'mem': 2, 'vcpu': 4, 'internet_access': True}]}, {'subnet_addr': '2.2.2.0/24', 'VM': [{'name': 'VM3', 'disk': '10G', 'mem': 3, 'vcpu': 2, 'internet_access': True}]}], 'MISC': [{'LOG_ENABLE': True}, {'GUI': True}]}
INFO:root: 08:07:22.124611 Provided subnet in C1: 1.1.1.0/24 is valid
INFO:root: 08:07:22.124662 Provided subnet in C2: 1.1.1.0/24 is valid
INFO:root: 08:07:22.124704 Provided subnet in C2: 2.2.2.0/24 is valid
Using /etc/ansible/ansible.cfg as config file

PLAY [main] *************************************************************************************************************************************************

TASK [Create Tenant Namespace] ******************************************************************************************************************************
ok: [localhost] => (item={u'default_route_ip': u'192.168.0.1', u'name': u't10', u'pns_ip': u'192.168.0.1/24', u'tenant_if': u't10if', u'tenant_ip': u'192.168.0.2/24', u'pns_if': u't10pns_if'}) => {"ansible_loop_var": "item", "changed": false, "cmd": ["ip", "netns", "add", "t10"], "item": {"default_route_ip": "192.168.0.1", "name": "t10", "pns_if": "t10pns_if", "pns_ip": "192.168.0.1/24", "tenant_if": "t10if", "tenant_ip": "192.168.0.2/24"}, "rc": 0, "stdout": "skipped, since /var/run/netns/t10 exists", "stdout_lines": ["skipped, since /var/run/netns/t10 exists"]}

TASK [Create Subnet Namespace] ******************************************************************************************************************************
ok: [localhost] => (item={u'route': [{u'ip': u'10.1.-9.1/24', u'ns_name': u't10', u'ns_if': u't10if', u'if': u'p1'}], u'default_route_ip': u'10.1.-9.1', u'bridge_name': u't10br1', u'dns': [{u'dnsif': u't10s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't10s1_dnsbrif'}], u'ns_name': u't10ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.-9.2/24', u'tenant_ns_ip': u'10.1.-9.1/24', u'tenant_ns_if': u't10ns1if', u'tenant_ns_name': u't10', u'tenant_sub_if': u't10s1if'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't10_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't10br1if1', u'vmif': u't10VM1if1'}, {u'mem': 4, u'name': u't10_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't10br1if2', u'vmif': u't10VM2if1'}], u'vxlan': [{u'local_ip': u'10.1.-9.2', u'tenant_route_ip': u'192.168.0.2', u'dsport': 4789, u'dev': u't10s1if', u'subnet_route': u'10.1.-9.0/24', u'remote_route': u'10.2.-9.0/24', u'v_name': u'vxlan_t10s1', u'id': 42, u'remote_ip': u'10.2.-9.2'}]}) => {"ansible_loop_var": "item", "changed": false, "cmd": ["ip", "netns", "add", "t10ns1"], "item": {"bridge_name": "t10br1", "default_route_ip": "10.1.-9.1", "dns": [{"brif": "t10s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.5", "dnsif": "t10s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t10ns1", "route": [{"if": "p1", "ip": "10.1.-9.1/24", "ns_if": "t10if", "ns_name": "t10"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t10ns1if", "tenant_ns_ip": "10.1.-9.1/24", "tenant_ns_name": "t10", "tenant_sub_if": "t10s1if", "tenant_sub_ip": "10.1.-9.2/24"}], "vms": [{"brif": "t10br1if1", "disk": "10G", "mem": 2, "name": "t10_VM1", "vcpu": 4, "vmif": "t10VM1if1"}, {"brif": "t10br1if2", "disk": "10G", "mem": 4, "name": "t10_VM2", "vcpu": 2, "vmif": "t10VM2if1"}], "vxlan": [{"dev": "t10s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.-9.2", "remote_ip": "10.2.-9.2", "remote_route": "10.2.-9.0/24", "subnet_route": "10.1.-9.0/24", "tenant_route_ip": "192.168.0.2", "v_name": "vxlan_t10s1"}]}, "rc": 0, "stdout": "skipped, since /var/run/netns/t10ns1 exists", "stdout_lines": ["skipped, since /var/run/netns/t10ns1 exists"]}

TASK [Create Tenant VETH pairs] *****************************************************************************************************************************
changed: [localhost] => (item={u'default_route_ip': u'192.168.0.1', u'name': u't10', u'pns_ip': u'192.168.0.1/24', u'tenant_if': u't10if', u'tenant_ip': u'192.168.0.2/24', u'pns_if': u't10pns_if'}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip link show \"t10if\" ; if [ $? -ne 0 ] ; then ip link add \"t10if\" type veth peer name \"t10pns_if\" ; fi\n", "delta": "0:00:00.012610", "end": "2019-12-05 08:07:23.964716", "item": {"default_route_ip": "192.168.0.1", "name": "t10", "pns_if": "t10pns_if", "pns_ip": "192.168.0.1/24", "tenant_if": "t10if", "tenant_ip": "192.168.0.2/24"}, "rc": 0, "start": "2019-12-05 08:07:23.952106", "stderr": "Device \"t10if\" does not exist.", "stderr_lines": ["Device \"t10if\" does not exist."], "stdout": "", "stdout_lines": []}

TASK [Attach Tenant VETH Pairs] *****************************************************************************************************************************
changed: [localhost] => (item={u'default_route_ip': u'192.168.0.1', u'name': u't10', u'pns_ip': u'192.168.0.1/24', u'tenant_if': u't10if', u'tenant_ip': u'192.168.0.2/24', u'pns_if': u't10pns_if'}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec pns ip link show \"t10pns_if\" ; if [ $? -ne 0 ] ; then ip link set \"t10pns_if\" netns pns ; fi\nip netns exec \"t10\" ip link show \"t10if\" ; if [ $? -ne 0 ] ; then ip link set \"t10if\" netns \"t10\" ; fi\nip netns exec pns ip link set dev \"t10pns_if\" up\nip netns exec \"t10\" ip link set dev \"t10if\" up\n", "delta": "0:00:00.174281", "end": "2019-12-05 08:07:24.457245", "item": {"default_route_ip": "192.168.0.1", "name": "t10", "pns_if": "t10pns_if", "pns_ip": "192.168.0.1/24", "tenant_if": "t10if", "tenant_ip": "192.168.0.2/24"}, "rc": 0, "start": "2019-12-05 08:07:24.282964", "stderr": "", "stderr_lines": [], "stdout": "71: t10pns_if@if72: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP mode DEFAULT group default qlen 1000\n    link/ether fe:a1:fc:74:4f:d7 brd ff:ff:ff:ff:ff:ff link-netnsid 5\n72: t10if@if71: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP mode DEFAULT group default qlen 1000\n    link/ether 3a:e1:62:80:a7:91 brd ff:ff:ff:ff:ff:ff link-netnsid 0", "stdout_lines": ["71: t10pns_if@if72: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP mode DEFAULT group default qlen 1000", "    link/ether fe:a1:fc:74:4f:d7 brd ff:ff:ff:ff:ff:ff link-netnsid 5", "72: t10if@if71: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP mode DEFAULT group default qlen 1000", "    link/ether 3a:e1:62:80:a7:91 brd ff:ff:ff:ff:ff:ff link-netnsid 0"]}

TASK [Add IP addresses to Tenant VETH Pairs] ****************************************************************************************************************
changed: [localhost] => (item={u'default_route_ip': u'192.168.0.1', u'name': u't10', u'pns_ip': u'192.168.0.1/24', u'tenant_if': u't10if', u'tenant_ip': u'192.168.0.2/24', u'pns_if': u't10pns_if'}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec pns ip addr show \"t10pns_if\" | awk 'FNR==3{ print $2 }' | grep -w '^192.168.0.1/24' ; if [ $? -ne 0 ] ; then ip netns exec pns ip addr add \"192.168.0.1/24\" dev \"t10pns_if\" ; fi\nip netns exec \"t10\" ip addr show \"t10if\" | awk 'FNR==3{ print $2 }' | grep -w '^192.168.0.2/24' ; if [ $? -ne 0 ] ; then ip netns exec \"t10\" ip addr add \"192.168.0.2/24\" dev \"t10if\" ; fi\n", "delta": "0:00:00.084596", "end": "2019-12-05 08:07:24.841384", "item": {"default_route_ip": "192.168.0.1", "name": "t10", "pns_if": "t10pns_if", "pns_ip": "192.168.0.1/24", "tenant_if": "t10if", "tenant_ip": "192.168.0.2/24"}, "rc": 0, "start": "2019-12-05 08:07:24.756788", "stderr": "", "stderr_lines": [], "stdout": "192.168.0.1/24\n192.168.0.2/24", "stdout_lines": ["192.168.0.1/24", "192.168.0.2/24"]}

TASK [Create Namespace VETH Pairs] **************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.-9.1/24', u'ns_name': u't10', u'ns_if': u't10if', u'if': u'p1'}], u'default_route_ip': u'10.1.-9.1', u'bridge_name': u't10br1', u'dns': [{u'dnsif': u't10s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't10s1_dnsbrif'}], u'ns_name': u't10ns1', u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't10_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't10br1if1', u'vmif': u't10VM1if1'}, {u'mem': 4, u'name': u't10_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't10br1if2', u'vmif': u't10VM2if1'}], u'vxlan': [{u'local_ip': u'10.1.-9.2', u'dsport': 4789, u'dev': u't10s1if', u'tenant_route_ip': u'192.168.0.2', u'remote_route': u'10.2.-9.0/24', u'subnet_route': u'10.1.-9.0/24', u'v_name': u'vxlan_t10s1', u'id': 42, u'remote_ip': u'10.2.-9.2'}]}, {u'tenant_sub_ip': u'10.1.-9.2/24', u'tenant_ns_ip': u'10.1.-9.1/24', u'tenant_ns_if': u't10ns1if', u'tenant_sub_if': u't10s1if', u'tenant_ns_name': u't10'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip link show \"t10ns1if\" ; if [ $? -ne 0 ] ; then ip link add \"t10ns1if\" type veth peer name \"t10s1if\" ; fi\n", "delta": "0:00:00.017426", "end": "2019-12-05 08:07:25.145133", "item": [{"bridge_name": "t10br1", "default_route_ip": "10.1.-9.1", "dns": [{"brif": "t10s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.5", "dnsif": "t10s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t10ns1", "route": [{"if": "p1", "ip": "10.1.-9.1/24", "ns_if": "t10if", "ns_name": "t10"}], "subnet_ip": "1.1.1.0/24", "vms": [{"brif": "t10br1if1", "disk": "10G", "mem": 2, "name": "t10_VM1", "vcpu": 4, "vmif": "t10VM1if1"}, {"brif": "t10br1if2", "disk": "10G", "mem": 4, "name": "t10_VM2", "vcpu": 2, "vmif": "t10VM2if1"}], "vxlan": [{"dev": "t10s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.-9.2", "remote_ip": "10.2.-9.2", "remote_route": "10.2.-9.0/24", "subnet_route": "10.1.-9.0/24", "tenant_route_ip": "192.168.0.2", "v_name": "vxlan_t10s1"}]}, {"tenant_ns_if": "t10ns1if", "tenant_ns_ip": "10.1.-9.1/24", "tenant_ns_name": "t10", "tenant_sub_if": "t10s1if", "tenant_sub_ip": "10.1.-9.2/24"}], "rc": 0, "start": "2019-12-05 08:07:25.127707", "stderr": "Device \"t10ns1if\" does not exist.", "stderr_lines": ["Device \"t10ns1if\" does not exist."], "stdout": "", "stdout_lines": []}

TASK [Attach Namespace VETH Pairs] **************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.-9.1/24', u'ns_name': u't10', u'ns_if': u't10if', u'if': u'p1'}], u'default_route_ip': u'10.1.-9.1', u'bridge_name': u't10br1', u'dns': [{u'dnsif': u't10s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't10s1_dnsbrif'}], u'ns_name': u't10ns1', u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't10_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't10br1if1', u'vmif': u't10VM1if1'}, {u'mem': 4, u'name': u't10_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't10br1if2', u'vmif': u't10VM2if1'}], u'vxlan': [{u'local_ip': u'10.1.-9.2', u'dsport': 4789, u'dev': u't10s1if', u'tenant_route_ip': u'192.168.0.2', u'remote_route': u'10.2.-9.0/24', u'subnet_route': u'10.1.-9.0/24', u'v_name': u'vxlan_t10s1', u'id': 42, u'remote_ip': u'10.2.-9.2'}]}, {u'tenant_sub_ip': u'10.1.-9.2/24', u'tenant_ns_ip': u'10.1.-9.1/24', u'tenant_ns_if': u't10ns1if', u'tenant_sub_if': u't10s1if', u'tenant_ns_name': u't10'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t10\" ip link show \"t10ns1if\" ; if [ $? -ne 0 ] ; then ip link set \"t10ns1if\" netns \"t10\" ; fi\nip netns exec \"t10ns1\" ip link show \"t10s1if\" ; if [ $? -ne 0 ] ; then ip link set \"t10s1if\" netns \"t10ns1\" ; fi\n", "delta": "0:00:00.071415", "end": "2019-12-05 08:07:25.489282", "item": [{"bridge_name": "t10br1", "default_route_ip": "10.1.-9.1", "dns": [{"brif": "t10s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.5", "dnsif": "t10s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t10ns1", "route": [{"if": "p1", "ip": "10.1.-9.1/24", "ns_if": "t10if", "ns_name": "t10"}], "subnet_ip": "1.1.1.0/24", "vms": [{"brif": "t10br1if1", "disk": "10G", "mem": 2, "name": "t10_VM1", "vcpu": 4, "vmif": "t10VM1if1"}, {"brif": "t10br1if2", "disk": "10G", "mem": 4, "name": "t10_VM2", "vcpu": 2, "vmif": "t10VM2if1"}], "vxlan": [{"dev": "t10s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.-9.2", "remote_ip": "10.2.-9.2", "remote_route": "10.2.-9.0/24", "subnet_route": "10.1.-9.0/24", "tenant_route_ip": "192.168.0.2", "v_name": "vxlan_t10s1"}]}, {"tenant_ns_if": "t10ns1if", "tenant_ns_ip": "10.1.-9.1/24", "tenant_ns_name": "t10", "tenant_sub_if": "t10s1if", "tenant_sub_ip": "10.1.-9.2/24"}], "rc": 0, "start": "2019-12-05 08:07:25.417867", "stderr": "", "stderr_lines": [], "stdout": "74: t10ns1if@if73: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP mode DEFAULT group default qlen 1000\n    link/ether 7e:6f:7f:d2:99:35 brd ff:ff:ff:ff:ff:ff link-netnsid 2\n73: t10s1if@if74: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP mode DEFAULT group default qlen 1000\n    link/ether ea:e3:61:f9:3c:42 brd ff:ff:ff:ff:ff:ff link-netnsid 0", "stdout_lines": ["74: t10ns1if@if73: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP mode DEFAULT group default qlen 1000", "    link/ether 7e:6f:7f:d2:99:35 brd ff:ff:ff:ff:ff:ff link-netnsid 2", "73: t10s1if@if74: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP mode DEFAULT group default qlen 1000", "    link/ether ea:e3:61:f9:3c:42 brd ff:ff:ff:ff:ff:ff link-netnsid 0"]}

TASK [Set Namespace VETH Pairs UP] **************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.-9.1/24', u'ns_name': u't10', u'ns_if': u't10if', u'if': u'p1'}], u'default_route_ip': u'10.1.-9.1', u'bridge_name': u't10br1', u'dns': [{u'dnsif': u't10s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't10s1_dnsbrif'}], u'ns_name': u't10ns1', u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't10_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't10br1if1', u'vmif': u't10VM1if1'}, {u'mem': 4, u'name': u't10_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't10br1if2', u'vmif': u't10VM2if1'}], u'vxlan': [{u'local_ip': u'10.1.-9.2', u'dsport': 4789, u'dev': u't10s1if', u'tenant_route_ip': u'192.168.0.2', u'remote_route': u'10.2.-9.0/24', u'subnet_route': u'10.1.-9.0/24', u'v_name': u'vxlan_t10s1', u'id': 42, u'remote_ip': u'10.2.-9.2'}]}, {u'tenant_sub_ip': u'10.1.-9.2/24', u'tenant_ns_ip': u'10.1.-9.1/24', u'tenant_ns_if': u't10ns1if', u'tenant_sub_if': u't10s1if', u'tenant_ns_name': u't10'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t10\" ip link set dev \"t10ns1if\" up\nip netns exec \"t10ns1\" ip link set dev \"t10s1if\" up\n", "delta": "0:00:00.087657", "end": "2019-12-05 08:07:25.913421", "item": [{"bridge_name": "t10br1", "default_route_ip": "10.1.-9.1", "dns": [{"brif": "t10s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.5", "dnsif": "t10s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t10ns1", "route": [{"if": "p1", "ip": "10.1.-9.1/24", "ns_if": "t10if", "ns_name": "t10"}], "subnet_ip": "1.1.1.0/24", "vms": [{"brif": "t10br1if1", "disk": "10G", "mem": 2, "name": "t10_VM1", "vcpu": 4, "vmif": "t10VM1if1"}, {"brif": "t10br1if2", "disk": "10G", "mem": 4, "name": "t10_VM2", "vcpu": 2, "vmif": "t10VM2if1"}], "vxlan": [{"dev": "t10s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.-9.2", "remote_ip": "10.2.-9.2", "remote_route": "10.2.-9.0/24", "subnet_route": "10.1.-9.0/24", "tenant_route_ip": "192.168.0.2", "v_name": "vxlan_t10s1"}]}, {"tenant_ns_if": "t10ns1if", "tenant_ns_ip": "10.1.-9.1/24", "tenant_ns_name": "t10", "tenant_sub_if": "t10s1if", "tenant_sub_ip": "10.1.-9.2/24"}], "rc": 0, "start": "2019-12-05 08:07:25.825764", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Add IP addresses to Namespace VETH Pairs] *************************************************************************************************************
failed: [localhost] (item=[{u'route': [{u'ip': u'10.1.-9.1/24', u'ns_name': u't10', u'ns_if': u't10if', u'if': u'p1'}], u'default_route_ip': u'10.1.-9.1', u'bridge_name': u't10br1', u'dns': [{u'dnsif': u't10s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't10s1_dnsbrif'}], u'ns_name': u't10ns1', u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't10_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't10br1if1', u'vmif': u't10VM1if1'}, {u'mem': 4, u'name': u't10_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't10br1if2', u'vmif': u't10VM2if1'}], u'vxlan': [{u'local_ip': u'10.1.-9.2', u'dsport': 4789, u'dev': u't10s1if', u'tenant_route_ip': u'192.168.0.2', u'remote_route': u'10.2.-9.0/24', u'subnet_route': u'10.1.-9.0/24', u'v_name': u'vxlan_t10s1', u'id': 42, u'remote_ip': u'10.2.-9.2'}]}, {u'tenant_sub_ip': u'10.1.-9.2/24', u'tenant_ns_ip': u'10.1.-9.1/24', u'tenant_ns_if': u't10ns1if', u'tenant_sub_if': u't10s1if', u'tenant_ns_name': u't10'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t10ns1\" ip addr show \"t10s1if\" | awk 'FNR==3{ print $2 }' | grep -w '^10.1.-9.2/24' ; if [ $? -ne 0 ] ; then ip netns exec \"t10ns1\" ip addr add \"10.1.-9.2/24\" dev \"t10s1if\" ; fi\n\nip netns exec \"t10\" ip addr show \"t10ns1if\" | awk 'FNR==3{ print $2 }' | grep -w '^10.1.-9.1/24' ; if [ $? -ne 0 ] ; then ip netns exec \"t10\" ip addr add \"10.1.-9.1/24\" dev \"t10ns1if\" ; fi\n", "delta": "0:00:00.145823", "end": "2019-12-05 08:07:26.389233", "item": [{"bridge_name": "t10br1", "default_route_ip": "10.1.-9.1", "dns": [{"brif": "t10s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.5", "dnsif": "t10s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t10ns1", "route": [{"if": "p1", "ip": "10.1.-9.1/24", "ns_if": "t10if", "ns_name": "t10"}], "subnet_ip": "1.1.1.0/24", "vms": [{"brif": "t10br1if1", "disk": "10G", "mem": 2, "name": "t10_VM1", "vcpu": 4, "vmif": "t10VM1if1"}, {"brif": "t10br1if2", "disk": "10G", "mem": 4, "name": "t10_VM2", "vcpu": 2, "vmif": "t10VM2if1"}], "vxlan": [{"dev": "t10s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.-9.2", "remote_ip": "10.2.-9.2", "remote_route": "10.2.-9.0/24", "subnet_route": "10.1.-9.0/24", "tenant_route_ip": "192.168.0.2", "v_name": "vxlan_t10s1"}]}, {"tenant_ns_if": "t10ns1if", "tenant_ns_ip": "10.1.-9.1/24", "tenant_ns_name": "t10", "tenant_sub_if": "t10s1if", "tenant_sub_ip": "10.1.-9.2/24"}], "msg": "non-zero return code", "rc": 1, "start": "2019-12-05 08:07:26.243410", "stderr": "Error: any valid prefix is expected rather than \"10.1.-9.2/24\".\nError: any valid prefix is expected rather than \"10.1.-9.1/24\".", "stderr_lines": ["Error: any valid prefix is expected rather than \"10.1.-9.2/24\".", "Error: any valid prefix is expected rather than \"10.1.-9.1/24\"."], "stdout": "", "stdout_lines": []}

PLAY RECAP **************************************************************************************************************************************************
localhost                  : ok=8    changed=6    unreachable=0    failed=1    skipped=0    rescued=0    ignored=0   

INFO:root: 08:07:26.554648 Printing the yaml input file
INFO:root: 08:07:26.554800 {'C1': [{'subnet_addr': '1.1.1.0/24', 'VM': [{'name': 'VM1', 'disk': '10G', 'mem': 2, 'vcpu': 4, 'internet_access': True}, {'name': 'VM2', 'disk': '10G', 'mem': 4, 'vcpu': 2, 'internet_access': False}]}], 'C2': [{'subnet_addr': '1.1.1.0/24', 'VM': [{'name': 'VM4', 'disk': '10G', 'mem': 2, 'vcpu': 4, 'internet_access': True}]}, {'subnet_addr': '2.2.2.0/24', 'VM': [{'name': 'VM3', 'disk': '10G', 'mem': 3, 'vcpu': 2, 'internet_access': True}]}], 'MISC': [{'LOG_ENABLE': True}, {'GUI': True}]}
INFO:root: 08:07:26.554925 Provided subnet in C1: 1.1.1.0/24 is valid
INFO:root: 08:07:26.554974 Provided subnet in C2: 1.1.1.0/24 is valid
INFO:root: 08:07:26.555013 Provided subnet in C2: 2.2.2.0/24 is valid
INFO:root: 08:07:35.788290 Printing the yaml input file
INFO:root: 08:07:35.788408 {'C1': [{'subnet_addr': '1.1.1.0/24', 'VM': [{'name': 'VM1', 'disk': '10G', 'mem': 2, 'vcpu': 4, 'internet_access': True}, {'name': 'VM2', 'disk': '10G', 'mem': 4, 'vcpu': 2, 'internet_access': False}]}], 'C2': [{'subnet_addr': '1.1.1.0/24', 'VM': [{'name': 'VM4', 'disk': '10G', 'mem': 2, 'vcpu': 4, 'internet_access': True}]}, {'subnet_addr': '2.2.2.0/24', 'VM': [{'name': 'VM3', 'disk': '10G', 'mem': 3, 'vcpu': 2, 'internet_access': True}]}], 'MISC': [{'LOG_ENABLE': True}, {'GUI': True}]}
INFO:root: 08:07:35.788535 Provided subnet in C1: 1.1.1.0/24 is valid
INFO:root: 08:07:35.788586 Provided subnet in C2: 1.1.1.0/24 is valid
INFO:root: 08:07:35.788627 Provided subnet in C2: 2.2.2.0/24 is valid
INFO:root: 08:07:40.232410 Printing the yaml input file
INFO:root: 08:07:40.232561 {'C1': [{'subnet_addr': '1.1.1.0/24', 'VM': [{'name': 'VM1', 'disk': '10G', 'mem': 2, 'vcpu': 4, 'internet_access': True}, {'name': 'VM2', 'disk': '10G', 'mem': 4, 'vcpu': 2, 'internet_access': False}]}], 'C2': [{'subnet_addr': '1.1.1.0/24', 'VM': [{'name': 'VM4', 'disk': '10G', 'mem': 2, 'vcpu': 4, 'internet_access': True}]}, {'subnet_addr': '2.2.2.0/24', 'VM': [{'name': 'VM3', 'disk': '10G', 'mem': 3, 'vcpu': 2, 'internet_access': True}]}], 'MISC': [{'LOG_ENABLE': True}, {'GUI': True}]}
INFO:root: 08:07:40.232660 Provided subnet in C1: 1.1.1.0/24 is valid
INFO:root: 08:07:40.232712 Provided subnet in C2: 1.1.1.0/24 is valid
INFO:root: 08:07:40.232755 Provided subnet in C2: 2.2.2.0/24 is valid
INFO:root: 08:08:14.738263 Printing the yaml input file
INFO:root: 08:08:14.738430 {'C1': [{'subnet_addr': '1.1.1.0/24', 'VM': [{'name': 'VM1', 'disk': '10G', 'mem': 2, 'vcpu': 4, 'internet_access': True}, {'name': 'VM2', 'disk': '10G', 'mem': 4, 'vcpu': 2, 'internet_access': False}]}], 'C2': [{'subnet_addr': '1.1.1.0/24', 'VM': [{'name': 'VM4', 'disk': '10G', 'mem': 2, 'vcpu': 4, 'internet_access': True}]}, {'subnet_addr': '2.2.2.0/24', 'VM': [{'name': 'VM3', 'disk': '10G', 'mem': 3, 'vcpu': 2, 'internet_access': True}]}], 'MISC': [{'LOG_ENABLE': True}, {'GUI': True}]}
INFO:root: 08:08:14.738571 Provided subnet in C1: 1.1.1.0/24 is valid
INFO:root: 08:08:14.738671 Provided subnet in C2: 1.1.1.0/24 is valid
INFO:root: 08:08:14.738734 Provided subnet in C2: 2.2.2.0/24 is valid
Using /etc/ansible/ansible.cfg as config file

PLAY [main] *************************************************************************************************************************************************

TASK [Create Tenant Namespace] ******************************************************************************************************************************
ok: [localhost] => (item={u'default_route_ip': u'192.168.3.1', u'name': u't3', u'pns_ip': u'192.168.3.1/24', u'tenant_if': u't3if', u'tenant_ip': u'192.168.3.2/24', u'pns_if': u't3pns_if'}) => {"ansible_loop_var": "item", "changed": false, "cmd": ["ip", "netns", "add", "t3"], "item": {"default_route_ip": "192.168.3.1", "name": "t3", "pns_if": "t3pns_if", "pns_ip": "192.168.3.1/24", "tenant_if": "t3if", "tenant_ip": "192.168.3.2/24"}, "rc": 0, "stdout": "skipped, since /var/run/netns/t3 exists", "stdout_lines": ["skipped, since /var/run/netns/t3 exists"]}

TASK [Create Subnet Namespace] ******************************************************************************************************************************
ok: [localhost] => (item={u'route': [{u'ip': u'10.1.21.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.1.21.1', u'bridge_name': u't3br1', u'dns': [{u'dnsif': u't3s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't3s1_dnsbrif'}], u'ns_name': u't3ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.21.2/24', u'tenant_ns_ip': u'10.1.21.1/24', u'tenant_ns_if': u't3ns1if', u'tenant_ns_name': u't3', u'tenant_sub_if': u't3s1if'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't3_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't3br1if1', u'vmif': u't3VM1if1'}, {u'mem': 4, u'name': u't3_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't3br1if2', u'vmif': u't3VM2if1'}], u'vxlan': [{u'local_ip': u'10.1.21.2', u'tenant_route_ip': u'192.168.3.2', u'dsport': 4789, u'dev': u't3s1if', u'subnet_route': u'10.1.21.0/24', u'remote_route': u'10.2.21.0/24', u'v_name': u'vxlan_t3s1', u'id': 42, u'remote_ip': u'10.2.21.2'}]}) => {"ansible_loop_var": "item", "changed": false, "cmd": ["ip", "netns", "add", "t3ns1"], "item": {"bridge_name": "t3br1", "default_route_ip": "10.1.21.1", "dns": [{"brif": "t3s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.5", "dnsif": "t3s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t3ns1", "route": [{"if": "p1", "ip": "10.1.21.1/24", "ns_if": "t3if", "ns_name": "t3"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t3ns1if", "tenant_ns_ip": "10.1.21.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s1if", "tenant_sub_ip": "10.1.21.2/24"}], "vms": [{"brif": "t3br1if1", "disk": "10G", "mem": 2, "name": "t3_VM1", "vcpu": 4, "vmif": "t3VM1if1"}, {"brif": "t3br1if2", "disk": "10G", "mem": 4, "name": "t3_VM2", "vcpu": 2, "vmif": "t3VM2if1"}], "vxlan": [{"dev": "t3s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.21.2", "remote_ip": "10.2.21.2", "remote_route": "10.2.21.0/24", "subnet_route": "10.1.21.0/24", "tenant_route_ip": "192.168.3.2", "v_name": "vxlan_t3s1"}]}, "rc": 0, "stdout": "skipped, since /var/run/netns/t3ns1 exists", "stdout_lines": ["skipped, since /var/run/netns/t3ns1 exists"]}

TASK [Create Tenant VETH pairs] *****************************************************************************************************************************
changed: [localhost] => (item={u'default_route_ip': u'192.168.3.1', u'name': u't3', u'pns_ip': u'192.168.3.1/24', u'tenant_if': u't3if', u'tenant_ip': u'192.168.3.2/24', u'pns_if': u't3pns_if'}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip link show \"t3if\" ; if [ $? -ne 0 ] ; then ip link add \"t3if\" type veth peer name \"t3pns_if\" ; fi\n", "delta": "0:00:00.012693", "end": "2019-12-05 08:08:16.444447", "item": {"default_route_ip": "192.168.3.1", "name": "t3", "pns_if": "t3pns_if", "pns_ip": "192.168.3.1/24", "tenant_if": "t3if", "tenant_ip": "192.168.3.2/24"}, "rc": 0, "start": "2019-12-05 08:08:16.431754", "stderr": "Device \"t3if\" does not exist.", "stderr_lines": ["Device \"t3if\" does not exist."], "stdout": "", "stdout_lines": []}

TASK [Attach Tenant VETH Pairs] *****************************************************************************************************************************
=======
99.99.99.2                 : ok=6    changed=3    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0   

INFO:root: 06:54:26.990999 The subnet 1.1.1.0/24 is present in Cloud 1
INFO:root: 06:54:26.991239 The subnet 1.1.1.0/24 is present in Cloud 2
INFO:root: 06:54:26.991286 The VM VM1 is present in Cloud 1
INFO:root: 06:54:26.991323 The VM VM4 is present in Cloud 2
INFO:root: 06:54:26.991386 The subnet 1.1.1.0/24 is present in destination cloud
INFO:root: 06:54:26.991443 The subnet 1.1.1.0/24 is present in destination cloud
INFO:root: 06:54:27.238345 source cloud is C1
INFO:root: 06:54:27.239862 source cloud is C2
INFO:paramiko.transport:Connected (version 2.0, client OpenSSH_7.6p1)
INFO:paramiko.transport:Authentication (publickey) successful!
>>>>>>> a666be77f24446cb6b8080d865af191ba109176a
