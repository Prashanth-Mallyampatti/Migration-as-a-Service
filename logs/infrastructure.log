INFO:root: 12:35:00.153930 Printing the yaml input file
INFO:root: 12:35:00.154085 {'C1': [{'subnet_addr': '1.1.1.0/24', 'VM': [{'name': 'VM1', 'disk': '10G', 'mem': 2, 'vcpu': 4}]}, {'subnet_addr': '2.2.2.0/24', 'VM': [{'name': 'VM3', 'disk': '10G', 'mem': 3, 'vcpu': 2}]}], 'C2': [{'subnet_addr': '1.1.1.0/24', 'VM': [{'name': 'VM4', 'disk': '10G', 'mem': 2, 'vcpu': 4}]}]}
INFO:root: 12:35:00.154180 Provided subnet in C1: 1.1.1.0/24 is valid
ERROR:root: 12:35:00.154213Multiple subnet in the C1 are same
INFO:root: 12:39:32.022780 Printing the yaml input file
INFO:root: 12:39:32.022941 {'C1': [{'subnet_addr': '1.1.1.0/24', 'VM': [{'name': 'VM1', 'disk': '10G', 'mem': 2, 'vcpu': 4}]}, {'subnet_addr': '2.2.2.0/24', 'VM': [{'name': 'VM3', 'disk': '10G', 'mem': 3, 'vcpu': 2}]}], 'C2': [{'subnet_addr': '1.1.1.0/24', 'VM': [{'name': 'VM4', 'disk': '10G', 'mem': 2, 'vcpu': 4}]}]}
INFO:root: 12:39:32.023072 Provided subnet in C1: 1.1.1.0/24 is valid
INFO:root: 12:41:41.046179 Printing the yaml input file
INFO:root: 12:41:41.046350 {'C1': [{'subnet_addr': '1.1.1.0/24', 'VM': [{'name': 'VM1', 'disk': '10G', 'mem': 2, 'vcpu': 4}]}, {'subnet_addr': '2.2.2.0/24', 'VM': [{'name': 'VM3', 'disk': '10G', 'mem': 3, 'vcpu': 2}]}], 'C2': [{'subnet_addr': '1.1.1.0/24', 'VM': [{'name': 'VM4', 'disk': '10G', 'mem': 2, 'vcpu': 4}]}]}
INFO:root: 12:41:41.046476 Provided subnet in C1: 1.1.1.0/24 is valid
INFO:root: 12:50:40.814817 Printing the yaml input file
INFO:root: 12:50:40.814987 {'C1': [{'subnet_addr': '1.1.1.0/24', 'VM': [{'name': 'VM1', 'disk': '10G', 'mem': 2, 'vcpu': 4}]}, {'subnet_addr': '2.2.2.0/24', 'VM': [{'name': 'VM3', 'disk': '10G', 'mem': 3, 'vcpu': 2}]}], 'C2': [{'subnet_addr': '1.1.1.0/24', 'VM': [{'name': 'VM4', 'disk': '10G', 'mem': 2, 'vcpu': 4}]}]}
INFO:root: 12:50:40.815141 Provided subnet in C1: 1.1.1.0/24 is valid
INFO:root: 12:50:40.815224 Provided subnet in C1: 2.2.2.0/24 is valid
INFO:root: 12:50:40.815302 Provided subnet in C2: 1.1.1.0/24 is valid
INFO:root: 12:51:24.114066 Printing the yaml input file
INFO:root: 12:51:24.114227 {'C1': [{'subnet_addr': '1.1.1.0/24', 'VM': [{'name': 'VM1', 'disk': '10G', 'mem': 2, 'vcpu': 4}]}, {'subnet_addr': '2.2.2.0/24', 'VM': [{'name': 'VM3', 'disk': '10G', 'mem': 3, 'vcpu': 2}]}], 'C2': [{'subnet_addr': '1.1.1.0/24', 'VM': [{'name': 'VM4', 'disk': '10G', 'mem': 2, 'vcpu': 4}]}]}
INFO:root: 12:51:24.114333 Provided subnet in C1: 1.1.1.0/24 is valid
INFO:root: 12:51:24.114396 Provided subnet in C1: 2.2.2.0/24 is valid
INFO:root: 12:51:24.114445 Provided subnet in C2: 1.1.1.0/24 is valid
INFO:root: 12:56:58.961651 Printing the yaml input file
INFO:root: 12:56:58.961872 {'C1': [{'subnet_addr': '1.1.1.0/24', 'VM': [{'name': 'VM1', 'disk': '10G', 'mem': 2, 'vcpu': 4}]}, {'subnet_addr': '2.2.2.0/24', 'VM': [{'name': 'VM3', 'disk': '10G', 'mem': 3, 'vcpu': 2}]}], 'C2': [{'subnet_addr': '1.1.1.0/24', 'VM': [{'name': 'VM4', 'disk': '10G', 'mem': 2, 'vcpu': 4}]}]}
INFO:root: 12:56:58.962213 Provided subnet in C1: 1.1.1.0/24 is valid
ERROR:root: 12:56:58.962339Multiple subnet in the C1 are same
INFO:root: 12:57:26.299953 Printing the yaml input file
INFO:root: 12:57:26.300072 {'C1': [{'subnet_addr': '1.1.1.0/24', 'VM': [{'name': 'VM1', 'disk': '10G', 'mem': 2, 'vcpu': 4}]}, {'subnet_addr': '2.2.2.0/24', 'VM': [{'name': 'VM3', 'disk': '10G', 'mem': 3, 'vcpu': 2}]}], 'C2': [{'subnet_addr': '1.1.1.0/24', 'VM': [{'name': 'VM4', 'disk': '10G', 'mem': 2, 'vcpu': 4}]}]}
INFO:root: 12:57:26.300180 Provided subnet in C1: 1.1.1.0/24 is valid
ERROR:root: 12:57:26.300221Multiple subnet in the C1 are same
INFO:root: 12:57:57.314239 Printing the yaml input file
INFO:root: 12:57:57.314427 {'C1': [{'subnet_addr': '1.1.1.0/24', 'VM': [{'name': 'VM1', 'disk': '10G', 'mem': 2, 'vcpu': 4}]}, {'subnet_addr': '2.2.2.0/24', 'VM': [{'name': 'VM3', 'disk': '10G', 'mem': 3, 'vcpu': 2}]}], 'C2': [{'subnet_addr': '1.1.1.0/24', 'VM': [{'name': 'VM4', 'disk': '10G', 'mem': 2, 'vcpu': 4}]}]}
INFO:root: 12:57:57.314587 Provided subnet in C1: 1.1.1.0/24 is valid
ERROR:root: 12:57:57.314633Multiple subnet in the C1 are same
INFO:root: 13:03:54.598742 Printing the yaml input file
INFO:root: 13:03:54.598857 {'C1': [{'subnet_addr': '1.1.1.0/24', 'VM': [{'name': 'VM1', 'disk': '10G', 'mem': 2, 'vcpu': 4}]}, {'subnet_addr': '2.2.2.0/24', 'VM': [{'name': 'VM3', 'disk': '10G', 'mem': 3, 'vcpu': 2}]}], 'C2': [{'subnet_addr': '1.1.1.0/24', 'VM': [{'name': 'VM4', 'disk': '10G', 'mem': 2, 'vcpu': 4}]}]}
INFO:root: 13:03:54.598977 Provided subnet in C1: 1.1.1.0/24 is valid
INFO:root: 13:03:54.599257 Provided subnet in C1: 2.2.2.0/24 is valid
INFO:root: 13:03:54.599388 Provided subnet in C2: 1.1.1.0/24 is valid
INFO:root: 13:06:13.783878 Printing the yaml input file
INFO:root: 13:06:13.784047 {'C1': [{'subnet_addr': '1.1.1.0/24', 'VM': [{'name': 'VM1', 'disk': '10G', 'mem': 2, 'vcpu': 4}]}, {'subnet_addr': '2.2.2.0/24', 'VM': [{'name': 'VM3', 'disk': '10G', 'mem': 3, 'vcpu': 2}]}], 'C2': [{'subnet_addr': '1.1.1.0/24', 'VM': [{'name': 'VM4', 'disk': '10G', 'mem': 2, 'vcpu': 4}]}]}
INFO:root: 13:06:13.784156 Provided subnet in C1: 1.1.1.0/24 is valid
INFO:root: 13:06:13.784208 Provided subnet in C1: 2.2.2.0/24 is valid
INFO:root: 13:06:13.784258 Provided subnet in C2: 1.1.1.0/24 is valid
INFO:root: 13:07:52.997676 Printing the yaml input file
INFO:root: 13:07:52.997864 {'C1': [{'subnet_addr': '1.1.1.0/24', 'VM': [{'name': 'VM1', 'disk': '10G', 'mem': 2, 'vcpu': 4}]}, {'subnet_addr': '2.2.23.412/24', 'VM': [{'name': 'VM3', 'disk': '10G', 'mem': 3, 'vcpu': 2}]}], 'C2': [{'subnet_addr': '1.1.1.0/24', 'VM': [{'name': 'VM4', 'disk': '10G', 'mem': 2, 'vcpu': 4}]}]}
INFO:root: 13:07:52.997978 Provided subnet in C1: 1.1.1.0/24 is valid
ERROR:root: 13:07:52.998233 Provided subnet in C1: 2.2.23.412/24 is not valid
INFO:root: 13:08:59.038443 Printing the yaml input file
INFO:root: 13:08:59.038610 {'C1': [{'subnet_addr': '1.1.1.0/24', 'VM': [{'name': 'VM1', 'disk': '10G', 'mem': 2, 'vcpu': 4}]}, {'subnet_addr': '1.1.1.0/24', 'VM': [{'name': 'VM3', 'disk': '10G', 'mem': 3, 'vcpu': 2}]}], 'C2': [{'subnet_addr': '1.1.1.0/24', 'VM': [{'name': 'VM4', 'disk': '10G', 'mem': 2, 'vcpu': 4}]}]}
INFO:root: 13:08:59.038720 Provided subnet in C1: 1.1.1.0/24 is valid
INFO:root: 13:08:59.038775 Provided subnet in C1: 1.1.1.0/24 is valid
ERROR:root: 13:08:59.038822Multiple subnet in the C1 are same
INFO:root: 00:09:15.169992 Printing the yaml input file
INFO:root: 00:09:15.170165 {'C1': [{'subnet_addr': '1.1.1.0/24', 'VM': [{'name': 'VM1', 'disk': '10G', 'mem': 2, 'vcpu': 4}, {'name': 'VM2', 'disk': '10G', 'mem': 4, 'vcpu': 2}]}, {'subnet_addr': '2.2.2.0/24', 'VM': [{'name': 'VM3', 'disk': '10G', 'mem': 3, 'vcpu': 2}]}], 'C2': [{'subnet_addr': '1.1.1.0/24', 'VM': [{'name': 'VM4', 'disk': '10G', 'mem': 2, 'vcpu': 4}]}]}
INFO:root: 00:09:15.170297 Provided subnet in C1: 1.1.1.0/24 is valid
INFO:root: 00:09:15.170375 Provided subnet in C1: 2.2.2.0/24 is valid
INFO:root: 00:09:15.170439 Provided subnet in C2: 1.1.1.0/24 is valid
Using /etc/ansible/ansible.cfg as config file

PLAY [main] *************************************************************************************************************************************************

TASK [Create Tenant Namespace] ******************************************************************************************************************************
changed: [localhost] => (item={u'default_route_ip': u'192.168.1.1', u'name': u't1', u'pns_ip': u'192.168.1.1/24', u'tenant_if': u't1if', u'tenant_ip': u'192.168.1.2/24', u'pns_if': u't1pns_if'}) => {"ansible_loop_var": "item", "changed": true, "cmd": ["ip", "netns", "add", "t1"], "delta": "0:00:00.050160", "end": "2019-11-18 00:09:16.689869", "item": {"default_route_ip": "192.168.1.1", "name": "t1", "pns_if": "t1pns_if", "pns_ip": "192.168.1.1/24", "tenant_if": "t1if", "tenant_ip": "192.168.1.2/24"}, "rc": 0, "start": "2019-11-18 00:09:16.639709", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Create Subnet Namespace] ******************************************************************************************************************************
changed: [localhost] => (item={u'route': [{u'ip': u'10.1.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.1.2/24', u'tenant_ns_ip': u'10.1.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_ns_name': u't1', u'tenant_sub_if': u't1s1if'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't1_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM1if1'}, {u'mem': 4, u'name': u't1_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br1if2', u'vmif': u't1VM2if1'}], u'vxlan': [{u'local_ip': u'10.1.1.2', u'tenant_route_ip': u'192.168.1.2', u'dsport': 4789, u'dev': u't1s1if', u'subnet_route': u'10.1.1.0/24', u'remote_route': u'10.2.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.2.1.2'}]}) => {"ansible_loop_var": "item", "changed": true, "cmd": ["ip", "netns", "add", "t1ns1"], "delta": "0:00:00.051192", "end": "2019-11-18 00:09:16.994011", "item": {"bridge_name": "t1br1", "default_route_ip": "10.1.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.1.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.1.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.1.1.2/24"}], "vms": [{"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM1", "vcpu": 4, "vmif": "t1VM1if1"}, {"brif": "t1br1if2", "disk": "10G", "mem": 4, "name": "t1_VM2", "vcpu": 2, "vmif": "t1VM2if1"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.1.2", "remote_ip": "10.2.1.2", "remote_route": "10.2.1.0/24", "subnet_route": "10.1.1.0/24", "tenant_route_ip": "192.168.1.2", "v_name": "vxlan_t1s1"}]}, "rc": 0, "start": "2019-11-18 00:09:16.942819", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}
changed: [localhost] => (item={u'route': [{u'ip': u'10.1.2.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.2.1', u'bridge_name': u't1br2', u'dns': [{u'dnsif': u't1s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s2_dnsbrif'}], u'ns_name': u't1ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.2.2/24', u'tenant_ns_ip': u'10.1.2.1/24', u'tenant_ns_if': u't1ns2if', u'tenant_ns_name': u't1', u'tenant_sub_if': u't1s2if'}], u'subnet_ip': u'2.2.2.0/24', u'vms': [{u'mem': 3, u'name': u't1_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br2if1', u'vmif': u't1VM3if1'}], u'vxlan': [{u'local_ip': [], u'tenant_route_ip': [], u'dsport': [], u'dev': [], u'subnet_route': [], u'remote_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}) => {"ansible_loop_var": "item", "changed": true, "cmd": ["ip", "netns", "add", "t1ns2"], "delta": "0:00:00.050704", "end": "2019-11-18 00:09:17.230009", "item": {"bridge_name": "t1br2", "default_route_ip": "10.1.2.1", "dns": [{"brif": "t1s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t1s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns2", "route": [{"if": "p1", "ip": "10.1.2.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "2.2.2.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns2if", "tenant_ns_ip": "10.1.2.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s2if", "tenant_sub_ip": "10.1.2.2/24"}], "vms": [{"brif": "t1br2if1", "disk": "10G", "mem": 3, "name": "t1_VM3", "vcpu": 2, "vmif": "t1VM3if1"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, "rc": 0, "start": "2019-11-18 00:09:17.179305", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Create Tenant VETH pairs] *****************************************************************************************************************************
changed: [localhost] => (item={u'default_route_ip': u'192.168.1.1', u'name': u't1', u'pns_ip': u'192.168.1.1/24', u'tenant_if': u't1if', u'tenant_ip': u'192.168.1.2/24', u'pns_if': u't1pns_if'}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip link show \"t1if\" ; if [ $? -ne 0 ] ; then ip link add \"t1if\" type veth peer name \"t1pns_if\" ; fi\n", "delta": "0:00:00.009888", "end": "2019-11-18 00:09:17.478723", "item": {"default_route_ip": "192.168.1.1", "name": "t1", "pns_if": "t1pns_if", "pns_ip": "192.168.1.1/24", "tenant_if": "t1if", "tenant_ip": "192.168.1.2/24"}, "rc": 0, "start": "2019-11-18 00:09:17.468835", "stderr": "Device \"t1if\" does not exist.", "stderr_lines": ["Device \"t1if\" does not exist."], "stdout": "", "stdout_lines": []}

TASK [Attach Tenant VETH Pairs] *****************************************************************************************************************************
changed: [localhost] => (item={u'default_route_ip': u'192.168.1.1', u'name': u't1', u'pns_ip': u'192.168.1.1/24', u'tenant_if': u't1if', u'tenant_ip': u'192.168.1.2/24', u'pns_if': u't1pns_if'}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec pns ip link show \"t1pns_if\" ; if [ $? -ne 0 ] ; then ip link set \"t1pns_if\" netns pns ; fi\nip netns exec \"t1\" ip link show \"t1if\" ; if [ $? -ne 0 ] ; then ip link set \"t1if\" netns \"t1\" ; fi\nip netns exec pns ip link set dev \"t1pns_if\" up\nip netns exec \"t1\" ip link set dev \"t1if\" up\n", "delta": "0:00:00.192743", "end": "2019-11-18 00:09:17.913800", "item": {"default_route_ip": "192.168.1.1", "name": "t1", "pns_if": "t1pns_if", "pns_ip": "192.168.1.1/24", "tenant_if": "t1if", "tenant_ip": "192.168.1.2/24"}, "rc": 0, "start": "2019-11-18 00:09:17.721057", "stderr": "Device \"t1pns_if\" does not exist.\nDevice \"t1if\" does not exist.", "stderr_lines": ["Device \"t1pns_if\" does not exist.", "Device \"t1if\" does not exist."], "stdout": "", "stdout_lines": []}

TASK [Add IP addresses to Tenant VETH Pairs] ****************************************************************************************************************
changed: [localhost] => (item={u'default_route_ip': u'192.168.1.1', u'name': u't1', u'pns_ip': u'192.168.1.1/24', u'tenant_if': u't1if', u'tenant_ip': u'192.168.1.2/24', u'pns_if': u't1pns_if'}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec pns ip addr show \"t1pns_if\" | awk 'FNR==3{ print $2 }' | grep -w '^192.168.1.1/24' ; if [ $? -ne 0 ] ; then ip netns exec pns ip addr add \"192.168.1.1/24\" dev \"t1pns_if\" ; fi\nip netns exec \"t1\" ip addr show \"t1if\" | awk 'FNR==3{ print $2 }' | grep -w '^192.168.1.2/24' ; if [ $? -ne 0 ] ; then ip netns exec \"t1\" ip addr add \"192.168.1.2/24\" dev \"t1if\" ; fi\n", "delta": "0:00:00.143871", "end": "2019-11-18 00:09:18.322001", "item": {"default_route_ip": "192.168.1.1", "name": "t1", "pns_if": "t1pns_if", "pns_ip": "192.168.1.1/24", "tenant_if": "t1if", "tenant_ip": "192.168.1.2/24"}, "rc": 0, "start": "2019-11-18 00:09:18.178130", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Create Namespace VETH Pairs] **************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't1_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM1if1'}, {u'mem': 4, u'name': u't1_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br1if2', u'vmif': u't1VM2if1'}], u'vxlan': [{u'local_ip': u'10.1.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.1.2', u'remote_route': u'10.2.1.0/24', u'subnet_route': u'10.1.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.2.1.2'}]}, {u'tenant_sub_ip': u'10.1.1.2/24', u'tenant_ns_ip': u'10.1.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip link show \"t1ns1if\" ; if [ $? -ne 0 ] ; then ip link add \"t1ns1if\" type veth peer name \"t1s1if\" ; fi\n", "delta": "0:00:00.011111", "end": "2019-11-18 00:09:18.607413", "item": [{"bridge_name": "t1br1", "default_route_ip": "10.1.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.1.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "vms": [{"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM1", "vcpu": 4, "vmif": "t1VM1if1"}, {"brif": "t1br1if2", "disk": "10G", "mem": 4, "name": "t1_VM2", "vcpu": 2, "vmif": "t1VM2if1"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.1.2", "remote_ip": "10.2.1.2", "remote_route": "10.2.1.0/24", "subnet_route": "10.1.1.0/24", "tenant_route_ip": "192.168.1.2", "v_name": "vxlan_t1s1"}]}, {"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.1.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.1.1.2/24"}], "rc": 0, "start": "2019-11-18 00:09:18.596302", "stderr": "Device \"t1ns1if\" does not exist.", "stderr_lines": ["Device \"t1ns1if\" does not exist."], "stdout": "", "stdout_lines": []}
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.2.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.2.1', u'bridge_name': u't1br2', u'dns': [{u'dnsif': u't1s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s2_dnsbrif'}], u'ns_name': u't1ns2', u'subnet_ip': u'2.2.2.0/24', u'vms': [{u'mem': 3, u'name': u't1_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br2if1', u'vmif': u't1VM3if1'}], u'vxlan': [{u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}, {u'tenant_sub_ip': u'10.1.2.2/24', u'tenant_ns_ip': u'10.1.2.1/24', u'tenant_ns_if': u't1ns2if', u'tenant_sub_if': u't1s2if', u'tenant_ns_name': u't1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip link show \"t1ns2if\" ; if [ $? -ne 0 ] ; then ip link add \"t1ns2if\" type veth peer name \"t1s2if\" ; fi\n", "delta": "0:00:00.010344", "end": "2019-11-18 00:09:18.826670", "item": [{"bridge_name": "t1br2", "default_route_ip": "10.1.2.1", "dns": [{"brif": "t1s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t1s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns2", "route": [{"if": "p1", "ip": "10.1.2.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "2.2.2.0/24", "vms": [{"brif": "t1br2if1", "disk": "10G", "mem": 3, "name": "t1_VM3", "vcpu": 2, "vmif": "t1VM3if1"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, {"tenant_ns_if": "t1ns2if", "tenant_ns_ip": "10.1.2.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s2if", "tenant_sub_ip": "10.1.2.2/24"}], "rc": 0, "start": "2019-11-18 00:09:18.816326", "stderr": "Device \"t1ns2if\" does not exist.", "stderr_lines": ["Device \"t1ns2if\" does not exist."], "stdout": "", "stdout_lines": []}

TASK [Attach Namespace VETH Pairs] **************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't1_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM1if1'}, {u'mem': 4, u'name': u't1_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br1if2', u'vmif': u't1VM2if1'}], u'vxlan': [{u'local_ip': u'10.1.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.1.2', u'remote_route': u'10.2.1.0/24', u'subnet_route': u'10.1.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.2.1.2'}]}, {u'tenant_sub_ip': u'10.1.1.2/24', u'tenant_ns_ip': u'10.1.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t1\" ip link show \"t1ns1if\" ; if [ $? -ne 0 ] ; then ip link set \"t1ns1if\" netns \"t1\" ; fi\nip netns exec \"t1ns1\" ip link show \"t1s1if\" ; if [ $? -ne 0 ] ; then ip link set \"t1s1if\" netns \"t1ns1\" ; fi\n", "delta": "0:00:00.110458", "end": "2019-11-18 00:09:19.216507", "item": [{"bridge_name": "t1br1", "default_route_ip": "10.1.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.1.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "vms": [{"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM1", "vcpu": 4, "vmif": "t1VM1if1"}, {"brif": "t1br1if2", "disk": "10G", "mem": 4, "name": "t1_VM2", "vcpu": 2, "vmif": "t1VM2if1"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.1.2", "remote_ip": "10.2.1.2", "remote_route": "10.2.1.0/24", "subnet_route": "10.1.1.0/24", "tenant_route_ip": "192.168.1.2", "v_name": "vxlan_t1s1"}]}, {"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.1.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.1.1.2/24"}], "rc": 0, "start": "2019-11-18 00:09:19.106049", "stderr": "Device \"t1ns1if\" does not exist.\nDevice \"t1s1if\" does not exist.", "stderr_lines": ["Device \"t1ns1if\" does not exist.", "Device \"t1s1if\" does not exist."], "stdout": "", "stdout_lines": []}
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.2.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.2.1', u'bridge_name': u't1br2', u'dns': [{u'dnsif': u't1s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s2_dnsbrif'}], u'ns_name': u't1ns2', u'subnet_ip': u'2.2.2.0/24', u'vms': [{u'mem': 3, u'name': u't1_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br2if1', u'vmif': u't1VM3if1'}], u'vxlan': [{u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}, {u'tenant_sub_ip': u'10.1.2.2/24', u'tenant_ns_ip': u'10.1.2.1/24', u'tenant_ns_if': u't1ns2if', u'tenant_sub_if': u't1s2if', u'tenant_ns_name': u't1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t1\" ip link show \"t1ns2if\" ; if [ $? -ne 0 ] ; then ip link set \"t1ns2if\" netns \"t1\" ; fi\nip netns exec \"t1ns2\" ip link show \"t1s2if\" ; if [ $? -ne 0 ] ; then ip link set \"t1s2if\" netns \"t1ns2\" ; fi\n", "delta": "0:00:00.114576", "end": "2019-11-18 00:09:19.538604", "item": [{"bridge_name": "t1br2", "default_route_ip": "10.1.2.1", "dns": [{"brif": "t1s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t1s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns2", "route": [{"if": "p1", "ip": "10.1.2.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "2.2.2.0/24", "vms": [{"brif": "t1br2if1", "disk": "10G", "mem": 3, "name": "t1_VM3", "vcpu": 2, "vmif": "t1VM3if1"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, {"tenant_ns_if": "t1ns2if", "tenant_ns_ip": "10.1.2.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s2if", "tenant_sub_ip": "10.1.2.2/24"}], "rc": 0, "start": "2019-11-18 00:09:19.424028", "stderr": "Device \"t1ns2if\" does not exist.\nDevice \"t1s2if\" does not exist.", "stderr_lines": ["Device \"t1ns2if\" does not exist.", "Device \"t1s2if\" does not exist."], "stdout": "", "stdout_lines": []}

TASK [Set Namespace VETH Pairs UP] **************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't1_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM1if1'}, {u'mem': 4, u'name': u't1_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br1if2', u'vmif': u't1VM2if1'}], u'vxlan': [{u'local_ip': u'10.1.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.1.2', u'remote_route': u'10.2.1.0/24', u'subnet_route': u'10.1.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.2.1.2'}]}, {u'tenant_sub_ip': u'10.1.1.2/24', u'tenant_ns_ip': u'10.1.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t1\" ip link set dev \"t1ns1if\" up\nip netns exec \"t1ns1\" ip link set dev \"t1s1if\" up\n", "delta": "0:00:00.075340", "end": "2019-11-18 00:09:19.881713", "item": [{"bridge_name": "t1br1", "default_route_ip": "10.1.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.1.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "vms": [{"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM1", "vcpu": 4, "vmif": "t1VM1if1"}, {"brif": "t1br1if2", "disk": "10G", "mem": 4, "name": "t1_VM2", "vcpu": 2, "vmif": "t1VM2if1"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.1.2", "remote_ip": "10.2.1.2", "remote_route": "10.2.1.0/24", "subnet_route": "10.1.1.0/24", "tenant_route_ip": "192.168.1.2", "v_name": "vxlan_t1s1"}]}, {"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.1.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.1.1.2/24"}], "rc": 0, "start": "2019-11-18 00:09:19.806373", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.2.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.2.1', u'bridge_name': u't1br2', u'dns': [{u'dnsif': u't1s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s2_dnsbrif'}], u'ns_name': u't1ns2', u'subnet_ip': u'2.2.2.0/24', u'vms': [{u'mem': 3, u'name': u't1_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br2if1', u'vmif': u't1VM3if1'}], u'vxlan': [{u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}, {u'tenant_sub_ip': u'10.1.2.2/24', u'tenant_ns_ip': u'10.1.2.1/24', u'tenant_ns_if': u't1ns2if', u'tenant_sub_if': u't1s2if', u'tenant_ns_name': u't1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t1\" ip link set dev \"t1ns2if\" up\nip netns exec \"t1ns2\" ip link set dev \"t1s2if\" up\n", "delta": "0:00:00.071949", "end": "2019-11-18 00:09:20.149643", "item": [{"bridge_name": "t1br2", "default_route_ip": "10.1.2.1", "dns": [{"brif": "t1s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t1s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns2", "route": [{"if": "p1", "ip": "10.1.2.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "2.2.2.0/24", "vms": [{"brif": "t1br2if1", "disk": "10G", "mem": 3, "name": "t1_VM3", "vcpu": 2, "vmif": "t1VM3if1"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, {"tenant_ns_if": "t1ns2if", "tenant_ns_ip": "10.1.2.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s2if", "tenant_sub_ip": "10.1.2.2/24"}], "rc": 0, "start": "2019-11-18 00:09:20.077694", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Add IP addresses to Namespace VETH Pairs] *************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't1_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM1if1'}, {u'mem': 4, u'name': u't1_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br1if2', u'vmif': u't1VM2if1'}], u'vxlan': [{u'local_ip': u'10.1.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.1.2', u'remote_route': u'10.2.1.0/24', u'subnet_route': u'10.1.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.2.1.2'}]}, {u'tenant_sub_ip': u'10.1.1.2/24', u'tenant_ns_ip': u'10.1.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t1ns1\" ip addr show \"t1s1if\" | awk 'FNR==3{ print $2 }' | grep -w '^10.1.1.2/24' ; if [ $? -ne 0 ] ; then ip netns exec \"t1ns1\" ip addr add \"10.1.1.2/24\" dev \"t1s1if\" ; fi\n\nip netns exec \"t1\" ip addr show \"t1ns1if\" | awk 'FNR==3{ print $2 }' | grep -w '^10.1.1.1/24' ; if [ $? -ne 0 ] ; then ip netns exec \"t1\" ip addr add \"10.1.1.1/24\" dev \"t1ns1if\" ; fi\n", "delta": "0:00:00.160340", "end": "2019-11-18 00:09:20.557870", "item": [{"bridge_name": "t1br1", "default_route_ip": "10.1.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.1.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "vms": [{"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM1", "vcpu": 4, "vmif": "t1VM1if1"}, {"brif": "t1br1if2", "disk": "10G", "mem": 4, "name": "t1_VM2", "vcpu": 2, "vmif": "t1VM2if1"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.1.2", "remote_ip": "10.2.1.2", "remote_route": "10.2.1.0/24", "subnet_route": "10.1.1.0/24", "tenant_route_ip": "192.168.1.2", "v_name": "vxlan_t1s1"}]}, {"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.1.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.1.1.2/24"}], "rc": 0, "start": "2019-11-18 00:09:20.397530", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.2.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.2.1', u'bridge_name': u't1br2', u'dns': [{u'dnsif': u't1s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s2_dnsbrif'}], u'ns_name': u't1ns2', u'subnet_ip': u'2.2.2.0/24', u'vms': [{u'mem': 3, u'name': u't1_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br2if1', u'vmif': u't1VM3if1'}], u'vxlan': [{u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}, {u'tenant_sub_ip': u'10.1.2.2/24', u'tenant_ns_ip': u'10.1.2.1/24', u'tenant_ns_if': u't1ns2if', u'tenant_sub_if': u't1s2if', u'tenant_ns_name': u't1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t1ns2\" ip addr show \"t1s2if\" | awk 'FNR==3{ print $2 }' | grep -w '^10.1.2.2/24' ; if [ $? -ne 0 ] ; then ip netns exec \"t1ns2\" ip addr add \"10.1.2.2/24\" dev \"t1s2if\" ; fi\n\nip netns exec \"t1\" ip addr show \"t1ns2if\" | awk 'FNR==3{ print $2 }' | grep -w '^10.1.2.1/24' ; if [ $? -ne 0 ] ; then ip netns exec \"t1\" ip addr add \"10.1.2.1/24\" dev \"t1ns2if\" ; fi\n", "delta": "0:00:00.174102", "end": "2019-11-18 00:09:20.925937", "item": [{"bridge_name": "t1br2", "default_route_ip": "10.1.2.1", "dns": [{"brif": "t1s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t1s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns2", "route": [{"if": "p1", "ip": "10.1.2.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "2.2.2.0/24", "vms": [{"brif": "t1br2if1", "disk": "10G", "mem": 3, "name": "t1_VM3", "vcpu": 2, "vmif": "t1VM3if1"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, {"tenant_ns_if": "t1ns2if", "tenant_ns_ip": "10.1.2.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s2if", "tenant_sub_ip": "10.1.2.2/24"}], "rc": 0, "start": "2019-11-18 00:09:20.751835", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Add IP Route to Tenant] *******************************************************************************************************************************
changed: [localhost] => (item={u'default_route_ip': u'192.168.1.1', u'name': u't1', u'pns_ip': u'192.168.1.1/24', u'tenant_if': u't1if', u'tenant_ip': u'192.168.1.2/24', u'pns_if': u't1pns_if'}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t1\" ip route show default | grep -w '[d]efault via 192.168.1.1' ; if [ $? -ne 0 ] ; then ip netns exec \"t1\" ip route add default via \"192.168.1.1\" ; fi\n", "delta": "0:00:00.083226", "end": "2019-11-18 00:09:21.281885", "item": {"default_route_ip": "192.168.1.1", "name": "t1", "pns_if": "t1pns_if", "pns_ip": "192.168.1.1/24", "tenant_if": "t1if", "tenant_ip": "192.168.1.2/24"}, "rc": 0, "start": "2019-11-18 00:09:21.198659", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Add IP Route to Tenant Subnet] ************************************************************************************************************************
changed: [localhost] => (item={u'route': [{u'ip': u'10.1.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.1.2/24', u'tenant_ns_ip': u'10.1.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_ns_name': u't1', u'tenant_sub_if': u't1s1if'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't1_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM1if1'}, {u'mem': 4, u'name': u't1_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br1if2', u'vmif': u't1VM2if1'}], u'vxlan': [{u'local_ip': u'10.1.1.2', u'tenant_route_ip': u'192.168.1.2', u'dsport': 4789, u'dev': u't1s1if', u'subnet_route': u'10.1.1.0/24', u'remote_route': u'10.2.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.2.1.2'}]}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t1ns1\" ip route show default | grep -w '[d]efault via 10.1.1.1' ; if [ $? -ne 0 ] ; then ip netns exec \"t1ns1\" ip route add default via \"10.1.1.1\" ; fi\n", "delta": "0:00:00.086677", "end": "2019-11-18 00:09:21.645877", "item": {"bridge_name": "t1br1", "default_route_ip": "10.1.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.1.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.1.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.1.1.2/24"}], "vms": [{"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM1", "vcpu": 4, "vmif": "t1VM1if1"}, {"brif": "t1br1if2", "disk": "10G", "mem": 4, "name": "t1_VM2", "vcpu": 2, "vmif": "t1VM2if1"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.1.2", "remote_ip": "10.2.1.2", "remote_route": "10.2.1.0/24", "subnet_route": "10.1.1.0/24", "tenant_route_ip": "192.168.1.2", "v_name": "vxlan_t1s1"}]}, "rc": 0, "start": "2019-11-18 00:09:21.559200", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}
changed: [localhost] => (item={u'route': [{u'ip': u'10.1.2.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.2.1', u'bridge_name': u't1br2', u'dns': [{u'dnsif': u't1s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s2_dnsbrif'}], u'ns_name': u't1ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.2.2/24', u'tenant_ns_ip': u'10.1.2.1/24', u'tenant_ns_if': u't1ns2if', u'tenant_ns_name': u't1', u'tenant_sub_if': u't1s2if'}], u'subnet_ip': u'2.2.2.0/24', u'vms': [{u'mem': 3, u'name': u't1_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br2if1', u'vmif': u't1VM3if1'}], u'vxlan': [{u'local_ip': [], u'tenant_route_ip': [], u'dsport': [], u'dev': [], u'subnet_route': [], u'remote_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t1ns2\" ip route show default | grep -w '[d]efault via 10.1.2.1' ; if [ $? -ne 0 ] ; then ip netns exec \"t1ns2\" ip route add default via \"10.1.2.1\" ; fi\n", "delta": "0:00:00.080232", "end": "2019-11-18 00:09:21.933878", "item": {"bridge_name": "t1br2", "default_route_ip": "10.1.2.1", "dns": [{"brif": "t1s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t1s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns2", "route": [{"if": "p1", "ip": "10.1.2.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "2.2.2.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns2if", "tenant_ns_ip": "10.1.2.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s2if", "tenant_sub_ip": "10.1.2.2/24"}], "vms": [{"brif": "t1br2if1", "disk": "10G", "mem": 3, "name": "t1_VM3", "vcpu": 2, "vmif": "t1VM3if1"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, "rc": 0, "start": "2019-11-18 00:09:21.853646", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Create bridge inside namespace] ***********************************************************************************************************************
changed: [localhost] => (item={u'route': [{u'ip': u'10.1.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.1.2/24', u'tenant_ns_ip': u'10.1.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_ns_name': u't1', u'tenant_sub_if': u't1s1if'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't1_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM1if1'}, {u'mem': 4, u'name': u't1_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br1if2', u'vmif': u't1VM2if1'}], u'vxlan': [{u'local_ip': u'10.1.1.2', u'tenant_route_ip': u'192.168.1.2', u'dsport': 4789, u'dev': u't1s1if', u'subnet_route': u'10.1.1.0/24', u'remote_route': u'10.2.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.2.1.2'}]}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t1ns1\" brctl show | grep -w '^t1br1'; if [ $? -ne 0 ] ; then ip netns exec \"t1ns1\" brctl addbr \"t1br1\" ; fi\nip netns exec \"t1ns1\" ip link set dev \"t1br1\" up\n", "delta": "0:00:00.111881", "end": "2019-11-18 00:09:22.321913", "item": {"bridge_name": "t1br1", "default_route_ip": "10.1.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.1.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.1.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.1.1.2/24"}], "vms": [{"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM1", "vcpu": 4, "vmif": "t1VM1if1"}, {"brif": "t1br1if2", "disk": "10G", "mem": 4, "name": "t1_VM2", "vcpu": 2, "vmif": "t1VM2if1"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.1.2", "remote_ip": "10.2.1.2", "remote_route": "10.2.1.0/24", "subnet_route": "10.1.1.0/24", "tenant_route_ip": "192.168.1.2", "v_name": "vxlan_t1s1"}]}, "rc": 0, "start": "2019-11-18 00:09:22.210032", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}
changed: [localhost] => (item={u'route': [{u'ip': u'10.1.2.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.2.1', u'bridge_name': u't1br2', u'dns': [{u'dnsif': u't1s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s2_dnsbrif'}], u'ns_name': u't1ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.2.2/24', u'tenant_ns_ip': u'10.1.2.1/24', u'tenant_ns_if': u't1ns2if', u'tenant_ns_name': u't1', u'tenant_sub_if': u't1s2if'}], u'subnet_ip': u'2.2.2.0/24', u'vms': [{u'mem': 3, u'name': u't1_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br2if1', u'vmif': u't1VM3if1'}], u'vxlan': [{u'local_ip': [], u'tenant_route_ip': [], u'dsport': [], u'dev': [], u'subnet_route': [], u'remote_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t1ns2\" brctl show | grep -w '^t1br2'; if [ $? -ne 0 ] ; then ip netns exec \"t1ns2\" brctl addbr \"t1br2\" ; fi\nip netns exec \"t1ns2\" ip link set dev \"t1br2\" up\n", "delta": "0:00:00.105891", "end": "2019-11-18 00:09:22.637883", "item": {"bridge_name": "t1br2", "default_route_ip": "10.1.2.1", "dns": [{"brif": "t1s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t1s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns2", "route": [{"if": "p1", "ip": "10.1.2.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "2.2.2.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns2if", "tenant_ns_ip": "10.1.2.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s2if", "tenant_sub_ip": "10.1.2.2/24"}], "vms": [{"brif": "t1br2if1", "disk": "10G", "mem": 3, "name": "t1_VM3", "vcpu": 2, "vmif": "t1VM3if1"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, "rc": 0, "start": "2019-11-18 00:09:22.531992", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Create DNS VETH Pair] *********************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.1.1', u'bridge_name': u't1br1', u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.1.2/24', u'tenant_ns_ip': u'10.1.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't1_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM1if1'}, {u'mem': 4, u'name': u't1_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br1if2', u'vmif': u't1VM2if1'}], u'vxlan': [{u'local_ip': u'10.1.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.1.2', u'remote_route': u'10.2.1.0/24', u'subnet_route': u'10.1.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.2.1.2'}]}, {u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t1ns1\" ip link show \"t1s1_dnsbrif\" ; if [ $? -ne 0 ] ; then ip netns exec \"t1ns1\" ip link add \"t1s1_dnsbrif\" type veth peer name \"t1s1_dnsif\" ; fi\nip netns exec \"t1ns1\" ip link set dev \"t1s1_dnsbrif\" up\nip netns exec \"t1ns1\" ip link set dev \"t1s1_dnsif\" up\n", "delta": "0:00:00.148749", "end": "2019-11-18 00:09:23.041712", "item": [{"bridge_name": "t1br1", "default_route_ip": "10.1.1.1", "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.1.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.1.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.1.1.2/24"}], "vms": [{"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM1", "vcpu": 4, "vmif": "t1VM1if1"}, {"brif": "t1br1if2", "disk": "10G", "mem": 4, "name": "t1_VM2", "vcpu": 2, "vmif": "t1VM2if1"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.1.2", "remote_ip": "10.2.1.2", "remote_route": "10.2.1.0/24", "subnet_route": "10.1.1.0/24", "tenant_route_ip": "192.168.1.2", "v_name": "vxlan_t1s1"}]}, {"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "rc": 0, "start": "2019-11-18 00:09:22.892963", "stderr": "Device \"t1s1_dnsbrif\" does not exist.", "stderr_lines": ["Device \"t1s1_dnsbrif\" does not exist."], "stdout": "", "stdout_lines": []}
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.2.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.2.1', u'bridge_name': u't1br2', u'ns_name': u't1ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.2.2/24', u'tenant_ns_ip': u'10.1.2.1/24', u'tenant_ns_if': u't1ns2if', u'tenant_sub_if': u't1s2if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'2.2.2.0/24', u'vms': [{u'mem': 3, u'name': u't1_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br2if1', u'vmif': u't1VM3if1'}], u'vxlan': [{u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}, {u'dnsif': u't1s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s2_dnsbrif'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t1ns2\" ip link show \"t1s2_dnsbrif\" ; if [ $? -ne 0 ] ; then ip netns exec \"t1ns2\" ip link add \"t1s2_dnsbrif\" type veth peer name \"t1s2_dnsif\" ; fi\nip netns exec \"t1ns2\" ip link set dev \"t1s2_dnsbrif\" up\nip netns exec \"t1ns2\" ip link set dev \"t1s2_dnsif\" up\n", "delta": "0:00:00.161808", "end": "2019-11-18 00:09:23.389686", "item": [{"bridge_name": "t1br2", "default_route_ip": "10.1.2.1", "ns_name": "t1ns2", "route": [{"if": "p1", "ip": "10.1.2.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "2.2.2.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns2if", "tenant_ns_ip": "10.1.2.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s2if", "tenant_sub_ip": "10.1.2.2/24"}], "vms": [{"brif": "t1br2if1", "disk": "10G", "mem": 3, "name": "t1_VM3", "vcpu": 2, "vmif": "t1VM3if1"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, {"brif": "t1s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t1s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "rc": 0, "start": "2019-11-18 00:09:23.227878", "stderr": "Device \"t1s2_dnsbrif\" does not exist.", "stderr_lines": ["Device \"t1s2_dnsbrif\" does not exist."], "stdout": "", "stdout_lines": []}

TASK [Attach DNS VETH Pair] *********************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.1.1', u'bridge_name': u't1br1', u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.1.2/24', u'tenant_ns_ip': u'10.1.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't1_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM1if1'}, {u'mem': 4, u'name': u't1_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br1if2', u'vmif': u't1VM2if1'}], u'vxlan': [{u'local_ip': u'10.1.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.1.2', u'remote_route': u'10.2.1.0/24', u'subnet_route': u'10.1.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.2.1.2'}]}, {u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t1ns1\" brctl show \"t1br1\" | grep -w 't1s1_dnsbrif' ; if [ $? -ne 0 ] ; then ip netns exec \"t1ns1\" brctl addif \"t1br1\" \"t1s1_dnsbrif\" ; fi\n", "delta": "0:00:00.071713", "end": "2019-11-18 00:09:23.697717", "item": [{"bridge_name": "t1br1", "default_route_ip": "10.1.1.1", "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.1.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.1.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.1.1.2/24"}], "vms": [{"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM1", "vcpu": 4, "vmif": "t1VM1if1"}, {"brif": "t1br1if2", "disk": "10G", "mem": 4, "name": "t1_VM2", "vcpu": 2, "vmif": "t1VM2if1"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.1.2", "remote_ip": "10.2.1.2", "remote_route": "10.2.1.0/24", "subnet_route": "10.1.1.0/24", "tenant_route_ip": "192.168.1.2", "v_name": "vxlan_t1s1"}]}, {"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "rc": 0, "start": "2019-11-18 00:09:23.626004", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.2.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.2.1', u'bridge_name': u't1br2', u'ns_name': u't1ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.2.2/24', u'tenant_ns_ip': u'10.1.2.1/24', u'tenant_ns_if': u't1ns2if', u'tenant_sub_if': u't1s2if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'2.2.2.0/24', u'vms': [{u'mem': 3, u'name': u't1_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br2if1', u'vmif': u't1VM3if1'}], u'vxlan': [{u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}, {u'dnsif': u't1s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s2_dnsbrif'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t1ns2\" brctl show \"t1br2\" | grep -w 't1s2_dnsbrif' ; if [ $? -ne 0 ] ; then ip netns exec \"t1ns2\" brctl addif \"t1br2\" \"t1s2_dnsbrif\" ; fi\n", "delta": "0:00:00.070537", "end": "2019-11-18 00:09:23.973935", "item": [{"bridge_name": "t1br2", "default_route_ip": "10.1.2.1", "ns_name": "t1ns2", "route": [{"if": "p1", "ip": "10.1.2.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "2.2.2.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns2if", "tenant_ns_ip": "10.1.2.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s2if", "tenant_sub_ip": "10.1.2.2/24"}], "vms": [{"brif": "t1br2if1", "disk": "10G", "mem": 3, "name": "t1_VM3", "vcpu": 2, "vmif": "t1VM3if1"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, {"brif": "t1s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t1s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "rc": 0, "start": "2019-11-18 00:09:23.903398", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Create VETH Pairs] ************************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.1.2/24', u'tenant_ns_ip': u'10.1.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.1.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.1.2', u'remote_route': u'10.2.1.0/24', u'subnet_route': u'10.1.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.2.1.2'}]}, {u'mem': 2, u'name': u't1_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM1if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip link show \"t1br1if1\" ; if [ $? -ne 0 ] ; then ip link add \"t1VM1if1\" type veth peer name \"t1br1if1\" ; fi\nip link set dev \"t1br1if1\" up\nip link set dev \"t1VM1if1\" up\n", "delta": "0:00:00.015995", "end": "2019-11-18 00:09:24.253366", "item": [{"bridge_name": "t1br1", "default_route_ip": "10.1.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.1.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.1.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.1.1.2/24"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.1.2", "remote_ip": "10.2.1.2", "remote_route": "10.2.1.0/24", "subnet_route": "10.1.1.0/24", "tenant_route_ip": "192.168.1.2", "v_name": "vxlan_t1s1"}]}, {"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM1", "vcpu": 4, "vmif": "t1VM1if1"}], "rc": 0, "start": "2019-11-18 00:09:24.237371", "stderr": "Device \"t1br1if1\" does not exist.", "stderr_lines": ["Device \"t1br1if1\" does not exist."], "stdout": "", "stdout_lines": []}
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.1.2/24', u'tenant_ns_ip': u'10.1.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.1.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.1.2', u'remote_route': u'10.2.1.0/24', u'subnet_route': u'10.1.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.2.1.2'}]}, {u'mem': 4, u'name': u't1_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br1if2', u'vmif': u't1VM2if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip link show \"t1br1if2\" ; if [ $? -ne 0 ] ; then ip link add \"t1VM2if1\" type veth peer name \"t1br1if2\" ; fi\nip link set dev \"t1br1if2\" up\nip link set dev \"t1VM2if1\" up\n", "delta": "0:00:00.017494", "end": "2019-11-18 00:09:24.482079", "item": [{"bridge_name": "t1br1", "default_route_ip": "10.1.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.1.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.1.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.1.1.2/24"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.1.2", "remote_ip": "10.2.1.2", "remote_route": "10.2.1.0/24", "subnet_route": "10.1.1.0/24", "tenant_route_ip": "192.168.1.2", "v_name": "vxlan_t1s1"}]}, {"brif": "t1br1if2", "disk": "10G", "mem": 4, "name": "t1_VM2", "vcpu": 2, "vmif": "t1VM2if1"}], "rc": 0, "start": "2019-11-18 00:09:24.464585", "stderr": "Device \"t1br1if2\" does not exist.", "stderr_lines": ["Device \"t1br1if2\" does not exist."], "stdout": "", "stdout_lines": []}
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.2.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.2.1', u'bridge_name': u't1br2', u'dns': [{u'dnsif': u't1s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s2_dnsbrif'}], u'ns_name': u't1ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.2.2/24', u'tenant_ns_ip': u'10.1.2.1/24', u'tenant_ns_if': u't1ns2if', u'tenant_sub_if': u't1s2if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'2.2.2.0/24', u'vxlan': [{u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}, {u'mem': 3, u'name': u't1_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br2if1', u'vmif': u't1VM3if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip link show \"t1br2if1\" ; if [ $? -ne 0 ] ; then ip link add \"t1VM3if1\" type veth peer name \"t1br2if1\" ; fi\nip link set dev \"t1br2if1\" up\nip link set dev \"t1VM3if1\" up\n", "delta": "0:00:00.017365", "end": "2019-11-18 00:09:24.714204", "item": [{"bridge_name": "t1br2", "default_route_ip": "10.1.2.1", "dns": [{"brif": "t1s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t1s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns2", "route": [{"if": "p1", "ip": "10.1.2.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "2.2.2.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns2if", "tenant_ns_ip": "10.1.2.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s2if", "tenant_sub_ip": "10.1.2.2/24"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, {"brif": "t1br2if1", "disk": "10G", "mem": 3, "name": "t1_VM3", "vcpu": 2, "vmif": "t1VM3if1"}], "rc": 0, "start": "2019-11-18 00:09:24.696839", "stderr": "Device \"t1br2if1\" does not exist.", "stderr_lines": ["Device \"t1br2if1\" does not exist."], "stdout": "", "stdout_lines": []}

TASK [Attach VETH Pairs] ************************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.1.2/24', u'tenant_ns_ip': u'10.1.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.1.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.1.2', u'remote_route': u'10.2.1.0/24', u'subnet_route': u'10.1.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.2.1.2'}]}, {u'mem': 2, u'name': u't1_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM1if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip link show \"t1br1if1\" ; if [ $? -eq 0 ] ; then ip link set \"t1br1if1\" netns \"t1ns1\" ; fi\nip netns exec \"t1ns1\" brctl show \"t1br1\" | grep -w 't1br1if1' ; if [ $? -ne 0 ] ; then ip netns exec \"t1ns1\" brctl addif \"t1br1\" \"t1br1if1\" ; fi\n", "delta": "0:00:00.112420", "end": "2019-11-18 00:09:25.113781", "item": [{"bridge_name": "t1br1", "default_route_ip": "10.1.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.1.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.1.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.1.1.2/24"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.1.2", "remote_ip": "10.2.1.2", "remote_route": "10.2.1.0/24", "subnet_route": "10.1.1.0/24", "tenant_route_ip": "192.168.1.2", "v_name": "vxlan_t1s1"}]}, {"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM1", "vcpu": 4, "vmif": "t1VM1if1"}], "rc": 0, "start": "2019-11-18 00:09:25.001361", "stderr": "", "stderr_lines": [], "stdout": "20: t1br1if1@t1VM1if1: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP mode DEFAULT group default qlen 1000\n    link/ether 52:6a:d7:2a:e1:9e brd ff:ff:ff:ff:ff:ff", "stdout_lines": ["20: t1br1if1@t1VM1if1: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP mode DEFAULT group default qlen 1000", "    link/ether 52:6a:d7:2a:e1:9e brd ff:ff:ff:ff:ff:ff"]}
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.1.2/24', u'tenant_ns_ip': u'10.1.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.1.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.1.2', u'remote_route': u'10.2.1.0/24', u'subnet_route': u'10.1.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.2.1.2'}]}, {u'mem': 4, u'name': u't1_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br1if2', u'vmif': u't1VM2if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip link show \"t1br1if2\" ; if [ $? -eq 0 ] ; then ip link set \"t1br1if2\" netns \"t1ns1\" ; fi\nip netns exec \"t1ns1\" brctl show \"t1br1\" | grep -w 't1br1if2' ; if [ $? -ne 0 ] ; then ip netns exec \"t1ns1\" brctl addif \"t1br1\" \"t1br1if2\" ; fi\n", "delta": "0:00:00.114040", "end": "2019-11-18 00:09:25.446233", "item": [{"bridge_name": "t1br1", "default_route_ip": "10.1.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.1.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.1.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.1.1.2/24"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.1.2", "remote_ip": "10.2.1.2", "remote_route": "10.2.1.0/24", "subnet_route": "10.1.1.0/24", "tenant_route_ip": "192.168.1.2", "v_name": "vxlan_t1s1"}]}, {"brif": "t1br1if2", "disk": "10G", "mem": 4, "name": "t1_VM2", "vcpu": 2, "vmif": "t1VM2if1"}], "rc": 0, "start": "2019-11-18 00:09:25.332193", "stderr": "", "stderr_lines": [], "stdout": "22: t1br1if2@t1VM2if1: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP mode DEFAULT group default qlen 1000\n    link/ether fa:98:3b:7f:06:24 brd ff:ff:ff:ff:ff:ff", "stdout_lines": ["22: t1br1if2@t1VM2if1: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP mode DEFAULT group default qlen 1000", "    link/ether fa:98:3b:7f:06:24 brd ff:ff:ff:ff:ff:ff"]}
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.2.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.2.1', u'bridge_name': u't1br2', u'dns': [{u'dnsif': u't1s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s2_dnsbrif'}], u'ns_name': u't1ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.2.2/24', u'tenant_ns_ip': u'10.1.2.1/24', u'tenant_ns_if': u't1ns2if', u'tenant_sub_if': u't1s2if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'2.2.2.0/24', u'vxlan': [{u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}, {u'mem': 3, u'name': u't1_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br2if1', u'vmif': u't1VM3if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip link show \"t1br2if1\" ; if [ $? -eq 0 ] ; then ip link set \"t1br2if1\" netns \"t1ns2\" ; fi\nip netns exec \"t1ns2\" brctl show \"t1br2\" | grep -w 't1br2if1' ; if [ $? -ne 0 ] ; then ip netns exec \"t1ns2\" brctl addif \"t1br2\" \"t1br2if1\" ; fi\n", "delta": "0:00:00.106855", "end": "2019-11-18 00:09:25.773738", "item": [{"bridge_name": "t1br2", "default_route_ip": "10.1.2.1", "dns": [{"brif": "t1s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t1s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns2", "route": [{"if": "p1", "ip": "10.1.2.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "2.2.2.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns2if", "tenant_ns_ip": "10.1.2.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s2if", "tenant_sub_ip": "10.1.2.2/24"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, {"brif": "t1br2if1", "disk": "10G", "mem": 3, "name": "t1_VM3", "vcpu": 2, "vmif": "t1VM3if1"}], "rc": 0, "start": "2019-11-18 00:09:25.666883", "stderr": "", "stderr_lines": [], "stdout": "24: t1br2if1@t1VM3if1: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP mode DEFAULT group default qlen 1000\n    link/ether ba:d8:2f:e0:98:a5 brd ff:ff:ff:ff:ff:ff", "stdout_lines": ["24: t1br2if1@t1VM3if1: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP mode DEFAULT group default qlen 1000", "    link/ether ba:d8:2f:e0:98:a5 brd ff:ff:ff:ff:ff:ff"]}

TASK [All interfaces and bridges UP] ************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.1.2/24', u'tenant_ns_ip': u'10.1.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.1.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.1.2', u'remote_route': u'10.2.1.0/24', u'subnet_route': u'10.1.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.2.1.2'}]}, {u'mem': 2, u'name': u't1_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM1if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t1ns1\" ip link set \"t1br1if1\" up\nip netns exec \"t1ns1\" ip link set dev \"t1br1\" up\n", "delta": "0:00:00.072744", "end": "2019-11-18 00:09:26.089979", "item": [{"bridge_name": "t1br1", "default_route_ip": "10.1.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.1.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.1.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.1.1.2/24"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.1.2", "remote_ip": "10.2.1.2", "remote_route": "10.2.1.0/24", "subnet_route": "10.1.1.0/24", "tenant_route_ip": "192.168.1.2", "v_name": "vxlan_t1s1"}]}, {"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM1", "vcpu": 4, "vmif": "t1VM1if1"}], "rc": 0, "start": "2019-11-18 00:09:26.017235", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.1.2/24', u'tenant_ns_ip': u'10.1.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.1.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.1.2', u'remote_route': u'10.2.1.0/24', u'subnet_route': u'10.1.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.2.1.2'}]}, {u'mem': 4, u'name': u't1_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br1if2', u'vmif': u't1VM2if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t1ns1\" ip link set \"t1br1if2\" up\nip netns exec \"t1ns1\" ip link set dev \"t1br1\" up\n", "delta": "0:00:00.071083", "end": "2019-11-18 00:09:26.341771", "item": [{"bridge_name": "t1br1", "default_route_ip": "10.1.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.1.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.1.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.1.1.2/24"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.1.2", "remote_ip": "10.2.1.2", "remote_route": "10.2.1.0/24", "subnet_route": "10.1.1.0/24", "tenant_route_ip": "192.168.1.2", "v_name": "vxlan_t1s1"}]}, {"brif": "t1br1if2", "disk": "10G", "mem": 4, "name": "t1_VM2", "vcpu": 2, "vmif": "t1VM2if1"}], "rc": 0, "start": "2019-11-18 00:09:26.270688", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.2.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.2.1', u'bridge_name': u't1br2', u'dns': [{u'dnsif': u't1s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s2_dnsbrif'}], u'ns_name': u't1ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.2.2/24', u'tenant_ns_ip': u'10.1.2.1/24', u'tenant_ns_if': u't1ns2if', u'tenant_sub_if': u't1s2if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'2.2.2.0/24', u'vxlan': [{u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}, {u'mem': 3, u'name': u't1_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br2if1', u'vmif': u't1VM3if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t1ns2\" ip link set \"t1br2if1\" up\nip netns exec \"t1ns2\" ip link set dev \"t1br2\" up\n", "delta": "0:00:00.077643", "end": "2019-11-18 00:09:26.605669", "item": [{"bridge_name": "t1br2", "default_route_ip": "10.1.2.1", "dns": [{"brif": "t1s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t1s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns2", "route": [{"if": "p1", "ip": "10.1.2.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "2.2.2.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns2if", "tenant_ns_ip": "10.1.2.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s2if", "tenant_sub_ip": "10.1.2.2/24"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, {"brif": "t1br2if1", "disk": "10G", "mem": 3, "name": "t1_VM3", "vcpu": 2, "vmif": "t1VM3if1"}], "rc": 0, "start": "2019-11-18 00:09:26.528026", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Add IP to DNS Interface] ******************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.1.1', u'bridge_name': u't1br1', u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.1.2/24', u'tenant_ns_ip': u'10.1.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't1_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM1if1'}, {u'mem': 4, u'name': u't1_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br1if2', u'vmif': u't1VM2if1'}], u'vxlan': [{u'local_ip': u'10.1.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.1.2', u'remote_route': u'10.2.1.0/24', u'subnet_route': u'10.1.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.2.1.2'}]}, {u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t1ns1\" ip addr show \"t1s1_dnsif\" | awk 'FNR==3{ print $2 }' | grep -w '^1.1.1.1/24' ; if [ $? -ne 0 ] ; then ip netns exec \"t1ns1\" ip addr add \"1.1.1.1/24\" dev \"t1s1_dnsif\" ; fi\n", "delta": "0:00:00.083686", "end": "2019-11-18 00:09:26.957864", "item": [{"bridge_name": "t1br1", "default_route_ip": "10.1.1.1", "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.1.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.1.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.1.1.2/24"}], "vms": [{"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM1", "vcpu": 4, "vmif": "t1VM1if1"}, {"brif": "t1br1if2", "disk": "10G", "mem": 4, "name": "t1_VM2", "vcpu": 2, "vmif": "t1VM2if1"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.1.2", "remote_ip": "10.2.1.2", "remote_route": "10.2.1.0/24", "subnet_route": "10.1.1.0/24", "tenant_route_ip": "192.168.1.2", "v_name": "vxlan_t1s1"}]}, {"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "rc": 0, "start": "2019-11-18 00:09:26.874178", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.2.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.2.1', u'bridge_name': u't1br2', u'ns_name': u't1ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.2.2/24', u'tenant_ns_ip': u'10.1.2.1/24', u'tenant_ns_if': u't1ns2if', u'tenant_sub_if': u't1s2if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'2.2.2.0/24', u'vms': [{u'mem': 3, u'name': u't1_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br2if1', u'vmif': u't1VM3if1'}], u'vxlan': [{u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}, {u'dnsif': u't1s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s2_dnsbrif'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t1ns2\" ip addr show \"t1s2_dnsif\" | awk 'FNR==3{ print $2 }' | grep -w '^2.2.2.1/24' ; if [ $? -ne 0 ] ; then ip netns exec \"t1ns2\" ip addr add \"2.2.2.1/24\" dev \"t1s2_dnsif\" ; fi\n", "delta": "0:00:00.070307", "end": "2019-11-18 00:09:27.241921", "item": [{"bridge_name": "t1br2", "default_route_ip": "10.1.2.1", "ns_name": "t1ns2", "route": [{"if": "p1", "ip": "10.1.2.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "2.2.2.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns2if", "tenant_ns_ip": "10.1.2.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s2if", "tenant_sub_ip": "10.1.2.2/24"}], "vms": [{"brif": "t1br2if1", "disk": "10G", "mem": 3, "name": "t1_VM3", "vcpu": 2, "vmif": "t1VM3if1"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, {"brif": "t1s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t1s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "rc": 0, "start": "2019-11-18 00:09:27.171614", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Install DHCP Server] **********************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.1.1', u'bridge_name': u't1br1', u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.1.2/24', u'tenant_ns_ip': u'10.1.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't1_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM1if1'}, {u'mem': 4, u'name': u't1_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br1if2', u'vmif': u't1VM2if1'}], u'vxlan': [{u'local_ip': u'10.1.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.1.2', u'remote_route': u'10.2.1.0/24', u'subnet_route': u'10.1.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.2.1.2'}]}, {u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t1ns1\" ps aux | grep -w '[d]nsmasq --interface t1s1_dnsif -z --dhcp-range=1.1.1.5,1.1.1.126' ; if [ $? -ne 0 ] ; then ip netns exec \"t1ns1\" dnsmasq --interface \"t1s1_dnsif\" -z --dhcp-range=1.1.1.5,'1.1.1.126' ; fi\n", "delta": "0:00:00.070577", "end": "2019-11-18 00:09:27.586779", "item": [{"bridge_name": "t1br1", "default_route_ip": "10.1.1.1", "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.1.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.1.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.1.1.2/24"}], "vms": [{"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM1", "vcpu": 4, "vmif": "t1VM1if1"}, {"brif": "t1br1if2", "disk": "10G", "mem": 4, "name": "t1_VM2", "vcpu": 2, "vmif": "t1VM2if1"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.1.2", "remote_ip": "10.2.1.2", "remote_route": "10.2.1.0/24", "subnet_route": "10.1.1.0/24", "tenant_route_ip": "192.168.1.2", "v_name": "vxlan_t1s1"}]}, {"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "rc": 0, "start": "2019-11-18 00:09:27.516202", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.2.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.2.1', u'bridge_name': u't1br2', u'ns_name': u't1ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.2.2/24', u'tenant_ns_ip': u'10.1.2.1/24', u'tenant_ns_if': u't1ns2if', u'tenant_sub_if': u't1s2if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'2.2.2.0/24', u'vms': [{u'mem': 3, u'name': u't1_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br2if1', u'vmif': u't1VM3if1'}], u'vxlan': [{u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}, {u'dnsif': u't1s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s2_dnsbrif'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t1ns2\" ps aux | grep -w '[d]nsmasq --interface t1s2_dnsif -z --dhcp-range=2.2.2.5,2.2.2.254' ; if [ $? -ne 0 ] ; then ip netns exec \"t1ns2\" dnsmasq --interface \"t1s2_dnsif\" -z --dhcp-range=2.2.2.5,'2.2.2.254' ; fi\n", "delta": "0:00:00.065855", "end": "2019-11-18 00:09:27.874155", "item": [{"bridge_name": "t1br2", "default_route_ip": "10.1.2.1", "ns_name": "t1ns2", "route": [{"if": "p1", "ip": "10.1.2.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "2.2.2.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns2if", "tenant_ns_ip": "10.1.2.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s2if", "tenant_sub_ip": "10.1.2.2/24"}], "vms": [{"brif": "t1br2if1", "disk": "10G", "mem": 3, "name": "t1_VM3", "vcpu": 2, "vmif": "t1VM3if1"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, {"brif": "t1s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t1s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "rc": 0, "start": "2019-11-18 00:09:27.808300", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Create VXLAN devices] *********************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.1.2/24', u'tenant_ns_ip': u'10.1.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't1_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM1if1'}, {u'mem': 4, u'name': u't1_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br1if2', u'vmif': u't1VM2if1'}]}, {u'local_ip': u'10.1.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.1.2', u'remote_route': u'10.2.1.0/24', u'subnet_route': u'10.1.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.2.1.2'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t1ns1\" ip link show \"vxlan_t1s1\" ; if [ $? -ne 0 ] ; then ip netns exec \"t1ns1\" ip link add \"vxlan_t1s1\" type vxlan id \"42\" local \"10.1.1.2\" remote \"10.2.1.2\" dstport \"4789\" dev \"t1s1if\"; ip netns exec \"t1ns1\" ip link set dev \"vxlan_t1s1\" up ; fi\n", "delta": "0:00:00.114335", "end": "2019-11-18 00:09:28.277925", "item": [{"bridge_name": "t1br1", "default_route_ip": "10.1.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.1.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.1.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.1.1.2/24"}], "vms": [{"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM1", "vcpu": 4, "vmif": "t1VM1if1"}, {"brif": "t1br1if2", "disk": "10G", "mem": 4, "name": "t1_VM2", "vcpu": 2, "vmif": "t1VM2if1"}]}, {"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.1.2", "remote_ip": "10.2.1.2", "remote_route": "10.2.1.0/24", "subnet_route": "10.1.1.0/24", "tenant_route_ip": "192.168.1.2", "v_name": "vxlan_t1s1"}], "rc": 0, "start": "2019-11-18 00:09:28.163590", "stderr": "Device \"vxlan_t1s1\" does not exist.", "stderr_lines": ["Device \"vxlan_t1s1\" does not exist."], "stdout": "", "stdout_lines": []}
skipping: [localhost] => (item=[{u'route': [{u'ip': u'10.1.2.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.2.1', u'bridge_name': u't1br2', u'dns': [{u'dnsif': u't1s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s2_dnsbrif'}], u'ns_name': u't1ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.2.2/24', u'tenant_ns_ip': u'10.1.2.1/24', u'tenant_ns_if': u't1ns2if', u'tenant_sub_if': u't1s2if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'2.2.2.0/24', u'vms': [{u'mem': 3, u'name': u't1_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br2if1', u'vmif': u't1VM3if1'}]}, {u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}])  => {"ansible_loop_var": "item", "changed": false, "item": [{"bridge_name": "t1br2", "default_route_ip": "10.1.2.1", "dns": [{"brif": "t1s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t1s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns2", "route": [{"if": "p1", "ip": "10.1.2.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "2.2.2.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns2if", "tenant_ns_ip": "10.1.2.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s2if", "tenant_sub_ip": "10.1.2.2/24"}], "vms": [{"brif": "t1br2if1", "disk": "10G", "mem": 3, "name": "t1_VM3", "vcpu": 2, "vmif": "t1VM3if1"}]}, {"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}], "skip_reason": "Conditional result was False"}

TASK [Attach VXLANs to bridge] ******************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.1.2/24', u'tenant_ns_ip': u'10.1.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't1_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM1if1'}, {u'mem': 4, u'name': u't1_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br1if2', u'vmif': u't1VM2if1'}]}, {u'local_ip': u'10.1.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.1.2', u'remote_route': u'10.2.1.0/24', u'subnet_route': u'10.1.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.2.1.2'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t1ns1\" brctl show \"t1br1\" | grep -w 'vxlan_t1s1' ; if [ $? -ne 0 ] ; then ip netns exec \"t1ns1\" brctl addif \"t1br1\" \"vxlan_t1s1\" ; fi\n", "delta": "0:00:00.074166", "end": "2019-11-18 00:09:28.658009", "item": [{"bridge_name": "t1br1", "default_route_ip": "10.1.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.1.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.1.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.1.1.2/24"}], "vms": [{"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM1", "vcpu": 4, "vmif": "t1VM1if1"}, {"brif": "t1br1if2", "disk": "10G", "mem": 4, "name": "t1_VM2", "vcpu": 2, "vmif": "t1VM2if1"}]}, {"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.1.2", "remote_ip": "10.2.1.2", "remote_route": "10.2.1.0/24", "subnet_route": "10.1.1.0/24", "tenant_route_ip": "192.168.1.2", "v_name": "vxlan_t1s1"}], "rc": 0, "start": "2019-11-18 00:09:28.583843", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}
skipping: [localhost] => (item=[{u'route': [{u'ip': u'10.1.2.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.2.1', u'bridge_name': u't1br2', u'dns': [{u'dnsif': u't1s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s2_dnsbrif'}], u'ns_name': u't1ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.2.2/24', u'tenant_ns_ip': u'10.1.2.1/24', u'tenant_ns_if': u't1ns2if', u'tenant_sub_if': u't1s2if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'2.2.2.0/24', u'vms': [{u'mem': 3, u'name': u't1_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br2if1', u'vmif': u't1VM3if1'}]}, {u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}])  => {"ansible_loop_var": "item", "changed": false, "item": [{"bridge_name": "t1br2", "default_route_ip": "10.1.2.1", "dns": [{"brif": "t1s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t1s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns2", "route": [{"if": "p1", "ip": "10.1.2.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "2.2.2.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns2if", "tenant_ns_ip": "10.1.2.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s2if", "tenant_sub_ip": "10.1.2.2/24"}], "vms": [{"brif": "t1br2if1", "disk": "10G", "mem": 3, "name": "t1_VM3", "vcpu": 2, "vmif": "t1VM3if1"}]}, {"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}], "skip_reason": "Conditional result was False"}

PLAY RECAP **************************************************************************************************************************************************
localhost                  : ok=21   changed=21   unreachable=0    failed=0    skipped=0    rescued=0    ignored=0   

Using /etc/ansible/ansible.cfg as config file

PLAY [worker] ***********************************************************************************************************************************************

TASK [Create Tenant Namespace] ******************************************************************************************************************************
changed: [99.99.99.2] => (item={u'default_route_ip': u'192.168.129.1', u'name': u't1', u'pns_ip': u'192.168.129.1/24', u'tenant_if': u't1if', u'tenant_ip': u'192.168.129.2/24', u'pns_if': u't1pns_if'}) => {"ansible_loop_var": "item", "changed": true, "cmd": ["ip", "netns", "add", "t1"], "delta": "0:00:00.061360", "end": "2019-11-18 00:09:30.612519", "item": {"default_route_ip": "192.168.129.1", "name": "t1", "pns_if": "t1pns_if", "pns_ip": "192.168.129.1/24", "tenant_if": "t1if", "tenant_ip": "192.168.129.2/24"}, "rc": 0, "start": "2019-11-18 00:09:30.551159", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Create Subnet Namespace] ******************************************************************************************************************************
changed: [99.99.99.2] => (item={u'route': [{u'ip': u'10.2.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.2.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.1.2/24', u'tenant_ns_ip': u'10.2.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_ns_name': u't1', u'tenant_sub_if': u't1s1if'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't1_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM4if1'}], u'vxlan': [{u'local_ip': u'10.2.1.2', u'tenant_route_ip': u'192.168.129.2', u'dsport': 4789, u'dev': u't1s1if', u'subnet_route': u'10.2.1.0/24', u'remote_route': u'10.1.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.1.1.2'}]}) => {"ansible_loop_var": "item", "changed": true, "cmd": ["ip", "netns", "add", "t1ns1"], "delta": "0:00:00.059298", "end": "2019-11-18 00:09:31.076479", "item": {"bridge_name": "t1br1", "default_route_ip": "10.2.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.2.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.2.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.2.1.2/24"}], "vms": [{"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM4", "vcpu": 4, "vmif": "t1VM4if1"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.1.2", "remote_ip": "10.1.1.2", "remote_route": "10.1.1.0/24", "subnet_route": "10.2.1.0/24", "tenant_route_ip": "192.168.129.2", "v_name": "vxlan_t1s1"}]}, "rc": 0, "start": "2019-11-18 00:09:31.017181", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Create Tenant VETH pairs] *****************************************************************************************************************************
changed: [99.99.99.2] => (item={u'default_route_ip': u'192.168.129.1', u'name': u't1', u'pns_ip': u'192.168.129.1/24', u'tenant_if': u't1if', u'tenant_ip': u'192.168.129.2/24', u'pns_if': u't1pns_if'}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip link show \"t1if\" ; if [ $? -ne 0 ] ; then ip link add \"t1if\" type veth peer name \"t1pns_if\" ; fi\n", "delta": "0:00:00.012402", "end": "2019-11-18 00:09:31.467053", "item": {"default_route_ip": "192.168.129.1", "name": "t1", "pns_if": "t1pns_if", "pns_ip": "192.168.129.1/24", "tenant_if": "t1if", "tenant_ip": "192.168.129.2/24"}, "rc": 0, "start": "2019-11-18 00:09:31.454651", "stderr": "Device \"t1if\" does not exist.", "stderr_lines": ["Device \"t1if\" does not exist."], "stdout": "", "stdout_lines": []}

TASK [Attach Tenant VETH Pairs] *****************************************************************************************************************************
changed: [99.99.99.2] => (item={u'default_route_ip': u'192.168.129.1', u'name': u't1', u'pns_ip': u'192.168.129.1/24', u'tenant_if': u't1if', u'tenant_ip': u'192.168.129.2/24', u'pns_if': u't1pns_if'}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec pns ip link show \"t1pns_if\" ; if [ $? -ne 0 ] ; then ip link set \"t1pns_if\" netns pns ; fi\nip netns exec \"t1\" ip link show \"t1if\" ; if [ $? -ne 0 ] ; then ip link set \"t1if\" netns \"t1\" ; fi\nip netns exec pns ip link set dev \"t1pns_if\" up\nip netns exec \"t1\" ip link set dev \"t1if\" up\n", "delta": "0:00:00.199088", "end": "2019-11-18 00:09:32.048240", "item": {"default_route_ip": "192.168.129.1", "name": "t1", "pns_if": "t1pns_if", "pns_ip": "192.168.129.1/24", "tenant_if": "t1if", "tenant_ip": "192.168.129.2/24"}, "rc": 0, "start": "2019-11-18 00:09:31.849152", "stderr": "Device \"t1pns_if\" does not exist.\nDevice \"t1if\" does not exist.", "stderr_lines": ["Device \"t1pns_if\" does not exist.", "Device \"t1if\" does not exist."], "stdout": "", "stdout_lines": []}

TASK [Add IP addresses to Tenant VETH Pairs] ****************************************************************************************************************
changed: [99.99.99.2] => (item={u'default_route_ip': u'192.168.129.1', u'name': u't1', u'pns_ip': u'192.168.129.1/24', u'tenant_if': u't1if', u'tenant_ip': u'192.168.129.2/24', u'pns_if': u't1pns_if'}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec pns ip addr show \"t1pns_if\" | awk 'FNR==3{ print $2 }' | grep -w '^192.168.129.1/24' ; if [ $? -ne 0 ] ; then ip netns exec pns ip addr add \"192.168.129.1/24\" dev \"t1pns_if\" ; fi\nip netns exec \"t1\" ip addr show \"t1if\" | awk 'FNR==3{ print $2 }' | grep -w '^192.168.129.2/24' ; if [ $? -ne 0 ] ; then ip netns exec \"t1\" ip addr add \"192.168.129.2/24\" dev \"t1if\" ; fi\n", "delta": "0:00:00.164685", "end": "2019-11-18 00:09:32.592453", "item": {"default_route_ip": "192.168.129.1", "name": "t1", "pns_if": "t1pns_if", "pns_ip": "192.168.129.1/24", "tenant_if": "t1if", "tenant_ip": "192.168.129.2/24"}, "rc": 0, "start": "2019-11-18 00:09:32.427768", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Create Namespace VETH Pairs] **************************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.2.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't1_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM4if1'}], u'vxlan': [{u'local_ip': u'10.2.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.129.2', u'remote_route': u'10.1.1.0/24', u'subnet_route': u'10.2.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.1.1.2'}]}, {u'tenant_sub_ip': u'10.2.1.2/24', u'tenant_ns_ip': u'10.2.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip link show \"t1ns1if\" ; if [ $? -ne 0 ] ; then ip link add \"t1ns1if\" type veth peer name \"t1s1if\" ; fi\n", "delta": "0:00:00.012430", "end": "2019-11-18 00:09:32.971322", "item": [{"bridge_name": "t1br1", "default_route_ip": "10.2.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.2.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "vms": [{"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM4", "vcpu": 4, "vmif": "t1VM4if1"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.1.2", "remote_ip": "10.1.1.2", "remote_route": "10.1.1.0/24", "subnet_route": "10.2.1.0/24", "tenant_route_ip": "192.168.129.2", "v_name": "vxlan_t1s1"}]}, {"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.2.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.2.1.2/24"}], "rc": 0, "start": "2019-11-18 00:09:32.958892", "stderr": "Device \"t1ns1if\" does not exist.", "stderr_lines": ["Device \"t1ns1if\" does not exist."], "stdout": "", "stdout_lines": []}

TASK [Attach Namespace VETH Pairs] **************************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.2.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't1_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM4if1'}], u'vxlan': [{u'local_ip': u'10.2.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.129.2', u'remote_route': u'10.1.1.0/24', u'subnet_route': u'10.2.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.1.1.2'}]}, {u'tenant_sub_ip': u'10.2.1.2/24', u'tenant_ns_ip': u'10.2.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t1\" ip link show \"t1ns1if\" ; if [ $? -ne 0 ] ; then ip link set \"t1ns1if\" netns \"t1\" ; fi\nip netns exec \"t1ns1\" ip link show \"t1s1if\" ; if [ $? -ne 0 ] ; then ip link set \"t1s1if\" netns \"t1ns1\" ; fi\n", "delta": "0:00:00.119718", "end": "2019-11-18 00:09:33.505667", "item": [{"bridge_name": "t1br1", "default_route_ip": "10.2.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.2.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "vms": [{"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM4", "vcpu": 4, "vmif": "t1VM4if1"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.1.2", "remote_ip": "10.1.1.2", "remote_route": "10.1.1.0/24", "subnet_route": "10.2.1.0/24", "tenant_route_ip": "192.168.129.2", "v_name": "vxlan_t1s1"}]}, {"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.2.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.2.1.2/24"}], "rc": 0, "start": "2019-11-18 00:09:33.385949", "stderr": "Device \"t1ns1if\" does not exist.\nDevice \"t1s1if\" does not exist.", "stderr_lines": ["Device \"t1ns1if\" does not exist.", "Device \"t1s1if\" does not exist."], "stdout": "", "stdout_lines": []}

TASK [Set Namespace VETH Pairs UP] **************************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.2.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't1_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM4if1'}], u'vxlan': [{u'local_ip': u'10.2.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.129.2', u'remote_route': u'10.1.1.0/24', u'subnet_route': u'10.2.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.1.1.2'}]}, {u'tenant_sub_ip': u'10.2.1.2/24', u'tenant_ns_ip': u'10.2.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t1\" ip link set dev \"t1ns1if\" up\nip netns exec \"t1ns1\" ip link set dev \"t1s1if\" up\n", "delta": "0:00:00.091129", "end": "2019-11-18 00:09:33.972595", "item": [{"bridge_name": "t1br1", "default_route_ip": "10.2.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.2.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "vms": [{"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM4", "vcpu": 4, "vmif": "t1VM4if1"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.1.2", "remote_ip": "10.1.1.2", "remote_route": "10.1.1.0/24", "subnet_route": "10.2.1.0/24", "tenant_route_ip": "192.168.129.2", "v_name": "vxlan_t1s1"}]}, {"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.2.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.2.1.2/24"}], "rc": 0, "start": "2019-11-18 00:09:33.881466", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Add IP addresses to Namespace VETH Pairs] *************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.2.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't1_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM4if1'}], u'vxlan': [{u'local_ip': u'10.2.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.129.2', u'remote_route': u'10.1.1.0/24', u'subnet_route': u'10.2.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.1.1.2'}]}, {u'tenant_sub_ip': u'10.2.1.2/24', u'tenant_ns_ip': u'10.2.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t1ns1\" ip addr show \"t1s1if\" | awk 'FNR==3{ print $2 }' | grep -w '^10.2.1.2/24' ; if [ $? -ne 0 ] ; then ip netns exec \"t1ns1\" ip addr add \"10.2.1.2/24\" dev \"t1s1if\" ; fi\n\nip netns exec \"t1\" ip addr show \"t1ns1if\" | awk 'FNR==3{ print $2 }' | grep -w '^10.2.1.1/24' ; if [ $? -ne 0 ] ; then ip netns exec \"t1\" ip addr add \"10.2.1.1/24\" dev \"t1ns1if\" ; fi\n", "delta": "0:00:00.160969", "end": "2019-11-18 00:09:34.504293", "item": [{"bridge_name": "t1br1", "default_route_ip": "10.2.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.2.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "vms": [{"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM4", "vcpu": 4, "vmif": "t1VM4if1"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.1.2", "remote_ip": "10.1.1.2", "remote_route": "10.1.1.0/24", "subnet_route": "10.2.1.0/24", "tenant_route_ip": "192.168.129.2", "v_name": "vxlan_t1s1"}]}, {"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.2.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.2.1.2/24"}], "rc": 0, "start": "2019-11-18 00:09:34.343324", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Add IP Route to Tenant] *******************************************************************************************************************************
changed: [99.99.99.2] => (item={u'default_route_ip': u'192.168.129.1', u'name': u't1', u'pns_ip': u'192.168.129.1/24', u'tenant_if': u't1if', u'tenant_ip': u'192.168.129.2/24', u'pns_if': u't1pns_if'}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t1\" ip route show default | grep -w '[d]efault via 192.168.129.1' ; if [ $? -ne 0 ] ; then ip netns exec \"t1\" ip route add default via \"192.168.129.1\" ; fi\n", "delta": "0:00:00.078992", "end": "2019-11-18 00:09:34.964387", "item": {"default_route_ip": "192.168.129.1", "name": "t1", "pns_if": "t1pns_if", "pns_ip": "192.168.129.1/24", "tenant_if": "t1if", "tenant_ip": "192.168.129.2/24"}, "rc": 0, "start": "2019-11-18 00:09:34.885395", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Add IP Route to Tenant Subnet] ************************************************************************************************************************
changed: [99.99.99.2] => (item={u'route': [{u'ip': u'10.2.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.2.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.1.2/24', u'tenant_ns_ip': u'10.2.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_ns_name': u't1', u'tenant_sub_if': u't1s1if'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't1_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM4if1'}], u'vxlan': [{u'local_ip': u'10.2.1.2', u'tenant_route_ip': u'192.168.129.2', u'dsport': 4789, u'dev': u't1s1if', u'subnet_route': u'10.2.1.0/24', u'remote_route': u'10.1.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.1.1.2'}]}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t1ns1\" ip route show default | grep -w '[d]efault via 10.2.1.1' ; if [ $? -ne 0 ] ; then ip netns exec \"t1ns1\" ip route add default via \"10.2.1.1\" ; fi\n", "delta": "0:00:00.086332", "end": "2019-11-18 00:09:35.436522", "item": {"bridge_name": "t1br1", "default_route_ip": "10.2.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.2.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.2.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.2.1.2/24"}], "vms": [{"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM4", "vcpu": 4, "vmif": "t1VM4if1"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.1.2", "remote_ip": "10.1.1.2", "remote_route": "10.1.1.0/24", "subnet_route": "10.2.1.0/24", "tenant_route_ip": "192.168.129.2", "v_name": "vxlan_t1s1"}]}, "rc": 0, "start": "2019-11-18 00:09:35.350190", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Create bridge inside namespace] ***********************************************************************************************************************
changed: [99.99.99.2] => (item={u'route': [{u'ip': u'10.2.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.2.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.1.2/24', u'tenant_ns_ip': u'10.2.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_ns_name': u't1', u'tenant_sub_if': u't1s1if'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't1_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM4if1'}], u'vxlan': [{u'local_ip': u'10.2.1.2', u'tenant_route_ip': u'192.168.129.2', u'dsport': 4789, u'dev': u't1s1if', u'subnet_route': u'10.2.1.0/24', u'remote_route': u'10.1.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.1.1.2'}]}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t1ns1\" brctl show | grep -w '^t1br1'; if [ $? -ne 0 ] ; then ip netns exec \"t1ns1\" brctl addbr \"t1br1\" ; fi\nip netns exec \"t1ns1\" ip link set dev \"t1br1\" up\n", "delta": "0:00:00.139127", "end": "2019-11-18 00:09:35.940550", "item": {"bridge_name": "t1br1", "default_route_ip": "10.2.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.2.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.2.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.2.1.2/24"}], "vms": [{"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM4", "vcpu": 4, "vmif": "t1VM4if1"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.1.2", "remote_ip": "10.1.1.2", "remote_route": "10.1.1.0/24", "subnet_route": "10.2.1.0/24", "tenant_route_ip": "192.168.129.2", "v_name": "vxlan_t1s1"}]}, "rc": 0, "start": "2019-11-18 00:09:35.801423", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Create DNS VETH Pair] *********************************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.2.1.1', u'bridge_name': u't1br1', u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.1.2/24', u'tenant_ns_ip': u'10.2.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't1_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM4if1'}], u'vxlan': [{u'local_ip': u'10.2.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.129.2', u'remote_route': u'10.1.1.0/24', u'subnet_route': u'10.2.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.1.1.2'}]}, {u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t1ns1\" ip link show \"t1s1_dnsbrif\" ; if [ $? -ne 0 ] ; then ip netns exec \"t1ns1\" ip link add \"t1s1_dnsbrif\" type veth peer name \"t1s1_dnsif\" ; fi\nip netns exec \"t1ns1\" ip link set dev \"t1s1_dnsbrif\" up\nip netns exec \"t1ns1\" ip link set dev \"t1s1_dnsif\" up\n", "delta": "0:00:00.166343", "end": "2019-11-18 00:09:36.496534", "item": [{"bridge_name": "t1br1", "default_route_ip": "10.2.1.1", "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.2.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.2.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.2.1.2/24"}], "vms": [{"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM4", "vcpu": 4, "vmif": "t1VM4if1"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.1.2", "remote_ip": "10.1.1.2", "remote_route": "10.1.1.0/24", "subnet_route": "10.2.1.0/24", "tenant_route_ip": "192.168.129.2", "v_name": "vxlan_t1s1"}]}, {"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "rc": 0, "start": "2019-11-18 00:09:36.330191", "stderr": "Device \"t1s1_dnsbrif\" does not exist.", "stderr_lines": ["Device \"t1s1_dnsbrif\" does not exist."], "stdout": "", "stdout_lines": []}

TASK [Attach DNS VETH Pair] *********************************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.2.1.1', u'bridge_name': u't1br1', u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.1.2/24', u'tenant_ns_ip': u'10.2.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't1_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM4if1'}], u'vxlan': [{u'local_ip': u'10.2.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.129.2', u'remote_route': u'10.1.1.0/24', u'subnet_route': u'10.2.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.1.1.2'}]}, {u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t1ns1\" brctl show \"t1br1\" | grep -w 't1s1_dnsbrif' ; if [ $? -ne 0 ] ; then ip netns exec \"t1ns1\" brctl addif \"t1br1\" \"t1s1_dnsbrif\" ; fi\n", "delta": "0:00:00.089385", "end": "2019-11-18 00:09:36.984442", "item": [{"bridge_name": "t1br1", "default_route_ip": "10.2.1.1", "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.2.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.2.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.2.1.2/24"}], "vms": [{"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM4", "vcpu": 4, "vmif": "t1VM4if1"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.1.2", "remote_ip": "10.1.1.2", "remote_route": "10.1.1.0/24", "subnet_route": "10.2.1.0/24", "tenant_route_ip": "192.168.129.2", "v_name": "vxlan_t1s1"}]}, {"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "rc": 0, "start": "2019-11-18 00:09:36.895057", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Create VETH Pairs] ************************************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.2.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.1.2/24', u'tenant_ns_ip': u'10.2.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.2.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.129.2', u'remote_route': u'10.1.1.0/24', u'subnet_route': u'10.2.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.1.1.2'}]}, {u'mem': 2, u'name': u't1_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM4if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip link show \"t1br1if1\" ; if [ $? -ne 0 ] ; then ip link add \"t1VM4if1\" type veth peer name \"t1br1if1\" ; fi\nip link set dev \"t1br1if1\" up\nip link set dev \"t1VM4if1\" up\n", "delta": "0:00:00.021429", "end": "2019-11-18 00:09:37.381646", "item": [{"bridge_name": "t1br1", "default_route_ip": "10.2.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.2.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.2.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.2.1.2/24"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.1.2", "remote_ip": "10.1.1.2", "remote_route": "10.1.1.0/24", "subnet_route": "10.2.1.0/24", "tenant_route_ip": "192.168.129.2", "v_name": "vxlan_t1s1"}]}, {"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM4", "vcpu": 4, "vmif": "t1VM4if1"}], "rc": 0, "start": "2019-11-18 00:09:37.360217", "stderr": "Device \"t1br1if1\" does not exist.", "stderr_lines": ["Device \"t1br1if1\" does not exist."], "stdout": "", "stdout_lines": []}

TASK [Attach VETH Pairs] ************************************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.2.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.1.2/24', u'tenant_ns_ip': u'10.2.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.2.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.129.2', u'remote_route': u'10.1.1.0/24', u'subnet_route': u'10.2.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.1.1.2'}]}, {u'mem': 2, u'name': u't1_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM4if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip link show \"t1br1if1\" ; if [ $? -eq 0 ] ; then ip link set \"t1br1if1\" netns \"t1ns1\" ; fi\nip netns exec \"t1ns1\" brctl show \"t1br1\" | grep -w 't1br1if1' ; if [ $? -ne 0 ] ; then ip netns exec \"t1ns1\" brctl addif \"t1br1\" \"t1br1if1\" ; fi\n", "delta": "0:00:00.102724", "end": "2019-11-18 00:09:37.864092", "item": [{"bridge_name": "t1br1", "default_route_ip": "10.2.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.2.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.2.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.2.1.2/24"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.1.2", "remote_ip": "10.1.1.2", "remote_route": "10.1.1.0/24", "subnet_route": "10.2.1.0/24", "tenant_route_ip": "192.168.129.2", "v_name": "vxlan_t1s1"}]}, {"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM4", "vcpu": 4, "vmif": "t1VM4if1"}], "rc": 0, "start": "2019-11-18 00:09:37.761368", "stderr": "", "stderr_lines": [], "stdout": "18: t1br1if1@t1VM4if1: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP mode DEFAULT group default qlen 1000\n    link/ether fa:7e:01:76:74:11 brd ff:ff:ff:ff:ff:ff", "stdout_lines": ["18: t1br1if1@t1VM4if1: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP mode DEFAULT group default qlen 1000", "    link/ether fa:7e:01:76:74:11 brd ff:ff:ff:ff:ff:ff"]}

TASK [All interfaces and bridges UP] ************************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.2.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.1.2/24', u'tenant_ns_ip': u'10.2.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.2.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.129.2', u'remote_route': u'10.1.1.0/24', u'subnet_route': u'10.2.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.1.1.2'}]}, {u'mem': 2, u'name': u't1_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM4if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t1ns1\" ip link set \"t1br1if1\" up\nip netns exec \"t1ns1\" ip link set dev \"t1br1\" up\n", "delta": "0:00:00.067901", "end": "2019-11-18 00:09:38.304363", "item": [{"bridge_name": "t1br1", "default_route_ip": "10.2.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.2.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.2.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.2.1.2/24"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.1.2", "remote_ip": "10.1.1.2", "remote_route": "10.1.1.0/24", "subnet_route": "10.2.1.0/24", "tenant_route_ip": "192.168.129.2", "v_name": "vxlan_t1s1"}]}, {"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM4", "vcpu": 4, "vmif": "t1VM4if1"}], "rc": 0, "start": "2019-11-18 00:09:38.236462", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Add IP to DNS Interface] ******************************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.2.1.1', u'bridge_name': u't1br1', u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.1.2/24', u'tenant_ns_ip': u'10.2.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't1_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM4if1'}], u'vxlan': [{u'local_ip': u'10.2.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.129.2', u'remote_route': u'10.1.1.0/24', u'subnet_route': u'10.2.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.1.1.2'}]}, {u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t1ns1\" ip addr show \"t1s1_dnsif\" | awk 'FNR==3{ print $2}'| grep -w '^1.1.1.128/24' ; if [ $? -ne 0 ] ; then ip netns exec \"t1ns1\" ip addr add \"1.1.1.128/24\" dev \"t1s1_dnsif\" ; fi\n", "delta": "0:00:00.094420", "end": "2019-11-18 00:09:38.764444", "item": [{"bridge_name": "t1br1", "default_route_ip": "10.2.1.1", "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.2.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.2.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.2.1.2/24"}], "vms": [{"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM4", "vcpu": 4, "vmif": "t1VM4if1"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.1.2", "remote_ip": "10.1.1.2", "remote_route": "10.1.1.0/24", "subnet_route": "10.2.1.0/24", "tenant_route_ip": "192.168.129.2", "v_name": "vxlan_t1s1"}]}, {"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "rc": 0, "start": "2019-11-18 00:09:38.670024", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Install DHCP Server] **********************************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.2.1.1', u'bridge_name': u't1br1', u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.1.2/24', u'tenant_ns_ip': u'10.2.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't1_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM4if1'}], u'vxlan': [{u'local_ip': u'10.2.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.129.2', u'remote_route': u'10.1.1.0/24', u'subnet_route': u'10.2.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.1.1.2'}]}, {u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t1ns1\" ps aux | grep -w '[d]nsmasq --interface t1s1_dnsif -z --dhcp-range=1.1.1.133,1.1.1.254' ; if [ $? -ne 0 ] ; then ip netns exec \"t1ns1\" dnsmasq --interface \"t1s1_dnsif\" -z --dhcp-range=1.1.1.133,'1.1.1.254' ; fi\n", "delta": "0:00:00.087662", "end": "2019-11-18 00:09:39.229465", "item": [{"bridge_name": "t1br1", "default_route_ip": "10.2.1.1", "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.2.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.2.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.2.1.2/24"}], "vms": [{"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM4", "vcpu": 4, "vmif": "t1VM4if1"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.1.2", "remote_ip": "10.1.1.2", "remote_route": "10.1.1.0/24", "subnet_route": "10.2.1.0/24", "tenant_route_ip": "192.168.129.2", "v_name": "vxlan_t1s1"}]}, {"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "rc": 0, "start": "2019-11-18 00:09:39.141803", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Create VXLAN devices] *********************************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.2.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.1.2/24', u'tenant_ns_ip': u'10.2.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't1_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM4if1'}]}, {u'local_ip': u'10.2.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.129.2', u'remote_route': u'10.1.1.0/24', u'subnet_route': u'10.2.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.1.1.2'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t1ns1\" ip link show \"vxlan_t1s1\" ; if [ $? -ne 0 ] ; then ip netns exec \"t1ns1\" ip link add \"vxlan_t1s1\" type vxlan id \"42\" local \"10.2.1.2\" remote \"10.1.1.2\" dstport \"4789\" dev \"t1s1if\" ; ip netns exec \"t1ns1\" ip link set dev \"vxlan_t1s1\" up ; fi\n", "delta": "0:00:00.131466", "end": "2019-11-18 00:09:39.764425", "item": [{"bridge_name": "t1br1", "default_route_ip": "10.2.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.2.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.2.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.2.1.2/24"}], "vms": [{"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM4", "vcpu": 4, "vmif": "t1VM4if1"}]}, {"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.1.2", "remote_ip": "10.1.1.2", "remote_route": "10.1.1.0/24", "subnet_route": "10.2.1.0/24", "tenant_route_ip": "192.168.129.2", "v_name": "vxlan_t1s1"}], "rc": 0, "start": "2019-11-18 00:09:39.632959", "stderr": "Device \"vxlan_t1s1\" does not exist.", "stderr_lines": ["Device \"vxlan_t1s1\" does not exist."], "stdout": "", "stdout_lines": []}

TASK [Attach VXLANs to bridge] ******************************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.2.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.1.2/24', u'tenant_ns_ip': u'10.2.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't1_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM4if1'}]}, {u'local_ip': u'10.2.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.129.2', u'remote_route': u'10.1.1.0/24', u'subnet_route': u'10.2.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.1.1.2'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t1ns1\" brctl show \"t1br1\" | grep -w 'vxlan_t1s1' ; if [ $? -ne 0 ] ; then ip netns exec \"t1ns1\" brctl addif \"t1br1\" \"vxlan_t1s1\" ; fi\n", "delta": "0:00:00.070047", "end": "2019-11-18 00:09:40.252445", "item": [{"bridge_name": "t1br1", "default_route_ip": "10.2.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.2.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.2.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.2.1.2/24"}], "vms": [{"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM4", "vcpu": 4, "vmif": "t1VM4if1"}]}, {"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.1.2", "remote_ip": "10.1.1.2", "remote_route": "10.1.1.0/24", "subnet_route": "10.2.1.0/24", "tenant_route_ip": "192.168.129.2", "v_name": "vxlan_t1s1"}], "rc": 0, "start": "2019-11-18 00:09:40.182398", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

PLAY RECAP **************************************************************************************************************************************************
99.99.99.2                 : ok=21   changed=21   unreachable=0    failed=0    skipped=0    rescued=0    ignored=0   

Using /etc/ansible/ansible.cfg as config file

PLAY [main] *************************************************************************************************************************************************

TASK [Add VXLAN routes in PNS] ******************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.1.2/24', u'tenant_ns_ip': u'10.1.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't1_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM1if1'}, {u'mem': 4, u'name': u't1_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br1if2', u'vmif': u't1VM2if1'}]}, {u'local_ip': u'10.1.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.1.2', u'remote_route': u'10.2.1.0/24', u'subnet_route': u'10.1.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.2.1.2'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec pns ip route show \"10.1.1.0/24\" via \"192.168.1.2\" | grep -w '^10.1.1.0/24' ; if [ $? -ne 0 ] ; then ip netns exec pns ip route add \"10.1.1.0/24\" via \"192.168.1.2\" ; fi\n", "delta": "0:00:00.072171", "end": "2019-11-18 00:09:41.361601", "item": [{"bridge_name": "t1br1", "default_route_ip": "10.1.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.1.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.1.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.1.1.2/24"}], "vms": [{"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM1", "vcpu": 4, "vmif": "t1VM1if1"}, {"brif": "t1br1if2", "disk": "10G", "mem": 4, "name": "t1_VM2", "vcpu": 2, "vmif": "t1VM2if1"}]}, {"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.1.2", "remote_ip": "10.2.1.2", "remote_route": "10.2.1.0/24", "subnet_route": "10.1.1.0/24", "tenant_route_ip": "192.168.1.2", "v_name": "vxlan_t1s1"}], "rc": 0, "start": "2019-11-18 00:09:41.289430", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}
skipping: [localhost] => (item=[{u'route': [{u'ip': u'10.1.2.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.2.1', u'bridge_name': u't1br2', u'dns': [{u'dnsif': u't1s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s2_dnsbrif'}], u'ns_name': u't1ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.2.2/24', u'tenant_ns_ip': u'10.1.2.1/24', u'tenant_ns_if': u't1ns2if', u'tenant_sub_if': u't1s2if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'2.2.2.0/24', u'vms': [{u'mem': 3, u'name': u't1_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br2if1', u'vmif': u't1VM3if1'}]}, {u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}])  => {"ansible_loop_var": "item", "changed": false, "item": [{"bridge_name": "t1br2", "default_route_ip": "10.1.2.1", "dns": [{"brif": "t1s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t1s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns2", "route": [{"if": "p1", "ip": "10.1.2.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "2.2.2.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns2if", "tenant_ns_ip": "10.1.2.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s2if", "tenant_sub_ip": "10.1.2.2/24"}], "vms": [{"brif": "t1br2if1", "disk": "10G", "mem": 3, "name": "t1_VM3", "vcpu": 2, "vmif": "t1VM3if1"}]}, {"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}], "skip_reason": "Conditional result was False"}

TASK [Get PNS ip address] ***********************************************************************************************************************************
ok: [localhost] => {"changed": false, "cmd": "ip netns exec pns ip addr show p1 | awk 'FNR==3{ print $2 }' | awk -F/ '{ print $1 }'\n", "delta": "0:00:00.046387", "end": "2019-11-18 00:09:41.650125", "rc": 0, "start": "2019-11-18 00:09:41.603738", "stderr": "", "stderr_lines": [], "stdout": "192.168.100.238", "stdout_lines": ["192.168.100.238"]}

TASK [Add VXLAN routes to host] *****************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.1.2/24', u'tenant_ns_ip': u'10.1.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't1_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM1if1'}, {u'mem': 4, u'name': u't1_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br1if2', u'vmif': u't1VM2if1'}]}, {u'local_ip': u'10.1.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.1.2', u'remote_route': u'10.2.1.0/24', u'subnet_route': u'10.1.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.2.1.2'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip route show \"10.1.1.0/24\" via \"192.168.100.238\" | grep -w '^10.1.1.0/24' ; if [ $? -ne 0 ] ; then ip route add \"10.1.1.0/24\" via \"192.168.100.238\" ; fi\nip route show \"10.2.1.0/24\" via 99.99.99.2 | grep -w '^10.2.1.0/24'; if [ $? -ne 0 ] ; then ip route add \"10.2.1.0/24\" via 99.99.99.2 ; fi\n", "delta": "0:00:00.007375", "end": "2019-11-18 00:09:41.912762", "item": [{"bridge_name": "t1br1", "default_route_ip": "10.1.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.1.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.1.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.1.1.2/24"}], "vms": [{"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM1", "vcpu": 4, "vmif": "t1VM1if1"}, {"brif": "t1br1if2", "disk": "10G", "mem": 4, "name": "t1_VM2", "vcpu": 2, "vmif": "t1VM2if1"}]}, {"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.1.2", "remote_ip": "10.2.1.2", "remote_route": "10.2.1.0/24", "subnet_route": "10.1.1.0/24", "tenant_route_ip": "192.168.1.2", "v_name": "vxlan_t1s1"}], "rc": 0, "start": "2019-11-18 00:09:41.905387", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}
skipping: [localhost] => (item=[{u'route': [{u'ip': u'10.1.2.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.2.1', u'bridge_name': u't1br2', u'dns': [{u'dnsif': u't1s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s2_dnsbrif'}], u'ns_name': u't1ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.2.2/24', u'tenant_ns_ip': u'10.1.2.1/24', u'tenant_ns_if': u't1ns2if', u'tenant_sub_if': u't1s2if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'2.2.2.0/24', u'vms': [{u'mem': 3, u'name': u't1_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br2if1', u'vmif': u't1VM3if1'}]}, {u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}])  => {"ansible_loop_var": "item", "changed": false, "item": [{"bridge_name": "t1br2", "default_route_ip": "10.1.2.1", "dns": [{"brif": "t1s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t1s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns2", "route": [{"if": "p1", "ip": "10.1.2.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "2.2.2.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns2if", "tenant_ns_ip": "10.1.2.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s2if", "tenant_sub_ip": "10.1.2.2/24"}], "vms": [{"brif": "t1br2if1", "disk": "10G", "mem": 3, "name": "t1_VM3", "vcpu": 2, "vmif": "t1VM3if1"}]}, {"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}], "skip_reason": "Conditional result was False"}

PLAY RECAP **************************************************************************************************************************************************
localhost                  : ok=3    changed=2    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0   

Using /etc/ansible/ansible.cfg as config file

PLAY [worker] ***********************************************************************************************************************************************

TASK [Add VXLAN routes in PNS] ******************************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.2.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.1.2/24', u'tenant_ns_ip': u'10.2.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't1_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM4if1'}]}, {u'local_ip': u'10.2.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.129.2', u'remote_route': u'10.1.1.0/24', u'subnet_route': u'10.2.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.1.1.2'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec pns ip route show \"10.2.1.0/24\" via \"192.168.129.2\" | grep -w '^10.2.1.0/24' ; if [ $? -ne 0 ] ; then ip netns exec pns ip route add \"10.2.1.0/24\" via \"192.168.129.2\" ; fi\n", "delta": "0:00:00.071886", "end": "2019-11-18 00:09:43.120257", "item": [{"bridge_name": "t1br1", "default_route_ip": "10.2.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.2.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.2.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.2.1.2/24"}], "vms": [{"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM4", "vcpu": 4, "vmif": "t1VM4if1"}]}, {"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.1.2", "remote_ip": "10.1.1.2", "remote_route": "10.1.1.0/24", "subnet_route": "10.2.1.0/24", "tenant_route_ip": "192.168.129.2", "v_name": "vxlan_t1s1"}], "rc": 0, "start": "2019-11-18 00:09:43.048371", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Get PNS ip address] ***********************************************************************************************************************************
ok: [99.99.99.2] => {"changed": false, "cmd": "ip netns exec pns ip addr show p1 | awk 'FNR==3{ print $2 }' | awk -F/ '{ print $1 }'\n", "delta": "0:00:00.044516", "end": "2019-11-18 00:09:43.552850", "rc": 0, "start": "2019-11-18 00:09:43.508334", "stderr": "", "stderr_lines": [], "stdout": "192.168.100.50", "stdout_lines": ["192.168.100.50"]}

TASK [Add VXLAN routes to host] *****************************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.2.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.1.2/24', u'tenant_ns_ip': u'10.2.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't1_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM4if1'}]}, {u'local_ip': u'10.2.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.129.2', u'remote_route': u'10.1.1.0/24', u'subnet_route': u'10.2.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.1.1.2'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip route show \"10.2.1.0/24\" via \"192.168.100.50\" | grep -w '^10.2.1.0/24' ; if [ $? -ne 0 ] ; then ip route add \"10.2.1.0/24\" via \"192.168.100.50\" ; fi\nip route show \"10.1.1.0/24\" via 99.99.99.1 | grep -w '^10.1.1.0/24'; if [ $? -ne 0 ] ; then ip route add \"10.1.1.0/24\" via 99.99.99.1 ; fi\n", "delta": "0:00:00.007767", "end": "2019-11-18 00:09:43.960693", "item": [{"bridge_name": "t1br1", "default_route_ip": "10.2.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.2.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.2.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.2.1.2/24"}], "vms": [{"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM4", "vcpu": 4, "vmif": "t1VM4if1"}]}, {"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.1.2", "remote_ip": "10.1.1.2", "remote_route": "10.1.1.0/24", "subnet_route": "10.2.1.0/24", "tenant_route_ip": "192.168.129.2", "v_name": "vxlan_t1s1"}], "rc": 0, "start": "2019-11-18 00:09:43.952926", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

PLAY RECAP **************************************************************************************************************************************************
99.99.99.2                 : ok=3    changed=2    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0   

Using /etc/ansible/ansible.cfg as config file

PLAY [main] *************************************************************************************************************************************************

TASK [Create VM templates (C1)] *****************************************************************************************************************************
ok: [localhost] => (item=[{u'route': [{u'ip': u'10.1.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.1.2/24', u'tenant_ns_ip': u'10.1.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.1.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.1.2', u'remote_route': u'10.2.1.0/24', u'subnet_route': u'10.1.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.2.1.2'}]}, {u'mem': 2, u'name': u't1_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM1if1'}]) => {"ansible_loop_var": "item", "changed": false, "checksum": "350ba870bd31b7f6ee517845c14237910b5af0bf", "dest": "/root/Migration-as-a-Service/t1/VM_templates/t1_VM1.xml.j2", "gid": 0, "group": "root", "item": [{"bridge_name": "t1br1", "default_route_ip": "10.1.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.1.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.1.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.1.1.2/24"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.1.2", "remote_ip": "10.2.1.2", "remote_route": "10.2.1.0/24", "subnet_route": "10.1.1.0/24", "tenant_route_ip": "192.168.1.2", "v_name": "vxlan_t1s1"}]}, {"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM1", "vcpu": 4, "vmif": "t1VM1if1"}], "mode": "0644", "owner": "root", "path": "/root/Migration-as-a-Service/t1/VM_templates/t1_VM1.xml.j2", "size": 4091, "state": "file", "uid": 0}
ok: [localhost] => (item=[{u'route': [{u'ip': u'10.1.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.1.2/24', u'tenant_ns_ip': u'10.1.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.1.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.1.2', u'remote_route': u'10.2.1.0/24', u'subnet_route': u'10.1.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.2.1.2'}]}, {u'mem': 4, u'name': u't1_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br1if2', u'vmif': u't1VM2if1'}]) => {"ansible_loop_var": "item", "changed": false, "checksum": "350ba870bd31b7f6ee517845c14237910b5af0bf", "dest": "/root/Migration-as-a-Service/t1/VM_templates/t1_VM2.xml.j2", "gid": 0, "group": "root", "item": [{"bridge_name": "t1br1", "default_route_ip": "10.1.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.1.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.1.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.1.1.2/24"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.1.2", "remote_ip": "10.2.1.2", "remote_route": "10.2.1.0/24", "subnet_route": "10.1.1.0/24", "tenant_route_ip": "192.168.1.2", "v_name": "vxlan_t1s1"}]}, {"brif": "t1br1if2", "disk": "10G", "mem": 4, "name": "t1_VM2", "vcpu": 2, "vmif": "t1VM2if1"}], "mode": "0644", "owner": "root", "path": "/root/Migration-as-a-Service/t1/VM_templates/t1_VM2.xml.j2", "size": 4091, "state": "file", "uid": 0}
ok: [localhost] => (item=[{u'route': [{u'ip': u'10.1.2.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.2.1', u'bridge_name': u't1br2', u'dns': [{u'dnsif': u't1s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s2_dnsbrif'}], u'ns_name': u't1ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.2.2/24', u'tenant_ns_ip': u'10.1.2.1/24', u'tenant_ns_if': u't1ns2if', u'tenant_sub_if': u't1s2if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'2.2.2.0/24', u'vxlan': [{u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}, {u'mem': 3, u'name': u't1_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br2if1', u'vmif': u't1VM3if1'}]) => {"ansible_loop_var": "item", "changed": false, "checksum": "350ba870bd31b7f6ee517845c14237910b5af0bf", "dest": "/root/Migration-as-a-Service/t1/VM_templates/t1_VM3.xml.j2", "gid": 0, "group": "root", "item": [{"bridge_name": "t1br2", "default_route_ip": "10.1.2.1", "dns": [{"brif": "t1s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t1s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns2", "route": [{"if": "p1", "ip": "10.1.2.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "2.2.2.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns2if", "tenant_ns_ip": "10.1.2.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s2if", "tenant_sub_ip": "10.1.2.2/24"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, {"brif": "t1br2if1", "disk": "10G", "mem": 3, "name": "t1_VM3", "vcpu": 2, "vmif": "t1VM3if1"}], "mode": "0644", "owner": "root", "path": "/root/Migration-as-a-Service/t1/VM_templates/t1_VM3.xml.j2", "size": 4091, "state": "file", "uid": 0}

PLAY RECAP **************************************************************************************************************************************************
localhost                  : ok=1    changed=0    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0   

Using /etc/ansible/ansible.cfg as config file

PLAY [main] *************************************************************************************************************************************************

TASK [Create VM templates (C2)] *****************************************************************************************************************************
ok: [localhost] => (item=[{u'route': [{u'ip': u'10.2.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.2.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.1.2/24', u'tenant_ns_ip': u'10.2.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.2.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.129.2', u'remote_route': u'10.1.1.0/24', u'subnet_route': u'10.2.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.1.1.2'}]}, {u'mem': 2, u'name': u't1_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM4if1'}]) => {"ansible_loop_var": "item", "changed": false, "checksum": "350ba870bd31b7f6ee517845c14237910b5af0bf", "dest": "/root/Migration-as-a-Service/t1/VM_templates/t1_VM4.xml.j2", "gid": 0, "group": "root", "item": [{"bridge_name": "t1br1", "default_route_ip": "10.2.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.2.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.2.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.2.1.2/24"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.1.2", "remote_ip": "10.1.1.2", "remote_route": "10.1.1.0/24", "subnet_route": "10.2.1.0/24", "tenant_route_ip": "192.168.129.2", "v_name": "vxlan_t1s1"}]}, {"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM4", "vcpu": 4, "vmif": "t1VM4if1"}], "mode": "0644", "owner": "root", "path": "/root/Migration-as-a-Service/t1/VM_templates/t1_VM4.xml.j2", "size": 4091, "state": "file", "uid": 0}

PLAY RECAP **************************************************************************************************************************************************
localhost                  : ok=1    changed=0    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0   

Using /etc/ansible/ansible.cfg as config file

PLAY [main] *************************************************************************************************************************************************

TASK [Copy VM image] ****************************************************************************************************************************************
ok: [localhost] => (item=[{u'route': [{u'ip': u'10.1.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.1.2/24', u'tenant_ns_ip': u'10.1.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.1.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.1.2', u'remote_route': u'10.2.1.0/24', u'subnet_route': u'10.1.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.2.1.2'}]}, {u'mem': 2, u'name': u't1_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM1if1'}]) => {"ansible_loop_var": "item", "changed": false, "dest": "/var/lib/libvirt/images/t1_VM1.qcow2", "item": [{"bridge_name": "t1br1", "default_route_ip": "10.1.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.1.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.1.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.1.1.2/24"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.1.2", "remote_ip": "10.2.1.2", "remote_route": "10.2.1.0/24", "subnet_route": "10.1.1.0/24", "tenant_route_ip": "192.168.1.2", "v_name": "vxlan_t1s1"}]}, {"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM1", "vcpu": 4, "vmif": "t1VM1if1"}], "src": "/root/mainVM.qcow2"}
ok: [localhost] => (item=[{u'route': [{u'ip': u'10.1.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.1.2/24', u'tenant_ns_ip': u'10.1.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.1.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.1.2', u'remote_route': u'10.2.1.0/24', u'subnet_route': u'10.1.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.2.1.2'}]}, {u'mem': 4, u'name': u't1_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br1if2', u'vmif': u't1VM2if1'}]) => {"ansible_loop_var": "item", "changed": false, "dest": "/var/lib/libvirt/images/t1_VM2.qcow2", "item": [{"bridge_name": "t1br1", "default_route_ip": "10.1.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.1.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.1.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.1.1.2/24"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.1.2", "remote_ip": "10.2.1.2", "remote_route": "10.2.1.0/24", "subnet_route": "10.1.1.0/24", "tenant_route_ip": "192.168.1.2", "v_name": "vxlan_t1s1"}]}, {"brif": "t1br1if2", "disk": "10G", "mem": 4, "name": "t1_VM2", "vcpu": 2, "vmif": "t1VM2if1"}], "src": "/root/mainVM.qcow2"}
ok: [localhost] => (item=[{u'route': [{u'ip': u'10.1.2.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.2.1', u'bridge_name': u't1br2', u'dns': [{u'dnsif': u't1s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s2_dnsbrif'}], u'ns_name': u't1ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.2.2/24', u'tenant_ns_ip': u'10.1.2.1/24', u'tenant_ns_if': u't1ns2if', u'tenant_sub_if': u't1s2if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'2.2.2.0/24', u'vxlan': [{u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}, {u'mem': 3, u'name': u't1_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br2if1', u'vmif': u't1VM3if1'}]) => {"ansible_loop_var": "item", "changed": false, "dest": "/var/lib/libvirt/images/t1_VM3.qcow2", "item": [{"bridge_name": "t1br2", "default_route_ip": "10.1.2.1", "dns": [{"brif": "t1s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t1s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns2", "route": [{"if": "p1", "ip": "10.1.2.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "2.2.2.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns2if", "tenant_ns_ip": "10.1.2.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s2if", "tenant_sub_ip": "10.1.2.2/24"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, {"brif": "t1br2if1", "disk": "10G", "mem": 3, "name": "t1_VM3", "vcpu": 2, "vmif": "t1VM3if1"}], "src": "/root/mainVM.qcow2"}

TASK [Create VM templates (C1)] *****************************************************************************************************************************
ok: [localhost] => (item=[{u'route': [{u'ip': u'10.1.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.1.2/24', u'tenant_ns_ip': u'10.1.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.1.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.1.2', u'remote_route': u'10.2.1.0/24', u'subnet_route': u'10.1.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.2.1.2'}]}, {u'mem': 2, u'name': u't1_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM1if1'}]) => {"ansible_loop_var": "item", "changed": false, "checksum": "350ba870bd31b7f6ee517845c14237910b5af0bf", "dest": "/root/Migration-as-a-Service/t1/VM_templates/t1_VM1.xml.j2", "gid": 0, "group": "root", "item": [{"bridge_name": "t1br1", "default_route_ip": "10.1.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.1.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.1.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.1.1.2/24"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.1.2", "remote_ip": "10.2.1.2", "remote_route": "10.2.1.0/24", "subnet_route": "10.1.1.0/24", "tenant_route_ip": "192.168.1.2", "v_name": "vxlan_t1s1"}]}, {"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM1", "vcpu": 4, "vmif": "t1VM1if1"}], "mode": "0644", "owner": "root", "path": "/root/Migration-as-a-Service/t1/VM_templates/t1_VM1.xml.j2", "size": 4091, "state": "file", "uid": 0}
ok: [localhost] => (item=[{u'route': [{u'ip': u'10.1.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.1.2/24', u'tenant_ns_ip': u'10.1.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.1.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.1.2', u'remote_route': u'10.2.1.0/24', u'subnet_route': u'10.1.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.2.1.2'}]}, {u'mem': 4, u'name': u't1_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br1if2', u'vmif': u't1VM2if1'}]) => {"ansible_loop_var": "item", "changed": false, "checksum": "350ba870bd31b7f6ee517845c14237910b5af0bf", "dest": "/root/Migration-as-a-Service/t1/VM_templates/t1_VM2.xml.j2", "gid": 0, "group": "root", "item": [{"bridge_name": "t1br1", "default_route_ip": "10.1.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.1.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.1.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.1.1.2/24"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.1.2", "remote_ip": "10.2.1.2", "remote_route": "10.2.1.0/24", "subnet_route": "10.1.1.0/24", "tenant_route_ip": "192.168.1.2", "v_name": "vxlan_t1s1"}]}, {"brif": "t1br1if2", "disk": "10G", "mem": 4, "name": "t1_VM2", "vcpu": 2, "vmif": "t1VM2if1"}], "mode": "0644", "owner": "root", "path": "/root/Migration-as-a-Service/t1/VM_templates/t1_VM2.xml.j2", "size": 4091, "state": "file", "uid": 0}
ok: [localhost] => (item=[{u'route': [{u'ip': u'10.1.2.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.2.1', u'bridge_name': u't1br2', u'dns': [{u'dnsif': u't1s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s2_dnsbrif'}], u'ns_name': u't1ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.2.2/24', u'tenant_ns_ip': u'10.1.2.1/24', u'tenant_ns_if': u't1ns2if', u'tenant_sub_if': u't1s2if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'2.2.2.0/24', u'vxlan': [{u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}, {u'mem': 3, u'name': u't1_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br2if1', u'vmif': u't1VM3if1'}]) => {"ansible_loop_var": "item", "changed": false, "checksum": "350ba870bd31b7f6ee517845c14237910b5af0bf", "dest": "/root/Migration-as-a-Service/t1/VM_templates/t1_VM3.xml.j2", "gid": 0, "group": "root", "item": [{"bridge_name": "t1br2", "default_route_ip": "10.1.2.1", "dns": [{"brif": "t1s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t1s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns2", "route": [{"if": "p1", "ip": "10.1.2.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "2.2.2.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns2if", "tenant_ns_ip": "10.1.2.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s2if", "tenant_sub_ip": "10.1.2.2/24"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, {"brif": "t1br2if1", "disk": "10G", "mem": 3, "name": "t1_VM3", "vcpu": 2, "vmif": "t1VM3if1"}], "mode": "0644", "owner": "root", "path": "/root/Migration-as-a-Service/t1/VM_templates/t1_VM3.xml.j2", "size": 4091, "state": "file", "uid": 0}

TASK [Get list of running VMs] ******************************************************************************************************************************
ok: [localhost] => {"changed": false, "cmd": ["virsh", "list", "--name"], "delta": "0:00:00.018347", "end": "2019-11-18 00:09:49.387664", "rc": 0, "start": "2019-11-18 00:09:49.369317", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Define VM] ********************************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.1.2/24', u'tenant_ns_ip': u'10.1.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.1.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.1.2', u'remote_route': u'10.2.1.0/24', u'subnet_route': u'10.1.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.2.1.2'}]}, {u'mem': 2, u'name': u't1_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM1if1'}]) => {"ansible_loop_var": "item", "changed": true, "created": "t1_VM1", "item": [{"bridge_name": "t1br1", "default_route_ip": "10.1.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.1.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.1.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.1.1.2/24"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.1.2", "remote_ip": "10.2.1.2", "remote_route": "10.2.1.0/24", "subnet_route": "10.1.1.0/24", "tenant_route_ip": "192.168.1.2", "v_name": "vxlan_t1s1"}]}, {"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM1", "vcpu": 4, "vmif": "t1VM1if1"}], "warnings": ["'xml' is given - ignoring 'name'"]}
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.1.2/24', u'tenant_ns_ip': u'10.1.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.1.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.1.2', u'remote_route': u'10.2.1.0/24', u'subnet_route': u'10.1.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.2.1.2'}]}, {u'mem': 4, u'name': u't1_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br1if2', u'vmif': u't1VM2if1'}]) => {"ansible_loop_var": "item", "changed": true, "created": "t1_VM2", "item": [{"bridge_name": "t1br1", "default_route_ip": "10.1.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.1.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.1.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.1.1.2/24"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.1.2", "remote_ip": "10.2.1.2", "remote_route": "10.2.1.0/24", "subnet_route": "10.1.1.0/24", "tenant_route_ip": "192.168.1.2", "v_name": "vxlan_t1s1"}]}, {"brif": "t1br1if2", "disk": "10G", "mem": 4, "name": "t1_VM2", "vcpu": 2, "vmif": "t1VM2if1"}], "warnings": ["'xml' is given - ignoring 'name'"]}
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.2.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.2.1', u'bridge_name': u't1br2', u'dns': [{u'dnsif': u't1s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s2_dnsbrif'}], u'ns_name': u't1ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.2.2/24', u'tenant_ns_ip': u'10.1.2.1/24', u'tenant_ns_if': u't1ns2if', u'tenant_sub_if': u't1s2if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'2.2.2.0/24', u'vxlan': [{u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}, {u'mem': 3, u'name': u't1_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br2if1', u'vmif': u't1VM3if1'}]) => {"ansible_loop_var": "item", "changed": true, "created": "t1_VM3", "item": [{"bridge_name": "t1br2", "default_route_ip": "10.1.2.1", "dns": [{"brif": "t1s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t1s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns2", "route": [{"if": "p1", "ip": "10.1.2.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "2.2.2.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns2if", "tenant_ns_ip": "10.1.2.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s2if", "tenant_sub_ip": "10.1.2.2/24"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, {"brif": "t1br2if1", "disk": "10G", "mem": 3, "name": "t1_VM3", "vcpu": 2, "vmif": "t1VM3if1"}], "warnings": ["'xml' is given - ignoring 'name'"]}

TASK [Create VM] ********************************************************************************************************************************************
ok: [localhost] => (item=[{u'route': [{u'ip': u'10.1.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.1.2/24', u'tenant_ns_ip': u'10.1.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.1.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.1.2', u'remote_route': u'10.2.1.0/24', u'subnet_route': u'10.1.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.2.1.2'}]}, {u'mem': 2, u'name': u't1_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM1if1'}]) => {"ansible_loop_var": "item", "changed": false, "create": 0, "item": [{"bridge_name": "t1br1", "default_route_ip": "10.1.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.1.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.1.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.1.1.2/24"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.1.2", "remote_ip": "10.2.1.2", "remote_route": "10.2.1.0/24", "subnet_route": "10.1.1.0/24", "tenant_route_ip": "192.168.1.2", "v_name": "vxlan_t1s1"}]}, {"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM1", "vcpu": 4, "vmif": "t1VM1if1"}]}
ok: [localhost] => (item=[{u'route': [{u'ip': u'10.1.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.1.2/24', u'tenant_ns_ip': u'10.1.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.1.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.1.2', u'remote_route': u'10.2.1.0/24', u'subnet_route': u'10.1.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.2.1.2'}]}, {u'mem': 4, u'name': u't1_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br1if2', u'vmif': u't1VM2if1'}]) => {"ansible_loop_var": "item", "changed": false, "create": 0, "item": [{"bridge_name": "t1br1", "default_route_ip": "10.1.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.1.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.1.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.1.1.2/24"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.1.2", "remote_ip": "10.2.1.2", "remote_route": "10.2.1.0/24", "subnet_route": "10.1.1.0/24", "tenant_route_ip": "192.168.1.2", "v_name": "vxlan_t1s1"}]}, {"brif": "t1br1if2", "disk": "10G", "mem": 4, "name": "t1_VM2", "vcpu": 2, "vmif": "t1VM2if1"}]}
ok: [localhost] => (item=[{u'route': [{u'ip': u'10.1.2.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.2.1', u'bridge_name': u't1br2', u'dns': [{u'dnsif': u't1s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s2_dnsbrif'}], u'ns_name': u't1ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.2.2/24', u'tenant_ns_ip': u'10.1.2.1/24', u'tenant_ns_if': u't1ns2if', u'tenant_sub_if': u't1s2if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'2.2.2.0/24', u'vxlan': [{u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}, {u'mem': 3, u'name': u't1_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br2if1', u'vmif': u't1VM3if1'}]) => {"ansible_loop_var": "item", "changed": false, "create": 0, "item": [{"bridge_name": "t1br2", "default_route_ip": "10.1.2.1", "dns": [{"brif": "t1s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t1s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns2", "route": [{"if": "p1", "ip": "10.1.2.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "2.2.2.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns2if", "tenant_ns_ip": "10.1.2.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s2if", "tenant_sub_ip": "10.1.2.2/24"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, {"brif": "t1br2if1", "disk": "10G", "mem": 3, "name": "t1_VM3", "vcpu": 2, "vmif": "t1VM3if1"}]}

TASK [Start VM] *********************************************************************************************************************************************
ok: [localhost] => (item=[{u'route': [{u'ip': u'10.1.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.1.2/24', u'tenant_ns_ip': u'10.1.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.1.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.1.2', u'remote_route': u'10.2.1.0/24', u'subnet_route': u'10.1.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.2.1.2'}]}, {u'mem': 2, u'name': u't1_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM1if1'}]) => {"ansible_loop_var": "item", "changed": false, "item": [{"bridge_name": "t1br1", "default_route_ip": "10.1.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.1.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.1.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.1.1.2/24"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.1.2", "remote_ip": "10.2.1.2", "remote_route": "10.2.1.0/24", "subnet_route": "10.1.1.0/24", "tenant_route_ip": "192.168.1.2", "v_name": "vxlan_t1s1"}]}, {"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM1", "vcpu": 4, "vmif": "t1VM1if1"}]}
ok: [localhost] => (item=[{u'route': [{u'ip': u'10.1.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.1.2/24', u'tenant_ns_ip': u'10.1.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.1.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.1.2', u'remote_route': u'10.2.1.0/24', u'subnet_route': u'10.1.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.2.1.2'}]}, {u'mem': 4, u'name': u't1_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br1if2', u'vmif': u't1VM2if1'}]) => {"ansible_loop_var": "item", "changed": false, "item": [{"bridge_name": "t1br1", "default_route_ip": "10.1.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.1.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.1.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.1.1.2/24"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.1.2", "remote_ip": "10.2.1.2", "remote_route": "10.2.1.0/24", "subnet_route": "10.1.1.0/24", "tenant_route_ip": "192.168.1.2", "v_name": "vxlan_t1s1"}]}, {"brif": "t1br1if2", "disk": "10G", "mem": 4, "name": "t1_VM2", "vcpu": 2, "vmif": "t1VM2if1"}]}
ok: [localhost] => (item=[{u'route': [{u'ip': u'10.1.2.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.2.1', u'bridge_name': u't1br2', u'dns': [{u'dnsif': u't1s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s2_dnsbrif'}], u'ns_name': u't1ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.2.2/24', u'tenant_ns_ip': u'10.1.2.1/24', u'tenant_ns_if': u't1ns2if', u'tenant_sub_if': u't1s2if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'2.2.2.0/24', u'vxlan': [{u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}, {u'mem': 3, u'name': u't1_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br2if1', u'vmif': u't1VM3if1'}]) => {"ansible_loop_var": "item", "changed": false, "item": [{"bridge_name": "t1br2", "default_route_ip": "10.1.2.1", "dns": [{"brif": "t1s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t1s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns2", "route": [{"if": "p1", "ip": "10.1.2.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "2.2.2.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns2if", "tenant_ns_ip": "10.1.2.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s2if", "tenant_sub_ip": "10.1.2.2/24"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, {"brif": "t1br2if1", "disk": "10G", "mem": 3, "name": "t1_VM3", "vcpu": 2, "vmif": "t1VM3if1"}]}

TASK [Attach VM interface] **********************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.1.2/24', u'tenant_ns_ip': u'10.1.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.1.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.1.2', u'remote_route': u'10.2.1.0/24', u'subnet_route': u'10.1.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.2.1.2'}]}, {u'mem': 2, u'name': u't1_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM1if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "virsh domiflist \"t1_VM1\" | grep -w 't1VM1if1' ; if [ $? -ne 0 ] ; then virsh attach-interface \"t1_VM1\" direct \"t1VM1if1\" --live --persistent ; fi\n", "delta": "0:00:00.289368", "end": "2019-11-18 00:09:54.897807", "item": [{"bridge_name": "t1br1", "default_route_ip": "10.1.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.1.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.1.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.1.1.2/24"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.1.2", "remote_ip": "10.2.1.2", "remote_route": "10.2.1.0/24", "subnet_route": "10.1.1.0/24", "tenant_route_ip": "192.168.1.2", "v_name": "vxlan_t1s1"}]}, {"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM1", "vcpu": 4, "vmif": "t1VM1if1"}], "rc": 0, "start": "2019-11-18 00:09:54.608439", "stderr": "", "stderr_lines": [], "stdout": "Interface attached successfully", "stdout_lines": ["Interface attached successfully"]}
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.1.2/24', u'tenant_ns_ip': u'10.1.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.1.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.1.2', u'remote_route': u'10.2.1.0/24', u'subnet_route': u'10.1.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.2.1.2'}]}, {u'mem': 4, u'name': u't1_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br1if2', u'vmif': u't1VM2if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "virsh domiflist \"t1_VM2\" | grep -w 't1VM2if1' ; if [ $? -ne 0 ] ; then virsh attach-interface \"t1_VM2\" direct \"t1VM2if1\" --live --persistent ; fi\n", "delta": "0:00:00.244762", "end": "2019-11-18 00:09:55.299871", "item": [{"bridge_name": "t1br1", "default_route_ip": "10.1.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.1.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.1.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.1.1.2/24"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.1.2", "remote_ip": "10.2.1.2", "remote_route": "10.2.1.0/24", "subnet_route": "10.1.1.0/24", "tenant_route_ip": "192.168.1.2", "v_name": "vxlan_t1s1"}]}, {"brif": "t1br1if2", "disk": "10G", "mem": 4, "name": "t1_VM2", "vcpu": 2, "vmif": "t1VM2if1"}], "rc": 0, "start": "2019-11-18 00:09:55.055109", "stderr": "", "stderr_lines": [], "stdout": "Interface attached successfully", "stdout_lines": ["Interface attached successfully"]}
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.2.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.2.1', u'bridge_name': u't1br2', u'dns': [{u'dnsif': u't1s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s2_dnsbrif'}], u'ns_name': u't1ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.2.2/24', u'tenant_ns_ip': u'10.1.2.1/24', u'tenant_ns_if': u't1ns2if', u'tenant_sub_if': u't1s2if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'2.2.2.0/24', u'vxlan': [{u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}, {u'mem': 3, u'name': u't1_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br2if1', u'vmif': u't1VM3if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "virsh domiflist \"t1_VM3\" | grep -w 't1VM3if1' ; if [ $? -ne 0 ] ; then virsh attach-interface \"t1_VM3\" direct \"t1VM3if1\" --live --persistent ; fi\n", "delta": "0:00:00.228492", "end": "2019-11-18 00:09:55.678454", "item": [{"bridge_name": "t1br2", "default_route_ip": "10.1.2.1", "dns": [{"brif": "t1s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t1s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns2", "route": [{"if": "p1", "ip": "10.1.2.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "2.2.2.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns2if", "tenant_ns_ip": "10.1.2.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s2if", "tenant_sub_ip": "10.1.2.2/24"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, {"brif": "t1br2if1", "disk": "10G", "mem": 3, "name": "t1_VM3", "vcpu": 2, "vmif": "t1VM3if1"}], "rc": 0, "start": "2019-11-18 00:09:55.449962", "stderr": "", "stderr_lines": [], "stdout": "Interface attached successfully", "stdout_lines": ["Interface attached successfully"]}

PLAY RECAP **************************************************************************************************************************************************
localhost                  : ok=7    changed=2    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0   

Using /etc/ansible/ansible.cfg as config file

PLAY [worker] ***********************************************************************************************************************************************

TASK [Copy VM image] ****************************************************************************************************************************************
ok: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.2.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.1.2/24', u'tenant_ns_ip': u'10.2.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.2.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.129.2', u'remote_route': u'10.1.1.0/24', u'subnet_route': u'10.2.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.1.1.2'}]}, {u'mem': 2, u'name': u't1_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM4if1'}]) => {"ansible_loop_var": "item", "changed": false, "dest": "/var/lib/libvirt/images/t1_VM4.qcow2", "gid": 0, "group": "root", "item": [{"bridge_name": "t1br1", "default_route_ip": "10.2.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.2.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.2.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.2.1.2/24"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.1.2", "remote_ip": "10.1.1.2", "remote_route": "10.1.1.0/24", "subnet_route": "10.2.1.0/24", "tenant_route_ip": "192.168.129.2", "v_name": "vxlan_t1s1"}]}, {"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM4", "vcpu": 4, "vmif": "t1VM4if1"}], "mode": "0644", "msg": "file already exists", "owner": "root", "size": 10739318784, "src": "/root/mainVM.qcow2", "state": "file", "uid": 0}

TASK [Get list of running VMs] ******************************************************************************************************************************
ok: [99.99.99.2] => {"changed": false, "cmd": ["virsh", "list", "--name"], "delta": "0:00:00.018772", "end": "2019-11-18 00:10:47.391692", "rc": 0, "start": "2019-11-18 00:10:47.372920", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Define VM] ********************************************************************************************************************************************
ok: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.2.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.1.2/24', u'tenant_ns_ip': u'10.2.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.2.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.129.2', u'remote_route': u'10.1.1.0/24', u'subnet_route': u'10.2.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.1.1.2'}]}, {u'mem': 2, u'name': u't1_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM4if1'}]) => {"ansible_loop_var": "item", "changed": false, "item": [{"bridge_name": "t1br1", "default_route_ip": "10.2.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.2.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.2.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.2.1.2/24"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.1.2", "remote_ip": "10.1.1.2", "remote_route": "10.1.1.0/24", "subnet_route": "10.2.1.0/24", "tenant_route_ip": "192.168.129.2", "v_name": "vxlan_t1s1"}]}, {"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM4", "vcpu": 4, "vmif": "t1VM4if1"}], "warnings": ["'xml' is given - ignoring 'name'"]}

TASK [Create VM] ********************************************************************************************************************************************
ok: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.2.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.1.2/24', u'tenant_ns_ip': u'10.2.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.2.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.129.2', u'remote_route': u'10.1.1.0/24', u'subnet_route': u'10.2.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.1.1.2'}]}, {u'mem': 2, u'name': u't1_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM4if1'}]) => {"ansible_loop_var": "item", "changed": false, "create": 0, "item": [{"bridge_name": "t1br1", "default_route_ip": "10.2.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.2.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.2.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.2.1.2/24"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.1.2", "remote_ip": "10.1.1.2", "remote_route": "10.1.1.0/24", "subnet_route": "10.2.1.0/24", "tenant_route_ip": "192.168.129.2", "v_name": "vxlan_t1s1"}]}, {"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM4", "vcpu": 4, "vmif": "t1VM4if1"}]}

TASK [Start VM] *********************************************************************************************************************************************
ok: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.2.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.1.2/24', u'tenant_ns_ip': u'10.2.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.2.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.129.2', u'remote_route': u'10.1.1.0/24', u'subnet_route': u'10.2.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.1.1.2'}]}, {u'mem': 2, u'name': u't1_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM4if1'}]) => {"ansible_loop_var": "item", "changed": false, "item": [{"bridge_name": "t1br1", "default_route_ip": "10.2.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.2.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.2.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.2.1.2/24"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.1.2", "remote_ip": "10.1.1.2", "remote_route": "10.1.1.0/24", "subnet_route": "10.2.1.0/24", "tenant_route_ip": "192.168.129.2", "v_name": "vxlan_t1s1"}]}, {"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM4", "vcpu": 4, "vmif": "t1VM4if1"}]}

TASK [Attach VM interface] **********************************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.2.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.1.2/24', u'tenant_ns_ip': u'10.2.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.2.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.129.2', u'remote_route': u'10.1.1.0/24', u'subnet_route': u'10.2.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.1.1.2'}]}, {u'mem': 2, u'name': u't1_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM4if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "virsh domiflist \"t1_VM4\" | grep -w 't1VM4if1' ; if [ $? -ne 0 ] ; then virsh attach-interface \"t1_VM4\" direct \"t1VM4if1\" --live --persistent ; fi\n", "delta": "0:00:00.022193", "end": "2019-11-18 00:10:50.216665", "item": [{"bridge_name": "t1br1", "default_route_ip": "10.2.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.2.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.2.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.2.1.2/24"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.1.2", "remote_ip": "10.1.1.2", "remote_route": "10.1.1.0/24", "subnet_route": "10.2.1.0/24", "tenant_route_ip": "192.168.129.2", "v_name": "vxlan_t1s1"}]}, {"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM4", "vcpu": 4, "vmif": "t1VM4if1"}], "rc": 0, "start": "2019-11-18 00:10:50.194472", "stderr": "", "stderr_lines": [], "stdout": "macvtap0   direct     t1VM4if1   rtl8139     52:54:00:d5:97:4d", "stdout_lines": ["macvtap0   direct     t1VM4if1   rtl8139     52:54:00:d5:97:4d"]}

PLAY RECAP **************************************************************************************************************************************************
99.99.99.2                 : ok=6    changed=1    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0   

INFO:root: 00:24:26.618580 Printing the yaml input file
INFO:root: 00:24:26.618879 {'C1': [{'subnet_addr': '1.1.1.0/24', 'VM': [{'name': 'VM1', 'disk': '10G', 'mem': 2, 'vcpu': 4}, {'name': 'VM2', 'disk': '10G', 'mem': 4, 'vcpu': 2}]}, {'subnet_addr': '2.2.2.0/24', 'VM': [{'name': 'VM3', 'disk': '10G', 'mem': 3, 'vcpu': 2}]}], 'C2': [{'subnet_addr': '1.1.1.0/24', 'VM': [{'name': 'VM4', 'disk': '10G', 'mem': 2, 'vcpu': 4}]}]}
INFO:root: 00:24:26.619029 Provided subnet in C1: 1.1.1.0/24 is valid
INFO:root: 00:24:26.619169 Provided subnet in C1: 2.2.2.0/24 is valid
INFO:root: 00:24:26.619253 Provided subnet in C2: 1.1.1.0/24 is valid
Using /etc/ansible/ansible.cfg as config file

PLAY [main] *************************************************************************************************************************************************

TASK [Create Tenant Namespace] ******************************************************************************************************************************
changed: [localhost] => (item={u'default_route_ip': u'192.168.2.1', u'name': u't2', u'pns_ip': u'192.168.2.1/24', u'tenant_if': u't2if', u'tenant_ip': u'192.168.2.2/24', u'pns_if': u't2pns_if'}) => {"ansible_loop_var": "item", "changed": true, "cmd": ["ip", "netns", "add", "t2"], "delta": "0:00:00.056744", "end": "2019-11-18 00:24:27.934842", "item": {"default_route_ip": "192.168.2.1", "name": "t2", "pns_if": "t2pns_if", "pns_ip": "192.168.2.1/24", "tenant_if": "t2if", "tenant_ip": "192.168.2.2/24"}, "rc": 0, "start": "2019-11-18 00:24:27.878098", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Create Subnet Namespace] ******************************************************************************************************************************
changed: [localhost] => (item={u'route': [{u'ip': u'10.1.11.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.1.11.1', u'bridge_name': u't2br1', u'dns': [{u'dnsif': u't2s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't2s1_dnsbrif'}], u'ns_name': u't2ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.11.2/24', u'tenant_ns_ip': u'10.1.11.1/24', u'tenant_ns_if': u't2ns1if', u'tenant_ns_name': u't2', u'tenant_sub_if': u't2s1if'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't2_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't2br1if1', u'vmif': u't2VM1if1'}, {u'mem': 4, u'name': u't2_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't2br1if2', u'vmif': u't2VM2if1'}], u'vxlan': [{u'local_ip': u'10.1.11.2', u'tenant_route_ip': u'192.168.2.2', u'dsport': 4789, u'dev': u't2s1if', u'subnet_route': u'10.1.11.0/24', u'remote_route': u'10.2.11.0/24', u'v_name': u'vxlan_t2s1', u'id': 42, u'remote_ip': u'10.2.11.2'}]}) => {"ansible_loop_var": "item", "changed": true, "cmd": ["ip", "netns", "add", "t2ns1"], "delta": "0:00:00.058702", "end": "2019-11-18 00:24:28.292488", "item": {"bridge_name": "t2br1", "default_route_ip": "10.1.11.1", "dns": [{"brif": "t2s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t2s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns1", "route": [{"if": "p1", "ip": "10.1.11.1/24", "ns_if": "t2if", "ns_name": "t2"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t2ns1if", "tenant_ns_ip": "10.1.11.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s1if", "tenant_sub_ip": "10.1.11.2/24"}], "vms": [{"brif": "t2br1if1", "disk": "10G", "mem": 2, "name": "t2_VM1", "vcpu": 4, "vmif": "t2VM1if1"}, {"brif": "t2br1if2", "disk": "10G", "mem": 4, "name": "t2_VM2", "vcpu": 2, "vmif": "t2VM2if1"}], "vxlan": [{"dev": "t2s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.11.2", "remote_ip": "10.2.11.2", "remote_route": "10.2.11.0/24", "subnet_route": "10.1.11.0/24", "tenant_route_ip": "192.168.2.2", "v_name": "vxlan_t2s1"}]}, "rc": 0, "start": "2019-11-18 00:24:28.233786", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}
changed: [localhost] => (item={u'route': [{u'ip': u'10.1.12.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.1.12.1', u'bridge_name': u't2br2', u'dns': [{u'dnsif': u't2s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't2s2_dnsbrif'}], u'ns_name': u't2ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.12.2/24', u'tenant_ns_ip': u'10.1.12.1/24', u'tenant_ns_if': u't2ns2if', u'tenant_ns_name': u't2', u'tenant_sub_if': u't2s2if'}], u'subnet_ip': u'2.2.2.0/24', u'vms': [{u'mem': 3, u'name': u't2_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't2br2if1', u'vmif': u't2VM3if1'}], u'vxlan': [{u'local_ip': [], u'tenant_route_ip': [], u'dsport': [], u'dev': [], u'subnet_route': [], u'remote_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}) => {"ansible_loop_var": "item", "changed": true, "cmd": ["ip", "netns", "add", "t2ns2"], "delta": "0:00:00.052166", "end": "2019-11-18 00:24:28.574003", "item": {"bridge_name": "t2br2", "default_route_ip": "10.1.12.1", "dns": [{"brif": "t2s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t2s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns2", "route": [{"if": "p1", "ip": "10.1.12.1/24", "ns_if": "t2if", "ns_name": "t2"}], "subnet_ip": "2.2.2.0/24", "tenant_ns": [{"tenant_ns_if": "t2ns2if", "tenant_ns_ip": "10.1.12.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s2if", "tenant_sub_ip": "10.1.12.2/24"}], "vms": [{"brif": "t2br2if1", "disk": "10G", "mem": 3, "name": "t2_VM3", "vcpu": 2, "vmif": "t2VM3if1"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, "rc": 0, "start": "2019-11-18 00:24:28.521837", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Create Tenant VETH pairs] *****************************************************************************************************************************
changed: [localhost] => (item={u'default_route_ip': u'192.168.2.1', u'name': u't2', u'pns_ip': u'192.168.2.1/24', u'tenant_if': u't2if', u'tenant_ip': u'192.168.2.2/24', u'pns_if': u't2pns_if'}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip link show \"t2if\" ; if [ $? -ne 0 ] ; then ip link add \"t2if\" type veth peer name \"t2pns_if\" ; fi\n", "delta": "0:00:00.013638", "end": "2019-11-18 00:24:28.858007", "item": {"default_route_ip": "192.168.2.1", "name": "t2", "pns_if": "t2pns_if", "pns_ip": "192.168.2.1/24", "tenant_if": "t2if", "tenant_ip": "192.168.2.2/24"}, "rc": 0, "start": "2019-11-18 00:24:28.844369", "stderr": "Device \"t2if\" does not exist.", "stderr_lines": ["Device \"t2if\" does not exist."], "stdout": "", "stdout_lines": []}

TASK [Attach Tenant VETH Pairs] *****************************************************************************************************************************
changed: [localhost] => (item={u'default_route_ip': u'192.168.2.1', u'name': u't2', u'pns_ip': u'192.168.2.1/24', u'tenant_if': u't2if', u'tenant_ip': u'192.168.2.2/24', u'pns_if': u't2pns_if'}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec pns ip link show \"t2pns_if\" ; if [ $? -ne 0 ] ; then ip link set \"t2pns_if\" netns pns ; fi\nip netns exec \"t2\" ip link show \"t2if\" ; if [ $? -ne 0 ] ; then ip link set \"t2if\" netns \"t2\" ; fi\nip netns exec pns ip link set dev \"t2pns_if\" up\nip netns exec \"t2\" ip link set dev \"t2if\" up\n", "delta": "0:00:00.199667", "end": "2019-11-18 00:24:29.333627", "item": {"default_route_ip": "192.168.2.1", "name": "t2", "pns_if": "t2pns_if", "pns_ip": "192.168.2.1/24", "tenant_if": "t2if", "tenant_ip": "192.168.2.2/24"}, "rc": 0, "start": "2019-11-18 00:24:29.133960", "stderr": "Device \"t2pns_if\" does not exist.\nDevice \"t2if\" does not exist.", "stderr_lines": ["Device \"t2pns_if\" does not exist.", "Device \"t2if\" does not exist."], "stdout": "", "stdout_lines": []}

TASK [Add IP addresses to Tenant VETH Pairs] ****************************************************************************************************************
changed: [localhost] => (item={u'default_route_ip': u'192.168.2.1', u'name': u't2', u'pns_ip': u'192.168.2.1/24', u'tenant_if': u't2if', u'tenant_ip': u'192.168.2.2/24', u'pns_if': u't2pns_if'}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec pns ip addr show \"t2pns_if\" | awk 'FNR==3{ print $2 }' | grep -w '^192.168.2.1/24' ; if [ $? -ne 0 ] ; then ip netns exec pns ip addr add \"192.168.2.1/24\" dev \"t2pns_if\" ; fi\nip netns exec \"t2\" ip addr show \"t2if\" | awk 'FNR==3{ print $2 }' | grep -w '^192.168.2.2/24' ; if [ $? -ne 0 ] ; then ip netns exec \"t2\" ip addr add \"192.168.2.2/24\" dev \"t2if\" ; fi\n", "delta": "0:00:00.148636", "end": "2019-11-18 00:24:29.794032", "item": {"default_route_ip": "192.168.2.1", "name": "t2", "pns_if": "t2pns_if", "pns_ip": "192.168.2.1/24", "tenant_if": "t2if", "tenant_ip": "192.168.2.2/24"}, "rc": 0, "start": "2019-11-18 00:24:29.645396", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Create Namespace VETH Pairs] **************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.11.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.1.11.1', u'bridge_name': u't2br1', u'dns': [{u'dnsif': u't2s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't2s1_dnsbrif'}], u'ns_name': u't2ns1', u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't2_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't2br1if1', u'vmif': u't2VM1if1'}, {u'mem': 4, u'name': u't2_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't2br1if2', u'vmif': u't2VM2if1'}], u'vxlan': [{u'local_ip': u'10.1.11.2', u'dsport': 4789, u'dev': u't2s1if', u'tenant_route_ip': u'192.168.2.2', u'remote_route': u'10.2.11.0/24', u'subnet_route': u'10.1.11.0/24', u'v_name': u'vxlan_t2s1', u'id': 42, u'remote_ip': u'10.2.11.2'}]}, {u'tenant_sub_ip': u'10.1.11.2/24', u'tenant_ns_ip': u'10.1.11.1/24', u'tenant_ns_if': u't2ns1if', u'tenant_sub_if': u't2s1if', u'tenant_ns_name': u't2'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip link show \"t2ns1if\" ; if [ $? -ne 0 ] ; then ip link add \"t2ns1if\" type veth peer name \"t2s1if\" ; fi\n", "delta": "0:00:00.011946", "end": "2019-11-18 00:24:30.111052", "item": [{"bridge_name": "t2br1", "default_route_ip": "10.1.11.1", "dns": [{"brif": "t2s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t2s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns1", "route": [{"if": "p1", "ip": "10.1.11.1/24", "ns_if": "t2if", "ns_name": "t2"}], "subnet_ip": "1.1.1.0/24", "vms": [{"brif": "t2br1if1", "disk": "10G", "mem": 2, "name": "t2_VM1", "vcpu": 4, "vmif": "t2VM1if1"}, {"brif": "t2br1if2", "disk": "10G", "mem": 4, "name": "t2_VM2", "vcpu": 2, "vmif": "t2VM2if1"}], "vxlan": [{"dev": "t2s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.11.2", "remote_ip": "10.2.11.2", "remote_route": "10.2.11.0/24", "subnet_route": "10.1.11.0/24", "tenant_route_ip": "192.168.2.2", "v_name": "vxlan_t2s1"}]}, {"tenant_ns_if": "t2ns1if", "tenant_ns_ip": "10.1.11.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s1if", "tenant_sub_ip": "10.1.11.2/24"}], "rc": 0, "start": "2019-11-18 00:24:30.099106", "stderr": "Device \"t2ns1if\" does not exist.", "stderr_lines": ["Device \"t2ns1if\" does not exist."], "stdout": "", "stdout_lines": []}
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.12.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.1.12.1', u'bridge_name': u't2br2', u'dns': [{u'dnsif': u't2s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't2s2_dnsbrif'}], u'ns_name': u't2ns2', u'subnet_ip': u'2.2.2.0/24', u'vms': [{u'mem': 3, u'name': u't2_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't2br2if1', u'vmif': u't2VM3if1'}], u'vxlan': [{u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}, {u'tenant_sub_ip': u'10.1.12.2/24', u'tenant_ns_ip': u'10.1.12.1/24', u'tenant_ns_if': u't2ns2if', u'tenant_sub_if': u't2s2if', u'tenant_ns_name': u't2'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip link show \"t2ns2if\" ; if [ $? -ne 0 ] ; then ip link add \"t2ns2if\" type veth peer name \"t2s2if\" ; fi\n", "delta": "0:00:00.014257", "end": "2019-11-18 00:24:30.358861", "item": [{"bridge_name": "t2br2", "default_route_ip": "10.1.12.1", "dns": [{"brif": "t2s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t2s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns2", "route": [{"if": "p1", "ip": "10.1.12.1/24", "ns_if": "t2if", "ns_name": "t2"}], "subnet_ip": "2.2.2.0/24", "vms": [{"brif": "t2br2if1", "disk": "10G", "mem": 3, "name": "t2_VM3", "vcpu": 2, "vmif": "t2VM3if1"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, {"tenant_ns_if": "t2ns2if", "tenant_ns_ip": "10.1.12.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s2if", "tenant_sub_ip": "10.1.12.2/24"}], "rc": 0, "start": "2019-11-18 00:24:30.344604", "stderr": "Device \"t2ns2if\" does not exist.", "stderr_lines": ["Device \"t2ns2if\" does not exist."], "stdout": "", "stdout_lines": []}

TASK [Attach Namespace VETH Pairs] **************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.11.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.1.11.1', u'bridge_name': u't2br1', u'dns': [{u'dnsif': u't2s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't2s1_dnsbrif'}], u'ns_name': u't2ns1', u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't2_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't2br1if1', u'vmif': u't2VM1if1'}, {u'mem': 4, u'name': u't2_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't2br1if2', u'vmif': u't2VM2if1'}], u'vxlan': [{u'local_ip': u'10.1.11.2', u'dsport': 4789, u'dev': u't2s1if', u'tenant_route_ip': u'192.168.2.2', u'remote_route': u'10.2.11.0/24', u'subnet_route': u'10.1.11.0/24', u'v_name': u'vxlan_t2s1', u'id': 42, u'remote_ip': u'10.2.11.2'}]}, {u'tenant_sub_ip': u'10.1.11.2/24', u'tenant_ns_ip': u'10.1.11.1/24', u'tenant_ns_if': u't2ns1if', u'tenant_sub_if': u't2s1if', u'tenant_ns_name': u't2'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t2\" ip link show \"t2ns1if\" ; if [ $? -ne 0 ] ; then ip link set \"t2ns1if\" netns \"t2\" ; fi\nip netns exec \"t2ns1\" ip link show \"t2s1if\" ; if [ $? -ne 0 ] ; then ip link set \"t2s1if\" netns \"t2ns1\" ; fi\n", "delta": "0:00:00.122746", "end": "2019-11-18 00:24:30.791585", "item": [{"bridge_name": "t2br1", "default_route_ip": "10.1.11.1", "dns": [{"brif": "t2s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t2s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns1", "route": [{"if": "p1", "ip": "10.1.11.1/24", "ns_if": "t2if", "ns_name": "t2"}], "subnet_ip": "1.1.1.0/24", "vms": [{"brif": "t2br1if1", "disk": "10G", "mem": 2, "name": "t2_VM1", "vcpu": 4, "vmif": "t2VM1if1"}, {"brif": "t2br1if2", "disk": "10G", "mem": 4, "name": "t2_VM2", "vcpu": 2, "vmif": "t2VM2if1"}], "vxlan": [{"dev": "t2s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.11.2", "remote_ip": "10.2.11.2", "remote_route": "10.2.11.0/24", "subnet_route": "10.1.11.0/24", "tenant_route_ip": "192.168.2.2", "v_name": "vxlan_t2s1"}]}, {"tenant_ns_if": "t2ns1if", "tenant_ns_ip": "10.1.11.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s1if", "tenant_sub_ip": "10.1.11.2/24"}], "rc": 0, "start": "2019-11-18 00:24:30.668839", "stderr": "Device \"t2ns1if\" does not exist.\nDevice \"t2s1if\" does not exist.", "stderr_lines": ["Device \"t2ns1if\" does not exist.", "Device \"t2s1if\" does not exist."], "stdout": "", "stdout_lines": []}
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.12.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.1.12.1', u'bridge_name': u't2br2', u'dns': [{u'dnsif': u't2s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't2s2_dnsbrif'}], u'ns_name': u't2ns2', u'subnet_ip': u'2.2.2.0/24', u'vms': [{u'mem': 3, u'name': u't2_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't2br2if1', u'vmif': u't2VM3if1'}], u'vxlan': [{u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}, {u'tenant_sub_ip': u'10.1.12.2/24', u'tenant_ns_ip': u'10.1.12.1/24', u'tenant_ns_if': u't2ns2if', u'tenant_sub_if': u't2s2if', u'tenant_ns_name': u't2'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t2\" ip link show \"t2ns2if\" ; if [ $? -ne 0 ] ; then ip link set \"t2ns2if\" netns \"t2\" ; fi\nip netns exec \"t2ns2\" ip link show \"t2s2if\" ; if [ $? -ne 0 ] ; then ip link set \"t2s2if\" netns \"t2ns2\" ; fi\n", "delta": "0:00:00.113172", "end": "2019-11-18 00:24:31.133570", "item": [{"bridge_name": "t2br2", "default_route_ip": "10.1.12.1", "dns": [{"brif": "t2s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t2s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns2", "route": [{"if": "p1", "ip": "10.1.12.1/24", "ns_if": "t2if", "ns_name": "t2"}], "subnet_ip": "2.2.2.0/24", "vms": [{"brif": "t2br2if1", "disk": "10G", "mem": 3, "name": "t2_VM3", "vcpu": 2, "vmif": "t2VM3if1"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, {"tenant_ns_if": "t2ns2if", "tenant_ns_ip": "10.1.12.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s2if", "tenant_sub_ip": "10.1.12.2/24"}], "rc": 0, "start": "2019-11-18 00:24:31.020398", "stderr": "Device \"t2ns2if\" does not exist.\nDevice \"t2s2if\" does not exist.", "stderr_lines": ["Device \"t2ns2if\" does not exist.", "Device \"t2s2if\" does not exist."], "stdout": "", "stdout_lines": []}

TASK [Set Namespace VETH Pairs UP] **************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.11.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.1.11.1', u'bridge_name': u't2br1', u'dns': [{u'dnsif': u't2s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't2s1_dnsbrif'}], u'ns_name': u't2ns1', u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't2_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't2br1if1', u'vmif': u't2VM1if1'}, {u'mem': 4, u'name': u't2_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't2br1if2', u'vmif': u't2VM2if1'}], u'vxlan': [{u'local_ip': u'10.1.11.2', u'dsport': 4789, u'dev': u't2s1if', u'tenant_route_ip': u'192.168.2.2', u'remote_route': u'10.2.11.0/24', u'subnet_route': u'10.1.11.0/24', u'v_name': u'vxlan_t2s1', u'id': 42, u'remote_ip': u'10.2.11.2'}]}, {u'tenant_sub_ip': u'10.1.11.2/24', u'tenant_ns_ip': u'10.1.11.1/24', u'tenant_ns_if': u't2ns1if', u'tenant_sub_if': u't2s1if', u'tenant_ns_name': u't2'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t2\" ip link set dev \"t2ns1if\" up\nip netns exec \"t2ns1\" ip link set dev \"t2s1if\" up\n", "delta": "0:00:00.073323", "end": "2019-11-18 00:24:31.497611", "item": [{"bridge_name": "t2br1", "default_route_ip": "10.1.11.1", "dns": [{"brif": "t2s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t2s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns1", "route": [{"if": "p1", "ip": "10.1.11.1/24", "ns_if": "t2if", "ns_name": "t2"}], "subnet_ip": "1.1.1.0/24", "vms": [{"brif": "t2br1if1", "disk": "10G", "mem": 2, "name": "t2_VM1", "vcpu": 4, "vmif": "t2VM1if1"}, {"brif": "t2br1if2", "disk": "10G", "mem": 4, "name": "t2_VM2", "vcpu": 2, "vmif": "t2VM2if1"}], "vxlan": [{"dev": "t2s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.11.2", "remote_ip": "10.2.11.2", "remote_route": "10.2.11.0/24", "subnet_route": "10.1.11.0/24", "tenant_route_ip": "192.168.2.2", "v_name": "vxlan_t2s1"}]}, {"tenant_ns_if": "t2ns1if", "tenant_ns_ip": "10.1.11.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s1if", "tenant_sub_ip": "10.1.11.2/24"}], "rc": 0, "start": "2019-11-18 00:24:31.424288", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.12.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.1.12.1', u'bridge_name': u't2br2', u'dns': [{u'dnsif': u't2s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't2s2_dnsbrif'}], u'ns_name': u't2ns2', u'subnet_ip': u'2.2.2.0/24', u'vms': [{u'mem': 3, u'name': u't2_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't2br2if1', u'vmif': u't2VM3if1'}], u'vxlan': [{u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}, {u'tenant_sub_ip': u'10.1.12.2/24', u'tenant_ns_ip': u'10.1.12.1/24', u'tenant_ns_if': u't2ns2if', u'tenant_sub_if': u't2s2if', u'tenant_ns_name': u't2'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t2\" ip link set dev \"t2ns2if\" up\nip netns exec \"t2ns2\" ip link set dev \"t2s2if\" up\n", "delta": "0:00:00.092578", "end": "2019-11-18 00:24:31.773623", "item": [{"bridge_name": "t2br2", "default_route_ip": "10.1.12.1", "dns": [{"brif": "t2s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t2s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns2", "route": [{"if": "p1", "ip": "10.1.12.1/24", "ns_if": "t2if", "ns_name": "t2"}], "subnet_ip": "2.2.2.0/24", "vms": [{"brif": "t2br2if1", "disk": "10G", "mem": 3, "name": "t2_VM3", "vcpu": 2, "vmif": "t2VM3if1"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, {"tenant_ns_if": "t2ns2if", "tenant_ns_ip": "10.1.12.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s2if", "tenant_sub_ip": "10.1.12.2/24"}], "rc": 0, "start": "2019-11-18 00:24:31.681045", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Add IP addresses to Namespace VETH Pairs] *************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.11.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.1.11.1', u'bridge_name': u't2br1', u'dns': [{u'dnsif': u't2s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't2s1_dnsbrif'}], u'ns_name': u't2ns1', u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't2_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't2br1if1', u'vmif': u't2VM1if1'}, {u'mem': 4, u'name': u't2_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't2br1if2', u'vmif': u't2VM2if1'}], u'vxlan': [{u'local_ip': u'10.1.11.2', u'dsport': 4789, u'dev': u't2s1if', u'tenant_route_ip': u'192.168.2.2', u'remote_route': u'10.2.11.0/24', u'subnet_route': u'10.1.11.0/24', u'v_name': u'vxlan_t2s1', u'id': 42, u'remote_ip': u'10.2.11.2'}]}, {u'tenant_sub_ip': u'10.1.11.2/24', u'tenant_ns_ip': u'10.1.11.1/24', u'tenant_ns_if': u't2ns1if', u'tenant_sub_if': u't2s1if', u'tenant_ns_name': u't2'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t2ns1\" ip addr show \"t2s1if\" | awk 'FNR==3{ print $2 }' | grep -w '^10.1.11.2/24' ; if [ $? -ne 0 ] ; then ip netns exec \"t2ns1\" ip addr add \"10.1.11.2/24\" dev \"t2s1if\" ; fi\n\nip netns exec \"t2\" ip addr show \"t2ns1if\" | awk 'FNR==3{ print $2 }' | grep -w '^10.1.11.1/24' ; if [ $? -ne 0 ] ; then ip netns exec \"t2\" ip addr add \"10.1.11.1/24\" dev \"t2ns1if\" ; fi\n", "delta": "0:00:00.159155", "end": "2019-11-18 00:24:32.185965", "item": [{"bridge_name": "t2br1", "default_route_ip": "10.1.11.1", "dns": [{"brif": "t2s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t2s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns1", "route": [{"if": "p1", "ip": "10.1.11.1/24", "ns_if": "t2if", "ns_name": "t2"}], "subnet_ip": "1.1.1.0/24", "vms": [{"brif": "t2br1if1", "disk": "10G", "mem": 2, "name": "t2_VM1", "vcpu": 4, "vmif": "t2VM1if1"}, {"brif": "t2br1if2", "disk": "10G", "mem": 4, "name": "t2_VM2", "vcpu": 2, "vmif": "t2VM2if1"}], "vxlan": [{"dev": "t2s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.11.2", "remote_ip": "10.2.11.2", "remote_route": "10.2.11.0/24", "subnet_route": "10.1.11.0/24", "tenant_route_ip": "192.168.2.2", "v_name": "vxlan_t2s1"}]}, {"tenant_ns_if": "t2ns1if", "tenant_ns_ip": "10.1.11.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s1if", "tenant_sub_ip": "10.1.11.2/24"}], "rc": 0, "start": "2019-11-18 00:24:32.026810", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.12.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.1.12.1', u'bridge_name': u't2br2', u'dns': [{u'dnsif': u't2s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't2s2_dnsbrif'}], u'ns_name': u't2ns2', u'subnet_ip': u'2.2.2.0/24', u'vms': [{u'mem': 3, u'name': u't2_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't2br2if1', u'vmif': u't2VM3if1'}], u'vxlan': [{u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}, {u'tenant_sub_ip': u'10.1.12.2/24', u'tenant_ns_ip': u'10.1.12.1/24', u'tenant_ns_if': u't2ns2if', u'tenant_sub_if': u't2s2if', u'tenant_ns_name': u't2'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t2ns2\" ip addr show \"t2s2if\" | awk 'FNR==3{ print $2 }' | grep -w '^10.1.12.2/24' ; if [ $? -ne 0 ] ; then ip netns exec \"t2ns2\" ip addr add \"10.1.12.2/24\" dev \"t2s2if\" ; fi\n\nip netns exec \"t2\" ip addr show \"t2ns2if\" | awk 'FNR==3{ print $2 }' | grep -w '^10.1.12.1/24' ; if [ $? -ne 0 ] ; then ip netns exec \"t2\" ip addr add \"10.1.12.1/24\" dev \"t2ns2if\" ; fi\n", "delta": "0:00:00.157813", "end": "2019-11-18 00:24:32.553805", "item": [{"bridge_name": "t2br2", "default_route_ip": "10.1.12.1", "dns": [{"brif": "t2s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t2s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns2", "route": [{"if": "p1", "ip": "10.1.12.1/24", "ns_if": "t2if", "ns_name": "t2"}], "subnet_ip": "2.2.2.0/24", "vms": [{"brif": "t2br2if1", "disk": "10G", "mem": 3, "name": "t2_VM3", "vcpu": 2, "vmif": "t2VM3if1"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, {"tenant_ns_if": "t2ns2if", "tenant_ns_ip": "10.1.12.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s2if", "tenant_sub_ip": "10.1.12.2/24"}], "rc": 0, "start": "2019-11-18 00:24:32.395992", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Add IP Route to Tenant] *******************************************************************************************************************************
changed: [localhost] => (item={u'default_route_ip': u'192.168.2.1', u'name': u't2', u'pns_ip': u'192.168.2.1/24', u'tenant_if': u't2if', u'tenant_ip': u'192.168.2.2/24', u'pns_if': u't2pns_if'}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t2\" ip route show default | grep -w '[d]efault via 192.168.2.1' ; if [ $? -ne 0 ] ; then ip netns exec \"t2\" ip route add default via \"192.168.2.1\" ; fi\n", "delta": "0:00:00.079800", "end": "2019-11-18 00:24:32.931392", "item": {"default_route_ip": "192.168.2.1", "name": "t2", "pns_if": "t2pns_if", "pns_ip": "192.168.2.1/24", "tenant_if": "t2if", "tenant_ip": "192.168.2.2/24"}, "rc": 0, "start": "2019-11-18 00:24:32.851592", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Add IP Route to Tenant Subnet] ************************************************************************************************************************
changed: [localhost] => (item={u'route': [{u'ip': u'10.1.11.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.1.11.1', u'bridge_name': u't2br1', u'dns': [{u'dnsif': u't2s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't2s1_dnsbrif'}], u'ns_name': u't2ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.11.2/24', u'tenant_ns_ip': u'10.1.11.1/24', u'tenant_ns_if': u't2ns1if', u'tenant_ns_name': u't2', u'tenant_sub_if': u't2s1if'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't2_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't2br1if1', u'vmif': u't2VM1if1'}, {u'mem': 4, u'name': u't2_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't2br1if2', u'vmif': u't2VM2if1'}], u'vxlan': [{u'local_ip': u'10.1.11.2', u'tenant_route_ip': u'192.168.2.2', u'dsport': 4789, u'dev': u't2s1if', u'subnet_route': u'10.1.11.0/24', u'remote_route': u'10.2.11.0/24', u'v_name': u'vxlan_t2s1', u'id': 42, u'remote_ip': u'10.2.11.2'}]}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t2ns1\" ip route show default | grep -w '[d]efault via 10.1.11.1' ; if [ $? -ne 0 ] ; then ip netns exec \"t2ns1\" ip route add default via \"10.1.11.1\" ; fi\n", "delta": "0:00:00.066532", "end": "2019-11-18 00:24:33.281721", "item": {"bridge_name": "t2br1", "default_route_ip": "10.1.11.1", "dns": [{"brif": "t2s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t2s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns1", "route": [{"if": "p1", "ip": "10.1.11.1/24", "ns_if": "t2if", "ns_name": "t2"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t2ns1if", "tenant_ns_ip": "10.1.11.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s1if", "tenant_sub_ip": "10.1.11.2/24"}], "vms": [{"brif": "t2br1if1", "disk": "10G", "mem": 2, "name": "t2_VM1", "vcpu": 4, "vmif": "t2VM1if1"}, {"brif": "t2br1if2", "disk": "10G", "mem": 4, "name": "t2_VM2", "vcpu": 2, "vmif": "t2VM2if1"}], "vxlan": [{"dev": "t2s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.11.2", "remote_ip": "10.2.11.2", "remote_route": "10.2.11.0/24", "subnet_route": "10.1.11.0/24", "tenant_route_ip": "192.168.2.2", "v_name": "vxlan_t2s1"}]}, "rc": 0, "start": "2019-11-18 00:24:33.215189", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}
changed: [localhost] => (item={u'route': [{u'ip': u'10.1.12.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.1.12.1', u'bridge_name': u't2br2', u'dns': [{u'dnsif': u't2s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't2s2_dnsbrif'}], u'ns_name': u't2ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.12.2/24', u'tenant_ns_ip': u'10.1.12.1/24', u'tenant_ns_if': u't2ns2if', u'tenant_ns_name': u't2', u'tenant_sub_if': u't2s2if'}], u'subnet_ip': u'2.2.2.0/24', u'vms': [{u'mem': 3, u'name': u't2_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't2br2if1', u'vmif': u't2VM3if1'}], u'vxlan': [{u'local_ip': [], u'tenant_route_ip': [], u'dsport': [], u'dev': [], u'subnet_route': [], u'remote_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t2ns2\" ip route show default | grep -w '[d]efault via 10.1.12.1' ; if [ $? -ne 0 ] ; then ip netns exec \"t2ns2\" ip route add default via \"10.1.12.1\" ; fi\n", "delta": "0:00:00.079455", "end": "2019-11-18 00:24:33.581776", "item": {"bridge_name": "t2br2", "default_route_ip": "10.1.12.1", "dns": [{"brif": "t2s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t2s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns2", "route": [{"if": "p1", "ip": "10.1.12.1/24", "ns_if": "t2if", "ns_name": "t2"}], "subnet_ip": "2.2.2.0/24", "tenant_ns": [{"tenant_ns_if": "t2ns2if", "tenant_ns_ip": "10.1.12.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s2if", "tenant_sub_ip": "10.1.12.2/24"}], "vms": [{"brif": "t2br2if1", "disk": "10G", "mem": 3, "name": "t2_VM3", "vcpu": 2, "vmif": "t2VM3if1"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, "rc": 0, "start": "2019-11-18 00:24:33.502321", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Create bridge inside namespace] ***********************************************************************************************************************
changed: [localhost] => (item={u'route': [{u'ip': u'10.1.11.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.1.11.1', u'bridge_name': u't2br1', u'dns': [{u'dnsif': u't2s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't2s1_dnsbrif'}], u'ns_name': u't2ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.11.2/24', u'tenant_ns_ip': u'10.1.11.1/24', u'tenant_ns_if': u't2ns1if', u'tenant_ns_name': u't2', u'tenant_sub_if': u't2s1if'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't2_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't2br1if1', u'vmif': u't2VM1if1'}, {u'mem': 4, u'name': u't2_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't2br1if2', u'vmif': u't2VM2if1'}], u'vxlan': [{u'local_ip': u'10.1.11.2', u'tenant_route_ip': u'192.168.2.2', u'dsport': 4789, u'dev': u't2s1if', u'subnet_route': u'10.1.11.0/24', u'remote_route': u'10.2.11.0/24', u'v_name': u'vxlan_t2s1', u'id': 42, u'remote_ip': u'10.2.11.2'}]}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t2ns1\" brctl show | grep -w '^t2br1'; if [ $? -ne 0 ] ; then ip netns exec \"t2ns1\" brctl addbr \"t2br1\" ; fi\nip netns exec \"t2ns1\" ip link set dev \"t2br1\" up\n", "delta": "0:00:00.114156", "end": "2019-11-18 00:24:33.989977", "item": {"bridge_name": "t2br1", "default_route_ip": "10.1.11.1", "dns": [{"brif": "t2s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t2s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns1", "route": [{"if": "p1", "ip": "10.1.11.1/24", "ns_if": "t2if", "ns_name": "t2"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t2ns1if", "tenant_ns_ip": "10.1.11.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s1if", "tenant_sub_ip": "10.1.11.2/24"}], "vms": [{"brif": "t2br1if1", "disk": "10G", "mem": 2, "name": "t2_VM1", "vcpu": 4, "vmif": "t2VM1if1"}, {"brif": "t2br1if2", "disk": "10G", "mem": 4, "name": "t2_VM2", "vcpu": 2, "vmif": "t2VM2if1"}], "vxlan": [{"dev": "t2s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.11.2", "remote_ip": "10.2.11.2", "remote_route": "10.2.11.0/24", "subnet_route": "10.1.11.0/24", "tenant_route_ip": "192.168.2.2", "v_name": "vxlan_t2s1"}]}, "rc": 0, "start": "2019-11-18 00:24:33.875821", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}
changed: [localhost] => (item={u'route': [{u'ip': u'10.1.12.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.1.12.1', u'bridge_name': u't2br2', u'dns': [{u'dnsif': u't2s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't2s2_dnsbrif'}], u'ns_name': u't2ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.12.2/24', u'tenant_ns_ip': u'10.1.12.1/24', u'tenant_ns_if': u't2ns2if', u'tenant_ns_name': u't2', u'tenant_sub_if': u't2s2if'}], u'subnet_ip': u'2.2.2.0/24', u'vms': [{u'mem': 3, u'name': u't2_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't2br2if1', u'vmif': u't2VM3if1'}], u'vxlan': [{u'local_ip': [], u'tenant_route_ip': [], u'dsport': [], u'dev': [], u'subnet_route': [], u'remote_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t2ns2\" brctl show | grep -w '^t2br2'; if [ $? -ne 0 ] ; then ip netns exec \"t2ns2\" brctl addbr \"t2br2\" ; fi\nip netns exec \"t2ns2\" ip link set dev \"t2br2\" up\n", "delta": "0:00:00.133849", "end": "2019-11-18 00:24:34.361788", "item": {"bridge_name": "t2br2", "default_route_ip": "10.1.12.1", "dns": [{"brif": "t2s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t2s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns2", "route": [{"if": "p1", "ip": "10.1.12.1/24", "ns_if": "t2if", "ns_name": "t2"}], "subnet_ip": "2.2.2.0/24", "tenant_ns": [{"tenant_ns_if": "t2ns2if", "tenant_ns_ip": "10.1.12.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s2if", "tenant_sub_ip": "10.1.12.2/24"}], "vms": [{"brif": "t2br2if1", "disk": "10G", "mem": 3, "name": "t2_VM3", "vcpu": 2, "vmif": "t2VM3if1"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, "rc": 0, "start": "2019-11-18 00:24:34.227939", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Create DNS VETH Pair] *********************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.11.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.1.11.1', u'bridge_name': u't2br1', u'ns_name': u't2ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.11.2/24', u'tenant_ns_ip': u'10.1.11.1/24', u'tenant_ns_if': u't2ns1if', u'tenant_sub_if': u't2s1if', u'tenant_ns_name': u't2'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't2_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't2br1if1', u'vmif': u't2VM1if1'}, {u'mem': 4, u'name': u't2_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't2br1if2', u'vmif': u't2VM2if1'}], u'vxlan': [{u'local_ip': u'10.1.11.2', u'dsport': 4789, u'dev': u't2s1if', u'tenant_route_ip': u'192.168.2.2', u'remote_route': u'10.2.11.0/24', u'subnet_route': u'10.1.11.0/24', u'v_name': u'vxlan_t2s1', u'id': 42, u'remote_ip': u'10.2.11.2'}]}, {u'dnsif': u't2s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't2s1_dnsbrif'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t2ns1\" ip link show \"t2s1_dnsbrif\" ; if [ $? -ne 0 ] ; then ip netns exec \"t2ns1\" ip link add \"t2s1_dnsbrif\" type veth peer name \"t2s1_dnsif\" ; fi\nip netns exec \"t2ns1\" ip link set dev \"t2s1_dnsbrif\" up\nip netns exec \"t2ns1\" ip link set dev \"t2s1_dnsif\" up\n", "delta": "0:00:00.150129", "end": "2019-11-18 00:24:34.805922", "item": [{"bridge_name": "t2br1", "default_route_ip": "10.1.11.1", "ns_name": "t2ns1", "route": [{"if": "p1", "ip": "10.1.11.1/24", "ns_if": "t2if", "ns_name": "t2"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t2ns1if", "tenant_ns_ip": "10.1.11.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s1if", "tenant_sub_ip": "10.1.11.2/24"}], "vms": [{"brif": "t2br1if1", "disk": "10G", "mem": 2, "name": "t2_VM1", "vcpu": 4, "vmif": "t2VM1if1"}, {"brif": "t2br1if2", "disk": "10G", "mem": 4, "name": "t2_VM2", "vcpu": 2, "vmif": "t2VM2if1"}], "vxlan": [{"dev": "t2s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.11.2", "remote_ip": "10.2.11.2", "remote_route": "10.2.11.0/24", "subnet_route": "10.1.11.0/24", "tenant_route_ip": "192.168.2.2", "v_name": "vxlan_t2s1"}]}, {"brif": "t2s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t2s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "rc": 0, "start": "2019-11-18 00:24:34.655793", "stderr": "Device \"t2s1_dnsbrif\" does not exist.", "stderr_lines": ["Device \"t2s1_dnsbrif\" does not exist."], "stdout": "", "stdout_lines": []}
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.12.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.1.12.1', u'bridge_name': u't2br2', u'ns_name': u't2ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.12.2/24', u'tenant_ns_ip': u'10.1.12.1/24', u'tenant_ns_if': u't2ns2if', u'tenant_sub_if': u't2s2if', u'tenant_ns_name': u't2'}], u'subnet_ip': u'2.2.2.0/24', u'vms': [{u'mem': 3, u'name': u't2_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't2br2if1', u'vmif': u't2VM3if1'}], u'vxlan': [{u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}, {u'dnsif': u't2s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't2s2_dnsbrif'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t2ns2\" ip link show \"t2s2_dnsbrif\" ; if [ $? -ne 0 ] ; then ip netns exec \"t2ns2\" ip link add \"t2s2_dnsbrif\" type veth peer name \"t2s2_dnsif\" ; fi\nip netns exec \"t2ns2\" ip link set dev \"t2s2_dnsbrif\" up\nip netns exec \"t2ns2\" ip link set dev \"t2s2_dnsif\" up\n", "delta": "0:00:00.179699", "end": "2019-11-18 00:24:35.209980", "item": [{"bridge_name": "t2br2", "default_route_ip": "10.1.12.1", "ns_name": "t2ns2", "route": [{"if": "p1", "ip": "10.1.12.1/24", "ns_if": "t2if", "ns_name": "t2"}], "subnet_ip": "2.2.2.0/24", "tenant_ns": [{"tenant_ns_if": "t2ns2if", "tenant_ns_ip": "10.1.12.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s2if", "tenant_sub_ip": "10.1.12.2/24"}], "vms": [{"brif": "t2br2if1", "disk": "10G", "mem": 3, "name": "t2_VM3", "vcpu": 2, "vmif": "t2VM3if1"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, {"brif": "t2s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t2s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "rc": 0, "start": "2019-11-18 00:24:35.030281", "stderr": "Device \"t2s2_dnsbrif\" does not exist.", "stderr_lines": ["Device \"t2s2_dnsbrif\" does not exist."], "stdout": "", "stdout_lines": []}

TASK [Attach DNS VETH Pair] *********************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.11.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.1.11.1', u'bridge_name': u't2br1', u'ns_name': u't2ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.11.2/24', u'tenant_ns_ip': u'10.1.11.1/24', u'tenant_ns_if': u't2ns1if', u'tenant_sub_if': u't2s1if', u'tenant_ns_name': u't2'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't2_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't2br1if1', u'vmif': u't2VM1if1'}, {u'mem': 4, u'name': u't2_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't2br1if2', u'vmif': u't2VM2if1'}], u'vxlan': [{u'local_ip': u'10.1.11.2', u'dsport': 4789, u'dev': u't2s1if', u'tenant_route_ip': u'192.168.2.2', u'remote_route': u'10.2.11.0/24', u'subnet_route': u'10.1.11.0/24', u'v_name': u'vxlan_t2s1', u'id': 42, u'remote_ip': u'10.2.11.2'}]}, {u'dnsif': u't2s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't2s1_dnsbrif'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t2ns1\" brctl show \"t2br1\" | grep -w 't2s1_dnsbrif' ; if [ $? -ne 0 ] ; then ip netns exec \"t2ns1\" brctl addif \"t2br1\" \"t2s1_dnsbrif\" ; fi\n", "delta": "0:00:00.094232", "end": "2019-11-18 00:24:35.570043", "item": [{"bridge_name": "t2br1", "default_route_ip": "10.1.11.1", "ns_name": "t2ns1", "route": [{"if": "p1", "ip": "10.1.11.1/24", "ns_if": "t2if", "ns_name": "t2"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t2ns1if", "tenant_ns_ip": "10.1.11.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s1if", "tenant_sub_ip": "10.1.11.2/24"}], "vms": [{"brif": "t2br1if1", "disk": "10G", "mem": 2, "name": "t2_VM1", "vcpu": 4, "vmif": "t2VM1if1"}, {"brif": "t2br1if2", "disk": "10G", "mem": 4, "name": "t2_VM2", "vcpu": 2, "vmif": "t2VM2if1"}], "vxlan": [{"dev": "t2s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.11.2", "remote_ip": "10.2.11.2", "remote_route": "10.2.11.0/24", "subnet_route": "10.1.11.0/24", "tenant_route_ip": "192.168.2.2", "v_name": "vxlan_t2s1"}]}, {"brif": "t2s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t2s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "rc": 0, "start": "2019-11-18 00:24:35.475811", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.12.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.1.12.1', u'bridge_name': u't2br2', u'ns_name': u't2ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.12.2/24', u'tenant_ns_ip': u'10.1.12.1/24', u'tenant_ns_if': u't2ns2if', u'tenant_sub_if': u't2s2if', u'tenant_ns_name': u't2'}], u'subnet_ip': u'2.2.2.0/24', u'vms': [{u'mem': 3, u'name': u't2_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't2br2if1', u'vmif': u't2VM3if1'}], u'vxlan': [{u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}, {u'dnsif': u't2s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't2s2_dnsbrif'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t2ns2\" brctl show \"t2br2\" | grep -w 't2s2_dnsbrif' ; if [ $? -ne 0 ] ; then ip netns exec \"t2ns2\" brctl addif \"t2br2\" \"t2s2_dnsbrif\" ; fi\n", "delta": "0:00:00.084800", "end": "2019-11-18 00:24:35.889744", "item": [{"bridge_name": "t2br2", "default_route_ip": "10.1.12.1", "ns_name": "t2ns2", "route": [{"if": "p1", "ip": "10.1.12.1/24", "ns_if": "t2if", "ns_name": "t2"}], "subnet_ip": "2.2.2.0/24", "tenant_ns": [{"tenant_ns_if": "t2ns2if", "tenant_ns_ip": "10.1.12.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s2if", "tenant_sub_ip": "10.1.12.2/24"}], "vms": [{"brif": "t2br2if1", "disk": "10G", "mem": 3, "name": "t2_VM3", "vcpu": 2, "vmif": "t2VM3if1"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, {"brif": "t2s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t2s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "rc": 0, "start": "2019-11-18 00:24:35.804944", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Create VETH Pairs] ************************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.11.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.1.11.1', u'bridge_name': u't2br1', u'dns': [{u'dnsif': u't2s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't2s1_dnsbrif'}], u'ns_name': u't2ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.11.2/24', u'tenant_ns_ip': u'10.1.11.1/24', u'tenant_ns_if': u't2ns1if', u'tenant_sub_if': u't2s1if', u'tenant_ns_name': u't2'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.1.11.2', u'dsport': 4789, u'dev': u't2s1if', u'tenant_route_ip': u'192.168.2.2', u'remote_route': u'10.2.11.0/24', u'subnet_route': u'10.1.11.0/24', u'v_name': u'vxlan_t2s1', u'id': 42, u'remote_ip': u'10.2.11.2'}]}, {u'mem': 2, u'name': u't2_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't2br1if1', u'vmif': u't2VM1if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip link show \"t2br1if1\" ; if [ $? -ne 0 ] ; then ip link add \"t2VM1if1\" type veth peer name \"t2br1if1\" ; fi\nip link set dev \"t2br1if1\" up\nip link set dev \"t2VM1if1\" up\n", "delta": "0:00:00.026347", "end": "2019-11-18 00:24:36.202859", "item": [{"bridge_name": "t2br1", "default_route_ip": "10.1.11.1", "dns": [{"brif": "t2s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t2s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns1", "route": [{"if": "p1", "ip": "10.1.11.1/24", "ns_if": "t2if", "ns_name": "t2"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t2ns1if", "tenant_ns_ip": "10.1.11.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s1if", "tenant_sub_ip": "10.1.11.2/24"}], "vxlan": [{"dev": "t2s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.11.2", "remote_ip": "10.2.11.2", "remote_route": "10.2.11.0/24", "subnet_route": "10.1.11.0/24", "tenant_route_ip": "192.168.2.2", "v_name": "vxlan_t2s1"}]}, {"brif": "t2br1if1", "disk": "10G", "mem": 2, "name": "t2_VM1", "vcpu": 4, "vmif": "t2VM1if1"}], "rc": 0, "start": "2019-11-18 00:24:36.176512", "stderr": "Device \"t2br1if1\" does not exist.", "stderr_lines": ["Device \"t2br1if1\" does not exist."], "stdout": "", "stdout_lines": []}
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.11.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.1.11.1', u'bridge_name': u't2br1', u'dns': [{u'dnsif': u't2s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't2s1_dnsbrif'}], u'ns_name': u't2ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.11.2/24', u'tenant_ns_ip': u'10.1.11.1/24', u'tenant_ns_if': u't2ns1if', u'tenant_sub_if': u't2s1if', u'tenant_ns_name': u't2'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.1.11.2', u'dsport': 4789, u'dev': u't2s1if', u'tenant_route_ip': u'192.168.2.2', u'remote_route': u'10.2.11.0/24', u'subnet_route': u'10.1.11.0/24', u'v_name': u'vxlan_t2s1', u'id': 42, u'remote_ip': u'10.2.11.2'}]}, {u'mem': 4, u'name': u't2_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't2br1if2', u'vmif': u't2VM2if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip link show \"t2br1if2\" ; if [ $? -ne 0 ] ; then ip link add \"t2VM2if1\" type veth peer name \"t2br1if2\" ; fi\nip link set dev \"t2br1if2\" up\nip link set dev \"t2VM2if1\" up\n", "delta": "0:00:00.025983", "end": "2019-11-18 00:24:36.478573", "item": [{"bridge_name": "t2br1", "default_route_ip": "10.1.11.1", "dns": [{"brif": "t2s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t2s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns1", "route": [{"if": "p1", "ip": "10.1.11.1/24", "ns_if": "t2if", "ns_name": "t2"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t2ns1if", "tenant_ns_ip": "10.1.11.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s1if", "tenant_sub_ip": "10.1.11.2/24"}], "vxlan": [{"dev": "t2s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.11.2", "remote_ip": "10.2.11.2", "remote_route": "10.2.11.0/24", "subnet_route": "10.1.11.0/24", "tenant_route_ip": "192.168.2.2", "v_name": "vxlan_t2s1"}]}, {"brif": "t2br1if2", "disk": "10G", "mem": 4, "name": "t2_VM2", "vcpu": 2, "vmif": "t2VM2if1"}], "rc": 0, "start": "2019-11-18 00:24:36.452590", "stderr": "Device \"t2br1if2\" does not exist.", "stderr_lines": ["Device \"t2br1if2\" does not exist."], "stdout": "", "stdout_lines": []}
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.12.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.1.12.1', u'bridge_name': u't2br2', u'dns': [{u'dnsif': u't2s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't2s2_dnsbrif'}], u'ns_name': u't2ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.12.2/24', u'tenant_ns_ip': u'10.1.12.1/24', u'tenant_ns_if': u't2ns2if', u'tenant_sub_if': u't2s2if', u'tenant_ns_name': u't2'}], u'subnet_ip': u'2.2.2.0/24', u'vxlan': [{u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}, {u'mem': 3, u'name': u't2_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't2br2if1', u'vmif': u't2VM3if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip link show \"t2br2if1\" ; if [ $? -ne 0 ] ; then ip link add \"t2VM3if1\" type veth peer name \"t2br2if1\" ; fi\nip link set dev \"t2br2if1\" up\nip link set dev \"t2VM3if1\" up\n", "delta": "0:00:00.022313", "end": "2019-11-18 00:24:36.728539", "item": [{"bridge_name": "t2br2", "default_route_ip": "10.1.12.1", "dns": [{"brif": "t2s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t2s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns2", "route": [{"if": "p1", "ip": "10.1.12.1/24", "ns_if": "t2if", "ns_name": "t2"}], "subnet_ip": "2.2.2.0/24", "tenant_ns": [{"tenant_ns_if": "t2ns2if", "tenant_ns_ip": "10.1.12.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s2if", "tenant_sub_ip": "10.1.12.2/24"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, {"brif": "t2br2if1", "disk": "10G", "mem": 3, "name": "t2_VM3", "vcpu": 2, "vmif": "t2VM3if1"}], "rc": 0, "start": "2019-11-18 00:24:36.706226", "stderr": "Device \"t2br2if1\" does not exist.", "stderr_lines": ["Device \"t2br2if1\" does not exist."], "stdout": "", "stdout_lines": []}

TASK [Attach VETH Pairs] ************************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.11.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.1.11.1', u'bridge_name': u't2br1', u'dns': [{u'dnsif': u't2s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't2s1_dnsbrif'}], u'ns_name': u't2ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.11.2/24', u'tenant_ns_ip': u'10.1.11.1/24', u'tenant_ns_if': u't2ns1if', u'tenant_sub_if': u't2s1if', u'tenant_ns_name': u't2'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.1.11.2', u'dsport': 4789, u'dev': u't2s1if', u'tenant_route_ip': u'192.168.2.2', u'remote_route': u'10.2.11.0/24', u'subnet_route': u'10.1.11.0/24', u'v_name': u'vxlan_t2s1', u'id': 42, u'remote_ip': u'10.2.11.2'}]}, {u'mem': 2, u'name': u't2_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't2br1if1', u'vmif': u't2VM1if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip link show \"t2br1if1\" ; if [ $? -eq 0 ] ; then ip link set \"t2br1if1\" netns \"t2ns1\" ; fi\nip netns exec \"t2ns1\" brctl show \"t2br1\" | grep -w 't2br1if1' ; if [ $? -ne 0 ] ; then ip netns exec \"t2ns1\" brctl addif \"t2br1\" \"t2br1if1\" ; fi\n", "delta": "0:00:00.122441", "end": "2019-11-18 00:24:37.173904", "item": [{"bridge_name": "t2br1", "default_route_ip": "10.1.11.1", "dns": [{"brif": "t2s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t2s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns1", "route": [{"if": "p1", "ip": "10.1.11.1/24", "ns_if": "t2if", "ns_name": "t2"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t2ns1if", "tenant_ns_ip": "10.1.11.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s1if", "tenant_sub_ip": "10.1.11.2/24"}], "vxlan": [{"dev": "t2s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.11.2", "remote_ip": "10.2.11.2", "remote_route": "10.2.11.0/24", "subnet_route": "10.1.11.0/24", "tenant_route_ip": "192.168.2.2", "v_name": "vxlan_t2s1"}]}, {"brif": "t2br1if1", "disk": "10G", "mem": 2, "name": "t2_VM1", "vcpu": 4, "vmif": "t2VM1if1"}], "rc": 0, "start": "2019-11-18 00:24:37.051463", "stderr": "", "stderr_lines": [], "stdout": "35: t2br1if1@t2VM1if1: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP mode DEFAULT group default qlen 1000\n    link/ether 2e:21:08:45:23:a3 brd ff:ff:ff:ff:ff:ff", "stdout_lines": ["35: t2br1if1@t2VM1if1: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP mode DEFAULT group default qlen 1000", "    link/ether 2e:21:08:45:23:a3 brd ff:ff:ff:ff:ff:ff"]}
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.11.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.1.11.1', u'bridge_name': u't2br1', u'dns': [{u'dnsif': u't2s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't2s1_dnsbrif'}], u'ns_name': u't2ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.11.2/24', u'tenant_ns_ip': u'10.1.11.1/24', u'tenant_ns_if': u't2ns1if', u'tenant_sub_if': u't2s1if', u'tenant_ns_name': u't2'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.1.11.2', u'dsport': 4789, u'dev': u't2s1if', u'tenant_route_ip': u'192.168.2.2', u'remote_route': u'10.2.11.0/24', u'subnet_route': u'10.1.11.0/24', u'v_name': u'vxlan_t2s1', u'id': 42, u'remote_ip': u'10.2.11.2'}]}, {u'mem': 4, u'name': u't2_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't2br1if2', u'vmif': u't2VM2if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip link show \"t2br1if2\" ; if [ $? -eq 0 ] ; then ip link set \"t2br1if2\" netns \"t2ns1\" ; fi\nip netns exec \"t2ns1\" brctl show \"t2br1\" | grep -w 't2br1if2' ; if [ $? -ne 0 ] ; then ip netns exec \"t2ns1\" brctl addif \"t2br1\" \"t2br1if2\" ; fi\n", "delta": "0:00:00.109870", "end": "2019-11-18 00:24:37.505713", "item": [{"bridge_name": "t2br1", "default_route_ip": "10.1.11.1", "dns": [{"brif": "t2s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t2s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns1", "route": [{"if": "p1", "ip": "10.1.11.1/24", "ns_if": "t2if", "ns_name": "t2"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t2ns1if", "tenant_ns_ip": "10.1.11.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s1if", "tenant_sub_ip": "10.1.11.2/24"}], "vxlan": [{"dev": "t2s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.11.2", "remote_ip": "10.2.11.2", "remote_route": "10.2.11.0/24", "subnet_route": "10.1.11.0/24", "tenant_route_ip": "192.168.2.2", "v_name": "vxlan_t2s1"}]}, {"brif": "t2br1if2", "disk": "10G", "mem": 4, "name": "t2_VM2", "vcpu": 2, "vmif": "t2VM2if1"}], "rc": 0, "start": "2019-11-18 00:24:37.395843", "stderr": "", "stderr_lines": [], "stdout": "37: t2br1if2@t2VM2if1: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP mode DEFAULT group default qlen 1000\n    link/ether 7a:ef:7e:27:05:7e brd ff:ff:ff:ff:ff:ff", "stdout_lines": ["37: t2br1if2@t2VM2if1: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP mode DEFAULT group default qlen 1000", "    link/ether 7a:ef:7e:27:05:7e brd ff:ff:ff:ff:ff:ff"]}
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.12.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.1.12.1', u'bridge_name': u't2br2', u'dns': [{u'dnsif': u't2s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't2s2_dnsbrif'}], u'ns_name': u't2ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.12.2/24', u'tenant_ns_ip': u'10.1.12.1/24', u'tenant_ns_if': u't2ns2if', u'tenant_sub_if': u't2s2if', u'tenant_ns_name': u't2'}], u'subnet_ip': u'2.2.2.0/24', u'vxlan': [{u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}, {u'mem': 3, u'name': u't2_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't2br2if1', u'vmif': u't2VM3if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip link show \"t2br2if1\" ; if [ $? -eq 0 ] ; then ip link set \"t2br2if1\" netns \"t2ns2\" ; fi\nip netns exec \"t2ns2\" brctl show \"t2br2\" | grep -w 't2br2if1' ; if [ $? -ne 0 ] ; then ip netns exec \"t2ns2\" brctl addif \"t2br2\" \"t2br2if1\" ; fi\n", "delta": "0:00:00.100804", "end": "2019-11-18 00:24:37.801535", "item": [{"bridge_name": "t2br2", "default_route_ip": "10.1.12.1", "dns": [{"brif": "t2s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t2s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns2", "route": [{"if": "p1", "ip": "10.1.12.1/24", "ns_if": "t2if", "ns_name": "t2"}], "subnet_ip": "2.2.2.0/24", "tenant_ns": [{"tenant_ns_if": "t2ns2if", "tenant_ns_ip": "10.1.12.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s2if", "tenant_sub_ip": "10.1.12.2/24"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, {"brif": "t2br2if1", "disk": "10G", "mem": 3, "name": "t2_VM3", "vcpu": 2, "vmif": "t2VM3if1"}], "rc": 0, "start": "2019-11-18 00:24:37.700731", "stderr": "", "stderr_lines": [], "stdout": "39: t2br2if1@t2VM3if1: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP mode DEFAULT group default qlen 1000\n    link/ether b2:a6:ac:1f:c7:7f brd ff:ff:ff:ff:ff:ff", "stdout_lines": ["39: t2br2if1@t2VM3if1: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP mode DEFAULT group default qlen 1000", "    link/ether b2:a6:ac:1f:c7:7f brd ff:ff:ff:ff:ff:ff"]}

TASK [All interfaces and bridges UP] ************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.11.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.1.11.1', u'bridge_name': u't2br1', u'dns': [{u'dnsif': u't2s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't2s1_dnsbrif'}], u'ns_name': u't2ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.11.2/24', u'tenant_ns_ip': u'10.1.11.1/24', u'tenant_ns_if': u't2ns1if', u'tenant_sub_if': u't2s1if', u'tenant_ns_name': u't2'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.1.11.2', u'dsport': 4789, u'dev': u't2s1if', u'tenant_route_ip': u'192.168.2.2', u'remote_route': u'10.2.11.0/24', u'subnet_route': u'10.1.11.0/24', u'v_name': u'vxlan_t2s1', u'id': 42, u'remote_ip': u'10.2.11.2'}]}, {u'mem': 2, u'name': u't2_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't2br1if1', u'vmif': u't2VM1if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t2ns1\" ip link set \"t2br1if1\" up\nip netns exec \"t2ns1\" ip link set dev \"t2br1\" up\n", "delta": "0:00:00.069231", "end": "2019-11-18 00:24:38.137721", "item": [{"bridge_name": "t2br1", "default_route_ip": "10.1.11.1", "dns": [{"brif": "t2s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t2s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns1", "route": [{"if": "p1", "ip": "10.1.11.1/24", "ns_if": "t2if", "ns_name": "t2"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t2ns1if", "tenant_ns_ip": "10.1.11.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s1if", "tenant_sub_ip": "10.1.11.2/24"}], "vxlan": [{"dev": "t2s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.11.2", "remote_ip": "10.2.11.2", "remote_route": "10.2.11.0/24", "subnet_route": "10.1.11.0/24", "tenant_route_ip": "192.168.2.2", "v_name": "vxlan_t2s1"}]}, {"brif": "t2br1if1", "disk": "10G", "mem": 2, "name": "t2_VM1", "vcpu": 4, "vmif": "t2VM1if1"}], "rc": 0, "start": "2019-11-18 00:24:38.068490", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.11.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.1.11.1', u'bridge_name': u't2br1', u'dns': [{u'dnsif': u't2s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't2s1_dnsbrif'}], u'ns_name': u't2ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.11.2/24', u'tenant_ns_ip': u'10.1.11.1/24', u'tenant_ns_if': u't2ns1if', u'tenant_sub_if': u't2s1if', u'tenant_ns_name': u't2'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.1.11.2', u'dsport': 4789, u'dev': u't2s1if', u'tenant_route_ip': u'192.168.2.2', u'remote_route': u'10.2.11.0/24', u'subnet_route': u'10.1.11.0/24', u'v_name': u'vxlan_t2s1', u'id': 42, u'remote_ip': u'10.2.11.2'}]}, {u'mem': 4, u'name': u't2_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't2br1if2', u'vmif': u't2VM2if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t2ns1\" ip link set \"t2br1if2\" up\nip netns exec \"t2ns1\" ip link set dev \"t2br1\" up\n", "delta": "0:00:00.079817", "end": "2019-11-18 00:24:38.429691", "item": [{"bridge_name": "t2br1", "default_route_ip": "10.1.11.1", "dns": [{"brif": "t2s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t2s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns1", "route": [{"if": "p1", "ip": "10.1.11.1/24", "ns_if": "t2if", "ns_name": "t2"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t2ns1if", "tenant_ns_ip": "10.1.11.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s1if", "tenant_sub_ip": "10.1.11.2/24"}], "vxlan": [{"dev": "t2s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.11.2", "remote_ip": "10.2.11.2", "remote_route": "10.2.11.0/24", "subnet_route": "10.1.11.0/24", "tenant_route_ip": "192.168.2.2", "v_name": "vxlan_t2s1"}]}, {"brif": "t2br1if2", "disk": "10G", "mem": 4, "name": "t2_VM2", "vcpu": 2, "vmif": "t2VM2if1"}], "rc": 0, "start": "2019-11-18 00:24:38.349874", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.12.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.1.12.1', u'bridge_name': u't2br2', u'dns': [{u'dnsif': u't2s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't2s2_dnsbrif'}], u'ns_name': u't2ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.12.2/24', u'tenant_ns_ip': u'10.1.12.1/24', u'tenant_ns_if': u't2ns2if', u'tenant_sub_if': u't2s2if', u'tenant_ns_name': u't2'}], u'subnet_ip': u'2.2.2.0/24', u'vxlan': [{u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}, {u'mem': 3, u'name': u't2_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't2br2if1', u'vmif': u't2VM3if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t2ns2\" ip link set \"t2br2if1\" up\nip netns exec \"t2ns2\" ip link set dev \"t2br2\" up\n", "delta": "0:00:00.079236", "end": "2019-11-18 00:24:38.749941", "item": [{"bridge_name": "t2br2", "default_route_ip": "10.1.12.1", "dns": [{"brif": "t2s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t2s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns2", "route": [{"if": "p1", "ip": "10.1.12.1/24", "ns_if": "t2if", "ns_name": "t2"}], "subnet_ip": "2.2.2.0/24", "tenant_ns": [{"tenant_ns_if": "t2ns2if", "tenant_ns_ip": "10.1.12.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s2if", "tenant_sub_ip": "10.1.12.2/24"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, {"brif": "t2br2if1", "disk": "10G", "mem": 3, "name": "t2_VM3", "vcpu": 2, "vmif": "t2VM3if1"}], "rc": 0, "start": "2019-11-18 00:24:38.670705", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Add IP to DNS Interface] ******************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.11.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.1.11.1', u'bridge_name': u't2br1', u'ns_name': u't2ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.11.2/24', u'tenant_ns_ip': u'10.1.11.1/24', u'tenant_ns_if': u't2ns1if', u'tenant_sub_if': u't2s1if', u'tenant_ns_name': u't2'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't2_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't2br1if1', u'vmif': u't2VM1if1'}, {u'mem': 4, u'name': u't2_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't2br1if2', u'vmif': u't2VM2if1'}], u'vxlan': [{u'local_ip': u'10.1.11.2', u'dsport': 4789, u'dev': u't2s1if', u'tenant_route_ip': u'192.168.2.2', u'remote_route': u'10.2.11.0/24', u'subnet_route': u'10.1.11.0/24', u'v_name': u'vxlan_t2s1', u'id': 42, u'remote_ip': u'10.2.11.2'}]}, {u'dnsif': u't2s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't2s1_dnsbrif'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t2ns1\" ip addr show \"t2s1_dnsif\" | awk 'FNR==3{ print $2 }' | grep -w '^1.1.1.1/24' ; if [ $? -ne 0 ] ; then ip netns exec \"t2ns1\" ip addr add \"1.1.1.1/24\" dev \"t2s1_dnsif\" ; fi\n", "delta": "0:00:00.076545", "end": "2019-11-18 00:24:39.101844", "item": [{"bridge_name": "t2br1", "default_route_ip": "10.1.11.1", "ns_name": "t2ns1", "route": [{"if": "p1", "ip": "10.1.11.1/24", "ns_if": "t2if", "ns_name": "t2"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t2ns1if", "tenant_ns_ip": "10.1.11.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s1if", "tenant_sub_ip": "10.1.11.2/24"}], "vms": [{"brif": "t2br1if1", "disk": "10G", "mem": 2, "name": "t2_VM1", "vcpu": 4, "vmif": "t2VM1if1"}, {"brif": "t2br1if2", "disk": "10G", "mem": 4, "name": "t2_VM2", "vcpu": 2, "vmif": "t2VM2if1"}], "vxlan": [{"dev": "t2s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.11.2", "remote_ip": "10.2.11.2", "remote_route": "10.2.11.0/24", "subnet_route": "10.1.11.0/24", "tenant_route_ip": "192.168.2.2", "v_name": "vxlan_t2s1"}]}, {"brif": "t2s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t2s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "rc": 0, "start": "2019-11-18 00:24:39.025299", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.12.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.1.12.1', u'bridge_name': u't2br2', u'ns_name': u't2ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.12.2/24', u'tenant_ns_ip': u'10.1.12.1/24', u'tenant_ns_if': u't2ns2if', u'tenant_sub_if': u't2s2if', u'tenant_ns_name': u't2'}], u'subnet_ip': u'2.2.2.0/24', u'vms': [{u'mem': 3, u'name': u't2_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't2br2if1', u'vmif': u't2VM3if1'}], u'vxlan': [{u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}, {u'dnsif': u't2s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't2s2_dnsbrif'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t2ns2\" ip addr show \"t2s2_dnsif\" | awk 'FNR==3{ print $2 }' | grep -w '^2.2.2.1/24' ; if [ $? -ne 0 ] ; then ip netns exec \"t2ns2\" ip addr add \"2.2.2.1/24\" dev \"t2s2_dnsif\" ; fi\n", "delta": "0:00:00.083860", "end": "2019-11-18 00:24:39.397880", "item": [{"bridge_name": "t2br2", "default_route_ip": "10.1.12.1", "ns_name": "t2ns2", "route": [{"if": "p1", "ip": "10.1.12.1/24", "ns_if": "t2if", "ns_name": "t2"}], "subnet_ip": "2.2.2.0/24", "tenant_ns": [{"tenant_ns_if": "t2ns2if", "tenant_ns_ip": "10.1.12.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s2if", "tenant_sub_ip": "10.1.12.2/24"}], "vms": [{"brif": "t2br2if1", "disk": "10G", "mem": 3, "name": "t2_VM3", "vcpu": 2, "vmif": "t2VM3if1"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, {"brif": "t2s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t2s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "rc": 0, "start": "2019-11-18 00:24:39.314020", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Install DHCP Server] **********************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.11.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.1.11.1', u'bridge_name': u't2br1', u'ns_name': u't2ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.11.2/24', u'tenant_ns_ip': u'10.1.11.1/24', u'tenant_ns_if': u't2ns1if', u'tenant_sub_if': u't2s1if', u'tenant_ns_name': u't2'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't2_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't2br1if1', u'vmif': u't2VM1if1'}, {u'mem': 4, u'name': u't2_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't2br1if2', u'vmif': u't2VM2if1'}], u'vxlan': [{u'local_ip': u'10.1.11.2', u'dsport': 4789, u'dev': u't2s1if', u'tenant_route_ip': u'192.168.2.2', u'remote_route': u'10.2.11.0/24', u'subnet_route': u'10.1.11.0/24', u'v_name': u'vxlan_t2s1', u'id': 42, u'remote_ip': u'10.2.11.2'}]}, {u'dnsif': u't2s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't2s1_dnsbrif'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t2ns1\" ps aux | grep -w '[d]nsmasq --interface t2s1_dnsif -z --dhcp-range=1.1.1.5,1.1.1.126' ; if [ $? -ne 0 ] ; then ip netns exec \"t2ns1\" dnsmasq --interface \"t2s1_dnsif\" -z --dhcp-range=1.1.1.5,'1.1.1.126' ; fi\n", "delta": "0:00:00.081215", "end": "2019-11-18 00:24:39.790841", "item": [{"bridge_name": "t2br1", "default_route_ip": "10.1.11.1", "ns_name": "t2ns1", "route": [{"if": "p1", "ip": "10.1.11.1/24", "ns_if": "t2if", "ns_name": "t2"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t2ns1if", "tenant_ns_ip": "10.1.11.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s1if", "tenant_sub_ip": "10.1.11.2/24"}], "vms": [{"brif": "t2br1if1", "disk": "10G", "mem": 2, "name": "t2_VM1", "vcpu": 4, "vmif": "t2VM1if1"}, {"brif": "t2br1if2", "disk": "10G", "mem": 4, "name": "t2_VM2", "vcpu": 2, "vmif": "t2VM2if1"}], "vxlan": [{"dev": "t2s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.11.2", "remote_ip": "10.2.11.2", "remote_route": "10.2.11.0/24", "subnet_route": "10.1.11.0/24", "tenant_route_ip": "192.168.2.2", "v_name": "vxlan_t2s1"}]}, {"brif": "t2s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t2s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "rc": 0, "start": "2019-11-18 00:24:39.709626", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.12.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.1.12.1', u'bridge_name': u't2br2', u'ns_name': u't2ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.12.2/24', u'tenant_ns_ip': u'10.1.12.1/24', u'tenant_ns_if': u't2ns2if', u'tenant_sub_if': u't2s2if', u'tenant_ns_name': u't2'}], u'subnet_ip': u'2.2.2.0/24', u'vms': [{u'mem': 3, u'name': u't2_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't2br2if1', u'vmif': u't2VM3if1'}], u'vxlan': [{u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}, {u'dnsif': u't2s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't2s2_dnsbrif'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t2ns2\" ps aux | grep -w '[d]nsmasq --interface t2s2_dnsif -z --dhcp-range=2.2.2.5,2.2.2.254' ; if [ $? -ne 0 ] ; then ip netns exec \"t2ns2\" dnsmasq --interface \"t2s2_dnsif\" -z --dhcp-range=2.2.2.5,'2.2.2.254' ; fi\n", "delta": "0:00:00.075895", "end": "2019-11-18 00:24:40.095482", "item": [{"bridge_name": "t2br2", "default_route_ip": "10.1.12.1", "ns_name": "t2ns2", "route": [{"if": "p1", "ip": "10.1.12.1/24", "ns_if": "t2if", "ns_name": "t2"}], "subnet_ip": "2.2.2.0/24", "tenant_ns": [{"tenant_ns_if": "t2ns2if", "tenant_ns_ip": "10.1.12.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s2if", "tenant_sub_ip": "10.1.12.2/24"}], "vms": [{"brif": "t2br2if1", "disk": "10G", "mem": 3, "name": "t2_VM3", "vcpu": 2, "vmif": "t2VM3if1"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, {"brif": "t2s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t2s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "rc": 0, "start": "2019-11-18 00:24:40.019587", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Create VXLAN devices] *********************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.11.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.1.11.1', u'bridge_name': u't2br1', u'dns': [{u'dnsif': u't2s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't2s1_dnsbrif'}], u'ns_name': u't2ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.11.2/24', u'tenant_ns_ip': u'10.1.11.1/24', u'tenant_ns_if': u't2ns1if', u'tenant_sub_if': u't2s1if', u'tenant_ns_name': u't2'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't2_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't2br1if1', u'vmif': u't2VM1if1'}, {u'mem': 4, u'name': u't2_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't2br1if2', u'vmif': u't2VM2if1'}]}, {u'local_ip': u'10.1.11.2', u'dsport': 4789, u'dev': u't2s1if', u'tenant_route_ip': u'192.168.2.2', u'remote_route': u'10.2.11.0/24', u'subnet_route': u'10.1.11.0/24', u'v_name': u'vxlan_t2s1', u'id': 42, u'remote_ip': u'10.2.11.2'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t2ns1\" ip link show \"vxlan_t2s1\" ; if [ $? -ne 0 ] ; then ip netns exec \"t2ns1\" ip link add \"vxlan_t2s1\" type vxlan id \"42\" local \"10.1.11.2\" remote \"10.2.11.2\" dstport \"4789\" dev \"t2s1if\"; ip netns exec \"t2ns1\" ip link set dev \"vxlan_t2s1\" up ; fi\n", "delta": "0:00:00.144840", "end": "2019-11-18 00:24:40.569573", "item": [{"bridge_name": "t2br1", "default_route_ip": "10.1.11.1", "dns": [{"brif": "t2s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t2s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns1", "route": [{"if": "p1", "ip": "10.1.11.1/24", "ns_if": "t2if", "ns_name": "t2"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t2ns1if", "tenant_ns_ip": "10.1.11.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s1if", "tenant_sub_ip": "10.1.11.2/24"}], "vms": [{"brif": "t2br1if1", "disk": "10G", "mem": 2, "name": "t2_VM1", "vcpu": 4, "vmif": "t2VM1if1"}, {"brif": "t2br1if2", "disk": "10G", "mem": 4, "name": "t2_VM2", "vcpu": 2, "vmif": "t2VM2if1"}]}, {"dev": "t2s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.11.2", "remote_ip": "10.2.11.2", "remote_route": "10.2.11.0/24", "subnet_route": "10.1.11.0/24", "tenant_route_ip": "192.168.2.2", "v_name": "vxlan_t2s1"}], "rc": 0, "start": "2019-11-18 00:24:40.424733", "stderr": "Device \"vxlan_t2s1\" does not exist.", "stderr_lines": ["Device \"vxlan_t2s1\" does not exist."], "stdout": "", "stdout_lines": []}
skipping: [localhost] => (item=[{u'route': [{u'ip': u'10.1.12.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.1.12.1', u'bridge_name': u't2br2', u'dns': [{u'dnsif': u't2s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't2s2_dnsbrif'}], u'ns_name': u't2ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.12.2/24', u'tenant_ns_ip': u'10.1.12.1/24', u'tenant_ns_if': u't2ns2if', u'tenant_sub_if': u't2s2if', u'tenant_ns_name': u't2'}], u'subnet_ip': u'2.2.2.0/24', u'vms': [{u'mem': 3, u'name': u't2_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't2br2if1', u'vmif': u't2VM3if1'}]}, {u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}])  => {"ansible_loop_var": "item", "changed": false, "item": [{"bridge_name": "t2br2", "default_route_ip": "10.1.12.1", "dns": [{"brif": "t2s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t2s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns2", "route": [{"if": "p1", "ip": "10.1.12.1/24", "ns_if": "t2if", "ns_name": "t2"}], "subnet_ip": "2.2.2.0/24", "tenant_ns": [{"tenant_ns_if": "t2ns2if", "tenant_ns_ip": "10.1.12.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s2if", "tenant_sub_ip": "10.1.12.2/24"}], "vms": [{"brif": "t2br2if1", "disk": "10G", "mem": 3, "name": "t2_VM3", "vcpu": 2, "vmif": "t2VM3if1"}]}, {"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}], "skip_reason": "Conditional result was False"}

TASK [Attach VXLANs to bridge] ******************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.11.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.1.11.1', u'bridge_name': u't2br1', u'dns': [{u'dnsif': u't2s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't2s1_dnsbrif'}], u'ns_name': u't2ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.11.2/24', u'tenant_ns_ip': u'10.1.11.1/24', u'tenant_ns_if': u't2ns1if', u'tenant_sub_if': u't2s1if', u'tenant_ns_name': u't2'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't2_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't2br1if1', u'vmif': u't2VM1if1'}, {u'mem': 4, u'name': u't2_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't2br1if2', u'vmif': u't2VM2if1'}]}, {u'local_ip': u'10.1.11.2', u'dsport': 4789, u'dev': u't2s1if', u'tenant_route_ip': u'192.168.2.2', u'remote_route': u'10.2.11.0/24', u'subnet_route': u'10.1.11.0/24', u'v_name': u'vxlan_t2s1', u'id': 42, u'remote_ip': u'10.2.11.2'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t2ns1\" brctl show \"t2br1\" | grep -w 'vxlan_t2s1' ; if [ $? -ne 0 ] ; then ip netns exec \"t2ns1\" brctl addif \"t2br1\" \"vxlan_t2s1\" ; fi\n", "delta": "0:00:00.065916", "end": "2019-11-18 00:24:40.949700", "item": [{"bridge_name": "t2br1", "default_route_ip": "10.1.11.1", "dns": [{"brif": "t2s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t2s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns1", "route": [{"if": "p1", "ip": "10.1.11.1/24", "ns_if": "t2if", "ns_name": "t2"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t2ns1if", "tenant_ns_ip": "10.1.11.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s1if", "tenant_sub_ip": "10.1.11.2/24"}], "vms": [{"brif": "t2br1if1", "disk": "10G", "mem": 2, "name": "t2_VM1", "vcpu": 4, "vmif": "t2VM1if1"}, {"brif": "t2br1if2", "disk": "10G", "mem": 4, "name": "t2_VM2", "vcpu": 2, "vmif": "t2VM2if1"}]}, {"dev": "t2s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.11.2", "remote_ip": "10.2.11.2", "remote_route": "10.2.11.0/24", "subnet_route": "10.1.11.0/24", "tenant_route_ip": "192.168.2.2", "v_name": "vxlan_t2s1"}], "rc": 0, "start": "2019-11-18 00:24:40.883784", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}
skipping: [localhost] => (item=[{u'route': [{u'ip': u'10.1.12.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.1.12.1', u'bridge_name': u't2br2', u'dns': [{u'dnsif': u't2s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't2s2_dnsbrif'}], u'ns_name': u't2ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.12.2/24', u'tenant_ns_ip': u'10.1.12.1/24', u'tenant_ns_if': u't2ns2if', u'tenant_sub_if': u't2s2if', u'tenant_ns_name': u't2'}], u'subnet_ip': u'2.2.2.0/24', u'vms': [{u'mem': 3, u'name': u't2_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't2br2if1', u'vmif': u't2VM3if1'}]}, {u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}])  => {"ansible_loop_var": "item", "changed": false, "item": [{"bridge_name": "t2br2", "default_route_ip": "10.1.12.1", "dns": [{"brif": "t2s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t2s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns2", "route": [{"if": "p1", "ip": "10.1.12.1/24", "ns_if": "t2if", "ns_name": "t2"}], "subnet_ip": "2.2.2.0/24", "tenant_ns": [{"tenant_ns_if": "t2ns2if", "tenant_ns_ip": "10.1.12.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s2if", "tenant_sub_ip": "10.1.12.2/24"}], "vms": [{"brif": "t2br2if1", "disk": "10G", "mem": 3, "name": "t2_VM3", "vcpu": 2, "vmif": "t2VM3if1"}]}, {"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}], "skip_reason": "Conditional result was False"}

PLAY RECAP **************************************************************************************************************************************************
localhost                  : ok=21   changed=21   unreachable=0    failed=0    skipped=0    rescued=0    ignored=0   

Using /etc/ansible/ansible.cfg as config file

PLAY [worker] ***********************************************************************************************************************************************

TASK [Create Tenant Namespace] ******************************************************************************************************************************
changed: [99.99.99.2] => (item={u'default_route_ip': u'192.168.130.1', u'name': u't2', u'pns_ip': u'192.168.130.1/24', u'tenant_if': u't2if', u'tenant_ip': u'192.168.130.2/24', u'pns_if': u't2pns_if'}) => {"ansible_loop_var": "item", "changed": true, "cmd": ["ip", "netns", "add", "t2"], "delta": "0:00:00.072656", "end": "2019-11-18 00:24:44.767871", "item": {"default_route_ip": "192.168.130.1", "name": "t2", "pns_if": "t2pns_if", "pns_ip": "192.168.130.1/24", "tenant_if": "t2if", "tenant_ip": "192.168.130.2/24"}, "rc": 0, "start": "2019-11-18 00:24:44.695215", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Create Subnet Namespace] ******************************************************************************************************************************
changed: [99.99.99.2] => (item={u'route': [{u'ip': u'10.2.11.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.2.11.1', u'bridge_name': u't2br1', u'dns': [{u'dnsif': u't2s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't2s1_dnsbrif'}], u'ns_name': u't2ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.11.2/24', u'tenant_ns_ip': u'10.2.11.1/24', u'tenant_ns_if': u't2ns1if', u'tenant_ns_name': u't2', u'tenant_sub_if': u't2s1if'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't2_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't2br1if1', u'vmif': u't2VM4if1'}], u'vxlan': [{u'local_ip': u'10.2.11.2', u'tenant_route_ip': u'192.168.130.2', u'dsport': 4789, u'dev': u't2s1if', u'subnet_route': u'10.2.11.0/24', u'remote_route': u'10.1.11.0/24', u'v_name': u'vxlan_t2s1', u'id': 42, u'remote_ip': u'10.1.11.2'}]}) => {"ansible_loop_var": "item", "changed": true, "cmd": ["ip", "netns", "add", "t2ns1"], "delta": "0:00:00.064870", "end": "2019-11-18 00:24:47.438674", "item": {"bridge_name": "t2br1", "default_route_ip": "10.2.11.1", "dns": [{"brif": "t2s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t2s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns1", "route": [{"if": "p1", "ip": "10.2.11.1/24", "ns_if": "t2if", "ns_name": "t2"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t2ns1if", "tenant_ns_ip": "10.2.11.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s1if", "tenant_sub_ip": "10.2.11.2/24"}], "vms": [{"brif": "t2br1if1", "disk": "10G", "mem": 2, "name": "t2_VM4", "vcpu": 4, "vmif": "t2VM4if1"}], "vxlan": [{"dev": "t2s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.11.2", "remote_ip": "10.1.11.2", "remote_route": "10.1.11.0/24", "subnet_route": "10.2.11.0/24", "tenant_route_ip": "192.168.130.2", "v_name": "vxlan_t2s1"}]}, "rc": 0, "start": "2019-11-18 00:24:47.373804", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Create Tenant VETH pairs] *****************************************************************************************************************************
changed: [99.99.99.2] => (item={u'default_route_ip': u'192.168.130.1', u'name': u't2', u'pns_ip': u'192.168.130.1/24', u'tenant_if': u't2if', u'tenant_ip': u'192.168.130.2/24', u'pns_if': u't2pns_if'}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip link show \"t2if\" ; if [ $? -ne 0 ] ; then ip link add \"t2if\" type veth peer name \"t2pns_if\" ; fi\n", "delta": "0:00:00.011075", "end": "2019-11-18 00:24:47.881452", "item": {"default_route_ip": "192.168.130.1", "name": "t2", "pns_if": "t2pns_if", "pns_ip": "192.168.130.1/24", "tenant_if": "t2if", "tenant_ip": "192.168.130.2/24"}, "rc": 0, "start": "2019-11-18 00:24:47.870377", "stderr": "Device \"t2if\" does not exist.", "stderr_lines": ["Device \"t2if\" does not exist."], "stdout": "", "stdout_lines": []}

TASK [Attach Tenant VETH Pairs] *****************************************************************************************************************************
changed: [99.99.99.2] => (item={u'default_route_ip': u'192.168.130.1', u'name': u't2', u'pns_ip': u'192.168.130.1/24', u'tenant_if': u't2if', u'tenant_ip': u'192.168.130.2/24', u'pns_if': u't2pns_if'}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec pns ip link show \"t2pns_if\" ; if [ $? -ne 0 ] ; then ip link set \"t2pns_if\" netns pns ; fi\nip netns exec \"t2\" ip link show \"t2if\" ; if [ $? -ne 0 ] ; then ip link set \"t2if\" netns \"t2\" ; fi\nip netns exec pns ip link set dev \"t2pns_if\" up\nip netns exec \"t2\" ip link set dev \"t2if\" up\n", "delta": "0:00:00.201179", "end": "2019-11-18 00:24:49.388172", "item": {"default_route_ip": "192.168.130.1", "name": "t2", "pns_if": "t2pns_if", "pns_ip": "192.168.130.1/24", "tenant_if": "t2if", "tenant_ip": "192.168.130.2/24"}, "rc": 0, "start": "2019-11-18 00:24:49.186993", "stderr": "Device \"t2pns_if\" does not exist.\nDevice \"t2if\" does not exist.", "stderr_lines": ["Device \"t2pns_if\" does not exist.", "Device \"t2if\" does not exist."], "stdout": "", "stdout_lines": []}

TASK [Add IP addresses to Tenant VETH Pairs] ****************************************************************************************************************
changed: [99.99.99.2] => (item={u'default_route_ip': u'192.168.130.1', u'name': u't2', u'pns_ip': u'192.168.130.1/24', u'tenant_if': u't2if', u'tenant_ip': u'192.168.130.2/24', u'pns_if': u't2pns_if'}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec pns ip addr show \"t2pns_if\" | awk 'FNR==3{ print $2 }' | grep -w '^192.168.130.1/24' ; if [ $? -ne 0 ] ; then ip netns exec pns ip addr add \"192.168.130.1/24\" dev \"t2pns_if\" ; fi\nip netns exec \"t2\" ip addr show \"t2if\" | awk 'FNR==3{ print $2 }' | grep -w '^192.168.130.2/24' ; if [ $? -ne 0 ] ; then ip netns exec \"t2\" ip addr add \"192.168.130.2/24\" dev \"t2if\" ; fi\n", "delta": "0:00:00.139793", "end": "2019-11-18 00:24:52.744197", "item": {"default_route_ip": "192.168.130.1", "name": "t2", "pns_if": "t2pns_if", "pns_ip": "192.168.130.1/24", "tenant_if": "t2if", "tenant_ip": "192.168.130.2/24"}, "rc": 0, "start": "2019-11-18 00:24:52.604404", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Create Namespace VETH Pairs] **************************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.11.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.2.11.1', u'bridge_name': u't2br1', u'dns': [{u'dnsif': u't2s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't2s1_dnsbrif'}], u'ns_name': u't2ns1', u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't2_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't2br1if1', u'vmif': u't2VM4if1'}], u'vxlan': [{u'local_ip': u'10.2.11.2', u'dsport': 4789, u'dev': u't2s1if', u'tenant_route_ip': u'192.168.130.2', u'remote_route': u'10.1.11.0/24', u'subnet_route': u'10.2.11.0/24', u'v_name': u'vxlan_t2s1', u'id': 42, u'remote_ip': u'10.1.11.2'}]}, {u'tenant_sub_ip': u'10.2.11.2/24', u'tenant_ns_ip': u'10.2.11.1/24', u'tenant_ns_if': u't2ns1if', u'tenant_sub_if': u't2s1if', u'tenant_ns_name': u't2'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip link show \"t2ns1if\" ; if [ $? -ne 0 ] ; then ip link add \"t2ns1if\" type veth peer name \"t2s1if\" ; fi\n", "delta": "0:00:00.010019", "end": "2019-11-18 00:24:54.735676", "item": [{"bridge_name": "t2br1", "default_route_ip": "10.2.11.1", "dns": [{"brif": "t2s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t2s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns1", "route": [{"if": "p1", "ip": "10.2.11.1/24", "ns_if": "t2if", "ns_name": "t2"}], "subnet_ip": "1.1.1.0/24", "vms": [{"brif": "t2br1if1", "disk": "10G", "mem": 2, "name": "t2_VM4", "vcpu": 4, "vmif": "t2VM4if1"}], "vxlan": [{"dev": "t2s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.11.2", "remote_ip": "10.1.11.2", "remote_route": "10.1.11.0/24", "subnet_route": "10.2.11.0/24", "tenant_route_ip": "192.168.130.2", "v_name": "vxlan_t2s1"}]}, {"tenant_ns_if": "t2ns1if", "tenant_ns_ip": "10.2.11.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s1if", "tenant_sub_ip": "10.2.11.2/24"}], "rc": 0, "start": "2019-11-18 00:24:54.725657", "stderr": "Device \"t2ns1if\" does not exist.", "stderr_lines": ["Device \"t2ns1if\" does not exist."], "stdout": "", "stdout_lines": []}

TASK [Attach Namespace VETH Pairs] **************************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.11.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.2.11.1', u'bridge_name': u't2br1', u'dns': [{u'dnsif': u't2s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't2s1_dnsbrif'}], u'ns_name': u't2ns1', u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't2_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't2br1if1', u'vmif': u't2VM4if1'}], u'vxlan': [{u'local_ip': u'10.2.11.2', u'dsport': 4789, u'dev': u't2s1if', u'tenant_route_ip': u'192.168.130.2', u'remote_route': u'10.1.11.0/24', u'subnet_route': u'10.2.11.0/24', u'v_name': u'vxlan_t2s1', u'id': 42, u'remote_ip': u'10.1.11.2'}]}, {u'tenant_sub_ip': u'10.2.11.2/24', u'tenant_ns_ip': u'10.2.11.1/24', u'tenant_ns_if': u't2ns1if', u'tenant_sub_if': u't2s1if', u'tenant_ns_name': u't2'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t2\" ip link show \"t2ns1if\" ; if [ $? -ne 0 ] ; then ip link set \"t2ns1if\" netns \"t2\" ; fi\nip netns exec \"t2ns1\" ip link show \"t2s1if\" ; if [ $? -ne 0 ] ; then ip link set \"t2s1if\" netns \"t2ns1\" ; fi\n", "delta": "0:00:00.129984", "end": "2019-11-18 00:24:57.002419", "item": [{"bridge_name": "t2br1", "default_route_ip": "10.2.11.1", "dns": [{"brif": "t2s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t2s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns1", "route": [{"if": "p1", "ip": "10.2.11.1/24", "ns_if": "t2if", "ns_name": "t2"}], "subnet_ip": "1.1.1.0/24", "vms": [{"brif": "t2br1if1", "disk": "10G", "mem": 2, "name": "t2_VM4", "vcpu": 4, "vmif": "t2VM4if1"}], "vxlan": [{"dev": "t2s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.11.2", "remote_ip": "10.1.11.2", "remote_route": "10.1.11.0/24", "subnet_route": "10.2.11.0/24", "tenant_route_ip": "192.168.130.2", "v_name": "vxlan_t2s1"}]}, {"tenant_ns_if": "t2ns1if", "tenant_ns_ip": "10.2.11.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s1if", "tenant_sub_ip": "10.2.11.2/24"}], "rc": 0, "start": "2019-11-18 00:24:56.872435", "stderr": "Device \"t2ns1if\" does not exist.\nDevice \"t2s1if\" does not exist.", "stderr_lines": ["Device \"t2ns1if\" does not exist.", "Device \"t2s1if\" does not exist."], "stdout": "", "stdout_lines": []}

TASK [Set Namespace VETH Pairs UP] **************************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.11.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.2.11.1', u'bridge_name': u't2br1', u'dns': [{u'dnsif': u't2s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't2s1_dnsbrif'}], u'ns_name': u't2ns1', u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't2_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't2br1if1', u'vmif': u't2VM4if1'}], u'vxlan': [{u'local_ip': u'10.2.11.2', u'dsport': 4789, u'dev': u't2s1if', u'tenant_route_ip': u'192.168.130.2', u'remote_route': u'10.1.11.0/24', u'subnet_route': u'10.2.11.0/24', u'v_name': u'vxlan_t2s1', u'id': 42, u'remote_ip': u'10.1.11.2'}]}, {u'tenant_sub_ip': u'10.2.11.2/24', u'tenant_ns_ip': u'10.2.11.1/24', u'tenant_ns_if': u't2ns1if', u'tenant_sub_if': u't2s1if', u'tenant_ns_name': u't2'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t2\" ip link set dev \"t2ns1if\" up\nip netns exec \"t2ns1\" ip link set dev \"t2s1if\" up\n", "delta": "0:00:00.089560", "end": "2019-11-18 00:25:00.136268", "item": [{"bridge_name": "t2br1", "default_route_ip": "10.2.11.1", "dns": [{"brif": "t2s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t2s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns1", "route": [{"if": "p1", "ip": "10.2.11.1/24", "ns_if": "t2if", "ns_name": "t2"}], "subnet_ip": "1.1.1.0/24", "vms": [{"brif": "t2br1if1", "disk": "10G", "mem": 2, "name": "t2_VM4", "vcpu": 4, "vmif": "t2VM4if1"}], "vxlan": [{"dev": "t2s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.11.2", "remote_ip": "10.1.11.2", "remote_route": "10.1.11.0/24", "subnet_route": "10.2.11.0/24", "tenant_route_ip": "192.168.130.2", "v_name": "vxlan_t2s1"}]}, {"tenant_ns_if": "t2ns1if", "tenant_ns_ip": "10.2.11.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s1if", "tenant_sub_ip": "10.2.11.2/24"}], "rc": 0, "start": "2019-11-18 00:25:00.046708", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Add IP addresses to Namespace VETH Pairs] *************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.11.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.2.11.1', u'bridge_name': u't2br1', u'dns': [{u'dnsif': u't2s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't2s1_dnsbrif'}], u'ns_name': u't2ns1', u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't2_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't2br1if1', u'vmif': u't2VM4if1'}], u'vxlan': [{u'local_ip': u'10.2.11.2', u'dsport': 4789, u'dev': u't2s1if', u'tenant_route_ip': u'192.168.130.2', u'remote_route': u'10.1.11.0/24', u'subnet_route': u'10.2.11.0/24', u'v_name': u'vxlan_t2s1', u'id': 42, u'remote_ip': u'10.1.11.2'}]}, {u'tenant_sub_ip': u'10.2.11.2/24', u'tenant_ns_ip': u'10.2.11.1/24', u'tenant_ns_if': u't2ns1if', u'tenant_sub_if': u't2s1if', u'tenant_ns_name': u't2'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t2ns1\" ip addr show \"t2s1if\" | awk 'FNR==3{ print $2 }' | grep -w '^10.2.11.2/24' ; if [ $? -ne 0 ] ; then ip netns exec \"t2ns1\" ip addr add \"10.2.11.2/24\" dev \"t2s1if\" ; fi\n\nip netns exec \"t2\" ip addr show \"t2ns1if\" | awk 'FNR==3{ print $2 }' | grep -w '^10.2.11.1/24' ; if [ $? -ne 0 ] ; then ip netns exec \"t2\" ip addr add \"10.2.11.1/24\" dev \"t2ns1if\" ; fi\n", "delta": "0:00:00.148456", "end": "2019-11-18 00:25:03.404185", "item": [{"bridge_name": "t2br1", "default_route_ip": "10.2.11.1", "dns": [{"brif": "t2s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t2s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns1", "route": [{"if": "p1", "ip": "10.2.11.1/24", "ns_if": "t2if", "ns_name": "t2"}], "subnet_ip": "1.1.1.0/24", "vms": [{"brif": "t2br1if1", "disk": "10G", "mem": 2, "name": "t2_VM4", "vcpu": 4, "vmif": "t2VM4if1"}], "vxlan": [{"dev": "t2s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.11.2", "remote_ip": "10.1.11.2", "remote_route": "10.1.11.0/24", "subnet_route": "10.2.11.0/24", "tenant_route_ip": "192.168.130.2", "v_name": "vxlan_t2s1"}]}, {"tenant_ns_if": "t2ns1if", "tenant_ns_ip": "10.2.11.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s1if", "tenant_sub_ip": "10.2.11.2/24"}], "rc": 0, "start": "2019-11-18 00:25:03.255729", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Add IP Route to Tenant] *******************************************************************************************************************************
changed: [99.99.99.2] => (item={u'default_route_ip': u'192.168.130.1', u'name': u't2', u'pns_ip': u'192.168.130.1/24', u'tenant_if': u't2if', u'tenant_ip': u'192.168.130.2/24', u'pns_if': u't2pns_if'}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t2\" ip route show default | grep -w '[d]efault via 192.168.130.1' ; if [ $? -ne 0 ] ; then ip netns exec \"t2\" ip route add default via \"192.168.130.1\" ; fi\n", "delta": "0:00:00.092000", "end": "2019-11-18 00:25:04.128334", "item": {"default_route_ip": "192.168.130.1", "name": "t2", "pns_if": "t2pns_if", "pns_ip": "192.168.130.1/24", "tenant_if": "t2if", "tenant_ip": "192.168.130.2/24"}, "rc": 0, "start": "2019-11-18 00:25:04.036334", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Add IP Route to Tenant Subnet] ************************************************************************************************************************
changed: [99.99.99.2] => (item={u'route': [{u'ip': u'10.2.11.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.2.11.1', u'bridge_name': u't2br1', u'dns': [{u'dnsif': u't2s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't2s1_dnsbrif'}], u'ns_name': u't2ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.11.2/24', u'tenant_ns_ip': u'10.2.11.1/24', u'tenant_ns_if': u't2ns1if', u'tenant_ns_name': u't2', u'tenant_sub_if': u't2s1if'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't2_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't2br1if1', u'vmif': u't2VM4if1'}], u'vxlan': [{u'local_ip': u'10.2.11.2', u'tenant_route_ip': u'192.168.130.2', u'dsport': 4789, u'dev': u't2s1if', u'subnet_route': u'10.2.11.0/24', u'remote_route': u'10.1.11.0/24', u'v_name': u'vxlan_t2s1', u'id': 42, u'remote_ip': u'10.1.11.2'}]}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t2ns1\" ip route show default | grep -w '[d]efault via 10.2.11.1' ; if [ $? -ne 0 ] ; then ip netns exec \"t2ns1\" ip route add default via \"10.2.11.1\" ; fi\n", "delta": "0:00:00.100684", "end": "2019-11-18 00:25:04.752374", "item": {"bridge_name": "t2br1", "default_route_ip": "10.2.11.1", "dns": [{"brif": "t2s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t2s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns1", "route": [{"if": "p1", "ip": "10.2.11.1/24", "ns_if": "t2if", "ns_name": "t2"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t2ns1if", "tenant_ns_ip": "10.2.11.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s1if", "tenant_sub_ip": "10.2.11.2/24"}], "vms": [{"brif": "t2br1if1", "disk": "10G", "mem": 2, "name": "t2_VM4", "vcpu": 4, "vmif": "t2VM4if1"}], "vxlan": [{"dev": "t2s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.11.2", "remote_ip": "10.1.11.2", "remote_route": "10.1.11.0/24", "subnet_route": "10.2.11.0/24", "tenant_route_ip": "192.168.130.2", "v_name": "vxlan_t2s1"}]}, "rc": 0, "start": "2019-11-18 00:25:04.651690", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Create bridge inside namespace] ***********************************************************************************************************************
changed: [99.99.99.2] => (item={u'route': [{u'ip': u'10.2.11.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.2.11.1', u'bridge_name': u't2br1', u'dns': [{u'dnsif': u't2s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't2s1_dnsbrif'}], u'ns_name': u't2ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.11.2/24', u'tenant_ns_ip': u'10.2.11.1/24', u'tenant_ns_if': u't2ns1if', u'tenant_ns_name': u't2', u'tenant_sub_if': u't2s1if'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't2_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't2br1if1', u'vmif': u't2VM4if1'}], u'vxlan': [{u'local_ip': u'10.2.11.2', u'tenant_route_ip': u'192.168.130.2', u'dsport': 4789, u'dev': u't2s1if', u'subnet_route': u'10.2.11.0/24', u'remote_route': u'10.1.11.0/24', u'v_name': u'vxlan_t2s1', u'id': 42, u'remote_ip': u'10.1.11.2'}]}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t2ns1\" brctl show | grep -w '^t2br1'; if [ $? -ne 0 ] ; then ip netns exec \"t2ns1\" brctl addbr \"t2br1\" ; fi\nip netns exec \"t2ns1\" ip link set dev \"t2br1\" up\n", "delta": "0:00:00.128136", "end": "2019-11-18 00:25:05.284147", "item": {"bridge_name": "t2br1", "default_route_ip": "10.2.11.1", "dns": [{"brif": "t2s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t2s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns1", "route": [{"if": "p1", "ip": "10.2.11.1/24", "ns_if": "t2if", "ns_name": "t2"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t2ns1if", "tenant_ns_ip": "10.2.11.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s1if", "tenant_sub_ip": "10.2.11.2/24"}], "vms": [{"brif": "t2br1if1", "disk": "10G", "mem": 2, "name": "t2_VM4", "vcpu": 4, "vmif": "t2VM4if1"}], "vxlan": [{"dev": "t2s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.11.2", "remote_ip": "10.1.11.2", "remote_route": "10.1.11.0/24", "subnet_route": "10.2.11.0/24", "tenant_route_ip": "192.168.130.2", "v_name": "vxlan_t2s1"}]}, "rc": 0, "start": "2019-11-18 00:25:05.156011", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Create DNS VETH Pair] *********************************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.11.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.2.11.1', u'bridge_name': u't2br1', u'ns_name': u't2ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.11.2/24', u'tenant_ns_ip': u'10.2.11.1/24', u'tenant_ns_if': u't2ns1if', u'tenant_sub_if': u't2s1if', u'tenant_ns_name': u't2'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't2_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't2br1if1', u'vmif': u't2VM4if1'}], u'vxlan': [{u'local_ip': u'10.2.11.2', u'dsport': 4789, u'dev': u't2s1if', u'tenant_route_ip': u'192.168.130.2', u'remote_route': u'10.1.11.0/24', u'subnet_route': u'10.2.11.0/24', u'v_name': u'vxlan_t2s1', u'id': 42, u'remote_ip': u'10.1.11.2'}]}, {u'dnsif': u't2s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't2s1_dnsbrif'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t2ns1\" ip link show \"t2s1_dnsbrif\" ; if [ $? -ne 0 ] ; then ip netns exec \"t2ns1\" ip link add \"t2s1_dnsbrif\" type veth peer name \"t2s1_dnsif\" ; fi\nip netns exec \"t2ns1\" ip link set dev \"t2s1_dnsbrif\" up\nip netns exec \"t2ns1\" ip link set dev \"t2s1_dnsif\" up\n", "delta": "0:00:00.225545", "end": "2019-11-18 00:25:05.880143", "item": [{"bridge_name": "t2br1", "default_route_ip": "10.2.11.1", "ns_name": "t2ns1", "route": [{"if": "p1", "ip": "10.2.11.1/24", "ns_if": "t2if", "ns_name": "t2"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t2ns1if", "tenant_ns_ip": "10.2.11.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s1if", "tenant_sub_ip": "10.2.11.2/24"}], "vms": [{"brif": "t2br1if1", "disk": "10G", "mem": 2, "name": "t2_VM4", "vcpu": 4, "vmif": "t2VM4if1"}], "vxlan": [{"dev": "t2s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.11.2", "remote_ip": "10.1.11.2", "remote_route": "10.1.11.0/24", "subnet_route": "10.2.11.0/24", "tenant_route_ip": "192.168.130.2", "v_name": "vxlan_t2s1"}]}, {"brif": "t2s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t2s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "rc": 0, "start": "2019-11-18 00:25:05.654598", "stderr": "Device \"t2s1_dnsbrif\" does not exist.", "stderr_lines": ["Device \"t2s1_dnsbrif\" does not exist."], "stdout": "", "stdout_lines": []}

TASK [Attach DNS VETH Pair] *********************************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.11.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.2.11.1', u'bridge_name': u't2br1', u'ns_name': u't2ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.11.2/24', u'tenant_ns_ip': u'10.2.11.1/24', u'tenant_ns_if': u't2ns1if', u'tenant_sub_if': u't2s1if', u'tenant_ns_name': u't2'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't2_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't2br1if1', u'vmif': u't2VM4if1'}], u'vxlan': [{u'local_ip': u'10.2.11.2', u'dsport': 4789, u'dev': u't2s1if', u'tenant_route_ip': u'192.168.130.2', u'remote_route': u'10.1.11.0/24', u'subnet_route': u'10.2.11.0/24', u'v_name': u'vxlan_t2s1', u'id': 42, u'remote_ip': u'10.1.11.2'}]}, {u'dnsif': u't2s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't2s1_dnsbrif'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t2ns1\" brctl show \"t2br1\" | grep -w 't2s1_dnsbrif' ; if [ $? -ne 0 ] ; then ip netns exec \"t2ns1\" brctl addif \"t2br1\" \"t2s1_dnsbrif\" ; fi\n", "delta": "0:00:00.084499", "end": "2019-11-18 00:25:06.340201", "item": [{"bridge_name": "t2br1", "default_route_ip": "10.2.11.1", "ns_name": "t2ns1", "route": [{"if": "p1", "ip": "10.2.11.1/24", "ns_if": "t2if", "ns_name": "t2"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t2ns1if", "tenant_ns_ip": "10.2.11.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s1if", "tenant_sub_ip": "10.2.11.2/24"}], "vms": [{"brif": "t2br1if1", "disk": "10G", "mem": 2, "name": "t2_VM4", "vcpu": 4, "vmif": "t2VM4if1"}], "vxlan": [{"dev": "t2s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.11.2", "remote_ip": "10.1.11.2", "remote_route": "10.1.11.0/24", "subnet_route": "10.2.11.0/24", "tenant_route_ip": "192.168.130.2", "v_name": "vxlan_t2s1"}]}, {"brif": "t2s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t2s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "rc": 0, "start": "2019-11-18 00:25:06.255702", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Create VETH Pairs] ************************************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.11.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.2.11.1', u'bridge_name': u't2br1', u'dns': [{u'dnsif': u't2s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't2s1_dnsbrif'}], u'ns_name': u't2ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.11.2/24', u'tenant_ns_ip': u'10.2.11.1/24', u'tenant_ns_if': u't2ns1if', u'tenant_sub_if': u't2s1if', u'tenant_ns_name': u't2'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.2.11.2', u'dsport': 4789, u'dev': u't2s1if', u'tenant_route_ip': u'192.168.130.2', u'remote_route': u'10.1.11.0/24', u'subnet_route': u'10.2.11.0/24', u'v_name': u'vxlan_t2s1', u'id': 42, u'remote_ip': u'10.1.11.2'}]}, {u'mem': 2, u'name': u't2_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't2br1if1', u'vmif': u't2VM4if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip link show \"t2br1if1\" ; if [ $? -ne 0 ] ; then ip link add \"t2VM4if1\" type veth peer name \"t2br1if1\" ; fi\nip link set dev \"t2br1if1\" up\nip link set dev \"t2VM4if1\" up\n", "delta": "0:00:00.020308", "end": "2019-11-18 00:25:06.766688", "item": [{"bridge_name": "t2br1", "default_route_ip": "10.2.11.1", "dns": [{"brif": "t2s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t2s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns1", "route": [{"if": "p1", "ip": "10.2.11.1/24", "ns_if": "t2if", "ns_name": "t2"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t2ns1if", "tenant_ns_ip": "10.2.11.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s1if", "tenant_sub_ip": "10.2.11.2/24"}], "vxlan": [{"dev": "t2s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.11.2", "remote_ip": "10.1.11.2", "remote_route": "10.1.11.0/24", "subnet_route": "10.2.11.0/24", "tenant_route_ip": "192.168.130.2", "v_name": "vxlan_t2s1"}]}, {"brif": "t2br1if1", "disk": "10G", "mem": 2, "name": "t2_VM4", "vcpu": 4, "vmif": "t2VM4if1"}], "rc": 0, "start": "2019-11-18 00:25:06.746380", "stderr": "Device \"t2br1if1\" does not exist.", "stderr_lines": ["Device \"t2br1if1\" does not exist."], "stdout": "", "stdout_lines": []}

TASK [Attach VETH Pairs] ************************************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.11.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.2.11.1', u'bridge_name': u't2br1', u'dns': [{u'dnsif': u't2s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't2s1_dnsbrif'}], u'ns_name': u't2ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.11.2/24', u'tenant_ns_ip': u'10.2.11.1/24', u'tenant_ns_if': u't2ns1if', u'tenant_sub_if': u't2s1if', u'tenant_ns_name': u't2'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.2.11.2', u'dsport': 4789, u'dev': u't2s1if', u'tenant_route_ip': u'192.168.130.2', u'remote_route': u'10.1.11.0/24', u'subnet_route': u'10.2.11.0/24', u'v_name': u'vxlan_t2s1', u'id': 42, u'remote_ip': u'10.1.11.2'}]}, {u'mem': 2, u'name': u't2_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't2br1if1', u'vmif': u't2VM4if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip link show \"t2br1if1\" ; if [ $? -eq 0 ] ; then ip link set \"t2br1if1\" netns \"t2ns1\" ; fi\nip netns exec \"t2ns1\" brctl show \"t2br1\" | grep -w 't2br1if1' ; if [ $? -ne 0 ] ; then ip netns exec \"t2ns1\" brctl addif \"t2br1\" \"t2br1if1\" ; fi\n", "delta": "0:00:00.139099", "end": "2019-11-18 00:25:07.268196", "item": [{"bridge_name": "t2br1", "default_route_ip": "10.2.11.1", "dns": [{"brif": "t2s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t2s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns1", "route": [{"if": "p1", "ip": "10.2.11.1/24", "ns_if": "t2if", "ns_name": "t2"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t2ns1if", "tenant_ns_ip": "10.2.11.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s1if", "tenant_sub_ip": "10.2.11.2/24"}], "vxlan": [{"dev": "t2s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.11.2", "remote_ip": "10.1.11.2", "remote_route": "10.1.11.0/24", "subnet_route": "10.2.11.0/24", "tenant_route_ip": "192.168.130.2", "v_name": "vxlan_t2s1"}]}, {"brif": "t2br1if1", "disk": "10G", "mem": 2, "name": "t2_VM4", "vcpu": 4, "vmif": "t2VM4if1"}], "rc": 0, "start": "2019-11-18 00:25:07.129097", "stderr": "", "stderr_lines": [], "stdout": "25: t2br1if1@t2VM4if1: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP mode DEFAULT group default qlen 1000\n    link/ether e6:62:f1:57:b0:99 brd ff:ff:ff:ff:ff:ff", "stdout_lines": ["25: t2br1if1@t2VM4if1: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP mode DEFAULT group default qlen 1000", "    link/ether e6:62:f1:57:b0:99 brd ff:ff:ff:ff:ff:ff"]}

TASK [All interfaces and bridges UP] ************************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.11.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.2.11.1', u'bridge_name': u't2br1', u'dns': [{u'dnsif': u't2s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't2s1_dnsbrif'}], u'ns_name': u't2ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.11.2/24', u'tenant_ns_ip': u'10.2.11.1/24', u'tenant_ns_if': u't2ns1if', u'tenant_sub_if': u't2s1if', u'tenant_ns_name': u't2'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.2.11.2', u'dsport': 4789, u'dev': u't2s1if', u'tenant_route_ip': u'192.168.130.2', u'remote_route': u'10.1.11.0/24', u'subnet_route': u'10.2.11.0/24', u'v_name': u'vxlan_t2s1', u'id': 42, u'remote_ip': u'10.1.11.2'}]}, {u'mem': 2, u'name': u't2_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't2br1if1', u'vmif': u't2VM4if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t2ns1\" ip link set \"t2br1if1\" up\nip netns exec \"t2ns1\" ip link set dev \"t2br1\" up\n", "delta": "0:00:00.081019", "end": "2019-11-18 00:25:07.764175", "item": [{"bridge_name": "t2br1", "default_route_ip": "10.2.11.1", "dns": [{"brif": "t2s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t2s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns1", "route": [{"if": "p1", "ip": "10.2.11.1/24", "ns_if": "t2if", "ns_name": "t2"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t2ns1if", "tenant_ns_ip": "10.2.11.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s1if", "tenant_sub_ip": "10.2.11.2/24"}], "vxlan": [{"dev": "t2s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.11.2", "remote_ip": "10.1.11.2", "remote_route": "10.1.11.0/24", "subnet_route": "10.2.11.0/24", "tenant_route_ip": "192.168.130.2", "v_name": "vxlan_t2s1"}]}, {"brif": "t2br1if1", "disk": "10G", "mem": 2, "name": "t2_VM4", "vcpu": 4, "vmif": "t2VM4if1"}], "rc": 0, "start": "2019-11-18 00:25:07.683156", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Add IP to DNS Interface] ******************************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.11.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.2.11.1', u'bridge_name': u't2br1', u'ns_name': u't2ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.11.2/24', u'tenant_ns_ip': u'10.2.11.1/24', u'tenant_ns_if': u't2ns1if', u'tenant_sub_if': u't2s1if', u'tenant_ns_name': u't2'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't2_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't2br1if1', u'vmif': u't2VM4if1'}], u'vxlan': [{u'local_ip': u'10.2.11.2', u'dsport': 4789, u'dev': u't2s1if', u'tenant_route_ip': u'192.168.130.2', u'remote_route': u'10.1.11.0/24', u'subnet_route': u'10.2.11.0/24', u'v_name': u'vxlan_t2s1', u'id': 42, u'remote_ip': u'10.1.11.2'}]}, {u'dnsif': u't2s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't2s1_dnsbrif'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t2ns1\" ip addr show \"t2s1_dnsif\" | awk 'FNR==3{ print $2}'| grep -w '^1.1.1.128/24' ; if [ $? -ne 0 ] ; then ip netns exec \"t2ns1\" ip addr add \"1.1.1.128/24\" dev \"t2s1_dnsif\" ; fi\n", "delta": "0:00:00.072261", "end": "2019-11-18 00:25:08.220212", "item": [{"bridge_name": "t2br1", "default_route_ip": "10.2.11.1", "ns_name": "t2ns1", "route": [{"if": "p1", "ip": "10.2.11.1/24", "ns_if": "t2if", "ns_name": "t2"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t2ns1if", "tenant_ns_ip": "10.2.11.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s1if", "tenant_sub_ip": "10.2.11.2/24"}], "vms": [{"brif": "t2br1if1", "disk": "10G", "mem": 2, "name": "t2_VM4", "vcpu": 4, "vmif": "t2VM4if1"}], "vxlan": [{"dev": "t2s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.11.2", "remote_ip": "10.1.11.2", "remote_route": "10.1.11.0/24", "subnet_route": "10.2.11.0/24", "tenant_route_ip": "192.168.130.2", "v_name": "vxlan_t2s1"}]}, {"brif": "t2s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t2s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "rc": 0, "start": "2019-11-18 00:25:08.147951", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Install DHCP Server] **********************************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.11.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.2.11.1', u'bridge_name': u't2br1', u'ns_name': u't2ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.11.2/24', u'tenant_ns_ip': u'10.2.11.1/24', u'tenant_ns_if': u't2ns1if', u'tenant_sub_if': u't2s1if', u'tenant_ns_name': u't2'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't2_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't2br1if1', u'vmif': u't2VM4if1'}], u'vxlan': [{u'local_ip': u'10.2.11.2', u'dsport': 4789, u'dev': u't2s1if', u'tenant_route_ip': u'192.168.130.2', u'remote_route': u'10.1.11.0/24', u'subnet_route': u'10.2.11.0/24', u'v_name': u'vxlan_t2s1', u'id': 42, u'remote_ip': u'10.1.11.2'}]}, {u'dnsif': u't2s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't2s1_dnsbrif'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t2ns1\" ps aux | grep -w '[d]nsmasq --interface t2s1_dnsif -z --dhcp-range=1.1.1.133,1.1.1.254' ; if [ $? -ne 0 ] ; then ip netns exec \"t2ns1\" dnsmasq --interface \"t2s1_dnsif\" -z --dhcp-range=1.1.1.133,'1.1.1.254' ; fi\n", "delta": "0:00:00.104077", "end": "2019-11-18 00:25:08.683206", "item": [{"bridge_name": "t2br1", "default_route_ip": "10.2.11.1", "ns_name": "t2ns1", "route": [{"if": "p1", "ip": "10.2.11.1/24", "ns_if": "t2if", "ns_name": "t2"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t2ns1if", "tenant_ns_ip": "10.2.11.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s1if", "tenant_sub_ip": "10.2.11.2/24"}], "vms": [{"brif": "t2br1if1", "disk": "10G", "mem": 2, "name": "t2_VM4", "vcpu": 4, "vmif": "t2VM4if1"}], "vxlan": [{"dev": "t2s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.11.2", "remote_ip": "10.1.11.2", "remote_route": "10.1.11.0/24", "subnet_route": "10.2.11.0/24", "tenant_route_ip": "192.168.130.2", "v_name": "vxlan_t2s1"}]}, {"brif": "t2s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t2s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "rc": 0, "start": "2019-11-18 00:25:08.579129", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Create VXLAN devices] *********************************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.11.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.2.11.1', u'bridge_name': u't2br1', u'dns': [{u'dnsif': u't2s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't2s1_dnsbrif'}], u'ns_name': u't2ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.11.2/24', u'tenant_ns_ip': u'10.2.11.1/24', u'tenant_ns_if': u't2ns1if', u'tenant_sub_if': u't2s1if', u'tenant_ns_name': u't2'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't2_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't2br1if1', u'vmif': u't2VM4if1'}]}, {u'local_ip': u'10.2.11.2', u'dsport': 4789, u'dev': u't2s1if', u'tenant_route_ip': u'192.168.130.2', u'remote_route': u'10.1.11.0/24', u'subnet_route': u'10.2.11.0/24', u'v_name': u'vxlan_t2s1', u'id': 42, u'remote_ip': u'10.1.11.2'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t2ns1\" ip link show \"vxlan_t2s1\" ; if [ $? -ne 0 ] ; then ip netns exec \"t2ns1\" ip link add \"vxlan_t2s1\" type vxlan id \"42\" local \"10.2.11.2\" remote \"10.1.11.2\" dstport \"4789\" dev \"t2s1if\" ; ip netns exec \"t2ns1\" ip link set dev \"vxlan_t2s1\" up ; fi\n", "delta": "0:00:00.147857", "end": "2019-11-18 00:25:09.256131", "item": [{"bridge_name": "t2br1", "default_route_ip": "10.2.11.1", "dns": [{"brif": "t2s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t2s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns1", "route": [{"if": "p1", "ip": "10.2.11.1/24", "ns_if": "t2if", "ns_name": "t2"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t2ns1if", "tenant_ns_ip": "10.2.11.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s1if", "tenant_sub_ip": "10.2.11.2/24"}], "vms": [{"brif": "t2br1if1", "disk": "10G", "mem": 2, "name": "t2_VM4", "vcpu": 4, "vmif": "t2VM4if1"}]}, {"dev": "t2s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.11.2", "remote_ip": "10.1.11.2", "remote_route": "10.1.11.0/24", "subnet_route": "10.2.11.0/24", "tenant_route_ip": "192.168.130.2", "v_name": "vxlan_t2s1"}], "rc": 0, "start": "2019-11-18 00:25:09.108274", "stderr": "Device \"vxlan_t2s1\" does not exist.", "stderr_lines": ["Device \"vxlan_t2s1\" does not exist."], "stdout": "", "stdout_lines": []}

TASK [Attach VXLANs to bridge] ******************************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.11.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.2.11.1', u'bridge_name': u't2br1', u'dns': [{u'dnsif': u't2s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't2s1_dnsbrif'}], u'ns_name': u't2ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.11.2/24', u'tenant_ns_ip': u'10.2.11.1/24', u'tenant_ns_if': u't2ns1if', u'tenant_sub_if': u't2s1if', u'tenant_ns_name': u't2'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't2_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't2br1if1', u'vmif': u't2VM4if1'}]}, {u'local_ip': u'10.2.11.2', u'dsport': 4789, u'dev': u't2s1if', u'tenant_route_ip': u'192.168.130.2', u'remote_route': u'10.1.11.0/24', u'subnet_route': u'10.2.11.0/24', u'v_name': u'vxlan_t2s1', u'id': 42, u'remote_ip': u'10.1.11.2'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t2ns1\" brctl show \"t2br1\" | grep -w 'vxlan_t2s1' ; if [ $? -ne 0 ] ; then ip netns exec \"t2ns1\" brctl addif \"t2br1\" \"vxlan_t2s1\" ; fi\n", "delta": "0:00:00.076995", "end": "2019-11-18 00:25:09.728199", "item": [{"bridge_name": "t2br1", "default_route_ip": "10.2.11.1", "dns": [{"brif": "t2s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t2s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns1", "route": [{"if": "p1", "ip": "10.2.11.1/24", "ns_if": "t2if", "ns_name": "t2"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t2ns1if", "tenant_ns_ip": "10.2.11.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s1if", "tenant_sub_ip": "10.2.11.2/24"}], "vms": [{"brif": "t2br1if1", "disk": "10G", "mem": 2, "name": "t2_VM4", "vcpu": 4, "vmif": "t2VM4if1"}]}, {"dev": "t2s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.11.2", "remote_ip": "10.1.11.2", "remote_route": "10.1.11.0/24", "subnet_route": "10.2.11.0/24", "tenant_route_ip": "192.168.130.2", "v_name": "vxlan_t2s1"}], "rc": 0, "start": "2019-11-18 00:25:09.651204", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

PLAY RECAP **************************************************************************************************************************************************
99.99.99.2                 : ok=21   changed=21   unreachable=0    failed=0    skipped=0    rescued=0    ignored=0   

Using /etc/ansible/ansible.cfg as config file

PLAY [main] *************************************************************************************************************************************************

TASK [Add VXLAN routes in PNS] ******************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.11.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.1.11.1', u'bridge_name': u't2br1', u'dns': [{u'dnsif': u't2s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't2s1_dnsbrif'}], u'ns_name': u't2ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.11.2/24', u'tenant_ns_ip': u'10.1.11.1/24', u'tenant_ns_if': u't2ns1if', u'tenant_sub_if': u't2s1if', u'tenant_ns_name': u't2'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't2_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't2br1if1', u'vmif': u't2VM1if1'}, {u'mem': 4, u'name': u't2_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't2br1if2', u'vmif': u't2VM2if1'}]}, {u'local_ip': u'10.1.11.2', u'dsport': 4789, u'dev': u't2s1if', u'tenant_route_ip': u'192.168.2.2', u'remote_route': u'10.2.11.0/24', u'subnet_route': u'10.1.11.0/24', u'v_name': u'vxlan_t2s1', u'id': 42, u'remote_ip': u'10.2.11.2'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec pns ip route show \"10.1.11.0/24\" via \"192.168.2.2\" | grep -w '^10.1.11.0/24' ; if [ $? -ne 0 ] ; then ip netns exec pns ip route add \"10.1.11.0/24\" via \"192.168.2.2\" ; fi\n", "delta": "0:00:00.066775", "end": "2019-11-18 00:25:10.861641", "item": [{"bridge_name": "t2br1", "default_route_ip": "10.1.11.1", "dns": [{"brif": "t2s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t2s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns1", "route": [{"if": "p1", "ip": "10.1.11.1/24", "ns_if": "t2if", "ns_name": "t2"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t2ns1if", "tenant_ns_ip": "10.1.11.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s1if", "tenant_sub_ip": "10.1.11.2/24"}], "vms": [{"brif": "t2br1if1", "disk": "10G", "mem": 2, "name": "t2_VM1", "vcpu": 4, "vmif": "t2VM1if1"}, {"brif": "t2br1if2", "disk": "10G", "mem": 4, "name": "t2_VM2", "vcpu": 2, "vmif": "t2VM2if1"}]}, {"dev": "t2s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.11.2", "remote_ip": "10.2.11.2", "remote_route": "10.2.11.0/24", "subnet_route": "10.1.11.0/24", "tenant_route_ip": "192.168.2.2", "v_name": "vxlan_t2s1"}], "rc": 0, "start": "2019-11-18 00:25:10.794866", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}
skipping: [localhost] => (item=[{u'route': [{u'ip': u'10.1.12.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.1.12.1', u'bridge_name': u't2br2', u'dns': [{u'dnsif': u't2s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't2s2_dnsbrif'}], u'ns_name': u't2ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.12.2/24', u'tenant_ns_ip': u'10.1.12.1/24', u'tenant_ns_if': u't2ns2if', u'tenant_sub_if': u't2s2if', u'tenant_ns_name': u't2'}], u'subnet_ip': u'2.2.2.0/24', u'vms': [{u'mem': 3, u'name': u't2_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't2br2if1', u'vmif': u't2VM3if1'}]}, {u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}])  => {"ansible_loop_var": "item", "changed": false, "item": [{"bridge_name": "t2br2", "default_route_ip": "10.1.12.1", "dns": [{"brif": "t2s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t2s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns2", "route": [{"if": "p1", "ip": "10.1.12.1/24", "ns_if": "t2if", "ns_name": "t2"}], "subnet_ip": "2.2.2.0/24", "tenant_ns": [{"tenant_ns_if": "t2ns2if", "tenant_ns_ip": "10.1.12.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s2if", "tenant_sub_ip": "10.1.12.2/24"}], "vms": [{"brif": "t2br2if1", "disk": "10G", "mem": 3, "name": "t2_VM3", "vcpu": 2, "vmif": "t2VM3if1"}]}, {"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}], "skip_reason": "Conditional result was False"}

TASK [Get PNS ip address] ***********************************************************************************************************************************
ok: [localhost] => {"changed": false, "cmd": "ip netns exec pns ip addr show p1 | awk 'FNR==3{ print $2 }' | awk -F/ '{ print $1 }'\n", "delta": "0:00:00.034436", "end": "2019-11-18 00:25:11.145953", "rc": 0, "start": "2019-11-18 00:25:11.111517", "stderr": "", "stderr_lines": [], "stdout": "192.168.100.238", "stdout_lines": ["192.168.100.238"]}

TASK [Add VXLAN routes to host] *****************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.11.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.1.11.1', u'bridge_name': u't2br1', u'dns': [{u'dnsif': u't2s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't2s1_dnsbrif'}], u'ns_name': u't2ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.11.2/24', u'tenant_ns_ip': u'10.1.11.1/24', u'tenant_ns_if': u't2ns1if', u'tenant_sub_if': u't2s1if', u'tenant_ns_name': u't2'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't2_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't2br1if1', u'vmif': u't2VM1if1'}, {u'mem': 4, u'name': u't2_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't2br1if2', u'vmif': u't2VM2if1'}]}, {u'local_ip': u'10.1.11.2', u'dsport': 4789, u'dev': u't2s1if', u'tenant_route_ip': u'192.168.2.2', u'remote_route': u'10.2.11.0/24', u'subnet_route': u'10.1.11.0/24', u'v_name': u'vxlan_t2s1', u'id': 42, u'remote_ip': u'10.2.11.2'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip route show \"10.1.11.0/24\" via \"192.168.100.238\" | grep -w '^10.1.11.0/24' ; if [ $? -ne 0 ] ; then ip route add \"10.1.11.0/24\" via \"192.168.100.238\" ; fi\nip route show \"10.2.11.0/24\" via 99.99.99.2 | grep -w '^10.2.11.0/24'; if [ $? -ne 0 ] ; then ip route add \"10.2.11.0/24\" via 99.99.99.2 ; fi\n", "delta": "0:00:00.010117", "end": "2019-11-18 00:25:11.455500", "item": [{"bridge_name": "t2br1", "default_route_ip": "10.1.11.1", "dns": [{"brif": "t2s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t2s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns1", "route": [{"if": "p1", "ip": "10.1.11.1/24", "ns_if": "t2if", "ns_name": "t2"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t2ns1if", "tenant_ns_ip": "10.1.11.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s1if", "tenant_sub_ip": "10.1.11.2/24"}], "vms": [{"brif": "t2br1if1", "disk": "10G", "mem": 2, "name": "t2_VM1", "vcpu": 4, "vmif": "t2VM1if1"}, {"brif": "t2br1if2", "disk": "10G", "mem": 4, "name": "t2_VM2", "vcpu": 2, "vmif": "t2VM2if1"}]}, {"dev": "t2s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.11.2", "remote_ip": "10.2.11.2", "remote_route": "10.2.11.0/24", "subnet_route": "10.1.11.0/24", "tenant_route_ip": "192.168.2.2", "v_name": "vxlan_t2s1"}], "rc": 0, "start": "2019-11-18 00:25:11.445383", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}
skipping: [localhost] => (item=[{u'route': [{u'ip': u'10.1.12.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.1.12.1', u'bridge_name': u't2br2', u'dns': [{u'dnsif': u't2s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't2s2_dnsbrif'}], u'ns_name': u't2ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.12.2/24', u'tenant_ns_ip': u'10.1.12.1/24', u'tenant_ns_if': u't2ns2if', u'tenant_sub_if': u't2s2if', u'tenant_ns_name': u't2'}], u'subnet_ip': u'2.2.2.0/24', u'vms': [{u'mem': 3, u'name': u't2_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't2br2if1', u'vmif': u't2VM3if1'}]}, {u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}])  => {"ansible_loop_var": "item", "changed": false, "item": [{"bridge_name": "t2br2", "default_route_ip": "10.1.12.1", "dns": [{"brif": "t2s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t2s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns2", "route": [{"if": "p1", "ip": "10.1.12.1/24", "ns_if": "t2if", "ns_name": "t2"}], "subnet_ip": "2.2.2.0/24", "tenant_ns": [{"tenant_ns_if": "t2ns2if", "tenant_ns_ip": "10.1.12.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s2if", "tenant_sub_ip": "10.1.12.2/24"}], "vms": [{"brif": "t2br2if1", "disk": "10G", "mem": 3, "name": "t2_VM3", "vcpu": 2, "vmif": "t2VM3if1"}]}, {"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}], "skip_reason": "Conditional result was False"}

PLAY RECAP **************************************************************************************************************************************************
localhost                  : ok=3    changed=2    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0   

Using /etc/ansible/ansible.cfg as config file

PLAY [worker] ***********************************************************************************************************************************************

TASK [Add VXLAN routes in PNS] ******************************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.11.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.2.11.1', u'bridge_name': u't2br1', u'dns': [{u'dnsif': u't2s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't2s1_dnsbrif'}], u'ns_name': u't2ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.11.2/24', u'tenant_ns_ip': u'10.2.11.1/24', u'tenant_ns_if': u't2ns1if', u'tenant_sub_if': u't2s1if', u'tenant_ns_name': u't2'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't2_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't2br1if1', u'vmif': u't2VM4if1'}]}, {u'local_ip': u'10.2.11.2', u'dsport': 4789, u'dev': u't2s1if', u'tenant_route_ip': u'192.168.130.2', u'remote_route': u'10.1.11.0/24', u'subnet_route': u'10.2.11.0/24', u'v_name': u'vxlan_t2s1', u'id': 42, u'remote_ip': u'10.1.11.2'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec pns ip route show \"10.2.11.0/24\" via \"192.168.130.2\" | grep -w '^10.2.11.0/24' ; if [ $? -ne 0 ] ; then ip netns exec pns ip route add \"10.2.11.0/24\" via \"192.168.130.2\" ; fi\n", "delta": "0:00:00.095309", "end": "2019-11-18 00:25:12.864080", "item": [{"bridge_name": "t2br1", "default_route_ip": "10.2.11.1", "dns": [{"brif": "t2s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t2s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns1", "route": [{"if": "p1", "ip": "10.2.11.1/24", "ns_if": "t2if", "ns_name": "t2"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t2ns1if", "tenant_ns_ip": "10.2.11.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s1if", "tenant_sub_ip": "10.2.11.2/24"}], "vms": [{"brif": "t2br1if1", "disk": "10G", "mem": 2, "name": "t2_VM4", "vcpu": 4, "vmif": "t2VM4if1"}]}, {"dev": "t2s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.11.2", "remote_ip": "10.1.11.2", "remote_route": "10.1.11.0/24", "subnet_route": "10.2.11.0/24", "tenant_route_ip": "192.168.130.2", "v_name": "vxlan_t2s1"}], "rc": 0, "start": "2019-11-18 00:25:12.768771", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Get PNS ip address] ***********************************************************************************************************************************
ok: [99.99.99.2] => {"changed": false, "cmd": "ip netns exec pns ip addr show p1 | awk 'FNR==3{ print $2 }' | awk -F/ '{ print $1 }'\n", "delta": "0:00:00.049436", "end": "2019-11-18 00:25:13.304405", "rc": 0, "start": "2019-11-18 00:25:13.254969", "stderr": "", "stderr_lines": [], "stdout": "192.168.100.50", "stdout_lines": ["192.168.100.50"]}

TASK [Add VXLAN routes to host] *****************************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.11.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.2.11.1', u'bridge_name': u't2br1', u'dns': [{u'dnsif': u't2s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't2s1_dnsbrif'}], u'ns_name': u't2ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.11.2/24', u'tenant_ns_ip': u'10.2.11.1/24', u'tenant_ns_if': u't2ns1if', u'tenant_sub_if': u't2s1if', u'tenant_ns_name': u't2'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't2_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't2br1if1', u'vmif': u't2VM4if1'}]}, {u'local_ip': u'10.2.11.2', u'dsport': 4789, u'dev': u't2s1if', u'tenant_route_ip': u'192.168.130.2', u'remote_route': u'10.1.11.0/24', u'subnet_route': u'10.2.11.0/24', u'v_name': u'vxlan_t2s1', u'id': 42, u'remote_ip': u'10.1.11.2'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip route show \"10.2.11.0/24\" via \"192.168.100.50\" | grep -w '^10.2.11.0/24' ; if [ $? -ne 0 ] ; then ip route add \"10.2.11.0/24\" via \"192.168.100.50\" ; fi\nip route show \"10.1.11.0/24\" via 99.99.99.1 | grep -w '^10.1.11.0/24'; if [ $? -ne 0 ] ; then ip route add \"10.1.11.0/24\" via 99.99.99.1 ; fi\n", "delta": "0:00:00.010752", "end": "2019-11-18 00:25:13.747472", "item": [{"bridge_name": "t2br1", "default_route_ip": "10.2.11.1", "dns": [{"brif": "t2s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t2s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns1", "route": [{"if": "p1", "ip": "10.2.11.1/24", "ns_if": "t2if", "ns_name": "t2"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t2ns1if", "tenant_ns_ip": "10.2.11.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s1if", "tenant_sub_ip": "10.2.11.2/24"}], "vms": [{"brif": "t2br1if1", "disk": "10G", "mem": 2, "name": "t2_VM4", "vcpu": 4, "vmif": "t2VM4if1"}]}, {"dev": "t2s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.11.2", "remote_ip": "10.1.11.2", "remote_route": "10.1.11.0/24", "subnet_route": "10.2.11.0/24", "tenant_route_ip": "192.168.130.2", "v_name": "vxlan_t2s1"}], "rc": 0, "start": "2019-11-18 00:25:13.736720", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

PLAY RECAP **************************************************************************************************************************************************
99.99.99.2                 : ok=3    changed=2    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0   

Using /etc/ansible/ansible.cfg as config file

PLAY [main] *************************************************************************************************************************************************

TASK [Create VM templates (C1)] *****************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.11.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.1.11.1', u'bridge_name': u't2br1', u'dns': [{u'dnsif': u't2s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't2s1_dnsbrif'}], u'ns_name': u't2ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.11.2/24', u'tenant_ns_ip': u'10.1.11.1/24', u'tenant_ns_if': u't2ns1if', u'tenant_sub_if': u't2s1if', u'tenant_ns_name': u't2'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.1.11.2', u'dsport': 4789, u'dev': u't2s1if', u'tenant_route_ip': u'192.168.2.2', u'remote_route': u'10.2.11.0/24', u'subnet_route': u'10.1.11.0/24', u'v_name': u'vxlan_t2s1', u'id': 42, u'remote_ip': u'10.2.11.2'}]}, {u'mem': 2, u'name': u't2_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't2br1if1', u'vmif': u't2VM1if1'}]) => {"ansible_loop_var": "item", "changed": true, "checksum": "350ba870bd31b7f6ee517845c14237910b5af0bf", "dest": "/root/Migration-as-a-Service/t2/VM_templates/t2_VM1.xml.j2", "gid": 0, "group": "root", "item": [{"bridge_name": "t2br1", "default_route_ip": "10.1.11.1", "dns": [{"brif": "t2s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t2s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns1", "route": [{"if": "p1", "ip": "10.1.11.1/24", "ns_if": "t2if", "ns_name": "t2"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t2ns1if", "tenant_ns_ip": "10.1.11.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s1if", "tenant_sub_ip": "10.1.11.2/24"}], "vxlan": [{"dev": "t2s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.11.2", "remote_ip": "10.2.11.2", "remote_route": "10.2.11.0/24", "subnet_route": "10.1.11.0/24", "tenant_route_ip": "192.168.2.2", "v_name": "vxlan_t2s1"}]}, {"brif": "t2br1if1", "disk": "10G", "mem": 2, "name": "t2_VM1", "vcpu": 4, "vmif": "t2VM1if1"}], "md5sum": "fbfc2eb0c2569531f25eea92c26d3bee", "mode": "0644", "owner": "root", "size": 4091, "src": "/root/.ansible/tmp/ansible-tmp-1574036714.45-19406384546388/source", "state": "file", "uid": 0}
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.11.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.1.11.1', u'bridge_name': u't2br1', u'dns': [{u'dnsif': u't2s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't2s1_dnsbrif'}], u'ns_name': u't2ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.11.2/24', u'tenant_ns_ip': u'10.1.11.1/24', u'tenant_ns_if': u't2ns1if', u'tenant_sub_if': u't2s1if', u'tenant_ns_name': u't2'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.1.11.2', u'dsport': 4789, u'dev': u't2s1if', u'tenant_route_ip': u'192.168.2.2', u'remote_route': u'10.2.11.0/24', u'subnet_route': u'10.1.11.0/24', u'v_name': u'vxlan_t2s1', u'id': 42, u'remote_ip': u'10.2.11.2'}]}, {u'mem': 4, u'name': u't2_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't2br1if2', u'vmif': u't2VM2if1'}]) => {"ansible_loop_var": "item", "changed": true, "checksum": "350ba870bd31b7f6ee517845c14237910b5af0bf", "dest": "/root/Migration-as-a-Service/t2/VM_templates/t2_VM2.xml.j2", "gid": 0, "group": "root", "item": [{"bridge_name": "t2br1", "default_route_ip": "10.1.11.1", "dns": [{"brif": "t2s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t2s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns1", "route": [{"if": "p1", "ip": "10.1.11.1/24", "ns_if": "t2if", "ns_name": "t2"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t2ns1if", "tenant_ns_ip": "10.1.11.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s1if", "tenant_sub_ip": "10.1.11.2/24"}], "vxlan": [{"dev": "t2s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.11.2", "remote_ip": "10.2.11.2", "remote_route": "10.2.11.0/24", "subnet_route": "10.1.11.0/24", "tenant_route_ip": "192.168.2.2", "v_name": "vxlan_t2s1"}]}, {"brif": "t2br1if2", "disk": "10G", "mem": 4, "name": "t2_VM2", "vcpu": 2, "vmif": "t2VM2if1"}], "md5sum": "fbfc2eb0c2569531f25eea92c26d3bee", "mode": "0644", "owner": "root", "size": 4091, "src": "/root/.ansible/tmp/ansible-tmp-1574036715.09-54937095010651/source", "state": "file", "uid": 0}
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.12.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.1.12.1', u'bridge_name': u't2br2', u'dns': [{u'dnsif': u't2s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't2s2_dnsbrif'}], u'ns_name': u't2ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.12.2/24', u'tenant_ns_ip': u'10.1.12.1/24', u'tenant_ns_if': u't2ns2if', u'tenant_sub_if': u't2s2if', u'tenant_ns_name': u't2'}], u'subnet_ip': u'2.2.2.0/24', u'vxlan': [{u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}, {u'mem': 3, u'name': u't2_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't2br2if1', u'vmif': u't2VM3if1'}]) => {"ansible_loop_var": "item", "changed": true, "checksum": "350ba870bd31b7f6ee517845c14237910b5af0bf", "dest": "/root/Migration-as-a-Service/t2/VM_templates/t2_VM3.xml.j2", "gid": 0, "group": "root", "item": [{"bridge_name": "t2br2", "default_route_ip": "10.1.12.1", "dns": [{"brif": "t2s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t2s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns2", "route": [{"if": "p1", "ip": "10.1.12.1/24", "ns_if": "t2if", "ns_name": "t2"}], "subnet_ip": "2.2.2.0/24", "tenant_ns": [{"tenant_ns_if": "t2ns2if", "tenant_ns_ip": "10.1.12.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s2if", "tenant_sub_ip": "10.1.12.2/24"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, {"brif": "t2br2if1", "disk": "10G", "mem": 3, "name": "t2_VM3", "vcpu": 2, "vmif": "t2VM3if1"}], "md5sum": "fbfc2eb0c2569531f25eea92c26d3bee", "mode": "0644", "owner": "root", "size": 4091, "src": "/root/.ansible/tmp/ansible-tmp-1574036715.38-279391049562999/source", "state": "file", "uid": 0}

PLAY RECAP **************************************************************************************************************************************************
localhost                  : ok=1    changed=1    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0   

Using /etc/ansible/ansible.cfg as config file

PLAY [main] *************************************************************************************************************************************************

TASK [Create VM templates (C2)] *****************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.2.11.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.2.11.1', u'bridge_name': u't2br1', u'dns': [{u'dnsif': u't2s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't2s1_dnsbrif'}], u'ns_name': u't2ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.11.2/24', u'tenant_ns_ip': u'10.2.11.1/24', u'tenant_ns_if': u't2ns1if', u'tenant_sub_if': u't2s1if', u'tenant_ns_name': u't2'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.2.11.2', u'dsport': 4789, u'dev': u't2s1if', u'tenant_route_ip': u'192.168.130.2', u'remote_route': u'10.1.11.0/24', u'subnet_route': u'10.2.11.0/24', u'v_name': u'vxlan_t2s1', u'id': 42, u'remote_ip': u'10.1.11.2'}]}, {u'mem': 2, u'name': u't2_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't2br1if1', u'vmif': u't2VM4if1'}]) => {"ansible_loop_var": "item", "changed": true, "checksum": "350ba870bd31b7f6ee517845c14237910b5af0bf", "dest": "/root/Migration-as-a-Service/t2/VM_templates/t2_VM4.xml.j2", "gid": 0, "group": "root", "item": [{"bridge_name": "t2br1", "default_route_ip": "10.2.11.1", "dns": [{"brif": "t2s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t2s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns1", "route": [{"if": "p1", "ip": "10.2.11.1/24", "ns_if": "t2if", "ns_name": "t2"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t2ns1if", "tenant_ns_ip": "10.2.11.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s1if", "tenant_sub_ip": "10.2.11.2/24"}], "vxlan": [{"dev": "t2s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.11.2", "remote_ip": "10.1.11.2", "remote_route": "10.1.11.0/24", "subnet_route": "10.2.11.0/24", "tenant_route_ip": "192.168.130.2", "v_name": "vxlan_t2s1"}]}, {"brif": "t2br1if1", "disk": "10G", "mem": 2, "name": "t2_VM4", "vcpu": 4, "vmif": "t2VM4if1"}], "md5sum": "fbfc2eb0c2569531f25eea92c26d3bee", "mode": "0644", "owner": "root", "size": 4091, "src": "/root/.ansible/tmp/ansible-tmp-1574036716.32-181677463683217/source", "state": "file", "uid": 0}

PLAY RECAP **************************************************************************************************************************************************
localhost                  : ok=1    changed=1    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0   

Using /etc/ansible/ansible.cfg as config file

PLAY [main] *************************************************************************************************************************************************

TASK [Copy VM image] ****************************************************************************************************************************************
ok: [localhost] => (item=[{u'route': [{u'ip': u'10.1.11.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.1.11.1', u'bridge_name': u't2br1', u'dns': [{u'dnsif': u't2s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't2s1_dnsbrif'}], u'ns_name': u't2ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.11.2/24', u'tenant_ns_ip': u'10.1.11.1/24', u'tenant_ns_if': u't2ns1if', u'tenant_sub_if': u't2s1if', u'tenant_ns_name': u't2'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.1.11.2', u'dsport': 4789, u'dev': u't2s1if', u'tenant_route_ip': u'192.168.2.2', u'remote_route': u'10.2.11.0/24', u'subnet_route': u'10.1.11.0/24', u'v_name': u'vxlan_t2s1', u'id': 42, u'remote_ip': u'10.2.11.2'}]}, {u'mem': 2, u'name': u't2_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't2br1if1', u'vmif': u't2VM1if1'}]) => {"ansible_loop_var": "item", "changed": false, "dest": "/var/lib/libvirt/images/t2_VM1.qcow2", "item": [{"bridge_name": "t2br1", "default_route_ip": "10.1.11.1", "dns": [{"brif": "t2s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t2s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns1", "route": [{"if": "p1", "ip": "10.1.11.1/24", "ns_if": "t2if", "ns_name": "t2"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t2ns1if", "tenant_ns_ip": "10.1.11.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s1if", "tenant_sub_ip": "10.1.11.2/24"}], "vxlan": [{"dev": "t2s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.11.2", "remote_ip": "10.2.11.2", "remote_route": "10.2.11.0/24", "subnet_route": "10.1.11.0/24", "tenant_route_ip": "192.168.2.2", "v_name": "vxlan_t2s1"}]}, {"brif": "t2br1if1", "disk": "10G", "mem": 2, "name": "t2_VM1", "vcpu": 4, "vmif": "t2VM1if1"}], "src": "/root/mainVM.qcow2"}
ok: [localhost] => (item=[{u'route': [{u'ip': u'10.1.11.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.1.11.1', u'bridge_name': u't2br1', u'dns': [{u'dnsif': u't2s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't2s1_dnsbrif'}], u'ns_name': u't2ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.11.2/24', u'tenant_ns_ip': u'10.1.11.1/24', u'tenant_ns_if': u't2ns1if', u'tenant_sub_if': u't2s1if', u'tenant_ns_name': u't2'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.1.11.2', u'dsport': 4789, u'dev': u't2s1if', u'tenant_route_ip': u'192.168.2.2', u'remote_route': u'10.2.11.0/24', u'subnet_route': u'10.1.11.0/24', u'v_name': u'vxlan_t2s1', u'id': 42, u'remote_ip': u'10.2.11.2'}]}, {u'mem': 4, u'name': u't2_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't2br1if2', u'vmif': u't2VM2if1'}]) => {"ansible_loop_var": "item", "changed": false, "dest": "/var/lib/libvirt/images/t2_VM2.qcow2", "item": [{"bridge_name": "t2br1", "default_route_ip": "10.1.11.1", "dns": [{"brif": "t2s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t2s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns1", "route": [{"if": "p1", "ip": "10.1.11.1/24", "ns_if": "t2if", "ns_name": "t2"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t2ns1if", "tenant_ns_ip": "10.1.11.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s1if", "tenant_sub_ip": "10.1.11.2/24"}], "vxlan": [{"dev": "t2s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.11.2", "remote_ip": "10.2.11.2", "remote_route": "10.2.11.0/24", "subnet_route": "10.1.11.0/24", "tenant_route_ip": "192.168.2.2", "v_name": "vxlan_t2s1"}]}, {"brif": "t2br1if2", "disk": "10G", "mem": 4, "name": "t2_VM2", "vcpu": 2, "vmif": "t2VM2if1"}], "src": "/root/mainVM.qcow2"}
ok: [localhost] => (item=[{u'route': [{u'ip': u'10.1.12.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.1.12.1', u'bridge_name': u't2br2', u'dns': [{u'dnsif': u't2s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't2s2_dnsbrif'}], u'ns_name': u't2ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.12.2/24', u'tenant_ns_ip': u'10.1.12.1/24', u'tenant_ns_if': u't2ns2if', u'tenant_sub_if': u't2s2if', u'tenant_ns_name': u't2'}], u'subnet_ip': u'2.2.2.0/24', u'vxlan': [{u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}, {u'mem': 3, u'name': u't2_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't2br2if1', u'vmif': u't2VM3if1'}]) => {"ansible_loop_var": "item", "changed": false, "dest": "/var/lib/libvirt/images/t2_VM3.qcow2", "item": [{"bridge_name": "t2br2", "default_route_ip": "10.1.12.1", "dns": [{"brif": "t2s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t2s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns2", "route": [{"if": "p1", "ip": "10.1.12.1/24", "ns_if": "t2if", "ns_name": "t2"}], "subnet_ip": "2.2.2.0/24", "tenant_ns": [{"tenant_ns_if": "t2ns2if", "tenant_ns_ip": "10.1.12.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s2if", "tenant_sub_ip": "10.1.12.2/24"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, {"brif": "t2br2if1", "disk": "10G", "mem": 3, "name": "t2_VM3", "vcpu": 2, "vmif": "t2VM3if1"}], "src": "/root/mainVM.qcow2"}

TASK [Create VM templates (C1)] *****************************************************************************************************************************
ok: [localhost] => (item=[{u'route': [{u'ip': u'10.1.11.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.1.11.1', u'bridge_name': u't2br1', u'dns': [{u'dnsif': u't2s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't2s1_dnsbrif'}], u'ns_name': u't2ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.11.2/24', u'tenant_ns_ip': u'10.1.11.1/24', u'tenant_ns_if': u't2ns1if', u'tenant_sub_if': u't2s1if', u'tenant_ns_name': u't2'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.1.11.2', u'dsport': 4789, u'dev': u't2s1if', u'tenant_route_ip': u'192.168.2.2', u'remote_route': u'10.2.11.0/24', u'subnet_route': u'10.1.11.0/24', u'v_name': u'vxlan_t2s1', u'id': 42, u'remote_ip': u'10.2.11.2'}]}, {u'mem': 2, u'name': u't2_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't2br1if1', u'vmif': u't2VM1if1'}]) => {"ansible_loop_var": "item", "changed": false, "checksum": "350ba870bd31b7f6ee517845c14237910b5af0bf", "dest": "/root/Migration-as-a-Service/t2/VM_templates/t2_VM1.xml.j2", "gid": 0, "group": "root", "item": [{"bridge_name": "t2br1", "default_route_ip": "10.1.11.1", "dns": [{"brif": "t2s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t2s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns1", "route": [{"if": "p1", "ip": "10.1.11.1/24", "ns_if": "t2if", "ns_name": "t2"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t2ns1if", "tenant_ns_ip": "10.1.11.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s1if", "tenant_sub_ip": "10.1.11.2/24"}], "vxlan": [{"dev": "t2s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.11.2", "remote_ip": "10.2.11.2", "remote_route": "10.2.11.0/24", "subnet_route": "10.1.11.0/24", "tenant_route_ip": "192.168.2.2", "v_name": "vxlan_t2s1"}]}, {"brif": "t2br1if1", "disk": "10G", "mem": 2, "name": "t2_VM1", "vcpu": 4, "vmif": "t2VM1if1"}], "mode": "0644", "owner": "root", "path": "/root/Migration-as-a-Service/t2/VM_templates/t2_VM1.xml.j2", "size": 4091, "state": "file", "uid": 0}
ok: [localhost] => (item=[{u'route': [{u'ip': u'10.1.11.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.1.11.1', u'bridge_name': u't2br1', u'dns': [{u'dnsif': u't2s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't2s1_dnsbrif'}], u'ns_name': u't2ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.11.2/24', u'tenant_ns_ip': u'10.1.11.1/24', u'tenant_ns_if': u't2ns1if', u'tenant_sub_if': u't2s1if', u'tenant_ns_name': u't2'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.1.11.2', u'dsport': 4789, u'dev': u't2s1if', u'tenant_route_ip': u'192.168.2.2', u'remote_route': u'10.2.11.0/24', u'subnet_route': u'10.1.11.0/24', u'v_name': u'vxlan_t2s1', u'id': 42, u'remote_ip': u'10.2.11.2'}]}, {u'mem': 4, u'name': u't2_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't2br1if2', u'vmif': u't2VM2if1'}]) => {"ansible_loop_var": "item", "changed": false, "checksum": "350ba870bd31b7f6ee517845c14237910b5af0bf", "dest": "/root/Migration-as-a-Service/t2/VM_templates/t2_VM2.xml.j2", "gid": 0, "group": "root", "item": [{"bridge_name": "t2br1", "default_route_ip": "10.1.11.1", "dns": [{"brif": "t2s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t2s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns1", "route": [{"if": "p1", "ip": "10.1.11.1/24", "ns_if": "t2if", "ns_name": "t2"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t2ns1if", "tenant_ns_ip": "10.1.11.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s1if", "tenant_sub_ip": "10.1.11.2/24"}], "vxlan": [{"dev": "t2s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.11.2", "remote_ip": "10.2.11.2", "remote_route": "10.2.11.0/24", "subnet_route": "10.1.11.0/24", "tenant_route_ip": "192.168.2.2", "v_name": "vxlan_t2s1"}]}, {"brif": "t2br1if2", "disk": "10G", "mem": 4, "name": "t2_VM2", "vcpu": 2, "vmif": "t2VM2if1"}], "mode": "0644", "owner": "root", "path": "/root/Migration-as-a-Service/t2/VM_templates/t2_VM2.xml.j2", "size": 4091, "state": "file", "uid": 0}
ok: [localhost] => (item=[{u'route': [{u'ip': u'10.1.12.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.1.12.1', u'bridge_name': u't2br2', u'dns': [{u'dnsif': u't2s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't2s2_dnsbrif'}], u'ns_name': u't2ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.12.2/24', u'tenant_ns_ip': u'10.1.12.1/24', u'tenant_ns_if': u't2ns2if', u'tenant_sub_if': u't2s2if', u'tenant_ns_name': u't2'}], u'subnet_ip': u'2.2.2.0/24', u'vxlan': [{u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}, {u'mem': 3, u'name': u't2_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't2br2if1', u'vmif': u't2VM3if1'}]) => {"ansible_loop_var": "item", "changed": false, "checksum": "350ba870bd31b7f6ee517845c14237910b5af0bf", "dest": "/root/Migration-as-a-Service/t2/VM_templates/t2_VM3.xml.j2", "gid": 0, "group": "root", "item": [{"bridge_name": "t2br2", "default_route_ip": "10.1.12.1", "dns": [{"brif": "t2s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t2s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns2", "route": [{"if": "p1", "ip": "10.1.12.1/24", "ns_if": "t2if", "ns_name": "t2"}], "subnet_ip": "2.2.2.0/24", "tenant_ns": [{"tenant_ns_if": "t2ns2if", "tenant_ns_ip": "10.1.12.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s2if", "tenant_sub_ip": "10.1.12.2/24"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, {"brif": "t2br2if1", "disk": "10G", "mem": 3, "name": "t2_VM3", "vcpu": 2, "vmif": "t2VM3if1"}], "mode": "0644", "owner": "root", "path": "/root/Migration-as-a-Service/t2/VM_templates/t2_VM3.xml.j2", "size": 4091, "state": "file", "uid": 0}

TASK [Get list of running VMs] ******************************************************************************************************************************
ok: [localhost] => {"changed": false, "cmd": ["virsh", "list", "--name"], "delta": "0:00:00.025959", "end": "2019-11-18 00:25:19.799436", "rc": 0, "start": "2019-11-18 00:25:19.773477", "stderr": "", "stderr_lines": [], "stdout": "t1_VM2\nt1_VM3", "stdout_lines": ["t1_VM2", "t1_VM3"]}

TASK [Define VM] ********************************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.11.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.1.11.1', u'bridge_name': u't2br1', u'dns': [{u'dnsif': u't2s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't2s1_dnsbrif'}], u'ns_name': u't2ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.11.2/24', u'tenant_ns_ip': u'10.1.11.1/24', u'tenant_ns_if': u't2ns1if', u'tenant_sub_if': u't2s1if', u'tenant_ns_name': u't2'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.1.11.2', u'dsport': 4789, u'dev': u't2s1if', u'tenant_route_ip': u'192.168.2.2', u'remote_route': u'10.2.11.0/24', u'subnet_route': u'10.1.11.0/24', u'v_name': u'vxlan_t2s1', u'id': 42, u'remote_ip': u'10.2.11.2'}]}, {u'mem': 2, u'name': u't2_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't2br1if1', u'vmif': u't2VM1if1'}]) => {"ansible_loop_var": "item", "changed": true, "created": "t2_VM1", "item": [{"bridge_name": "t2br1", "default_route_ip": "10.1.11.1", "dns": [{"brif": "t2s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t2s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns1", "route": [{"if": "p1", "ip": "10.1.11.1/24", "ns_if": "t2if", "ns_name": "t2"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t2ns1if", "tenant_ns_ip": "10.1.11.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s1if", "tenant_sub_ip": "10.1.11.2/24"}], "vxlan": [{"dev": "t2s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.11.2", "remote_ip": "10.2.11.2", "remote_route": "10.2.11.0/24", "subnet_route": "10.1.11.0/24", "tenant_route_ip": "192.168.2.2", "v_name": "vxlan_t2s1"}]}, {"brif": "t2br1if1", "disk": "10G", "mem": 2, "name": "t2_VM1", "vcpu": 4, "vmif": "t2VM1if1"}], "warnings": ["'xml' is given - ignoring 'name'"]}
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.11.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.1.11.1', u'bridge_name': u't2br1', u'dns': [{u'dnsif': u't2s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't2s1_dnsbrif'}], u'ns_name': u't2ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.11.2/24', u'tenant_ns_ip': u'10.1.11.1/24', u'tenant_ns_if': u't2ns1if', u'tenant_sub_if': u't2s1if', u'tenant_ns_name': u't2'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.1.11.2', u'dsport': 4789, u'dev': u't2s1if', u'tenant_route_ip': u'192.168.2.2', u'remote_route': u'10.2.11.0/24', u'subnet_route': u'10.1.11.0/24', u'v_name': u'vxlan_t2s1', u'id': 42, u'remote_ip': u'10.2.11.2'}]}, {u'mem': 4, u'name': u't2_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't2br1if2', u'vmif': u't2VM2if1'}]) => {"ansible_loop_var": "item", "changed": true, "created": "t2_VM2", "item": [{"bridge_name": "t2br1", "default_route_ip": "10.1.11.1", "dns": [{"brif": "t2s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t2s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns1", "route": [{"if": "p1", "ip": "10.1.11.1/24", "ns_if": "t2if", "ns_name": "t2"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t2ns1if", "tenant_ns_ip": "10.1.11.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s1if", "tenant_sub_ip": "10.1.11.2/24"}], "vxlan": [{"dev": "t2s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.11.2", "remote_ip": "10.2.11.2", "remote_route": "10.2.11.0/24", "subnet_route": "10.1.11.0/24", "tenant_route_ip": "192.168.2.2", "v_name": "vxlan_t2s1"}]}, {"brif": "t2br1if2", "disk": "10G", "mem": 4, "name": "t2_VM2", "vcpu": 2, "vmif": "t2VM2if1"}], "warnings": ["'xml' is given - ignoring 'name'"]}
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.12.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.1.12.1', u'bridge_name': u't2br2', u'dns': [{u'dnsif': u't2s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't2s2_dnsbrif'}], u'ns_name': u't2ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.12.2/24', u'tenant_ns_ip': u'10.1.12.1/24', u'tenant_ns_if': u't2ns2if', u'tenant_sub_if': u't2s2if', u'tenant_ns_name': u't2'}], u'subnet_ip': u'2.2.2.0/24', u'vxlan': [{u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}, {u'mem': 3, u'name': u't2_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't2br2if1', u'vmif': u't2VM3if1'}]) => {"ansible_loop_var": "item", "changed": true, "created": "t2_VM3", "item": [{"bridge_name": "t2br2", "default_route_ip": "10.1.12.1", "dns": [{"brif": "t2s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t2s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns2", "route": [{"if": "p1", "ip": "10.1.12.1/24", "ns_if": "t2if", "ns_name": "t2"}], "subnet_ip": "2.2.2.0/24", "tenant_ns": [{"tenant_ns_if": "t2ns2if", "tenant_ns_ip": "10.1.12.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s2if", "tenant_sub_ip": "10.1.12.2/24"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, {"brif": "t2br2if1", "disk": "10G", "mem": 3, "name": "t2_VM3", "vcpu": 2, "vmif": "t2VM3if1"}], "warnings": ["'xml' is given - ignoring 'name'"]}

TASK [Create VM] ********************************************************************************************************************************************
ok: [localhost] => (item=[{u'route': [{u'ip': u'10.1.11.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.1.11.1', u'bridge_name': u't2br1', u'dns': [{u'dnsif': u't2s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't2s1_dnsbrif'}], u'ns_name': u't2ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.11.2/24', u'tenant_ns_ip': u'10.1.11.1/24', u'tenant_ns_if': u't2ns1if', u'tenant_sub_if': u't2s1if', u'tenant_ns_name': u't2'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.1.11.2', u'dsport': 4789, u'dev': u't2s1if', u'tenant_route_ip': u'192.168.2.2', u'remote_route': u'10.2.11.0/24', u'subnet_route': u'10.1.11.0/24', u'v_name': u'vxlan_t2s1', u'id': 42, u'remote_ip': u'10.2.11.2'}]}, {u'mem': 2, u'name': u't2_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't2br1if1', u'vmif': u't2VM1if1'}]) => {"ansible_loop_var": "item", "changed": false, "create": 0, "item": [{"bridge_name": "t2br1", "default_route_ip": "10.1.11.1", "dns": [{"brif": "t2s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t2s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns1", "route": [{"if": "p1", "ip": "10.1.11.1/24", "ns_if": "t2if", "ns_name": "t2"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t2ns1if", "tenant_ns_ip": "10.1.11.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s1if", "tenant_sub_ip": "10.1.11.2/24"}], "vxlan": [{"dev": "t2s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.11.2", "remote_ip": "10.2.11.2", "remote_route": "10.2.11.0/24", "subnet_route": "10.1.11.0/24", "tenant_route_ip": "192.168.2.2", "v_name": "vxlan_t2s1"}]}, {"brif": "t2br1if1", "disk": "10G", "mem": 2, "name": "t2_VM1", "vcpu": 4, "vmif": "t2VM1if1"}]}
ok: [localhost] => (item=[{u'route': [{u'ip': u'10.1.11.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.1.11.1', u'bridge_name': u't2br1', u'dns': [{u'dnsif': u't2s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't2s1_dnsbrif'}], u'ns_name': u't2ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.11.2/24', u'tenant_ns_ip': u'10.1.11.1/24', u'tenant_ns_if': u't2ns1if', u'tenant_sub_if': u't2s1if', u'tenant_ns_name': u't2'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.1.11.2', u'dsport': 4789, u'dev': u't2s1if', u'tenant_route_ip': u'192.168.2.2', u'remote_route': u'10.2.11.0/24', u'subnet_route': u'10.1.11.0/24', u'v_name': u'vxlan_t2s1', u'id': 42, u'remote_ip': u'10.2.11.2'}]}, {u'mem': 4, u'name': u't2_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't2br1if2', u'vmif': u't2VM2if1'}]) => {"ansible_loop_var": "item", "changed": false, "create": 0, "item": [{"bridge_name": "t2br1", "default_route_ip": "10.1.11.1", "dns": [{"brif": "t2s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t2s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns1", "route": [{"if": "p1", "ip": "10.1.11.1/24", "ns_if": "t2if", "ns_name": "t2"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t2ns1if", "tenant_ns_ip": "10.1.11.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s1if", "tenant_sub_ip": "10.1.11.2/24"}], "vxlan": [{"dev": "t2s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.11.2", "remote_ip": "10.2.11.2", "remote_route": "10.2.11.0/24", "subnet_route": "10.1.11.0/24", "tenant_route_ip": "192.168.2.2", "v_name": "vxlan_t2s1"}]}, {"brif": "t2br1if2", "disk": "10G", "mem": 4, "name": "t2_VM2", "vcpu": 2, "vmif": "t2VM2if1"}]}
ok: [localhost] => (item=[{u'route': [{u'ip': u'10.1.12.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.1.12.1', u'bridge_name': u't2br2', u'dns': [{u'dnsif': u't2s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't2s2_dnsbrif'}], u'ns_name': u't2ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.12.2/24', u'tenant_ns_ip': u'10.1.12.1/24', u'tenant_ns_if': u't2ns2if', u'tenant_sub_if': u't2s2if', u'tenant_ns_name': u't2'}], u'subnet_ip': u'2.2.2.0/24', u'vxlan': [{u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}, {u'mem': 3, u'name': u't2_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't2br2if1', u'vmif': u't2VM3if1'}]) => {"ansible_loop_var": "item", "changed": false, "create": 0, "item": [{"bridge_name": "t2br2", "default_route_ip": "10.1.12.1", "dns": [{"brif": "t2s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t2s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns2", "route": [{"if": "p1", "ip": "10.1.12.1/24", "ns_if": "t2if", "ns_name": "t2"}], "subnet_ip": "2.2.2.0/24", "tenant_ns": [{"tenant_ns_if": "t2ns2if", "tenant_ns_ip": "10.1.12.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s2if", "tenant_sub_ip": "10.1.12.2/24"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, {"brif": "t2br2if1", "disk": "10G", "mem": 3, "name": "t2_VM3", "vcpu": 2, "vmif": "t2VM3if1"}]}

TASK [Start VM] *********************************************************************************************************************************************
ok: [localhost] => (item=[{u'route': [{u'ip': u'10.1.11.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.1.11.1', u'bridge_name': u't2br1', u'dns': [{u'dnsif': u't2s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't2s1_dnsbrif'}], u'ns_name': u't2ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.11.2/24', u'tenant_ns_ip': u'10.1.11.1/24', u'tenant_ns_if': u't2ns1if', u'tenant_sub_if': u't2s1if', u'tenant_ns_name': u't2'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.1.11.2', u'dsport': 4789, u'dev': u't2s1if', u'tenant_route_ip': u'192.168.2.2', u'remote_route': u'10.2.11.0/24', u'subnet_route': u'10.1.11.0/24', u'v_name': u'vxlan_t2s1', u'id': 42, u'remote_ip': u'10.2.11.2'}]}, {u'mem': 2, u'name': u't2_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't2br1if1', u'vmif': u't2VM1if1'}]) => {"ansible_loop_var": "item", "changed": false, "item": [{"bridge_name": "t2br1", "default_route_ip": "10.1.11.1", "dns": [{"brif": "t2s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t2s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns1", "route": [{"if": "p1", "ip": "10.1.11.1/24", "ns_if": "t2if", "ns_name": "t2"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t2ns1if", "tenant_ns_ip": "10.1.11.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s1if", "tenant_sub_ip": "10.1.11.2/24"}], "vxlan": [{"dev": "t2s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.11.2", "remote_ip": "10.2.11.2", "remote_route": "10.2.11.0/24", "subnet_route": "10.1.11.0/24", "tenant_route_ip": "192.168.2.2", "v_name": "vxlan_t2s1"}]}, {"brif": "t2br1if1", "disk": "10G", "mem": 2, "name": "t2_VM1", "vcpu": 4, "vmif": "t2VM1if1"}]}
ok: [localhost] => (item=[{u'route': [{u'ip': u'10.1.11.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.1.11.1', u'bridge_name': u't2br1', u'dns': [{u'dnsif': u't2s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't2s1_dnsbrif'}], u'ns_name': u't2ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.11.2/24', u'tenant_ns_ip': u'10.1.11.1/24', u'tenant_ns_if': u't2ns1if', u'tenant_sub_if': u't2s1if', u'tenant_ns_name': u't2'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.1.11.2', u'dsport': 4789, u'dev': u't2s1if', u'tenant_route_ip': u'192.168.2.2', u'remote_route': u'10.2.11.0/24', u'subnet_route': u'10.1.11.0/24', u'v_name': u'vxlan_t2s1', u'id': 42, u'remote_ip': u'10.2.11.2'}]}, {u'mem': 4, u'name': u't2_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't2br1if2', u'vmif': u't2VM2if1'}]) => {"ansible_loop_var": "item", "changed": false, "item": [{"bridge_name": "t2br1", "default_route_ip": "10.1.11.1", "dns": [{"brif": "t2s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t2s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns1", "route": [{"if": "p1", "ip": "10.1.11.1/24", "ns_if": "t2if", "ns_name": "t2"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t2ns1if", "tenant_ns_ip": "10.1.11.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s1if", "tenant_sub_ip": "10.1.11.2/24"}], "vxlan": [{"dev": "t2s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.11.2", "remote_ip": "10.2.11.2", "remote_route": "10.2.11.0/24", "subnet_route": "10.1.11.0/24", "tenant_route_ip": "192.168.2.2", "v_name": "vxlan_t2s1"}]}, {"brif": "t2br1if2", "disk": "10G", "mem": 4, "name": "t2_VM2", "vcpu": 2, "vmif": "t2VM2if1"}]}
ok: [localhost] => (item=[{u'route': [{u'ip': u'10.1.12.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.1.12.1', u'bridge_name': u't2br2', u'dns': [{u'dnsif': u't2s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't2s2_dnsbrif'}], u'ns_name': u't2ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.12.2/24', u'tenant_ns_ip': u'10.1.12.1/24', u'tenant_ns_if': u't2ns2if', u'tenant_sub_if': u't2s2if', u'tenant_ns_name': u't2'}], u'subnet_ip': u'2.2.2.0/24', u'vxlan': [{u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}, {u'mem': 3, u'name': u't2_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't2br2if1', u'vmif': u't2VM3if1'}]) => {"ansible_loop_var": "item", "changed": false, "item": [{"bridge_name": "t2br2", "default_route_ip": "10.1.12.1", "dns": [{"brif": "t2s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t2s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns2", "route": [{"if": "p1", "ip": "10.1.12.1/24", "ns_if": "t2if", "ns_name": "t2"}], "subnet_ip": "2.2.2.0/24", "tenant_ns": [{"tenant_ns_if": "t2ns2if", "tenant_ns_ip": "10.1.12.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s2if", "tenant_sub_ip": "10.1.12.2/24"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, {"brif": "t2br2if1", "disk": "10G", "mem": 3, "name": "t2_VM3", "vcpu": 2, "vmif": "t2VM3if1"}]}

TASK [Attach VM interface] **********************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.11.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.1.11.1', u'bridge_name': u't2br1', u'dns': [{u'dnsif': u't2s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't2s1_dnsbrif'}], u'ns_name': u't2ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.11.2/24', u'tenant_ns_ip': u'10.1.11.1/24', u'tenant_ns_if': u't2ns1if', u'tenant_sub_if': u't2s1if', u'tenant_ns_name': u't2'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.1.11.2', u'dsport': 4789, u'dev': u't2s1if', u'tenant_route_ip': u'192.168.2.2', u'remote_route': u'10.2.11.0/24', u'subnet_route': u'10.1.11.0/24', u'v_name': u'vxlan_t2s1', u'id': 42, u'remote_ip': u'10.2.11.2'}]}, {u'mem': 2, u'name': u't2_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't2br1if1', u'vmif': u't2VM1if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "virsh domiflist \"t2_VM1\" | grep -w 't2VM1if1' ; if [ $? -ne 0 ] ; then virsh attach-interface \"t2_VM1\" direct \"t2VM1if1\" --live --persistent ; fi\n", "delta": "0:00:00.279785", "end": "2019-11-18 00:25:25.917564", "item": [{"bridge_name": "t2br1", "default_route_ip": "10.1.11.1", "dns": [{"brif": "t2s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t2s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns1", "route": [{"if": "p1", "ip": "10.1.11.1/24", "ns_if": "t2if", "ns_name": "t2"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t2ns1if", "tenant_ns_ip": "10.1.11.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s1if", "tenant_sub_ip": "10.1.11.2/24"}], "vxlan": [{"dev": "t2s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.11.2", "remote_ip": "10.2.11.2", "remote_route": "10.2.11.0/24", "subnet_route": "10.1.11.0/24", "tenant_route_ip": "192.168.2.2", "v_name": "vxlan_t2s1"}]}, {"brif": "t2br1if1", "disk": "10G", "mem": 2, "name": "t2_VM1", "vcpu": 4, "vmif": "t2VM1if1"}], "rc": 0, "start": "2019-11-18 00:25:25.637779", "stderr": "", "stderr_lines": [], "stdout": "Interface attached successfully", "stdout_lines": ["Interface attached successfully"]}
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.11.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.1.11.1', u'bridge_name': u't2br1', u'dns': [{u'dnsif': u't2s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't2s1_dnsbrif'}], u'ns_name': u't2ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.11.2/24', u'tenant_ns_ip': u'10.1.11.1/24', u'tenant_ns_if': u't2ns1if', u'tenant_sub_if': u't2s1if', u'tenant_ns_name': u't2'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.1.11.2', u'dsport': 4789, u'dev': u't2s1if', u'tenant_route_ip': u'192.168.2.2', u'remote_route': u'10.2.11.0/24', u'subnet_route': u'10.1.11.0/24', u'v_name': u'vxlan_t2s1', u'id': 42, u'remote_ip': u'10.2.11.2'}]}, {u'mem': 4, u'name': u't2_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't2br1if2', u'vmif': u't2VM2if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "virsh domiflist \"t2_VM2\" | grep -w 't2VM2if1' ; if [ $? -ne 0 ] ; then virsh attach-interface \"t2_VM2\" direct \"t2VM2if1\" --live --persistent ; fi\n", "delta": "0:00:00.440789", "end": "2019-11-18 00:25:26.617495", "item": [{"bridge_name": "t2br1", "default_route_ip": "10.1.11.1", "dns": [{"brif": "t2s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t2s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns1", "route": [{"if": "p1", "ip": "10.1.11.1/24", "ns_if": "t2if", "ns_name": "t2"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t2ns1if", "tenant_ns_ip": "10.1.11.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s1if", "tenant_sub_ip": "10.1.11.2/24"}], "vxlan": [{"dev": "t2s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.11.2", "remote_ip": "10.2.11.2", "remote_route": "10.2.11.0/24", "subnet_route": "10.1.11.0/24", "tenant_route_ip": "192.168.2.2", "v_name": "vxlan_t2s1"}]}, {"brif": "t2br1if2", "disk": "10G", "mem": 4, "name": "t2_VM2", "vcpu": 2, "vmif": "t2VM2if1"}], "rc": 0, "start": "2019-11-18 00:25:26.176706", "stderr": "", "stderr_lines": [], "stdout": "Interface attached successfully", "stdout_lines": ["Interface attached successfully"]}
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.12.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.1.12.1', u'bridge_name': u't2br2', u'dns': [{u'dnsif': u't2s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't2s2_dnsbrif'}], u'ns_name': u't2ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.12.2/24', u'tenant_ns_ip': u'10.1.12.1/24', u'tenant_ns_if': u't2ns2if', u'tenant_sub_if': u't2s2if', u'tenant_ns_name': u't2'}], u'subnet_ip': u'2.2.2.0/24', u'vxlan': [{u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}, {u'mem': 3, u'name': u't2_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't2br2if1', u'vmif': u't2VM3if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "virsh domiflist \"t2_VM3\" | grep -w 't2VM3if1' ; if [ $? -ne 0 ] ; then virsh attach-interface \"t2_VM3\" direct \"t2VM3if1\" --live --persistent ; fi\n", "delta": "0:00:00.474436", "end": "2019-11-18 00:25:27.421407", "item": [{"bridge_name": "t2br2", "default_route_ip": "10.1.12.1", "dns": [{"brif": "t2s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t2s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns2", "route": [{"if": "p1", "ip": "10.1.12.1/24", "ns_if": "t2if", "ns_name": "t2"}], "subnet_ip": "2.2.2.0/24", "tenant_ns": [{"tenant_ns_if": "t2ns2if", "tenant_ns_ip": "10.1.12.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s2if", "tenant_sub_ip": "10.1.12.2/24"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, {"brif": "t2br2if1", "disk": "10G", "mem": 3, "name": "t2_VM3", "vcpu": 2, "vmif": "t2VM3if1"}], "rc": 0, "start": "2019-11-18 00:25:26.946971", "stderr": "", "stderr_lines": [], "stdout": "Interface attached successfully", "stdout_lines": ["Interface attached successfully"]}

PLAY RECAP **************************************************************************************************************************************************
localhost                  : ok=7    changed=2    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0   

Using /etc/ansible/ansible.cfg as config file

PLAY [worker] ***********************************************************************************************************************************************

TASK [Copy VM image] ****************************************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.11.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.2.11.1', u'bridge_name': u't2br1', u'dns': [{u'dnsif': u't2s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't2s1_dnsbrif'}], u'ns_name': u't2ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.11.2/24', u'tenant_ns_ip': u'10.2.11.1/24', u'tenant_ns_if': u't2ns1if', u'tenant_sub_if': u't2s1if', u'tenant_ns_name': u't2'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.2.11.2', u'dsport': 4789, u'dev': u't2s1if', u'tenant_route_ip': u'192.168.130.2', u'remote_route': u'10.1.11.0/24', u'subnet_route': u'10.2.11.0/24', u'v_name': u'vxlan_t2s1', u'id': 42, u'remote_ip': u'10.1.11.2'}]}, {u'mem': 2, u'name': u't2_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't2br1if1', u'vmif': u't2VM4if1'}]) => {"ansible_loop_var": "item", "changed": true, "checksum": "f8b2ffa2bf201c84196c582f2dec0d33a1eb4b42", "dest": "/var/lib/libvirt/images/t2_VM4.qcow2", "gid": 0, "group": "root", "item": [{"bridge_name": "t2br1", "default_route_ip": "10.2.11.1", "dns": [{"brif": "t2s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t2s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns1", "route": [{"if": "p1", "ip": "10.2.11.1/24", "ns_if": "t2if", "ns_name": "t2"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t2ns1if", "tenant_ns_ip": "10.2.11.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s1if", "tenant_sub_ip": "10.2.11.2/24"}], "vxlan": [{"dev": "t2s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.11.2", "remote_ip": "10.1.11.2", "remote_route": "10.1.11.0/24", "subnet_route": "10.2.11.0/24", "tenant_route_ip": "192.168.130.2", "v_name": "vxlan_t2s1"}]}, {"brif": "t2br1if1", "disk": "10G", "mem": 2, "name": "t2_VM4", "vcpu": 4, "vmif": "t2VM4if1"}], "md5sum": "e6d5d524b68797ddd748ba1475985d34", "mode": "0644", "owner": "root", "size": 10739318784, "src": "/root/mainVM.qcow2", "state": "file", "uid": 0}

TASK [Get list of running VMs] ******************************************************************************************************************************
ok: [99.99.99.2] => {"changed": false, "cmd": ["virsh", "list", "--name"], "delta": "0:00:00.022856", "end": "2019-11-18 00:26:43.404397", "rc": 0, "start": "2019-11-18 00:26:43.381541", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Define VM] ********************************************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.11.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.2.11.1', u'bridge_name': u't2br1', u'dns': [{u'dnsif': u't2s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't2s1_dnsbrif'}], u'ns_name': u't2ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.11.2/24', u'tenant_ns_ip': u'10.2.11.1/24', u'tenant_ns_if': u't2ns1if', u'tenant_sub_if': u't2s1if', u'tenant_ns_name': u't2'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.2.11.2', u'dsport': 4789, u'dev': u't2s1if', u'tenant_route_ip': u'192.168.130.2', u'remote_route': u'10.1.11.0/24', u'subnet_route': u'10.2.11.0/24', u'v_name': u'vxlan_t2s1', u'id': 42, u'remote_ip': u'10.1.11.2'}]}, {u'mem': 2, u'name': u't2_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't2br1if1', u'vmif': u't2VM4if1'}]) => {"ansible_loop_var": "item", "changed": true, "created": "t2_VM4", "item": [{"bridge_name": "t2br1", "default_route_ip": "10.2.11.1", "dns": [{"brif": "t2s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t2s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns1", "route": [{"if": "p1", "ip": "10.2.11.1/24", "ns_if": "t2if", "ns_name": "t2"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t2ns1if", "tenant_ns_ip": "10.2.11.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s1if", "tenant_sub_ip": "10.2.11.2/24"}], "vxlan": [{"dev": "t2s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.11.2", "remote_ip": "10.1.11.2", "remote_route": "10.1.11.0/24", "subnet_route": "10.2.11.0/24", "tenant_route_ip": "192.168.130.2", "v_name": "vxlan_t2s1"}]}, {"brif": "t2br1if1", "disk": "10G", "mem": 2, "name": "t2_VM4", "vcpu": 4, "vmif": "t2VM4if1"}], "warnings": ["'xml' is given - ignoring 'name'"]}

TASK [Create VM] ********************************************************************************************************************************************
ok: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.11.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.2.11.1', u'bridge_name': u't2br1', u'dns': [{u'dnsif': u't2s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't2s1_dnsbrif'}], u'ns_name': u't2ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.11.2/24', u'tenant_ns_ip': u'10.2.11.1/24', u'tenant_ns_if': u't2ns1if', u'tenant_sub_if': u't2s1if', u'tenant_ns_name': u't2'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.2.11.2', u'dsport': 4789, u'dev': u't2s1if', u'tenant_route_ip': u'192.168.130.2', u'remote_route': u'10.1.11.0/24', u'subnet_route': u'10.2.11.0/24', u'v_name': u'vxlan_t2s1', u'id': 42, u'remote_ip': u'10.1.11.2'}]}, {u'mem': 2, u'name': u't2_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't2br1if1', u'vmif': u't2VM4if1'}]) => {"ansible_loop_var": "item", "changed": false, "create": 0, "item": [{"bridge_name": "t2br1", "default_route_ip": "10.2.11.1", "dns": [{"brif": "t2s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t2s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns1", "route": [{"if": "p1", "ip": "10.2.11.1/24", "ns_if": "t2if", "ns_name": "t2"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t2ns1if", "tenant_ns_ip": "10.2.11.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s1if", "tenant_sub_ip": "10.2.11.2/24"}], "vxlan": [{"dev": "t2s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.11.2", "remote_ip": "10.1.11.2", "remote_route": "10.1.11.0/24", "subnet_route": "10.2.11.0/24", "tenant_route_ip": "192.168.130.2", "v_name": "vxlan_t2s1"}]}, {"brif": "t2br1if1", "disk": "10G", "mem": 2, "name": "t2_VM4", "vcpu": 4, "vmif": "t2VM4if1"}]}

TASK [Start VM] *********************************************************************************************************************************************
ok: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.11.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.2.11.1', u'bridge_name': u't2br1', u'dns': [{u'dnsif': u't2s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't2s1_dnsbrif'}], u'ns_name': u't2ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.11.2/24', u'tenant_ns_ip': u'10.2.11.1/24', u'tenant_ns_if': u't2ns1if', u'tenant_sub_if': u't2s1if', u'tenant_ns_name': u't2'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.2.11.2', u'dsport': 4789, u'dev': u't2s1if', u'tenant_route_ip': u'192.168.130.2', u'remote_route': u'10.1.11.0/24', u'subnet_route': u'10.2.11.0/24', u'v_name': u'vxlan_t2s1', u'id': 42, u'remote_ip': u'10.1.11.2'}]}, {u'mem': 2, u'name': u't2_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't2br1if1', u'vmif': u't2VM4if1'}]) => {"ansible_loop_var": "item", "changed": false, "item": [{"bridge_name": "t2br1", "default_route_ip": "10.2.11.1", "dns": [{"brif": "t2s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t2s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns1", "route": [{"if": "p1", "ip": "10.2.11.1/24", "ns_if": "t2if", "ns_name": "t2"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t2ns1if", "tenant_ns_ip": "10.2.11.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s1if", "tenant_sub_ip": "10.2.11.2/24"}], "vxlan": [{"dev": "t2s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.11.2", "remote_ip": "10.1.11.2", "remote_route": "10.1.11.0/24", "subnet_route": "10.2.11.0/24", "tenant_route_ip": "192.168.130.2", "v_name": "vxlan_t2s1"}]}, {"brif": "t2br1if1", "disk": "10G", "mem": 2, "name": "t2_VM4", "vcpu": 4, "vmif": "t2VM4if1"}]}

TASK [Attach VM interface] **********************************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.11.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.2.11.1', u'bridge_name': u't2br1', u'dns': [{u'dnsif': u't2s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't2s1_dnsbrif'}], u'ns_name': u't2ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.11.2/24', u'tenant_ns_ip': u'10.2.11.1/24', u'tenant_ns_if': u't2ns1if', u'tenant_sub_if': u't2s1if', u'tenant_ns_name': u't2'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.2.11.2', u'dsport': 4789, u'dev': u't2s1if', u'tenant_route_ip': u'192.168.130.2', u'remote_route': u'10.1.11.0/24', u'subnet_route': u'10.2.11.0/24', u'v_name': u'vxlan_t2s1', u'id': 42, u'remote_ip': u'10.1.11.2'}]}, {u'mem': 2, u'name': u't2_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't2br1if1', u'vmif': u't2VM4if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "virsh domiflist \"t2_VM4\" | grep -w 't2VM4if1' ; if [ $? -ne 0 ] ; then virsh attach-interface \"t2_VM4\" direct \"t2VM4if1\" --live --persistent ; fi\n", "delta": "0:00:00.255081", "end": "2019-11-18 00:27:27.696048", "item": [{"bridge_name": "t2br1", "default_route_ip": "10.2.11.1", "dns": [{"brif": "t2s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t2s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns1", "route": [{"if": "p1", "ip": "10.2.11.1/24", "ns_if": "t2if", "ns_name": "t2"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t2ns1if", "tenant_ns_ip": "10.2.11.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s1if", "tenant_sub_ip": "10.2.11.2/24"}], "vxlan": [{"dev": "t2s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.11.2", "remote_ip": "10.1.11.2", "remote_route": "10.1.11.0/24", "subnet_route": "10.2.11.0/24", "tenant_route_ip": "192.168.130.2", "v_name": "vxlan_t2s1"}]}, {"brif": "t2br1if1", "disk": "10G", "mem": 2, "name": "t2_VM4", "vcpu": 4, "vmif": "t2VM4if1"}], "rc": 0, "start": "2019-11-18 00:27:27.440967", "stderr": "", "stderr_lines": [], "stdout": "Interface attached successfully", "stdout_lines": ["Interface attached successfully"]}

PLAY RECAP **************************************************************************************************************************************************
99.99.99.2                 : ok=6    changed=3    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0   

INFO:root: 00:41:52.235088 Unable to open user input yaml file
Using /etc/ansible/ansible.cfg as config file
Using /etc/ansible/ansible.cfg as config file
Using /etc/ansible/ansible.cfg as config file
Using /etc/ansible/ansible.cfg as config file
Using /etc/ansible/ansible.cfg as config file
Using /etc/ansible/ansible.cfg as config file
Using /etc/ansible/ansible.cfg as config file
Using /etc/ansible/ansible.cfg as config file
Using /etc/ansible/ansible.cfg as config file
Using /etc/ansible/ansible.cfg as config file
Using /etc/ansible/ansible.cfg as config file
Using /etc/ansible/ansible.cfg as config file
Using /etc/ansible/ansible.cfg as config file
Using /etc/ansible/ansible.cfg as config file
Using /etc/ansible/ansible.cfg as config file
Using /etc/ansible/ansible.cfg as config file
INFO:root: 00:42:02.403346 Unable to open user input yaml file
Using /etc/ansible/ansible.cfg as config file
Using /etc/ansible/ansible.cfg as config file
Using /etc/ansible/ansible.cfg as config file
Using /etc/ansible/ansible.cfg as config file
Using /etc/ansible/ansible.cfg as config file
Using /etc/ansible/ansible.cfg as config file
Using /etc/ansible/ansible.cfg as config file
Using /etc/ansible/ansible.cfg as config file
INFO:root: 01:11:00.621811 Printing the yaml input file
INFO:root: 01:11:00.622208 {'C1': [{'subnet_addr': '1.1.1.0/24', 'VM': [{'name': 'VM1', 'disk': '10G', 'mem': 2, 'vcpu': 4}, {'name': 'VM2', 'disk': '10G', 'mem': 4, 'vcpu': 2}]}, {'subnet_addr': '2.2.2.0/24', 'VM': [{'name': 'VM3', 'disk': '10G', 'mem': 3, 'vcpu': 2}]}], 'C2': [{'subnet_addr': '1.1.1.0/24', 'VM': [{'name': 'VM4', 'disk': '10G', 'mem': 2, 'vcpu': 4}]}]}
INFO:root: 01:11:00.622343 Provided subnet in C1: 1.1.1.0/24 is valid
INFO:root: 01:11:00.622396 Provided subnet in C1: 2.2.2.0/24 is valid
INFO:root: 01:11:00.622441 Provided subnet in C2: 1.1.1.0/24 is valid
INFO:root: 01:12:23.267810 Printing the yaml input file
INFO:root: 01:12:23.267952 {'C1': [{'subnet_addr': '1.1.1.0/24', 'VM': [{'name': 'VM1', 'disk': '10G', 'mem': 2, 'vcpu': 4}, {'name': 'VM2', 'disk': '10G', 'mem': 4, 'vcpu': 2}]}, {'subnet_addr': '2.2.2.0/24', 'VM': [{'name': 'VM3', 'disk': '10G', 'mem': 3, 'vcpu': 2}]}], 'C2': [{'subnet_addr': '1.1.1.0/24', 'VM': [{'name': 'VM4', 'disk': '10G', 'mem': 2, 'vcpu': 4}]}]}
INFO:root: 01:12:23.268051 Provided subnet in C1: 1.1.1.0/24 is valid
INFO:root: 01:12:23.268097 Provided subnet in C1: 2.2.2.0/24 is valid
INFO:root: 01:12:23.268137 Provided subnet in C2: 1.1.1.0/24 is valid
Using /etc/ansible/ansible.cfg as config file

PLAY [main] *************************************************************************************************************************************************

TASK [Create Tenant Namespace] ******************************************************************************************************************************
changed: [localhost] => (item={u'default_route_ip': u'192.168.4.1', u'name': u't4', u'pns_ip': u'192.168.4.1/24', u'tenant_if': u't4if', u'tenant_ip': u'192.168.4.2/24', u'pns_if': u't4pns_if'}) => {"ansible_loop_var": "item", "changed": true, "cmd": ["ip", "netns", "add", "t4"], "delta": "0:00:00.059058", "end": "2019-11-18 01:12:24.447238", "item": {"default_route_ip": "192.168.4.1", "name": "t4", "pns_if": "t4pns_if", "pns_ip": "192.168.4.1/24", "tenant_if": "t4if", "tenant_ip": "192.168.4.2/24"}, "rc": 0, "start": "2019-11-18 01:12:24.388180", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Create Subnet Namespace] ******************************************************************************************************************************
changed: [localhost] => (item={u'route': [{u'ip': u'10.1.31.1/24', u'ns_name': u't4', u'ns_if': u't4if', u'if': u'p1'}], u'default_route_ip': u'10.1.31.1', u'bridge_name': u't4br1', u'dns': [{u'dnsif': u't4s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't4s1_dnsbrif'}], u'ns_name': u't4ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.31.2/24', u'tenant_ns_ip': u'10.1.31.1/24', u'tenant_ns_if': u't4ns1if', u'tenant_ns_name': u't4', u'tenant_sub_if': u't4s1if'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't4_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't4br1if1', u'vmif': u't4VM1if1'}, {u'mem': 4, u'name': u't4_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't4br1if2', u'vmif': u't4VM2if1'}], u'vxlan': [{u'local_ip': u'10.1.31.2', u'tenant_route_ip': u'192.168.4.2', u'dsport': 4789, u'dev': u't4s1if', u'subnet_route': u'10.1.31.0/24', u'remote_route': u'10.2.31.0/24', u'v_name': u'vxlan_t4s1', u'id': 42, u'remote_ip': u'10.2.31.2'}]}) => {"ansible_loop_var": "item", "changed": true, "cmd": ["ip", "netns", "add", "t4ns1"], "delta": "0:00:00.064698", "end": "2019-11-18 01:12:24.794227", "item": {"bridge_name": "t4br1", "default_route_ip": "10.1.31.1", "dns": [{"brif": "t4s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t4s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t4ns1", "route": [{"if": "p1", "ip": "10.1.31.1/24", "ns_if": "t4if", "ns_name": "t4"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t4ns1if", "tenant_ns_ip": "10.1.31.1/24", "tenant_ns_name": "t4", "tenant_sub_if": "t4s1if", "tenant_sub_ip": "10.1.31.2/24"}], "vms": [{"brif": "t4br1if1", "disk": "10G", "mem": 2, "name": "t4_VM1", "vcpu": 4, "vmif": "t4VM1if1"}, {"brif": "t4br1if2", "disk": "10G", "mem": 4, "name": "t4_VM2", "vcpu": 2, "vmif": "t4VM2if1"}], "vxlan": [{"dev": "t4s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.31.2", "remote_ip": "10.2.31.2", "remote_route": "10.2.31.0/24", "subnet_route": "10.1.31.0/24", "tenant_route_ip": "192.168.4.2", "v_name": "vxlan_t4s1"}]}, "rc": 0, "start": "2019-11-18 01:12:24.729529", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}
changed: [localhost] => (item={u'route': [{u'ip': u'10.1.32.1/24', u'ns_name': u't4', u'ns_if': u't4if', u'if': u'p1'}], u'default_route_ip': u'10.1.32.1', u'bridge_name': u't4br2', u'dns': [{u'dnsif': u't4s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't4s2_dnsbrif'}], u'ns_name': u't4ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.32.2/24', u'tenant_ns_ip': u'10.1.32.1/24', u'tenant_ns_if': u't4ns2if', u'tenant_ns_name': u't4', u'tenant_sub_if': u't4s2if'}], u'subnet_ip': u'2.2.2.0/24', u'vms': [{u'mem': 3, u'name': u't4_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't4br2if1', u'vmif': u't4VM3if1'}], u'vxlan': [{u'local_ip': [], u'tenant_route_ip': [], u'dsport': [], u'dev': [], u'subnet_route': [], u'remote_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}) => {"ansible_loop_var": "item", "changed": true, "cmd": ["ip", "netns", "add", "t4ns2"], "delta": "0:00:00.056288", "end": "2019-11-18 01:12:25.062128", "item": {"bridge_name": "t4br2", "default_route_ip": "10.1.32.1", "dns": [{"brif": "t4s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t4s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t4ns2", "route": [{"if": "p1", "ip": "10.1.32.1/24", "ns_if": "t4if", "ns_name": "t4"}], "subnet_ip": "2.2.2.0/24", "tenant_ns": [{"tenant_ns_if": "t4ns2if", "tenant_ns_ip": "10.1.32.1/24", "tenant_ns_name": "t4", "tenant_sub_if": "t4s2if", "tenant_sub_ip": "10.1.32.2/24"}], "vms": [{"brif": "t4br2if1", "disk": "10G", "mem": 3, "name": "t4_VM3", "vcpu": 2, "vmif": "t4VM3if1"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, "rc": 0, "start": "2019-11-18 01:12:25.005840", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Create Tenant VETH pairs] *****************************************************************************************************************************
changed: [localhost] => (item={u'default_route_ip': u'192.168.4.1', u'name': u't4', u'pns_ip': u'192.168.4.1/24', u'tenant_if': u't4if', u'tenant_ip': u'192.168.4.2/24', u'pns_if': u't4pns_if'}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip link show \"t4if\" ; if [ $? -ne 0 ] ; then ip link add \"t4if\" type veth peer name \"t4pns_if\" ; fi\n", "delta": "0:00:00.009990", "end": "2019-11-18 01:12:25.329853", "item": {"default_route_ip": "192.168.4.1", "name": "t4", "pns_if": "t4pns_if", "pns_ip": "192.168.4.1/24", "tenant_if": "t4if", "tenant_ip": "192.168.4.2/24"}, "rc": 0, "start": "2019-11-18 01:12:25.319863", "stderr": "Device \"t4if\" does not exist.", "stderr_lines": ["Device \"t4if\" does not exist."], "stdout": "", "stdout_lines": []}

TASK [Attach Tenant VETH Pairs] *****************************************************************************************************************************
changed: [localhost] => (item={u'default_route_ip': u'192.168.4.1', u'name': u't4', u'pns_ip': u'192.168.4.1/24', u'tenant_if': u't4if', u'tenant_ip': u'192.168.4.2/24', u'pns_if': u't4pns_if'}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec pns ip link show \"t4pns_if\" ; if [ $? -ne 0 ] ; then ip link set \"t4pns_if\" netns pns ; fi\nip netns exec \"t4\" ip link show \"t4if\" ; if [ $? -ne 0 ] ; then ip link set \"t4if\" netns \"t4\" ; fi\nip netns exec pns ip link set dev \"t4pns_if\" up\nip netns exec \"t4\" ip link set dev \"t4if\" up\n", "delta": "0:00:00.206879", "end": "2019-11-18 01:12:25.797672", "item": {"default_route_ip": "192.168.4.1", "name": "t4", "pns_if": "t4pns_if", "pns_ip": "192.168.4.1/24", "tenant_if": "t4if", "tenant_ip": "192.168.4.2/24"}, "rc": 0, "start": "2019-11-18 01:12:25.590793", "stderr": "Device \"t4pns_if\" does not exist.\nDevice \"t4if\" does not exist.", "stderr_lines": ["Device \"t4pns_if\" does not exist.", "Device \"t4if\" does not exist."], "stdout": "", "stdout_lines": []}

TASK [Add IP addresses to Tenant VETH Pairs] ****************************************************************************************************************
changed: [localhost] => (item={u'default_route_ip': u'192.168.4.1', u'name': u't4', u'pns_ip': u'192.168.4.1/24', u'tenant_if': u't4if', u'tenant_ip': u'192.168.4.2/24', u'pns_if': u't4pns_if'}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec pns ip addr show \"t4pns_if\" | awk 'FNR==3{ print $2 }' | grep -w '^192.168.4.1/24' ; if [ $? -ne 0 ] ; then ip netns exec pns ip addr add \"192.168.4.1/24\" dev \"t4pns_if\" ; fi\nip netns exec \"t4\" ip addr show \"t4if\" | awk 'FNR==3{ print $2 }' | grep -w '^192.168.4.2/24' ; if [ $? -ne 0 ] ; then ip netns exec \"t4\" ip addr add \"192.168.4.2/24\" dev \"t4if\" ; fi\n", "delta": "0:00:00.148394", "end": "2019-11-18 01:12:26.218062", "item": {"default_route_ip": "192.168.4.1", "name": "t4", "pns_if": "t4pns_if", "pns_ip": "192.168.4.1/24", "tenant_if": "t4if", "tenant_ip": "192.168.4.2/24"}, "rc": 0, "start": "2019-11-18 01:12:26.069668", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Create Namespace VETH Pairs] **************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.31.1/24', u'ns_name': u't4', u'ns_if': u't4if', u'if': u'p1'}], u'default_route_ip': u'10.1.31.1', u'bridge_name': u't4br1', u'dns': [{u'dnsif': u't4s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't4s1_dnsbrif'}], u'ns_name': u't4ns1', u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't4_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't4br1if1', u'vmif': u't4VM1if1'}, {u'mem': 4, u'name': u't4_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't4br1if2', u'vmif': u't4VM2if1'}], u'vxlan': [{u'local_ip': u'10.1.31.2', u'dsport': 4789, u'dev': u't4s1if', u'tenant_route_ip': u'192.168.4.2', u'remote_route': u'10.2.31.0/24', u'subnet_route': u'10.1.31.0/24', u'v_name': u'vxlan_t4s1', u'id': 42, u'remote_ip': u'10.2.31.2'}]}, {u'tenant_sub_ip': u'10.1.31.2/24', u'tenant_ns_ip': u'10.1.31.1/24', u'tenant_ns_if': u't4ns1if', u'tenant_sub_if': u't4s1if', u'tenant_ns_name': u't4'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip link show \"t4ns1if\" ; if [ $? -ne 0 ] ; then ip link add \"t4ns1if\" type veth peer name \"t4s1if\" ; fi\n", "delta": "0:00:00.012882", "end": "2019-11-18 01:12:26.506250", "item": [{"bridge_name": "t4br1", "default_route_ip": "10.1.31.1", "dns": [{"brif": "t4s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t4s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t4ns1", "route": [{"if": "p1", "ip": "10.1.31.1/24", "ns_if": "t4if", "ns_name": "t4"}], "subnet_ip": "1.1.1.0/24", "vms": [{"brif": "t4br1if1", "disk": "10G", "mem": 2, "name": "t4_VM1", "vcpu": 4, "vmif": "t4VM1if1"}, {"brif": "t4br1if2", "disk": "10G", "mem": 4, "name": "t4_VM2", "vcpu": 2, "vmif": "t4VM2if1"}], "vxlan": [{"dev": "t4s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.31.2", "remote_ip": "10.2.31.2", "remote_route": "10.2.31.0/24", "subnet_route": "10.1.31.0/24", "tenant_route_ip": "192.168.4.2", "v_name": "vxlan_t4s1"}]}, {"tenant_ns_if": "t4ns1if", "tenant_ns_ip": "10.1.31.1/24", "tenant_ns_name": "t4", "tenant_sub_if": "t4s1if", "tenant_sub_ip": "10.1.31.2/24"}], "rc": 0, "start": "2019-11-18 01:12:26.493368", "stderr": "Device \"t4ns1if\" does not exist.", "stderr_lines": ["Device \"t4ns1if\" does not exist."], "stdout": "", "stdout_lines": []}
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.32.1/24', u'ns_name': u't4', u'ns_if': u't4if', u'if': u'p1'}], u'default_route_ip': u'10.1.32.1', u'bridge_name': u't4br2', u'dns': [{u'dnsif': u't4s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't4s2_dnsbrif'}], u'ns_name': u't4ns2', u'subnet_ip': u'2.2.2.0/24', u'vms': [{u'mem': 3, u'name': u't4_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't4br2if1', u'vmif': u't4VM3if1'}], u'vxlan': [{u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}, {u'tenant_sub_ip': u'10.1.32.2/24', u'tenant_ns_ip': u'10.1.32.1/24', u'tenant_ns_if': u't4ns2if', u'tenant_sub_if': u't4s2if', u'tenant_ns_name': u't4'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip link show \"t4ns2if\" ; if [ $? -ne 0 ] ; then ip link add \"t4ns2if\" type veth peer name \"t4s2if\" ; fi\n", "delta": "0:00:00.015166", "end": "2019-11-18 01:12:26.742269", "item": [{"bridge_name": "t4br2", "default_route_ip": "10.1.32.1", "dns": [{"brif": "t4s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t4s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t4ns2", "route": [{"if": "p1", "ip": "10.1.32.1/24", "ns_if": "t4if", "ns_name": "t4"}], "subnet_ip": "2.2.2.0/24", "vms": [{"brif": "t4br2if1", "disk": "10G", "mem": 3, "name": "t4_VM3", "vcpu": 2, "vmif": "t4VM3if1"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, {"tenant_ns_if": "t4ns2if", "tenant_ns_ip": "10.1.32.1/24", "tenant_ns_name": "t4", "tenant_sub_if": "t4s2if", "tenant_sub_ip": "10.1.32.2/24"}], "rc": 0, "start": "2019-11-18 01:12:26.727103", "stderr": "Device \"t4ns2if\" does not exist.", "stderr_lines": ["Device \"t4ns2if\" does not exist."], "stdout": "", "stdout_lines": []}

TASK [Attach Namespace VETH Pairs] **************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.31.1/24', u'ns_name': u't4', u'ns_if': u't4if', u'if': u'p1'}], u'default_route_ip': u'10.1.31.1', u'bridge_name': u't4br1', u'dns': [{u'dnsif': u't4s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't4s1_dnsbrif'}], u'ns_name': u't4ns1', u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't4_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't4br1if1', u'vmif': u't4VM1if1'}, {u'mem': 4, u'name': u't4_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't4br1if2', u'vmif': u't4VM2if1'}], u'vxlan': [{u'local_ip': u'10.1.31.2', u'dsport': 4789, u'dev': u't4s1if', u'tenant_route_ip': u'192.168.4.2', u'remote_route': u'10.2.31.0/24', u'subnet_route': u'10.1.31.0/24', u'v_name': u'vxlan_t4s1', u'id': 42, u'remote_ip': u'10.2.31.2'}]}, {u'tenant_sub_ip': u'10.1.31.2/24', u'tenant_ns_ip': u'10.1.31.1/24', u'tenant_ns_if': u't4ns1if', u'tenant_sub_if': u't4s1if', u'tenant_ns_name': u't4'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t4\" ip link show \"t4ns1if\" ; if [ $? -ne 0 ] ; then ip link set \"t4ns1if\" netns \"t4\" ; fi\nip netns exec \"t4ns1\" ip link show \"t4s1if\" ; if [ $? -ne 0 ] ; then ip link set \"t4s1if\" netns \"t4ns1\" ; fi\n", "delta": "0:00:00.115226", "end": "2019-11-18 01:12:27.142534", "item": [{"bridge_name": "t4br1", "default_route_ip": "10.1.31.1", "dns": [{"brif": "t4s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t4s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t4ns1", "route": [{"if": "p1", "ip": "10.1.31.1/24", "ns_if": "t4if", "ns_name": "t4"}], "subnet_ip": "1.1.1.0/24", "vms": [{"brif": "t4br1if1", "disk": "10G", "mem": 2, "name": "t4_VM1", "vcpu": 4, "vmif": "t4VM1if1"}, {"brif": "t4br1if2", "disk": "10G", "mem": 4, "name": "t4_VM2", "vcpu": 2, "vmif": "t4VM2if1"}], "vxlan": [{"dev": "t4s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.31.2", "remote_ip": "10.2.31.2", "remote_route": "10.2.31.0/24", "subnet_route": "10.1.31.0/24", "tenant_route_ip": "192.168.4.2", "v_name": "vxlan_t4s1"}]}, {"tenant_ns_if": "t4ns1if", "tenant_ns_ip": "10.1.31.1/24", "tenant_ns_name": "t4", "tenant_sub_if": "t4s1if", "tenant_sub_ip": "10.1.31.2/24"}], "rc": 0, "start": "2019-11-18 01:12:27.027308", "stderr": "Device \"t4ns1if\" does not exist.\nDevice \"t4s1if\" does not exist.", "stderr_lines": ["Device \"t4ns1if\" does not exist.", "Device \"t4s1if\" does not exist."], "stdout": "", "stdout_lines": []}
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.32.1/24', u'ns_name': u't4', u'ns_if': u't4if', u'if': u'p1'}], u'default_route_ip': u'10.1.32.1', u'bridge_name': u't4br2', u'dns': [{u'dnsif': u't4s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't4s2_dnsbrif'}], u'ns_name': u't4ns2', u'subnet_ip': u'2.2.2.0/24', u'vms': [{u'mem': 3, u'name': u't4_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't4br2if1', u'vmif': u't4VM3if1'}], u'vxlan': [{u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}, {u'tenant_sub_ip': u'10.1.32.2/24', u'tenant_ns_ip': u'10.1.32.1/24', u'tenant_ns_if': u't4ns2if', u'tenant_sub_if': u't4s2if', u'tenant_ns_name': u't4'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t4\" ip link show \"t4ns2if\" ; if [ $? -ne 0 ] ; then ip link set \"t4ns2if\" netns \"t4\" ; fi\nip netns exec \"t4ns2\" ip link show \"t4s2if\" ; if [ $? -ne 0 ] ; then ip link set \"t4s2if\" netns \"t4ns2\" ; fi\n", "delta": "0:00:00.131499", "end": "2019-11-18 01:12:27.500640", "item": [{"bridge_name": "t4br2", "default_route_ip": "10.1.32.1", "dns": [{"brif": "t4s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t4s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t4ns2", "route": [{"if": "p1", "ip": "10.1.32.1/24", "ns_if": "t4if", "ns_name": "t4"}], "subnet_ip": "2.2.2.0/24", "vms": [{"brif": "t4br2if1", "disk": "10G", "mem": 3, "name": "t4_VM3", "vcpu": 2, "vmif": "t4VM3if1"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, {"tenant_ns_if": "t4ns2if", "tenant_ns_ip": "10.1.32.1/24", "tenant_ns_name": "t4", "tenant_sub_if": "t4s2if", "tenant_sub_ip": "10.1.32.2/24"}], "rc": 0, "start": "2019-11-18 01:12:27.369141", "stderr": "Device \"t4ns2if\" does not exist.\nDevice \"t4s2if\" does not exist.", "stderr_lines": ["Device \"t4ns2if\" does not exist.", "Device \"t4s2if\" does not exist."], "stdout": "", "stdout_lines": []}

TASK [Set Namespace VETH Pairs UP] **************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.31.1/24', u'ns_name': u't4', u'ns_if': u't4if', u'if': u'p1'}], u'default_route_ip': u'10.1.31.1', u'bridge_name': u't4br1', u'dns': [{u'dnsif': u't4s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't4s1_dnsbrif'}], u'ns_name': u't4ns1', u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't4_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't4br1if1', u'vmif': u't4VM1if1'}, {u'mem': 4, u'name': u't4_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't4br1if2', u'vmif': u't4VM2if1'}], u'vxlan': [{u'local_ip': u'10.1.31.2', u'dsport': 4789, u'dev': u't4s1if', u'tenant_route_ip': u'192.168.4.2', u'remote_route': u'10.2.31.0/24', u'subnet_route': u'10.1.31.0/24', u'v_name': u'vxlan_t4s1', u'id': 42, u'remote_ip': u'10.2.31.2'}]}, {u'tenant_sub_ip': u'10.1.31.2/24', u'tenant_ns_ip': u'10.1.31.1/24', u'tenant_ns_if': u't4ns1if', u'tenant_sub_if': u't4s1if', u'tenant_ns_name': u't4'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t4\" ip link set dev \"t4ns1if\" up\nip netns exec \"t4ns1\" ip link set dev \"t4s1if\" up\n", "delta": "0:00:00.072150", "end": "2019-11-18 01:12:27.854003", "item": [{"bridge_name": "t4br1", "default_route_ip": "10.1.31.1", "dns": [{"brif": "t4s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t4s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t4ns1", "route": [{"if": "p1", "ip": "10.1.31.1/24", "ns_if": "t4if", "ns_name": "t4"}], "subnet_ip": "1.1.1.0/24", "vms": [{"brif": "t4br1if1", "disk": "10G", "mem": 2, "name": "t4_VM1", "vcpu": 4, "vmif": "t4VM1if1"}, {"brif": "t4br1if2", "disk": "10G", "mem": 4, "name": "t4_VM2", "vcpu": 2, "vmif": "t4VM2if1"}], "vxlan": [{"dev": "t4s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.31.2", "remote_ip": "10.2.31.2", "remote_route": "10.2.31.0/24", "subnet_route": "10.1.31.0/24", "tenant_route_ip": "192.168.4.2", "v_name": "vxlan_t4s1"}]}, {"tenant_ns_if": "t4ns1if", "tenant_ns_ip": "10.1.31.1/24", "tenant_ns_name": "t4", "tenant_sub_if": "t4s1if", "tenant_sub_ip": "10.1.31.2/24"}], "rc": 0, "start": "2019-11-18 01:12:27.781853", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.32.1/24', u'ns_name': u't4', u'ns_if': u't4if', u'if': u'p1'}], u'default_route_ip': u'10.1.32.1', u'bridge_name': u't4br2', u'dns': [{u'dnsif': u't4s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't4s2_dnsbrif'}], u'ns_name': u't4ns2', u'subnet_ip': u'2.2.2.0/24', u'vms': [{u'mem': 3, u'name': u't4_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't4br2if1', u'vmif': u't4VM3if1'}], u'vxlan': [{u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}, {u'tenant_sub_ip': u'10.1.32.2/24', u'tenant_ns_ip': u'10.1.32.1/24', u'tenant_ns_if': u't4ns2if', u'tenant_sub_if': u't4s2if', u'tenant_ns_name': u't4'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t4\" ip link set dev \"t4ns2if\" up\nip netns exec \"t4ns2\" ip link set dev \"t4s2if\" up\n", "delta": "0:00:00.076077", "end": "2019-11-18 01:12:28.137733", "item": [{"bridge_name": "t4br2", "default_route_ip": "10.1.32.1", "dns": [{"brif": "t4s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t4s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t4ns2", "route": [{"if": "p1", "ip": "10.1.32.1/24", "ns_if": "t4if", "ns_name": "t4"}], "subnet_ip": "2.2.2.0/24", "vms": [{"brif": "t4br2if1", "disk": "10G", "mem": 3, "name": "t4_VM3", "vcpu": 2, "vmif": "t4VM3if1"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, {"tenant_ns_if": "t4ns2if", "tenant_ns_ip": "10.1.32.1/24", "tenant_ns_name": "t4", "tenant_sub_if": "t4s2if", "tenant_sub_ip": "10.1.32.2/24"}], "rc": 0, "start": "2019-11-18 01:12:28.061656", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Add IP addresses to Namespace VETH Pairs] *************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.31.1/24', u'ns_name': u't4', u'ns_if': u't4if', u'if': u'p1'}], u'default_route_ip': u'10.1.31.1', u'bridge_name': u't4br1', u'dns': [{u'dnsif': u't4s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't4s1_dnsbrif'}], u'ns_name': u't4ns1', u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't4_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't4br1if1', u'vmif': u't4VM1if1'}, {u'mem': 4, u'name': u't4_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't4br1if2', u'vmif': u't4VM2if1'}], u'vxlan': [{u'local_ip': u'10.1.31.2', u'dsport': 4789, u'dev': u't4s1if', u'tenant_route_ip': u'192.168.4.2', u'remote_route': u'10.2.31.0/24', u'subnet_route': u'10.1.31.0/24', u'v_name': u'vxlan_t4s1', u'id': 42, u'remote_ip': u'10.2.31.2'}]}, {u'tenant_sub_ip': u'10.1.31.2/24', u'tenant_ns_ip': u'10.1.31.1/24', u'tenant_ns_if': u't4ns1if', u'tenant_sub_if': u't4s1if', u'tenant_ns_name': u't4'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t4ns1\" ip addr show \"t4s1if\" | awk 'FNR==3{ print $2 }' | grep -w '^10.1.31.2/24' ; if [ $? -ne 0 ] ; then ip netns exec \"t4ns1\" ip addr add \"10.1.31.2/24\" dev \"t4s1if\" ; fi\n\nip netns exec \"t4\" ip addr show \"t4ns1if\" | awk 'FNR==3{ print $2 }' | grep -w '^10.1.31.1/24' ; if [ $? -ne 0 ] ; then ip netns exec \"t4\" ip addr add \"10.1.31.1/24\" dev \"t4ns1if\" ; fi\n", "delta": "0:00:00.162527", "end": "2019-11-18 01:12:28.561792", "item": [{"bridge_name": "t4br1", "default_route_ip": "10.1.31.1", "dns": [{"brif": "t4s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t4s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t4ns1", "route": [{"if": "p1", "ip": "10.1.31.1/24", "ns_if": "t4if", "ns_name": "t4"}], "subnet_ip": "1.1.1.0/24", "vms": [{"brif": "t4br1if1", "disk": "10G", "mem": 2, "name": "t4_VM1", "vcpu": 4, "vmif": "t4VM1if1"}, {"brif": "t4br1if2", "disk": "10G", "mem": 4, "name": "t4_VM2", "vcpu": 2, "vmif": "t4VM2if1"}], "vxlan": [{"dev": "t4s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.31.2", "remote_ip": "10.2.31.2", "remote_route": "10.2.31.0/24", "subnet_route": "10.1.31.0/24", "tenant_route_ip": "192.168.4.2", "v_name": "vxlan_t4s1"}]}, {"tenant_ns_if": "t4ns1if", "tenant_ns_ip": "10.1.31.1/24", "tenant_ns_name": "t4", "tenant_sub_if": "t4s1if", "tenant_sub_ip": "10.1.31.2/24"}], "rc": 0, "start": "2019-11-18 01:12:28.399265", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.32.1/24', u'ns_name': u't4', u'ns_if': u't4if', u'if': u'p1'}], u'default_route_ip': u'10.1.32.1', u'bridge_name': u't4br2', u'dns': [{u'dnsif': u't4s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't4s2_dnsbrif'}], u'ns_name': u't4ns2', u'subnet_ip': u'2.2.2.0/24', u'vms': [{u'mem': 3, u'name': u't4_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't4br2if1', u'vmif': u't4VM3if1'}], u'vxlan': [{u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}, {u'tenant_sub_ip': u'10.1.32.2/24', u'tenant_ns_ip': u'10.1.32.1/24', u'tenant_ns_if': u't4ns2if', u'tenant_sub_if': u't4s2if', u'tenant_ns_name': u't4'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t4ns2\" ip addr show \"t4s2if\" | awk 'FNR==3{ print $2 }' | grep -w '^10.1.32.2/24' ; if [ $? -ne 0 ] ; then ip netns exec \"t4ns2\" ip addr add \"10.1.32.2/24\" dev \"t4s2if\" ; fi\n\nip netns exec \"t4\" ip addr show \"t4ns2if\" | awk 'FNR==3{ print $2 }' | grep -w '^10.1.32.1/24' ; if [ $? -ne 0 ] ; then ip netns exec \"t4\" ip addr add \"10.1.32.1/24\" dev \"t4ns2if\" ; fi\n", "delta": "0:00:00.148002", "end": "2019-11-18 01:12:28.909933", "item": [{"bridge_name": "t4br2", "default_route_ip": "10.1.32.1", "dns": [{"brif": "t4s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t4s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t4ns2", "route": [{"if": "p1", "ip": "10.1.32.1/24", "ns_if": "t4if", "ns_name": "t4"}], "subnet_ip": "2.2.2.0/24", "vms": [{"brif": "t4br2if1", "disk": "10G", "mem": 3, "name": "t4_VM3", "vcpu": 2, "vmif": "t4VM3if1"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, {"tenant_ns_if": "t4ns2if", "tenant_ns_ip": "10.1.32.1/24", "tenant_ns_name": "t4", "tenant_sub_if": "t4s2if", "tenant_sub_ip": "10.1.32.2/24"}], "rc": 0, "start": "2019-11-18 01:12:28.761931", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Add IP Route to Tenant] *******************************************************************************************************************************
changed: [localhost] => (item={u'default_route_ip': u'192.168.4.1', u'name': u't4', u'pns_ip': u'192.168.4.1/24', u'tenant_if': u't4if', u'tenant_ip': u'192.168.4.2/24', u'pns_if': u't4pns_if'}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t4\" ip route show default | grep -w '[d]efault via 192.168.4.1' ; if [ $? -ne 0 ] ; then ip netns exec \"t4\" ip route add default via \"192.168.4.1\" ; fi\n", "delta": "0:00:00.081303", "end": "2019-11-18 01:12:29.269989", "item": {"default_route_ip": "192.168.4.1", "name": "t4", "pns_if": "t4pns_if", "pns_ip": "192.168.4.1/24", "tenant_if": "t4if", "tenant_ip": "192.168.4.2/24"}, "rc": 0, "start": "2019-11-18 01:12:29.188686", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Add IP Route to Tenant Subnet] ************************************************************************************************************************
changed: [localhost] => (item={u'route': [{u'ip': u'10.1.31.1/24', u'ns_name': u't4', u'ns_if': u't4if', u'if': u'p1'}], u'default_route_ip': u'10.1.31.1', u'bridge_name': u't4br1', u'dns': [{u'dnsif': u't4s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't4s1_dnsbrif'}], u'ns_name': u't4ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.31.2/24', u'tenant_ns_ip': u'10.1.31.1/24', u'tenant_ns_if': u't4ns1if', u'tenant_ns_name': u't4', u'tenant_sub_if': u't4s1if'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't4_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't4br1if1', u'vmif': u't4VM1if1'}, {u'mem': 4, u'name': u't4_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't4br1if2', u'vmif': u't4VM2if1'}], u'vxlan': [{u'local_ip': u'10.1.31.2', u'tenant_route_ip': u'192.168.4.2', u'dsport': 4789, u'dev': u't4s1if', u'subnet_route': u'10.1.31.0/24', u'remote_route': u'10.2.31.0/24', u'v_name': u'vxlan_t4s1', u'id': 42, u'remote_ip': u'10.2.31.2'}]}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t4ns1\" ip route show default | grep -w '[d]efault via 10.1.31.1' ; if [ $? -ne 0 ] ; then ip netns exec \"t4ns1\" ip route add default via \"10.1.31.1\" ; fi\n", "delta": "0:00:00.098505", "end": "2019-11-18 01:12:29.658041", "item": {"bridge_name": "t4br1", "default_route_ip": "10.1.31.1", "dns": [{"brif": "t4s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t4s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t4ns1", "route": [{"if": "p1", "ip": "10.1.31.1/24", "ns_if": "t4if", "ns_name": "t4"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t4ns1if", "tenant_ns_ip": "10.1.31.1/24", "tenant_ns_name": "t4", "tenant_sub_if": "t4s1if", "tenant_sub_ip": "10.1.31.2/24"}], "vms": [{"brif": "t4br1if1", "disk": "10G", "mem": 2, "name": "t4_VM1", "vcpu": 4, "vmif": "t4VM1if1"}, {"brif": "t4br1if2", "disk": "10G", "mem": 4, "name": "t4_VM2", "vcpu": 2, "vmif": "t4VM2if1"}], "vxlan": [{"dev": "t4s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.31.2", "remote_ip": "10.2.31.2", "remote_route": "10.2.31.0/24", "subnet_route": "10.1.31.0/24", "tenant_route_ip": "192.168.4.2", "v_name": "vxlan_t4s1"}]}, "rc": 0, "start": "2019-11-18 01:12:29.559536", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}
changed: [localhost] => (item={u'route': [{u'ip': u'10.1.32.1/24', u'ns_name': u't4', u'ns_if': u't4if', u'if': u'p1'}], u'default_route_ip': u'10.1.32.1', u'bridge_name': u't4br2', u'dns': [{u'dnsif': u't4s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't4s2_dnsbrif'}], u'ns_name': u't4ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.32.2/24', u'tenant_ns_ip': u'10.1.32.1/24', u'tenant_ns_if': u't4ns2if', u'tenant_ns_name': u't4', u'tenant_sub_if': u't4s2if'}], u'subnet_ip': u'2.2.2.0/24', u'vms': [{u'mem': 3, u'name': u't4_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't4br2if1', u'vmif': u't4VM3if1'}], u'vxlan': [{u'local_ip': [], u'tenant_route_ip': [], u'dsport': [], u'dev': [], u'subnet_route': [], u'remote_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t4ns2\" ip route show default | grep -w '[d]efault via 10.1.32.1' ; if [ $? -ne 0 ] ; then ip netns exec \"t4ns2\" ip route add default via \"10.1.32.1\" ; fi\n", "delta": "0:00:00.082307", "end": "2019-11-18 01:12:29.961989", "item": {"bridge_name": "t4br2", "default_route_ip": "10.1.32.1", "dns": [{"brif": "t4s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t4s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t4ns2", "route": [{"if": "p1", "ip": "10.1.32.1/24", "ns_if": "t4if", "ns_name": "t4"}], "subnet_ip": "2.2.2.0/24", "tenant_ns": [{"tenant_ns_if": "t4ns2if", "tenant_ns_ip": "10.1.32.1/24", "tenant_ns_name": "t4", "tenant_sub_if": "t4s2if", "tenant_sub_ip": "10.1.32.2/24"}], "vms": [{"brif": "t4br2if1", "disk": "10G", "mem": 3, "name": "t4_VM3", "vcpu": 2, "vmif": "t4VM3if1"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, "rc": 0, "start": "2019-11-18 01:12:29.879682", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Create bridge inside namespace] ***********************************************************************************************************************
changed: [localhost] => (item={u'route': [{u'ip': u'10.1.31.1/24', u'ns_name': u't4', u'ns_if': u't4if', u'if': u'p1'}], u'default_route_ip': u'10.1.31.1', u'bridge_name': u't4br1', u'dns': [{u'dnsif': u't4s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't4s1_dnsbrif'}], u'ns_name': u't4ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.31.2/24', u'tenant_ns_ip': u'10.1.31.1/24', u'tenant_ns_if': u't4ns1if', u'tenant_ns_name': u't4', u'tenant_sub_if': u't4s1if'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't4_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't4br1if1', u'vmif': u't4VM1if1'}, {u'mem': 4, u'name': u't4_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't4br1if2', u'vmif': u't4VM2if1'}], u'vxlan': [{u'local_ip': u'10.1.31.2', u'tenant_route_ip': u'192.168.4.2', u'dsport': 4789, u'dev': u't4s1if', u'subnet_route': u'10.1.31.0/24', u'remote_route': u'10.2.31.0/24', u'v_name': u'vxlan_t4s1', u'id': 42, u'remote_ip': u'10.2.31.2'}]}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t4ns1\" brctl show | grep -w '^t4br1'; if [ $? -ne 0 ] ; then ip netns exec \"t4ns1\" brctl addbr \"t4br1\" ; fi\nip netns exec \"t4ns1\" ip link set dev \"t4br1\" up\n", "delta": "0:00:00.112135", "end": "2019-11-18 01:12:30.362042", "item": {"bridge_name": "t4br1", "default_route_ip": "10.1.31.1", "dns": [{"brif": "t4s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t4s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t4ns1", "route": [{"if": "p1", "ip": "10.1.31.1/24", "ns_if": "t4if", "ns_name": "t4"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t4ns1if", "tenant_ns_ip": "10.1.31.1/24", "tenant_ns_name": "t4", "tenant_sub_if": "t4s1if", "tenant_sub_ip": "10.1.31.2/24"}], "vms": [{"brif": "t4br1if1", "disk": "10G", "mem": 2, "name": "t4_VM1", "vcpu": 4, "vmif": "t4VM1if1"}, {"brif": "t4br1if2", "disk": "10G", "mem": 4, "name": "t4_VM2", "vcpu": 2, "vmif": "t4VM2if1"}], "vxlan": [{"dev": "t4s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.31.2", "remote_ip": "10.2.31.2", "remote_route": "10.2.31.0/24", "subnet_route": "10.1.31.0/24", "tenant_route_ip": "192.168.4.2", "v_name": "vxlan_t4s1"}]}, "rc": 0, "start": "2019-11-18 01:12:30.249907", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}
changed: [localhost] => (item={u'route': [{u'ip': u'10.1.32.1/24', u'ns_name': u't4', u'ns_if': u't4if', u'if': u'p1'}], u'default_route_ip': u'10.1.32.1', u'bridge_name': u't4br2', u'dns': [{u'dnsif': u't4s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't4s2_dnsbrif'}], u'ns_name': u't4ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.32.2/24', u'tenant_ns_ip': u'10.1.32.1/24', u'tenant_ns_if': u't4ns2if', u'tenant_ns_name': u't4', u'tenant_sub_if': u't4s2if'}], u'subnet_ip': u'2.2.2.0/24', u'vms': [{u'mem': 3, u'name': u't4_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't4br2if1', u'vmif': u't4VM3if1'}], u'vxlan': [{u'local_ip': [], u'tenant_route_ip': [], u'dsport': [], u'dev': [], u'subnet_route': [], u'remote_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t4ns2\" brctl show | grep -w '^t4br2'; if [ $? -ne 0 ] ; then ip netns exec \"t4ns2\" brctl addbr \"t4br2\" ; fi\nip netns exec \"t4ns2\" ip link set dev \"t4br2\" up\n", "delta": "0:00:00.114819", "end": "2019-11-18 01:12:30.698049", "item": {"bridge_name": "t4br2", "default_route_ip": "10.1.32.1", "dns": [{"brif": "t4s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t4s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t4ns2", "route": [{"if": "p1", "ip": "10.1.32.1/24", "ns_if": "t4if", "ns_name": "t4"}], "subnet_ip": "2.2.2.0/24", "tenant_ns": [{"tenant_ns_if": "t4ns2if", "tenant_ns_ip": "10.1.32.1/24", "tenant_ns_name": "t4", "tenant_sub_if": "t4s2if", "tenant_sub_ip": "10.1.32.2/24"}], "vms": [{"brif": "t4br2if1", "disk": "10G", "mem": 3, "name": "t4_VM3", "vcpu": 2, "vmif": "t4VM3if1"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, "rc": 0, "start": "2019-11-18 01:12:30.583230", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Create DNS VETH Pair] *********************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.31.1/24', u'ns_name': u't4', u'ns_if': u't4if', u'if': u'p1'}], u'default_route_ip': u'10.1.31.1', u'bridge_name': u't4br1', u'ns_name': u't4ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.31.2/24', u'tenant_ns_ip': u'10.1.31.1/24', u'tenant_ns_if': u't4ns1if', u'tenant_sub_if': u't4s1if', u'tenant_ns_name': u't4'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't4_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't4br1if1', u'vmif': u't4VM1if1'}, {u'mem': 4, u'name': u't4_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't4br1if2', u'vmif': u't4VM2if1'}], u'vxlan': [{u'local_ip': u'10.1.31.2', u'dsport': 4789, u'dev': u't4s1if', u'tenant_route_ip': u'192.168.4.2', u'remote_route': u'10.2.31.0/24', u'subnet_route': u'10.1.31.0/24', u'v_name': u'vxlan_t4s1', u'id': 42, u'remote_ip': u'10.2.31.2'}]}, {u'dnsif': u't4s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't4s1_dnsbrif'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t4ns1\" ip link show \"t4s1_dnsbrif\" ; if [ $? -ne 0 ] ; then ip netns exec \"t4ns1\" ip link add \"t4s1_dnsbrif\" type veth peer name \"t4s1_dnsif\" ; fi\nip netns exec \"t4ns1\" ip link set dev \"t4s1_dnsbrif\" up\nip netns exec \"t4ns1\" ip link set dev \"t4s1_dnsif\" up\n", "delta": "0:00:00.163202", "end": "2019-11-18 01:12:31.141798", "item": [{"bridge_name": "t4br1", "default_route_ip": "10.1.31.1", "ns_name": "t4ns1", "route": [{"if": "p1", "ip": "10.1.31.1/24", "ns_if": "t4if", "ns_name": "t4"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t4ns1if", "tenant_ns_ip": "10.1.31.1/24", "tenant_ns_name": "t4", "tenant_sub_if": "t4s1if", "tenant_sub_ip": "10.1.31.2/24"}], "vms": [{"brif": "t4br1if1", "disk": "10G", "mem": 2, "name": "t4_VM1", "vcpu": 4, "vmif": "t4VM1if1"}, {"brif": "t4br1if2", "disk": "10G", "mem": 4, "name": "t4_VM2", "vcpu": 2, "vmif": "t4VM2if1"}], "vxlan": [{"dev": "t4s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.31.2", "remote_ip": "10.2.31.2", "remote_route": "10.2.31.0/24", "subnet_route": "10.1.31.0/24", "tenant_route_ip": "192.168.4.2", "v_name": "vxlan_t4s1"}]}, {"brif": "t4s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t4s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "rc": 0, "start": "2019-11-18 01:12:30.978596", "stderr": "Device \"t4s1_dnsbrif\" does not exist.", "stderr_lines": ["Device \"t4s1_dnsbrif\" does not exist."], "stdout": "", "stdout_lines": []}
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.32.1/24', u'ns_name': u't4', u'ns_if': u't4if', u'if': u'p1'}], u'default_route_ip': u'10.1.32.1', u'bridge_name': u't4br2', u'ns_name': u't4ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.32.2/24', u'tenant_ns_ip': u'10.1.32.1/24', u'tenant_ns_if': u't4ns2if', u'tenant_sub_if': u't4s2if', u'tenant_ns_name': u't4'}], u'subnet_ip': u'2.2.2.0/24', u'vms': [{u'mem': 3, u'name': u't4_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't4br2if1', u'vmif': u't4VM3if1'}], u'vxlan': [{u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}, {u'dnsif': u't4s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't4s2_dnsbrif'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t4ns2\" ip link show \"t4s2_dnsbrif\" ; if [ $? -ne 0 ] ; then ip netns exec \"t4ns2\" ip link add \"t4s2_dnsbrif\" type veth peer name \"t4s2_dnsif\" ; fi\nip netns exec \"t4ns2\" ip link set dev \"t4s2_dnsbrif\" up\nip netns exec \"t4ns2\" ip link set dev \"t4s2_dnsif\" up\n", "delta": "0:00:00.150139", "end": "2019-11-18 01:12:31.489705", "item": [{"bridge_name": "t4br2", "default_route_ip": "10.1.32.1", "ns_name": "t4ns2", "route": [{"if": "p1", "ip": "10.1.32.1/24", "ns_if": "t4if", "ns_name": "t4"}], "subnet_ip": "2.2.2.0/24", "tenant_ns": [{"tenant_ns_if": "t4ns2if", "tenant_ns_ip": "10.1.32.1/24", "tenant_ns_name": "t4", "tenant_sub_if": "t4s2if", "tenant_sub_ip": "10.1.32.2/24"}], "vms": [{"brif": "t4br2if1", "disk": "10G", "mem": 3, "name": "t4_VM3", "vcpu": 2, "vmif": "t4VM3if1"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, {"brif": "t4s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t4s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "rc": 0, "start": "2019-11-18 01:12:31.339566", "stderr": "Device \"t4s2_dnsbrif\" does not exist.", "stderr_lines": ["Device \"t4s2_dnsbrif\" does not exist."], "stdout": "", "stdout_lines": []}

TASK [Attach DNS VETH Pair] *********************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.31.1/24', u'ns_name': u't4', u'ns_if': u't4if', u'if': u'p1'}], u'default_route_ip': u'10.1.31.1', u'bridge_name': u't4br1', u'ns_name': u't4ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.31.2/24', u'tenant_ns_ip': u'10.1.31.1/24', u'tenant_ns_if': u't4ns1if', u'tenant_sub_if': u't4s1if', u'tenant_ns_name': u't4'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't4_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't4br1if1', u'vmif': u't4VM1if1'}, {u'mem': 4, u'name': u't4_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't4br1if2', u'vmif': u't4VM2if1'}], u'vxlan': [{u'local_ip': u'10.1.31.2', u'dsport': 4789, u'dev': u't4s1if', u'tenant_route_ip': u'192.168.4.2', u'remote_route': u'10.2.31.0/24', u'subnet_route': u'10.1.31.0/24', u'v_name': u'vxlan_t4s1', u'id': 42, u'remote_ip': u'10.2.31.2'}]}, {u'dnsif': u't4s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't4s1_dnsbrif'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t4ns1\" brctl show \"t4br1\" | grep -w 't4s1_dnsbrif' ; if [ $? -ne 0 ] ; then ip netns exec \"t4ns1\" brctl addif \"t4br1\" \"t4s1_dnsbrif\" ; fi\n", "delta": "0:00:00.076345", "end": "2019-11-18 01:12:31.817688", "item": [{"bridge_name": "t4br1", "default_route_ip": "10.1.31.1", "ns_name": "t4ns1", "route": [{"if": "p1", "ip": "10.1.31.1/24", "ns_if": "t4if", "ns_name": "t4"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t4ns1if", "tenant_ns_ip": "10.1.31.1/24", "tenant_ns_name": "t4", "tenant_sub_if": "t4s1if", "tenant_sub_ip": "10.1.31.2/24"}], "vms": [{"brif": "t4br1if1", "disk": "10G", "mem": 2, "name": "t4_VM1", "vcpu": 4, "vmif": "t4VM1if1"}, {"brif": "t4br1if2", "disk": "10G", "mem": 4, "name": "t4_VM2", "vcpu": 2, "vmif": "t4VM2if1"}], "vxlan": [{"dev": "t4s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.31.2", "remote_ip": "10.2.31.2", "remote_route": "10.2.31.0/24", "subnet_route": "10.1.31.0/24", "tenant_route_ip": "192.168.4.2", "v_name": "vxlan_t4s1"}]}, {"brif": "t4s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t4s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "rc": 0, "start": "2019-11-18 01:12:31.741343", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.32.1/24', u'ns_name': u't4', u'ns_if': u't4if', u'if': u'p1'}], u'default_route_ip': u'10.1.32.1', u'bridge_name': u't4br2', u'ns_name': u't4ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.32.2/24', u'tenant_ns_ip': u'10.1.32.1/24', u'tenant_ns_if': u't4ns2if', u'tenant_sub_if': u't4s2if', u'tenant_ns_name': u't4'}], u'subnet_ip': u'2.2.2.0/24', u'vms': [{u'mem': 3, u'name': u't4_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't4br2if1', u'vmif': u't4VM3if1'}], u'vxlan': [{u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}, {u'dnsif': u't4s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't4s2_dnsbrif'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t4ns2\" brctl show \"t4br2\" | grep -w 't4s2_dnsbrif' ; if [ $? -ne 0 ] ; then ip netns exec \"t4ns2\" brctl addif \"t4br2\" \"t4s2_dnsbrif\" ; fi\n", "delta": "0:00:00.083766", "end": "2019-11-18 01:12:32.105908", "item": [{"bridge_name": "t4br2", "default_route_ip": "10.1.32.1", "ns_name": "t4ns2", "route": [{"if": "p1", "ip": "10.1.32.1/24", "ns_if": "t4if", "ns_name": "t4"}], "subnet_ip": "2.2.2.0/24", "tenant_ns": [{"tenant_ns_if": "t4ns2if", "tenant_ns_ip": "10.1.32.1/24", "tenant_ns_name": "t4", "tenant_sub_if": "t4s2if", "tenant_sub_ip": "10.1.32.2/24"}], "vms": [{"brif": "t4br2if1", "disk": "10G", "mem": 3, "name": "t4_VM3", "vcpu": 2, "vmif": "t4VM3if1"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, {"brif": "t4s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t4s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "rc": 0, "start": "2019-11-18 01:12:32.022142", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Create VETH Pairs] ************************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.31.1/24', u'ns_name': u't4', u'ns_if': u't4if', u'if': u'p1'}], u'default_route_ip': u'10.1.31.1', u'bridge_name': u't4br1', u'dns': [{u'dnsif': u't4s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't4s1_dnsbrif'}], u'ns_name': u't4ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.31.2/24', u'tenant_ns_ip': u'10.1.31.1/24', u'tenant_ns_if': u't4ns1if', u'tenant_sub_if': u't4s1if', u'tenant_ns_name': u't4'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.1.31.2', u'dsport': 4789, u'dev': u't4s1if', u'tenant_route_ip': u'192.168.4.2', u'remote_route': u'10.2.31.0/24', u'subnet_route': u'10.1.31.0/24', u'v_name': u'vxlan_t4s1', u'id': 42, u'remote_ip': u'10.2.31.2'}]}, {u'mem': 2, u'name': u't4_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't4br1if1', u'vmif': u't4VM1if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip link show \"t4br1if1\" ; if [ $? -ne 0 ] ; then ip link add \"t4VM1if1\" type veth peer name \"t4br1if1\" ; fi\nip link set dev \"t4br1if1\" up\nip link set dev \"t4VM1if1\" up\n", "delta": "0:00:00.020212", "end": "2019-11-18 01:12:32.413537", "item": [{"bridge_name": "t4br1", "default_route_ip": "10.1.31.1", "dns": [{"brif": "t4s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t4s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t4ns1", "route": [{"if": "p1", "ip": "10.1.31.1/24", "ns_if": "t4if", "ns_name": "t4"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t4ns1if", "tenant_ns_ip": "10.1.31.1/24", "tenant_ns_name": "t4", "tenant_sub_if": "t4s1if", "tenant_sub_ip": "10.1.31.2/24"}], "vxlan": [{"dev": "t4s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.31.2", "remote_ip": "10.2.31.2", "remote_route": "10.2.31.0/24", "subnet_route": "10.1.31.0/24", "tenant_route_ip": "192.168.4.2", "v_name": "vxlan_t4s1"}]}, {"brif": "t4br1if1", "disk": "10G", "mem": 2, "name": "t4_VM1", "vcpu": 4, "vmif": "t4VM1if1"}], "rc": 0, "start": "2019-11-18 01:12:32.393325", "stderr": "Device \"t4br1if1\" does not exist.", "stderr_lines": ["Device \"t4br1if1\" does not exist."], "stdout": "", "stdout_lines": []}
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.31.1/24', u'ns_name': u't4', u'ns_if': u't4if', u'if': u'p1'}], u'default_route_ip': u'10.1.31.1', u'bridge_name': u't4br1', u'dns': [{u'dnsif': u't4s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't4s1_dnsbrif'}], u'ns_name': u't4ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.31.2/24', u'tenant_ns_ip': u'10.1.31.1/24', u'tenant_ns_if': u't4ns1if', u'tenant_sub_if': u't4s1if', u'tenant_ns_name': u't4'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.1.31.2', u'dsport': 4789, u'dev': u't4s1if', u'tenant_route_ip': u'192.168.4.2', u'remote_route': u'10.2.31.0/24', u'subnet_route': u'10.1.31.0/24', u'v_name': u'vxlan_t4s1', u'id': 42, u'remote_ip': u'10.2.31.2'}]}, {u'mem': 4, u'name': u't4_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't4br1if2', u'vmif': u't4VM2if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip link show \"t4br1if2\" ; if [ $? -ne 0 ] ; then ip link add \"t4VM2if1\" type veth peer name \"t4br1if2\" ; fi\nip link set dev \"t4br1if2\" up\nip link set dev \"t4VM2if1\" up\n", "delta": "0:00:00.022656", "end": "2019-11-18 01:12:32.657501", "item": [{"bridge_name": "t4br1", "default_route_ip": "10.1.31.1", "dns": [{"brif": "t4s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t4s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t4ns1", "route": [{"if": "p1", "ip": "10.1.31.1/24", "ns_if": "t4if", "ns_name": "t4"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t4ns1if", "tenant_ns_ip": "10.1.31.1/24", "tenant_ns_name": "t4", "tenant_sub_if": "t4s1if", "tenant_sub_ip": "10.1.31.2/24"}], "vxlan": [{"dev": "t4s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.31.2", "remote_ip": "10.2.31.2", "remote_route": "10.2.31.0/24", "subnet_route": "10.1.31.0/24", "tenant_route_ip": "192.168.4.2", "v_name": "vxlan_t4s1"}]}, {"brif": "t4br1if2", "disk": "10G", "mem": 4, "name": "t4_VM2", "vcpu": 2, "vmif": "t4VM2if1"}], "rc": 0, "start": "2019-11-18 01:12:32.634845", "stderr": "Device \"t4br1if2\" does not exist.", "stderr_lines": ["Device \"t4br1if2\" does not exist."], "stdout": "", "stdout_lines": []}
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.32.1/24', u'ns_name': u't4', u'ns_if': u't4if', u'if': u'p1'}], u'default_route_ip': u'10.1.32.1', u'bridge_name': u't4br2', u'dns': [{u'dnsif': u't4s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't4s2_dnsbrif'}], u'ns_name': u't4ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.32.2/24', u'tenant_ns_ip': u'10.1.32.1/24', u'tenant_ns_if': u't4ns2if', u'tenant_sub_if': u't4s2if', u'tenant_ns_name': u't4'}], u'subnet_ip': u'2.2.2.0/24', u'vxlan': [{u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}, {u'mem': 3, u'name': u't4_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't4br2if1', u'vmif': u't4VM3if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip link show \"t4br2if1\" ; if [ $? -ne 0 ] ; then ip link add \"t4VM3if1\" type veth peer name \"t4br2if1\" ; fi\nip link set dev \"t4br2if1\" up\nip link set dev \"t4VM3if1\" up\n", "delta": "0:00:00.019216", "end": "2019-11-18 01:12:32.895677", "item": [{"bridge_name": "t4br2", "default_route_ip": "10.1.32.1", "dns": [{"brif": "t4s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t4s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t4ns2", "route": [{"if": "p1", "ip": "10.1.32.1/24", "ns_if": "t4if", "ns_name": "t4"}], "subnet_ip": "2.2.2.0/24", "tenant_ns": [{"tenant_ns_if": "t4ns2if", "tenant_ns_ip": "10.1.32.1/24", "tenant_ns_name": "t4", "tenant_sub_if": "t4s2if", "tenant_sub_ip": "10.1.32.2/24"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, {"brif": "t4br2if1", "disk": "10G", "mem": 3, "name": "t4_VM3", "vcpu": 2, "vmif": "t4VM3if1"}], "rc": 0, "start": "2019-11-18 01:12:32.876461", "stderr": "Device \"t4br2if1\" does not exist.", "stderr_lines": ["Device \"t4br2if1\" does not exist."], "stdout": "", "stdout_lines": []}

TASK [Attach VETH Pairs] ************************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.31.1/24', u'ns_name': u't4', u'ns_if': u't4if', u'if': u'p1'}], u'default_route_ip': u'10.1.31.1', u'bridge_name': u't4br1', u'dns': [{u'dnsif': u't4s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't4s1_dnsbrif'}], u'ns_name': u't4ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.31.2/24', u'tenant_ns_ip': u'10.1.31.1/24', u'tenant_ns_if': u't4ns1if', u'tenant_sub_if': u't4s1if', u'tenant_ns_name': u't4'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.1.31.2', u'dsport': 4789, u'dev': u't4s1if', u'tenant_route_ip': u'192.168.4.2', u'remote_route': u'10.2.31.0/24', u'subnet_route': u'10.1.31.0/24', u'v_name': u'vxlan_t4s1', u'id': 42, u'remote_ip': u'10.2.31.2'}]}, {u'mem': 2, u'name': u't4_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't4br1if1', u'vmif': u't4VM1if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip link show \"t4br1if1\" ; if [ $? -eq 0 ] ; then ip link set \"t4br1if1\" netns \"t4ns1\" ; fi\nip netns exec \"t4ns1\" brctl show \"t4br1\" | grep -w 't4br1if1' ; if [ $? -ne 0 ] ; then ip netns exec \"t4ns1\" brctl addif \"t4br1\" \"t4br1if1\" ; fi\n", "delta": "0:00:00.115816", "end": "2019-11-18 01:12:33.301942", "item": [{"bridge_name": "t4br1", "default_route_ip": "10.1.31.1", "dns": [{"brif": "t4s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t4s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t4ns1", "route": [{"if": "p1", "ip": "10.1.31.1/24", "ns_if": "t4if", "ns_name": "t4"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t4ns1if", "tenant_ns_ip": "10.1.31.1/24", "tenant_ns_name": "t4", "tenant_sub_if": "t4s1if", "tenant_sub_ip": "10.1.31.2/24"}], "vxlan": [{"dev": "t4s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.31.2", "remote_ip": "10.2.31.2", "remote_route": "10.2.31.0/24", "subnet_route": "10.1.31.0/24", "tenant_route_ip": "192.168.4.2", "v_name": "vxlan_t4s1"}]}, {"brif": "t4br1if1", "disk": "10G", "mem": 2, "name": "t4_VM1", "vcpu": 4, "vmif": "t4VM1if1"}], "rc": 0, "start": "2019-11-18 01:12:33.186126", "stderr": "", "stderr_lines": [], "stdout": "50: t4br1if1@t4VM1if1: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP mode DEFAULT group default qlen 1000\n    link/ether 42:10:ea:e3:e9:99 brd ff:ff:ff:ff:ff:ff", "stdout_lines": ["50: t4br1if1@t4VM1if1: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP mode DEFAULT group default qlen 1000", "    link/ether 42:10:ea:e3:e9:99 brd ff:ff:ff:ff:ff:ff"]}
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.31.1/24', u'ns_name': u't4', u'ns_if': u't4if', u'if': u'p1'}], u'default_route_ip': u'10.1.31.1', u'bridge_name': u't4br1', u'dns': [{u'dnsif': u't4s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't4s1_dnsbrif'}], u'ns_name': u't4ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.31.2/24', u'tenant_ns_ip': u'10.1.31.1/24', u'tenant_ns_if': u't4ns1if', u'tenant_sub_if': u't4s1if', u'tenant_ns_name': u't4'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.1.31.2', u'dsport': 4789, u'dev': u't4s1if', u'tenant_route_ip': u'192.168.4.2', u'remote_route': u'10.2.31.0/24', u'subnet_route': u'10.1.31.0/24', u'v_name': u'vxlan_t4s1', u'id': 42, u'remote_ip': u'10.2.31.2'}]}, {u'mem': 4, u'name': u't4_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't4br1if2', u'vmif': u't4VM2if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip link show \"t4br1if2\" ; if [ $? -eq 0 ] ; then ip link set \"t4br1if2\" netns \"t4ns1\" ; fi\nip netns exec \"t4ns1\" brctl show \"t4br1\" | grep -w 't4br1if2' ; if [ $? -ne 0 ] ; then ip netns exec \"t4ns1\" brctl addif \"t4br1\" \"t4br1if2\" ; fi\n", "delta": "0:00:00.113043", "end": "2019-11-18 01:12:33.629836", "item": [{"bridge_name": "t4br1", "default_route_ip": "10.1.31.1", "dns": [{"brif": "t4s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t4s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t4ns1", "route": [{"if": "p1", "ip": "10.1.31.1/24", "ns_if": "t4if", "ns_name": "t4"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t4ns1if", "tenant_ns_ip": "10.1.31.1/24", "tenant_ns_name": "t4", "tenant_sub_if": "t4s1if", "tenant_sub_ip": "10.1.31.2/24"}], "vxlan": [{"dev": "t4s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.31.2", "remote_ip": "10.2.31.2", "remote_route": "10.2.31.0/24", "subnet_route": "10.1.31.0/24", "tenant_route_ip": "192.168.4.2", "v_name": "vxlan_t4s1"}]}, {"brif": "t4br1if2", "disk": "10G", "mem": 4, "name": "t4_VM2", "vcpu": 2, "vmif": "t4VM2if1"}], "rc": 0, "start": "2019-11-18 01:12:33.516793", "stderr": "", "stderr_lines": [], "stdout": "52: t4br1if2@t4VM2if1: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP mode DEFAULT group default qlen 1000\n    link/ether 2e:85:19:ed:08:ce brd ff:ff:ff:ff:ff:ff", "stdout_lines": ["52: t4br1if2@t4VM2if1: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP mode DEFAULT group default qlen 1000", "    link/ether 2e:85:19:ed:08:ce brd ff:ff:ff:ff:ff:ff"]}
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.32.1/24', u'ns_name': u't4', u'ns_if': u't4if', u'if': u'p1'}], u'default_route_ip': u'10.1.32.1', u'bridge_name': u't4br2', u'dns': [{u'dnsif': u't4s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't4s2_dnsbrif'}], u'ns_name': u't4ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.32.2/24', u'tenant_ns_ip': u'10.1.32.1/24', u'tenant_ns_if': u't4ns2if', u'tenant_sub_if': u't4s2if', u'tenant_ns_name': u't4'}], u'subnet_ip': u'2.2.2.0/24', u'vxlan': [{u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}, {u'mem': 3, u'name': u't4_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't4br2if1', u'vmif': u't4VM3if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip link show \"t4br2if1\" ; if [ $? -eq 0 ] ; then ip link set \"t4br2if1\" netns \"t4ns2\" ; fi\nip netns exec \"t4ns2\" brctl show \"t4br2\" | grep -w 't4br2if1' ; if [ $? -ne 0 ] ; then ip netns exec \"t4ns2\" brctl addif \"t4br2\" \"t4br2if1\" ; fi\n", "delta": "0:00:00.097838", "end": "2019-11-18 01:12:33.953715", "item": [{"bridge_name": "t4br2", "default_route_ip": "10.1.32.1", "dns": [{"brif": "t4s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t4s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t4ns2", "route": [{"if": "p1", "ip": "10.1.32.1/24", "ns_if": "t4if", "ns_name": "t4"}], "subnet_ip": "2.2.2.0/24", "tenant_ns": [{"tenant_ns_if": "t4ns2if", "tenant_ns_ip": "10.1.32.1/24", "tenant_ns_name": "t4", "tenant_sub_if": "t4s2if", "tenant_sub_ip": "10.1.32.2/24"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, {"brif": "t4br2if1", "disk": "10G", "mem": 3, "name": "t4_VM3", "vcpu": 2, "vmif": "t4VM3if1"}], "rc": 0, "start": "2019-11-18 01:12:33.855877", "stderr": "", "stderr_lines": [], "stdout": "54: t4br2if1@t4VM3if1: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP mode DEFAULT group default qlen 1000\n    link/ether 06:02:08:e0:4f:c4 brd ff:ff:ff:ff:ff:ff", "stdout_lines": ["54: t4br2if1@t4VM3if1: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP mode DEFAULT group default qlen 1000", "    link/ether 06:02:08:e0:4f:c4 brd ff:ff:ff:ff:ff:ff"]}

TASK [All interfaces and bridges UP] ************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.31.1/24', u'ns_name': u't4', u'ns_if': u't4if', u'if': u'p1'}], u'default_route_ip': u'10.1.31.1', u'bridge_name': u't4br1', u'dns': [{u'dnsif': u't4s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't4s1_dnsbrif'}], u'ns_name': u't4ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.31.2/24', u'tenant_ns_ip': u'10.1.31.1/24', u'tenant_ns_if': u't4ns1if', u'tenant_sub_if': u't4s1if', u'tenant_ns_name': u't4'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.1.31.2', u'dsport': 4789, u'dev': u't4s1if', u'tenant_route_ip': u'192.168.4.2', u'remote_route': u'10.2.31.0/24', u'subnet_route': u'10.1.31.0/24', u'v_name': u'vxlan_t4s1', u'id': 42, u'remote_ip': u'10.2.31.2'}]}, {u'mem': 2, u'name': u't4_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't4br1if1', u'vmif': u't4VM1if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t4ns1\" ip link set \"t4br1if1\" up\nip netns exec \"t4ns1\" ip link set dev \"t4br1\" up\n", "delta": "0:00:00.073152", "end": "2019-11-18 01:12:34.277611", "item": [{"bridge_name": "t4br1", "default_route_ip": "10.1.31.1", "dns": [{"brif": "t4s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t4s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t4ns1", "route": [{"if": "p1", "ip": "10.1.31.1/24", "ns_if": "t4if", "ns_name": "t4"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t4ns1if", "tenant_ns_ip": "10.1.31.1/24", "tenant_ns_name": "t4", "tenant_sub_if": "t4s1if", "tenant_sub_ip": "10.1.31.2/24"}], "vxlan": [{"dev": "t4s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.31.2", "remote_ip": "10.2.31.2", "remote_route": "10.2.31.0/24", "subnet_route": "10.1.31.0/24", "tenant_route_ip": "192.168.4.2", "v_name": "vxlan_t4s1"}]}, {"brif": "t4br1if1", "disk": "10G", "mem": 2, "name": "t4_VM1", "vcpu": 4, "vmif": "t4VM1if1"}], "rc": 0, "start": "2019-11-18 01:12:34.204459", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.31.1/24', u'ns_name': u't4', u'ns_if': u't4if', u'if': u'p1'}], u'default_route_ip': u'10.1.31.1', u'bridge_name': u't4br1', u'dns': [{u'dnsif': u't4s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't4s1_dnsbrif'}], u'ns_name': u't4ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.31.2/24', u'tenant_ns_ip': u'10.1.31.1/24', u'tenant_ns_if': u't4ns1if', u'tenant_sub_if': u't4s1if', u'tenant_ns_name': u't4'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.1.31.2', u'dsport': 4789, u'dev': u't4s1if', u'tenant_route_ip': u'192.168.4.2', u'remote_route': u'10.2.31.0/24', u'subnet_route': u'10.1.31.0/24', u'v_name': u'vxlan_t4s1', u'id': 42, u'remote_ip': u'10.2.31.2'}]}, {u'mem': 4, u'name': u't4_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't4br1if2', u'vmif': u't4VM2if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t4ns1\" ip link set \"t4br1if2\" up\nip netns exec \"t4ns1\" ip link set dev \"t4br1\" up\n", "delta": "0:00:00.072128", "end": "2019-11-18 01:12:34.537987", "item": [{"bridge_name": "t4br1", "default_route_ip": "10.1.31.1", "dns": [{"brif": "t4s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t4s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t4ns1", "route": [{"if": "p1", "ip": "10.1.31.1/24", "ns_if": "t4if", "ns_name": "t4"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t4ns1if", "tenant_ns_ip": "10.1.31.1/24", "tenant_ns_name": "t4", "tenant_sub_if": "t4s1if", "tenant_sub_ip": "10.1.31.2/24"}], "vxlan": [{"dev": "t4s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.31.2", "remote_ip": "10.2.31.2", "remote_route": "10.2.31.0/24", "subnet_route": "10.1.31.0/24", "tenant_route_ip": "192.168.4.2", "v_name": "vxlan_t4s1"}]}, {"brif": "t4br1if2", "disk": "10G", "mem": 4, "name": "t4_VM2", "vcpu": 2, "vmif": "t4VM2if1"}], "rc": 0, "start": "2019-11-18 01:12:34.465859", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.32.1/24', u'ns_name': u't4', u'ns_if': u't4if', u'if': u'p1'}], u'default_route_ip': u'10.1.32.1', u'bridge_name': u't4br2', u'dns': [{u'dnsif': u't4s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't4s2_dnsbrif'}], u'ns_name': u't4ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.32.2/24', u'tenant_ns_ip': u'10.1.32.1/24', u'tenant_ns_if': u't4ns2if', u'tenant_sub_if': u't4s2if', u'tenant_ns_name': u't4'}], u'subnet_ip': u'2.2.2.0/24', u'vxlan': [{u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}, {u'mem': 3, u'name': u't4_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't4br2if1', u'vmif': u't4VM3if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t4ns2\" ip link set \"t4br2if1\" up\nip netns exec \"t4ns2\" ip link set dev \"t4br2\" up\n", "delta": "0:00:00.065527", "end": "2019-11-18 01:12:34.793801", "item": [{"bridge_name": "t4br2", "default_route_ip": "10.1.32.1", "dns": [{"brif": "t4s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t4s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t4ns2", "route": [{"if": "p1", "ip": "10.1.32.1/24", "ns_if": "t4if", "ns_name": "t4"}], "subnet_ip": "2.2.2.0/24", "tenant_ns": [{"tenant_ns_if": "t4ns2if", "tenant_ns_ip": "10.1.32.1/24", "tenant_ns_name": "t4", "tenant_sub_if": "t4s2if", "tenant_sub_ip": "10.1.32.2/24"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, {"brif": "t4br2if1", "disk": "10G", "mem": 3, "name": "t4_VM3", "vcpu": 2, "vmif": "t4VM3if1"}], "rc": 0, "start": "2019-11-18 01:12:34.728274", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Add IP to DNS Interface] ******************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.31.1/24', u'ns_name': u't4', u'ns_if': u't4if', u'if': u'p1'}], u'default_route_ip': u'10.1.31.1', u'bridge_name': u't4br1', u'ns_name': u't4ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.31.2/24', u'tenant_ns_ip': u'10.1.31.1/24', u'tenant_ns_if': u't4ns1if', u'tenant_sub_if': u't4s1if', u'tenant_ns_name': u't4'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't4_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't4br1if1', u'vmif': u't4VM1if1'}, {u'mem': 4, u'name': u't4_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't4br1if2', u'vmif': u't4VM2if1'}], u'vxlan': [{u'local_ip': u'10.1.31.2', u'dsport': 4789, u'dev': u't4s1if', u'tenant_route_ip': u'192.168.4.2', u'remote_route': u'10.2.31.0/24', u'subnet_route': u'10.1.31.0/24', u'v_name': u'vxlan_t4s1', u'id': 42, u'remote_ip': u'10.2.31.2'}]}, {u'dnsif': u't4s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't4s1_dnsbrif'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t4ns1\" ip addr show \"t4s1_dnsif\" | awk 'FNR==3{ print $2 }' | grep -w '^1.1.1.1/24' ; if [ $? -ne 0 ] ; then ip netns exec \"t4ns1\" ip addr add \"1.1.1.1/24\" dev \"t4s1_dnsif\" ; fi\n", "delta": "0:00:00.074921", "end": "2019-11-18 01:12:35.145830", "item": [{"bridge_name": "t4br1", "default_route_ip": "10.1.31.1", "ns_name": "t4ns1", "route": [{"if": "p1", "ip": "10.1.31.1/24", "ns_if": "t4if", "ns_name": "t4"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t4ns1if", "tenant_ns_ip": "10.1.31.1/24", "tenant_ns_name": "t4", "tenant_sub_if": "t4s1if", "tenant_sub_ip": "10.1.31.2/24"}], "vms": [{"brif": "t4br1if1", "disk": "10G", "mem": 2, "name": "t4_VM1", "vcpu": 4, "vmif": "t4VM1if1"}, {"brif": "t4br1if2", "disk": "10G", "mem": 4, "name": "t4_VM2", "vcpu": 2, "vmif": "t4VM2if1"}], "vxlan": [{"dev": "t4s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.31.2", "remote_ip": "10.2.31.2", "remote_route": "10.2.31.0/24", "subnet_route": "10.1.31.0/24", "tenant_route_ip": "192.168.4.2", "v_name": "vxlan_t4s1"}]}, {"brif": "t4s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t4s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "rc": 0, "start": "2019-11-18 01:12:35.070909", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.32.1/24', u'ns_name': u't4', u'ns_if': u't4if', u'if': u'p1'}], u'default_route_ip': u'10.1.32.1', u'bridge_name': u't4br2', u'ns_name': u't4ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.32.2/24', u'tenant_ns_ip': u'10.1.32.1/24', u'tenant_ns_if': u't4ns2if', u'tenant_sub_if': u't4s2if', u'tenant_ns_name': u't4'}], u'subnet_ip': u'2.2.2.0/24', u'vms': [{u'mem': 3, u'name': u't4_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't4br2if1', u'vmif': u't4VM3if1'}], u'vxlan': [{u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}, {u'dnsif': u't4s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't4s2_dnsbrif'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t4ns2\" ip addr show \"t4s2_dnsif\" | awk 'FNR==3{ print $2 }' | grep -w '^2.2.2.1/24' ; if [ $? -ne 0 ] ; then ip netns exec \"t4ns2\" ip addr add \"2.2.2.1/24\" dev \"t4s2_dnsif\" ; fi\n", "delta": "0:00:00.090590", "end": "2019-11-18 01:12:35.465968", "item": [{"bridge_name": "t4br2", "default_route_ip": "10.1.32.1", "ns_name": "t4ns2", "route": [{"if": "p1", "ip": "10.1.32.1/24", "ns_if": "t4if", "ns_name": "t4"}], "subnet_ip": "2.2.2.0/24", "tenant_ns": [{"tenant_ns_if": "t4ns2if", "tenant_ns_ip": "10.1.32.1/24", "tenant_ns_name": "t4", "tenant_sub_if": "t4s2if", "tenant_sub_ip": "10.1.32.2/24"}], "vms": [{"brif": "t4br2if1", "disk": "10G", "mem": 3, "name": "t4_VM3", "vcpu": 2, "vmif": "t4VM3if1"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, {"brif": "t4s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t4s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "rc": 0, "start": "2019-11-18 01:12:35.375378", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Install DHCP Server] **********************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.31.1/24', u'ns_name': u't4', u'ns_if': u't4if', u'if': u'p1'}], u'default_route_ip': u'10.1.31.1', u'bridge_name': u't4br1', u'ns_name': u't4ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.31.2/24', u'tenant_ns_ip': u'10.1.31.1/24', u'tenant_ns_if': u't4ns1if', u'tenant_sub_if': u't4s1if', u'tenant_ns_name': u't4'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't4_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't4br1if1', u'vmif': u't4VM1if1'}, {u'mem': 4, u'name': u't4_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't4br1if2', u'vmif': u't4VM2if1'}], u'vxlan': [{u'local_ip': u'10.1.31.2', u'dsport': 4789, u'dev': u't4s1if', u'tenant_route_ip': u'192.168.4.2', u'remote_route': u'10.2.31.0/24', u'subnet_route': u'10.1.31.0/24', u'v_name': u'vxlan_t4s1', u'id': 42, u'remote_ip': u'10.2.31.2'}]}, {u'dnsif': u't4s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't4s1_dnsbrif'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t4ns1\" ps aux | grep -w '[d]nsmasq --interface t4s1_dnsif -z --dhcp-range=1.1.1.5,1.1.1.126' ; if [ $? -ne 0 ] ; then ip netns exec \"t4ns1\" dnsmasq --interface \"t4s1_dnsif\" -z --dhcp-range=1.1.1.5,'1.1.1.126' ; fi\n", "delta": "0:00:00.085623", "end": "2019-11-18 01:12:35.843463", "item": [{"bridge_name": "t4br1", "default_route_ip": "10.1.31.1", "ns_name": "t4ns1", "route": [{"if": "p1", "ip": "10.1.31.1/24", "ns_if": "t4if", "ns_name": "t4"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t4ns1if", "tenant_ns_ip": "10.1.31.1/24", "tenant_ns_name": "t4", "tenant_sub_if": "t4s1if", "tenant_sub_ip": "10.1.31.2/24"}], "vms": [{"brif": "t4br1if1", "disk": "10G", "mem": 2, "name": "t4_VM1", "vcpu": 4, "vmif": "t4VM1if1"}, {"brif": "t4br1if2", "disk": "10G", "mem": 4, "name": "t4_VM2", "vcpu": 2, "vmif": "t4VM2if1"}], "vxlan": [{"dev": "t4s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.31.2", "remote_ip": "10.2.31.2", "remote_route": "10.2.31.0/24", "subnet_route": "10.1.31.0/24", "tenant_route_ip": "192.168.4.2", "v_name": "vxlan_t4s1"}]}, {"brif": "t4s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t4s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "rc": 0, "start": "2019-11-18 01:12:35.757840", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.32.1/24', u'ns_name': u't4', u'ns_if': u't4if', u'if': u'p1'}], u'default_route_ip': u'10.1.32.1', u'bridge_name': u't4br2', u'ns_name': u't4ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.32.2/24', u'tenant_ns_ip': u'10.1.32.1/24', u'tenant_ns_if': u't4ns2if', u'tenant_sub_if': u't4s2if', u'tenant_ns_name': u't4'}], u'subnet_ip': u'2.2.2.0/24', u'vms': [{u'mem': 3, u'name': u't4_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't4br2if1', u'vmif': u't4VM3if1'}], u'vxlan': [{u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}, {u'dnsif': u't4s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't4s2_dnsbrif'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t4ns2\" ps aux | grep -w '[d]nsmasq --interface t4s2_dnsif -z --dhcp-range=2.2.2.5,2.2.2.254' ; if [ $? -ne 0 ] ; then ip netns exec \"t4ns2\" dnsmasq --interface \"t4s2_dnsif\" -z --dhcp-range=2.2.2.5,'2.2.2.254' ; fi\n", "delta": "0:00:00.062457", "end": "2019-11-18 01:12:36.138775", "item": [{"bridge_name": "t4br2", "default_route_ip": "10.1.32.1", "ns_name": "t4ns2", "route": [{"if": "p1", "ip": "10.1.32.1/24", "ns_if": "t4if", "ns_name": "t4"}], "subnet_ip": "2.2.2.0/24", "tenant_ns": [{"tenant_ns_if": "t4ns2if", "tenant_ns_ip": "10.1.32.1/24", "tenant_ns_name": "t4", "tenant_sub_if": "t4s2if", "tenant_sub_ip": "10.1.32.2/24"}], "vms": [{"brif": "t4br2if1", "disk": "10G", "mem": 3, "name": "t4_VM3", "vcpu": 2, "vmif": "t4VM3if1"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, {"brif": "t4s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t4s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "rc": 0, "start": "2019-11-18 01:12:36.076318", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Create VXLAN devices] *********************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.31.1/24', u'ns_name': u't4', u'ns_if': u't4if', u'if': u'p1'}], u'default_route_ip': u'10.1.31.1', u'bridge_name': u't4br1', u'dns': [{u'dnsif': u't4s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't4s1_dnsbrif'}], u'ns_name': u't4ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.31.2/24', u'tenant_ns_ip': u'10.1.31.1/24', u'tenant_ns_if': u't4ns1if', u'tenant_sub_if': u't4s1if', u'tenant_ns_name': u't4'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't4_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't4br1if1', u'vmif': u't4VM1if1'}, {u'mem': 4, u'name': u't4_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't4br1if2', u'vmif': u't4VM2if1'}]}, {u'local_ip': u'10.1.31.2', u'dsport': 4789, u'dev': u't4s1if', u'tenant_route_ip': u'192.168.4.2', u'remote_route': u'10.2.31.0/24', u'subnet_route': u'10.1.31.0/24', u'v_name': u'vxlan_t4s1', u'id': 42, u'remote_ip': u'10.2.31.2'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t4ns1\" ip link show \"vxlan_t4s1\" ; if [ $? -ne 0 ] ; then ip netns exec \"t4ns1\" ip link add \"vxlan_t4s1\" type vxlan id \"42\" local \"10.1.31.2\" remote \"10.2.31.2\" dstport \"4789\" dev \"t4s1if\"; ip netns exec \"t4ns1\" ip link set dev \"vxlan_t4s1\" up ; fi\n", "delta": "0:00:00.113489", "end": "2019-11-18 01:12:36.557886", "item": [{"bridge_name": "t4br1", "default_route_ip": "10.1.31.1", "dns": [{"brif": "t4s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t4s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t4ns1", "route": [{"if": "p1", "ip": "10.1.31.1/24", "ns_if": "t4if", "ns_name": "t4"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t4ns1if", "tenant_ns_ip": "10.1.31.1/24", "tenant_ns_name": "t4", "tenant_sub_if": "t4s1if", "tenant_sub_ip": "10.1.31.2/24"}], "vms": [{"brif": "t4br1if1", "disk": "10G", "mem": 2, "name": "t4_VM1", "vcpu": 4, "vmif": "t4VM1if1"}, {"brif": "t4br1if2", "disk": "10G", "mem": 4, "name": "t4_VM2", "vcpu": 2, "vmif": "t4VM2if1"}]}, {"dev": "t4s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.31.2", "remote_ip": "10.2.31.2", "remote_route": "10.2.31.0/24", "subnet_route": "10.1.31.0/24", "tenant_route_ip": "192.168.4.2", "v_name": "vxlan_t4s1"}], "rc": 0, "start": "2019-11-18 01:12:36.444397", "stderr": "Device \"vxlan_t4s1\" does not exist.", "stderr_lines": ["Device \"vxlan_t4s1\" does not exist."], "stdout": "", "stdout_lines": []}
skipping: [localhost] => (item=[{u'route': [{u'ip': u'10.1.32.1/24', u'ns_name': u't4', u'ns_if': u't4if', u'if': u'p1'}], u'default_route_ip': u'10.1.32.1', u'bridge_name': u't4br2', u'dns': [{u'dnsif': u't4s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't4s2_dnsbrif'}], u'ns_name': u't4ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.32.2/24', u'tenant_ns_ip': u'10.1.32.1/24', u'tenant_ns_if': u't4ns2if', u'tenant_sub_if': u't4s2if', u'tenant_ns_name': u't4'}], u'subnet_ip': u'2.2.2.0/24', u'vms': [{u'mem': 3, u'name': u't4_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't4br2if1', u'vmif': u't4VM3if1'}]}, {u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}])  => {"ansible_loop_var": "item", "changed": false, "item": [{"bridge_name": "t4br2", "default_route_ip": "10.1.32.1", "dns": [{"brif": "t4s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t4s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t4ns2", "route": [{"if": "p1", "ip": "10.1.32.1/24", "ns_if": "t4if", "ns_name": "t4"}], "subnet_ip": "2.2.2.0/24", "tenant_ns": [{"tenant_ns_if": "t4ns2if", "tenant_ns_ip": "10.1.32.1/24", "tenant_ns_name": "t4", "tenant_sub_if": "t4s2if", "tenant_sub_ip": "10.1.32.2/24"}], "vms": [{"brif": "t4br2if1", "disk": "10G", "mem": 3, "name": "t4_VM3", "vcpu": 2, "vmif": "t4VM3if1"}]}, {"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}], "skip_reason": "Conditional result was False"}

TASK [Attach VXLANs to bridge] ******************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.31.1/24', u'ns_name': u't4', u'ns_if': u't4if', u'if': u'p1'}], u'default_route_ip': u'10.1.31.1', u'bridge_name': u't4br1', u'dns': [{u'dnsif': u't4s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't4s1_dnsbrif'}], u'ns_name': u't4ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.31.2/24', u'tenant_ns_ip': u'10.1.31.1/24', u'tenant_ns_if': u't4ns1if', u'tenant_sub_if': u't4s1if', u'tenant_ns_name': u't4'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't4_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't4br1if1', u'vmif': u't4VM1if1'}, {u'mem': 4, u'name': u't4_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't4br1if2', u'vmif': u't4VM2if1'}]}, {u'local_ip': u'10.1.31.2', u'dsport': 4789, u'dev': u't4s1if', u'tenant_route_ip': u'192.168.4.2', u'remote_route': u'10.2.31.0/24', u'subnet_route': u'10.1.31.0/24', u'v_name': u'vxlan_t4s1', u'id': 42, u'remote_ip': u'10.2.31.2'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t4ns1\" brctl show \"t4br1\" | grep -w 'vxlan_t4s1' ; if [ $? -ne 0 ] ; then ip netns exec \"t4ns1\" brctl addif \"t4br1\" \"vxlan_t4s1\" ; fi\n", "delta": "0:00:00.087981", "end": "2019-11-18 01:12:36.978248", "item": [{"bridge_name": "t4br1", "default_route_ip": "10.1.31.1", "dns": [{"brif": "t4s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t4s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t4ns1", "route": [{"if": "p1", "ip": "10.1.31.1/24", "ns_if": "t4if", "ns_name": "t4"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t4ns1if", "tenant_ns_ip": "10.1.31.1/24", "tenant_ns_name": "t4", "tenant_sub_if": "t4s1if", "tenant_sub_ip": "10.1.31.2/24"}], "vms": [{"brif": "t4br1if1", "disk": "10G", "mem": 2, "name": "t4_VM1", "vcpu": 4, "vmif": "t4VM1if1"}, {"brif": "t4br1if2", "disk": "10G", "mem": 4, "name": "t4_VM2", "vcpu": 2, "vmif": "t4VM2if1"}]}, {"dev": "t4s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.31.2", "remote_ip": "10.2.31.2", "remote_route": "10.2.31.0/24", "subnet_route": "10.1.31.0/24", "tenant_route_ip": "192.168.4.2", "v_name": "vxlan_t4s1"}], "rc": 0, "start": "2019-11-18 01:12:36.890267", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}
skipping: [localhost] => (item=[{u'route': [{u'ip': u'10.1.32.1/24', u'ns_name': u't4', u'ns_if': u't4if', u'if': u'p1'}], u'default_route_ip': u'10.1.32.1', u'bridge_name': u't4br2', u'dns': [{u'dnsif': u't4s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't4s2_dnsbrif'}], u'ns_name': u't4ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.32.2/24', u'tenant_ns_ip': u'10.1.32.1/24', u'tenant_ns_if': u't4ns2if', u'tenant_sub_if': u't4s2if', u'tenant_ns_name': u't4'}], u'subnet_ip': u'2.2.2.0/24', u'vms': [{u'mem': 3, u'name': u't4_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't4br2if1', u'vmif': u't4VM3if1'}]}, {u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}])  => {"ansible_loop_var": "item", "changed": false, "item": [{"bridge_name": "t4br2", "default_route_ip": "10.1.32.1", "dns": [{"brif": "t4s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t4s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t4ns2", "route": [{"if": "p1", "ip": "10.1.32.1/24", "ns_if": "t4if", "ns_name": "t4"}], "subnet_ip": "2.2.2.0/24", "tenant_ns": [{"tenant_ns_if": "t4ns2if", "tenant_ns_ip": "10.1.32.1/24", "tenant_ns_name": "t4", "tenant_sub_if": "t4s2if", "tenant_sub_ip": "10.1.32.2/24"}], "vms": [{"brif": "t4br2if1", "disk": "10G", "mem": 3, "name": "t4_VM3", "vcpu": 2, "vmif": "t4VM3if1"}]}, {"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}], "skip_reason": "Conditional result was False"}

PLAY RECAP **************************************************************************************************************************************************
localhost                  : ok=21   changed=21   unreachable=0    failed=0    skipped=0    rescued=0    ignored=0   

INFO:root: 01:21:18.862390 Printing the yaml input file
INFO:root: 01:21:18.862543 {'C1': [{'subnet_addr': '1.1.1.0/24', 'VM': [{'name': 'VM1', 'disk': '10G', 'mem': 2, 'vcpu': 4}, {'name': 'VM2', 'disk': '10G', 'mem': 4, 'vcpu': 2}]}, {'subnet_addr': '2.2.2.0/24', 'VM': [{'name': 'VM3', 'disk': '10G', 'mem': 3, 'vcpu': 2}]}], 'C2': [{'subnet_addr': '1.1.1.0/24', 'VM': [{'name': 'VM4', 'disk': '10G', 'mem': 2, 'vcpu': 4}]}]}
INFO:root: 01:21:18.862643 Provided subnet in C1: 1.1.1.0/24 is valid
INFO:root: 01:21:18.862690 Provided subnet in C1: 2.2.2.0/24 is valid
INFO:root: 01:21:18.862731 Provided subnet in C2: 1.1.1.0/24 is valid
Using /etc/ansible/ansible.cfg as config file

PLAY [main] *************************************************************************************************************************************************

TASK [Create Tenant Namespace] ******************************************************************************************************************************
failed: [localhost] (item={u'default_route_ip': u'192.168.5.1', u'name': u't5', u'pns_ip': u'192.168.5.1/24', u'tenant_if': u't5if', u'tenant_ip': u'192.168.5.2/24', u'pns_if': u't5pns_if'}) => {"ansible_loop_var": "item", "changed": true, "cmd": ["ip", "nlsjdifgjfdbgetns", "add", "t5"], "delta": "0:00:00.003089", "end": "2019-11-18 01:21:19.980098", "item": {"default_route_ip": "192.168.5.1", "name": "t5", "pns_if": "t5pns_if", "pns_ip": "192.168.5.1/24", "tenant_if": "t5if", "tenant_ip": "192.168.5.2/24"}, "msg": "non-zero return code", "rc": 1, "start": "2019-11-18 01:21:19.977009", "stderr": "Object \"nlsjdifgjfdbgetns\" is unknown, try \"ip help\".", "stderr_lines": ["Object \"nlsjdifgjfdbgetns\" is unknown, try \"ip help\"."], "stdout": "", "stdout_lines": []}

PLAY RECAP **************************************************************************************************************************************************
localhost                  : ok=0    changed=0    unreachable=0    failed=1    skipped=0    rescued=0    ignored=0   

INFO:root: 01:22:03.516452 Printing the yaml input file
INFO:root: 01:22:03.516553 {'C1': [{'subnet_addr': '1.1.1.0/24', 'VM': [{'name': 'VM1', 'disk': '10G', 'mem': 2, 'vcpu': 4}, {'name': 'VM2', 'disk': '10G', 'mem': 4, 'vcpu': 2}]}, {'subnet_addr': '2.2.2.0/24', 'VM': [{'name': 'VM3', 'disk': '10G', 'mem': 3, 'vcpu': 2}]}], 'C2': [{'subnet_addr': '1.1.1.0/24', 'VM': [{'name': 'VM4', 'disk': '10G', 'mem': 2, 'vcpu': 4}]}]}
INFO:root: 01:22:03.516640 Provided subnet in C1: 1.1.1.0/24 is valid
INFO:root: 01:22:03.516688 Provided subnet in C1: 2.2.2.0/24 is valid
INFO:root: 01:22:03.516730 Provided subnet in C2: 1.1.1.0/24 is valid
Using /etc/ansible/ansible.cfg as config file

PLAY [main] *************************************************************************************************************************************************

TASK [Create Tenant Namespace] ******************************************************************************************************************************
failed: [localhost] (item={u'default_route_ip': u'192.168.6.1', u'name': u't6', u'pns_ip': u'192.168.6.1/24', u'tenant_if': u't6if', u'tenant_ip': u'192.168.6.2/24', u'pns_if': u't6pns_if'}) => {"ansible_loop_var": "item", "changed": true, "cmd": ["ip", "nlsjdifgjfdbgetns", "add", "t6"], "delta": "0:00:00.002987", "end": "2019-11-18 01:22:04.595374", "item": {"default_route_ip": "192.168.6.1", "name": "t6", "pns_if": "t6pns_if", "pns_ip": "192.168.6.1/24", "tenant_if": "t6if", "tenant_ip": "192.168.6.2/24"}, "msg": "non-zero return code", "rc": 1, "start": "2019-11-18 01:22:04.592387", "stderr": "Object \"nlsjdifgjfdbgetns\" is unknown, try \"ip help\".", "stderr_lines": ["Object \"nlsjdifgjfdbgetns\" is unknown, try \"ip help\"."], "stdout": "", "stdout_lines": []}

PLAY RECAP **************************************************************************************************************************************************
localhost                  : ok=0    changed=0    unreachable=0    failed=1    skipped=0    rescued=0    ignored=0   

INFO:root: 01:23:28.139104 Printing the yaml input file
INFO:root: 01:23:28.139212 {'C1': [{'subnet_addr': '1.1.1.0/24', 'VM': [{'name': 'VM1', 'disk': '10G', 'mem': 2, 'vcpu': 4}, {'name': 'VM2', 'disk': '10G', 'mem': 4, 'vcpu': 2}]}, {'subnet_addr': '2.2.2.0/24', 'VM': [{'name': 'VM3', 'disk': '10G', 'mem': 3, 'vcpu': 2}]}], 'C2': [{'subnet_addr': '1.1.1.0/24', 'VM': [{'name': 'VM4', 'disk': '10G', 'mem': 2, 'vcpu': 4}]}]}
INFO:root: 01:23:28.139303 Provided subnet in C1: 1.1.1.0/24 is valid
INFO:root: 01:23:28.139354 Provided subnet in C1: 2.2.2.0/24 is valid
INFO:root: 01:23:28.139399 Provided subnet in C2: 1.1.1.0/24 is valid
Using /etc/ansible/ansible.cfg as config file

PLAY [main] *************************************************************************************************************************************************

TASK [Create Tenant Namespace] ******************************************************************************************************************************
failed: [localhost] (item={u'default_route_ip': u'192.168.7.1', u'name': u't7', u'pns_ip': u'192.168.7.1/24', u'tenant_if': u't7if', u'tenant_ip': u'192.168.7.2/24', u'pns_if': u't7pns_if'}) => {"ansible_loop_var": "item", "changed": true, "cmd": ["ip", "nlsjdifgjfdbgetns", "add", "t7"], "delta": "0:00:00.003046", "end": "2019-11-18 01:23:29.215747", "item": {"default_route_ip": "192.168.7.1", "name": "t7", "pns_if": "t7pns_if", "pns_ip": "192.168.7.1/24", "tenant_if": "t7if", "tenant_ip": "192.168.7.2/24"}, "msg": "non-zero return code", "rc": 1, "start": "2019-11-18 01:23:29.212701", "stderr": "Object \"nlsjdifgjfdbgetns\" is unknown, try \"ip help\".", "stderr_lines": ["Object \"nlsjdifgjfdbgetns\" is unknown, try \"ip help\"."], "stdout": "", "stdout_lines": []}

PLAY RECAP **************************************************************************************************************************************************
localhost                  : ok=0    changed=0    unreachable=0    failed=1    skipped=0    rescued=0    ignored=0   

INFO:root: 01:29:24.884487 Printing the yaml input file
INFO:root: 01:29:24.884603 {'C1': [{'subnet_addr': '1.1.1.0/24', 'VM': [{'name': 'VM1', 'disk': '10G', 'mem': 2, 'vcpu': 4}, {'name': 'VM2', 'disk': '10G', 'mem': 4, 'vcpu': 2}]}, {'subnet_addr': '1.1.1.0/24', 'VM': [{'name': 'VM3', 'disk': '10G', 'mem': 3, 'vcpu': 2}]}], 'C2': [{'subnet_addr': '1.1.1.0/24', 'VM': [{'name': 'VM4', 'disk': '10G', 'mem': 2, 'vcpu': 4}]}]}
INFO:root: 01:29:24.884693 Provided subnet in C1: 1.1.1.0/24 is valid
INFO:root: 01:29:24.884743 Provided subnet in C1: 1.1.1.0/24 is valid
ERROR:root: 01:29:24.884775Multiple subnet in the C1 are same
INFO:root: 01:29:41.901960 Printing the yaml input file
INFO:root: 01:29:41.902100 {'C1': [{'subnet_addr': '1.1.1.0/24', 'VM': [{'name': 'VM1', 'disk': '10G', 'mem': 2, 'vcpu': 4}, {'name': 'VM2', 'disk': '10G', 'mem': 4, 'vcpu': 2}]}, {'subnet_addr': '1.1.1.0/24', 'VM': [{'name': 'VM3', 'disk': '10G', 'mem': 3, 'vcpu': 2}]}], 'C2': [{'subnet_addr': '1.1.1.0/24', 'VM': [{'name': 'VM4', 'disk': '10G', 'mem': 2, 'vcpu': 4}]}]}
INFO:root: 01:29:41.902199 Provided subnet in C1: 1.1.1.0/24 is valid
INFO:root: 01:29:41.902245 Provided subnet in C1: 1.1.1.0/24 is valid
ERROR:root: 01:29:41.902274Multiple subnet in the C1 are same
INFO:root: 01:30:03.360679 Printing the yaml input file
INFO:root: 01:30:03.360821 {'C1': [{'subnet_addr': '1.1.1.0/24', 'VM': [{'name': 'VM1', 'disk': '10G', 'mem': 2, 'vcpu': 4}, {'name': 'VM2', 'disk': '10G', 'mem': 4, 'vcpu': 2}]}, {'subnet_addr': '2.2.2.0/24', 'VM': [{'name': 'VM3', 'disk': '10G', 'mem': 3, 'vcpu': 2}]}], 'C2': [{'subnet_addr': '1.1.1.0/24', 'VM': [{'name': 'VM4', 'disk': '10G', 'mem': 2, 'vcpu': 4}]}]}
INFO:root: 01:30:03.360913 Provided subnet in C1: 1.1.1.0/24 is valid
INFO:root: 01:30:03.360962 Provided subnet in C1: 2.2.2.0/24 is valid
INFO:root: 01:30:03.361005 Provided subnet in C2: 1.1.1.0/24 is valid
