Using /etc/ansible/ansible.cfg as config file
Using /etc/ansible/ansible.cfg as config file
Using /etc/ansible/ansible.cfg as config file

PLAY [main] *************************************************************************************************************************************************

TASK [Detach Interface] *************************************************************************************************************************************
changed: [localhost] => (item=[{u'ns_name': u't3ns1', u'bridge_name': u't3br1'}, {u'vmif_m': u't3VM2if1_m', u'vm_mac': u'52:54:00:5f:95:a9', u'name': u't3_VM2', u'vmif': u't3VM2if1', u'brif_m': u't3br1if2_m'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "virsh domiflist \"t3_VM2\" | grep -w \"t3VM2if1\" ; if [ $? -eq 0 ] ; then virsh detach-interface --domain \"t3_VM2\" --type direct --config ; fi\n", "delta": "0:00:00.046949", "end": "2019-12-05 18:05:28.526262", "item": [{"bridge_name": "t3br1", "ns_name": "t3ns1"}, {"brif_m": "t3br1if2_m", "name": "t3_VM2", "vm_mac": "52:54:00:5f:95:a9", "vmif": "t3VM2if1", "vmif_m": "t3VM2if1_m"}], "rc": 0, "start": "2019-12-05 18:05:28.479313", "stderr": "", "stderr_lines": [], "stdout": "macvtap5   direct     t3VM2if1   rtl8139     52:54:00:5f:95:a9\nInterface detached successfully", "stdout_lines": ["macvtap5   direct     t3VM2if1   rtl8139     52:54:00:5f:95:a9", "Interface detached successfully"]}

TASK [Shutdown VMs] *****************************************************************************************************************************************
changed: [localhost] => (item=[{u'ns_name': u't3ns1', u'bridge_name': u't3br1'}, {u'vmif_m': u't3VM2if1_m', u'vm_mac': u'52:54:00:5f:95:a9', u'name': u't3_VM2', u'vmif': u't3VM2if1', u'brif_m': u't3br1if2_m'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "virsh list --state-shutoff | grep -w \"t3_VM2\" ; if [ $? -ne 0 ] ; then virsh shutdown \"t3_VM2\" ; fi\n", "delta": "0:00:00.114995", "end": "2019-12-05 18:05:28.883956", "item": [{"bridge_name": "t3br1", "ns_name": "t3ns1"}, {"brif_m": "t3br1if2_m", "name": "t3_VM2", "vm_mac": "52:54:00:5f:95:a9", "vmif": "t3VM2if1", "vmif_m": "t3VM2if1_m"}], "rc": 0, "start": "2019-12-05 18:05:28.768961", "stderr": "", "stderr_lines": [], "stdout": "Domain t3_VM2 is being shutdown", "stdout_lines": ["Domain t3_VM2 is being shutdown"]}

TASK [Remove TEMP files] ************************************************************************************************************************************
changed: [localhost] => {"changed": true, "path": "/root/.ansible/tmp/", "state": "absent"}

PLAY [worker] ***********************************************************************************************************************************************

TASK [Remove TEMP files] ************************************************************************************************************************************
changed: [99.99.99.2] => {"changed": true, "path": "/root/.ansible/tmp/", "state": "absent"}

TASK [Migrate VM images] ************************************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'ns_name': u't3ns1', u'bridge_name': u't3br1'}, {u'vmif_m': u't3VM2if1_m', u'vm_mac': u'52:54:00:5f:95:a9', u'name': u't3_VM2', u'vmif': u't3VM2if1', u'brif_m': u't3br1if2_m'}]) => {"ansible_loop_var": "item", "attempts": 1, "changed": true, "checksum": "13712f383d49b35d65df249a56a8aad030c12c31", "dest": "/var/lib/libvirt/images/t3_VM2.qcow2", "gid": 0, "group": "root", "item": [{"bridge_name": "t3br1", "ns_name": "t3ns1"}, {"brif_m": "t3br1if2_m", "name": "t3_VM2", "vm_mac": "52:54:00:5f:95:a9", "vmif": "t3VM2if1", "vmif_m": "t3VM2if1_m"}], "md5sum": "ff2a8d313eb8caad3382d66c023b40b2", "mode": "0644", "owner": "root", "size": 10739318784, "src": "/root/.ansible/tmp/ansible-tmp-1575569131.42-193590209332902/source", "state": "file", "uid": 0}

TASK [Migrate VM templates] *********************************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'ns_name': u't3ns1', u'bridge_name': u't3br1'}, {u'vmif_m': u't3VM2if1_m', u'vm_mac': u'52:54:00:5f:95:a9', u'name': u't3_VM2', u'vmif': u't3VM2if1', u'brif_m': u't3br1if2_m'}]) => {"ansible_loop_var": "item", "changed": true, "checksum": "130b1886a3e545ef1077bc382f7b55418fa99d87", "dest": "/etc/libvirt/qemu/t3_VM2.xml", "gid": 0, "group": "root", "item": [{"bridge_name": "t3br1", "ns_name": "t3ns1"}, {"brif_m": "t3br1if2_m", "name": "t3_VM2", "vm_mac": "52:54:00:5f:95:a9", "vmif": "t3VM2if1", "vmif_m": "t3VM2if1_m"}], "md5sum": "269bb662153c849e6f97be4365acd1e0", "mode": "0644", "owner": "root", "size": 4252, "src": "/root/.ansible/tmp/ansible-tmp-1575569410.86-135676073074719/source", "state": "file", "uid": 0}

TASK [Get list of running VMs] ******************************************************************************************************************************
ok: [99.99.99.2] => {"changed": false, "cmd": ["virsh", "list", "--name"], "delta": "0:00:00.019732", "end": "2019-12-05 18:10:11.899907", "rc": 0, "start": "2019-12-05 18:10:11.880175", "stderr": "", "stderr_lines": [], "stdout": "t3_VM4\nt3_VM3", "stdout_lines": ["t3_VM4", "t3_VM3"]}

TASK [Define VM] ********************************************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'ns_name': u't3ns1', u'bridge_name': u't3br1'}, {u'vmif_m': u't3VM2if1_m', u'vm_mac': u'52:54:00:5f:95:a9', u'name': u't3_VM2', u'vmif': u't3VM2if1', u'brif_m': u't3br1if2_m'}]) => {"ansible_loop_var": "item", "changed": true, "created": "t3_VM2", "item": [{"bridge_name": "t3br1", "ns_name": "t3ns1"}, {"brif_m": "t3br1if2_m", "name": "t3_VM2", "vm_mac": "52:54:00:5f:95:a9", "vmif": "t3VM2if1", "vmif_m": "t3VM2if1_m"}], "warnings": ["'xml' is given - ignoring 'name'"]}

TASK [Create VM] ********************************************************************************************************************************************
ok: [99.99.99.2] => (item=[{u'ns_name': u't3ns1', u'bridge_name': u't3br1'}, {u'vmif_m': u't3VM2if1_m', u'vm_mac': u'52:54:00:5f:95:a9', u'name': u't3_VM2', u'vmif': u't3VM2if1', u'brif_m': u't3br1if2_m'}]) => {"ansible_loop_var": "item", "changed": false, "create": 0, "item": [{"bridge_name": "t3br1", "ns_name": "t3ns1"}, {"brif_m": "t3br1if2_m", "name": "t3_VM2", "vm_mac": "52:54:00:5f:95:a9", "vmif": "t3VM2if1", "vmif_m": "t3VM2if1_m"}]}

TASK [Start VM] *********************************************************************************************************************************************
ok: [99.99.99.2] => (item=[{u'ns_name': u't3ns1', u'bridge_name': u't3br1'}, {u'vmif_m': u't3VM2if1_m', u'vm_mac': u'52:54:00:5f:95:a9', u'name': u't3_VM2', u'vmif': u't3VM2if1', u'brif_m': u't3br1if2_m'}]) => {"ansible_loop_var": "item", "changed": false, "item": [{"bridge_name": "t3br1", "ns_name": "t3ns1"}, {"brif_m": "t3br1if2_m", "name": "t3_VM2", "vm_mac": "52:54:00:5f:95:a9", "vmif": "t3VM2if1", "vmif_m": "t3VM2if1_m"}]}

TASK [Create VETH Pairs] ************************************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'ns_name': u't3ns1', u'bridge_name': u't3br1'}, {u'vmif_m': u't3VM2if1_m', u'vm_mac': u'52:54:00:5f:95:a9', u'name': u't3_VM2', u'vmif': u't3VM2if1', u'brif_m': u't3br1if2_m'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip link show \"t3br1if2_m\" ; if [ $? -ne 0 ] ; then ip link add \"t3VM2if1_m\" type veth peer name \"t3br1if2_m\" ; fi\nip link set dev \"t3br1if2_m\" up\nip link set dev \"t3VM2if1_m\" up\n", "delta": "0:00:00.017176", "end": "2019-12-05 18:10:14.446448", "item": [{"bridge_name": "t3br1", "ns_name": "t3ns1"}, {"brif_m": "t3br1if2_m", "name": "t3_VM2", "vm_mac": "52:54:00:5f:95:a9", "vmif": "t3VM2if1", "vmif_m": "t3VM2if1_m"}], "rc": 0, "start": "2019-12-05 18:10:14.429272", "stderr": "Device \"t3br1if2_m\" does not exist.", "stderr_lines": ["Device \"t3br1if2_m\" does not exist."], "stdout": "", "stdout_lines": []}

TASK [Attach VETH Pairs] ************************************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'ns_name': u't3ns1', u'bridge_name': u't3br1'}, {u'vmif_m': u't3VM2if1_m', u'vm_mac': u'52:54:00:5f:95:a9', u'name': u't3_VM2', u'vmif': u't3VM2if1', u'brif_m': u't3br1if2_m'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip link show \"t3br1if2_m\" ; if [ $? -eq 0 ] ; then ip link set \"t3br1if2_m\" netns \"t3ns1\" ; fi\nip netns exec \"t3ns1\" brctl show \"t3br1\" | grep -w 't3br1if2_m' ; if [ $? -ne 0 ] ; then ip netns exec \"t3ns1\" brctl addif \"t3br1\" \"t3br1if2_m\" ; fi\nvirsh domiflist \"t3_VM2\" | grep -w \"t3VM2if1_m\" ; if [ $? -ne 0 ] ; then virsh attach-interface --domain \"t3_VM2\" direct \"t3VM2if1_m\" --live --persistent --mac \"52:54:00:5f:95:a9\" ; fi\n", "delta": "0:00:00.359188", "end": "2019-12-05 18:10:15.113630", "item": [{"bridge_name": "t3br1", "ns_name": "t3ns1"}, {"brif_m": "t3br1if2_m", "name": "t3_VM2", "vm_mac": "52:54:00:5f:95:a9", "vmif": "t3VM2if1", "vmif_m": "t3VM2if1_m"}], "rc": 0, "start": "2019-12-05 18:10:14.754442", "stderr": "", "stderr_lines": [], "stdout": "27: t3br1if2_m@t3VM2if1_m: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP mode DEFAULT group default qlen 1000\n    link/ether 56:72:07:1e:a1:aa brd ff:ff:ff:ff:ff:ff\nInterface attached successfully", "stdout_lines": ["27: t3br1if2_m@t3VM2if1_m: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP mode DEFAULT group default qlen 1000", "    link/ether 56:72:07:1e:a1:aa brd ff:ff:ff:ff:ff:ff", "Interface attached successfully"]}

TASK [Make all interfaces UP] *******************************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'ns_name': u't3ns1', u'bridge_name': u't3br1'}, {u'vmif_m': u't3VM2if1_m', u'vm_mac': u'52:54:00:5f:95:a9', u'name': u't3_VM2', u'vmif': u't3VM2if1', u'brif_m': u't3br1if2_m'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t3ns1\" ip link set dev \"t3br1if2_m\" up\nip link set dev \"t3VM2if1_m\" up\n", "delta": "0:00:00.045023", "end": "2019-12-05 18:10:15.471964", "item": [{"bridge_name": "t3br1", "ns_name": "t3ns1"}, {"brif_m": "t3br1if2_m", "name": "t3_VM2", "vm_mac": "52:54:00:5f:95:a9", "vmif": "t3VM2if1", "vmif_m": "t3VM2if1_m"}], "rc": 0, "start": "2019-12-05 18:10:15.426941", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

PLAY [main] *************************************************************************************************************************************************

TASK [pause] ************************************************************************************************************************************************
Pausing for 60 seconds
(ctrl+C then 'C' = continue early, ctrl+C then 'A' = abort)
ok: [localhost] => {"changed": false, "delta": 60, "echo": true, "rc": 0, "start": "2019-12-05 18:10:15.565198", "stderr": "", "stdout": "Paused for 1.0 minutes", "stop": "2019-12-05 18:11:15.565609", "user_input": ""}

TASK [Undefine Migrated VM at C1] ***************************************************************************************************************************
changed: [localhost] => (item=[{u'ns_name': u't3ns1', u'bridge_name': u't3br1'}, {u'vmif_m': u't3VM2if1_m', u'vm_mac': u'52:54:00:5f:95:a9', u'name': u't3_VM2', u'vmif': u't3VM2if1', u'brif_m': u't3br1if2_m'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "virsh undefine \"t3_VM2\"\n", "delta": "0:00:00.032278", "end": "2019-12-05 18:11:15.886424", "item": [{"bridge_name": "t3br1", "ns_name": "t3ns1"}, {"brif_m": "t3br1if2_m", "name": "t3_VM2", "vm_mac": "52:54:00:5f:95:a9", "vmif": "t3VM2if1", "vmif_m": "t3VM2if1_m"}], "rc": 0, "start": "2019-12-05 18:11:15.854146", "stderr": "", "stderr_lines": [], "stdout": "Domain t3_VM2 has been undefined", "stdout_lines": ["Domain t3_VM2 has been undefined"]}

PLAY RECAP **************************************************************************************************************************************************
99.99.99.2                 : ok=10   changed=7    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0   
localhost                  : ok=5    changed=4    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0   

Using /etc/ansible/ansible.cfg as config file

PLAY [worker] ***********************************************************************************************************************************************

TASK [Detach Interface] *************************************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'ns_name': u't3ns1', u'bridge_name': u't3br1'}, {u'vmif_m': u't3VM4if1_m', u'vm_mac': u'52:54:00:62:b5:e3', u'name': u't3_VM4', u'vmif': u't3VM4if1', u'brif_m': u't3br1if1_m'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "virsh domiflist \"t3_VM4\" | grep -w \"t3VM4if1\" ; if [ $? -eq 0 ] ; then virsh detach-interface --domain \"t3_VM4\" --type direct --config ; fi\n", "delta": "0:00:00.067598", "end": "2019-12-05 18:11:18.123506", "item": [{"bridge_name": "t3br1", "ns_name": "t3ns1"}, {"brif_m": "t3br1if1_m", "name": "t3_VM4", "vm_mac": "52:54:00:62:b5:e3", "vmif": "t3VM4if1", "vmif_m": "t3VM4if1_m"}], "rc": 0, "start": "2019-12-05 18:11:18.055908", "stderr": "", "stderr_lines": [], "stdout": "macvtap0   direct     t3VM4if1   rtl8139     52:54:00:62:b5:e3\nInterface detached successfully", "stdout_lines": ["macvtap0   direct     t3VM4if1   rtl8139     52:54:00:62:b5:e3", "Interface detached successfully"]}
changed: [99.99.99.2] => (item=[{u'ns_name': u't3ns2', u'bridge_name': u't3br2'}, {u'vmif_m': u't3VM3if1_m', u'vm_mac': u'52:54:00:72:9d:df', u'name': u't3_VM3', u'vmif': u't3VM3if1', u'brif_m': u't3br2if1_m'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "virsh domiflist \"t3_VM3\" | grep -w \"t3VM3if1\" ; if [ $? -eq 0 ] ; then virsh detach-interface --domain \"t3_VM3\" --type direct --config ; fi\n", "delta": "0:00:00.057197", "end": "2019-12-05 18:11:18.528620", "item": [{"bridge_name": "t3br2", "ns_name": "t3ns2"}, {"brif_m": "t3br2if1_m", "name": "t3_VM3", "vm_mac": "52:54:00:72:9d:df", "vmif": "t3VM3if1", "vmif_m": "t3VM3if1_m"}], "rc": 0, "start": "2019-12-05 18:11:18.471423", "stderr": "", "stderr_lines": [], "stdout": "macvtap1   direct     t3VM3if1   rtl8139     52:54:00:72:9d:df\nInterface detached successfully", "stdout_lines": ["macvtap1   direct     t3VM3if1   rtl8139     52:54:00:72:9d:df", "Interface detached successfully"]}

TASK [Shutdown VMs] *****************************************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'ns_name': u't3ns1', u'bridge_name': u't3br1'}, {u'vmif_m': u't3VM4if1_m', u'vm_mac': u'52:54:00:62:b5:e3', u'name': u't3_VM4', u'vmif': u't3VM4if1', u'brif_m': u't3br1if1_m'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "virsh list --state-shutoff | grep -w \"t3_VM4\" ; if [ $? -ne 0 ] ; then virsh shutdown \"t3_VM4\" ; fi\n", "delta": "0:00:00.199610", "end": "2019-12-05 18:11:19.117896", "item": [{"bridge_name": "t3br1", "ns_name": "t3ns1"}, {"brif_m": "t3br1if1_m", "name": "t3_VM4", "vm_mac": "52:54:00:62:b5:e3", "vmif": "t3VM4if1", "vmif_m": "t3VM4if1_m"}], "rc": 0, "start": "2019-12-05 18:11:18.918286", "stderr": "", "stderr_lines": [], "stdout": "Domain t3_VM4 is being shutdown", "stdout_lines": ["Domain t3_VM4 is being shutdown"]}
changed: [99.99.99.2] => (item=[{u'ns_name': u't3ns2', u'bridge_name': u't3br2'}, {u'vmif_m': u't3VM3if1_m', u'vm_mac': u'52:54:00:72:9d:df', u'name': u't3_VM3', u'vmif': u't3VM3if1', u'brif_m': u't3br2if1_m'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "virsh list --state-shutoff | grep -w \"t3_VM3\" ; if [ $? -ne 0 ] ; then virsh shutdown \"t3_VM3\" ; fi\n", "delta": "0:00:00.128489", "end": "2019-12-05 18:11:19.653372", "item": [{"bridge_name": "t3br2", "ns_name": "t3ns2"}, {"brif_m": "t3br2if1_m", "name": "t3_VM3", "vm_mac": "52:54:00:72:9d:df", "vmif": "t3VM3if1", "vmif_m": "t3VM3if1_m"}], "rc": 0, "start": "2019-12-05 18:11:19.524883", "stderr": "", "stderr_lines": [], "stdout": "Domain t3_VM3 is being shutdown", "stdout_lines": ["Domain t3_VM3 is being shutdown"]}

TASK [Remove TEMP files] ************************************************************************************************************************************
changed: [99.99.99.2] => {"changed": true, "path": "/root/.ansible/tmp/", "state": "absent"}

TASK [Migrate VM images] ************************************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'ns_name': u't3ns1', u'bridge_name': u't3br1'}, {u'vmif_m': u't3VM4if1_m', u'vm_mac': u'52:54:00:62:b5:e3', u'name': u't3_VM4', u'vmif': u't3VM4if1', u'brif_m': u't3br1if1_m'}]) => {"ansible_loop_var": "item", "changed": true, "checksum": "b73493658cf56b0fe701565fe97c852b7fe88325", "dest": "/var/lib/libvirt/images/t3_VM4.qcow2", "item": [{"bridge_name": "t3br1", "ns_name": "t3ns1"}, {"brif_m": "t3br1if1_m", "name": "t3_VM4", "vm_mac": "52:54:00:62:b5:e3", "vmif": "t3VM4if1", "vmif_m": "t3VM4if1_m"}], "md5sum": "e4f789bdf1172b0d3f69e2d1f8dd2cd0", "remote_checksum": "ccd1fd44d71d150425c3457a3fce998a54f9ee2f", "remote_md5sum": null}
Using /etc/ansible/ansible.cfg as config file

PLAY [main] *************************************************************************************************************************************************

TASK [Create Tenant Namespace] ******************************************************************************************************************************
ok: [localhost] => (item={u'default_route_ip': u'192.168.4.1', u'name': u't4', u'pns_ip': u'192.168.4.1/24', u'tenant_if': u't4if', u'tenant_ip': u'192.168.4.2/24', u'pns_if': u't4pns_if'}) => {"ansible_loop_var": "item", "changed": false, "cmd": ["ip", "netns", "add", "t4"], "item": {"default_route_ip": "192.168.4.1", "name": "t4", "pns_if": "t4pns_if", "pns_ip": "192.168.4.1/24", "tenant_if": "t4if", "tenant_ip": "192.168.4.2/24"}, "rc": 0, "stdout": "skipped, since /var/run/netns/t4 exists", "stdout_lines": ["skipped, since /var/run/netns/t4 exists"]}

TASK [Create Subnet Namespace] ******************************************************************************************************************************
ok: [localhost] => (item={u'route': [{u'ip': u'10.1.31.1/24', u'ns_name': u't4', u'ns_if': u't4if', u'if': u'p1'}], u'default_route_ip': u'10.1.31.1', u'bridge_name': u't4br1', u'dns': [{u'dnsif': u't4s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't4s1_dnsbrif'}], u'ns_name': u't4ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.31.2/24', u'tenant_ns_ip': u'10.1.31.1/24', u'tenant_ns_if': u't4ns1if', u'tenant_ns_name': u't4', u'tenant_sub_if': u't4s1if'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't4_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't4br1if1', u'vmif': u't4VM1if1'}, {u'mem': 4, u'name': u't4_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't4br1if2', u'vmif': u't4VM2if1'}], u'vxlan': [{u'local_ip': u'10.1.31.2', u'tenant_route_ip': u'192.168.4.2', u'dsport': 4789, u'dev': u't4s1if', u'subnet_route': u'10.1.31.0/24', u'remote_route': u'10.2.31.0/24', u'v_name': u'vxlan_t4s1', u'id': 42, u'remote_ip': u'10.2.31.2'}]}) => {"ansible_loop_var": "item", "changed": false, "cmd": ["ip", "netns", "add", "t4ns1"], "item": {"bridge_name": "t4br1", "default_route_ip": "10.1.31.1", "dns": [{"brif": "t4s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.5", "dnsif": "t4s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t4ns1", "route": [{"if": "p1", "ip": "10.1.31.1/24", "ns_if": "t4if", "ns_name": "t4"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t4ns1if", "tenant_ns_ip": "10.1.31.1/24", "tenant_ns_name": "t4", "tenant_sub_if": "t4s1if", "tenant_sub_ip": "10.1.31.2/24"}], "vms": [{"brif": "t4br1if1", "disk": "10G", "mem": 2, "name": "t4_VM1", "vcpu": 4, "vmif": "t4VM1if1"}, {"brif": "t4br1if2", "disk": "10G", "mem": 4, "name": "t4_VM2", "vcpu": 2, "vmif": "t4VM2if1"}], "vxlan": [{"dev": "t4s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.31.2", "remote_ip": "10.2.31.2", "remote_route": "10.2.31.0/24", "subnet_route": "10.1.31.0/24", "tenant_route_ip": "192.168.4.2", "v_name": "vxlan_t4s1"}]}, "rc": 0, "stdout": "skipped, since /var/run/netns/t4ns1 exists", "stdout_lines": ["skipped, since /var/run/netns/t4ns1 exists"]}
changed: [localhost] => (item={u'route': [{u'ip': u'10.1.32.1/24', u'ns_name': u't4', u'ns_if': u't4if', u'if': u'p1'}], u'default_route_ip': u'10.1.32.1', u'bridge_name': u't4br2', u'dns': [{u'dnsif': [], u'dhcp_start': [], u'dhcp_end': [], u'dnsif_ip': [], u'net_mask': [], u'brif': []}], u'ns_name': u't4ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.32.2/24', u'tenant_ns_ip': u'10.1.32.1/24', u'tenant_ns_if': u't4ns2if', u'tenant_ns_name': u't4', u'tenant_sub_if': u't4s2if'}], u'subnet_ip': u'2.2.2.0/24', u'vms': [{u'mem': [], u'name': [], u'vcpu': [], u'disk': [], u'brif': [], u'vmif': []}], u'vxlan': [{u'local_ip': u'10.1.32.2', u'tenant_route_ip': u'192.168.4.2', u'dsport': 4789, u'dev': u't4s2if', u'subnet_route': u'10.1.32.0/24', u'remote_route': u'10.2.32.0/24', u'v_name': u'vxlan_t4s2', u'id': 42, u'remote_ip': u'10.2.32.2'}]}) => {"ansible_loop_var": "item", "changed": true, "cmd": ["ip", "netns", "add", "t4ns2"], "delta": "0:00:00.057549", "end": "2019-12-05 18:34:30.087540", "item": {"bridge_name": "t4br2", "default_route_ip": "10.1.32.1", "dns": [{"brif": [], "dhcp_end": [], "dhcp_start": [], "dnsif": [], "dnsif_ip": [], "net_mask": []}], "ns_name": "t4ns2", "route": [{"if": "p1", "ip": "10.1.32.1/24", "ns_if": "t4if", "ns_name": "t4"}], "subnet_ip": "2.2.2.0/24", "tenant_ns": [{"tenant_ns_if": "t4ns2if", "tenant_ns_ip": "10.1.32.1/24", "tenant_ns_name": "t4", "tenant_sub_if": "t4s2if", "tenant_sub_ip": "10.1.32.2/24"}], "vms": [{"brif": [], "disk": [], "mem": [], "name": [], "vcpu": [], "vmif": []}], "vxlan": [{"dev": "t4s2if", "dsport": 4789, "id": 42, "local_ip": "10.1.32.2", "remote_ip": "10.2.32.2", "remote_route": "10.2.32.0/24", "subnet_route": "10.1.32.0/24", "tenant_route_ip": "192.168.4.2", "v_name": "vxlan_t4s2"}]}, "rc": 0, "start": "2019-12-05 18:34:30.029991", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Create Tenant VETH pairs] *****************************************************************************************************************************
changed: [localhost] => (item={u'default_route_ip': u'192.168.4.1', u'name': u't4', u'pns_ip': u'192.168.4.1/24', u'tenant_if': u't4if', u'tenant_ip': u'192.168.4.2/24', u'pns_if': u't4pns_if'}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip link show \"t4if\" ; if [ $? -ne 0 ] ; then ip link add \"t4if\" type veth peer name \"t4pns_if\" ; fi\n", "delta": "0:00:00.017757", "end": "2019-12-05 18:34:30.411542", "item": {"default_route_ip": "192.168.4.1", "name": "t4", "pns_if": "t4pns_if", "pns_ip": "192.168.4.1/24", "tenant_if": "t4if", "tenant_ip": "192.168.4.2/24"}, "rc": 0, "start": "2019-12-05 18:34:30.393785", "stderr": "Device \"t4if\" does not exist.", "stderr_lines": ["Device \"t4if\" does not exist."], "stdout": "", "stdout_lines": []}

TASK [Attach Tenant VETH Pairs] *****************************************************************************************************************************
changed: [localhost] => (item={u'default_route_ip': u'192.168.4.1', u'name': u't4', u'pns_ip': u'192.168.4.1/24', u'tenant_if': u't4if', u'tenant_ip': u'192.168.4.2/24', u'pns_if': u't4pns_if'}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec pns ip link show \"t4pns_if\" ; if [ $? -ne 0 ] ; then ip link set \"t4pns_if\" netns pns ; fi\nip netns exec \"t4\" ip link show \"t4if\" ; if [ $? -ne 0 ] ; then ip link set \"t4if\" netns \"t4\" ; fi\nip netns exec pns ip link set dev \"t4pns_if\" up\nip netns exec \"t4\" ip link set dev \"t4if\" up\n", "delta": "0:00:00.146369", "end": "2019-12-05 18:34:30.826744", "item": {"default_route_ip": "192.168.4.1", "name": "t4", "pns_if": "t4pns_if", "pns_ip": "192.168.4.1/24", "tenant_if": "t4if", "tenant_ip": "192.168.4.2/24"}, "rc": 0, "start": "2019-12-05 18:34:30.680375", "stderr": "", "stderr_lines": [], "stdout": "46: t4pns_if@if47: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP mode DEFAULT group default qlen 1000\n    link/ether 92:23:0d:d3:d9:4b brd ff:ff:ff:ff:ff:ff link-netnsid 4\n47: t4if@if46: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP mode DEFAULT group default qlen 1000\n    link/ether c6:b6:e1:e6:cb:b8 brd ff:ff:ff:ff:ff:ff link-netnsid 0", "stdout_lines": ["46: t4pns_if@if47: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP mode DEFAULT group default qlen 1000", "    link/ether 92:23:0d:d3:d9:4b brd ff:ff:ff:ff:ff:ff link-netnsid 4", "47: t4if@if46: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP mode DEFAULT group default qlen 1000", "    link/ether c6:b6:e1:e6:cb:b8 brd ff:ff:ff:ff:ff:ff link-netnsid 0"]}

TASK [Add IP addresses to Tenant VETH Pairs] ****************************************************************************************************************
changed: [localhost] => (item={u'default_route_ip': u'192.168.4.1', u'name': u't4', u'pns_ip': u'192.168.4.1/24', u'tenant_if': u't4if', u'tenant_ip': u'192.168.4.2/24', u'pns_if': u't4pns_if'}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec pns ip addr show \"t4pns_if\" | awk 'FNR==3{ print $2 }' | grep -w '^192.168.4.1/24' ; if [ $? -ne 0 ] ; then ip netns exec pns ip addr add \"192.168.4.1/24\" dev \"t4pns_if\" ; fi\nip netns exec \"t4\" ip addr show \"t4if\" | awk 'FNR==3{ print $2 }' | grep -w '^192.168.4.2/24' ; if [ $? -ne 0 ] ; then ip netns exec \"t4\" ip addr add \"192.168.4.2/24\" dev \"t4if\" ; fi\n", "delta": "0:00:00.076054", "end": "2019-12-05 18:34:31.191188", "item": {"default_route_ip": "192.168.4.1", "name": "t4", "pns_if": "t4pns_if", "pns_ip": "192.168.4.1/24", "tenant_if": "t4if", "tenant_ip": "192.168.4.2/24"}, "rc": 0, "start": "2019-12-05 18:34:31.115134", "stderr": "", "stderr_lines": [], "stdout": "192.168.4.1/24\n192.168.4.2/24", "stdout_lines": ["192.168.4.1/24", "192.168.4.2/24"]}

TASK [Create Namespace VETH Pairs] **************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.31.1/24', u'ns_name': u't4', u'ns_if': u't4if', u'if': u'p1'}], u'default_route_ip': u'10.1.31.1', u'bridge_name': u't4br1', u'dns': [{u'dnsif': u't4s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't4s1_dnsbrif'}], u'ns_name': u't4ns1', u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't4_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't4br1if1', u'vmif': u't4VM1if1'}, {u'mem': 4, u'name': u't4_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't4br1if2', u'vmif': u't4VM2if1'}], u'vxlan': [{u'local_ip': u'10.1.31.2', u'dsport': 4789, u'dev': u't4s1if', u'tenant_route_ip': u'192.168.4.2', u'remote_route': u'10.2.31.0/24', u'subnet_route': u'10.1.31.0/24', u'v_name': u'vxlan_t4s1', u'id': 42, u'remote_ip': u'10.2.31.2'}]}, {u'tenant_sub_ip': u'10.1.31.2/24', u'tenant_ns_ip': u'10.1.31.1/24', u'tenant_ns_if': u't4ns1if', u'tenant_sub_if': u't4s1if', u'tenant_ns_name': u't4'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip link show \"t4ns1if\" ; if [ $? -ne 0 ] ; then ip link add \"t4ns1if\" type veth peer name \"t4s1if\" ; fi\n", "delta": "0:00:00.009986", "end": "2019-12-05 18:34:31.470468", "item": [{"bridge_name": "t4br1", "default_route_ip": "10.1.31.1", "dns": [{"brif": "t4s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.5", "dnsif": "t4s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t4ns1", "route": [{"if": "p1", "ip": "10.1.31.1/24", "ns_if": "t4if", "ns_name": "t4"}], "subnet_ip": "1.1.1.0/24", "vms": [{"brif": "t4br1if1", "disk": "10G", "mem": 2, "name": "t4_VM1", "vcpu": 4, "vmif": "t4VM1if1"}, {"brif": "t4br1if2", "disk": "10G", "mem": 4, "name": "t4_VM2", "vcpu": 2, "vmif": "t4VM2if1"}], "vxlan": [{"dev": "t4s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.31.2", "remote_ip": "10.2.31.2", "remote_route": "10.2.31.0/24", "subnet_route": "10.1.31.0/24", "tenant_route_ip": "192.168.4.2", "v_name": "vxlan_t4s1"}]}, {"tenant_ns_if": "t4ns1if", "tenant_ns_ip": "10.1.31.1/24", "tenant_ns_name": "t4", "tenant_sub_if": "t4s1if", "tenant_sub_ip": "10.1.31.2/24"}], "rc": 0, "start": "2019-12-05 18:34:31.460482", "stderr": "Device \"t4ns1if\" does not exist.", "stderr_lines": ["Device \"t4ns1if\" does not exist."], "stdout": "", "stdout_lines": []}
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.32.1/24', u'ns_name': u't4', u'ns_if': u't4if', u'if': u'p1'}], u'default_route_ip': u'10.1.32.1', u'bridge_name': u't4br2', u'dns': [{u'dnsif': [], u'dhcp_start': [], u'dhcp_end': [], u'dnsif_ip': [], u'net_mask': [], u'brif': []}], u'ns_name': u't4ns2', u'subnet_ip': u'2.2.2.0/24', u'vms': [{u'mem': [], u'name': [], u'vcpu': [], u'disk': [], u'brif': [], u'vmif': []}], u'vxlan': [{u'local_ip': u'10.1.32.2', u'dsport': 4789, u'dev': u't4s2if', u'tenant_route_ip': u'192.168.4.2', u'remote_route': u'10.2.32.0/24', u'subnet_route': u'10.1.32.0/24', u'v_name': u'vxlan_t4s2', u'id': 42, u'remote_ip': u'10.2.32.2'}]}, {u'tenant_sub_ip': u'10.1.32.2/24', u'tenant_ns_ip': u'10.1.32.1/24', u'tenant_ns_if': u't4ns2if', u'tenant_sub_if': u't4s2if', u'tenant_ns_name': u't4'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip link show \"t4ns2if\" ; if [ $? -ne 0 ] ; then ip link add \"t4ns2if\" type veth peer name \"t4s2if\" ; fi\n", "delta": "0:00:00.011467", "end": "2019-12-05 18:34:31.707739", "item": [{"bridge_name": "t4br2", "default_route_ip": "10.1.32.1", "dns": [{"brif": [], "dhcp_end": [], "dhcp_start": [], "dnsif": [], "dnsif_ip": [], "net_mask": []}], "ns_name": "t4ns2", "route": [{"if": "p1", "ip": "10.1.32.1/24", "ns_if": "t4if", "ns_name": "t4"}], "subnet_ip": "2.2.2.0/24", "vms": [{"brif": [], "disk": [], "mem": [], "name": [], "vcpu": [], "vmif": []}], "vxlan": [{"dev": "t4s2if", "dsport": 4789, "id": 42, "local_ip": "10.1.32.2", "remote_ip": "10.2.32.2", "remote_route": "10.2.32.0/24", "subnet_route": "10.1.32.0/24", "tenant_route_ip": "192.168.4.2", "v_name": "vxlan_t4s2"}]}, {"tenant_ns_if": "t4ns2if", "tenant_ns_ip": "10.1.32.1/24", "tenant_ns_name": "t4", "tenant_sub_if": "t4s2if", "tenant_sub_ip": "10.1.32.2/24"}], "rc": 0, "start": "2019-12-05 18:34:31.696272", "stderr": "Device \"t4ns2if\" does not exist.", "stderr_lines": ["Device \"t4ns2if\" does not exist."], "stdout": "", "stdout_lines": []}

TASK [Attach Namespace VETH Pairs] **************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.31.1/24', u'ns_name': u't4', u'ns_if': u't4if', u'if': u'p1'}], u'default_route_ip': u'10.1.31.1', u'bridge_name': u't4br1', u'dns': [{u'dnsif': u't4s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't4s1_dnsbrif'}], u'ns_name': u't4ns1', u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't4_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't4br1if1', u'vmif': u't4VM1if1'}, {u'mem': 4, u'name': u't4_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't4br1if2', u'vmif': u't4VM2if1'}], u'vxlan': [{u'local_ip': u'10.1.31.2', u'dsport': 4789, u'dev': u't4s1if', u'tenant_route_ip': u'192.168.4.2', u'remote_route': u'10.2.31.0/24', u'subnet_route': u'10.1.31.0/24', u'v_name': u'vxlan_t4s1', u'id': 42, u'remote_ip': u'10.2.31.2'}]}, {u'tenant_sub_ip': u'10.1.31.2/24', u'tenant_ns_ip': u'10.1.31.1/24', u'tenant_ns_if': u't4ns1if', u'tenant_sub_if': u't4s1if', u'tenant_ns_name': u't4'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t4\" ip link show \"t4ns1if\" ; if [ $? -ne 0 ] ; then ip link set \"t4ns1if\" netns \"t4\" ; fi\nip netns exec \"t4ns1\" ip link show \"t4s1if\" ; if [ $? -ne 0 ] ; then ip link set \"t4s1if\" netns \"t4ns1\" ; fi\n", "delta": "0:00:00.084156", "end": "2019-12-05 18:34:32.063695", "item": [{"bridge_name": "t4br1", "default_route_ip": "10.1.31.1", "dns": [{"brif": "t4s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.5", "dnsif": "t4s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t4ns1", "route": [{"if": "p1", "ip": "10.1.31.1/24", "ns_if": "t4if", "ns_name": "t4"}], "subnet_ip": "1.1.1.0/24", "vms": [{"brif": "t4br1if1", "disk": "10G", "mem": 2, "name": "t4_VM1", "vcpu": 4, "vmif": "t4VM1if1"}, {"brif": "t4br1if2", "disk": "10G", "mem": 4, "name": "t4_VM2", "vcpu": 2, "vmif": "t4VM2if1"}], "vxlan": [{"dev": "t4s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.31.2", "remote_ip": "10.2.31.2", "remote_route": "10.2.31.0/24", "subnet_route": "10.1.31.0/24", "tenant_route_ip": "192.168.4.2", "v_name": "vxlan_t4s1"}]}, {"tenant_ns_if": "t4ns1if", "tenant_ns_ip": "10.1.31.1/24", "tenant_ns_name": "t4", "tenant_sub_if": "t4s1if", "tenant_sub_ip": "10.1.31.2/24"}], "rc": 0, "start": "2019-12-05 18:34:31.979539", "stderr": "", "stderr_lines": [], "stdout": "49: t4ns1if@if48: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP mode DEFAULT group default qlen 1000\n    link/ether d6:bc:4b:ba:af:86 brd ff:ff:ff:ff:ff:ff link-netnsid 2\n48: t4s1if@if49: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP mode DEFAULT group default qlen 1000\n    link/ether 9e:4a:2d:e7:3b:52 brd ff:ff:ff:ff:ff:ff link-netnsid 0", "stdout_lines": ["49: t4ns1if@if48: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP mode DEFAULT group default qlen 1000", "    link/ether d6:bc:4b:ba:af:86 brd ff:ff:ff:ff:ff:ff link-netnsid 2", "48: t4s1if@if49: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP mode DEFAULT group default qlen 1000", "    link/ether 9e:4a:2d:e7:3b:52 brd ff:ff:ff:ff:ff:ff link-netnsid 0"]}
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.32.1/24', u'ns_name': u't4', u'ns_if': u't4if', u'if': u'p1'}], u'default_route_ip': u'10.1.32.1', u'bridge_name': u't4br2', u'dns': [{u'dnsif': [], u'dhcp_start': [], u'dhcp_end': [], u'dnsif_ip': [], u'net_mask': [], u'brif': []}], u'ns_name': u't4ns2', u'subnet_ip': u'2.2.2.0/24', u'vms': [{u'mem': [], u'name': [], u'vcpu': [], u'disk': [], u'brif': [], u'vmif': []}], u'vxlan': [{u'local_ip': u'10.1.32.2', u'dsport': 4789, u'dev': u't4s2if', u'tenant_route_ip': u'192.168.4.2', u'remote_route': u'10.2.32.0/24', u'subnet_route': u'10.1.32.0/24', u'v_name': u'vxlan_t4s2', u'id': 42, u'remote_ip': u'10.2.32.2'}]}, {u'tenant_sub_ip': u'10.1.32.2/24', u'tenant_ns_ip': u'10.1.32.1/24', u'tenant_ns_if': u't4ns2if', u'tenant_sub_if': u't4s2if', u'tenant_ns_name': u't4'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t4\" ip link show \"t4ns2if\" ; if [ $? -ne 0 ] ; then ip link set \"t4ns2if\" netns \"t4\" ; fi\nip netns exec \"t4ns2\" ip link show \"t4s2if\" ; if [ $? -ne 0 ] ; then ip link set \"t4s2if\" netns \"t4ns2\" ; fi\n", "delta": "0:00:00.110807", "end": "2019-12-05 18:34:32.396748", "item": [{"bridge_name": "t4br2", "default_route_ip": "10.1.32.1", "dns": [{"brif": [], "dhcp_end": [], "dhcp_start": [], "dnsif": [], "dnsif_ip": [], "net_mask": []}], "ns_name": "t4ns2", "route": [{"if": "p1", "ip": "10.1.32.1/24", "ns_if": "t4if", "ns_name": "t4"}], "subnet_ip": "2.2.2.0/24", "vms": [{"brif": [], "disk": [], "mem": [], "name": [], "vcpu": [], "vmif": []}], "vxlan": [{"dev": "t4s2if", "dsport": 4789, "id": 42, "local_ip": "10.1.32.2", "remote_ip": "10.2.32.2", "remote_route": "10.2.32.0/24", "subnet_route": "10.1.32.0/24", "tenant_route_ip": "192.168.4.2", "v_name": "vxlan_t4s2"}]}, {"tenant_ns_if": "t4ns2if", "tenant_ns_ip": "10.1.32.1/24", "tenant_ns_name": "t4", "tenant_sub_if": "t4s2if", "tenant_sub_ip": "10.1.32.2/24"}], "rc": 0, "start": "2019-12-05 18:34:32.285941", "stderr": "Device \"t4ns2if\" does not exist.\nDevice \"t4s2if\" does not exist.", "stderr_lines": ["Device \"t4ns2if\" does not exist.", "Device \"t4s2if\" does not exist."], "stdout": "", "stdout_lines": []}

TASK [Set Namespace VETH Pairs UP] **************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.31.1/24', u'ns_name': u't4', u'ns_if': u't4if', u'if': u'p1'}], u'default_route_ip': u'10.1.31.1', u'bridge_name': u't4br1', u'dns': [{u'dnsif': u't4s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't4s1_dnsbrif'}], u'ns_name': u't4ns1', u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't4_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't4br1if1', u'vmif': u't4VM1if1'}, {u'mem': 4, u'name': u't4_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't4br1if2', u'vmif': u't4VM2if1'}], u'vxlan': [{u'local_ip': u'10.1.31.2', u'dsport': 4789, u'dev': u't4s1if', u'tenant_route_ip': u'192.168.4.2', u'remote_route': u'10.2.31.0/24', u'subnet_route': u'10.1.31.0/24', u'v_name': u'vxlan_t4s1', u'id': 42, u'remote_ip': u'10.2.31.2'}]}, {u'tenant_sub_ip': u'10.1.31.2/24', u'tenant_ns_ip': u'10.1.31.1/24', u'tenant_ns_if': u't4ns1if', u'tenant_sub_if': u't4s1if', u'tenant_ns_name': u't4'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t4\" ip link set dev \"t4ns1if\" up\nip netns exec \"t4ns1\" ip link set dev \"t4s1if\" up\n", "delta": "0:00:00.067638", "end": "2019-12-05 18:34:32.734707", "item": [{"bridge_name": "t4br1", "default_route_ip": "10.1.31.1", "dns": [{"brif": "t4s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.5", "dnsif": "t4s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t4ns1", "route": [{"if": "p1", "ip": "10.1.31.1/24", "ns_if": "t4if", "ns_name": "t4"}], "subnet_ip": "1.1.1.0/24", "vms": [{"brif": "t4br1if1", "disk": "10G", "mem": 2, "name": "t4_VM1", "vcpu": 4, "vmif": "t4VM1if1"}, {"brif": "t4br1if2", "disk": "10G", "mem": 4, "name": "t4_VM2", "vcpu": 2, "vmif": "t4VM2if1"}], "vxlan": [{"dev": "t4s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.31.2", "remote_ip": "10.2.31.2", "remote_route": "10.2.31.0/24", "subnet_route": "10.1.31.0/24", "tenant_route_ip": "192.168.4.2", "v_name": "vxlan_t4s1"}]}, {"tenant_ns_if": "t4ns1if", "tenant_ns_ip": "10.1.31.1/24", "tenant_ns_name": "t4", "tenant_sub_if": "t4s1if", "tenant_sub_ip": "10.1.31.2/24"}], "rc": 0, "start": "2019-12-05 18:34:32.667069", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.32.1/24', u'ns_name': u't4', u'ns_if': u't4if', u'if': u'p1'}], u'default_route_ip': u'10.1.32.1', u'bridge_name': u't4br2', u'dns': [{u'dnsif': [], u'dhcp_start': [], u'dhcp_end': [], u'dnsif_ip': [], u'net_mask': [], u'brif': []}], u'ns_name': u't4ns2', u'subnet_ip': u'2.2.2.0/24', u'vms': [{u'mem': [], u'name': [], u'vcpu': [], u'disk': [], u'brif': [], u'vmif': []}], u'vxlan': [{u'local_ip': u'10.1.32.2', u'dsport': 4789, u'dev': u't4s2if', u'tenant_route_ip': u'192.168.4.2', u'remote_route': u'10.2.32.0/24', u'subnet_route': u'10.1.32.0/24', u'v_name': u'vxlan_t4s2', u'id': 42, u'remote_ip': u'10.2.32.2'}]}, {u'tenant_sub_ip': u'10.1.32.2/24', u'tenant_ns_ip': u'10.1.32.1/24', u'tenant_ns_if': u't4ns2if', u'tenant_sub_if': u't4s2if', u'tenant_ns_name': u't4'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t4\" ip link set dev \"t4ns2if\" up\nip netns exec \"t4ns2\" ip link set dev \"t4s2if\" up\n", "delta": "0:00:00.099615", "end": "2019-12-05 18:34:33.034880", "item": [{"bridge_name": "t4br2", "default_route_ip": "10.1.32.1", "dns": [{"brif": [], "dhcp_end": [], "dhcp_start": [], "dnsif": [], "dnsif_ip": [], "net_mask": []}], "ns_name": "t4ns2", "route": [{"if": "p1", "ip": "10.1.32.1/24", "ns_if": "t4if", "ns_name": "t4"}], "subnet_ip": "2.2.2.0/24", "vms": [{"brif": [], "disk": [], "mem": [], "name": [], "vcpu": [], "vmif": []}], "vxlan": [{"dev": "t4s2if", "dsport": 4789, "id": 42, "local_ip": "10.1.32.2", "remote_ip": "10.2.32.2", "remote_route": "10.2.32.0/24", "subnet_route": "10.1.32.0/24", "tenant_route_ip": "192.168.4.2", "v_name": "vxlan_t4s2"}]}, {"tenant_ns_if": "t4ns2if", "tenant_ns_ip": "10.1.32.1/24", "tenant_ns_name": "t4", "tenant_sub_if": "t4s2if", "tenant_sub_ip": "10.1.32.2/24"}], "rc": 0, "start": "2019-12-05 18:34:32.935265", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Add IP addresses to Namespace VETH Pairs] *************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.31.1/24', u'ns_name': u't4', u'ns_if': u't4if', u'if': u'p1'}], u'default_route_ip': u'10.1.31.1', u'bridge_name': u't4br1', u'dns': [{u'dnsif': u't4s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't4s1_dnsbrif'}], u'ns_name': u't4ns1', u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't4_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't4br1if1', u'vmif': u't4VM1if1'}, {u'mem': 4, u'name': u't4_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't4br1if2', u'vmif': u't4VM2if1'}], u'vxlan': [{u'local_ip': u'10.1.31.2', u'dsport': 4789, u'dev': u't4s1if', u'tenant_route_ip': u'192.168.4.2', u'remote_route': u'10.2.31.0/24', u'subnet_route': u'10.1.31.0/24', u'v_name': u'vxlan_t4s1', u'id': 42, u'remote_ip': u'10.2.31.2'}]}, {u'tenant_sub_ip': u'10.1.31.2/24', u'tenant_ns_ip': u'10.1.31.1/24', u'tenant_ns_if': u't4ns1if', u'tenant_sub_if': u't4s1if', u'tenant_ns_name': u't4'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t4ns1\" ip addr show \"t4s1if\" | awk 'FNR==3{ print $2 }' | grep -w '^10.1.31.2/24' ; if [ $? -ne 0 ] ; then ip netns exec \"t4ns1\" ip addr add \"10.1.31.2/24\" dev \"t4s1if\" ; fi\n\nip netns exec \"t4\" ip addr show \"t4ns1if\" | awk 'FNR==3{ print $2 }' | grep -w '^10.1.31.1/24' ; if [ $? -ne 0 ] ; then ip netns exec \"t4\" ip addr add \"10.1.31.1/24\" dev \"t4ns1if\" ; fi\n", "delta": "0:00:00.077784", "end": "2019-12-05 18:34:33.382963", "item": [{"bridge_name": "t4br1", "default_route_ip": "10.1.31.1", "dns": [{"brif": "t4s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.5", "dnsif": "t4s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t4ns1", "route": [{"if": "p1", "ip": "10.1.31.1/24", "ns_if": "t4if", "ns_name": "t4"}], "subnet_ip": "1.1.1.0/24", "vms": [{"brif": "t4br1if1", "disk": "10G", "mem": 2, "name": "t4_VM1", "vcpu": 4, "vmif": "t4VM1if1"}, {"brif": "t4br1if2", "disk": "10G", "mem": 4, "name": "t4_VM2", "vcpu": 2, "vmif": "t4VM2if1"}], "vxlan": [{"dev": "t4s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.31.2", "remote_ip": "10.2.31.2", "remote_route": "10.2.31.0/24", "subnet_route": "10.1.31.0/24", "tenant_route_ip": "192.168.4.2", "v_name": "vxlan_t4s1"}]}, {"tenant_ns_if": "t4ns1if", "tenant_ns_ip": "10.1.31.1/24", "tenant_ns_name": "t4", "tenant_sub_if": "t4s1if", "tenant_sub_ip": "10.1.31.2/24"}], "rc": 0, "start": "2019-12-05 18:34:33.305179", "stderr": "", "stderr_lines": [], "stdout": "10.1.31.2/24\n10.1.31.1/24", "stdout_lines": ["10.1.31.2/24", "10.1.31.1/24"]}
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.32.1/24', u'ns_name': u't4', u'ns_if': u't4if', u'if': u'p1'}], u'default_route_ip': u'10.1.32.1', u'bridge_name': u't4br2', u'dns': [{u'dnsif': [], u'dhcp_start': [], u'dhcp_end': [], u'dnsif_ip': [], u'net_mask': [], u'brif': []}], u'ns_name': u't4ns2', u'subnet_ip': u'2.2.2.0/24', u'vms': [{u'mem': [], u'name': [], u'vcpu': [], u'disk': [], u'brif': [], u'vmif': []}], u'vxlan': [{u'local_ip': u'10.1.32.2', u'dsport': 4789, u'dev': u't4s2if', u'tenant_route_ip': u'192.168.4.2', u'remote_route': u'10.2.32.0/24', u'subnet_route': u'10.1.32.0/24', u'v_name': u'vxlan_t4s2', u'id': 42, u'remote_ip': u'10.2.32.2'}]}, {u'tenant_sub_ip': u'10.1.32.2/24', u'tenant_ns_ip': u'10.1.32.1/24', u'tenant_ns_if': u't4ns2if', u'tenant_sub_if': u't4s2if', u'tenant_ns_name': u't4'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t4ns2\" ip addr show \"t4s2if\" | awk 'FNR==3{ print $2 }' | grep -w '^10.1.32.2/24' ; if [ $? -ne 0 ] ; then ip netns exec \"t4ns2\" ip addr add \"10.1.32.2/24\" dev \"t4s2if\" ; fi\n\nip netns exec \"t4\" ip addr show \"t4ns2if\" | awk 'FNR==3{ print $2 }' | grep -w '^10.1.32.1/24' ; if [ $? -ne 0 ] ; then ip netns exec \"t4\" ip addr add \"10.1.32.1/24\" dev \"t4ns2if\" ; fi\n", "delta": "0:00:00.158078", "end": "2019-12-05 18:34:33.747013", "item": [{"bridge_name": "t4br2", "default_route_ip": "10.1.32.1", "dns": [{"brif": [], "dhcp_end": [], "dhcp_start": [], "dnsif": [], "dnsif_ip": [], "net_mask": []}], "ns_name": "t4ns2", "route": [{"if": "p1", "ip": "10.1.32.1/24", "ns_if": "t4if", "ns_name": "t4"}], "subnet_ip": "2.2.2.0/24", "vms": [{"brif": [], "disk": [], "mem": [], "name": [], "vcpu": [], "vmif": []}], "vxlan": [{"dev": "t4s2if", "dsport": 4789, "id": 42, "local_ip": "10.1.32.2", "remote_ip": "10.2.32.2", "remote_route": "10.2.32.0/24", "subnet_route": "10.1.32.0/24", "tenant_route_ip": "192.168.4.2", "v_name": "vxlan_t4s2"}]}, {"tenant_ns_if": "t4ns2if", "tenant_ns_ip": "10.1.32.1/24", "tenant_ns_name": "t4", "tenant_sub_if": "t4s2if", "tenant_sub_ip": "10.1.32.2/24"}], "rc": 0, "start": "2019-12-05 18:34:33.588935", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Add IP Route to Tenant] *******************************************************************************************************************************
changed: [localhost] => (item={u'default_route_ip': u'192.168.4.1', u'name': u't4', u'pns_ip': u'192.168.4.1/24', u'tenant_if': u't4if', u'tenant_ip': u'192.168.4.2/24', u'pns_if': u't4pns_if'}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t4\" ip route show default | grep -w '[d]efault via 192.168.4.1' ; if [ $? -ne 0 ] ; then ip netns exec \"t4\" ip route add default via \"192.168.4.1\" ; fi\n", "delta": "0:00:00.036951", "end": "2019-12-05 18:34:34.103085", "item": {"default_route_ip": "192.168.4.1", "name": "t4", "pns_if": "t4pns_if", "pns_ip": "192.168.4.1/24", "tenant_if": "t4if", "tenant_ip": "192.168.4.2/24"}, "rc": 0, "start": "2019-12-05 18:34:34.066134", "stderr": "", "stderr_lines": [], "stdout": "default via 192.168.4.1 dev t4if ", "stdout_lines": ["default via 192.168.4.1 dev t4if "]}

TASK [Add IP Route to Tenant Subnet] ************************************************************************************************************************
changed: [localhost] => (item={u'route': [{u'ip': u'10.1.31.1/24', u'ns_name': u't4', u'ns_if': u't4if', u'if': u'p1'}], u'default_route_ip': u'10.1.31.1', u'bridge_name': u't4br1', u'dns': [{u'dnsif': u't4s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't4s1_dnsbrif'}], u'ns_name': u't4ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.31.2/24', u'tenant_ns_ip': u'10.1.31.1/24', u'tenant_ns_if': u't4ns1if', u'tenant_ns_name': u't4', u'tenant_sub_if': u't4s1if'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't4_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't4br1if1', u'vmif': u't4VM1if1'}, {u'mem': 4, u'name': u't4_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't4br1if2', u'vmif': u't4VM2if1'}], u'vxlan': [{u'local_ip': u'10.1.31.2', u'tenant_route_ip': u'192.168.4.2', u'dsport': 4789, u'dev': u't4s1if', u'subnet_route': u'10.1.31.0/24', u'remote_route': u'10.2.31.0/24', u'v_name': u'vxlan_t4s1', u'id': 42, u'remote_ip': u'10.2.31.2'}]}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t4ns1\" ip route show default | grep -w '[d]efault via 10.1.31.1' ; if [ $? -ne 0 ] ; then ip netns exec \"t4ns1\" ip route add default via \"10.1.31.1\" ; fi\n", "delta": "0:00:00.040556", "end": "2019-12-05 18:34:34.478823", "item": {"bridge_name": "t4br1", "default_route_ip": "10.1.31.1", "dns": [{"brif": "t4s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.5", "dnsif": "t4s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t4ns1", "route": [{"if": "p1", "ip": "10.1.31.1/24", "ns_if": "t4if", "ns_name": "t4"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t4ns1if", "tenant_ns_ip": "10.1.31.1/24", "tenant_ns_name": "t4", "tenant_sub_if": "t4s1if", "tenant_sub_ip": "10.1.31.2/24"}], "vms": [{"brif": "t4br1if1", "disk": "10G", "mem": 2, "name": "t4_VM1", "vcpu": 4, "vmif": "t4VM1if1"}, {"brif": "t4br1if2", "disk": "10G", "mem": 4, "name": "t4_VM2", "vcpu": 2, "vmif": "t4VM2if1"}], "vxlan": [{"dev": "t4s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.31.2", "remote_ip": "10.2.31.2", "remote_route": "10.2.31.0/24", "subnet_route": "10.1.31.0/24", "tenant_route_ip": "192.168.4.2", "v_name": "vxlan_t4s1"}]}, "rc": 0, "start": "2019-12-05 18:34:34.438267", "stderr": "", "stderr_lines": [], "stdout": "default via 10.1.31.1 dev t4s1if ", "stdout_lines": ["default via 10.1.31.1 dev t4s1if "]}
changed: [localhost] => (item={u'route': [{u'ip': u'10.1.32.1/24', u'ns_name': u't4', u'ns_if': u't4if', u'if': u'p1'}], u'default_route_ip': u'10.1.32.1', u'bridge_name': u't4br2', u'dns': [{u'dnsif': [], u'dhcp_start': [], u'dhcp_end': [], u'dnsif_ip': [], u'net_mask': [], u'brif': []}], u'ns_name': u't4ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.32.2/24', u'tenant_ns_ip': u'10.1.32.1/24', u'tenant_ns_if': u't4ns2if', u'tenant_ns_name': u't4', u'tenant_sub_if': u't4s2if'}], u'subnet_ip': u'2.2.2.0/24', u'vms': [{u'mem': [], u'name': [], u'vcpu': [], u'disk': [], u'brif': [], u'vmif': []}], u'vxlan': [{u'local_ip': u'10.1.32.2', u'tenant_route_ip': u'192.168.4.2', u'dsport': 4789, u'dev': u't4s2if', u'subnet_route': u'10.1.32.0/24', u'remote_route': u'10.2.32.0/24', u'v_name': u'vxlan_t4s2', u'id': 42, u'remote_ip': u'10.2.32.2'}]}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t4ns2\" ip route show default | grep -w '[d]efault via 10.1.32.1' ; if [ $? -ne 0 ] ; then ip netns exec \"t4ns2\" ip route add default via \"10.1.32.1\" ; fi\n", "delta": "0:00:00.074517", "end": "2019-12-05 18:34:34.786842", "item": {"bridge_name": "t4br2", "default_route_ip": "10.1.32.1", "dns": [{"brif": [], "dhcp_end": [], "dhcp_start": [], "dnsif": [], "dnsif_ip": [], "net_mask": []}], "ns_name": "t4ns2", "route": [{"if": "p1", "ip": "10.1.32.1/24", "ns_if": "t4if", "ns_name": "t4"}], "subnet_ip": "2.2.2.0/24", "tenant_ns": [{"tenant_ns_if": "t4ns2if", "tenant_ns_ip": "10.1.32.1/24", "tenant_ns_name": "t4", "tenant_sub_if": "t4s2if", "tenant_sub_ip": "10.1.32.2/24"}], "vms": [{"brif": [], "disk": [], "mem": [], "name": [], "vcpu": [], "vmif": []}], "vxlan": [{"dev": "t4s2if", "dsport": 4789, "id": 42, "local_ip": "10.1.32.2", "remote_ip": "10.2.32.2", "remote_route": "10.2.32.0/24", "subnet_route": "10.1.32.0/24", "tenant_route_ip": "192.168.4.2", "v_name": "vxlan_t4s2"}]}, "rc": 0, "start": "2019-12-05 18:34:34.712325", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Create bridge inside namespace] ***********************************************************************************************************************
changed: [localhost] => (item={u'route': [{u'ip': u'10.1.31.1/24', u'ns_name': u't4', u'ns_if': u't4if', u'if': u'p1'}], u'default_route_ip': u'10.1.31.1', u'bridge_name': u't4br1', u'dns': [{u'dnsif': u't4s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't4s1_dnsbrif'}], u'ns_name': u't4ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.31.2/24', u'tenant_ns_ip': u'10.1.31.1/24', u'tenant_ns_if': u't4ns1if', u'tenant_ns_name': u't4', u'tenant_sub_if': u't4s1if'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't4_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't4br1if1', u'vmif': u't4VM1if1'}, {u'mem': 4, u'name': u't4_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't4br1if2', u'vmif': u't4VM2if1'}], u'vxlan': [{u'local_ip': u'10.1.31.2', u'tenant_route_ip': u'192.168.4.2', u'dsport': 4789, u'dev': u't4s1if', u'subnet_route': u'10.1.31.0/24', u'remote_route': u'10.2.31.0/24', u'v_name': u'vxlan_t4s1', u'id': 42, u'remote_ip': u'10.2.31.2'}]}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t4ns1\" brctl show | grep -w '^t4br1'; if [ $? -ne 0 ] ; then ip netns exec \"t4ns1\" brctl addbr \"t4br1\" ; fi\nip netns exec \"t4ns1\" ip link set dev \"t4br1\" up\n", "delta": "0:00:00.077533", "end": "2019-12-05 18:34:35.162684", "item": {"bridge_name": "t4br1", "default_route_ip": "10.1.31.1", "dns": [{"brif": "t4s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.5", "dnsif": "t4s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t4ns1", "route": [{"if": "p1", "ip": "10.1.31.1/24", "ns_if": "t4if", "ns_name": "t4"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t4ns1if", "tenant_ns_ip": "10.1.31.1/24", "tenant_ns_name": "t4", "tenant_sub_if": "t4s1if", "tenant_sub_ip": "10.1.31.2/24"}], "vms": [{"brif": "t4br1if1", "disk": "10G", "mem": 2, "name": "t4_VM1", "vcpu": 4, "vmif": "t4VM1if1"}, {"brif": "t4br1if2", "disk": "10G", "mem": 4, "name": "t4_VM2", "vcpu": 2, "vmif": "t4VM2if1"}], "vxlan": [{"dev": "t4s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.31.2", "remote_ip": "10.2.31.2", "remote_route": "10.2.31.0/24", "subnet_route": "10.1.31.0/24", "tenant_route_ip": "192.168.4.2", "v_name": "vxlan_t4s1"}]}, "rc": 0, "start": "2019-12-05 18:34:35.085151", "stderr": "", "stderr_lines": [], "stdout": "t4br1\t\t8000.12bca3c52589\tno\t\tt4br1if1", "stdout_lines": ["t4br1\t\t8000.12bca3c52589\tno\t\tt4br1if1"]}
changed: [localhost] => (item={u'route': [{u'ip': u'10.1.32.1/24', u'ns_name': u't4', u'ns_if': u't4if', u'if': u'p1'}], u'default_route_ip': u'10.1.32.1', u'bridge_name': u't4br2', u'dns': [{u'dnsif': [], u'dhcp_start': [], u'dhcp_end': [], u'dnsif_ip': [], u'net_mask': [], u'brif': []}], u'ns_name': u't4ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.32.2/24', u'tenant_ns_ip': u'10.1.32.1/24', u'tenant_ns_if': u't4ns2if', u'tenant_ns_name': u't4', u'tenant_sub_if': u't4s2if'}], u'subnet_ip': u'2.2.2.0/24', u'vms': [{u'mem': [], u'name': [], u'vcpu': [], u'disk': [], u'brif': [], u'vmif': []}], u'vxlan': [{u'local_ip': u'10.1.32.2', u'tenant_route_ip': u'192.168.4.2', u'dsport': 4789, u'dev': u't4s2if', u'subnet_route': u'10.1.32.0/24', u'remote_route': u'10.2.32.0/24', u'v_name': u'vxlan_t4s2', u'id': 42, u'remote_ip': u'10.2.32.2'}]}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t4ns2\" brctl show | grep -w '^t4br2'; if [ $? -ne 0 ] ; then ip netns exec \"t4ns2\" brctl addbr \"t4br2\" ; fi\nip netns exec \"t4ns2\" ip link set dev \"t4br2\" up\n", "delta": "0:00:00.105088", "end": "2019-12-05 18:34:35.506764", "item": {"bridge_name": "t4br2", "default_route_ip": "10.1.32.1", "dns": [{"brif": [], "dhcp_end": [], "dhcp_start": [], "dnsif": [], "dnsif_ip": [], "net_mask": []}], "ns_name": "t4ns2", "route": [{"if": "p1", "ip": "10.1.32.1/24", "ns_if": "t4if", "ns_name": "t4"}], "subnet_ip": "2.2.2.0/24", "tenant_ns": [{"tenant_ns_if": "t4ns2if", "tenant_ns_ip": "10.1.32.1/24", "tenant_ns_name": "t4", "tenant_sub_if": "t4s2if", "tenant_sub_ip": "10.1.32.2/24"}], "vms": [{"brif": [], "disk": [], "mem": [], "name": [], "vcpu": [], "vmif": []}], "vxlan": [{"dev": "t4s2if", "dsport": 4789, "id": 42, "local_ip": "10.1.32.2", "remote_ip": "10.2.32.2", "remote_route": "10.2.32.0/24", "subnet_route": "10.1.32.0/24", "tenant_route_ip": "192.168.4.2", "v_name": "vxlan_t4s2"}]}, "rc": 0, "start": "2019-12-05 18:34:35.401676", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Create DNS VETH Pair] *********************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.31.1/24', u'ns_name': u't4', u'ns_if': u't4if', u'if': u'p1'}], u'default_route_ip': u'10.1.31.1', u'bridge_name': u't4br1', u'ns_name': u't4ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.31.2/24', u'tenant_ns_ip': u'10.1.31.1/24', u'tenant_ns_if': u't4ns1if', u'tenant_sub_if': u't4s1if', u'tenant_ns_name': u't4'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't4_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't4br1if1', u'vmif': u't4VM1if1'}, {u'mem': 4, u'name': u't4_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't4br1if2', u'vmif': u't4VM2if1'}], u'vxlan': [{u'local_ip': u'10.1.31.2', u'dsport': 4789, u'dev': u't4s1if', u'tenant_route_ip': u'192.168.4.2', u'remote_route': u'10.2.31.0/24', u'subnet_route': u'10.1.31.0/24', u'v_name': u'vxlan_t4s1', u'id': 42, u'remote_ip': u'10.2.31.2'}]}, {u'dnsif': u't4s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't4s1_dnsbrif'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t4ns1\" ip link show \"t4s1_dnsbrif\" ; if [ $? -ne 0 ] ; then ip netns exec \"t4ns1\" ip link add \"t4s1_dnsbrif\" type veth peer name \"t4s1_dnsif\" ; fi\nip netns exec \"t4ns1\" ip link set dev \"t4s1_dnsbrif\" up\nip netns exec \"t4ns1\" ip link set dev \"t4s1_dnsif\" up\n", "delta": "0:00:00.105765", "end": "2019-12-05 18:34:35.906737", "item": [{"bridge_name": "t4br1", "default_route_ip": "10.1.31.1", "ns_name": "t4ns1", "route": [{"if": "p1", "ip": "10.1.31.1/24", "ns_if": "t4if", "ns_name": "t4"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t4ns1if", "tenant_ns_ip": "10.1.31.1/24", "tenant_ns_name": "t4", "tenant_sub_if": "t4s1if", "tenant_sub_ip": "10.1.31.2/24"}], "vms": [{"brif": "t4br1if1", "disk": "10G", "mem": 2, "name": "t4_VM1", "vcpu": 4, "vmif": "t4VM1if1"}, {"brif": "t4br1if2", "disk": "10G", "mem": 4, "name": "t4_VM2", "vcpu": 2, "vmif": "t4VM2if1"}], "vxlan": [{"dev": "t4s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.31.2", "remote_ip": "10.2.31.2", "remote_route": "10.2.31.0/24", "subnet_route": "10.1.31.0/24", "tenant_route_ip": "192.168.4.2", "v_name": "vxlan_t4s1"}]}, {"brif": "t4s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.5", "dnsif": "t4s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "rc": 0, "start": "2019-12-05 18:34:35.800972", "stderr": "", "stderr_lines": [], "stdout": "4: t4s1_dnsbrif@t4s1_dnsif: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue master t4br1 state UP mode DEFAULT group default qlen 1000\n    link/ether 32:48:8b:1b:3e:fc brd ff:ff:ff:ff:ff:ff", "stdout_lines": ["4: t4s1_dnsbrif@t4s1_dnsif: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue master t4br1 state UP mode DEFAULT group default qlen 1000", "    link/ether 32:48:8b:1b:3e:fc brd ff:ff:ff:ff:ff:ff"]}
skipping: [localhost] => (item=[{u'route': [{u'ip': u'10.1.32.1/24', u'ns_name': u't4', u'ns_if': u't4if', u'if': u'p1'}], u'default_route_ip': u'10.1.32.1', u'bridge_name': u't4br2', u'ns_name': u't4ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.32.2/24', u'tenant_ns_ip': u'10.1.32.1/24', u'tenant_ns_if': u't4ns2if', u'tenant_sub_if': u't4s2if', u'tenant_ns_name': u't4'}], u'subnet_ip': u'2.2.2.0/24', u'vms': [{u'mem': [], u'name': [], u'vcpu': [], u'disk': [], u'brif': [], u'vmif': []}], u'vxlan': [{u'local_ip': u'10.1.32.2', u'dsport': 4789, u'dev': u't4s2if', u'tenant_route_ip': u'192.168.4.2', u'remote_route': u'10.2.32.0/24', u'subnet_route': u'10.1.32.0/24', u'v_name': u'vxlan_t4s2', u'id': 42, u'remote_ip': u'10.2.32.2'}]}, {u'dnsif': [], u'dhcp_start': [], u'dhcp_end': [], u'dnsif_ip': [], u'net_mask': [], u'brif': []}])  => {"ansible_loop_var": "item", "changed": false, "item": [{"bridge_name": "t4br2", "default_route_ip": "10.1.32.1", "ns_name": "t4ns2", "route": [{"if": "p1", "ip": "10.1.32.1/24", "ns_if": "t4if", "ns_name": "t4"}], "subnet_ip": "2.2.2.0/24", "tenant_ns": [{"tenant_ns_if": "t4ns2if", "tenant_ns_ip": "10.1.32.1/24", "tenant_ns_name": "t4", "tenant_sub_if": "t4s2if", "tenant_sub_ip": "10.1.32.2/24"}], "vms": [{"brif": [], "disk": [], "mem": [], "name": [], "vcpu": [], "vmif": []}], "vxlan": [{"dev": "t4s2if", "dsport": 4789, "id": 42, "local_ip": "10.1.32.2", "remote_ip": "10.2.32.2", "remote_route": "10.2.32.0/24", "subnet_route": "10.1.32.0/24", "tenant_route_ip": "192.168.4.2", "v_name": "vxlan_t4s2"}]}, {"brif": [], "dhcp_end": [], "dhcp_start": [], "dnsif": [], "dnsif_ip": [], "net_mask": []}], "skip_reason": "Conditional result was False"}

TASK [Attach DNS VETH Pair] *********************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.31.1/24', u'ns_name': u't4', u'ns_if': u't4if', u'if': u'p1'}], u'default_route_ip': u'10.1.31.1', u'bridge_name': u't4br1', u'ns_name': u't4ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.31.2/24', u'tenant_ns_ip': u'10.1.31.1/24', u'tenant_ns_if': u't4ns1if', u'tenant_sub_if': u't4s1if', u'tenant_ns_name': u't4'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't4_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't4br1if1', u'vmif': u't4VM1if1'}, {u'mem': 4, u'name': u't4_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't4br1if2', u'vmif': u't4VM2if1'}], u'vxlan': [{u'local_ip': u'10.1.31.2', u'dsport': 4789, u'dev': u't4s1if', u'tenant_route_ip': u'192.168.4.2', u'remote_route': u'10.2.31.0/24', u'subnet_route': u'10.1.31.0/24', u'v_name': u'vxlan_t4s1', u'id': 42, u'remote_ip': u'10.2.31.2'}]}, {u'dnsif': u't4s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't4s1_dnsbrif'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t4ns1\" brctl show \"t4br1\" | grep -w 't4s1_dnsbrif' ; if [ $? -ne 0 ] ; then ip netns exec \"t4ns1\" brctl addif \"t4br1\" \"t4s1_dnsbrif\" ; fi\n", "delta": "0:00:00.044263", "end": "2019-12-05 18:34:36.258713", "item": [{"bridge_name": "t4br1", "default_route_ip": "10.1.31.1", "ns_name": "t4ns1", "route": [{"if": "p1", "ip": "10.1.31.1/24", "ns_if": "t4if", "ns_name": "t4"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t4ns1if", "tenant_ns_ip": "10.1.31.1/24", "tenant_ns_name": "t4", "tenant_sub_if": "t4s1if", "tenant_sub_ip": "10.1.31.2/24"}], "vms": [{"brif": "t4br1if1", "disk": "10G", "mem": 2, "name": "t4_VM1", "vcpu": 4, "vmif": "t4VM1if1"}, {"brif": "t4br1if2", "disk": "10G", "mem": 4, "name": "t4_VM2", "vcpu": 2, "vmif": "t4VM2if1"}], "vxlan": [{"dev": "t4s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.31.2", "remote_ip": "10.2.31.2", "remote_route": "10.2.31.0/24", "subnet_route": "10.1.31.0/24", "tenant_route_ip": "192.168.4.2", "v_name": "vxlan_t4s1"}]}, {"brif": "t4s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.5", "dnsif": "t4s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "rc": 0, "start": "2019-12-05 18:34:36.214450", "stderr": "", "stderr_lines": [], "stdout": "\t\t\t\t\t\t\tt4s1_dnsbrif", "stdout_lines": ["\t\t\t\t\t\t\tt4s1_dnsbrif"]}
skipping: [localhost] => (item=[{u'route': [{u'ip': u'10.1.32.1/24', u'ns_name': u't4', u'ns_if': u't4if', u'if': u'p1'}], u'default_route_ip': u'10.1.32.1', u'bridge_name': u't4br2', u'ns_name': u't4ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.32.2/24', u'tenant_ns_ip': u'10.1.32.1/24', u'tenant_ns_if': u't4ns2if', u'tenant_sub_if': u't4s2if', u'tenant_ns_name': u't4'}], u'subnet_ip': u'2.2.2.0/24', u'vms': [{u'mem': [], u'name': [], u'vcpu': [], u'disk': [], u'brif': [], u'vmif': []}], u'vxlan': [{u'local_ip': u'10.1.32.2', u'dsport': 4789, u'dev': u't4s2if', u'tenant_route_ip': u'192.168.4.2', u'remote_route': u'10.2.32.0/24', u'subnet_route': u'10.1.32.0/24', u'v_name': u'vxlan_t4s2', u'id': 42, u'remote_ip': u'10.2.32.2'}]}, {u'dnsif': [], u'dhcp_start': [], u'dhcp_end': [], u'dnsif_ip': [], u'net_mask': [], u'brif': []}])  => {"ansible_loop_var": "item", "changed": false, "item": [{"bridge_name": "t4br2", "default_route_ip": "10.1.32.1", "ns_name": "t4ns2", "route": [{"if": "p1", "ip": "10.1.32.1/24", "ns_if": "t4if", "ns_name": "t4"}], "subnet_ip": "2.2.2.0/24", "tenant_ns": [{"tenant_ns_if": "t4ns2if", "tenant_ns_ip": "10.1.32.1/24", "tenant_ns_name": "t4", "tenant_sub_if": "t4s2if", "tenant_sub_ip": "10.1.32.2/24"}], "vms": [{"brif": [], "disk": [], "mem": [], "name": [], "vcpu": [], "vmif": []}], "vxlan": [{"dev": "t4s2if", "dsport": 4789, "id": 42, "local_ip": "10.1.32.2", "remote_ip": "10.2.32.2", "remote_route": "10.2.32.0/24", "subnet_route": "10.1.32.0/24", "tenant_route_ip": "192.168.4.2", "v_name": "vxlan_t4s2"}]}, {"brif": [], "dhcp_end": [], "dhcp_start": [], "dnsif": [], "dnsif_ip": [], "net_mask": []}], "skip_reason": "Conditional result was False"}

TASK [Create VETH Pairs] ************************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.31.1/24', u'ns_name': u't4', u'ns_if': u't4if', u'if': u'p1'}], u'default_route_ip': u'10.1.31.1', u'bridge_name': u't4br1', u'dns': [{u'dnsif': u't4s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't4s1_dnsbrif'}], u'ns_name': u't4ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.31.2/24', u'tenant_ns_ip': u'10.1.31.1/24', u'tenant_ns_if': u't4ns1if', u'tenant_sub_if': u't4s1if', u'tenant_ns_name': u't4'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.1.31.2', u'dsport': 4789, u'dev': u't4s1if', u'tenant_route_ip': u'192.168.4.2', u'remote_route': u'10.2.31.0/24', u'subnet_route': u'10.1.31.0/24', u'v_name': u'vxlan_t4s1', u'id': 42, u'remote_ip': u'10.2.31.2'}]}, {u'mem': 2, u'name': u't4_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't4br1if1', u'vmif': u't4VM1if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip link show \"t4br1if1\" ; if [ $? -ne 0 ] ; then ip link add \"t4VM1if1\" type veth peer name \"t4br1if1\" ; fi\nip link set dev \"t4br1if1\" up\nip link set dev \"t4VM1if1\" up\n", "delta": "0:00:00.014784", "end": "2019-12-05 18:34:36.592638", "item": [{"bridge_name": "t4br1", "default_route_ip": "10.1.31.1", "dns": [{"brif": "t4s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.5", "dnsif": "t4s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t4ns1", "route": [{"if": "p1", "ip": "10.1.31.1/24", "ns_if": "t4if", "ns_name": "t4"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t4ns1if", "tenant_ns_ip": "10.1.31.1/24", "tenant_ns_name": "t4", "tenant_sub_if": "t4s1if", "tenant_sub_ip": "10.1.31.2/24"}], "vxlan": [{"dev": "t4s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.31.2", "remote_ip": "10.2.31.2", "remote_route": "10.2.31.0/24", "subnet_route": "10.1.31.0/24", "tenant_route_ip": "192.168.4.2", "v_name": "vxlan_t4s1"}]}, {"brif": "t4br1if1", "disk": "10G", "mem": 2, "name": "t4_VM1", "vcpu": 4, "vmif": "t4VM1if1"}], "rc": 0, "start": "2019-12-05 18:34:36.577854", "stderr": "Device \"t4br1if1\" does not exist.\nRTNETLINK answers: File exists\nCannot find device \"t4br1if1\"", "stderr_lines": ["Device \"t4br1if1\" does not exist.", "RTNETLINK answers: File exists", "Cannot find device \"t4br1if1\""], "stdout": "", "stdout_lines": []}
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.31.1/24', u'ns_name': u't4', u'ns_if': u't4if', u'if': u'p1'}], u'default_route_ip': u'10.1.31.1', u'bridge_name': u't4br1', u'dns': [{u'dnsif': u't4s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't4s1_dnsbrif'}], u'ns_name': u't4ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.31.2/24', u'tenant_ns_ip': u'10.1.31.1/24', u'tenant_ns_if': u't4ns1if', u'tenant_sub_if': u't4s1if', u'tenant_ns_name': u't4'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.1.31.2', u'dsport': 4789, u'dev': u't4s1if', u'tenant_route_ip': u'192.168.4.2', u'remote_route': u'10.2.31.0/24', u'subnet_route': u'10.1.31.0/24', u'v_name': u'vxlan_t4s1', u'id': 42, u'remote_ip': u'10.2.31.2'}]}, {u'mem': 4, u'name': u't4_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't4br1if2', u'vmif': u't4VM2if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip link show \"t4br1if2\" ; if [ $? -ne 0 ] ; then ip link add \"t4VM2if1\" type veth peer name \"t4br1if2\" ; fi\nip link set dev \"t4br1if2\" up\nip link set dev \"t4VM2if1\" up\n", "delta": "0:00:00.017007", "end": "2019-12-05 18:34:36.886214", "item": [{"bridge_name": "t4br1", "default_route_ip": "10.1.31.1", "dns": [{"brif": "t4s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.5", "dnsif": "t4s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t4ns1", "route": [{"if": "p1", "ip": "10.1.31.1/24", "ns_if": "t4if", "ns_name": "t4"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t4ns1if", "tenant_ns_ip": "10.1.31.1/24", "tenant_ns_name": "t4", "tenant_sub_if": "t4s1if", "tenant_sub_ip": "10.1.31.2/24"}], "vxlan": [{"dev": "t4s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.31.2", "remote_ip": "10.2.31.2", "remote_route": "10.2.31.0/24", "subnet_route": "10.1.31.0/24", "tenant_route_ip": "192.168.4.2", "v_name": "vxlan_t4s1"}]}, {"brif": "t4br1if2", "disk": "10G", "mem": 4, "name": "t4_VM2", "vcpu": 2, "vmif": "t4VM2if1"}], "rc": 0, "start": "2019-12-05 18:34:36.869207", "stderr": "Device \"t4br1if2\" does not exist.\nRTNETLINK answers: File exists\nCannot find device \"t4br1if2\"", "stderr_lines": ["Device \"t4br1if2\" does not exist.", "RTNETLINK answers: File exists", "Cannot find device \"t4br1if2\""], "stdout": "", "stdout_lines": []}
skipping: [localhost] => (item=[{u'route': [{u'ip': u'10.1.32.1/24', u'ns_name': u't4', u'ns_if': u't4if', u'if': u'p1'}], u'default_route_ip': u'10.1.32.1', u'bridge_name': u't4br2', u'dns': [{u'dnsif': [], u'dhcp_start': [], u'dhcp_end': [], u'dnsif_ip': [], u'net_mask': [], u'brif': []}], u'ns_name': u't4ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.32.2/24', u'tenant_ns_ip': u'10.1.32.1/24', u'tenant_ns_if': u't4ns2if', u'tenant_sub_if': u't4s2if', u'tenant_ns_name': u't4'}], u'subnet_ip': u'2.2.2.0/24', u'vxlan': [{u'local_ip': u'10.1.32.2', u'dsport': 4789, u'dev': u't4s2if', u'tenant_route_ip': u'192.168.4.2', u'remote_route': u'10.2.32.0/24', u'subnet_route': u'10.1.32.0/24', u'v_name': u'vxlan_t4s2', u'id': 42, u'remote_ip': u'10.2.32.2'}]}, {u'mem': [], u'name': [], u'vcpu': [], u'disk': [], u'brif': [], u'vmif': []}])  => {"ansible_loop_var": "item", "changed": false, "item": [{"bridge_name": "t4br2", "default_route_ip": "10.1.32.1", "dns": [{"brif": [], "dhcp_end": [], "dhcp_start": [], "dnsif": [], "dnsif_ip": [], "net_mask": []}], "ns_name": "t4ns2", "route": [{"if": "p1", "ip": "10.1.32.1/24", "ns_if": "t4if", "ns_name": "t4"}], "subnet_ip": "2.2.2.0/24", "tenant_ns": [{"tenant_ns_if": "t4ns2if", "tenant_ns_ip": "10.1.32.1/24", "tenant_ns_name": "t4", "tenant_sub_if": "t4s2if", "tenant_sub_ip": "10.1.32.2/24"}], "vxlan": [{"dev": "t4s2if", "dsport": 4789, "id": 42, "local_ip": "10.1.32.2", "remote_ip": "10.2.32.2", "remote_route": "10.2.32.0/24", "subnet_route": "10.1.32.0/24", "tenant_route_ip": "192.168.4.2", "v_name": "vxlan_t4s2"}]}, {"brif": [], "disk": [], "mem": [], "name": [], "vcpu": [], "vmif": []}], "skip_reason": "Conditional result was False"}

TASK [Attach VETH Pairs] ************************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.31.1/24', u'ns_name': u't4', u'ns_if': u't4if', u'if': u'p1'}], u'default_route_ip': u'10.1.31.1', u'bridge_name': u't4br1', u'dns': [{u'dnsif': u't4s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't4s1_dnsbrif'}], u'ns_name': u't4ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.31.2/24', u'tenant_ns_ip': u'10.1.31.1/24', u'tenant_ns_if': u't4ns1if', u'tenant_sub_if': u't4s1if', u'tenant_ns_name': u't4'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.1.31.2', u'dsport': 4789, u'dev': u't4s1if', u'tenant_route_ip': u'192.168.4.2', u'remote_route': u'10.2.31.0/24', u'subnet_route': u'10.1.31.0/24', u'v_name': u'vxlan_t4s1', u'id': 42, u'remote_ip': u'10.2.31.2'}]}, {u'mem': 2, u'name': u't4_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't4br1if1', u'vmif': u't4VM1if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip link show \"t4br1if1\" ; if [ $? -eq 0 ] ; then ip link set \"t4br1if1\" netns \"t4ns1\" ; fi\nip netns exec \"t4ns1\" brctl show \"t4br1\" | grep -w 't4br1if1' ; if [ $? -ne 0 ] ; then ip netns exec \"t4ns1\" brctl addif \"t4br1\" \"t4br1if1\" ; fi\n", "delta": "0:00:00.044722", "end": "2019-12-05 18:34:37.287029", "item": [{"bridge_name": "t4br1", "default_route_ip": "10.1.31.1", "dns": [{"brif": "t4s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.5", "dnsif": "t4s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t4ns1", "route": [{"if": "p1", "ip": "10.1.31.1/24", "ns_if": "t4if", "ns_name": "t4"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t4ns1if", "tenant_ns_ip": "10.1.31.1/24", "tenant_ns_name": "t4", "tenant_sub_if": "t4s1if", "tenant_sub_ip": "10.1.31.2/24"}], "vxlan": [{"dev": "t4s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.31.2", "remote_ip": "10.2.31.2", "remote_route": "10.2.31.0/24", "subnet_route": "10.1.31.0/24", "tenant_route_ip": "192.168.4.2", "v_name": "vxlan_t4s1"}]}, {"brif": "t4br1if1", "disk": "10G", "mem": 2, "name": "t4_VM1", "vcpu": 4, "vmif": "t4VM1if1"}], "rc": 0, "start": "2019-12-05 18:34:37.242307", "stderr": "Device \"t4br1if1\" does not exist.", "stderr_lines": ["Device \"t4br1if1\" does not exist."], "stdout": "t4br1\t\t8000.12bca3c52589\tno\t\tt4br1if1", "stdout_lines": ["t4br1\t\t8000.12bca3c52589\tno\t\tt4br1if1"]}
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.31.1/24', u'ns_name': u't4', u'ns_if': u't4if', u'if': u'p1'}], u'default_route_ip': u'10.1.31.1', u'bridge_name': u't4br1', u'dns': [{u'dnsif': u't4s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't4s1_dnsbrif'}], u'ns_name': u't4ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.31.2/24', u'tenant_ns_ip': u'10.1.31.1/24', u'tenant_ns_if': u't4ns1if', u'tenant_sub_if': u't4s1if', u'tenant_ns_name': u't4'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.1.31.2', u'dsport': 4789, u'dev': u't4s1if', u'tenant_route_ip': u'192.168.4.2', u'remote_route': u'10.2.31.0/24', u'subnet_route': u'10.1.31.0/24', u'v_name': u'vxlan_t4s1', u'id': 42, u'remote_ip': u'10.2.31.2'}]}, {u'mem': 4, u'name': u't4_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't4br1if2', u'vmif': u't4VM2if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip link show \"t4br1if2\" ; if [ $? -eq 0 ] ; then ip link set \"t4br1if2\" netns \"t4ns1\" ; fi\nip netns exec \"t4ns1\" brctl show \"t4br1\" | grep -w 't4br1if2' ; if [ $? -ne 0 ] ; then ip netns exec \"t4ns1\" brctl addif \"t4br1\" \"t4br1if2\" ; fi\n", "delta": "0:00:00.045826", "end": "2019-12-05 18:34:37.634988", "item": [{"bridge_name": "t4br1", "default_route_ip": "10.1.31.1", "dns": [{"brif": "t4s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.5", "dnsif": "t4s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t4ns1", "route": [{"if": "p1", "ip": "10.1.31.1/24", "ns_if": "t4if", "ns_name": "t4"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t4ns1if", "tenant_ns_ip": "10.1.31.1/24", "tenant_ns_name": "t4", "tenant_sub_if": "t4s1if", "tenant_sub_ip": "10.1.31.2/24"}], "vxlan": [{"dev": "t4s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.31.2", "remote_ip": "10.2.31.2", "remote_route": "10.2.31.0/24", "subnet_route": "10.1.31.0/24", "tenant_route_ip": "192.168.4.2", "v_name": "vxlan_t4s1"}]}, {"brif": "t4br1if2", "disk": "10G", "mem": 4, "name": "t4_VM2", "vcpu": 2, "vmif": "t4VM2if1"}], "rc": 0, "start": "2019-12-05 18:34:37.589162", "stderr": "Device \"t4br1if2\" does not exist.", "stderr_lines": ["Device \"t4br1if2\" does not exist."], "stdout": "\t\t\t\t\t\t\tt4br1if2", "stdout_lines": ["\t\t\t\t\t\t\tt4br1if2"]}
skipping: [localhost] => (item=[{u'route': [{u'ip': u'10.1.32.1/24', u'ns_name': u't4', u'ns_if': u't4if', u'if': u'p1'}], u'default_route_ip': u'10.1.32.1', u'bridge_name': u't4br2', u'dns': [{u'dnsif': [], u'dhcp_start': [], u'dhcp_end': [], u'dnsif_ip': [], u'net_mask': [], u'brif': []}], u'ns_name': u't4ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.32.2/24', u'tenant_ns_ip': u'10.1.32.1/24', u'tenant_ns_if': u't4ns2if', u'tenant_sub_if': u't4s2if', u'tenant_ns_name': u't4'}], u'subnet_ip': u'2.2.2.0/24', u'vxlan': [{u'local_ip': u'10.1.32.2', u'dsport': 4789, u'dev': u't4s2if', u'tenant_route_ip': u'192.168.4.2', u'remote_route': u'10.2.32.0/24', u'subnet_route': u'10.1.32.0/24', u'v_name': u'vxlan_t4s2', u'id': 42, u'remote_ip': u'10.2.32.2'}]}, {u'mem': [], u'name': [], u'vcpu': [], u'disk': [], u'brif': [], u'vmif': []}])  => {"ansible_loop_var": "item", "changed": false, "item": [{"bridge_name": "t4br2", "default_route_ip": "10.1.32.1", "dns": [{"brif": [], "dhcp_end": [], "dhcp_start": [], "dnsif": [], "dnsif_ip": [], "net_mask": []}], "ns_name": "t4ns2", "route": [{"if": "p1", "ip": "10.1.32.1/24", "ns_if": "t4if", "ns_name": "t4"}], "subnet_ip": "2.2.2.0/24", "tenant_ns": [{"tenant_ns_if": "t4ns2if", "tenant_ns_ip": "10.1.32.1/24", "tenant_ns_name": "t4", "tenant_sub_if": "t4s2if", "tenant_sub_ip": "10.1.32.2/24"}], "vxlan": [{"dev": "t4s2if", "dsport": 4789, "id": 42, "local_ip": "10.1.32.2", "remote_ip": "10.2.32.2", "remote_route": "10.2.32.0/24", "subnet_route": "10.1.32.0/24", "tenant_route_ip": "192.168.4.2", "v_name": "vxlan_t4s2"}]}, {"brif": [], "disk": [], "mem": [], "name": [], "vcpu": [], "vmif": []}], "skip_reason": "Conditional result was False"}

TASK [All interfaces and bridges UP] ************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.31.1/24', u'ns_name': u't4', u'ns_if': u't4if', u'if': u'p1'}], u'default_route_ip': u'10.1.31.1', u'bridge_name': u't4br1', u'dns': [{u'dnsif': u't4s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't4s1_dnsbrif'}], u'ns_name': u't4ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.31.2/24', u'tenant_ns_ip': u'10.1.31.1/24', u'tenant_ns_if': u't4ns1if', u'tenant_sub_if': u't4s1if', u'tenant_ns_name': u't4'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.1.31.2', u'dsport': 4789, u'dev': u't4s1if', u'tenant_route_ip': u'192.168.4.2', u'remote_route': u'10.2.31.0/24', u'subnet_route': u'10.1.31.0/24', u'v_name': u'vxlan_t4s1', u'id': 42, u'remote_ip': u'10.2.31.2'}]}, {u'mem': 2, u'name': u't4_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't4br1if1', u'vmif': u't4VM1if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t4ns1\" ip link set \"t4br1if1\" up\nip netns exec \"t4ns1\" ip link set dev \"t4br1\" up\n", "delta": "0:00:00.071451", "end": "2019-12-05 18:34:38.055190", "item": [{"bridge_name": "t4br1", "default_route_ip": "10.1.31.1", "dns": [{"brif": "t4s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.5", "dnsif": "t4s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t4ns1", "route": [{"if": "p1", "ip": "10.1.31.1/24", "ns_if": "t4if", "ns_name": "t4"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t4ns1if", "tenant_ns_ip": "10.1.31.1/24", "tenant_ns_name": "t4", "tenant_sub_if": "t4s1if", "tenant_sub_ip": "10.1.31.2/24"}], "vxlan": [{"dev": "t4s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.31.2", "remote_ip": "10.2.31.2", "remote_route": "10.2.31.0/24", "subnet_route": "10.1.31.0/24", "tenant_route_ip": "192.168.4.2", "v_name": "vxlan_t4s1"}]}, {"brif": "t4br1if1", "disk": "10G", "mem": 2, "name": "t4_VM1", "vcpu": 4, "vmif": "t4VM1if1"}], "rc": 0, "start": "2019-12-05 18:34:37.983739", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.31.1/24', u'ns_name': u't4', u'ns_if': u't4if', u'if': u'p1'}], u'default_route_ip': u'10.1.31.1', u'bridge_name': u't4br1', u'dns': [{u'dnsif': u't4s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't4s1_dnsbrif'}], u'ns_name': u't4ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.31.2/24', u'tenant_ns_ip': u'10.1.31.1/24', u'tenant_ns_if': u't4ns1if', u'tenant_sub_if': u't4s1if', u'tenant_ns_name': u't4'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.1.31.2', u'dsport': 4789, u'dev': u't4s1if', u'tenant_route_ip': u'192.168.4.2', u'remote_route': u'10.2.31.0/24', u'subnet_route': u'10.1.31.0/24', u'v_name': u'vxlan_t4s1', u'id': 42, u'remote_ip': u'10.2.31.2'}]}, {u'mem': 4, u'name': u't4_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't4br1if2', u'vmif': u't4VM2if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t4ns1\" ip link set \"t4br1if2\" up\nip netns exec \"t4ns1\" ip link set dev \"t4br1\" up\n", "delta": "0:00:00.085019", "end": "2019-12-05 18:34:38.407079", "item": [{"bridge_name": "t4br1", "default_route_ip": "10.1.31.1", "dns": [{"brif": "t4s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.5", "dnsif": "t4s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t4ns1", "route": [{"if": "p1", "ip": "10.1.31.1/24", "ns_if": "t4if", "ns_name": "t4"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t4ns1if", "tenant_ns_ip": "10.1.31.1/24", "tenant_ns_name": "t4", "tenant_sub_if": "t4s1if", "tenant_sub_ip": "10.1.31.2/24"}], "vxlan": [{"dev": "t4s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.31.2", "remote_ip": "10.2.31.2", "remote_route": "10.2.31.0/24", "subnet_route": "10.1.31.0/24", "tenant_route_ip": "192.168.4.2", "v_name": "vxlan_t4s1"}]}, {"brif": "t4br1if2", "disk": "10G", "mem": 4, "name": "t4_VM2", "vcpu": 2, "vmif": "t4VM2if1"}], "rc": 0, "start": "2019-12-05 18:34:38.322060", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}
skipping: [localhost] => (item=[{u'route': [{u'ip': u'10.1.32.1/24', u'ns_name': u't4', u'ns_if': u't4if', u'if': u'p1'}], u'default_route_ip': u'10.1.32.1', u'bridge_name': u't4br2', u'dns': [{u'dnsif': [], u'dhcp_start': [], u'dhcp_end': [], u'dnsif_ip': [], u'net_mask': [], u'brif': []}], u'ns_name': u't4ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.32.2/24', u'tenant_ns_ip': u'10.1.32.1/24', u'tenant_ns_if': u't4ns2if', u'tenant_sub_if': u't4s2if', u'tenant_ns_name': u't4'}], u'subnet_ip': u'2.2.2.0/24', u'vxlan': [{u'local_ip': u'10.1.32.2', u'dsport': 4789, u'dev': u't4s2if', u'tenant_route_ip': u'192.168.4.2', u'remote_route': u'10.2.32.0/24', u'subnet_route': u'10.1.32.0/24', u'v_name': u'vxlan_t4s2', u'id': 42, u'remote_ip': u'10.2.32.2'}]}, {u'mem': [], u'name': [], u'vcpu': [], u'disk': [], u'brif': [], u'vmif': []}])  => {"ansible_loop_var": "item", "changed": false, "item": [{"bridge_name": "t4br2", "default_route_ip": "10.1.32.1", "dns": [{"brif": [], "dhcp_end": [], "dhcp_start": [], "dnsif": [], "dnsif_ip": [], "net_mask": []}], "ns_name": "t4ns2", "route": [{"if": "p1", "ip": "10.1.32.1/24", "ns_if": "t4if", "ns_name": "t4"}], "subnet_ip": "2.2.2.0/24", "tenant_ns": [{"tenant_ns_if": "t4ns2if", "tenant_ns_ip": "10.1.32.1/24", "tenant_ns_name": "t4", "tenant_sub_if": "t4s2if", "tenant_sub_ip": "10.1.32.2/24"}], "vxlan": [{"dev": "t4s2if", "dsport": 4789, "id": 42, "local_ip": "10.1.32.2", "remote_ip": "10.2.32.2", "remote_route": "10.2.32.0/24", "subnet_route": "10.1.32.0/24", "tenant_route_ip": "192.168.4.2", "v_name": "vxlan_t4s2"}]}, {"brif": [], "disk": [], "mem": [], "name": [], "vcpu": [], "vmif": []}], "skip_reason": "Conditional result was False"}

TASK [Add IP to DNS Interface] ******************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.31.1/24', u'ns_name': u't4', u'ns_if': u't4if', u'if': u'p1'}], u'default_route_ip': u'10.1.31.1', u'bridge_name': u't4br1', u'ns_name': u't4ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.31.2/24', u'tenant_ns_ip': u'10.1.31.1/24', u'tenant_ns_if': u't4ns1if', u'tenant_sub_if': u't4s1if', u'tenant_ns_name': u't4'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't4_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't4br1if1', u'vmif': u't4VM1if1'}, {u'mem': 4, u'name': u't4_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't4br1if2', u'vmif': u't4VM2if1'}], u'vxlan': [{u'local_ip': u'10.1.31.2', u'dsport': 4789, u'dev': u't4s1if', u'tenant_route_ip': u'192.168.4.2', u'remote_route': u'10.2.31.0/24', u'subnet_route': u'10.1.31.0/24', u'v_name': u'vxlan_t4s1', u'id': 42, u'remote_ip': u'10.2.31.2'}]}, {u'dnsif': u't4s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't4s1_dnsbrif'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t4ns1\" ip addr show \"t4s1_dnsif\" | awk 'FNR==3{ print $2 }' | grep -w '^1.1.1.1/24' ; if [ $? -ne 0 ] ; then ip netns exec \"t4ns1\" ip addr add \"1.1.1.1/24\" dev \"t4s1_dnsif\" ; fi\n", "delta": "0:00:00.038381", "end": "2019-12-05 18:34:38.775380", "item": [{"bridge_name": "t4br1", "default_route_ip": "10.1.31.1", "ns_name": "t4ns1", "route": [{"if": "p1", "ip": "10.1.31.1/24", "ns_if": "t4if", "ns_name": "t4"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t4ns1if", "tenant_ns_ip": "10.1.31.1/24", "tenant_ns_name": "t4", "tenant_sub_if": "t4s1if", "tenant_sub_ip": "10.1.31.2/24"}], "vms": [{"brif": "t4br1if1", "disk": "10G", "mem": 2, "name": "t4_VM1", "vcpu": 4, "vmif": "t4VM1if1"}, {"brif": "t4br1if2", "disk": "10G", "mem": 4, "name": "t4_VM2", "vcpu": 2, "vmif": "t4VM2if1"}], "vxlan": [{"dev": "t4s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.31.2", "remote_ip": "10.2.31.2", "remote_route": "10.2.31.0/24", "subnet_route": "10.1.31.0/24", "tenant_route_ip": "192.168.4.2", "v_name": "vxlan_t4s1"}]}, {"brif": "t4s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.5", "dnsif": "t4s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "rc": 0, "start": "2019-12-05 18:34:38.736999", "stderr": "", "stderr_lines": [], "stdout": "1.1.1.1/24", "stdout_lines": ["1.1.1.1/24"]}
skipping: [localhost] => (item=[{u'route': [{u'ip': u'10.1.32.1/24', u'ns_name': u't4', u'ns_if': u't4if', u'if': u'p1'}], u'default_route_ip': u'10.1.32.1', u'bridge_name': u't4br2', u'ns_name': u't4ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.32.2/24', u'tenant_ns_ip': u'10.1.32.1/24', u'tenant_ns_if': u't4ns2if', u'tenant_sub_if': u't4s2if', u'tenant_ns_name': u't4'}], u'subnet_ip': u'2.2.2.0/24', u'vms': [{u'mem': [], u'name': [], u'vcpu': [], u'disk': [], u'brif': [], u'vmif': []}], u'vxlan': [{u'local_ip': u'10.1.32.2', u'dsport': 4789, u'dev': u't4s2if', u'tenant_route_ip': u'192.168.4.2', u'remote_route': u'10.2.32.0/24', u'subnet_route': u'10.1.32.0/24', u'v_name': u'vxlan_t4s2', u'id': 42, u'remote_ip': u'10.2.32.2'}]}, {u'dnsif': [], u'dhcp_start': [], u'dhcp_end': [], u'dnsif_ip': [], u'net_mask': [], u'brif': []}])  => {"ansible_loop_var": "item", "changed": false, "item": [{"bridge_name": "t4br2", "default_route_ip": "10.1.32.1", "ns_name": "t4ns2", "route": [{"if": "p1", "ip": "10.1.32.1/24", "ns_if": "t4if", "ns_name": "t4"}], "subnet_ip": "2.2.2.0/24", "tenant_ns": [{"tenant_ns_if": "t4ns2if", "tenant_ns_ip": "10.1.32.1/24", "tenant_ns_name": "t4", "tenant_sub_if": "t4s2if", "tenant_sub_ip": "10.1.32.2/24"}], "vms": [{"brif": [], "disk": [], "mem": [], "name": [], "vcpu": [], "vmif": []}], "vxlan": [{"dev": "t4s2if", "dsport": 4789, "id": 42, "local_ip": "10.1.32.2", "remote_ip": "10.2.32.2", "remote_route": "10.2.32.0/24", "subnet_route": "10.1.32.0/24", "tenant_route_ip": "192.168.4.2", "v_name": "vxlan_t4s2"}]}, {"brif": [], "dhcp_end": [], "dhcp_start": [], "dnsif": [], "dnsif_ip": [], "net_mask": []}], "skip_reason": "Conditional result was False"}

TASK [Install DHCP Server] **********************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.31.1/24', u'ns_name': u't4', u'ns_if': u't4if', u'if': u'p1'}], u'default_route_ip': u'10.1.31.1', u'bridge_name': u't4br1', u'ns_name': u't4ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.31.2/24', u'tenant_ns_ip': u'10.1.31.1/24', u'tenant_ns_if': u't4ns1if', u'tenant_sub_if': u't4s1if', u'tenant_ns_name': u't4'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't4_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't4br1if1', u'vmif': u't4VM1if1'}, {u'mem': 4, u'name': u't4_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't4br1if2', u'vmif': u't4VM2if1'}], u'vxlan': [{u'local_ip': u'10.1.31.2', u'dsport': 4789, u'dev': u't4s1if', u'tenant_route_ip': u'192.168.4.2', u'remote_route': u'10.2.31.0/24', u'subnet_route': u'10.1.31.0/24', u'v_name': u'vxlan_t4s1', u'id': 42, u'remote_ip': u'10.2.31.2'}]}, {u'dnsif': u't4s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't4s1_dnsbrif'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t4ns1\" ps aux | grep -w '[d]nsmasq --interface t4s1_dnsif -z --dhcp-range=1.1.1.5,1.1.1.254' ; if [ $? -ne 0 ] ; then ip netns exec \"t4ns1\" dnsmasq --interface \"t4s1_dnsif\" -z --dhcp-range=1.1.1.5,'1.1.1.254' ; fi\n", "delta": "0:00:00.050619", "end": "2019-12-05 18:34:39.142924", "item": [{"bridge_name": "t4br1", "default_route_ip": "10.1.31.1", "ns_name": "t4ns1", "route": [{"if": "p1", "ip": "10.1.31.1/24", "ns_if": "t4if", "ns_name": "t4"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t4ns1if", "tenant_ns_ip": "10.1.31.1/24", "tenant_ns_name": "t4", "tenant_sub_if": "t4s1if", "tenant_sub_ip": "10.1.31.2/24"}], "vms": [{"brif": "t4br1if1", "disk": "10G", "mem": 2, "name": "t4_VM1", "vcpu": 4, "vmif": "t4VM1if1"}, {"brif": "t4br1if2", "disk": "10G", "mem": 4, "name": "t4_VM2", "vcpu": 2, "vmif": "t4VM2if1"}], "vxlan": [{"dev": "t4s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.31.2", "remote_ip": "10.2.31.2", "remote_route": "10.2.31.0/24", "subnet_route": "10.1.31.0/24", "tenant_route_ip": "192.168.4.2", "v_name": "vxlan_t4s1"}]}, {"brif": "t4s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.5", "dnsif": "t4s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "rc": 0, "start": "2019-12-05 18:34:39.092305", "stderr": "", "stderr_lines": [], "stdout": "nobody   30160  0.1  0.0  51580  2740 ?        S    18:18   0:01 dnsmasq --interface t4s1_dnsif -z --dhcp-range=1.1.1.5,1.1.1.254", "stdout_lines": ["nobody   30160  0.1  0.0  51580  2740 ?        S    18:18   0:01 dnsmasq --interface t4s1_dnsif -z --dhcp-range=1.1.1.5,1.1.1.254"]}
skipping: [localhost] => (item=[{u'route': [{u'ip': u'10.1.32.1/24', u'ns_name': u't4', u'ns_if': u't4if', u'if': u'p1'}], u'default_route_ip': u'10.1.32.1', u'bridge_name': u't4br2', u'ns_name': u't4ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.32.2/24', u'tenant_ns_ip': u'10.1.32.1/24', u'tenant_ns_if': u't4ns2if', u'tenant_sub_if': u't4s2if', u'tenant_ns_name': u't4'}], u'subnet_ip': u'2.2.2.0/24', u'vms': [{u'mem': [], u'name': [], u'vcpu': [], u'disk': [], u'brif': [], u'vmif': []}], u'vxlan': [{u'local_ip': u'10.1.32.2', u'dsport': 4789, u'dev': u't4s2if', u'tenant_route_ip': u'192.168.4.2', u'remote_route': u'10.2.32.0/24', u'subnet_route': u'10.1.32.0/24', u'v_name': u'vxlan_t4s2', u'id': 42, u'remote_ip': u'10.2.32.2'}]}, {u'dnsif': [], u'dhcp_start': [], u'dhcp_end': [], u'dnsif_ip': [], u'net_mask': [], u'brif': []}])  => {"ansible_loop_var": "item", "changed": false, "item": [{"bridge_name": "t4br2", "default_route_ip": "10.1.32.1", "ns_name": "t4ns2", "route": [{"if": "p1", "ip": "10.1.32.1/24", "ns_if": "t4if", "ns_name": "t4"}], "subnet_ip": "2.2.2.0/24", "tenant_ns": [{"tenant_ns_if": "t4ns2if", "tenant_ns_ip": "10.1.32.1/24", "tenant_ns_name": "t4", "tenant_sub_if": "t4s2if", "tenant_sub_ip": "10.1.32.2/24"}], "vms": [{"brif": [], "disk": [], "mem": [], "name": [], "vcpu": [], "vmif": []}], "vxlan": [{"dev": "t4s2if", "dsport": 4789, "id": 42, "local_ip": "10.1.32.2", "remote_ip": "10.2.32.2", "remote_route": "10.2.32.0/24", "subnet_route": "10.1.32.0/24", "tenant_route_ip": "192.168.4.2", "v_name": "vxlan_t4s2"}]}, {"brif": [], "dhcp_end": [], "dhcp_start": [], "dnsif": [], "dnsif_ip": [], "net_mask": []}], "skip_reason": "Conditional result was False"}

TASK [Create VXLAN devices] *********************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.31.1/24', u'ns_name': u't4', u'ns_if': u't4if', u'if': u'p1'}], u'default_route_ip': u'10.1.31.1', u'bridge_name': u't4br1', u'dns': [{u'dnsif': u't4s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't4s1_dnsbrif'}], u'ns_name': u't4ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.31.2/24', u'tenant_ns_ip': u'10.1.31.1/24', u'tenant_ns_if': u't4ns1if', u'tenant_sub_if': u't4s1if', u'tenant_ns_name': u't4'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't4_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't4br1if1', u'vmif': u't4VM1if1'}, {u'mem': 4, u'name': u't4_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't4br1if2', u'vmif': u't4VM2if1'}]}, {u'local_ip': u'10.1.31.2', u'dsport': 4789, u'dev': u't4s1if', u'tenant_route_ip': u'192.168.4.2', u'remote_route': u'10.2.31.0/24', u'subnet_route': u'10.1.31.0/24', u'v_name': u'vxlan_t4s1', u'id': 42, u'remote_ip': u'10.2.31.2'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t4ns1\" ip link show \"vxlan_t4s1\" ; if [ $? -ne 0 ] ; then ip netns exec \"t4ns1\" ip link add \"vxlan_t4s1\" type vxlan id \"42\" local \"10.1.31.2\" remote \"10.2.31.2\" dstport \"4789\" dev \"t4s1if\"; ip netns exec \"t4ns1\" ip link set dev \"vxlan_t4s1\" up ; fi\n", "delta": "0:00:00.032626", "end": "2019-12-05 18:34:39.526723", "item": [{"bridge_name": "t4br1", "default_route_ip": "10.1.31.1", "dns": [{"brif": "t4s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.5", "dnsif": "t4s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t4ns1", "route": [{"if": "p1", "ip": "10.1.31.1/24", "ns_if": "t4if", "ns_name": "t4"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t4ns1if", "tenant_ns_ip": "10.1.31.1/24", "tenant_ns_name": "t4", "tenant_sub_if": "t4s1if", "tenant_sub_ip": "10.1.31.2/24"}], "vms": [{"brif": "t4br1if1", "disk": "10G", "mem": 2, "name": "t4_VM1", "vcpu": 4, "vmif": "t4VM1if1"}, {"brif": "t4br1if2", "disk": "10G", "mem": 4, "name": "t4_VM2", "vcpu": 2, "vmif": "t4VM2if1"}]}, {"dev": "t4s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.31.2", "remote_ip": "10.2.31.2", "remote_route": "10.2.31.0/24", "subnet_route": "10.1.31.0/24", "tenant_route_ip": "192.168.4.2", "v_name": "vxlan_t4s1"}], "rc": 0, "start": "2019-12-05 18:34:39.494097", "stderr": "", "stderr_lines": [], "stdout": "5: vxlan_t4s1: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1450 qdisc noqueue master t4br1 state UNKNOWN mode DEFAULT group default qlen 1000\n    link/ether 12:ef:0e:31:eb:be brd ff:ff:ff:ff:ff:ff", "stdout_lines": ["5: vxlan_t4s1: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1450 qdisc noqueue master t4br1 state UNKNOWN mode DEFAULT group default qlen 1000", "    link/ether 12:ef:0e:31:eb:be brd ff:ff:ff:ff:ff:ff"]}
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.32.1/24', u'ns_name': u't4', u'ns_if': u't4if', u'if': u'p1'}], u'default_route_ip': u'10.1.32.1', u'bridge_name': u't4br2', u'dns': [{u'dnsif': [], u'dhcp_start': [], u'dhcp_end': [], u'dnsif_ip': [], u'net_mask': [], u'brif': []}], u'ns_name': u't4ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.32.2/24', u'tenant_ns_ip': u'10.1.32.1/24', u'tenant_ns_if': u't4ns2if', u'tenant_sub_if': u't4s2if', u'tenant_ns_name': u't4'}], u'subnet_ip': u'2.2.2.0/24', u'vms': [{u'mem': [], u'name': [], u'vcpu': [], u'disk': [], u'brif': [], u'vmif': []}]}, {u'local_ip': u'10.1.32.2', u'dsport': 4789, u'dev': u't4s2if', u'tenant_route_ip': u'192.168.4.2', u'remote_route': u'10.2.32.0/24', u'subnet_route': u'10.1.32.0/24', u'v_name': u'vxlan_t4s2', u'id': 42, u'remote_ip': u'10.2.32.2'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t4ns2\" ip link show \"vxlan_t4s2\" ; if [ $? -ne 0 ] ; then ip netns exec \"t4ns2\" ip link add \"vxlan_t4s2\" type vxlan id \"42\" local \"10.1.32.2\" remote \"10.2.32.2\" dstport \"4789\" dev \"t4s2if\"; ip netns exec \"t4ns2\" ip link set dev \"vxlan_t4s2\" up ; fi\n", "delta": "0:00:00.129436", "end": "2019-12-05 18:34:39.915055", "item": [{"bridge_name": "t4br2", "default_route_ip": "10.1.32.1", "dns": [{"brif": [], "dhcp_end": [], "dhcp_start": [], "dnsif": [], "dnsif_ip": [], "net_mask": []}], "ns_name": "t4ns2", "route": [{"if": "p1", "ip": "10.1.32.1/24", "ns_if": "t4if", "ns_name": "t4"}], "subnet_ip": "2.2.2.0/24", "tenant_ns": [{"tenant_ns_if": "t4ns2if", "tenant_ns_ip": "10.1.32.1/24", "tenant_ns_name": "t4", "tenant_sub_if": "t4s2if", "tenant_sub_ip": "10.1.32.2/24"}], "vms": [{"brif": [], "disk": [], "mem": [], "name": [], "vcpu": [], "vmif": []}]}, {"dev": "t4s2if", "dsport": 4789, "id": 42, "local_ip": "10.1.32.2", "remote_ip": "10.2.32.2", "remote_route": "10.2.32.0/24", "subnet_route": "10.1.32.0/24", "tenant_route_ip": "192.168.4.2", "v_name": "vxlan_t4s2"}], "rc": 0, "start": "2019-12-05 18:34:39.785619", "stderr": "Device \"vxlan_t4s2\" does not exist.", "stderr_lines": ["Device \"vxlan_t4s2\" does not exist."], "stdout": "", "stdout_lines": []}

TASK [Attach VXLANs to bridge] ******************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.31.1/24', u'ns_name': u't4', u'ns_if': u't4if', u'if': u'p1'}], u'default_route_ip': u'10.1.31.1', u'bridge_name': u't4br1', u'dns': [{u'dnsif': u't4s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't4s1_dnsbrif'}], u'ns_name': u't4ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.31.2/24', u'tenant_ns_ip': u'10.1.31.1/24', u'tenant_ns_if': u't4ns1if', u'tenant_sub_if': u't4s1if', u'tenant_ns_name': u't4'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't4_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't4br1if1', u'vmif': u't4VM1if1'}, {u'mem': 4, u'name': u't4_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't4br1if2', u'vmif': u't4VM2if1'}]}, {u'local_ip': u'10.1.31.2', u'dsport': 4789, u'dev': u't4s1if', u'tenant_route_ip': u'192.168.4.2', u'remote_route': u'10.2.31.0/24', u'subnet_route': u'10.1.31.0/24', u'v_name': u'vxlan_t4s1', u'id': 42, u'remote_ip': u'10.2.31.2'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t4ns1\" brctl show \"t4br1\" | grep -w 'vxlan_t4s1' ; if [ $? -ne 0 ] ; then ip netns exec \"t4ns1\" brctl addif \"t4br1\" \"vxlan_t4s1\" ; fi\n", "delta": "0:00:00.032734", "end": "2019-12-05 18:34:40.299080", "item": [{"bridge_name": "t4br1", "default_route_ip": "10.1.31.1", "dns": [{"brif": "t4s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.5", "dnsif": "t4s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t4ns1", "route": [{"if": "p1", "ip": "10.1.31.1/24", "ns_if": "t4if", "ns_name": "t4"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t4ns1if", "tenant_ns_ip": "10.1.31.1/24", "tenant_ns_name": "t4", "tenant_sub_if": "t4s1if", "tenant_sub_ip": "10.1.31.2/24"}], "vms": [{"brif": "t4br1if1", "disk": "10G", "mem": 2, "name": "t4_VM1", "vcpu": 4, "vmif": "t4VM1if1"}, {"brif": "t4br1if2", "disk": "10G", "mem": 4, "name": "t4_VM2", "vcpu": 2, "vmif": "t4VM2if1"}]}, {"dev": "t4s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.31.2", "remote_ip": "10.2.31.2", "remote_route": "10.2.31.0/24", "subnet_route": "10.1.31.0/24", "tenant_route_ip": "192.168.4.2", "v_name": "vxlan_t4s1"}], "rc": 0, "start": "2019-12-05 18:34:40.266346", "stderr": "", "stderr_lines": [], "stdout": "\t\t\t\t\t\t\tvxlan_t4s1", "stdout_lines": ["\t\t\t\t\t\t\tvxlan_t4s1"]}
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.32.1/24', u'ns_name': u't4', u'ns_if': u't4if', u'if': u'p1'}], u'default_route_ip': u'10.1.32.1', u'bridge_name': u't4br2', u'dns': [{u'dnsif': [], u'dhcp_start': [], u'dhcp_end': [], u'dnsif_ip': [], u'net_mask': [], u'brif': []}], u'ns_name': u't4ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.32.2/24', u'tenant_ns_ip': u'10.1.32.1/24', u'tenant_ns_if': u't4ns2if', u'tenant_sub_if': u't4s2if', u'tenant_ns_name': u't4'}], u'subnet_ip': u'2.2.2.0/24', u'vms': [{u'mem': [], u'name': [], u'vcpu': [], u'disk': [], u'brif': [], u'vmif': []}]}, {u'local_ip': u'10.1.32.2', u'dsport': 4789, u'dev': u't4s2if', u'tenant_route_ip': u'192.168.4.2', u'remote_route': u'10.2.32.0/24', u'subnet_route': u'10.1.32.0/24', u'v_name': u'vxlan_t4s2', u'id': 42, u'remote_ip': u'10.2.32.2'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t4ns2\" brctl show \"t4br2\" | grep -w 'vxlan_t4s2' ; if [ $? -ne 0 ] ; then ip netns exec \"t4ns2\" brctl addif \"t4br2\" \"vxlan_t4s2\" ; fi\n", "delta": "0:00:00.075989", "end": "2019-12-05 18:34:40.634802", "item": [{"bridge_name": "t4br2", "default_route_ip": "10.1.32.1", "dns": [{"brif": [], "dhcp_end": [], "dhcp_start": [], "dnsif": [], "dnsif_ip": [], "net_mask": []}], "ns_name": "t4ns2", "route": [{"if": "p1", "ip": "10.1.32.1/24", "ns_if": "t4if", "ns_name": "t4"}], "subnet_ip": "2.2.2.0/24", "tenant_ns": [{"tenant_ns_if": "t4ns2if", "tenant_ns_ip": "10.1.32.1/24", "tenant_ns_name": "t4", "tenant_sub_if": "t4s2if", "tenant_sub_ip": "10.1.32.2/24"}], "vms": [{"brif": [], "disk": [], "mem": [], "name": [], "vcpu": [], "vmif": []}]}, {"dev": "t4s2if", "dsport": 4789, "id": 42, "local_ip": "10.1.32.2", "remote_ip": "10.2.32.2", "remote_route": "10.2.32.0/24", "subnet_route": "10.1.32.0/24", "tenant_route_ip": "192.168.4.2", "v_name": "vxlan_t4s2"}], "rc": 0, "start": "2019-12-05 18:34:40.558813", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

PLAY RECAP **************************************************************************************************************************************************
localhost                  : ok=21   changed=20   unreachable=0    failed=0    skipped=0    rescued=0    ignored=0   

Using /etc/ansible/ansible.cfg as config file

PLAY [worker] ***********************************************************************************************************************************************

TASK [Create Tenant Namespace] ******************************************************************************************************************************
ok: [99.99.99.2] => (item={u'default_route_ip': u'192.168.132.1', u'name': u't4', u'pns_ip': u'192.168.132.1/24', u'tenant_if': u't4if', u'tenant_ip': u'192.168.132.2/24', u'pns_if': u't4pns_if'}) => {"ansible_loop_var": "item", "changed": false, "cmd": ["ip", "netns", "add", "t4"], "item": {"default_route_ip": "192.168.132.1", "name": "t4", "pns_if": "t4pns_if", "pns_ip": "192.168.132.1/24", "tenant_if": "t4if", "tenant_ip": "192.168.132.2/24"}, "rc": 0, "stdout": "skipped, since /var/run/netns/t4 exists", "stdout_lines": ["skipped, since /var/run/netns/t4 exists"]}

TASK [Create Subnet Namespace] ******************************************************************************************************************************
ok: [99.99.99.2] => (item={u'route': [{u'ip': u'10.2.31.1/24', u'ns_name': u't4', u'ns_if': u't4if', u'if': u'p1'}], u'default_route_ip': u'10.2.31.1', u'bridge_name': u't4br1', u'dns': [{u'dnsif': u't4s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't4s1_dnsbrif'}], u'ns_name': u't4ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.31.2/24', u'tenant_ns_ip': u'10.2.31.1/24', u'tenant_ns_if': u't4ns1if', u'tenant_ns_name': u't4', u'tenant_sub_if': u't4s1if'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't4_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't4br1if1', u'vmif': u't4VM4if1'}], u'vxlan': [{u'local_ip': u'10.2.31.2', u'tenant_route_ip': u'192.168.132.2', u'dsport': 4789, u'dev': u't4s1if', u'subnet_route': u'10.2.31.0/24', u'remote_route': u'10.1.31.0/24', u'v_name': u'vxlan_t4s1', u'id': 42, u'remote_ip': u'10.1.31.2'}]}) => {"ansible_loop_var": "item", "changed": false, "cmd": ["ip", "netns", "add", "t4ns1"], "item": {"bridge_name": "t4br1", "default_route_ip": "10.2.31.1", "dns": [{"brif": "t4s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.5", "dnsif": "t4s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t4ns1", "route": [{"if": "p1", "ip": "10.2.31.1/24", "ns_if": "t4if", "ns_name": "t4"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t4ns1if", "tenant_ns_ip": "10.2.31.1/24", "tenant_ns_name": "t4", "tenant_sub_if": "t4s1if", "tenant_sub_ip": "10.2.31.2/24"}], "vms": [{"brif": "t4br1if1", "disk": "10G", "mem": 2, "name": "t4_VM4", "vcpu": 4, "vmif": "t4VM4if1"}], "vxlan": [{"dev": "t4s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.31.2", "remote_ip": "10.1.31.2", "remote_route": "10.1.31.0/24", "subnet_route": "10.2.31.0/24", "tenant_route_ip": "192.168.132.2", "v_name": "vxlan_t4s1"}]}, "rc": 0, "stdout": "skipped, since /var/run/netns/t4ns1 exists", "stdout_lines": ["skipped, since /var/run/netns/t4ns1 exists"]}
ok: [99.99.99.2] => (item={u'route': [{u'ip': u'10.2.32.1/24', u'ns_name': u't4', u'ns_if': u't4if', u'if': u'p1'}], u'default_route_ip': u'10.2.32.1', u'bridge_name': u't4br2', u'dns': [{u'dnsif': u't4s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't4s2_dnsbrif'}], u'ns_name': u't4ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.32.2/24', u'tenant_ns_ip': u'10.2.32.1/24', u'tenant_ns_if': u't4ns2if', u'tenant_ns_name': u't4', u'tenant_sub_if': u't4s2if'}], u'subnet_ip': u'2.2.2.0/24', u'vms': [{u'mem': 3, u'name': u't4_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't4br2if1', u'vmif': u't4VM3if1'}], u'vxlan': [{u'local_ip': u'10.2.32.2', u'tenant_route_ip': u'192.168.132.2', u'dsport': 4789, u'dev': u't4s2if', u'subnet_route': u'10.2.32.0/24', u'remote_route': u'10.1.32.0/24', u'v_name': u'vxlan_t4s2', u'id': 42, u'remote_ip': u'10.1.32.2'}]}) => {"ansible_loop_var": "item", "changed": false, "cmd": ["ip", "netns", "add", "t4ns2"], "item": {"bridge_name": "t4br2", "default_route_ip": "10.2.32.1", "dns": [{"brif": "t4s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t4s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t4ns2", "route": [{"if": "p1", "ip": "10.2.32.1/24", "ns_if": "t4if", "ns_name": "t4"}], "subnet_ip": "2.2.2.0/24", "tenant_ns": [{"tenant_ns_if": "t4ns2if", "tenant_ns_ip": "10.2.32.1/24", "tenant_ns_name": "t4", "tenant_sub_if": "t4s2if", "tenant_sub_ip": "10.2.32.2/24"}], "vms": [{"brif": "t4br2if1", "disk": "10G", "mem": 3, "name": "t4_VM3", "vcpu": 2, "vmif": "t4VM3if1"}], "vxlan": [{"dev": "t4s2if", "dsport": 4789, "id": 42, "local_ip": "10.2.32.2", "remote_ip": "10.1.32.2", "remote_route": "10.1.32.0/24", "subnet_route": "10.2.32.0/24", "tenant_route_ip": "192.168.132.2", "v_name": "vxlan_t4s2"}]}, "rc": 0, "stdout": "skipped, since /var/run/netns/t4ns2 exists", "stdout_lines": ["skipped, since /var/run/netns/t4ns2 exists"]}

TASK [Create Tenant VETH pairs] *****************************************************************************************************************************
changed: [99.99.99.2] => (item={u'default_route_ip': u'192.168.132.1', u'name': u't4', u'pns_ip': u'192.168.132.1/24', u'tenant_if': u't4if', u'tenant_ip': u'192.168.132.2/24', u'pns_if': u't4pns_if'}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip link show \"t4if\" ; if [ $? -ne 0 ] ; then ip link add \"t4if\" type veth peer name \"t4pns_if\" ; fi\n", "delta": "0:00:00.018079", "end": "2019-12-05 18:34:43.951167", "item": {"default_route_ip": "192.168.132.1", "name": "t4", "pns_if": "t4pns_if", "pns_ip": "192.168.132.1/24", "tenant_if": "t4if", "tenant_ip": "192.168.132.2/24"}, "rc": 0, "start": "2019-12-05 18:34:43.933088", "stderr": "Device \"t4if\" does not exist.", "stderr_lines": ["Device \"t4if\" does not exist."], "stdout": "", "stdout_lines": []}

TASK [Attach Tenant VETH Pairs] *****************************************************************************************************************************
changed: [99.99.99.2] => (item={u'default_route_ip': u'192.168.132.1', u'name': u't4', u'pns_ip': u'192.168.132.1/24', u'tenant_if': u't4if', u'tenant_ip': u'192.168.132.2/24', u'pns_if': u't4pns_if'}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec pns ip link show \"t4pns_if\" ; if [ $? -ne 0 ] ; then ip link set \"t4pns_if\" netns pns ; fi\nip netns exec \"t4\" ip link show \"t4if\" ; if [ $? -ne 0 ] ; then ip link set \"t4if\" netns \"t4\" ; fi\nip netns exec pns ip link set dev \"t4pns_if\" up\nip netns exec \"t4\" ip link set dev \"t4if\" up\n", "delta": "0:00:00.137160", "end": "2019-12-05 18:34:44.522547", "item": {"default_route_ip": "192.168.132.1", "name": "t4", "pns_if": "t4pns_if", "pns_ip": "192.168.132.1/24", "tenant_if": "t4if", "tenant_ip": "192.168.132.2/24"}, "rc": 0, "start": "2019-12-05 18:34:44.385387", "stderr": "", "stderr_lines": [], "stdout": "30: t4pns_if@if31: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP mode DEFAULT group default qlen 1000\n    link/ether 2a:00:00:e2:5c:87 brd ff:ff:ff:ff:ff:ff link-netnsid 2\n31: t4if@if30: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP mode DEFAULT group default qlen 1000\n    link/ether 52:da:31:c6:a9:b1 brd ff:ff:ff:ff:ff:ff link-netnsid 0", "stdout_lines": ["30: t4pns_if@if31: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP mode DEFAULT group default qlen 1000", "    link/ether 2a:00:00:e2:5c:87 brd ff:ff:ff:ff:ff:ff link-netnsid 2", "31: t4if@if30: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP mode DEFAULT group default qlen 1000", "    link/ether 52:da:31:c6:a9:b1 brd ff:ff:ff:ff:ff:ff link-netnsid 0"]}

TASK [Add IP addresses to Tenant VETH Pairs] ****************************************************************************************************************
changed: [99.99.99.2] => (item={u'default_route_ip': u'192.168.132.1', u'name': u't4', u'pns_ip': u'192.168.132.1/24', u'tenant_if': u't4if', u'tenant_ip': u'192.168.132.2/24', u'pns_if': u't4pns_if'}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec pns ip addr show \"t4pns_if\" | awk 'FNR==3{ print $2 }' | grep -w '^192.168.132.1/24' ; if [ $? -ne 0 ] ; then ip netns exec pns ip addr add \"192.168.132.1/24\" dev \"t4pns_if\" ; fi\nip netns exec \"t4\" ip addr show \"t4if\" | awk 'FNR==3{ print $2 }' | grep -w '^192.168.132.2/24' ; if [ $? -ne 0 ] ; then ip netns exec \"t4\" ip addr add \"192.168.132.2/24\" dev \"t4if\" ; fi\n", "delta": "0:00:00.077674", "end": "2019-12-05 18:34:45.010946", "item": {"default_route_ip": "192.168.132.1", "name": "t4", "pns_if": "t4pns_if", "pns_ip": "192.168.132.1/24", "tenant_if": "t4if", "tenant_ip": "192.168.132.2/24"}, "rc": 0, "start": "2019-12-05 18:34:44.933272", "stderr": "", "stderr_lines": [], "stdout": "192.168.132.1/24\n192.168.132.2/24", "stdout_lines": ["192.168.132.1/24", "192.168.132.2/24"]}

TASK [Create Namespace VETH Pairs] **************************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.31.1/24', u'ns_name': u't4', u'ns_if': u't4if', u'if': u'p1'}], u'default_route_ip': u'10.2.31.1', u'bridge_name': u't4br1', u'dns': [{u'dnsif': u't4s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't4s1_dnsbrif'}], u'ns_name': u't4ns1', u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't4_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't4br1if1', u'vmif': u't4VM4if1'}], u'vxlan': [{u'local_ip': u'10.2.31.2', u'dsport': 4789, u'dev': u't4s1if', u'tenant_route_ip': u'192.168.132.2', u'remote_route': u'10.1.31.0/24', u'subnet_route': u'10.2.31.0/24', u'v_name': u'vxlan_t4s1', u'id': 42, u'remote_ip': u'10.1.31.2'}]}, {u'tenant_sub_ip': u'10.2.31.2/24', u'tenant_ns_ip': u'10.2.31.1/24', u'tenant_ns_if': u't4ns1if', u'tenant_sub_if': u't4s1if', u'tenant_ns_name': u't4'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip link show \"t4ns1if\" ; if [ $? -ne 0 ] ; then ip link add \"t4ns1if\" type veth peer name \"t4s1if\" ; fi\n", "delta": "0:00:00.018316", "end": "2019-12-05 18:34:45.451928", "item": [{"bridge_name": "t4br1", "default_route_ip": "10.2.31.1", "dns": [{"brif": "t4s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.5", "dnsif": "t4s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t4ns1", "route": [{"if": "p1", "ip": "10.2.31.1/24", "ns_if": "t4if", "ns_name": "t4"}], "subnet_ip": "1.1.1.0/24", "vms": [{"brif": "t4br1if1", "disk": "10G", "mem": 2, "name": "t4_VM4", "vcpu": 4, "vmif": "t4VM4if1"}], "vxlan": [{"dev": "t4s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.31.2", "remote_ip": "10.1.31.2", "remote_route": "10.1.31.0/24", "subnet_route": "10.2.31.0/24", "tenant_route_ip": "192.168.132.2", "v_name": "vxlan_t4s1"}]}, {"tenant_ns_if": "t4ns1if", "tenant_ns_ip": "10.2.31.1/24", "tenant_ns_name": "t4", "tenant_sub_if": "t4s1if", "tenant_sub_ip": "10.2.31.2/24"}], "rc": 0, "start": "2019-12-05 18:34:45.433612", "stderr": "Device \"t4ns1if\" does not exist.", "stderr_lines": ["Device \"t4ns1if\" does not exist."], "stdout": "", "stdout_lines": []}
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.32.1/24', u'ns_name': u't4', u'ns_if': u't4if', u'if': u'p1'}], u'default_route_ip': u'10.2.32.1', u'bridge_name': u't4br2', u'dns': [{u'dnsif': u't4s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't4s2_dnsbrif'}], u'ns_name': u't4ns2', u'subnet_ip': u'2.2.2.0/24', u'vms': [{u'mem': 3, u'name': u't4_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't4br2if1', u'vmif': u't4VM3if1'}], u'vxlan': [{u'local_ip': u'10.2.32.2', u'dsport': 4789, u'dev': u't4s2if', u'tenant_route_ip': u'192.168.132.2', u'remote_route': u'10.1.32.0/24', u'subnet_route': u'10.2.32.0/24', u'v_name': u'vxlan_t4s2', u'id': 42, u'remote_ip': u'10.1.32.2'}]}, {u'tenant_sub_ip': u'10.2.32.2/24', u'tenant_ns_ip': u'10.2.32.1/24', u'tenant_ns_if': u't4ns2if', u'tenant_sub_if': u't4s2if', u'tenant_ns_name': u't4'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip link show \"t4ns2if\" ; if [ $? -ne 0 ] ; then ip link add \"t4ns2if\" type veth peer name \"t4s2if\" ; fi\n", "delta": "0:00:00.013214", "end": "2019-12-05 18:34:45.819787", "item": [{"bridge_name": "t4br2", "default_route_ip": "10.2.32.1", "dns": [{"brif": "t4s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t4s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t4ns2", "route": [{"if": "p1", "ip": "10.2.32.1/24", "ns_if": "t4if", "ns_name": "t4"}], "subnet_ip": "2.2.2.0/24", "vms": [{"brif": "t4br2if1", "disk": "10G", "mem": 3, "name": "t4_VM3", "vcpu": 2, "vmif": "t4VM3if1"}], "vxlan": [{"dev": "t4s2if", "dsport": 4789, "id": 42, "local_ip": "10.2.32.2", "remote_ip": "10.1.32.2", "remote_route": "10.1.32.0/24", "subnet_route": "10.2.32.0/24", "tenant_route_ip": "192.168.132.2", "v_name": "vxlan_t4s2"}]}, {"tenant_ns_if": "t4ns2if", "tenant_ns_ip": "10.2.32.1/24", "tenant_ns_name": "t4", "tenant_sub_if": "t4s2if", "tenant_sub_ip": "10.2.32.2/24"}], "rc": 0, "start": "2019-12-05 18:34:45.806573", "stderr": "Device \"t4ns2if\" does not exist.", "stderr_lines": ["Device \"t4ns2if\" does not exist."], "stdout": "", "stdout_lines": []}

TASK [Attach Namespace VETH Pairs] **************************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.31.1/24', u'ns_name': u't4', u'ns_if': u't4if', u'if': u'p1'}], u'default_route_ip': u'10.2.31.1', u'bridge_name': u't4br1', u'dns': [{u'dnsif': u't4s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't4s1_dnsbrif'}], u'ns_name': u't4ns1', u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't4_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't4br1if1', u'vmif': u't4VM4if1'}], u'vxlan': [{u'local_ip': u'10.2.31.2', u'dsport': 4789, u'dev': u't4s1if', u'tenant_route_ip': u'192.168.132.2', u'remote_route': u'10.1.31.0/24', u'subnet_route': u'10.2.31.0/24', u'v_name': u'vxlan_t4s1', u'id': 42, u'remote_ip': u'10.1.31.2'}]}, {u'tenant_sub_ip': u'10.2.31.2/24', u'tenant_ns_ip': u'10.2.31.1/24', u'tenant_ns_if': u't4ns1if', u'tenant_sub_if': u't4s1if', u'tenant_ns_name': u't4'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t4\" ip link show \"t4ns1if\" ; if [ $? -ne 0 ] ; then ip link set \"t4ns1if\" netns \"t4\" ; fi\nip netns exec \"t4ns1\" ip link show \"t4s1if\" ; if [ $? -ne 0 ] ; then ip link set \"t4s1if\" netns \"t4ns1\" ; fi\n", "delta": "0:00:00.079189", "end": "2019-12-05 18:34:46.370676", "item": [{"bridge_name": "t4br1", "default_route_ip": "10.2.31.1", "dns": [{"brif": "t4s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.5", "dnsif": "t4s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t4ns1", "route": [{"if": "p1", "ip": "10.2.31.1/24", "ns_if": "t4if", "ns_name": "t4"}], "subnet_ip": "1.1.1.0/24", "vms": [{"brif": "t4br1if1", "disk": "10G", "mem": 2, "name": "t4_VM4", "vcpu": 4, "vmif": "t4VM4if1"}], "vxlan": [{"dev": "t4s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.31.2", "remote_ip": "10.1.31.2", "remote_route": "10.1.31.0/24", "subnet_route": "10.2.31.0/24", "tenant_route_ip": "192.168.132.2", "v_name": "vxlan_t4s1"}]}, {"tenant_ns_if": "t4ns1if", "tenant_ns_ip": "10.2.31.1/24", "tenant_ns_name": "t4", "tenant_sub_if": "t4s1if", "tenant_sub_ip": "10.2.31.2/24"}], "rc": 0, "start": "2019-12-05 18:34:46.291487", "stderr": "", "stderr_lines": [], "stdout": "33: t4ns1if@if32: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP mode DEFAULT group default qlen 1000\n    link/ether 8a:0d:ae:0b:e5:f7 brd ff:ff:ff:ff:ff:ff link-netnsid 2\n32: t4s1if@if33: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP mode DEFAULT group default qlen 1000\n    link/ether 6a:2a:90:34:2d:03 brd ff:ff:ff:ff:ff:ff link-netnsid 0", "stdout_lines": ["33: t4ns1if@if32: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP mode DEFAULT group default qlen 1000", "    link/ether 8a:0d:ae:0b:e5:f7 brd ff:ff:ff:ff:ff:ff link-netnsid 2", "32: t4s1if@if33: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP mode DEFAULT group default qlen 1000", "    link/ether 6a:2a:90:34:2d:03 brd ff:ff:ff:ff:ff:ff link-netnsid 0"]}
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.32.1/24', u'ns_name': u't4', u'ns_if': u't4if', u'if': u'p1'}], u'default_route_ip': u'10.2.32.1', u'bridge_name': u't4br2', u'dns': [{u'dnsif': u't4s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't4s2_dnsbrif'}], u'ns_name': u't4ns2', u'subnet_ip': u'2.2.2.0/24', u'vms': [{u'mem': 3, u'name': u't4_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't4br2if1', u'vmif': u't4VM3if1'}], u'vxlan': [{u'local_ip': u'10.2.32.2', u'dsport': 4789, u'dev': u't4s2if', u'tenant_route_ip': u'192.168.132.2', u'remote_route': u'10.1.32.0/24', u'subnet_route': u'10.2.32.0/24', u'v_name': u'vxlan_t4s2', u'id': 42, u'remote_ip': u'10.1.32.2'}]}, {u'tenant_sub_ip': u'10.2.32.2/24', u'tenant_ns_ip': u'10.2.32.1/24', u'tenant_ns_if': u't4ns2if', u'tenant_sub_if': u't4s2if', u'tenant_ns_name': u't4'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t4\" ip link show \"t4ns2if\" ; if [ $? -ne 0 ] ; then ip link set \"t4ns2if\" netns \"t4\" ; fi\nip netns exec \"t4ns2\" ip link show \"t4s2if\" ; if [ $? -ne 0 ] ; then ip link set \"t4s2if\" netns \"t4ns2\" ; fi\n", "delta": "0:00:00.069017", "end": "2019-12-05 18:34:46.806536", "item": [{"bridge_name": "t4br2", "default_route_ip": "10.2.32.1", "dns": [{"brif": "t4s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t4s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t4ns2", "route": [{"if": "p1", "ip": "10.2.32.1/24", "ns_if": "t4if", "ns_name": "t4"}], "subnet_ip": "2.2.2.0/24", "vms": [{"brif": "t4br2if1", "disk": "10G", "mem": 3, "name": "t4_VM3", "vcpu": 2, "vmif": "t4VM3if1"}], "vxlan": [{"dev": "t4s2if", "dsport": 4789, "id": 42, "local_ip": "10.2.32.2", "remote_ip": "10.1.32.2", "remote_route": "10.1.32.0/24", "subnet_route": "10.2.32.0/24", "tenant_route_ip": "192.168.132.2", "v_name": "vxlan_t4s2"}]}, {"tenant_ns_if": "t4ns2if", "tenant_ns_ip": "10.2.32.1/24", "tenant_ns_name": "t4", "tenant_sub_if": "t4s2if", "tenant_sub_ip": "10.2.32.2/24"}], "rc": 0, "start": "2019-12-05 18:34:46.737519", "stderr": "", "stderr_lines": [], "stdout": "35: t4ns2if@if34: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP mode DEFAULT group default qlen 1000\n    link/ether 52:5c:9e:55:80:63 brd ff:ff:ff:ff:ff:ff link-netnsid 3\n34: t4s2if@if35: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP mode DEFAULT group default qlen 1000\n    link/ether 62:94:c9:9e:f0:86 brd ff:ff:ff:ff:ff:ff link-netnsid 0", "stdout_lines": ["35: t4ns2if@if34: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP mode DEFAULT group default qlen 1000", "    link/ether 52:5c:9e:55:80:63 brd ff:ff:ff:ff:ff:ff link-netnsid 3", "34: t4s2if@if35: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP mode DEFAULT group default qlen 1000", "    link/ether 62:94:c9:9e:f0:86 brd ff:ff:ff:ff:ff:ff link-netnsid 0"]}

TASK [Set Namespace VETH Pairs UP] **************************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.31.1/24', u'ns_name': u't4', u'ns_if': u't4if', u'if': u'p1'}], u'default_route_ip': u'10.2.31.1', u'bridge_name': u't4br1', u'dns': [{u'dnsif': u't4s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't4s1_dnsbrif'}], u'ns_name': u't4ns1', u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't4_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't4br1if1', u'vmif': u't4VM4if1'}], u'vxlan': [{u'local_ip': u'10.2.31.2', u'dsport': 4789, u'dev': u't4s1if', u'tenant_route_ip': u'192.168.132.2', u'remote_route': u'10.1.31.0/24', u'subnet_route': u'10.2.31.0/24', u'v_name': u'vxlan_t4s1', u'id': 42, u'remote_ip': u'10.1.31.2'}]}, {u'tenant_sub_ip': u'10.2.31.2/24', u'tenant_ns_ip': u'10.2.31.1/24', u'tenant_ns_if': u't4ns1if', u'tenant_sub_if': u't4s1if', u'tenant_ns_name': u't4'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t4\" ip link set dev \"t4ns1if\" up\nip netns exec \"t4ns1\" ip link set dev \"t4s1if\" up\n", "delta": "0:00:00.065218", "end": "2019-12-05 18:34:47.318530", "item": [{"bridge_name": "t4br1", "default_route_ip": "10.2.31.1", "dns": [{"brif": "t4s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.5", "dnsif": "t4s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t4ns1", "route": [{"if": "p1", "ip": "10.2.31.1/24", "ns_if": "t4if", "ns_name": "t4"}], "subnet_ip": "1.1.1.0/24", "vms": [{"brif": "t4br1if1", "disk": "10G", "mem": 2, "name": "t4_VM4", "vcpu": 4, "vmif": "t4VM4if1"}], "vxlan": [{"dev": "t4s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.31.2", "remote_ip": "10.1.31.2", "remote_route": "10.1.31.0/24", "subnet_route": "10.2.31.0/24", "tenant_route_ip": "192.168.132.2", "v_name": "vxlan_t4s1"}]}, {"tenant_ns_if": "t4ns1if", "tenant_ns_ip": "10.2.31.1/24", "tenant_ns_name": "t4", "tenant_sub_if": "t4s1if", "tenant_sub_ip": "10.2.31.2/24"}], "rc": 0, "start": "2019-12-05 18:34:47.253312", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.32.1/24', u'ns_name': u't4', u'ns_if': u't4if', u'if': u'p1'}], u'default_route_ip': u'10.2.32.1', u'bridge_name': u't4br2', u'dns': [{u'dnsif': u't4s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't4s2_dnsbrif'}], u'ns_name': u't4ns2', u'subnet_ip': u'2.2.2.0/24', u'vms': [{u'mem': 3, u'name': u't4_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't4br2if1', u'vmif': u't4VM3if1'}], u'vxlan': [{u'local_ip': u'10.2.32.2', u'dsport': 4789, u'dev': u't4s2if', u'tenant_route_ip': u'192.168.132.2', u'remote_route': u'10.1.32.0/24', u'subnet_route': u'10.2.32.0/24', u'v_name': u'vxlan_t4s2', u'id': 42, u'remote_ip': u'10.1.32.2'}]}, {u'tenant_sub_ip': u'10.2.32.2/24', u'tenant_ns_ip': u'10.2.32.1/24', u'tenant_ns_if': u't4ns2if', u'tenant_sub_if': u't4s2if', u'tenant_ns_name': u't4'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t4\" ip link set dev \"t4ns2if\" up\nip netns exec \"t4ns2\" ip link set dev \"t4s2if\" up\n", "delta": "0:00:00.074513", "end": "2019-12-05 18:34:47.778589", "item": [{"bridge_name": "t4br2", "default_route_ip": "10.2.32.1", "dns": [{"brif": "t4s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t4s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t4ns2", "route": [{"if": "p1", "ip": "10.2.32.1/24", "ns_if": "t4if", "ns_name": "t4"}], "subnet_ip": "2.2.2.0/24", "vms": [{"brif": "t4br2if1", "disk": "10G", "mem": 3, "name": "t4_VM3", "vcpu": 2, "vmif": "t4VM3if1"}], "vxlan": [{"dev": "t4s2if", "dsport": 4789, "id": 42, "local_ip": "10.2.32.2", "remote_ip": "10.1.32.2", "remote_route": "10.1.32.0/24", "subnet_route": "10.2.32.0/24", "tenant_route_ip": "192.168.132.2", "v_name": "vxlan_t4s2"}]}, {"tenant_ns_if": "t4ns2if", "tenant_ns_ip": "10.2.32.1/24", "tenant_ns_name": "t4", "tenant_sub_if": "t4s2if", "tenant_sub_ip": "10.2.32.2/24"}], "rc": 0, "start": "2019-12-05 18:34:47.704076", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Add IP addresses to Namespace VETH Pairs] *************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.31.1/24', u'ns_name': u't4', u'ns_if': u't4if', u'if': u'p1'}], u'default_route_ip': u'10.2.31.1', u'bridge_name': u't4br1', u'dns': [{u'dnsif': u't4s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't4s1_dnsbrif'}], u'ns_name': u't4ns1', u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't4_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't4br1if1', u'vmif': u't4VM4if1'}], u'vxlan': [{u'local_ip': u'10.2.31.2', u'dsport': 4789, u'dev': u't4s1if', u'tenant_route_ip': u'192.168.132.2', u'remote_route': u'10.1.31.0/24', u'subnet_route': u'10.2.31.0/24', u'v_name': u'vxlan_t4s1', u'id': 42, u'remote_ip': u'10.1.31.2'}]}, {u'tenant_sub_ip': u'10.2.31.2/24', u'tenant_ns_ip': u'10.2.31.1/24', u'tenant_ns_if': u't4ns1if', u'tenant_sub_if': u't4s1if', u'tenant_ns_name': u't4'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t4ns1\" ip addr show \"t4s1if\" | awk 'FNR==3{ print $2 }' | grep -w '^10.2.31.2/24' ; if [ $? -ne 0 ] ; then ip netns exec \"t4ns1\" ip addr add \"10.2.31.2/24\" dev \"t4s1if\" ; fi\n\nip netns exec \"t4\" ip addr show \"t4ns1if\" | awk 'FNR==3{ print $2 }' | grep -w '^10.2.31.1/24' ; if [ $? -ne 0 ] ; then ip netns exec \"t4\" ip addr add \"10.2.31.1/24\" dev \"t4ns1if\" ; fi\n", "delta": "0:00:00.069666", "end": "2019-12-05 18:34:48.271136", "item": [{"bridge_name": "t4br1", "default_route_ip": "10.2.31.1", "dns": [{"brif": "t4s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.5", "dnsif": "t4s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t4ns1", "route": [{"if": "p1", "ip": "10.2.31.1/24", "ns_if": "t4if", "ns_name": "t4"}], "subnet_ip": "1.1.1.0/24", "vms": [{"brif": "t4br1if1", "disk": "10G", "mem": 2, "name": "t4_VM4", "vcpu": 4, "vmif": "t4VM4if1"}], "vxlan": [{"dev": "t4s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.31.2", "remote_ip": "10.1.31.2", "remote_route": "10.1.31.0/24", "subnet_route": "10.2.31.0/24", "tenant_route_ip": "192.168.132.2", "v_name": "vxlan_t4s1"}]}, {"tenant_ns_if": "t4ns1if", "tenant_ns_ip": "10.2.31.1/24", "tenant_ns_name": "t4", "tenant_sub_if": "t4s1if", "tenant_sub_ip": "10.2.31.2/24"}], "rc": 0, "start": "2019-12-05 18:34:48.201470", "stderr": "", "stderr_lines": [], "stdout": "10.2.31.2/24\n10.2.31.1/24", "stdout_lines": ["10.2.31.2/24", "10.2.31.1/24"]}
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.32.1/24', u'ns_name': u't4', u'ns_if': u't4if', u'if': u'p1'}], u'default_route_ip': u'10.2.32.1', u'bridge_name': u't4br2', u'dns': [{u'dnsif': u't4s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't4s2_dnsbrif'}], u'ns_name': u't4ns2', u'subnet_ip': u'2.2.2.0/24', u'vms': [{u'mem': 3, u'name': u't4_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't4br2if1', u'vmif': u't4VM3if1'}], u'vxlan': [{u'local_ip': u'10.2.32.2', u'dsport': 4789, u'dev': u't4s2if', u'tenant_route_ip': u'192.168.132.2', u'remote_route': u'10.1.32.0/24', u'subnet_route': u'10.2.32.0/24', u'v_name': u'vxlan_t4s2', u'id': 42, u'remote_ip': u'10.1.32.2'}]}, {u'tenant_sub_ip': u'10.2.32.2/24', u'tenant_ns_ip': u'10.2.32.1/24', u'tenant_ns_if': u't4ns2if', u'tenant_sub_if': u't4s2if', u'tenant_ns_name': u't4'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t4ns2\" ip addr show \"t4s2if\" | awk 'FNR==3{ print $2 }' | grep -w '^10.2.32.2/24' ; if [ $? -ne 0 ] ; then ip netns exec \"t4ns2\" ip addr add \"10.2.32.2/24\" dev \"t4s2if\" ; fi\n\nip netns exec \"t4\" ip addr show \"t4ns2if\" | awk 'FNR==3{ print $2 }' | grep -w '^10.2.32.1/24' ; if [ $? -ne 0 ] ; then ip netns exec \"t4\" ip addr add \"10.2.32.1/24\" dev \"t4ns2if\" ; fi\n", "delta": "0:00:00.067995", "end": "2019-12-05 18:34:48.666970", "item": [{"bridge_name": "t4br2", "default_route_ip": "10.2.32.1", "dns": [{"brif": "t4s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t4s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t4ns2", "route": [{"if": "p1", "ip": "10.2.32.1/24", "ns_if": "t4if", "ns_name": "t4"}], "subnet_ip": "2.2.2.0/24", "vms": [{"brif": "t4br2if1", "disk": "10G", "mem": 3, "name": "t4_VM3", "vcpu": 2, "vmif": "t4VM3if1"}], "vxlan": [{"dev": "t4s2if", "dsport": 4789, "id": 42, "local_ip": "10.2.32.2", "remote_ip": "10.1.32.2", "remote_route": "10.1.32.0/24", "subnet_route": "10.2.32.0/24", "tenant_route_ip": "192.168.132.2", "v_name": "vxlan_t4s2"}]}, {"tenant_ns_if": "t4ns2if", "tenant_ns_ip": "10.2.32.1/24", "tenant_ns_name": "t4", "tenant_sub_if": "t4s2if", "tenant_sub_ip": "10.2.32.2/24"}], "rc": 0, "start": "2019-12-05 18:34:48.598975", "stderr": "", "stderr_lines": [], "stdout": "10.2.32.2/24\n10.2.32.1/24", "stdout_lines": ["10.2.32.2/24", "10.2.32.1/24"]}

TASK [Add IP Route to Tenant] *******************************************************************************************************************************
changed: [99.99.99.2] => (item={u'default_route_ip': u'192.168.132.1', u'name': u't4', u'pns_ip': u'192.168.132.1/24', u'tenant_if': u't4if', u'tenant_ip': u'192.168.132.2/24', u'pns_if': u't4pns_if'}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t4\" ip route show default | grep -w '[d]efault via 192.168.132.1' ; if [ $? -ne 0 ] ; then ip netns exec \"t4\" ip route add default via \"192.168.132.1\" ; fi\n", "delta": "0:00:00.039893", "end": "2019-12-05 18:34:49.142877", "item": {"default_route_ip": "192.168.132.1", "name": "t4", "pns_if": "t4pns_if", "pns_ip": "192.168.132.1/24", "tenant_if": "t4if", "tenant_ip": "192.168.132.2/24"}, "rc": 0, "start": "2019-12-05 18:34:49.102984", "stderr": "", "stderr_lines": [], "stdout": "default via 192.168.132.1 dev t4if ", "stdout_lines": ["default via 192.168.132.1 dev t4if "]}

TASK [Add IP Route to Tenant Subnet] ************************************************************************************************************************
changed: [99.99.99.2] => (item={u'route': [{u'ip': u'10.2.31.1/24', u'ns_name': u't4', u'ns_if': u't4if', u'if': u'p1'}], u'default_route_ip': u'10.2.31.1', u'bridge_name': u't4br1', u'dns': [{u'dnsif': u't4s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't4s1_dnsbrif'}], u'ns_name': u't4ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.31.2/24', u'tenant_ns_ip': u'10.2.31.1/24', u'tenant_ns_if': u't4ns1if', u'tenant_ns_name': u't4', u'tenant_sub_if': u't4s1if'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't4_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't4br1if1', u'vmif': u't4VM4if1'}], u'vxlan': [{u'local_ip': u'10.2.31.2', u'tenant_route_ip': u'192.168.132.2', u'dsport': 4789, u'dev': u't4s1if', u'subnet_route': u'10.2.31.0/24', u'remote_route': u'10.1.31.0/24', u'v_name': u'vxlan_t4s1', u'id': 42, u'remote_ip': u'10.1.31.2'}]}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t4ns1\" ip route show default | grep -w '[d]efault via 10.2.31.1' ; if [ $? -ne 0 ] ; then ip netns exec \"t4ns1\" ip route add default via \"10.2.31.1\" ; fi\n", "delta": "0:00:00.033515", "end": "2019-12-05 18:34:49.610844", "item": {"bridge_name": "t4br1", "default_route_ip": "10.2.31.1", "dns": [{"brif": "t4s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.5", "dnsif": "t4s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t4ns1", "route": [{"if": "p1", "ip": "10.2.31.1/24", "ns_if": "t4if", "ns_name": "t4"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t4ns1if", "tenant_ns_ip": "10.2.31.1/24", "tenant_ns_name": "t4", "tenant_sub_if": "t4s1if", "tenant_sub_ip": "10.2.31.2/24"}], "vms": [{"brif": "t4br1if1", "disk": "10G", "mem": 2, "name": "t4_VM4", "vcpu": 4, "vmif": "t4VM4if1"}], "vxlan": [{"dev": "t4s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.31.2", "remote_ip": "10.1.31.2", "remote_route": "10.1.31.0/24", "subnet_route": "10.2.31.0/24", "tenant_route_ip": "192.168.132.2", "v_name": "vxlan_t4s1"}]}, "rc": 0, "start": "2019-12-05 18:34:49.577329", "stderr": "", "stderr_lines": [], "stdout": "default via 10.2.31.1 dev t4s1if ", "stdout_lines": ["default via 10.2.31.1 dev t4s1if "]}
changed: [99.99.99.2] => (item={u'route': [{u'ip': u'10.2.32.1/24', u'ns_name': u't4', u'ns_if': u't4if', u'if': u'p1'}], u'default_route_ip': u'10.2.32.1', u'bridge_name': u't4br2', u'dns': [{u'dnsif': u't4s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't4s2_dnsbrif'}], u'ns_name': u't4ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.32.2/24', u'tenant_ns_ip': u'10.2.32.1/24', u'tenant_ns_if': u't4ns2if', u'tenant_ns_name': u't4', u'tenant_sub_if': u't4s2if'}], u'subnet_ip': u'2.2.2.0/24', u'vms': [{u'mem': 3, u'name': u't4_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't4br2if1', u'vmif': u't4VM3if1'}], u'vxlan': [{u'local_ip': u'10.2.32.2', u'tenant_route_ip': u'192.168.132.2', u'dsport': 4789, u'dev': u't4s2if', u'subnet_route': u'10.2.32.0/24', u'remote_route': u'10.1.32.0/24', u'v_name': u'vxlan_t4s2', u'id': 42, u'remote_ip': u'10.1.32.2'}]}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t4ns2\" ip route show default | grep -w '[d]efault via 10.2.32.1' ; if [ $? -ne 0 ] ; then ip netns exec \"t4ns2\" ip route add default via \"10.2.32.1\" ; fi\n", "delta": "0:00:00.034086", "end": "2019-12-05 18:34:50.038813", "item": {"bridge_name": "t4br2", "default_route_ip": "10.2.32.1", "dns": [{"brif": "t4s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t4s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t4ns2", "route": [{"if": "p1", "ip": "10.2.32.1/24", "ns_if": "t4if", "ns_name": "t4"}], "subnet_ip": "2.2.2.0/24", "tenant_ns": [{"tenant_ns_if": "t4ns2if", "tenant_ns_ip": "10.2.32.1/24", "tenant_ns_name": "t4", "tenant_sub_if": "t4s2if", "tenant_sub_ip": "10.2.32.2/24"}], "vms": [{"brif": "t4br2if1", "disk": "10G", "mem": 3, "name": "t4_VM3", "vcpu": 2, "vmif": "t4VM3if1"}], "vxlan": [{"dev": "t4s2if", "dsport": 4789, "id": 42, "local_ip": "10.2.32.2", "remote_ip": "10.1.32.2", "remote_route": "10.1.32.0/24", "subnet_route": "10.2.32.0/24", "tenant_route_ip": "192.168.132.2", "v_name": "vxlan_t4s2"}]}, "rc": 0, "start": "2019-12-05 18:34:50.004727", "stderr": "", "stderr_lines": [], "stdout": "default via 10.2.32.1 dev t4s2if ", "stdout_lines": ["default via 10.2.32.1 dev t4s2if "]}

TASK [Create bridge inside namespace] ***********************************************************************************************************************
changed: [99.99.99.2] => (item={u'route': [{u'ip': u'10.2.31.1/24', u'ns_name': u't4', u'ns_if': u't4if', u'if': u'p1'}], u'default_route_ip': u'10.2.31.1', u'bridge_name': u't4br1', u'dns': [{u'dnsif': u't4s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't4s1_dnsbrif'}], u'ns_name': u't4ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.31.2/24', u'tenant_ns_ip': u'10.2.31.1/24', u'tenant_ns_if': u't4ns1if', u'tenant_ns_name': u't4', u'tenant_sub_if': u't4s1if'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't4_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't4br1if1', u'vmif': u't4VM4if1'}], u'vxlan': [{u'local_ip': u'10.2.31.2', u'tenant_route_ip': u'192.168.132.2', u'dsport': 4789, u'dev': u't4s1if', u'subnet_route': u'10.2.31.0/24', u'remote_route': u'10.1.31.0/24', u'v_name': u'vxlan_t4s1', u'id': 42, u'remote_ip': u'10.1.31.2'}]}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t4ns1\" brctl show | grep -w '^t4br1'; if [ $? -ne 0 ] ; then ip netns exec \"t4ns1\" brctl addbr \"t4br1\" ; fi\nip netns exec \"t4ns1\" ip link set dev \"t4br1\" up\n", "delta": "0:00:00.079862", "end": "2019-12-05 18:34:50.546639", "item": {"bridge_name": "t4br1", "default_route_ip": "10.2.31.1", "dns": [{"brif": "t4s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.5", "dnsif": "t4s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t4ns1", "route": [{"if": "p1", "ip": "10.2.31.1/24", "ns_if": "t4if", "ns_name": "t4"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t4ns1if", "tenant_ns_ip": "10.2.31.1/24", "tenant_ns_name": "t4", "tenant_sub_if": "t4s1if", "tenant_sub_ip": "10.2.31.2/24"}], "vms": [{"brif": "t4br1if1", "disk": "10G", "mem": 2, "name": "t4_VM4", "vcpu": 4, "vmif": "t4VM4if1"}], "vxlan": [{"dev": "t4s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.31.2", "remote_ip": "10.1.31.2", "remote_route": "10.1.31.0/24", "subnet_route": "10.2.31.0/24", "tenant_route_ip": "192.168.132.2", "v_name": "vxlan_t4s1"}]}, "rc": 0, "start": "2019-12-05 18:34:50.466777", "stderr": "", "stderr_lines": [], "stdout": "t4br1\t\t8000.1aae79158aa9\tno\t\tt4br1if1", "stdout_lines": ["t4br1\t\t8000.1aae79158aa9\tno\t\tt4br1if1"]}
changed: [99.99.99.2] => (item={u'route': [{u'ip': u'10.2.32.1/24', u'ns_name': u't4', u'ns_if': u't4if', u'if': u'p1'}], u'default_route_ip': u'10.2.32.1', u'bridge_name': u't4br2', u'dns': [{u'dnsif': u't4s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't4s2_dnsbrif'}], u'ns_name': u't4ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.32.2/24', u'tenant_ns_ip': u'10.2.32.1/24', u'tenant_ns_if': u't4ns2if', u'tenant_ns_name': u't4', u'tenant_sub_if': u't4s2if'}], u'subnet_ip': u'2.2.2.0/24', u'vms': [{u'mem': 3, u'name': u't4_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't4br2if1', u'vmif': u't4VM3if1'}], u'vxlan': [{u'local_ip': u'10.2.32.2', u'tenant_route_ip': u'192.168.132.2', u'dsport': 4789, u'dev': u't4s2if', u'subnet_route': u'10.2.32.0/24', u'remote_route': u'10.1.32.0/24', u'v_name': u'vxlan_t4s2', u'id': 42, u'remote_ip': u'10.1.32.2'}]}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t4ns2\" brctl show | grep -w '^t4br2'; if [ $? -ne 0 ] ; then ip netns exec \"t4ns2\" brctl addbr \"t4br2\" ; fi\nip netns exec \"t4ns2\" ip link set dev \"t4br2\" up\n", "delta": "0:00:00.068835", "end": "2019-12-05 18:34:50.962514", "item": {"bridge_name": "t4br2", "default_route_ip": "10.2.32.1", "dns": [{"brif": "t4s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t4s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t4ns2", "route": [{"if": "p1", "ip": "10.2.32.1/24", "ns_if": "t4if", "ns_name": "t4"}], "subnet_ip": "2.2.2.0/24", "tenant_ns": [{"tenant_ns_if": "t4ns2if", "tenant_ns_ip": "10.2.32.1/24", "tenant_ns_name": "t4", "tenant_sub_if": "t4s2if", "tenant_sub_ip": "10.2.32.2/24"}], "vms": [{"brif": "t4br2if1", "disk": "10G", "mem": 3, "name": "t4_VM3", "vcpu": 2, "vmif": "t4VM3if1"}], "vxlan": [{"dev": "t4s2if", "dsport": 4789, "id": 42, "local_ip": "10.2.32.2", "remote_ip": "10.1.32.2", "remote_route": "10.1.32.0/24", "subnet_route": "10.2.32.0/24", "tenant_route_ip": "192.168.132.2", "v_name": "vxlan_t4s2"}]}, "rc": 0, "start": "2019-12-05 18:34:50.893679", "stderr": "", "stderr_lines": [], "stdout": "t4br2\t\t8000.3ec5fe585877\tno\t\tt4br2if1", "stdout_lines": ["t4br2\t\t8000.3ec5fe585877\tno\t\tt4br2if1"]}

TASK [Create DNS VETH Pair] *********************************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.31.1/24', u'ns_name': u't4', u'ns_if': u't4if', u'if': u'p1'}], u'default_route_ip': u'10.2.31.1', u'bridge_name': u't4br1', u'ns_name': u't4ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.31.2/24', u'tenant_ns_ip': u'10.2.31.1/24', u'tenant_ns_if': u't4ns1if', u'tenant_sub_if': u't4s1if', u'tenant_ns_name': u't4'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't4_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't4br1if1', u'vmif': u't4VM4if1'}], u'vxlan': [{u'local_ip': u'10.2.31.2', u'dsport': 4789, u'dev': u't4s1if', u'tenant_route_ip': u'192.168.132.2', u'remote_route': u'10.1.31.0/24', u'subnet_route': u'10.2.31.0/24', u'v_name': u'vxlan_t4s1', u'id': 42, u'remote_ip': u'10.1.31.2'}]}, {u'dnsif': u't4s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't4s1_dnsbrif'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t4ns1\" ip link show \"t4s1_dnsbrif\" ; if [ $? -ne 0 ] ; then ip netns exec \"t4ns1\" ip link add \"t4s1_dnsbrif\" type veth peer name \"t4s1_dnsif\" ; fi\nip netns exec \"t4ns1\" ip link set dev \"t4s1_dnsbrif\" up\nip netns exec \"t4ns1\" ip link set dev \"t4s1_dnsif\" up\n", "delta": "0:00:00.115402", "end": "2019-12-05 18:34:51.503790", "item": [{"bridge_name": "t4br1", "default_route_ip": "10.2.31.1", "ns_name": "t4ns1", "route": [{"if": "p1", "ip": "10.2.31.1/24", "ns_if": "t4if", "ns_name": "t4"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t4ns1if", "tenant_ns_ip": "10.2.31.1/24", "tenant_ns_name": "t4", "tenant_sub_if": "t4s1if", "tenant_sub_ip": "10.2.31.2/24"}], "vms": [{"brif": "t4br1if1", "disk": "10G", "mem": 2, "name": "t4_VM4", "vcpu": 4, "vmif": "t4VM4if1"}], "vxlan": [{"dev": "t4s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.31.2", "remote_ip": "10.1.31.2", "remote_route": "10.1.31.0/24", "subnet_route": "10.2.31.0/24", "tenant_route_ip": "192.168.132.2", "v_name": "vxlan_t4s1"}]}, {"brif": "t4s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.5", "dnsif": "t4s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "rc": 0, "start": "2019-12-05 18:34:51.388388", "stderr": "", "stderr_lines": [], "stdout": "4: t4s1_dnsbrif@t4s1_dnsif: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue master t4br1 state UP mode DEFAULT group default qlen 1000\n    link/ether 5e:3d:b3:6e:a1:38 brd ff:ff:ff:ff:ff:ff", "stdout_lines": ["4: t4s1_dnsbrif@t4s1_dnsif: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue master t4br1 state UP mode DEFAULT group default qlen 1000", "    link/ether 5e:3d:b3:6e:a1:38 brd ff:ff:ff:ff:ff:ff"]}
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.32.1/24', u'ns_name': u't4', u'ns_if': u't4if', u'if': u'p1'}], u'default_route_ip': u'10.2.32.1', u'bridge_name': u't4br2', u'ns_name': u't4ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.32.2/24', u'tenant_ns_ip': u'10.2.32.1/24', u'tenant_ns_if': u't4ns2if', u'tenant_sub_if': u't4s2if', u'tenant_ns_name': u't4'}], u'subnet_ip': u'2.2.2.0/24', u'vms': [{u'mem': 3, u'name': u't4_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't4br2if1', u'vmif': u't4VM3if1'}], u'vxlan': [{u'local_ip': u'10.2.32.2', u'dsport': 4789, u'dev': u't4s2if', u'tenant_route_ip': u'192.168.132.2', u'remote_route': u'10.1.32.0/24', u'subnet_route': u'10.2.32.0/24', u'v_name': u'vxlan_t4s2', u'id': 42, u'remote_ip': u'10.1.32.2'}]}, {u'dnsif': u't4s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't4s2_dnsbrif'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t4ns2\" ip link show \"t4s2_dnsbrif\" ; if [ $? -ne 0 ] ; then ip netns exec \"t4ns2\" ip link add \"t4s2_dnsbrif\" type veth peer name \"t4s2_dnsif\" ; fi\nip netns exec \"t4ns2\" ip link set dev \"t4s2_dnsbrif\" up\nip netns exec \"t4ns2\" ip link set dev \"t4s2_dnsif\" up\n", "delta": "0:00:00.110192", "end": "2019-12-05 18:34:51.974594", "item": [{"bridge_name": "t4br2", "default_route_ip": "10.2.32.1", "ns_name": "t4ns2", "route": [{"if": "p1", "ip": "10.2.32.1/24", "ns_if": "t4if", "ns_name": "t4"}], "subnet_ip": "2.2.2.0/24", "tenant_ns": [{"tenant_ns_if": "t4ns2if", "tenant_ns_ip": "10.2.32.1/24", "tenant_ns_name": "t4", "tenant_sub_if": "t4s2if", "tenant_sub_ip": "10.2.32.2/24"}], "vms": [{"brif": "t4br2if1", "disk": "10G", "mem": 3, "name": "t4_VM3", "vcpu": 2, "vmif": "t4VM3if1"}], "vxlan": [{"dev": "t4s2if", "dsport": 4789, "id": 42, "local_ip": "10.2.32.2", "remote_ip": "10.1.32.2", "remote_route": "10.1.32.0/24", "subnet_route": "10.2.32.0/24", "tenant_route_ip": "192.168.132.2", "v_name": "vxlan_t4s2"}]}, {"brif": "t4s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t4s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "rc": 0, "start": "2019-12-05 18:34:51.864402", "stderr": "", "stderr_lines": [], "stdout": "4: t4s2_dnsbrif@t4s2_dnsif: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue master t4br2 state UP mode DEFAULT group default qlen 1000\n    link/ether 5e:7b:3e:16:e5:b4 brd ff:ff:ff:ff:ff:ff", "stdout_lines": ["4: t4s2_dnsbrif@t4s2_dnsif: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue master t4br2 state UP mode DEFAULT group default qlen 1000", "    link/ether 5e:7b:3e:16:e5:b4 brd ff:ff:ff:ff:ff:ff"]}

TASK [Attach DNS VETH Pair] *********************************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.31.1/24', u'ns_name': u't4', u'ns_if': u't4if', u'if': u'p1'}], u'default_route_ip': u'10.2.31.1', u'bridge_name': u't4br1', u'ns_name': u't4ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.31.2/24', u'tenant_ns_ip': u'10.2.31.1/24', u'tenant_ns_if': u't4ns1if', u'tenant_sub_if': u't4s1if', u'tenant_ns_name': u't4'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't4_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't4br1if1', u'vmif': u't4VM4if1'}], u'vxlan': [{u'local_ip': u'10.2.31.2', u'dsport': 4789, u'dev': u't4s1if', u'tenant_route_ip': u'192.168.132.2', u'remote_route': u'10.1.31.0/24', u'subnet_route': u'10.2.31.0/24', u'v_name': u'vxlan_t4s1', u'id': 42, u'remote_ip': u'10.1.31.2'}]}, {u'dnsif': u't4s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't4s1_dnsbrif'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t4ns1\" brctl show \"t4br1\" | grep -w 't4s1_dnsbrif' ; if [ $? -ne 0 ] ; then ip netns exec \"t4ns1\" brctl addif \"t4br1\" \"t4s1_dnsbrif\" ; fi\n", "delta": "0:00:00.032705", "end": "2019-12-05 18:34:52.462538", "item": [{"bridge_name": "t4br1", "default_route_ip": "10.2.31.1", "ns_name": "t4ns1", "route": [{"if": "p1", "ip": "10.2.31.1/24", "ns_if": "t4if", "ns_name": "t4"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t4ns1if", "tenant_ns_ip": "10.2.31.1/24", "tenant_ns_name": "t4", "tenant_sub_if": "t4s1if", "tenant_sub_ip": "10.2.31.2/24"}], "vms": [{"brif": "t4br1if1", "disk": "10G", "mem": 2, "name": "t4_VM4", "vcpu": 4, "vmif": "t4VM4if1"}], "vxlan": [{"dev": "t4s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.31.2", "remote_ip": "10.1.31.2", "remote_route": "10.1.31.0/24", "subnet_route": "10.2.31.0/24", "tenant_route_ip": "192.168.132.2", "v_name": "vxlan_t4s1"}]}, {"brif": "t4s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.5", "dnsif": "t4s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "rc": 0, "start": "2019-12-05 18:34:52.429833", "stderr": "", "stderr_lines": [], "stdout": "\t\t\t\t\t\t\tt4s1_dnsbrif", "stdout_lines": ["\t\t\t\t\t\t\tt4s1_dnsbrif"]}
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.32.1/24', u'ns_name': u't4', u'ns_if': u't4if', u'if': u'p1'}], u'default_route_ip': u'10.2.32.1', u'bridge_name': u't4br2', u'ns_name': u't4ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.32.2/24', u'tenant_ns_ip': u'10.2.32.1/24', u'tenant_ns_if': u't4ns2if', u'tenant_sub_if': u't4s2if', u'tenant_ns_name': u't4'}], u'subnet_ip': u'2.2.2.0/24', u'vms': [{u'mem': 3, u'name': u't4_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't4br2if1', u'vmif': u't4VM3if1'}], u'vxlan': [{u'local_ip': u'10.2.32.2', u'dsport': 4789, u'dev': u't4s2if', u'tenant_route_ip': u'192.168.132.2', u'remote_route': u'10.1.32.0/24', u'subnet_route': u'10.2.32.0/24', u'v_name': u'vxlan_t4s2', u'id': 42, u'remote_ip': u'10.1.32.2'}]}, {u'dnsif': u't4s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't4s2_dnsbrif'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t4ns2\" brctl show \"t4br2\" | grep -w 't4s2_dnsbrif' ; if [ $? -ne 0 ] ; then ip netns exec \"t4ns2\" brctl addif \"t4br2\" \"t4s2_dnsbrif\" ; fi\n", "delta": "0:00:00.040775", "end": "2019-12-05 18:34:52.902786", "item": [{"bridge_name": "t4br2", "default_route_ip": "10.2.32.1", "ns_name": "t4ns2", "route": [{"if": "p1", "ip": "10.2.32.1/24", "ns_if": "t4if", "ns_name": "t4"}], "subnet_ip": "2.2.2.0/24", "tenant_ns": [{"tenant_ns_if": "t4ns2if", "tenant_ns_ip": "10.2.32.1/24", "tenant_ns_name": "t4", "tenant_sub_if": "t4s2if", "tenant_sub_ip": "10.2.32.2/24"}], "vms": [{"brif": "t4br2if1", "disk": "10G", "mem": 3, "name": "t4_VM3", "vcpu": 2, "vmif": "t4VM3if1"}], "vxlan": [{"dev": "t4s2if", "dsport": 4789, "id": 42, "local_ip": "10.2.32.2", "remote_ip": "10.1.32.2", "remote_route": "10.1.32.0/24", "subnet_route": "10.2.32.0/24", "tenant_route_ip": "192.168.132.2", "v_name": "vxlan_t4s2"}]}, {"brif": "t4s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t4s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "rc": 0, "start": "2019-12-05 18:34:52.862011", "stderr": "", "stderr_lines": [], "stdout": "\t\t\t\t\t\t\tt4s2_dnsbrif", "stdout_lines": ["\t\t\t\t\t\t\tt4s2_dnsbrif"]}

TASK [Create VETH Pairs] ************************************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.31.1/24', u'ns_name': u't4', u'ns_if': u't4if', u'if': u'p1'}], u'default_route_ip': u'10.2.31.1', u'bridge_name': u't4br1', u'dns': [{u'dnsif': u't4s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't4s1_dnsbrif'}], u'ns_name': u't4ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.31.2/24', u'tenant_ns_ip': u'10.2.31.1/24', u'tenant_ns_if': u't4ns1if', u'tenant_sub_if': u't4s1if', u'tenant_ns_name': u't4'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.2.31.2', u'dsport': 4789, u'dev': u't4s1if', u'tenant_route_ip': u'192.168.132.2', u'remote_route': u'10.1.31.0/24', u'subnet_route': u'10.2.31.0/24', u'v_name': u'vxlan_t4s1', u'id': 42, u'remote_ip': u'10.1.31.2'}]}, {u'mem': 2, u'name': u't4_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't4br1if1', u'vmif': u't4VM4if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip link show \"t4br1if1\" ; if [ $? -ne 0 ] ; then ip link add \"t4VM4if1\" type veth peer name \"t4br1if1\" ; fi\nip link set dev \"t4br1if1\" up\nip link set dev \"t4VM4if1\" up\n", "delta": "0:00:00.015178", "end": "2019-12-05 18:34:53.346001", "item": [{"bridge_name": "t4br1", "default_route_ip": "10.2.31.1", "dns": [{"brif": "t4s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.5", "dnsif": "t4s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t4ns1", "route": [{"if": "p1", "ip": "10.2.31.1/24", "ns_if": "t4if", "ns_name": "t4"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t4ns1if", "tenant_ns_ip": "10.2.31.1/24", "tenant_ns_name": "t4", "tenant_sub_if": "t4s1if", "tenant_sub_ip": "10.2.31.2/24"}], "vxlan": [{"dev": "t4s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.31.2", "remote_ip": "10.1.31.2", "remote_route": "10.1.31.0/24", "subnet_route": "10.2.31.0/24", "tenant_route_ip": "192.168.132.2", "v_name": "vxlan_t4s1"}]}, {"brif": "t4br1if1", "disk": "10G", "mem": 2, "name": "t4_VM4", "vcpu": 4, "vmif": "t4VM4if1"}], "rc": 0, "start": "2019-12-05 18:34:53.330823", "stderr": "Device \"t4br1if1\" does not exist.\nRTNETLINK answers: File exists\nCannot find device \"t4br1if1\"", "stderr_lines": ["Device \"t4br1if1\" does not exist.", "RTNETLINK answers: File exists", "Cannot find device \"t4br1if1\""], "stdout": "", "stdout_lines": []}
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.32.1/24', u'ns_name': u't4', u'ns_if': u't4if', u'if': u'p1'}], u'default_route_ip': u'10.2.32.1', u'bridge_name': u't4br2', u'dns': [{u'dnsif': u't4s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't4s2_dnsbrif'}], u'ns_name': u't4ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.32.2/24', u'tenant_ns_ip': u'10.2.32.1/24', u'tenant_ns_if': u't4ns2if', u'tenant_sub_if': u't4s2if', u'tenant_ns_name': u't4'}], u'subnet_ip': u'2.2.2.0/24', u'vxlan': [{u'local_ip': u'10.2.32.2', u'dsport': 4789, u'dev': u't4s2if', u'tenant_route_ip': u'192.168.132.2', u'remote_route': u'10.1.32.0/24', u'subnet_route': u'10.2.32.0/24', u'v_name': u'vxlan_t4s2', u'id': 42, u'remote_ip': u'10.1.32.2'}]}, {u'mem': 3, u'name': u't4_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't4br2if1', u'vmif': u't4VM3if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip link show \"t4br2if1\" ; if [ $? -ne 0 ] ; then ip link add \"t4VM3if1\" type veth peer name \"t4br2if1\" ; fi\nip link set dev \"t4br2if1\" up\nip link set dev \"t4VM3if1\" up\n", "delta": "0:00:00.015656", "end": "2019-12-05 18:34:53.727579", "item": [{"bridge_name": "t4br2", "default_route_ip": "10.2.32.1", "dns": [{"brif": "t4s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t4s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t4ns2", "route": [{"if": "p1", "ip": "10.2.32.1/24", "ns_if": "t4if", "ns_name": "t4"}], "subnet_ip": "2.2.2.0/24", "tenant_ns": [{"tenant_ns_if": "t4ns2if", "tenant_ns_ip": "10.2.32.1/24", "tenant_ns_name": "t4", "tenant_sub_if": "t4s2if", "tenant_sub_ip": "10.2.32.2/24"}], "vxlan": [{"dev": "t4s2if", "dsport": 4789, "id": 42, "local_ip": "10.2.32.2", "remote_ip": "10.1.32.2", "remote_route": "10.1.32.0/24", "subnet_route": "10.2.32.0/24", "tenant_route_ip": "192.168.132.2", "v_name": "vxlan_t4s2"}]}, {"brif": "t4br2if1", "disk": "10G", "mem": 3, "name": "t4_VM3", "vcpu": 2, "vmif": "t4VM3if1"}], "rc": 0, "start": "2019-12-05 18:34:53.711923", "stderr": "Device \"t4br2if1\" does not exist.\nRTNETLINK answers: File exists\nCannot find device \"t4br2if1\"", "stderr_lines": ["Device \"t4br2if1\" does not exist.", "RTNETLINK answers: File exists", "Cannot find device \"t4br2if1\""], "stdout": "", "stdout_lines": []}

TASK [Attach VETH Pairs] ************************************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.31.1/24', u'ns_name': u't4', u'ns_if': u't4if', u'if': u'p1'}], u'default_route_ip': u'10.2.31.1', u'bridge_name': u't4br1', u'dns': [{u'dnsif': u't4s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't4s1_dnsbrif'}], u'ns_name': u't4ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.31.2/24', u'tenant_ns_ip': u'10.2.31.1/24', u'tenant_ns_if': u't4ns1if', u'tenant_sub_if': u't4s1if', u'tenant_ns_name': u't4'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.2.31.2', u'dsport': 4789, u'dev': u't4s1if', u'tenant_route_ip': u'192.168.132.2', u'remote_route': u'10.1.31.0/24', u'subnet_route': u'10.2.31.0/24', u'v_name': u'vxlan_t4s1', u'id': 42, u'remote_ip': u'10.1.31.2'}]}, {u'mem': 2, u'name': u't4_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't4br1if1', u'vmif': u't4VM4if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip link show \"t4br1if1\" ; if [ $? -eq 0 ] ; then ip link set \"t4br1if1\" netns \"t4ns1\" ; fi\nip netns exec \"t4ns1\" brctl show \"t4br1\" | grep -w 't4br1if1' ; if [ $? -ne 0 ] ; then ip netns exec \"t4ns1\" brctl addif \"t4br1\" \"t4br1if1\" ; fi\n", "delta": "0:00:00.044785", "end": "2019-12-05 18:34:54.198787", "item": [{"bridge_name": "t4br1", "default_route_ip": "10.2.31.1", "dns": [{"brif": "t4s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.5", "dnsif": "t4s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t4ns1", "route": [{"if": "p1", "ip": "10.2.31.1/24", "ns_if": "t4if", "ns_name": "t4"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t4ns1if", "tenant_ns_ip": "10.2.31.1/24", "tenant_ns_name": "t4", "tenant_sub_if": "t4s1if", "tenant_sub_ip": "10.2.31.2/24"}], "vxlan": [{"dev": "t4s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.31.2", "remote_ip": "10.1.31.2", "remote_route": "10.1.31.0/24", "subnet_route": "10.2.31.0/24", "tenant_route_ip": "192.168.132.2", "v_name": "vxlan_t4s1"}]}, {"brif": "t4br1if1", "disk": "10G", "mem": 2, "name": "t4_VM4", "vcpu": 4, "vmif": "t4VM4if1"}], "rc": 0, "start": "2019-12-05 18:34:54.154002", "stderr": "Device \"t4br1if1\" does not exist.", "stderr_lines": ["Device \"t4br1if1\" does not exist."], "stdout": "t4br1\t\t8000.1aae79158aa9\tno\t\tt4br1if1", "stdout_lines": ["t4br1\t\t8000.1aae79158aa9\tno\t\tt4br1if1"]}
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.32.1/24', u'ns_name': u't4', u'ns_if': u't4if', u'if': u'p1'}], u'default_route_ip': u'10.2.32.1', u'bridge_name': u't4br2', u'dns': [{u'dnsif': u't4s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't4s2_dnsbrif'}], u'ns_name': u't4ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.32.2/24', u'tenant_ns_ip': u'10.2.32.1/24', u'tenant_ns_if': u't4ns2if', u'tenant_sub_if': u't4s2if', u'tenant_ns_name': u't4'}], u'subnet_ip': u'2.2.2.0/24', u'vxlan': [{u'local_ip': u'10.2.32.2', u'dsport': 4789, u'dev': u't4s2if', u'tenant_route_ip': u'192.168.132.2', u'remote_route': u'10.1.32.0/24', u'subnet_route': u'10.2.32.0/24', u'v_name': u'vxlan_t4s2', u'id': 42, u'remote_ip': u'10.1.32.2'}]}, {u'mem': 3, u'name': u't4_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't4br2if1', u'vmif': u't4VM3if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip link show \"t4br2if1\" ; if [ $? -eq 0 ] ; then ip link set \"t4br2if1\" netns \"t4ns2\" ; fi\nip netns exec \"t4ns2\" brctl show \"t4br2\" | grep -w 't4br2if1' ; if [ $? -ne 0 ] ; then ip netns exec \"t4ns2\" brctl addif \"t4br2\" \"t4br2if1\" ; fi\n", "delta": "0:00:00.042522", "end": "2019-12-05 18:34:54.602715", "item": [{"bridge_name": "t4br2", "default_route_ip": "10.2.32.1", "dns": [{"brif": "t4s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t4s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t4ns2", "route": [{"if": "p1", "ip": "10.2.32.1/24", "ns_if": "t4if", "ns_name": "t4"}], "subnet_ip": "2.2.2.0/24", "tenant_ns": [{"tenant_ns_if": "t4ns2if", "tenant_ns_ip": "10.2.32.1/24", "tenant_ns_name": "t4", "tenant_sub_if": "t4s2if", "tenant_sub_ip": "10.2.32.2/24"}], "vxlan": [{"dev": "t4s2if", "dsport": 4789, "id": 42, "local_ip": "10.2.32.2", "remote_ip": "10.1.32.2", "remote_route": "10.1.32.0/24", "subnet_route": "10.2.32.0/24", "tenant_route_ip": "192.168.132.2", "v_name": "vxlan_t4s2"}]}, {"brif": "t4br2if1", "disk": "10G", "mem": 3, "name": "t4_VM3", "vcpu": 2, "vmif": "t4VM3if1"}], "rc": 0, "start": "2019-12-05 18:34:54.560193", "stderr": "Device \"t4br2if1\" does not exist.", "stderr_lines": ["Device \"t4br2if1\" does not exist."], "stdout": "t4br2\t\t8000.3ec5fe585877\tno\t\tt4br2if1", "stdout_lines": ["t4br2\t\t8000.3ec5fe585877\tno\t\tt4br2if1"]}

TASK [All interfaces and bridges UP] ************************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.31.1/24', u'ns_name': u't4', u'ns_if': u't4if', u'if': u'p1'}], u'default_route_ip': u'10.2.31.1', u'bridge_name': u't4br1', u'dns': [{u'dnsif': u't4s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't4s1_dnsbrif'}], u'ns_name': u't4ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.31.2/24', u'tenant_ns_ip': u'10.2.31.1/24', u'tenant_ns_if': u't4ns1if', u'tenant_sub_if': u't4s1if', u'tenant_ns_name': u't4'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.2.31.2', u'dsport': 4789, u'dev': u't4s1if', u'tenant_route_ip': u'192.168.132.2', u'remote_route': u'10.1.31.0/24', u'subnet_route': u'10.2.31.0/24', u'v_name': u'vxlan_t4s1', u'id': 42, u'remote_ip': u'10.1.31.2'}]}, {u'mem': 2, u'name': u't4_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't4br1if1', u'vmif': u't4VM4if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t4ns1\" ip link set \"t4br1if1\" up\nip netns exec \"t4ns1\" ip link set dev \"t4br1\" up\n", "delta": "0:00:00.077746", "end": "2019-12-05 18:34:55.114631", "item": [{"bridge_name": "t4br1", "default_route_ip": "10.2.31.1", "dns": [{"brif": "t4s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.5", "dnsif": "t4s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t4ns1", "route": [{"if": "p1", "ip": "10.2.31.1/24", "ns_if": "t4if", "ns_name": "t4"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t4ns1if", "tenant_ns_ip": "10.2.31.1/24", "tenant_ns_name": "t4", "tenant_sub_if": "t4s1if", "tenant_sub_ip": "10.2.31.2/24"}], "vxlan": [{"dev": "t4s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.31.2", "remote_ip": "10.1.31.2", "remote_route": "10.1.31.0/24", "subnet_route": "10.2.31.0/24", "tenant_route_ip": "192.168.132.2", "v_name": "vxlan_t4s1"}]}, {"brif": "t4br1if1", "disk": "10G", "mem": 2, "name": "t4_VM4", "vcpu": 4, "vmif": "t4VM4if1"}], "rc": 0, "start": "2019-12-05 18:34:55.036885", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.32.1/24', u'ns_name': u't4', u'ns_if': u't4if', u'if': u'p1'}], u'default_route_ip': u'10.2.32.1', u'bridge_name': u't4br2', u'dns': [{u'dnsif': u't4s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't4s2_dnsbrif'}], u'ns_name': u't4ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.32.2/24', u'tenant_ns_ip': u'10.2.32.1/24', u'tenant_ns_if': u't4ns2if', u'tenant_sub_if': u't4s2if', u'tenant_ns_name': u't4'}], u'subnet_ip': u'2.2.2.0/24', u'vxlan': [{u'local_ip': u'10.2.32.2', u'dsport': 4789, u'dev': u't4s2if', u'tenant_route_ip': u'192.168.132.2', u'remote_route': u'10.1.32.0/24', u'subnet_route': u'10.2.32.0/24', u'v_name': u'vxlan_t4s2', u'id': 42, u'remote_ip': u'10.1.32.2'}]}, {u'mem': 3, u'name': u't4_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't4br2if1', u'vmif': u't4VM3if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t4ns2\" ip link set \"t4br2if1\" up\nip netns exec \"t4ns2\" ip link set dev \"t4br2\" up\n", "delta": "0:00:00.067223", "end": "2019-12-05 18:34:55.530689", "item": [{"bridge_name": "t4br2", "default_route_ip": "10.2.32.1", "dns": [{"brif": "t4s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t4s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t4ns2", "route": [{"if": "p1", "ip": "10.2.32.1/24", "ns_if": "t4if", "ns_name": "t4"}], "subnet_ip": "2.2.2.0/24", "tenant_ns": [{"tenant_ns_if": "t4ns2if", "tenant_ns_ip": "10.2.32.1/24", "tenant_ns_name": "t4", "tenant_sub_if": "t4s2if", "tenant_sub_ip": "10.2.32.2/24"}], "vxlan": [{"dev": "t4s2if", "dsport": 4789, "id": 42, "local_ip": "10.2.32.2", "remote_ip": "10.1.32.2", "remote_route": "10.1.32.0/24", "subnet_route": "10.2.32.0/24", "tenant_route_ip": "192.168.132.2", "v_name": "vxlan_t4s2"}]}, {"brif": "t4br2if1", "disk": "10G", "mem": 3, "name": "t4_VM3", "vcpu": 2, "vmif": "t4VM3if1"}], "rc": 0, "start": "2019-12-05 18:34:55.463466", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Add IP to DNS Interface] ******************************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.31.1/24', u'ns_name': u't4', u'ns_if': u't4if', u'if': u'p1'}], u'default_route_ip': u'10.2.31.1', u'bridge_name': u't4br1', u'ns_name': u't4ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.31.2/24', u'tenant_ns_ip': u'10.2.31.1/24', u'tenant_ns_if': u't4ns1if', u'tenant_sub_if': u't4s1if', u'tenant_ns_name': u't4'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't4_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't4br1if1', u'vmif': u't4VM4if1'}], u'vxlan': [{u'local_ip': u'10.2.31.2', u'dsport': 4789, u'dev': u't4s1if', u'tenant_route_ip': u'192.168.132.2', u'remote_route': u'10.1.31.0/24', u'subnet_route': u'10.2.31.0/24', u'v_name': u'vxlan_t4s1', u'id': 42, u'remote_ip': u'10.1.31.2'}]}, {u'dnsif': u't4s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't4s1_dnsbrif'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t4ns1\" ip addr show \"t4s1_dnsif\" | awk 'FNR==3{ print $2}'| grep -w '^1.1.1.1/24' ; if [ $? -ne 0 ] ; then ip netns exec \"t4ns1\" ip addr add \"1.1.1.1/24\" dev \"t4s1_dnsif\" ; fi\n", "delta": "0:00:00.035809", "end": "2019-12-05 18:34:55.983127", "item": [{"bridge_name": "t4br1", "default_route_ip": "10.2.31.1", "ns_name": "t4ns1", "route": [{"if": "p1", "ip": "10.2.31.1/24", "ns_if": "t4if", "ns_name": "t4"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t4ns1if", "tenant_ns_ip": "10.2.31.1/24", "tenant_ns_name": "t4", "tenant_sub_if": "t4s1if", "tenant_sub_ip": "10.2.31.2/24"}], "vms": [{"brif": "t4br1if1", "disk": "10G", "mem": 2, "name": "t4_VM4", "vcpu": 4, "vmif": "t4VM4if1"}], "vxlan": [{"dev": "t4s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.31.2", "remote_ip": "10.1.31.2", "remote_route": "10.1.31.0/24", "subnet_route": "10.2.31.0/24", "tenant_route_ip": "192.168.132.2", "v_name": "vxlan_t4s1"}]}, {"brif": "t4s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.5", "dnsif": "t4s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "rc": 0, "start": "2019-12-05 18:34:55.947318", "stderr": "", "stderr_lines": [], "stdout": "1.1.1.1/24", "stdout_lines": ["1.1.1.1/24"]}
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.32.1/24', u'ns_name': u't4', u'ns_if': u't4if', u'if': u'p1'}], u'default_route_ip': u'10.2.32.1', u'bridge_name': u't4br2', u'ns_name': u't4ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.32.2/24', u'tenant_ns_ip': u'10.2.32.1/24', u'tenant_ns_if': u't4ns2if', u'tenant_sub_if': u't4s2if', u'tenant_ns_name': u't4'}], u'subnet_ip': u'2.2.2.0/24', u'vms': [{u'mem': 3, u'name': u't4_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't4br2if1', u'vmif': u't4VM3if1'}], u'vxlan': [{u'local_ip': u'10.2.32.2', u'dsport': 4789, u'dev': u't4s2if', u'tenant_route_ip': u'192.168.132.2', u'remote_route': u'10.1.32.0/24', u'subnet_route': u'10.2.32.0/24', u'v_name': u'vxlan_t4s2', u'id': 42, u'remote_ip': u'10.1.32.2'}]}, {u'dnsif': u't4s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't4s2_dnsbrif'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t4ns2\" ip addr show \"t4s2_dnsif\" | awk 'FNR==3{ print $2}'| grep -w '^2.2.2.1/24' ; if [ $? -ne 0 ] ; then ip netns exec \"t4ns2\" ip addr add \"2.2.2.1/24\" dev \"t4s2_dnsif\" ; fi\n", "delta": "0:00:00.059882", "end": "2019-12-05 18:34:56.387123", "item": [{"bridge_name": "t4br2", "default_route_ip": "10.2.32.1", "ns_name": "t4ns2", "route": [{"if": "p1", "ip": "10.2.32.1/24", "ns_if": "t4if", "ns_name": "t4"}], "subnet_ip": "2.2.2.0/24", "tenant_ns": [{"tenant_ns_if": "t4ns2if", "tenant_ns_ip": "10.2.32.1/24", "tenant_ns_name": "t4", "tenant_sub_if": "t4s2if", "tenant_sub_ip": "10.2.32.2/24"}], "vms": [{"brif": "t4br2if1", "disk": "10G", "mem": 3, "name": "t4_VM3", "vcpu": 2, "vmif": "t4VM3if1"}], "vxlan": [{"dev": "t4s2if", "dsport": 4789, "id": 42, "local_ip": "10.2.32.2", "remote_ip": "10.1.32.2", "remote_route": "10.1.32.0/24", "subnet_route": "10.2.32.0/24", "tenant_route_ip": "192.168.132.2", "v_name": "vxlan_t4s2"}]}, {"brif": "t4s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t4s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "rc": 0, "start": "2019-12-05 18:34:56.327241", "stderr": "", "stderr_lines": [], "stdout": "2.2.2.1/24", "stdout_lines": ["2.2.2.1/24"]}

TASK [Install DHCP Server] **********************************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.31.1/24', u'ns_name': u't4', u'ns_if': u't4if', u'if': u'p1'}], u'default_route_ip': u'10.2.31.1', u'bridge_name': u't4br1', u'ns_name': u't4ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.31.2/24', u'tenant_ns_ip': u'10.2.31.1/24', u'tenant_ns_if': u't4ns1if', u'tenant_sub_if': u't4s1if', u'tenant_ns_name': u't4'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't4_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't4br1if1', u'vmif': u't4VM4if1'}], u'vxlan': [{u'local_ip': u'10.2.31.2', u'dsport': 4789, u'dev': u't4s1if', u'tenant_route_ip': u'192.168.132.2', u'remote_route': u'10.1.31.0/24', u'subnet_route': u'10.2.31.0/24', u'v_name': u'vxlan_t4s1', u'id': 42, u'remote_ip': u'10.1.31.2'}]}, {u'dnsif': u't4s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't4s1_dnsbrif'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t4ns1\" ps aux | grep -w '[d]nsmasq --interface t4s1_dnsif -z --dhcp-range=1.1.1.5,1.1.1.254' ; if [ $? -ne 0 ] ; then ip netns exec \"t4ns1\" dnsmasq --interface \"t4s1_dnsif\" -z --dhcp-range=1.1.1.5,'1.1.1.254' ; fi\n", "delta": "0:00:00.056825", "end": "2019-12-05 18:34:56.886676", "item": [{"bridge_name": "t4br1", "default_route_ip": "10.2.31.1", "ns_name": "t4ns1", "route": [{"if": "p1", "ip": "10.2.31.1/24", "ns_if": "t4if", "ns_name": "t4"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t4ns1if", "tenant_ns_ip": "10.2.31.1/24", "tenant_ns_name": "t4", "tenant_sub_if": "t4s1if", "tenant_sub_ip": "10.2.31.2/24"}], "vms": [{"brif": "t4br1if1", "disk": "10G", "mem": 2, "name": "t4_VM4", "vcpu": 4, "vmif": "t4VM4if1"}], "vxlan": [{"dev": "t4s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.31.2", "remote_ip": "10.1.31.2", "remote_route": "10.1.31.0/24", "subnet_route": "10.2.31.0/24", "tenant_route_ip": "192.168.132.2", "v_name": "vxlan_t4s1"}]}, {"brif": "t4s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.5", "dnsif": "t4s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "rc": 0, "start": "2019-12-05 18:34:56.829851", "stderr": "", "stderr_lines": [], "stdout": "nobody    7995  0.0  0.0  51580  2768 ?        S    18:19   0:00 dnsmasq --interface t4s1_dnsif -z --dhcp-range=1.1.1.5,1.1.1.254", "stdout_lines": ["nobody    7995  0.0  0.0  51580  2768 ?        S    18:19   0:00 dnsmasq --interface t4s1_dnsif -z --dhcp-range=1.1.1.5,1.1.1.254"]}
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.32.1/24', u'ns_name': u't4', u'ns_if': u't4if', u'if': u'p1'}], u'default_route_ip': u'10.2.32.1', u'bridge_name': u't4br2', u'ns_name': u't4ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.32.2/24', u'tenant_ns_ip': u'10.2.32.1/24', u'tenant_ns_if': u't4ns2if', u'tenant_sub_if': u't4s2if', u'tenant_ns_name': u't4'}], u'subnet_ip': u'2.2.2.0/24', u'vms': [{u'mem': 3, u'name': u't4_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't4br2if1', u'vmif': u't4VM3if1'}], u'vxlan': [{u'local_ip': u'10.2.32.2', u'dsport': 4789, u'dev': u't4s2if', u'tenant_route_ip': u'192.168.132.2', u'remote_route': u'10.1.32.0/24', u'subnet_route': u'10.2.32.0/24', u'v_name': u'vxlan_t4s2', u'id': 42, u'remote_ip': u'10.1.32.2'}]}, {u'dnsif': u't4s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't4s2_dnsbrif'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t4ns2\" ps aux | grep -w '[d]nsmasq --interface t4s2_dnsif -z --dhcp-range=2.2.2.5,2.2.2.254' ; if [ $? -ne 0 ] ; then ip netns exec \"t4ns2\" dnsmasq --interface \"t4s2_dnsif\" -z --dhcp-range=2.2.2.5,'2.2.2.254' ; fi\n", "delta": "0:00:00.052886", "end": "2019-12-05 18:34:57.302538", "item": [{"bridge_name": "t4br2", "default_route_ip": "10.2.32.1", "ns_name": "t4ns2", "route": [{"if": "p1", "ip": "10.2.32.1/24", "ns_if": "t4if", "ns_name": "t4"}], "subnet_ip": "2.2.2.0/24", "tenant_ns": [{"tenant_ns_if": "t4ns2if", "tenant_ns_ip": "10.2.32.1/24", "tenant_ns_name": "t4", "tenant_sub_if": "t4s2if", "tenant_sub_ip": "10.2.32.2/24"}], "vms": [{"brif": "t4br2if1", "disk": "10G", "mem": 3, "name": "t4_VM3", "vcpu": 2, "vmif": "t4VM3if1"}], "vxlan": [{"dev": "t4s2if", "dsport": 4789, "id": 42, "local_ip": "10.2.32.2", "remote_ip": "10.1.32.2", "remote_route": "10.1.32.0/24", "subnet_route": "10.2.32.0/24", "tenant_route_ip": "192.168.132.2", "v_name": "vxlan_t4s2"}]}, {"brif": "t4s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t4s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "rc": 0, "start": "2019-12-05 18:34:57.249652", "stderr": "", "stderr_lines": [], "stdout": "nobody    8030  0.0  0.0  51580  2832 ?        S    18:19   0:00 dnsmasq --interface t4s2_dnsif -z --dhcp-range=2.2.2.5,2.2.2.254", "stdout_lines": ["nobody    8030  0.0  0.0  51580  2832 ?        S    18:19   0:00 dnsmasq --interface t4s2_dnsif -z --dhcp-range=2.2.2.5,2.2.2.254"]}

TASK [Create VXLAN devices] *********************************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.31.1/24', u'ns_name': u't4', u'ns_if': u't4if', u'if': u'p1'}], u'default_route_ip': u'10.2.31.1', u'bridge_name': u't4br1', u'dns': [{u'dnsif': u't4s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't4s1_dnsbrif'}], u'ns_name': u't4ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.31.2/24', u'tenant_ns_ip': u'10.2.31.1/24', u'tenant_ns_if': u't4ns1if', u'tenant_sub_if': u't4s1if', u'tenant_ns_name': u't4'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't4_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't4br1if1', u'vmif': u't4VM4if1'}]}, {u'local_ip': u'10.2.31.2', u'dsport': 4789, u'dev': u't4s1if', u'tenant_route_ip': u'192.168.132.2', u'remote_route': u'10.1.31.0/24', u'subnet_route': u'10.2.31.0/24', u'v_name': u'vxlan_t4s1', u'id': 42, u'remote_ip': u'10.1.31.2'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t4ns1\" ip link show \"vxlan_t4s1\" ; if [ $? -ne 0 ] ; then ip netns exec \"t4ns1\" ip link add \"vxlan_t4s1\" type vxlan id \"42\" local \"10.2.31.2\" remote \"10.1.31.2\" dstport \"4789\" dev \"t4s1if\" ; ip netns exec \"t4ns1\" ip link set dev \"vxlan_t4s1\" up ; fi\n", "delta": "0:00:00.044268", "end": "2019-12-05 18:34:57.766642", "item": [{"bridge_name": "t4br1", "default_route_ip": "10.2.31.1", "dns": [{"brif": "t4s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.5", "dnsif": "t4s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t4ns1", "route": [{"if": "p1", "ip": "10.2.31.1/24", "ns_if": "t4if", "ns_name": "t4"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t4ns1if", "tenant_ns_ip": "10.2.31.1/24", "tenant_ns_name": "t4", "tenant_sub_if": "t4s1if", "tenant_sub_ip": "10.2.31.2/24"}], "vms": [{"brif": "t4br1if1", "disk": "10G", "mem": 2, "name": "t4_VM4", "vcpu": 4, "vmif": "t4VM4if1"}]}, {"dev": "t4s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.31.2", "remote_ip": "10.1.31.2", "remote_route": "10.1.31.0/24", "subnet_route": "10.2.31.0/24", "tenant_route_ip": "192.168.132.2", "v_name": "vxlan_t4s1"}], "rc": 0, "start": "2019-12-05 18:34:57.722374", "stderr": "", "stderr_lines": [], "stdout": "5: vxlan_t4s1: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1450 qdisc noqueue master t4br1 state UNKNOWN mode DEFAULT group default qlen 1000\n    link/ether 1a:ae:79:15:8a:a9 brd ff:ff:ff:ff:ff:ff", "stdout_lines": ["5: vxlan_t4s1: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1450 qdisc noqueue master t4br1 state UNKNOWN mode DEFAULT group default qlen 1000", "    link/ether 1a:ae:79:15:8a:a9 brd ff:ff:ff:ff:ff:ff"]}
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.32.1/24', u'ns_name': u't4', u'ns_if': u't4if', u'if': u'p1'}], u'default_route_ip': u'10.2.32.1', u'bridge_name': u't4br2', u'dns': [{u'dnsif': u't4s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't4s2_dnsbrif'}], u'ns_name': u't4ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.32.2/24', u'tenant_ns_ip': u'10.2.32.1/24', u'tenant_ns_if': u't4ns2if', u'tenant_sub_if': u't4s2if', u'tenant_ns_name': u't4'}], u'subnet_ip': u'2.2.2.0/24', u'vms': [{u'mem': 3, u'name': u't4_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't4br2if1', u'vmif': u't4VM3if1'}]}, {u'local_ip': u'10.2.32.2', u'dsport': 4789, u'dev': u't4s2if', u'tenant_route_ip': u'192.168.132.2', u'remote_route': u'10.1.32.0/24', u'subnet_route': u'10.2.32.0/24', u'v_name': u'vxlan_t4s2', u'id': 42, u'remote_ip': u'10.1.32.2'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t4ns2\" ip link show \"vxlan_t4s2\" ; if [ $? -ne 0 ] ; then ip netns exec \"t4ns2\" ip link add \"vxlan_t4s2\" type vxlan id \"42\" local \"10.2.32.2\" remote \"10.1.32.2\" dstport \"4789\" dev \"t4s2if\" ; ip netns exec \"t4ns2\" ip link set dev \"vxlan_t4s2\" up ; fi\n", "delta": "0:00:00.161107", "end": "2019-12-05 18:34:58.302541", "item": [{"bridge_name": "t4br2", "default_route_ip": "10.2.32.1", "dns": [{"brif": "t4s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t4s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t4ns2", "route": [{"if": "p1", "ip": "10.2.32.1/24", "ns_if": "t4if", "ns_name": "t4"}], "subnet_ip": "2.2.2.0/24", "tenant_ns": [{"tenant_ns_if": "t4ns2if", "tenant_ns_ip": "10.2.32.1/24", "tenant_ns_name": "t4", "tenant_sub_if": "t4s2if", "tenant_sub_ip": "10.2.32.2/24"}], "vms": [{"brif": "t4br2if1", "disk": "10G", "mem": 3, "name": "t4_VM3", "vcpu": 2, "vmif": "t4VM3if1"}]}, {"dev": "t4s2if", "dsport": 4789, "id": 42, "local_ip": "10.2.32.2", "remote_ip": "10.1.32.2", "remote_route": "10.1.32.0/24", "subnet_route": "10.2.32.0/24", "tenant_route_ip": "192.168.132.2", "v_name": "vxlan_t4s2"}], "rc": 0, "start": "2019-12-05 18:34:58.141434", "stderr": "Device \"vxlan_t4s2\" does not exist.", "stderr_lines": ["Device \"vxlan_t4s2\" does not exist."], "stdout": "", "stdout_lines": []}

TASK [Attach VXLANs to bridge] ******************************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.31.1/24', u'ns_name': u't4', u'ns_if': u't4if', u'if': u'p1'}], u'default_route_ip': u'10.2.31.1', u'bridge_name': u't4br1', u'dns': [{u'dnsif': u't4s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't4s1_dnsbrif'}], u'ns_name': u't4ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.31.2/24', u'tenant_ns_ip': u'10.2.31.1/24', u'tenant_ns_if': u't4ns1if', u'tenant_sub_if': u't4s1if', u'tenant_ns_name': u't4'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't4_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't4br1if1', u'vmif': u't4VM4if1'}]}, {u'local_ip': u'10.2.31.2', u'dsport': 4789, u'dev': u't4s1if', u'tenant_route_ip': u'192.168.132.2', u'remote_route': u'10.1.31.0/24', u'subnet_route': u'10.2.31.0/24', u'v_name': u'vxlan_t4s1', u'id': 42, u'remote_ip': u'10.1.31.2'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t4ns1\" brctl show \"t4br1\" | grep -w 'vxlan_t4s1' ; if [ $? -ne 0 ] ; then ip netns exec \"t4ns1\" brctl addif \"t4br1\" \"vxlan_t4s1\" ; fi\n", "delta": "0:00:00.047070", "end": "2019-12-05 18:34:58.806740", "item": [{"bridge_name": "t4br1", "default_route_ip": "10.2.31.1", "dns": [{"brif": "t4s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.5", "dnsif": "t4s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t4ns1", "route": [{"if": "p1", "ip": "10.2.31.1/24", "ns_if": "t4if", "ns_name": "t4"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t4ns1if", "tenant_ns_ip": "10.2.31.1/24", "tenant_ns_name": "t4", "tenant_sub_if": "t4s1if", "tenant_sub_ip": "10.2.31.2/24"}], "vms": [{"brif": "t4br1if1", "disk": "10G", "mem": 2, "name": "t4_VM4", "vcpu": 4, "vmif": "t4VM4if1"}]}, {"dev": "t4s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.31.2", "remote_ip": "10.1.31.2", "remote_route": "10.1.31.0/24", "subnet_route": "10.2.31.0/24", "tenant_route_ip": "192.168.132.2", "v_name": "vxlan_t4s1"}], "rc": 0, "start": "2019-12-05 18:34:58.759670", "stderr": "", "stderr_lines": [], "stdout": "\t\t\t\t\t\t\tvxlan_t4s1", "stdout_lines": ["\t\t\t\t\t\t\tvxlan_t4s1"]}
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.32.1/24', u'ns_name': u't4', u'ns_if': u't4if', u'if': u'p1'}], u'default_route_ip': u'10.2.32.1', u'bridge_name': u't4br2', u'dns': [{u'dnsif': u't4s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't4s2_dnsbrif'}], u'ns_name': u't4ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.32.2/24', u'tenant_ns_ip': u'10.2.32.1/24', u'tenant_ns_if': u't4ns2if', u'tenant_sub_if': u't4s2if', u'tenant_ns_name': u't4'}], u'subnet_ip': u'2.2.2.0/24', u'vms': [{u'mem': 3, u'name': u't4_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't4br2if1', u'vmif': u't4VM3if1'}]}, {u'local_ip': u'10.2.32.2', u'dsport': 4789, u'dev': u't4s2if', u'tenant_route_ip': u'192.168.132.2', u'remote_route': u'10.1.32.0/24', u'subnet_route': u'10.2.32.0/24', u'v_name': u'vxlan_t4s2', u'id': 42, u'remote_ip': u'10.1.32.2'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t4ns2\" brctl show \"t4br2\" | grep -w 'vxlan_t4s2' ; if [ $? -ne 0 ] ; then ip netns exec \"t4ns2\" brctl addif \"t4br2\" \"vxlan_t4s2\" ; fi\n", "delta": "0:00:00.075788", "end": "2019-12-05 18:34:59.242755", "item": [{"bridge_name": "t4br2", "default_route_ip": "10.2.32.1", "dns": [{"brif": "t4s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t4s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t4ns2", "route": [{"if": "p1", "ip": "10.2.32.1/24", "ns_if": "t4if", "ns_name": "t4"}], "subnet_ip": "2.2.2.0/24", "tenant_ns": [{"tenant_ns_if": "t4ns2if", "tenant_ns_ip": "10.2.32.1/24", "tenant_ns_name": "t4", "tenant_sub_if": "t4s2if", "tenant_sub_ip": "10.2.32.2/24"}], "vms": [{"brif": "t4br2if1", "disk": "10G", "mem": 3, "name": "t4_VM3", "vcpu": 2, "vmif": "t4VM3if1"}]}, {"dev": "t4s2if", "dsport": 4789, "id": 42, "local_ip": "10.2.32.2", "remote_ip": "10.1.32.2", "remote_route": "10.1.32.0/24", "subnet_route": "10.2.32.0/24", "tenant_route_ip": "192.168.132.2", "v_name": "vxlan_t4s2"}], "rc": 0, "start": "2019-12-05 18:34:59.166967", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

PLAY RECAP **************************************************************************************************************************************************
99.99.99.2                 : ok=21   changed=19   unreachable=0    failed=0    skipped=0    rescued=0    ignored=0   

Using /etc/ansible/ansible.cfg as config file

PLAY [main] *************************************************************************************************************************************************

TASK [Add VXLAN routes in PNS] ******************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.31.1/24', u'ns_name': u't4', u'ns_if': u't4if', u'if': u'p1'}], u'default_route_ip': u'10.1.31.1', u'bridge_name': u't4br1', u'dns': [{u'dnsif': u't4s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't4s1_dnsbrif'}], u'ns_name': u't4ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.31.2/24', u'tenant_ns_ip': u'10.1.31.1/24', u'tenant_ns_if': u't4ns1if', u'tenant_sub_if': u't4s1if', u'tenant_ns_name': u't4'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't4_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't4br1if1', u'vmif': u't4VM1if1'}, {u'mem': 4, u'name': u't4_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't4br1if2', u'vmif': u't4VM2if1'}]}, {u'local_ip': u'10.1.31.2', u'dsport': 4789, u'dev': u't4s1if', u'tenant_route_ip': u'192.168.4.2', u'remote_route': u'10.2.31.0/24', u'subnet_route': u'10.1.31.0/24', u'v_name': u'vxlan_t4s1', u'id': 42, u'remote_ip': u'10.2.31.2'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec pns ip route show \"10.1.31.0/24\" via \"192.168.4.2\" | grep -w '^10.1.31.0/24' ; if [ $? -ne 0 ] ; then ip netns exec pns ip route add \"10.1.31.0/24\" via \"192.168.4.2\" ; fi\n", "delta": "0:00:00.035408", "end": "2019-12-05 18:35:00.454792", "item": [{"bridge_name": "t4br1", "default_route_ip": "10.1.31.1", "dns": [{"brif": "t4s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.5", "dnsif": "t4s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t4ns1", "route": [{"if": "p1", "ip": "10.1.31.1/24", "ns_if": "t4if", "ns_name": "t4"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t4ns1if", "tenant_ns_ip": "10.1.31.1/24", "tenant_ns_name": "t4", "tenant_sub_if": "t4s1if", "tenant_sub_ip": "10.1.31.2/24"}], "vms": [{"brif": "t4br1if1", "disk": "10G", "mem": 2, "name": "t4_VM1", "vcpu": 4, "vmif": "t4VM1if1"}, {"brif": "t4br1if2", "disk": "10G", "mem": 4, "name": "t4_VM2", "vcpu": 2, "vmif": "t4VM2if1"}]}, {"dev": "t4s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.31.2", "remote_ip": "10.2.31.2", "remote_route": "10.2.31.0/24", "subnet_route": "10.1.31.0/24", "tenant_route_ip": "192.168.4.2", "v_name": "vxlan_t4s1"}], "rc": 0, "start": "2019-12-05 18:35:00.419384", "stderr": "", "stderr_lines": [], "stdout": "10.1.31.0/24 dev t4pns_if ", "stdout_lines": ["10.1.31.0/24 dev t4pns_if "]}
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.32.1/24', u'ns_name': u't4', u'ns_if': u't4if', u'if': u'p1'}], u'default_route_ip': u'10.1.32.1', u'bridge_name': u't4br2', u'dns': [{u'dnsif': [], u'dhcp_start': [], u'dhcp_end': [], u'dnsif_ip': [], u'net_mask': [], u'brif': []}], u'ns_name': u't4ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.32.2/24', u'tenant_ns_ip': u'10.1.32.1/24', u'tenant_ns_if': u't4ns2if', u'tenant_sub_if': u't4s2if', u'tenant_ns_name': u't4'}], u'subnet_ip': u'2.2.2.0/24', u'vms': [{u'mem': [], u'name': [], u'vcpu': [], u'disk': [], u'brif': [], u'vmif': []}]}, {u'local_ip': u'10.1.32.2', u'dsport': 4789, u'dev': u't4s2if', u'tenant_route_ip': u'192.168.4.2', u'remote_route': u'10.2.32.0/24', u'subnet_route': u'10.1.32.0/24', u'v_name': u'vxlan_t4s2', u'id': 42, u'remote_ip': u'10.2.32.2'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec pns ip route show \"10.1.32.0/24\" via \"192.168.4.2\" | grep -w '^10.1.32.0/24' ; if [ $? -ne 0 ] ; then ip netns exec pns ip route add \"10.1.32.0/24\" via \"192.168.4.2\" ; fi\n", "delta": "0:00:00.073162", "end": "2019-12-05 18:35:00.786720", "item": [{"bridge_name": "t4br2", "default_route_ip": "10.1.32.1", "dns": [{"brif": [], "dhcp_end": [], "dhcp_start": [], "dnsif": [], "dnsif_ip": [], "net_mask": []}], "ns_name": "t4ns2", "route": [{"if": "p1", "ip": "10.1.32.1/24", "ns_if": "t4if", "ns_name": "t4"}], "subnet_ip": "2.2.2.0/24", "tenant_ns": [{"tenant_ns_if": "t4ns2if", "tenant_ns_ip": "10.1.32.1/24", "tenant_ns_name": "t4", "tenant_sub_if": "t4s2if", "tenant_sub_ip": "10.1.32.2/24"}], "vms": [{"brif": [], "disk": [], "mem": [], "name": [], "vcpu": [], "vmif": []}]}, {"dev": "t4s2if", "dsport": 4789, "id": 42, "local_ip": "10.1.32.2", "remote_ip": "10.2.32.2", "remote_route": "10.2.32.0/24", "subnet_route": "10.1.32.0/24", "tenant_route_ip": "192.168.4.2", "v_name": "vxlan_t4s2"}], "rc": 0, "start": "2019-12-05 18:35:00.713558", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Get PNS ip address] ***********************************************************************************************************************************
ok: [localhost] => {"changed": false, "cmd": "ip netns exec pns ip addr show p1 | awk 'FNR==3{ print $2 }' | awk -F/ '{ print $1 }'\n", "delta": "0:00:00.039265", "end": "2019-12-05 18:35:01.086868", "rc": 0, "start": "2019-12-05 18:35:01.047603", "stderr": "", "stderr_lines": [], "stdout": "192.168.100.238", "stdout_lines": ["192.168.100.238"]}

TASK [Add VXLAN routes to host] *****************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.31.1/24', u'ns_name': u't4', u'ns_if': u't4if', u'if': u'p1'}], u'default_route_ip': u'10.1.31.1', u'bridge_name': u't4br1', u'dns': [{u'dnsif': u't4s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't4s1_dnsbrif'}], u'ns_name': u't4ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.31.2/24', u'tenant_ns_ip': u'10.1.31.1/24', u'tenant_ns_if': u't4ns1if', u'tenant_sub_if': u't4s1if', u'tenant_ns_name': u't4'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't4_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't4br1if1', u'vmif': u't4VM1if1'}, {u'mem': 4, u'name': u't4_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't4br1if2', u'vmif': u't4VM2if1'}]}, {u'local_ip': u'10.1.31.2', u'dsport': 4789, u'dev': u't4s1if', u'tenant_route_ip': u'192.168.4.2', u'remote_route': u'10.2.31.0/24', u'subnet_route': u'10.1.31.0/24', u'v_name': u'vxlan_t4s1', u'id': 42, u'remote_ip': u'10.2.31.2'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip route show \"10.1.31.0/24\" via \"192.168.100.238\" | grep -w '^10.1.31.0/24' ; if [ $? -ne 0 ] ; then ip route add \"10.1.31.0/24\" via \"192.168.100.238\" ; fi\nip route show \"10.2.31.0/24\" via 99.99.99.2 | grep -w '^10.2.31.0/24'; if [ $? -ne 0 ] ; then ip route add \"10.2.31.0/24\" via 99.99.99.2 ; fi\n", "delta": "0:00:00.006571", "end": "2019-12-05 18:35:01.393671", "item": [{"bridge_name": "t4br1", "default_route_ip": "10.1.31.1", "dns": [{"brif": "t4s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.5", "dnsif": "t4s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t4ns1", "route": [{"if": "p1", "ip": "10.1.31.1/24", "ns_if": "t4if", "ns_name": "t4"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t4ns1if", "tenant_ns_ip": "10.1.31.1/24", "tenant_ns_name": "t4", "tenant_sub_if": "t4s1if", "tenant_sub_ip": "10.1.31.2/24"}], "vms": [{"brif": "t4br1if1", "disk": "10G", "mem": 2, "name": "t4_VM1", "vcpu": 4, "vmif": "t4VM1if1"}, {"brif": "t4br1if2", "disk": "10G", "mem": 4, "name": "t4_VM2", "vcpu": 2, "vmif": "t4VM2if1"}]}, {"dev": "t4s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.31.2", "remote_ip": "10.2.31.2", "remote_route": "10.2.31.0/24", "subnet_route": "10.1.31.0/24", "tenant_route_ip": "192.168.4.2", "v_name": "vxlan_t4s1"}], "rc": 0, "start": "2019-12-05 18:35:01.387100", "stderr": "", "stderr_lines": [], "stdout": "10.1.31.0/24 dev testBR \n10.2.31.0/24 dev ens4 ", "stdout_lines": ["10.1.31.0/24 dev testBR ", "10.2.31.0/24 dev ens4 "]}
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.32.1/24', u'ns_name': u't4', u'ns_if': u't4if', u'if': u'p1'}], u'default_route_ip': u'10.1.32.1', u'bridge_name': u't4br2', u'dns': [{u'dnsif': [], u'dhcp_start': [], u'dhcp_end': [], u'dnsif_ip': [], u'net_mask': [], u'brif': []}], u'ns_name': u't4ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.32.2/24', u'tenant_ns_ip': u'10.1.32.1/24', u'tenant_ns_if': u't4ns2if', u'tenant_sub_if': u't4s2if', u'tenant_ns_name': u't4'}], u'subnet_ip': u'2.2.2.0/24', u'vms': [{u'mem': [], u'name': [], u'vcpu': [], u'disk': [], u'brif': [], u'vmif': []}]}, {u'local_ip': u'10.1.32.2', u'dsport': 4789, u'dev': u't4s2if', u'tenant_route_ip': u'192.168.4.2', u'remote_route': u'10.2.32.0/24', u'subnet_route': u'10.1.32.0/24', u'v_name': u'vxlan_t4s2', u'id': 42, u'remote_ip': u'10.2.32.2'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip route show \"10.1.32.0/24\" via \"192.168.100.238\" | grep -w '^10.1.32.0/24' ; if [ $? -ne 0 ] ; then ip route add \"10.1.32.0/24\" via \"192.168.100.238\" ; fi\nip route show \"10.2.32.0/24\" via 99.99.99.2 | grep -w '^10.2.32.0/24'; if [ $? -ne 0 ] ; then ip route add \"10.2.32.0/24\" via 99.99.99.2 ; fi\n", "delta": "0:00:00.008588", "end": "2019-12-05 18:35:01.640457", "item": [{"bridge_name": "t4br2", "default_route_ip": "10.1.32.1", "dns": [{"brif": [], "dhcp_end": [], "dhcp_start": [], "dnsif": [], "dnsif_ip": [], "net_mask": []}], "ns_name": "t4ns2", "route": [{"if": "p1", "ip": "10.1.32.1/24", "ns_if": "t4if", "ns_name": "t4"}], "subnet_ip": "2.2.2.0/24", "tenant_ns": [{"tenant_ns_if": "t4ns2if", "tenant_ns_ip": "10.1.32.1/24", "tenant_ns_name": "t4", "tenant_sub_if": "t4s2if", "tenant_sub_ip": "10.1.32.2/24"}], "vms": [{"brif": [], "disk": [], "mem": [], "name": [], "vcpu": [], "vmif": []}]}, {"dev": "t4s2if", "dsport": 4789, "id": 42, "local_ip": "10.1.32.2", "remote_ip": "10.2.32.2", "remote_route": "10.2.32.0/24", "subnet_route": "10.1.32.0/24", "tenant_route_ip": "192.168.4.2", "v_name": "vxlan_t4s2"}], "rc": 0, "start": "2019-12-05 18:35:01.631869", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

PLAY RECAP **************************************************************************************************************************************************
localhost                  : ok=3    changed=2    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0   

Using /etc/ansible/ansible.cfg as config file

PLAY [worker] ***********************************************************************************************************************************************

TASK [Add VXLAN routes in PNS] ******************************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.31.1/24', u'ns_name': u't4', u'ns_if': u't4if', u'if': u'p1'}], u'default_route_ip': u'10.2.31.1', u'bridge_name': u't4br1', u'dns': [{u'dnsif': u't4s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't4s1_dnsbrif'}], u'ns_name': u't4ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.31.2/24', u'tenant_ns_ip': u'10.2.31.1/24', u'tenant_ns_if': u't4ns1if', u'tenant_sub_if': u't4s1if', u'tenant_ns_name': u't4'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't4_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't4br1if1', u'vmif': u't4VM4if1'}]}, {u'local_ip': u'10.2.31.2', u'dsport': 4789, u'dev': u't4s1if', u'tenant_route_ip': u'192.168.132.2', u'remote_route': u'10.1.31.0/24', u'subnet_route': u'10.2.31.0/24', u'v_name': u'vxlan_t4s1', u'id': 42, u'remote_ip': u'10.1.31.2'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec pns ip route show \"10.2.31.0/24\" via \"192.168.132.2\" | grep -w '^10.2.31.0/24' ; if [ $? -ne 0 ] ; then ip netns exec pns ip route add \"10.2.31.0/24\" via \"192.168.132.2\" ; fi\n", "delta": "0:00:00.029490", "end": "2019-12-05 18:35:02.902582", "item": [{"bridge_name": "t4br1", "default_route_ip": "10.2.31.1", "dns": [{"brif": "t4s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.5", "dnsif": "t4s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t4ns1", "route": [{"if": "p1", "ip": "10.2.31.1/24", "ns_if": "t4if", "ns_name": "t4"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t4ns1if", "tenant_ns_ip": "10.2.31.1/24", "tenant_ns_name": "t4", "tenant_sub_if": "t4s1if", "tenant_sub_ip": "10.2.31.2/24"}], "vms": [{"brif": "t4br1if1", "disk": "10G", "mem": 2, "name": "t4_VM4", "vcpu": 4, "vmif": "t4VM4if1"}]}, {"dev": "t4s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.31.2", "remote_ip": "10.1.31.2", "remote_route": "10.1.31.0/24", "subnet_route": "10.2.31.0/24", "tenant_route_ip": "192.168.132.2", "v_name": "vxlan_t4s1"}], "rc": 0, "start": "2019-12-05 18:35:02.873092", "stderr": "", "stderr_lines": [], "stdout": "10.2.31.0/24 dev t4pns_if ", "stdout_lines": ["10.2.31.0/24 dev t4pns_if "]}
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.32.1/24', u'ns_name': u't4', u'ns_if': u't4if', u'if': u'p1'}], u'default_route_ip': u'10.2.32.1', u'bridge_name': u't4br2', u'dns': [{u'dnsif': u't4s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't4s2_dnsbrif'}], u'ns_name': u't4ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.32.2/24', u'tenant_ns_ip': u'10.2.32.1/24', u'tenant_ns_if': u't4ns2if', u'tenant_sub_if': u't4s2if', u'tenant_ns_name': u't4'}], u'subnet_ip': u'2.2.2.0/24', u'vms': [{u'mem': 3, u'name': u't4_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't4br2if1', u'vmif': u't4VM3if1'}]}, {u'local_ip': u'10.2.32.2', u'dsport': 4789, u'dev': u't4s2if', u'tenant_route_ip': u'192.168.132.2', u'remote_route': u'10.1.32.0/24', u'subnet_route': u'10.2.32.0/24', u'v_name': u'vxlan_t4s2', u'id': 42, u'remote_ip': u'10.1.32.2'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec pns ip route show \"10.2.32.0/24\" via \"192.168.132.2\" | grep -w '^10.2.32.0/24' ; if [ $? -ne 0 ] ; then ip netns exec pns ip route add \"10.2.32.0/24\" via \"192.168.132.2\" ; fi\n", "delta": "0:00:00.071668", "end": "2019-12-05 18:35:03.350777", "item": [{"bridge_name": "t4br2", "default_route_ip": "10.2.32.1", "dns": [{"brif": "t4s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t4s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t4ns2", "route": [{"if": "p1", "ip": "10.2.32.1/24", "ns_if": "t4if", "ns_name": "t4"}], "subnet_ip": "2.2.2.0/24", "tenant_ns": [{"tenant_ns_if": "t4ns2if", "tenant_ns_ip": "10.2.32.1/24", "tenant_ns_name": "t4", "tenant_sub_if": "t4s2if", "tenant_sub_ip": "10.2.32.2/24"}], "vms": [{"brif": "t4br2if1", "disk": "10G", "mem": 3, "name": "t4_VM3", "vcpu": 2, "vmif": "t4VM3if1"}]}, {"dev": "t4s2if", "dsport": 4789, "id": 42, "local_ip": "10.2.32.2", "remote_ip": "10.1.32.2", "remote_route": "10.1.32.0/24", "subnet_route": "10.2.32.0/24", "tenant_route_ip": "192.168.132.2", "v_name": "vxlan_t4s2"}], "rc": 0, "start": "2019-12-05 18:35:03.279109", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Get PNS ip address] ***********************************************************************************************************************************
ok: [99.99.99.2] => {"changed": false, "cmd": "ip netns exec pns ip addr show p1 | awk 'FNR==3{ print $2 }' | awk -F/ '{ print $1 }'\n", "delta": "0:00:00.034794", "end": "2019-12-05 18:35:03.783004", "rc": 0, "start": "2019-12-05 18:35:03.748210", "stderr": "", "stderr_lines": [], "stdout": "192.168.100.50", "stdout_lines": ["192.168.100.50"]}

TASK [Add VXLAN routes to host] *****************************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.31.1/24', u'ns_name': u't4', u'ns_if': u't4if', u'if': u'p1'}], u'default_route_ip': u'10.2.31.1', u'bridge_name': u't4br1', u'dns': [{u'dnsif': u't4s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't4s1_dnsbrif'}], u'ns_name': u't4ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.31.2/24', u'tenant_ns_ip': u'10.2.31.1/24', u'tenant_ns_if': u't4ns1if', u'tenant_sub_if': u't4s1if', u'tenant_ns_name': u't4'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't4_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't4br1if1', u'vmif': u't4VM4if1'}]}, {u'local_ip': u'10.2.31.2', u'dsport': 4789, u'dev': u't4s1if', u'tenant_route_ip': u'192.168.132.2', u'remote_route': u'10.1.31.0/24', u'subnet_route': u'10.2.31.0/24', u'v_name': u'vxlan_t4s1', u'id': 42, u'remote_ip': u'10.1.31.2'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip route show \"10.2.31.0/24\" via \"192.168.100.50\" | grep -w '^10.2.31.0/24' ; if [ $? -ne 0 ] ; then ip route add \"10.2.31.0/24\" via \"192.168.100.50\" ; fi\nip route show \"10.1.31.0/24\" via 99.99.99.1 | grep -w '^10.1.31.0/24'; if [ $? -ne 0 ] ; then ip route add \"10.1.31.0/24\" via 99.99.99.1 ; fi\n", "delta": "0:00:00.007795", "end": "2019-12-05 18:35:04.258904", "item": [{"bridge_name": "t4br1", "default_route_ip": "10.2.31.1", "dns": [{"brif": "t4s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.5", "dnsif": "t4s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t4ns1", "route": [{"if": "p1", "ip": "10.2.31.1/24", "ns_if": "t4if", "ns_name": "t4"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t4ns1if", "tenant_ns_ip": "10.2.31.1/24", "tenant_ns_name": "t4", "tenant_sub_if": "t4s1if", "tenant_sub_ip": "10.2.31.2/24"}], "vms": [{"brif": "t4br1if1", "disk": "10G", "mem": 2, "name": "t4_VM4", "vcpu": 4, "vmif": "t4VM4if1"}]}, {"dev": "t4s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.31.2", "remote_ip": "10.1.31.2", "remote_route": "10.1.31.0/24", "subnet_route": "10.2.31.0/24", "tenant_route_ip": "192.168.132.2", "v_name": "vxlan_t4s1"}], "rc": 0, "start": "2019-12-05 18:35:04.251109", "stderr": "", "stderr_lines": [], "stdout": "10.2.31.0/24 dev testBR \n10.1.31.0/24 dev ens4 ", "stdout_lines": ["10.2.31.0/24 dev testBR ", "10.1.31.0/24 dev ens4 "]}
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.32.1/24', u'ns_name': u't4', u'ns_if': u't4if', u'if': u'p1'}], u'default_route_ip': u'10.2.32.1', u'bridge_name': u't4br2', u'dns': [{u'dnsif': u't4s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't4s2_dnsbrif'}], u'ns_name': u't4ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.32.2/24', u'tenant_ns_ip': u'10.2.32.1/24', u'tenant_ns_if': u't4ns2if', u'tenant_sub_if': u't4s2if', u'tenant_ns_name': u't4'}], u'subnet_ip': u'2.2.2.0/24', u'vms': [{u'mem': 3, u'name': u't4_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't4br2if1', u'vmif': u't4VM3if1'}]}, {u'local_ip': u'10.2.32.2', u'dsport': 4789, u'dev': u't4s2if', u'tenant_route_ip': u'192.168.132.2', u'remote_route': u'10.1.32.0/24', u'subnet_route': u'10.2.32.0/24', u'v_name': u'vxlan_t4s2', u'id': 42, u'remote_ip': u'10.1.32.2'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip route show \"10.2.32.0/24\" via \"192.168.100.50\" | grep -w '^10.2.32.0/24' ; if [ $? -ne 0 ] ; then ip route add \"10.2.32.0/24\" via \"192.168.100.50\" ; fi\nip route show \"10.1.32.0/24\" via 99.99.99.1 | grep -w '^10.1.32.0/24'; if [ $? -ne 0 ] ; then ip route add \"10.1.32.0/24\" via 99.99.99.1 ; fi\n", "delta": "0:00:00.009614", "end": "2019-12-05 18:35:04.640659", "item": [{"bridge_name": "t4br2", "default_route_ip": "10.2.32.1", "dns": [{"brif": "t4s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t4s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t4ns2", "route": [{"if": "p1", "ip": "10.2.32.1/24", "ns_if": "t4if", "ns_name": "t4"}], "subnet_ip": "2.2.2.0/24", "tenant_ns": [{"tenant_ns_if": "t4ns2if", "tenant_ns_ip": "10.2.32.1/24", "tenant_ns_name": "t4", "tenant_sub_if": "t4s2if", "tenant_sub_ip": "10.2.32.2/24"}], "vms": [{"brif": "t4br2if1", "disk": "10G", "mem": 3, "name": "t4_VM3", "vcpu": 2, "vmif": "t4VM3if1"}]}, {"dev": "t4s2if", "dsport": 4789, "id": 42, "local_ip": "10.2.32.2", "remote_ip": "10.1.32.2", "remote_route": "10.1.32.0/24", "subnet_route": "10.2.32.0/24", "tenant_route_ip": "192.168.132.2", "v_name": "vxlan_t4s2"}], "rc": 0, "start": "2019-12-05 18:35:04.631045", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

PLAY RECAP **************************************************************************************************************************************************
99.99.99.2                 : ok=3    changed=2    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0   

Using /etc/ansible/ansible.cfg as config file

PLAY [main] *************************************************************************************************************************************************

TASK [Detach Interface] *************************************************************************************************************************************
changed: [localhost] => (item=[{u'ns_name': u't4ns1', u'bridge_name': u't4br1'}, {u'vmif_m': u't4VM2if1_m', u'vm_mac': u'52:54:00:e0:3f:ef', u'name': u't4_VM2', u'vmif': u't4VM2if1', u'brif_m': u't4br1if2_m'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "virsh domiflist \"t4_VM2\" | grep -w \"t4VM2if1\" ; if [ $? -eq 0 ] ; then virsh detach-interface --domain \"t4_VM2\" --type direct --config ; fi\n", "delta": "0:00:00.051621", "end": "2019-12-05 18:35:05.955815", "item": [{"bridge_name": "t4br1", "ns_name": "t4ns1"}, {"brif_m": "t4br1if2_m", "name": "t4_VM2", "vm_mac": "52:54:00:e0:3f:ef", "vmif": "t4VM2if1", "vmif_m": "t4VM2if1_m"}], "rc": 0, "start": "2019-12-05 18:35:05.904194", "stderr": "", "stderr_lines": [], "stdout": "macvtap1   direct     t4VM2if1   rtl8139     52:54:00:e0:3f:ef\nInterface detached successfully", "stdout_lines": ["macvtap1   direct     t4VM2if1   rtl8139     52:54:00:e0:3f:ef", "Interface detached successfully"]}

TASK [Shutdown VMs] *****************************************************************************************************************************************
changed: [localhost] => (item=[{u'ns_name': u't4ns1', u'bridge_name': u't4br1'}, {u'vmif_m': u't4VM2if1_m', u'vm_mac': u'52:54:00:e0:3f:ef', u'name': u't4_VM2', u'vmif': u't4VM2if1', u'brif_m': u't4br1if2_m'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "virsh list --state-shutoff | grep -w \"t4_VM2\" ; if [ $? -ne 0 ] ; then virsh shutdown \"t4_VM2\" ; fi\n", "delta": "0:00:00.146188", "end": "2019-12-05 18:35:06.355099", "item": [{"bridge_name": "t4br1", "ns_name": "t4ns1"}, {"brif_m": "t4br1if2_m", "name": "t4_VM2", "vm_mac": "52:54:00:e0:3f:ef", "vmif": "t4VM2if1", "vmif_m": "t4VM2if1_m"}], "rc": 0, "start": "2019-12-05 18:35:06.208911", "stderr": "", "stderr_lines": [], "stdout": "Domain t4_VM2 is being shutdown", "stdout_lines": ["Domain t4_VM2 is being shutdown"]}

TASK [Remove TEMP files] ************************************************************************************************************************************
changed: [localhost] => {"changed": true, "path": "/root/.ansible/tmp/", "state": "absent"}

PLAY [worker] ***********************************************************************************************************************************************

TASK [Remove TEMP files] ************************************************************************************************************************************
changed: [99.99.99.2] => {"changed": true, "path": "/root/.ansible/tmp/", "state": "absent"}

TASK [Migrate VM images] ************************************************************************************************************************************
FAILED - RETRYING: Migrate VM images (3 retries left).
changed: [99.99.99.2] => (item=[{u'ns_name': u't4ns1', u'bridge_name': u't4br1'}, {u'vmif_m': u't4VM2if1_m', u'vm_mac': u'52:54:00:e0:3f:ef', u'name': u't4_VM2', u'vmif': u't4VM2if1', u'brif_m': u't4br1if2_m'}]) => {"ansible_loop_var": "item", "attempts": 2, "changed": true, "checksum": "5343bbda6a6c2477e010d413db11f3bc9d555b46", "dest": "/var/lib/libvirt/images/t4_VM2.qcow2", "gid": 0, "group": "root", "item": [{"bridge_name": "t4br1", "ns_name": "t4ns1"}, {"brif_m": "t4br1if2_m", "name": "t4_VM2", "vm_mac": "52:54:00:e0:3f:ef", "vmif": "t4VM2if1", "vmif_m": "t4VM2if1_m"}], "md5sum": "e8959f35cbb0a94bd4da29c7b0bf2e7c", "mode": "0644", "owner": "root", "size": 10739318784, "src": "/root/.ansible/tmp/ansible-tmp-1575570907.42-234886289617184/source", "state": "file", "uid": 0}

TASK [Migrate VM templates] *********************************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'ns_name': u't4ns1', u'bridge_name': u't4br1'}, {u'vmif_m': u't4VM2if1_m', u'vm_mac': u'52:54:00:e0:3f:ef', u'name': u't4_VM2', u'vmif': u't4VM2if1', u'brif_m': u't4br1if2_m'}]) => {"ansible_loop_var": "item", "changed": true, "checksum": "1b2a860245dd09f561219bb35a05e4affc3d2b47", "dest": "/etc/libvirt/qemu/t4_VM2.xml", "gid": 0, "group": "root", "item": [{"bridge_name": "t4br1", "ns_name": "t4ns1"}, {"brif_m": "t4br1if2_m", "name": "t4_VM2", "vm_mac": "52:54:00:e0:3f:ef", "vmif": "t4VM2if1", "vmif_m": "t4VM2if1_m"}], "md5sum": "73cb0817c836a3253ffa2ea9730d6ab3", "mode": "0644", "owner": "root", "size": 4252, "src": "/root/.ansible/tmp/ansible-tmp-1575571446.71-16193084869514/source", "state": "file", "uid": 0}

TASK [Get list of running VMs] ******************************************************************************************************************************
ok: [99.99.99.2] => {"changed": false, "cmd": ["virsh", "list", "--name"], "delta": "0:00:00.038054", "end": "2019-12-05 18:44:07.714318", "rc": 0, "start": "2019-12-05 18:44:07.676264", "stderr": "", "stderr_lines": [], "stdout": "t3_VM2\nt4_VM4\nt4_VM3", "stdout_lines": ["t3_VM2", "t4_VM4", "t4_VM3"]}

TASK [Define VM] ********************************************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'ns_name': u't4ns1', u'bridge_name': u't4br1'}, {u'vmif_m': u't4VM2if1_m', u'vm_mac': u'52:54:00:e0:3f:ef', u'name': u't4_VM2', u'vmif': u't4VM2if1', u'brif_m': u't4br1if2_m'}]) => {"ansible_loop_var": "item", "changed": true, "created": "t4_VM2", "item": [{"bridge_name": "t4br1", "ns_name": "t4ns1"}, {"brif_m": "t4br1if2_m", "name": "t4_VM2", "vm_mac": "52:54:00:e0:3f:ef", "vmif": "t4VM2if1", "vmif_m": "t4VM2if1_m"}], "warnings": ["'xml' is given - ignoring 'name'"]}

TASK [Create VM] ********************************************************************************************************************************************
ok: [99.99.99.2] => (item=[{u'ns_name': u't4ns1', u'bridge_name': u't4br1'}, {u'vmif_m': u't4VM2if1_m', u'vm_mac': u'52:54:00:e0:3f:ef', u'name': u't4_VM2', u'vmif': u't4VM2if1', u'brif_m': u't4br1if2_m'}]) => {"ansible_loop_var": "item", "changed": false, "create": 0, "item": [{"bridge_name": "t4br1", "ns_name": "t4ns1"}, {"brif_m": "t4br1if2_m", "name": "t4_VM2", "vm_mac": "52:54:00:e0:3f:ef", "vmif": "t4VM2if1", "vmif_m": "t4VM2if1_m"}]}

TASK [Start VM] *********************************************************************************************************************************************
ok: [99.99.99.2] => (item=[{u'ns_name': u't4ns1', u'bridge_name': u't4br1'}, {u'vmif_m': u't4VM2if1_m', u'vm_mac': u'52:54:00:e0:3f:ef', u'name': u't4_VM2', u'vmif': u't4VM2if1', u'brif_m': u't4br1if2_m'}]) => {"ansible_loop_var": "item", "changed": false, "item": [{"bridge_name": "t4br1", "ns_name": "t4ns1"}, {"brif_m": "t4br1if2_m", "name": "t4_VM2", "vm_mac": "52:54:00:e0:3f:ef", "vmif": "t4VM2if1", "vmif_m": "t4VM2if1_m"}]}

TASK [Create VETH Pairs] ************************************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'ns_name': u't4ns1', u'bridge_name': u't4br1'}, {u'vmif_m': u't4VM2if1_m', u'vm_mac': u'52:54:00:e0:3f:ef', u'name': u't4_VM2', u'vmif': u't4VM2if1', u'brif_m': u't4br1if2_m'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip link show \"t4br1if2_m\" ; if [ $? -ne 0 ] ; then ip link add \"t4VM2if1_m\" type veth peer name \"t4br1if2_m\" ; fi\nip link set dev \"t4br1if2_m\" up\nip link set dev \"t4VM2if1_m\" up\n", "delta": "0:00:00.025800", "end": "2019-12-05 18:44:10.349734", "item": [{"bridge_name": "t4br1", "ns_name": "t4ns1"}, {"brif_m": "t4br1if2_m", "name": "t4_VM2", "vm_mac": "52:54:00:e0:3f:ef", "vmif": "t4VM2if1", "vmif_m": "t4VM2if1_m"}], "rc": 0, "start": "2019-12-05 18:44:10.323934", "stderr": "Device \"t4br1if2_m\" does not exist.", "stderr_lines": ["Device \"t4br1if2_m\" does not exist."], "stdout": "", "stdout_lines": []}

TASK [Attach VETH Pairs] ************************************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'ns_name': u't4ns1', u'bridge_name': u't4br1'}, {u'vmif_m': u't4VM2if1_m', u'vm_mac': u'52:54:00:e0:3f:ef', u'name': u't4_VM2', u'vmif': u't4VM2if1', u'brif_m': u't4br1if2_m'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip link show \"t4br1if2_m\" ; if [ $? -eq 0 ] ; then ip link set \"t4br1if2_m\" netns \"t4ns1\" ; fi\nip netns exec \"t4ns1\" brctl show \"t4br1\" | grep -w 't4br1if2_m' ; if [ $? -ne 0 ] ; then ip netns exec \"t4ns1\" brctl addif \"t4br1\" \"t4br1if2_m\" ; fi\nvirsh domiflist \"t4_VM2\" | grep -w \"t4VM2if1_m\" ; if [ $? -ne 0 ] ; then virsh attach-interface --domain \"t4_VM2\" direct \"t4VM2if1_m\" --live --persistent --mac \"52:54:00:e0:3f:ef\" ; fi\n", "delta": "0:00:00.423074", "end": "2019-12-05 18:44:11.098877", "item": [{"bridge_name": "t4br1", "ns_name": "t4ns1"}, {"brif_m": "t4br1if2_m", "name": "t4_VM2", "vm_mac": "52:54:00:e0:3f:ef", "vmif": "t4VM2if1", "vmif_m": "t4VM2if1_m"}], "rc": 0, "start": "2019-12-05 18:44:10.675803", "stderr": "", "stderr_lines": [], "stdout": "48: t4br1if2_m@t4VM2if1_m: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP mode DEFAULT group default qlen 1000\n    link/ether 1a:28:83:ee:b8:26 brd ff:ff:ff:ff:ff:ff\nInterface attached successfully", "stdout_lines": ["48: t4br1if2_m@t4VM2if1_m: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP mode DEFAULT group default qlen 1000", "    link/ether 1a:28:83:ee:b8:26 brd ff:ff:ff:ff:ff:ff", "Interface attached successfully"]}

TASK [Make all interfaces UP] *******************************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'ns_name': u't4ns1', u'bridge_name': u't4br1'}, {u'vmif_m': u't4VM2if1_m', u'vm_mac': u'52:54:00:e0:3f:ef', u'name': u't4_VM2', u'vmif': u't4VM2if1', u'brif_m': u't4br1if2_m'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t4ns1\" ip link set dev \"t4br1if2_m\" up\nip link set dev \"t4VM2if1_m\" up\n", "delta": "0:00:00.046380", "end": "2019-12-05 18:44:11.430265", "item": [{"bridge_name": "t4br1", "ns_name": "t4ns1"}, {"brif_m": "t4br1if2_m", "name": "t4_VM2", "vm_mac": "52:54:00:e0:3f:ef", "vmif": "t4VM2if1", "vmif_m": "t4VM2if1_m"}], "rc": 0, "start": "2019-12-05 18:44:11.383885", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

PLAY [main] *************************************************************************************************************************************************

TASK [pause] ************************************************************************************************************************************************
Pausing for 60 seconds
(ctrl+C then 'C' = continue early, ctrl+C then 'A' = abort)
ok: [localhost] => {"changed": false, "delta": 60, "echo": true, "rc": 0, "start": "2019-12-05 18:44:11.530530", "stderr": "", "stdout": "Paused for 1.0 minutes", "stop": "2019-12-05 18:45:11.530912", "user_input": ""}

TASK [Undefine Migrated VM at C1] ***************************************************************************************************************************
changed: [localhost] => (item=[{u'ns_name': u't4ns1', u'bridge_name': u't4br1'}, {u'vmif_m': u't4VM2if1_m', u'vm_mac': u'52:54:00:e0:3f:ef', u'name': u't4_VM2', u'vmif': u't4VM2if1', u'brif_m': u't4br1if2_m'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "virsh undefine \"t4_VM2\"\n", "delta": "0:00:00.026774", "end": "2019-12-05 18:45:11.785933", "item": [{"bridge_name": "t4br1", "ns_name": "t4ns1"}, {"brif_m": "t4br1if2_m", "name": "t4_VM2", "vm_mac": "52:54:00:e0:3f:ef", "vmif": "t4VM2if1", "vmif_m": "t4VM2if1_m"}], "rc": 0, "start": "2019-12-05 18:45:11.759159", "stderr": "", "stderr_lines": [], "stdout": "Domain t4_VM2 has been undefined", "stdout_lines": ["Domain t4_VM2 has been undefined"]}

PLAY RECAP **************************************************************************************************************************************************
99.99.99.2                 : ok=10   changed=7    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0   
localhost                  : ok=5    changed=4    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0   

Using /etc/ansible/ansible.cfg as config file

PLAY [worker] ***********************************************************************************************************************************************

TASK [Detach Interface] *************************************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'ns_name': u't4ns1', u'bridge_name': u't4br1'}, {u'vmif_m': u't4VM4if1_m', u'vm_mac': u'52:54:00:10:05:fd', u'name': u't4_VM4', u'vmif': u't4VM4if1', u'brif_m': u't4br1if1_m'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "virsh domiflist \"t4_VM4\" | grep -w \"t4VM4if1\" ; if [ $? -eq 0 ] ; then virsh detach-interface --domain \"t4_VM4\" --type direct --config ; fi\n", "delta": "0:00:00.137199", "end": "2019-12-05 18:45:13.999886", "item": [{"bridge_name": "t4br1", "ns_name": "t4ns1"}, {"brif_m": "t4br1if1_m", "name": "t4_VM4", "vm_mac": "52:54:00:10:05:fd", "vmif": "t4VM4if1", "vmif_m": "t4VM4if1_m"}], "rc": 0, "start": "2019-12-05 18:45:13.862687", "stderr": "", "stderr_lines": [], "stdout": "macvtap0   direct     t4VM4if1   rtl8139     52:54:00:10:05:fd\nInterface detached successfully", "stdout_lines": ["macvtap0   direct     t4VM4if1   rtl8139     52:54:00:10:05:fd", "Interface detached successfully"]}
changed: [99.99.99.2] => (item=[{u'ns_name': u't4ns2', u'bridge_name': u't4br2'}, {u'vmif_m': u't4VM3if1_m', u'vm_mac': u'52:54:00:10:f7:cf', u'name': u't4_VM3', u'vmif': u't4VM3if1', u'brif_m': u't4br2if1_m'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "virsh domiflist \"t4_VM3\" | grep -w \"t4VM3if1\" ; if [ $? -eq 0 ] ; then virsh detach-interface --domain \"t4_VM3\" --type direct --config ; fi\n", "delta": "0:00:00.053182", "end": "2019-12-05 18:45:14.403204", "item": [{"bridge_name": "t4br2", "ns_name": "t4ns2"}, {"brif_m": "t4br2if1_m", "name": "t4_VM3", "vm_mac": "52:54:00:10:f7:cf", "vmif": "t4VM3if1", "vmif_m": "t4VM3if1_m"}], "rc": 0, "start": "2019-12-05 18:45:14.350022", "stderr": "", "stderr_lines": [], "stdout": "macvtap1   direct     t4VM3if1   rtl8139     52:54:00:10:f7:cf\nInterface detached successfully", "stdout_lines": ["macvtap1   direct     t4VM3if1   rtl8139     52:54:00:10:f7:cf", "Interface detached successfully"]}

TASK [Shutdown VMs] *****************************************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'ns_name': u't4ns1', u'bridge_name': u't4br1'}, {u'vmif_m': u't4VM4if1_m', u'vm_mac': u'52:54:00:10:05:fd', u'name': u't4_VM4', u'vmif': u't4VM4if1', u'brif_m': u't4br1if1_m'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "virsh list --state-shutoff | grep -w \"t4_VM4\" ; if [ $? -ne 0 ] ; then virsh shutdown \"t4_VM4\" ; fi\n", "delta": "0:00:00.186270", "end": "2019-12-05 18:45:14.988033", "item": [{"bridge_name": "t4br1", "ns_name": "t4ns1"}, {"brif_m": "t4br1if1_m", "name": "t4_VM4", "vm_mac": "52:54:00:10:05:fd", "vmif": "t4VM4if1", "vmif_m": "t4VM4if1_m"}], "rc": 0, "start": "2019-12-05 18:45:14.801763", "stderr": "", "stderr_lines": [], "stdout": "Domain t4_VM4 is being shutdown", "stdout_lines": ["Domain t4_VM4 is being shutdown"]}
changed: [99.99.99.2] => (item=[{u'ns_name': u't4ns2', u'bridge_name': u't4br2'}, {u'vmif_m': u't4VM3if1_m', u'vm_mac': u'52:54:00:10:f7:cf', u'name': u't4_VM3', u'vmif': u't4VM3if1', u'brif_m': u't4br2if1_m'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "virsh list --state-shutoff | grep -w \"t4_VM3\" ; if [ $? -ne 0 ] ; then virsh shutdown \"t4_VM3\" ; fi\n", "delta": "0:00:00.188397", "end": "2019-12-05 18:45:15.551677", "item": [{"bridge_name": "t4br2", "ns_name": "t4ns2"}, {"brif_m": "t4br2if1_m", "name": "t4_VM3", "vm_mac": "52:54:00:10:f7:cf", "vmif": "t4VM3if1", "vmif_m": "t4VM3if1_m"}], "rc": 0, "start": "2019-12-05 18:45:15.363280", "stderr": "", "stderr_lines": [], "stdout": "Domain t4_VM3 is being shutdown", "stdout_lines": ["Domain t4_VM3 is being shutdown"]}

TASK [Remove TEMP files] ************************************************************************************************************************************
changed: [99.99.99.2] => {"changed": true, "path": "/root/.ansible/tmp/", "state": "absent"}

TASK [Migrate VM images] ************************************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'ns_name': u't4ns1', u'bridge_name': u't4br1'}, {u'vmif_m': u't4VM4if1_m', u'vm_mac': u'52:54:00:10:05:fd', u'name': u't4_VM4', u'vmif': u't4VM4if1', u'brif_m': u't4br1if1_m'}]) => {"ansible_loop_var": "item", "changed": true, "checksum": "a7711c21f584f5777cc06b4c4c94ced2882b5c08", "dest": "/var/lib/libvirt/images/t4_VM4.qcow2", "item": [{"bridge_name": "t4br1", "ns_name": "t4ns1"}, {"brif_m": "t4br1if1_m", "name": "t4_VM4", "vm_mac": "52:54:00:10:05:fd", "vmif": "t4VM4if1", "vmif_m": "t4VM4if1_m"}], "md5sum": "1dd7e1bdf8ea2e0b95ad2ae7fdac83df", "remote_checksum": "05e7ba1034d0e52d535a949b4bc6050e1d68a60b", "remote_md5sum": null}
changed: [99.99.99.2] => (item=[{u'ns_name': u't4ns2', u'bridge_name': u't4br2'}, {u'vmif_m': u't4VM3if1_m', u'vm_mac': u'52:54:00:10:f7:cf', u'name': u't4_VM3', u'vmif': u't4VM3if1', u'brif_m': u't4br2if1_m'}]) => {"ansible_loop_var": "item", "changed": true, "checksum": "84667696f52a8732c3365c4d9d3a8708292b7df9", "dest": "/var/lib/libvirt/images/t4_VM3.qcow2", "item": [{"bridge_name": "t4br2", "ns_name": "t4ns2"}, {"brif_m": "t4br2if1_m", "name": "t4_VM3", "vm_mac": "52:54:00:10:f7:cf", "vmif": "t4VM3if1", "vmif_m": "t4VM3if1_m"}], "md5sum": "890665e790cfc426ff2bb8b84992d927", "remote_checksum": "84667696f52a8732c3365c4d9d3a8708292b7df9", "remote_md5sum": null}

TASK [Migrate VM templates] *********************************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'ns_name': u't4ns1', u'bridge_name': u't4br1'}, {u'vmif_m': u't4VM4if1_m', u'vm_mac': u'52:54:00:10:05:fd', u'name': u't4_VM4', u'vmif': u't4VM4if1', u'brif_m': u't4br1if1_m'}]) => {"ansible_loop_var": "item", "changed": true, "checksum": "d01c1636fe27847110616a81db14c36c983832a1", "dest": "/etc/libvirt/qemu/t4_VM4.xml", "item": [{"bridge_name": "t4br1", "ns_name": "t4ns1"}, {"brif_m": "t4br1if1_m", "name": "t4_VM4", "vm_mac": "52:54:00:10:05:fd", "vmif": "t4VM4if1", "vmif_m": "t4VM4if1_m"}], "md5sum": "8db2f1637354d4c6f6dbc3eceb0cc6d7", "remote_checksum": "d01c1636fe27847110616a81db14c36c983832a1", "remote_md5sum": null}
changed: [99.99.99.2] => (item=[{u'ns_name': u't4ns2', u'bridge_name': u't4br2'}, {u'vmif_m': u't4VM3if1_m', u'vm_mac': u'52:54:00:10:f7:cf', u'name': u't4_VM3', u'vmif': u't4VM3if1', u'brif_m': u't4br2if1_m'}]) => {"ansible_loop_var": "item", "changed": true, "checksum": "2b294ea2cbb5b9652dbd0fdfb918dea219121912", "dest": "/etc/libvirt/qemu/t4_VM3.xml", "item": [{"bridge_name": "t4br2", "ns_name": "t4ns2"}, {"brif_m": "t4br2if1_m", "name": "t4_VM3", "vm_mac": "52:54:00:10:f7:cf", "vmif": "t4VM3if1", "vmif_m": "t4VM3if1_m"}], "md5sum": "8fd327f243f740529f733accbd7429e9", "remote_checksum": "2b294ea2cbb5b9652dbd0fdfb918dea219121912", "remote_md5sum": null}

PLAY [main] *************************************************************************************************************************************************

TASK [Get list of running VMs] ******************************************************************************************************************************
ok: [localhost] => {"changed": false, "cmd": ["virsh", "list", "--name"], "delta": "0:00:00.031852", "end": "2019-12-05 18:56:13.029704", "rc": 0, "start": "2019-12-05 18:56:12.997852", "stderr": "", "stderr_lines": [], "stdout": "t4_VM1", "stdout_lines": ["t4_VM1"]}

TASK [Define VM] ********************************************************************************************************************************************
changed: [localhost] => (item=[{u'ns_name': u't4ns1', u'bridge_name': u't4br1'}, {u'vmif_m': u't4VM4if1_m', u'vm_mac': u'52:54:00:10:05:fd', u'name': u't4_VM4', u'vmif': u't4VM4if1', u'brif_m': u't4br1if1_m'}]) => {"ansible_loop_var": "item", "changed": true, "created": "t4_VM4", "item": [{"bridge_name": "t4br1", "ns_name": "t4ns1"}, {"brif_m": "t4br1if1_m", "name": "t4_VM4", "vm_mac": "52:54:00:10:05:fd", "vmif": "t4VM4if1", "vmif_m": "t4VM4if1_m"}], "warnings": ["'xml' is given - ignoring 'name'"]}
changed: [localhost] => (item=[{u'ns_name': u't4ns2', u'bridge_name': u't4br2'}, {u'vmif_m': u't4VM3if1_m', u'vm_mac': u'52:54:00:10:f7:cf', u'name': u't4_VM3', u'vmif': u't4VM3if1', u'brif_m': u't4br2if1_m'}]) => {"ansible_loop_var": "item", "changed": true, "created": "t4_VM3", "item": [{"bridge_name": "t4br2", "ns_name": "t4ns2"}, {"brif_m": "t4br2if1_m", "name": "t4_VM3", "vm_mac": "52:54:00:10:f7:cf", "vmif": "t4VM3if1", "vmif_m": "t4VM3if1_m"}], "warnings": ["'xml' is given - ignoring 'name'"]}

TASK [Create VM] ********************************************************************************************************************************************
ok: [localhost] => (item=[{u'ns_name': u't4ns1', u'bridge_name': u't4br1'}, {u'vmif_m': u't4VM4if1_m', u'vm_mac': u'52:54:00:10:05:fd', u'name': u't4_VM4', u'vmif': u't4VM4if1', u'brif_m': u't4br1if1_m'}]) => {"ansible_loop_var": "item", "changed": false, "create": 0, "item": [{"bridge_name": "t4br1", "ns_name": "t4ns1"}, {"brif_m": "t4br1if1_m", "name": "t4_VM4", "vm_mac": "52:54:00:10:05:fd", "vmif": "t4VM4if1", "vmif_m": "t4VM4if1_m"}]}
ok: [localhost] => (item=[{u'ns_name': u't4ns2', u'bridge_name': u't4br2'}, {u'vmif_m': u't4VM3if1_m', u'vm_mac': u'52:54:00:10:f7:cf', u'name': u't4_VM3', u'vmif': u't4VM3if1', u'brif_m': u't4br2if1_m'}]) => {"ansible_loop_var": "item", "changed": false, "create": 0, "item": [{"bridge_name": "t4br2", "ns_name": "t4ns2"}, {"brif_m": "t4br2if1_m", "name": "t4_VM3", "vm_mac": "52:54:00:10:f7:cf", "vmif": "t4VM3if1", "vmif_m": "t4VM3if1_m"}]}

TASK [Start VM] *********************************************************************************************************************************************
ok: [localhost] => (item=[{u'ns_name': u't4ns1', u'bridge_name': u't4br1'}, {u'vmif_m': u't4VM4if1_m', u'vm_mac': u'52:54:00:10:05:fd', u'name': u't4_VM4', u'vmif': u't4VM4if1', u'brif_m': u't4br1if1_m'}]) => {"ansible_loop_var": "item", "changed": false, "item": [{"bridge_name": "t4br1", "ns_name": "t4ns1"}, {"brif_m": "t4br1if1_m", "name": "t4_VM4", "vm_mac": "52:54:00:10:05:fd", "vmif": "t4VM4if1", "vmif_m": "t4VM4if1_m"}]}
ok: [localhost] => (item=[{u'ns_name': u't4ns2', u'bridge_name': u't4br2'}, {u'vmif_m': u't4VM3if1_m', u'vm_mac': u'52:54:00:10:f7:cf', u'name': u't4_VM3', u'vmif': u't4VM3if1', u'brif_m': u't4br2if1_m'}]) => {"ansible_loop_var": "item", "changed": false, "item": [{"bridge_name": "t4br2", "ns_name": "t4ns2"}, {"brif_m": "t4br2if1_m", "name": "t4_VM3", "vm_mac": "52:54:00:10:f7:cf", "vmif": "t4VM3if1", "vmif_m": "t4VM3if1_m"}]}

TASK [Create VETH Pairs] ************************************************************************************************************************************
changed: [localhost] => (item=[{u'ns_name': u't4ns1', u'bridge_name': u't4br1'}, {u'vmif_m': u't4VM4if1_m', u'vm_mac': u'52:54:00:10:05:fd', u'name': u't4_VM4', u'vmif': u't4VM4if1', u'brif_m': u't4br1if1_m'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip link show \"t4br1if1_m\" ; if [ $? -ne 0 ] ; then ip link add \"t4VM4if1_m\" type veth peer name \"t4br1if1_m\" ; fi\nip link set dev \"t4br1if1_m\" up\nip link set dev \"t4VM4if1_m\" up\n", "delta": "0:00:00.037172", "end": "2019-12-05 18:56:16.732711", "item": [{"bridge_name": "t4br1", "ns_name": "t4ns1"}, {"brif_m": "t4br1if1_m", "name": "t4_VM4", "vm_mac": "52:54:00:10:05:fd", "vmif": "t4VM4if1", "vmif_m": "t4VM4if1_m"}], "rc": 0, "start": "2019-12-05 18:56:16.695539", "stderr": "Device \"t4br1if1_m\" does not exist.", "stderr_lines": ["Device \"t4br1if1_m\" does not exist."], "stdout": "", "stdout_lines": []}
changed: [localhost] => (item=[{u'ns_name': u't4ns2', u'bridge_name': u't4br2'}, {u'vmif_m': u't4VM3if1_m', u'vm_mac': u'52:54:00:10:f7:cf', u'name': u't4_VM3', u'vmif': u't4VM3if1', u'brif_m': u't4br2if1_m'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip link show \"t4br2if1_m\" ; if [ $? -ne 0 ] ; then ip link add \"t4VM3if1_m\" type veth peer name \"t4br2if1_m\" ; fi\nip link set dev \"t4br2if1_m\" up\nip link set dev \"t4VM3if1_m\" up\n", "delta": "0:00:00.021757", "end": "2019-12-05 18:56:16.956181", "item": [{"bridge_name": "t4br2", "ns_name": "t4ns2"}, {"brif_m": "t4br2if1_m", "name": "t4_VM3", "vm_mac": "52:54:00:10:f7:cf", "vmif": "t4VM3if1", "vmif_m": "t4VM3if1_m"}], "rc": 0, "start": "2019-12-05 18:56:16.934424", "stderr": "Device \"t4br2if1_m\" does not exist.", "stderr_lines": ["Device \"t4br2if1_m\" does not exist."], "stdout": "", "stdout_lines": []}

TASK [Attach VETH Pairs] ************************************************************************************************************************************
changed: [localhost] => (item=[{u'ns_name': u't4ns1', u'bridge_name': u't4br1'}, {u'vmif_m': u't4VM4if1_m', u'vm_mac': u'52:54:00:10:05:fd', u'name': u't4_VM4', u'vmif': u't4VM4if1', u'brif_m': u't4br1if1_m'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip link show \"t4br1if1_m\" ; if [ $? -eq 0 ] ; then ip link set \"t4br1if1_m\" netns \"t4ns1\" ; fi\nip netns exec \"t4ns1\" brctl show \"t4br1\" | grep -w 't4br1if1_m' ; if [ $? -ne 0 ] ; then ip netns exec \"t4ns1\" brctl addif \"t4br1\" \"t4br1if1_m\" ; fi\nvirsh domiflist \"t4_VM4\" | grep -w \"t4VM4if1_m\" ; if [ $? -ne 0 ] ; then virsh attach-interface --domain \"t4_VM4\" direct \"t4VM4if1_m\" --live --persistent --mac \"52:54:00:10:05:fd\" ; fi\n", "delta": "0:00:00.385247", "end": "2019-12-05 18:56:17.602178", "item": [{"bridge_name": "t4br1", "ns_name": "t4ns1"}, {"brif_m": "t4br1if1_m", "name": "t4_VM4", "vm_mac": "52:54:00:10:05:fd", "vmif": "t4VM4if1", "vmif_m": "t4VM4if1_m"}], "rc": 0, "start": "2019-12-05 18:56:17.216931", "stderr": "", "stderr_lines": [], "stdout": "66: t4br1if1_m@t4VM4if1_m: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP mode DEFAULT group default qlen 1000\n    link/ether 6e:06:2e:9b:ad:ad brd ff:ff:ff:ff:ff:ff\nInterface attached successfully", "stdout_lines": ["66: t4br1if1_m@t4VM4if1_m: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP mode DEFAULT group default qlen 1000", "    link/ether 6e:06:2e:9b:ad:ad brd ff:ff:ff:ff:ff:ff", "Interface attached successfully"]}
changed: [localhost] => (item=[{u'ns_name': u't4ns2', u'bridge_name': u't4br2'}, {u'vmif_m': u't4VM3if1_m', u'vm_mac': u'52:54:00:10:f7:cf', u'name': u't4_VM3', u'vmif': u't4VM3if1', u'brif_m': u't4br2if1_m'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip link show \"t4br2if1_m\" ; if [ $? -eq 0 ] ; then ip link set \"t4br2if1_m\" netns \"t4ns2\" ; fi\nip netns exec \"t4ns2\" brctl show \"t4br2\" | grep -w 't4br2if1_m' ; if [ $? -ne 0 ] ; then ip netns exec \"t4ns2\" brctl addif \"t4br2\" \"t4br2if1_m\" ; fi\nvirsh domiflist \"t4_VM3\" | grep -w \"t4VM3if1_m\" ; if [ $? -ne 0 ] ; then virsh attach-interface --domain \"t4_VM3\" direct \"t4VM3if1_m\" --live --persistent --mac \"52:54:00:10:f7:cf\" ; fi\n", "delta": "0:00:00.364169", "end": "2019-12-05 18:56:18.152190", "item": [{"bridge_name": "t4br2", "ns_name": "t4ns2"}, {"brif_m": "t4br2if1_m", "name": "t4_VM3", "vm_mac": "52:54:00:10:f7:cf", "vmif": "t4VM3if1", "vmif_m": "t4VM3if1_m"}], "rc": 0, "start": "2019-12-05 18:56:17.788021", "stderr": "", "stderr_lines": [], "stdout": "68: t4br2if1_m@t4VM3if1_m: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP mode DEFAULT group default qlen 1000\n    link/ether 96:cb:98:be:da:7c brd ff:ff:ff:ff:ff:ff\nInterface attached successfully", "stdout_lines": ["68: t4br2if1_m@t4VM3if1_m: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP mode DEFAULT group default qlen 1000", "    link/ether 96:cb:98:be:da:7c brd ff:ff:ff:ff:ff:ff", "Interface attached successfully"]}

TASK [Make all interfaces UP] *******************************************************************************************************************************
changed: [localhost] => (item=[{u'ns_name': u't4ns1', u'bridge_name': u't4br1'}, {u'vmif_m': u't4VM4if1_m', u'vm_mac': u'52:54:00:10:05:fd', u'name': u't4_VM4', u'vmif': u't4VM4if1', u'brif_m': u't4br1if1_m'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t4ns1\" ip link set dev \"t4br1if1_m\" up\nip link set dev \"t4VM4if1_m\" up\n", "delta": "0:00:00.060035", "end": "2019-12-05 18:56:18.464483", "item": [{"bridge_name": "t4br1", "ns_name": "t4ns1"}, {"brif_m": "t4br1if1_m", "name": "t4_VM4", "vm_mac": "52:54:00:10:05:fd", "vmif": "t4VM4if1", "vmif_m": "t4VM4if1_m"}], "rc": 0, "start": "2019-12-05 18:56:18.404448", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}
changed: [localhost] => (item=[{u'ns_name': u't4ns2', u'bridge_name': u't4br2'}, {u'vmif_m': u't4VM3if1_m', u'vm_mac': u'52:54:00:10:f7:cf', u'name': u't4_VM3', u'vmif': u't4VM3if1', u'brif_m': u't4br2if1_m'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t4ns2\" ip link set dev \"t4br2if1_m\" up\nip link set dev \"t4VM3if1_m\" up\n", "delta": "0:00:00.044503", "end": "2019-12-05 18:56:18.708775", "item": [{"bridge_name": "t4br2", "ns_name": "t4ns2"}, {"brif_m": "t4br2if1_m", "name": "t4_VM3", "vm_mac": "52:54:00:10:f7:cf", "vmif": "t4VM3if1", "vmif_m": "t4VM3if1_m"}], "rc": 0, "start": "2019-12-05 18:56:18.664272", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

PLAY [worker] ***********************************************************************************************************************************************

TASK [pause] ************************************************************************************************************************************************
Pausing for 60 seconds
(ctrl+C then 'C' = continue early, ctrl+C then 'A' = abort)
ok: [99.99.99.2] => {"changed": false, "delta": 60, "echo": true, "rc": 0, "start": "2019-12-05 18:56:18.794990", "stderr": "", "stdout": "Paused for 1.0 minutes", "stop": "2019-12-05 18:57:18.795441", "user_input": ""}

TASK [Undefine Migrated VM at C2] ***************************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'ns_name': u't4ns1', u'bridge_name': u't4br1'}, {u'vmif_m': u't4VM4if1_m', u'vm_mac': u'52:54:00:10:05:fd', u'name': u't4_VM4', u'vmif': u't4VM4if1', u'brif_m': u't4br1if1_m'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "virsh undefine \"t4_VM4\"\n", "delta": "0:00:00.046354", "end": "2019-12-05 18:57:20.014688", "item": [{"bridge_name": "t4br1", "ns_name": "t4ns1"}, {"brif_m": "t4br1if1_m", "name": "t4_VM4", "vm_mac": "52:54:00:10:05:fd", "vmif": "t4VM4if1", "vmif_m": "t4VM4if1_m"}], "rc": 0, "start": "2019-12-05 18:57:19.968334", "stderr": "", "stderr_lines": [], "stdout": "Domain t4_VM4 has been undefined", "stdout_lines": ["Domain t4_VM4 has been undefined"]}
changed: [99.99.99.2] => (item=[{u'ns_name': u't4ns2', u'bridge_name': u't4br2'}, {u'vmif_m': u't4VM3if1_m', u'vm_mac': u'52:54:00:10:f7:cf', u'name': u't4_VM3', u'vmif': u't4VM3if1', u'brif_m': u't4br2if1_m'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "virsh undefine \"t4_VM3\"\n", "delta": "0:00:00.022556", "end": "2019-12-05 18:57:20.380171", "item": [{"bridge_name": "t4br2", "ns_name": "t4ns2"}, {"brif_m": "t4br2if1_m", "name": "t4_VM3", "vm_mac": "52:54:00:10:f7:cf", "vmif": "t4VM3if1", "vmif_m": "t4VM3if1_m"}], "rc": 0, "start": "2019-12-05 18:57:20.357615", "stderr": "", "stderr_lines": [], "stdout": "Domain t4_VM3 has been undefined", "stdout_lines": ["Domain t4_VM3 has been undefined"]}

PLAY RECAP **************************************************************************************************************************************************
99.99.99.2                 : ok=7    changed=6    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0   
localhost                  : ok=7    changed=4    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0   

Using /etc/ansible/ansible.cfg as config file

PLAY [main] *************************************************************************************************************************************************

TASK [Create Tenant Namespace] ******************************************************************************************************************************
ok: [localhost] => (item={u'default_route_ip': u'192.168.5.1', u'name': u't5', u'pns_ip': u'192.168.5.1/24', u'tenant_if': u't5if', u'tenant_ip': u'192.168.5.2/24', u'pns_if': u't5pns_if'}) => {"ansible_loop_var": "item", "changed": false, "cmd": ["ip", "netns", "add", "t5"], "item": {"default_route_ip": "192.168.5.1", "name": "t5", "pns_if": "t5pns_if", "pns_ip": "192.168.5.1/24", "tenant_if": "t5if", "tenant_ip": "192.168.5.2/24"}, "rc": 0, "stdout": "skipped, since /var/run/netns/t5 exists", "stdout_lines": ["skipped, since /var/run/netns/t5 exists"]}

TASK [Create Subnet Namespace] ******************************************************************************************************************************
ok: [localhost] => (item={u'route': [{u'ip': u'10.1.41.1/24', u'ns_name': u't5', u'ns_if': u't5if', u'if': u'p1'}], u'default_route_ip': u'10.1.41.1', u'bridge_name': u't5br1', u'dns': [{u'dnsif': u't5s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't5s1_dnsbrif'}], u'ns_name': u't5ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.41.2/24', u'tenant_ns_ip': u'10.1.41.1/24', u'tenant_ns_if': u't5ns1if', u'tenant_ns_name': u't5', u'tenant_sub_if': u't5s1if'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't5_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't5br1if1', u'vmif': u't5VM1if1'}, {u'mem': 4, u'name': u't5_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't5br1if2', u'vmif': u't5VM2if1'}], u'vxlan': [{u'local_ip': u'10.1.41.2', u'tenant_route_ip': u'192.168.5.2', u'dsport': 4789, u'dev': u't5s1if', u'subnet_route': u'10.1.41.0/24', u'remote_route': u'10.2.41.0/24', u'v_name': u'vxlan_t5s1', u'id': 42, u'remote_ip': u'10.2.41.2'}]}) => {"ansible_loop_var": "item", "changed": false, "cmd": ["ip", "netns", "add", "t5ns1"], "item": {"bridge_name": "t5br1", "default_route_ip": "10.1.41.1", "dns": [{"brif": "t5s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.5", "dnsif": "t5s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t5ns1", "route": [{"if": "p1", "ip": "10.1.41.1/24", "ns_if": "t5if", "ns_name": "t5"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t5ns1if", "tenant_ns_ip": "10.1.41.1/24", "tenant_ns_name": "t5", "tenant_sub_if": "t5s1if", "tenant_sub_ip": "10.1.41.2/24"}], "vms": [{"brif": "t5br1if1", "disk": "10G", "mem": 2, "name": "t5_VM1", "vcpu": 4, "vmif": "t5VM1if1"}, {"brif": "t5br1if2", "disk": "10G", "mem": 4, "name": "t5_VM2", "vcpu": 2, "vmif": "t5VM2if1"}], "vxlan": [{"dev": "t5s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.41.2", "remote_ip": "10.2.41.2", "remote_route": "10.2.41.0/24", "subnet_route": "10.1.41.0/24", "tenant_route_ip": "192.168.5.2", "v_name": "vxlan_t5s1"}]}, "rc": 0, "stdout": "skipped, since /var/run/netns/t5ns1 exists", "stdout_lines": ["skipped, since /var/run/netns/t5ns1 exists"]}
ok: [localhost] => (item={u'route': [{u'ip': u'10.1.42.1/24', u'ns_name': u't5', u'ns_if': u't5if', u'if': u'p1'}], u'default_route_ip': u'10.1.42.1', u'bridge_name': u't5br2', u'dns': [{u'dnsif': [], u'dhcp_start': [], u'dhcp_end': [], u'dnsif_ip': [], u'net_mask': [], u'brif': []}], u'ns_name': u't5ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.42.2/24', u'tenant_ns_ip': u'10.1.42.1/24', u'tenant_ns_if': u't5ns2if', u'tenant_ns_name': u't5', u'tenant_sub_if': u't5s2if'}], u'subnet_ip': u'2.2.2.0/24', u'vms': [{u'mem': [], u'name': u'JOKER', u'vcpu': [], u'disk': [], u'brif': [], u'vmif': []}], u'vxlan': [{u'local_ip': u'10.1.42.2', u'tenant_route_ip': u'192.168.5.2', u'dsport': 4789, u'dev': u't5s2if', u'subnet_route': u'10.1.42.0/24', u'remote_route': u'10.2.42.0/24', u'v_name': u'vxlan_t5s2', u'id': 42, u'remote_ip': u'10.2.42.2'}]}) => {"ansible_loop_var": "item", "changed": false, "cmd": ["ip", "netns", "add", "t5ns2"], "item": {"bridge_name": "t5br2", "default_route_ip": "10.1.42.1", "dns": [{"brif": [], "dhcp_end": [], "dhcp_start": [], "dnsif": [], "dnsif_ip": [], "net_mask": []}], "ns_name": "t5ns2", "route": [{"if": "p1", "ip": "10.1.42.1/24", "ns_if": "t5if", "ns_name": "t5"}], "subnet_ip": "2.2.2.0/24", "tenant_ns": [{"tenant_ns_if": "t5ns2if", "tenant_ns_ip": "10.1.42.1/24", "tenant_ns_name": "t5", "tenant_sub_if": "t5s2if", "tenant_sub_ip": "10.1.42.2/24"}], "vms": [{"brif": [], "disk": [], "mem": [], "name": "JOKER", "vcpu": [], "vmif": []}], "vxlan": [{"dev": "t5s2if", "dsport": 4789, "id": 42, "local_ip": "10.1.42.2", "remote_ip": "10.2.42.2", "remote_route": "10.2.42.0/24", "subnet_route": "10.1.42.0/24", "tenant_route_ip": "192.168.5.2", "v_name": "vxlan_t5s2"}]}, "rc": 0, "stdout": "skipped, since /var/run/netns/t5ns2 exists", "stdout_lines": ["skipped, since /var/run/netns/t5ns2 exists"]}

TASK [Create Tenant VETH pairs] *****************************************************************************************************************************
changed: [localhost] => (item={u'default_route_ip': u'192.168.5.1', u'name': u't5', u'pns_ip': u'192.168.5.1/24', u'tenant_if': u't5if', u'tenant_ip': u'192.168.5.2/24', u'pns_if': u't5pns_if'}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t5\" ip link show \"t5if\" ; if [ $? -ne 0 ] ; then ip link add \"t5if\" type veth peer name \"t5pns_if\" ; fi\n", "delta": "0:00:00.040195", "end": "2019-12-05 20:52:33.359098", "item": {"default_route_ip": "192.168.5.1", "name": "t5", "pns_if": "t5pns_if", "pns_ip": "192.168.5.1/24", "tenant_if": "t5if", "tenant_ip": "192.168.5.2/24"}, "rc": 0, "start": "2019-12-05 20:52:33.318903", "stderr": "", "stderr_lines": [], "stdout": "87: t5if@if86: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP mode DEFAULT group default qlen 1000\n    link/ether ce:d5:2e:e7:32:84 brd ff:ff:ff:ff:ff:ff link-netnsid 0", "stdout_lines": ["87: t5if@if86: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP mode DEFAULT group default qlen 1000", "    link/ether ce:d5:2e:e7:32:84 brd ff:ff:ff:ff:ff:ff link-netnsid 0"]}

TASK [Attach Tenant VETH Pairs] *****************************************************************************************************************************
changed: [localhost] => (item={u'default_route_ip': u'192.168.5.1', u'name': u't5', u'pns_ip': u'192.168.5.1/24', u'tenant_if': u't5if', u'tenant_ip': u'192.168.5.2/24', u'pns_if': u't5pns_if'}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec pns ip link show \"t5pns_if\" ; if [ $? -ne 0 ] ; then ip link set \"t5pns_if\" netns pns ; fi\nip netns exec \"t5\" ip link show \"t5if\" ; if [ $? -ne 0 ] ; then ip link set \"t5if\" netns \"t5\" ; fi\nip netns exec pns ip link set dev \"t5pns_if\" up\nip netns exec \"t5\" ip link set dev \"t5if\" up\n", "delta": "0:00:00.151409", "end": "2019-12-05 20:52:33.827012", "item": {"default_route_ip": "192.168.5.1", "name": "t5", "pns_if": "t5pns_if", "pns_ip": "192.168.5.1/24", "tenant_if": "t5if", "tenant_ip": "192.168.5.2/24"}, "rc": 0, "start": "2019-12-05 20:52:33.675603", "stderr": "", "stderr_lines": [], "stdout": "86: t5pns_if@if87: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP mode DEFAULT group default qlen 1000\n    link/ether 7e:a4:ab:05:2e:0c brd ff:ff:ff:ff:ff:ff link-netnsid 5\n87: t5if@if86: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP mode DEFAULT group default qlen 1000\n    link/ether ce:d5:2e:e7:32:84 brd ff:ff:ff:ff:ff:ff link-netnsid 0", "stdout_lines": ["86: t5pns_if@if87: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP mode DEFAULT group default qlen 1000", "    link/ether 7e:a4:ab:05:2e:0c brd ff:ff:ff:ff:ff:ff link-netnsid 5", "87: t5if@if86: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP mode DEFAULT group default qlen 1000", "    link/ether ce:d5:2e:e7:32:84 brd ff:ff:ff:ff:ff:ff link-netnsid 0"]}

TASK [Add IP addresses to Tenant VETH Pairs] ****************************************************************************************************************
changed: [localhost] => (item={u'default_route_ip': u'192.168.5.1', u'name': u't5', u'pns_ip': u'192.168.5.1/24', u'tenant_if': u't5if', u'tenant_ip': u'192.168.5.2/24', u'pns_if': u't5pns_if'}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec pns ip addr show \"t5pns_if\" | awk 'FNR==3{ print $2 }' | grep -w '^192.168.5.1/24' ; if [ $? -ne 0 ] ; then ip netns exec pns ip addr add \"192.168.5.1/24\" dev \"t5pns_if\" ; fi\nip netns exec \"t5\" ip addr show \"t5if\" | awk 'FNR==3{ print $2 }' | grep -w '^192.168.5.2/24' ; if [ $? -ne 0 ] ; then ip netns exec \"t5\" ip addr add \"192.168.5.2/24\" dev \"t5if\" ; fi\n", "delta": "0:00:00.075207", "end": "2019-12-05 20:52:34.215237", "item": {"default_route_ip": "192.168.5.1", "name": "t5", "pns_if": "t5pns_if", "pns_ip": "192.168.5.1/24", "tenant_if": "t5if", "tenant_ip": "192.168.5.2/24"}, "rc": 0, "start": "2019-12-05 20:52:34.140030", "stderr": "", "stderr_lines": [], "stdout": "192.168.5.1/24\n192.168.5.2/24", "stdout_lines": ["192.168.5.1/24", "192.168.5.2/24"]}

TASK [Create Namespace VETH Pairs] **************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.41.1/24', u'ns_name': u't5', u'ns_if': u't5if', u'if': u'p1'}], u'default_route_ip': u'10.1.41.1', u'bridge_name': u't5br1', u'dns': [{u'dnsif': u't5s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't5s1_dnsbrif'}], u'ns_name': u't5ns1', u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't5_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't5br1if1', u'vmif': u't5VM1if1'}, {u'mem': 4, u'name': u't5_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't5br1if2', u'vmif': u't5VM2if1'}], u'vxlan': [{u'local_ip': u'10.1.41.2', u'dsport': 4789, u'dev': u't5s1if', u'tenant_route_ip': u'192.168.5.2', u'remote_route': u'10.2.41.0/24', u'subnet_route': u'10.1.41.0/24', u'v_name': u'vxlan_t5s1', u'id': 42, u'remote_ip': u'10.2.41.2'}]}, {u'tenant_sub_ip': u'10.1.41.2/24', u'tenant_ns_ip': u'10.1.41.1/24', u'tenant_ns_if': u't5ns1if', u'tenant_sub_if': u't5s1if', u'tenant_ns_name': u't5'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t5\" ip link show \"t5ns1if\" ; if [ $? -ne 0 ] ; then ip link add \"t5ns1if\" type veth peer name \"t5s1if\" ; fi\n", "delta": "0:00:00.050709", "end": "2019-12-05 20:52:34.586969", "item": [{"bridge_name": "t5br1", "default_route_ip": "10.1.41.1", "dns": [{"brif": "t5s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.5", "dnsif": "t5s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t5ns1", "route": [{"if": "p1", "ip": "10.1.41.1/24", "ns_if": "t5if", "ns_name": "t5"}], "subnet_ip": "1.1.1.0/24", "vms": [{"brif": "t5br1if1", "disk": "10G", "mem": 2, "name": "t5_VM1", "vcpu": 4, "vmif": "t5VM1if1"}, {"brif": "t5br1if2", "disk": "10G", "mem": 4, "name": "t5_VM2", "vcpu": 2, "vmif": "t5VM2if1"}], "vxlan": [{"dev": "t5s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.41.2", "remote_ip": "10.2.41.2", "remote_route": "10.2.41.0/24", "subnet_route": "10.1.41.0/24", "tenant_route_ip": "192.168.5.2", "v_name": "vxlan_t5s1"}]}, {"tenant_ns_if": "t5ns1if", "tenant_ns_ip": "10.1.41.1/24", "tenant_ns_name": "t5", "tenant_sub_if": "t5s1if", "tenant_sub_ip": "10.1.41.2/24"}], "rc": 0, "start": "2019-12-05 20:52:34.536260", "stderr": "", "stderr_lines": [], "stdout": "89: t5ns1if@if88: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP mode DEFAULT group default qlen 1000\n    link/ether 66:02:b7:25:3a:b7 brd ff:ff:ff:ff:ff:ff link-netnsid 2", "stdout_lines": ["89: t5ns1if@if88: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP mode DEFAULT group default qlen 1000", "    link/ether 66:02:b7:25:3a:b7 brd ff:ff:ff:ff:ff:ff link-netnsid 2"]}
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.42.1/24', u'ns_name': u't5', u'ns_if': u't5if', u'if': u'p1'}], u'default_route_ip': u'10.1.42.1', u'bridge_name': u't5br2', u'dns': [{u'dnsif': [], u'dhcp_start': [], u'dhcp_end': [], u'dnsif_ip': [], u'net_mask': [], u'brif': []}], u'ns_name': u't5ns2', u'subnet_ip': u'2.2.2.0/24', u'vms': [{u'mem': [], u'name': u'JOKER', u'vcpu': [], u'disk': [], u'brif': [], u'vmif': []}], u'vxlan': [{u'local_ip': u'10.1.42.2', u'dsport': 4789, u'dev': u't5s2if', u'tenant_route_ip': u'192.168.5.2', u'remote_route': u'10.2.42.0/24', u'subnet_route': u'10.1.42.0/24', u'v_name': u'vxlan_t5s2', u'id': 42, u'remote_ip': u'10.2.42.2'}]}, {u'tenant_sub_ip': u'10.1.42.2/24', u'tenant_ns_ip': u'10.1.42.1/24', u'tenant_ns_if': u't5ns2if', u'tenant_sub_if': u't5s2if', u'tenant_ns_name': u't5'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t5\" ip link show \"t5ns2if\" ; if [ $? -ne 0 ] ; then ip link add \"t5ns2if\" type veth peer name \"t5s2if\" ; fi\n", "delta": "0:00:00.041855", "end": "2019-12-05 20:52:34.887426", "item": [{"bridge_name": "t5br2", "default_route_ip": "10.1.42.1", "dns": [{"brif": [], "dhcp_end": [], "dhcp_start": [], "dnsif": [], "dnsif_ip": [], "net_mask": []}], "ns_name": "t5ns2", "route": [{"if": "p1", "ip": "10.1.42.1/24", "ns_if": "t5if", "ns_name": "t5"}], "subnet_ip": "2.2.2.0/24", "vms": [{"brif": [], "disk": [], "mem": [], "name": "JOKER", "vcpu": [], "vmif": []}], "vxlan": [{"dev": "t5s2if", "dsport": 4789, "id": 42, "local_ip": "10.1.42.2", "remote_ip": "10.2.42.2", "remote_route": "10.2.42.0/24", "subnet_route": "10.1.42.0/24", "tenant_route_ip": "192.168.5.2", "v_name": "vxlan_t5s2"}]}, {"tenant_ns_if": "t5ns2if", "tenant_ns_ip": "10.1.42.1/24", "tenant_ns_name": "t5", "tenant_sub_if": "t5s2if", "tenant_sub_ip": "10.1.42.2/24"}], "rc": 0, "start": "2019-12-05 20:52:34.845571", "stderr": "", "stderr_lines": [], "stdout": "91: t5ns2if@if90: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP mode DEFAULT group default qlen 1000\n    link/ether 0e:15:cd:a2:81:3f brd ff:ff:ff:ff:ff:ff link-netnsid 3", "stdout_lines": ["91: t5ns2if@if90: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP mode DEFAULT group default qlen 1000", "    link/ether 0e:15:cd:a2:81:3f brd ff:ff:ff:ff:ff:ff link-netnsid 3"]}

TASK [Attach Namespace VETH Pairs] **************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.41.1/24', u'ns_name': u't5', u'ns_if': u't5if', u'if': u'p1'}], u'default_route_ip': u'10.1.41.1', u'bridge_name': u't5br1', u'dns': [{u'dnsif': u't5s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't5s1_dnsbrif'}], u'ns_name': u't5ns1', u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't5_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't5br1if1', u'vmif': u't5VM1if1'}, {u'mem': 4, u'name': u't5_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't5br1if2', u'vmif': u't5VM2if1'}], u'vxlan': [{u'local_ip': u'10.1.41.2', u'dsport': 4789, u'dev': u't5s1if', u'tenant_route_ip': u'192.168.5.2', u'remote_route': u'10.2.41.0/24', u'subnet_route': u'10.1.41.0/24', u'v_name': u'vxlan_t5s1', u'id': 42, u'remote_ip': u'10.2.41.2'}]}, {u'tenant_sub_ip': u'10.1.41.2/24', u'tenant_ns_ip': u'10.1.41.1/24', u'tenant_ns_if': u't5ns1if', u'tenant_sub_if': u't5s1if', u'tenant_ns_name': u't5'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t5\" ip link show \"t5ns1if\" ; if [ $? -ne 0 ] ; then ip link set \"t5ns1if\" netns \"t5\" ; fi\nip netns exec \"t5ns1\" ip link show \"t5s1if\" ; if [ $? -ne 0 ] ; then ip link set \"t5s1if\" netns \"t5ns1\" ; fi\n", "delta": "0:00:00.069423", "end": "2019-12-05 20:52:35.278805", "item": [{"bridge_name": "t5br1", "default_route_ip": "10.1.41.1", "dns": [{"brif": "t5s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.5", "dnsif": "t5s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t5ns1", "route": [{"if": "p1", "ip": "10.1.41.1/24", "ns_if": "t5if", "ns_name": "t5"}], "subnet_ip": "1.1.1.0/24", "vms": [{"brif": "t5br1if1", "disk": "10G", "mem": 2, "name": "t5_VM1", "vcpu": 4, "vmif": "t5VM1if1"}, {"brif": "t5br1if2", "disk": "10G", "mem": 4, "name": "t5_VM2", "vcpu": 2, "vmif": "t5VM2if1"}], "vxlan": [{"dev": "t5s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.41.2", "remote_ip": "10.2.41.2", "remote_route": "10.2.41.0/24", "subnet_route": "10.1.41.0/24", "tenant_route_ip": "192.168.5.2", "v_name": "vxlan_t5s1"}]}, {"tenant_ns_if": "t5ns1if", "tenant_ns_ip": "10.1.41.1/24", "tenant_ns_name": "t5", "tenant_sub_if": "t5s1if", "tenant_sub_ip": "10.1.41.2/24"}], "rc": 0, "start": "2019-12-05 20:52:35.209382", "stderr": "", "stderr_lines": [], "stdout": "89: t5ns1if@if88: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP mode DEFAULT group default qlen 1000\n    link/ether 66:02:b7:25:3a:b7 brd ff:ff:ff:ff:ff:ff link-netnsid 2\n88: t5s1if@if89: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP mode DEFAULT group default qlen 1000\n    link/ether ce:51:3d:49:9e:c1 brd ff:ff:ff:ff:ff:ff link-netnsid 0", "stdout_lines": ["89: t5ns1if@if88: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP mode DEFAULT group default qlen 1000", "    link/ether 66:02:b7:25:3a:b7 brd ff:ff:ff:ff:ff:ff link-netnsid 2", "88: t5s1if@if89: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP mode DEFAULT group default qlen 1000", "    link/ether ce:51:3d:49:9e:c1 brd ff:ff:ff:ff:ff:ff link-netnsid 0"]}
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.42.1/24', u'ns_name': u't5', u'ns_if': u't5if', u'if': u'p1'}], u'default_route_ip': u'10.1.42.1', u'bridge_name': u't5br2', u'dns': [{u'dnsif': [], u'dhcp_start': [], u'dhcp_end': [], u'dnsif_ip': [], u'net_mask': [], u'brif': []}], u'ns_name': u't5ns2', u'subnet_ip': u'2.2.2.0/24', u'vms': [{u'mem': [], u'name': u'JOKER', u'vcpu': [], u'disk': [], u'brif': [], u'vmif': []}], u'vxlan': [{u'local_ip': u'10.1.42.2', u'dsport': 4789, u'dev': u't5s2if', u'tenant_route_ip': u'192.168.5.2', u'remote_route': u'10.2.42.0/24', u'subnet_route': u'10.1.42.0/24', u'v_name': u'vxlan_t5s2', u'id': 42, u'remote_ip': u'10.2.42.2'}]}, {u'tenant_sub_ip': u'10.1.42.2/24', u'tenant_ns_ip': u'10.1.42.1/24', u'tenant_ns_if': u't5ns2if', u'tenant_sub_if': u't5s2if', u'tenant_ns_name': u't5'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t5\" ip link show \"t5ns2if\" ; if [ $? -ne 0 ] ; then ip link set \"t5ns2if\" netns \"t5\" ; fi\nip netns exec \"t5ns2\" ip link show \"t5s2if\" ; if [ $? -ne 0 ] ; then ip link set \"t5s2if\" netns \"t5ns2\" ; fi\n", "delta": "0:00:00.094461", "end": "2019-12-05 20:52:35.614853", "item": [{"bridge_name": "t5br2", "default_route_ip": "10.1.42.1", "dns": [{"brif": [], "dhcp_end": [], "dhcp_start": [], "dnsif": [], "dnsif_ip": [], "net_mask": []}], "ns_name": "t5ns2", "route": [{"if": "p1", "ip": "10.1.42.1/24", "ns_if": "t5if", "ns_name": "t5"}], "subnet_ip": "2.2.2.0/24", "vms": [{"brif": [], "disk": [], "mem": [], "name": "JOKER", "vcpu": [], "vmif": []}], "vxlan": [{"dev": "t5s2if", "dsport": 4789, "id": 42, "local_ip": "10.1.42.2", "remote_ip": "10.2.42.2", "remote_route": "10.2.42.0/24", "subnet_route": "10.1.42.0/24", "tenant_route_ip": "192.168.5.2", "v_name": "vxlan_t5s2"}]}, {"tenant_ns_if": "t5ns2if", "tenant_ns_ip": "10.1.42.1/24", "tenant_ns_name": "t5", "tenant_sub_if": "t5s2if", "tenant_sub_ip": "10.1.42.2/24"}], "rc": 0, "start": "2019-12-05 20:52:35.520392", "stderr": "", "stderr_lines": [], "stdout": "91: t5ns2if@if90: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP mode DEFAULT group default qlen 1000\n    link/ether 0e:15:cd:a2:81:3f brd ff:ff:ff:ff:ff:ff link-netnsid 3\n90: t5s2if@if91: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP mode DEFAULT group default qlen 1000\n    link/ether 0a:0f:aa:7e:85:e8 brd ff:ff:ff:ff:ff:ff link-netnsid 0", "stdout_lines": ["91: t5ns2if@if90: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP mode DEFAULT group default qlen 1000", "    link/ether 0e:15:cd:a2:81:3f brd ff:ff:ff:ff:ff:ff link-netnsid 3", "90: t5s2if@if91: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP mode DEFAULT group default qlen 1000", "    link/ether 0a:0f:aa:7e:85:e8 brd ff:ff:ff:ff:ff:ff link-netnsid 0"]}

TASK [Set Namespace VETH Pairs UP] **************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.41.1/24', u'ns_name': u't5', u'ns_if': u't5if', u'if': u'p1'}], u'default_route_ip': u'10.1.41.1', u'bridge_name': u't5br1', u'dns': [{u'dnsif': u't5s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't5s1_dnsbrif'}], u'ns_name': u't5ns1', u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't5_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't5br1if1', u'vmif': u't5VM1if1'}, {u'mem': 4, u'name': u't5_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't5br1if2', u'vmif': u't5VM2if1'}], u'vxlan': [{u'local_ip': u'10.1.41.2', u'dsport': 4789, u'dev': u't5s1if', u'tenant_route_ip': u'192.168.5.2', u'remote_route': u'10.2.41.0/24', u'subnet_route': u'10.1.41.0/24', u'v_name': u'vxlan_t5s1', u'id': 42, u'remote_ip': u'10.2.41.2'}]}, {u'tenant_sub_ip': u'10.1.41.2/24', u'tenant_ns_ip': u'10.1.41.1/24', u'tenant_ns_if': u't5ns1if', u'tenant_sub_if': u't5s1if', u'tenant_ns_name': u't5'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t5\" ip link set dev \"t5ns1if\" up\nip netns exec \"t5ns1\" ip link set dev \"t5s1if\" up\n", "delta": "0:00:00.074782", "end": "2019-12-05 20:52:36.011041", "item": [{"bridge_name": "t5br1", "default_route_ip": "10.1.41.1", "dns": [{"brif": "t5s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.5", "dnsif": "t5s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t5ns1", "route": [{"if": "p1", "ip": "10.1.41.1/24", "ns_if": "t5if", "ns_name": "t5"}], "subnet_ip": "1.1.1.0/24", "vms": [{"brif": "t5br1if1", "disk": "10G", "mem": 2, "name": "t5_VM1", "vcpu": 4, "vmif": "t5VM1if1"}, {"brif": "t5br1if2", "disk": "10G", "mem": 4, "name": "t5_VM2", "vcpu": 2, "vmif": "t5VM2if1"}], "vxlan": [{"dev": "t5s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.41.2", "remote_ip": "10.2.41.2", "remote_route": "10.2.41.0/24", "subnet_route": "10.1.41.0/24", "tenant_route_ip": "192.168.5.2", "v_name": "vxlan_t5s1"}]}, {"tenant_ns_if": "t5ns1if", "tenant_ns_ip": "10.1.41.1/24", "tenant_ns_name": "t5", "tenant_sub_if": "t5s1if", "tenant_sub_ip": "10.1.41.2/24"}], "rc": 0, "start": "2019-12-05 20:52:35.936259", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.42.1/24', u'ns_name': u't5', u'ns_if': u't5if', u'if': u'p1'}], u'default_route_ip': u'10.1.42.1', u'bridge_name': u't5br2', u'dns': [{u'dnsif': [], u'dhcp_start': [], u'dhcp_end': [], u'dnsif_ip': [], u'net_mask': [], u'brif': []}], u'ns_name': u't5ns2', u'subnet_ip': u'2.2.2.0/24', u'vms': [{u'mem': [], u'name': u'JOKER', u'vcpu': [], u'disk': [], u'brif': [], u'vmif': []}], u'vxlan': [{u'local_ip': u'10.1.42.2', u'dsport': 4789, u'dev': u't5s2if', u'tenant_route_ip': u'192.168.5.2', u'remote_route': u'10.2.42.0/24', u'subnet_route': u'10.1.42.0/24', u'v_name': u'vxlan_t5s2', u'id': 42, u'remote_ip': u'10.2.42.2'}]}, {u'tenant_sub_ip': u'10.1.42.2/24', u'tenant_ns_ip': u'10.1.42.1/24', u'tenant_ns_if': u't5ns2if', u'tenant_sub_if': u't5s2if', u'tenant_ns_name': u't5'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t5\" ip link set dev \"t5ns2if\" up\nip netns exec \"t5ns2\" ip link set dev \"t5s2if\" up\n", "delta": "0:00:00.071925", "end": "2019-12-05 20:52:36.322863", "item": [{"bridge_name": "t5br2", "default_route_ip": "10.1.42.1", "dns": [{"brif": [], "dhcp_end": [], "dhcp_start": [], "dnsif": [], "dnsif_ip": [], "net_mask": []}], "ns_name": "t5ns2", "route": [{"if": "p1", "ip": "10.1.42.1/24", "ns_if": "t5if", "ns_name": "t5"}], "subnet_ip": "2.2.2.0/24", "vms": [{"brif": [], "disk": [], "mem": [], "name": "JOKER", "vcpu": [], "vmif": []}], "vxlan": [{"dev": "t5s2if", "dsport": 4789, "id": 42, "local_ip": "10.1.42.2", "remote_ip": "10.2.42.2", "remote_route": "10.2.42.0/24", "subnet_route": "10.1.42.0/24", "tenant_route_ip": "192.168.5.2", "v_name": "vxlan_t5s2"}]}, {"tenant_ns_if": "t5ns2if", "tenant_ns_ip": "10.1.42.1/24", "tenant_ns_name": "t5", "tenant_sub_if": "t5s2if", "tenant_sub_ip": "10.1.42.2/24"}], "rc": 0, "start": "2019-12-05 20:52:36.250938", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Add IP addresses to Namespace VETH Pairs] *************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.41.1/24', u'ns_name': u't5', u'ns_if': u't5if', u'if': u'p1'}], u'default_route_ip': u'10.1.41.1', u'bridge_name': u't5br1', u'dns': [{u'dnsif': u't5s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't5s1_dnsbrif'}], u'ns_name': u't5ns1', u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't5_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't5br1if1', u'vmif': u't5VM1if1'}, {u'mem': 4, u'name': u't5_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't5br1if2', u'vmif': u't5VM2if1'}], u'vxlan': [{u'local_ip': u'10.1.41.2', u'dsport': 4789, u'dev': u't5s1if', u'tenant_route_ip': u'192.168.5.2', u'remote_route': u'10.2.41.0/24', u'subnet_route': u'10.1.41.0/24', u'v_name': u'vxlan_t5s1', u'id': 42, u'remote_ip': u'10.2.41.2'}]}, {u'tenant_sub_ip': u'10.1.41.2/24', u'tenant_ns_ip': u'10.1.41.1/24', u'tenant_ns_if': u't5ns1if', u'tenant_sub_if': u't5s1if', u'tenant_ns_name': u't5'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t5ns1\" ip addr show \"t5s1if\" | awk 'FNR==3{ print $2 }' | grep -w '^10.1.41.2/24' ; if [ $? -ne 0 ] ; then ip netns exec \"t5ns1\" ip addr add \"10.1.41.2/24\" dev \"t5s1if\" ; fi\n\nip netns exec \"t5\" ip addr show \"t5ns1if\" | awk 'FNR==3{ print $2 }' | grep -w '^10.1.41.1/24' ; if [ $? -ne 0 ] ; then ip netns exec \"t5\" ip addr add \"10.1.41.1/24\" dev \"t5ns1if\" ; fi\n", "delta": "0:00:00.067812", "end": "2019-12-05 20:52:36.723283", "item": [{"bridge_name": "t5br1", "default_route_ip": "10.1.41.1", "dns": [{"brif": "t5s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.5", "dnsif": "t5s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t5ns1", "route": [{"if": "p1", "ip": "10.1.41.1/24", "ns_if": "t5if", "ns_name": "t5"}], "subnet_ip": "1.1.1.0/24", "vms": [{"brif": "t5br1if1", "disk": "10G", "mem": 2, "name": "t5_VM1", "vcpu": 4, "vmif": "t5VM1if1"}, {"brif": "t5br1if2", "disk": "10G", "mem": 4, "name": "t5_VM2", "vcpu": 2, "vmif": "t5VM2if1"}], "vxlan": [{"dev": "t5s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.41.2", "remote_ip": "10.2.41.2", "remote_route": "10.2.41.0/24", "subnet_route": "10.1.41.0/24", "tenant_route_ip": "192.168.5.2", "v_name": "vxlan_t5s1"}]}, {"tenant_ns_if": "t5ns1if", "tenant_ns_ip": "10.1.41.1/24", "tenant_ns_name": "t5", "tenant_sub_if": "t5s1if", "tenant_sub_ip": "10.1.41.2/24"}], "rc": 0, "start": "2019-12-05 20:52:36.655471", "stderr": "", "stderr_lines": [], "stdout": "10.1.41.2/24\n10.1.41.1/24", "stdout_lines": ["10.1.41.2/24", "10.1.41.1/24"]}
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.42.1/24', u'ns_name': u't5', u'ns_if': u't5if', u'if': u'p1'}], u'default_route_ip': u'10.1.42.1', u'bridge_name': u't5br2', u'dns': [{u'dnsif': [], u'dhcp_start': [], u'dhcp_end': [], u'dnsif_ip': [], u'net_mask': [], u'brif': []}], u'ns_name': u't5ns2', u'subnet_ip': u'2.2.2.0/24', u'vms': [{u'mem': [], u'name': u'JOKER', u'vcpu': [], u'disk': [], u'brif': [], u'vmif': []}], u'vxlan': [{u'local_ip': u'10.1.42.2', u'dsport': 4789, u'dev': u't5s2if', u'tenant_route_ip': u'192.168.5.2', u'remote_route': u'10.2.42.0/24', u'subnet_route': u'10.1.42.0/24', u'v_name': u'vxlan_t5s2', u'id': 42, u'remote_ip': u'10.2.42.2'}]}, {u'tenant_sub_ip': u'10.1.42.2/24', u'tenant_ns_ip': u'10.1.42.1/24', u'tenant_ns_if': u't5ns2if', u'tenant_sub_if': u't5s2if', u'tenant_ns_name': u't5'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t5ns2\" ip addr show \"t5s2if\" | awk 'FNR==3{ print $2 }' | grep -w '^10.1.42.2/24' ; if [ $? -ne 0 ] ; then ip netns exec \"t5ns2\" ip addr add \"10.1.42.2/24\" dev \"t5s2if\" ; fi\n\nip netns exec \"t5\" ip addr show \"t5ns2if\" | awk 'FNR==3{ print $2 }' | grep -w '^10.1.42.1/24' ; if [ $? -ne 0 ] ; then ip netns exec \"t5\" ip addr add \"10.1.42.1/24\" dev \"t5ns2if\" ; fi\n", "delta": "0:00:00.071629", "end": "2019-12-05 20:52:37.035249", "item": [{"bridge_name": "t5br2", "default_route_ip": "10.1.42.1", "dns": [{"brif": [], "dhcp_end": [], "dhcp_start": [], "dnsif": [], "dnsif_ip": [], "net_mask": []}], "ns_name": "t5ns2", "route": [{"if": "p1", "ip": "10.1.42.1/24", "ns_if": "t5if", "ns_name": "t5"}], "subnet_ip": "2.2.2.0/24", "vms": [{"brif": [], "disk": [], "mem": [], "name": "JOKER", "vcpu": [], "vmif": []}], "vxlan": [{"dev": "t5s2if", "dsport": 4789, "id": 42, "local_ip": "10.1.42.2", "remote_ip": "10.2.42.2", "remote_route": "10.2.42.0/24", "subnet_route": "10.1.42.0/24", "tenant_route_ip": "192.168.5.2", "v_name": "vxlan_t5s2"}]}, {"tenant_ns_if": "t5ns2if", "tenant_ns_ip": "10.1.42.1/24", "tenant_ns_name": "t5", "tenant_sub_if": "t5s2if", "tenant_sub_ip": "10.1.42.2/24"}], "rc": 0, "start": "2019-12-05 20:52:36.963620", "stderr": "", "stderr_lines": [], "stdout": "10.1.42.2/24\n10.1.42.1/24", "stdout_lines": ["10.1.42.2/24", "10.1.42.1/24"]}

TASK [Add IP Route to Tenant] *******************************************************************************************************************************
changed: [localhost] => (item={u'default_route_ip': u'192.168.5.1', u'name': u't5', u'pns_ip': u'192.168.5.1/24', u'tenant_if': u't5if', u'tenant_ip': u'192.168.5.2/24', u'pns_if': u't5pns_if'}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t5\" ip route show default | grep -w '[d]efault via 192.168.5.1' ; if [ $? -ne 0 ] ; then ip netns exec \"t5\" ip route add default via \"192.168.5.1\" ; fi\n", "delta": "0:00:00.036777", "end": "2019-12-05 20:52:37.387001", "item": {"default_route_ip": "192.168.5.1", "name": "t5", "pns_if": "t5pns_if", "pns_ip": "192.168.5.1/24", "tenant_if": "t5if", "tenant_ip": "192.168.5.2/24"}, "rc": 0, "start": "2019-12-05 20:52:37.350224", "stderr": "", "stderr_lines": [], "stdout": "default via 192.168.5.1 dev t5if ", "stdout_lines": ["default via 192.168.5.1 dev t5if "]}

TASK [Add IP Route to Tenant Subnet] ************************************************************************************************************************
changed: [localhost] => (item={u'route': [{u'ip': u'10.1.41.1/24', u'ns_name': u't5', u'ns_if': u't5if', u'if': u'p1'}], u'default_route_ip': u'10.1.41.1', u'bridge_name': u't5br1', u'dns': [{u'dnsif': u't5s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't5s1_dnsbrif'}], u'ns_name': u't5ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.41.2/24', u'tenant_ns_ip': u'10.1.41.1/24', u'tenant_ns_if': u't5ns1if', u'tenant_ns_name': u't5', u'tenant_sub_if': u't5s1if'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't5_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't5br1if1', u'vmif': u't5VM1if1'}, {u'mem': 4, u'name': u't5_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't5br1if2', u'vmif': u't5VM2if1'}], u'vxlan': [{u'local_ip': u'10.1.41.2', u'tenant_route_ip': u'192.168.5.2', u'dsport': 4789, u'dev': u't5s1if', u'subnet_route': u'10.1.41.0/24', u'remote_route': u'10.2.41.0/24', u'v_name': u'vxlan_t5s1', u'id': 42, u'remote_ip': u'10.2.41.2'}]}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t5ns1\" ip route show default | grep -w '[d]efault via 10.1.41.1' ; if [ $? -ne 0 ] ; then ip netns exec \"t5ns1\" ip route add default via \"10.1.41.1\" ; fi\n", "delta": "0:00:00.039546", "end": "2019-12-05 20:52:37.779056", "item": {"bridge_name": "t5br1", "default_route_ip": "10.1.41.1", "dns": [{"brif": "t5s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.5", "dnsif": "t5s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t5ns1", "route": [{"if": "p1", "ip": "10.1.41.1/24", "ns_if": "t5if", "ns_name": "t5"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t5ns1if", "tenant_ns_ip": "10.1.41.1/24", "tenant_ns_name": "t5", "tenant_sub_if": "t5s1if", "tenant_sub_ip": "10.1.41.2/24"}], "vms": [{"brif": "t5br1if1", "disk": "10G", "mem": 2, "name": "t5_VM1", "vcpu": 4, "vmif": "t5VM1if1"}, {"brif": "t5br1if2", "disk": "10G", "mem": 4, "name": "t5_VM2", "vcpu": 2, "vmif": "t5VM2if1"}], "vxlan": [{"dev": "t5s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.41.2", "remote_ip": "10.2.41.2", "remote_route": "10.2.41.0/24", "subnet_route": "10.1.41.0/24", "tenant_route_ip": "192.168.5.2", "v_name": "vxlan_t5s1"}]}, "rc": 0, "start": "2019-12-05 20:52:37.739510", "stderr": "", "stderr_lines": [], "stdout": "default via 10.1.41.1 dev t5s1if ", "stdout_lines": ["default via 10.1.41.1 dev t5s1if "]}
changed: [localhost] => (item={u'route': [{u'ip': u'10.1.42.1/24', u'ns_name': u't5', u'ns_if': u't5if', u'if': u'p1'}], u'default_route_ip': u'10.1.42.1', u'bridge_name': u't5br2', u'dns': [{u'dnsif': [], u'dhcp_start': [], u'dhcp_end': [], u'dnsif_ip': [], u'net_mask': [], u'brif': []}], u'ns_name': u't5ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.42.2/24', u'tenant_ns_ip': u'10.1.42.1/24', u'tenant_ns_if': u't5ns2if', u'tenant_ns_name': u't5', u'tenant_sub_if': u't5s2if'}], u'subnet_ip': u'2.2.2.0/24', u'vms': [{u'mem': [], u'name': u'JOKER', u'vcpu': [], u'disk': [], u'brif': [], u'vmif': []}], u'vxlan': [{u'local_ip': u'10.1.42.2', u'tenant_route_ip': u'192.168.5.2', u'dsport': 4789, u'dev': u't5s2if', u'subnet_route': u'10.1.42.0/24', u'remote_route': u'10.2.42.0/24', u'v_name': u'vxlan_t5s2', u'id': 42, u'remote_ip': u'10.2.42.2'}]}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t5ns2\" ip route show default | grep -w '[d]efault via 10.1.42.1' ; if [ $? -ne 0 ] ; then ip netns exec \"t5ns2\" ip route add default via \"10.1.42.1\" ; fi\n", "delta": "0:00:00.041867", "end": "2019-12-05 20:52:38.071284", "item": {"bridge_name": "t5br2", "default_route_ip": "10.1.42.1", "dns": [{"brif": [], "dhcp_end": [], "dhcp_start": [], "dnsif": [], "dnsif_ip": [], "net_mask": []}], "ns_name": "t5ns2", "route": [{"if": "p1", "ip": "10.1.42.1/24", "ns_if": "t5if", "ns_name": "t5"}], "subnet_ip": "2.2.2.0/24", "tenant_ns": [{"tenant_ns_if": "t5ns2if", "tenant_ns_ip": "10.1.42.1/24", "tenant_ns_name": "t5", "tenant_sub_if": "t5s2if", "tenant_sub_ip": "10.1.42.2/24"}], "vms": [{"brif": [], "disk": [], "mem": [], "name": "JOKER", "vcpu": [], "vmif": []}], "vxlan": [{"dev": "t5s2if", "dsport": 4789, "id": 42, "local_ip": "10.1.42.2", "remote_ip": "10.2.42.2", "remote_route": "10.2.42.0/24", "subnet_route": "10.1.42.0/24", "tenant_route_ip": "192.168.5.2", "v_name": "vxlan_t5s2"}]}, "rc": 0, "start": "2019-12-05 20:52:38.029417", "stderr": "", "stderr_lines": [], "stdout": "default via 10.1.42.1 dev t5s2if ", "stdout_lines": ["default via 10.1.42.1 dev t5s2if "]}

TASK [Create bridge inside namespace] ***********************************************************************************************************************
changed: [localhost] => (item={u'route': [{u'ip': u'10.1.41.1/24', u'ns_name': u't5', u'ns_if': u't5if', u'if': u'p1'}], u'default_route_ip': u'10.1.41.1', u'bridge_name': u't5br1', u'dns': [{u'dnsif': u't5s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't5s1_dnsbrif'}], u'ns_name': u't5ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.41.2/24', u'tenant_ns_ip': u'10.1.41.1/24', u'tenant_ns_if': u't5ns1if', u'tenant_ns_name': u't5', u'tenant_sub_if': u't5s1if'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't5_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't5br1if1', u'vmif': u't5VM1if1'}, {u'mem': 4, u'name': u't5_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't5br1if2', u'vmif': u't5VM2if1'}], u'vxlan': [{u'local_ip': u'10.1.41.2', u'tenant_route_ip': u'192.168.5.2', u'dsport': 4789, u'dev': u't5s1if', u'subnet_route': u'10.1.41.0/24', u'remote_route': u'10.2.41.0/24', u'v_name': u'vxlan_t5s1', u'id': 42, u'remote_ip': u'10.2.41.2'}]}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t5ns1\" brctl show | grep -w '^t5br1'; if [ $? -ne 0 ] ; then ip netns exec \"t5ns1\" brctl addbr \"t5br1\" ; fi\nip netns exec \"t5ns1\" ip link set dev \"t5br1\" up\n", "delta": "0:00:00.073254", "end": "2019-12-05 20:52:38.434826", "item": {"bridge_name": "t5br1", "default_route_ip": "10.1.41.1", "dns": [{"brif": "t5s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.5", "dnsif": "t5s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t5ns1", "route": [{"if": "p1", "ip": "10.1.41.1/24", "ns_if": "t5if", "ns_name": "t5"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t5ns1if", "tenant_ns_ip": "10.1.41.1/24", "tenant_ns_name": "t5", "tenant_sub_if": "t5s1if", "tenant_sub_ip": "10.1.41.2/24"}], "vms": [{"brif": "t5br1if1", "disk": "10G", "mem": 2, "name": "t5_VM1", "vcpu": 4, "vmif": "t5VM1if1"}, {"brif": "t5br1if2", "disk": "10G", "mem": 4, "name": "t5_VM2", "vcpu": 2, "vmif": "t5VM2if1"}], "vxlan": [{"dev": "t5s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.41.2", "remote_ip": "10.2.41.2", "remote_route": "10.2.41.0/24", "subnet_route": "10.1.41.0/24", "tenant_route_ip": "192.168.5.2", "v_name": "vxlan_t5s1"}]}, "rc": 0, "start": "2019-12-05 20:52:38.361572", "stderr": "", "stderr_lines": [], "stdout": "t5br1\t\t8000.627616c2638e\tno\t\tt5br1if1", "stdout_lines": ["t5br1\t\t8000.627616c2638e\tno\t\tt5br1if1"]}
changed: [localhost] => (item={u'route': [{u'ip': u'10.1.42.1/24', u'ns_name': u't5', u'ns_if': u't5if', u'if': u'p1'}], u'default_route_ip': u'10.1.42.1', u'bridge_name': u't5br2', u'dns': [{u'dnsif': [], u'dhcp_start': [], u'dhcp_end': [], u'dnsif_ip': [], u'net_mask': [], u'brif': []}], u'ns_name': u't5ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.42.2/24', u'tenant_ns_ip': u'10.1.42.1/24', u'tenant_ns_if': u't5ns2if', u'tenant_ns_name': u't5', u'tenant_sub_if': u't5s2if'}], u'subnet_ip': u'2.2.2.0/24', u'vms': [{u'mem': [], u'name': u'JOKER', u'vcpu': [], u'disk': [], u'brif': [], u'vmif': []}], u'vxlan': [{u'local_ip': u'10.1.42.2', u'tenant_route_ip': u'192.168.5.2', u'dsport': 4789, u'dev': u't5s2if', u'subnet_route': u'10.1.42.0/24', u'remote_route': u'10.2.42.0/24', u'v_name': u'vxlan_t5s2', u'id': 42, u'remote_ip': u'10.2.42.2'}]}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t5ns2\" brctl show | grep -w '^t5br2'; if [ $? -ne 0 ] ; then ip netns exec \"t5ns2\" brctl addbr \"t5br2\" ; fi\nip netns exec \"t5ns2\" ip link set dev \"t5br2\" up\n", "delta": "0:00:00.068813", "end": "2019-12-05 20:52:38.739008", "item": {"bridge_name": "t5br2", "default_route_ip": "10.1.42.1", "dns": [{"brif": [], "dhcp_end": [], "dhcp_start": [], "dnsif": [], "dnsif_ip": [], "net_mask": []}], "ns_name": "t5ns2", "route": [{"if": "p1", "ip": "10.1.42.1/24", "ns_if": "t5if", "ns_name": "t5"}], "subnet_ip": "2.2.2.0/24", "tenant_ns": [{"tenant_ns_if": "t5ns2if", "tenant_ns_ip": "10.1.42.1/24", "tenant_ns_name": "t5", "tenant_sub_if": "t5s2if", "tenant_sub_ip": "10.1.42.2/24"}], "vms": [{"brif": [], "disk": [], "mem": [], "name": "JOKER", "vcpu": [], "vmif": []}], "vxlan": [{"dev": "t5s2if", "dsport": 4789, "id": 42, "local_ip": "10.1.42.2", "remote_ip": "10.2.42.2", "remote_route": "10.2.42.0/24", "subnet_route": "10.1.42.0/24", "tenant_route_ip": "192.168.5.2", "v_name": "vxlan_t5s2"}]}, "rc": 0, "start": "2019-12-05 20:52:38.670195", "stderr": "", "stderr_lines": [], "stdout": "t5br2\t\t8000.5e8c9890782f\tno\t\tvxlan_t5s2", "stdout_lines": ["t5br2\t\t8000.5e8c9890782f\tno\t\tvxlan_t5s2"]}

TASK [Create DNS VETH Pair] *********************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.41.1/24', u'ns_name': u't5', u'ns_if': u't5if', u'if': u'p1'}], u'default_route_ip': u'10.1.41.1', u'bridge_name': u't5br1', u'ns_name': u't5ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.41.2/24', u'tenant_ns_ip': u'10.1.41.1/24', u'tenant_ns_if': u't5ns1if', u'tenant_sub_if': u't5s1if', u'tenant_ns_name': u't5'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't5_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't5br1if1', u'vmif': u't5VM1if1'}, {u'mem': 4, u'name': u't5_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't5br1if2', u'vmif': u't5VM2if1'}], u'vxlan': [{u'local_ip': u'10.1.41.2', u'dsport': 4789, u'dev': u't5s1if', u'tenant_route_ip': u'192.168.5.2', u'remote_route': u'10.2.41.0/24', u'subnet_route': u'10.1.41.0/24', u'v_name': u'vxlan_t5s1', u'id': 42, u'remote_ip': u'10.2.41.2'}]}, {u'dnsif': u't5s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't5s1_dnsbrif'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t5ns1\" ip link show \"t5s1_dnsbrif\" ; if [ $? -ne 0 ] ; then ip netns exec \"t5ns1\" ip link add \"t5s1_dnsbrif\" type veth peer name \"t5s1_dnsif\" ; fi\nip netns exec \"t5ns1\" ip link set dev \"t5s1_dnsbrif\" up\nip netns exec \"t5ns1\" ip link set dev \"t5s1_dnsif\" up\n", "delta": "0:00:00.126651", "end": "2019-12-05 20:52:39.174965", "item": [{"bridge_name": "t5br1", "default_route_ip": "10.1.41.1", "ns_name": "t5ns1", "route": [{"if": "p1", "ip": "10.1.41.1/24", "ns_if": "t5if", "ns_name": "t5"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t5ns1if", "tenant_ns_ip": "10.1.41.1/24", "tenant_ns_name": "t5", "tenant_sub_if": "t5s1if", "tenant_sub_ip": "10.1.41.2/24"}], "vms": [{"brif": "t5br1if1", "disk": "10G", "mem": 2, "name": "t5_VM1", "vcpu": 4, "vmif": "t5VM1if1"}, {"brif": "t5br1if2", "disk": "10G", "mem": 4, "name": "t5_VM2", "vcpu": 2, "vmif": "t5VM2if1"}], "vxlan": [{"dev": "t5s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.41.2", "remote_ip": "10.2.41.2", "remote_route": "10.2.41.0/24", "subnet_route": "10.1.41.0/24", "tenant_route_ip": "192.168.5.2", "v_name": "vxlan_t5s1"}]}, {"brif": "t5s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.5", "dnsif": "t5s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "rc": 0, "start": "2019-12-05 20:52:39.048314", "stderr": "", "stderr_lines": [], "stdout": "4: t5s1_dnsbrif@t5s1_dnsif: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue master t5br1 state UP mode DEFAULT group default qlen 1000\n    link/ether 62:eb:97:f3:e6:b1 brd ff:ff:ff:ff:ff:ff", "stdout_lines": ["4: t5s1_dnsbrif@t5s1_dnsif: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue master t5br1 state UP mode DEFAULT group default qlen 1000", "    link/ether 62:eb:97:f3:e6:b1 brd ff:ff:ff:ff:ff:ff"]}
skipping: [localhost] => (item=[{u'route': [{u'ip': u'10.1.42.1/24', u'ns_name': u't5', u'ns_if': u't5if', u'if': u'p1'}], u'default_route_ip': u'10.1.42.1', u'bridge_name': u't5br2', u'ns_name': u't5ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.42.2/24', u'tenant_ns_ip': u'10.1.42.1/24', u'tenant_ns_if': u't5ns2if', u'tenant_sub_if': u't5s2if', u'tenant_ns_name': u't5'}], u'subnet_ip': u'2.2.2.0/24', u'vms': [{u'mem': [], u'name': u'JOKER', u'vcpu': [], u'disk': [], u'brif': [], u'vmif': []}], u'vxlan': [{u'local_ip': u'10.1.42.2', u'dsport': 4789, u'dev': u't5s2if', u'tenant_route_ip': u'192.168.5.2', u'remote_route': u'10.2.42.0/24', u'subnet_route': u'10.1.42.0/24', u'v_name': u'vxlan_t5s2', u'id': 42, u'remote_ip': u'10.2.42.2'}]}, {u'dnsif': [], u'dhcp_start': [], u'dhcp_end': [], u'dnsif_ip': [], u'net_mask': [], u'brif': []}])  => {"ansible_loop_var": "item", "changed": false, "item": [{"bridge_name": "t5br2", "default_route_ip": "10.1.42.1", "ns_name": "t5ns2", "route": [{"if": "p1", "ip": "10.1.42.1/24", "ns_if": "t5if", "ns_name": "t5"}], "subnet_ip": "2.2.2.0/24", "tenant_ns": [{"tenant_ns_if": "t5ns2if", "tenant_ns_ip": "10.1.42.1/24", "tenant_ns_name": "t5", "tenant_sub_if": "t5s2if", "tenant_sub_ip": "10.1.42.2/24"}], "vms": [{"brif": [], "disk": [], "mem": [], "name": "JOKER", "vcpu": [], "vmif": []}], "vxlan": [{"dev": "t5s2if", "dsport": 4789, "id": 42, "local_ip": "10.1.42.2", "remote_ip": "10.2.42.2", "remote_route": "10.2.42.0/24", "subnet_route": "10.1.42.0/24", "tenant_route_ip": "192.168.5.2", "v_name": "vxlan_t5s2"}]}, {"brif": [], "dhcp_end": [], "dhcp_start": [], "dnsif": [], "dnsif_ip": [], "net_mask": []}], "skip_reason": "Conditional result was False"}

TASK [Attach DNS VETH Pair] *********************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.41.1/24', u'ns_name': u't5', u'ns_if': u't5if', u'if': u'p1'}], u'default_route_ip': u'10.1.41.1', u'bridge_name': u't5br1', u'ns_name': u't5ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.41.2/24', u'tenant_ns_ip': u'10.1.41.1/24', u'tenant_ns_if': u't5ns1if', u'tenant_sub_if': u't5s1if', u'tenant_ns_name': u't5'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't5_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't5br1if1', u'vmif': u't5VM1if1'}, {u'mem': 4, u'name': u't5_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't5br1if2', u'vmif': u't5VM2if1'}], u'vxlan': [{u'local_ip': u'10.1.41.2', u'dsport': 4789, u'dev': u't5s1if', u'tenant_route_ip': u'192.168.5.2', u'remote_route': u'10.2.41.0/24', u'subnet_route': u'10.1.41.0/24', u'v_name': u'vxlan_t5s1', u'id': 42, u'remote_ip': u'10.2.41.2'}]}, {u'dnsif': u't5s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't5s1_dnsbrif'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t5ns1\" brctl show \"t5br1\" | grep -w 't5s1_dnsbrif' ; if [ $? -ne 0 ] ; then ip netns exec \"t5ns1\" brctl addif \"t5br1\" \"t5s1_dnsbrif\" ; fi\n", "delta": "0:00:00.055345", "end": "2019-12-05 20:52:39.595821", "item": [{"bridge_name": "t5br1", "default_route_ip": "10.1.41.1", "ns_name": "t5ns1", "route": [{"if": "p1", "ip": "10.1.41.1/24", "ns_if": "t5if", "ns_name": "t5"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t5ns1if", "tenant_ns_ip": "10.1.41.1/24", "tenant_ns_name": "t5", "tenant_sub_if": "t5s1if", "tenant_sub_ip": "10.1.41.2/24"}], "vms": [{"brif": "t5br1if1", "disk": "10G", "mem": 2, "name": "t5_VM1", "vcpu": 4, "vmif": "t5VM1if1"}, {"brif": "t5br1if2", "disk": "10G", "mem": 4, "name": "t5_VM2", "vcpu": 2, "vmif": "t5VM2if1"}], "vxlan": [{"dev": "t5s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.41.2", "remote_ip": "10.2.41.2", "remote_route": "10.2.41.0/24", "subnet_route": "10.1.41.0/24", "tenant_route_ip": "192.168.5.2", "v_name": "vxlan_t5s1"}]}, {"brif": "t5s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.5", "dnsif": "t5s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "rc": 0, "start": "2019-12-05 20:52:39.540476", "stderr": "", "stderr_lines": [], "stdout": "\t\t\t\t\t\t\tt5s1_dnsbrif", "stdout_lines": ["\t\t\t\t\t\t\tt5s1_dnsbrif"]}
skipping: [localhost] => (item=[{u'route': [{u'ip': u'10.1.42.1/24', u'ns_name': u't5', u'ns_if': u't5if', u'if': u'p1'}], u'default_route_ip': u'10.1.42.1', u'bridge_name': u't5br2', u'ns_name': u't5ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.42.2/24', u'tenant_ns_ip': u'10.1.42.1/24', u'tenant_ns_if': u't5ns2if', u'tenant_sub_if': u't5s2if', u'tenant_ns_name': u't5'}], u'subnet_ip': u'2.2.2.0/24', u'vms': [{u'mem': [], u'name': u'JOKER', u'vcpu': [], u'disk': [], u'brif': [], u'vmif': []}], u'vxlan': [{u'local_ip': u'10.1.42.2', u'dsport': 4789, u'dev': u't5s2if', u'tenant_route_ip': u'192.168.5.2', u'remote_route': u'10.2.42.0/24', u'subnet_route': u'10.1.42.0/24', u'v_name': u'vxlan_t5s2', u'id': 42, u'remote_ip': u'10.2.42.2'}]}, {u'dnsif': [], u'dhcp_start': [], u'dhcp_end': [], u'dnsif_ip': [], u'net_mask': [], u'brif': []}])  => {"ansible_loop_var": "item", "changed": false, "item": [{"bridge_name": "t5br2", "default_route_ip": "10.1.42.1", "ns_name": "t5ns2", "route": [{"if": "p1", "ip": "10.1.42.1/24", "ns_if": "t5if", "ns_name": "t5"}], "subnet_ip": "2.2.2.0/24", "tenant_ns": [{"tenant_ns_if": "t5ns2if", "tenant_ns_ip": "10.1.42.1/24", "tenant_ns_name": "t5", "tenant_sub_if": "t5s2if", "tenant_sub_ip": "10.1.42.2/24"}], "vms": [{"brif": [], "disk": [], "mem": [], "name": "JOKER", "vcpu": [], "vmif": []}], "vxlan": [{"dev": "t5s2if", "dsport": 4789, "id": 42, "local_ip": "10.1.42.2", "remote_ip": "10.2.42.2", "remote_route": "10.2.42.0/24", "subnet_route": "10.1.42.0/24", "tenant_route_ip": "192.168.5.2", "v_name": "vxlan_t5s2"}]}, {"brif": [], "dhcp_end": [], "dhcp_start": [], "dnsif": [], "dnsif_ip": [], "net_mask": []}], "skip_reason": "Conditional result was False"}

TASK [Create VETH Pairs] ************************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.41.1/24', u'ns_name': u't5', u'ns_if': u't5if', u'if': u'p1'}], u'default_route_ip': u'10.1.41.1', u'bridge_name': u't5br1', u'dns': [{u'dnsif': u't5s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't5s1_dnsbrif'}], u'ns_name': u't5ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.41.2/24', u'tenant_ns_ip': u'10.1.41.1/24', u'tenant_ns_if': u't5ns1if', u'tenant_sub_if': u't5s1if', u'tenant_ns_name': u't5'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.1.41.2', u'dsport': 4789, u'dev': u't5s1if', u'tenant_route_ip': u'192.168.5.2', u'remote_route': u'10.2.41.0/24', u'subnet_route': u'10.1.41.0/24', u'v_name': u'vxlan_t5s1', u'id': 42, u'remote_ip': u'10.2.41.2'}]}, {u'mem': 2, u'name': u't5_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't5br1if1', u'vmif': u't5VM1if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t5ns1\" ip link show \"t5br1if1\" ; if [ $? -ne 0 ] ; then ip link add \"t5VM1if1\" type veth peer name \"t5br1if1\" ; fi\nip link set dev \"t5br1if1\" up\nip link set dev \"t5VM1if1\" up\n", "delta": "0:00:00.060476", "end": "2019-12-05 20:52:40.008183", "item": [{"bridge_name": "t5br1", "default_route_ip": "10.1.41.1", "dns": [{"brif": "t5s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.5", "dnsif": "t5s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t5ns1", "route": [{"if": "p1", "ip": "10.1.41.1/24", "ns_if": "t5if", "ns_name": "t5"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t5ns1if", "tenant_ns_ip": "10.1.41.1/24", "tenant_ns_name": "t5", "tenant_sub_if": "t5s1if", "tenant_sub_ip": "10.1.41.2/24"}], "vxlan": [{"dev": "t5s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.41.2", "remote_ip": "10.2.41.2", "remote_route": "10.2.41.0/24", "subnet_route": "10.1.41.0/24", "tenant_route_ip": "192.168.5.2", "v_name": "vxlan_t5s1"}]}, {"brif": "t5br1if1", "disk": "10G", "mem": 2, "name": "t5_VM1", "vcpu": 4, "vmif": "t5VM1if1"}], "rc": 0, "start": "2019-12-05 20:52:39.947707", "stderr": "Cannot find device \"t5br1if1\"", "stderr_lines": ["Cannot find device \"t5br1if1\""], "stdout": "92: t5br1if1@if93: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue master t5br1 state UP mode DEFAULT group default qlen 1000\n    link/ether fa:6c:55:63:19:b0 brd ff:ff:ff:ff:ff:ff link-netnsid 1", "stdout_lines": ["92: t5br1if1@if93: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue master t5br1 state UP mode DEFAULT group default qlen 1000", "    link/ether fa:6c:55:63:19:b0 brd ff:ff:ff:ff:ff:ff link-netnsid 1"]}
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.41.1/24', u'ns_name': u't5', u'ns_if': u't5if', u'if': u'p1'}], u'default_route_ip': u'10.1.41.1', u'bridge_name': u't5br1', u'dns': [{u'dnsif': u't5s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't5s1_dnsbrif'}], u'ns_name': u't5ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.41.2/24', u'tenant_ns_ip': u'10.1.41.1/24', u'tenant_ns_if': u't5ns1if', u'tenant_sub_if': u't5s1if', u'tenant_ns_name': u't5'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.1.41.2', u'dsport': 4789, u'dev': u't5s1if', u'tenant_route_ip': u'192.168.5.2', u'remote_route': u'10.2.41.0/24', u'subnet_route': u'10.1.41.0/24', u'v_name': u'vxlan_t5s1', u'id': 42, u'remote_ip': u'10.2.41.2'}]}, {u'mem': 4, u'name': u't5_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't5br1if2', u'vmif': u't5VM2if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t5ns1\" ip link show \"t5br1if2\" ; if [ $? -ne 0 ] ; then ip link add \"t5VM2if1\" type veth peer name \"t5br1if2\" ; fi\nip link set dev \"t5br1if2\" up\nip link set dev \"t5VM2if1\" up\n", "delta": "0:00:00.059220", "end": "2019-12-05 20:52:40.346861", "item": [{"bridge_name": "t5br1", "default_route_ip": "10.1.41.1", "dns": [{"brif": "t5s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.5", "dnsif": "t5s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t5ns1", "route": [{"if": "p1", "ip": "10.1.41.1/24", "ns_if": "t5if", "ns_name": "t5"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t5ns1if", "tenant_ns_ip": "10.1.41.1/24", "tenant_ns_name": "t5", "tenant_sub_if": "t5s1if", "tenant_sub_ip": "10.1.41.2/24"}], "vxlan": [{"dev": "t5s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.41.2", "remote_ip": "10.2.41.2", "remote_route": "10.2.41.0/24", "subnet_route": "10.1.41.0/24", "tenant_route_ip": "192.168.5.2", "v_name": "vxlan_t5s1"}]}, {"brif": "t5br1if2", "disk": "10G", "mem": 4, "name": "t5_VM2", "vcpu": 2, "vmif": "t5VM2if1"}], "rc": 0, "start": "2019-12-05 20:52:40.287641", "stderr": "Cannot find device \"t5br1if2\"", "stderr_lines": ["Cannot find device \"t5br1if2\""], "stdout": "94: t5br1if2@if95: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue master t5br1 state UP mode DEFAULT group default qlen 1000\n    link/ether 62:76:16:c2:63:8e brd ff:ff:ff:ff:ff:ff link-netnsid 1", "stdout_lines": ["94: t5br1if2@if95: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue master t5br1 state UP mode DEFAULT group default qlen 1000", "    link/ether 62:76:16:c2:63:8e brd ff:ff:ff:ff:ff:ff link-netnsid 1"]}
skipping: [localhost] => (item=[{u'route': [{u'ip': u'10.1.42.1/24', u'ns_name': u't5', u'ns_if': u't5if', u'if': u'p1'}], u'default_route_ip': u'10.1.42.1', u'bridge_name': u't5br2', u'dns': [{u'dnsif': [], u'dhcp_start': [], u'dhcp_end': [], u'dnsif_ip': [], u'net_mask': [], u'brif': []}], u'ns_name': u't5ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.42.2/24', u'tenant_ns_ip': u'10.1.42.1/24', u'tenant_ns_if': u't5ns2if', u'tenant_sub_if': u't5s2if', u'tenant_ns_name': u't5'}], u'subnet_ip': u'2.2.2.0/24', u'vxlan': [{u'local_ip': u'10.1.42.2', u'dsport': 4789, u'dev': u't5s2if', u'tenant_route_ip': u'192.168.5.2', u'remote_route': u'10.2.42.0/24', u'subnet_route': u'10.1.42.0/24', u'v_name': u'vxlan_t5s2', u'id': 42, u'remote_ip': u'10.2.42.2'}]}, {u'mem': [], u'name': u'JOKER', u'vcpu': [], u'disk': [], u'brif': [], u'vmif': []}])  => {"ansible_loop_var": "item", "changed": false, "item": [{"bridge_name": "t5br2", "default_route_ip": "10.1.42.1", "dns": [{"brif": [], "dhcp_end": [], "dhcp_start": [], "dnsif": [], "dnsif_ip": [], "net_mask": []}], "ns_name": "t5ns2", "route": [{"if": "p1", "ip": "10.1.42.1/24", "ns_if": "t5if", "ns_name": "t5"}], "subnet_ip": "2.2.2.0/24", "tenant_ns": [{"tenant_ns_if": "t5ns2if", "tenant_ns_ip": "10.1.42.1/24", "tenant_ns_name": "t5", "tenant_sub_if": "t5s2if", "tenant_sub_ip": "10.1.42.2/24"}], "vxlan": [{"dev": "t5s2if", "dsport": 4789, "id": 42, "local_ip": "10.1.42.2", "remote_ip": "10.2.42.2", "remote_route": "10.2.42.0/24", "subnet_route": "10.1.42.0/24", "tenant_route_ip": "192.168.5.2", "v_name": "vxlan_t5s2"}]}, {"brif": [], "disk": [], "mem": [], "name": "JOKER", "vcpu": [], "vmif": []}], "skip_reason": "Conditional result was False"}

TASK [Attach VETH Pairs] ************************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.41.1/24', u'ns_name': u't5', u'ns_if': u't5if', u'if': u'p1'}], u'default_route_ip': u'10.1.41.1', u'bridge_name': u't5br1', u'dns': [{u'dnsif': u't5s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't5s1_dnsbrif'}], u'ns_name': u't5ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.41.2/24', u'tenant_ns_ip': u'10.1.41.1/24', u'tenant_ns_if': u't5ns1if', u'tenant_sub_if': u't5s1if', u'tenant_ns_name': u't5'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.1.41.2', u'dsport': 4789, u'dev': u't5s1if', u'tenant_route_ip': u'192.168.5.2', u'remote_route': u'10.2.41.0/24', u'subnet_route': u'10.1.41.0/24', u'v_name': u'vxlan_t5s1', u'id': 42, u'remote_ip': u'10.2.41.2'}]}, {u'mem': 2, u'name': u't5_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't5br1if1', u'vmif': u't5VM1if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip link show \"t5br1if1\" ; if [ $? -eq 0 ] ; then ip link set \"t5br1if1\" netns \"t5ns1\" ; fi\nip netns exec \"t5ns1\" brctl show \"t5br1\" | grep -w 't5br1if1' ; if [ $? -ne 0 ] ; then ip netns exec \"t5ns1\" brctl addif \"t5br1\" \"t5br1if1\" ; fi\n", "delta": "0:00:00.079027", "end": "2019-12-05 20:52:40.810994", "item": [{"bridge_name": "t5br1", "default_route_ip": "10.1.41.1", "dns": [{"brif": "t5s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.5", "dnsif": "t5s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t5ns1", "route": [{"if": "p1", "ip": "10.1.41.1/24", "ns_if": "t5if", "ns_name": "t5"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t5ns1if", "tenant_ns_ip": "10.1.41.1/24", "tenant_ns_name": "t5", "tenant_sub_if": "t5s1if", "tenant_sub_ip": "10.1.41.2/24"}], "vxlan": [{"dev": "t5s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.41.2", "remote_ip": "10.2.41.2", "remote_route": "10.2.41.0/24", "subnet_route": "10.1.41.0/24", "tenant_route_ip": "192.168.5.2", "v_name": "vxlan_t5s1"}]}, {"brif": "t5br1if1", "disk": "10G", "mem": 2, "name": "t5_VM1", "vcpu": 4, "vmif": "t5VM1if1"}], "rc": 0, "start": "2019-12-05 20:52:40.731967", "stderr": "Device \"t5br1if1\" does not exist.", "stderr_lines": ["Device \"t5br1if1\" does not exist."], "stdout": "t5br1\t\t8000.627616c2638e\tno\t\tt5br1if1", "stdout_lines": ["t5br1\t\t8000.627616c2638e\tno\t\tt5br1if1"]}
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.41.1/24', u'ns_name': u't5', u'ns_if': u't5if', u'if': u'p1'}], u'default_route_ip': u'10.1.41.1', u'bridge_name': u't5br1', u'dns': [{u'dnsif': u't5s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't5s1_dnsbrif'}], u'ns_name': u't5ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.41.2/24', u'tenant_ns_ip': u'10.1.41.1/24', u'tenant_ns_if': u't5ns1if', u'tenant_sub_if': u't5s1if', u'tenant_ns_name': u't5'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.1.41.2', u'dsport': 4789, u'dev': u't5s1if', u'tenant_route_ip': u'192.168.5.2', u'remote_route': u'10.2.41.0/24', u'subnet_route': u'10.1.41.0/24', u'v_name': u'vxlan_t5s1', u'id': 42, u'remote_ip': u'10.2.41.2'}]}, {u'mem': 4, u'name': u't5_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't5br1if2', u'vmif': u't5VM2if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip link show \"t5br1if2\" ; if [ $? -eq 0 ] ; then ip link set \"t5br1if2\" netns \"t5ns1\" ; fi\nip netns exec \"t5ns1\" brctl show \"t5br1\" | grep -w 't5br1if2' ; if [ $? -ne 0 ] ; then ip netns exec \"t5ns1\" brctl addif \"t5br1\" \"t5br1if2\" ; fi\n", "delta": "0:00:00.052545", "end": "2019-12-05 20:52:41.130985", "item": [{"bridge_name": "t5br1", "default_route_ip": "10.1.41.1", "dns": [{"brif": "t5s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.5", "dnsif": "t5s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t5ns1", "route": [{"if": "p1", "ip": "10.1.41.1/24", "ns_if": "t5if", "ns_name": "t5"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t5ns1if", "tenant_ns_ip": "10.1.41.1/24", "tenant_ns_name": "t5", "tenant_sub_if": "t5s1if", "tenant_sub_ip": "10.1.41.2/24"}], "vxlan": [{"dev": "t5s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.41.2", "remote_ip": "10.2.41.2", "remote_route": "10.2.41.0/24", "subnet_route": "10.1.41.0/24", "tenant_route_ip": "192.168.5.2", "v_name": "vxlan_t5s1"}]}, {"brif": "t5br1if2", "disk": "10G", "mem": 4, "name": "t5_VM2", "vcpu": 2, "vmif": "t5VM2if1"}], "rc": 0, "start": "2019-12-05 20:52:41.078440", "stderr": "Device \"t5br1if2\" does not exist.", "stderr_lines": ["Device \"t5br1if2\" does not exist."], "stdout": "\t\t\t\t\t\t\tt5br1if2", "stdout_lines": ["\t\t\t\t\t\t\tt5br1if2"]}
skipping: [localhost] => (item=[{u'route': [{u'ip': u'10.1.42.1/24', u'ns_name': u't5', u'ns_if': u't5if', u'if': u'p1'}], u'default_route_ip': u'10.1.42.1', u'bridge_name': u't5br2', u'dns': [{u'dnsif': [], u'dhcp_start': [], u'dhcp_end': [], u'dnsif_ip': [], u'net_mask': [], u'brif': []}], u'ns_name': u't5ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.42.2/24', u'tenant_ns_ip': u'10.1.42.1/24', u'tenant_ns_if': u't5ns2if', u'tenant_sub_if': u't5s2if', u'tenant_ns_name': u't5'}], u'subnet_ip': u'2.2.2.0/24', u'vxlan': [{u'local_ip': u'10.1.42.2', u'dsport': 4789, u'dev': u't5s2if', u'tenant_route_ip': u'192.168.5.2', u'remote_route': u'10.2.42.0/24', u'subnet_route': u'10.1.42.0/24', u'v_name': u'vxlan_t5s2', u'id': 42, u'remote_ip': u'10.2.42.2'}]}, {u'mem': [], u'name': u'JOKER', u'vcpu': [], u'disk': [], u'brif': [], u'vmif': []}])  => {"ansible_loop_var": "item", "changed": false, "item": [{"bridge_name": "t5br2", "default_route_ip": "10.1.42.1", "dns": [{"brif": [], "dhcp_end": [], "dhcp_start": [], "dnsif": [], "dnsif_ip": [], "net_mask": []}], "ns_name": "t5ns2", "route": [{"if": "p1", "ip": "10.1.42.1/24", "ns_if": "t5if", "ns_name": "t5"}], "subnet_ip": "2.2.2.0/24", "tenant_ns": [{"tenant_ns_if": "t5ns2if", "tenant_ns_ip": "10.1.42.1/24", "tenant_ns_name": "t5", "tenant_sub_if": "t5s2if", "tenant_sub_ip": "10.1.42.2/24"}], "vxlan": [{"dev": "t5s2if", "dsport": 4789, "id": 42, "local_ip": "10.1.42.2", "remote_ip": "10.2.42.2", "remote_route": "10.2.42.0/24", "subnet_route": "10.1.42.0/24", "tenant_route_ip": "192.168.5.2", "v_name": "vxlan_t5s2"}]}, {"brif": [], "disk": [], "mem": [], "name": "JOKER", "vcpu": [], "vmif": []}], "skip_reason": "Conditional result was False"}

TASK [All interfaces and bridges UP] ************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.41.1/24', u'ns_name': u't5', u'ns_if': u't5if', u'if': u'p1'}], u'default_route_ip': u'10.1.41.1', u'bridge_name': u't5br1', u'dns': [{u'dnsif': u't5s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't5s1_dnsbrif'}], u'ns_name': u't5ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.41.2/24', u'tenant_ns_ip': u'10.1.41.1/24', u'tenant_ns_if': u't5ns1if', u'tenant_sub_if': u't5s1if', u'tenant_ns_name': u't5'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.1.41.2', u'dsport': 4789, u'dev': u't5s1if', u'tenant_route_ip': u'192.168.5.2', u'remote_route': u'10.2.41.0/24', u'subnet_route': u'10.1.41.0/24', u'v_name': u'vxlan_t5s1', u'id': 42, u'remote_ip': u'10.2.41.2'}]}, {u'mem': 2, u'name': u't5_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't5br1if1', u'vmif': u't5VM1if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t5ns1\" ip link set \"t5br1if1\" up\nip netns exec \"t5ns1\" ip link set dev \"t5br1\" up\n", "delta": "0:00:00.088744", "end": "2019-12-05 20:52:41.554962", "item": [{"bridge_name": "t5br1", "default_route_ip": "10.1.41.1", "dns": [{"brif": "t5s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.5", "dnsif": "t5s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t5ns1", "route": [{"if": "p1", "ip": "10.1.41.1/24", "ns_if": "t5if", "ns_name": "t5"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t5ns1if", "tenant_ns_ip": "10.1.41.1/24", "tenant_ns_name": "t5", "tenant_sub_if": "t5s1if", "tenant_sub_ip": "10.1.41.2/24"}], "vxlan": [{"dev": "t5s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.41.2", "remote_ip": "10.2.41.2", "remote_route": "10.2.41.0/24", "subnet_route": "10.1.41.0/24", "tenant_route_ip": "192.168.5.2", "v_name": "vxlan_t5s1"}]}, {"brif": "t5br1if1", "disk": "10G", "mem": 2, "name": "t5_VM1", "vcpu": 4, "vmif": "t5VM1if1"}], "rc": 0, "start": "2019-12-05 20:52:41.466218", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.41.1/24', u'ns_name': u't5', u'ns_if': u't5if', u'if': u'p1'}], u'default_route_ip': u'10.1.41.1', u'bridge_name': u't5br1', u'dns': [{u'dnsif': u't5s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't5s1_dnsbrif'}], u'ns_name': u't5ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.41.2/24', u'tenant_ns_ip': u'10.1.41.1/24', u'tenant_ns_if': u't5ns1if', u'tenant_sub_if': u't5s1if', u'tenant_ns_name': u't5'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.1.41.2', u'dsport': 4789, u'dev': u't5s1if', u'tenant_route_ip': u'192.168.5.2', u'remote_route': u'10.2.41.0/24', u'subnet_route': u'10.1.41.0/24', u'v_name': u'vxlan_t5s1', u'id': 42, u'remote_ip': u'10.2.41.2'}]}, {u'mem': 4, u'name': u't5_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't5br1if2', u'vmif': u't5VM2if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t5ns1\" ip link set \"t5br1if2\" up\nip netns exec \"t5ns1\" ip link set dev \"t5br1\" up\n", "delta": "0:00:00.080819", "end": "2019-12-05 20:52:41.862812", "item": [{"bridge_name": "t5br1", "default_route_ip": "10.1.41.1", "dns": [{"brif": "t5s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.5", "dnsif": "t5s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t5ns1", "route": [{"if": "p1", "ip": "10.1.41.1/24", "ns_if": "t5if", "ns_name": "t5"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t5ns1if", "tenant_ns_ip": "10.1.41.1/24", "tenant_ns_name": "t5", "tenant_sub_if": "t5s1if", "tenant_sub_ip": "10.1.41.2/24"}], "vxlan": [{"dev": "t5s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.41.2", "remote_ip": "10.2.41.2", "remote_route": "10.2.41.0/24", "subnet_route": "10.1.41.0/24", "tenant_route_ip": "192.168.5.2", "v_name": "vxlan_t5s1"}]}, {"brif": "t5br1if2", "disk": "10G", "mem": 4, "name": "t5_VM2", "vcpu": 2, "vmif": "t5VM2if1"}], "rc": 0, "start": "2019-12-05 20:52:41.781993", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}
skipping: [localhost] => (item=[{u'route': [{u'ip': u'10.1.42.1/24', u'ns_name': u't5', u'ns_if': u't5if', u'if': u'p1'}], u'default_route_ip': u'10.1.42.1', u'bridge_name': u't5br2', u'dns': [{u'dnsif': [], u'dhcp_start': [], u'dhcp_end': [], u'dnsif_ip': [], u'net_mask': [], u'brif': []}], u'ns_name': u't5ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.42.2/24', u'tenant_ns_ip': u'10.1.42.1/24', u'tenant_ns_if': u't5ns2if', u'tenant_sub_if': u't5s2if', u'tenant_ns_name': u't5'}], u'subnet_ip': u'2.2.2.0/24', u'vxlan': [{u'local_ip': u'10.1.42.2', u'dsport': 4789, u'dev': u't5s2if', u'tenant_route_ip': u'192.168.5.2', u'remote_route': u'10.2.42.0/24', u'subnet_route': u'10.1.42.0/24', u'v_name': u'vxlan_t5s2', u'id': 42, u'remote_ip': u'10.2.42.2'}]}, {u'mem': [], u'name': u'JOKER', u'vcpu': [], u'disk': [], u'brif': [], u'vmif': []}])  => {"ansible_loop_var": "item", "changed": false, "item": [{"bridge_name": "t5br2", "default_route_ip": "10.1.42.1", "dns": [{"brif": [], "dhcp_end": [], "dhcp_start": [], "dnsif": [], "dnsif_ip": [], "net_mask": []}], "ns_name": "t5ns2", "route": [{"if": "p1", "ip": "10.1.42.1/24", "ns_if": "t5if", "ns_name": "t5"}], "subnet_ip": "2.2.2.0/24", "tenant_ns": [{"tenant_ns_if": "t5ns2if", "tenant_ns_ip": "10.1.42.1/24", "tenant_ns_name": "t5", "tenant_sub_if": "t5s2if", "tenant_sub_ip": "10.1.42.2/24"}], "vxlan": [{"dev": "t5s2if", "dsport": 4789, "id": 42, "local_ip": "10.1.42.2", "remote_ip": "10.2.42.2", "remote_route": "10.2.42.0/24", "subnet_route": "10.1.42.0/24", "tenant_route_ip": "192.168.5.2", "v_name": "vxlan_t5s2"}]}, {"brif": [], "disk": [], "mem": [], "name": "JOKER", "vcpu": [], "vmif": []}], "skip_reason": "Conditional result was False"}

TASK [Add IP to DNS Interface] ******************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.41.1/24', u'ns_name': u't5', u'ns_if': u't5if', u'if': u'p1'}], u'default_route_ip': u'10.1.41.1', u'bridge_name': u't5br1', u'ns_name': u't5ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.41.2/24', u'tenant_ns_ip': u'10.1.41.1/24', u'tenant_ns_if': u't5ns1if', u'tenant_sub_if': u't5s1if', u'tenant_ns_name': u't5'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't5_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't5br1if1', u'vmif': u't5VM1if1'}, {u'mem': 4, u'name': u't5_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't5br1if2', u'vmif': u't5VM2if1'}], u'vxlan': [{u'local_ip': u'10.1.41.2', u'dsport': 4789, u'dev': u't5s1if', u'tenant_route_ip': u'192.168.5.2', u'remote_route': u'10.2.41.0/24', u'subnet_route': u'10.1.41.0/24', u'v_name': u'vxlan_t5s1', u'id': 42, u'remote_ip': u'10.2.41.2'}]}, {u'dnsif': u't5s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't5s1_dnsbrif'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t5ns1\" ip addr show \"t5s1_dnsif\" | awk 'FNR==3{ print $2 }' | grep -w '^1.1.1.1/24' ; if [ $? -ne 0 ] ; then ip netns exec \"t5ns1\" ip addr add \"1.1.1.1/24\" dev \"t5s1_dnsif\" ; fi\n", "delta": "0:00:00.041651", "end": "2019-12-05 20:52:42.219228", "item": [{"bridge_name": "t5br1", "default_route_ip": "10.1.41.1", "ns_name": "t5ns1", "route": [{"if": "p1", "ip": "10.1.41.1/24", "ns_if": "t5if", "ns_name": "t5"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t5ns1if", "tenant_ns_ip": "10.1.41.1/24", "tenant_ns_name": "t5", "tenant_sub_if": "t5s1if", "tenant_sub_ip": "10.1.41.2/24"}], "vms": [{"brif": "t5br1if1", "disk": "10G", "mem": 2, "name": "t5_VM1", "vcpu": 4, "vmif": "t5VM1if1"}, {"brif": "t5br1if2", "disk": "10G", "mem": 4, "name": "t5_VM2", "vcpu": 2, "vmif": "t5VM2if1"}], "vxlan": [{"dev": "t5s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.41.2", "remote_ip": "10.2.41.2", "remote_route": "10.2.41.0/24", "subnet_route": "10.1.41.0/24", "tenant_route_ip": "192.168.5.2", "v_name": "vxlan_t5s1"}]}, {"brif": "t5s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.5", "dnsif": "t5s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "rc": 0, "start": "2019-12-05 20:52:42.177577", "stderr": "", "stderr_lines": [], "stdout": "1.1.1.1/24", "stdout_lines": ["1.1.1.1/24"]}
skipping: [localhost] => (item=[{u'route': [{u'ip': u'10.1.42.1/24', u'ns_name': u't5', u'ns_if': u't5if', u'if': u'p1'}], u'default_route_ip': u'10.1.42.1', u'bridge_name': u't5br2', u'ns_name': u't5ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.42.2/24', u'tenant_ns_ip': u'10.1.42.1/24', u'tenant_ns_if': u't5ns2if', u'tenant_sub_if': u't5s2if', u'tenant_ns_name': u't5'}], u'subnet_ip': u'2.2.2.0/24', u'vms': [{u'mem': [], u'name': u'JOKER', u'vcpu': [], u'disk': [], u'brif': [], u'vmif': []}], u'vxlan': [{u'local_ip': u'10.1.42.2', u'dsport': 4789, u'dev': u't5s2if', u'tenant_route_ip': u'192.168.5.2', u'remote_route': u'10.2.42.0/24', u'subnet_route': u'10.1.42.0/24', u'v_name': u'vxlan_t5s2', u'id': 42, u'remote_ip': u'10.2.42.2'}]}, {u'dnsif': [], u'dhcp_start': [], u'dhcp_end': [], u'dnsif_ip': [], u'net_mask': [], u'brif': []}])  => {"ansible_loop_var": "item", "changed": false, "item": [{"bridge_name": "t5br2", "default_route_ip": "10.1.42.1", "ns_name": "t5ns2", "route": [{"if": "p1", "ip": "10.1.42.1/24", "ns_if": "t5if", "ns_name": "t5"}], "subnet_ip": "2.2.2.0/24", "tenant_ns": [{"tenant_ns_if": "t5ns2if", "tenant_ns_ip": "10.1.42.1/24", "tenant_ns_name": "t5", "tenant_sub_if": "t5s2if", "tenant_sub_ip": "10.1.42.2/24"}], "vms": [{"brif": [], "disk": [], "mem": [], "name": "JOKER", "vcpu": [], "vmif": []}], "vxlan": [{"dev": "t5s2if", "dsport": 4789, "id": 42, "local_ip": "10.1.42.2", "remote_ip": "10.2.42.2", "remote_route": "10.2.42.0/24", "subnet_route": "10.1.42.0/24", "tenant_route_ip": "192.168.5.2", "v_name": "vxlan_t5s2"}]}, {"brif": [], "dhcp_end": [], "dhcp_start": [], "dnsif": [], "dnsif_ip": [], "net_mask": []}], "skip_reason": "Conditional result was False"}

TASK [Install DHCP Server] **********************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.41.1/24', u'ns_name': u't5', u'ns_if': u't5if', u'if': u'p1'}], u'default_route_ip': u'10.1.41.1', u'bridge_name': u't5br1', u'ns_name': u't5ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.41.2/24', u'tenant_ns_ip': u'10.1.41.1/24', u'tenant_ns_if': u't5ns1if', u'tenant_sub_if': u't5s1if', u'tenant_ns_name': u't5'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't5_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't5br1if1', u'vmif': u't5VM1if1'}, {u'mem': 4, u'name': u't5_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't5br1if2', u'vmif': u't5VM2if1'}], u'vxlan': [{u'local_ip': u'10.1.41.2', u'dsport': 4789, u'dev': u't5s1if', u'tenant_route_ip': u'192.168.5.2', u'remote_route': u'10.2.41.0/24', u'subnet_route': u'10.1.41.0/24', u'v_name': u'vxlan_t5s1', u'id': 42, u'remote_ip': u'10.2.41.2'}]}, {u'dnsif': u't5s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't5s1_dnsbrif'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t5ns1\" ps aux | grep -w '[d]nsmasq --interface t5s1_dnsif -z --dhcp-range=1.1.1.5,1.1.1.254' ; if [ $? -ne 0 ] ; then ip netns exec \"t5ns1\" dnsmasq --interface \"t5s1_dnsif\" -z --dhcp-range=1.1.1.5,'1.1.1.254' ; fi\n", "delta": "0:00:00.057001", "end": "2019-12-05 20:52:42.626909", "item": [{"bridge_name": "t5br1", "default_route_ip": "10.1.41.1", "ns_name": "t5ns1", "route": [{"if": "p1", "ip": "10.1.41.1/24", "ns_if": "t5if", "ns_name": "t5"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t5ns1if", "tenant_ns_ip": "10.1.41.1/24", "tenant_ns_name": "t5", "tenant_sub_if": "t5s1if", "tenant_sub_ip": "10.1.41.2/24"}], "vms": [{"brif": "t5br1if1", "disk": "10G", "mem": 2, "name": "t5_VM1", "vcpu": 4, "vmif": "t5VM1if1"}, {"brif": "t5br1if2", "disk": "10G", "mem": 4, "name": "t5_VM2", "vcpu": 2, "vmif": "t5VM2if1"}], "vxlan": [{"dev": "t5s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.41.2", "remote_ip": "10.2.41.2", "remote_route": "10.2.41.0/24", "subnet_route": "10.1.41.0/24", "tenant_route_ip": "192.168.5.2", "v_name": "vxlan_t5s1"}]}, {"brif": "t5s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.5", "dnsif": "t5s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "rc": 0, "start": "2019-12-05 20:52:42.569908", "stderr": "", "stderr_lines": [], "stdout": "nobody    7459  0.0  0.0  51580  2528 ?        S    20:39   0:00 dnsmasq --interface t5s1_dnsif -z --dhcp-range=1.1.1.5,1.1.1.254", "stdout_lines": ["nobody    7459  0.0  0.0  51580  2528 ?        S    20:39   0:00 dnsmasq --interface t5s1_dnsif -z --dhcp-range=1.1.1.5,1.1.1.254"]}
skipping: [localhost] => (item=[{u'route': [{u'ip': u'10.1.42.1/24', u'ns_name': u't5', u'ns_if': u't5if', u'if': u'p1'}], u'default_route_ip': u'10.1.42.1', u'bridge_name': u't5br2', u'ns_name': u't5ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.42.2/24', u'tenant_ns_ip': u'10.1.42.1/24', u'tenant_ns_if': u't5ns2if', u'tenant_sub_if': u't5s2if', u'tenant_ns_name': u't5'}], u'subnet_ip': u'2.2.2.0/24', u'vms': [{u'mem': [], u'name': u'JOKER', u'vcpu': [], u'disk': [], u'brif': [], u'vmif': []}], u'vxlan': [{u'local_ip': u'10.1.42.2', u'dsport': 4789, u'dev': u't5s2if', u'tenant_route_ip': u'192.168.5.2', u'remote_route': u'10.2.42.0/24', u'subnet_route': u'10.1.42.0/24', u'v_name': u'vxlan_t5s2', u'id': 42, u'remote_ip': u'10.2.42.2'}]}, {u'dnsif': [], u'dhcp_start': [], u'dhcp_end': [], u'dnsif_ip': [], u'net_mask': [], u'brif': []}])  => {"ansible_loop_var": "item", "changed": false, "item": [{"bridge_name": "t5br2", "default_route_ip": "10.1.42.1", "ns_name": "t5ns2", "route": [{"if": "p1", "ip": "10.1.42.1/24", "ns_if": "t5if", "ns_name": "t5"}], "subnet_ip": "2.2.2.0/24", "tenant_ns": [{"tenant_ns_if": "t5ns2if", "tenant_ns_ip": "10.1.42.1/24", "tenant_ns_name": "t5", "tenant_sub_if": "t5s2if", "tenant_sub_ip": "10.1.42.2/24"}], "vms": [{"brif": [], "disk": [], "mem": [], "name": "JOKER", "vcpu": [], "vmif": []}], "vxlan": [{"dev": "t5s2if", "dsport": 4789, "id": 42, "local_ip": "10.1.42.2", "remote_ip": "10.2.42.2", "remote_route": "10.2.42.0/24", "subnet_route": "10.1.42.0/24", "tenant_route_ip": "192.168.5.2", "v_name": "vxlan_t5s2"}]}, {"brif": [], "dhcp_end": [], "dhcp_start": [], "dnsif": [], "dnsif_ip": [], "net_mask": []}], "skip_reason": "Conditional result was False"}

TASK [Create VXLAN devices] *********************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.41.1/24', u'ns_name': u't5', u'ns_if': u't5if', u'if': u'p1'}], u'default_route_ip': u'10.1.41.1', u'bridge_name': u't5br1', u'dns': [{u'dnsif': u't5s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't5s1_dnsbrif'}], u'ns_name': u't5ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.41.2/24', u'tenant_ns_ip': u'10.1.41.1/24', u'tenant_ns_if': u't5ns1if', u'tenant_sub_if': u't5s1if', u'tenant_ns_name': u't5'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't5_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't5br1if1', u'vmif': u't5VM1if1'}, {u'mem': 4, u'name': u't5_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't5br1if2', u'vmif': u't5VM2if1'}]}, {u'local_ip': u'10.1.41.2', u'dsport': 4789, u'dev': u't5s1if', u'tenant_route_ip': u'192.168.5.2', u'remote_route': u'10.2.41.0/24', u'subnet_route': u'10.1.41.0/24', u'v_name': u'vxlan_t5s1', u'id': 42, u'remote_ip': u'10.2.41.2'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t5ns1\" ip link show \"vxlan_t5s1\" ; if [ $? -ne 0 ] ; then ip netns exec \"t5ns1\" ip link add \"vxlan_t5s1\" type vxlan id \"42\" local \"10.1.41.2\" remote \"10.2.41.2\" dstport \"4789\" dev \"t5s1if\"; ip netns exec \"t5ns1\" ip link set dev \"vxlan_t5s1\" up ; fi\n", "delta": "0:00:00.050792", "end": "2019-12-05 20:52:43.035115", "item": [{"bridge_name": "t5br1", "default_route_ip": "10.1.41.1", "dns": [{"brif": "t5s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.5", "dnsif": "t5s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t5ns1", "route": [{"if": "p1", "ip": "10.1.41.1/24", "ns_if": "t5if", "ns_name": "t5"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t5ns1if", "tenant_ns_ip": "10.1.41.1/24", "tenant_ns_name": "t5", "tenant_sub_if": "t5s1if", "tenant_sub_ip": "10.1.41.2/24"}], "vms": [{"brif": "t5br1if1", "disk": "10G", "mem": 2, "name": "t5_VM1", "vcpu": 4, "vmif": "t5VM1if1"}, {"brif": "t5br1if2", "disk": "10G", "mem": 4, "name": "t5_VM2", "vcpu": 2, "vmif": "t5VM2if1"}]}, {"dev": "t5s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.41.2", "remote_ip": "10.2.41.2", "remote_route": "10.2.41.0/24", "subnet_route": "10.1.41.0/24", "tenant_route_ip": "192.168.5.2", "v_name": "vxlan_t5s1"}], "rc": 0, "start": "2019-12-05 20:52:42.984323", "stderr": "", "stderr_lines": [], "stdout": "5: vxlan_t5s1: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1450 qdisc noqueue master t5br1 state UNKNOWN mode DEFAULT group default qlen 1000\n    link/ether e6:72:a6:4b:2f:54 brd ff:ff:ff:ff:ff:ff", "stdout_lines": ["5: vxlan_t5s1: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1450 qdisc noqueue master t5br1 state UNKNOWN mode DEFAULT group default qlen 1000", "    link/ether e6:72:a6:4b:2f:54 brd ff:ff:ff:ff:ff:ff"]}
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.42.1/24', u'ns_name': u't5', u'ns_if': u't5if', u'if': u'p1'}], u'default_route_ip': u'10.1.42.1', u'bridge_name': u't5br2', u'dns': [{u'dnsif': [], u'dhcp_start': [], u'dhcp_end': [], u'dnsif_ip': [], u'net_mask': [], u'brif': []}], u'ns_name': u't5ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.42.2/24', u'tenant_ns_ip': u'10.1.42.1/24', u'tenant_ns_if': u't5ns2if', u'tenant_sub_if': u't5s2if', u'tenant_ns_name': u't5'}], u'subnet_ip': u'2.2.2.0/24', u'vms': [{u'mem': [], u'name': u'JOKER', u'vcpu': [], u'disk': [], u'brif': [], u'vmif': []}]}, {u'local_ip': u'10.1.42.2', u'dsport': 4789, u'dev': u't5s2if', u'tenant_route_ip': u'192.168.5.2', u'remote_route': u'10.2.42.0/24', u'subnet_route': u'10.1.42.0/24', u'v_name': u'vxlan_t5s2', u'id': 42, u'remote_ip': u'10.2.42.2'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t5ns2\" ip link show \"vxlan_t5s2\" ; if [ $? -ne 0 ] ; then ip netns exec \"t5ns2\" ip link add \"vxlan_t5s2\" type vxlan id \"42\" local \"10.1.42.2\" remote \"10.2.42.2\" dstport \"4789\" dev \"t5s2if\"; ip netns exec \"t5ns2\" ip link set dev \"vxlan_t5s2\" up ; fi\n", "delta": "0:00:00.049644", "end": "2019-12-05 20:52:43.366867", "item": [{"bridge_name": "t5br2", "default_route_ip": "10.1.42.1", "dns": [{"brif": [], "dhcp_end": [], "dhcp_start": [], "dnsif": [], "dnsif_ip": [], "net_mask": []}], "ns_name": "t5ns2", "route": [{"if": "p1", "ip": "10.1.42.1/24", "ns_if": "t5if", "ns_name": "t5"}], "subnet_ip": "2.2.2.0/24", "tenant_ns": [{"tenant_ns_if": "t5ns2if", "tenant_ns_ip": "10.1.42.1/24", "tenant_ns_name": "t5", "tenant_sub_if": "t5s2if", "tenant_sub_ip": "10.1.42.2/24"}], "vms": [{"brif": [], "disk": [], "mem": [], "name": "JOKER", "vcpu": [], "vmif": []}]}, {"dev": "t5s2if", "dsport": 4789, "id": 42, "local_ip": "10.1.42.2", "remote_ip": "10.2.42.2", "remote_route": "10.2.42.0/24", "subnet_route": "10.1.42.0/24", "tenant_route_ip": "192.168.5.2", "v_name": "vxlan_t5s2"}], "rc": 0, "start": "2019-12-05 20:52:43.317223", "stderr": "", "stderr_lines": [], "stdout": "3: vxlan_t5s2: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1450 qdisc noqueue master t5br2 state UNKNOWN mode DEFAULT group default qlen 1000\n    link/ether 5e:8c:98:90:78:2f brd ff:ff:ff:ff:ff:ff", "stdout_lines": ["3: vxlan_t5s2: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1450 qdisc noqueue master t5br2 state UNKNOWN mode DEFAULT group default qlen 1000", "    link/ether 5e:8c:98:90:78:2f brd ff:ff:ff:ff:ff:ff"]}

TASK [Attach VXLANs to bridge] ******************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.41.1/24', u'ns_name': u't5', u'ns_if': u't5if', u'if': u'p1'}], u'default_route_ip': u'10.1.41.1', u'bridge_name': u't5br1', u'dns': [{u'dnsif': u't5s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't5s1_dnsbrif'}], u'ns_name': u't5ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.41.2/24', u'tenant_ns_ip': u'10.1.41.1/24', u'tenant_ns_if': u't5ns1if', u'tenant_sub_if': u't5s1if', u'tenant_ns_name': u't5'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't5_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't5br1if1', u'vmif': u't5VM1if1'}, {u'mem': 4, u'name': u't5_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't5br1if2', u'vmif': u't5VM2if1'}]}, {u'local_ip': u'10.1.41.2', u'dsport': 4789, u'dev': u't5s1if', u'tenant_route_ip': u'192.168.5.2', u'remote_route': u'10.2.41.0/24', u'subnet_route': u'10.1.41.0/24', u'v_name': u'vxlan_t5s1', u'id': 42, u'remote_ip': u'10.2.41.2'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t5ns1\" brctl show \"t5br1\" | grep -w 'vxlan_t5s1' ; if [ $? -ne 0 ] ; then ip netns exec \"t5ns1\" brctl addif \"t5br1\" \"vxlan_t5s1\" ; fi\n", "delta": "0:00:00.036948", "end": "2019-12-05 20:52:43.694772", "item": [{"bridge_name": "t5br1", "default_route_ip": "10.1.41.1", "dns": [{"brif": "t5s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.5", "dnsif": "t5s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t5ns1", "route": [{"if": "p1", "ip": "10.1.41.1/24", "ns_if": "t5if", "ns_name": "t5"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t5ns1if", "tenant_ns_ip": "10.1.41.1/24", "tenant_ns_name": "t5", "tenant_sub_if": "t5s1if", "tenant_sub_ip": "10.1.41.2/24"}], "vms": [{"brif": "t5br1if1", "disk": "10G", "mem": 2, "name": "t5_VM1", "vcpu": 4, "vmif": "t5VM1if1"}, {"brif": "t5br1if2", "disk": "10G", "mem": 4, "name": "t5_VM2", "vcpu": 2, "vmif": "t5VM2if1"}]}, {"dev": "t5s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.41.2", "remote_ip": "10.2.41.2", "remote_route": "10.2.41.0/24", "subnet_route": "10.1.41.0/24", "tenant_route_ip": "192.168.5.2", "v_name": "vxlan_t5s1"}], "rc": 0, "start": "2019-12-05 20:52:43.657824", "stderr": "", "stderr_lines": [], "stdout": "\t\t\t\t\t\t\tvxlan_t5s1", "stdout_lines": ["\t\t\t\t\t\t\tvxlan_t5s1"]}
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.42.1/24', u'ns_name': u't5', u'ns_if': u't5if', u'if': u'p1'}], u'default_route_ip': u'10.1.42.1', u'bridge_name': u't5br2', u'dns': [{u'dnsif': [], u'dhcp_start': [], u'dhcp_end': [], u'dnsif_ip': [], u'net_mask': [], u'brif': []}], u'ns_name': u't5ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.42.2/24', u'tenant_ns_ip': u'10.1.42.1/24', u'tenant_ns_if': u't5ns2if', u'tenant_sub_if': u't5s2if', u'tenant_ns_name': u't5'}], u'subnet_ip': u'2.2.2.0/24', u'vms': [{u'mem': [], u'name': u'JOKER', u'vcpu': [], u'disk': [], u'brif': [], u'vmif': []}]}, {u'local_ip': u'10.1.42.2', u'dsport': 4789, u'dev': u't5s2if', u'tenant_route_ip': u'192.168.5.2', u'remote_route': u'10.2.42.0/24', u'subnet_route': u'10.1.42.0/24', u'v_name': u'vxlan_t5s2', u'id': 42, u'remote_ip': u'10.2.42.2'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t5ns2\" brctl show \"t5br2\" | grep -w 'vxlan_t5s2' ; if [ $? -ne 0 ] ; then ip netns exec \"t5ns2\" brctl addif \"t5br2\" \"vxlan_t5s2\" ; fi\n", "delta": "0:00:00.040632", "end": "2019-12-05 20:52:43.955016", "item": [{"bridge_name": "t5br2", "default_route_ip": "10.1.42.1", "dns": [{"brif": [], "dhcp_end": [], "dhcp_start": [], "dnsif": [], "dnsif_ip": [], "net_mask": []}], "ns_name": "t5ns2", "route": [{"if": "p1", "ip": "10.1.42.1/24", "ns_if": "t5if", "ns_name": "t5"}], "subnet_ip": "2.2.2.0/24", "tenant_ns": [{"tenant_ns_if": "t5ns2if", "tenant_ns_ip": "10.1.42.1/24", "tenant_ns_name": "t5", "tenant_sub_if": "t5s2if", "tenant_sub_ip": "10.1.42.2/24"}], "vms": [{"brif": [], "disk": [], "mem": [], "name": "JOKER", "vcpu": [], "vmif": []}]}, {"dev": "t5s2if", "dsport": 4789, "id": 42, "local_ip": "10.1.42.2", "remote_ip": "10.2.42.2", "remote_route": "10.2.42.0/24", "subnet_route": "10.1.42.0/24", "tenant_route_ip": "192.168.5.2", "v_name": "vxlan_t5s2"}], "rc": 0, "start": "2019-12-05 20:52:43.914384", "stderr": "", "stderr_lines": [], "stdout": "t5br2\t\t8000.5e8c9890782f\tno\t\tvxlan_t5s2", "stdout_lines": ["t5br2\t\t8000.5e8c9890782f\tno\t\tvxlan_t5s2"]}

PLAY RECAP **************************************************************************************************************************************************
localhost                  : ok=21   changed=19   unreachable=0    failed=0    skipped=0    rescued=0    ignored=0   

Using /etc/ansible/ansible.cfg as config file

PLAY [worker] ***********************************************************************************************************************************************

TASK [Create Tenant Namespace] ******************************************************************************************************************************
ok: [99.99.99.2] => (item={u'default_route_ip': u'192.168.133.1', u'name': u't5', u'pns_ip': u'192.168.133.1/24', u'tenant_if': u't5if', u'tenant_ip': u'192.168.133.2/24', u'pns_if': u't5pns_if'}) => {"ansible_loop_var": "item", "changed": false, "cmd": ["ip", "netns", "add", "t5"], "item": {"default_route_ip": "192.168.133.1", "name": "t5", "pns_if": "t5pns_if", "pns_ip": "192.168.133.1/24", "tenant_if": "t5if", "tenant_ip": "192.168.133.2/24"}, "rc": 0, "stdout": "skipped, since /var/run/netns/t5 exists", "stdout_lines": ["skipped, since /var/run/netns/t5 exists"]}

TASK [Create Subnet Namespace] ******************************************************************************************************************************
ok: [99.99.99.2] => (item={u'route': [{u'ip': u'10.2.41.1/24', u'ns_name': u't5', u'ns_if': u't5if', u'if': u'p1'}], u'default_route_ip': u'10.2.41.1', u'bridge_name': u't5br1', u'dns': [{u'dnsif': u't5s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't5s1_dnsbrif'}], u'ns_name': u't5ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.41.2/24', u'tenant_ns_ip': u'10.2.41.1/24', u'tenant_ns_if': u't5ns1if', u'tenant_ns_name': u't5', u'tenant_sub_if': u't5s1if'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't5_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't5br1if1', u'vmif': u't5VM4if1'}], u'vxlan': [{u'local_ip': u'10.2.41.2', u'tenant_route_ip': u'192.168.133.2', u'dsport': 4789, u'dev': u't5s1if', u'subnet_route': u'10.2.41.0/24', u'remote_route': u'10.1.41.0/24', u'v_name': u'vxlan_t5s1', u'id': 42, u'remote_ip': u'10.1.41.2'}]}) => {"ansible_loop_var": "item", "changed": false, "cmd": ["ip", "netns", "add", "t5ns1"], "item": {"bridge_name": "t5br1", "default_route_ip": "10.2.41.1", "dns": [{"brif": "t5s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.5", "dnsif": "t5s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t5ns1", "route": [{"if": "p1", "ip": "10.2.41.1/24", "ns_if": "t5if", "ns_name": "t5"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t5ns1if", "tenant_ns_ip": "10.2.41.1/24", "tenant_ns_name": "t5", "tenant_sub_if": "t5s1if", "tenant_sub_ip": "10.2.41.2/24"}], "vms": [{"brif": "t5br1if1", "disk": "10G", "mem": 2, "name": "t5_VM4", "vcpu": 4, "vmif": "t5VM4if1"}], "vxlan": [{"dev": "t5s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.41.2", "remote_ip": "10.1.41.2", "remote_route": "10.1.41.0/24", "subnet_route": "10.2.41.0/24", "tenant_route_ip": "192.168.133.2", "v_name": "vxlan_t5s1"}]}, "rc": 0, "stdout": "skipped, since /var/run/netns/t5ns1 exists", "stdout_lines": ["skipped, since /var/run/netns/t5ns1 exists"]}
ok: [99.99.99.2] => (item={u'route': [{u'ip': u'10.2.42.1/24', u'ns_name': u't5', u'ns_if': u't5if', u'if': u'p1'}], u'default_route_ip': u'10.2.42.1', u'bridge_name': u't5br2', u'dns': [{u'dnsif': u't5s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't5s2_dnsbrif'}], u'ns_name': u't5ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.42.2/24', u'tenant_ns_ip': u'10.2.42.1/24', u'tenant_ns_if': u't5ns2if', u'tenant_ns_name': u't5', u'tenant_sub_if': u't5s2if'}], u'subnet_ip': u'2.2.2.0/24', u'vms': [{u'mem': 3, u'name': u't5_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't5br2if1', u'vmif': u't5VM3if1'}], u'vxlan': [{u'local_ip': u'10.2.42.2', u'tenant_route_ip': u'192.168.133.2', u'dsport': 4789, u'dev': u't5s2if', u'subnet_route': u'10.2.42.0/24', u'remote_route': u'10.1.42.0/24', u'v_name': u'vxlan_t5s2', u'id': 42, u'remote_ip': u'10.1.42.2'}]}) => {"ansible_loop_var": "item", "changed": false, "cmd": ["ip", "netns", "add", "t5ns2"], "item": {"bridge_name": "t5br2", "default_route_ip": "10.2.42.1", "dns": [{"brif": "t5s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t5s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t5ns2", "route": [{"if": "p1", "ip": "10.2.42.1/24", "ns_if": "t5if", "ns_name": "t5"}], "subnet_ip": "2.2.2.0/24", "tenant_ns": [{"tenant_ns_if": "t5ns2if", "tenant_ns_ip": "10.2.42.1/24", "tenant_ns_name": "t5", "tenant_sub_if": "t5s2if", "tenant_sub_ip": "10.2.42.2/24"}], "vms": [{"brif": "t5br2if1", "disk": "10G", "mem": 3, "name": "t5_VM3", "vcpu": 2, "vmif": "t5VM3if1"}], "vxlan": [{"dev": "t5s2if", "dsport": 4789, "id": 42, "local_ip": "10.2.42.2", "remote_ip": "10.1.42.2", "remote_route": "10.1.42.0/24", "subnet_route": "10.2.42.0/24", "tenant_route_ip": "192.168.133.2", "v_name": "vxlan_t5s2"}]}, "rc": 0, "stdout": "skipped, since /var/run/netns/t5ns2 exists", "stdout_lines": ["skipped, since /var/run/netns/t5ns2 exists"]}

TASK [Create Tenant VETH pairs] *****************************************************************************************************************************
changed: [99.99.99.2] => (item={u'default_route_ip': u'192.168.133.1', u'name': u't5', u'pns_ip': u'192.168.133.1/24', u'tenant_if': u't5if', u'tenant_ip': u'192.168.133.2/24', u'pns_if': u't5pns_if'}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t5\" ip link show \"t5if\" ; if [ $? -ne 0 ] ; then ip link add \"t5if\" type veth peer name \"t5pns_if\" ; fi\n", "delta": "0:00:00.040143", "end": "2019-12-05 20:52:47.154500", "item": {"default_route_ip": "192.168.133.1", "name": "t5", "pns_if": "t5pns_if", "pns_ip": "192.168.133.1/24", "tenant_if": "t5if", "tenant_ip": "192.168.133.2/24"}, "rc": 0, "start": "2019-12-05 20:52:47.114357", "stderr": "", "stderr_lines": [], "stdout": "52: t5if@if51: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP mode DEFAULT group default qlen 1000\n    link/ether ee:44:1a:04:ea:c1 brd ff:ff:ff:ff:ff:ff link-netnsid 0", "stdout_lines": ["52: t5if@if51: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP mode DEFAULT group default qlen 1000", "    link/ether ee:44:1a:04:ea:c1 brd ff:ff:ff:ff:ff:ff link-netnsid 0"]}

TASK [Attach Tenant VETH Pairs] *****************************************************************************************************************************
changed: [99.99.99.2] => (item={u'default_route_ip': u'192.168.133.1', u'name': u't5', u'pns_ip': u'192.168.133.1/24', u'tenant_if': u't5if', u'tenant_ip': u'192.168.133.2/24', u'pns_if': u't5pns_if'}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec pns ip link show \"t5pns_if\" ; if [ $? -ne 0 ] ; then ip link set \"t5pns_if\" netns pns ; fi\nip netns exec \"t5\" ip link show \"t5if\" ; if [ $? -ne 0 ] ; then ip link set \"t5if\" netns \"t5\" ; fi\nip netns exec pns ip link set dev \"t5pns_if\" up\nip netns exec \"t5\" ip link set dev \"t5if\" up\n", "delta": "0:00:00.147015", "end": "2019-12-05 20:52:47.714760", "item": {"default_route_ip": "192.168.133.1", "name": "t5", "pns_if": "t5pns_if", "pns_ip": "192.168.133.1/24", "tenant_if": "t5if", "tenant_ip": "192.168.133.2/24"}, "rc": 0, "start": "2019-12-05 20:52:47.567745", "stderr": "", "stderr_lines": [], "stdout": "51: t5pns_if@if52: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP mode DEFAULT group default qlen 1000\n    link/ether 0a:ba:42:33:b2:24 brd ff:ff:ff:ff:ff:ff link-netnsid 3\n52: t5if@if51: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP mode DEFAULT group default qlen 1000\n    link/ether ee:44:1a:04:ea:c1 brd ff:ff:ff:ff:ff:ff link-netnsid 0", "stdout_lines": ["51: t5pns_if@if52: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP mode DEFAULT group default qlen 1000", "    link/ether 0a:ba:42:33:b2:24 brd ff:ff:ff:ff:ff:ff link-netnsid 3", "52: t5if@if51: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP mode DEFAULT group default qlen 1000", "    link/ether ee:44:1a:04:ea:c1 brd ff:ff:ff:ff:ff:ff link-netnsid 0"]}

TASK [Add IP addresses to Tenant VETH Pairs] ****************************************************************************************************************
changed: [99.99.99.2] => (item={u'default_route_ip': u'192.168.133.1', u'name': u't5', u'pns_ip': u'192.168.133.1/24', u'tenant_if': u't5if', u'tenant_ip': u'192.168.133.2/24', u'pns_if': u't5pns_if'}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec pns ip addr show \"t5pns_if\" | awk 'FNR==3{ print $2 }' | grep -w '^192.168.133.1/24' ; if [ $? -ne 0 ] ; then ip netns exec pns ip addr add \"192.168.133.1/24\" dev \"t5pns_if\" ; fi\nip netns exec \"t5\" ip addr show \"t5if\" | awk 'FNR==3{ print $2 }' | grep -w '^192.168.133.2/24' ; if [ $? -ne 0 ] ; then ip netns exec \"t5\" ip addr add \"192.168.133.2/24\" dev \"t5if\" ; fi\n", "delta": "0:00:00.075230", "end": "2019-12-05 20:52:48.186848", "item": {"default_route_ip": "192.168.133.1", "name": "t5", "pns_if": "t5pns_if", "pns_ip": "192.168.133.1/24", "tenant_if": "t5if", "tenant_ip": "192.168.133.2/24"}, "rc": 0, "start": "2019-12-05 20:52:48.111618", "stderr": "", "stderr_lines": [], "stdout": "192.168.133.1/24\n192.168.133.2/24", "stdout_lines": ["192.168.133.1/24", "192.168.133.2/24"]}

TASK [Create Namespace VETH Pairs] **************************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.41.1/24', u'ns_name': u't5', u'ns_if': u't5if', u'if': u'p1'}], u'default_route_ip': u'10.2.41.1', u'bridge_name': u't5br1', u'dns': [{u'dnsif': u't5s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't5s1_dnsbrif'}], u'ns_name': u't5ns1', u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't5_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't5br1if1', u'vmif': u't5VM4if1'}], u'vxlan': [{u'local_ip': u'10.2.41.2', u'dsport': 4789, u'dev': u't5s1if', u'tenant_route_ip': u'192.168.133.2', u'remote_route': u'10.1.41.0/24', u'subnet_route': u'10.2.41.0/24', u'v_name': u'vxlan_t5s1', u'id': 42, u'remote_ip': u'10.1.41.2'}]}, {u'tenant_sub_ip': u'10.2.41.2/24', u'tenant_ns_ip': u'10.2.41.1/24', u'tenant_ns_if': u't5ns1if', u'tenant_sub_if': u't5s1if', u'tenant_ns_name': u't5'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t5\" ip link show \"t5ns1if\" ; if [ $? -ne 0 ] ; then ip link add \"t5ns1if\" type veth peer name \"t5s1if\" ; fi\n", "delta": "0:00:00.055820", "end": "2019-12-05 20:52:48.634555", "item": [{"bridge_name": "t5br1", "default_route_ip": "10.2.41.1", "dns": [{"brif": "t5s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.5", "dnsif": "t5s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t5ns1", "route": [{"if": "p1", "ip": "10.2.41.1/24", "ns_if": "t5if", "ns_name": "t5"}], "subnet_ip": "1.1.1.0/24", "vms": [{"brif": "t5br1if1", "disk": "10G", "mem": 2, "name": "t5_VM4", "vcpu": 4, "vmif": "t5VM4if1"}], "vxlan": [{"dev": "t5s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.41.2", "remote_ip": "10.1.41.2", "remote_route": "10.1.41.0/24", "subnet_route": "10.2.41.0/24", "tenant_route_ip": "192.168.133.2", "v_name": "vxlan_t5s1"}]}, {"tenant_ns_if": "t5ns1if", "tenant_ns_ip": "10.2.41.1/24", "tenant_ns_name": "t5", "tenant_sub_if": "t5s1if", "tenant_sub_ip": "10.2.41.2/24"}], "rc": 0, "start": "2019-12-05 20:52:48.578735", "stderr": "", "stderr_lines": [], "stdout": "54: t5ns1if@if53: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP mode DEFAULT group default qlen 1000\n    link/ether fa:4e:57:10:ff:a3 brd ff:ff:ff:ff:ff:ff link-netnsid 2", "stdout_lines": ["54: t5ns1if@if53: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP mode DEFAULT group default qlen 1000", "    link/ether fa:4e:57:10:ff:a3 brd ff:ff:ff:ff:ff:ff link-netnsid 2"]}
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.42.1/24', u'ns_name': u't5', u'ns_if': u't5if', u'if': u'p1'}], u'default_route_ip': u'10.2.42.1', u'bridge_name': u't5br2', u'dns': [{u'dnsif': u't5s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't5s2_dnsbrif'}], u'ns_name': u't5ns2', u'subnet_ip': u'2.2.2.0/24', u'vms': [{u'mem': 3, u'name': u't5_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't5br2if1', u'vmif': u't5VM3if1'}], u'vxlan': [{u'local_ip': u'10.2.42.2', u'dsport': 4789, u'dev': u't5s2if', u'tenant_route_ip': u'192.168.133.2', u'remote_route': u'10.1.42.0/24', u'subnet_route': u'10.2.42.0/24', u'v_name': u'vxlan_t5s2', u'id': 42, u'remote_ip': u'10.1.42.2'}]}, {u'tenant_sub_ip': u'10.2.42.2/24', u'tenant_ns_ip': u'10.2.42.1/24', u'tenant_ns_if': u't5ns2if', u'tenant_sub_if': u't5s2if', u'tenant_ns_name': u't5'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t5\" ip link show \"t5ns2if\" ; if [ $? -ne 0 ] ; then ip link add \"t5ns2if\" type veth peer name \"t5s2if\" ; fi\n", "delta": "0:00:00.032492", "end": "2019-12-05 20:52:49.006807", "item": [{"bridge_name": "t5br2", "default_route_ip": "10.2.42.1", "dns": [{"brif": "t5s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t5s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t5ns2", "route": [{"if": "p1", "ip": "10.2.42.1/24", "ns_if": "t5if", "ns_name": "t5"}], "subnet_ip": "2.2.2.0/24", "vms": [{"brif": "t5br2if1", "disk": "10G", "mem": 3, "name": "t5_VM3", "vcpu": 2, "vmif": "t5VM3if1"}], "vxlan": [{"dev": "t5s2if", "dsport": 4789, "id": 42, "local_ip": "10.2.42.2", "remote_ip": "10.1.42.2", "remote_route": "10.1.42.0/24", "subnet_route": "10.2.42.0/24", "tenant_route_ip": "192.168.133.2", "v_name": "vxlan_t5s2"}]}, {"tenant_ns_if": "t5ns2if", "tenant_ns_ip": "10.2.42.1/24", "tenant_ns_name": "t5", "tenant_sub_if": "t5s2if", "tenant_sub_ip": "10.2.42.2/24"}], "rc": 0, "start": "2019-12-05 20:52:48.974315", "stderr": "", "stderr_lines": [], "stdout": "56: t5ns2if@if55: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP mode DEFAULT group default qlen 1000\n    link/ether 12:4e:53:b9:39:99 brd ff:ff:ff:ff:ff:ff link-netnsid 3", "stdout_lines": ["56: t5ns2if@if55: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP mode DEFAULT group default qlen 1000", "    link/ether 12:4e:53:b9:39:99 brd ff:ff:ff:ff:ff:ff link-netnsid 3"]}

TASK [Attach Namespace VETH Pairs] **************************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.41.1/24', u'ns_name': u't5', u'ns_if': u't5if', u'if': u'p1'}], u'default_route_ip': u'10.2.41.1', u'bridge_name': u't5br1', u'dns': [{u'dnsif': u't5s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't5s1_dnsbrif'}], u'ns_name': u't5ns1', u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't5_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't5br1if1', u'vmif': u't5VM4if1'}], u'vxlan': [{u'local_ip': u'10.2.41.2', u'dsport': 4789, u'dev': u't5s1if', u'tenant_route_ip': u'192.168.133.2', u'remote_route': u'10.1.41.0/24', u'subnet_route': u'10.2.41.0/24', u'v_name': u'vxlan_t5s1', u'id': 42, u'remote_ip': u'10.1.41.2'}]}, {u'tenant_sub_ip': u'10.2.41.2/24', u'tenant_ns_ip': u'10.2.41.1/24', u'tenant_ns_if': u't5ns1if', u'tenant_sub_if': u't5s1if', u'tenant_ns_name': u't5'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t5\" ip link show \"t5ns1if\" ; if [ $? -ne 0 ] ; then ip link set \"t5ns1if\" netns \"t5\" ; fi\nip netns exec \"t5ns1\" ip link show \"t5s1if\" ; if [ $? -ne 0 ] ; then ip link set \"t5s1if\" netns \"t5ns1\" ; fi\n", "delta": "0:00:00.084925", "end": "2019-12-05 20:52:49.494655", "item": [{"bridge_name": "t5br1", "default_route_ip": "10.2.41.1", "dns": [{"brif": "t5s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.5", "dnsif": "t5s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t5ns1", "route": [{"if": "p1", "ip": "10.2.41.1/24", "ns_if": "t5if", "ns_name": "t5"}], "subnet_ip": "1.1.1.0/24", "vms": [{"brif": "t5br1if1", "disk": "10G", "mem": 2, "name": "t5_VM4", "vcpu": 4, "vmif": "t5VM4if1"}], "vxlan": [{"dev": "t5s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.41.2", "remote_ip": "10.1.41.2", "remote_route": "10.1.41.0/24", "subnet_route": "10.2.41.0/24", "tenant_route_ip": "192.168.133.2", "v_name": "vxlan_t5s1"}]}, {"tenant_ns_if": "t5ns1if", "tenant_ns_ip": "10.2.41.1/24", "tenant_ns_name": "t5", "tenant_sub_if": "t5s1if", "tenant_sub_ip": "10.2.41.2/24"}], "rc": 0, "start": "2019-12-05 20:52:49.409730", "stderr": "", "stderr_lines": [], "stdout": "54: t5ns1if@if53: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP mode DEFAULT group default qlen 1000\n    link/ether fa:4e:57:10:ff:a3 brd ff:ff:ff:ff:ff:ff link-netnsid 2\n53: t5s1if@if54: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP mode DEFAULT group default qlen 1000\n    link/ether 32:69:8e:34:8b:ec brd ff:ff:ff:ff:ff:ff link-netnsid 0", "stdout_lines": ["54: t5ns1if@if53: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP mode DEFAULT group default qlen 1000", "    link/ether fa:4e:57:10:ff:a3 brd ff:ff:ff:ff:ff:ff link-netnsid 2", "53: t5s1if@if54: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP mode DEFAULT group default qlen 1000", "    link/ether 32:69:8e:34:8b:ec brd ff:ff:ff:ff:ff:ff link-netnsid 0"]}
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.42.1/24', u'ns_name': u't5', u'ns_if': u't5if', u'if': u'p1'}], u'default_route_ip': u'10.2.42.1', u'bridge_name': u't5br2', u'dns': [{u'dnsif': u't5s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't5s2_dnsbrif'}], u'ns_name': u't5ns2', u'subnet_ip': u'2.2.2.0/24', u'vms': [{u'mem': 3, u'name': u't5_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't5br2if1', u'vmif': u't5VM3if1'}], u'vxlan': [{u'local_ip': u'10.2.42.2', u'dsport': 4789, u'dev': u't5s2if', u'tenant_route_ip': u'192.168.133.2', u'remote_route': u'10.1.42.0/24', u'subnet_route': u'10.2.42.0/24', u'v_name': u'vxlan_t5s2', u'id': 42, u'remote_ip': u'10.1.42.2'}]}, {u'tenant_sub_ip': u'10.2.42.2/24', u'tenant_ns_ip': u'10.2.42.1/24', u'tenant_ns_if': u't5ns2if', u'tenant_sub_if': u't5s2if', u'tenant_ns_name': u't5'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t5\" ip link show \"t5ns2if\" ; if [ $? -ne 0 ] ; then ip link set \"t5ns2if\" netns \"t5\" ; fi\nip netns exec \"t5ns2\" ip link show \"t5s2if\" ; if [ $? -ne 0 ] ; then ip link set \"t5s2if\" netns \"t5ns2\" ; fi\n", "delta": "0:00:00.103308", "end": "2019-12-05 20:52:49.942747", "item": [{"bridge_name": "t5br2", "default_route_ip": "10.2.42.1", "dns": [{"brif": "t5s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t5s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t5ns2", "route": [{"if": "p1", "ip": "10.2.42.1/24", "ns_if": "t5if", "ns_name": "t5"}], "subnet_ip": "2.2.2.0/24", "vms": [{"brif": "t5br2if1", "disk": "10G", "mem": 3, "name": "t5_VM3", "vcpu": 2, "vmif": "t5VM3if1"}], "vxlan": [{"dev": "t5s2if", "dsport": 4789, "id": 42, "local_ip": "10.2.42.2", "remote_ip": "10.1.42.2", "remote_route": "10.1.42.0/24", "subnet_route": "10.2.42.0/24", "tenant_route_ip": "192.168.133.2", "v_name": "vxlan_t5s2"}]}, {"tenant_ns_if": "t5ns2if", "tenant_ns_ip": "10.2.42.1/24", "tenant_ns_name": "t5", "tenant_sub_if": "t5s2if", "tenant_sub_ip": "10.2.42.2/24"}], "rc": 0, "start": "2019-12-05 20:52:49.839439", "stderr": "", "stderr_lines": [], "stdout": "56: t5ns2if@if55: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP mode DEFAULT group default qlen 1000\n    link/ether 12:4e:53:b9:39:99 brd ff:ff:ff:ff:ff:ff link-netnsid 3\n55: t5s2if@if56: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP mode DEFAULT group default qlen 1000\n    link/ether 1a:8e:76:bb:3e:cb brd ff:ff:ff:ff:ff:ff link-netnsid 0", "stdout_lines": ["56: t5ns2if@if55: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP mode DEFAULT group default qlen 1000", "    link/ether 12:4e:53:b9:39:99 brd ff:ff:ff:ff:ff:ff link-netnsid 3", "55: t5s2if@if56: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP mode DEFAULT group default qlen 1000", "    link/ether 1a:8e:76:bb:3e:cb brd ff:ff:ff:ff:ff:ff link-netnsid 0"]}

TASK [Set Namespace VETH Pairs UP] **************************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.41.1/24', u'ns_name': u't5', u'ns_if': u't5if', u'if': u'p1'}], u'default_route_ip': u'10.2.41.1', u'bridge_name': u't5br1', u'dns': [{u'dnsif': u't5s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't5s1_dnsbrif'}], u'ns_name': u't5ns1', u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't5_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't5br1if1', u'vmif': u't5VM4if1'}], u'vxlan': [{u'local_ip': u'10.2.41.2', u'dsport': 4789, u'dev': u't5s1if', u'tenant_route_ip': u'192.168.133.2', u'remote_route': u'10.1.41.0/24', u'subnet_route': u'10.2.41.0/24', u'v_name': u'vxlan_t5s1', u'id': 42, u'remote_ip': u'10.1.41.2'}]}, {u'tenant_sub_ip': u'10.2.41.2/24', u'tenant_ns_ip': u'10.2.41.1/24', u'tenant_ns_if': u't5ns1if', u'tenant_sub_if': u't5s1if', u'tenant_ns_name': u't5'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t5\" ip link set dev \"t5ns1if\" up\nip netns exec \"t5ns1\" ip link set dev \"t5s1if\" up\n", "delta": "0:00:00.077952", "end": "2019-12-05 20:52:50.442719", "item": [{"bridge_name": "t5br1", "default_route_ip": "10.2.41.1", "dns": [{"brif": "t5s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.5", "dnsif": "t5s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t5ns1", "route": [{"if": "p1", "ip": "10.2.41.1/24", "ns_if": "t5if", "ns_name": "t5"}], "subnet_ip": "1.1.1.0/24", "vms": [{"brif": "t5br1if1", "disk": "10G", "mem": 2, "name": "t5_VM4", "vcpu": 4, "vmif": "t5VM4if1"}], "vxlan": [{"dev": "t5s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.41.2", "remote_ip": "10.1.41.2", "remote_route": "10.1.41.0/24", "subnet_route": "10.2.41.0/24", "tenant_route_ip": "192.168.133.2", "v_name": "vxlan_t5s1"}]}, {"tenant_ns_if": "t5ns1if", "tenant_ns_ip": "10.2.41.1/24", "tenant_ns_name": "t5", "tenant_sub_if": "t5s1if", "tenant_sub_ip": "10.2.41.2/24"}], "rc": 0, "start": "2019-12-05 20:52:50.364767", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.42.1/24', u'ns_name': u't5', u'ns_if': u't5if', u'if': u'p1'}], u'default_route_ip': u'10.2.42.1', u'bridge_name': u't5br2', u'dns': [{u'dnsif': u't5s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't5s2_dnsbrif'}], u'ns_name': u't5ns2', u'subnet_ip': u'2.2.2.0/24', u'vms': [{u'mem': 3, u'name': u't5_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't5br2if1', u'vmif': u't5VM3if1'}], u'vxlan': [{u'local_ip': u'10.2.42.2', u'dsport': 4789, u'dev': u't5s2if', u'tenant_route_ip': u'192.168.133.2', u'remote_route': u'10.1.42.0/24', u'subnet_route': u'10.2.42.0/24', u'v_name': u'vxlan_t5s2', u'id': 42, u'remote_ip': u'10.1.42.2'}]}, {u'tenant_sub_ip': u'10.2.42.2/24', u'tenant_ns_ip': u'10.2.42.1/24', u'tenant_ns_if': u't5ns2if', u'tenant_sub_if': u't5s2if', u'tenant_ns_name': u't5'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t5\" ip link set dev \"t5ns2if\" up\nip netns exec \"t5ns2\" ip link set dev \"t5s2if\" up\n", "delta": "0:00:00.078295", "end": "2019-12-05 20:52:50.894722", "item": [{"bridge_name": "t5br2", "default_route_ip": "10.2.42.1", "dns": [{"brif": "t5s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t5s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t5ns2", "route": [{"if": "p1", "ip": "10.2.42.1/24", "ns_if": "t5if", "ns_name": "t5"}], "subnet_ip": "2.2.2.0/24", "vms": [{"brif": "t5br2if1", "disk": "10G", "mem": 3, "name": "t5_VM3", "vcpu": 2, "vmif": "t5VM3if1"}], "vxlan": [{"dev": "t5s2if", "dsport": 4789, "id": 42, "local_ip": "10.2.42.2", "remote_ip": "10.1.42.2", "remote_route": "10.1.42.0/24", "subnet_route": "10.2.42.0/24", "tenant_route_ip": "192.168.133.2", "v_name": "vxlan_t5s2"}]}, {"tenant_ns_if": "t5ns2if", "tenant_ns_ip": "10.2.42.1/24", "tenant_ns_name": "t5", "tenant_sub_if": "t5s2if", "tenant_sub_ip": "10.2.42.2/24"}], "rc": 0, "start": "2019-12-05 20:52:50.816427", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Add IP addresses to Namespace VETH Pairs] *************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.41.1/24', u'ns_name': u't5', u'ns_if': u't5if', u'if': u'p1'}], u'default_route_ip': u'10.2.41.1', u'bridge_name': u't5br1', u'dns': [{u'dnsif': u't5s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't5s1_dnsbrif'}], u'ns_name': u't5ns1', u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't5_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't5br1if1', u'vmif': u't5VM4if1'}], u'vxlan': [{u'local_ip': u'10.2.41.2', u'dsport': 4789, u'dev': u't5s1if', u'tenant_route_ip': u'192.168.133.2', u'remote_route': u'10.1.41.0/24', u'subnet_route': u'10.2.41.0/24', u'v_name': u'vxlan_t5s1', u'id': 42, u'remote_ip': u'10.1.41.2'}]}, {u'tenant_sub_ip': u'10.2.41.2/24', u'tenant_ns_ip': u'10.2.41.1/24', u'tenant_ns_if': u't5ns1if', u'tenant_sub_if': u't5s1if', u'tenant_ns_name': u't5'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t5ns1\" ip addr show \"t5s1if\" | awk 'FNR==3{ print $2 }' | grep -w '^10.2.41.2/24' ; if [ $? -ne 0 ] ; then ip netns exec \"t5ns1\" ip addr add \"10.2.41.2/24\" dev \"t5s1if\" ; fi\n\nip netns exec \"t5\" ip addr show \"t5ns1if\" | awk 'FNR==3{ print $2 }' | grep -w '^10.2.41.1/24' ; if [ $? -ne 0 ] ; then ip netns exec \"t5\" ip addr add \"10.2.41.1/24\" dev \"t5ns1if\" ; fi\n", "delta": "0:00:00.092948", "end": "2019-12-05 20:52:51.438900", "item": [{"bridge_name": "t5br1", "default_route_ip": "10.2.41.1", "dns": [{"brif": "t5s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.5", "dnsif": "t5s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t5ns1", "route": [{"if": "p1", "ip": "10.2.41.1/24", "ns_if": "t5if", "ns_name": "t5"}], "subnet_ip": "1.1.1.0/24", "vms": [{"brif": "t5br1if1", "disk": "10G", "mem": 2, "name": "t5_VM4", "vcpu": 4, "vmif": "t5VM4if1"}], "vxlan": [{"dev": "t5s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.41.2", "remote_ip": "10.1.41.2", "remote_route": "10.1.41.0/24", "subnet_route": "10.2.41.0/24", "tenant_route_ip": "192.168.133.2", "v_name": "vxlan_t5s1"}]}, {"tenant_ns_if": "t5ns1if", "tenant_ns_ip": "10.2.41.1/24", "tenant_ns_name": "t5", "tenant_sub_if": "t5s1if", "tenant_sub_ip": "10.2.41.2/24"}], "rc": 0, "start": "2019-12-05 20:52:51.345952", "stderr": "", "stderr_lines": [], "stdout": "10.2.41.2/24\n10.2.41.1/24", "stdout_lines": ["10.2.41.2/24", "10.2.41.1/24"]}
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.42.1/24', u'ns_name': u't5', u'ns_if': u't5if', u'if': u'p1'}], u'default_route_ip': u'10.2.42.1', u'bridge_name': u't5br2', u'dns': [{u'dnsif': u't5s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't5s2_dnsbrif'}], u'ns_name': u't5ns2', u'subnet_ip': u'2.2.2.0/24', u'vms': [{u'mem': 3, u'name': u't5_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't5br2if1', u'vmif': u't5VM3if1'}], u'vxlan': [{u'local_ip': u'10.2.42.2', u'dsport': 4789, u'dev': u't5s2if', u'tenant_route_ip': u'192.168.133.2', u'remote_route': u'10.1.42.0/24', u'subnet_route': u'10.2.42.0/24', u'v_name': u'vxlan_t5s2', u'id': 42, u'remote_ip': u'10.1.42.2'}]}, {u'tenant_sub_ip': u'10.2.42.2/24', u'tenant_ns_ip': u'10.2.42.1/24', u'tenant_ns_if': u't5ns2if', u'tenant_sub_if': u't5s2if', u'tenant_ns_name': u't5'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t5ns2\" ip addr show \"t5s2if\" | awk 'FNR==3{ print $2 }' | grep -w '^10.2.42.2/24' ; if [ $? -ne 0 ] ; then ip netns exec \"t5ns2\" ip addr add \"10.2.42.2/24\" dev \"t5s2if\" ; fi\n\nip netns exec \"t5\" ip addr show \"t5ns2if\" | awk 'FNR==3{ print $2 }' | grep -w '^10.2.42.1/24' ; if [ $? -ne 0 ] ; then ip netns exec \"t5\" ip addr add \"10.2.42.1/24\" dev \"t5ns2if\" ; fi\n", "delta": "0:00:00.071227", "end": "2019-12-05 20:52:51.854954", "item": [{"bridge_name": "t5br2", "default_route_ip": "10.2.42.1", "dns": [{"brif": "t5s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t5s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t5ns2", "route": [{"if": "p1", "ip": "10.2.42.1/24", "ns_if": "t5if", "ns_name": "t5"}], "subnet_ip": "2.2.2.0/24", "vms": [{"brif": "t5br2if1", "disk": "10G", "mem": 3, "name": "t5_VM3", "vcpu": 2, "vmif": "t5VM3if1"}], "vxlan": [{"dev": "t5s2if", "dsport": 4789, "id": 42, "local_ip": "10.2.42.2", "remote_ip": "10.1.42.2", "remote_route": "10.1.42.0/24", "subnet_route": "10.2.42.0/24", "tenant_route_ip": "192.168.133.2", "v_name": "vxlan_t5s2"}]}, {"tenant_ns_if": "t5ns2if", "tenant_ns_ip": "10.2.42.1/24", "tenant_ns_name": "t5", "tenant_sub_if": "t5s2if", "tenant_sub_ip": "10.2.42.2/24"}], "rc": 0, "start": "2019-12-05 20:52:51.783727", "stderr": "", "stderr_lines": [], "stdout": "10.2.42.2/24\n10.2.42.1/24", "stdout_lines": ["10.2.42.2/24", "10.2.42.1/24"]}

TASK [Add IP Route to Tenant] *******************************************************************************************************************************
changed: [99.99.99.2] => (item={u'default_route_ip': u'192.168.133.1', u'name': u't5', u'pns_ip': u'192.168.133.1/24', u'tenant_if': u't5if', u'tenant_ip': u'192.168.133.2/24', u'pns_if': u't5pns_if'}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t5\" ip route show default | grep -w '[d]efault via 192.168.133.1' ; if [ $? -ne 0 ] ; then ip netns exec \"t5\" ip route add default via \"192.168.133.1\" ; fi\n", "delta": "0:00:00.035588", "end": "2019-12-05 20:52:52.270729", "item": {"default_route_ip": "192.168.133.1", "name": "t5", "pns_if": "t5pns_if", "pns_ip": "192.168.133.1/24", "tenant_if": "t5if", "tenant_ip": "192.168.133.2/24"}, "rc": 0, "start": "2019-12-05 20:52:52.235141", "stderr": "", "stderr_lines": [], "stdout": "default via 192.168.133.1 dev t5if ", "stdout_lines": ["default via 192.168.133.1 dev t5if "]}

TASK [Add IP Route to Tenant Subnet] ************************************************************************************************************************
changed: [99.99.99.2] => (item={u'route': [{u'ip': u'10.2.41.1/24', u'ns_name': u't5', u'ns_if': u't5if', u'if': u'p1'}], u'default_route_ip': u'10.2.41.1', u'bridge_name': u't5br1', u'dns': [{u'dnsif': u't5s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't5s1_dnsbrif'}], u'ns_name': u't5ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.41.2/24', u'tenant_ns_ip': u'10.2.41.1/24', u'tenant_ns_if': u't5ns1if', u'tenant_ns_name': u't5', u'tenant_sub_if': u't5s1if'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't5_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't5br1if1', u'vmif': u't5VM4if1'}], u'vxlan': [{u'local_ip': u'10.2.41.2', u'tenant_route_ip': u'192.168.133.2', u'dsport': 4789, u'dev': u't5s1if', u'subnet_route': u'10.2.41.0/24', u'remote_route': u'10.1.41.0/24', u'v_name': u'vxlan_t5s1', u'id': 42, u'remote_ip': u'10.1.41.2'}]}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t5ns1\" ip route show default | grep -w '[d]efault via 10.2.41.1' ; if [ $? -ne 0 ] ; then ip netns exec \"t5ns1\" ip route add default via \"10.2.41.1\" ; fi\n", "delta": "0:00:00.040148", "end": "2019-12-05 20:52:52.726614", "item": {"bridge_name": "t5br1", "default_route_ip": "10.2.41.1", "dns": [{"brif": "t5s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.5", "dnsif": "t5s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t5ns1", "route": [{"if": "p1", "ip": "10.2.41.1/24", "ns_if": "t5if", "ns_name": "t5"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t5ns1if", "tenant_ns_ip": "10.2.41.1/24", "tenant_ns_name": "t5", "tenant_sub_if": "t5s1if", "tenant_sub_ip": "10.2.41.2/24"}], "vms": [{"brif": "t5br1if1", "disk": "10G", "mem": 2, "name": "t5_VM4", "vcpu": 4, "vmif": "t5VM4if1"}], "vxlan": [{"dev": "t5s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.41.2", "remote_ip": "10.1.41.2", "remote_route": "10.1.41.0/24", "subnet_route": "10.2.41.0/24", "tenant_route_ip": "192.168.133.2", "v_name": "vxlan_t5s1"}]}, "rc": 0, "start": "2019-12-05 20:52:52.686466", "stderr": "", "stderr_lines": [], "stdout": "default via 10.2.41.1 dev t5s1if ", "stdout_lines": ["default via 10.2.41.1 dev t5s1if "]}
changed: [99.99.99.2] => (item={u'route': [{u'ip': u'10.2.42.1/24', u'ns_name': u't5', u'ns_if': u't5if', u'if': u'p1'}], u'default_route_ip': u'10.2.42.1', u'bridge_name': u't5br2', u'dns': [{u'dnsif': u't5s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't5s2_dnsbrif'}], u'ns_name': u't5ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.42.2/24', u'tenant_ns_ip': u'10.2.42.1/24', u'tenant_ns_if': u't5ns2if', u'tenant_ns_name': u't5', u'tenant_sub_if': u't5s2if'}], u'subnet_ip': u'2.2.2.0/24', u'vms': [{u'mem': 3, u'name': u't5_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't5br2if1', u'vmif': u't5VM3if1'}], u'vxlan': [{u'local_ip': u'10.2.42.2', u'tenant_route_ip': u'192.168.133.2', u'dsport': 4789, u'dev': u't5s2if', u'subnet_route': u'10.2.42.0/24', u'remote_route': u'10.1.42.0/24', u'v_name': u'vxlan_t5s2', u'id': 42, u'remote_ip': u'10.1.42.2'}]}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t5ns2\" ip route show default | grep -w '[d]efault via 10.2.42.1' ; if [ $? -ne 0 ] ; then ip netns exec \"t5ns2\" ip route add default via \"10.2.42.1\" ; fi\n", "delta": "0:00:00.038029", "end": "2019-12-05 20:52:53.126747", "item": {"bridge_name": "t5br2", "default_route_ip": "10.2.42.1", "dns": [{"brif": "t5s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t5s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t5ns2", "route": [{"if": "p1", "ip": "10.2.42.1/24", "ns_if": "t5if", "ns_name": "t5"}], "subnet_ip": "2.2.2.0/24", "tenant_ns": [{"tenant_ns_if": "t5ns2if", "tenant_ns_ip": "10.2.42.1/24", "tenant_ns_name": "t5", "tenant_sub_if": "t5s2if", "tenant_sub_ip": "10.2.42.2/24"}], "vms": [{"brif": "t5br2if1", "disk": "10G", "mem": 3, "name": "t5_VM3", "vcpu": 2, "vmif": "t5VM3if1"}], "vxlan": [{"dev": "t5s2if", "dsport": 4789, "id": 42, "local_ip": "10.2.42.2", "remote_ip": "10.1.42.2", "remote_route": "10.1.42.0/24", "subnet_route": "10.2.42.0/24", "tenant_route_ip": "192.168.133.2", "v_name": "vxlan_t5s2"}]}, "rc": 0, "start": "2019-12-05 20:52:53.088718", "stderr": "", "stderr_lines": [], "stdout": "default via 10.2.42.1 dev t5s2if ", "stdout_lines": ["default via 10.2.42.1 dev t5s2if "]}

TASK [Create bridge inside namespace] ***********************************************************************************************************************
changed: [99.99.99.2] => (item={u'route': [{u'ip': u'10.2.41.1/24', u'ns_name': u't5', u'ns_if': u't5if', u'if': u'p1'}], u'default_route_ip': u'10.2.41.1', u'bridge_name': u't5br1', u'dns': [{u'dnsif': u't5s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't5s1_dnsbrif'}], u'ns_name': u't5ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.41.2/24', u'tenant_ns_ip': u'10.2.41.1/24', u'tenant_ns_if': u't5ns1if', u'tenant_ns_name': u't5', u'tenant_sub_if': u't5s1if'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't5_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't5br1if1', u'vmif': u't5VM4if1'}], u'vxlan': [{u'local_ip': u'10.2.41.2', u'tenant_route_ip': u'192.168.133.2', u'dsport': 4789, u'dev': u't5s1if', u'subnet_route': u'10.2.41.0/24', u'remote_route': u'10.1.41.0/24', u'v_name': u'vxlan_t5s1', u'id': 42, u'remote_ip': u'10.1.41.2'}]}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t5ns1\" brctl show | grep -w '^t5br1'; if [ $? -ne 0 ] ; then ip netns exec \"t5ns1\" brctl addbr \"t5br1\" ; fi\nip netns exec \"t5ns1\" ip link set dev \"t5br1\" up\n", "delta": "0:00:00.065680", "end": "2019-12-05 20:52:53.586576", "item": {"bridge_name": "t5br1", "default_route_ip": "10.2.41.1", "dns": [{"brif": "t5s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.5", "dnsif": "t5s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t5ns1", "route": [{"if": "p1", "ip": "10.2.41.1/24", "ns_if": "t5if", "ns_name": "t5"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t5ns1if", "tenant_ns_ip": "10.2.41.1/24", "tenant_ns_name": "t5", "tenant_sub_if": "t5s1if", "tenant_sub_ip": "10.2.41.2/24"}], "vms": [{"brif": "t5br1if1", "disk": "10G", "mem": 2, "name": "t5_VM4", "vcpu": 4, "vmif": "t5VM4if1"}], "vxlan": [{"dev": "t5s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.41.2", "remote_ip": "10.1.41.2", "remote_route": "10.1.41.0/24", "subnet_route": "10.2.41.0/24", "tenant_route_ip": "192.168.133.2", "v_name": "vxlan_t5s1"}]}, "rc": 0, "start": "2019-12-05 20:52:53.520896", "stderr": "", "stderr_lines": [], "stdout": "t5br1\t\t8000.7aa78802f87d\tno\t\tt5br1if1", "stdout_lines": ["t5br1\t\t8000.7aa78802f87d\tno\t\tt5br1if1"]}
changed: [99.99.99.2] => (item={u'route': [{u'ip': u'10.2.42.1/24', u'ns_name': u't5', u'ns_if': u't5if', u'if': u'p1'}], u'default_route_ip': u'10.2.42.1', u'bridge_name': u't5br2', u'dns': [{u'dnsif': u't5s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't5s2_dnsbrif'}], u'ns_name': u't5ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.42.2/24', u'tenant_ns_ip': u'10.2.42.1/24', u'tenant_ns_if': u't5ns2if', u'tenant_ns_name': u't5', u'tenant_sub_if': u't5s2if'}], u'subnet_ip': u'2.2.2.0/24', u'vms': [{u'mem': 3, u'name': u't5_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't5br2if1', u'vmif': u't5VM3if1'}], u'vxlan': [{u'local_ip': u'10.2.42.2', u'tenant_route_ip': u'192.168.133.2', u'dsport': 4789, u'dev': u't5s2if', u'subnet_route': u'10.2.42.0/24', u'remote_route': u'10.1.42.0/24', u'v_name': u'vxlan_t5s2', u'id': 42, u'remote_ip': u'10.1.42.2'}]}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t5ns2\" brctl show | grep -w '^t5br2'; if [ $? -ne 0 ] ; then ip netns exec \"t5ns2\" brctl addbr \"t5br2\" ; fi\nip netns exec \"t5ns2\" ip link set dev \"t5br2\" up\n", "delta": "0:00:00.081422", "end": "2019-12-05 20:52:54.030935", "item": {"bridge_name": "t5br2", "default_route_ip": "10.2.42.1", "dns": [{"brif": "t5s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t5s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t5ns2", "route": [{"if": "p1", "ip": "10.2.42.1/24", "ns_if": "t5if", "ns_name": "t5"}], "subnet_ip": "2.2.2.0/24", "tenant_ns": [{"tenant_ns_if": "t5ns2if", "tenant_ns_ip": "10.2.42.1/24", "tenant_ns_name": "t5", "tenant_sub_if": "t5s2if", "tenant_sub_ip": "10.2.42.2/24"}], "vms": [{"brif": "t5br2if1", "disk": "10G", "mem": 3, "name": "t5_VM3", "vcpu": 2, "vmif": "t5VM3if1"}], "vxlan": [{"dev": "t5s2if", "dsport": 4789, "id": 42, "local_ip": "10.2.42.2", "remote_ip": "10.1.42.2", "remote_route": "10.1.42.0/24", "subnet_route": "10.2.42.0/24", "tenant_route_ip": "192.168.133.2", "v_name": "vxlan_t5s2"}]}, "rc": 0, "start": "2019-12-05 20:52:53.949513", "stderr": "", "stderr_lines": [], "stdout": "t5br2\t\t8000.d253f96e09d8\tno\t\tt5br2if1", "stdout_lines": ["t5br2\t\t8000.d253f96e09d8\tno\t\tt5br2if1"]}

TASK [Create DNS VETH Pair] *********************************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.41.1/24', u'ns_name': u't5', u'ns_if': u't5if', u'if': u'p1'}], u'default_route_ip': u'10.2.41.1', u'bridge_name': u't5br1', u'ns_name': u't5ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.41.2/24', u'tenant_ns_ip': u'10.2.41.1/24', u'tenant_ns_if': u't5ns1if', u'tenant_sub_if': u't5s1if', u'tenant_ns_name': u't5'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't5_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't5br1if1', u'vmif': u't5VM4if1'}], u'vxlan': [{u'local_ip': u'10.2.41.2', u'dsport': 4789, u'dev': u't5s1if', u'tenant_route_ip': u'192.168.133.2', u'remote_route': u'10.1.41.0/24', u'subnet_route': u'10.2.41.0/24', u'v_name': u'vxlan_t5s1', u'id': 42, u'remote_ip': u'10.1.41.2'}]}, {u'dnsif': u't5s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't5s1_dnsbrif'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t5ns1\" ip link show \"t5s1_dnsbrif\" ; if [ $? -ne 0 ] ; then ip netns exec \"t5ns1\" ip link add \"t5s1_dnsbrif\" type veth peer name \"t5s1_dnsif\" ; fi\nip netns exec \"t5ns1\" ip link set dev \"t5s1_dnsbrif\" up\nip netns exec \"t5ns1\" ip link set dev \"t5s1_dnsif\" up\n", "delta": "0:00:00.113094", "end": "2019-12-05 20:52:54.582642", "item": [{"bridge_name": "t5br1", "default_route_ip": "10.2.41.1", "ns_name": "t5ns1", "route": [{"if": "p1", "ip": "10.2.41.1/24", "ns_if": "t5if", "ns_name": "t5"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t5ns1if", "tenant_ns_ip": "10.2.41.1/24", "tenant_ns_name": "t5", "tenant_sub_if": "t5s1if", "tenant_sub_ip": "10.2.41.2/24"}], "vms": [{"brif": "t5br1if1", "disk": "10G", "mem": 2, "name": "t5_VM4", "vcpu": 4, "vmif": "t5VM4if1"}], "vxlan": [{"dev": "t5s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.41.2", "remote_ip": "10.1.41.2", "remote_route": "10.1.41.0/24", "subnet_route": "10.2.41.0/24", "tenant_route_ip": "192.168.133.2", "v_name": "vxlan_t5s1"}]}, {"brif": "t5s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.5", "dnsif": "t5s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "rc": 0, "start": "2019-12-05 20:52:54.469548", "stderr": "", "stderr_lines": [], "stdout": "4: t5s1_dnsbrif@t5s1_dnsif: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue master t5br1 state UP mode DEFAULT group default qlen 1000\n    link/ether 7a:a7:88:02:f8:7d brd ff:ff:ff:ff:ff:ff", "stdout_lines": ["4: t5s1_dnsbrif@t5s1_dnsif: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue master t5br1 state UP mode DEFAULT group default qlen 1000", "    link/ether 7a:a7:88:02:f8:7d brd ff:ff:ff:ff:ff:ff"]}
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.42.1/24', u'ns_name': u't5', u'ns_if': u't5if', u'if': u'p1'}], u'default_route_ip': u'10.2.42.1', u'bridge_name': u't5br2', u'ns_name': u't5ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.42.2/24', u'tenant_ns_ip': u'10.2.42.1/24', u'tenant_ns_if': u't5ns2if', u'tenant_sub_if': u't5s2if', u'tenant_ns_name': u't5'}], u'subnet_ip': u'2.2.2.0/24', u'vms': [{u'mem': 3, u'name': u't5_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't5br2if1', u'vmif': u't5VM3if1'}], u'vxlan': [{u'local_ip': u'10.2.42.2', u'dsport': 4789, u'dev': u't5s2if', u'tenant_route_ip': u'192.168.133.2', u'remote_route': u'10.1.42.0/24', u'subnet_route': u'10.2.42.0/24', u'v_name': u'vxlan_t5s2', u'id': 42, u'remote_ip': u'10.1.42.2'}]}, {u'dnsif': u't5s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't5s2_dnsbrif'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t5ns2\" ip link show \"t5s2_dnsbrif\" ; if [ $? -ne 0 ] ; then ip netns exec \"t5ns2\" ip link add \"t5s2_dnsbrif\" type veth peer name \"t5s2_dnsif\" ; fi\nip netns exec \"t5ns2\" ip link set dev \"t5s2_dnsbrif\" up\nip netns exec \"t5ns2\" ip link set dev \"t5s2_dnsif\" up\n", "delta": "0:00:00.111269", "end": "2019-12-05 20:52:55.062804", "item": [{"bridge_name": "t5br2", "default_route_ip": "10.2.42.1", "ns_name": "t5ns2", "route": [{"if": "p1", "ip": "10.2.42.1/24", "ns_if": "t5if", "ns_name": "t5"}], "subnet_ip": "2.2.2.0/24", "tenant_ns": [{"tenant_ns_if": "t5ns2if", "tenant_ns_ip": "10.2.42.1/24", "tenant_ns_name": "t5", "tenant_sub_if": "t5s2if", "tenant_sub_ip": "10.2.42.2/24"}], "vms": [{"brif": "t5br2if1", "disk": "10G", "mem": 3, "name": "t5_VM3", "vcpu": 2, "vmif": "t5VM3if1"}], "vxlan": [{"dev": "t5s2if", "dsport": 4789, "id": 42, "local_ip": "10.2.42.2", "remote_ip": "10.1.42.2", "remote_route": "10.1.42.0/24", "subnet_route": "10.2.42.0/24", "tenant_route_ip": "192.168.133.2", "v_name": "vxlan_t5s2"}]}, {"brif": "t5s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t5s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "rc": 0, "start": "2019-12-05 20:52:54.951535", "stderr": "", "stderr_lines": [], "stdout": "4: t5s2_dnsbrif@t5s2_dnsif: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue master t5br2 state UP mode DEFAULT group default qlen 1000\n    link/ether ea:04:d2:b3:bc:08 brd ff:ff:ff:ff:ff:ff", "stdout_lines": ["4: t5s2_dnsbrif@t5s2_dnsif: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue master t5br2 state UP mode DEFAULT group default qlen 1000", "    link/ether ea:04:d2:b3:bc:08 brd ff:ff:ff:ff:ff:ff"]}

TASK [Attach DNS VETH Pair] *********************************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.41.1/24', u'ns_name': u't5', u'ns_if': u't5if', u'if': u'p1'}], u'default_route_ip': u'10.2.41.1', u'bridge_name': u't5br1', u'ns_name': u't5ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.41.2/24', u'tenant_ns_ip': u'10.2.41.1/24', u'tenant_ns_if': u't5ns1if', u'tenant_sub_if': u't5s1if', u'tenant_ns_name': u't5'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't5_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't5br1if1', u'vmif': u't5VM4if1'}], u'vxlan': [{u'local_ip': u'10.2.41.2', u'dsport': 4789, u'dev': u't5s1if', u'tenant_route_ip': u'192.168.133.2', u'remote_route': u'10.1.41.0/24', u'subnet_route': u'10.2.41.0/24', u'v_name': u'vxlan_t5s1', u'id': 42, u'remote_ip': u'10.1.41.2'}]}, {u'dnsif': u't5s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't5s1_dnsbrif'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t5ns1\" brctl show \"t5br1\" | grep -w 't5s1_dnsbrif' ; if [ $? -ne 0 ] ; then ip netns exec \"t5ns1\" brctl addif \"t5br1\" \"t5s1_dnsbrif\" ; fi\n", "delta": "0:00:00.046243", "end": "2019-12-05 20:52:55.558738", "item": [{"bridge_name": "t5br1", "default_route_ip": "10.2.41.1", "ns_name": "t5ns1", "route": [{"if": "p1", "ip": "10.2.41.1/24", "ns_if": "t5if", "ns_name": "t5"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t5ns1if", "tenant_ns_ip": "10.2.41.1/24", "tenant_ns_name": "t5", "tenant_sub_if": "t5s1if", "tenant_sub_ip": "10.2.41.2/24"}], "vms": [{"brif": "t5br1if1", "disk": "10G", "mem": 2, "name": "t5_VM4", "vcpu": 4, "vmif": "t5VM4if1"}], "vxlan": [{"dev": "t5s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.41.2", "remote_ip": "10.1.41.2", "remote_route": "10.1.41.0/24", "subnet_route": "10.2.41.0/24", "tenant_route_ip": "192.168.133.2", "v_name": "vxlan_t5s1"}]}, {"brif": "t5s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.5", "dnsif": "t5s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "rc": 0, "start": "2019-12-05 20:52:55.512495", "stderr": "", "stderr_lines": [], "stdout": "\t\t\t\t\t\t\tt5s1_dnsbrif", "stdout_lines": ["\t\t\t\t\t\t\tt5s1_dnsbrif"]}
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.42.1/24', u'ns_name': u't5', u'ns_if': u't5if', u'if': u'p1'}], u'default_route_ip': u'10.2.42.1', u'bridge_name': u't5br2', u'ns_name': u't5ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.42.2/24', u'tenant_ns_ip': u'10.2.42.1/24', u'tenant_ns_if': u't5ns2if', u'tenant_sub_if': u't5s2if', u'tenant_ns_name': u't5'}], u'subnet_ip': u'2.2.2.0/24', u'vms': [{u'mem': 3, u'name': u't5_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't5br2if1', u'vmif': u't5VM3if1'}], u'vxlan': [{u'local_ip': u'10.2.42.2', u'dsport': 4789, u'dev': u't5s2if', u'tenant_route_ip': u'192.168.133.2', u'remote_route': u'10.1.42.0/24', u'subnet_route': u'10.2.42.0/24', u'v_name': u'vxlan_t5s2', u'id': 42, u'remote_ip': u'10.1.42.2'}]}, {u'dnsif': u't5s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't5s2_dnsbrif'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t5ns2\" brctl show \"t5br2\" | grep -w 't5s2_dnsbrif' ; if [ $? -ne 0 ] ; then ip netns exec \"t5ns2\" brctl addif \"t5br2\" \"t5s2_dnsbrif\" ; fi\n", "delta": "0:00:00.035907", "end": "2019-12-05 20:52:55.962619", "item": [{"bridge_name": "t5br2", "default_route_ip": "10.2.42.1", "ns_name": "t5ns2", "route": [{"if": "p1", "ip": "10.2.42.1/24", "ns_if": "t5if", "ns_name": "t5"}], "subnet_ip": "2.2.2.0/24", "tenant_ns": [{"tenant_ns_if": "t5ns2if", "tenant_ns_ip": "10.2.42.1/24", "tenant_ns_name": "t5", "tenant_sub_if": "t5s2if", "tenant_sub_ip": "10.2.42.2/24"}], "vms": [{"brif": "t5br2if1", "disk": "10G", "mem": 3, "name": "t5_VM3", "vcpu": 2, "vmif": "t5VM3if1"}], "vxlan": [{"dev": "t5s2if", "dsport": 4789, "id": 42, "local_ip": "10.2.42.2", "remote_ip": "10.1.42.2", "remote_route": "10.1.42.0/24", "subnet_route": "10.2.42.0/24", "tenant_route_ip": "192.168.133.2", "v_name": "vxlan_t5s2"}]}, {"brif": "t5s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t5s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "rc": 0, "start": "2019-12-05 20:52:55.926712", "stderr": "", "stderr_lines": [], "stdout": "\t\t\t\t\t\t\tt5s2_dnsbrif", "stdout_lines": ["\t\t\t\t\t\t\tt5s2_dnsbrif"]}

TASK [Create VETH Pairs] ************************************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.41.1/24', u'ns_name': u't5', u'ns_if': u't5if', u'if': u'p1'}], u'default_route_ip': u'10.2.41.1', u'bridge_name': u't5br1', u'dns': [{u'dnsif': u't5s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't5s1_dnsbrif'}], u'ns_name': u't5ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.41.2/24', u'tenant_ns_ip': u'10.2.41.1/24', u'tenant_ns_if': u't5ns1if', u'tenant_sub_if': u't5s1if', u'tenant_ns_name': u't5'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.2.41.2', u'dsport': 4789, u'dev': u't5s1if', u'tenant_route_ip': u'192.168.133.2', u'remote_route': u'10.1.41.0/24', u'subnet_route': u'10.2.41.0/24', u'v_name': u'vxlan_t5s1', u'id': 42, u'remote_ip': u'10.1.41.2'}]}, {u'mem': 2, u'name': u't5_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't5br1if1', u'vmif': u't5VM4if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t5ns1\" ip link show \"t5br1if1\" ; if [ $? -ne 0 ] ; then ip link add \"t5VM4if1\" type veth peer name \"t5br1if1\" ; fi\nip link set dev \"t5br1if1\" up\nip link set dev \"t5VM4if1\" up\n", "delta": "0:00:00.043584", "end": "2019-12-05 20:52:56.448934", "item": [{"bridge_name": "t5br1", "default_route_ip": "10.2.41.1", "dns": [{"brif": "t5s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.5", "dnsif": "t5s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t5ns1", "route": [{"if": "p1", "ip": "10.2.41.1/24", "ns_if": "t5if", "ns_name": "t5"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t5ns1if", "tenant_ns_ip": "10.2.41.1/24", "tenant_ns_name": "t5", "tenant_sub_if": "t5s1if", "tenant_sub_ip": "10.2.41.2/24"}], "vxlan": [{"dev": "t5s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.41.2", "remote_ip": "10.1.41.2", "remote_route": "10.1.41.0/24", "subnet_route": "10.2.41.0/24", "tenant_route_ip": "192.168.133.2", "v_name": "vxlan_t5s1"}]}, {"brif": "t5br1if1", "disk": "10G", "mem": 2, "name": "t5_VM4", "vcpu": 4, "vmif": "t5VM4if1"}], "rc": 0, "start": "2019-12-05 20:52:56.405350", "stderr": "Cannot find device \"t5br1if1\"", "stderr_lines": ["Cannot find device \"t5br1if1\""], "stdout": "57: t5br1if1@if58: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue master t5br1 state UP mode DEFAULT group default qlen 1000\n    link/ether 7a:c4:bf:01:43:c5 brd ff:ff:ff:ff:ff:ff link-netnsid 1", "stdout_lines": ["57: t5br1if1@if58: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue master t5br1 state UP mode DEFAULT group default qlen 1000", "    link/ether 7a:c4:bf:01:43:c5 brd ff:ff:ff:ff:ff:ff link-netnsid 1"]}
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.42.1/24', u'ns_name': u't5', u'ns_if': u't5if', u'if': u'p1'}], u'default_route_ip': u'10.2.42.1', u'bridge_name': u't5br2', u'dns': [{u'dnsif': u't5s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't5s2_dnsbrif'}], u'ns_name': u't5ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.42.2/24', u'tenant_ns_ip': u'10.2.42.1/24', u'tenant_ns_if': u't5ns2if', u'tenant_sub_if': u't5s2if', u'tenant_ns_name': u't5'}], u'subnet_ip': u'2.2.2.0/24', u'vxlan': [{u'local_ip': u'10.2.42.2', u'dsport': 4789, u'dev': u't5s2if', u'tenant_route_ip': u'192.168.133.2', u'remote_route': u'10.1.42.0/24', u'subnet_route': u'10.2.42.0/24', u'v_name': u'vxlan_t5s2', u'id': 42, u'remote_ip': u'10.1.42.2'}]}, {u'mem': 3, u'name': u't5_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't5br2if1', u'vmif': u't5VM3if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t5ns2\" ip link show \"t5br2if1\" ; if [ $? -ne 0 ] ; then ip link add \"t5VM3if1\" type veth peer name \"t5br2if1\" ; fi\nip link set dev \"t5br2if1\" up\nip link set dev \"t5VM3if1\" up\n", "delta": "0:00:00.050599", "end": "2019-12-05 20:52:56.839544", "item": [{"bridge_name": "t5br2", "default_route_ip": "10.2.42.1", "dns": [{"brif": "t5s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t5s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t5ns2", "route": [{"if": "p1", "ip": "10.2.42.1/24", "ns_if": "t5if", "ns_name": "t5"}], "subnet_ip": "2.2.2.0/24", "tenant_ns": [{"tenant_ns_if": "t5ns2if", "tenant_ns_ip": "10.2.42.1/24", "tenant_ns_name": "t5", "tenant_sub_if": "t5s2if", "tenant_sub_ip": "10.2.42.2/24"}], "vxlan": [{"dev": "t5s2if", "dsport": 4789, "id": 42, "local_ip": "10.2.42.2", "remote_ip": "10.1.42.2", "remote_route": "10.1.42.0/24", "subnet_route": "10.2.42.0/24", "tenant_route_ip": "192.168.133.2", "v_name": "vxlan_t5s2"}]}, {"brif": "t5br2if1", "disk": "10G", "mem": 3, "name": "t5_VM3", "vcpu": 2, "vmif": "t5VM3if1"}], "rc": 0, "start": "2019-12-05 20:52:56.788945", "stderr": "Cannot find device \"t5br2if1\"", "stderr_lines": ["Cannot find device \"t5br2if1\""], "stdout": "59: t5br2if1@if60: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue master t5br2 state UP mode DEFAULT group default qlen 1000\n    link/ether d2:53:f9:6e:09:d8 brd ff:ff:ff:ff:ff:ff link-netnsid 1", "stdout_lines": ["59: t5br2if1@if60: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue master t5br2 state UP mode DEFAULT group default qlen 1000", "    link/ether d2:53:f9:6e:09:d8 brd ff:ff:ff:ff:ff:ff link-netnsid 1"]}

TASK [Attach VETH Pairs] ************************************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.41.1/24', u'ns_name': u't5', u'ns_if': u't5if', u'if': u'p1'}], u'default_route_ip': u'10.2.41.1', u'bridge_name': u't5br1', u'dns': [{u'dnsif': u't5s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't5s1_dnsbrif'}], u'ns_name': u't5ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.41.2/24', u'tenant_ns_ip': u'10.2.41.1/24', u'tenant_ns_if': u't5ns1if', u'tenant_sub_if': u't5s1if', u'tenant_ns_name': u't5'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.2.41.2', u'dsport': 4789, u'dev': u't5s1if', u'tenant_route_ip': u'192.168.133.2', u'remote_route': u'10.1.41.0/24', u'subnet_route': u'10.2.41.0/24', u'v_name': u'vxlan_t5s1', u'id': 42, u'remote_ip': u'10.1.41.2'}]}, {u'mem': 2, u'name': u't5_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't5br1if1', u'vmif': u't5VM4if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip link show \"t5br1if1\" ; if [ $? -eq 0 ] ; then ip link set \"t5br1if1\" netns \"t5ns1\" ; fi\nip netns exec \"t5ns1\" brctl show \"t5br1\" | grep -w 't5br1if1' ; if [ $? -ne 0 ] ; then ip netns exec \"t5ns1\" brctl addif \"t5br1\" \"t5br1if1\" ; fi\n", "delta": "0:00:00.042816", "end": "2019-12-05 20:52:57.290789", "item": [{"bridge_name": "t5br1", "default_route_ip": "10.2.41.1", "dns": [{"brif": "t5s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.5", "dnsif": "t5s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t5ns1", "route": [{"if": "p1", "ip": "10.2.41.1/24", "ns_if": "t5if", "ns_name": "t5"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t5ns1if", "tenant_ns_ip": "10.2.41.1/24", "tenant_ns_name": "t5", "tenant_sub_if": "t5s1if", "tenant_sub_ip": "10.2.41.2/24"}], "vxlan": [{"dev": "t5s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.41.2", "remote_ip": "10.1.41.2", "remote_route": "10.1.41.0/24", "subnet_route": "10.2.41.0/24", "tenant_route_ip": "192.168.133.2", "v_name": "vxlan_t5s1"}]}, {"brif": "t5br1if1", "disk": "10G", "mem": 2, "name": "t5_VM4", "vcpu": 4, "vmif": "t5VM4if1"}], "rc": 0, "start": "2019-12-05 20:52:57.247973", "stderr": "Device \"t5br1if1\" does not exist.", "stderr_lines": ["Device \"t5br1if1\" does not exist."], "stdout": "t5br1\t\t8000.7aa78802f87d\tno\t\tt5br1if1", "stdout_lines": ["t5br1\t\t8000.7aa78802f87d\tno\t\tt5br1if1"]}
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.42.1/24', u'ns_name': u't5', u'ns_if': u't5if', u'if': u'p1'}], u'default_route_ip': u'10.2.42.1', u'bridge_name': u't5br2', u'dns': [{u'dnsif': u't5s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't5s2_dnsbrif'}], u'ns_name': u't5ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.42.2/24', u'tenant_ns_ip': u'10.2.42.1/24', u'tenant_ns_if': u't5ns2if', u'tenant_sub_if': u't5s2if', u'tenant_ns_name': u't5'}], u'subnet_ip': u'2.2.2.0/24', u'vxlan': [{u'local_ip': u'10.2.42.2', u'dsport': 4789, u'dev': u't5s2if', u'tenant_route_ip': u'192.168.133.2', u'remote_route': u'10.1.42.0/24', u'subnet_route': u'10.2.42.0/24', u'v_name': u'vxlan_t5s2', u'id': 42, u'remote_ip': u'10.1.42.2'}]}, {u'mem': 3, u'name': u't5_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't5br2if1', u'vmif': u't5VM3if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip link show \"t5br2if1\" ; if [ $? -eq 0 ] ; then ip link set \"t5br2if1\" netns \"t5ns2\" ; fi\nip netns exec \"t5ns2\" brctl show \"t5br2\" | grep -w 't5br2if1' ; if [ $? -ne 0 ] ; then ip netns exec \"t5ns2\" brctl addif \"t5br2\" \"t5br2if1\" ; fi\n", "delta": "0:00:00.043559", "end": "2019-12-05 20:52:57.722936", "item": [{"bridge_name": "t5br2", "default_route_ip": "10.2.42.1", "dns": [{"brif": "t5s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t5s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t5ns2", "route": [{"if": "p1", "ip": "10.2.42.1/24", "ns_if": "t5if", "ns_name": "t5"}], "subnet_ip": "2.2.2.0/24", "tenant_ns": [{"tenant_ns_if": "t5ns2if", "tenant_ns_ip": "10.2.42.1/24", "tenant_ns_name": "t5", "tenant_sub_if": "t5s2if", "tenant_sub_ip": "10.2.42.2/24"}], "vxlan": [{"dev": "t5s2if", "dsport": 4789, "id": 42, "local_ip": "10.2.42.2", "remote_ip": "10.1.42.2", "remote_route": "10.1.42.0/24", "subnet_route": "10.2.42.0/24", "tenant_route_ip": "192.168.133.2", "v_name": "vxlan_t5s2"}]}, {"brif": "t5br2if1", "disk": "10G", "mem": 3, "name": "t5_VM3", "vcpu": 2, "vmif": "t5VM3if1"}], "rc": 0, "start": "2019-12-05 20:52:57.679377", "stderr": "Device \"t5br2if1\" does not exist.", "stderr_lines": ["Device \"t5br2if1\" does not exist."], "stdout": "t5br2\t\t8000.d253f96e09d8\tno\t\tt5br2if1", "stdout_lines": ["t5br2\t\t8000.d253f96e09d8\tno\t\tt5br2if1"]}

TASK [All interfaces and bridges UP] ************************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.41.1/24', u'ns_name': u't5', u'ns_if': u't5if', u'if': u'p1'}], u'default_route_ip': u'10.2.41.1', u'bridge_name': u't5br1', u'dns': [{u'dnsif': u't5s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't5s1_dnsbrif'}], u'ns_name': u't5ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.41.2/24', u'tenant_ns_ip': u'10.2.41.1/24', u'tenant_ns_if': u't5ns1if', u'tenant_sub_if': u't5s1if', u'tenant_ns_name': u't5'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.2.41.2', u'dsport': 4789, u'dev': u't5s1if', u'tenant_route_ip': u'192.168.133.2', u'remote_route': u'10.1.41.0/24', u'subnet_route': u'10.2.41.0/24', u'v_name': u'vxlan_t5s1', u'id': 42, u'remote_ip': u'10.1.41.2'}]}, {u'mem': 2, u'name': u't5_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't5br1if1', u'vmif': u't5VM4if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t5ns1\" ip link set \"t5br1if1\" up\nip netns exec \"t5ns1\" ip link set dev \"t5br1\" up\n", "delta": "0:00:00.070337", "end": "2019-12-05 20:52:58.242555", "item": [{"bridge_name": "t5br1", "default_route_ip": "10.2.41.1", "dns": [{"brif": "t5s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.5", "dnsif": "t5s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t5ns1", "route": [{"if": "p1", "ip": "10.2.41.1/24", "ns_if": "t5if", "ns_name": "t5"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t5ns1if", "tenant_ns_ip": "10.2.41.1/24", "tenant_ns_name": "t5", "tenant_sub_if": "t5s1if", "tenant_sub_ip": "10.2.41.2/24"}], "vxlan": [{"dev": "t5s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.41.2", "remote_ip": "10.1.41.2", "remote_route": "10.1.41.0/24", "subnet_route": "10.2.41.0/24", "tenant_route_ip": "192.168.133.2", "v_name": "vxlan_t5s1"}]}, {"brif": "t5br1if1", "disk": "10G", "mem": 2, "name": "t5_VM4", "vcpu": 4, "vmif": "t5VM4if1"}], "rc": 0, "start": "2019-12-05 20:52:58.172218", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.42.1/24', u'ns_name': u't5', u'ns_if': u't5if', u'if': u'p1'}], u'default_route_ip': u'10.2.42.1', u'bridge_name': u't5br2', u'dns': [{u'dnsif': u't5s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't5s2_dnsbrif'}], u'ns_name': u't5ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.42.2/24', u'tenant_ns_ip': u'10.2.42.1/24', u'tenant_ns_if': u't5ns2if', u'tenant_sub_if': u't5s2if', u'tenant_ns_name': u't5'}], u'subnet_ip': u'2.2.2.0/24', u'vxlan': [{u'local_ip': u'10.2.42.2', u'dsport': 4789, u'dev': u't5s2if', u'tenant_route_ip': u'192.168.133.2', u'remote_route': u'10.1.42.0/24', u'subnet_route': u'10.2.42.0/24', u'v_name': u'vxlan_t5s2', u'id': 42, u'remote_ip': u'10.1.42.2'}]}, {u'mem': 3, u'name': u't5_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't5br2if1', u'vmif': u't5VM3if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t5ns2\" ip link set \"t5br2if1\" up\nip netns exec \"t5ns2\" ip link set dev \"t5br2\" up\n", "delta": "0:00:00.074959", "end": "2019-12-05 20:52:58.702649", "item": [{"bridge_name": "t5br2", "default_route_ip": "10.2.42.1", "dns": [{"brif": "t5s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t5s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t5ns2", "route": [{"if": "p1", "ip": "10.2.42.1/24", "ns_if": "t5if", "ns_name": "t5"}], "subnet_ip": "2.2.2.0/24", "tenant_ns": [{"tenant_ns_if": "t5ns2if", "tenant_ns_ip": "10.2.42.1/24", "tenant_ns_name": "t5", "tenant_sub_if": "t5s2if", "tenant_sub_ip": "10.2.42.2/24"}], "vxlan": [{"dev": "t5s2if", "dsport": 4789, "id": 42, "local_ip": "10.2.42.2", "remote_ip": "10.1.42.2", "remote_route": "10.1.42.0/24", "subnet_route": "10.2.42.0/24", "tenant_route_ip": "192.168.133.2", "v_name": "vxlan_t5s2"}]}, {"brif": "t5br2if1", "disk": "10G", "mem": 3, "name": "t5_VM3", "vcpu": 2, "vmif": "t5VM3if1"}], "rc": 0, "start": "2019-12-05 20:52:58.627690", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Add IP to DNS Interface] ******************************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.41.1/24', u'ns_name': u't5', u'ns_if': u't5if', u'if': u'p1'}], u'default_route_ip': u'10.2.41.1', u'bridge_name': u't5br1', u'ns_name': u't5ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.41.2/24', u'tenant_ns_ip': u'10.2.41.1/24', u'tenant_ns_if': u't5ns1if', u'tenant_sub_if': u't5s1if', u'tenant_ns_name': u't5'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't5_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't5br1if1', u'vmif': u't5VM4if1'}], u'vxlan': [{u'local_ip': u'10.2.41.2', u'dsport': 4789, u'dev': u't5s1if', u'tenant_route_ip': u'192.168.133.2', u'remote_route': u'10.1.41.0/24', u'subnet_route': u'10.2.41.0/24', u'v_name': u'vxlan_t5s1', u'id': 42, u'remote_ip': u'10.1.41.2'}]}, {u'dnsif': u't5s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't5s1_dnsbrif'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t5ns1\" ip addr show \"t5s1_dnsif\" | awk 'FNR==3{ print $2}'| grep -w '^1.1.1.1/24' ; if [ $? -ne 0 ] ; then ip netns exec \"t5ns1\" ip addr add \"1.1.1.1/24\" dev \"t5s1_dnsif\" ; fi\n", "delta": "0:00:00.050261", "end": "2019-12-05 20:52:59.219173", "item": [{"bridge_name": "t5br1", "default_route_ip": "10.2.41.1", "ns_name": "t5ns1", "route": [{"if": "p1", "ip": "10.2.41.1/24", "ns_if": "t5if", "ns_name": "t5"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t5ns1if", "tenant_ns_ip": "10.2.41.1/24", "tenant_ns_name": "t5", "tenant_sub_if": "t5s1if", "tenant_sub_ip": "10.2.41.2/24"}], "vms": [{"brif": "t5br1if1", "disk": "10G", "mem": 2, "name": "t5_VM4", "vcpu": 4, "vmif": "t5VM4if1"}], "vxlan": [{"dev": "t5s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.41.2", "remote_ip": "10.1.41.2", "remote_route": "10.1.41.0/24", "subnet_route": "10.2.41.0/24", "tenant_route_ip": "192.168.133.2", "v_name": "vxlan_t5s1"}]}, {"brif": "t5s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.5", "dnsif": "t5s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "rc": 0, "start": "2019-12-05 20:52:59.168912", "stderr": "", "stderr_lines": [], "stdout": "1.1.1.1/24", "stdout_lines": ["1.1.1.1/24"]}
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.42.1/24', u'ns_name': u't5', u'ns_if': u't5if', u'if': u'p1'}], u'default_route_ip': u'10.2.42.1', u'bridge_name': u't5br2', u'ns_name': u't5ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.42.2/24', u'tenant_ns_ip': u'10.2.42.1/24', u'tenant_ns_if': u't5ns2if', u'tenant_sub_if': u't5s2if', u'tenant_ns_name': u't5'}], u'subnet_ip': u'2.2.2.0/24', u'vms': [{u'mem': 3, u'name': u't5_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't5br2if1', u'vmif': u't5VM3if1'}], u'vxlan': [{u'local_ip': u'10.2.42.2', u'dsport': 4789, u'dev': u't5s2if', u'tenant_route_ip': u'192.168.133.2', u'remote_route': u'10.1.42.0/24', u'subnet_route': u'10.2.42.0/24', u'v_name': u'vxlan_t5s2', u'id': 42, u'remote_ip': u'10.1.42.2'}]}, {u'dnsif': u't5s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't5s2_dnsbrif'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t5ns2\" ip addr show \"t5s2_dnsif\" | awk 'FNR==3{ print $2}'| grep -w '^2.2.2.1/24' ; if [ $? -ne 0 ] ; then ip netns exec \"t5ns2\" ip addr add \"2.2.2.1/24\" dev \"t5s2_dnsif\" ; fi\n", "delta": "0:00:00.040925", "end": "2019-12-05 20:52:59.647032", "item": [{"bridge_name": "t5br2", "default_route_ip": "10.2.42.1", "ns_name": "t5ns2", "route": [{"if": "p1", "ip": "10.2.42.1/24", "ns_if": "t5if", "ns_name": "t5"}], "subnet_ip": "2.2.2.0/24", "tenant_ns": [{"tenant_ns_if": "t5ns2if", "tenant_ns_ip": "10.2.42.1/24", "tenant_ns_name": "t5", "tenant_sub_if": "t5s2if", "tenant_sub_ip": "10.2.42.2/24"}], "vms": [{"brif": "t5br2if1", "disk": "10G", "mem": 3, "name": "t5_VM3", "vcpu": 2, "vmif": "t5VM3if1"}], "vxlan": [{"dev": "t5s2if", "dsport": 4789, "id": 42, "local_ip": "10.2.42.2", "remote_ip": "10.1.42.2", "remote_route": "10.1.42.0/24", "subnet_route": "10.2.42.0/24", "tenant_route_ip": "192.168.133.2", "v_name": "vxlan_t5s2"}]}, {"brif": "t5s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t5s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "rc": 0, "start": "2019-12-05 20:52:59.606107", "stderr": "", "stderr_lines": [], "stdout": "2.2.2.1/24", "stdout_lines": ["2.2.2.1/24"]}

TASK [Install DHCP Server] **********************************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.41.1/24', u'ns_name': u't5', u'ns_if': u't5if', u'if': u'p1'}], u'default_route_ip': u'10.2.41.1', u'bridge_name': u't5br1', u'ns_name': u't5ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.41.2/24', u'tenant_ns_ip': u'10.2.41.1/24', u'tenant_ns_if': u't5ns1if', u'tenant_sub_if': u't5s1if', u'tenant_ns_name': u't5'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't5_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't5br1if1', u'vmif': u't5VM4if1'}], u'vxlan': [{u'local_ip': u'10.2.41.2', u'dsport': 4789, u'dev': u't5s1if', u'tenant_route_ip': u'192.168.133.2', u'remote_route': u'10.1.41.0/24', u'subnet_route': u'10.2.41.0/24', u'v_name': u'vxlan_t5s1', u'id': 42, u'remote_ip': u'10.1.41.2'}]}, {u'dnsif': u't5s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't5s1_dnsbrif'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t5ns1\" ps aux | grep -w '[d]nsmasq --interface t5s1_dnsif -z --dhcp-range=1.1.1.5,1.1.1.254' ; if [ $? -ne 0 ] ; then ip netns exec \"t5ns1\" dnsmasq --interface \"t5s1_dnsif\" -z --dhcp-range=1.1.1.5,'1.1.1.254' ; fi\n", "delta": "0:00:00.057321", "end": "2019-12-05 20:53:00.134486", "item": [{"bridge_name": "t5br1", "default_route_ip": "10.2.41.1", "ns_name": "t5ns1", "route": [{"if": "p1", "ip": "10.2.41.1/24", "ns_if": "t5if", "ns_name": "t5"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t5ns1if", "tenant_ns_ip": "10.2.41.1/24", "tenant_ns_name": "t5", "tenant_sub_if": "t5s1if", "tenant_sub_ip": "10.2.41.2/24"}], "vms": [{"brif": "t5br1if1", "disk": "10G", "mem": 2, "name": "t5_VM4", "vcpu": 4, "vmif": "t5VM4if1"}], "vxlan": [{"dev": "t5s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.41.2", "remote_ip": "10.1.41.2", "remote_route": "10.1.41.0/24", "subnet_route": "10.2.41.0/24", "tenant_route_ip": "192.168.133.2", "v_name": "vxlan_t5s1"}]}, {"brif": "t5s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.5", "dnsif": "t5s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "rc": 0, "start": "2019-12-05 20:53:00.077165", "stderr": "", "stderr_lines": [], "stdout": "nobody   15592  0.0  0.0  51580  2668 ?        S    20:39   0:00 dnsmasq --interface t5s1_dnsif -z --dhcp-range=1.1.1.5,1.1.1.254", "stdout_lines": ["nobody   15592  0.0  0.0  51580  2668 ?        S    20:39   0:00 dnsmasq --interface t5s1_dnsif -z --dhcp-range=1.1.1.5,1.1.1.254"]}
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.42.1/24', u'ns_name': u't5', u'ns_if': u't5if', u'if': u'p1'}], u'default_route_ip': u'10.2.42.1', u'bridge_name': u't5br2', u'ns_name': u't5ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.42.2/24', u'tenant_ns_ip': u'10.2.42.1/24', u'tenant_ns_if': u't5ns2if', u'tenant_sub_if': u't5s2if', u'tenant_ns_name': u't5'}], u'subnet_ip': u'2.2.2.0/24', u'vms': [{u'mem': 3, u'name': u't5_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't5br2if1', u'vmif': u't5VM3if1'}], u'vxlan': [{u'local_ip': u'10.2.42.2', u'dsport': 4789, u'dev': u't5s2if', u'tenant_route_ip': u'192.168.133.2', u'remote_route': u'10.1.42.0/24', u'subnet_route': u'10.2.42.0/24', u'v_name': u'vxlan_t5s2', u'id': 42, u'remote_ip': u'10.1.42.2'}]}, {u'dnsif': u't5s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't5s2_dnsbrif'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t5ns2\" ps aux | grep -w '[d]nsmasq --interface t5s2_dnsif -z --dhcp-range=2.2.2.5,2.2.2.254' ; if [ $? -ne 0 ] ; then ip netns exec \"t5ns2\" dnsmasq --interface \"t5s2_dnsif\" -z --dhcp-range=2.2.2.5,'2.2.2.254' ; fi\n", "delta": "0:00:00.053855", "end": "2019-12-05 20:53:00.539097", "item": [{"bridge_name": "t5br2", "default_route_ip": "10.2.42.1", "ns_name": "t5ns2", "route": [{"if": "p1", "ip": "10.2.42.1/24", "ns_if": "t5if", "ns_name": "t5"}], "subnet_ip": "2.2.2.0/24", "tenant_ns": [{"tenant_ns_if": "t5ns2if", "tenant_ns_ip": "10.2.42.1/24", "tenant_ns_name": "t5", "tenant_sub_if": "t5s2if", "tenant_sub_ip": "10.2.42.2/24"}], "vms": [{"brif": "t5br2if1", "disk": "10G", "mem": 3, "name": "t5_VM3", "vcpu": 2, "vmif": "t5VM3if1"}], "vxlan": [{"dev": "t5s2if", "dsport": 4789, "id": 42, "local_ip": "10.2.42.2", "remote_ip": "10.1.42.2", "remote_route": "10.1.42.0/24", "subnet_route": "10.2.42.0/24", "tenant_route_ip": "192.168.133.2", "v_name": "vxlan_t5s2"}]}, {"brif": "t5s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t5s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "rc": 0, "start": "2019-12-05 20:53:00.485242", "stderr": "", "stderr_lines": [], "stdout": "nobody   15627  0.0  0.0  51580  2720 ?        S    20:39   0:00 dnsmasq --interface t5s2_dnsif -z --dhcp-range=2.2.2.5,2.2.2.254", "stdout_lines": ["nobody   15627  0.0  0.0  51580  2720 ?        S    20:39   0:00 dnsmasq --interface t5s2_dnsif -z --dhcp-range=2.2.2.5,2.2.2.254"]}

TASK [Create VXLAN devices] *********************************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.41.1/24', u'ns_name': u't5', u'ns_if': u't5if', u'if': u'p1'}], u'default_route_ip': u'10.2.41.1', u'bridge_name': u't5br1', u'dns': [{u'dnsif': u't5s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't5s1_dnsbrif'}], u'ns_name': u't5ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.41.2/24', u'tenant_ns_ip': u'10.2.41.1/24', u'tenant_ns_if': u't5ns1if', u'tenant_sub_if': u't5s1if', u'tenant_ns_name': u't5'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't5_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't5br1if1', u'vmif': u't5VM4if1'}]}, {u'local_ip': u'10.2.41.2', u'dsport': 4789, u'dev': u't5s1if', u'tenant_route_ip': u'192.168.133.2', u'remote_route': u'10.1.41.0/24', u'subnet_route': u'10.2.41.0/24', u'v_name': u'vxlan_t5s1', u'id': 42, u'remote_ip': u'10.1.41.2'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t5ns1\" ip link show \"vxlan_t5s1\" ; if [ $? -ne 0 ] ; then ip netns exec \"t5ns1\" ip link add \"vxlan_t5s1\" type vxlan id \"42\" local \"10.2.41.2\" remote \"10.1.41.2\" dstport \"4789\" dev \"t5s1if\" ; ip netns exec \"t5ns1\" ip link set dev \"vxlan_t5s1\" up ; fi\n", "delta": "0:00:00.041464", "end": "2019-12-05 20:53:01.030761", "item": [{"bridge_name": "t5br1", "default_route_ip": "10.2.41.1", "dns": [{"brif": "t5s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.5", "dnsif": "t5s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t5ns1", "route": [{"if": "p1", "ip": "10.2.41.1/24", "ns_if": "t5if", "ns_name": "t5"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t5ns1if", "tenant_ns_ip": "10.2.41.1/24", "tenant_ns_name": "t5", "tenant_sub_if": "t5s1if", "tenant_sub_ip": "10.2.41.2/24"}], "vms": [{"brif": "t5br1if1", "disk": "10G", "mem": 2, "name": "t5_VM4", "vcpu": 4, "vmif": "t5VM4if1"}]}, {"dev": "t5s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.41.2", "remote_ip": "10.1.41.2", "remote_route": "10.1.41.0/24", "subnet_route": "10.2.41.0/24", "tenant_route_ip": "192.168.133.2", "v_name": "vxlan_t5s1"}], "rc": 0, "start": "2019-12-05 20:53:00.989297", "stderr": "", "stderr_lines": [], "stdout": "5: vxlan_t5s1: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1450 qdisc noqueue master t5br1 state UNKNOWN mode DEFAULT group default qlen 1000\n    link/ether fe:55:e5:28:8f:b3 brd ff:ff:ff:ff:ff:ff", "stdout_lines": ["5: vxlan_t5s1: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1450 qdisc noqueue master t5br1 state UNKNOWN mode DEFAULT group default qlen 1000", "    link/ether fe:55:e5:28:8f:b3 brd ff:ff:ff:ff:ff:ff"]}
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.42.1/24', u'ns_name': u't5', u'ns_if': u't5if', u'if': u'p1'}], u'default_route_ip': u'10.2.42.1', u'bridge_name': u't5br2', u'dns': [{u'dnsif': u't5s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't5s2_dnsbrif'}], u'ns_name': u't5ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.42.2/24', u'tenant_ns_ip': u'10.2.42.1/24', u'tenant_ns_if': u't5ns2if', u'tenant_sub_if': u't5s2if', u'tenant_ns_name': u't5'}], u'subnet_ip': u'2.2.2.0/24', u'vms': [{u'mem': 3, u'name': u't5_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't5br2if1', u'vmif': u't5VM3if1'}]}, {u'local_ip': u'10.2.42.2', u'dsport': 4789, u'dev': u't5s2if', u'tenant_route_ip': u'192.168.133.2', u'remote_route': u'10.1.42.0/24', u'subnet_route': u'10.2.42.0/24', u'v_name': u'vxlan_t5s2', u'id': 42, u'remote_ip': u'10.1.42.2'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t5ns2\" ip link show \"vxlan_t5s2\" ; if [ $? -ne 0 ] ; then ip netns exec \"t5ns2\" ip link add \"vxlan_t5s2\" type vxlan id \"42\" local \"10.2.42.2\" remote \"10.1.42.2\" dstport \"4789\" dev \"t5s2if\" ; ip netns exec \"t5ns2\" ip link set dev \"vxlan_t5s2\" up ; fi\n", "delta": "0:00:00.033181", "end": "2019-12-05 20:53:01.454688", "item": [{"bridge_name": "t5br2", "default_route_ip": "10.2.42.1", "dns": [{"brif": "t5s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t5s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t5ns2", "route": [{"if": "p1", "ip": "10.2.42.1/24", "ns_if": "t5if", "ns_name": "t5"}], "subnet_ip": "2.2.2.0/24", "tenant_ns": [{"tenant_ns_if": "t5ns2if", "tenant_ns_ip": "10.2.42.1/24", "tenant_ns_name": "t5", "tenant_sub_if": "t5s2if", "tenant_sub_ip": "10.2.42.2/24"}], "vms": [{"brif": "t5br2if1", "disk": "10G", "mem": 3, "name": "t5_VM3", "vcpu": 2, "vmif": "t5VM3if1"}]}, {"dev": "t5s2if", "dsport": 4789, "id": 42, "local_ip": "10.2.42.2", "remote_ip": "10.1.42.2", "remote_route": "10.1.42.0/24", "subnet_route": "10.2.42.0/24", "tenant_route_ip": "192.168.133.2", "v_name": "vxlan_t5s2"}], "rc": 0, "start": "2019-12-05 20:53:01.421507", "stderr": "", "stderr_lines": [], "stdout": "5: vxlan_t5s2: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1450 qdisc noqueue master t5br2 state UNKNOWN mode DEFAULT group default qlen 1000\n    link/ether ee:29:c7:1e:ff:bd brd ff:ff:ff:ff:ff:ff", "stdout_lines": ["5: vxlan_t5s2: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1450 qdisc noqueue master t5br2 state UNKNOWN mode DEFAULT group default qlen 1000", "    link/ether ee:29:c7:1e:ff:bd brd ff:ff:ff:ff:ff:ff"]}

TASK [Attach VXLANs to bridge] ******************************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.41.1/24', u'ns_name': u't5', u'ns_if': u't5if', u'if': u'p1'}], u'default_route_ip': u'10.2.41.1', u'bridge_name': u't5br1', u'dns': [{u'dnsif': u't5s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't5s1_dnsbrif'}], u'ns_name': u't5ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.41.2/24', u'tenant_ns_ip': u'10.2.41.1/24', u'tenant_ns_if': u't5ns1if', u'tenant_sub_if': u't5s1if', u'tenant_ns_name': u't5'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't5_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't5br1if1', u'vmif': u't5VM4if1'}]}, {u'local_ip': u'10.2.41.2', u'dsport': 4789, u'dev': u't5s1if', u'tenant_route_ip': u'192.168.133.2', u'remote_route': u'10.1.41.0/24', u'subnet_route': u'10.2.41.0/24', u'v_name': u'vxlan_t5s1', u'id': 42, u'remote_ip': u'10.1.41.2'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t5ns1\" brctl show \"t5br1\" | grep -w 'vxlan_t5s1' ; if [ $? -ne 0 ] ; then ip netns exec \"t5ns1\" brctl addif \"t5br1\" \"vxlan_t5s1\" ; fi\n", "delta": "0:00:00.039600", "end": "2019-12-05 20:53:01.942806", "item": [{"bridge_name": "t5br1", "default_route_ip": "10.2.41.1", "dns": [{"brif": "t5s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.5", "dnsif": "t5s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t5ns1", "route": [{"if": "p1", "ip": "10.2.41.1/24", "ns_if": "t5if", "ns_name": "t5"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t5ns1if", "tenant_ns_ip": "10.2.41.1/24", "tenant_ns_name": "t5", "tenant_sub_if": "t5s1if", "tenant_sub_ip": "10.2.41.2/24"}], "vms": [{"brif": "t5br1if1", "disk": "10G", "mem": 2, "name": "t5_VM4", "vcpu": 4, "vmif": "t5VM4if1"}]}, {"dev": "t5s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.41.2", "remote_ip": "10.1.41.2", "remote_route": "10.1.41.0/24", "subnet_route": "10.2.41.0/24", "tenant_route_ip": "192.168.133.2", "v_name": "vxlan_t5s1"}], "rc": 0, "start": "2019-12-05 20:53:01.903206", "stderr": "", "stderr_lines": [], "stdout": "\t\t\t\t\t\t\tvxlan_t5s1", "stdout_lines": ["\t\t\t\t\t\t\tvxlan_t5s1"]}
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.42.1/24', u'ns_name': u't5', u'ns_if': u't5if', u'if': u'p1'}], u'default_route_ip': u'10.2.42.1', u'bridge_name': u't5br2', u'dns': [{u'dnsif': u't5s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't5s2_dnsbrif'}], u'ns_name': u't5ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.42.2/24', u'tenant_ns_ip': u'10.2.42.1/24', u'tenant_ns_if': u't5ns2if', u'tenant_sub_if': u't5s2if', u'tenant_ns_name': u't5'}], u'subnet_ip': u'2.2.2.0/24', u'vms': [{u'mem': 3, u'name': u't5_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't5br2if1', u'vmif': u't5VM3if1'}]}, {u'local_ip': u'10.2.42.2', u'dsport': 4789, u'dev': u't5s2if', u'tenant_route_ip': u'192.168.133.2', u'remote_route': u'10.1.42.0/24', u'subnet_route': u'10.2.42.0/24', u'v_name': u'vxlan_t5s2', u'id': 42, u'remote_ip': u'10.1.42.2'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t5ns2\" brctl show \"t5br2\" | grep -w 'vxlan_t5s2' ; if [ $? -ne 0 ] ; then ip netns exec \"t5ns2\" brctl addif \"t5br2\" \"vxlan_t5s2\" ; fi\n", "delta": "0:00:00.034834", "end": "2019-12-05 20:53:02.346712", "item": [{"bridge_name": "t5br2", "default_route_ip": "10.2.42.1", "dns": [{"brif": "t5s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t5s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t5ns2", "route": [{"if": "p1", "ip": "10.2.42.1/24", "ns_if": "t5if", "ns_name": "t5"}], "subnet_ip": "2.2.2.0/24", "tenant_ns": [{"tenant_ns_if": "t5ns2if", "tenant_ns_ip": "10.2.42.1/24", "tenant_ns_name": "t5", "tenant_sub_if": "t5s2if", "tenant_sub_ip": "10.2.42.2/24"}], "vms": [{"brif": "t5br2if1", "disk": "10G", "mem": 3, "name": "t5_VM3", "vcpu": 2, "vmif": "t5VM3if1"}]}, {"dev": "t5s2if", "dsport": 4789, "id": 42, "local_ip": "10.2.42.2", "remote_ip": "10.1.42.2", "remote_route": "10.1.42.0/24", "subnet_route": "10.2.42.0/24", "tenant_route_ip": "192.168.133.2", "v_name": "vxlan_t5s2"}], "rc": 0, "start": "2019-12-05 20:53:02.311878", "stderr": "", "stderr_lines": [], "stdout": "\t\t\t\t\t\t\tvxlan_t5s2", "stdout_lines": ["\t\t\t\t\t\t\tvxlan_t5s2"]}

PLAY RECAP **************************************************************************************************************************************************
99.99.99.2                 : ok=21   changed=19   unreachable=0    failed=0    skipped=0    rescued=0    ignored=0   

Using /etc/ansible/ansible.cfg as config file

PLAY [main] *************************************************************************************************************************************************

TASK [Add VXLAN routes in PNS] ******************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.41.1/24', u'ns_name': u't5', u'ns_if': u't5if', u'if': u'p1'}], u'default_route_ip': u'10.1.41.1', u'bridge_name': u't5br1', u'dns': [{u'dnsif': u't5s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't5s1_dnsbrif'}], u'ns_name': u't5ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.41.2/24', u'tenant_ns_ip': u'10.1.41.1/24', u'tenant_ns_if': u't5ns1if', u'tenant_sub_if': u't5s1if', u'tenant_ns_name': u't5'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't5_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't5br1if1', u'vmif': u't5VM1if1'}, {u'mem': 4, u'name': u't5_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't5br1if2', u'vmif': u't5VM2if1'}]}, {u'local_ip': u'10.1.41.2', u'dsport': 4789, u'dev': u't5s1if', u'tenant_route_ip': u'192.168.5.2', u'remote_route': u'10.2.41.0/24', u'subnet_route': u'10.1.41.0/24', u'v_name': u'vxlan_t5s1', u'id': 42, u'remote_ip': u'10.2.41.2'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec pns ip route show \"10.1.41.0/24\" via \"192.168.5.2\" | grep -w '^10.1.41.0/24' ; if [ $? -ne 0 ] ; then ip netns exec pns ip route add \"10.1.41.0/24\" via \"192.168.5.2\" ; fi\n", "delta": "0:00:00.040472", "end": "2019-12-05 20:53:03.554976", "item": [{"bridge_name": "t5br1", "default_route_ip": "10.1.41.1", "dns": [{"brif": "t5s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.5", "dnsif": "t5s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t5ns1", "route": [{"if": "p1", "ip": "10.1.41.1/24", "ns_if": "t5if", "ns_name": "t5"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t5ns1if", "tenant_ns_ip": "10.1.41.1/24", "tenant_ns_name": "t5", "tenant_sub_if": "t5s1if", "tenant_sub_ip": "10.1.41.2/24"}], "vms": [{"brif": "t5br1if1", "disk": "10G", "mem": 2, "name": "t5_VM1", "vcpu": 4, "vmif": "t5VM1if1"}, {"brif": "t5br1if2", "disk": "10G", "mem": 4, "name": "t5_VM2", "vcpu": 2, "vmif": "t5VM2if1"}]}, {"dev": "t5s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.41.2", "remote_ip": "10.2.41.2", "remote_route": "10.2.41.0/24", "subnet_route": "10.1.41.0/24", "tenant_route_ip": "192.168.5.2", "v_name": "vxlan_t5s1"}], "rc": 0, "start": "2019-12-05 20:53:03.514504", "stderr": "", "stderr_lines": [], "stdout": "10.1.41.0/24 dev t5pns_if ", "stdout_lines": ["10.1.41.0/24 dev t5pns_if "]}
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.42.1/24', u'ns_name': u't5', u'ns_if': u't5if', u'if': u'p1'}], u'default_route_ip': u'10.1.42.1', u'bridge_name': u't5br2', u'dns': [{u'dnsif': [], u'dhcp_start': [], u'dhcp_end': [], u'dnsif_ip': [], u'net_mask': [], u'brif': []}], u'ns_name': u't5ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.42.2/24', u'tenant_ns_ip': u'10.1.42.1/24', u'tenant_ns_if': u't5ns2if', u'tenant_sub_if': u't5s2if', u'tenant_ns_name': u't5'}], u'subnet_ip': u'2.2.2.0/24', u'vms': [{u'mem': [], u'name': u'JOKER', u'vcpu': [], u'disk': [], u'brif': [], u'vmif': []}]}, {u'local_ip': u'10.1.42.2', u'dsport': 4789, u'dev': u't5s2if', u'tenant_route_ip': u'192.168.5.2', u'remote_route': u'10.2.42.0/24', u'subnet_route': u'10.1.42.0/24', u'v_name': u'vxlan_t5s2', u'id': 42, u'remote_ip': u'10.2.42.2'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec pns ip route show \"10.1.42.0/24\" via \"192.168.5.2\" | grep -w '^10.1.42.0/24' ; if [ $? -ne 0 ] ; then ip netns exec pns ip route add \"10.1.42.0/24\" via \"192.168.5.2\" ; fi\n", "delta": "0:00:00.044563", "end": "2019-12-05 20:53:03.891019", "item": [{"bridge_name": "t5br2", "default_route_ip": "10.1.42.1", "dns": [{"brif": [], "dhcp_end": [], "dhcp_start": [], "dnsif": [], "dnsif_ip": [], "net_mask": []}], "ns_name": "t5ns2", "route": [{"if": "p1", "ip": "10.1.42.1/24", "ns_if": "t5if", "ns_name": "t5"}], "subnet_ip": "2.2.2.0/24", "tenant_ns": [{"tenant_ns_if": "t5ns2if", "tenant_ns_ip": "10.1.42.1/24", "tenant_ns_name": "t5", "tenant_sub_if": "t5s2if", "tenant_sub_ip": "10.1.42.2/24"}], "vms": [{"brif": [], "disk": [], "mem": [], "name": "JOKER", "vcpu": [], "vmif": []}]}, {"dev": "t5s2if", "dsport": 4789, "id": 42, "local_ip": "10.1.42.2", "remote_ip": "10.2.42.2", "remote_route": "10.2.42.0/24", "subnet_route": "10.1.42.0/24", "tenant_route_ip": "192.168.5.2", "v_name": "vxlan_t5s2"}], "rc": 0, "start": "2019-12-05 20:53:03.846456", "stderr": "", "stderr_lines": [], "stdout": "10.1.42.0/24 dev t5pns_if ", "stdout_lines": ["10.1.42.0/24 dev t5pns_if "]}

TASK [Get PNS ip address] ***********************************************************************************************************************************
ok: [localhost] => {"changed": false, "cmd": "ip netns exec pns ip addr show p1 | awk 'FNR==3{ print $2 }' | awk -F/ '{ print $1 }'\n", "delta": "0:00:00.037495", "end": "2019-12-05 20:53:04.247327", "rc": 0, "start": "2019-12-05 20:53:04.209832", "stderr": "", "stderr_lines": [], "stdout": "192.168.100.238", "stdout_lines": ["192.168.100.238"]}

TASK [Add VXLAN routes to host] *****************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.41.1/24', u'ns_name': u't5', u'ns_if': u't5if', u'if': u'p1'}], u'default_route_ip': u'10.1.41.1', u'bridge_name': u't5br1', u'dns': [{u'dnsif': u't5s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't5s1_dnsbrif'}], u'ns_name': u't5ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.41.2/24', u'tenant_ns_ip': u'10.1.41.1/24', u'tenant_ns_if': u't5ns1if', u'tenant_sub_if': u't5s1if', u'tenant_ns_name': u't5'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't5_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't5br1if1', u'vmif': u't5VM1if1'}, {u'mem': 4, u'name': u't5_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't5br1if2', u'vmif': u't5VM2if1'}]}, {u'local_ip': u'10.1.41.2', u'dsport': 4789, u'dev': u't5s1if', u'tenant_route_ip': u'192.168.5.2', u'remote_route': u'10.2.41.0/24', u'subnet_route': u'10.1.41.0/24', u'v_name': u'vxlan_t5s1', u'id': 42, u'remote_ip': u'10.2.41.2'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip route show \"10.1.41.0/24\" via \"192.168.100.238\" | grep -w '^10.1.41.0/24' ; if [ $? -ne 0 ] ; then ip route add \"10.1.41.0/24\" via \"192.168.100.238\" ; fi\nip route show \"10.2.41.0/24\" via 99.99.99.2 | grep -w '^10.2.41.0/24'; if [ $? -ne 0 ] ; then ip route add \"10.2.41.0/24\" via 99.99.99.2 ; fi\n", "delta": "0:00:00.010133", "end": "2019-12-05 20:53:04.598577", "item": [{"bridge_name": "t5br1", "default_route_ip": "10.1.41.1", "dns": [{"brif": "t5s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.5", "dnsif": "t5s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t5ns1", "route": [{"if": "p1", "ip": "10.1.41.1/24", "ns_if": "t5if", "ns_name": "t5"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t5ns1if", "tenant_ns_ip": "10.1.41.1/24", "tenant_ns_name": "t5", "tenant_sub_if": "t5s1if", "tenant_sub_ip": "10.1.41.2/24"}], "vms": [{"brif": "t5br1if1", "disk": "10G", "mem": 2, "name": "t5_VM1", "vcpu": 4, "vmif": "t5VM1if1"}, {"brif": "t5br1if2", "disk": "10G", "mem": 4, "name": "t5_VM2", "vcpu": 2, "vmif": "t5VM2if1"}]}, {"dev": "t5s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.41.2", "remote_ip": "10.2.41.2", "remote_route": "10.2.41.0/24", "subnet_route": "10.1.41.0/24", "tenant_route_ip": "192.168.5.2", "v_name": "vxlan_t5s1"}], "rc": 0, "start": "2019-12-05 20:53:04.588444", "stderr": "", "stderr_lines": [], "stdout": "10.1.41.0/24 dev testBR \n10.2.41.0/24 dev ens4 ", "stdout_lines": ["10.1.41.0/24 dev testBR ", "10.2.41.0/24 dev ens4 "]}
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.42.1/24', u'ns_name': u't5', u'ns_if': u't5if', u'if': u'p1'}], u'default_route_ip': u'10.1.42.1', u'bridge_name': u't5br2', u'dns': [{u'dnsif': [], u'dhcp_start': [], u'dhcp_end': [], u'dnsif_ip': [], u'net_mask': [], u'brif': []}], u'ns_name': u't5ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.42.2/24', u'tenant_ns_ip': u'10.1.42.1/24', u'tenant_ns_if': u't5ns2if', u'tenant_sub_if': u't5s2if', u'tenant_ns_name': u't5'}], u'subnet_ip': u'2.2.2.0/24', u'vms': [{u'mem': [], u'name': u'JOKER', u'vcpu': [], u'disk': [], u'brif': [], u'vmif': []}]}, {u'local_ip': u'10.1.42.2', u'dsport': 4789, u'dev': u't5s2if', u'tenant_route_ip': u'192.168.5.2', u'remote_route': u'10.2.42.0/24', u'subnet_route': u'10.1.42.0/24', u'v_name': u'vxlan_t5s2', u'id': 42, u'remote_ip': u'10.2.42.2'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip route show \"10.1.42.0/24\" via \"192.168.100.238\" | grep -w '^10.1.42.0/24' ; if [ $? -ne 0 ] ; then ip route add \"10.1.42.0/24\" via \"192.168.100.238\" ; fi\nip route show \"10.2.42.0/24\" via 99.99.99.2 | grep -w '^10.2.42.0/24'; if [ $? -ne 0 ] ; then ip route add \"10.2.42.0/24\" via 99.99.99.2 ; fi\n", "delta": "0:00:00.007418", "end": "2019-12-05 20:53:04.864724", "item": [{"bridge_name": "t5br2", "default_route_ip": "10.1.42.1", "dns": [{"brif": [], "dhcp_end": [], "dhcp_start": [], "dnsif": [], "dnsif_ip": [], "net_mask": []}], "ns_name": "t5ns2", "route": [{"if": "p1", "ip": "10.1.42.1/24", "ns_if": "t5if", "ns_name": "t5"}], "subnet_ip": "2.2.2.0/24", "tenant_ns": [{"tenant_ns_if": "t5ns2if", "tenant_ns_ip": "10.1.42.1/24", "tenant_ns_name": "t5", "tenant_sub_if": "t5s2if", "tenant_sub_ip": "10.1.42.2/24"}], "vms": [{"brif": [], "disk": [], "mem": [], "name": "JOKER", "vcpu": [], "vmif": []}]}, {"dev": "t5s2if", "dsport": 4789, "id": 42, "local_ip": "10.1.42.2", "remote_ip": "10.2.42.2", "remote_route": "10.2.42.0/24", "subnet_route": "10.1.42.0/24", "tenant_route_ip": "192.168.5.2", "v_name": "vxlan_t5s2"}], "rc": 0, "start": "2019-12-05 20:53:04.857306", "stderr": "", "stderr_lines": [], "stdout": "10.1.42.0/24 dev testBR \n10.2.42.0/24 dev ens4 ", "stdout_lines": ["10.1.42.0/24 dev testBR ", "10.2.42.0/24 dev ens4 "]}

PLAY RECAP **************************************************************************************************************************************************
localhost                  : ok=3    changed=2    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0   

Using /etc/ansible/ansible.cfg as config file

PLAY [worker] ***********************************************************************************************************************************************

TASK [Add VXLAN routes in PNS] ******************************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.41.1/24', u'ns_name': u't5', u'ns_if': u't5if', u'if': u'p1'}], u'default_route_ip': u'10.2.41.1', u'bridge_name': u't5br1', u'dns': [{u'dnsif': u't5s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't5s1_dnsbrif'}], u'ns_name': u't5ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.41.2/24', u'tenant_ns_ip': u'10.2.41.1/24', u'tenant_ns_if': u't5ns1if', u'tenant_sub_if': u't5s1if', u'tenant_ns_name': u't5'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't5_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't5br1if1', u'vmif': u't5VM4if1'}]}, {u'local_ip': u'10.2.41.2', u'dsport': 4789, u'dev': u't5s1if', u'tenant_route_ip': u'192.168.133.2', u'remote_route': u'10.1.41.0/24', u'subnet_route': u'10.2.41.0/24', u'v_name': u'vxlan_t5s1', u'id': 42, u'remote_ip': u'10.1.41.2'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec pns ip route show \"10.2.41.0/24\" via \"192.168.133.2\" | grep -w '^10.2.41.0/24' ; if [ $? -ne 0 ] ; then ip netns exec pns ip route add \"10.2.41.0/24\" via \"192.168.133.2\" ; fi\n", "delta": "0:00:00.038095", "end": "2019-12-05 20:53:06.162809", "item": [{"bridge_name": "t5br1", "default_route_ip": "10.2.41.1", "dns": [{"brif": "t5s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.5", "dnsif": "t5s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t5ns1", "route": [{"if": "p1", "ip": "10.2.41.1/24", "ns_if": "t5if", "ns_name": "t5"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t5ns1if", "tenant_ns_ip": "10.2.41.1/24", "tenant_ns_name": "t5", "tenant_sub_if": "t5s1if", "tenant_sub_ip": "10.2.41.2/24"}], "vms": [{"brif": "t5br1if1", "disk": "10G", "mem": 2, "name": "t5_VM4", "vcpu": 4, "vmif": "t5VM4if1"}]}, {"dev": "t5s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.41.2", "remote_ip": "10.1.41.2", "remote_route": "10.1.41.0/24", "subnet_route": "10.2.41.0/24", "tenant_route_ip": "192.168.133.2", "v_name": "vxlan_t5s1"}], "rc": 0, "start": "2019-12-05 20:53:06.124714", "stderr": "", "stderr_lines": [], "stdout": "10.2.41.0/24 dev t5pns_if ", "stdout_lines": ["10.2.41.0/24 dev t5pns_if "]}
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.42.1/24', u'ns_name': u't5', u'ns_if': u't5if', u'if': u'p1'}], u'default_route_ip': u'10.2.42.1', u'bridge_name': u't5br2', u'dns': [{u'dnsif': u't5s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't5s2_dnsbrif'}], u'ns_name': u't5ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.42.2/24', u'tenant_ns_ip': u'10.2.42.1/24', u'tenant_ns_if': u't5ns2if', u'tenant_sub_if': u't5s2if', u'tenant_ns_name': u't5'}], u'subnet_ip': u'2.2.2.0/24', u'vms': [{u'mem': 3, u'name': u't5_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't5br2if1', u'vmif': u't5VM3if1'}]}, {u'local_ip': u'10.2.42.2', u'dsport': 4789, u'dev': u't5s2if', u'tenant_route_ip': u'192.168.133.2', u'remote_route': u'10.1.42.0/24', u'subnet_route': u'10.2.42.0/24', u'v_name': u'vxlan_t5s2', u'id': 42, u'remote_ip': u'10.1.42.2'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec pns ip route show \"10.2.42.0/24\" via \"192.168.133.2\" | grep -w '^10.2.42.0/24' ; if [ $? -ne 0 ] ; then ip netns exec pns ip route add \"10.2.42.0/24\" via \"192.168.133.2\" ; fi\n", "delta": "0:00:00.036674", "end": "2019-12-05 20:53:06.610686", "item": [{"bridge_name": "t5br2", "default_route_ip": "10.2.42.1", "dns": [{"brif": "t5s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t5s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t5ns2", "route": [{"if": "p1", "ip": "10.2.42.1/24", "ns_if": "t5if", "ns_name": "t5"}], "subnet_ip": "2.2.2.0/24", "tenant_ns": [{"tenant_ns_if": "t5ns2if", "tenant_ns_ip": "10.2.42.1/24", "tenant_ns_name": "t5", "tenant_sub_if": "t5s2if", "tenant_sub_ip": "10.2.42.2/24"}], "vms": [{"brif": "t5br2if1", "disk": "10G", "mem": 3, "name": "t5_VM3", "vcpu": 2, "vmif": "t5VM3if1"}]}, {"dev": "t5s2if", "dsport": 4789, "id": 42, "local_ip": "10.2.42.2", "remote_ip": "10.1.42.2", "remote_route": "10.1.42.0/24", "subnet_route": "10.2.42.0/24", "tenant_route_ip": "192.168.133.2", "v_name": "vxlan_t5s2"}], "rc": 0, "start": "2019-12-05 20:53:06.574012", "stderr": "", "stderr_lines": [], "stdout": "10.2.42.0/24 dev t5pns_if ", "stdout_lines": ["10.2.42.0/24 dev t5pns_if "]}

TASK [Get PNS ip address] ***********************************************************************************************************************************
ok: [99.99.99.2] => {"changed": false, "cmd": "ip netns exec pns ip addr show p1 | awk 'FNR==3{ print $2 }' | awk -F/ '{ print $1 }'\n", "delta": "0:00:00.046749", "end": "2019-12-05 20:53:07.067659", "rc": 0, "start": "2019-12-05 20:53:07.020910", "stderr": "", "stderr_lines": [], "stdout": "192.168.100.50", "stdout_lines": ["192.168.100.50"]}

TASK [Add VXLAN routes to host] *****************************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.41.1/24', u'ns_name': u't5', u'ns_if': u't5if', u'if': u'p1'}], u'default_route_ip': u'10.2.41.1', u'bridge_name': u't5br1', u'dns': [{u'dnsif': u't5s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't5s1_dnsbrif'}], u'ns_name': u't5ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.41.2/24', u'tenant_ns_ip': u'10.2.41.1/24', u'tenant_ns_if': u't5ns1if', u'tenant_sub_if': u't5s1if', u'tenant_ns_name': u't5'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't5_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't5br1if1', u'vmif': u't5VM4if1'}]}, {u'local_ip': u'10.2.41.2', u'dsport': 4789, u'dev': u't5s1if', u'tenant_route_ip': u'192.168.133.2', u'remote_route': u'10.1.41.0/24', u'subnet_route': u'10.2.41.0/24', u'v_name': u'vxlan_t5s1', u'id': 42, u'remote_ip': u'10.1.41.2'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip route show \"10.2.41.0/24\" via \"192.168.100.50\" | grep -w '^10.2.41.0/24' ; if [ $? -ne 0 ] ; then ip route add \"10.2.41.0/24\" via \"192.168.100.50\" ; fi\nip route show \"10.1.41.0/24\" via 99.99.99.1 | grep -w '^10.1.41.0/24'; if [ $? -ne 0 ] ; then ip route add \"10.1.41.0/24\" via 99.99.99.1 ; fi\n", "delta": "0:00:00.006621", "end": "2019-12-05 20:53:07.511905", "item": [{"bridge_name": "t5br1", "default_route_ip": "10.2.41.1", "dns": [{"brif": "t5s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.5", "dnsif": "t5s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t5ns1", "route": [{"if": "p1", "ip": "10.2.41.1/24", "ns_if": "t5if", "ns_name": "t5"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t5ns1if", "tenant_ns_ip": "10.2.41.1/24", "tenant_ns_name": "t5", "tenant_sub_if": "t5s1if", "tenant_sub_ip": "10.2.41.2/24"}], "vms": [{"brif": "t5br1if1", "disk": "10G", "mem": 2, "name": "t5_VM4", "vcpu": 4, "vmif": "t5VM4if1"}]}, {"dev": "t5s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.41.2", "remote_ip": "10.1.41.2", "remote_route": "10.1.41.0/24", "subnet_route": "10.2.41.0/24", "tenant_route_ip": "192.168.133.2", "v_name": "vxlan_t5s1"}], "rc": 0, "start": "2019-12-05 20:53:07.505284", "stderr": "", "stderr_lines": [], "stdout": "10.2.41.0/24 dev testBR \n10.1.41.0/24 dev ens4 ", "stdout_lines": ["10.2.41.0/24 dev testBR ", "10.1.41.0/24 dev ens4 "]}
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.42.1/24', u'ns_name': u't5', u'ns_if': u't5if', u'if': u'p1'}], u'default_route_ip': u'10.2.42.1', u'bridge_name': u't5br2', u'dns': [{u'dnsif': u't5s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't5s2_dnsbrif'}], u'ns_name': u't5ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.42.2/24', u'tenant_ns_ip': u'10.2.42.1/24', u'tenant_ns_if': u't5ns2if', u'tenant_sub_if': u't5s2if', u'tenant_ns_name': u't5'}], u'subnet_ip': u'2.2.2.0/24', u'vms': [{u'mem': 3, u'name': u't5_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't5br2if1', u'vmif': u't5VM3if1'}]}, {u'local_ip': u'10.2.42.2', u'dsport': 4789, u'dev': u't5s2if', u'tenant_route_ip': u'192.168.133.2', u'remote_route': u'10.1.42.0/24', u'subnet_route': u'10.2.42.0/24', u'v_name': u'vxlan_t5s2', u'id': 42, u'remote_ip': u'10.1.42.2'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip route show \"10.2.42.0/24\" via \"192.168.100.50\" | grep -w '^10.2.42.0/24' ; if [ $? -ne 0 ] ; then ip route add \"10.2.42.0/24\" via \"192.168.100.50\" ; fi\nip route show \"10.1.42.0/24\" via 99.99.99.1 | grep -w '^10.1.42.0/24'; if [ $? -ne 0 ] ; then ip route add \"10.1.42.0/24\" via 99.99.99.1 ; fi\n", "delta": "0:00:00.006062", "end": "2019-12-05 20:53:07.910509", "item": [{"bridge_name": "t5br2", "default_route_ip": "10.2.42.1", "dns": [{"brif": "t5s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t5s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t5ns2", "route": [{"if": "p1", "ip": "10.2.42.1/24", "ns_if": "t5if", "ns_name": "t5"}], "subnet_ip": "2.2.2.0/24", "tenant_ns": [{"tenant_ns_if": "t5ns2if", "tenant_ns_ip": "10.2.42.1/24", "tenant_ns_name": "t5", "tenant_sub_if": "t5s2if", "tenant_sub_ip": "10.2.42.2/24"}], "vms": [{"brif": "t5br2if1", "disk": "10G", "mem": 3, "name": "t5_VM3", "vcpu": 2, "vmif": "t5VM3if1"}]}, {"dev": "t5s2if", "dsport": 4789, "id": 42, "local_ip": "10.2.42.2", "remote_ip": "10.1.42.2", "remote_route": "10.1.42.0/24", "subnet_route": "10.2.42.0/24", "tenant_route_ip": "192.168.133.2", "v_name": "vxlan_t5s2"}], "rc": 0, "start": "2019-12-05 20:53:07.904447", "stderr": "", "stderr_lines": [], "stdout": "10.2.42.0/24 dev testBR \n10.1.42.0/24 dev ens4 ", "stdout_lines": ["10.2.42.0/24 dev testBR ", "10.1.42.0/24 dev ens4 "]}

PLAY RECAP **************************************************************************************************************************************************
99.99.99.2                 : ok=3    changed=2    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0   

Using /etc/ansible/ansible.cfg as config file

PLAY [main] *************************************************************************************************************************************************

TASK [Detach Interface] *************************************************************************************************************************************
changed: [localhost] => (item=[{u'ns_name': u't5ns1', u'bridge_name': u't5br1'}, {u'vmif_m': u't5VM2if1_m', u'vm_mac': u'52:54:00:8b:e1:87', u'name': u't5_VM2', u'vmif': u't5VM2if1', u'brif_m': u't5br1if2_m'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "virsh domiflist \"t5_VM2\" | grep -w \"t5VM2if1\" ; if [ $? -eq 0 ] ; then virsh detach-interface --domain \"t5_VM2\" --type direct --config ; fi\n", "delta": "0:00:00.059338", "end": "2019-12-05 20:53:09.181409", "item": [{"bridge_name": "t5br1", "ns_name": "t5ns1"}, {"brif_m": "t5br1if2_m", "name": "t5_VM2", "vm_mac": "52:54:00:8b:e1:87", "vmif": "t5VM2if1", "vmif_m": "t5VM2if1_m"}], "rc": 0, "start": "2019-12-05 20:53:09.122071", "stderr": "", "stderr_lines": [], "stdout": "macvtap5   direct     t5VM2if1   rtl8139     52:54:00:8b:e1:87\nInterface detached successfully", "stdout_lines": ["macvtap5   direct     t5VM2if1   rtl8139     52:54:00:8b:e1:87", "Interface detached successfully"]}

TASK [Shutdown VMs] *****************************************************************************************************************************************
changed: [localhost] => (item=[{u'ns_name': u't5ns1', u'bridge_name': u't5br1'}, {u'vmif_m': u't5VM2if1_m', u'vm_mac': u'52:54:00:8b:e1:87', u'name': u't5_VM2', u'vmif': u't5VM2if1', u'brif_m': u't5br1if2_m'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "virsh list --state-shutoff | grep -w \"t5_VM2\" ; if [ $? -ne 0 ] ; then virsh shutdown \"t5_VM2\" ; fi\n", "delta": "0:00:00.197051", "end": "2019-12-05 20:53:09.659379", "item": [{"bridge_name": "t5br1", "ns_name": "t5ns1"}, {"brif_m": "t5br1if2_m", "name": "t5_VM2", "vm_mac": "52:54:00:8b:e1:87", "vmif": "t5VM2if1", "vmif_m": "t5VM2if1_m"}], "rc": 0, "start": "2019-12-05 20:53:09.462328", "stderr": "", "stderr_lines": [], "stdout": "Domain t5_VM2 is being shutdown", "stdout_lines": ["Domain t5_VM2 is being shutdown"]}

TASK [Remove TEMP files] ************************************************************************************************************************************
changed: [localhost] => {"changed": true, "path": "/root/.ansible/tmp/", "state": "absent"}

PLAY [worker] ***********************************************************************************************************************************************

TASK [Remove TEMP files] ************************************************************************************************************************************
changed: [99.99.99.2] => {"changed": true, "path": "/root/.ansible/tmp/", "state": "absent"}

TASK [Migrate VM images] ************************************************************************************************************************************
FAILED - RETRYING: Migrate VM images (3 retries left).
changed: [99.99.99.2] => (item=[{u'ns_name': u't5ns1', u'bridge_name': u't5br1'}, {u'vmif_m': u't5VM2if1_m', u'vm_mac': u'52:54:00:8b:e1:87', u'name': u't5_VM2', u'vmif': u't5VM2if1', u'brif_m': u't5br1if2_m'}]) => {"ansible_loop_var": "item", "attempts": 2, "changed": true, "checksum": "3aa28fd23d403fa08953e04b109a0c2afc8db093", "dest": "/var/lib/libvirt/images/t5_VM2.qcow2", "gid": 0, "group": "root", "item": [{"bridge_name": "t5br1", "ns_name": "t5ns1"}, {"brif_m": "t5br1if2_m", "name": "t5_VM2", "vm_mac": "52:54:00:8b:e1:87", "vmif": "t5VM2if1", "vmif_m": "t5VM2if1_m"}], "md5sum": "4406e02e5dfc57299d77bacf2ea98da3", "mode": "0644", "owner": "root", "size": 10739318784, "src": "/root/.ansible/tmp/ansible-tmp-1575579190.74-21240685850435/source", "state": "file", "uid": 0}

TASK [Migrate VM templates] *********************************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'ns_name': u't5ns1', u'bridge_name': u't5br1'}, {u'vmif_m': u't5VM2if1_m', u'vm_mac': u'52:54:00:8b:e1:87', u'name': u't5_VM2', u'vmif': u't5VM2if1', u'brif_m': u't5br1if2_m'}]) => {"ansible_loop_var": "item", "changed": true, "checksum": "890f0ae294b7791b905266a3d5b3e50a43dab739", "dest": "/etc/libvirt/qemu/t5_VM2.xml", "gid": 0, "group": "root", "item": [{"bridge_name": "t5br1", "ns_name": "t5ns1"}, {"brif_m": "t5br1if2_m", "name": "t5_VM2", "vm_mac": "52:54:00:8b:e1:87", "vmif": "t5VM2if1", "vmif_m": "t5VM2if1_m"}], "md5sum": "16a09fc69b408c3527dfdbf3209b0514", "mode": "0644", "owner": "root", "size": 4252, "src": "/root/.ansible/tmp/ansible-tmp-1575579744.83-273829010279356/source", "state": "file", "uid": 0}

TASK [Get list of running VMs] ******************************************************************************************************************************
ok: [99.99.99.2] => {"changed": false, "cmd": ["virsh", "list", "--name"], "delta": "0:00:00.024771", "end": "2019-12-05 21:02:25.776060", "rc": 0, "start": "2019-12-05 21:02:25.751289", "stderr": "", "stderr_lines": [], "stdout": "t3_VM2\nt4_VM2\nt5_VM4\nt5_VM3", "stdout_lines": ["t3_VM2", "t4_VM2", "t5_VM4", "t5_VM3"]}

TASK [Define VM] ********************************************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'ns_name': u't5ns1', u'bridge_name': u't5br1'}, {u'vmif_m': u't5VM2if1_m', u'vm_mac': u'52:54:00:8b:e1:87', u'name': u't5_VM2', u'vmif': u't5VM2if1', u'brif_m': u't5br1if2_m'}]) => {"ansible_loop_var": "item", "changed": true, "created": "t5_VM2", "item": [{"bridge_name": "t5br1", "ns_name": "t5ns1"}, {"brif_m": "t5br1if2_m", "name": "t5_VM2", "vm_mac": "52:54:00:8b:e1:87", "vmif": "t5VM2if1", "vmif_m": "t5VM2if1_m"}], "warnings": ["'xml' is given - ignoring 'name'"]}

TASK [Create VM] ********************************************************************************************************************************************
ok: [99.99.99.2] => (item=[{u'ns_name': u't5ns1', u'bridge_name': u't5br1'}, {u'vmif_m': u't5VM2if1_m', u'vm_mac': u'52:54:00:8b:e1:87', u'name': u't5_VM2', u'vmif': u't5VM2if1', u'brif_m': u't5br1if2_m'}]) => {"ansible_loop_var": "item", "changed": false, "create": 0, "item": [{"bridge_name": "t5br1", "ns_name": "t5ns1"}, {"brif_m": "t5br1if2_m", "name": "t5_VM2", "vm_mac": "52:54:00:8b:e1:87", "vmif": "t5VM2if1", "vmif_m": "t5VM2if1_m"}]}

TASK [Start VM] *********************************************************************************************************************************************
ok: [99.99.99.2] => (item=[{u'ns_name': u't5ns1', u'bridge_name': u't5br1'}, {u'vmif_m': u't5VM2if1_m', u'vm_mac': u'52:54:00:8b:e1:87', u'name': u't5_VM2', u'vmif': u't5VM2if1', u'brif_m': u't5br1if2_m'}]) => {"ansible_loop_var": "item", "changed": false, "item": [{"bridge_name": "t5br1", "ns_name": "t5ns1"}, {"brif_m": "t5br1if2_m", "name": "t5_VM2", "vm_mac": "52:54:00:8b:e1:87", "vmif": "t5VM2if1", "vmif_m": "t5VM2if1_m"}]}

TASK [Create VETH Pairs] ************************************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'ns_name': u't5ns1', u'bridge_name': u't5br1'}, {u'vmif_m': u't5VM2if1_m', u'vm_mac': u'52:54:00:8b:e1:87', u'name': u't5_VM2', u'vmif': u't5VM2if1', u'brif_m': u't5br1if2_m'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip link show \"t5br1if2_m\" ; if [ $? -ne 0 ] ; then ip link add \"t5VM2if1_m\" type veth peer name \"t5br1if2_m\" ; fi\nip link set dev \"t5br1if2_m\" up\nip link set dev \"t5VM2if1_m\" up\n", "delta": "0:00:00.025995", "end": "2019-12-05 21:02:28.303138", "item": [{"bridge_name": "t5br1", "ns_name": "t5ns1"}, {"brif_m": "t5br1if2_m", "name": "t5_VM2", "vm_mac": "52:54:00:8b:e1:87", "vmif": "t5VM2if1", "vmif_m": "t5VM2if1_m"}], "rc": 0, "start": "2019-12-05 21:02:28.277143", "stderr": "Device \"t5br1if2_m\" does not exist.", "stderr_lines": ["Device \"t5br1if2_m\" does not exist."], "stdout": "", "stdout_lines": []}

TASK [Attach VETH Pairs] ************************************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'ns_name': u't5ns1', u'bridge_name': u't5br1'}, {u'vmif_m': u't5VM2if1_m', u'vm_mac': u'52:54:00:8b:e1:87', u'name': u't5_VM2', u'vmif': u't5VM2if1', u'brif_m': u't5br1if2_m'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip link show \"t5br1if2_m\" ; if [ $? -eq 0 ] ; then ip link set \"t5br1if2_m\" netns \"t5ns1\" ; fi\nip netns exec \"t5ns1\" brctl show \"t5br1\" | grep -w 't5br1if2_m' ; if [ $? -ne 0 ] ; then ip netns exec \"t5ns1\" brctl addif \"t5br1\" \"t5br1if2_m\" ; fi\nvirsh domiflist \"t5_VM2\" | grep -w \"t5VM2if1_m\" ; if [ $? -ne 0 ] ; then virsh attach-interface --domain \"t5_VM2\" direct \"t5VM2if1_m\" --live --persistent --mac \"52:54:00:8b:e1:87\" ; fi\n", "delta": "0:00:00.363667", "end": "2019-12-05 21:02:28.978948", "item": [{"bridge_name": "t5br1", "ns_name": "t5ns1"}, {"brif_m": "t5br1if2_m", "name": "t5_VM2", "vm_mac": "52:54:00:8b:e1:87", "vmif": "t5VM2if1", "vmif_m": "t5VM2if1_m"}], "rc": 0, "start": "2019-12-05 21:02:28.615281", "stderr": "", "stderr_lines": [], "stdout": "63: t5br1if2_m@t5VM2if1_m: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP mode DEFAULT group default qlen 1000\n    link/ether 16:58:0e:e9:b5:24 brd ff:ff:ff:ff:ff:ff\nInterface attached successfully", "stdout_lines": ["63: t5br1if2_m@t5VM2if1_m: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP mode DEFAULT group default qlen 1000", "    link/ether 16:58:0e:e9:b5:24 brd ff:ff:ff:ff:ff:ff", "Interface attached successfully"]}

TASK [Make all interfaces UP] *******************************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'ns_name': u't5ns1', u'bridge_name': u't5br1'}, {u'vmif_m': u't5VM2if1_m', u'vm_mac': u'52:54:00:8b:e1:87', u'name': u't5_VM2', u'vmif': u't5VM2if1', u'brif_m': u't5br1if2_m'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t5ns1\" ip link set dev \"t5br1if2_m\" up\nip link set dev \"t5VM2if1_m\" up\n", "delta": "0:00:00.045856", "end": "2019-12-05 21:02:29.351898", "item": [{"bridge_name": "t5br1", "ns_name": "t5ns1"}, {"brif_m": "t5br1if2_m", "name": "t5_VM2", "vm_mac": "52:54:00:8b:e1:87", "vmif": "t5VM2if1", "vmif_m": "t5VM2if1_m"}], "rc": 0, "start": "2019-12-05 21:02:29.306042", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

PLAY [main] *************************************************************************************************************************************************

TASK [pause] ************************************************************************************************************************************************
Pausing for 60 seconds
(ctrl+C then 'C' = continue early, ctrl+C then 'A' = abort)
ok: [localhost] => {"changed": false, "delta": 60, "echo": true, "rc": 0, "start": "2019-12-05 21:02:29.447930", "stderr": "", "stdout": "Paused for 1.0 minutes", "stop": "2019-12-05 21:03:29.448440", "user_input": ""}

TASK [Undefine Migrated VM at C1] ***************************************************************************************************************************
changed: [localhost] => (item=[{u'ns_name': u't5ns1', u'bridge_name': u't5br1'}, {u'vmif_m': u't5VM2if1_m', u'vm_mac': u'52:54:00:8b:e1:87', u'name': u't5_VM2', u'vmif': u't5VM2if1', u'brif_m': u't5br1if2_m'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "virsh undefine \"t5_VM2\"\n", "delta": "0:00:00.026159", "end": "2019-12-05 21:03:29.747703", "item": [{"bridge_name": "t5br1", "ns_name": "t5ns1"}, {"brif_m": "t5br1if2_m", "name": "t5_VM2", "vm_mac": "52:54:00:8b:e1:87", "vmif": "t5VM2if1", "vmif_m": "t5VM2if1_m"}], "rc": 0, "start": "2019-12-05 21:03:29.721544", "stderr": "", "stderr_lines": [], "stdout": "Domain t5_VM2 has been undefined", "stdout_lines": ["Domain t5_VM2 has been undefined"]}

PLAY RECAP **************************************************************************************************************************************************
99.99.99.2                 : ok=10   changed=7    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0   
localhost                  : ok=5    changed=4    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0   

Using /etc/ansible/ansible.cfg as config file

PLAY [worker] ***********************************************************************************************************************************************

TASK [Detach Interface] *************************************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'ns_name': u't5ns1', u'bridge_name': u't5br1'}, {u'vmif_m': u't5VM4if1_m', u'vm_mac': u'52:54:00:7f:d0:83', u'name': u't5_VM4', u'vmif': u't5VM4if1', u'brif_m': u't5br1if1_m'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "virsh domiflist \"t5_VM4\" | grep -w \"t5VM4if1\" ; if [ $? -eq 0 ] ; then virsh detach-interface --domain \"t5_VM4\" --type direct --config ; fi\n", "delta": "0:00:00.056358", "end": "2019-12-05 21:03:32.157884", "item": [{"bridge_name": "t5br1", "ns_name": "t5ns1"}, {"brif_m": "t5br1if1_m", "name": "t5_VM4", "vm_mac": "52:54:00:7f:d0:83", "vmif": "t5VM4if1", "vmif_m": "t5VM4if1_m"}], "rc": 0, "start": "2019-12-05 21:03:32.101526", "stderr": "", "stderr_lines": [], "stdout": "macvtap0   direct     t5VM4if1   rtl8139     52:54:00:7f:d0:83\nInterface detached successfully", "stdout_lines": ["macvtap0   direct     t5VM4if1   rtl8139     52:54:00:7f:d0:83", "Interface detached successfully"]}
changed: [99.99.99.2] => (item=[{u'ns_name': u't5ns2', u'bridge_name': u't5br2'}, {u'vmif_m': u't5VM3if1_m', u'vm_mac': u'52:54:00:2f:a9:53', u'name': u't5_VM3', u'vmif': u't5VM3if1', u'brif_m': u't5br2if1_m'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "virsh domiflist \"t5_VM3\" | grep -w \"t5VM3if1\" ; if [ $? -eq 0 ] ; then virsh detach-interface --domain \"t5_VM3\" --type direct --config ; fi\n", "delta": "0:00:00.057811", "end": "2019-12-05 21:03:32.597702", "item": [{"bridge_name": "t5br2", "ns_name": "t5ns2"}, {"brif_m": "t5br2if1_m", "name": "t5_VM3", "vm_mac": "52:54:00:2f:a9:53", "vmif": "t5VM3if1", "vmif_m": "t5VM3if1_m"}], "rc": 0, "start": "2019-12-05 21:03:32.539891", "stderr": "", "stderr_lines": [], "stdout": "macvtap1   direct     t5VM3if1   rtl8139     52:54:00:2f:a9:53\nInterface detached successfully", "stdout_lines": ["macvtap1   direct     t5VM3if1   rtl8139     52:54:00:2f:a9:53", "Interface detached successfully"]}

TASK [Shutdown VMs] *****************************************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'ns_name': u't5ns1', u'bridge_name': u't5br1'}, {u'vmif_m': u't5VM4if1_m', u'vm_mac': u'52:54:00:7f:d0:83', u'name': u't5_VM4', u'vmif': u't5VM4if1', u'brif_m': u't5br1if1_m'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "virsh list --state-shutoff | grep -w \"t5_VM4\" ; if [ $? -ne 0 ] ; then virsh shutdown \"t5_VM4\" ; fi\n", "delta": "0:00:00.222501", "end": "2019-12-05 21:03:33.223276", "item": [{"bridge_name": "t5br1", "ns_name": "t5ns1"}, {"brif_m": "t5br1if1_m", "name": "t5_VM4", "vm_mac": "52:54:00:7f:d0:83", "vmif": "t5VM4if1", "vmif_m": "t5VM4if1_m"}], "rc": 0, "start": "2019-12-05 21:03:33.000775", "stderr": "", "stderr_lines": [], "stdout": "Domain t5_VM4 is being shutdown", "stdout_lines": ["Domain t5_VM4 is being shutdown"]}
changed: [99.99.99.2] => (item=[{u'ns_name': u't5ns2', u'bridge_name': u't5br2'}, {u'vmif_m': u't5VM3if1_m', u'vm_mac': u'52:54:00:2f:a9:53', u'name': u't5_VM3', u'vmif': u't5VM3if1', u'brif_m': u't5br2if1_m'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "virsh list --state-shutoff | grep -w \"t5_VM3\" ; if [ $? -ne 0 ] ; then virsh shutdown \"t5_VM3\" ; fi\n", "delta": "0:00:00.101637", "end": "2019-12-05 21:03:33.704282", "item": [{"bridge_name": "t5br2", "ns_name": "t5ns2"}, {"brif_m": "t5br2if1_m", "name": "t5_VM3", "vm_mac": "52:54:00:2f:a9:53", "vmif": "t5VM3if1", "vmif_m": "t5VM3if1_m"}], "rc": 0, "start": "2019-12-05 21:03:33.602645", "stderr": "", "stderr_lines": [], "stdout": "Domain t5_VM3 is being shutdown", "stdout_lines": ["Domain t5_VM3 is being shutdown"]}

TASK [Remove TEMP files] ************************************************************************************************************************************
changed: [99.99.99.2] => {"changed": true, "path": "/root/.ansible/tmp/", "state": "absent"}

TASK [Migrate VM images] ************************************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'ns_name': u't5ns1', u'bridge_name': u't5br1'}, {u'vmif_m': u't5VM4if1_m', u'vm_mac': u'52:54:00:7f:d0:83', u'name': u't5_VM4', u'vmif': u't5VM4if1', u'brif_m': u't5br1if1_m'}]) => {"ansible_loop_var": "item", "changed": true, "checksum": "3364c8255dc4a2434a2a00efd9c7b35cb70df851", "dest": "/var/lib/libvirt/images/t5_VM4.qcow2", "item": [{"bridge_name": "t5br1", "ns_name": "t5ns1"}, {"brif_m": "t5br1if1_m", "name": "t5_VM4", "vm_mac": "52:54:00:7f:d0:83", "vmif": "t5VM4if1", "vmif_m": "t5VM4if1_m"}], "md5sum": "2dac22fb5d04ddb4d176324053bc1bf3", "remote_checksum": "fab6939fc7fafe6399fc478997933c1438153707", "remote_md5sum": null}
changed: [99.99.99.2] => (item=[{u'ns_name': u't5ns2', u'bridge_name': u't5br2'}, {u'vmif_m': u't5VM3if1_m', u'vm_mac': u'52:54:00:2f:a9:53', u'name': u't5_VM3', u'vmif': u't5VM3if1', u'brif_m': u't5br2if1_m'}]) => {"ansible_loop_var": "item", "changed": true, "checksum": "fdc913be821f42868fcaa1a9830f9ef7624af1fe", "dest": "/var/lib/libvirt/images/t5_VM3.qcow2", "item": [{"bridge_name": "t5br2", "ns_name": "t5ns2"}, {"brif_m": "t5br2if1_m", "name": "t5_VM3", "vm_mac": "52:54:00:2f:a9:53", "vmif": "t5VM3if1", "vmif_m": "t5VM3if1_m"}], "md5sum": "5892e2ad3fabf1a5cb77818e4bbda33a", "remote_checksum": "fdc913be821f42868fcaa1a9830f9ef7624af1fe", "remote_md5sum": null}

TASK [Migrate VM templates] *********************************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'ns_name': u't5ns1', u'bridge_name': u't5br1'}, {u'vmif_m': u't5VM4if1_m', u'vm_mac': u'52:54:00:7f:d0:83', u'name': u't5_VM4', u'vmif': u't5VM4if1', u'brif_m': u't5br1if1_m'}]) => {"ansible_loop_var": "item", "changed": true, "checksum": "e4848d3a724ae8828b45f49e0a3992af43b7b07b", "dest": "/etc/libvirt/qemu/t5_VM4.xml", "item": [{"bridge_name": "t5br1", "ns_name": "t5ns1"}, {"brif_m": "t5br1if1_m", "name": "t5_VM4", "vm_mac": "52:54:00:7f:d0:83", "vmif": "t5VM4if1", "vmif_m": "t5VM4if1_m"}], "md5sum": "8963e037def2955d85bbcfff35b6534f", "remote_checksum": "e4848d3a724ae8828b45f49e0a3992af43b7b07b", "remote_md5sum": null}
changed: [99.99.99.2] => (item=[{u'ns_name': u't5ns2', u'bridge_name': u't5br2'}, {u'vmif_m': u't5VM3if1_m', u'vm_mac': u'52:54:00:2f:a9:53', u'name': u't5_VM3', u'vmif': u't5VM3if1', u'brif_m': u't5br2if1_m'}]) => {"ansible_loop_var": "item", "changed": true, "checksum": "7fa2e2c42850026ef424fea300c9e5a888483fdf", "dest": "/etc/libvirt/qemu/t5_VM3.xml", "item": [{"bridge_name": "t5br2", "ns_name": "t5ns2"}, {"brif_m": "t5br2if1_m", "name": "t5_VM3", "vm_mac": "52:54:00:2f:a9:53", "vmif": "t5VM3if1", "vmif_m": "t5VM3if1_m"}], "md5sum": "9a271a1e271740553bc3b6a356263271", "remote_checksum": "7fa2e2c42850026ef424fea300c9e5a888483fdf", "remote_md5sum": null}

PLAY [main] *************************************************************************************************************************************************

TASK [Get list of running VMs] ******************************************************************************************************************************
ok: [localhost] => {"changed": false, "cmd": ["virsh", "list", "--name"], "delta": "0:00:00.050442", "end": "2019-12-05 21:14:13.907988", "rc": 0, "start": "2019-12-05 21:14:13.857546", "stderr": "", "stderr_lines": [], "stdout": "t4_VM4\nt4_VM3\nt4_VM1\nt4_VM2\nt5_VM1", "stdout_lines": ["t4_VM4", "t4_VM3", "t4_VM1", "t4_VM2", "t5_VM1"]}

TASK [Define VM] ********************************************************************************************************************************************
changed: [localhost] => (item=[{u'ns_name': u't5ns1', u'bridge_name': u't5br1'}, {u'vmif_m': u't5VM4if1_m', u'vm_mac': u'52:54:00:7f:d0:83', u'name': u't5_VM4', u'vmif': u't5VM4if1', u'brif_m': u't5br1if1_m'}]) => {"ansible_loop_var": "item", "changed": true, "created": "t5_VM4", "item": [{"bridge_name": "t5br1", "ns_name": "t5ns1"}, {"brif_m": "t5br1if1_m", "name": "t5_VM4", "vm_mac": "52:54:00:7f:d0:83", "vmif": "t5VM4if1", "vmif_m": "t5VM4if1_m"}], "warnings": ["'xml' is given - ignoring 'name'"]}
changed: [localhost] => (item=[{u'ns_name': u't5ns2', u'bridge_name': u't5br2'}, {u'vmif_m': u't5VM3if1_m', u'vm_mac': u'52:54:00:2f:a9:53', u'name': u't5_VM3', u'vmif': u't5VM3if1', u'brif_m': u't5br2if1_m'}]) => {"ansible_loop_var": "item", "changed": true, "created": "t5_VM3", "item": [{"bridge_name": "t5br2", "ns_name": "t5ns2"}, {"brif_m": "t5br2if1_m", "name": "t5_VM3", "vm_mac": "52:54:00:2f:a9:53", "vmif": "t5VM3if1", "vmif_m": "t5VM3if1_m"}], "warnings": ["'xml' is given - ignoring 'name'"]}

TASK [Create VM] ********************************************************************************************************************************************
ok: [localhost] => (item=[{u'ns_name': u't5ns1', u'bridge_name': u't5br1'}, {u'vmif_m': u't5VM4if1_m', u'vm_mac': u'52:54:00:7f:d0:83', u'name': u't5_VM4', u'vmif': u't5VM4if1', u'brif_m': u't5br1if1_m'}]) => {"ansible_loop_var": "item", "changed": false, "create": 0, "item": [{"bridge_name": "t5br1", "ns_name": "t5ns1"}, {"brif_m": "t5br1if1_m", "name": "t5_VM4", "vm_mac": "52:54:00:7f:d0:83", "vmif": "t5VM4if1", "vmif_m": "t5VM4if1_m"}]}
ok: [localhost] => (item=[{u'ns_name': u't5ns2', u'bridge_name': u't5br2'}, {u'vmif_m': u't5VM3if1_m', u'vm_mac': u'52:54:00:2f:a9:53', u'name': u't5_VM3', u'vmif': u't5VM3if1', u'brif_m': u't5br2if1_m'}]) => {"ansible_loop_var": "item", "changed": false, "create": 0, "item": [{"bridge_name": "t5br2", "ns_name": "t5ns2"}, {"brif_m": "t5br2if1_m", "name": "t5_VM3", "vm_mac": "52:54:00:2f:a9:53", "vmif": "t5VM3if1", "vmif_m": "t5VM3if1_m"}]}

TASK [Start VM] *********************************************************************************************************************************************
ok: [localhost] => (item=[{u'ns_name': u't5ns1', u'bridge_name': u't5br1'}, {u'vmif_m': u't5VM4if1_m', u'vm_mac': u'52:54:00:7f:d0:83', u'name': u't5_VM4', u'vmif': u't5VM4if1', u'brif_m': u't5br1if1_m'}]) => {"ansible_loop_var": "item", "changed": false, "item": [{"bridge_name": "t5br1", "ns_name": "t5ns1"}, {"brif_m": "t5br1if1_m", "name": "t5_VM4", "vm_mac": "52:54:00:7f:d0:83", "vmif": "t5VM4if1", "vmif_m": "t5VM4if1_m"}]}
ok: [localhost] => (item=[{u'ns_name': u't5ns2', u'bridge_name': u't5br2'}, {u'vmif_m': u't5VM3if1_m', u'vm_mac': u'52:54:00:2f:a9:53', u'name': u't5_VM3', u'vmif': u't5VM3if1', u'brif_m': u't5br2if1_m'}]) => {"ansible_loop_var": "item", "changed": false, "item": [{"bridge_name": "t5br2", "ns_name": "t5ns2"}, {"brif_m": "t5br2if1_m", "name": "t5_VM3", "vm_mac": "52:54:00:2f:a9:53", "vmif": "t5VM3if1", "vmif_m": "t5VM3if1_m"}]}

TASK [Create VETH Pairs] ************************************************************************************************************************************
changed: [localhost] => (item=[{u'ns_name': u't5ns1', u'bridge_name': u't5br1'}, {u'vmif_m': u't5VM4if1_m', u'vm_mac': u'52:54:00:7f:d0:83', u'name': u't5_VM4', u'vmif': u't5VM4if1', u'brif_m': u't5br1if1_m'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip link show \"t5br1if1_m\" ; if [ $? -ne 0 ] ; then ip link add \"t5VM4if1_m\" type veth peer name \"t5br1if1_m\" ; fi\nip link set dev \"t5br1if1_m\" up\nip link set dev \"t5VM4if1_m\" up\n", "delta": "0:00:00.037994", "end": "2019-12-05 21:14:17.610308", "item": [{"bridge_name": "t5br1", "ns_name": "t5ns1"}, {"brif_m": "t5br1if1_m", "name": "t5_VM4", "vm_mac": "52:54:00:7f:d0:83", "vmif": "t5VM4if1", "vmif_m": "t5VM4if1_m"}], "rc": 0, "start": "2019-12-05 21:14:17.572314", "stderr": "Device \"t5br1if1_m\" does not exist.", "stderr_lines": ["Device \"t5br1if1_m\" does not exist."], "stdout": "", "stdout_lines": []}
changed: [localhost] => (item=[{u'ns_name': u't5ns2', u'bridge_name': u't5br2'}, {u'vmif_m': u't5VM3if1_m', u'vm_mac': u'52:54:00:2f:a9:53', u'name': u't5_VM3', u'vmif': u't5VM3if1', u'brif_m': u't5br2if1_m'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip link show \"t5br2if1_m\" ; if [ $? -ne 0 ] ; then ip link add \"t5VM3if1_m\" type veth peer name \"t5br2if1_m\" ; fi\nip link set dev \"t5br2if1_m\" up\nip link set dev \"t5VM3if1_m\" up\n", "delta": "0:00:00.023229", "end": "2019-12-05 21:14:17.826459", "item": [{"bridge_name": "t5br2", "ns_name": "t5ns2"}, {"brif_m": "t5br2if1_m", "name": "t5_VM3", "vm_mac": "52:54:00:2f:a9:53", "vmif": "t5VM3if1", "vmif_m": "t5VM3if1_m"}], "rc": 0, "start": "2019-12-05 21:14:17.803230", "stderr": "Device \"t5br2if1_m\" does not exist.", "stderr_lines": ["Device \"t5br2if1_m\" does not exist."], "stdout": "", "stdout_lines": []}

TASK [Attach VETH Pairs] ************************************************************************************************************************************
changed: [localhost] => (item=[{u'ns_name': u't5ns1', u'bridge_name': u't5br1'}, {u'vmif_m': u't5VM4if1_m', u'vm_mac': u'52:54:00:7f:d0:83', u'name': u't5_VM4', u'vmif': u't5VM4if1', u'brif_m': u't5br1if1_m'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip link show \"t5br1if1_m\" ; if [ $? -eq 0 ] ; then ip link set \"t5br1if1_m\" netns \"t5ns1\" ; fi\nip netns exec \"t5ns1\" brctl show \"t5br1\" | grep -w 't5br1if1_m' ; if [ $? -ne 0 ] ; then ip netns exec \"t5ns1\" brctl addif \"t5br1\" \"t5br1if1_m\" ; fi\nvirsh domiflist \"t5_VM4\" | grep -w \"t5VM4if1_m\" ; if [ $? -ne 0 ] ; then virsh attach-interface --domain \"t5_VM4\" direct \"t5VM4if1_m\" --live --persistent --mac \"52:54:00:7f:d0:83\" ; fi\n", "delta": "0:00:00.364945", "end": "2019-12-05 21:14:18.389271", "item": [{"bridge_name": "t5br1", "ns_name": "t5ns1"}, {"brif_m": "t5br1if1_m", "name": "t5_VM4", "vm_mac": "52:54:00:7f:d0:83", "vmif": "t5VM4if1", "vmif_m": "t5VM4if1_m"}], "rc": 0, "start": "2019-12-05 21:14:18.024326", "stderr": "", "stderr_lines": [], "stdout": "98: t5br1if1_m@t5VM4if1_m: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP mode DEFAULT group default qlen 1000\n    link/ether ea:7e:df:fa:7b:c7 brd ff:ff:ff:ff:ff:ff\nInterface attached successfully", "stdout_lines": ["98: t5br1if1_m@t5VM4if1_m: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP mode DEFAULT group default qlen 1000", "    link/ether ea:7e:df:fa:7b:c7 brd ff:ff:ff:ff:ff:ff", "Interface attached successfully"]}
changed: [localhost] => (item=[{u'ns_name': u't5ns2', u'bridge_name': u't5br2'}, {u'vmif_m': u't5VM3if1_m', u'vm_mac': u'52:54:00:2f:a9:53', u'name': u't5_VM3', u'vmif': u't5VM3if1', u'brif_m': u't5br2if1_m'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip link show \"t5br2if1_m\" ; if [ $? -eq 0 ] ; then ip link set \"t5br2if1_m\" netns \"t5ns2\" ; fi\nip netns exec \"t5ns2\" brctl show \"t5br2\" | grep -w 't5br2if1_m' ; if [ $? -ne 0 ] ; then ip netns exec \"t5ns2\" brctl addif \"t5br2\" \"t5br2if1_m\" ; fi\nvirsh domiflist \"t5_VM3\" | grep -w \"t5VM3if1_m\" ; if [ $? -ne 0 ] ; then virsh attach-interface --domain \"t5_VM3\" direct \"t5VM3if1_m\" --live --persistent --mac \"52:54:00:2f:a9:53\" ; fi\n", "delta": "0:00:00.342353", "end": "2019-12-05 21:14:18.881386", "item": [{"bridge_name": "t5br2", "ns_name": "t5ns2"}, {"brif_m": "t5br2if1_m", "name": "t5_VM3", "vm_mac": "52:54:00:2f:a9:53", "vmif": "t5VM3if1", "vmif_m": "t5VM3if1_m"}], "rc": 0, "start": "2019-12-05 21:14:18.539033", "stderr": "", "stderr_lines": [], "stdout": "100: t5br2if1_m@t5VM3if1_m: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP mode DEFAULT group default qlen 1000\n    link/ether d6:25:68:e9:bc:1f brd ff:ff:ff:ff:ff:ff\nInterface attached successfully", "stdout_lines": ["100: t5br2if1_m@t5VM3if1_m: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP mode DEFAULT group default qlen 1000", "    link/ether d6:25:68:e9:bc:1f brd ff:ff:ff:ff:ff:ff", "Interface attached successfully"]}

TASK [Make all interfaces UP] *******************************************************************************************************************************
changed: [localhost] => (item=[{u'ns_name': u't5ns1', u'bridge_name': u't5br1'}, {u'vmif_m': u't5VM4if1_m', u'vm_mac': u'52:54:00:7f:d0:83', u'name': u't5_VM4', u'vmif': u't5VM4if1', u'brif_m': u't5br1if1_m'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t5ns1\" ip link set dev \"t5br1if1_m\" up\nip link set dev \"t5VM4if1_m\" up\n", "delta": "0:00:00.044499", "end": "2019-12-05 21:14:19.115935", "item": [{"bridge_name": "t5br1", "ns_name": "t5ns1"}, {"brif_m": "t5br1if1_m", "name": "t5_VM4", "vm_mac": "52:54:00:7f:d0:83", "vmif": "t5VM4if1", "vmif_m": "t5VM4if1_m"}], "rc": 0, "start": "2019-12-05 21:14:19.071436", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}
changed: [localhost] => (item=[{u'ns_name': u't5ns2', u'bridge_name': u't5br2'}, {u'vmif_m': u't5VM3if1_m', u'vm_mac': u'52:54:00:2f:a9:53', u'name': u't5_VM3', u'vmif': u't5VM3if1', u'brif_m': u't5br2if1_m'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t5ns2\" ip link set dev \"t5br2if1_m\" up\nip link set dev \"t5VM3if1_m\" up\n", "delta": "0:00:00.046785", "end": "2019-12-05 21:14:19.320150", "item": [{"bridge_name": "t5br2", "ns_name": "t5ns2"}, {"brif_m": "t5br2if1_m", "name": "t5_VM3", "vm_mac": "52:54:00:2f:a9:53", "vmif": "t5VM3if1", "vmif_m": "t5VM3if1_m"}], "rc": 0, "start": "2019-12-05 21:14:19.273365", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

PLAY [worker] ***********************************************************************************************************************************************

TASK [pause] ************************************************************************************************************************************************
Pausing for 60 seconds
(ctrl+C then 'C' = continue early, ctrl+C then 'A' = abort)
ok: [99.99.99.2] => {"changed": false, "delta": 60, "echo": true, "rc": 0, "start": "2019-12-05 21:14:19.400799", "stderr": "", "stdout": "Paused for 1.0 minutes", "stop": "2019-12-05 21:15:19.401361", "user_input": ""}

TASK [Undefine Migrated VM at C2] ***************************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'ns_name': u't5ns1', u'bridge_name': u't5br1'}, {u'vmif_m': u't5VM4if1_m', u'vm_mac': u'52:54:00:7f:d0:83', u'name': u't5_VM4', u'vmif': u't5VM4if1', u'brif_m': u't5br1if1_m'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "virsh undefine \"t5_VM4\"\n", "delta": "0:00:00.053476", "end": "2019-12-05 21:15:20.651555", "item": [{"bridge_name": "t5br1", "ns_name": "t5ns1"}, {"brif_m": "t5br1if1_m", "name": "t5_VM4", "vm_mac": "52:54:00:7f:d0:83", "vmif": "t5VM4if1", "vmif_m": "t5VM4if1_m"}], "rc": 0, "start": "2019-12-05 21:15:20.598079", "stderr": "", "stderr_lines": [], "stdout": "Domain t5_VM4 has been undefined", "stdout_lines": ["Domain t5_VM4 has been undefined"]}
changed: [99.99.99.2] => (item=[{u'ns_name': u't5ns2', u'bridge_name': u't5br2'}, {u'vmif_m': u't5VM3if1_m', u'vm_mac': u'52:54:00:2f:a9:53', u'name': u't5_VM3', u'vmif': u't5VM3if1', u'brif_m': u't5br2if1_m'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "virsh undefine \"t5_VM3\"\n", "delta": "0:00:00.021521", "end": "2019-12-05 21:15:21.044855", "item": [{"bridge_name": "t5br2", "ns_name": "t5ns2"}, {"brif_m": "t5br2if1_m", "name": "t5_VM3", "vm_mac": "52:54:00:2f:a9:53", "vmif": "t5VM3if1", "vmif_m": "t5VM3if1_m"}], "rc": 0, "start": "2019-12-05 21:15:21.023334", "stderr": "", "stderr_lines": [], "stdout": "Domain t5_VM3 has been undefined", "stdout_lines": ["Domain t5_VM3 has been undefined"]}

PLAY RECAP **************************************************************************************************************************************************
99.99.99.2                 : ok=7    changed=6    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0   
localhost                  : ok=7    changed=4    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0   

