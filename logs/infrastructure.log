INFO:root: 12:35:00.153930 Printing the yaml input file
INFO:root: 12:35:00.154085 {'C1': [{'subnet_addr': '1.1.1.0/24', 'VM': [{'name': 'VM1', 'disk': '10G', 'mem': 2, 'vcpu': 4}]}, {'subnet_addr': '2.2.2.0/24', 'VM': [{'name': 'VM3', 'disk': '10G', 'mem': 3, 'vcpu': 2}]}], 'C2': [{'subnet_addr': '1.1.1.0/24', 'VM': [{'name': 'VM4', 'disk': '10G', 'mem': 2, 'vcpu': 4}]}]}
INFO:root: 12:35:00.154180 Provided subnet in C1: 1.1.1.0/24 is valid
ERROR:root: 12:35:00.154213Multiple subnet in the C1 are same
INFO:root: 12:39:32.022780 Printing the yaml input file
INFO:root: 12:39:32.022941 {'C1': [{'subnet_addr': '1.1.1.0/24', 'VM': [{'name': 'VM1', 'disk': '10G', 'mem': 2, 'vcpu': 4}]}, {'subnet_addr': '2.2.2.0/24', 'VM': [{'name': 'VM3', 'disk': '10G', 'mem': 3, 'vcpu': 2}]}], 'C2': [{'subnet_addr': '1.1.1.0/24', 'VM': [{'name': 'VM4', 'disk': '10G', 'mem': 2, 'vcpu': 4}]}]}
INFO:root: 12:39:32.023072 Provided subnet in C1: 1.1.1.0/24 is valid
INFO:root: 12:41:41.046179 Printing the yaml input file
INFO:root: 12:41:41.046350 {'C1': [{'subnet_addr': '1.1.1.0/24', 'VM': [{'name': 'VM1', 'disk': '10G', 'mem': 2, 'vcpu': 4}]}, {'subnet_addr': '2.2.2.0/24', 'VM': [{'name': 'VM3', 'disk': '10G', 'mem': 3, 'vcpu': 2}]}], 'C2': [{'subnet_addr': '1.1.1.0/24', 'VM': [{'name': 'VM4', 'disk': '10G', 'mem': 2, 'vcpu': 4}]}]}
INFO:root: 12:41:41.046476 Provided subnet in C1: 1.1.1.0/24 is valid
INFO:root: 12:50:40.814817 Printing the yaml input file
INFO:root: 12:50:40.814987 {'C1': [{'subnet_addr': '1.1.1.0/24', 'VM': [{'name': 'VM1', 'disk': '10G', 'mem': 2, 'vcpu': 4}]}, {'subnet_addr': '2.2.2.0/24', 'VM': [{'name': 'VM3', 'disk': '10G', 'mem': 3, 'vcpu': 2}]}], 'C2': [{'subnet_addr': '1.1.1.0/24', 'VM': [{'name': 'VM4', 'disk': '10G', 'mem': 2, 'vcpu': 4}]}]}
INFO:root: 12:50:40.815141 Provided subnet in C1: 1.1.1.0/24 is valid
INFO:root: 12:50:40.815224 Provided subnet in C1: 2.2.2.0/24 is valid
INFO:root: 12:50:40.815302 Provided subnet in C2: 1.1.1.0/24 is valid
INFO:root: 12:51:24.114066 Printing the yaml input file
INFO:root: 12:51:24.114227 {'C1': [{'subnet_addr': '1.1.1.0/24', 'VM': [{'name': 'VM1', 'disk': '10G', 'mem': 2, 'vcpu': 4}]}, {'subnet_addr': '2.2.2.0/24', 'VM': [{'name': 'VM3', 'disk': '10G', 'mem': 3, 'vcpu': 2}]}], 'C2': [{'subnet_addr': '1.1.1.0/24', 'VM': [{'name': 'VM4', 'disk': '10G', 'mem': 2, 'vcpu': 4}]}]}
INFO:root: 12:51:24.114333 Provided subnet in C1: 1.1.1.0/24 is valid
INFO:root: 12:51:24.114396 Provided subnet in C1: 2.2.2.0/24 is valid
INFO:root: 12:51:24.114445 Provided subnet in C2: 1.1.1.0/24 is valid
INFO:root: 12:56:58.961651 Printing the yaml input file
INFO:root: 12:56:58.961872 {'C1': [{'subnet_addr': '1.1.1.0/24', 'VM': [{'name': 'VM1', 'disk': '10G', 'mem': 2, 'vcpu': 4}]}, {'subnet_addr': '2.2.2.0/24', 'VM': [{'name': 'VM3', 'disk': '10G', 'mem': 3, 'vcpu': 2}]}], 'C2': [{'subnet_addr': '1.1.1.0/24', 'VM': [{'name': 'VM4', 'disk': '10G', 'mem': 2, 'vcpu': 4}]}]}
INFO:root: 12:56:58.962213 Provided subnet in C1: 1.1.1.0/24 is valid
ERROR:root: 12:56:58.962339Multiple subnet in the C1 are same
INFO:root: 12:57:26.299953 Printing the yaml input file
INFO:root: 12:57:26.300072 {'C1': [{'subnet_addr': '1.1.1.0/24', 'VM': [{'name': 'VM1', 'disk': '10G', 'mem': 2, 'vcpu': 4}]}, {'subnet_addr': '2.2.2.0/24', 'VM': [{'name': 'VM3', 'disk': '10G', 'mem': 3, 'vcpu': 2}]}], 'C2': [{'subnet_addr': '1.1.1.0/24', 'VM': [{'name': 'VM4', 'disk': '10G', 'mem': 2, 'vcpu': 4}]}]}
INFO:root: 12:57:26.300180 Provided subnet in C1: 1.1.1.0/24 is valid
ERROR:root: 12:57:26.300221Multiple subnet in the C1 are same
INFO:root: 12:57:57.314239 Printing the yaml input file
INFO:root: 12:57:57.314427 {'C1': [{'subnet_addr': '1.1.1.0/24', 'VM': [{'name': 'VM1', 'disk': '10G', 'mem': 2, 'vcpu': 4}]}, {'subnet_addr': '2.2.2.0/24', 'VM': [{'name': 'VM3', 'disk': '10G', 'mem': 3, 'vcpu': 2}]}], 'C2': [{'subnet_addr': '1.1.1.0/24', 'VM': [{'name': 'VM4', 'disk': '10G', 'mem': 2, 'vcpu': 4}]}]}
INFO:root: 12:57:57.314587 Provided subnet in C1: 1.1.1.0/24 is valid
ERROR:root: 12:57:57.314633Multiple subnet in the C1 are same
INFO:root: 13:03:54.598742 Printing the yaml input file
INFO:root: 13:03:54.598857 {'C1': [{'subnet_addr': '1.1.1.0/24', 'VM': [{'name': 'VM1', 'disk': '10G', 'mem': 2, 'vcpu': 4}]}, {'subnet_addr': '2.2.2.0/24', 'VM': [{'name': 'VM3', 'disk': '10G', 'mem': 3, 'vcpu': 2}]}], 'C2': [{'subnet_addr': '1.1.1.0/24', 'VM': [{'name': 'VM4', 'disk': '10G', 'mem': 2, 'vcpu': 4}]}]}
INFO:root: 13:03:54.598977 Provided subnet in C1: 1.1.1.0/24 is valid
INFO:root: 13:03:54.599257 Provided subnet in C1: 2.2.2.0/24 is valid
INFO:root: 13:03:54.599388 Provided subnet in C2: 1.1.1.0/24 is valid
INFO:root: 13:06:13.783878 Printing the yaml input file
INFO:root: 13:06:13.784047 {'C1': [{'subnet_addr': '1.1.1.0/24', 'VM': [{'name': 'VM1', 'disk': '10G', 'mem': 2, 'vcpu': 4}]}, {'subnet_addr': '2.2.2.0/24', 'VM': [{'name': 'VM3', 'disk': '10G', 'mem': 3, 'vcpu': 2}]}], 'C2': [{'subnet_addr': '1.1.1.0/24', 'VM': [{'name': 'VM4', 'disk': '10G', 'mem': 2, 'vcpu': 4}]}]}
INFO:root: 13:06:13.784156 Provided subnet in C1: 1.1.1.0/24 is valid
INFO:root: 13:06:13.784208 Provided subnet in C1: 2.2.2.0/24 is valid
INFO:root: 13:06:13.784258 Provided subnet in C2: 1.1.1.0/24 is valid
INFO:root: 13:07:52.997676 Printing the yaml input file
INFO:root: 13:07:52.997864 {'C1': [{'subnet_addr': '1.1.1.0/24', 'VM': [{'name': 'VM1', 'disk': '10G', 'mem': 2, 'vcpu': 4}]}, {'subnet_addr': '2.2.23.412/24', 'VM': [{'name': 'VM3', 'disk': '10G', 'mem': 3, 'vcpu': 2}]}], 'C2': [{'subnet_addr': '1.1.1.0/24', 'VM': [{'name': 'VM4', 'disk': '10G', 'mem': 2, 'vcpu': 4}]}]}
INFO:root: 13:07:52.997978 Provided subnet in C1: 1.1.1.0/24 is valid
ERROR:root: 13:07:52.998233 Provided subnet in C1: 2.2.23.412/24 is not valid
INFO:root: 13:08:59.038443 Printing the yaml input file
INFO:root: 13:08:59.038610 {'C1': [{'subnet_addr': '1.1.1.0/24', 'VM': [{'name': 'VM1', 'disk': '10G', 'mem': 2, 'vcpu': 4}]}, {'subnet_addr': '1.1.1.0/24', 'VM': [{'name': 'VM3', 'disk': '10G', 'mem': 3, 'vcpu': 2}]}], 'C2': [{'subnet_addr': '1.1.1.0/24', 'VM': [{'name': 'VM4', 'disk': '10G', 'mem': 2, 'vcpu': 4}]}]}
INFO:root: 13:08:59.038720 Provided subnet in C1: 1.1.1.0/24 is valid
INFO:root: 13:08:59.038775 Provided subnet in C1: 1.1.1.0/24 is valid
ERROR:root: 13:08:59.038822Multiple subnet in the C1 are same
INFO:root: 00:09:15.169992 Printing the yaml input file
INFO:root: 00:09:15.170165 {'C1': [{'subnet_addr': '1.1.1.0/24', 'VM': [{'name': 'VM1', 'disk': '10G', 'mem': 2, 'vcpu': 4}, {'name': 'VM2', 'disk': '10G', 'mem': 4, 'vcpu': 2}]}, {'subnet_addr': '2.2.2.0/24', 'VM': [{'name': 'VM3', 'disk': '10G', 'mem': 3, 'vcpu': 2}]}], 'C2': [{'subnet_addr': '1.1.1.0/24', 'VM': [{'name': 'VM4', 'disk': '10G', 'mem': 2, 'vcpu': 4}]}]}
INFO:root: 00:09:15.170297 Provided subnet in C1: 1.1.1.0/24 is valid
INFO:root: 00:09:15.170375 Provided subnet in C1: 2.2.2.0/24 is valid
INFO:root: 00:09:15.170439 Provided subnet in C2: 1.1.1.0/24 is valid
Using /etc/ansible/ansible.cfg as config file

PLAY [main] *************************************************************************************************************************************************

TASK [Create Tenant Namespace] ******************************************************************************************************************************
changed: [localhost] => (item={u'default_route_ip': u'192.168.1.1', u'name': u't1', u'pns_ip': u'192.168.1.1/24', u'tenant_if': u't1if', u'tenant_ip': u'192.168.1.2/24', u'pns_if': u't1pns_if'}) => {"ansible_loop_var": "item", "changed": true, "cmd": ["ip", "netns", "add", "t1"], "delta": "0:00:00.050160", "end": "2019-11-18 00:09:16.689869", "item": {"default_route_ip": "192.168.1.1", "name": "t1", "pns_if": "t1pns_if", "pns_ip": "192.168.1.1/24", "tenant_if": "t1if", "tenant_ip": "192.168.1.2/24"}, "rc": 0, "start": "2019-11-18 00:09:16.639709", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Create Subnet Namespace] ******************************************************************************************************************************
changed: [localhost] => (item={u'route': [{u'ip': u'10.1.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.1.2/24', u'tenant_ns_ip': u'10.1.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_ns_name': u't1', u'tenant_sub_if': u't1s1if'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't1_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM1if1'}, {u'mem': 4, u'name': u't1_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br1if2', u'vmif': u't1VM2if1'}], u'vxlan': [{u'local_ip': u'10.1.1.2', u'tenant_route_ip': u'192.168.1.2', u'dsport': 4789, u'dev': u't1s1if', u'subnet_route': u'10.1.1.0/24', u'remote_route': u'10.2.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.2.1.2'}]}) => {"ansible_loop_var": "item", "changed": true, "cmd": ["ip", "netns", "add", "t1ns1"], "delta": "0:00:00.051192", "end": "2019-11-18 00:09:16.994011", "item": {"bridge_name": "t1br1", "default_route_ip": "10.1.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.1.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.1.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.1.1.2/24"}], "vms": [{"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM1", "vcpu": 4, "vmif": "t1VM1if1"}, {"brif": "t1br1if2", "disk": "10G", "mem": 4, "name": "t1_VM2", "vcpu": 2, "vmif": "t1VM2if1"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.1.2", "remote_ip": "10.2.1.2", "remote_route": "10.2.1.0/24", "subnet_route": "10.1.1.0/24", "tenant_route_ip": "192.168.1.2", "v_name": "vxlan_t1s1"}]}, "rc": 0, "start": "2019-11-18 00:09:16.942819", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}
changed: [localhost] => (item={u'route': [{u'ip': u'10.1.2.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.2.1', u'bridge_name': u't1br2', u'dns': [{u'dnsif': u't1s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s2_dnsbrif'}], u'ns_name': u't1ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.2.2/24', u'tenant_ns_ip': u'10.1.2.1/24', u'tenant_ns_if': u't1ns2if', u'tenant_ns_name': u't1', u'tenant_sub_if': u't1s2if'}], u'subnet_ip': u'2.2.2.0/24', u'vms': [{u'mem': 3, u'name': u't1_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br2if1', u'vmif': u't1VM3if1'}], u'vxlan': [{u'local_ip': [], u'tenant_route_ip': [], u'dsport': [], u'dev': [], u'subnet_route': [], u'remote_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}) => {"ansible_loop_var": "item", "changed": true, "cmd": ["ip", "netns", "add", "t1ns2"], "delta": "0:00:00.050704", "end": "2019-11-18 00:09:17.230009", "item": {"bridge_name": "t1br2", "default_route_ip": "10.1.2.1", "dns": [{"brif": "t1s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t1s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns2", "route": [{"if": "p1", "ip": "10.1.2.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "2.2.2.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns2if", "tenant_ns_ip": "10.1.2.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s2if", "tenant_sub_ip": "10.1.2.2/24"}], "vms": [{"brif": "t1br2if1", "disk": "10G", "mem": 3, "name": "t1_VM3", "vcpu": 2, "vmif": "t1VM3if1"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, "rc": 0, "start": "2019-11-18 00:09:17.179305", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Create Tenant VETH pairs] *****************************************************************************************************************************
changed: [localhost] => (item={u'default_route_ip': u'192.168.1.1', u'name': u't1', u'pns_ip': u'192.168.1.1/24', u'tenant_if': u't1if', u'tenant_ip': u'192.168.1.2/24', u'pns_if': u't1pns_if'}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip link show \"t1if\" ; if [ $? -ne 0 ] ; then ip link add \"t1if\" type veth peer name \"t1pns_if\" ; fi\n", "delta": "0:00:00.009888", "end": "2019-11-18 00:09:17.478723", "item": {"default_route_ip": "192.168.1.1", "name": "t1", "pns_if": "t1pns_if", "pns_ip": "192.168.1.1/24", "tenant_if": "t1if", "tenant_ip": "192.168.1.2/24"}, "rc": 0, "start": "2019-11-18 00:09:17.468835", "stderr": "Device \"t1if\" does not exist.", "stderr_lines": ["Device \"t1if\" does not exist."], "stdout": "", "stdout_lines": []}

TASK [Attach Tenant VETH Pairs] *****************************************************************************************************************************
changed: [localhost] => (item={u'default_route_ip': u'192.168.1.1', u'name': u't1', u'pns_ip': u'192.168.1.1/24', u'tenant_if': u't1if', u'tenant_ip': u'192.168.1.2/24', u'pns_if': u't1pns_if'}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec pns ip link show \"t1pns_if\" ; if [ $? -ne 0 ] ; then ip link set \"t1pns_if\" netns pns ; fi\nip netns exec \"t1\" ip link show \"t1if\" ; if [ $? -ne 0 ] ; then ip link set \"t1if\" netns \"t1\" ; fi\nip netns exec pns ip link set dev \"t1pns_if\" up\nip netns exec \"t1\" ip link set dev \"t1if\" up\n", "delta": "0:00:00.192743", "end": "2019-11-18 00:09:17.913800", "item": {"default_route_ip": "192.168.1.1", "name": "t1", "pns_if": "t1pns_if", "pns_ip": "192.168.1.1/24", "tenant_if": "t1if", "tenant_ip": "192.168.1.2/24"}, "rc": 0, "start": "2019-11-18 00:09:17.721057", "stderr": "Device \"t1pns_if\" does not exist.\nDevice \"t1if\" does not exist.", "stderr_lines": ["Device \"t1pns_if\" does not exist.", "Device \"t1if\" does not exist."], "stdout": "", "stdout_lines": []}

TASK [Add IP addresses to Tenant VETH Pairs] ****************************************************************************************************************
changed: [localhost] => (item={u'default_route_ip': u'192.168.1.1', u'name': u't1', u'pns_ip': u'192.168.1.1/24', u'tenant_if': u't1if', u'tenant_ip': u'192.168.1.2/24', u'pns_if': u't1pns_if'}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec pns ip addr show \"t1pns_if\" | awk 'FNR==3{ print $2 }' | grep -w '^192.168.1.1/24' ; if [ $? -ne 0 ] ; then ip netns exec pns ip addr add \"192.168.1.1/24\" dev \"t1pns_if\" ; fi\nip netns exec \"t1\" ip addr show \"t1if\" | awk 'FNR==3{ print $2 }' | grep -w '^192.168.1.2/24' ; if [ $? -ne 0 ] ; then ip netns exec \"t1\" ip addr add \"192.168.1.2/24\" dev \"t1if\" ; fi\n", "delta": "0:00:00.143871", "end": "2019-11-18 00:09:18.322001", "item": {"default_route_ip": "192.168.1.1", "name": "t1", "pns_if": "t1pns_if", "pns_ip": "192.168.1.1/24", "tenant_if": "t1if", "tenant_ip": "192.168.1.2/24"}, "rc": 0, "start": "2019-11-18 00:09:18.178130", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Create Namespace VETH Pairs] **************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't1_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM1if1'}, {u'mem': 4, u'name': u't1_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br1if2', u'vmif': u't1VM2if1'}], u'vxlan': [{u'local_ip': u'10.1.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.1.2', u'remote_route': u'10.2.1.0/24', u'subnet_route': u'10.1.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.2.1.2'}]}, {u'tenant_sub_ip': u'10.1.1.2/24', u'tenant_ns_ip': u'10.1.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip link show \"t1ns1if\" ; if [ $? -ne 0 ] ; then ip link add \"t1ns1if\" type veth peer name \"t1s1if\" ; fi\n", "delta": "0:00:00.011111", "end": "2019-11-18 00:09:18.607413", "item": [{"bridge_name": "t1br1", "default_route_ip": "10.1.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.1.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "vms": [{"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM1", "vcpu": 4, "vmif": "t1VM1if1"}, {"brif": "t1br1if2", "disk": "10G", "mem": 4, "name": "t1_VM2", "vcpu": 2, "vmif": "t1VM2if1"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.1.2", "remote_ip": "10.2.1.2", "remote_route": "10.2.1.0/24", "subnet_route": "10.1.1.0/24", "tenant_route_ip": "192.168.1.2", "v_name": "vxlan_t1s1"}]}, {"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.1.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.1.1.2/24"}], "rc": 0, "start": "2019-11-18 00:09:18.596302", "stderr": "Device \"t1ns1if\" does not exist.", "stderr_lines": ["Device \"t1ns1if\" does not exist."], "stdout": "", "stdout_lines": []}
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.2.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.2.1', u'bridge_name': u't1br2', u'dns': [{u'dnsif': u't1s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s2_dnsbrif'}], u'ns_name': u't1ns2', u'subnet_ip': u'2.2.2.0/24', u'vms': [{u'mem': 3, u'name': u't1_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br2if1', u'vmif': u't1VM3if1'}], u'vxlan': [{u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}, {u'tenant_sub_ip': u'10.1.2.2/24', u'tenant_ns_ip': u'10.1.2.1/24', u'tenant_ns_if': u't1ns2if', u'tenant_sub_if': u't1s2if', u'tenant_ns_name': u't1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip link show \"t1ns2if\" ; if [ $? -ne 0 ] ; then ip link add \"t1ns2if\" type veth peer name \"t1s2if\" ; fi\n", "delta": "0:00:00.010344", "end": "2019-11-18 00:09:18.826670", "item": [{"bridge_name": "t1br2", "default_route_ip": "10.1.2.1", "dns": [{"brif": "t1s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t1s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns2", "route": [{"if": "p1", "ip": "10.1.2.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "2.2.2.0/24", "vms": [{"brif": "t1br2if1", "disk": "10G", "mem": 3, "name": "t1_VM3", "vcpu": 2, "vmif": "t1VM3if1"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, {"tenant_ns_if": "t1ns2if", "tenant_ns_ip": "10.1.2.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s2if", "tenant_sub_ip": "10.1.2.2/24"}], "rc": 0, "start": "2019-11-18 00:09:18.816326", "stderr": "Device \"t1ns2if\" does not exist.", "stderr_lines": ["Device \"t1ns2if\" does not exist."], "stdout": "", "stdout_lines": []}

TASK [Attach Namespace VETH Pairs] **************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't1_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM1if1'}, {u'mem': 4, u'name': u't1_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br1if2', u'vmif': u't1VM2if1'}], u'vxlan': [{u'local_ip': u'10.1.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.1.2', u'remote_route': u'10.2.1.0/24', u'subnet_route': u'10.1.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.2.1.2'}]}, {u'tenant_sub_ip': u'10.1.1.2/24', u'tenant_ns_ip': u'10.1.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t1\" ip link show \"t1ns1if\" ; if [ $? -ne 0 ] ; then ip link set \"t1ns1if\" netns \"t1\" ; fi\nip netns exec \"t1ns1\" ip link show \"t1s1if\" ; if [ $? -ne 0 ] ; then ip link set \"t1s1if\" netns \"t1ns1\" ; fi\n", "delta": "0:00:00.110458", "end": "2019-11-18 00:09:19.216507", "item": [{"bridge_name": "t1br1", "default_route_ip": "10.1.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.1.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "vms": [{"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM1", "vcpu": 4, "vmif": "t1VM1if1"}, {"brif": "t1br1if2", "disk": "10G", "mem": 4, "name": "t1_VM2", "vcpu": 2, "vmif": "t1VM2if1"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.1.2", "remote_ip": "10.2.1.2", "remote_route": "10.2.1.0/24", "subnet_route": "10.1.1.0/24", "tenant_route_ip": "192.168.1.2", "v_name": "vxlan_t1s1"}]}, {"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.1.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.1.1.2/24"}], "rc": 0, "start": "2019-11-18 00:09:19.106049", "stderr": "Device \"t1ns1if\" does not exist.\nDevice \"t1s1if\" does not exist.", "stderr_lines": ["Device \"t1ns1if\" does not exist.", "Device \"t1s1if\" does not exist."], "stdout": "", "stdout_lines": []}
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.2.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.2.1', u'bridge_name': u't1br2', u'dns': [{u'dnsif': u't1s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s2_dnsbrif'}], u'ns_name': u't1ns2', u'subnet_ip': u'2.2.2.0/24', u'vms': [{u'mem': 3, u'name': u't1_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br2if1', u'vmif': u't1VM3if1'}], u'vxlan': [{u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}, {u'tenant_sub_ip': u'10.1.2.2/24', u'tenant_ns_ip': u'10.1.2.1/24', u'tenant_ns_if': u't1ns2if', u'tenant_sub_if': u't1s2if', u'tenant_ns_name': u't1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t1\" ip link show \"t1ns2if\" ; if [ $? -ne 0 ] ; then ip link set \"t1ns2if\" netns \"t1\" ; fi\nip netns exec \"t1ns2\" ip link show \"t1s2if\" ; if [ $? -ne 0 ] ; then ip link set \"t1s2if\" netns \"t1ns2\" ; fi\n", "delta": "0:00:00.114576", "end": "2019-11-18 00:09:19.538604", "item": [{"bridge_name": "t1br2", "default_route_ip": "10.1.2.1", "dns": [{"brif": "t1s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t1s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns2", "route": [{"if": "p1", "ip": "10.1.2.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "2.2.2.0/24", "vms": [{"brif": "t1br2if1", "disk": "10G", "mem": 3, "name": "t1_VM3", "vcpu": 2, "vmif": "t1VM3if1"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, {"tenant_ns_if": "t1ns2if", "tenant_ns_ip": "10.1.2.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s2if", "tenant_sub_ip": "10.1.2.2/24"}], "rc": 0, "start": "2019-11-18 00:09:19.424028", "stderr": "Device \"t1ns2if\" does not exist.\nDevice \"t1s2if\" does not exist.", "stderr_lines": ["Device \"t1ns2if\" does not exist.", "Device \"t1s2if\" does not exist."], "stdout": "", "stdout_lines": []}

TASK [Set Namespace VETH Pairs UP] **************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't1_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM1if1'}, {u'mem': 4, u'name': u't1_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br1if2', u'vmif': u't1VM2if1'}], u'vxlan': [{u'local_ip': u'10.1.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.1.2', u'remote_route': u'10.2.1.0/24', u'subnet_route': u'10.1.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.2.1.2'}]}, {u'tenant_sub_ip': u'10.1.1.2/24', u'tenant_ns_ip': u'10.1.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t1\" ip link set dev \"t1ns1if\" up\nip netns exec \"t1ns1\" ip link set dev \"t1s1if\" up\n", "delta": "0:00:00.075340", "end": "2019-11-18 00:09:19.881713", "item": [{"bridge_name": "t1br1", "default_route_ip": "10.1.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.1.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "vms": [{"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM1", "vcpu": 4, "vmif": "t1VM1if1"}, {"brif": "t1br1if2", "disk": "10G", "mem": 4, "name": "t1_VM2", "vcpu": 2, "vmif": "t1VM2if1"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.1.2", "remote_ip": "10.2.1.2", "remote_route": "10.2.1.0/24", "subnet_route": "10.1.1.0/24", "tenant_route_ip": "192.168.1.2", "v_name": "vxlan_t1s1"}]}, {"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.1.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.1.1.2/24"}], "rc": 0, "start": "2019-11-18 00:09:19.806373", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.2.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.2.1', u'bridge_name': u't1br2', u'dns': [{u'dnsif': u't1s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s2_dnsbrif'}], u'ns_name': u't1ns2', u'subnet_ip': u'2.2.2.0/24', u'vms': [{u'mem': 3, u'name': u't1_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br2if1', u'vmif': u't1VM3if1'}], u'vxlan': [{u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}, {u'tenant_sub_ip': u'10.1.2.2/24', u'tenant_ns_ip': u'10.1.2.1/24', u'tenant_ns_if': u't1ns2if', u'tenant_sub_if': u't1s2if', u'tenant_ns_name': u't1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t1\" ip link set dev \"t1ns2if\" up\nip netns exec \"t1ns2\" ip link set dev \"t1s2if\" up\n", "delta": "0:00:00.071949", "end": "2019-11-18 00:09:20.149643", "item": [{"bridge_name": "t1br2", "default_route_ip": "10.1.2.1", "dns": [{"brif": "t1s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t1s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns2", "route": [{"if": "p1", "ip": "10.1.2.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "2.2.2.0/24", "vms": [{"brif": "t1br2if1", "disk": "10G", "mem": 3, "name": "t1_VM3", "vcpu": 2, "vmif": "t1VM3if1"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, {"tenant_ns_if": "t1ns2if", "tenant_ns_ip": "10.1.2.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s2if", "tenant_sub_ip": "10.1.2.2/24"}], "rc": 0, "start": "2019-11-18 00:09:20.077694", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Add IP addresses to Namespace VETH Pairs] *************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't1_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM1if1'}, {u'mem': 4, u'name': u't1_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br1if2', u'vmif': u't1VM2if1'}], u'vxlan': [{u'local_ip': u'10.1.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.1.2', u'remote_route': u'10.2.1.0/24', u'subnet_route': u'10.1.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.2.1.2'}]}, {u'tenant_sub_ip': u'10.1.1.2/24', u'tenant_ns_ip': u'10.1.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t1ns1\" ip addr show \"t1s1if\" | awk 'FNR==3{ print $2 }' | grep -w '^10.1.1.2/24' ; if [ $? -ne 0 ] ; then ip netns exec \"t1ns1\" ip addr add \"10.1.1.2/24\" dev \"t1s1if\" ; fi\n\nip netns exec \"t1\" ip addr show \"t1ns1if\" | awk 'FNR==3{ print $2 }' | grep -w '^10.1.1.1/24' ; if [ $? -ne 0 ] ; then ip netns exec \"t1\" ip addr add \"10.1.1.1/24\" dev \"t1ns1if\" ; fi\n", "delta": "0:00:00.160340", "end": "2019-11-18 00:09:20.557870", "item": [{"bridge_name": "t1br1", "default_route_ip": "10.1.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.1.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "vms": [{"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM1", "vcpu": 4, "vmif": "t1VM1if1"}, {"brif": "t1br1if2", "disk": "10G", "mem": 4, "name": "t1_VM2", "vcpu": 2, "vmif": "t1VM2if1"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.1.2", "remote_ip": "10.2.1.2", "remote_route": "10.2.1.0/24", "subnet_route": "10.1.1.0/24", "tenant_route_ip": "192.168.1.2", "v_name": "vxlan_t1s1"}]}, {"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.1.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.1.1.2/24"}], "rc": 0, "start": "2019-11-18 00:09:20.397530", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.2.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.2.1', u'bridge_name': u't1br2', u'dns': [{u'dnsif': u't1s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s2_dnsbrif'}], u'ns_name': u't1ns2', u'subnet_ip': u'2.2.2.0/24', u'vms': [{u'mem': 3, u'name': u't1_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br2if1', u'vmif': u't1VM3if1'}], u'vxlan': [{u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}, {u'tenant_sub_ip': u'10.1.2.2/24', u'tenant_ns_ip': u'10.1.2.1/24', u'tenant_ns_if': u't1ns2if', u'tenant_sub_if': u't1s2if', u'tenant_ns_name': u't1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t1ns2\" ip addr show \"t1s2if\" | awk 'FNR==3{ print $2 }' | grep -w '^10.1.2.2/24' ; if [ $? -ne 0 ] ; then ip netns exec \"t1ns2\" ip addr add \"10.1.2.2/24\" dev \"t1s2if\" ; fi\n\nip netns exec \"t1\" ip addr show \"t1ns2if\" | awk 'FNR==3{ print $2 }' | grep -w '^10.1.2.1/24' ; if [ $? -ne 0 ] ; then ip netns exec \"t1\" ip addr add \"10.1.2.1/24\" dev \"t1ns2if\" ; fi\n", "delta": "0:00:00.174102", "end": "2019-11-18 00:09:20.925937", "item": [{"bridge_name": "t1br2", "default_route_ip": "10.1.2.1", "dns": [{"brif": "t1s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t1s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns2", "route": [{"if": "p1", "ip": "10.1.2.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "2.2.2.0/24", "vms": [{"brif": "t1br2if1", "disk": "10G", "mem": 3, "name": "t1_VM3", "vcpu": 2, "vmif": "t1VM3if1"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, {"tenant_ns_if": "t1ns2if", "tenant_ns_ip": "10.1.2.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s2if", "tenant_sub_ip": "10.1.2.2/24"}], "rc": 0, "start": "2019-11-18 00:09:20.751835", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Add IP Route to Tenant] *******************************************************************************************************************************
changed: [localhost] => (item={u'default_route_ip': u'192.168.1.1', u'name': u't1', u'pns_ip': u'192.168.1.1/24', u'tenant_if': u't1if', u'tenant_ip': u'192.168.1.2/24', u'pns_if': u't1pns_if'}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t1\" ip route show default | grep -w '[d]efault via 192.168.1.1' ; if [ $? -ne 0 ] ; then ip netns exec \"t1\" ip route add default via \"192.168.1.1\" ; fi\n", "delta": "0:00:00.083226", "end": "2019-11-18 00:09:21.281885", "item": {"default_route_ip": "192.168.1.1", "name": "t1", "pns_if": "t1pns_if", "pns_ip": "192.168.1.1/24", "tenant_if": "t1if", "tenant_ip": "192.168.1.2/24"}, "rc": 0, "start": "2019-11-18 00:09:21.198659", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Add IP Route to Tenant Subnet] ************************************************************************************************************************
changed: [localhost] => (item={u'route': [{u'ip': u'10.1.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.1.2/24', u'tenant_ns_ip': u'10.1.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_ns_name': u't1', u'tenant_sub_if': u't1s1if'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't1_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM1if1'}, {u'mem': 4, u'name': u't1_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br1if2', u'vmif': u't1VM2if1'}], u'vxlan': [{u'local_ip': u'10.1.1.2', u'tenant_route_ip': u'192.168.1.2', u'dsport': 4789, u'dev': u't1s1if', u'subnet_route': u'10.1.1.0/24', u'remote_route': u'10.2.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.2.1.2'}]}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t1ns1\" ip route show default | grep -w '[d]efault via 10.1.1.1' ; if [ $? -ne 0 ] ; then ip netns exec \"t1ns1\" ip route add default via \"10.1.1.1\" ; fi\n", "delta": "0:00:00.086677", "end": "2019-11-18 00:09:21.645877", "item": {"bridge_name": "t1br1", "default_route_ip": "10.1.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.1.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.1.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.1.1.2/24"}], "vms": [{"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM1", "vcpu": 4, "vmif": "t1VM1if1"}, {"brif": "t1br1if2", "disk": "10G", "mem": 4, "name": "t1_VM2", "vcpu": 2, "vmif": "t1VM2if1"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.1.2", "remote_ip": "10.2.1.2", "remote_route": "10.2.1.0/24", "subnet_route": "10.1.1.0/24", "tenant_route_ip": "192.168.1.2", "v_name": "vxlan_t1s1"}]}, "rc": 0, "start": "2019-11-18 00:09:21.559200", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}
changed: [localhost] => (item={u'route': [{u'ip': u'10.1.2.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.2.1', u'bridge_name': u't1br2', u'dns': [{u'dnsif': u't1s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s2_dnsbrif'}], u'ns_name': u't1ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.2.2/24', u'tenant_ns_ip': u'10.1.2.1/24', u'tenant_ns_if': u't1ns2if', u'tenant_ns_name': u't1', u'tenant_sub_if': u't1s2if'}], u'subnet_ip': u'2.2.2.0/24', u'vms': [{u'mem': 3, u'name': u't1_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br2if1', u'vmif': u't1VM3if1'}], u'vxlan': [{u'local_ip': [], u'tenant_route_ip': [], u'dsport': [], u'dev': [], u'subnet_route': [], u'remote_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t1ns2\" ip route show default | grep -w '[d]efault via 10.1.2.1' ; if [ $? -ne 0 ] ; then ip netns exec \"t1ns2\" ip route add default via \"10.1.2.1\" ; fi\n", "delta": "0:00:00.080232", "end": "2019-11-18 00:09:21.933878", "item": {"bridge_name": "t1br2", "default_route_ip": "10.1.2.1", "dns": [{"brif": "t1s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t1s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns2", "route": [{"if": "p1", "ip": "10.1.2.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "2.2.2.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns2if", "tenant_ns_ip": "10.1.2.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s2if", "tenant_sub_ip": "10.1.2.2/24"}], "vms": [{"brif": "t1br2if1", "disk": "10G", "mem": 3, "name": "t1_VM3", "vcpu": 2, "vmif": "t1VM3if1"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, "rc": 0, "start": "2019-11-18 00:09:21.853646", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Create bridge inside namespace] ***********************************************************************************************************************
changed: [localhost] => (item={u'route': [{u'ip': u'10.1.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.1.2/24', u'tenant_ns_ip': u'10.1.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_ns_name': u't1', u'tenant_sub_if': u't1s1if'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't1_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM1if1'}, {u'mem': 4, u'name': u't1_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br1if2', u'vmif': u't1VM2if1'}], u'vxlan': [{u'local_ip': u'10.1.1.2', u'tenant_route_ip': u'192.168.1.2', u'dsport': 4789, u'dev': u't1s1if', u'subnet_route': u'10.1.1.0/24', u'remote_route': u'10.2.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.2.1.2'}]}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t1ns1\" brctl show | grep -w '^t1br1'; if [ $? -ne 0 ] ; then ip netns exec \"t1ns1\" brctl addbr \"t1br1\" ; fi\nip netns exec \"t1ns1\" ip link set dev \"t1br1\" up\n", "delta": "0:00:00.111881", "end": "2019-11-18 00:09:22.321913", "item": {"bridge_name": "t1br1", "default_route_ip": "10.1.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.1.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.1.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.1.1.2/24"}], "vms": [{"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM1", "vcpu": 4, "vmif": "t1VM1if1"}, {"brif": "t1br1if2", "disk": "10G", "mem": 4, "name": "t1_VM2", "vcpu": 2, "vmif": "t1VM2if1"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.1.2", "remote_ip": "10.2.1.2", "remote_route": "10.2.1.0/24", "subnet_route": "10.1.1.0/24", "tenant_route_ip": "192.168.1.2", "v_name": "vxlan_t1s1"}]}, "rc": 0, "start": "2019-11-18 00:09:22.210032", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}
changed: [localhost] => (item={u'route': [{u'ip': u'10.1.2.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.2.1', u'bridge_name': u't1br2', u'dns': [{u'dnsif': u't1s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s2_dnsbrif'}], u'ns_name': u't1ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.2.2/24', u'tenant_ns_ip': u'10.1.2.1/24', u'tenant_ns_if': u't1ns2if', u'tenant_ns_name': u't1', u'tenant_sub_if': u't1s2if'}], u'subnet_ip': u'2.2.2.0/24', u'vms': [{u'mem': 3, u'name': u't1_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br2if1', u'vmif': u't1VM3if1'}], u'vxlan': [{u'local_ip': [], u'tenant_route_ip': [], u'dsport': [], u'dev': [], u'subnet_route': [], u'remote_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t1ns2\" brctl show | grep -w '^t1br2'; if [ $? -ne 0 ] ; then ip netns exec \"t1ns2\" brctl addbr \"t1br2\" ; fi\nip netns exec \"t1ns2\" ip link set dev \"t1br2\" up\n", "delta": "0:00:00.105891", "end": "2019-11-18 00:09:22.637883", "item": {"bridge_name": "t1br2", "default_route_ip": "10.1.2.1", "dns": [{"brif": "t1s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t1s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns2", "route": [{"if": "p1", "ip": "10.1.2.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "2.2.2.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns2if", "tenant_ns_ip": "10.1.2.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s2if", "tenant_sub_ip": "10.1.2.2/24"}], "vms": [{"brif": "t1br2if1", "disk": "10G", "mem": 3, "name": "t1_VM3", "vcpu": 2, "vmif": "t1VM3if1"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, "rc": 0, "start": "2019-11-18 00:09:22.531992", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Create DNS VETH Pair] *********************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.1.1', u'bridge_name': u't1br1', u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.1.2/24', u'tenant_ns_ip': u'10.1.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't1_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM1if1'}, {u'mem': 4, u'name': u't1_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br1if2', u'vmif': u't1VM2if1'}], u'vxlan': [{u'local_ip': u'10.1.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.1.2', u'remote_route': u'10.2.1.0/24', u'subnet_route': u'10.1.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.2.1.2'}]}, {u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t1ns1\" ip link show \"t1s1_dnsbrif\" ; if [ $? -ne 0 ] ; then ip netns exec \"t1ns1\" ip link add \"t1s1_dnsbrif\" type veth peer name \"t1s1_dnsif\" ; fi\nip netns exec \"t1ns1\" ip link set dev \"t1s1_dnsbrif\" up\nip netns exec \"t1ns1\" ip link set dev \"t1s1_dnsif\" up\n", "delta": "0:00:00.148749", "end": "2019-11-18 00:09:23.041712", "item": [{"bridge_name": "t1br1", "default_route_ip": "10.1.1.1", "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.1.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.1.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.1.1.2/24"}], "vms": [{"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM1", "vcpu": 4, "vmif": "t1VM1if1"}, {"brif": "t1br1if2", "disk": "10G", "mem": 4, "name": "t1_VM2", "vcpu": 2, "vmif": "t1VM2if1"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.1.2", "remote_ip": "10.2.1.2", "remote_route": "10.2.1.0/24", "subnet_route": "10.1.1.0/24", "tenant_route_ip": "192.168.1.2", "v_name": "vxlan_t1s1"}]}, {"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "rc": 0, "start": "2019-11-18 00:09:22.892963", "stderr": "Device \"t1s1_dnsbrif\" does not exist.", "stderr_lines": ["Device \"t1s1_dnsbrif\" does not exist."], "stdout": "", "stdout_lines": []}
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.2.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.2.1', u'bridge_name': u't1br2', u'ns_name': u't1ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.2.2/24', u'tenant_ns_ip': u'10.1.2.1/24', u'tenant_ns_if': u't1ns2if', u'tenant_sub_if': u't1s2if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'2.2.2.0/24', u'vms': [{u'mem': 3, u'name': u't1_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br2if1', u'vmif': u't1VM3if1'}], u'vxlan': [{u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}, {u'dnsif': u't1s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s2_dnsbrif'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t1ns2\" ip link show \"t1s2_dnsbrif\" ; if [ $? -ne 0 ] ; then ip netns exec \"t1ns2\" ip link add \"t1s2_dnsbrif\" type veth peer name \"t1s2_dnsif\" ; fi\nip netns exec \"t1ns2\" ip link set dev \"t1s2_dnsbrif\" up\nip netns exec \"t1ns2\" ip link set dev \"t1s2_dnsif\" up\n", "delta": "0:00:00.161808", "end": "2019-11-18 00:09:23.389686", "item": [{"bridge_name": "t1br2", "default_route_ip": "10.1.2.1", "ns_name": "t1ns2", "route": [{"if": "p1", "ip": "10.1.2.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "2.2.2.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns2if", "tenant_ns_ip": "10.1.2.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s2if", "tenant_sub_ip": "10.1.2.2/24"}], "vms": [{"brif": "t1br2if1", "disk": "10G", "mem": 3, "name": "t1_VM3", "vcpu": 2, "vmif": "t1VM3if1"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, {"brif": "t1s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t1s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "rc": 0, "start": "2019-11-18 00:09:23.227878", "stderr": "Device \"t1s2_dnsbrif\" does not exist.", "stderr_lines": ["Device \"t1s2_dnsbrif\" does not exist."], "stdout": "", "stdout_lines": []}

TASK [Attach DNS VETH Pair] *********************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.1.1', u'bridge_name': u't1br1', u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.1.2/24', u'tenant_ns_ip': u'10.1.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't1_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM1if1'}, {u'mem': 4, u'name': u't1_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br1if2', u'vmif': u't1VM2if1'}], u'vxlan': [{u'local_ip': u'10.1.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.1.2', u'remote_route': u'10.2.1.0/24', u'subnet_route': u'10.1.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.2.1.2'}]}, {u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t1ns1\" brctl show \"t1br1\" | grep -w 't1s1_dnsbrif' ; if [ $? -ne 0 ] ; then ip netns exec \"t1ns1\" brctl addif \"t1br1\" \"t1s1_dnsbrif\" ; fi\n", "delta": "0:00:00.071713", "end": "2019-11-18 00:09:23.697717", "item": [{"bridge_name": "t1br1", "default_route_ip": "10.1.1.1", "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.1.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.1.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.1.1.2/24"}], "vms": [{"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM1", "vcpu": 4, "vmif": "t1VM1if1"}, {"brif": "t1br1if2", "disk": "10G", "mem": 4, "name": "t1_VM2", "vcpu": 2, "vmif": "t1VM2if1"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.1.2", "remote_ip": "10.2.1.2", "remote_route": "10.2.1.0/24", "subnet_route": "10.1.1.0/24", "tenant_route_ip": "192.168.1.2", "v_name": "vxlan_t1s1"}]}, {"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "rc": 0, "start": "2019-11-18 00:09:23.626004", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.2.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.2.1', u'bridge_name': u't1br2', u'ns_name': u't1ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.2.2/24', u'tenant_ns_ip': u'10.1.2.1/24', u'tenant_ns_if': u't1ns2if', u'tenant_sub_if': u't1s2if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'2.2.2.0/24', u'vms': [{u'mem': 3, u'name': u't1_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br2if1', u'vmif': u't1VM3if1'}], u'vxlan': [{u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}, {u'dnsif': u't1s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s2_dnsbrif'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t1ns2\" brctl show \"t1br2\" | grep -w 't1s2_dnsbrif' ; if [ $? -ne 0 ] ; then ip netns exec \"t1ns2\" brctl addif \"t1br2\" \"t1s2_dnsbrif\" ; fi\n", "delta": "0:00:00.070537", "end": "2019-11-18 00:09:23.973935", "item": [{"bridge_name": "t1br2", "default_route_ip": "10.1.2.1", "ns_name": "t1ns2", "route": [{"if": "p1", "ip": "10.1.2.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "2.2.2.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns2if", "tenant_ns_ip": "10.1.2.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s2if", "tenant_sub_ip": "10.1.2.2/24"}], "vms": [{"brif": "t1br2if1", "disk": "10G", "mem": 3, "name": "t1_VM3", "vcpu": 2, "vmif": "t1VM3if1"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, {"brif": "t1s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t1s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "rc": 0, "start": "2019-11-18 00:09:23.903398", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Create VETH Pairs] ************************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.1.2/24', u'tenant_ns_ip': u'10.1.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.1.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.1.2', u'remote_route': u'10.2.1.0/24', u'subnet_route': u'10.1.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.2.1.2'}]}, {u'mem': 2, u'name': u't1_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM1if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip link show \"t1br1if1\" ; if [ $? -ne 0 ] ; then ip link add \"t1VM1if1\" type veth peer name \"t1br1if1\" ; fi\nip link set dev \"t1br1if1\" up\nip link set dev \"t1VM1if1\" up\n", "delta": "0:00:00.015995", "end": "2019-11-18 00:09:24.253366", "item": [{"bridge_name": "t1br1", "default_route_ip": "10.1.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.1.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.1.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.1.1.2/24"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.1.2", "remote_ip": "10.2.1.2", "remote_route": "10.2.1.0/24", "subnet_route": "10.1.1.0/24", "tenant_route_ip": "192.168.1.2", "v_name": "vxlan_t1s1"}]}, {"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM1", "vcpu": 4, "vmif": "t1VM1if1"}], "rc": 0, "start": "2019-11-18 00:09:24.237371", "stderr": "Device \"t1br1if1\" does not exist.", "stderr_lines": ["Device \"t1br1if1\" does not exist."], "stdout": "", "stdout_lines": []}
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.1.2/24', u'tenant_ns_ip': u'10.1.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.1.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.1.2', u'remote_route': u'10.2.1.0/24', u'subnet_route': u'10.1.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.2.1.2'}]}, {u'mem': 4, u'name': u't1_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br1if2', u'vmif': u't1VM2if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip link show \"t1br1if2\" ; if [ $? -ne 0 ] ; then ip link add \"t1VM2if1\" type veth peer name \"t1br1if2\" ; fi\nip link set dev \"t1br1if2\" up\nip link set dev \"t1VM2if1\" up\n", "delta": "0:00:00.017494", "end": "2019-11-18 00:09:24.482079", "item": [{"bridge_name": "t1br1", "default_route_ip": "10.1.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.1.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.1.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.1.1.2/24"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.1.2", "remote_ip": "10.2.1.2", "remote_route": "10.2.1.0/24", "subnet_route": "10.1.1.0/24", "tenant_route_ip": "192.168.1.2", "v_name": "vxlan_t1s1"}]}, {"brif": "t1br1if2", "disk": "10G", "mem": 4, "name": "t1_VM2", "vcpu": 2, "vmif": "t1VM2if1"}], "rc": 0, "start": "2019-11-18 00:09:24.464585", "stderr": "Device \"t1br1if2\" does not exist.", "stderr_lines": ["Device \"t1br1if2\" does not exist."], "stdout": "", "stdout_lines": []}
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.2.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.2.1', u'bridge_name': u't1br2', u'dns': [{u'dnsif': u't1s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s2_dnsbrif'}], u'ns_name': u't1ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.2.2/24', u'tenant_ns_ip': u'10.1.2.1/24', u'tenant_ns_if': u't1ns2if', u'tenant_sub_if': u't1s2if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'2.2.2.0/24', u'vxlan': [{u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}, {u'mem': 3, u'name': u't1_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br2if1', u'vmif': u't1VM3if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip link show \"t1br2if1\" ; if [ $? -ne 0 ] ; then ip link add \"t1VM3if1\" type veth peer name \"t1br2if1\" ; fi\nip link set dev \"t1br2if1\" up\nip link set dev \"t1VM3if1\" up\n", "delta": "0:00:00.017365", "end": "2019-11-18 00:09:24.714204", "item": [{"bridge_name": "t1br2", "default_route_ip": "10.1.2.1", "dns": [{"brif": "t1s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t1s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns2", "route": [{"if": "p1", "ip": "10.1.2.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "2.2.2.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns2if", "tenant_ns_ip": "10.1.2.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s2if", "tenant_sub_ip": "10.1.2.2/24"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, {"brif": "t1br2if1", "disk": "10G", "mem": 3, "name": "t1_VM3", "vcpu": 2, "vmif": "t1VM3if1"}], "rc": 0, "start": "2019-11-18 00:09:24.696839", "stderr": "Device \"t1br2if1\" does not exist.", "stderr_lines": ["Device \"t1br2if1\" does not exist."], "stdout": "", "stdout_lines": []}

TASK [Attach VETH Pairs] ************************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.1.2/24', u'tenant_ns_ip': u'10.1.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.1.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.1.2', u'remote_route': u'10.2.1.0/24', u'subnet_route': u'10.1.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.2.1.2'}]}, {u'mem': 2, u'name': u't1_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM1if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip link show \"t1br1if1\" ; if [ $? -eq 0 ] ; then ip link set \"t1br1if1\" netns \"t1ns1\" ; fi\nip netns exec \"t1ns1\" brctl show \"t1br1\" | grep -w 't1br1if1' ; if [ $? -ne 0 ] ; then ip netns exec \"t1ns1\" brctl addif \"t1br1\" \"t1br1if1\" ; fi\n", "delta": "0:00:00.112420", "end": "2019-11-18 00:09:25.113781", "item": [{"bridge_name": "t1br1", "default_route_ip": "10.1.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.1.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.1.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.1.1.2/24"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.1.2", "remote_ip": "10.2.1.2", "remote_route": "10.2.1.0/24", "subnet_route": "10.1.1.0/24", "tenant_route_ip": "192.168.1.2", "v_name": "vxlan_t1s1"}]}, {"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM1", "vcpu": 4, "vmif": "t1VM1if1"}], "rc": 0, "start": "2019-11-18 00:09:25.001361", "stderr": "", "stderr_lines": [], "stdout": "20: t1br1if1@t1VM1if1: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP mode DEFAULT group default qlen 1000\n    link/ether 52:6a:d7:2a:e1:9e brd ff:ff:ff:ff:ff:ff", "stdout_lines": ["20: t1br1if1@t1VM1if1: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP mode DEFAULT group default qlen 1000", "    link/ether 52:6a:d7:2a:e1:9e brd ff:ff:ff:ff:ff:ff"]}
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.1.2/24', u'tenant_ns_ip': u'10.1.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.1.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.1.2', u'remote_route': u'10.2.1.0/24', u'subnet_route': u'10.1.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.2.1.2'}]}, {u'mem': 4, u'name': u't1_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br1if2', u'vmif': u't1VM2if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip link show \"t1br1if2\" ; if [ $? -eq 0 ] ; then ip link set \"t1br1if2\" netns \"t1ns1\" ; fi\nip netns exec \"t1ns1\" brctl show \"t1br1\" | grep -w 't1br1if2' ; if [ $? -ne 0 ] ; then ip netns exec \"t1ns1\" brctl addif \"t1br1\" \"t1br1if2\" ; fi\n", "delta": "0:00:00.114040", "end": "2019-11-18 00:09:25.446233", "item": [{"bridge_name": "t1br1", "default_route_ip": "10.1.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.1.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.1.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.1.1.2/24"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.1.2", "remote_ip": "10.2.1.2", "remote_route": "10.2.1.0/24", "subnet_route": "10.1.1.0/24", "tenant_route_ip": "192.168.1.2", "v_name": "vxlan_t1s1"}]}, {"brif": "t1br1if2", "disk": "10G", "mem": 4, "name": "t1_VM2", "vcpu": 2, "vmif": "t1VM2if1"}], "rc": 0, "start": "2019-11-18 00:09:25.332193", "stderr": "", "stderr_lines": [], "stdout": "22: t1br1if2@t1VM2if1: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP mode DEFAULT group default qlen 1000\n    link/ether fa:98:3b:7f:06:24 brd ff:ff:ff:ff:ff:ff", "stdout_lines": ["22: t1br1if2@t1VM2if1: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP mode DEFAULT group default qlen 1000", "    link/ether fa:98:3b:7f:06:24 brd ff:ff:ff:ff:ff:ff"]}
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.2.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.2.1', u'bridge_name': u't1br2', u'dns': [{u'dnsif': u't1s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s2_dnsbrif'}], u'ns_name': u't1ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.2.2/24', u'tenant_ns_ip': u'10.1.2.1/24', u'tenant_ns_if': u't1ns2if', u'tenant_sub_if': u't1s2if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'2.2.2.0/24', u'vxlan': [{u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}, {u'mem': 3, u'name': u't1_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br2if1', u'vmif': u't1VM3if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip link show \"t1br2if1\" ; if [ $? -eq 0 ] ; then ip link set \"t1br2if1\" netns \"t1ns2\" ; fi\nip netns exec \"t1ns2\" brctl show \"t1br2\" | grep -w 't1br2if1' ; if [ $? -ne 0 ] ; then ip netns exec \"t1ns2\" brctl addif \"t1br2\" \"t1br2if1\" ; fi\n", "delta": "0:00:00.106855", "end": "2019-11-18 00:09:25.773738", "item": [{"bridge_name": "t1br2", "default_route_ip": "10.1.2.1", "dns": [{"brif": "t1s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t1s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns2", "route": [{"if": "p1", "ip": "10.1.2.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "2.2.2.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns2if", "tenant_ns_ip": "10.1.2.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s2if", "tenant_sub_ip": "10.1.2.2/24"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, {"brif": "t1br2if1", "disk": "10G", "mem": 3, "name": "t1_VM3", "vcpu": 2, "vmif": "t1VM3if1"}], "rc": 0, "start": "2019-11-18 00:09:25.666883", "stderr": "", "stderr_lines": [], "stdout": "24: t1br2if1@t1VM3if1: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP mode DEFAULT group default qlen 1000\n    link/ether ba:d8:2f:e0:98:a5 brd ff:ff:ff:ff:ff:ff", "stdout_lines": ["24: t1br2if1@t1VM3if1: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP mode DEFAULT group default qlen 1000", "    link/ether ba:d8:2f:e0:98:a5 brd ff:ff:ff:ff:ff:ff"]}

TASK [All interfaces and bridges UP] ************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.1.2/24', u'tenant_ns_ip': u'10.1.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.1.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.1.2', u'remote_route': u'10.2.1.0/24', u'subnet_route': u'10.1.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.2.1.2'}]}, {u'mem': 2, u'name': u't1_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM1if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t1ns1\" ip link set \"t1br1if1\" up\nip netns exec \"t1ns1\" ip link set dev \"t1br1\" up\n", "delta": "0:00:00.072744", "end": "2019-11-18 00:09:26.089979", "item": [{"bridge_name": "t1br1", "default_route_ip": "10.1.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.1.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.1.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.1.1.2/24"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.1.2", "remote_ip": "10.2.1.2", "remote_route": "10.2.1.0/24", "subnet_route": "10.1.1.0/24", "tenant_route_ip": "192.168.1.2", "v_name": "vxlan_t1s1"}]}, {"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM1", "vcpu": 4, "vmif": "t1VM1if1"}], "rc": 0, "start": "2019-11-18 00:09:26.017235", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.1.2/24', u'tenant_ns_ip': u'10.1.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.1.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.1.2', u'remote_route': u'10.2.1.0/24', u'subnet_route': u'10.1.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.2.1.2'}]}, {u'mem': 4, u'name': u't1_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br1if2', u'vmif': u't1VM2if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t1ns1\" ip link set \"t1br1if2\" up\nip netns exec \"t1ns1\" ip link set dev \"t1br1\" up\n", "delta": "0:00:00.071083", "end": "2019-11-18 00:09:26.341771", "item": [{"bridge_name": "t1br1", "default_route_ip": "10.1.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.1.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.1.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.1.1.2/24"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.1.2", "remote_ip": "10.2.1.2", "remote_route": "10.2.1.0/24", "subnet_route": "10.1.1.0/24", "tenant_route_ip": "192.168.1.2", "v_name": "vxlan_t1s1"}]}, {"brif": "t1br1if2", "disk": "10G", "mem": 4, "name": "t1_VM2", "vcpu": 2, "vmif": "t1VM2if1"}], "rc": 0, "start": "2019-11-18 00:09:26.270688", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.2.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.2.1', u'bridge_name': u't1br2', u'dns': [{u'dnsif': u't1s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s2_dnsbrif'}], u'ns_name': u't1ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.2.2/24', u'tenant_ns_ip': u'10.1.2.1/24', u'tenant_ns_if': u't1ns2if', u'tenant_sub_if': u't1s2if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'2.2.2.0/24', u'vxlan': [{u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}, {u'mem': 3, u'name': u't1_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br2if1', u'vmif': u't1VM3if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t1ns2\" ip link set \"t1br2if1\" up\nip netns exec \"t1ns2\" ip link set dev \"t1br2\" up\n", "delta": "0:00:00.077643", "end": "2019-11-18 00:09:26.605669", "item": [{"bridge_name": "t1br2", "default_route_ip": "10.1.2.1", "dns": [{"brif": "t1s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t1s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns2", "route": [{"if": "p1", "ip": "10.1.2.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "2.2.2.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns2if", "tenant_ns_ip": "10.1.2.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s2if", "tenant_sub_ip": "10.1.2.2/24"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, {"brif": "t1br2if1", "disk": "10G", "mem": 3, "name": "t1_VM3", "vcpu": 2, "vmif": "t1VM3if1"}], "rc": 0, "start": "2019-11-18 00:09:26.528026", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Add IP to DNS Interface] ******************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.1.1', u'bridge_name': u't1br1', u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.1.2/24', u'tenant_ns_ip': u'10.1.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't1_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM1if1'}, {u'mem': 4, u'name': u't1_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br1if2', u'vmif': u't1VM2if1'}], u'vxlan': [{u'local_ip': u'10.1.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.1.2', u'remote_route': u'10.2.1.0/24', u'subnet_route': u'10.1.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.2.1.2'}]}, {u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t1ns1\" ip addr show \"t1s1_dnsif\" | awk 'FNR==3{ print $2 }' | grep -w '^1.1.1.1/24' ; if [ $? -ne 0 ] ; then ip netns exec \"t1ns1\" ip addr add \"1.1.1.1/24\" dev \"t1s1_dnsif\" ; fi\n", "delta": "0:00:00.083686", "end": "2019-11-18 00:09:26.957864", "item": [{"bridge_name": "t1br1", "default_route_ip": "10.1.1.1", "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.1.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.1.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.1.1.2/24"}], "vms": [{"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM1", "vcpu": 4, "vmif": "t1VM1if1"}, {"brif": "t1br1if2", "disk": "10G", "mem": 4, "name": "t1_VM2", "vcpu": 2, "vmif": "t1VM2if1"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.1.2", "remote_ip": "10.2.1.2", "remote_route": "10.2.1.0/24", "subnet_route": "10.1.1.0/24", "tenant_route_ip": "192.168.1.2", "v_name": "vxlan_t1s1"}]}, {"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "rc": 0, "start": "2019-11-18 00:09:26.874178", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.2.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.2.1', u'bridge_name': u't1br2', u'ns_name': u't1ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.2.2/24', u'tenant_ns_ip': u'10.1.2.1/24', u'tenant_ns_if': u't1ns2if', u'tenant_sub_if': u't1s2if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'2.2.2.0/24', u'vms': [{u'mem': 3, u'name': u't1_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br2if1', u'vmif': u't1VM3if1'}], u'vxlan': [{u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}, {u'dnsif': u't1s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s2_dnsbrif'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t1ns2\" ip addr show \"t1s2_dnsif\" | awk 'FNR==3{ print $2 }' | grep -w '^2.2.2.1/24' ; if [ $? -ne 0 ] ; then ip netns exec \"t1ns2\" ip addr add \"2.2.2.1/24\" dev \"t1s2_dnsif\" ; fi\n", "delta": "0:00:00.070307", "end": "2019-11-18 00:09:27.241921", "item": [{"bridge_name": "t1br2", "default_route_ip": "10.1.2.1", "ns_name": "t1ns2", "route": [{"if": "p1", "ip": "10.1.2.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "2.2.2.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns2if", "tenant_ns_ip": "10.1.2.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s2if", "tenant_sub_ip": "10.1.2.2/24"}], "vms": [{"brif": "t1br2if1", "disk": "10G", "mem": 3, "name": "t1_VM3", "vcpu": 2, "vmif": "t1VM3if1"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, {"brif": "t1s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t1s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "rc": 0, "start": "2019-11-18 00:09:27.171614", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Install DHCP Server] **********************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.1.1', u'bridge_name': u't1br1', u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.1.2/24', u'tenant_ns_ip': u'10.1.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't1_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM1if1'}, {u'mem': 4, u'name': u't1_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br1if2', u'vmif': u't1VM2if1'}], u'vxlan': [{u'local_ip': u'10.1.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.1.2', u'remote_route': u'10.2.1.0/24', u'subnet_route': u'10.1.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.2.1.2'}]}, {u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t1ns1\" ps aux | grep -w '[d]nsmasq --interface t1s1_dnsif -z --dhcp-range=1.1.1.5,1.1.1.126' ; if [ $? -ne 0 ] ; then ip netns exec \"t1ns1\" dnsmasq --interface \"t1s1_dnsif\" -z --dhcp-range=1.1.1.5,'1.1.1.126' ; fi\n", "delta": "0:00:00.070577", "end": "2019-11-18 00:09:27.586779", "item": [{"bridge_name": "t1br1", "default_route_ip": "10.1.1.1", "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.1.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.1.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.1.1.2/24"}], "vms": [{"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM1", "vcpu": 4, "vmif": "t1VM1if1"}, {"brif": "t1br1if2", "disk": "10G", "mem": 4, "name": "t1_VM2", "vcpu": 2, "vmif": "t1VM2if1"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.1.2", "remote_ip": "10.2.1.2", "remote_route": "10.2.1.0/24", "subnet_route": "10.1.1.0/24", "tenant_route_ip": "192.168.1.2", "v_name": "vxlan_t1s1"}]}, {"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "rc": 0, "start": "2019-11-18 00:09:27.516202", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.2.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.2.1', u'bridge_name': u't1br2', u'ns_name': u't1ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.2.2/24', u'tenant_ns_ip': u'10.1.2.1/24', u'tenant_ns_if': u't1ns2if', u'tenant_sub_if': u't1s2if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'2.2.2.0/24', u'vms': [{u'mem': 3, u'name': u't1_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br2if1', u'vmif': u't1VM3if1'}], u'vxlan': [{u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}, {u'dnsif': u't1s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s2_dnsbrif'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t1ns2\" ps aux | grep -w '[d]nsmasq --interface t1s2_dnsif -z --dhcp-range=2.2.2.5,2.2.2.254' ; if [ $? -ne 0 ] ; then ip netns exec \"t1ns2\" dnsmasq --interface \"t1s2_dnsif\" -z --dhcp-range=2.2.2.5,'2.2.2.254' ; fi\n", "delta": "0:00:00.065855", "end": "2019-11-18 00:09:27.874155", "item": [{"bridge_name": "t1br2", "default_route_ip": "10.1.2.1", "ns_name": "t1ns2", "route": [{"if": "p1", "ip": "10.1.2.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "2.2.2.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns2if", "tenant_ns_ip": "10.1.2.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s2if", "tenant_sub_ip": "10.1.2.2/24"}], "vms": [{"brif": "t1br2if1", "disk": "10G", "mem": 3, "name": "t1_VM3", "vcpu": 2, "vmif": "t1VM3if1"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, {"brif": "t1s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t1s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "rc": 0, "start": "2019-11-18 00:09:27.808300", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Create VXLAN devices] *********************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.1.2/24', u'tenant_ns_ip': u'10.1.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't1_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM1if1'}, {u'mem': 4, u'name': u't1_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br1if2', u'vmif': u't1VM2if1'}]}, {u'local_ip': u'10.1.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.1.2', u'remote_route': u'10.2.1.0/24', u'subnet_route': u'10.1.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.2.1.2'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t1ns1\" ip link show \"vxlan_t1s1\" ; if [ $? -ne 0 ] ; then ip netns exec \"t1ns1\" ip link add \"vxlan_t1s1\" type vxlan id \"42\" local \"10.1.1.2\" remote \"10.2.1.2\" dstport \"4789\" dev \"t1s1if\"; ip netns exec \"t1ns1\" ip link set dev \"vxlan_t1s1\" up ; fi\n", "delta": "0:00:00.114335", "end": "2019-11-18 00:09:28.277925", "item": [{"bridge_name": "t1br1", "default_route_ip": "10.1.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.1.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.1.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.1.1.2/24"}], "vms": [{"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM1", "vcpu": 4, "vmif": "t1VM1if1"}, {"brif": "t1br1if2", "disk": "10G", "mem": 4, "name": "t1_VM2", "vcpu": 2, "vmif": "t1VM2if1"}]}, {"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.1.2", "remote_ip": "10.2.1.2", "remote_route": "10.2.1.0/24", "subnet_route": "10.1.1.0/24", "tenant_route_ip": "192.168.1.2", "v_name": "vxlan_t1s1"}], "rc": 0, "start": "2019-11-18 00:09:28.163590", "stderr": "Device \"vxlan_t1s1\" does not exist.", "stderr_lines": ["Device \"vxlan_t1s1\" does not exist."], "stdout": "", "stdout_lines": []}
skipping: [localhost] => (item=[{u'route': [{u'ip': u'10.1.2.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.2.1', u'bridge_name': u't1br2', u'dns': [{u'dnsif': u't1s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s2_dnsbrif'}], u'ns_name': u't1ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.2.2/24', u'tenant_ns_ip': u'10.1.2.1/24', u'tenant_ns_if': u't1ns2if', u'tenant_sub_if': u't1s2if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'2.2.2.0/24', u'vms': [{u'mem': 3, u'name': u't1_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br2if1', u'vmif': u't1VM3if1'}]}, {u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}])  => {"ansible_loop_var": "item", "changed": false, "item": [{"bridge_name": "t1br2", "default_route_ip": "10.1.2.1", "dns": [{"brif": "t1s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t1s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns2", "route": [{"if": "p1", "ip": "10.1.2.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "2.2.2.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns2if", "tenant_ns_ip": "10.1.2.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s2if", "tenant_sub_ip": "10.1.2.2/24"}], "vms": [{"brif": "t1br2if1", "disk": "10G", "mem": 3, "name": "t1_VM3", "vcpu": 2, "vmif": "t1VM3if1"}]}, {"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}], "skip_reason": "Conditional result was False"}

TASK [Attach VXLANs to bridge] ******************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.1.2/24', u'tenant_ns_ip': u'10.1.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't1_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM1if1'}, {u'mem': 4, u'name': u't1_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br1if2', u'vmif': u't1VM2if1'}]}, {u'local_ip': u'10.1.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.1.2', u'remote_route': u'10.2.1.0/24', u'subnet_route': u'10.1.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.2.1.2'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t1ns1\" brctl show \"t1br1\" | grep -w 'vxlan_t1s1' ; if [ $? -ne 0 ] ; then ip netns exec \"t1ns1\" brctl addif \"t1br1\" \"vxlan_t1s1\" ; fi\n", "delta": "0:00:00.074166", "end": "2019-11-18 00:09:28.658009", "item": [{"bridge_name": "t1br1", "default_route_ip": "10.1.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.1.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.1.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.1.1.2/24"}], "vms": [{"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM1", "vcpu": 4, "vmif": "t1VM1if1"}, {"brif": "t1br1if2", "disk": "10G", "mem": 4, "name": "t1_VM2", "vcpu": 2, "vmif": "t1VM2if1"}]}, {"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.1.2", "remote_ip": "10.2.1.2", "remote_route": "10.2.1.0/24", "subnet_route": "10.1.1.0/24", "tenant_route_ip": "192.168.1.2", "v_name": "vxlan_t1s1"}], "rc": 0, "start": "2019-11-18 00:09:28.583843", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}
skipping: [localhost] => (item=[{u'route': [{u'ip': u'10.1.2.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.2.1', u'bridge_name': u't1br2', u'dns': [{u'dnsif': u't1s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s2_dnsbrif'}], u'ns_name': u't1ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.2.2/24', u'tenant_ns_ip': u'10.1.2.1/24', u'tenant_ns_if': u't1ns2if', u'tenant_sub_if': u't1s2if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'2.2.2.0/24', u'vms': [{u'mem': 3, u'name': u't1_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br2if1', u'vmif': u't1VM3if1'}]}, {u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}])  => {"ansible_loop_var": "item", "changed": false, "item": [{"bridge_name": "t1br2", "default_route_ip": "10.1.2.1", "dns": [{"brif": "t1s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t1s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns2", "route": [{"if": "p1", "ip": "10.1.2.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "2.2.2.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns2if", "tenant_ns_ip": "10.1.2.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s2if", "tenant_sub_ip": "10.1.2.2/24"}], "vms": [{"brif": "t1br2if1", "disk": "10G", "mem": 3, "name": "t1_VM3", "vcpu": 2, "vmif": "t1VM3if1"}]}, {"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}], "skip_reason": "Conditional result was False"}

PLAY RECAP **************************************************************************************************************************************************
localhost                  : ok=21   changed=21   unreachable=0    failed=0    skipped=0    rescued=0    ignored=0   

Using /etc/ansible/ansible.cfg as config file

PLAY [worker] ***********************************************************************************************************************************************

TASK [Create Tenant Namespace] ******************************************************************************************************************************
changed: [99.99.99.2] => (item={u'default_route_ip': u'192.168.129.1', u'name': u't1', u'pns_ip': u'192.168.129.1/24', u'tenant_if': u't1if', u'tenant_ip': u'192.168.129.2/24', u'pns_if': u't1pns_if'}) => {"ansible_loop_var": "item", "changed": true, "cmd": ["ip", "netns", "add", "t1"], "delta": "0:00:00.061360", "end": "2019-11-18 00:09:30.612519", "item": {"default_route_ip": "192.168.129.1", "name": "t1", "pns_if": "t1pns_if", "pns_ip": "192.168.129.1/24", "tenant_if": "t1if", "tenant_ip": "192.168.129.2/24"}, "rc": 0, "start": "2019-11-18 00:09:30.551159", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Create Subnet Namespace] ******************************************************************************************************************************
changed: [99.99.99.2] => (item={u'route': [{u'ip': u'10.2.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.2.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.1.2/24', u'tenant_ns_ip': u'10.2.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_ns_name': u't1', u'tenant_sub_if': u't1s1if'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't1_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM4if1'}], u'vxlan': [{u'local_ip': u'10.2.1.2', u'tenant_route_ip': u'192.168.129.2', u'dsport': 4789, u'dev': u't1s1if', u'subnet_route': u'10.2.1.0/24', u'remote_route': u'10.1.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.1.1.2'}]}) => {"ansible_loop_var": "item", "changed": true, "cmd": ["ip", "netns", "add", "t1ns1"], "delta": "0:00:00.059298", "end": "2019-11-18 00:09:31.076479", "item": {"bridge_name": "t1br1", "default_route_ip": "10.2.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.2.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.2.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.2.1.2/24"}], "vms": [{"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM4", "vcpu": 4, "vmif": "t1VM4if1"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.1.2", "remote_ip": "10.1.1.2", "remote_route": "10.1.1.0/24", "subnet_route": "10.2.1.0/24", "tenant_route_ip": "192.168.129.2", "v_name": "vxlan_t1s1"}]}, "rc": 0, "start": "2019-11-18 00:09:31.017181", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Create Tenant VETH pairs] *****************************************************************************************************************************
changed: [99.99.99.2] => (item={u'default_route_ip': u'192.168.129.1', u'name': u't1', u'pns_ip': u'192.168.129.1/24', u'tenant_if': u't1if', u'tenant_ip': u'192.168.129.2/24', u'pns_if': u't1pns_if'}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip link show \"t1if\" ; if [ $? -ne 0 ] ; then ip link add \"t1if\" type veth peer name \"t1pns_if\" ; fi\n", "delta": "0:00:00.012402", "end": "2019-11-18 00:09:31.467053", "item": {"default_route_ip": "192.168.129.1", "name": "t1", "pns_if": "t1pns_if", "pns_ip": "192.168.129.1/24", "tenant_if": "t1if", "tenant_ip": "192.168.129.2/24"}, "rc": 0, "start": "2019-11-18 00:09:31.454651", "stderr": "Device \"t1if\" does not exist.", "stderr_lines": ["Device \"t1if\" does not exist."], "stdout": "", "stdout_lines": []}

TASK [Attach Tenant VETH Pairs] *****************************************************************************************************************************
changed: [99.99.99.2] => (item={u'default_route_ip': u'192.168.129.1', u'name': u't1', u'pns_ip': u'192.168.129.1/24', u'tenant_if': u't1if', u'tenant_ip': u'192.168.129.2/24', u'pns_if': u't1pns_if'}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec pns ip link show \"t1pns_if\" ; if [ $? -ne 0 ] ; then ip link set \"t1pns_if\" netns pns ; fi\nip netns exec \"t1\" ip link show \"t1if\" ; if [ $? -ne 0 ] ; then ip link set \"t1if\" netns \"t1\" ; fi\nip netns exec pns ip link set dev \"t1pns_if\" up\nip netns exec \"t1\" ip link set dev \"t1if\" up\n", "delta": "0:00:00.199088", "end": "2019-11-18 00:09:32.048240", "item": {"default_route_ip": "192.168.129.1", "name": "t1", "pns_if": "t1pns_if", "pns_ip": "192.168.129.1/24", "tenant_if": "t1if", "tenant_ip": "192.168.129.2/24"}, "rc": 0, "start": "2019-11-18 00:09:31.849152", "stderr": "Device \"t1pns_if\" does not exist.\nDevice \"t1if\" does not exist.", "stderr_lines": ["Device \"t1pns_if\" does not exist.", "Device \"t1if\" does not exist."], "stdout": "", "stdout_lines": []}

TASK [Add IP addresses to Tenant VETH Pairs] ****************************************************************************************************************
changed: [99.99.99.2] => (item={u'default_route_ip': u'192.168.129.1', u'name': u't1', u'pns_ip': u'192.168.129.1/24', u'tenant_if': u't1if', u'tenant_ip': u'192.168.129.2/24', u'pns_if': u't1pns_if'}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec pns ip addr show \"t1pns_if\" | awk 'FNR==3{ print $2 }' | grep -w '^192.168.129.1/24' ; if [ $? -ne 0 ] ; then ip netns exec pns ip addr add \"192.168.129.1/24\" dev \"t1pns_if\" ; fi\nip netns exec \"t1\" ip addr show \"t1if\" | awk 'FNR==3{ print $2 }' | grep -w '^192.168.129.2/24' ; if [ $? -ne 0 ] ; then ip netns exec \"t1\" ip addr add \"192.168.129.2/24\" dev \"t1if\" ; fi\n", "delta": "0:00:00.164685", "end": "2019-11-18 00:09:32.592453", "item": {"default_route_ip": "192.168.129.1", "name": "t1", "pns_if": "t1pns_if", "pns_ip": "192.168.129.1/24", "tenant_if": "t1if", "tenant_ip": "192.168.129.2/24"}, "rc": 0, "start": "2019-11-18 00:09:32.427768", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Create Namespace VETH Pairs] **************************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.2.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't1_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM4if1'}], u'vxlan': [{u'local_ip': u'10.2.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.129.2', u'remote_route': u'10.1.1.0/24', u'subnet_route': u'10.2.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.1.1.2'}]}, {u'tenant_sub_ip': u'10.2.1.2/24', u'tenant_ns_ip': u'10.2.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip link show \"t1ns1if\" ; if [ $? -ne 0 ] ; then ip link add \"t1ns1if\" type veth peer name \"t1s1if\" ; fi\n", "delta": "0:00:00.012430", "end": "2019-11-18 00:09:32.971322", "item": [{"bridge_name": "t1br1", "default_route_ip": "10.2.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.2.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "vms": [{"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM4", "vcpu": 4, "vmif": "t1VM4if1"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.1.2", "remote_ip": "10.1.1.2", "remote_route": "10.1.1.0/24", "subnet_route": "10.2.1.0/24", "tenant_route_ip": "192.168.129.2", "v_name": "vxlan_t1s1"}]}, {"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.2.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.2.1.2/24"}], "rc": 0, "start": "2019-11-18 00:09:32.958892", "stderr": "Device \"t1ns1if\" does not exist.", "stderr_lines": ["Device \"t1ns1if\" does not exist."], "stdout": "", "stdout_lines": []}

TASK [Attach Namespace VETH Pairs] **************************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.2.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't1_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM4if1'}], u'vxlan': [{u'local_ip': u'10.2.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.129.2', u'remote_route': u'10.1.1.0/24', u'subnet_route': u'10.2.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.1.1.2'}]}, {u'tenant_sub_ip': u'10.2.1.2/24', u'tenant_ns_ip': u'10.2.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t1\" ip link show \"t1ns1if\" ; if [ $? -ne 0 ] ; then ip link set \"t1ns1if\" netns \"t1\" ; fi\nip netns exec \"t1ns1\" ip link show \"t1s1if\" ; if [ $? -ne 0 ] ; then ip link set \"t1s1if\" netns \"t1ns1\" ; fi\n", "delta": "0:00:00.119718", "end": "2019-11-18 00:09:33.505667", "item": [{"bridge_name": "t1br1", "default_route_ip": "10.2.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.2.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "vms": [{"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM4", "vcpu": 4, "vmif": "t1VM4if1"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.1.2", "remote_ip": "10.1.1.2", "remote_route": "10.1.1.0/24", "subnet_route": "10.2.1.0/24", "tenant_route_ip": "192.168.129.2", "v_name": "vxlan_t1s1"}]}, {"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.2.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.2.1.2/24"}], "rc": 0, "start": "2019-11-18 00:09:33.385949", "stderr": "Device \"t1ns1if\" does not exist.\nDevice \"t1s1if\" does not exist.", "stderr_lines": ["Device \"t1ns1if\" does not exist.", "Device \"t1s1if\" does not exist."], "stdout": "", "stdout_lines": []}

TASK [Set Namespace VETH Pairs UP] **************************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.2.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't1_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM4if1'}], u'vxlan': [{u'local_ip': u'10.2.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.129.2', u'remote_route': u'10.1.1.0/24', u'subnet_route': u'10.2.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.1.1.2'}]}, {u'tenant_sub_ip': u'10.2.1.2/24', u'tenant_ns_ip': u'10.2.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t1\" ip link set dev \"t1ns1if\" up\nip netns exec \"t1ns1\" ip link set dev \"t1s1if\" up\n", "delta": "0:00:00.091129", "end": "2019-11-18 00:09:33.972595", "item": [{"bridge_name": "t1br1", "default_route_ip": "10.2.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.2.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "vms": [{"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM4", "vcpu": 4, "vmif": "t1VM4if1"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.1.2", "remote_ip": "10.1.1.2", "remote_route": "10.1.1.0/24", "subnet_route": "10.2.1.0/24", "tenant_route_ip": "192.168.129.2", "v_name": "vxlan_t1s1"}]}, {"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.2.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.2.1.2/24"}], "rc": 0, "start": "2019-11-18 00:09:33.881466", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Add IP addresses to Namespace VETH Pairs] *************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.2.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't1_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM4if1'}], u'vxlan': [{u'local_ip': u'10.2.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.129.2', u'remote_route': u'10.1.1.0/24', u'subnet_route': u'10.2.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.1.1.2'}]}, {u'tenant_sub_ip': u'10.2.1.2/24', u'tenant_ns_ip': u'10.2.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t1ns1\" ip addr show \"t1s1if\" | awk 'FNR==3{ print $2 }' | grep -w '^10.2.1.2/24' ; if [ $? -ne 0 ] ; then ip netns exec \"t1ns1\" ip addr add \"10.2.1.2/24\" dev \"t1s1if\" ; fi\n\nip netns exec \"t1\" ip addr show \"t1ns1if\" | awk 'FNR==3{ print $2 }' | grep -w '^10.2.1.1/24' ; if [ $? -ne 0 ] ; then ip netns exec \"t1\" ip addr add \"10.2.1.1/24\" dev \"t1ns1if\" ; fi\n", "delta": "0:00:00.160969", "end": "2019-11-18 00:09:34.504293", "item": [{"bridge_name": "t1br1", "default_route_ip": "10.2.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.2.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "vms": [{"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM4", "vcpu": 4, "vmif": "t1VM4if1"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.1.2", "remote_ip": "10.1.1.2", "remote_route": "10.1.1.0/24", "subnet_route": "10.2.1.0/24", "tenant_route_ip": "192.168.129.2", "v_name": "vxlan_t1s1"}]}, {"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.2.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.2.1.2/24"}], "rc": 0, "start": "2019-11-18 00:09:34.343324", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Add IP Route to Tenant] *******************************************************************************************************************************
changed: [99.99.99.2] => (item={u'default_route_ip': u'192.168.129.1', u'name': u't1', u'pns_ip': u'192.168.129.1/24', u'tenant_if': u't1if', u'tenant_ip': u'192.168.129.2/24', u'pns_if': u't1pns_if'}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t1\" ip route show default | grep -w '[d]efault via 192.168.129.1' ; if [ $? -ne 0 ] ; then ip netns exec \"t1\" ip route add default via \"192.168.129.1\" ; fi\n", "delta": "0:00:00.078992", "end": "2019-11-18 00:09:34.964387", "item": {"default_route_ip": "192.168.129.1", "name": "t1", "pns_if": "t1pns_if", "pns_ip": "192.168.129.1/24", "tenant_if": "t1if", "tenant_ip": "192.168.129.2/24"}, "rc": 0, "start": "2019-11-18 00:09:34.885395", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Add IP Route to Tenant Subnet] ************************************************************************************************************************
changed: [99.99.99.2] => (item={u'route': [{u'ip': u'10.2.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.2.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.1.2/24', u'tenant_ns_ip': u'10.2.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_ns_name': u't1', u'tenant_sub_if': u't1s1if'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't1_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM4if1'}], u'vxlan': [{u'local_ip': u'10.2.1.2', u'tenant_route_ip': u'192.168.129.2', u'dsport': 4789, u'dev': u't1s1if', u'subnet_route': u'10.2.1.0/24', u'remote_route': u'10.1.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.1.1.2'}]}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t1ns1\" ip route show default | grep -w '[d]efault via 10.2.1.1' ; if [ $? -ne 0 ] ; then ip netns exec \"t1ns1\" ip route add default via \"10.2.1.1\" ; fi\n", "delta": "0:00:00.086332", "end": "2019-11-18 00:09:35.436522", "item": {"bridge_name": "t1br1", "default_route_ip": "10.2.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.2.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.2.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.2.1.2/24"}], "vms": [{"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM4", "vcpu": 4, "vmif": "t1VM4if1"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.1.2", "remote_ip": "10.1.1.2", "remote_route": "10.1.1.0/24", "subnet_route": "10.2.1.0/24", "tenant_route_ip": "192.168.129.2", "v_name": "vxlan_t1s1"}]}, "rc": 0, "start": "2019-11-18 00:09:35.350190", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Create bridge inside namespace] ***********************************************************************************************************************
changed: [99.99.99.2] => (item={u'route': [{u'ip': u'10.2.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.2.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.1.2/24', u'tenant_ns_ip': u'10.2.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_ns_name': u't1', u'tenant_sub_if': u't1s1if'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't1_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM4if1'}], u'vxlan': [{u'local_ip': u'10.2.1.2', u'tenant_route_ip': u'192.168.129.2', u'dsport': 4789, u'dev': u't1s1if', u'subnet_route': u'10.2.1.0/24', u'remote_route': u'10.1.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.1.1.2'}]}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t1ns1\" brctl show | grep -w '^t1br1'; if [ $? -ne 0 ] ; then ip netns exec \"t1ns1\" brctl addbr \"t1br1\" ; fi\nip netns exec \"t1ns1\" ip link set dev \"t1br1\" up\n", "delta": "0:00:00.139127", "end": "2019-11-18 00:09:35.940550", "item": {"bridge_name": "t1br1", "default_route_ip": "10.2.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.2.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.2.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.2.1.2/24"}], "vms": [{"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM4", "vcpu": 4, "vmif": "t1VM4if1"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.1.2", "remote_ip": "10.1.1.2", "remote_route": "10.1.1.0/24", "subnet_route": "10.2.1.0/24", "tenant_route_ip": "192.168.129.2", "v_name": "vxlan_t1s1"}]}, "rc": 0, "start": "2019-11-18 00:09:35.801423", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Create DNS VETH Pair] *********************************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.2.1.1', u'bridge_name': u't1br1', u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.1.2/24', u'tenant_ns_ip': u'10.2.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't1_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM4if1'}], u'vxlan': [{u'local_ip': u'10.2.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.129.2', u'remote_route': u'10.1.1.0/24', u'subnet_route': u'10.2.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.1.1.2'}]}, {u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t1ns1\" ip link show \"t1s1_dnsbrif\" ; if [ $? -ne 0 ] ; then ip netns exec \"t1ns1\" ip link add \"t1s1_dnsbrif\" type veth peer name \"t1s1_dnsif\" ; fi\nip netns exec \"t1ns1\" ip link set dev \"t1s1_dnsbrif\" up\nip netns exec \"t1ns1\" ip link set dev \"t1s1_dnsif\" up\n", "delta": "0:00:00.166343", "end": "2019-11-18 00:09:36.496534", "item": [{"bridge_name": "t1br1", "default_route_ip": "10.2.1.1", "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.2.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.2.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.2.1.2/24"}], "vms": [{"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM4", "vcpu": 4, "vmif": "t1VM4if1"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.1.2", "remote_ip": "10.1.1.2", "remote_route": "10.1.1.0/24", "subnet_route": "10.2.1.0/24", "tenant_route_ip": "192.168.129.2", "v_name": "vxlan_t1s1"}]}, {"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "rc": 0, "start": "2019-11-18 00:09:36.330191", "stderr": "Device \"t1s1_dnsbrif\" does not exist.", "stderr_lines": ["Device \"t1s1_dnsbrif\" does not exist."], "stdout": "", "stdout_lines": []}

TASK [Attach DNS VETH Pair] *********************************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.2.1.1', u'bridge_name': u't1br1', u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.1.2/24', u'tenant_ns_ip': u'10.2.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't1_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM4if1'}], u'vxlan': [{u'local_ip': u'10.2.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.129.2', u'remote_route': u'10.1.1.0/24', u'subnet_route': u'10.2.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.1.1.2'}]}, {u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t1ns1\" brctl show \"t1br1\" | grep -w 't1s1_dnsbrif' ; if [ $? -ne 0 ] ; then ip netns exec \"t1ns1\" brctl addif \"t1br1\" \"t1s1_dnsbrif\" ; fi\n", "delta": "0:00:00.089385", "end": "2019-11-18 00:09:36.984442", "item": [{"bridge_name": "t1br1", "default_route_ip": "10.2.1.1", "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.2.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.2.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.2.1.2/24"}], "vms": [{"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM4", "vcpu": 4, "vmif": "t1VM4if1"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.1.2", "remote_ip": "10.1.1.2", "remote_route": "10.1.1.0/24", "subnet_route": "10.2.1.0/24", "tenant_route_ip": "192.168.129.2", "v_name": "vxlan_t1s1"}]}, {"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "rc": 0, "start": "2019-11-18 00:09:36.895057", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Create VETH Pairs] ************************************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.2.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.1.2/24', u'tenant_ns_ip': u'10.2.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.2.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.129.2', u'remote_route': u'10.1.1.0/24', u'subnet_route': u'10.2.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.1.1.2'}]}, {u'mem': 2, u'name': u't1_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM4if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip link show \"t1br1if1\" ; if [ $? -ne 0 ] ; then ip link add \"t1VM4if1\" type veth peer name \"t1br1if1\" ; fi\nip link set dev \"t1br1if1\" up\nip link set dev \"t1VM4if1\" up\n", "delta": "0:00:00.021429", "end": "2019-11-18 00:09:37.381646", "item": [{"bridge_name": "t1br1", "default_route_ip": "10.2.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.2.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.2.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.2.1.2/24"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.1.2", "remote_ip": "10.1.1.2", "remote_route": "10.1.1.0/24", "subnet_route": "10.2.1.0/24", "tenant_route_ip": "192.168.129.2", "v_name": "vxlan_t1s1"}]}, {"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM4", "vcpu": 4, "vmif": "t1VM4if1"}], "rc": 0, "start": "2019-11-18 00:09:37.360217", "stderr": "Device \"t1br1if1\" does not exist.", "stderr_lines": ["Device \"t1br1if1\" does not exist."], "stdout": "", "stdout_lines": []}

TASK [Attach VETH Pairs] ************************************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.2.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.1.2/24', u'tenant_ns_ip': u'10.2.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.2.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.129.2', u'remote_route': u'10.1.1.0/24', u'subnet_route': u'10.2.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.1.1.2'}]}, {u'mem': 2, u'name': u't1_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM4if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip link show \"t1br1if1\" ; if [ $? -eq 0 ] ; then ip link set \"t1br1if1\" netns \"t1ns1\" ; fi\nip netns exec \"t1ns1\" brctl show \"t1br1\" | grep -w 't1br1if1' ; if [ $? -ne 0 ] ; then ip netns exec \"t1ns1\" brctl addif \"t1br1\" \"t1br1if1\" ; fi\n", "delta": "0:00:00.102724", "end": "2019-11-18 00:09:37.864092", "item": [{"bridge_name": "t1br1", "default_route_ip": "10.2.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.2.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.2.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.2.1.2/24"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.1.2", "remote_ip": "10.1.1.2", "remote_route": "10.1.1.0/24", "subnet_route": "10.2.1.0/24", "tenant_route_ip": "192.168.129.2", "v_name": "vxlan_t1s1"}]}, {"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM4", "vcpu": 4, "vmif": "t1VM4if1"}], "rc": 0, "start": "2019-11-18 00:09:37.761368", "stderr": "", "stderr_lines": [], "stdout": "18: t1br1if1@t1VM4if1: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP mode DEFAULT group default qlen 1000\n    link/ether fa:7e:01:76:74:11 brd ff:ff:ff:ff:ff:ff", "stdout_lines": ["18: t1br1if1@t1VM4if1: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP mode DEFAULT group default qlen 1000", "    link/ether fa:7e:01:76:74:11 brd ff:ff:ff:ff:ff:ff"]}

TASK [All interfaces and bridges UP] ************************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.2.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.1.2/24', u'tenant_ns_ip': u'10.2.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.2.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.129.2', u'remote_route': u'10.1.1.0/24', u'subnet_route': u'10.2.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.1.1.2'}]}, {u'mem': 2, u'name': u't1_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM4if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t1ns1\" ip link set \"t1br1if1\" up\nip netns exec \"t1ns1\" ip link set dev \"t1br1\" up\n", "delta": "0:00:00.067901", "end": "2019-11-18 00:09:38.304363", "item": [{"bridge_name": "t1br1", "default_route_ip": "10.2.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.2.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.2.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.2.1.2/24"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.1.2", "remote_ip": "10.1.1.2", "remote_route": "10.1.1.0/24", "subnet_route": "10.2.1.0/24", "tenant_route_ip": "192.168.129.2", "v_name": "vxlan_t1s1"}]}, {"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM4", "vcpu": 4, "vmif": "t1VM4if1"}], "rc": 0, "start": "2019-11-18 00:09:38.236462", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Add IP to DNS Interface] ******************************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.2.1.1', u'bridge_name': u't1br1', u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.1.2/24', u'tenant_ns_ip': u'10.2.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't1_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM4if1'}], u'vxlan': [{u'local_ip': u'10.2.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.129.2', u'remote_route': u'10.1.1.0/24', u'subnet_route': u'10.2.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.1.1.2'}]}, {u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t1ns1\" ip addr show \"t1s1_dnsif\" | awk 'FNR==3{ print $2}'| grep -w '^1.1.1.128/24' ; if [ $? -ne 0 ] ; then ip netns exec \"t1ns1\" ip addr add \"1.1.1.128/24\" dev \"t1s1_dnsif\" ; fi\n", "delta": "0:00:00.094420", "end": "2019-11-18 00:09:38.764444", "item": [{"bridge_name": "t1br1", "default_route_ip": "10.2.1.1", "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.2.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.2.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.2.1.2/24"}], "vms": [{"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM4", "vcpu": 4, "vmif": "t1VM4if1"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.1.2", "remote_ip": "10.1.1.2", "remote_route": "10.1.1.0/24", "subnet_route": "10.2.1.0/24", "tenant_route_ip": "192.168.129.2", "v_name": "vxlan_t1s1"}]}, {"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "rc": 0, "start": "2019-11-18 00:09:38.670024", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Install DHCP Server] **********************************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.2.1.1', u'bridge_name': u't1br1', u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.1.2/24', u'tenant_ns_ip': u'10.2.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't1_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM4if1'}], u'vxlan': [{u'local_ip': u'10.2.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.129.2', u'remote_route': u'10.1.1.0/24', u'subnet_route': u'10.2.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.1.1.2'}]}, {u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t1ns1\" ps aux | grep -w '[d]nsmasq --interface t1s1_dnsif -z --dhcp-range=1.1.1.133,1.1.1.254' ; if [ $? -ne 0 ] ; then ip netns exec \"t1ns1\" dnsmasq --interface \"t1s1_dnsif\" -z --dhcp-range=1.1.1.133,'1.1.1.254' ; fi\n", "delta": "0:00:00.087662", "end": "2019-11-18 00:09:39.229465", "item": [{"bridge_name": "t1br1", "default_route_ip": "10.2.1.1", "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.2.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.2.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.2.1.2/24"}], "vms": [{"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM4", "vcpu": 4, "vmif": "t1VM4if1"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.1.2", "remote_ip": "10.1.1.2", "remote_route": "10.1.1.0/24", "subnet_route": "10.2.1.0/24", "tenant_route_ip": "192.168.129.2", "v_name": "vxlan_t1s1"}]}, {"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "rc": 0, "start": "2019-11-18 00:09:39.141803", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Create VXLAN devices] *********************************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.2.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.1.2/24', u'tenant_ns_ip': u'10.2.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't1_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM4if1'}]}, {u'local_ip': u'10.2.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.129.2', u'remote_route': u'10.1.1.0/24', u'subnet_route': u'10.2.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.1.1.2'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t1ns1\" ip link show \"vxlan_t1s1\" ; if [ $? -ne 0 ] ; then ip netns exec \"t1ns1\" ip link add \"vxlan_t1s1\" type vxlan id \"42\" local \"10.2.1.2\" remote \"10.1.1.2\" dstport \"4789\" dev \"t1s1if\" ; ip netns exec \"t1ns1\" ip link set dev \"vxlan_t1s1\" up ; fi\n", "delta": "0:00:00.131466", "end": "2019-11-18 00:09:39.764425", "item": [{"bridge_name": "t1br1", "default_route_ip": "10.2.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.2.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.2.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.2.1.2/24"}], "vms": [{"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM4", "vcpu": 4, "vmif": "t1VM4if1"}]}, {"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.1.2", "remote_ip": "10.1.1.2", "remote_route": "10.1.1.0/24", "subnet_route": "10.2.1.0/24", "tenant_route_ip": "192.168.129.2", "v_name": "vxlan_t1s1"}], "rc": 0, "start": "2019-11-18 00:09:39.632959", "stderr": "Device \"vxlan_t1s1\" does not exist.", "stderr_lines": ["Device \"vxlan_t1s1\" does not exist."], "stdout": "", "stdout_lines": []}

TASK [Attach VXLANs to bridge] ******************************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.2.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.1.2/24', u'tenant_ns_ip': u'10.2.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't1_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM4if1'}]}, {u'local_ip': u'10.2.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.129.2', u'remote_route': u'10.1.1.0/24', u'subnet_route': u'10.2.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.1.1.2'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t1ns1\" brctl show \"t1br1\" | grep -w 'vxlan_t1s1' ; if [ $? -ne 0 ] ; then ip netns exec \"t1ns1\" brctl addif \"t1br1\" \"vxlan_t1s1\" ; fi\n", "delta": "0:00:00.070047", "end": "2019-11-18 00:09:40.252445", "item": [{"bridge_name": "t1br1", "default_route_ip": "10.2.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.2.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.2.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.2.1.2/24"}], "vms": [{"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM4", "vcpu": 4, "vmif": "t1VM4if1"}]}, {"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.1.2", "remote_ip": "10.1.1.2", "remote_route": "10.1.1.0/24", "subnet_route": "10.2.1.0/24", "tenant_route_ip": "192.168.129.2", "v_name": "vxlan_t1s1"}], "rc": 0, "start": "2019-11-18 00:09:40.182398", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

PLAY RECAP **************************************************************************************************************************************************
99.99.99.2                 : ok=21   changed=21   unreachable=0    failed=0    skipped=0    rescued=0    ignored=0   

Using /etc/ansible/ansible.cfg as config file

PLAY [main] *************************************************************************************************************************************************

TASK [Add VXLAN routes in PNS] ******************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.1.2/24', u'tenant_ns_ip': u'10.1.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't1_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM1if1'}, {u'mem': 4, u'name': u't1_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br1if2', u'vmif': u't1VM2if1'}]}, {u'local_ip': u'10.1.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.1.2', u'remote_route': u'10.2.1.0/24', u'subnet_route': u'10.1.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.2.1.2'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec pns ip route show \"10.1.1.0/24\" via \"192.168.1.2\" | grep -w '^10.1.1.0/24' ; if [ $? -ne 0 ] ; then ip netns exec pns ip route add \"10.1.1.0/24\" via \"192.168.1.2\" ; fi\n", "delta": "0:00:00.072171", "end": "2019-11-18 00:09:41.361601", "item": [{"bridge_name": "t1br1", "default_route_ip": "10.1.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.1.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.1.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.1.1.2/24"}], "vms": [{"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM1", "vcpu": 4, "vmif": "t1VM1if1"}, {"brif": "t1br1if2", "disk": "10G", "mem": 4, "name": "t1_VM2", "vcpu": 2, "vmif": "t1VM2if1"}]}, {"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.1.2", "remote_ip": "10.2.1.2", "remote_route": "10.2.1.0/24", "subnet_route": "10.1.1.0/24", "tenant_route_ip": "192.168.1.2", "v_name": "vxlan_t1s1"}], "rc": 0, "start": "2019-11-18 00:09:41.289430", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}
skipping: [localhost] => (item=[{u'route': [{u'ip': u'10.1.2.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.2.1', u'bridge_name': u't1br2', u'dns': [{u'dnsif': u't1s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s2_dnsbrif'}], u'ns_name': u't1ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.2.2/24', u'tenant_ns_ip': u'10.1.2.1/24', u'tenant_ns_if': u't1ns2if', u'tenant_sub_if': u't1s2if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'2.2.2.0/24', u'vms': [{u'mem': 3, u'name': u't1_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br2if1', u'vmif': u't1VM3if1'}]}, {u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}])  => {"ansible_loop_var": "item", "changed": false, "item": [{"bridge_name": "t1br2", "default_route_ip": "10.1.2.1", "dns": [{"brif": "t1s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t1s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns2", "route": [{"if": "p1", "ip": "10.1.2.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "2.2.2.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns2if", "tenant_ns_ip": "10.1.2.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s2if", "tenant_sub_ip": "10.1.2.2/24"}], "vms": [{"brif": "t1br2if1", "disk": "10G", "mem": 3, "name": "t1_VM3", "vcpu": 2, "vmif": "t1VM3if1"}]}, {"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}], "skip_reason": "Conditional result was False"}

TASK [Get PNS ip address] ***********************************************************************************************************************************
ok: [localhost] => {"changed": false, "cmd": "ip netns exec pns ip addr show p1 | awk 'FNR==3{ print $2 }' | awk -F/ '{ print $1 }'\n", "delta": "0:00:00.046387", "end": "2019-11-18 00:09:41.650125", "rc": 0, "start": "2019-11-18 00:09:41.603738", "stderr": "", "stderr_lines": [], "stdout": "192.168.100.238", "stdout_lines": ["192.168.100.238"]}

TASK [Add VXLAN routes to host] *****************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.1.2/24', u'tenant_ns_ip': u'10.1.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't1_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM1if1'}, {u'mem': 4, u'name': u't1_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br1if2', u'vmif': u't1VM2if1'}]}, {u'local_ip': u'10.1.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.1.2', u'remote_route': u'10.2.1.0/24', u'subnet_route': u'10.1.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.2.1.2'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip route show \"10.1.1.0/24\" via \"192.168.100.238\" | grep -w '^10.1.1.0/24' ; if [ $? -ne 0 ] ; then ip route add \"10.1.1.0/24\" via \"192.168.100.238\" ; fi\nip route show \"10.2.1.0/24\" via 99.99.99.2 | grep -w '^10.2.1.0/24'; if [ $? -ne 0 ] ; then ip route add \"10.2.1.0/24\" via 99.99.99.2 ; fi\n", "delta": "0:00:00.007375", "end": "2019-11-18 00:09:41.912762", "item": [{"bridge_name": "t1br1", "default_route_ip": "10.1.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.1.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.1.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.1.1.2/24"}], "vms": [{"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM1", "vcpu": 4, "vmif": "t1VM1if1"}, {"brif": "t1br1if2", "disk": "10G", "mem": 4, "name": "t1_VM2", "vcpu": 2, "vmif": "t1VM2if1"}]}, {"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.1.2", "remote_ip": "10.2.1.2", "remote_route": "10.2.1.0/24", "subnet_route": "10.1.1.0/24", "tenant_route_ip": "192.168.1.2", "v_name": "vxlan_t1s1"}], "rc": 0, "start": "2019-11-18 00:09:41.905387", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}
skipping: [localhost] => (item=[{u'route': [{u'ip': u'10.1.2.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.2.1', u'bridge_name': u't1br2', u'dns': [{u'dnsif': u't1s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s2_dnsbrif'}], u'ns_name': u't1ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.2.2/24', u'tenant_ns_ip': u'10.1.2.1/24', u'tenant_ns_if': u't1ns2if', u'tenant_sub_if': u't1s2if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'2.2.2.0/24', u'vms': [{u'mem': 3, u'name': u't1_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br2if1', u'vmif': u't1VM3if1'}]}, {u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}])  => {"ansible_loop_var": "item", "changed": false, "item": [{"bridge_name": "t1br2", "default_route_ip": "10.1.2.1", "dns": [{"brif": "t1s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t1s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns2", "route": [{"if": "p1", "ip": "10.1.2.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "2.2.2.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns2if", "tenant_ns_ip": "10.1.2.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s2if", "tenant_sub_ip": "10.1.2.2/24"}], "vms": [{"brif": "t1br2if1", "disk": "10G", "mem": 3, "name": "t1_VM3", "vcpu": 2, "vmif": "t1VM3if1"}]}, {"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}], "skip_reason": "Conditional result was False"}

PLAY RECAP **************************************************************************************************************************************************
localhost                  : ok=3    changed=2    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0   

Using /etc/ansible/ansible.cfg as config file

PLAY [worker] ***********************************************************************************************************************************************

TASK [Add VXLAN routes in PNS] ******************************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.2.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.1.2/24', u'tenant_ns_ip': u'10.2.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't1_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM4if1'}]}, {u'local_ip': u'10.2.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.129.2', u'remote_route': u'10.1.1.0/24', u'subnet_route': u'10.2.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.1.1.2'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec pns ip route show \"10.2.1.0/24\" via \"192.168.129.2\" | grep -w '^10.2.1.0/24' ; if [ $? -ne 0 ] ; then ip netns exec pns ip route add \"10.2.1.0/24\" via \"192.168.129.2\" ; fi\n", "delta": "0:00:00.071886", "end": "2019-11-18 00:09:43.120257", "item": [{"bridge_name": "t1br1", "default_route_ip": "10.2.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.2.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.2.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.2.1.2/24"}], "vms": [{"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM4", "vcpu": 4, "vmif": "t1VM4if1"}]}, {"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.1.2", "remote_ip": "10.1.1.2", "remote_route": "10.1.1.0/24", "subnet_route": "10.2.1.0/24", "tenant_route_ip": "192.168.129.2", "v_name": "vxlan_t1s1"}], "rc": 0, "start": "2019-11-18 00:09:43.048371", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Get PNS ip address] ***********************************************************************************************************************************
ok: [99.99.99.2] => {"changed": false, "cmd": "ip netns exec pns ip addr show p1 | awk 'FNR==3{ print $2 }' | awk -F/ '{ print $1 }'\n", "delta": "0:00:00.044516", "end": "2019-11-18 00:09:43.552850", "rc": 0, "start": "2019-11-18 00:09:43.508334", "stderr": "", "stderr_lines": [], "stdout": "192.168.100.50", "stdout_lines": ["192.168.100.50"]}

TASK [Add VXLAN routes to host] *****************************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.2.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.1.2/24', u'tenant_ns_ip': u'10.2.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't1_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM4if1'}]}, {u'local_ip': u'10.2.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.129.2', u'remote_route': u'10.1.1.0/24', u'subnet_route': u'10.2.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.1.1.2'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip route show \"10.2.1.0/24\" via \"192.168.100.50\" | grep -w '^10.2.1.0/24' ; if [ $? -ne 0 ] ; then ip route add \"10.2.1.0/24\" via \"192.168.100.50\" ; fi\nip route show \"10.1.1.0/24\" via 99.99.99.1 | grep -w '^10.1.1.0/24'; if [ $? -ne 0 ] ; then ip route add \"10.1.1.0/24\" via 99.99.99.1 ; fi\n", "delta": "0:00:00.007767", "end": "2019-11-18 00:09:43.960693", "item": [{"bridge_name": "t1br1", "default_route_ip": "10.2.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.2.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.2.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.2.1.2/24"}], "vms": [{"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM4", "vcpu": 4, "vmif": "t1VM4if1"}]}, {"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.1.2", "remote_ip": "10.1.1.2", "remote_route": "10.1.1.0/24", "subnet_route": "10.2.1.0/24", "tenant_route_ip": "192.168.129.2", "v_name": "vxlan_t1s1"}], "rc": 0, "start": "2019-11-18 00:09:43.952926", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

PLAY RECAP **************************************************************************************************************************************************
99.99.99.2                 : ok=3    changed=2    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0   

Using /etc/ansible/ansible.cfg as config file

PLAY [main] *************************************************************************************************************************************************

TASK [Create VM templates (C1)] *****************************************************************************************************************************
ok: [localhost] => (item=[{u'route': [{u'ip': u'10.1.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.1.2/24', u'tenant_ns_ip': u'10.1.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.1.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.1.2', u'remote_route': u'10.2.1.0/24', u'subnet_route': u'10.1.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.2.1.2'}]}, {u'mem': 2, u'name': u't1_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM1if1'}]) => {"ansible_loop_var": "item", "changed": false, "checksum": "350ba870bd31b7f6ee517845c14237910b5af0bf", "dest": "/root/Migration-as-a-Service/t1/VM_templates/t1_VM1.xml.j2", "gid": 0, "group": "root", "item": [{"bridge_name": "t1br1", "default_route_ip": "10.1.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.1.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.1.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.1.1.2/24"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.1.2", "remote_ip": "10.2.1.2", "remote_route": "10.2.1.0/24", "subnet_route": "10.1.1.0/24", "tenant_route_ip": "192.168.1.2", "v_name": "vxlan_t1s1"}]}, {"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM1", "vcpu": 4, "vmif": "t1VM1if1"}], "mode": "0644", "owner": "root", "path": "/root/Migration-as-a-Service/t1/VM_templates/t1_VM1.xml.j2", "size": 4091, "state": "file", "uid": 0}
ok: [localhost] => (item=[{u'route': [{u'ip': u'10.1.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.1.2/24', u'tenant_ns_ip': u'10.1.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.1.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.1.2', u'remote_route': u'10.2.1.0/24', u'subnet_route': u'10.1.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.2.1.2'}]}, {u'mem': 4, u'name': u't1_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br1if2', u'vmif': u't1VM2if1'}]) => {"ansible_loop_var": "item", "changed": false, "checksum": "350ba870bd31b7f6ee517845c14237910b5af0bf", "dest": "/root/Migration-as-a-Service/t1/VM_templates/t1_VM2.xml.j2", "gid": 0, "group": "root", "item": [{"bridge_name": "t1br1", "default_route_ip": "10.1.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.1.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.1.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.1.1.2/24"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.1.2", "remote_ip": "10.2.1.2", "remote_route": "10.2.1.0/24", "subnet_route": "10.1.1.0/24", "tenant_route_ip": "192.168.1.2", "v_name": "vxlan_t1s1"}]}, {"brif": "t1br1if2", "disk": "10G", "mem": 4, "name": "t1_VM2", "vcpu": 2, "vmif": "t1VM2if1"}], "mode": "0644", "owner": "root", "path": "/root/Migration-as-a-Service/t1/VM_templates/t1_VM2.xml.j2", "size": 4091, "state": "file", "uid": 0}
ok: [localhost] => (item=[{u'route': [{u'ip': u'10.1.2.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.2.1', u'bridge_name': u't1br2', u'dns': [{u'dnsif': u't1s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s2_dnsbrif'}], u'ns_name': u't1ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.2.2/24', u'tenant_ns_ip': u'10.1.2.1/24', u'tenant_ns_if': u't1ns2if', u'tenant_sub_if': u't1s2if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'2.2.2.0/24', u'vxlan': [{u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}, {u'mem': 3, u'name': u't1_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br2if1', u'vmif': u't1VM3if1'}]) => {"ansible_loop_var": "item", "changed": false, "checksum": "350ba870bd31b7f6ee517845c14237910b5af0bf", "dest": "/root/Migration-as-a-Service/t1/VM_templates/t1_VM3.xml.j2", "gid": 0, "group": "root", "item": [{"bridge_name": "t1br2", "default_route_ip": "10.1.2.1", "dns": [{"brif": "t1s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t1s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns2", "route": [{"if": "p1", "ip": "10.1.2.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "2.2.2.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns2if", "tenant_ns_ip": "10.1.2.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s2if", "tenant_sub_ip": "10.1.2.2/24"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, {"brif": "t1br2if1", "disk": "10G", "mem": 3, "name": "t1_VM3", "vcpu": 2, "vmif": "t1VM3if1"}], "mode": "0644", "owner": "root", "path": "/root/Migration-as-a-Service/t1/VM_templates/t1_VM3.xml.j2", "size": 4091, "state": "file", "uid": 0}

PLAY RECAP **************************************************************************************************************************************************
localhost                  : ok=1    changed=0    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0   

Using /etc/ansible/ansible.cfg as config file

PLAY [main] *************************************************************************************************************************************************

TASK [Create VM templates (C2)] *****************************************************************************************************************************
ok: [localhost] => (item=[{u'route': [{u'ip': u'10.2.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.2.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.1.2/24', u'tenant_ns_ip': u'10.2.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.2.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.129.2', u'remote_route': u'10.1.1.0/24', u'subnet_route': u'10.2.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.1.1.2'}]}, {u'mem': 2, u'name': u't1_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM4if1'}]) => {"ansible_loop_var": "item", "changed": false, "checksum": "350ba870bd31b7f6ee517845c14237910b5af0bf", "dest": "/root/Migration-as-a-Service/t1/VM_templates/t1_VM4.xml.j2", "gid": 0, "group": "root", "item": [{"bridge_name": "t1br1", "default_route_ip": "10.2.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.2.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.2.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.2.1.2/24"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.1.2", "remote_ip": "10.1.1.2", "remote_route": "10.1.1.0/24", "subnet_route": "10.2.1.0/24", "tenant_route_ip": "192.168.129.2", "v_name": "vxlan_t1s1"}]}, {"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM4", "vcpu": 4, "vmif": "t1VM4if1"}], "mode": "0644", "owner": "root", "path": "/root/Migration-as-a-Service/t1/VM_templates/t1_VM4.xml.j2", "size": 4091, "state": "file", "uid": 0}

PLAY RECAP **************************************************************************************************************************************************
localhost                  : ok=1    changed=0    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0   

Using /etc/ansible/ansible.cfg as config file

PLAY [main] *************************************************************************************************************************************************

TASK [Copy VM image] ****************************************************************************************************************************************
ok: [localhost] => (item=[{u'route': [{u'ip': u'10.1.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.1.2/24', u'tenant_ns_ip': u'10.1.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.1.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.1.2', u'remote_route': u'10.2.1.0/24', u'subnet_route': u'10.1.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.2.1.2'}]}, {u'mem': 2, u'name': u't1_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM1if1'}]) => {"ansible_loop_var": "item", "changed": false, "dest": "/var/lib/libvirt/images/t1_VM1.qcow2", "item": [{"bridge_name": "t1br1", "default_route_ip": "10.1.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.1.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.1.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.1.1.2/24"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.1.2", "remote_ip": "10.2.1.2", "remote_route": "10.2.1.0/24", "subnet_route": "10.1.1.0/24", "tenant_route_ip": "192.168.1.2", "v_name": "vxlan_t1s1"}]}, {"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM1", "vcpu": 4, "vmif": "t1VM1if1"}], "src": "/root/mainVM.qcow2"}
ok: [localhost] => (item=[{u'route': [{u'ip': u'10.1.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.1.2/24', u'tenant_ns_ip': u'10.1.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.1.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.1.2', u'remote_route': u'10.2.1.0/24', u'subnet_route': u'10.1.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.2.1.2'}]}, {u'mem': 4, u'name': u't1_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br1if2', u'vmif': u't1VM2if1'}]) => {"ansible_loop_var": "item", "changed": false, "dest": "/var/lib/libvirt/images/t1_VM2.qcow2", "item": [{"bridge_name": "t1br1", "default_route_ip": "10.1.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.1.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.1.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.1.1.2/24"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.1.2", "remote_ip": "10.2.1.2", "remote_route": "10.2.1.0/24", "subnet_route": "10.1.1.0/24", "tenant_route_ip": "192.168.1.2", "v_name": "vxlan_t1s1"}]}, {"brif": "t1br1if2", "disk": "10G", "mem": 4, "name": "t1_VM2", "vcpu": 2, "vmif": "t1VM2if1"}], "src": "/root/mainVM.qcow2"}
ok: [localhost] => (item=[{u'route': [{u'ip': u'10.1.2.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.2.1', u'bridge_name': u't1br2', u'dns': [{u'dnsif': u't1s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s2_dnsbrif'}], u'ns_name': u't1ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.2.2/24', u'tenant_ns_ip': u'10.1.2.1/24', u'tenant_ns_if': u't1ns2if', u'tenant_sub_if': u't1s2if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'2.2.2.0/24', u'vxlan': [{u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}, {u'mem': 3, u'name': u't1_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br2if1', u'vmif': u't1VM3if1'}]) => {"ansible_loop_var": "item", "changed": false, "dest": "/var/lib/libvirt/images/t1_VM3.qcow2", "item": [{"bridge_name": "t1br2", "default_route_ip": "10.1.2.1", "dns": [{"brif": "t1s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t1s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns2", "route": [{"if": "p1", "ip": "10.1.2.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "2.2.2.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns2if", "tenant_ns_ip": "10.1.2.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s2if", "tenant_sub_ip": "10.1.2.2/24"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, {"brif": "t1br2if1", "disk": "10G", "mem": 3, "name": "t1_VM3", "vcpu": 2, "vmif": "t1VM3if1"}], "src": "/root/mainVM.qcow2"}

TASK [Create VM templates (C1)] *****************************************************************************************************************************
ok: [localhost] => (item=[{u'route': [{u'ip': u'10.1.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.1.2/24', u'tenant_ns_ip': u'10.1.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.1.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.1.2', u'remote_route': u'10.2.1.0/24', u'subnet_route': u'10.1.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.2.1.2'}]}, {u'mem': 2, u'name': u't1_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM1if1'}]) => {"ansible_loop_var": "item", "changed": false, "checksum": "350ba870bd31b7f6ee517845c14237910b5af0bf", "dest": "/root/Migration-as-a-Service/t1/VM_templates/t1_VM1.xml.j2", "gid": 0, "group": "root", "item": [{"bridge_name": "t1br1", "default_route_ip": "10.1.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.1.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.1.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.1.1.2/24"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.1.2", "remote_ip": "10.2.1.2", "remote_route": "10.2.1.0/24", "subnet_route": "10.1.1.0/24", "tenant_route_ip": "192.168.1.2", "v_name": "vxlan_t1s1"}]}, {"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM1", "vcpu": 4, "vmif": "t1VM1if1"}], "mode": "0644", "owner": "root", "path": "/root/Migration-as-a-Service/t1/VM_templates/t1_VM1.xml.j2", "size": 4091, "state": "file", "uid": 0}
ok: [localhost] => (item=[{u'route': [{u'ip': u'10.1.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.1.2/24', u'tenant_ns_ip': u'10.1.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.1.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.1.2', u'remote_route': u'10.2.1.0/24', u'subnet_route': u'10.1.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.2.1.2'}]}, {u'mem': 4, u'name': u't1_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br1if2', u'vmif': u't1VM2if1'}]) => {"ansible_loop_var": "item", "changed": false, "checksum": "350ba870bd31b7f6ee517845c14237910b5af0bf", "dest": "/root/Migration-as-a-Service/t1/VM_templates/t1_VM2.xml.j2", "gid": 0, "group": "root", "item": [{"bridge_name": "t1br1", "default_route_ip": "10.1.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.1.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.1.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.1.1.2/24"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.1.2", "remote_ip": "10.2.1.2", "remote_route": "10.2.1.0/24", "subnet_route": "10.1.1.0/24", "tenant_route_ip": "192.168.1.2", "v_name": "vxlan_t1s1"}]}, {"brif": "t1br1if2", "disk": "10G", "mem": 4, "name": "t1_VM2", "vcpu": 2, "vmif": "t1VM2if1"}], "mode": "0644", "owner": "root", "path": "/root/Migration-as-a-Service/t1/VM_templates/t1_VM2.xml.j2", "size": 4091, "state": "file", "uid": 0}
ok: [localhost] => (item=[{u'route': [{u'ip': u'10.1.2.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.2.1', u'bridge_name': u't1br2', u'dns': [{u'dnsif': u't1s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s2_dnsbrif'}], u'ns_name': u't1ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.2.2/24', u'tenant_ns_ip': u'10.1.2.1/24', u'tenant_ns_if': u't1ns2if', u'tenant_sub_if': u't1s2if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'2.2.2.0/24', u'vxlan': [{u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}, {u'mem': 3, u'name': u't1_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br2if1', u'vmif': u't1VM3if1'}]) => {"ansible_loop_var": "item", "changed": false, "checksum": "350ba870bd31b7f6ee517845c14237910b5af0bf", "dest": "/root/Migration-as-a-Service/t1/VM_templates/t1_VM3.xml.j2", "gid": 0, "group": "root", "item": [{"bridge_name": "t1br2", "default_route_ip": "10.1.2.1", "dns": [{"brif": "t1s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t1s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns2", "route": [{"if": "p1", "ip": "10.1.2.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "2.2.2.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns2if", "tenant_ns_ip": "10.1.2.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s2if", "tenant_sub_ip": "10.1.2.2/24"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, {"brif": "t1br2if1", "disk": "10G", "mem": 3, "name": "t1_VM3", "vcpu": 2, "vmif": "t1VM3if1"}], "mode": "0644", "owner": "root", "path": "/root/Migration-as-a-Service/t1/VM_templates/t1_VM3.xml.j2", "size": 4091, "state": "file", "uid": 0}

TASK [Get list of running VMs] ******************************************************************************************************************************
ok: [localhost] => {"changed": false, "cmd": ["virsh", "list", "--name"], "delta": "0:00:00.018347", "end": "2019-11-18 00:09:49.387664", "rc": 0, "start": "2019-11-18 00:09:49.369317", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Define VM] ********************************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.1.2/24', u'tenant_ns_ip': u'10.1.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.1.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.1.2', u'remote_route': u'10.2.1.0/24', u'subnet_route': u'10.1.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.2.1.2'}]}, {u'mem': 2, u'name': u't1_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM1if1'}]) => {"ansible_loop_var": "item", "changed": true, "created": "t1_VM1", "item": [{"bridge_name": "t1br1", "default_route_ip": "10.1.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.1.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.1.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.1.1.2/24"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.1.2", "remote_ip": "10.2.1.2", "remote_route": "10.2.1.0/24", "subnet_route": "10.1.1.0/24", "tenant_route_ip": "192.168.1.2", "v_name": "vxlan_t1s1"}]}, {"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM1", "vcpu": 4, "vmif": "t1VM1if1"}], "warnings": ["'xml' is given - ignoring 'name'"]}
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.1.2/24', u'tenant_ns_ip': u'10.1.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.1.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.1.2', u'remote_route': u'10.2.1.0/24', u'subnet_route': u'10.1.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.2.1.2'}]}, {u'mem': 4, u'name': u't1_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br1if2', u'vmif': u't1VM2if1'}]) => {"ansible_loop_var": "item", "changed": true, "created": "t1_VM2", "item": [{"bridge_name": "t1br1", "default_route_ip": "10.1.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.1.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.1.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.1.1.2/24"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.1.2", "remote_ip": "10.2.1.2", "remote_route": "10.2.1.0/24", "subnet_route": "10.1.1.0/24", "tenant_route_ip": "192.168.1.2", "v_name": "vxlan_t1s1"}]}, {"brif": "t1br1if2", "disk": "10G", "mem": 4, "name": "t1_VM2", "vcpu": 2, "vmif": "t1VM2if1"}], "warnings": ["'xml' is given - ignoring 'name'"]}
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.2.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.2.1', u'bridge_name': u't1br2', u'dns': [{u'dnsif': u't1s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s2_dnsbrif'}], u'ns_name': u't1ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.2.2/24', u'tenant_ns_ip': u'10.1.2.1/24', u'tenant_ns_if': u't1ns2if', u'tenant_sub_if': u't1s2if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'2.2.2.0/24', u'vxlan': [{u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}, {u'mem': 3, u'name': u't1_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br2if1', u'vmif': u't1VM3if1'}]) => {"ansible_loop_var": "item", "changed": true, "created": "t1_VM3", "item": [{"bridge_name": "t1br2", "default_route_ip": "10.1.2.1", "dns": [{"brif": "t1s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t1s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns2", "route": [{"if": "p1", "ip": "10.1.2.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "2.2.2.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns2if", "tenant_ns_ip": "10.1.2.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s2if", "tenant_sub_ip": "10.1.2.2/24"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, {"brif": "t1br2if1", "disk": "10G", "mem": 3, "name": "t1_VM3", "vcpu": 2, "vmif": "t1VM3if1"}], "warnings": ["'xml' is given - ignoring 'name'"]}

TASK [Create VM] ********************************************************************************************************************************************
ok: [localhost] => (item=[{u'route': [{u'ip': u'10.1.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.1.2/24', u'tenant_ns_ip': u'10.1.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.1.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.1.2', u'remote_route': u'10.2.1.0/24', u'subnet_route': u'10.1.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.2.1.2'}]}, {u'mem': 2, u'name': u't1_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM1if1'}]) => {"ansible_loop_var": "item", "changed": false, "create": 0, "item": [{"bridge_name": "t1br1", "default_route_ip": "10.1.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.1.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.1.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.1.1.2/24"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.1.2", "remote_ip": "10.2.1.2", "remote_route": "10.2.1.0/24", "subnet_route": "10.1.1.0/24", "tenant_route_ip": "192.168.1.2", "v_name": "vxlan_t1s1"}]}, {"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM1", "vcpu": 4, "vmif": "t1VM1if1"}]}
ok: [localhost] => (item=[{u'route': [{u'ip': u'10.1.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.1.2/24', u'tenant_ns_ip': u'10.1.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.1.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.1.2', u'remote_route': u'10.2.1.0/24', u'subnet_route': u'10.1.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.2.1.2'}]}, {u'mem': 4, u'name': u't1_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br1if2', u'vmif': u't1VM2if1'}]) => {"ansible_loop_var": "item", "changed": false, "create": 0, "item": [{"bridge_name": "t1br1", "default_route_ip": "10.1.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.1.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.1.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.1.1.2/24"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.1.2", "remote_ip": "10.2.1.2", "remote_route": "10.2.1.0/24", "subnet_route": "10.1.1.0/24", "tenant_route_ip": "192.168.1.2", "v_name": "vxlan_t1s1"}]}, {"brif": "t1br1if2", "disk": "10G", "mem": 4, "name": "t1_VM2", "vcpu": 2, "vmif": "t1VM2if1"}]}
ok: [localhost] => (item=[{u'route': [{u'ip': u'10.1.2.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.2.1', u'bridge_name': u't1br2', u'dns': [{u'dnsif': u't1s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s2_dnsbrif'}], u'ns_name': u't1ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.2.2/24', u'tenant_ns_ip': u'10.1.2.1/24', u'tenant_ns_if': u't1ns2if', u'tenant_sub_if': u't1s2if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'2.2.2.0/24', u'vxlan': [{u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}, {u'mem': 3, u'name': u't1_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br2if1', u'vmif': u't1VM3if1'}]) => {"ansible_loop_var": "item", "changed": false, "create": 0, "item": [{"bridge_name": "t1br2", "default_route_ip": "10.1.2.1", "dns": [{"brif": "t1s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t1s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns2", "route": [{"if": "p1", "ip": "10.1.2.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "2.2.2.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns2if", "tenant_ns_ip": "10.1.2.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s2if", "tenant_sub_ip": "10.1.2.2/24"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, {"brif": "t1br2if1", "disk": "10G", "mem": 3, "name": "t1_VM3", "vcpu": 2, "vmif": "t1VM3if1"}]}

TASK [Start VM] *********************************************************************************************************************************************
ok: [localhost] => (item=[{u'route': [{u'ip': u'10.1.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.1.2/24', u'tenant_ns_ip': u'10.1.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.1.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.1.2', u'remote_route': u'10.2.1.0/24', u'subnet_route': u'10.1.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.2.1.2'}]}, {u'mem': 2, u'name': u't1_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM1if1'}]) => {"ansible_loop_var": "item", "changed": false, "item": [{"bridge_name": "t1br1", "default_route_ip": "10.1.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.1.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.1.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.1.1.2/24"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.1.2", "remote_ip": "10.2.1.2", "remote_route": "10.2.1.0/24", "subnet_route": "10.1.1.0/24", "tenant_route_ip": "192.168.1.2", "v_name": "vxlan_t1s1"}]}, {"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM1", "vcpu": 4, "vmif": "t1VM1if1"}]}
ok: [localhost] => (item=[{u'route': [{u'ip': u'10.1.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.1.2/24', u'tenant_ns_ip': u'10.1.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.1.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.1.2', u'remote_route': u'10.2.1.0/24', u'subnet_route': u'10.1.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.2.1.2'}]}, {u'mem': 4, u'name': u't1_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br1if2', u'vmif': u't1VM2if1'}]) => {"ansible_loop_var": "item", "changed": false, "item": [{"bridge_name": "t1br1", "default_route_ip": "10.1.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.1.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.1.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.1.1.2/24"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.1.2", "remote_ip": "10.2.1.2", "remote_route": "10.2.1.0/24", "subnet_route": "10.1.1.0/24", "tenant_route_ip": "192.168.1.2", "v_name": "vxlan_t1s1"}]}, {"brif": "t1br1if2", "disk": "10G", "mem": 4, "name": "t1_VM2", "vcpu": 2, "vmif": "t1VM2if1"}]}
ok: [localhost] => (item=[{u'route': [{u'ip': u'10.1.2.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.2.1', u'bridge_name': u't1br2', u'dns': [{u'dnsif': u't1s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s2_dnsbrif'}], u'ns_name': u't1ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.2.2/24', u'tenant_ns_ip': u'10.1.2.1/24', u'tenant_ns_if': u't1ns2if', u'tenant_sub_if': u't1s2if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'2.2.2.0/24', u'vxlan': [{u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}, {u'mem': 3, u'name': u't1_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br2if1', u'vmif': u't1VM3if1'}]) => {"ansible_loop_var": "item", "changed": false, "item": [{"bridge_name": "t1br2", "default_route_ip": "10.1.2.1", "dns": [{"brif": "t1s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t1s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns2", "route": [{"if": "p1", "ip": "10.1.2.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "2.2.2.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns2if", "tenant_ns_ip": "10.1.2.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s2if", "tenant_sub_ip": "10.1.2.2/24"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, {"brif": "t1br2if1", "disk": "10G", "mem": 3, "name": "t1_VM3", "vcpu": 2, "vmif": "t1VM3if1"}]}

TASK [Attach VM interface] **********************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.1.2/24', u'tenant_ns_ip': u'10.1.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.1.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.1.2', u'remote_route': u'10.2.1.0/24', u'subnet_route': u'10.1.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.2.1.2'}]}, {u'mem': 2, u'name': u't1_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM1if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "virsh domiflist \"t1_VM1\" | grep -w 't1VM1if1' ; if [ $? -ne 0 ] ; then virsh attach-interface \"t1_VM1\" direct \"t1VM1if1\" --live --persistent ; fi\n", "delta": "0:00:00.289368", "end": "2019-11-18 00:09:54.897807", "item": [{"bridge_name": "t1br1", "default_route_ip": "10.1.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.1.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.1.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.1.1.2/24"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.1.2", "remote_ip": "10.2.1.2", "remote_route": "10.2.1.0/24", "subnet_route": "10.1.1.0/24", "tenant_route_ip": "192.168.1.2", "v_name": "vxlan_t1s1"}]}, {"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM1", "vcpu": 4, "vmif": "t1VM1if1"}], "rc": 0, "start": "2019-11-18 00:09:54.608439", "stderr": "", "stderr_lines": [], "stdout": "Interface attached successfully", "stdout_lines": ["Interface attached successfully"]}
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.1.2/24', u'tenant_ns_ip': u'10.1.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.1.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.1.2', u'remote_route': u'10.2.1.0/24', u'subnet_route': u'10.1.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.2.1.2'}]}, {u'mem': 4, u'name': u't1_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br1if2', u'vmif': u't1VM2if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "virsh domiflist \"t1_VM2\" | grep -w 't1VM2if1' ; if [ $? -ne 0 ] ; then virsh attach-interface \"t1_VM2\" direct \"t1VM2if1\" --live --persistent ; fi\n", "delta": "0:00:00.244762", "end": "2019-11-18 00:09:55.299871", "item": [{"bridge_name": "t1br1", "default_route_ip": "10.1.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.1.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.1.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.1.1.2/24"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.1.2", "remote_ip": "10.2.1.2", "remote_route": "10.2.1.0/24", "subnet_route": "10.1.1.0/24", "tenant_route_ip": "192.168.1.2", "v_name": "vxlan_t1s1"}]}, {"brif": "t1br1if2", "disk": "10G", "mem": 4, "name": "t1_VM2", "vcpu": 2, "vmif": "t1VM2if1"}], "rc": 0, "start": "2019-11-18 00:09:55.055109", "stderr": "", "stderr_lines": [], "stdout": "Interface attached successfully", "stdout_lines": ["Interface attached successfully"]}
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.2.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.2.1', u'bridge_name': u't1br2', u'dns': [{u'dnsif': u't1s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s2_dnsbrif'}], u'ns_name': u't1ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.2.2/24', u'tenant_ns_ip': u'10.1.2.1/24', u'tenant_ns_if': u't1ns2if', u'tenant_sub_if': u't1s2if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'2.2.2.0/24', u'vxlan': [{u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}, {u'mem': 3, u'name': u't1_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br2if1', u'vmif': u't1VM3if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "virsh domiflist \"t1_VM3\" | grep -w 't1VM3if1' ; if [ $? -ne 0 ] ; then virsh attach-interface \"t1_VM3\" direct \"t1VM3if1\" --live --persistent ; fi\n", "delta": "0:00:00.228492", "end": "2019-11-18 00:09:55.678454", "item": [{"bridge_name": "t1br2", "default_route_ip": "10.1.2.1", "dns": [{"brif": "t1s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t1s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns2", "route": [{"if": "p1", "ip": "10.1.2.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "2.2.2.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns2if", "tenant_ns_ip": "10.1.2.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s2if", "tenant_sub_ip": "10.1.2.2/24"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, {"brif": "t1br2if1", "disk": "10G", "mem": 3, "name": "t1_VM3", "vcpu": 2, "vmif": "t1VM3if1"}], "rc": 0, "start": "2019-11-18 00:09:55.449962", "stderr": "", "stderr_lines": [], "stdout": "Interface attached successfully", "stdout_lines": ["Interface attached successfully"]}

PLAY RECAP **************************************************************************************************************************************************
localhost                  : ok=7    changed=2    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0   

Using /etc/ansible/ansible.cfg as config file

PLAY [worker] ***********************************************************************************************************************************************

TASK [Copy VM image] ****************************************************************************************************************************************
ok: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.2.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.1.2/24', u'tenant_ns_ip': u'10.2.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.2.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.129.2', u'remote_route': u'10.1.1.0/24', u'subnet_route': u'10.2.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.1.1.2'}]}, {u'mem': 2, u'name': u't1_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM4if1'}]) => {"ansible_loop_var": "item", "changed": false, "dest": "/var/lib/libvirt/images/t1_VM4.qcow2", "gid": 0, "group": "root", "item": [{"bridge_name": "t1br1", "default_route_ip": "10.2.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.2.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.2.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.2.1.2/24"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.1.2", "remote_ip": "10.1.1.2", "remote_route": "10.1.1.0/24", "subnet_route": "10.2.1.0/24", "tenant_route_ip": "192.168.129.2", "v_name": "vxlan_t1s1"}]}, {"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM4", "vcpu": 4, "vmif": "t1VM4if1"}], "mode": "0644", "msg": "file already exists", "owner": "root", "size": 10739318784, "src": "/root/mainVM.qcow2", "state": "file", "uid": 0}

TASK [Get list of running VMs] ******************************************************************************************************************************
ok: [99.99.99.2] => {"changed": false, "cmd": ["virsh", "list", "--name"], "delta": "0:00:00.018772", "end": "2019-11-18 00:10:47.391692", "rc": 0, "start": "2019-11-18 00:10:47.372920", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Define VM] ********************************************************************************************************************************************
ok: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.2.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.1.2/24', u'tenant_ns_ip': u'10.2.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.2.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.129.2', u'remote_route': u'10.1.1.0/24', u'subnet_route': u'10.2.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.1.1.2'}]}, {u'mem': 2, u'name': u't1_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM4if1'}]) => {"ansible_loop_var": "item", "changed": false, "item": [{"bridge_name": "t1br1", "default_route_ip": "10.2.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.2.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.2.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.2.1.2/24"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.1.2", "remote_ip": "10.1.1.2", "remote_route": "10.1.1.0/24", "subnet_route": "10.2.1.0/24", "tenant_route_ip": "192.168.129.2", "v_name": "vxlan_t1s1"}]}, {"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM4", "vcpu": 4, "vmif": "t1VM4if1"}], "warnings": ["'xml' is given - ignoring 'name'"]}

TASK [Create VM] ********************************************************************************************************************************************
ok: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.2.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.1.2/24', u'tenant_ns_ip': u'10.2.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.2.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.129.2', u'remote_route': u'10.1.1.0/24', u'subnet_route': u'10.2.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.1.1.2'}]}, {u'mem': 2, u'name': u't1_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM4if1'}]) => {"ansible_loop_var": "item", "changed": false, "create": 0, "item": [{"bridge_name": "t1br1", "default_route_ip": "10.2.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.2.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.2.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.2.1.2/24"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.1.2", "remote_ip": "10.1.1.2", "remote_route": "10.1.1.0/24", "subnet_route": "10.2.1.0/24", "tenant_route_ip": "192.168.129.2", "v_name": "vxlan_t1s1"}]}, {"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM4", "vcpu": 4, "vmif": "t1VM4if1"}]}

TASK [Start VM] *********************************************************************************************************************************************
ok: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.2.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.1.2/24', u'tenant_ns_ip': u'10.2.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.2.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.129.2', u'remote_route': u'10.1.1.0/24', u'subnet_route': u'10.2.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.1.1.2'}]}, {u'mem': 2, u'name': u't1_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM4if1'}]) => {"ansible_loop_var": "item", "changed": false, "item": [{"bridge_name": "t1br1", "default_route_ip": "10.2.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.2.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.2.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.2.1.2/24"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.1.2", "remote_ip": "10.1.1.2", "remote_route": "10.1.1.0/24", "subnet_route": "10.2.1.0/24", "tenant_route_ip": "192.168.129.2", "v_name": "vxlan_t1s1"}]}, {"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM4", "vcpu": 4, "vmif": "t1VM4if1"}]}

TASK [Attach VM interface] **********************************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.2.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.1.2/24', u'tenant_ns_ip': u'10.2.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.2.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.129.2', u'remote_route': u'10.1.1.0/24', u'subnet_route': u'10.2.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.1.1.2'}]}, {u'mem': 2, u'name': u't1_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM4if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "virsh domiflist \"t1_VM4\" | grep -w 't1VM4if1' ; if [ $? -ne 0 ] ; then virsh attach-interface \"t1_VM4\" direct \"t1VM4if1\" --live --persistent ; fi\n", "delta": "0:00:00.022193", "end": "2019-11-18 00:10:50.216665", "item": [{"bridge_name": "t1br1", "default_route_ip": "10.2.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.2.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.2.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.2.1.2/24"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.1.2", "remote_ip": "10.1.1.2", "remote_route": "10.1.1.0/24", "subnet_route": "10.2.1.0/24", "tenant_route_ip": "192.168.129.2", "v_name": "vxlan_t1s1"}]}, {"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM4", "vcpu": 4, "vmif": "t1VM4if1"}], "rc": 0, "start": "2019-11-18 00:10:50.194472", "stderr": "", "stderr_lines": [], "stdout": "macvtap0   direct     t1VM4if1   rtl8139     52:54:00:d5:97:4d", "stdout_lines": ["macvtap0   direct     t1VM4if1   rtl8139     52:54:00:d5:97:4d"]}

PLAY RECAP **************************************************************************************************************************************************
99.99.99.2                 : ok=6    changed=1    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0   

INFO:root: 00:24:26.618580 Printing the yaml input file
INFO:root: 00:24:26.618879 {'C1': [{'subnet_addr': '1.1.1.0/24', 'VM': [{'name': 'VM1', 'disk': '10G', 'mem': 2, 'vcpu': 4}, {'name': 'VM2', 'disk': '10G', 'mem': 4, 'vcpu': 2}]}, {'subnet_addr': '2.2.2.0/24', 'VM': [{'name': 'VM3', 'disk': '10G', 'mem': 3, 'vcpu': 2}]}], 'C2': [{'subnet_addr': '1.1.1.0/24', 'VM': [{'name': 'VM4', 'disk': '10G', 'mem': 2, 'vcpu': 4}]}]}
INFO:root: 00:24:26.619029 Provided subnet in C1: 1.1.1.0/24 is valid
INFO:root: 00:24:26.619169 Provided subnet in C1: 2.2.2.0/24 is valid
INFO:root: 00:24:26.619253 Provided subnet in C2: 1.1.1.0/24 is valid
Using /etc/ansible/ansible.cfg as config file

PLAY [main] *************************************************************************************************************************************************

TASK [Create Tenant Namespace] ******************************************************************************************************************************
changed: [localhost] => (item={u'default_route_ip': u'192.168.2.1', u'name': u't2', u'pns_ip': u'192.168.2.1/24', u'tenant_if': u't2if', u'tenant_ip': u'192.168.2.2/24', u'pns_if': u't2pns_if'}) => {"ansible_loop_var": "item", "changed": true, "cmd": ["ip", "netns", "add", "t2"], "delta": "0:00:00.056744", "end": "2019-11-18 00:24:27.934842", "item": {"default_route_ip": "192.168.2.1", "name": "t2", "pns_if": "t2pns_if", "pns_ip": "192.168.2.1/24", "tenant_if": "t2if", "tenant_ip": "192.168.2.2/24"}, "rc": 0, "start": "2019-11-18 00:24:27.878098", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Create Subnet Namespace] ******************************************************************************************************************************
changed: [localhost] => (item={u'route': [{u'ip': u'10.1.11.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.1.11.1', u'bridge_name': u't2br1', u'dns': [{u'dnsif': u't2s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't2s1_dnsbrif'}], u'ns_name': u't2ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.11.2/24', u'tenant_ns_ip': u'10.1.11.1/24', u'tenant_ns_if': u't2ns1if', u'tenant_ns_name': u't2', u'tenant_sub_if': u't2s1if'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't2_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't2br1if1', u'vmif': u't2VM1if1'}, {u'mem': 4, u'name': u't2_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't2br1if2', u'vmif': u't2VM2if1'}], u'vxlan': [{u'local_ip': u'10.1.11.2', u'tenant_route_ip': u'192.168.2.2', u'dsport': 4789, u'dev': u't2s1if', u'subnet_route': u'10.1.11.0/24', u'remote_route': u'10.2.11.0/24', u'v_name': u'vxlan_t2s1', u'id': 42, u'remote_ip': u'10.2.11.2'}]}) => {"ansible_loop_var": "item", "changed": true, "cmd": ["ip", "netns", "add", "t2ns1"], "delta": "0:00:00.058702", "end": "2019-11-18 00:24:28.292488", "item": {"bridge_name": "t2br1", "default_route_ip": "10.1.11.1", "dns": [{"brif": "t2s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t2s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns1", "route": [{"if": "p1", "ip": "10.1.11.1/24", "ns_if": "t2if", "ns_name": "t2"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t2ns1if", "tenant_ns_ip": "10.1.11.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s1if", "tenant_sub_ip": "10.1.11.2/24"}], "vms": [{"brif": "t2br1if1", "disk": "10G", "mem": 2, "name": "t2_VM1", "vcpu": 4, "vmif": "t2VM1if1"}, {"brif": "t2br1if2", "disk": "10G", "mem": 4, "name": "t2_VM2", "vcpu": 2, "vmif": "t2VM2if1"}], "vxlan": [{"dev": "t2s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.11.2", "remote_ip": "10.2.11.2", "remote_route": "10.2.11.0/24", "subnet_route": "10.1.11.0/24", "tenant_route_ip": "192.168.2.2", "v_name": "vxlan_t2s1"}]}, "rc": 0, "start": "2019-11-18 00:24:28.233786", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}
changed: [localhost] => (item={u'route': [{u'ip': u'10.1.12.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.1.12.1', u'bridge_name': u't2br2', u'dns': [{u'dnsif': u't2s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't2s2_dnsbrif'}], u'ns_name': u't2ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.12.2/24', u'tenant_ns_ip': u'10.1.12.1/24', u'tenant_ns_if': u't2ns2if', u'tenant_ns_name': u't2', u'tenant_sub_if': u't2s2if'}], u'subnet_ip': u'2.2.2.0/24', u'vms': [{u'mem': 3, u'name': u't2_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't2br2if1', u'vmif': u't2VM3if1'}], u'vxlan': [{u'local_ip': [], u'tenant_route_ip': [], u'dsport': [], u'dev': [], u'subnet_route': [], u'remote_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}) => {"ansible_loop_var": "item", "changed": true, "cmd": ["ip", "netns", "add", "t2ns2"], "delta": "0:00:00.052166", "end": "2019-11-18 00:24:28.574003", "item": {"bridge_name": "t2br2", "default_route_ip": "10.1.12.1", "dns": [{"brif": "t2s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t2s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns2", "route": [{"if": "p1", "ip": "10.1.12.1/24", "ns_if": "t2if", "ns_name": "t2"}], "subnet_ip": "2.2.2.0/24", "tenant_ns": [{"tenant_ns_if": "t2ns2if", "tenant_ns_ip": "10.1.12.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s2if", "tenant_sub_ip": "10.1.12.2/24"}], "vms": [{"brif": "t2br2if1", "disk": "10G", "mem": 3, "name": "t2_VM3", "vcpu": 2, "vmif": "t2VM3if1"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, "rc": 0, "start": "2019-11-18 00:24:28.521837", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Create Tenant VETH pairs] *****************************************************************************************************************************
changed: [localhost] => (item={u'default_route_ip': u'192.168.2.1', u'name': u't2', u'pns_ip': u'192.168.2.1/24', u'tenant_if': u't2if', u'tenant_ip': u'192.168.2.2/24', u'pns_if': u't2pns_if'}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip link show \"t2if\" ; if [ $? -ne 0 ] ; then ip link add \"t2if\" type veth peer name \"t2pns_if\" ; fi\n", "delta": "0:00:00.013638", "end": "2019-11-18 00:24:28.858007", "item": {"default_route_ip": "192.168.2.1", "name": "t2", "pns_if": "t2pns_if", "pns_ip": "192.168.2.1/24", "tenant_if": "t2if", "tenant_ip": "192.168.2.2/24"}, "rc": 0, "start": "2019-11-18 00:24:28.844369", "stderr": "Device \"t2if\" does not exist.", "stderr_lines": ["Device \"t2if\" does not exist."], "stdout": "", "stdout_lines": []}

TASK [Attach Tenant VETH Pairs] *****************************************************************************************************************************
changed: [localhost] => (item={u'default_route_ip': u'192.168.2.1', u'name': u't2', u'pns_ip': u'192.168.2.1/24', u'tenant_if': u't2if', u'tenant_ip': u'192.168.2.2/24', u'pns_if': u't2pns_if'}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec pns ip link show \"t2pns_if\" ; if [ $? -ne 0 ] ; then ip link set \"t2pns_if\" netns pns ; fi\nip netns exec \"t2\" ip link show \"t2if\" ; if [ $? -ne 0 ] ; then ip link set \"t2if\" netns \"t2\" ; fi\nip netns exec pns ip link set dev \"t2pns_if\" up\nip netns exec \"t2\" ip link set dev \"t2if\" up\n", "delta": "0:00:00.199667", "end": "2019-11-18 00:24:29.333627", "item": {"default_route_ip": "192.168.2.1", "name": "t2", "pns_if": "t2pns_if", "pns_ip": "192.168.2.1/24", "tenant_if": "t2if", "tenant_ip": "192.168.2.2/24"}, "rc": 0, "start": "2019-11-18 00:24:29.133960", "stderr": "Device \"t2pns_if\" does not exist.\nDevice \"t2if\" does not exist.", "stderr_lines": ["Device \"t2pns_if\" does not exist.", "Device \"t2if\" does not exist."], "stdout": "", "stdout_lines": []}

TASK [Add IP addresses to Tenant VETH Pairs] ****************************************************************************************************************
changed: [localhost] => (item={u'default_route_ip': u'192.168.2.1', u'name': u't2', u'pns_ip': u'192.168.2.1/24', u'tenant_if': u't2if', u'tenant_ip': u'192.168.2.2/24', u'pns_if': u't2pns_if'}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec pns ip addr show \"t2pns_if\" | awk 'FNR==3{ print $2 }' | grep -w '^192.168.2.1/24' ; if [ $? -ne 0 ] ; then ip netns exec pns ip addr add \"192.168.2.1/24\" dev \"t2pns_if\" ; fi\nip netns exec \"t2\" ip addr show \"t2if\" | awk 'FNR==3{ print $2 }' | grep -w '^192.168.2.2/24' ; if [ $? -ne 0 ] ; then ip netns exec \"t2\" ip addr add \"192.168.2.2/24\" dev \"t2if\" ; fi\n", "delta": "0:00:00.148636", "end": "2019-11-18 00:24:29.794032", "item": {"default_route_ip": "192.168.2.1", "name": "t2", "pns_if": "t2pns_if", "pns_ip": "192.168.2.1/24", "tenant_if": "t2if", "tenant_ip": "192.168.2.2/24"}, "rc": 0, "start": "2019-11-18 00:24:29.645396", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Create Namespace VETH Pairs] **************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.11.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.1.11.1', u'bridge_name': u't2br1', u'dns': [{u'dnsif': u't2s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't2s1_dnsbrif'}], u'ns_name': u't2ns1', u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't2_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't2br1if1', u'vmif': u't2VM1if1'}, {u'mem': 4, u'name': u't2_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't2br1if2', u'vmif': u't2VM2if1'}], u'vxlan': [{u'local_ip': u'10.1.11.2', u'dsport': 4789, u'dev': u't2s1if', u'tenant_route_ip': u'192.168.2.2', u'remote_route': u'10.2.11.0/24', u'subnet_route': u'10.1.11.0/24', u'v_name': u'vxlan_t2s1', u'id': 42, u'remote_ip': u'10.2.11.2'}]}, {u'tenant_sub_ip': u'10.1.11.2/24', u'tenant_ns_ip': u'10.1.11.1/24', u'tenant_ns_if': u't2ns1if', u'tenant_sub_if': u't2s1if', u'tenant_ns_name': u't2'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip link show \"t2ns1if\" ; if [ $? -ne 0 ] ; then ip link add \"t2ns1if\" type veth peer name \"t2s1if\" ; fi\n", "delta": "0:00:00.011946", "end": "2019-11-18 00:24:30.111052", "item": [{"bridge_name": "t2br1", "default_route_ip": "10.1.11.1", "dns": [{"brif": "t2s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t2s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns1", "route": [{"if": "p1", "ip": "10.1.11.1/24", "ns_if": "t2if", "ns_name": "t2"}], "subnet_ip": "1.1.1.0/24", "vms": [{"brif": "t2br1if1", "disk": "10G", "mem": 2, "name": "t2_VM1", "vcpu": 4, "vmif": "t2VM1if1"}, {"brif": "t2br1if2", "disk": "10G", "mem": 4, "name": "t2_VM2", "vcpu": 2, "vmif": "t2VM2if1"}], "vxlan": [{"dev": "t2s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.11.2", "remote_ip": "10.2.11.2", "remote_route": "10.2.11.0/24", "subnet_route": "10.1.11.0/24", "tenant_route_ip": "192.168.2.2", "v_name": "vxlan_t2s1"}]}, {"tenant_ns_if": "t2ns1if", "tenant_ns_ip": "10.1.11.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s1if", "tenant_sub_ip": "10.1.11.2/24"}], "rc": 0, "start": "2019-11-18 00:24:30.099106", "stderr": "Device \"t2ns1if\" does not exist.", "stderr_lines": ["Device \"t2ns1if\" does not exist."], "stdout": "", "stdout_lines": []}
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.12.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.1.12.1', u'bridge_name': u't2br2', u'dns': [{u'dnsif': u't2s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't2s2_dnsbrif'}], u'ns_name': u't2ns2', u'subnet_ip': u'2.2.2.0/24', u'vms': [{u'mem': 3, u'name': u't2_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't2br2if1', u'vmif': u't2VM3if1'}], u'vxlan': [{u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}, {u'tenant_sub_ip': u'10.1.12.2/24', u'tenant_ns_ip': u'10.1.12.1/24', u'tenant_ns_if': u't2ns2if', u'tenant_sub_if': u't2s2if', u'tenant_ns_name': u't2'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip link show \"t2ns2if\" ; if [ $? -ne 0 ] ; then ip link add \"t2ns2if\" type veth peer name \"t2s2if\" ; fi\n", "delta": "0:00:00.014257", "end": "2019-11-18 00:24:30.358861", "item": [{"bridge_name": "t2br2", "default_route_ip": "10.1.12.1", "dns": [{"brif": "t2s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t2s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns2", "route": [{"if": "p1", "ip": "10.1.12.1/24", "ns_if": "t2if", "ns_name": "t2"}], "subnet_ip": "2.2.2.0/24", "vms": [{"brif": "t2br2if1", "disk": "10G", "mem": 3, "name": "t2_VM3", "vcpu": 2, "vmif": "t2VM3if1"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, {"tenant_ns_if": "t2ns2if", "tenant_ns_ip": "10.1.12.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s2if", "tenant_sub_ip": "10.1.12.2/24"}], "rc": 0, "start": "2019-11-18 00:24:30.344604", "stderr": "Device \"t2ns2if\" does not exist.", "stderr_lines": ["Device \"t2ns2if\" does not exist."], "stdout": "", "stdout_lines": []}

TASK [Attach Namespace VETH Pairs] **************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.11.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.1.11.1', u'bridge_name': u't2br1', u'dns': [{u'dnsif': u't2s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't2s1_dnsbrif'}], u'ns_name': u't2ns1', u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't2_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't2br1if1', u'vmif': u't2VM1if1'}, {u'mem': 4, u'name': u't2_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't2br1if2', u'vmif': u't2VM2if1'}], u'vxlan': [{u'local_ip': u'10.1.11.2', u'dsport': 4789, u'dev': u't2s1if', u'tenant_route_ip': u'192.168.2.2', u'remote_route': u'10.2.11.0/24', u'subnet_route': u'10.1.11.0/24', u'v_name': u'vxlan_t2s1', u'id': 42, u'remote_ip': u'10.2.11.2'}]}, {u'tenant_sub_ip': u'10.1.11.2/24', u'tenant_ns_ip': u'10.1.11.1/24', u'tenant_ns_if': u't2ns1if', u'tenant_sub_if': u't2s1if', u'tenant_ns_name': u't2'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t2\" ip link show \"t2ns1if\" ; if [ $? -ne 0 ] ; then ip link set \"t2ns1if\" netns \"t2\" ; fi\nip netns exec \"t2ns1\" ip link show \"t2s1if\" ; if [ $? -ne 0 ] ; then ip link set \"t2s1if\" netns \"t2ns1\" ; fi\n", "delta": "0:00:00.122746", "end": "2019-11-18 00:24:30.791585", "item": [{"bridge_name": "t2br1", "default_route_ip": "10.1.11.1", "dns": [{"brif": "t2s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t2s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns1", "route": [{"if": "p1", "ip": "10.1.11.1/24", "ns_if": "t2if", "ns_name": "t2"}], "subnet_ip": "1.1.1.0/24", "vms": [{"brif": "t2br1if1", "disk": "10G", "mem": 2, "name": "t2_VM1", "vcpu": 4, "vmif": "t2VM1if1"}, {"brif": "t2br1if2", "disk": "10G", "mem": 4, "name": "t2_VM2", "vcpu": 2, "vmif": "t2VM2if1"}], "vxlan": [{"dev": "t2s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.11.2", "remote_ip": "10.2.11.2", "remote_route": "10.2.11.0/24", "subnet_route": "10.1.11.0/24", "tenant_route_ip": "192.168.2.2", "v_name": "vxlan_t2s1"}]}, {"tenant_ns_if": "t2ns1if", "tenant_ns_ip": "10.1.11.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s1if", "tenant_sub_ip": "10.1.11.2/24"}], "rc": 0, "start": "2019-11-18 00:24:30.668839", "stderr": "Device \"t2ns1if\" does not exist.\nDevice \"t2s1if\" does not exist.", "stderr_lines": ["Device \"t2ns1if\" does not exist.", "Device \"t2s1if\" does not exist."], "stdout": "", "stdout_lines": []}
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.12.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.1.12.1', u'bridge_name': u't2br2', u'dns': [{u'dnsif': u't2s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't2s2_dnsbrif'}], u'ns_name': u't2ns2', u'subnet_ip': u'2.2.2.0/24', u'vms': [{u'mem': 3, u'name': u't2_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't2br2if1', u'vmif': u't2VM3if1'}], u'vxlan': [{u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}, {u'tenant_sub_ip': u'10.1.12.2/24', u'tenant_ns_ip': u'10.1.12.1/24', u'tenant_ns_if': u't2ns2if', u'tenant_sub_if': u't2s2if', u'tenant_ns_name': u't2'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t2\" ip link show \"t2ns2if\" ; if [ $? -ne 0 ] ; then ip link set \"t2ns2if\" netns \"t2\" ; fi\nip netns exec \"t2ns2\" ip link show \"t2s2if\" ; if [ $? -ne 0 ] ; then ip link set \"t2s2if\" netns \"t2ns2\" ; fi\n", "delta": "0:00:00.113172", "end": "2019-11-18 00:24:31.133570", "item": [{"bridge_name": "t2br2", "default_route_ip": "10.1.12.1", "dns": [{"brif": "t2s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t2s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns2", "route": [{"if": "p1", "ip": "10.1.12.1/24", "ns_if": "t2if", "ns_name": "t2"}], "subnet_ip": "2.2.2.0/24", "vms": [{"brif": "t2br2if1", "disk": "10G", "mem": 3, "name": "t2_VM3", "vcpu": 2, "vmif": "t2VM3if1"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, {"tenant_ns_if": "t2ns2if", "tenant_ns_ip": "10.1.12.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s2if", "tenant_sub_ip": "10.1.12.2/24"}], "rc": 0, "start": "2019-11-18 00:24:31.020398", "stderr": "Device \"t2ns2if\" does not exist.\nDevice \"t2s2if\" does not exist.", "stderr_lines": ["Device \"t2ns2if\" does not exist.", "Device \"t2s2if\" does not exist."], "stdout": "", "stdout_lines": []}

TASK [Set Namespace VETH Pairs UP] **************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.11.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.1.11.1', u'bridge_name': u't2br1', u'dns': [{u'dnsif': u't2s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't2s1_dnsbrif'}], u'ns_name': u't2ns1', u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't2_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't2br1if1', u'vmif': u't2VM1if1'}, {u'mem': 4, u'name': u't2_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't2br1if2', u'vmif': u't2VM2if1'}], u'vxlan': [{u'local_ip': u'10.1.11.2', u'dsport': 4789, u'dev': u't2s1if', u'tenant_route_ip': u'192.168.2.2', u'remote_route': u'10.2.11.0/24', u'subnet_route': u'10.1.11.0/24', u'v_name': u'vxlan_t2s1', u'id': 42, u'remote_ip': u'10.2.11.2'}]}, {u'tenant_sub_ip': u'10.1.11.2/24', u'tenant_ns_ip': u'10.1.11.1/24', u'tenant_ns_if': u't2ns1if', u'tenant_sub_if': u't2s1if', u'tenant_ns_name': u't2'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t2\" ip link set dev \"t2ns1if\" up\nip netns exec \"t2ns1\" ip link set dev \"t2s1if\" up\n", "delta": "0:00:00.073323", "end": "2019-11-18 00:24:31.497611", "item": [{"bridge_name": "t2br1", "default_route_ip": "10.1.11.1", "dns": [{"brif": "t2s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t2s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns1", "route": [{"if": "p1", "ip": "10.1.11.1/24", "ns_if": "t2if", "ns_name": "t2"}], "subnet_ip": "1.1.1.0/24", "vms": [{"brif": "t2br1if1", "disk": "10G", "mem": 2, "name": "t2_VM1", "vcpu": 4, "vmif": "t2VM1if1"}, {"brif": "t2br1if2", "disk": "10G", "mem": 4, "name": "t2_VM2", "vcpu": 2, "vmif": "t2VM2if1"}], "vxlan": [{"dev": "t2s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.11.2", "remote_ip": "10.2.11.2", "remote_route": "10.2.11.0/24", "subnet_route": "10.1.11.0/24", "tenant_route_ip": "192.168.2.2", "v_name": "vxlan_t2s1"}]}, {"tenant_ns_if": "t2ns1if", "tenant_ns_ip": "10.1.11.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s1if", "tenant_sub_ip": "10.1.11.2/24"}], "rc": 0, "start": "2019-11-18 00:24:31.424288", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.12.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.1.12.1', u'bridge_name': u't2br2', u'dns': [{u'dnsif': u't2s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't2s2_dnsbrif'}], u'ns_name': u't2ns2', u'subnet_ip': u'2.2.2.0/24', u'vms': [{u'mem': 3, u'name': u't2_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't2br2if1', u'vmif': u't2VM3if1'}], u'vxlan': [{u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}, {u'tenant_sub_ip': u'10.1.12.2/24', u'tenant_ns_ip': u'10.1.12.1/24', u'tenant_ns_if': u't2ns2if', u'tenant_sub_if': u't2s2if', u'tenant_ns_name': u't2'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t2\" ip link set dev \"t2ns2if\" up\nip netns exec \"t2ns2\" ip link set dev \"t2s2if\" up\n", "delta": "0:00:00.092578", "end": "2019-11-18 00:24:31.773623", "item": [{"bridge_name": "t2br2", "default_route_ip": "10.1.12.1", "dns": [{"brif": "t2s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t2s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns2", "route": [{"if": "p1", "ip": "10.1.12.1/24", "ns_if": "t2if", "ns_name": "t2"}], "subnet_ip": "2.2.2.0/24", "vms": [{"brif": "t2br2if1", "disk": "10G", "mem": 3, "name": "t2_VM3", "vcpu": 2, "vmif": "t2VM3if1"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, {"tenant_ns_if": "t2ns2if", "tenant_ns_ip": "10.1.12.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s2if", "tenant_sub_ip": "10.1.12.2/24"}], "rc": 0, "start": "2019-11-18 00:24:31.681045", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Add IP addresses to Namespace VETH Pairs] *************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.11.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.1.11.1', u'bridge_name': u't2br1', u'dns': [{u'dnsif': u't2s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't2s1_dnsbrif'}], u'ns_name': u't2ns1', u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't2_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't2br1if1', u'vmif': u't2VM1if1'}, {u'mem': 4, u'name': u't2_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't2br1if2', u'vmif': u't2VM2if1'}], u'vxlan': [{u'local_ip': u'10.1.11.2', u'dsport': 4789, u'dev': u't2s1if', u'tenant_route_ip': u'192.168.2.2', u'remote_route': u'10.2.11.0/24', u'subnet_route': u'10.1.11.0/24', u'v_name': u'vxlan_t2s1', u'id': 42, u'remote_ip': u'10.2.11.2'}]}, {u'tenant_sub_ip': u'10.1.11.2/24', u'tenant_ns_ip': u'10.1.11.1/24', u'tenant_ns_if': u't2ns1if', u'tenant_sub_if': u't2s1if', u'tenant_ns_name': u't2'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t2ns1\" ip addr show \"t2s1if\" | awk 'FNR==3{ print $2 }' | grep -w '^10.1.11.2/24' ; if [ $? -ne 0 ] ; then ip netns exec \"t2ns1\" ip addr add \"10.1.11.2/24\" dev \"t2s1if\" ; fi\n\nip netns exec \"t2\" ip addr show \"t2ns1if\" | awk 'FNR==3{ print $2 }' | grep -w '^10.1.11.1/24' ; if [ $? -ne 0 ] ; then ip netns exec \"t2\" ip addr add \"10.1.11.1/24\" dev \"t2ns1if\" ; fi\n", "delta": "0:00:00.159155", "end": "2019-11-18 00:24:32.185965", "item": [{"bridge_name": "t2br1", "default_route_ip": "10.1.11.1", "dns": [{"brif": "t2s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t2s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns1", "route": [{"if": "p1", "ip": "10.1.11.1/24", "ns_if": "t2if", "ns_name": "t2"}], "subnet_ip": "1.1.1.0/24", "vms": [{"brif": "t2br1if1", "disk": "10G", "mem": 2, "name": "t2_VM1", "vcpu": 4, "vmif": "t2VM1if1"}, {"brif": "t2br1if2", "disk": "10G", "mem": 4, "name": "t2_VM2", "vcpu": 2, "vmif": "t2VM2if1"}], "vxlan": [{"dev": "t2s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.11.2", "remote_ip": "10.2.11.2", "remote_route": "10.2.11.0/24", "subnet_route": "10.1.11.0/24", "tenant_route_ip": "192.168.2.2", "v_name": "vxlan_t2s1"}]}, {"tenant_ns_if": "t2ns1if", "tenant_ns_ip": "10.1.11.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s1if", "tenant_sub_ip": "10.1.11.2/24"}], "rc": 0, "start": "2019-11-18 00:24:32.026810", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.12.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.1.12.1', u'bridge_name': u't2br2', u'dns': [{u'dnsif': u't2s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't2s2_dnsbrif'}], u'ns_name': u't2ns2', u'subnet_ip': u'2.2.2.0/24', u'vms': [{u'mem': 3, u'name': u't2_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't2br2if1', u'vmif': u't2VM3if1'}], u'vxlan': [{u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}, {u'tenant_sub_ip': u'10.1.12.2/24', u'tenant_ns_ip': u'10.1.12.1/24', u'tenant_ns_if': u't2ns2if', u'tenant_sub_if': u't2s2if', u'tenant_ns_name': u't2'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t2ns2\" ip addr show \"t2s2if\" | awk 'FNR==3{ print $2 }' | grep -w '^10.1.12.2/24' ; if [ $? -ne 0 ] ; then ip netns exec \"t2ns2\" ip addr add \"10.1.12.2/24\" dev \"t2s2if\" ; fi\n\nip netns exec \"t2\" ip addr show \"t2ns2if\" | awk 'FNR==3{ print $2 }' | grep -w '^10.1.12.1/24' ; if [ $? -ne 0 ] ; then ip netns exec \"t2\" ip addr add \"10.1.12.1/24\" dev \"t2ns2if\" ; fi\n", "delta": "0:00:00.157813", "end": "2019-11-18 00:24:32.553805", "item": [{"bridge_name": "t2br2", "default_route_ip": "10.1.12.1", "dns": [{"brif": "t2s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t2s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns2", "route": [{"if": "p1", "ip": "10.1.12.1/24", "ns_if": "t2if", "ns_name": "t2"}], "subnet_ip": "2.2.2.0/24", "vms": [{"brif": "t2br2if1", "disk": "10G", "mem": 3, "name": "t2_VM3", "vcpu": 2, "vmif": "t2VM3if1"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, {"tenant_ns_if": "t2ns2if", "tenant_ns_ip": "10.1.12.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s2if", "tenant_sub_ip": "10.1.12.2/24"}], "rc": 0, "start": "2019-11-18 00:24:32.395992", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Add IP Route to Tenant] *******************************************************************************************************************************
changed: [localhost] => (item={u'default_route_ip': u'192.168.2.1', u'name': u't2', u'pns_ip': u'192.168.2.1/24', u'tenant_if': u't2if', u'tenant_ip': u'192.168.2.2/24', u'pns_if': u't2pns_if'}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t2\" ip route show default | grep -w '[d]efault via 192.168.2.1' ; if [ $? -ne 0 ] ; then ip netns exec \"t2\" ip route add default via \"192.168.2.1\" ; fi\n", "delta": "0:00:00.079800", "end": "2019-11-18 00:24:32.931392", "item": {"default_route_ip": "192.168.2.1", "name": "t2", "pns_if": "t2pns_if", "pns_ip": "192.168.2.1/24", "tenant_if": "t2if", "tenant_ip": "192.168.2.2/24"}, "rc": 0, "start": "2019-11-18 00:24:32.851592", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Add IP Route to Tenant Subnet] ************************************************************************************************************************
changed: [localhost] => (item={u'route': [{u'ip': u'10.1.11.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.1.11.1', u'bridge_name': u't2br1', u'dns': [{u'dnsif': u't2s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't2s1_dnsbrif'}], u'ns_name': u't2ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.11.2/24', u'tenant_ns_ip': u'10.1.11.1/24', u'tenant_ns_if': u't2ns1if', u'tenant_ns_name': u't2', u'tenant_sub_if': u't2s1if'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't2_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't2br1if1', u'vmif': u't2VM1if1'}, {u'mem': 4, u'name': u't2_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't2br1if2', u'vmif': u't2VM2if1'}], u'vxlan': [{u'local_ip': u'10.1.11.2', u'tenant_route_ip': u'192.168.2.2', u'dsport': 4789, u'dev': u't2s1if', u'subnet_route': u'10.1.11.0/24', u'remote_route': u'10.2.11.0/24', u'v_name': u'vxlan_t2s1', u'id': 42, u'remote_ip': u'10.2.11.2'}]}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t2ns1\" ip route show default | grep -w '[d]efault via 10.1.11.1' ; if [ $? -ne 0 ] ; then ip netns exec \"t2ns1\" ip route add default via \"10.1.11.1\" ; fi\n", "delta": "0:00:00.066532", "end": "2019-11-18 00:24:33.281721", "item": {"bridge_name": "t2br1", "default_route_ip": "10.1.11.1", "dns": [{"brif": "t2s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t2s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns1", "route": [{"if": "p1", "ip": "10.1.11.1/24", "ns_if": "t2if", "ns_name": "t2"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t2ns1if", "tenant_ns_ip": "10.1.11.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s1if", "tenant_sub_ip": "10.1.11.2/24"}], "vms": [{"brif": "t2br1if1", "disk": "10G", "mem": 2, "name": "t2_VM1", "vcpu": 4, "vmif": "t2VM1if1"}, {"brif": "t2br1if2", "disk": "10G", "mem": 4, "name": "t2_VM2", "vcpu": 2, "vmif": "t2VM2if1"}], "vxlan": [{"dev": "t2s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.11.2", "remote_ip": "10.2.11.2", "remote_route": "10.2.11.0/24", "subnet_route": "10.1.11.0/24", "tenant_route_ip": "192.168.2.2", "v_name": "vxlan_t2s1"}]}, "rc": 0, "start": "2019-11-18 00:24:33.215189", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}
changed: [localhost] => (item={u'route': [{u'ip': u'10.1.12.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.1.12.1', u'bridge_name': u't2br2', u'dns': [{u'dnsif': u't2s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't2s2_dnsbrif'}], u'ns_name': u't2ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.12.2/24', u'tenant_ns_ip': u'10.1.12.1/24', u'tenant_ns_if': u't2ns2if', u'tenant_ns_name': u't2', u'tenant_sub_if': u't2s2if'}], u'subnet_ip': u'2.2.2.0/24', u'vms': [{u'mem': 3, u'name': u't2_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't2br2if1', u'vmif': u't2VM3if1'}], u'vxlan': [{u'local_ip': [], u'tenant_route_ip': [], u'dsport': [], u'dev': [], u'subnet_route': [], u'remote_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t2ns2\" ip route show default | grep -w '[d]efault via 10.1.12.1' ; if [ $? -ne 0 ] ; then ip netns exec \"t2ns2\" ip route add default via \"10.1.12.1\" ; fi\n", "delta": "0:00:00.079455", "end": "2019-11-18 00:24:33.581776", "item": {"bridge_name": "t2br2", "default_route_ip": "10.1.12.1", "dns": [{"brif": "t2s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t2s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns2", "route": [{"if": "p1", "ip": "10.1.12.1/24", "ns_if": "t2if", "ns_name": "t2"}], "subnet_ip": "2.2.2.0/24", "tenant_ns": [{"tenant_ns_if": "t2ns2if", "tenant_ns_ip": "10.1.12.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s2if", "tenant_sub_ip": "10.1.12.2/24"}], "vms": [{"brif": "t2br2if1", "disk": "10G", "mem": 3, "name": "t2_VM3", "vcpu": 2, "vmif": "t2VM3if1"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, "rc": 0, "start": "2019-11-18 00:24:33.502321", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Create bridge inside namespace] ***********************************************************************************************************************
changed: [localhost] => (item={u'route': [{u'ip': u'10.1.11.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.1.11.1', u'bridge_name': u't2br1', u'dns': [{u'dnsif': u't2s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't2s1_dnsbrif'}], u'ns_name': u't2ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.11.2/24', u'tenant_ns_ip': u'10.1.11.1/24', u'tenant_ns_if': u't2ns1if', u'tenant_ns_name': u't2', u'tenant_sub_if': u't2s1if'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't2_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't2br1if1', u'vmif': u't2VM1if1'}, {u'mem': 4, u'name': u't2_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't2br1if2', u'vmif': u't2VM2if1'}], u'vxlan': [{u'local_ip': u'10.1.11.2', u'tenant_route_ip': u'192.168.2.2', u'dsport': 4789, u'dev': u't2s1if', u'subnet_route': u'10.1.11.0/24', u'remote_route': u'10.2.11.0/24', u'v_name': u'vxlan_t2s1', u'id': 42, u'remote_ip': u'10.2.11.2'}]}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t2ns1\" brctl show | grep -w '^t2br1'; if [ $? -ne 0 ] ; then ip netns exec \"t2ns1\" brctl addbr \"t2br1\" ; fi\nip netns exec \"t2ns1\" ip link set dev \"t2br1\" up\n", "delta": "0:00:00.114156", "end": "2019-11-18 00:24:33.989977", "item": {"bridge_name": "t2br1", "default_route_ip": "10.1.11.1", "dns": [{"brif": "t2s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t2s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns1", "route": [{"if": "p1", "ip": "10.1.11.1/24", "ns_if": "t2if", "ns_name": "t2"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t2ns1if", "tenant_ns_ip": "10.1.11.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s1if", "tenant_sub_ip": "10.1.11.2/24"}], "vms": [{"brif": "t2br1if1", "disk": "10G", "mem": 2, "name": "t2_VM1", "vcpu": 4, "vmif": "t2VM1if1"}, {"brif": "t2br1if2", "disk": "10G", "mem": 4, "name": "t2_VM2", "vcpu": 2, "vmif": "t2VM2if1"}], "vxlan": [{"dev": "t2s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.11.2", "remote_ip": "10.2.11.2", "remote_route": "10.2.11.0/24", "subnet_route": "10.1.11.0/24", "tenant_route_ip": "192.168.2.2", "v_name": "vxlan_t2s1"}]}, "rc": 0, "start": "2019-11-18 00:24:33.875821", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}
changed: [localhost] => (item={u'route': [{u'ip': u'10.1.12.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.1.12.1', u'bridge_name': u't2br2', u'dns': [{u'dnsif': u't2s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't2s2_dnsbrif'}], u'ns_name': u't2ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.12.2/24', u'tenant_ns_ip': u'10.1.12.1/24', u'tenant_ns_if': u't2ns2if', u'tenant_ns_name': u't2', u'tenant_sub_if': u't2s2if'}], u'subnet_ip': u'2.2.2.0/24', u'vms': [{u'mem': 3, u'name': u't2_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't2br2if1', u'vmif': u't2VM3if1'}], u'vxlan': [{u'local_ip': [], u'tenant_route_ip': [], u'dsport': [], u'dev': [], u'subnet_route': [], u'remote_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t2ns2\" brctl show | grep -w '^t2br2'; if [ $? -ne 0 ] ; then ip netns exec \"t2ns2\" brctl addbr \"t2br2\" ; fi\nip netns exec \"t2ns2\" ip link set dev \"t2br2\" up\n", "delta": "0:00:00.133849", "end": "2019-11-18 00:24:34.361788", "item": {"bridge_name": "t2br2", "default_route_ip": "10.1.12.1", "dns": [{"brif": "t2s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t2s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns2", "route": [{"if": "p1", "ip": "10.1.12.1/24", "ns_if": "t2if", "ns_name": "t2"}], "subnet_ip": "2.2.2.0/24", "tenant_ns": [{"tenant_ns_if": "t2ns2if", "tenant_ns_ip": "10.1.12.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s2if", "tenant_sub_ip": "10.1.12.2/24"}], "vms": [{"brif": "t2br2if1", "disk": "10G", "mem": 3, "name": "t2_VM3", "vcpu": 2, "vmif": "t2VM3if1"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, "rc": 0, "start": "2019-11-18 00:24:34.227939", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Create DNS VETH Pair] *********************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.11.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.1.11.1', u'bridge_name': u't2br1', u'ns_name': u't2ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.11.2/24', u'tenant_ns_ip': u'10.1.11.1/24', u'tenant_ns_if': u't2ns1if', u'tenant_sub_if': u't2s1if', u'tenant_ns_name': u't2'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't2_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't2br1if1', u'vmif': u't2VM1if1'}, {u'mem': 4, u'name': u't2_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't2br1if2', u'vmif': u't2VM2if1'}], u'vxlan': [{u'local_ip': u'10.1.11.2', u'dsport': 4789, u'dev': u't2s1if', u'tenant_route_ip': u'192.168.2.2', u'remote_route': u'10.2.11.0/24', u'subnet_route': u'10.1.11.0/24', u'v_name': u'vxlan_t2s1', u'id': 42, u'remote_ip': u'10.2.11.2'}]}, {u'dnsif': u't2s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't2s1_dnsbrif'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t2ns1\" ip link show \"t2s1_dnsbrif\" ; if [ $? -ne 0 ] ; then ip netns exec \"t2ns1\" ip link add \"t2s1_dnsbrif\" type veth peer name \"t2s1_dnsif\" ; fi\nip netns exec \"t2ns1\" ip link set dev \"t2s1_dnsbrif\" up\nip netns exec \"t2ns1\" ip link set dev \"t2s1_dnsif\" up\n", "delta": "0:00:00.150129", "end": "2019-11-18 00:24:34.805922", "item": [{"bridge_name": "t2br1", "default_route_ip": "10.1.11.1", "ns_name": "t2ns1", "route": [{"if": "p1", "ip": "10.1.11.1/24", "ns_if": "t2if", "ns_name": "t2"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t2ns1if", "tenant_ns_ip": "10.1.11.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s1if", "tenant_sub_ip": "10.1.11.2/24"}], "vms": [{"brif": "t2br1if1", "disk": "10G", "mem": 2, "name": "t2_VM1", "vcpu": 4, "vmif": "t2VM1if1"}, {"brif": "t2br1if2", "disk": "10G", "mem": 4, "name": "t2_VM2", "vcpu": 2, "vmif": "t2VM2if1"}], "vxlan": [{"dev": "t2s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.11.2", "remote_ip": "10.2.11.2", "remote_route": "10.2.11.0/24", "subnet_route": "10.1.11.0/24", "tenant_route_ip": "192.168.2.2", "v_name": "vxlan_t2s1"}]}, {"brif": "t2s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t2s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "rc": 0, "start": "2019-11-18 00:24:34.655793", "stderr": "Device \"t2s1_dnsbrif\" does not exist.", "stderr_lines": ["Device \"t2s1_dnsbrif\" does not exist."], "stdout": "", "stdout_lines": []}
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.12.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.1.12.1', u'bridge_name': u't2br2', u'ns_name': u't2ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.12.2/24', u'tenant_ns_ip': u'10.1.12.1/24', u'tenant_ns_if': u't2ns2if', u'tenant_sub_if': u't2s2if', u'tenant_ns_name': u't2'}], u'subnet_ip': u'2.2.2.0/24', u'vms': [{u'mem': 3, u'name': u't2_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't2br2if1', u'vmif': u't2VM3if1'}], u'vxlan': [{u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}, {u'dnsif': u't2s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't2s2_dnsbrif'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t2ns2\" ip link show \"t2s2_dnsbrif\" ; if [ $? -ne 0 ] ; then ip netns exec \"t2ns2\" ip link add \"t2s2_dnsbrif\" type veth peer name \"t2s2_dnsif\" ; fi\nip netns exec \"t2ns2\" ip link set dev \"t2s2_dnsbrif\" up\nip netns exec \"t2ns2\" ip link set dev \"t2s2_dnsif\" up\n", "delta": "0:00:00.179699", "end": "2019-11-18 00:24:35.209980", "item": [{"bridge_name": "t2br2", "default_route_ip": "10.1.12.1", "ns_name": "t2ns2", "route": [{"if": "p1", "ip": "10.1.12.1/24", "ns_if": "t2if", "ns_name": "t2"}], "subnet_ip": "2.2.2.0/24", "tenant_ns": [{"tenant_ns_if": "t2ns2if", "tenant_ns_ip": "10.1.12.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s2if", "tenant_sub_ip": "10.1.12.2/24"}], "vms": [{"brif": "t2br2if1", "disk": "10G", "mem": 3, "name": "t2_VM3", "vcpu": 2, "vmif": "t2VM3if1"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, {"brif": "t2s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t2s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "rc": 0, "start": "2019-11-18 00:24:35.030281", "stderr": "Device \"t2s2_dnsbrif\" does not exist.", "stderr_lines": ["Device \"t2s2_dnsbrif\" does not exist."], "stdout": "", "stdout_lines": []}

TASK [Attach DNS VETH Pair] *********************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.11.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.1.11.1', u'bridge_name': u't2br1', u'ns_name': u't2ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.11.2/24', u'tenant_ns_ip': u'10.1.11.1/24', u'tenant_ns_if': u't2ns1if', u'tenant_sub_if': u't2s1if', u'tenant_ns_name': u't2'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't2_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't2br1if1', u'vmif': u't2VM1if1'}, {u'mem': 4, u'name': u't2_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't2br1if2', u'vmif': u't2VM2if1'}], u'vxlan': [{u'local_ip': u'10.1.11.2', u'dsport': 4789, u'dev': u't2s1if', u'tenant_route_ip': u'192.168.2.2', u'remote_route': u'10.2.11.0/24', u'subnet_route': u'10.1.11.0/24', u'v_name': u'vxlan_t2s1', u'id': 42, u'remote_ip': u'10.2.11.2'}]}, {u'dnsif': u't2s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't2s1_dnsbrif'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t2ns1\" brctl show \"t2br1\" | grep -w 't2s1_dnsbrif' ; if [ $? -ne 0 ] ; then ip netns exec \"t2ns1\" brctl addif \"t2br1\" \"t2s1_dnsbrif\" ; fi\n", "delta": "0:00:00.094232", "end": "2019-11-18 00:24:35.570043", "item": [{"bridge_name": "t2br1", "default_route_ip": "10.1.11.1", "ns_name": "t2ns1", "route": [{"if": "p1", "ip": "10.1.11.1/24", "ns_if": "t2if", "ns_name": "t2"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t2ns1if", "tenant_ns_ip": "10.1.11.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s1if", "tenant_sub_ip": "10.1.11.2/24"}], "vms": [{"brif": "t2br1if1", "disk": "10G", "mem": 2, "name": "t2_VM1", "vcpu": 4, "vmif": "t2VM1if1"}, {"brif": "t2br1if2", "disk": "10G", "mem": 4, "name": "t2_VM2", "vcpu": 2, "vmif": "t2VM2if1"}], "vxlan": [{"dev": "t2s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.11.2", "remote_ip": "10.2.11.2", "remote_route": "10.2.11.0/24", "subnet_route": "10.1.11.0/24", "tenant_route_ip": "192.168.2.2", "v_name": "vxlan_t2s1"}]}, {"brif": "t2s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t2s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "rc": 0, "start": "2019-11-18 00:24:35.475811", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.12.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.1.12.1', u'bridge_name': u't2br2', u'ns_name': u't2ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.12.2/24', u'tenant_ns_ip': u'10.1.12.1/24', u'tenant_ns_if': u't2ns2if', u'tenant_sub_if': u't2s2if', u'tenant_ns_name': u't2'}], u'subnet_ip': u'2.2.2.0/24', u'vms': [{u'mem': 3, u'name': u't2_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't2br2if1', u'vmif': u't2VM3if1'}], u'vxlan': [{u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}, {u'dnsif': u't2s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't2s2_dnsbrif'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t2ns2\" brctl show \"t2br2\" | grep -w 't2s2_dnsbrif' ; if [ $? -ne 0 ] ; then ip netns exec \"t2ns2\" brctl addif \"t2br2\" \"t2s2_dnsbrif\" ; fi\n", "delta": "0:00:00.084800", "end": "2019-11-18 00:24:35.889744", "item": [{"bridge_name": "t2br2", "default_route_ip": "10.1.12.1", "ns_name": "t2ns2", "route": [{"if": "p1", "ip": "10.1.12.1/24", "ns_if": "t2if", "ns_name": "t2"}], "subnet_ip": "2.2.2.0/24", "tenant_ns": [{"tenant_ns_if": "t2ns2if", "tenant_ns_ip": "10.1.12.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s2if", "tenant_sub_ip": "10.1.12.2/24"}], "vms": [{"brif": "t2br2if1", "disk": "10G", "mem": 3, "name": "t2_VM3", "vcpu": 2, "vmif": "t2VM3if1"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, {"brif": "t2s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t2s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "rc": 0, "start": "2019-11-18 00:24:35.804944", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Create VETH Pairs] ************************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.11.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.1.11.1', u'bridge_name': u't2br1', u'dns': [{u'dnsif': u't2s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't2s1_dnsbrif'}], u'ns_name': u't2ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.11.2/24', u'tenant_ns_ip': u'10.1.11.1/24', u'tenant_ns_if': u't2ns1if', u'tenant_sub_if': u't2s1if', u'tenant_ns_name': u't2'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.1.11.2', u'dsport': 4789, u'dev': u't2s1if', u'tenant_route_ip': u'192.168.2.2', u'remote_route': u'10.2.11.0/24', u'subnet_route': u'10.1.11.0/24', u'v_name': u'vxlan_t2s1', u'id': 42, u'remote_ip': u'10.2.11.2'}]}, {u'mem': 2, u'name': u't2_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't2br1if1', u'vmif': u't2VM1if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip link show \"t2br1if1\" ; if [ $? -ne 0 ] ; then ip link add \"t2VM1if1\" type veth peer name \"t2br1if1\" ; fi\nip link set dev \"t2br1if1\" up\nip link set dev \"t2VM1if1\" up\n", "delta": "0:00:00.026347", "end": "2019-11-18 00:24:36.202859", "item": [{"bridge_name": "t2br1", "default_route_ip": "10.1.11.1", "dns": [{"brif": "t2s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t2s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns1", "route": [{"if": "p1", "ip": "10.1.11.1/24", "ns_if": "t2if", "ns_name": "t2"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t2ns1if", "tenant_ns_ip": "10.1.11.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s1if", "tenant_sub_ip": "10.1.11.2/24"}], "vxlan": [{"dev": "t2s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.11.2", "remote_ip": "10.2.11.2", "remote_route": "10.2.11.0/24", "subnet_route": "10.1.11.0/24", "tenant_route_ip": "192.168.2.2", "v_name": "vxlan_t2s1"}]}, {"brif": "t2br1if1", "disk": "10G", "mem": 2, "name": "t2_VM1", "vcpu": 4, "vmif": "t2VM1if1"}], "rc": 0, "start": "2019-11-18 00:24:36.176512", "stderr": "Device \"t2br1if1\" does not exist.", "stderr_lines": ["Device \"t2br1if1\" does not exist."], "stdout": "", "stdout_lines": []}
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.11.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.1.11.1', u'bridge_name': u't2br1', u'dns': [{u'dnsif': u't2s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't2s1_dnsbrif'}], u'ns_name': u't2ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.11.2/24', u'tenant_ns_ip': u'10.1.11.1/24', u'tenant_ns_if': u't2ns1if', u'tenant_sub_if': u't2s1if', u'tenant_ns_name': u't2'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.1.11.2', u'dsport': 4789, u'dev': u't2s1if', u'tenant_route_ip': u'192.168.2.2', u'remote_route': u'10.2.11.0/24', u'subnet_route': u'10.1.11.0/24', u'v_name': u'vxlan_t2s1', u'id': 42, u'remote_ip': u'10.2.11.2'}]}, {u'mem': 4, u'name': u't2_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't2br1if2', u'vmif': u't2VM2if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip link show \"t2br1if2\" ; if [ $? -ne 0 ] ; then ip link add \"t2VM2if1\" type veth peer name \"t2br1if2\" ; fi\nip link set dev \"t2br1if2\" up\nip link set dev \"t2VM2if1\" up\n", "delta": "0:00:00.025983", "end": "2019-11-18 00:24:36.478573", "item": [{"bridge_name": "t2br1", "default_route_ip": "10.1.11.1", "dns": [{"brif": "t2s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t2s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns1", "route": [{"if": "p1", "ip": "10.1.11.1/24", "ns_if": "t2if", "ns_name": "t2"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t2ns1if", "tenant_ns_ip": "10.1.11.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s1if", "tenant_sub_ip": "10.1.11.2/24"}], "vxlan": [{"dev": "t2s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.11.2", "remote_ip": "10.2.11.2", "remote_route": "10.2.11.0/24", "subnet_route": "10.1.11.0/24", "tenant_route_ip": "192.168.2.2", "v_name": "vxlan_t2s1"}]}, {"brif": "t2br1if2", "disk": "10G", "mem": 4, "name": "t2_VM2", "vcpu": 2, "vmif": "t2VM2if1"}], "rc": 0, "start": "2019-11-18 00:24:36.452590", "stderr": "Device \"t2br1if2\" does not exist.", "stderr_lines": ["Device \"t2br1if2\" does not exist."], "stdout": "", "stdout_lines": []}
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.12.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.1.12.1', u'bridge_name': u't2br2', u'dns': [{u'dnsif': u't2s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't2s2_dnsbrif'}], u'ns_name': u't2ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.12.2/24', u'tenant_ns_ip': u'10.1.12.1/24', u'tenant_ns_if': u't2ns2if', u'tenant_sub_if': u't2s2if', u'tenant_ns_name': u't2'}], u'subnet_ip': u'2.2.2.0/24', u'vxlan': [{u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}, {u'mem': 3, u'name': u't2_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't2br2if1', u'vmif': u't2VM3if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip link show \"t2br2if1\" ; if [ $? -ne 0 ] ; then ip link add \"t2VM3if1\" type veth peer name \"t2br2if1\" ; fi\nip link set dev \"t2br2if1\" up\nip link set dev \"t2VM3if1\" up\n", "delta": "0:00:00.022313", "end": "2019-11-18 00:24:36.728539", "item": [{"bridge_name": "t2br2", "default_route_ip": "10.1.12.1", "dns": [{"brif": "t2s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t2s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns2", "route": [{"if": "p1", "ip": "10.1.12.1/24", "ns_if": "t2if", "ns_name": "t2"}], "subnet_ip": "2.2.2.0/24", "tenant_ns": [{"tenant_ns_if": "t2ns2if", "tenant_ns_ip": "10.1.12.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s2if", "tenant_sub_ip": "10.1.12.2/24"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, {"brif": "t2br2if1", "disk": "10G", "mem": 3, "name": "t2_VM3", "vcpu": 2, "vmif": "t2VM3if1"}], "rc": 0, "start": "2019-11-18 00:24:36.706226", "stderr": "Device \"t2br2if1\" does not exist.", "stderr_lines": ["Device \"t2br2if1\" does not exist."], "stdout": "", "stdout_lines": []}

TASK [Attach VETH Pairs] ************************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.11.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.1.11.1', u'bridge_name': u't2br1', u'dns': [{u'dnsif': u't2s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't2s1_dnsbrif'}], u'ns_name': u't2ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.11.2/24', u'tenant_ns_ip': u'10.1.11.1/24', u'tenant_ns_if': u't2ns1if', u'tenant_sub_if': u't2s1if', u'tenant_ns_name': u't2'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.1.11.2', u'dsport': 4789, u'dev': u't2s1if', u'tenant_route_ip': u'192.168.2.2', u'remote_route': u'10.2.11.0/24', u'subnet_route': u'10.1.11.0/24', u'v_name': u'vxlan_t2s1', u'id': 42, u'remote_ip': u'10.2.11.2'}]}, {u'mem': 2, u'name': u't2_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't2br1if1', u'vmif': u't2VM1if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip link show \"t2br1if1\" ; if [ $? -eq 0 ] ; then ip link set \"t2br1if1\" netns \"t2ns1\" ; fi\nip netns exec \"t2ns1\" brctl show \"t2br1\" | grep -w 't2br1if1' ; if [ $? -ne 0 ] ; then ip netns exec \"t2ns1\" brctl addif \"t2br1\" \"t2br1if1\" ; fi\n", "delta": "0:00:00.122441", "end": "2019-11-18 00:24:37.173904", "item": [{"bridge_name": "t2br1", "default_route_ip": "10.1.11.1", "dns": [{"brif": "t2s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t2s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns1", "route": [{"if": "p1", "ip": "10.1.11.1/24", "ns_if": "t2if", "ns_name": "t2"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t2ns1if", "tenant_ns_ip": "10.1.11.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s1if", "tenant_sub_ip": "10.1.11.2/24"}], "vxlan": [{"dev": "t2s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.11.2", "remote_ip": "10.2.11.2", "remote_route": "10.2.11.0/24", "subnet_route": "10.1.11.0/24", "tenant_route_ip": "192.168.2.2", "v_name": "vxlan_t2s1"}]}, {"brif": "t2br1if1", "disk": "10G", "mem": 2, "name": "t2_VM1", "vcpu": 4, "vmif": "t2VM1if1"}], "rc": 0, "start": "2019-11-18 00:24:37.051463", "stderr": "", "stderr_lines": [], "stdout": "35: t2br1if1@t2VM1if1: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP mode DEFAULT group default qlen 1000\n    link/ether 2e:21:08:45:23:a3 brd ff:ff:ff:ff:ff:ff", "stdout_lines": ["35: t2br1if1@t2VM1if1: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP mode DEFAULT group default qlen 1000", "    link/ether 2e:21:08:45:23:a3 brd ff:ff:ff:ff:ff:ff"]}
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.11.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.1.11.1', u'bridge_name': u't2br1', u'dns': [{u'dnsif': u't2s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't2s1_dnsbrif'}], u'ns_name': u't2ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.11.2/24', u'tenant_ns_ip': u'10.1.11.1/24', u'tenant_ns_if': u't2ns1if', u'tenant_sub_if': u't2s1if', u'tenant_ns_name': u't2'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.1.11.2', u'dsport': 4789, u'dev': u't2s1if', u'tenant_route_ip': u'192.168.2.2', u'remote_route': u'10.2.11.0/24', u'subnet_route': u'10.1.11.0/24', u'v_name': u'vxlan_t2s1', u'id': 42, u'remote_ip': u'10.2.11.2'}]}, {u'mem': 4, u'name': u't2_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't2br1if2', u'vmif': u't2VM2if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip link show \"t2br1if2\" ; if [ $? -eq 0 ] ; then ip link set \"t2br1if2\" netns \"t2ns1\" ; fi\nip netns exec \"t2ns1\" brctl show \"t2br1\" | grep -w 't2br1if2' ; if [ $? -ne 0 ] ; then ip netns exec \"t2ns1\" brctl addif \"t2br1\" \"t2br1if2\" ; fi\n", "delta": "0:00:00.109870", "end": "2019-11-18 00:24:37.505713", "item": [{"bridge_name": "t2br1", "default_route_ip": "10.1.11.1", "dns": [{"brif": "t2s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t2s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns1", "route": [{"if": "p1", "ip": "10.1.11.1/24", "ns_if": "t2if", "ns_name": "t2"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t2ns1if", "tenant_ns_ip": "10.1.11.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s1if", "tenant_sub_ip": "10.1.11.2/24"}], "vxlan": [{"dev": "t2s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.11.2", "remote_ip": "10.2.11.2", "remote_route": "10.2.11.0/24", "subnet_route": "10.1.11.0/24", "tenant_route_ip": "192.168.2.2", "v_name": "vxlan_t2s1"}]}, {"brif": "t2br1if2", "disk": "10G", "mem": 4, "name": "t2_VM2", "vcpu": 2, "vmif": "t2VM2if1"}], "rc": 0, "start": "2019-11-18 00:24:37.395843", "stderr": "", "stderr_lines": [], "stdout": "37: t2br1if2@t2VM2if1: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP mode DEFAULT group default qlen 1000\n    link/ether 7a:ef:7e:27:05:7e brd ff:ff:ff:ff:ff:ff", "stdout_lines": ["37: t2br1if2@t2VM2if1: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP mode DEFAULT group default qlen 1000", "    link/ether 7a:ef:7e:27:05:7e brd ff:ff:ff:ff:ff:ff"]}
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.12.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.1.12.1', u'bridge_name': u't2br2', u'dns': [{u'dnsif': u't2s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't2s2_dnsbrif'}], u'ns_name': u't2ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.12.2/24', u'tenant_ns_ip': u'10.1.12.1/24', u'tenant_ns_if': u't2ns2if', u'tenant_sub_if': u't2s2if', u'tenant_ns_name': u't2'}], u'subnet_ip': u'2.2.2.0/24', u'vxlan': [{u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}, {u'mem': 3, u'name': u't2_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't2br2if1', u'vmif': u't2VM3if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip link show \"t2br2if1\" ; if [ $? -eq 0 ] ; then ip link set \"t2br2if1\" netns \"t2ns2\" ; fi\nip netns exec \"t2ns2\" brctl show \"t2br2\" | grep -w 't2br2if1' ; if [ $? -ne 0 ] ; then ip netns exec \"t2ns2\" brctl addif \"t2br2\" \"t2br2if1\" ; fi\n", "delta": "0:00:00.100804", "end": "2019-11-18 00:24:37.801535", "item": [{"bridge_name": "t2br2", "default_route_ip": "10.1.12.1", "dns": [{"brif": "t2s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t2s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns2", "route": [{"if": "p1", "ip": "10.1.12.1/24", "ns_if": "t2if", "ns_name": "t2"}], "subnet_ip": "2.2.2.0/24", "tenant_ns": [{"tenant_ns_if": "t2ns2if", "tenant_ns_ip": "10.1.12.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s2if", "tenant_sub_ip": "10.1.12.2/24"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, {"brif": "t2br2if1", "disk": "10G", "mem": 3, "name": "t2_VM3", "vcpu": 2, "vmif": "t2VM3if1"}], "rc": 0, "start": "2019-11-18 00:24:37.700731", "stderr": "", "stderr_lines": [], "stdout": "39: t2br2if1@t2VM3if1: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP mode DEFAULT group default qlen 1000\n    link/ether b2:a6:ac:1f:c7:7f brd ff:ff:ff:ff:ff:ff", "stdout_lines": ["39: t2br2if1@t2VM3if1: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP mode DEFAULT group default qlen 1000", "    link/ether b2:a6:ac:1f:c7:7f brd ff:ff:ff:ff:ff:ff"]}

TASK [All interfaces and bridges UP] ************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.11.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.1.11.1', u'bridge_name': u't2br1', u'dns': [{u'dnsif': u't2s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't2s1_dnsbrif'}], u'ns_name': u't2ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.11.2/24', u'tenant_ns_ip': u'10.1.11.1/24', u'tenant_ns_if': u't2ns1if', u'tenant_sub_if': u't2s1if', u'tenant_ns_name': u't2'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.1.11.2', u'dsport': 4789, u'dev': u't2s1if', u'tenant_route_ip': u'192.168.2.2', u'remote_route': u'10.2.11.0/24', u'subnet_route': u'10.1.11.0/24', u'v_name': u'vxlan_t2s1', u'id': 42, u'remote_ip': u'10.2.11.2'}]}, {u'mem': 2, u'name': u't2_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't2br1if1', u'vmif': u't2VM1if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t2ns1\" ip link set \"t2br1if1\" up\nip netns exec \"t2ns1\" ip link set dev \"t2br1\" up\n", "delta": "0:00:00.069231", "end": "2019-11-18 00:24:38.137721", "item": [{"bridge_name": "t2br1", "default_route_ip": "10.1.11.1", "dns": [{"brif": "t2s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t2s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns1", "route": [{"if": "p1", "ip": "10.1.11.1/24", "ns_if": "t2if", "ns_name": "t2"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t2ns1if", "tenant_ns_ip": "10.1.11.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s1if", "tenant_sub_ip": "10.1.11.2/24"}], "vxlan": [{"dev": "t2s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.11.2", "remote_ip": "10.2.11.2", "remote_route": "10.2.11.0/24", "subnet_route": "10.1.11.0/24", "tenant_route_ip": "192.168.2.2", "v_name": "vxlan_t2s1"}]}, {"brif": "t2br1if1", "disk": "10G", "mem": 2, "name": "t2_VM1", "vcpu": 4, "vmif": "t2VM1if1"}], "rc": 0, "start": "2019-11-18 00:24:38.068490", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.11.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.1.11.1', u'bridge_name': u't2br1', u'dns': [{u'dnsif': u't2s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't2s1_dnsbrif'}], u'ns_name': u't2ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.11.2/24', u'tenant_ns_ip': u'10.1.11.1/24', u'tenant_ns_if': u't2ns1if', u'tenant_sub_if': u't2s1if', u'tenant_ns_name': u't2'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.1.11.2', u'dsport': 4789, u'dev': u't2s1if', u'tenant_route_ip': u'192.168.2.2', u'remote_route': u'10.2.11.0/24', u'subnet_route': u'10.1.11.0/24', u'v_name': u'vxlan_t2s1', u'id': 42, u'remote_ip': u'10.2.11.2'}]}, {u'mem': 4, u'name': u't2_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't2br1if2', u'vmif': u't2VM2if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t2ns1\" ip link set \"t2br1if2\" up\nip netns exec \"t2ns1\" ip link set dev \"t2br1\" up\n", "delta": "0:00:00.079817", "end": "2019-11-18 00:24:38.429691", "item": [{"bridge_name": "t2br1", "default_route_ip": "10.1.11.1", "dns": [{"brif": "t2s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t2s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns1", "route": [{"if": "p1", "ip": "10.1.11.1/24", "ns_if": "t2if", "ns_name": "t2"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t2ns1if", "tenant_ns_ip": "10.1.11.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s1if", "tenant_sub_ip": "10.1.11.2/24"}], "vxlan": [{"dev": "t2s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.11.2", "remote_ip": "10.2.11.2", "remote_route": "10.2.11.0/24", "subnet_route": "10.1.11.0/24", "tenant_route_ip": "192.168.2.2", "v_name": "vxlan_t2s1"}]}, {"brif": "t2br1if2", "disk": "10G", "mem": 4, "name": "t2_VM2", "vcpu": 2, "vmif": "t2VM2if1"}], "rc": 0, "start": "2019-11-18 00:24:38.349874", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.12.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.1.12.1', u'bridge_name': u't2br2', u'dns': [{u'dnsif': u't2s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't2s2_dnsbrif'}], u'ns_name': u't2ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.12.2/24', u'tenant_ns_ip': u'10.1.12.1/24', u'tenant_ns_if': u't2ns2if', u'tenant_sub_if': u't2s2if', u'tenant_ns_name': u't2'}], u'subnet_ip': u'2.2.2.0/24', u'vxlan': [{u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}, {u'mem': 3, u'name': u't2_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't2br2if1', u'vmif': u't2VM3if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t2ns2\" ip link set \"t2br2if1\" up\nip netns exec \"t2ns2\" ip link set dev \"t2br2\" up\n", "delta": "0:00:00.079236", "end": "2019-11-18 00:24:38.749941", "item": [{"bridge_name": "t2br2", "default_route_ip": "10.1.12.1", "dns": [{"brif": "t2s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t2s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns2", "route": [{"if": "p1", "ip": "10.1.12.1/24", "ns_if": "t2if", "ns_name": "t2"}], "subnet_ip": "2.2.2.0/24", "tenant_ns": [{"tenant_ns_if": "t2ns2if", "tenant_ns_ip": "10.1.12.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s2if", "tenant_sub_ip": "10.1.12.2/24"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, {"brif": "t2br2if1", "disk": "10G", "mem": 3, "name": "t2_VM3", "vcpu": 2, "vmif": "t2VM3if1"}], "rc": 0, "start": "2019-11-18 00:24:38.670705", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Add IP to DNS Interface] ******************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.11.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.1.11.1', u'bridge_name': u't2br1', u'ns_name': u't2ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.11.2/24', u'tenant_ns_ip': u'10.1.11.1/24', u'tenant_ns_if': u't2ns1if', u'tenant_sub_if': u't2s1if', u'tenant_ns_name': u't2'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't2_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't2br1if1', u'vmif': u't2VM1if1'}, {u'mem': 4, u'name': u't2_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't2br1if2', u'vmif': u't2VM2if1'}], u'vxlan': [{u'local_ip': u'10.1.11.2', u'dsport': 4789, u'dev': u't2s1if', u'tenant_route_ip': u'192.168.2.2', u'remote_route': u'10.2.11.0/24', u'subnet_route': u'10.1.11.0/24', u'v_name': u'vxlan_t2s1', u'id': 42, u'remote_ip': u'10.2.11.2'}]}, {u'dnsif': u't2s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't2s1_dnsbrif'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t2ns1\" ip addr show \"t2s1_dnsif\" | awk 'FNR==3{ print $2 }' | grep -w '^1.1.1.1/24' ; if [ $? -ne 0 ] ; then ip netns exec \"t2ns1\" ip addr add \"1.1.1.1/24\" dev \"t2s1_dnsif\" ; fi\n", "delta": "0:00:00.076545", "end": "2019-11-18 00:24:39.101844", "item": [{"bridge_name": "t2br1", "default_route_ip": "10.1.11.1", "ns_name": "t2ns1", "route": [{"if": "p1", "ip": "10.1.11.1/24", "ns_if": "t2if", "ns_name": "t2"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t2ns1if", "tenant_ns_ip": "10.1.11.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s1if", "tenant_sub_ip": "10.1.11.2/24"}], "vms": [{"brif": "t2br1if1", "disk": "10G", "mem": 2, "name": "t2_VM1", "vcpu": 4, "vmif": "t2VM1if1"}, {"brif": "t2br1if2", "disk": "10G", "mem": 4, "name": "t2_VM2", "vcpu": 2, "vmif": "t2VM2if1"}], "vxlan": [{"dev": "t2s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.11.2", "remote_ip": "10.2.11.2", "remote_route": "10.2.11.0/24", "subnet_route": "10.1.11.0/24", "tenant_route_ip": "192.168.2.2", "v_name": "vxlan_t2s1"}]}, {"brif": "t2s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t2s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "rc": 0, "start": "2019-11-18 00:24:39.025299", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.12.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.1.12.1', u'bridge_name': u't2br2', u'ns_name': u't2ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.12.2/24', u'tenant_ns_ip': u'10.1.12.1/24', u'tenant_ns_if': u't2ns2if', u'tenant_sub_if': u't2s2if', u'tenant_ns_name': u't2'}], u'subnet_ip': u'2.2.2.0/24', u'vms': [{u'mem': 3, u'name': u't2_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't2br2if1', u'vmif': u't2VM3if1'}], u'vxlan': [{u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}, {u'dnsif': u't2s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't2s2_dnsbrif'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t2ns2\" ip addr show \"t2s2_dnsif\" | awk 'FNR==3{ print $2 }' | grep -w '^2.2.2.1/24' ; if [ $? -ne 0 ] ; then ip netns exec \"t2ns2\" ip addr add \"2.2.2.1/24\" dev \"t2s2_dnsif\" ; fi\n", "delta": "0:00:00.083860", "end": "2019-11-18 00:24:39.397880", "item": [{"bridge_name": "t2br2", "default_route_ip": "10.1.12.1", "ns_name": "t2ns2", "route": [{"if": "p1", "ip": "10.1.12.1/24", "ns_if": "t2if", "ns_name": "t2"}], "subnet_ip": "2.2.2.0/24", "tenant_ns": [{"tenant_ns_if": "t2ns2if", "tenant_ns_ip": "10.1.12.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s2if", "tenant_sub_ip": "10.1.12.2/24"}], "vms": [{"brif": "t2br2if1", "disk": "10G", "mem": 3, "name": "t2_VM3", "vcpu": 2, "vmif": "t2VM3if1"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, {"brif": "t2s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t2s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "rc": 0, "start": "2019-11-18 00:24:39.314020", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Install DHCP Server] **********************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.11.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.1.11.1', u'bridge_name': u't2br1', u'ns_name': u't2ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.11.2/24', u'tenant_ns_ip': u'10.1.11.1/24', u'tenant_ns_if': u't2ns1if', u'tenant_sub_if': u't2s1if', u'tenant_ns_name': u't2'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't2_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't2br1if1', u'vmif': u't2VM1if1'}, {u'mem': 4, u'name': u't2_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't2br1if2', u'vmif': u't2VM2if1'}], u'vxlan': [{u'local_ip': u'10.1.11.2', u'dsport': 4789, u'dev': u't2s1if', u'tenant_route_ip': u'192.168.2.2', u'remote_route': u'10.2.11.0/24', u'subnet_route': u'10.1.11.0/24', u'v_name': u'vxlan_t2s1', u'id': 42, u'remote_ip': u'10.2.11.2'}]}, {u'dnsif': u't2s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't2s1_dnsbrif'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t2ns1\" ps aux | grep -w '[d]nsmasq --interface t2s1_dnsif -z --dhcp-range=1.1.1.5,1.1.1.126' ; if [ $? -ne 0 ] ; then ip netns exec \"t2ns1\" dnsmasq --interface \"t2s1_dnsif\" -z --dhcp-range=1.1.1.5,'1.1.1.126' ; fi\n", "delta": "0:00:00.081215", "end": "2019-11-18 00:24:39.790841", "item": [{"bridge_name": "t2br1", "default_route_ip": "10.1.11.1", "ns_name": "t2ns1", "route": [{"if": "p1", "ip": "10.1.11.1/24", "ns_if": "t2if", "ns_name": "t2"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t2ns1if", "tenant_ns_ip": "10.1.11.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s1if", "tenant_sub_ip": "10.1.11.2/24"}], "vms": [{"brif": "t2br1if1", "disk": "10G", "mem": 2, "name": "t2_VM1", "vcpu": 4, "vmif": "t2VM1if1"}, {"brif": "t2br1if2", "disk": "10G", "mem": 4, "name": "t2_VM2", "vcpu": 2, "vmif": "t2VM2if1"}], "vxlan": [{"dev": "t2s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.11.2", "remote_ip": "10.2.11.2", "remote_route": "10.2.11.0/24", "subnet_route": "10.1.11.0/24", "tenant_route_ip": "192.168.2.2", "v_name": "vxlan_t2s1"}]}, {"brif": "t2s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t2s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "rc": 0, "start": "2019-11-18 00:24:39.709626", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.12.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.1.12.1', u'bridge_name': u't2br2', u'ns_name': u't2ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.12.2/24', u'tenant_ns_ip': u'10.1.12.1/24', u'tenant_ns_if': u't2ns2if', u'tenant_sub_if': u't2s2if', u'tenant_ns_name': u't2'}], u'subnet_ip': u'2.2.2.0/24', u'vms': [{u'mem': 3, u'name': u't2_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't2br2if1', u'vmif': u't2VM3if1'}], u'vxlan': [{u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}, {u'dnsif': u't2s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't2s2_dnsbrif'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t2ns2\" ps aux | grep -w '[d]nsmasq --interface t2s2_dnsif -z --dhcp-range=2.2.2.5,2.2.2.254' ; if [ $? -ne 0 ] ; then ip netns exec \"t2ns2\" dnsmasq --interface \"t2s2_dnsif\" -z --dhcp-range=2.2.2.5,'2.2.2.254' ; fi\n", "delta": "0:00:00.075895", "end": "2019-11-18 00:24:40.095482", "item": [{"bridge_name": "t2br2", "default_route_ip": "10.1.12.1", "ns_name": "t2ns2", "route": [{"if": "p1", "ip": "10.1.12.1/24", "ns_if": "t2if", "ns_name": "t2"}], "subnet_ip": "2.2.2.0/24", "tenant_ns": [{"tenant_ns_if": "t2ns2if", "tenant_ns_ip": "10.1.12.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s2if", "tenant_sub_ip": "10.1.12.2/24"}], "vms": [{"brif": "t2br2if1", "disk": "10G", "mem": 3, "name": "t2_VM3", "vcpu": 2, "vmif": "t2VM3if1"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, {"brif": "t2s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t2s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "rc": 0, "start": "2019-11-18 00:24:40.019587", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Create VXLAN devices] *********************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.11.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.1.11.1', u'bridge_name': u't2br1', u'dns': [{u'dnsif': u't2s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't2s1_dnsbrif'}], u'ns_name': u't2ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.11.2/24', u'tenant_ns_ip': u'10.1.11.1/24', u'tenant_ns_if': u't2ns1if', u'tenant_sub_if': u't2s1if', u'tenant_ns_name': u't2'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't2_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't2br1if1', u'vmif': u't2VM1if1'}, {u'mem': 4, u'name': u't2_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't2br1if2', u'vmif': u't2VM2if1'}]}, {u'local_ip': u'10.1.11.2', u'dsport': 4789, u'dev': u't2s1if', u'tenant_route_ip': u'192.168.2.2', u'remote_route': u'10.2.11.0/24', u'subnet_route': u'10.1.11.0/24', u'v_name': u'vxlan_t2s1', u'id': 42, u'remote_ip': u'10.2.11.2'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t2ns1\" ip link show \"vxlan_t2s1\" ; if [ $? -ne 0 ] ; then ip netns exec \"t2ns1\" ip link add \"vxlan_t2s1\" type vxlan id \"42\" local \"10.1.11.2\" remote \"10.2.11.2\" dstport \"4789\" dev \"t2s1if\"; ip netns exec \"t2ns1\" ip link set dev \"vxlan_t2s1\" up ; fi\n", "delta": "0:00:00.144840", "end": "2019-11-18 00:24:40.569573", "item": [{"bridge_name": "t2br1", "default_route_ip": "10.1.11.1", "dns": [{"brif": "t2s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t2s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns1", "route": [{"if": "p1", "ip": "10.1.11.1/24", "ns_if": "t2if", "ns_name": "t2"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t2ns1if", "tenant_ns_ip": "10.1.11.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s1if", "tenant_sub_ip": "10.1.11.2/24"}], "vms": [{"brif": "t2br1if1", "disk": "10G", "mem": 2, "name": "t2_VM1", "vcpu": 4, "vmif": "t2VM1if1"}, {"brif": "t2br1if2", "disk": "10G", "mem": 4, "name": "t2_VM2", "vcpu": 2, "vmif": "t2VM2if1"}]}, {"dev": "t2s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.11.2", "remote_ip": "10.2.11.2", "remote_route": "10.2.11.0/24", "subnet_route": "10.1.11.0/24", "tenant_route_ip": "192.168.2.2", "v_name": "vxlan_t2s1"}], "rc": 0, "start": "2019-11-18 00:24:40.424733", "stderr": "Device \"vxlan_t2s1\" does not exist.", "stderr_lines": ["Device \"vxlan_t2s1\" does not exist."], "stdout": "", "stdout_lines": []}
skipping: [localhost] => (item=[{u'route': [{u'ip': u'10.1.12.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.1.12.1', u'bridge_name': u't2br2', u'dns': [{u'dnsif': u't2s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't2s2_dnsbrif'}], u'ns_name': u't2ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.12.2/24', u'tenant_ns_ip': u'10.1.12.1/24', u'tenant_ns_if': u't2ns2if', u'tenant_sub_if': u't2s2if', u'tenant_ns_name': u't2'}], u'subnet_ip': u'2.2.2.0/24', u'vms': [{u'mem': 3, u'name': u't2_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't2br2if1', u'vmif': u't2VM3if1'}]}, {u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}])  => {"ansible_loop_var": "item", "changed": false, "item": [{"bridge_name": "t2br2", "default_route_ip": "10.1.12.1", "dns": [{"brif": "t2s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t2s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns2", "route": [{"if": "p1", "ip": "10.1.12.1/24", "ns_if": "t2if", "ns_name": "t2"}], "subnet_ip": "2.2.2.0/24", "tenant_ns": [{"tenant_ns_if": "t2ns2if", "tenant_ns_ip": "10.1.12.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s2if", "tenant_sub_ip": "10.1.12.2/24"}], "vms": [{"brif": "t2br2if1", "disk": "10G", "mem": 3, "name": "t2_VM3", "vcpu": 2, "vmif": "t2VM3if1"}]}, {"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}], "skip_reason": "Conditional result was False"}

TASK [Attach VXLANs to bridge] ******************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.11.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.1.11.1', u'bridge_name': u't2br1', u'dns': [{u'dnsif': u't2s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't2s1_dnsbrif'}], u'ns_name': u't2ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.11.2/24', u'tenant_ns_ip': u'10.1.11.1/24', u'tenant_ns_if': u't2ns1if', u'tenant_sub_if': u't2s1if', u'tenant_ns_name': u't2'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't2_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't2br1if1', u'vmif': u't2VM1if1'}, {u'mem': 4, u'name': u't2_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't2br1if2', u'vmif': u't2VM2if1'}]}, {u'local_ip': u'10.1.11.2', u'dsport': 4789, u'dev': u't2s1if', u'tenant_route_ip': u'192.168.2.2', u'remote_route': u'10.2.11.0/24', u'subnet_route': u'10.1.11.0/24', u'v_name': u'vxlan_t2s1', u'id': 42, u'remote_ip': u'10.2.11.2'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t2ns1\" brctl show \"t2br1\" | grep -w 'vxlan_t2s1' ; if [ $? -ne 0 ] ; then ip netns exec \"t2ns1\" brctl addif \"t2br1\" \"vxlan_t2s1\" ; fi\n", "delta": "0:00:00.065916", "end": "2019-11-18 00:24:40.949700", "item": [{"bridge_name": "t2br1", "default_route_ip": "10.1.11.1", "dns": [{"brif": "t2s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t2s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns1", "route": [{"if": "p1", "ip": "10.1.11.1/24", "ns_if": "t2if", "ns_name": "t2"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t2ns1if", "tenant_ns_ip": "10.1.11.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s1if", "tenant_sub_ip": "10.1.11.2/24"}], "vms": [{"brif": "t2br1if1", "disk": "10G", "mem": 2, "name": "t2_VM1", "vcpu": 4, "vmif": "t2VM1if1"}, {"brif": "t2br1if2", "disk": "10G", "mem": 4, "name": "t2_VM2", "vcpu": 2, "vmif": "t2VM2if1"}]}, {"dev": "t2s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.11.2", "remote_ip": "10.2.11.2", "remote_route": "10.2.11.0/24", "subnet_route": "10.1.11.0/24", "tenant_route_ip": "192.168.2.2", "v_name": "vxlan_t2s1"}], "rc": 0, "start": "2019-11-18 00:24:40.883784", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}
skipping: [localhost] => (item=[{u'route': [{u'ip': u'10.1.12.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.1.12.1', u'bridge_name': u't2br2', u'dns': [{u'dnsif': u't2s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't2s2_dnsbrif'}], u'ns_name': u't2ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.12.2/24', u'tenant_ns_ip': u'10.1.12.1/24', u'tenant_ns_if': u't2ns2if', u'tenant_sub_if': u't2s2if', u'tenant_ns_name': u't2'}], u'subnet_ip': u'2.2.2.0/24', u'vms': [{u'mem': 3, u'name': u't2_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't2br2if1', u'vmif': u't2VM3if1'}]}, {u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}])  => {"ansible_loop_var": "item", "changed": false, "item": [{"bridge_name": "t2br2", "default_route_ip": "10.1.12.1", "dns": [{"brif": "t2s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t2s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns2", "route": [{"if": "p1", "ip": "10.1.12.1/24", "ns_if": "t2if", "ns_name": "t2"}], "subnet_ip": "2.2.2.0/24", "tenant_ns": [{"tenant_ns_if": "t2ns2if", "tenant_ns_ip": "10.1.12.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s2if", "tenant_sub_ip": "10.1.12.2/24"}], "vms": [{"brif": "t2br2if1", "disk": "10G", "mem": 3, "name": "t2_VM3", "vcpu": 2, "vmif": "t2VM3if1"}]}, {"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}], "skip_reason": "Conditional result was False"}

PLAY RECAP **************************************************************************************************************************************************
localhost                  : ok=21   changed=21   unreachable=0    failed=0    skipped=0    rescued=0    ignored=0   

Using /etc/ansible/ansible.cfg as config file

PLAY [worker] ***********************************************************************************************************************************************

TASK [Create Tenant Namespace] ******************************************************************************************************************************
changed: [99.99.99.2] => (item={u'default_route_ip': u'192.168.130.1', u'name': u't2', u'pns_ip': u'192.168.130.1/24', u'tenant_if': u't2if', u'tenant_ip': u'192.168.130.2/24', u'pns_if': u't2pns_if'}) => {"ansible_loop_var": "item", "changed": true, "cmd": ["ip", "netns", "add", "t2"], "delta": "0:00:00.072656", "end": "2019-11-18 00:24:44.767871", "item": {"default_route_ip": "192.168.130.1", "name": "t2", "pns_if": "t2pns_if", "pns_ip": "192.168.130.1/24", "tenant_if": "t2if", "tenant_ip": "192.168.130.2/24"}, "rc": 0, "start": "2019-11-18 00:24:44.695215", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Create Subnet Namespace] ******************************************************************************************************************************
changed: [99.99.99.2] => (item={u'route': [{u'ip': u'10.2.11.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.2.11.1', u'bridge_name': u't2br1', u'dns': [{u'dnsif': u't2s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't2s1_dnsbrif'}], u'ns_name': u't2ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.11.2/24', u'tenant_ns_ip': u'10.2.11.1/24', u'tenant_ns_if': u't2ns1if', u'tenant_ns_name': u't2', u'tenant_sub_if': u't2s1if'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't2_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't2br1if1', u'vmif': u't2VM4if1'}], u'vxlan': [{u'local_ip': u'10.2.11.2', u'tenant_route_ip': u'192.168.130.2', u'dsport': 4789, u'dev': u't2s1if', u'subnet_route': u'10.2.11.0/24', u'remote_route': u'10.1.11.0/24', u'v_name': u'vxlan_t2s1', u'id': 42, u'remote_ip': u'10.1.11.2'}]}) => {"ansible_loop_var": "item", "changed": true, "cmd": ["ip", "netns", "add", "t2ns1"], "delta": "0:00:00.064870", "end": "2019-11-18 00:24:47.438674", "item": {"bridge_name": "t2br1", "default_route_ip": "10.2.11.1", "dns": [{"brif": "t2s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t2s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns1", "route": [{"if": "p1", "ip": "10.2.11.1/24", "ns_if": "t2if", "ns_name": "t2"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t2ns1if", "tenant_ns_ip": "10.2.11.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s1if", "tenant_sub_ip": "10.2.11.2/24"}], "vms": [{"brif": "t2br1if1", "disk": "10G", "mem": 2, "name": "t2_VM4", "vcpu": 4, "vmif": "t2VM4if1"}], "vxlan": [{"dev": "t2s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.11.2", "remote_ip": "10.1.11.2", "remote_route": "10.1.11.0/24", "subnet_route": "10.2.11.0/24", "tenant_route_ip": "192.168.130.2", "v_name": "vxlan_t2s1"}]}, "rc": 0, "start": "2019-11-18 00:24:47.373804", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Create Tenant VETH pairs] *****************************************************************************************************************************
changed: [99.99.99.2] => (item={u'default_route_ip': u'192.168.130.1', u'name': u't2', u'pns_ip': u'192.168.130.1/24', u'tenant_if': u't2if', u'tenant_ip': u'192.168.130.2/24', u'pns_if': u't2pns_if'}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip link show \"t2if\" ; if [ $? -ne 0 ] ; then ip link add \"t2if\" type veth peer name \"t2pns_if\" ; fi\n", "delta": "0:00:00.011075", "end": "2019-11-18 00:24:47.881452", "item": {"default_route_ip": "192.168.130.1", "name": "t2", "pns_if": "t2pns_if", "pns_ip": "192.168.130.1/24", "tenant_if": "t2if", "tenant_ip": "192.168.130.2/24"}, "rc": 0, "start": "2019-11-18 00:24:47.870377", "stderr": "Device \"t2if\" does not exist.", "stderr_lines": ["Device \"t2if\" does not exist."], "stdout": "", "stdout_lines": []}

TASK [Attach Tenant VETH Pairs] *****************************************************************************************************************************
changed: [99.99.99.2] => (item={u'default_route_ip': u'192.168.130.1', u'name': u't2', u'pns_ip': u'192.168.130.1/24', u'tenant_if': u't2if', u'tenant_ip': u'192.168.130.2/24', u'pns_if': u't2pns_if'}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec pns ip link show \"t2pns_if\" ; if [ $? -ne 0 ] ; then ip link set \"t2pns_if\" netns pns ; fi\nip netns exec \"t2\" ip link show \"t2if\" ; if [ $? -ne 0 ] ; then ip link set \"t2if\" netns \"t2\" ; fi\nip netns exec pns ip link set dev \"t2pns_if\" up\nip netns exec \"t2\" ip link set dev \"t2if\" up\n", "delta": "0:00:00.201179", "end": "2019-11-18 00:24:49.388172", "item": {"default_route_ip": "192.168.130.1", "name": "t2", "pns_if": "t2pns_if", "pns_ip": "192.168.130.1/24", "tenant_if": "t2if", "tenant_ip": "192.168.130.2/24"}, "rc": 0, "start": "2019-11-18 00:24:49.186993", "stderr": "Device \"t2pns_if\" does not exist.\nDevice \"t2if\" does not exist.", "stderr_lines": ["Device \"t2pns_if\" does not exist.", "Device \"t2if\" does not exist."], "stdout": "", "stdout_lines": []}

TASK [Add IP addresses to Tenant VETH Pairs] ****************************************************************************************************************
changed: [99.99.99.2] => (item={u'default_route_ip': u'192.168.130.1', u'name': u't2', u'pns_ip': u'192.168.130.1/24', u'tenant_if': u't2if', u'tenant_ip': u'192.168.130.2/24', u'pns_if': u't2pns_if'}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec pns ip addr show \"t2pns_if\" | awk 'FNR==3{ print $2 }' | grep -w '^192.168.130.1/24' ; if [ $? -ne 0 ] ; then ip netns exec pns ip addr add \"192.168.130.1/24\" dev \"t2pns_if\" ; fi\nip netns exec \"t2\" ip addr show \"t2if\" | awk 'FNR==3{ print $2 }' | grep -w '^192.168.130.2/24' ; if [ $? -ne 0 ] ; then ip netns exec \"t2\" ip addr add \"192.168.130.2/24\" dev \"t2if\" ; fi\n", "delta": "0:00:00.139793", "end": "2019-11-18 00:24:52.744197", "item": {"default_route_ip": "192.168.130.1", "name": "t2", "pns_if": "t2pns_if", "pns_ip": "192.168.130.1/24", "tenant_if": "t2if", "tenant_ip": "192.168.130.2/24"}, "rc": 0, "start": "2019-11-18 00:24:52.604404", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Create Namespace VETH Pairs] **************************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.11.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.2.11.1', u'bridge_name': u't2br1', u'dns': [{u'dnsif': u't2s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't2s1_dnsbrif'}], u'ns_name': u't2ns1', u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't2_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't2br1if1', u'vmif': u't2VM4if1'}], u'vxlan': [{u'local_ip': u'10.2.11.2', u'dsport': 4789, u'dev': u't2s1if', u'tenant_route_ip': u'192.168.130.2', u'remote_route': u'10.1.11.0/24', u'subnet_route': u'10.2.11.0/24', u'v_name': u'vxlan_t2s1', u'id': 42, u'remote_ip': u'10.1.11.2'}]}, {u'tenant_sub_ip': u'10.2.11.2/24', u'tenant_ns_ip': u'10.2.11.1/24', u'tenant_ns_if': u't2ns1if', u'tenant_sub_if': u't2s1if', u'tenant_ns_name': u't2'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip link show \"t2ns1if\" ; if [ $? -ne 0 ] ; then ip link add \"t2ns1if\" type veth peer name \"t2s1if\" ; fi\n", "delta": "0:00:00.010019", "end": "2019-11-18 00:24:54.735676", "item": [{"bridge_name": "t2br1", "default_route_ip": "10.2.11.1", "dns": [{"brif": "t2s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t2s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns1", "route": [{"if": "p1", "ip": "10.2.11.1/24", "ns_if": "t2if", "ns_name": "t2"}], "subnet_ip": "1.1.1.0/24", "vms": [{"brif": "t2br1if1", "disk": "10G", "mem": 2, "name": "t2_VM4", "vcpu": 4, "vmif": "t2VM4if1"}], "vxlan": [{"dev": "t2s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.11.2", "remote_ip": "10.1.11.2", "remote_route": "10.1.11.0/24", "subnet_route": "10.2.11.0/24", "tenant_route_ip": "192.168.130.2", "v_name": "vxlan_t2s1"}]}, {"tenant_ns_if": "t2ns1if", "tenant_ns_ip": "10.2.11.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s1if", "tenant_sub_ip": "10.2.11.2/24"}], "rc": 0, "start": "2019-11-18 00:24:54.725657", "stderr": "Device \"t2ns1if\" does not exist.", "stderr_lines": ["Device \"t2ns1if\" does not exist."], "stdout": "", "stdout_lines": []}

TASK [Attach Namespace VETH Pairs] **************************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.11.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.2.11.1', u'bridge_name': u't2br1', u'dns': [{u'dnsif': u't2s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't2s1_dnsbrif'}], u'ns_name': u't2ns1', u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't2_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't2br1if1', u'vmif': u't2VM4if1'}], u'vxlan': [{u'local_ip': u'10.2.11.2', u'dsport': 4789, u'dev': u't2s1if', u'tenant_route_ip': u'192.168.130.2', u'remote_route': u'10.1.11.0/24', u'subnet_route': u'10.2.11.0/24', u'v_name': u'vxlan_t2s1', u'id': 42, u'remote_ip': u'10.1.11.2'}]}, {u'tenant_sub_ip': u'10.2.11.2/24', u'tenant_ns_ip': u'10.2.11.1/24', u'tenant_ns_if': u't2ns1if', u'tenant_sub_if': u't2s1if', u'tenant_ns_name': u't2'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t2\" ip link show \"t2ns1if\" ; if [ $? -ne 0 ] ; then ip link set \"t2ns1if\" netns \"t2\" ; fi\nip netns exec \"t2ns1\" ip link show \"t2s1if\" ; if [ $? -ne 0 ] ; then ip link set \"t2s1if\" netns \"t2ns1\" ; fi\n", "delta": "0:00:00.129984", "end": "2019-11-18 00:24:57.002419", "item": [{"bridge_name": "t2br1", "default_route_ip": "10.2.11.1", "dns": [{"brif": "t2s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t2s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns1", "route": [{"if": "p1", "ip": "10.2.11.1/24", "ns_if": "t2if", "ns_name": "t2"}], "subnet_ip": "1.1.1.0/24", "vms": [{"brif": "t2br1if1", "disk": "10G", "mem": 2, "name": "t2_VM4", "vcpu": 4, "vmif": "t2VM4if1"}], "vxlan": [{"dev": "t2s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.11.2", "remote_ip": "10.1.11.2", "remote_route": "10.1.11.0/24", "subnet_route": "10.2.11.0/24", "tenant_route_ip": "192.168.130.2", "v_name": "vxlan_t2s1"}]}, {"tenant_ns_if": "t2ns1if", "tenant_ns_ip": "10.2.11.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s1if", "tenant_sub_ip": "10.2.11.2/24"}], "rc": 0, "start": "2019-11-18 00:24:56.872435", "stderr": "Device \"t2ns1if\" does not exist.\nDevice \"t2s1if\" does not exist.", "stderr_lines": ["Device \"t2ns1if\" does not exist.", "Device \"t2s1if\" does not exist."], "stdout": "", "stdout_lines": []}

TASK [Set Namespace VETH Pairs UP] **************************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.11.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.2.11.1', u'bridge_name': u't2br1', u'dns': [{u'dnsif': u't2s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't2s1_dnsbrif'}], u'ns_name': u't2ns1', u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't2_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't2br1if1', u'vmif': u't2VM4if1'}], u'vxlan': [{u'local_ip': u'10.2.11.2', u'dsport': 4789, u'dev': u't2s1if', u'tenant_route_ip': u'192.168.130.2', u'remote_route': u'10.1.11.0/24', u'subnet_route': u'10.2.11.0/24', u'v_name': u'vxlan_t2s1', u'id': 42, u'remote_ip': u'10.1.11.2'}]}, {u'tenant_sub_ip': u'10.2.11.2/24', u'tenant_ns_ip': u'10.2.11.1/24', u'tenant_ns_if': u't2ns1if', u'tenant_sub_if': u't2s1if', u'tenant_ns_name': u't2'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t2\" ip link set dev \"t2ns1if\" up\nip netns exec \"t2ns1\" ip link set dev \"t2s1if\" up\n", "delta": "0:00:00.089560", "end": "2019-11-18 00:25:00.136268", "item": [{"bridge_name": "t2br1", "default_route_ip": "10.2.11.1", "dns": [{"brif": "t2s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t2s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns1", "route": [{"if": "p1", "ip": "10.2.11.1/24", "ns_if": "t2if", "ns_name": "t2"}], "subnet_ip": "1.1.1.0/24", "vms": [{"brif": "t2br1if1", "disk": "10G", "mem": 2, "name": "t2_VM4", "vcpu": 4, "vmif": "t2VM4if1"}], "vxlan": [{"dev": "t2s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.11.2", "remote_ip": "10.1.11.2", "remote_route": "10.1.11.0/24", "subnet_route": "10.2.11.0/24", "tenant_route_ip": "192.168.130.2", "v_name": "vxlan_t2s1"}]}, {"tenant_ns_if": "t2ns1if", "tenant_ns_ip": "10.2.11.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s1if", "tenant_sub_ip": "10.2.11.2/24"}], "rc": 0, "start": "2019-11-18 00:25:00.046708", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Add IP addresses to Namespace VETH Pairs] *************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.11.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.2.11.1', u'bridge_name': u't2br1', u'dns': [{u'dnsif': u't2s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't2s1_dnsbrif'}], u'ns_name': u't2ns1', u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't2_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't2br1if1', u'vmif': u't2VM4if1'}], u'vxlan': [{u'local_ip': u'10.2.11.2', u'dsport': 4789, u'dev': u't2s1if', u'tenant_route_ip': u'192.168.130.2', u'remote_route': u'10.1.11.0/24', u'subnet_route': u'10.2.11.0/24', u'v_name': u'vxlan_t2s1', u'id': 42, u'remote_ip': u'10.1.11.2'}]}, {u'tenant_sub_ip': u'10.2.11.2/24', u'tenant_ns_ip': u'10.2.11.1/24', u'tenant_ns_if': u't2ns1if', u'tenant_sub_if': u't2s1if', u'tenant_ns_name': u't2'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t2ns1\" ip addr show \"t2s1if\" | awk 'FNR==3{ print $2 }' | grep -w '^10.2.11.2/24' ; if [ $? -ne 0 ] ; then ip netns exec \"t2ns1\" ip addr add \"10.2.11.2/24\" dev \"t2s1if\" ; fi\n\nip netns exec \"t2\" ip addr show \"t2ns1if\" | awk 'FNR==3{ print $2 }' | grep -w '^10.2.11.1/24' ; if [ $? -ne 0 ] ; then ip netns exec \"t2\" ip addr add \"10.2.11.1/24\" dev \"t2ns1if\" ; fi\n", "delta": "0:00:00.148456", "end": "2019-11-18 00:25:03.404185", "item": [{"bridge_name": "t2br1", "default_route_ip": "10.2.11.1", "dns": [{"brif": "t2s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t2s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns1", "route": [{"if": "p1", "ip": "10.2.11.1/24", "ns_if": "t2if", "ns_name": "t2"}], "subnet_ip": "1.1.1.0/24", "vms": [{"brif": "t2br1if1", "disk": "10G", "mem": 2, "name": "t2_VM4", "vcpu": 4, "vmif": "t2VM4if1"}], "vxlan": [{"dev": "t2s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.11.2", "remote_ip": "10.1.11.2", "remote_route": "10.1.11.0/24", "subnet_route": "10.2.11.0/24", "tenant_route_ip": "192.168.130.2", "v_name": "vxlan_t2s1"}]}, {"tenant_ns_if": "t2ns1if", "tenant_ns_ip": "10.2.11.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s1if", "tenant_sub_ip": "10.2.11.2/24"}], "rc": 0, "start": "2019-11-18 00:25:03.255729", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Add IP Route to Tenant] *******************************************************************************************************************************
changed: [99.99.99.2] => (item={u'default_route_ip': u'192.168.130.1', u'name': u't2', u'pns_ip': u'192.168.130.1/24', u'tenant_if': u't2if', u'tenant_ip': u'192.168.130.2/24', u'pns_if': u't2pns_if'}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t2\" ip route show default | grep -w '[d]efault via 192.168.130.1' ; if [ $? -ne 0 ] ; then ip netns exec \"t2\" ip route add default via \"192.168.130.1\" ; fi\n", "delta": "0:00:00.092000", "end": "2019-11-18 00:25:04.128334", "item": {"default_route_ip": "192.168.130.1", "name": "t2", "pns_if": "t2pns_if", "pns_ip": "192.168.130.1/24", "tenant_if": "t2if", "tenant_ip": "192.168.130.2/24"}, "rc": 0, "start": "2019-11-18 00:25:04.036334", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Add IP Route to Tenant Subnet] ************************************************************************************************************************
changed: [99.99.99.2] => (item={u'route': [{u'ip': u'10.2.11.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.2.11.1', u'bridge_name': u't2br1', u'dns': [{u'dnsif': u't2s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't2s1_dnsbrif'}], u'ns_name': u't2ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.11.2/24', u'tenant_ns_ip': u'10.2.11.1/24', u'tenant_ns_if': u't2ns1if', u'tenant_ns_name': u't2', u'tenant_sub_if': u't2s1if'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't2_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't2br1if1', u'vmif': u't2VM4if1'}], u'vxlan': [{u'local_ip': u'10.2.11.2', u'tenant_route_ip': u'192.168.130.2', u'dsport': 4789, u'dev': u't2s1if', u'subnet_route': u'10.2.11.0/24', u'remote_route': u'10.1.11.0/24', u'v_name': u'vxlan_t2s1', u'id': 42, u'remote_ip': u'10.1.11.2'}]}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t2ns1\" ip route show default | grep -w '[d]efault via 10.2.11.1' ; if [ $? -ne 0 ] ; then ip netns exec \"t2ns1\" ip route add default via \"10.2.11.1\" ; fi\n", "delta": "0:00:00.100684", "end": "2019-11-18 00:25:04.752374", "item": {"bridge_name": "t2br1", "default_route_ip": "10.2.11.1", "dns": [{"brif": "t2s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t2s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns1", "route": [{"if": "p1", "ip": "10.2.11.1/24", "ns_if": "t2if", "ns_name": "t2"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t2ns1if", "tenant_ns_ip": "10.2.11.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s1if", "tenant_sub_ip": "10.2.11.2/24"}], "vms": [{"brif": "t2br1if1", "disk": "10G", "mem": 2, "name": "t2_VM4", "vcpu": 4, "vmif": "t2VM4if1"}], "vxlan": [{"dev": "t2s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.11.2", "remote_ip": "10.1.11.2", "remote_route": "10.1.11.0/24", "subnet_route": "10.2.11.0/24", "tenant_route_ip": "192.168.130.2", "v_name": "vxlan_t2s1"}]}, "rc": 0, "start": "2019-11-18 00:25:04.651690", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Create bridge inside namespace] ***********************************************************************************************************************
changed: [99.99.99.2] => (item={u'route': [{u'ip': u'10.2.11.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.2.11.1', u'bridge_name': u't2br1', u'dns': [{u'dnsif': u't2s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't2s1_dnsbrif'}], u'ns_name': u't2ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.11.2/24', u'tenant_ns_ip': u'10.2.11.1/24', u'tenant_ns_if': u't2ns1if', u'tenant_ns_name': u't2', u'tenant_sub_if': u't2s1if'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't2_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't2br1if1', u'vmif': u't2VM4if1'}], u'vxlan': [{u'local_ip': u'10.2.11.2', u'tenant_route_ip': u'192.168.130.2', u'dsport': 4789, u'dev': u't2s1if', u'subnet_route': u'10.2.11.0/24', u'remote_route': u'10.1.11.0/24', u'v_name': u'vxlan_t2s1', u'id': 42, u'remote_ip': u'10.1.11.2'}]}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t2ns1\" brctl show | grep -w '^t2br1'; if [ $? -ne 0 ] ; then ip netns exec \"t2ns1\" brctl addbr \"t2br1\" ; fi\nip netns exec \"t2ns1\" ip link set dev \"t2br1\" up\n", "delta": "0:00:00.128136", "end": "2019-11-18 00:25:05.284147", "item": {"bridge_name": "t2br1", "default_route_ip": "10.2.11.1", "dns": [{"brif": "t2s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t2s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns1", "route": [{"if": "p1", "ip": "10.2.11.1/24", "ns_if": "t2if", "ns_name": "t2"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t2ns1if", "tenant_ns_ip": "10.2.11.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s1if", "tenant_sub_ip": "10.2.11.2/24"}], "vms": [{"brif": "t2br1if1", "disk": "10G", "mem": 2, "name": "t2_VM4", "vcpu": 4, "vmif": "t2VM4if1"}], "vxlan": [{"dev": "t2s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.11.2", "remote_ip": "10.1.11.2", "remote_route": "10.1.11.0/24", "subnet_route": "10.2.11.0/24", "tenant_route_ip": "192.168.130.2", "v_name": "vxlan_t2s1"}]}, "rc": 0, "start": "2019-11-18 00:25:05.156011", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Create DNS VETH Pair] *********************************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.11.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.2.11.1', u'bridge_name': u't2br1', u'ns_name': u't2ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.11.2/24', u'tenant_ns_ip': u'10.2.11.1/24', u'tenant_ns_if': u't2ns1if', u'tenant_sub_if': u't2s1if', u'tenant_ns_name': u't2'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't2_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't2br1if1', u'vmif': u't2VM4if1'}], u'vxlan': [{u'local_ip': u'10.2.11.2', u'dsport': 4789, u'dev': u't2s1if', u'tenant_route_ip': u'192.168.130.2', u'remote_route': u'10.1.11.0/24', u'subnet_route': u'10.2.11.0/24', u'v_name': u'vxlan_t2s1', u'id': 42, u'remote_ip': u'10.1.11.2'}]}, {u'dnsif': u't2s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't2s1_dnsbrif'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t2ns1\" ip link show \"t2s1_dnsbrif\" ; if [ $? -ne 0 ] ; then ip netns exec \"t2ns1\" ip link add \"t2s1_dnsbrif\" type veth peer name \"t2s1_dnsif\" ; fi\nip netns exec \"t2ns1\" ip link set dev \"t2s1_dnsbrif\" up\nip netns exec \"t2ns1\" ip link set dev \"t2s1_dnsif\" up\n", "delta": "0:00:00.225545", "end": "2019-11-18 00:25:05.880143", "item": [{"bridge_name": "t2br1", "default_route_ip": "10.2.11.1", "ns_name": "t2ns1", "route": [{"if": "p1", "ip": "10.2.11.1/24", "ns_if": "t2if", "ns_name": "t2"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t2ns1if", "tenant_ns_ip": "10.2.11.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s1if", "tenant_sub_ip": "10.2.11.2/24"}], "vms": [{"brif": "t2br1if1", "disk": "10G", "mem": 2, "name": "t2_VM4", "vcpu": 4, "vmif": "t2VM4if1"}], "vxlan": [{"dev": "t2s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.11.2", "remote_ip": "10.1.11.2", "remote_route": "10.1.11.0/24", "subnet_route": "10.2.11.0/24", "tenant_route_ip": "192.168.130.2", "v_name": "vxlan_t2s1"}]}, {"brif": "t2s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t2s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "rc": 0, "start": "2019-11-18 00:25:05.654598", "stderr": "Device \"t2s1_dnsbrif\" does not exist.", "stderr_lines": ["Device \"t2s1_dnsbrif\" does not exist."], "stdout": "", "stdout_lines": []}

TASK [Attach DNS VETH Pair] *********************************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.11.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.2.11.1', u'bridge_name': u't2br1', u'ns_name': u't2ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.11.2/24', u'tenant_ns_ip': u'10.2.11.1/24', u'tenant_ns_if': u't2ns1if', u'tenant_sub_if': u't2s1if', u'tenant_ns_name': u't2'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't2_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't2br1if1', u'vmif': u't2VM4if1'}], u'vxlan': [{u'local_ip': u'10.2.11.2', u'dsport': 4789, u'dev': u't2s1if', u'tenant_route_ip': u'192.168.130.2', u'remote_route': u'10.1.11.0/24', u'subnet_route': u'10.2.11.0/24', u'v_name': u'vxlan_t2s1', u'id': 42, u'remote_ip': u'10.1.11.2'}]}, {u'dnsif': u't2s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't2s1_dnsbrif'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t2ns1\" brctl show \"t2br1\" | grep -w 't2s1_dnsbrif' ; if [ $? -ne 0 ] ; then ip netns exec \"t2ns1\" brctl addif \"t2br1\" \"t2s1_dnsbrif\" ; fi\n", "delta": "0:00:00.084499", "end": "2019-11-18 00:25:06.340201", "item": [{"bridge_name": "t2br1", "default_route_ip": "10.2.11.1", "ns_name": "t2ns1", "route": [{"if": "p1", "ip": "10.2.11.1/24", "ns_if": "t2if", "ns_name": "t2"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t2ns1if", "tenant_ns_ip": "10.2.11.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s1if", "tenant_sub_ip": "10.2.11.2/24"}], "vms": [{"brif": "t2br1if1", "disk": "10G", "mem": 2, "name": "t2_VM4", "vcpu": 4, "vmif": "t2VM4if1"}], "vxlan": [{"dev": "t2s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.11.2", "remote_ip": "10.1.11.2", "remote_route": "10.1.11.0/24", "subnet_route": "10.2.11.0/24", "tenant_route_ip": "192.168.130.2", "v_name": "vxlan_t2s1"}]}, {"brif": "t2s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t2s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "rc": 0, "start": "2019-11-18 00:25:06.255702", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Create VETH Pairs] ************************************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.11.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.2.11.1', u'bridge_name': u't2br1', u'dns': [{u'dnsif': u't2s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't2s1_dnsbrif'}], u'ns_name': u't2ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.11.2/24', u'tenant_ns_ip': u'10.2.11.1/24', u'tenant_ns_if': u't2ns1if', u'tenant_sub_if': u't2s1if', u'tenant_ns_name': u't2'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.2.11.2', u'dsport': 4789, u'dev': u't2s1if', u'tenant_route_ip': u'192.168.130.2', u'remote_route': u'10.1.11.0/24', u'subnet_route': u'10.2.11.0/24', u'v_name': u'vxlan_t2s1', u'id': 42, u'remote_ip': u'10.1.11.2'}]}, {u'mem': 2, u'name': u't2_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't2br1if1', u'vmif': u't2VM4if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip link show \"t2br1if1\" ; if [ $? -ne 0 ] ; then ip link add \"t2VM4if1\" type veth peer name \"t2br1if1\" ; fi\nip link set dev \"t2br1if1\" up\nip link set dev \"t2VM4if1\" up\n", "delta": "0:00:00.020308", "end": "2019-11-18 00:25:06.766688", "item": [{"bridge_name": "t2br1", "default_route_ip": "10.2.11.1", "dns": [{"brif": "t2s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t2s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns1", "route": [{"if": "p1", "ip": "10.2.11.1/24", "ns_if": "t2if", "ns_name": "t2"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t2ns1if", "tenant_ns_ip": "10.2.11.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s1if", "tenant_sub_ip": "10.2.11.2/24"}], "vxlan": [{"dev": "t2s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.11.2", "remote_ip": "10.1.11.2", "remote_route": "10.1.11.0/24", "subnet_route": "10.2.11.0/24", "tenant_route_ip": "192.168.130.2", "v_name": "vxlan_t2s1"}]}, {"brif": "t2br1if1", "disk": "10G", "mem": 2, "name": "t2_VM4", "vcpu": 4, "vmif": "t2VM4if1"}], "rc": 0, "start": "2019-11-18 00:25:06.746380", "stderr": "Device \"t2br1if1\" does not exist.", "stderr_lines": ["Device \"t2br1if1\" does not exist."], "stdout": "", "stdout_lines": []}

TASK [Attach VETH Pairs] ************************************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.11.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.2.11.1', u'bridge_name': u't2br1', u'dns': [{u'dnsif': u't2s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't2s1_dnsbrif'}], u'ns_name': u't2ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.11.2/24', u'tenant_ns_ip': u'10.2.11.1/24', u'tenant_ns_if': u't2ns1if', u'tenant_sub_if': u't2s1if', u'tenant_ns_name': u't2'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.2.11.2', u'dsport': 4789, u'dev': u't2s1if', u'tenant_route_ip': u'192.168.130.2', u'remote_route': u'10.1.11.0/24', u'subnet_route': u'10.2.11.0/24', u'v_name': u'vxlan_t2s1', u'id': 42, u'remote_ip': u'10.1.11.2'}]}, {u'mem': 2, u'name': u't2_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't2br1if1', u'vmif': u't2VM4if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip link show \"t2br1if1\" ; if [ $? -eq 0 ] ; then ip link set \"t2br1if1\" netns \"t2ns1\" ; fi\nip netns exec \"t2ns1\" brctl show \"t2br1\" | grep -w 't2br1if1' ; if [ $? -ne 0 ] ; then ip netns exec \"t2ns1\" brctl addif \"t2br1\" \"t2br1if1\" ; fi\n", "delta": "0:00:00.139099", "end": "2019-11-18 00:25:07.268196", "item": [{"bridge_name": "t2br1", "default_route_ip": "10.2.11.1", "dns": [{"brif": "t2s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t2s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns1", "route": [{"if": "p1", "ip": "10.2.11.1/24", "ns_if": "t2if", "ns_name": "t2"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t2ns1if", "tenant_ns_ip": "10.2.11.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s1if", "tenant_sub_ip": "10.2.11.2/24"}], "vxlan": [{"dev": "t2s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.11.2", "remote_ip": "10.1.11.2", "remote_route": "10.1.11.0/24", "subnet_route": "10.2.11.0/24", "tenant_route_ip": "192.168.130.2", "v_name": "vxlan_t2s1"}]}, {"brif": "t2br1if1", "disk": "10G", "mem": 2, "name": "t2_VM4", "vcpu": 4, "vmif": "t2VM4if1"}], "rc": 0, "start": "2019-11-18 00:25:07.129097", "stderr": "", "stderr_lines": [], "stdout": "25: t2br1if1@t2VM4if1: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP mode DEFAULT group default qlen 1000\n    link/ether e6:62:f1:57:b0:99 brd ff:ff:ff:ff:ff:ff", "stdout_lines": ["25: t2br1if1@t2VM4if1: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP mode DEFAULT group default qlen 1000", "    link/ether e6:62:f1:57:b0:99 brd ff:ff:ff:ff:ff:ff"]}

TASK [All interfaces and bridges UP] ************************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.11.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.2.11.1', u'bridge_name': u't2br1', u'dns': [{u'dnsif': u't2s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't2s1_dnsbrif'}], u'ns_name': u't2ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.11.2/24', u'tenant_ns_ip': u'10.2.11.1/24', u'tenant_ns_if': u't2ns1if', u'tenant_sub_if': u't2s1if', u'tenant_ns_name': u't2'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.2.11.2', u'dsport': 4789, u'dev': u't2s1if', u'tenant_route_ip': u'192.168.130.2', u'remote_route': u'10.1.11.0/24', u'subnet_route': u'10.2.11.0/24', u'v_name': u'vxlan_t2s1', u'id': 42, u'remote_ip': u'10.1.11.2'}]}, {u'mem': 2, u'name': u't2_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't2br1if1', u'vmif': u't2VM4if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t2ns1\" ip link set \"t2br1if1\" up\nip netns exec \"t2ns1\" ip link set dev \"t2br1\" up\n", "delta": "0:00:00.081019", "end": "2019-11-18 00:25:07.764175", "item": [{"bridge_name": "t2br1", "default_route_ip": "10.2.11.1", "dns": [{"brif": "t2s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t2s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns1", "route": [{"if": "p1", "ip": "10.2.11.1/24", "ns_if": "t2if", "ns_name": "t2"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t2ns1if", "tenant_ns_ip": "10.2.11.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s1if", "tenant_sub_ip": "10.2.11.2/24"}], "vxlan": [{"dev": "t2s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.11.2", "remote_ip": "10.1.11.2", "remote_route": "10.1.11.0/24", "subnet_route": "10.2.11.0/24", "tenant_route_ip": "192.168.130.2", "v_name": "vxlan_t2s1"}]}, {"brif": "t2br1if1", "disk": "10G", "mem": 2, "name": "t2_VM4", "vcpu": 4, "vmif": "t2VM4if1"}], "rc": 0, "start": "2019-11-18 00:25:07.683156", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Add IP to DNS Interface] ******************************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.11.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.2.11.1', u'bridge_name': u't2br1', u'ns_name': u't2ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.11.2/24', u'tenant_ns_ip': u'10.2.11.1/24', u'tenant_ns_if': u't2ns1if', u'tenant_sub_if': u't2s1if', u'tenant_ns_name': u't2'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't2_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't2br1if1', u'vmif': u't2VM4if1'}], u'vxlan': [{u'local_ip': u'10.2.11.2', u'dsport': 4789, u'dev': u't2s1if', u'tenant_route_ip': u'192.168.130.2', u'remote_route': u'10.1.11.0/24', u'subnet_route': u'10.2.11.0/24', u'v_name': u'vxlan_t2s1', u'id': 42, u'remote_ip': u'10.1.11.2'}]}, {u'dnsif': u't2s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't2s1_dnsbrif'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t2ns1\" ip addr show \"t2s1_dnsif\" | awk 'FNR==3{ print $2}'| grep -w '^1.1.1.128/24' ; if [ $? -ne 0 ] ; then ip netns exec \"t2ns1\" ip addr add \"1.1.1.128/24\" dev \"t2s1_dnsif\" ; fi\n", "delta": "0:00:00.072261", "end": "2019-11-18 00:25:08.220212", "item": [{"bridge_name": "t2br1", "default_route_ip": "10.2.11.1", "ns_name": "t2ns1", "route": [{"if": "p1", "ip": "10.2.11.1/24", "ns_if": "t2if", "ns_name": "t2"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t2ns1if", "tenant_ns_ip": "10.2.11.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s1if", "tenant_sub_ip": "10.2.11.2/24"}], "vms": [{"brif": "t2br1if1", "disk": "10G", "mem": 2, "name": "t2_VM4", "vcpu": 4, "vmif": "t2VM4if1"}], "vxlan": [{"dev": "t2s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.11.2", "remote_ip": "10.1.11.2", "remote_route": "10.1.11.0/24", "subnet_route": "10.2.11.0/24", "tenant_route_ip": "192.168.130.2", "v_name": "vxlan_t2s1"}]}, {"brif": "t2s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t2s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "rc": 0, "start": "2019-11-18 00:25:08.147951", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Install DHCP Server] **********************************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.11.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.2.11.1', u'bridge_name': u't2br1', u'ns_name': u't2ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.11.2/24', u'tenant_ns_ip': u'10.2.11.1/24', u'tenant_ns_if': u't2ns1if', u'tenant_sub_if': u't2s1if', u'tenant_ns_name': u't2'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't2_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't2br1if1', u'vmif': u't2VM4if1'}], u'vxlan': [{u'local_ip': u'10.2.11.2', u'dsport': 4789, u'dev': u't2s1if', u'tenant_route_ip': u'192.168.130.2', u'remote_route': u'10.1.11.0/24', u'subnet_route': u'10.2.11.0/24', u'v_name': u'vxlan_t2s1', u'id': 42, u'remote_ip': u'10.1.11.2'}]}, {u'dnsif': u't2s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't2s1_dnsbrif'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t2ns1\" ps aux | grep -w '[d]nsmasq --interface t2s1_dnsif -z --dhcp-range=1.1.1.133,1.1.1.254' ; if [ $? -ne 0 ] ; then ip netns exec \"t2ns1\" dnsmasq --interface \"t2s1_dnsif\" -z --dhcp-range=1.1.1.133,'1.1.1.254' ; fi\n", "delta": "0:00:00.104077", "end": "2019-11-18 00:25:08.683206", "item": [{"bridge_name": "t2br1", "default_route_ip": "10.2.11.1", "ns_name": "t2ns1", "route": [{"if": "p1", "ip": "10.2.11.1/24", "ns_if": "t2if", "ns_name": "t2"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t2ns1if", "tenant_ns_ip": "10.2.11.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s1if", "tenant_sub_ip": "10.2.11.2/24"}], "vms": [{"brif": "t2br1if1", "disk": "10G", "mem": 2, "name": "t2_VM4", "vcpu": 4, "vmif": "t2VM4if1"}], "vxlan": [{"dev": "t2s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.11.2", "remote_ip": "10.1.11.2", "remote_route": "10.1.11.0/24", "subnet_route": "10.2.11.0/24", "tenant_route_ip": "192.168.130.2", "v_name": "vxlan_t2s1"}]}, {"brif": "t2s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t2s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "rc": 0, "start": "2019-11-18 00:25:08.579129", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Create VXLAN devices] *********************************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.11.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.2.11.1', u'bridge_name': u't2br1', u'dns': [{u'dnsif': u't2s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't2s1_dnsbrif'}], u'ns_name': u't2ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.11.2/24', u'tenant_ns_ip': u'10.2.11.1/24', u'tenant_ns_if': u't2ns1if', u'tenant_sub_if': u't2s1if', u'tenant_ns_name': u't2'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't2_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't2br1if1', u'vmif': u't2VM4if1'}]}, {u'local_ip': u'10.2.11.2', u'dsport': 4789, u'dev': u't2s1if', u'tenant_route_ip': u'192.168.130.2', u'remote_route': u'10.1.11.0/24', u'subnet_route': u'10.2.11.0/24', u'v_name': u'vxlan_t2s1', u'id': 42, u'remote_ip': u'10.1.11.2'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t2ns1\" ip link show \"vxlan_t2s1\" ; if [ $? -ne 0 ] ; then ip netns exec \"t2ns1\" ip link add \"vxlan_t2s1\" type vxlan id \"42\" local \"10.2.11.2\" remote \"10.1.11.2\" dstport \"4789\" dev \"t2s1if\" ; ip netns exec \"t2ns1\" ip link set dev \"vxlan_t2s1\" up ; fi\n", "delta": "0:00:00.147857", "end": "2019-11-18 00:25:09.256131", "item": [{"bridge_name": "t2br1", "default_route_ip": "10.2.11.1", "dns": [{"brif": "t2s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t2s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns1", "route": [{"if": "p1", "ip": "10.2.11.1/24", "ns_if": "t2if", "ns_name": "t2"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t2ns1if", "tenant_ns_ip": "10.2.11.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s1if", "tenant_sub_ip": "10.2.11.2/24"}], "vms": [{"brif": "t2br1if1", "disk": "10G", "mem": 2, "name": "t2_VM4", "vcpu": 4, "vmif": "t2VM4if1"}]}, {"dev": "t2s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.11.2", "remote_ip": "10.1.11.2", "remote_route": "10.1.11.0/24", "subnet_route": "10.2.11.0/24", "tenant_route_ip": "192.168.130.2", "v_name": "vxlan_t2s1"}], "rc": 0, "start": "2019-11-18 00:25:09.108274", "stderr": "Device \"vxlan_t2s1\" does not exist.", "stderr_lines": ["Device \"vxlan_t2s1\" does not exist."], "stdout": "", "stdout_lines": []}

TASK [Attach VXLANs to bridge] ******************************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.11.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.2.11.1', u'bridge_name': u't2br1', u'dns': [{u'dnsif': u't2s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't2s1_dnsbrif'}], u'ns_name': u't2ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.11.2/24', u'tenant_ns_ip': u'10.2.11.1/24', u'tenant_ns_if': u't2ns1if', u'tenant_sub_if': u't2s1if', u'tenant_ns_name': u't2'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't2_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't2br1if1', u'vmif': u't2VM4if1'}]}, {u'local_ip': u'10.2.11.2', u'dsport': 4789, u'dev': u't2s1if', u'tenant_route_ip': u'192.168.130.2', u'remote_route': u'10.1.11.0/24', u'subnet_route': u'10.2.11.0/24', u'v_name': u'vxlan_t2s1', u'id': 42, u'remote_ip': u'10.1.11.2'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t2ns1\" brctl show \"t2br1\" | grep -w 'vxlan_t2s1' ; if [ $? -ne 0 ] ; then ip netns exec \"t2ns1\" brctl addif \"t2br1\" \"vxlan_t2s1\" ; fi\n", "delta": "0:00:00.076995", "end": "2019-11-18 00:25:09.728199", "item": [{"bridge_name": "t2br1", "default_route_ip": "10.2.11.1", "dns": [{"brif": "t2s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t2s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns1", "route": [{"if": "p1", "ip": "10.2.11.1/24", "ns_if": "t2if", "ns_name": "t2"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t2ns1if", "tenant_ns_ip": "10.2.11.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s1if", "tenant_sub_ip": "10.2.11.2/24"}], "vms": [{"brif": "t2br1if1", "disk": "10G", "mem": 2, "name": "t2_VM4", "vcpu": 4, "vmif": "t2VM4if1"}]}, {"dev": "t2s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.11.2", "remote_ip": "10.1.11.2", "remote_route": "10.1.11.0/24", "subnet_route": "10.2.11.0/24", "tenant_route_ip": "192.168.130.2", "v_name": "vxlan_t2s1"}], "rc": 0, "start": "2019-11-18 00:25:09.651204", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

PLAY RECAP **************************************************************************************************************************************************
99.99.99.2                 : ok=21   changed=21   unreachable=0    failed=0    skipped=0    rescued=0    ignored=0   

Using /etc/ansible/ansible.cfg as config file

PLAY [main] *************************************************************************************************************************************************

TASK [Add VXLAN routes in PNS] ******************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.11.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.1.11.1', u'bridge_name': u't2br1', u'dns': [{u'dnsif': u't2s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't2s1_dnsbrif'}], u'ns_name': u't2ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.11.2/24', u'tenant_ns_ip': u'10.1.11.1/24', u'tenant_ns_if': u't2ns1if', u'tenant_sub_if': u't2s1if', u'tenant_ns_name': u't2'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't2_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't2br1if1', u'vmif': u't2VM1if1'}, {u'mem': 4, u'name': u't2_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't2br1if2', u'vmif': u't2VM2if1'}]}, {u'local_ip': u'10.1.11.2', u'dsport': 4789, u'dev': u't2s1if', u'tenant_route_ip': u'192.168.2.2', u'remote_route': u'10.2.11.0/24', u'subnet_route': u'10.1.11.0/24', u'v_name': u'vxlan_t2s1', u'id': 42, u'remote_ip': u'10.2.11.2'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec pns ip route show \"10.1.11.0/24\" via \"192.168.2.2\" | grep -w '^10.1.11.0/24' ; if [ $? -ne 0 ] ; then ip netns exec pns ip route add \"10.1.11.0/24\" via \"192.168.2.2\" ; fi\n", "delta": "0:00:00.066775", "end": "2019-11-18 00:25:10.861641", "item": [{"bridge_name": "t2br1", "default_route_ip": "10.1.11.1", "dns": [{"brif": "t2s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t2s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns1", "route": [{"if": "p1", "ip": "10.1.11.1/24", "ns_if": "t2if", "ns_name": "t2"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t2ns1if", "tenant_ns_ip": "10.1.11.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s1if", "tenant_sub_ip": "10.1.11.2/24"}], "vms": [{"brif": "t2br1if1", "disk": "10G", "mem": 2, "name": "t2_VM1", "vcpu": 4, "vmif": "t2VM1if1"}, {"brif": "t2br1if2", "disk": "10G", "mem": 4, "name": "t2_VM2", "vcpu": 2, "vmif": "t2VM2if1"}]}, {"dev": "t2s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.11.2", "remote_ip": "10.2.11.2", "remote_route": "10.2.11.0/24", "subnet_route": "10.1.11.0/24", "tenant_route_ip": "192.168.2.2", "v_name": "vxlan_t2s1"}], "rc": 0, "start": "2019-11-18 00:25:10.794866", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}
skipping: [localhost] => (item=[{u'route': [{u'ip': u'10.1.12.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.1.12.1', u'bridge_name': u't2br2', u'dns': [{u'dnsif': u't2s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't2s2_dnsbrif'}], u'ns_name': u't2ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.12.2/24', u'tenant_ns_ip': u'10.1.12.1/24', u'tenant_ns_if': u't2ns2if', u'tenant_sub_if': u't2s2if', u'tenant_ns_name': u't2'}], u'subnet_ip': u'2.2.2.0/24', u'vms': [{u'mem': 3, u'name': u't2_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't2br2if1', u'vmif': u't2VM3if1'}]}, {u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}])  => {"ansible_loop_var": "item", "changed": false, "item": [{"bridge_name": "t2br2", "default_route_ip": "10.1.12.1", "dns": [{"brif": "t2s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t2s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns2", "route": [{"if": "p1", "ip": "10.1.12.1/24", "ns_if": "t2if", "ns_name": "t2"}], "subnet_ip": "2.2.2.0/24", "tenant_ns": [{"tenant_ns_if": "t2ns2if", "tenant_ns_ip": "10.1.12.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s2if", "tenant_sub_ip": "10.1.12.2/24"}], "vms": [{"brif": "t2br2if1", "disk": "10G", "mem": 3, "name": "t2_VM3", "vcpu": 2, "vmif": "t2VM3if1"}]}, {"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}], "skip_reason": "Conditional result was False"}

TASK [Get PNS ip address] ***********************************************************************************************************************************
ok: [localhost] => {"changed": false, "cmd": "ip netns exec pns ip addr show p1 | awk 'FNR==3{ print $2 }' | awk -F/ '{ print $1 }'\n", "delta": "0:00:00.034436", "end": "2019-11-18 00:25:11.145953", "rc": 0, "start": "2019-11-18 00:25:11.111517", "stderr": "", "stderr_lines": [], "stdout": "192.168.100.238", "stdout_lines": ["192.168.100.238"]}

TASK [Add VXLAN routes to host] *****************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.11.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.1.11.1', u'bridge_name': u't2br1', u'dns': [{u'dnsif': u't2s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't2s1_dnsbrif'}], u'ns_name': u't2ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.11.2/24', u'tenant_ns_ip': u'10.1.11.1/24', u'tenant_ns_if': u't2ns1if', u'tenant_sub_if': u't2s1if', u'tenant_ns_name': u't2'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't2_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't2br1if1', u'vmif': u't2VM1if1'}, {u'mem': 4, u'name': u't2_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't2br1if2', u'vmif': u't2VM2if1'}]}, {u'local_ip': u'10.1.11.2', u'dsport': 4789, u'dev': u't2s1if', u'tenant_route_ip': u'192.168.2.2', u'remote_route': u'10.2.11.0/24', u'subnet_route': u'10.1.11.0/24', u'v_name': u'vxlan_t2s1', u'id': 42, u'remote_ip': u'10.2.11.2'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip route show \"10.1.11.0/24\" via \"192.168.100.238\" | grep -w '^10.1.11.0/24' ; if [ $? -ne 0 ] ; then ip route add \"10.1.11.0/24\" via \"192.168.100.238\" ; fi\nip route show \"10.2.11.0/24\" via 99.99.99.2 | grep -w '^10.2.11.0/24'; if [ $? -ne 0 ] ; then ip route add \"10.2.11.0/24\" via 99.99.99.2 ; fi\n", "delta": "0:00:00.010117", "end": "2019-11-18 00:25:11.455500", "item": [{"bridge_name": "t2br1", "default_route_ip": "10.1.11.1", "dns": [{"brif": "t2s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t2s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns1", "route": [{"if": "p1", "ip": "10.1.11.1/24", "ns_if": "t2if", "ns_name": "t2"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t2ns1if", "tenant_ns_ip": "10.1.11.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s1if", "tenant_sub_ip": "10.1.11.2/24"}], "vms": [{"brif": "t2br1if1", "disk": "10G", "mem": 2, "name": "t2_VM1", "vcpu": 4, "vmif": "t2VM1if1"}, {"brif": "t2br1if2", "disk": "10G", "mem": 4, "name": "t2_VM2", "vcpu": 2, "vmif": "t2VM2if1"}]}, {"dev": "t2s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.11.2", "remote_ip": "10.2.11.2", "remote_route": "10.2.11.0/24", "subnet_route": "10.1.11.0/24", "tenant_route_ip": "192.168.2.2", "v_name": "vxlan_t2s1"}], "rc": 0, "start": "2019-11-18 00:25:11.445383", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}
skipping: [localhost] => (item=[{u'route': [{u'ip': u'10.1.12.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.1.12.1', u'bridge_name': u't2br2', u'dns': [{u'dnsif': u't2s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't2s2_dnsbrif'}], u'ns_name': u't2ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.12.2/24', u'tenant_ns_ip': u'10.1.12.1/24', u'tenant_ns_if': u't2ns2if', u'tenant_sub_if': u't2s2if', u'tenant_ns_name': u't2'}], u'subnet_ip': u'2.2.2.0/24', u'vms': [{u'mem': 3, u'name': u't2_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't2br2if1', u'vmif': u't2VM3if1'}]}, {u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}])  => {"ansible_loop_var": "item", "changed": false, "item": [{"bridge_name": "t2br2", "default_route_ip": "10.1.12.1", "dns": [{"brif": "t2s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t2s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns2", "route": [{"if": "p1", "ip": "10.1.12.1/24", "ns_if": "t2if", "ns_name": "t2"}], "subnet_ip": "2.2.2.0/24", "tenant_ns": [{"tenant_ns_if": "t2ns2if", "tenant_ns_ip": "10.1.12.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s2if", "tenant_sub_ip": "10.1.12.2/24"}], "vms": [{"brif": "t2br2if1", "disk": "10G", "mem": 3, "name": "t2_VM3", "vcpu": 2, "vmif": "t2VM3if1"}]}, {"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}], "skip_reason": "Conditional result was False"}

PLAY RECAP **************************************************************************************************************************************************
localhost                  : ok=3    changed=2    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0   

Using /etc/ansible/ansible.cfg as config file

PLAY [worker] ***********************************************************************************************************************************************

TASK [Add VXLAN routes in PNS] ******************************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.11.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.2.11.1', u'bridge_name': u't2br1', u'dns': [{u'dnsif': u't2s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't2s1_dnsbrif'}], u'ns_name': u't2ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.11.2/24', u'tenant_ns_ip': u'10.2.11.1/24', u'tenant_ns_if': u't2ns1if', u'tenant_sub_if': u't2s1if', u'tenant_ns_name': u't2'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't2_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't2br1if1', u'vmif': u't2VM4if1'}]}, {u'local_ip': u'10.2.11.2', u'dsport': 4789, u'dev': u't2s1if', u'tenant_route_ip': u'192.168.130.2', u'remote_route': u'10.1.11.0/24', u'subnet_route': u'10.2.11.0/24', u'v_name': u'vxlan_t2s1', u'id': 42, u'remote_ip': u'10.1.11.2'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec pns ip route show \"10.2.11.0/24\" via \"192.168.130.2\" | grep -w '^10.2.11.0/24' ; if [ $? -ne 0 ] ; then ip netns exec pns ip route add \"10.2.11.0/24\" via \"192.168.130.2\" ; fi\n", "delta": "0:00:00.095309", "end": "2019-11-18 00:25:12.864080", "item": [{"bridge_name": "t2br1", "default_route_ip": "10.2.11.1", "dns": [{"brif": "t2s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t2s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns1", "route": [{"if": "p1", "ip": "10.2.11.1/24", "ns_if": "t2if", "ns_name": "t2"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t2ns1if", "tenant_ns_ip": "10.2.11.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s1if", "tenant_sub_ip": "10.2.11.2/24"}], "vms": [{"brif": "t2br1if1", "disk": "10G", "mem": 2, "name": "t2_VM4", "vcpu": 4, "vmif": "t2VM4if1"}]}, {"dev": "t2s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.11.2", "remote_ip": "10.1.11.2", "remote_route": "10.1.11.0/24", "subnet_route": "10.2.11.0/24", "tenant_route_ip": "192.168.130.2", "v_name": "vxlan_t2s1"}], "rc": 0, "start": "2019-11-18 00:25:12.768771", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Get PNS ip address] ***********************************************************************************************************************************
ok: [99.99.99.2] => {"changed": false, "cmd": "ip netns exec pns ip addr show p1 | awk 'FNR==3{ print $2 }' | awk -F/ '{ print $1 }'\n", "delta": "0:00:00.049436", "end": "2019-11-18 00:25:13.304405", "rc": 0, "start": "2019-11-18 00:25:13.254969", "stderr": "", "stderr_lines": [], "stdout": "192.168.100.50", "stdout_lines": ["192.168.100.50"]}

TASK [Add VXLAN routes to host] *****************************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.11.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.2.11.1', u'bridge_name': u't2br1', u'dns': [{u'dnsif': u't2s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't2s1_dnsbrif'}], u'ns_name': u't2ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.11.2/24', u'tenant_ns_ip': u'10.2.11.1/24', u'tenant_ns_if': u't2ns1if', u'tenant_sub_if': u't2s1if', u'tenant_ns_name': u't2'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't2_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't2br1if1', u'vmif': u't2VM4if1'}]}, {u'local_ip': u'10.2.11.2', u'dsport': 4789, u'dev': u't2s1if', u'tenant_route_ip': u'192.168.130.2', u'remote_route': u'10.1.11.0/24', u'subnet_route': u'10.2.11.0/24', u'v_name': u'vxlan_t2s1', u'id': 42, u'remote_ip': u'10.1.11.2'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip route show \"10.2.11.0/24\" via \"192.168.100.50\" | grep -w '^10.2.11.0/24' ; if [ $? -ne 0 ] ; then ip route add \"10.2.11.0/24\" via \"192.168.100.50\" ; fi\nip route show \"10.1.11.0/24\" via 99.99.99.1 | grep -w '^10.1.11.0/24'; if [ $? -ne 0 ] ; then ip route add \"10.1.11.0/24\" via 99.99.99.1 ; fi\n", "delta": "0:00:00.010752", "end": "2019-11-18 00:25:13.747472", "item": [{"bridge_name": "t2br1", "default_route_ip": "10.2.11.1", "dns": [{"brif": "t2s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t2s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns1", "route": [{"if": "p1", "ip": "10.2.11.1/24", "ns_if": "t2if", "ns_name": "t2"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t2ns1if", "tenant_ns_ip": "10.2.11.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s1if", "tenant_sub_ip": "10.2.11.2/24"}], "vms": [{"brif": "t2br1if1", "disk": "10G", "mem": 2, "name": "t2_VM4", "vcpu": 4, "vmif": "t2VM4if1"}]}, {"dev": "t2s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.11.2", "remote_ip": "10.1.11.2", "remote_route": "10.1.11.0/24", "subnet_route": "10.2.11.0/24", "tenant_route_ip": "192.168.130.2", "v_name": "vxlan_t2s1"}], "rc": 0, "start": "2019-11-18 00:25:13.736720", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

PLAY RECAP **************************************************************************************************************************************************
99.99.99.2                 : ok=3    changed=2    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0   

Using /etc/ansible/ansible.cfg as config file

PLAY [main] *************************************************************************************************************************************************

TASK [Create VM templates (C1)] *****************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.11.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.1.11.1', u'bridge_name': u't2br1', u'dns': [{u'dnsif': u't2s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't2s1_dnsbrif'}], u'ns_name': u't2ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.11.2/24', u'tenant_ns_ip': u'10.1.11.1/24', u'tenant_ns_if': u't2ns1if', u'tenant_sub_if': u't2s1if', u'tenant_ns_name': u't2'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.1.11.2', u'dsport': 4789, u'dev': u't2s1if', u'tenant_route_ip': u'192.168.2.2', u'remote_route': u'10.2.11.0/24', u'subnet_route': u'10.1.11.0/24', u'v_name': u'vxlan_t2s1', u'id': 42, u'remote_ip': u'10.2.11.2'}]}, {u'mem': 2, u'name': u't2_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't2br1if1', u'vmif': u't2VM1if1'}]) => {"ansible_loop_var": "item", "changed": true, "checksum": "350ba870bd31b7f6ee517845c14237910b5af0bf", "dest": "/root/Migration-as-a-Service/t2/VM_templates/t2_VM1.xml.j2", "gid": 0, "group": "root", "item": [{"bridge_name": "t2br1", "default_route_ip": "10.1.11.1", "dns": [{"brif": "t2s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t2s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns1", "route": [{"if": "p1", "ip": "10.1.11.1/24", "ns_if": "t2if", "ns_name": "t2"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t2ns1if", "tenant_ns_ip": "10.1.11.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s1if", "tenant_sub_ip": "10.1.11.2/24"}], "vxlan": [{"dev": "t2s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.11.2", "remote_ip": "10.2.11.2", "remote_route": "10.2.11.0/24", "subnet_route": "10.1.11.0/24", "tenant_route_ip": "192.168.2.2", "v_name": "vxlan_t2s1"}]}, {"brif": "t2br1if1", "disk": "10G", "mem": 2, "name": "t2_VM1", "vcpu": 4, "vmif": "t2VM1if1"}], "md5sum": "fbfc2eb0c2569531f25eea92c26d3bee", "mode": "0644", "owner": "root", "size": 4091, "src": "/root/.ansible/tmp/ansible-tmp-1574036714.45-19406384546388/source", "state": "file", "uid": 0}
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.11.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.1.11.1', u'bridge_name': u't2br1', u'dns': [{u'dnsif': u't2s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't2s1_dnsbrif'}], u'ns_name': u't2ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.11.2/24', u'tenant_ns_ip': u'10.1.11.1/24', u'tenant_ns_if': u't2ns1if', u'tenant_sub_if': u't2s1if', u'tenant_ns_name': u't2'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.1.11.2', u'dsport': 4789, u'dev': u't2s1if', u'tenant_route_ip': u'192.168.2.2', u'remote_route': u'10.2.11.0/24', u'subnet_route': u'10.1.11.0/24', u'v_name': u'vxlan_t2s1', u'id': 42, u'remote_ip': u'10.2.11.2'}]}, {u'mem': 4, u'name': u't2_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't2br1if2', u'vmif': u't2VM2if1'}]) => {"ansible_loop_var": "item", "changed": true, "checksum": "350ba870bd31b7f6ee517845c14237910b5af0bf", "dest": "/root/Migration-as-a-Service/t2/VM_templates/t2_VM2.xml.j2", "gid": 0, "group": "root", "item": [{"bridge_name": "t2br1", "default_route_ip": "10.1.11.1", "dns": [{"brif": "t2s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t2s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns1", "route": [{"if": "p1", "ip": "10.1.11.1/24", "ns_if": "t2if", "ns_name": "t2"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t2ns1if", "tenant_ns_ip": "10.1.11.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s1if", "tenant_sub_ip": "10.1.11.2/24"}], "vxlan": [{"dev": "t2s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.11.2", "remote_ip": "10.2.11.2", "remote_route": "10.2.11.0/24", "subnet_route": "10.1.11.0/24", "tenant_route_ip": "192.168.2.2", "v_name": "vxlan_t2s1"}]}, {"brif": "t2br1if2", "disk": "10G", "mem": 4, "name": "t2_VM2", "vcpu": 2, "vmif": "t2VM2if1"}], "md5sum": "fbfc2eb0c2569531f25eea92c26d3bee", "mode": "0644", "owner": "root", "size": 4091, "src": "/root/.ansible/tmp/ansible-tmp-1574036715.09-54937095010651/source", "state": "file", "uid": 0}
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.12.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.1.12.1', u'bridge_name': u't2br2', u'dns': [{u'dnsif': u't2s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't2s2_dnsbrif'}], u'ns_name': u't2ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.12.2/24', u'tenant_ns_ip': u'10.1.12.1/24', u'tenant_ns_if': u't2ns2if', u'tenant_sub_if': u't2s2if', u'tenant_ns_name': u't2'}], u'subnet_ip': u'2.2.2.0/24', u'vxlan': [{u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}, {u'mem': 3, u'name': u't2_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't2br2if1', u'vmif': u't2VM3if1'}]) => {"ansible_loop_var": "item", "changed": true, "checksum": "350ba870bd31b7f6ee517845c14237910b5af0bf", "dest": "/root/Migration-as-a-Service/t2/VM_templates/t2_VM3.xml.j2", "gid": 0, "group": "root", "item": [{"bridge_name": "t2br2", "default_route_ip": "10.1.12.1", "dns": [{"brif": "t2s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t2s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns2", "route": [{"if": "p1", "ip": "10.1.12.1/24", "ns_if": "t2if", "ns_name": "t2"}], "subnet_ip": "2.2.2.0/24", "tenant_ns": [{"tenant_ns_if": "t2ns2if", "tenant_ns_ip": "10.1.12.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s2if", "tenant_sub_ip": "10.1.12.2/24"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, {"brif": "t2br2if1", "disk": "10G", "mem": 3, "name": "t2_VM3", "vcpu": 2, "vmif": "t2VM3if1"}], "md5sum": "fbfc2eb0c2569531f25eea92c26d3bee", "mode": "0644", "owner": "root", "size": 4091, "src": "/root/.ansible/tmp/ansible-tmp-1574036715.38-279391049562999/source", "state": "file", "uid": 0}

PLAY RECAP **************************************************************************************************************************************************
localhost                  : ok=1    changed=1    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0   

Using /etc/ansible/ansible.cfg as config file

PLAY [main] *************************************************************************************************************************************************

TASK [Create VM templates (C2)] *****************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.2.11.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.2.11.1', u'bridge_name': u't2br1', u'dns': [{u'dnsif': u't2s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't2s1_dnsbrif'}], u'ns_name': u't2ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.11.2/24', u'tenant_ns_ip': u'10.2.11.1/24', u'tenant_ns_if': u't2ns1if', u'tenant_sub_if': u't2s1if', u'tenant_ns_name': u't2'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.2.11.2', u'dsport': 4789, u'dev': u't2s1if', u'tenant_route_ip': u'192.168.130.2', u'remote_route': u'10.1.11.0/24', u'subnet_route': u'10.2.11.0/24', u'v_name': u'vxlan_t2s1', u'id': 42, u'remote_ip': u'10.1.11.2'}]}, {u'mem': 2, u'name': u't2_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't2br1if1', u'vmif': u't2VM4if1'}]) => {"ansible_loop_var": "item", "changed": true, "checksum": "350ba870bd31b7f6ee517845c14237910b5af0bf", "dest": "/root/Migration-as-a-Service/t2/VM_templates/t2_VM4.xml.j2", "gid": 0, "group": "root", "item": [{"bridge_name": "t2br1", "default_route_ip": "10.2.11.1", "dns": [{"brif": "t2s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t2s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns1", "route": [{"if": "p1", "ip": "10.2.11.1/24", "ns_if": "t2if", "ns_name": "t2"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t2ns1if", "tenant_ns_ip": "10.2.11.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s1if", "tenant_sub_ip": "10.2.11.2/24"}], "vxlan": [{"dev": "t2s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.11.2", "remote_ip": "10.1.11.2", "remote_route": "10.1.11.0/24", "subnet_route": "10.2.11.0/24", "tenant_route_ip": "192.168.130.2", "v_name": "vxlan_t2s1"}]}, {"brif": "t2br1if1", "disk": "10G", "mem": 2, "name": "t2_VM4", "vcpu": 4, "vmif": "t2VM4if1"}], "md5sum": "fbfc2eb0c2569531f25eea92c26d3bee", "mode": "0644", "owner": "root", "size": 4091, "src": "/root/.ansible/tmp/ansible-tmp-1574036716.32-181677463683217/source", "state": "file", "uid": 0}

PLAY RECAP **************************************************************************************************************************************************
localhost                  : ok=1    changed=1    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0   

Using /etc/ansible/ansible.cfg as config file

PLAY [main] *************************************************************************************************************************************************

TASK [Copy VM image] ****************************************************************************************************************************************
ok: [localhost] => (item=[{u'route': [{u'ip': u'10.1.11.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.1.11.1', u'bridge_name': u't2br1', u'dns': [{u'dnsif': u't2s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't2s1_dnsbrif'}], u'ns_name': u't2ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.11.2/24', u'tenant_ns_ip': u'10.1.11.1/24', u'tenant_ns_if': u't2ns1if', u'tenant_sub_if': u't2s1if', u'tenant_ns_name': u't2'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.1.11.2', u'dsport': 4789, u'dev': u't2s1if', u'tenant_route_ip': u'192.168.2.2', u'remote_route': u'10.2.11.0/24', u'subnet_route': u'10.1.11.0/24', u'v_name': u'vxlan_t2s1', u'id': 42, u'remote_ip': u'10.2.11.2'}]}, {u'mem': 2, u'name': u't2_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't2br1if1', u'vmif': u't2VM1if1'}]) => {"ansible_loop_var": "item", "changed": false, "dest": "/var/lib/libvirt/images/t2_VM1.qcow2", "item": [{"bridge_name": "t2br1", "default_route_ip": "10.1.11.1", "dns": [{"brif": "t2s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t2s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns1", "route": [{"if": "p1", "ip": "10.1.11.1/24", "ns_if": "t2if", "ns_name": "t2"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t2ns1if", "tenant_ns_ip": "10.1.11.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s1if", "tenant_sub_ip": "10.1.11.2/24"}], "vxlan": [{"dev": "t2s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.11.2", "remote_ip": "10.2.11.2", "remote_route": "10.2.11.0/24", "subnet_route": "10.1.11.0/24", "tenant_route_ip": "192.168.2.2", "v_name": "vxlan_t2s1"}]}, {"brif": "t2br1if1", "disk": "10G", "mem": 2, "name": "t2_VM1", "vcpu": 4, "vmif": "t2VM1if1"}], "src": "/root/mainVM.qcow2"}
ok: [localhost] => (item=[{u'route': [{u'ip': u'10.1.11.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.1.11.1', u'bridge_name': u't2br1', u'dns': [{u'dnsif': u't2s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't2s1_dnsbrif'}], u'ns_name': u't2ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.11.2/24', u'tenant_ns_ip': u'10.1.11.1/24', u'tenant_ns_if': u't2ns1if', u'tenant_sub_if': u't2s1if', u'tenant_ns_name': u't2'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.1.11.2', u'dsport': 4789, u'dev': u't2s1if', u'tenant_route_ip': u'192.168.2.2', u'remote_route': u'10.2.11.0/24', u'subnet_route': u'10.1.11.0/24', u'v_name': u'vxlan_t2s1', u'id': 42, u'remote_ip': u'10.2.11.2'}]}, {u'mem': 4, u'name': u't2_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't2br1if2', u'vmif': u't2VM2if1'}]) => {"ansible_loop_var": "item", "changed": false, "dest": "/var/lib/libvirt/images/t2_VM2.qcow2", "item": [{"bridge_name": "t2br1", "default_route_ip": "10.1.11.1", "dns": [{"brif": "t2s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t2s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns1", "route": [{"if": "p1", "ip": "10.1.11.1/24", "ns_if": "t2if", "ns_name": "t2"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t2ns1if", "tenant_ns_ip": "10.1.11.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s1if", "tenant_sub_ip": "10.1.11.2/24"}], "vxlan": [{"dev": "t2s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.11.2", "remote_ip": "10.2.11.2", "remote_route": "10.2.11.0/24", "subnet_route": "10.1.11.0/24", "tenant_route_ip": "192.168.2.2", "v_name": "vxlan_t2s1"}]}, {"brif": "t2br1if2", "disk": "10G", "mem": 4, "name": "t2_VM2", "vcpu": 2, "vmif": "t2VM2if1"}], "src": "/root/mainVM.qcow2"}
ok: [localhost] => (item=[{u'route': [{u'ip': u'10.1.12.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.1.12.1', u'bridge_name': u't2br2', u'dns': [{u'dnsif': u't2s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't2s2_dnsbrif'}], u'ns_name': u't2ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.12.2/24', u'tenant_ns_ip': u'10.1.12.1/24', u'tenant_ns_if': u't2ns2if', u'tenant_sub_if': u't2s2if', u'tenant_ns_name': u't2'}], u'subnet_ip': u'2.2.2.0/24', u'vxlan': [{u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}, {u'mem': 3, u'name': u't2_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't2br2if1', u'vmif': u't2VM3if1'}]) => {"ansible_loop_var": "item", "changed": false, "dest": "/var/lib/libvirt/images/t2_VM3.qcow2", "item": [{"bridge_name": "t2br2", "default_route_ip": "10.1.12.1", "dns": [{"brif": "t2s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t2s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns2", "route": [{"if": "p1", "ip": "10.1.12.1/24", "ns_if": "t2if", "ns_name": "t2"}], "subnet_ip": "2.2.2.0/24", "tenant_ns": [{"tenant_ns_if": "t2ns2if", "tenant_ns_ip": "10.1.12.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s2if", "tenant_sub_ip": "10.1.12.2/24"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, {"brif": "t2br2if1", "disk": "10G", "mem": 3, "name": "t2_VM3", "vcpu": 2, "vmif": "t2VM3if1"}], "src": "/root/mainVM.qcow2"}

TASK [Create VM templates (C1)] *****************************************************************************************************************************
ok: [localhost] => (item=[{u'route': [{u'ip': u'10.1.11.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.1.11.1', u'bridge_name': u't2br1', u'dns': [{u'dnsif': u't2s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't2s1_dnsbrif'}], u'ns_name': u't2ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.11.2/24', u'tenant_ns_ip': u'10.1.11.1/24', u'tenant_ns_if': u't2ns1if', u'tenant_sub_if': u't2s1if', u'tenant_ns_name': u't2'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.1.11.2', u'dsport': 4789, u'dev': u't2s1if', u'tenant_route_ip': u'192.168.2.2', u'remote_route': u'10.2.11.0/24', u'subnet_route': u'10.1.11.0/24', u'v_name': u'vxlan_t2s1', u'id': 42, u'remote_ip': u'10.2.11.2'}]}, {u'mem': 2, u'name': u't2_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't2br1if1', u'vmif': u't2VM1if1'}]) => {"ansible_loop_var": "item", "changed": false, "checksum": "350ba870bd31b7f6ee517845c14237910b5af0bf", "dest": "/root/Migration-as-a-Service/t2/VM_templates/t2_VM1.xml.j2", "gid": 0, "group": "root", "item": [{"bridge_name": "t2br1", "default_route_ip": "10.1.11.1", "dns": [{"brif": "t2s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t2s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns1", "route": [{"if": "p1", "ip": "10.1.11.1/24", "ns_if": "t2if", "ns_name": "t2"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t2ns1if", "tenant_ns_ip": "10.1.11.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s1if", "tenant_sub_ip": "10.1.11.2/24"}], "vxlan": [{"dev": "t2s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.11.2", "remote_ip": "10.2.11.2", "remote_route": "10.2.11.0/24", "subnet_route": "10.1.11.0/24", "tenant_route_ip": "192.168.2.2", "v_name": "vxlan_t2s1"}]}, {"brif": "t2br1if1", "disk": "10G", "mem": 2, "name": "t2_VM1", "vcpu": 4, "vmif": "t2VM1if1"}], "mode": "0644", "owner": "root", "path": "/root/Migration-as-a-Service/t2/VM_templates/t2_VM1.xml.j2", "size": 4091, "state": "file", "uid": 0}
ok: [localhost] => (item=[{u'route': [{u'ip': u'10.1.11.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.1.11.1', u'bridge_name': u't2br1', u'dns': [{u'dnsif': u't2s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't2s1_dnsbrif'}], u'ns_name': u't2ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.11.2/24', u'tenant_ns_ip': u'10.1.11.1/24', u'tenant_ns_if': u't2ns1if', u'tenant_sub_if': u't2s1if', u'tenant_ns_name': u't2'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.1.11.2', u'dsport': 4789, u'dev': u't2s1if', u'tenant_route_ip': u'192.168.2.2', u'remote_route': u'10.2.11.0/24', u'subnet_route': u'10.1.11.0/24', u'v_name': u'vxlan_t2s1', u'id': 42, u'remote_ip': u'10.2.11.2'}]}, {u'mem': 4, u'name': u't2_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't2br1if2', u'vmif': u't2VM2if1'}]) => {"ansible_loop_var": "item", "changed": false, "checksum": "350ba870bd31b7f6ee517845c14237910b5af0bf", "dest": "/root/Migration-as-a-Service/t2/VM_templates/t2_VM2.xml.j2", "gid": 0, "group": "root", "item": [{"bridge_name": "t2br1", "default_route_ip": "10.1.11.1", "dns": [{"brif": "t2s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t2s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns1", "route": [{"if": "p1", "ip": "10.1.11.1/24", "ns_if": "t2if", "ns_name": "t2"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t2ns1if", "tenant_ns_ip": "10.1.11.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s1if", "tenant_sub_ip": "10.1.11.2/24"}], "vxlan": [{"dev": "t2s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.11.2", "remote_ip": "10.2.11.2", "remote_route": "10.2.11.0/24", "subnet_route": "10.1.11.0/24", "tenant_route_ip": "192.168.2.2", "v_name": "vxlan_t2s1"}]}, {"brif": "t2br1if2", "disk": "10G", "mem": 4, "name": "t2_VM2", "vcpu": 2, "vmif": "t2VM2if1"}], "mode": "0644", "owner": "root", "path": "/root/Migration-as-a-Service/t2/VM_templates/t2_VM2.xml.j2", "size": 4091, "state": "file", "uid": 0}
ok: [localhost] => (item=[{u'route': [{u'ip': u'10.1.12.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.1.12.1', u'bridge_name': u't2br2', u'dns': [{u'dnsif': u't2s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't2s2_dnsbrif'}], u'ns_name': u't2ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.12.2/24', u'tenant_ns_ip': u'10.1.12.1/24', u'tenant_ns_if': u't2ns2if', u'tenant_sub_if': u't2s2if', u'tenant_ns_name': u't2'}], u'subnet_ip': u'2.2.2.0/24', u'vxlan': [{u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}, {u'mem': 3, u'name': u't2_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't2br2if1', u'vmif': u't2VM3if1'}]) => {"ansible_loop_var": "item", "changed": false, "checksum": "350ba870bd31b7f6ee517845c14237910b5af0bf", "dest": "/root/Migration-as-a-Service/t2/VM_templates/t2_VM3.xml.j2", "gid": 0, "group": "root", "item": [{"bridge_name": "t2br2", "default_route_ip": "10.1.12.1", "dns": [{"brif": "t2s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t2s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns2", "route": [{"if": "p1", "ip": "10.1.12.1/24", "ns_if": "t2if", "ns_name": "t2"}], "subnet_ip": "2.2.2.0/24", "tenant_ns": [{"tenant_ns_if": "t2ns2if", "tenant_ns_ip": "10.1.12.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s2if", "tenant_sub_ip": "10.1.12.2/24"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, {"brif": "t2br2if1", "disk": "10G", "mem": 3, "name": "t2_VM3", "vcpu": 2, "vmif": "t2VM3if1"}], "mode": "0644", "owner": "root", "path": "/root/Migration-as-a-Service/t2/VM_templates/t2_VM3.xml.j2", "size": 4091, "state": "file", "uid": 0}

TASK [Get list of running VMs] ******************************************************************************************************************************
ok: [localhost] => {"changed": false, "cmd": ["virsh", "list", "--name"], "delta": "0:00:00.025959", "end": "2019-11-18 00:25:19.799436", "rc": 0, "start": "2019-11-18 00:25:19.773477", "stderr": "", "stderr_lines": [], "stdout": "t1_VM2\nt1_VM3", "stdout_lines": ["t1_VM2", "t1_VM3"]}

TASK [Define VM] ********************************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.11.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.1.11.1', u'bridge_name': u't2br1', u'dns': [{u'dnsif': u't2s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't2s1_dnsbrif'}], u'ns_name': u't2ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.11.2/24', u'tenant_ns_ip': u'10.1.11.1/24', u'tenant_ns_if': u't2ns1if', u'tenant_sub_if': u't2s1if', u'tenant_ns_name': u't2'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.1.11.2', u'dsport': 4789, u'dev': u't2s1if', u'tenant_route_ip': u'192.168.2.2', u'remote_route': u'10.2.11.0/24', u'subnet_route': u'10.1.11.0/24', u'v_name': u'vxlan_t2s1', u'id': 42, u'remote_ip': u'10.2.11.2'}]}, {u'mem': 2, u'name': u't2_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't2br1if1', u'vmif': u't2VM1if1'}]) => {"ansible_loop_var": "item", "changed": true, "created": "t2_VM1", "item": [{"bridge_name": "t2br1", "default_route_ip": "10.1.11.1", "dns": [{"brif": "t2s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t2s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns1", "route": [{"if": "p1", "ip": "10.1.11.1/24", "ns_if": "t2if", "ns_name": "t2"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t2ns1if", "tenant_ns_ip": "10.1.11.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s1if", "tenant_sub_ip": "10.1.11.2/24"}], "vxlan": [{"dev": "t2s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.11.2", "remote_ip": "10.2.11.2", "remote_route": "10.2.11.0/24", "subnet_route": "10.1.11.0/24", "tenant_route_ip": "192.168.2.2", "v_name": "vxlan_t2s1"}]}, {"brif": "t2br1if1", "disk": "10G", "mem": 2, "name": "t2_VM1", "vcpu": 4, "vmif": "t2VM1if1"}], "warnings": ["'xml' is given - ignoring 'name'"]}
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.11.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.1.11.1', u'bridge_name': u't2br1', u'dns': [{u'dnsif': u't2s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't2s1_dnsbrif'}], u'ns_name': u't2ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.11.2/24', u'tenant_ns_ip': u'10.1.11.1/24', u'tenant_ns_if': u't2ns1if', u'tenant_sub_if': u't2s1if', u'tenant_ns_name': u't2'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.1.11.2', u'dsport': 4789, u'dev': u't2s1if', u'tenant_route_ip': u'192.168.2.2', u'remote_route': u'10.2.11.0/24', u'subnet_route': u'10.1.11.0/24', u'v_name': u'vxlan_t2s1', u'id': 42, u'remote_ip': u'10.2.11.2'}]}, {u'mem': 4, u'name': u't2_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't2br1if2', u'vmif': u't2VM2if1'}]) => {"ansible_loop_var": "item", "changed": true, "created": "t2_VM2", "item": [{"bridge_name": "t2br1", "default_route_ip": "10.1.11.1", "dns": [{"brif": "t2s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t2s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns1", "route": [{"if": "p1", "ip": "10.1.11.1/24", "ns_if": "t2if", "ns_name": "t2"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t2ns1if", "tenant_ns_ip": "10.1.11.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s1if", "tenant_sub_ip": "10.1.11.2/24"}], "vxlan": [{"dev": "t2s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.11.2", "remote_ip": "10.2.11.2", "remote_route": "10.2.11.0/24", "subnet_route": "10.1.11.0/24", "tenant_route_ip": "192.168.2.2", "v_name": "vxlan_t2s1"}]}, {"brif": "t2br1if2", "disk": "10G", "mem": 4, "name": "t2_VM2", "vcpu": 2, "vmif": "t2VM2if1"}], "warnings": ["'xml' is given - ignoring 'name'"]}
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.12.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.1.12.1', u'bridge_name': u't2br2', u'dns': [{u'dnsif': u't2s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't2s2_dnsbrif'}], u'ns_name': u't2ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.12.2/24', u'tenant_ns_ip': u'10.1.12.1/24', u'tenant_ns_if': u't2ns2if', u'tenant_sub_if': u't2s2if', u'tenant_ns_name': u't2'}], u'subnet_ip': u'2.2.2.0/24', u'vxlan': [{u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}, {u'mem': 3, u'name': u't2_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't2br2if1', u'vmif': u't2VM3if1'}]) => {"ansible_loop_var": "item", "changed": true, "created": "t2_VM3", "item": [{"bridge_name": "t2br2", "default_route_ip": "10.1.12.1", "dns": [{"brif": "t2s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t2s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns2", "route": [{"if": "p1", "ip": "10.1.12.1/24", "ns_if": "t2if", "ns_name": "t2"}], "subnet_ip": "2.2.2.0/24", "tenant_ns": [{"tenant_ns_if": "t2ns2if", "tenant_ns_ip": "10.1.12.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s2if", "tenant_sub_ip": "10.1.12.2/24"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, {"brif": "t2br2if1", "disk": "10G", "mem": 3, "name": "t2_VM3", "vcpu": 2, "vmif": "t2VM3if1"}], "warnings": ["'xml' is given - ignoring 'name'"]}

TASK [Create VM] ********************************************************************************************************************************************
ok: [localhost] => (item=[{u'route': [{u'ip': u'10.1.11.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.1.11.1', u'bridge_name': u't2br1', u'dns': [{u'dnsif': u't2s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't2s1_dnsbrif'}], u'ns_name': u't2ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.11.2/24', u'tenant_ns_ip': u'10.1.11.1/24', u'tenant_ns_if': u't2ns1if', u'tenant_sub_if': u't2s1if', u'tenant_ns_name': u't2'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.1.11.2', u'dsport': 4789, u'dev': u't2s1if', u'tenant_route_ip': u'192.168.2.2', u'remote_route': u'10.2.11.0/24', u'subnet_route': u'10.1.11.0/24', u'v_name': u'vxlan_t2s1', u'id': 42, u'remote_ip': u'10.2.11.2'}]}, {u'mem': 2, u'name': u't2_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't2br1if1', u'vmif': u't2VM1if1'}]) => {"ansible_loop_var": "item", "changed": false, "create": 0, "item": [{"bridge_name": "t2br1", "default_route_ip": "10.1.11.1", "dns": [{"brif": "t2s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t2s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns1", "route": [{"if": "p1", "ip": "10.1.11.1/24", "ns_if": "t2if", "ns_name": "t2"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t2ns1if", "tenant_ns_ip": "10.1.11.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s1if", "tenant_sub_ip": "10.1.11.2/24"}], "vxlan": [{"dev": "t2s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.11.2", "remote_ip": "10.2.11.2", "remote_route": "10.2.11.0/24", "subnet_route": "10.1.11.0/24", "tenant_route_ip": "192.168.2.2", "v_name": "vxlan_t2s1"}]}, {"brif": "t2br1if1", "disk": "10G", "mem": 2, "name": "t2_VM1", "vcpu": 4, "vmif": "t2VM1if1"}]}
ok: [localhost] => (item=[{u'route': [{u'ip': u'10.1.11.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.1.11.1', u'bridge_name': u't2br1', u'dns': [{u'dnsif': u't2s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't2s1_dnsbrif'}], u'ns_name': u't2ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.11.2/24', u'tenant_ns_ip': u'10.1.11.1/24', u'tenant_ns_if': u't2ns1if', u'tenant_sub_if': u't2s1if', u'tenant_ns_name': u't2'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.1.11.2', u'dsport': 4789, u'dev': u't2s1if', u'tenant_route_ip': u'192.168.2.2', u'remote_route': u'10.2.11.0/24', u'subnet_route': u'10.1.11.0/24', u'v_name': u'vxlan_t2s1', u'id': 42, u'remote_ip': u'10.2.11.2'}]}, {u'mem': 4, u'name': u't2_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't2br1if2', u'vmif': u't2VM2if1'}]) => {"ansible_loop_var": "item", "changed": false, "create": 0, "item": [{"bridge_name": "t2br1", "default_route_ip": "10.1.11.1", "dns": [{"brif": "t2s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t2s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns1", "route": [{"if": "p1", "ip": "10.1.11.1/24", "ns_if": "t2if", "ns_name": "t2"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t2ns1if", "tenant_ns_ip": "10.1.11.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s1if", "tenant_sub_ip": "10.1.11.2/24"}], "vxlan": [{"dev": "t2s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.11.2", "remote_ip": "10.2.11.2", "remote_route": "10.2.11.0/24", "subnet_route": "10.1.11.0/24", "tenant_route_ip": "192.168.2.2", "v_name": "vxlan_t2s1"}]}, {"brif": "t2br1if2", "disk": "10G", "mem": 4, "name": "t2_VM2", "vcpu": 2, "vmif": "t2VM2if1"}]}
ok: [localhost] => (item=[{u'route': [{u'ip': u'10.1.12.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.1.12.1', u'bridge_name': u't2br2', u'dns': [{u'dnsif': u't2s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't2s2_dnsbrif'}], u'ns_name': u't2ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.12.2/24', u'tenant_ns_ip': u'10.1.12.1/24', u'tenant_ns_if': u't2ns2if', u'tenant_sub_if': u't2s2if', u'tenant_ns_name': u't2'}], u'subnet_ip': u'2.2.2.0/24', u'vxlan': [{u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}, {u'mem': 3, u'name': u't2_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't2br2if1', u'vmif': u't2VM3if1'}]) => {"ansible_loop_var": "item", "changed": false, "create": 0, "item": [{"bridge_name": "t2br2", "default_route_ip": "10.1.12.1", "dns": [{"brif": "t2s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t2s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns2", "route": [{"if": "p1", "ip": "10.1.12.1/24", "ns_if": "t2if", "ns_name": "t2"}], "subnet_ip": "2.2.2.0/24", "tenant_ns": [{"tenant_ns_if": "t2ns2if", "tenant_ns_ip": "10.1.12.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s2if", "tenant_sub_ip": "10.1.12.2/24"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, {"brif": "t2br2if1", "disk": "10G", "mem": 3, "name": "t2_VM3", "vcpu": 2, "vmif": "t2VM3if1"}]}

TASK [Start VM] *********************************************************************************************************************************************
ok: [localhost] => (item=[{u'route': [{u'ip': u'10.1.11.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.1.11.1', u'bridge_name': u't2br1', u'dns': [{u'dnsif': u't2s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't2s1_dnsbrif'}], u'ns_name': u't2ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.11.2/24', u'tenant_ns_ip': u'10.1.11.1/24', u'tenant_ns_if': u't2ns1if', u'tenant_sub_if': u't2s1if', u'tenant_ns_name': u't2'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.1.11.2', u'dsport': 4789, u'dev': u't2s1if', u'tenant_route_ip': u'192.168.2.2', u'remote_route': u'10.2.11.0/24', u'subnet_route': u'10.1.11.0/24', u'v_name': u'vxlan_t2s1', u'id': 42, u'remote_ip': u'10.2.11.2'}]}, {u'mem': 2, u'name': u't2_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't2br1if1', u'vmif': u't2VM1if1'}]) => {"ansible_loop_var": "item", "changed": false, "item": [{"bridge_name": "t2br1", "default_route_ip": "10.1.11.1", "dns": [{"brif": "t2s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t2s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns1", "route": [{"if": "p1", "ip": "10.1.11.1/24", "ns_if": "t2if", "ns_name": "t2"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t2ns1if", "tenant_ns_ip": "10.1.11.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s1if", "tenant_sub_ip": "10.1.11.2/24"}], "vxlan": [{"dev": "t2s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.11.2", "remote_ip": "10.2.11.2", "remote_route": "10.2.11.0/24", "subnet_route": "10.1.11.0/24", "tenant_route_ip": "192.168.2.2", "v_name": "vxlan_t2s1"}]}, {"brif": "t2br1if1", "disk": "10G", "mem": 2, "name": "t2_VM1", "vcpu": 4, "vmif": "t2VM1if1"}]}
ok: [localhost] => (item=[{u'route': [{u'ip': u'10.1.11.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.1.11.1', u'bridge_name': u't2br1', u'dns': [{u'dnsif': u't2s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't2s1_dnsbrif'}], u'ns_name': u't2ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.11.2/24', u'tenant_ns_ip': u'10.1.11.1/24', u'tenant_ns_if': u't2ns1if', u'tenant_sub_if': u't2s1if', u'tenant_ns_name': u't2'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.1.11.2', u'dsport': 4789, u'dev': u't2s1if', u'tenant_route_ip': u'192.168.2.2', u'remote_route': u'10.2.11.0/24', u'subnet_route': u'10.1.11.0/24', u'v_name': u'vxlan_t2s1', u'id': 42, u'remote_ip': u'10.2.11.2'}]}, {u'mem': 4, u'name': u't2_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't2br1if2', u'vmif': u't2VM2if1'}]) => {"ansible_loop_var": "item", "changed": false, "item": [{"bridge_name": "t2br1", "default_route_ip": "10.1.11.1", "dns": [{"brif": "t2s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t2s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns1", "route": [{"if": "p1", "ip": "10.1.11.1/24", "ns_if": "t2if", "ns_name": "t2"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t2ns1if", "tenant_ns_ip": "10.1.11.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s1if", "tenant_sub_ip": "10.1.11.2/24"}], "vxlan": [{"dev": "t2s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.11.2", "remote_ip": "10.2.11.2", "remote_route": "10.2.11.0/24", "subnet_route": "10.1.11.0/24", "tenant_route_ip": "192.168.2.2", "v_name": "vxlan_t2s1"}]}, {"brif": "t2br1if2", "disk": "10G", "mem": 4, "name": "t2_VM2", "vcpu": 2, "vmif": "t2VM2if1"}]}
ok: [localhost] => (item=[{u'route': [{u'ip': u'10.1.12.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.1.12.1', u'bridge_name': u't2br2', u'dns': [{u'dnsif': u't2s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't2s2_dnsbrif'}], u'ns_name': u't2ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.12.2/24', u'tenant_ns_ip': u'10.1.12.1/24', u'tenant_ns_if': u't2ns2if', u'tenant_sub_if': u't2s2if', u'tenant_ns_name': u't2'}], u'subnet_ip': u'2.2.2.0/24', u'vxlan': [{u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}, {u'mem': 3, u'name': u't2_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't2br2if1', u'vmif': u't2VM3if1'}]) => {"ansible_loop_var": "item", "changed": false, "item": [{"bridge_name": "t2br2", "default_route_ip": "10.1.12.1", "dns": [{"brif": "t2s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t2s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns2", "route": [{"if": "p1", "ip": "10.1.12.1/24", "ns_if": "t2if", "ns_name": "t2"}], "subnet_ip": "2.2.2.0/24", "tenant_ns": [{"tenant_ns_if": "t2ns2if", "tenant_ns_ip": "10.1.12.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s2if", "tenant_sub_ip": "10.1.12.2/24"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, {"brif": "t2br2if1", "disk": "10G", "mem": 3, "name": "t2_VM3", "vcpu": 2, "vmif": "t2VM3if1"}]}

TASK [Attach VM interface] **********************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.11.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.1.11.1', u'bridge_name': u't2br1', u'dns': [{u'dnsif': u't2s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't2s1_dnsbrif'}], u'ns_name': u't2ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.11.2/24', u'tenant_ns_ip': u'10.1.11.1/24', u'tenant_ns_if': u't2ns1if', u'tenant_sub_if': u't2s1if', u'tenant_ns_name': u't2'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.1.11.2', u'dsport': 4789, u'dev': u't2s1if', u'tenant_route_ip': u'192.168.2.2', u'remote_route': u'10.2.11.0/24', u'subnet_route': u'10.1.11.0/24', u'v_name': u'vxlan_t2s1', u'id': 42, u'remote_ip': u'10.2.11.2'}]}, {u'mem': 2, u'name': u't2_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't2br1if1', u'vmif': u't2VM1if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "virsh domiflist \"t2_VM1\" | grep -w 't2VM1if1' ; if [ $? -ne 0 ] ; then virsh attach-interface \"t2_VM1\" direct \"t2VM1if1\" --live --persistent ; fi\n", "delta": "0:00:00.279785", "end": "2019-11-18 00:25:25.917564", "item": [{"bridge_name": "t2br1", "default_route_ip": "10.1.11.1", "dns": [{"brif": "t2s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t2s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns1", "route": [{"if": "p1", "ip": "10.1.11.1/24", "ns_if": "t2if", "ns_name": "t2"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t2ns1if", "tenant_ns_ip": "10.1.11.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s1if", "tenant_sub_ip": "10.1.11.2/24"}], "vxlan": [{"dev": "t2s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.11.2", "remote_ip": "10.2.11.2", "remote_route": "10.2.11.0/24", "subnet_route": "10.1.11.0/24", "tenant_route_ip": "192.168.2.2", "v_name": "vxlan_t2s1"}]}, {"brif": "t2br1if1", "disk": "10G", "mem": 2, "name": "t2_VM1", "vcpu": 4, "vmif": "t2VM1if1"}], "rc": 0, "start": "2019-11-18 00:25:25.637779", "stderr": "", "stderr_lines": [], "stdout": "Interface attached successfully", "stdout_lines": ["Interface attached successfully"]}
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.11.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.1.11.1', u'bridge_name': u't2br1', u'dns': [{u'dnsif': u't2s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't2s1_dnsbrif'}], u'ns_name': u't2ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.11.2/24', u'tenant_ns_ip': u'10.1.11.1/24', u'tenant_ns_if': u't2ns1if', u'tenant_sub_if': u't2s1if', u'tenant_ns_name': u't2'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.1.11.2', u'dsport': 4789, u'dev': u't2s1if', u'tenant_route_ip': u'192.168.2.2', u'remote_route': u'10.2.11.0/24', u'subnet_route': u'10.1.11.0/24', u'v_name': u'vxlan_t2s1', u'id': 42, u'remote_ip': u'10.2.11.2'}]}, {u'mem': 4, u'name': u't2_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't2br1if2', u'vmif': u't2VM2if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "virsh domiflist \"t2_VM2\" | grep -w 't2VM2if1' ; if [ $? -ne 0 ] ; then virsh attach-interface \"t2_VM2\" direct \"t2VM2if1\" --live --persistent ; fi\n", "delta": "0:00:00.440789", "end": "2019-11-18 00:25:26.617495", "item": [{"bridge_name": "t2br1", "default_route_ip": "10.1.11.1", "dns": [{"brif": "t2s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t2s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns1", "route": [{"if": "p1", "ip": "10.1.11.1/24", "ns_if": "t2if", "ns_name": "t2"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t2ns1if", "tenant_ns_ip": "10.1.11.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s1if", "tenant_sub_ip": "10.1.11.2/24"}], "vxlan": [{"dev": "t2s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.11.2", "remote_ip": "10.2.11.2", "remote_route": "10.2.11.0/24", "subnet_route": "10.1.11.0/24", "tenant_route_ip": "192.168.2.2", "v_name": "vxlan_t2s1"}]}, {"brif": "t2br1if2", "disk": "10G", "mem": 4, "name": "t2_VM2", "vcpu": 2, "vmif": "t2VM2if1"}], "rc": 0, "start": "2019-11-18 00:25:26.176706", "stderr": "", "stderr_lines": [], "stdout": "Interface attached successfully", "stdout_lines": ["Interface attached successfully"]}
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.12.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.1.12.1', u'bridge_name': u't2br2', u'dns': [{u'dnsif': u't2s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't2s2_dnsbrif'}], u'ns_name': u't2ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.12.2/24', u'tenant_ns_ip': u'10.1.12.1/24', u'tenant_ns_if': u't2ns2if', u'tenant_sub_if': u't2s2if', u'tenant_ns_name': u't2'}], u'subnet_ip': u'2.2.2.0/24', u'vxlan': [{u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}, {u'mem': 3, u'name': u't2_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't2br2if1', u'vmif': u't2VM3if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "virsh domiflist \"t2_VM3\" | grep -w 't2VM3if1' ; if [ $? -ne 0 ] ; then virsh attach-interface \"t2_VM3\" direct \"t2VM3if1\" --live --persistent ; fi\n", "delta": "0:00:00.474436", "end": "2019-11-18 00:25:27.421407", "item": [{"bridge_name": "t2br2", "default_route_ip": "10.1.12.1", "dns": [{"brif": "t2s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t2s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns2", "route": [{"if": "p1", "ip": "10.1.12.1/24", "ns_if": "t2if", "ns_name": "t2"}], "subnet_ip": "2.2.2.0/24", "tenant_ns": [{"tenant_ns_if": "t2ns2if", "tenant_ns_ip": "10.1.12.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s2if", "tenant_sub_ip": "10.1.12.2/24"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, {"brif": "t2br2if1", "disk": "10G", "mem": 3, "name": "t2_VM3", "vcpu": 2, "vmif": "t2VM3if1"}], "rc": 0, "start": "2019-11-18 00:25:26.946971", "stderr": "", "stderr_lines": [], "stdout": "Interface attached successfully", "stdout_lines": ["Interface attached successfully"]}

PLAY RECAP **************************************************************************************************************************************************
localhost                  : ok=7    changed=2    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0   

Using /etc/ansible/ansible.cfg as config file

PLAY [worker] ***********************************************************************************************************************************************

TASK [Copy VM image] ****************************************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.11.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.2.11.1', u'bridge_name': u't2br1', u'dns': [{u'dnsif': u't2s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't2s1_dnsbrif'}], u'ns_name': u't2ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.11.2/24', u'tenant_ns_ip': u'10.2.11.1/24', u'tenant_ns_if': u't2ns1if', u'tenant_sub_if': u't2s1if', u'tenant_ns_name': u't2'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.2.11.2', u'dsport': 4789, u'dev': u't2s1if', u'tenant_route_ip': u'192.168.130.2', u'remote_route': u'10.1.11.0/24', u'subnet_route': u'10.2.11.0/24', u'v_name': u'vxlan_t2s1', u'id': 42, u'remote_ip': u'10.1.11.2'}]}, {u'mem': 2, u'name': u't2_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't2br1if1', u'vmif': u't2VM4if1'}]) => {"ansible_loop_var": "item", "changed": true, "checksum": "f8b2ffa2bf201c84196c582f2dec0d33a1eb4b42", "dest": "/var/lib/libvirt/images/t2_VM4.qcow2", "gid": 0, "group": "root", "item": [{"bridge_name": "t2br1", "default_route_ip": "10.2.11.1", "dns": [{"brif": "t2s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t2s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns1", "route": [{"if": "p1", "ip": "10.2.11.1/24", "ns_if": "t2if", "ns_name": "t2"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t2ns1if", "tenant_ns_ip": "10.2.11.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s1if", "tenant_sub_ip": "10.2.11.2/24"}], "vxlan": [{"dev": "t2s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.11.2", "remote_ip": "10.1.11.2", "remote_route": "10.1.11.0/24", "subnet_route": "10.2.11.0/24", "tenant_route_ip": "192.168.130.2", "v_name": "vxlan_t2s1"}]}, {"brif": "t2br1if1", "disk": "10G", "mem": 2, "name": "t2_VM4", "vcpu": 4, "vmif": "t2VM4if1"}], "md5sum": "e6d5d524b68797ddd748ba1475985d34", "mode": "0644", "owner": "root", "size": 10739318784, "src": "/root/mainVM.qcow2", "state": "file", "uid": 0}

TASK [Get list of running VMs] ******************************************************************************************************************************
ok: [99.99.99.2] => {"changed": false, "cmd": ["virsh", "list", "--name"], "delta": "0:00:00.022856", "end": "2019-11-18 00:26:43.404397", "rc": 0, "start": "2019-11-18 00:26:43.381541", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Define VM] ********************************************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.11.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.2.11.1', u'bridge_name': u't2br1', u'dns': [{u'dnsif': u't2s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't2s1_dnsbrif'}], u'ns_name': u't2ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.11.2/24', u'tenant_ns_ip': u'10.2.11.1/24', u'tenant_ns_if': u't2ns1if', u'tenant_sub_if': u't2s1if', u'tenant_ns_name': u't2'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.2.11.2', u'dsport': 4789, u'dev': u't2s1if', u'tenant_route_ip': u'192.168.130.2', u'remote_route': u'10.1.11.0/24', u'subnet_route': u'10.2.11.0/24', u'v_name': u'vxlan_t2s1', u'id': 42, u'remote_ip': u'10.1.11.2'}]}, {u'mem': 2, u'name': u't2_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't2br1if1', u'vmif': u't2VM4if1'}]) => {"ansible_loop_var": "item", "changed": true, "created": "t2_VM4", "item": [{"bridge_name": "t2br1", "default_route_ip": "10.2.11.1", "dns": [{"brif": "t2s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t2s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns1", "route": [{"if": "p1", "ip": "10.2.11.1/24", "ns_if": "t2if", "ns_name": "t2"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t2ns1if", "tenant_ns_ip": "10.2.11.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s1if", "tenant_sub_ip": "10.2.11.2/24"}], "vxlan": [{"dev": "t2s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.11.2", "remote_ip": "10.1.11.2", "remote_route": "10.1.11.0/24", "subnet_route": "10.2.11.0/24", "tenant_route_ip": "192.168.130.2", "v_name": "vxlan_t2s1"}]}, {"brif": "t2br1if1", "disk": "10G", "mem": 2, "name": "t2_VM4", "vcpu": 4, "vmif": "t2VM4if1"}], "warnings": ["'xml' is given - ignoring 'name'"]}

TASK [Create VM] ********************************************************************************************************************************************
ok: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.11.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.2.11.1', u'bridge_name': u't2br1', u'dns': [{u'dnsif': u't2s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't2s1_dnsbrif'}], u'ns_name': u't2ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.11.2/24', u'tenant_ns_ip': u'10.2.11.1/24', u'tenant_ns_if': u't2ns1if', u'tenant_sub_if': u't2s1if', u'tenant_ns_name': u't2'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.2.11.2', u'dsport': 4789, u'dev': u't2s1if', u'tenant_route_ip': u'192.168.130.2', u'remote_route': u'10.1.11.0/24', u'subnet_route': u'10.2.11.0/24', u'v_name': u'vxlan_t2s1', u'id': 42, u'remote_ip': u'10.1.11.2'}]}, {u'mem': 2, u'name': u't2_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't2br1if1', u'vmif': u't2VM4if1'}]) => {"ansible_loop_var": "item", "changed": false, "create": 0, "item": [{"bridge_name": "t2br1", "default_route_ip": "10.2.11.1", "dns": [{"brif": "t2s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t2s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns1", "route": [{"if": "p1", "ip": "10.2.11.1/24", "ns_if": "t2if", "ns_name": "t2"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t2ns1if", "tenant_ns_ip": "10.2.11.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s1if", "tenant_sub_ip": "10.2.11.2/24"}], "vxlan": [{"dev": "t2s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.11.2", "remote_ip": "10.1.11.2", "remote_route": "10.1.11.0/24", "subnet_route": "10.2.11.0/24", "tenant_route_ip": "192.168.130.2", "v_name": "vxlan_t2s1"}]}, {"brif": "t2br1if1", "disk": "10G", "mem": 2, "name": "t2_VM4", "vcpu": 4, "vmif": "t2VM4if1"}]}

TASK [Start VM] *********************************************************************************************************************************************
ok: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.11.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.2.11.1', u'bridge_name': u't2br1', u'dns': [{u'dnsif': u't2s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't2s1_dnsbrif'}], u'ns_name': u't2ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.11.2/24', u'tenant_ns_ip': u'10.2.11.1/24', u'tenant_ns_if': u't2ns1if', u'tenant_sub_if': u't2s1if', u'tenant_ns_name': u't2'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.2.11.2', u'dsport': 4789, u'dev': u't2s1if', u'tenant_route_ip': u'192.168.130.2', u'remote_route': u'10.1.11.0/24', u'subnet_route': u'10.2.11.0/24', u'v_name': u'vxlan_t2s1', u'id': 42, u'remote_ip': u'10.1.11.2'}]}, {u'mem': 2, u'name': u't2_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't2br1if1', u'vmif': u't2VM4if1'}]) => {"ansible_loop_var": "item", "changed": false, "item": [{"bridge_name": "t2br1", "default_route_ip": "10.2.11.1", "dns": [{"brif": "t2s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t2s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns1", "route": [{"if": "p1", "ip": "10.2.11.1/24", "ns_if": "t2if", "ns_name": "t2"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t2ns1if", "tenant_ns_ip": "10.2.11.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s1if", "tenant_sub_ip": "10.2.11.2/24"}], "vxlan": [{"dev": "t2s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.11.2", "remote_ip": "10.1.11.2", "remote_route": "10.1.11.0/24", "subnet_route": "10.2.11.0/24", "tenant_route_ip": "192.168.130.2", "v_name": "vxlan_t2s1"}]}, {"brif": "t2br1if1", "disk": "10G", "mem": 2, "name": "t2_VM4", "vcpu": 4, "vmif": "t2VM4if1"}]}

TASK [Attach VM interface] **********************************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.11.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.2.11.1', u'bridge_name': u't2br1', u'dns': [{u'dnsif': u't2s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't2s1_dnsbrif'}], u'ns_name': u't2ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.11.2/24', u'tenant_ns_ip': u'10.2.11.1/24', u'tenant_ns_if': u't2ns1if', u'tenant_sub_if': u't2s1if', u'tenant_ns_name': u't2'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.2.11.2', u'dsport': 4789, u'dev': u't2s1if', u'tenant_route_ip': u'192.168.130.2', u'remote_route': u'10.1.11.0/24', u'subnet_route': u'10.2.11.0/24', u'v_name': u'vxlan_t2s1', u'id': 42, u'remote_ip': u'10.1.11.2'}]}, {u'mem': 2, u'name': u't2_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't2br1if1', u'vmif': u't2VM4if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "virsh domiflist \"t2_VM4\" | grep -w 't2VM4if1' ; if [ $? -ne 0 ] ; then virsh attach-interface \"t2_VM4\" direct \"t2VM4if1\" --live --persistent ; fi\n", "delta": "0:00:00.255081", "end": "2019-11-18 00:27:27.696048", "item": [{"bridge_name": "t2br1", "default_route_ip": "10.2.11.1", "dns": [{"brif": "t2s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t2s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns1", "route": [{"if": "p1", "ip": "10.2.11.1/24", "ns_if": "t2if", "ns_name": "t2"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t2ns1if", "tenant_ns_ip": "10.2.11.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s1if", "tenant_sub_ip": "10.2.11.2/24"}], "vxlan": [{"dev": "t2s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.11.2", "remote_ip": "10.1.11.2", "remote_route": "10.1.11.0/24", "subnet_route": "10.2.11.0/24", "tenant_route_ip": "192.168.130.2", "v_name": "vxlan_t2s1"}]}, {"brif": "t2br1if1", "disk": "10G", "mem": 2, "name": "t2_VM4", "vcpu": 4, "vmif": "t2VM4if1"}], "rc": 0, "start": "2019-11-18 00:27:27.440967", "stderr": "", "stderr_lines": [], "stdout": "Interface attached successfully", "stdout_lines": ["Interface attached successfully"]}

PLAY RECAP **************************************************************************************************************************************************
99.99.99.2                 : ok=6    changed=3    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0   

INFO:root: 00:41:52.235088 Unable to open user input yaml file
Using /etc/ansible/ansible.cfg as config file
Using /etc/ansible/ansible.cfg as config file
Using /etc/ansible/ansible.cfg as config file
Using /etc/ansible/ansible.cfg as config file
Using /etc/ansible/ansible.cfg as config file
Using /etc/ansible/ansible.cfg as config file
Using /etc/ansible/ansible.cfg as config file
Using /etc/ansible/ansible.cfg as config file
Using /etc/ansible/ansible.cfg as config file
Using /etc/ansible/ansible.cfg as config file
Using /etc/ansible/ansible.cfg as config file
Using /etc/ansible/ansible.cfg as config file
Using /etc/ansible/ansible.cfg as config file
Using /etc/ansible/ansible.cfg as config file
Using /etc/ansible/ansible.cfg as config file
Using /etc/ansible/ansible.cfg as config file
INFO:root: 00:42:02.403346 Unable to open user input yaml file
Using /etc/ansible/ansible.cfg as config file
Using /etc/ansible/ansible.cfg as config file
Using /etc/ansible/ansible.cfg as config file
Using /etc/ansible/ansible.cfg as config file
Using /etc/ansible/ansible.cfg as config file
Using /etc/ansible/ansible.cfg as config file
Using /etc/ansible/ansible.cfg as config file
Using /etc/ansible/ansible.cfg as config file
INFO:root: 01:11:00.621811 Printing the yaml input file
INFO:root: 01:11:00.622208 {'C1': [{'subnet_addr': '1.1.1.0/24', 'VM': [{'name': 'VM1', 'disk': '10G', 'mem': 2, 'vcpu': 4}, {'name': 'VM2', 'disk': '10G', 'mem': 4, 'vcpu': 2}]}, {'subnet_addr': '2.2.2.0/24', 'VM': [{'name': 'VM3', 'disk': '10G', 'mem': 3, 'vcpu': 2}]}], 'C2': [{'subnet_addr': '1.1.1.0/24', 'VM': [{'name': 'VM4', 'disk': '10G', 'mem': 2, 'vcpu': 4}]}]}
INFO:root: 01:11:00.622343 Provided subnet in C1: 1.1.1.0/24 is valid
INFO:root: 01:11:00.622396 Provided subnet in C1: 2.2.2.0/24 is valid
INFO:root: 01:11:00.622441 Provided subnet in C2: 1.1.1.0/24 is valid
INFO:root: 01:12:23.267810 Printing the yaml input file
INFO:root: 01:12:23.267952 {'C1': [{'subnet_addr': '1.1.1.0/24', 'VM': [{'name': 'VM1', 'disk': '10G', 'mem': 2, 'vcpu': 4}, {'name': 'VM2', 'disk': '10G', 'mem': 4, 'vcpu': 2}]}, {'subnet_addr': '2.2.2.0/24', 'VM': [{'name': 'VM3', 'disk': '10G', 'mem': 3, 'vcpu': 2}]}], 'C2': [{'subnet_addr': '1.1.1.0/24', 'VM': [{'name': 'VM4', 'disk': '10G', 'mem': 2, 'vcpu': 4}]}]}
INFO:root: 01:12:23.268051 Provided subnet in C1: 1.1.1.0/24 is valid
INFO:root: 01:12:23.268097 Provided subnet in C1: 2.2.2.0/24 is valid
INFO:root: 01:12:23.268137 Provided subnet in C2: 1.1.1.0/24 is valid
Using /etc/ansible/ansible.cfg as config file

PLAY [main] *************************************************************************************************************************************************

TASK [Create Tenant Namespace] ******************************************************************************************************************************
changed: [localhost] => (item={u'default_route_ip': u'192.168.4.1', u'name': u't4', u'pns_ip': u'192.168.4.1/24', u'tenant_if': u't4if', u'tenant_ip': u'192.168.4.2/24', u'pns_if': u't4pns_if'}) => {"ansible_loop_var": "item", "changed": true, "cmd": ["ip", "netns", "add", "t4"], "delta": "0:00:00.059058", "end": "2019-11-18 01:12:24.447238", "item": {"default_route_ip": "192.168.4.1", "name": "t4", "pns_if": "t4pns_if", "pns_ip": "192.168.4.1/24", "tenant_if": "t4if", "tenant_ip": "192.168.4.2/24"}, "rc": 0, "start": "2019-11-18 01:12:24.388180", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Create Subnet Namespace] ******************************************************************************************************************************
changed: [localhost] => (item={u'route': [{u'ip': u'10.1.31.1/24', u'ns_name': u't4', u'ns_if': u't4if', u'if': u'p1'}], u'default_route_ip': u'10.1.31.1', u'bridge_name': u't4br1', u'dns': [{u'dnsif': u't4s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't4s1_dnsbrif'}], u'ns_name': u't4ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.31.2/24', u'tenant_ns_ip': u'10.1.31.1/24', u'tenant_ns_if': u't4ns1if', u'tenant_ns_name': u't4', u'tenant_sub_if': u't4s1if'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't4_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't4br1if1', u'vmif': u't4VM1if1'}, {u'mem': 4, u'name': u't4_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't4br1if2', u'vmif': u't4VM2if1'}], u'vxlan': [{u'local_ip': u'10.1.31.2', u'tenant_route_ip': u'192.168.4.2', u'dsport': 4789, u'dev': u't4s1if', u'subnet_route': u'10.1.31.0/24', u'remote_route': u'10.2.31.0/24', u'v_name': u'vxlan_t4s1', u'id': 42, u'remote_ip': u'10.2.31.2'}]}) => {"ansible_loop_var": "item", "changed": true, "cmd": ["ip", "netns", "add", "t4ns1"], "delta": "0:00:00.064698", "end": "2019-11-18 01:12:24.794227", "item": {"bridge_name": "t4br1", "default_route_ip": "10.1.31.1", "dns": [{"brif": "t4s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t4s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t4ns1", "route": [{"if": "p1", "ip": "10.1.31.1/24", "ns_if": "t4if", "ns_name": "t4"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t4ns1if", "tenant_ns_ip": "10.1.31.1/24", "tenant_ns_name": "t4", "tenant_sub_if": "t4s1if", "tenant_sub_ip": "10.1.31.2/24"}], "vms": [{"brif": "t4br1if1", "disk": "10G", "mem": 2, "name": "t4_VM1", "vcpu": 4, "vmif": "t4VM1if1"}, {"brif": "t4br1if2", "disk": "10G", "mem": 4, "name": "t4_VM2", "vcpu": 2, "vmif": "t4VM2if1"}], "vxlan": [{"dev": "t4s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.31.2", "remote_ip": "10.2.31.2", "remote_route": "10.2.31.0/24", "subnet_route": "10.1.31.0/24", "tenant_route_ip": "192.168.4.2", "v_name": "vxlan_t4s1"}]}, "rc": 0, "start": "2019-11-18 01:12:24.729529", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}
changed: [localhost] => (item={u'route': [{u'ip': u'10.1.32.1/24', u'ns_name': u't4', u'ns_if': u't4if', u'if': u'p1'}], u'default_route_ip': u'10.1.32.1', u'bridge_name': u't4br2', u'dns': [{u'dnsif': u't4s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't4s2_dnsbrif'}], u'ns_name': u't4ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.32.2/24', u'tenant_ns_ip': u'10.1.32.1/24', u'tenant_ns_if': u't4ns2if', u'tenant_ns_name': u't4', u'tenant_sub_if': u't4s2if'}], u'subnet_ip': u'2.2.2.0/24', u'vms': [{u'mem': 3, u'name': u't4_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't4br2if1', u'vmif': u't4VM3if1'}], u'vxlan': [{u'local_ip': [], u'tenant_route_ip': [], u'dsport': [], u'dev': [], u'subnet_route': [], u'remote_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}) => {"ansible_loop_var": "item", "changed": true, "cmd": ["ip", "netns", "add", "t4ns2"], "delta": "0:00:00.056288", "end": "2019-11-18 01:12:25.062128", "item": {"bridge_name": "t4br2", "default_route_ip": "10.1.32.1", "dns": [{"brif": "t4s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t4s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t4ns2", "route": [{"if": "p1", "ip": "10.1.32.1/24", "ns_if": "t4if", "ns_name": "t4"}], "subnet_ip": "2.2.2.0/24", "tenant_ns": [{"tenant_ns_if": "t4ns2if", "tenant_ns_ip": "10.1.32.1/24", "tenant_ns_name": "t4", "tenant_sub_if": "t4s2if", "tenant_sub_ip": "10.1.32.2/24"}], "vms": [{"brif": "t4br2if1", "disk": "10G", "mem": 3, "name": "t4_VM3", "vcpu": 2, "vmif": "t4VM3if1"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, "rc": 0, "start": "2019-11-18 01:12:25.005840", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Create Tenant VETH pairs] *****************************************************************************************************************************
changed: [localhost] => (item={u'default_route_ip': u'192.168.4.1', u'name': u't4', u'pns_ip': u'192.168.4.1/24', u'tenant_if': u't4if', u'tenant_ip': u'192.168.4.2/24', u'pns_if': u't4pns_if'}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip link show \"t4if\" ; if [ $? -ne 0 ] ; then ip link add \"t4if\" type veth peer name \"t4pns_if\" ; fi\n", "delta": "0:00:00.009990", "end": "2019-11-18 01:12:25.329853", "item": {"default_route_ip": "192.168.4.1", "name": "t4", "pns_if": "t4pns_if", "pns_ip": "192.168.4.1/24", "tenant_if": "t4if", "tenant_ip": "192.168.4.2/24"}, "rc": 0, "start": "2019-11-18 01:12:25.319863", "stderr": "Device \"t4if\" does not exist.", "stderr_lines": ["Device \"t4if\" does not exist."], "stdout": "", "stdout_lines": []}

TASK [Attach Tenant VETH Pairs] *****************************************************************************************************************************
changed: [localhost] => (item={u'default_route_ip': u'192.168.4.1', u'name': u't4', u'pns_ip': u'192.168.4.1/24', u'tenant_if': u't4if', u'tenant_ip': u'192.168.4.2/24', u'pns_if': u't4pns_if'}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec pns ip link show \"t4pns_if\" ; if [ $? -ne 0 ] ; then ip link set \"t4pns_if\" netns pns ; fi\nip netns exec \"t4\" ip link show \"t4if\" ; if [ $? -ne 0 ] ; then ip link set \"t4if\" netns \"t4\" ; fi\nip netns exec pns ip link set dev \"t4pns_if\" up\nip netns exec \"t4\" ip link set dev \"t4if\" up\n", "delta": "0:00:00.206879", "end": "2019-11-18 01:12:25.797672", "item": {"default_route_ip": "192.168.4.1", "name": "t4", "pns_if": "t4pns_if", "pns_ip": "192.168.4.1/24", "tenant_if": "t4if", "tenant_ip": "192.168.4.2/24"}, "rc": 0, "start": "2019-11-18 01:12:25.590793", "stderr": "Device \"t4pns_if\" does not exist.\nDevice \"t4if\" does not exist.", "stderr_lines": ["Device \"t4pns_if\" does not exist.", "Device \"t4if\" does not exist."], "stdout": "", "stdout_lines": []}

TASK [Add IP addresses to Tenant VETH Pairs] ****************************************************************************************************************
changed: [localhost] => (item={u'default_route_ip': u'192.168.4.1', u'name': u't4', u'pns_ip': u'192.168.4.1/24', u'tenant_if': u't4if', u'tenant_ip': u'192.168.4.2/24', u'pns_if': u't4pns_if'}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec pns ip addr show \"t4pns_if\" | awk 'FNR==3{ print $2 }' | grep -w '^192.168.4.1/24' ; if [ $? -ne 0 ] ; then ip netns exec pns ip addr add \"192.168.4.1/24\" dev \"t4pns_if\" ; fi\nip netns exec \"t4\" ip addr show \"t4if\" | awk 'FNR==3{ print $2 }' | grep -w '^192.168.4.2/24' ; if [ $? -ne 0 ] ; then ip netns exec \"t4\" ip addr add \"192.168.4.2/24\" dev \"t4if\" ; fi\n", "delta": "0:00:00.148394", "end": "2019-11-18 01:12:26.218062", "item": {"default_route_ip": "192.168.4.1", "name": "t4", "pns_if": "t4pns_if", "pns_ip": "192.168.4.1/24", "tenant_if": "t4if", "tenant_ip": "192.168.4.2/24"}, "rc": 0, "start": "2019-11-18 01:12:26.069668", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Create Namespace VETH Pairs] **************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.31.1/24', u'ns_name': u't4', u'ns_if': u't4if', u'if': u'p1'}], u'default_route_ip': u'10.1.31.1', u'bridge_name': u't4br1', u'dns': [{u'dnsif': u't4s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't4s1_dnsbrif'}], u'ns_name': u't4ns1', u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't4_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't4br1if1', u'vmif': u't4VM1if1'}, {u'mem': 4, u'name': u't4_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't4br1if2', u'vmif': u't4VM2if1'}], u'vxlan': [{u'local_ip': u'10.1.31.2', u'dsport': 4789, u'dev': u't4s1if', u'tenant_route_ip': u'192.168.4.2', u'remote_route': u'10.2.31.0/24', u'subnet_route': u'10.1.31.0/24', u'v_name': u'vxlan_t4s1', u'id': 42, u'remote_ip': u'10.2.31.2'}]}, {u'tenant_sub_ip': u'10.1.31.2/24', u'tenant_ns_ip': u'10.1.31.1/24', u'tenant_ns_if': u't4ns1if', u'tenant_sub_if': u't4s1if', u'tenant_ns_name': u't4'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip link show \"t4ns1if\" ; if [ $? -ne 0 ] ; then ip link add \"t4ns1if\" type veth peer name \"t4s1if\" ; fi\n", "delta": "0:00:00.012882", "end": "2019-11-18 01:12:26.506250", "item": [{"bridge_name": "t4br1", "default_route_ip": "10.1.31.1", "dns": [{"brif": "t4s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t4s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t4ns1", "route": [{"if": "p1", "ip": "10.1.31.1/24", "ns_if": "t4if", "ns_name": "t4"}], "subnet_ip": "1.1.1.0/24", "vms": [{"brif": "t4br1if1", "disk": "10G", "mem": 2, "name": "t4_VM1", "vcpu": 4, "vmif": "t4VM1if1"}, {"brif": "t4br1if2", "disk": "10G", "mem": 4, "name": "t4_VM2", "vcpu": 2, "vmif": "t4VM2if1"}], "vxlan": [{"dev": "t4s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.31.2", "remote_ip": "10.2.31.2", "remote_route": "10.2.31.0/24", "subnet_route": "10.1.31.0/24", "tenant_route_ip": "192.168.4.2", "v_name": "vxlan_t4s1"}]}, {"tenant_ns_if": "t4ns1if", "tenant_ns_ip": "10.1.31.1/24", "tenant_ns_name": "t4", "tenant_sub_if": "t4s1if", "tenant_sub_ip": "10.1.31.2/24"}], "rc": 0, "start": "2019-11-18 01:12:26.493368", "stderr": "Device \"t4ns1if\" does not exist.", "stderr_lines": ["Device \"t4ns1if\" does not exist."], "stdout": "", "stdout_lines": []}
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.32.1/24', u'ns_name': u't4', u'ns_if': u't4if', u'if': u'p1'}], u'default_route_ip': u'10.1.32.1', u'bridge_name': u't4br2', u'dns': [{u'dnsif': u't4s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't4s2_dnsbrif'}], u'ns_name': u't4ns2', u'subnet_ip': u'2.2.2.0/24', u'vms': [{u'mem': 3, u'name': u't4_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't4br2if1', u'vmif': u't4VM3if1'}], u'vxlan': [{u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}, {u'tenant_sub_ip': u'10.1.32.2/24', u'tenant_ns_ip': u'10.1.32.1/24', u'tenant_ns_if': u't4ns2if', u'tenant_sub_if': u't4s2if', u'tenant_ns_name': u't4'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip link show \"t4ns2if\" ; if [ $? -ne 0 ] ; then ip link add \"t4ns2if\" type veth peer name \"t4s2if\" ; fi\n", "delta": "0:00:00.015166", "end": "2019-11-18 01:12:26.742269", "item": [{"bridge_name": "t4br2", "default_route_ip": "10.1.32.1", "dns": [{"brif": "t4s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t4s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t4ns2", "route": [{"if": "p1", "ip": "10.1.32.1/24", "ns_if": "t4if", "ns_name": "t4"}], "subnet_ip": "2.2.2.0/24", "vms": [{"brif": "t4br2if1", "disk": "10G", "mem": 3, "name": "t4_VM3", "vcpu": 2, "vmif": "t4VM3if1"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, {"tenant_ns_if": "t4ns2if", "tenant_ns_ip": "10.1.32.1/24", "tenant_ns_name": "t4", "tenant_sub_if": "t4s2if", "tenant_sub_ip": "10.1.32.2/24"}], "rc": 0, "start": "2019-11-18 01:12:26.727103", "stderr": "Device \"t4ns2if\" does not exist.", "stderr_lines": ["Device \"t4ns2if\" does not exist."], "stdout": "", "stdout_lines": []}

TASK [Attach Namespace VETH Pairs] **************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.31.1/24', u'ns_name': u't4', u'ns_if': u't4if', u'if': u'p1'}], u'default_route_ip': u'10.1.31.1', u'bridge_name': u't4br1', u'dns': [{u'dnsif': u't4s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't4s1_dnsbrif'}], u'ns_name': u't4ns1', u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't4_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't4br1if1', u'vmif': u't4VM1if1'}, {u'mem': 4, u'name': u't4_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't4br1if2', u'vmif': u't4VM2if1'}], u'vxlan': [{u'local_ip': u'10.1.31.2', u'dsport': 4789, u'dev': u't4s1if', u'tenant_route_ip': u'192.168.4.2', u'remote_route': u'10.2.31.0/24', u'subnet_route': u'10.1.31.0/24', u'v_name': u'vxlan_t4s1', u'id': 42, u'remote_ip': u'10.2.31.2'}]}, {u'tenant_sub_ip': u'10.1.31.2/24', u'tenant_ns_ip': u'10.1.31.1/24', u'tenant_ns_if': u't4ns1if', u'tenant_sub_if': u't4s1if', u'tenant_ns_name': u't4'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t4\" ip link show \"t4ns1if\" ; if [ $? -ne 0 ] ; then ip link set \"t4ns1if\" netns \"t4\" ; fi\nip netns exec \"t4ns1\" ip link show \"t4s1if\" ; if [ $? -ne 0 ] ; then ip link set \"t4s1if\" netns \"t4ns1\" ; fi\n", "delta": "0:00:00.115226", "end": "2019-11-18 01:12:27.142534", "item": [{"bridge_name": "t4br1", "default_route_ip": "10.1.31.1", "dns": [{"brif": "t4s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t4s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t4ns1", "route": [{"if": "p1", "ip": "10.1.31.1/24", "ns_if": "t4if", "ns_name": "t4"}], "subnet_ip": "1.1.1.0/24", "vms": [{"brif": "t4br1if1", "disk": "10G", "mem": 2, "name": "t4_VM1", "vcpu": 4, "vmif": "t4VM1if1"}, {"brif": "t4br1if2", "disk": "10G", "mem": 4, "name": "t4_VM2", "vcpu": 2, "vmif": "t4VM2if1"}], "vxlan": [{"dev": "t4s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.31.2", "remote_ip": "10.2.31.2", "remote_route": "10.2.31.0/24", "subnet_route": "10.1.31.0/24", "tenant_route_ip": "192.168.4.2", "v_name": "vxlan_t4s1"}]}, {"tenant_ns_if": "t4ns1if", "tenant_ns_ip": "10.1.31.1/24", "tenant_ns_name": "t4", "tenant_sub_if": "t4s1if", "tenant_sub_ip": "10.1.31.2/24"}], "rc": 0, "start": "2019-11-18 01:12:27.027308", "stderr": "Device \"t4ns1if\" does not exist.\nDevice \"t4s1if\" does not exist.", "stderr_lines": ["Device \"t4ns1if\" does not exist.", "Device \"t4s1if\" does not exist."], "stdout": "", "stdout_lines": []}
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.32.1/24', u'ns_name': u't4', u'ns_if': u't4if', u'if': u'p1'}], u'default_route_ip': u'10.1.32.1', u'bridge_name': u't4br2', u'dns': [{u'dnsif': u't4s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't4s2_dnsbrif'}], u'ns_name': u't4ns2', u'subnet_ip': u'2.2.2.0/24', u'vms': [{u'mem': 3, u'name': u't4_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't4br2if1', u'vmif': u't4VM3if1'}], u'vxlan': [{u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}, {u'tenant_sub_ip': u'10.1.32.2/24', u'tenant_ns_ip': u'10.1.32.1/24', u'tenant_ns_if': u't4ns2if', u'tenant_sub_if': u't4s2if', u'tenant_ns_name': u't4'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t4\" ip link show \"t4ns2if\" ; if [ $? -ne 0 ] ; then ip link set \"t4ns2if\" netns \"t4\" ; fi\nip netns exec \"t4ns2\" ip link show \"t4s2if\" ; if [ $? -ne 0 ] ; then ip link set \"t4s2if\" netns \"t4ns2\" ; fi\n", "delta": "0:00:00.131499", "end": "2019-11-18 01:12:27.500640", "item": [{"bridge_name": "t4br2", "default_route_ip": "10.1.32.1", "dns": [{"brif": "t4s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t4s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t4ns2", "route": [{"if": "p1", "ip": "10.1.32.1/24", "ns_if": "t4if", "ns_name": "t4"}], "subnet_ip": "2.2.2.0/24", "vms": [{"brif": "t4br2if1", "disk": "10G", "mem": 3, "name": "t4_VM3", "vcpu": 2, "vmif": "t4VM3if1"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, {"tenant_ns_if": "t4ns2if", "tenant_ns_ip": "10.1.32.1/24", "tenant_ns_name": "t4", "tenant_sub_if": "t4s2if", "tenant_sub_ip": "10.1.32.2/24"}], "rc": 0, "start": "2019-11-18 01:12:27.369141", "stderr": "Device \"t4ns2if\" does not exist.\nDevice \"t4s2if\" does not exist.", "stderr_lines": ["Device \"t4ns2if\" does not exist.", "Device \"t4s2if\" does not exist."], "stdout": "", "stdout_lines": []}

TASK [Set Namespace VETH Pairs UP] **************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.31.1/24', u'ns_name': u't4', u'ns_if': u't4if', u'if': u'p1'}], u'default_route_ip': u'10.1.31.1', u'bridge_name': u't4br1', u'dns': [{u'dnsif': u't4s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't4s1_dnsbrif'}], u'ns_name': u't4ns1', u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't4_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't4br1if1', u'vmif': u't4VM1if1'}, {u'mem': 4, u'name': u't4_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't4br1if2', u'vmif': u't4VM2if1'}], u'vxlan': [{u'local_ip': u'10.1.31.2', u'dsport': 4789, u'dev': u't4s1if', u'tenant_route_ip': u'192.168.4.2', u'remote_route': u'10.2.31.0/24', u'subnet_route': u'10.1.31.0/24', u'v_name': u'vxlan_t4s1', u'id': 42, u'remote_ip': u'10.2.31.2'}]}, {u'tenant_sub_ip': u'10.1.31.2/24', u'tenant_ns_ip': u'10.1.31.1/24', u'tenant_ns_if': u't4ns1if', u'tenant_sub_if': u't4s1if', u'tenant_ns_name': u't4'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t4\" ip link set dev \"t4ns1if\" up\nip netns exec \"t4ns1\" ip link set dev \"t4s1if\" up\n", "delta": "0:00:00.072150", "end": "2019-11-18 01:12:27.854003", "item": [{"bridge_name": "t4br1", "default_route_ip": "10.1.31.1", "dns": [{"brif": "t4s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t4s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t4ns1", "route": [{"if": "p1", "ip": "10.1.31.1/24", "ns_if": "t4if", "ns_name": "t4"}], "subnet_ip": "1.1.1.0/24", "vms": [{"brif": "t4br1if1", "disk": "10G", "mem": 2, "name": "t4_VM1", "vcpu": 4, "vmif": "t4VM1if1"}, {"brif": "t4br1if2", "disk": "10G", "mem": 4, "name": "t4_VM2", "vcpu": 2, "vmif": "t4VM2if1"}], "vxlan": [{"dev": "t4s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.31.2", "remote_ip": "10.2.31.2", "remote_route": "10.2.31.0/24", "subnet_route": "10.1.31.0/24", "tenant_route_ip": "192.168.4.2", "v_name": "vxlan_t4s1"}]}, {"tenant_ns_if": "t4ns1if", "tenant_ns_ip": "10.1.31.1/24", "tenant_ns_name": "t4", "tenant_sub_if": "t4s1if", "tenant_sub_ip": "10.1.31.2/24"}], "rc": 0, "start": "2019-11-18 01:12:27.781853", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.32.1/24', u'ns_name': u't4', u'ns_if': u't4if', u'if': u'p1'}], u'default_route_ip': u'10.1.32.1', u'bridge_name': u't4br2', u'dns': [{u'dnsif': u't4s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't4s2_dnsbrif'}], u'ns_name': u't4ns2', u'subnet_ip': u'2.2.2.0/24', u'vms': [{u'mem': 3, u'name': u't4_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't4br2if1', u'vmif': u't4VM3if1'}], u'vxlan': [{u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}, {u'tenant_sub_ip': u'10.1.32.2/24', u'tenant_ns_ip': u'10.1.32.1/24', u'tenant_ns_if': u't4ns2if', u'tenant_sub_if': u't4s2if', u'tenant_ns_name': u't4'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t4\" ip link set dev \"t4ns2if\" up\nip netns exec \"t4ns2\" ip link set dev \"t4s2if\" up\n", "delta": "0:00:00.076077", "end": "2019-11-18 01:12:28.137733", "item": [{"bridge_name": "t4br2", "default_route_ip": "10.1.32.1", "dns": [{"brif": "t4s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t4s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t4ns2", "route": [{"if": "p1", "ip": "10.1.32.1/24", "ns_if": "t4if", "ns_name": "t4"}], "subnet_ip": "2.2.2.0/24", "vms": [{"brif": "t4br2if1", "disk": "10G", "mem": 3, "name": "t4_VM3", "vcpu": 2, "vmif": "t4VM3if1"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, {"tenant_ns_if": "t4ns2if", "tenant_ns_ip": "10.1.32.1/24", "tenant_ns_name": "t4", "tenant_sub_if": "t4s2if", "tenant_sub_ip": "10.1.32.2/24"}], "rc": 0, "start": "2019-11-18 01:12:28.061656", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Add IP addresses to Namespace VETH Pairs] *************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.31.1/24', u'ns_name': u't4', u'ns_if': u't4if', u'if': u'p1'}], u'default_route_ip': u'10.1.31.1', u'bridge_name': u't4br1', u'dns': [{u'dnsif': u't4s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't4s1_dnsbrif'}], u'ns_name': u't4ns1', u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't4_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't4br1if1', u'vmif': u't4VM1if1'}, {u'mem': 4, u'name': u't4_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't4br1if2', u'vmif': u't4VM2if1'}], u'vxlan': [{u'local_ip': u'10.1.31.2', u'dsport': 4789, u'dev': u't4s1if', u'tenant_route_ip': u'192.168.4.2', u'remote_route': u'10.2.31.0/24', u'subnet_route': u'10.1.31.0/24', u'v_name': u'vxlan_t4s1', u'id': 42, u'remote_ip': u'10.2.31.2'}]}, {u'tenant_sub_ip': u'10.1.31.2/24', u'tenant_ns_ip': u'10.1.31.1/24', u'tenant_ns_if': u't4ns1if', u'tenant_sub_if': u't4s1if', u'tenant_ns_name': u't4'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t4ns1\" ip addr show \"t4s1if\" | awk 'FNR==3{ print $2 }' | grep -w '^10.1.31.2/24' ; if [ $? -ne 0 ] ; then ip netns exec \"t4ns1\" ip addr add \"10.1.31.2/24\" dev \"t4s1if\" ; fi\n\nip netns exec \"t4\" ip addr show \"t4ns1if\" | awk 'FNR==3{ print $2 }' | grep -w '^10.1.31.1/24' ; if [ $? -ne 0 ] ; then ip netns exec \"t4\" ip addr add \"10.1.31.1/24\" dev \"t4ns1if\" ; fi\n", "delta": "0:00:00.162527", "end": "2019-11-18 01:12:28.561792", "item": [{"bridge_name": "t4br1", "default_route_ip": "10.1.31.1", "dns": [{"brif": "t4s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t4s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t4ns1", "route": [{"if": "p1", "ip": "10.1.31.1/24", "ns_if": "t4if", "ns_name": "t4"}], "subnet_ip": "1.1.1.0/24", "vms": [{"brif": "t4br1if1", "disk": "10G", "mem": 2, "name": "t4_VM1", "vcpu": 4, "vmif": "t4VM1if1"}, {"brif": "t4br1if2", "disk": "10G", "mem": 4, "name": "t4_VM2", "vcpu": 2, "vmif": "t4VM2if1"}], "vxlan": [{"dev": "t4s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.31.2", "remote_ip": "10.2.31.2", "remote_route": "10.2.31.0/24", "subnet_route": "10.1.31.0/24", "tenant_route_ip": "192.168.4.2", "v_name": "vxlan_t4s1"}]}, {"tenant_ns_if": "t4ns1if", "tenant_ns_ip": "10.1.31.1/24", "tenant_ns_name": "t4", "tenant_sub_if": "t4s1if", "tenant_sub_ip": "10.1.31.2/24"}], "rc": 0, "start": "2019-11-18 01:12:28.399265", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.32.1/24', u'ns_name': u't4', u'ns_if': u't4if', u'if': u'p1'}], u'default_route_ip': u'10.1.32.1', u'bridge_name': u't4br2', u'dns': [{u'dnsif': u't4s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't4s2_dnsbrif'}], u'ns_name': u't4ns2', u'subnet_ip': u'2.2.2.0/24', u'vms': [{u'mem': 3, u'name': u't4_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't4br2if1', u'vmif': u't4VM3if1'}], u'vxlan': [{u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}, {u'tenant_sub_ip': u'10.1.32.2/24', u'tenant_ns_ip': u'10.1.32.1/24', u'tenant_ns_if': u't4ns2if', u'tenant_sub_if': u't4s2if', u'tenant_ns_name': u't4'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t4ns2\" ip addr show \"t4s2if\" | awk 'FNR==3{ print $2 }' | grep -w '^10.1.32.2/24' ; if [ $? -ne 0 ] ; then ip netns exec \"t4ns2\" ip addr add \"10.1.32.2/24\" dev \"t4s2if\" ; fi\n\nip netns exec \"t4\" ip addr show \"t4ns2if\" | awk 'FNR==3{ print $2 }' | grep -w '^10.1.32.1/24' ; if [ $? -ne 0 ] ; then ip netns exec \"t4\" ip addr add \"10.1.32.1/24\" dev \"t4ns2if\" ; fi\n", "delta": "0:00:00.148002", "end": "2019-11-18 01:12:28.909933", "item": [{"bridge_name": "t4br2", "default_route_ip": "10.1.32.1", "dns": [{"brif": "t4s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t4s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t4ns2", "route": [{"if": "p1", "ip": "10.1.32.1/24", "ns_if": "t4if", "ns_name": "t4"}], "subnet_ip": "2.2.2.0/24", "vms": [{"brif": "t4br2if1", "disk": "10G", "mem": 3, "name": "t4_VM3", "vcpu": 2, "vmif": "t4VM3if1"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, {"tenant_ns_if": "t4ns2if", "tenant_ns_ip": "10.1.32.1/24", "tenant_ns_name": "t4", "tenant_sub_if": "t4s2if", "tenant_sub_ip": "10.1.32.2/24"}], "rc": 0, "start": "2019-11-18 01:12:28.761931", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Add IP Route to Tenant] *******************************************************************************************************************************
changed: [localhost] => (item={u'default_route_ip': u'192.168.4.1', u'name': u't4', u'pns_ip': u'192.168.4.1/24', u'tenant_if': u't4if', u'tenant_ip': u'192.168.4.2/24', u'pns_if': u't4pns_if'}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t4\" ip route show default | grep -w '[d]efault via 192.168.4.1' ; if [ $? -ne 0 ] ; then ip netns exec \"t4\" ip route add default via \"192.168.4.1\" ; fi\n", "delta": "0:00:00.081303", "end": "2019-11-18 01:12:29.269989", "item": {"default_route_ip": "192.168.4.1", "name": "t4", "pns_if": "t4pns_if", "pns_ip": "192.168.4.1/24", "tenant_if": "t4if", "tenant_ip": "192.168.4.2/24"}, "rc": 0, "start": "2019-11-18 01:12:29.188686", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Add IP Route to Tenant Subnet] ************************************************************************************************************************
changed: [localhost] => (item={u'route': [{u'ip': u'10.1.31.1/24', u'ns_name': u't4', u'ns_if': u't4if', u'if': u'p1'}], u'default_route_ip': u'10.1.31.1', u'bridge_name': u't4br1', u'dns': [{u'dnsif': u't4s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't4s1_dnsbrif'}], u'ns_name': u't4ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.31.2/24', u'tenant_ns_ip': u'10.1.31.1/24', u'tenant_ns_if': u't4ns1if', u'tenant_ns_name': u't4', u'tenant_sub_if': u't4s1if'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't4_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't4br1if1', u'vmif': u't4VM1if1'}, {u'mem': 4, u'name': u't4_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't4br1if2', u'vmif': u't4VM2if1'}], u'vxlan': [{u'local_ip': u'10.1.31.2', u'tenant_route_ip': u'192.168.4.2', u'dsport': 4789, u'dev': u't4s1if', u'subnet_route': u'10.1.31.0/24', u'remote_route': u'10.2.31.0/24', u'v_name': u'vxlan_t4s1', u'id': 42, u'remote_ip': u'10.2.31.2'}]}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t4ns1\" ip route show default | grep -w '[d]efault via 10.1.31.1' ; if [ $? -ne 0 ] ; then ip netns exec \"t4ns1\" ip route add default via \"10.1.31.1\" ; fi\n", "delta": "0:00:00.098505", "end": "2019-11-18 01:12:29.658041", "item": {"bridge_name": "t4br1", "default_route_ip": "10.1.31.1", "dns": [{"brif": "t4s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t4s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t4ns1", "route": [{"if": "p1", "ip": "10.1.31.1/24", "ns_if": "t4if", "ns_name": "t4"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t4ns1if", "tenant_ns_ip": "10.1.31.1/24", "tenant_ns_name": "t4", "tenant_sub_if": "t4s1if", "tenant_sub_ip": "10.1.31.2/24"}], "vms": [{"brif": "t4br1if1", "disk": "10G", "mem": 2, "name": "t4_VM1", "vcpu": 4, "vmif": "t4VM1if1"}, {"brif": "t4br1if2", "disk": "10G", "mem": 4, "name": "t4_VM2", "vcpu": 2, "vmif": "t4VM2if1"}], "vxlan": [{"dev": "t4s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.31.2", "remote_ip": "10.2.31.2", "remote_route": "10.2.31.0/24", "subnet_route": "10.1.31.0/24", "tenant_route_ip": "192.168.4.2", "v_name": "vxlan_t4s1"}]}, "rc": 0, "start": "2019-11-18 01:12:29.559536", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}
changed: [localhost] => (item={u'route': [{u'ip': u'10.1.32.1/24', u'ns_name': u't4', u'ns_if': u't4if', u'if': u'p1'}], u'default_route_ip': u'10.1.32.1', u'bridge_name': u't4br2', u'dns': [{u'dnsif': u't4s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't4s2_dnsbrif'}], u'ns_name': u't4ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.32.2/24', u'tenant_ns_ip': u'10.1.32.1/24', u'tenant_ns_if': u't4ns2if', u'tenant_ns_name': u't4', u'tenant_sub_if': u't4s2if'}], u'subnet_ip': u'2.2.2.0/24', u'vms': [{u'mem': 3, u'name': u't4_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't4br2if1', u'vmif': u't4VM3if1'}], u'vxlan': [{u'local_ip': [], u'tenant_route_ip': [], u'dsport': [], u'dev': [], u'subnet_route': [], u'remote_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t4ns2\" ip route show default | grep -w '[d]efault via 10.1.32.1' ; if [ $? -ne 0 ] ; then ip netns exec \"t4ns2\" ip route add default via \"10.1.32.1\" ; fi\n", "delta": "0:00:00.082307", "end": "2019-11-18 01:12:29.961989", "item": {"bridge_name": "t4br2", "default_route_ip": "10.1.32.1", "dns": [{"brif": "t4s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t4s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t4ns2", "route": [{"if": "p1", "ip": "10.1.32.1/24", "ns_if": "t4if", "ns_name": "t4"}], "subnet_ip": "2.2.2.0/24", "tenant_ns": [{"tenant_ns_if": "t4ns2if", "tenant_ns_ip": "10.1.32.1/24", "tenant_ns_name": "t4", "tenant_sub_if": "t4s2if", "tenant_sub_ip": "10.1.32.2/24"}], "vms": [{"brif": "t4br2if1", "disk": "10G", "mem": 3, "name": "t4_VM3", "vcpu": 2, "vmif": "t4VM3if1"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, "rc": 0, "start": "2019-11-18 01:12:29.879682", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Create bridge inside namespace] ***********************************************************************************************************************
changed: [localhost] => (item={u'route': [{u'ip': u'10.1.31.1/24', u'ns_name': u't4', u'ns_if': u't4if', u'if': u'p1'}], u'default_route_ip': u'10.1.31.1', u'bridge_name': u't4br1', u'dns': [{u'dnsif': u't4s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't4s1_dnsbrif'}], u'ns_name': u't4ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.31.2/24', u'tenant_ns_ip': u'10.1.31.1/24', u'tenant_ns_if': u't4ns1if', u'tenant_ns_name': u't4', u'tenant_sub_if': u't4s1if'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't4_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't4br1if1', u'vmif': u't4VM1if1'}, {u'mem': 4, u'name': u't4_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't4br1if2', u'vmif': u't4VM2if1'}], u'vxlan': [{u'local_ip': u'10.1.31.2', u'tenant_route_ip': u'192.168.4.2', u'dsport': 4789, u'dev': u't4s1if', u'subnet_route': u'10.1.31.0/24', u'remote_route': u'10.2.31.0/24', u'v_name': u'vxlan_t4s1', u'id': 42, u'remote_ip': u'10.2.31.2'}]}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t4ns1\" brctl show | grep -w '^t4br1'; if [ $? -ne 0 ] ; then ip netns exec \"t4ns1\" brctl addbr \"t4br1\" ; fi\nip netns exec \"t4ns1\" ip link set dev \"t4br1\" up\n", "delta": "0:00:00.112135", "end": "2019-11-18 01:12:30.362042", "item": {"bridge_name": "t4br1", "default_route_ip": "10.1.31.1", "dns": [{"brif": "t4s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t4s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t4ns1", "route": [{"if": "p1", "ip": "10.1.31.1/24", "ns_if": "t4if", "ns_name": "t4"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t4ns1if", "tenant_ns_ip": "10.1.31.1/24", "tenant_ns_name": "t4", "tenant_sub_if": "t4s1if", "tenant_sub_ip": "10.1.31.2/24"}], "vms": [{"brif": "t4br1if1", "disk": "10G", "mem": 2, "name": "t4_VM1", "vcpu": 4, "vmif": "t4VM1if1"}, {"brif": "t4br1if2", "disk": "10G", "mem": 4, "name": "t4_VM2", "vcpu": 2, "vmif": "t4VM2if1"}], "vxlan": [{"dev": "t4s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.31.2", "remote_ip": "10.2.31.2", "remote_route": "10.2.31.0/24", "subnet_route": "10.1.31.0/24", "tenant_route_ip": "192.168.4.2", "v_name": "vxlan_t4s1"}]}, "rc": 0, "start": "2019-11-18 01:12:30.249907", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}
changed: [localhost] => (item={u'route': [{u'ip': u'10.1.32.1/24', u'ns_name': u't4', u'ns_if': u't4if', u'if': u'p1'}], u'default_route_ip': u'10.1.32.1', u'bridge_name': u't4br2', u'dns': [{u'dnsif': u't4s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't4s2_dnsbrif'}], u'ns_name': u't4ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.32.2/24', u'tenant_ns_ip': u'10.1.32.1/24', u'tenant_ns_if': u't4ns2if', u'tenant_ns_name': u't4', u'tenant_sub_if': u't4s2if'}], u'subnet_ip': u'2.2.2.0/24', u'vms': [{u'mem': 3, u'name': u't4_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't4br2if1', u'vmif': u't4VM3if1'}], u'vxlan': [{u'local_ip': [], u'tenant_route_ip': [], u'dsport': [], u'dev': [], u'subnet_route': [], u'remote_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t4ns2\" brctl show | grep -w '^t4br2'; if [ $? -ne 0 ] ; then ip netns exec \"t4ns2\" brctl addbr \"t4br2\" ; fi\nip netns exec \"t4ns2\" ip link set dev \"t4br2\" up\n", "delta": "0:00:00.114819", "end": "2019-11-18 01:12:30.698049", "item": {"bridge_name": "t4br2", "default_route_ip": "10.1.32.1", "dns": [{"brif": "t4s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t4s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t4ns2", "route": [{"if": "p1", "ip": "10.1.32.1/24", "ns_if": "t4if", "ns_name": "t4"}], "subnet_ip": "2.2.2.0/24", "tenant_ns": [{"tenant_ns_if": "t4ns2if", "tenant_ns_ip": "10.1.32.1/24", "tenant_ns_name": "t4", "tenant_sub_if": "t4s2if", "tenant_sub_ip": "10.1.32.2/24"}], "vms": [{"brif": "t4br2if1", "disk": "10G", "mem": 3, "name": "t4_VM3", "vcpu": 2, "vmif": "t4VM3if1"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, "rc": 0, "start": "2019-11-18 01:12:30.583230", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Create DNS VETH Pair] *********************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.31.1/24', u'ns_name': u't4', u'ns_if': u't4if', u'if': u'p1'}], u'default_route_ip': u'10.1.31.1', u'bridge_name': u't4br1', u'ns_name': u't4ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.31.2/24', u'tenant_ns_ip': u'10.1.31.1/24', u'tenant_ns_if': u't4ns1if', u'tenant_sub_if': u't4s1if', u'tenant_ns_name': u't4'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't4_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't4br1if1', u'vmif': u't4VM1if1'}, {u'mem': 4, u'name': u't4_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't4br1if2', u'vmif': u't4VM2if1'}], u'vxlan': [{u'local_ip': u'10.1.31.2', u'dsport': 4789, u'dev': u't4s1if', u'tenant_route_ip': u'192.168.4.2', u'remote_route': u'10.2.31.0/24', u'subnet_route': u'10.1.31.0/24', u'v_name': u'vxlan_t4s1', u'id': 42, u'remote_ip': u'10.2.31.2'}]}, {u'dnsif': u't4s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't4s1_dnsbrif'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t4ns1\" ip link show \"t4s1_dnsbrif\" ; if [ $? -ne 0 ] ; then ip netns exec \"t4ns1\" ip link add \"t4s1_dnsbrif\" type veth peer name \"t4s1_dnsif\" ; fi\nip netns exec \"t4ns1\" ip link set dev \"t4s1_dnsbrif\" up\nip netns exec \"t4ns1\" ip link set dev \"t4s1_dnsif\" up\n", "delta": "0:00:00.163202", "end": "2019-11-18 01:12:31.141798", "item": [{"bridge_name": "t4br1", "default_route_ip": "10.1.31.1", "ns_name": "t4ns1", "route": [{"if": "p1", "ip": "10.1.31.1/24", "ns_if": "t4if", "ns_name": "t4"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t4ns1if", "tenant_ns_ip": "10.1.31.1/24", "tenant_ns_name": "t4", "tenant_sub_if": "t4s1if", "tenant_sub_ip": "10.1.31.2/24"}], "vms": [{"brif": "t4br1if1", "disk": "10G", "mem": 2, "name": "t4_VM1", "vcpu": 4, "vmif": "t4VM1if1"}, {"brif": "t4br1if2", "disk": "10G", "mem": 4, "name": "t4_VM2", "vcpu": 2, "vmif": "t4VM2if1"}], "vxlan": [{"dev": "t4s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.31.2", "remote_ip": "10.2.31.2", "remote_route": "10.2.31.0/24", "subnet_route": "10.1.31.0/24", "tenant_route_ip": "192.168.4.2", "v_name": "vxlan_t4s1"}]}, {"brif": "t4s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t4s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "rc": 0, "start": "2019-11-18 01:12:30.978596", "stderr": "Device \"t4s1_dnsbrif\" does not exist.", "stderr_lines": ["Device \"t4s1_dnsbrif\" does not exist."], "stdout": "", "stdout_lines": []}
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.32.1/24', u'ns_name': u't4', u'ns_if': u't4if', u'if': u'p1'}], u'default_route_ip': u'10.1.32.1', u'bridge_name': u't4br2', u'ns_name': u't4ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.32.2/24', u'tenant_ns_ip': u'10.1.32.1/24', u'tenant_ns_if': u't4ns2if', u'tenant_sub_if': u't4s2if', u'tenant_ns_name': u't4'}], u'subnet_ip': u'2.2.2.0/24', u'vms': [{u'mem': 3, u'name': u't4_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't4br2if1', u'vmif': u't4VM3if1'}], u'vxlan': [{u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}, {u'dnsif': u't4s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't4s2_dnsbrif'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t4ns2\" ip link show \"t4s2_dnsbrif\" ; if [ $? -ne 0 ] ; then ip netns exec \"t4ns2\" ip link add \"t4s2_dnsbrif\" type veth peer name \"t4s2_dnsif\" ; fi\nip netns exec \"t4ns2\" ip link set dev \"t4s2_dnsbrif\" up\nip netns exec \"t4ns2\" ip link set dev \"t4s2_dnsif\" up\n", "delta": "0:00:00.150139", "end": "2019-11-18 01:12:31.489705", "item": [{"bridge_name": "t4br2", "default_route_ip": "10.1.32.1", "ns_name": "t4ns2", "route": [{"if": "p1", "ip": "10.1.32.1/24", "ns_if": "t4if", "ns_name": "t4"}], "subnet_ip": "2.2.2.0/24", "tenant_ns": [{"tenant_ns_if": "t4ns2if", "tenant_ns_ip": "10.1.32.1/24", "tenant_ns_name": "t4", "tenant_sub_if": "t4s2if", "tenant_sub_ip": "10.1.32.2/24"}], "vms": [{"brif": "t4br2if1", "disk": "10G", "mem": 3, "name": "t4_VM3", "vcpu": 2, "vmif": "t4VM3if1"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, {"brif": "t4s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t4s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "rc": 0, "start": "2019-11-18 01:12:31.339566", "stderr": "Device \"t4s2_dnsbrif\" does not exist.", "stderr_lines": ["Device \"t4s2_dnsbrif\" does not exist."], "stdout": "", "stdout_lines": []}

TASK [Attach DNS VETH Pair] *********************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.31.1/24', u'ns_name': u't4', u'ns_if': u't4if', u'if': u'p1'}], u'default_route_ip': u'10.1.31.1', u'bridge_name': u't4br1', u'ns_name': u't4ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.31.2/24', u'tenant_ns_ip': u'10.1.31.1/24', u'tenant_ns_if': u't4ns1if', u'tenant_sub_if': u't4s1if', u'tenant_ns_name': u't4'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't4_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't4br1if1', u'vmif': u't4VM1if1'}, {u'mem': 4, u'name': u't4_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't4br1if2', u'vmif': u't4VM2if1'}], u'vxlan': [{u'local_ip': u'10.1.31.2', u'dsport': 4789, u'dev': u't4s1if', u'tenant_route_ip': u'192.168.4.2', u'remote_route': u'10.2.31.0/24', u'subnet_route': u'10.1.31.0/24', u'v_name': u'vxlan_t4s1', u'id': 42, u'remote_ip': u'10.2.31.2'}]}, {u'dnsif': u't4s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't4s1_dnsbrif'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t4ns1\" brctl show \"t4br1\" | grep -w 't4s1_dnsbrif' ; if [ $? -ne 0 ] ; then ip netns exec \"t4ns1\" brctl addif \"t4br1\" \"t4s1_dnsbrif\" ; fi\n", "delta": "0:00:00.076345", "end": "2019-11-18 01:12:31.817688", "item": [{"bridge_name": "t4br1", "default_route_ip": "10.1.31.1", "ns_name": "t4ns1", "route": [{"if": "p1", "ip": "10.1.31.1/24", "ns_if": "t4if", "ns_name": "t4"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t4ns1if", "tenant_ns_ip": "10.1.31.1/24", "tenant_ns_name": "t4", "tenant_sub_if": "t4s1if", "tenant_sub_ip": "10.1.31.2/24"}], "vms": [{"brif": "t4br1if1", "disk": "10G", "mem": 2, "name": "t4_VM1", "vcpu": 4, "vmif": "t4VM1if1"}, {"brif": "t4br1if2", "disk": "10G", "mem": 4, "name": "t4_VM2", "vcpu": 2, "vmif": "t4VM2if1"}], "vxlan": [{"dev": "t4s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.31.2", "remote_ip": "10.2.31.2", "remote_route": "10.2.31.0/24", "subnet_route": "10.1.31.0/24", "tenant_route_ip": "192.168.4.2", "v_name": "vxlan_t4s1"}]}, {"brif": "t4s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t4s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "rc": 0, "start": "2019-11-18 01:12:31.741343", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.32.1/24', u'ns_name': u't4', u'ns_if': u't4if', u'if': u'p1'}], u'default_route_ip': u'10.1.32.1', u'bridge_name': u't4br2', u'ns_name': u't4ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.32.2/24', u'tenant_ns_ip': u'10.1.32.1/24', u'tenant_ns_if': u't4ns2if', u'tenant_sub_if': u't4s2if', u'tenant_ns_name': u't4'}], u'subnet_ip': u'2.2.2.0/24', u'vms': [{u'mem': 3, u'name': u't4_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't4br2if1', u'vmif': u't4VM3if1'}], u'vxlan': [{u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}, {u'dnsif': u't4s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't4s2_dnsbrif'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t4ns2\" brctl show \"t4br2\" | grep -w 't4s2_dnsbrif' ; if [ $? -ne 0 ] ; then ip netns exec \"t4ns2\" brctl addif \"t4br2\" \"t4s2_dnsbrif\" ; fi\n", "delta": "0:00:00.083766", "end": "2019-11-18 01:12:32.105908", "item": [{"bridge_name": "t4br2", "default_route_ip": "10.1.32.1", "ns_name": "t4ns2", "route": [{"if": "p1", "ip": "10.1.32.1/24", "ns_if": "t4if", "ns_name": "t4"}], "subnet_ip": "2.2.2.0/24", "tenant_ns": [{"tenant_ns_if": "t4ns2if", "tenant_ns_ip": "10.1.32.1/24", "tenant_ns_name": "t4", "tenant_sub_if": "t4s2if", "tenant_sub_ip": "10.1.32.2/24"}], "vms": [{"brif": "t4br2if1", "disk": "10G", "mem": 3, "name": "t4_VM3", "vcpu": 2, "vmif": "t4VM3if1"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, {"brif": "t4s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t4s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "rc": 0, "start": "2019-11-18 01:12:32.022142", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Create VETH Pairs] ************************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.31.1/24', u'ns_name': u't4', u'ns_if': u't4if', u'if': u'p1'}], u'default_route_ip': u'10.1.31.1', u'bridge_name': u't4br1', u'dns': [{u'dnsif': u't4s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't4s1_dnsbrif'}], u'ns_name': u't4ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.31.2/24', u'tenant_ns_ip': u'10.1.31.1/24', u'tenant_ns_if': u't4ns1if', u'tenant_sub_if': u't4s1if', u'tenant_ns_name': u't4'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.1.31.2', u'dsport': 4789, u'dev': u't4s1if', u'tenant_route_ip': u'192.168.4.2', u'remote_route': u'10.2.31.0/24', u'subnet_route': u'10.1.31.0/24', u'v_name': u'vxlan_t4s1', u'id': 42, u'remote_ip': u'10.2.31.2'}]}, {u'mem': 2, u'name': u't4_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't4br1if1', u'vmif': u't4VM1if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip link show \"t4br1if1\" ; if [ $? -ne 0 ] ; then ip link add \"t4VM1if1\" type veth peer name \"t4br1if1\" ; fi\nip link set dev \"t4br1if1\" up\nip link set dev \"t4VM1if1\" up\n", "delta": "0:00:00.020212", "end": "2019-11-18 01:12:32.413537", "item": [{"bridge_name": "t4br1", "default_route_ip": "10.1.31.1", "dns": [{"brif": "t4s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t4s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t4ns1", "route": [{"if": "p1", "ip": "10.1.31.1/24", "ns_if": "t4if", "ns_name": "t4"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t4ns1if", "tenant_ns_ip": "10.1.31.1/24", "tenant_ns_name": "t4", "tenant_sub_if": "t4s1if", "tenant_sub_ip": "10.1.31.2/24"}], "vxlan": [{"dev": "t4s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.31.2", "remote_ip": "10.2.31.2", "remote_route": "10.2.31.0/24", "subnet_route": "10.1.31.0/24", "tenant_route_ip": "192.168.4.2", "v_name": "vxlan_t4s1"}]}, {"brif": "t4br1if1", "disk": "10G", "mem": 2, "name": "t4_VM1", "vcpu": 4, "vmif": "t4VM1if1"}], "rc": 0, "start": "2019-11-18 01:12:32.393325", "stderr": "Device \"t4br1if1\" does not exist.", "stderr_lines": ["Device \"t4br1if1\" does not exist."], "stdout": "", "stdout_lines": []}
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.31.1/24', u'ns_name': u't4', u'ns_if': u't4if', u'if': u'p1'}], u'default_route_ip': u'10.1.31.1', u'bridge_name': u't4br1', u'dns': [{u'dnsif': u't4s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't4s1_dnsbrif'}], u'ns_name': u't4ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.31.2/24', u'tenant_ns_ip': u'10.1.31.1/24', u'tenant_ns_if': u't4ns1if', u'tenant_sub_if': u't4s1if', u'tenant_ns_name': u't4'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.1.31.2', u'dsport': 4789, u'dev': u't4s1if', u'tenant_route_ip': u'192.168.4.2', u'remote_route': u'10.2.31.0/24', u'subnet_route': u'10.1.31.0/24', u'v_name': u'vxlan_t4s1', u'id': 42, u'remote_ip': u'10.2.31.2'}]}, {u'mem': 4, u'name': u't4_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't4br1if2', u'vmif': u't4VM2if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip link show \"t4br1if2\" ; if [ $? -ne 0 ] ; then ip link add \"t4VM2if1\" type veth peer name \"t4br1if2\" ; fi\nip link set dev \"t4br1if2\" up\nip link set dev \"t4VM2if1\" up\n", "delta": "0:00:00.022656", "end": "2019-11-18 01:12:32.657501", "item": [{"bridge_name": "t4br1", "default_route_ip": "10.1.31.1", "dns": [{"brif": "t4s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t4s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t4ns1", "route": [{"if": "p1", "ip": "10.1.31.1/24", "ns_if": "t4if", "ns_name": "t4"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t4ns1if", "tenant_ns_ip": "10.1.31.1/24", "tenant_ns_name": "t4", "tenant_sub_if": "t4s1if", "tenant_sub_ip": "10.1.31.2/24"}], "vxlan": [{"dev": "t4s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.31.2", "remote_ip": "10.2.31.2", "remote_route": "10.2.31.0/24", "subnet_route": "10.1.31.0/24", "tenant_route_ip": "192.168.4.2", "v_name": "vxlan_t4s1"}]}, {"brif": "t4br1if2", "disk": "10G", "mem": 4, "name": "t4_VM2", "vcpu": 2, "vmif": "t4VM2if1"}], "rc": 0, "start": "2019-11-18 01:12:32.634845", "stderr": "Device \"t4br1if2\" does not exist.", "stderr_lines": ["Device \"t4br1if2\" does not exist."], "stdout": "", "stdout_lines": []}
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.32.1/24', u'ns_name': u't4', u'ns_if': u't4if', u'if': u'p1'}], u'default_route_ip': u'10.1.32.1', u'bridge_name': u't4br2', u'dns': [{u'dnsif': u't4s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't4s2_dnsbrif'}], u'ns_name': u't4ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.32.2/24', u'tenant_ns_ip': u'10.1.32.1/24', u'tenant_ns_if': u't4ns2if', u'tenant_sub_if': u't4s2if', u'tenant_ns_name': u't4'}], u'subnet_ip': u'2.2.2.0/24', u'vxlan': [{u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}, {u'mem': 3, u'name': u't4_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't4br2if1', u'vmif': u't4VM3if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip link show \"t4br2if1\" ; if [ $? -ne 0 ] ; then ip link add \"t4VM3if1\" type veth peer name \"t4br2if1\" ; fi\nip link set dev \"t4br2if1\" up\nip link set dev \"t4VM3if1\" up\n", "delta": "0:00:00.019216", "end": "2019-11-18 01:12:32.895677", "item": [{"bridge_name": "t4br2", "default_route_ip": "10.1.32.1", "dns": [{"brif": "t4s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t4s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t4ns2", "route": [{"if": "p1", "ip": "10.1.32.1/24", "ns_if": "t4if", "ns_name": "t4"}], "subnet_ip": "2.2.2.0/24", "tenant_ns": [{"tenant_ns_if": "t4ns2if", "tenant_ns_ip": "10.1.32.1/24", "tenant_ns_name": "t4", "tenant_sub_if": "t4s2if", "tenant_sub_ip": "10.1.32.2/24"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, {"brif": "t4br2if1", "disk": "10G", "mem": 3, "name": "t4_VM3", "vcpu": 2, "vmif": "t4VM3if1"}], "rc": 0, "start": "2019-11-18 01:12:32.876461", "stderr": "Device \"t4br2if1\" does not exist.", "stderr_lines": ["Device \"t4br2if1\" does not exist."], "stdout": "", "stdout_lines": []}

TASK [Attach VETH Pairs] ************************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.31.1/24', u'ns_name': u't4', u'ns_if': u't4if', u'if': u'p1'}], u'default_route_ip': u'10.1.31.1', u'bridge_name': u't4br1', u'dns': [{u'dnsif': u't4s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't4s1_dnsbrif'}], u'ns_name': u't4ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.31.2/24', u'tenant_ns_ip': u'10.1.31.1/24', u'tenant_ns_if': u't4ns1if', u'tenant_sub_if': u't4s1if', u'tenant_ns_name': u't4'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.1.31.2', u'dsport': 4789, u'dev': u't4s1if', u'tenant_route_ip': u'192.168.4.2', u'remote_route': u'10.2.31.0/24', u'subnet_route': u'10.1.31.0/24', u'v_name': u'vxlan_t4s1', u'id': 42, u'remote_ip': u'10.2.31.2'}]}, {u'mem': 2, u'name': u't4_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't4br1if1', u'vmif': u't4VM1if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip link show \"t4br1if1\" ; if [ $? -eq 0 ] ; then ip link set \"t4br1if1\" netns \"t4ns1\" ; fi\nip netns exec \"t4ns1\" brctl show \"t4br1\" | grep -w 't4br1if1' ; if [ $? -ne 0 ] ; then ip netns exec \"t4ns1\" brctl addif \"t4br1\" \"t4br1if1\" ; fi\n", "delta": "0:00:00.115816", "end": "2019-11-18 01:12:33.301942", "item": [{"bridge_name": "t4br1", "default_route_ip": "10.1.31.1", "dns": [{"brif": "t4s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t4s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t4ns1", "route": [{"if": "p1", "ip": "10.1.31.1/24", "ns_if": "t4if", "ns_name": "t4"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t4ns1if", "tenant_ns_ip": "10.1.31.1/24", "tenant_ns_name": "t4", "tenant_sub_if": "t4s1if", "tenant_sub_ip": "10.1.31.2/24"}], "vxlan": [{"dev": "t4s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.31.2", "remote_ip": "10.2.31.2", "remote_route": "10.2.31.0/24", "subnet_route": "10.1.31.0/24", "tenant_route_ip": "192.168.4.2", "v_name": "vxlan_t4s1"}]}, {"brif": "t4br1if1", "disk": "10G", "mem": 2, "name": "t4_VM1", "vcpu": 4, "vmif": "t4VM1if1"}], "rc": 0, "start": "2019-11-18 01:12:33.186126", "stderr": "", "stderr_lines": [], "stdout": "50: t4br1if1@t4VM1if1: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP mode DEFAULT group default qlen 1000\n    link/ether 42:10:ea:e3:e9:99 brd ff:ff:ff:ff:ff:ff", "stdout_lines": ["50: t4br1if1@t4VM1if1: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP mode DEFAULT group default qlen 1000", "    link/ether 42:10:ea:e3:e9:99 brd ff:ff:ff:ff:ff:ff"]}
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.31.1/24', u'ns_name': u't4', u'ns_if': u't4if', u'if': u'p1'}], u'default_route_ip': u'10.1.31.1', u'bridge_name': u't4br1', u'dns': [{u'dnsif': u't4s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't4s1_dnsbrif'}], u'ns_name': u't4ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.31.2/24', u'tenant_ns_ip': u'10.1.31.1/24', u'tenant_ns_if': u't4ns1if', u'tenant_sub_if': u't4s1if', u'tenant_ns_name': u't4'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.1.31.2', u'dsport': 4789, u'dev': u't4s1if', u'tenant_route_ip': u'192.168.4.2', u'remote_route': u'10.2.31.0/24', u'subnet_route': u'10.1.31.0/24', u'v_name': u'vxlan_t4s1', u'id': 42, u'remote_ip': u'10.2.31.2'}]}, {u'mem': 4, u'name': u't4_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't4br1if2', u'vmif': u't4VM2if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip link show \"t4br1if2\" ; if [ $? -eq 0 ] ; then ip link set \"t4br1if2\" netns \"t4ns1\" ; fi\nip netns exec \"t4ns1\" brctl show \"t4br1\" | grep -w 't4br1if2' ; if [ $? -ne 0 ] ; then ip netns exec \"t4ns1\" brctl addif \"t4br1\" \"t4br1if2\" ; fi\n", "delta": "0:00:00.113043", "end": "2019-11-18 01:12:33.629836", "item": [{"bridge_name": "t4br1", "default_route_ip": "10.1.31.1", "dns": [{"brif": "t4s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t4s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t4ns1", "route": [{"if": "p1", "ip": "10.1.31.1/24", "ns_if": "t4if", "ns_name": "t4"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t4ns1if", "tenant_ns_ip": "10.1.31.1/24", "tenant_ns_name": "t4", "tenant_sub_if": "t4s1if", "tenant_sub_ip": "10.1.31.2/24"}], "vxlan": [{"dev": "t4s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.31.2", "remote_ip": "10.2.31.2", "remote_route": "10.2.31.0/24", "subnet_route": "10.1.31.0/24", "tenant_route_ip": "192.168.4.2", "v_name": "vxlan_t4s1"}]}, {"brif": "t4br1if2", "disk": "10G", "mem": 4, "name": "t4_VM2", "vcpu": 2, "vmif": "t4VM2if1"}], "rc": 0, "start": "2019-11-18 01:12:33.516793", "stderr": "", "stderr_lines": [], "stdout": "52: t4br1if2@t4VM2if1: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP mode DEFAULT group default qlen 1000\n    link/ether 2e:85:19:ed:08:ce brd ff:ff:ff:ff:ff:ff", "stdout_lines": ["52: t4br1if2@t4VM2if1: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP mode DEFAULT group default qlen 1000", "    link/ether 2e:85:19:ed:08:ce brd ff:ff:ff:ff:ff:ff"]}
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.32.1/24', u'ns_name': u't4', u'ns_if': u't4if', u'if': u'p1'}], u'default_route_ip': u'10.1.32.1', u'bridge_name': u't4br2', u'dns': [{u'dnsif': u't4s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't4s2_dnsbrif'}], u'ns_name': u't4ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.32.2/24', u'tenant_ns_ip': u'10.1.32.1/24', u'tenant_ns_if': u't4ns2if', u'tenant_sub_if': u't4s2if', u'tenant_ns_name': u't4'}], u'subnet_ip': u'2.2.2.0/24', u'vxlan': [{u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}, {u'mem': 3, u'name': u't4_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't4br2if1', u'vmif': u't4VM3if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip link show \"t4br2if1\" ; if [ $? -eq 0 ] ; then ip link set \"t4br2if1\" netns \"t4ns2\" ; fi\nip netns exec \"t4ns2\" brctl show \"t4br2\" | grep -w 't4br2if1' ; if [ $? -ne 0 ] ; then ip netns exec \"t4ns2\" brctl addif \"t4br2\" \"t4br2if1\" ; fi\n", "delta": "0:00:00.097838", "end": "2019-11-18 01:12:33.953715", "item": [{"bridge_name": "t4br2", "default_route_ip": "10.1.32.1", "dns": [{"brif": "t4s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t4s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t4ns2", "route": [{"if": "p1", "ip": "10.1.32.1/24", "ns_if": "t4if", "ns_name": "t4"}], "subnet_ip": "2.2.2.0/24", "tenant_ns": [{"tenant_ns_if": "t4ns2if", "tenant_ns_ip": "10.1.32.1/24", "tenant_ns_name": "t4", "tenant_sub_if": "t4s2if", "tenant_sub_ip": "10.1.32.2/24"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, {"brif": "t4br2if1", "disk": "10G", "mem": 3, "name": "t4_VM3", "vcpu": 2, "vmif": "t4VM3if1"}], "rc": 0, "start": "2019-11-18 01:12:33.855877", "stderr": "", "stderr_lines": [], "stdout": "54: t4br2if1@t4VM3if1: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP mode DEFAULT group default qlen 1000\n    link/ether 06:02:08:e0:4f:c4 brd ff:ff:ff:ff:ff:ff", "stdout_lines": ["54: t4br2if1@t4VM3if1: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP mode DEFAULT group default qlen 1000", "    link/ether 06:02:08:e0:4f:c4 brd ff:ff:ff:ff:ff:ff"]}

TASK [All interfaces and bridges UP] ************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.31.1/24', u'ns_name': u't4', u'ns_if': u't4if', u'if': u'p1'}], u'default_route_ip': u'10.1.31.1', u'bridge_name': u't4br1', u'dns': [{u'dnsif': u't4s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't4s1_dnsbrif'}], u'ns_name': u't4ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.31.2/24', u'tenant_ns_ip': u'10.1.31.1/24', u'tenant_ns_if': u't4ns1if', u'tenant_sub_if': u't4s1if', u'tenant_ns_name': u't4'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.1.31.2', u'dsport': 4789, u'dev': u't4s1if', u'tenant_route_ip': u'192.168.4.2', u'remote_route': u'10.2.31.0/24', u'subnet_route': u'10.1.31.0/24', u'v_name': u'vxlan_t4s1', u'id': 42, u'remote_ip': u'10.2.31.2'}]}, {u'mem': 2, u'name': u't4_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't4br1if1', u'vmif': u't4VM1if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t4ns1\" ip link set \"t4br1if1\" up\nip netns exec \"t4ns1\" ip link set dev \"t4br1\" up\n", "delta": "0:00:00.073152", "end": "2019-11-18 01:12:34.277611", "item": [{"bridge_name": "t4br1", "default_route_ip": "10.1.31.1", "dns": [{"brif": "t4s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t4s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t4ns1", "route": [{"if": "p1", "ip": "10.1.31.1/24", "ns_if": "t4if", "ns_name": "t4"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t4ns1if", "tenant_ns_ip": "10.1.31.1/24", "tenant_ns_name": "t4", "tenant_sub_if": "t4s1if", "tenant_sub_ip": "10.1.31.2/24"}], "vxlan": [{"dev": "t4s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.31.2", "remote_ip": "10.2.31.2", "remote_route": "10.2.31.0/24", "subnet_route": "10.1.31.0/24", "tenant_route_ip": "192.168.4.2", "v_name": "vxlan_t4s1"}]}, {"brif": "t4br1if1", "disk": "10G", "mem": 2, "name": "t4_VM1", "vcpu": 4, "vmif": "t4VM1if1"}], "rc": 0, "start": "2019-11-18 01:12:34.204459", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.31.1/24', u'ns_name': u't4', u'ns_if': u't4if', u'if': u'p1'}], u'default_route_ip': u'10.1.31.1', u'bridge_name': u't4br1', u'dns': [{u'dnsif': u't4s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't4s1_dnsbrif'}], u'ns_name': u't4ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.31.2/24', u'tenant_ns_ip': u'10.1.31.1/24', u'tenant_ns_if': u't4ns1if', u'tenant_sub_if': u't4s1if', u'tenant_ns_name': u't4'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.1.31.2', u'dsport': 4789, u'dev': u't4s1if', u'tenant_route_ip': u'192.168.4.2', u'remote_route': u'10.2.31.0/24', u'subnet_route': u'10.1.31.0/24', u'v_name': u'vxlan_t4s1', u'id': 42, u'remote_ip': u'10.2.31.2'}]}, {u'mem': 4, u'name': u't4_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't4br1if2', u'vmif': u't4VM2if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t4ns1\" ip link set \"t4br1if2\" up\nip netns exec \"t4ns1\" ip link set dev \"t4br1\" up\n", "delta": "0:00:00.072128", "end": "2019-11-18 01:12:34.537987", "item": [{"bridge_name": "t4br1", "default_route_ip": "10.1.31.1", "dns": [{"brif": "t4s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t4s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t4ns1", "route": [{"if": "p1", "ip": "10.1.31.1/24", "ns_if": "t4if", "ns_name": "t4"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t4ns1if", "tenant_ns_ip": "10.1.31.1/24", "tenant_ns_name": "t4", "tenant_sub_if": "t4s1if", "tenant_sub_ip": "10.1.31.2/24"}], "vxlan": [{"dev": "t4s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.31.2", "remote_ip": "10.2.31.2", "remote_route": "10.2.31.0/24", "subnet_route": "10.1.31.0/24", "tenant_route_ip": "192.168.4.2", "v_name": "vxlan_t4s1"}]}, {"brif": "t4br1if2", "disk": "10G", "mem": 4, "name": "t4_VM2", "vcpu": 2, "vmif": "t4VM2if1"}], "rc": 0, "start": "2019-11-18 01:12:34.465859", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.32.1/24', u'ns_name': u't4', u'ns_if': u't4if', u'if': u'p1'}], u'default_route_ip': u'10.1.32.1', u'bridge_name': u't4br2', u'dns': [{u'dnsif': u't4s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't4s2_dnsbrif'}], u'ns_name': u't4ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.32.2/24', u'tenant_ns_ip': u'10.1.32.1/24', u'tenant_ns_if': u't4ns2if', u'tenant_sub_if': u't4s2if', u'tenant_ns_name': u't4'}], u'subnet_ip': u'2.2.2.0/24', u'vxlan': [{u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}, {u'mem': 3, u'name': u't4_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't4br2if1', u'vmif': u't4VM3if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t4ns2\" ip link set \"t4br2if1\" up\nip netns exec \"t4ns2\" ip link set dev \"t4br2\" up\n", "delta": "0:00:00.065527", "end": "2019-11-18 01:12:34.793801", "item": [{"bridge_name": "t4br2", "default_route_ip": "10.1.32.1", "dns": [{"brif": "t4s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t4s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t4ns2", "route": [{"if": "p1", "ip": "10.1.32.1/24", "ns_if": "t4if", "ns_name": "t4"}], "subnet_ip": "2.2.2.0/24", "tenant_ns": [{"tenant_ns_if": "t4ns2if", "tenant_ns_ip": "10.1.32.1/24", "tenant_ns_name": "t4", "tenant_sub_if": "t4s2if", "tenant_sub_ip": "10.1.32.2/24"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, {"brif": "t4br2if1", "disk": "10G", "mem": 3, "name": "t4_VM3", "vcpu": 2, "vmif": "t4VM3if1"}], "rc": 0, "start": "2019-11-18 01:12:34.728274", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Add IP to DNS Interface] ******************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.31.1/24', u'ns_name': u't4', u'ns_if': u't4if', u'if': u'p1'}], u'default_route_ip': u'10.1.31.1', u'bridge_name': u't4br1', u'ns_name': u't4ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.31.2/24', u'tenant_ns_ip': u'10.1.31.1/24', u'tenant_ns_if': u't4ns1if', u'tenant_sub_if': u't4s1if', u'tenant_ns_name': u't4'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't4_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't4br1if1', u'vmif': u't4VM1if1'}, {u'mem': 4, u'name': u't4_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't4br1if2', u'vmif': u't4VM2if1'}], u'vxlan': [{u'local_ip': u'10.1.31.2', u'dsport': 4789, u'dev': u't4s1if', u'tenant_route_ip': u'192.168.4.2', u'remote_route': u'10.2.31.0/24', u'subnet_route': u'10.1.31.0/24', u'v_name': u'vxlan_t4s1', u'id': 42, u'remote_ip': u'10.2.31.2'}]}, {u'dnsif': u't4s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't4s1_dnsbrif'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t4ns1\" ip addr show \"t4s1_dnsif\" | awk 'FNR==3{ print $2 }' | grep -w '^1.1.1.1/24' ; if [ $? -ne 0 ] ; then ip netns exec \"t4ns1\" ip addr add \"1.1.1.1/24\" dev \"t4s1_dnsif\" ; fi\n", "delta": "0:00:00.074921", "end": "2019-11-18 01:12:35.145830", "item": [{"bridge_name": "t4br1", "default_route_ip": "10.1.31.1", "ns_name": "t4ns1", "route": [{"if": "p1", "ip": "10.1.31.1/24", "ns_if": "t4if", "ns_name": "t4"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t4ns1if", "tenant_ns_ip": "10.1.31.1/24", "tenant_ns_name": "t4", "tenant_sub_if": "t4s1if", "tenant_sub_ip": "10.1.31.2/24"}], "vms": [{"brif": "t4br1if1", "disk": "10G", "mem": 2, "name": "t4_VM1", "vcpu": 4, "vmif": "t4VM1if1"}, {"brif": "t4br1if2", "disk": "10G", "mem": 4, "name": "t4_VM2", "vcpu": 2, "vmif": "t4VM2if1"}], "vxlan": [{"dev": "t4s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.31.2", "remote_ip": "10.2.31.2", "remote_route": "10.2.31.0/24", "subnet_route": "10.1.31.0/24", "tenant_route_ip": "192.168.4.2", "v_name": "vxlan_t4s1"}]}, {"brif": "t4s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t4s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "rc": 0, "start": "2019-11-18 01:12:35.070909", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.32.1/24', u'ns_name': u't4', u'ns_if': u't4if', u'if': u'p1'}], u'default_route_ip': u'10.1.32.1', u'bridge_name': u't4br2', u'ns_name': u't4ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.32.2/24', u'tenant_ns_ip': u'10.1.32.1/24', u'tenant_ns_if': u't4ns2if', u'tenant_sub_if': u't4s2if', u'tenant_ns_name': u't4'}], u'subnet_ip': u'2.2.2.0/24', u'vms': [{u'mem': 3, u'name': u't4_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't4br2if1', u'vmif': u't4VM3if1'}], u'vxlan': [{u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}, {u'dnsif': u't4s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't4s2_dnsbrif'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t4ns2\" ip addr show \"t4s2_dnsif\" | awk 'FNR==3{ print $2 }' | grep -w '^2.2.2.1/24' ; if [ $? -ne 0 ] ; then ip netns exec \"t4ns2\" ip addr add \"2.2.2.1/24\" dev \"t4s2_dnsif\" ; fi\n", "delta": "0:00:00.090590", "end": "2019-11-18 01:12:35.465968", "item": [{"bridge_name": "t4br2", "default_route_ip": "10.1.32.1", "ns_name": "t4ns2", "route": [{"if": "p1", "ip": "10.1.32.1/24", "ns_if": "t4if", "ns_name": "t4"}], "subnet_ip": "2.2.2.0/24", "tenant_ns": [{"tenant_ns_if": "t4ns2if", "tenant_ns_ip": "10.1.32.1/24", "tenant_ns_name": "t4", "tenant_sub_if": "t4s2if", "tenant_sub_ip": "10.1.32.2/24"}], "vms": [{"brif": "t4br2if1", "disk": "10G", "mem": 3, "name": "t4_VM3", "vcpu": 2, "vmif": "t4VM3if1"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, {"brif": "t4s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t4s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "rc": 0, "start": "2019-11-18 01:12:35.375378", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Install DHCP Server] **********************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.31.1/24', u'ns_name': u't4', u'ns_if': u't4if', u'if': u'p1'}], u'default_route_ip': u'10.1.31.1', u'bridge_name': u't4br1', u'ns_name': u't4ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.31.2/24', u'tenant_ns_ip': u'10.1.31.1/24', u'tenant_ns_if': u't4ns1if', u'tenant_sub_if': u't4s1if', u'tenant_ns_name': u't4'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't4_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't4br1if1', u'vmif': u't4VM1if1'}, {u'mem': 4, u'name': u't4_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't4br1if2', u'vmif': u't4VM2if1'}], u'vxlan': [{u'local_ip': u'10.1.31.2', u'dsport': 4789, u'dev': u't4s1if', u'tenant_route_ip': u'192.168.4.2', u'remote_route': u'10.2.31.0/24', u'subnet_route': u'10.1.31.0/24', u'v_name': u'vxlan_t4s1', u'id': 42, u'remote_ip': u'10.2.31.2'}]}, {u'dnsif': u't4s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't4s1_dnsbrif'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t4ns1\" ps aux | grep -w '[d]nsmasq --interface t4s1_dnsif -z --dhcp-range=1.1.1.5,1.1.1.126' ; if [ $? -ne 0 ] ; then ip netns exec \"t4ns1\" dnsmasq --interface \"t4s1_dnsif\" -z --dhcp-range=1.1.1.5,'1.1.1.126' ; fi\n", "delta": "0:00:00.085623", "end": "2019-11-18 01:12:35.843463", "item": [{"bridge_name": "t4br1", "default_route_ip": "10.1.31.1", "ns_name": "t4ns1", "route": [{"if": "p1", "ip": "10.1.31.1/24", "ns_if": "t4if", "ns_name": "t4"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t4ns1if", "tenant_ns_ip": "10.1.31.1/24", "tenant_ns_name": "t4", "tenant_sub_if": "t4s1if", "tenant_sub_ip": "10.1.31.2/24"}], "vms": [{"brif": "t4br1if1", "disk": "10G", "mem": 2, "name": "t4_VM1", "vcpu": 4, "vmif": "t4VM1if1"}, {"brif": "t4br1if2", "disk": "10G", "mem": 4, "name": "t4_VM2", "vcpu": 2, "vmif": "t4VM2if1"}], "vxlan": [{"dev": "t4s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.31.2", "remote_ip": "10.2.31.2", "remote_route": "10.2.31.0/24", "subnet_route": "10.1.31.0/24", "tenant_route_ip": "192.168.4.2", "v_name": "vxlan_t4s1"}]}, {"brif": "t4s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t4s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "rc": 0, "start": "2019-11-18 01:12:35.757840", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.32.1/24', u'ns_name': u't4', u'ns_if': u't4if', u'if': u'p1'}], u'default_route_ip': u'10.1.32.1', u'bridge_name': u't4br2', u'ns_name': u't4ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.32.2/24', u'tenant_ns_ip': u'10.1.32.1/24', u'tenant_ns_if': u't4ns2if', u'tenant_sub_if': u't4s2if', u'tenant_ns_name': u't4'}], u'subnet_ip': u'2.2.2.0/24', u'vms': [{u'mem': 3, u'name': u't4_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't4br2if1', u'vmif': u't4VM3if1'}], u'vxlan': [{u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}, {u'dnsif': u't4s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't4s2_dnsbrif'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t4ns2\" ps aux | grep -w '[d]nsmasq --interface t4s2_dnsif -z --dhcp-range=2.2.2.5,2.2.2.254' ; if [ $? -ne 0 ] ; then ip netns exec \"t4ns2\" dnsmasq --interface \"t4s2_dnsif\" -z --dhcp-range=2.2.2.5,'2.2.2.254' ; fi\n", "delta": "0:00:00.062457", "end": "2019-11-18 01:12:36.138775", "item": [{"bridge_name": "t4br2", "default_route_ip": "10.1.32.1", "ns_name": "t4ns2", "route": [{"if": "p1", "ip": "10.1.32.1/24", "ns_if": "t4if", "ns_name": "t4"}], "subnet_ip": "2.2.2.0/24", "tenant_ns": [{"tenant_ns_if": "t4ns2if", "tenant_ns_ip": "10.1.32.1/24", "tenant_ns_name": "t4", "tenant_sub_if": "t4s2if", "tenant_sub_ip": "10.1.32.2/24"}], "vms": [{"brif": "t4br2if1", "disk": "10G", "mem": 3, "name": "t4_VM3", "vcpu": 2, "vmif": "t4VM3if1"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, {"brif": "t4s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t4s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "rc": 0, "start": "2019-11-18 01:12:36.076318", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Create VXLAN devices] *********************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.31.1/24', u'ns_name': u't4', u'ns_if': u't4if', u'if': u'p1'}], u'default_route_ip': u'10.1.31.1', u'bridge_name': u't4br1', u'dns': [{u'dnsif': u't4s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't4s1_dnsbrif'}], u'ns_name': u't4ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.31.2/24', u'tenant_ns_ip': u'10.1.31.1/24', u'tenant_ns_if': u't4ns1if', u'tenant_sub_if': u't4s1if', u'tenant_ns_name': u't4'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't4_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't4br1if1', u'vmif': u't4VM1if1'}, {u'mem': 4, u'name': u't4_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't4br1if2', u'vmif': u't4VM2if1'}]}, {u'local_ip': u'10.1.31.2', u'dsport': 4789, u'dev': u't4s1if', u'tenant_route_ip': u'192.168.4.2', u'remote_route': u'10.2.31.0/24', u'subnet_route': u'10.1.31.0/24', u'v_name': u'vxlan_t4s1', u'id': 42, u'remote_ip': u'10.2.31.2'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t4ns1\" ip link show \"vxlan_t4s1\" ; if [ $? -ne 0 ] ; then ip netns exec \"t4ns1\" ip link add \"vxlan_t4s1\" type vxlan id \"42\" local \"10.1.31.2\" remote \"10.2.31.2\" dstport \"4789\" dev \"t4s1if\"; ip netns exec \"t4ns1\" ip link set dev \"vxlan_t4s1\" up ; fi\n", "delta": "0:00:00.113489", "end": "2019-11-18 01:12:36.557886", "item": [{"bridge_name": "t4br1", "default_route_ip": "10.1.31.1", "dns": [{"brif": "t4s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t4s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t4ns1", "route": [{"if": "p1", "ip": "10.1.31.1/24", "ns_if": "t4if", "ns_name": "t4"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t4ns1if", "tenant_ns_ip": "10.1.31.1/24", "tenant_ns_name": "t4", "tenant_sub_if": "t4s1if", "tenant_sub_ip": "10.1.31.2/24"}], "vms": [{"brif": "t4br1if1", "disk": "10G", "mem": 2, "name": "t4_VM1", "vcpu": 4, "vmif": "t4VM1if1"}, {"brif": "t4br1if2", "disk": "10G", "mem": 4, "name": "t4_VM2", "vcpu": 2, "vmif": "t4VM2if1"}]}, {"dev": "t4s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.31.2", "remote_ip": "10.2.31.2", "remote_route": "10.2.31.0/24", "subnet_route": "10.1.31.0/24", "tenant_route_ip": "192.168.4.2", "v_name": "vxlan_t4s1"}], "rc": 0, "start": "2019-11-18 01:12:36.444397", "stderr": "Device \"vxlan_t4s1\" does not exist.", "stderr_lines": ["Device \"vxlan_t4s1\" does not exist."], "stdout": "", "stdout_lines": []}
skipping: [localhost] => (item=[{u'route': [{u'ip': u'10.1.32.1/24', u'ns_name': u't4', u'ns_if': u't4if', u'if': u'p1'}], u'default_route_ip': u'10.1.32.1', u'bridge_name': u't4br2', u'dns': [{u'dnsif': u't4s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't4s2_dnsbrif'}], u'ns_name': u't4ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.32.2/24', u'tenant_ns_ip': u'10.1.32.1/24', u'tenant_ns_if': u't4ns2if', u'tenant_sub_if': u't4s2if', u'tenant_ns_name': u't4'}], u'subnet_ip': u'2.2.2.0/24', u'vms': [{u'mem': 3, u'name': u't4_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't4br2if1', u'vmif': u't4VM3if1'}]}, {u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}])  => {"ansible_loop_var": "item", "changed": false, "item": [{"bridge_name": "t4br2", "default_route_ip": "10.1.32.1", "dns": [{"brif": "t4s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t4s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t4ns2", "route": [{"if": "p1", "ip": "10.1.32.1/24", "ns_if": "t4if", "ns_name": "t4"}], "subnet_ip": "2.2.2.0/24", "tenant_ns": [{"tenant_ns_if": "t4ns2if", "tenant_ns_ip": "10.1.32.1/24", "tenant_ns_name": "t4", "tenant_sub_if": "t4s2if", "tenant_sub_ip": "10.1.32.2/24"}], "vms": [{"brif": "t4br2if1", "disk": "10G", "mem": 3, "name": "t4_VM3", "vcpu": 2, "vmif": "t4VM3if1"}]}, {"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}], "skip_reason": "Conditional result was False"}

TASK [Attach VXLANs to bridge] ******************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.31.1/24', u'ns_name': u't4', u'ns_if': u't4if', u'if': u'p1'}], u'default_route_ip': u'10.1.31.1', u'bridge_name': u't4br1', u'dns': [{u'dnsif': u't4s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't4s1_dnsbrif'}], u'ns_name': u't4ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.31.2/24', u'tenant_ns_ip': u'10.1.31.1/24', u'tenant_ns_if': u't4ns1if', u'tenant_sub_if': u't4s1if', u'tenant_ns_name': u't4'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't4_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't4br1if1', u'vmif': u't4VM1if1'}, {u'mem': 4, u'name': u't4_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't4br1if2', u'vmif': u't4VM2if1'}]}, {u'local_ip': u'10.1.31.2', u'dsport': 4789, u'dev': u't4s1if', u'tenant_route_ip': u'192.168.4.2', u'remote_route': u'10.2.31.0/24', u'subnet_route': u'10.1.31.0/24', u'v_name': u'vxlan_t4s1', u'id': 42, u'remote_ip': u'10.2.31.2'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t4ns1\" brctl show \"t4br1\" | grep -w 'vxlan_t4s1' ; if [ $? -ne 0 ] ; then ip netns exec \"t4ns1\" brctl addif \"t4br1\" \"vxlan_t4s1\" ; fi\n", "delta": "0:00:00.087981", "end": "2019-11-18 01:12:36.978248", "item": [{"bridge_name": "t4br1", "default_route_ip": "10.1.31.1", "dns": [{"brif": "t4s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t4s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t4ns1", "route": [{"if": "p1", "ip": "10.1.31.1/24", "ns_if": "t4if", "ns_name": "t4"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t4ns1if", "tenant_ns_ip": "10.1.31.1/24", "tenant_ns_name": "t4", "tenant_sub_if": "t4s1if", "tenant_sub_ip": "10.1.31.2/24"}], "vms": [{"brif": "t4br1if1", "disk": "10G", "mem": 2, "name": "t4_VM1", "vcpu": 4, "vmif": "t4VM1if1"}, {"brif": "t4br1if2", "disk": "10G", "mem": 4, "name": "t4_VM2", "vcpu": 2, "vmif": "t4VM2if1"}]}, {"dev": "t4s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.31.2", "remote_ip": "10.2.31.2", "remote_route": "10.2.31.0/24", "subnet_route": "10.1.31.0/24", "tenant_route_ip": "192.168.4.2", "v_name": "vxlan_t4s1"}], "rc": 0, "start": "2019-11-18 01:12:36.890267", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}
skipping: [localhost] => (item=[{u'route': [{u'ip': u'10.1.32.1/24', u'ns_name': u't4', u'ns_if': u't4if', u'if': u'p1'}], u'default_route_ip': u'10.1.32.1', u'bridge_name': u't4br2', u'dns': [{u'dnsif': u't4s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't4s2_dnsbrif'}], u'ns_name': u't4ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.32.2/24', u'tenant_ns_ip': u'10.1.32.1/24', u'tenant_ns_if': u't4ns2if', u'tenant_sub_if': u't4s2if', u'tenant_ns_name': u't4'}], u'subnet_ip': u'2.2.2.0/24', u'vms': [{u'mem': 3, u'name': u't4_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't4br2if1', u'vmif': u't4VM3if1'}]}, {u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}])  => {"ansible_loop_var": "item", "changed": false, "item": [{"bridge_name": "t4br2", "default_route_ip": "10.1.32.1", "dns": [{"brif": "t4s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t4s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t4ns2", "route": [{"if": "p1", "ip": "10.1.32.1/24", "ns_if": "t4if", "ns_name": "t4"}], "subnet_ip": "2.2.2.0/24", "tenant_ns": [{"tenant_ns_if": "t4ns2if", "tenant_ns_ip": "10.1.32.1/24", "tenant_ns_name": "t4", "tenant_sub_if": "t4s2if", "tenant_sub_ip": "10.1.32.2/24"}], "vms": [{"brif": "t4br2if1", "disk": "10G", "mem": 3, "name": "t4_VM3", "vcpu": 2, "vmif": "t4VM3if1"}]}, {"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}], "skip_reason": "Conditional result was False"}

PLAY RECAP **************************************************************************************************************************************************
localhost                  : ok=21   changed=21   unreachable=0    failed=0    skipped=0    rescued=0    ignored=0   

INFO:root: 01:21:18.862390 Printing the yaml input file
INFO:root: 01:21:18.862543 {'C1': [{'subnet_addr': '1.1.1.0/24', 'VM': [{'name': 'VM1', 'disk': '10G', 'mem': 2, 'vcpu': 4}, {'name': 'VM2', 'disk': '10G', 'mem': 4, 'vcpu': 2}]}, {'subnet_addr': '2.2.2.0/24', 'VM': [{'name': 'VM3', 'disk': '10G', 'mem': 3, 'vcpu': 2}]}], 'C2': [{'subnet_addr': '1.1.1.0/24', 'VM': [{'name': 'VM4', 'disk': '10G', 'mem': 2, 'vcpu': 4}]}]}
INFO:root: 01:21:18.862643 Provided subnet in C1: 1.1.1.0/24 is valid
INFO:root: 01:21:18.862690 Provided subnet in C1: 2.2.2.0/24 is valid
INFO:root: 01:21:18.862731 Provided subnet in C2: 1.1.1.0/24 is valid
Using /etc/ansible/ansible.cfg as config file

PLAY [main] *************************************************************************************************************************************************

TASK [Create Tenant Namespace] ******************************************************************************************************************************
failed: [localhost] (item={u'default_route_ip': u'192.168.5.1', u'name': u't5', u'pns_ip': u'192.168.5.1/24', u'tenant_if': u't5if', u'tenant_ip': u'192.168.5.2/24', u'pns_if': u't5pns_if'}) => {"ansible_loop_var": "item", "changed": true, "cmd": ["ip", "nlsjdifgjfdbgetns", "add", "t5"], "delta": "0:00:00.003089", "end": "2019-11-18 01:21:19.980098", "item": {"default_route_ip": "192.168.5.1", "name": "t5", "pns_if": "t5pns_if", "pns_ip": "192.168.5.1/24", "tenant_if": "t5if", "tenant_ip": "192.168.5.2/24"}, "msg": "non-zero return code", "rc": 1, "start": "2019-11-18 01:21:19.977009", "stderr": "Object \"nlsjdifgjfdbgetns\" is unknown, try \"ip help\".", "stderr_lines": ["Object \"nlsjdifgjfdbgetns\" is unknown, try \"ip help\"."], "stdout": "", "stdout_lines": []}

PLAY RECAP **************************************************************************************************************************************************
localhost                  : ok=0    changed=0    unreachable=0    failed=1    skipped=0    rescued=0    ignored=0   

INFO:root: 01:22:03.516452 Printing the yaml input file
INFO:root: 01:22:03.516553 {'C1': [{'subnet_addr': '1.1.1.0/24', 'VM': [{'name': 'VM1', 'disk': '10G', 'mem': 2, 'vcpu': 4}, {'name': 'VM2', 'disk': '10G', 'mem': 4, 'vcpu': 2}]}, {'subnet_addr': '2.2.2.0/24', 'VM': [{'name': 'VM3', 'disk': '10G', 'mem': 3, 'vcpu': 2}]}], 'C2': [{'subnet_addr': '1.1.1.0/24', 'VM': [{'name': 'VM4', 'disk': '10G', 'mem': 2, 'vcpu': 4}]}]}
INFO:root: 01:22:03.516640 Provided subnet in C1: 1.1.1.0/24 is valid
INFO:root: 01:22:03.516688 Provided subnet in C1: 2.2.2.0/24 is valid
INFO:root: 01:22:03.516730 Provided subnet in C2: 1.1.1.0/24 is valid
Using /etc/ansible/ansible.cfg as config file

PLAY [main] *************************************************************************************************************************************************

TASK [Create Tenant Namespace] ******************************************************************************************************************************
failed: [localhost] (item={u'default_route_ip': u'192.168.6.1', u'name': u't6', u'pns_ip': u'192.168.6.1/24', u'tenant_if': u't6if', u'tenant_ip': u'192.168.6.2/24', u'pns_if': u't6pns_if'}) => {"ansible_loop_var": "item", "changed": true, "cmd": ["ip", "nlsjdifgjfdbgetns", "add", "t6"], "delta": "0:00:00.002987", "end": "2019-11-18 01:22:04.595374", "item": {"default_route_ip": "192.168.6.1", "name": "t6", "pns_if": "t6pns_if", "pns_ip": "192.168.6.1/24", "tenant_if": "t6if", "tenant_ip": "192.168.6.2/24"}, "msg": "non-zero return code", "rc": 1, "start": "2019-11-18 01:22:04.592387", "stderr": "Object \"nlsjdifgjfdbgetns\" is unknown, try \"ip help\".", "stderr_lines": ["Object \"nlsjdifgjfdbgetns\" is unknown, try \"ip help\"."], "stdout": "", "stdout_lines": []}

PLAY RECAP **************************************************************************************************************************************************
localhost                  : ok=0    changed=0    unreachable=0    failed=1    skipped=0    rescued=0    ignored=0   

INFO:root: 01:23:28.139104 Printing the yaml input file
INFO:root: 01:23:28.139212 {'C1': [{'subnet_addr': '1.1.1.0/24', 'VM': [{'name': 'VM1', 'disk': '10G', 'mem': 2, 'vcpu': 4}, {'name': 'VM2', 'disk': '10G', 'mem': 4, 'vcpu': 2}]}, {'subnet_addr': '2.2.2.0/24', 'VM': [{'name': 'VM3', 'disk': '10G', 'mem': 3, 'vcpu': 2}]}], 'C2': [{'subnet_addr': '1.1.1.0/24', 'VM': [{'name': 'VM4', 'disk': '10G', 'mem': 2, 'vcpu': 4}]}]}
INFO:root: 01:23:28.139303 Provided subnet in C1: 1.1.1.0/24 is valid
INFO:root: 01:23:28.139354 Provided subnet in C1: 2.2.2.0/24 is valid
INFO:root: 01:23:28.139399 Provided subnet in C2: 1.1.1.0/24 is valid
Using /etc/ansible/ansible.cfg as config file

PLAY [main] *************************************************************************************************************************************************

TASK [Create Tenant Namespace] ******************************************************************************************************************************
failed: [localhost] (item={u'default_route_ip': u'192.168.7.1', u'name': u't7', u'pns_ip': u'192.168.7.1/24', u'tenant_if': u't7if', u'tenant_ip': u'192.168.7.2/24', u'pns_if': u't7pns_if'}) => {"ansible_loop_var": "item", "changed": true, "cmd": ["ip", "nlsjdifgjfdbgetns", "add", "t7"], "delta": "0:00:00.003046", "end": "2019-11-18 01:23:29.215747", "item": {"default_route_ip": "192.168.7.1", "name": "t7", "pns_if": "t7pns_if", "pns_ip": "192.168.7.1/24", "tenant_if": "t7if", "tenant_ip": "192.168.7.2/24"}, "msg": "non-zero return code", "rc": 1, "start": "2019-11-18 01:23:29.212701", "stderr": "Object \"nlsjdifgjfdbgetns\" is unknown, try \"ip help\".", "stderr_lines": ["Object \"nlsjdifgjfdbgetns\" is unknown, try \"ip help\"."], "stdout": "", "stdout_lines": []}

PLAY RECAP **************************************************************************************************************************************************
localhost                  : ok=0    changed=0    unreachable=0    failed=1    skipped=0    rescued=0    ignored=0   

INFO:root: 01:29:24.884487 Printing the yaml input file
INFO:root: 01:29:24.884603 {'C1': [{'subnet_addr': '1.1.1.0/24', 'VM': [{'name': 'VM1', 'disk': '10G', 'mem': 2, 'vcpu': 4}, {'name': 'VM2', 'disk': '10G', 'mem': 4, 'vcpu': 2}]}, {'subnet_addr': '1.1.1.0/24', 'VM': [{'name': 'VM3', 'disk': '10G', 'mem': 3, 'vcpu': 2}]}], 'C2': [{'subnet_addr': '1.1.1.0/24', 'VM': [{'name': 'VM4', 'disk': '10G', 'mem': 2, 'vcpu': 4}]}]}
INFO:root: 01:29:24.884693 Provided subnet in C1: 1.1.1.0/24 is valid
INFO:root: 01:29:24.884743 Provided subnet in C1: 1.1.1.0/24 is valid
ERROR:root: 01:29:24.884775Multiple subnet in the C1 are same
INFO:root: 01:29:41.901960 Printing the yaml input file
INFO:root: 01:29:41.902100 {'C1': [{'subnet_addr': '1.1.1.0/24', 'VM': [{'name': 'VM1', 'disk': '10G', 'mem': 2, 'vcpu': 4}, {'name': 'VM2', 'disk': '10G', 'mem': 4, 'vcpu': 2}]}, {'subnet_addr': '1.1.1.0/24', 'VM': [{'name': 'VM3', 'disk': '10G', 'mem': 3, 'vcpu': 2}]}], 'C2': [{'subnet_addr': '1.1.1.0/24', 'VM': [{'name': 'VM4', 'disk': '10G', 'mem': 2, 'vcpu': 4}]}]}
INFO:root: 01:29:41.902199 Provided subnet in C1: 1.1.1.0/24 is valid
INFO:root: 01:29:41.902245 Provided subnet in C1: 1.1.1.0/24 is valid
ERROR:root: 01:29:41.902274Multiple subnet in the C1 are same
INFO:root: 01:30:03.360679 Printing the yaml input file
INFO:root: 01:30:03.360821 {'C1': [{'subnet_addr': '1.1.1.0/24', 'VM': [{'name': 'VM1', 'disk': '10G', 'mem': 2, 'vcpu': 4}, {'name': 'VM2', 'disk': '10G', 'mem': 4, 'vcpu': 2}]}, {'subnet_addr': '2.2.2.0/24', 'VM': [{'name': 'VM3', 'disk': '10G', 'mem': 3, 'vcpu': 2}]}], 'C2': [{'subnet_addr': '1.1.1.0/24', 'VM': [{'name': 'VM4', 'disk': '10G', 'mem': 2, 'vcpu': 4}]}]}
INFO:root: 01:30:03.360913 Provided subnet in C1: 1.1.1.0/24 is valid
INFO:root: 01:30:03.360962 Provided subnet in C1: 2.2.2.0/24 is valid
INFO:root: 01:30:03.361005 Provided subnet in C2: 1.1.1.0/24 is valid
INFO:root: 03:26:43.854404 Printing the yaml input file
INFO:root: 03:26:43.854517 {'C1': [{'subnet_addr': '1.1.1.0/24', 'VM': [{'name': 'VM1', 'disk': '10G', 'mem': 2, 'vcpu': 4}, {'name': 'VM2', 'disk': '10G', 'mem': 4, 'vcpu': 2}]}, {'subnet_addr': '2.2.2.0/24', 'VM': [{'name': 'VM3', 'disk': '10G', 'mem': 3, 'vcpu': 2}]}], 'C2': [{'subnet_addr': '1.1.1.0/24', 'VM': [{'name': 'VM4', 'disk': '10G', 'mem': 2, 'vcpu': 4}]}]}
INFO:root: 03:26:43.854627 Provided subnet in C1: 1.1.1.0/24 is valid
INFO:root: 03:26:43.854684 Provided subnet in C1: 2.2.2.0/24 is valid
INFO:root: 03:26:43.854735 Provided subnet in C2: 1.1.1.0/24 is valid
Using /etc/ansible/ansible.cfg as config file

PLAY [main] *************************************************************************************************************************************************

TASK [Create Tenant Namespace] ******************************************************************************************************************************
failed: [localhost] (item={u'default_route_ip': u'192.168.2.1', u'name': u't2', u'pns_ip': u'192.168.2.1/24', u'tenant_if': u't2if', u'tenant_ip': u'192.168.2.2/24', u'pns_if': u't2pns_if'}) => {"ansible_loop_var": "item", "changed": true, "cmd": ["ip", "nlsjdifgjfdbgetns", "add", "t2"], "delta": "0:00:00.002621", "end": "2019-11-18 03:26:45.164171", "item": {"default_route_ip": "192.168.2.1", "name": "t2", "pns_if": "t2pns_if", "pns_ip": "192.168.2.1/24", "tenant_if": "t2if", "tenant_ip": "192.168.2.2/24"}, "msg": "non-zero return code", "rc": 1, "start": "2019-11-18 03:26:45.161550", "stderr": "Object \"nlsjdifgjfdbgetns\" is unknown, try \"ip help\".", "stderr_lines": ["Object \"nlsjdifgjfdbgetns\" is unknown, try \"ip help\"."], "stdout": "", "stdout_lines": []}

PLAY RECAP **************************************************************************************************************************************************
localhost                  : ok=0    changed=0    unreachable=0    failed=1    skipped=0    rescued=0    ignored=0   

INFO:root: 03:26:51.919120 Unable to open user input yaml file
INFO:root: 03:26:52.089012 Unable to open user input yaml file
INFO:root: 03:28:05.443823 Printing the yaml input file
INFO:root: 03:28:05.443969 {'C1': [{'subnet_addr': '1.1.1.0/24', 'VM': [{'name': 'VM1', 'disk': '10G', 'mem': 2, 'vcpu': 4}, {'name': 'VM2', 'disk': '10G', 'mem': 4, 'vcpu': 2}]}, {'subnet_addr': '2.2.2.0/24', 'VM': [{'name': 'VM3', 'disk': '10G', 'mem': 3, 'vcpu': 2}]}], 'C2': [{'subnet_addr': '1.1.1.0/24', 'VM': [{'name': 'VM4', 'disk': '10G', 'mem': 2, 'vcpu': 4}]}]}
INFO:root: 03:28:05.444093 Provided subnet in C1: 1.1.1.0/24 is valid
INFO:root: 03:28:05.444155 Provided subnet in C1: 2.2.2.0/24 is valid
INFO:root: 03:28:05.444205 Provided subnet in C2: 1.1.1.0/24 is valid
INFO:root: 03:28:28.375753 Printing the yaml input file
INFO:root: 03:28:28.375933 {'C1': [{'subnet_addr': '1.1.1.0/24', 'VM': [{'name': 'VM1', 'disk': '10G', 'mem': 2, 'vcpu': 4}, {'name': 'VM2', 'disk': '10G', 'mem': 4, 'vcpu': 2}]}, {'subnet_addr': '2.2.2.0/24', 'VM': [{'name': 'VM3', 'disk': '10G', 'mem': 3, 'vcpu': 2}]}], 'C2': [{'subnet_addr': '1.1.1.0/24', 'VM': [{'name': 'VM4', 'disk': '10G', 'mem': 2, 'vcpu': 4}]}]}
INFO:root: 03:28:28.376071 Provided subnet in C1: 1.1.1.0/24 is valid
INFO:root: 03:28:28.376182 Provided subnet in C1: 2.2.2.0/24 is valid
INFO:root: 03:28:28.376253 Provided subnet in C2: 1.1.1.0/24 is valid
Using /etc/ansible/ansible.cfg as config file

PLAY [main] *************************************************************************************************************************************************

TASK [Create Tenant Namespace] ******************************************************************************************************************************
changed: [localhost] => (item={u'default_route_ip': u'192.168.1.1', u'name': u't1', u'pns_ip': u'192.168.1.1/24', u'tenant_if': u't1if', u'tenant_ip': u'192.168.1.2/24', u'pns_if': u't1pns_if'}) => {"ansible_loop_var": "item", "changed": true, "cmd": ["ip", "netns", "add", "t1"], "delta": "0:00:00.053712", "end": "2019-11-18 03:28:29.464046", "item": {"default_route_ip": "192.168.1.1", "name": "t1", "pns_if": "t1pns_if", "pns_ip": "192.168.1.1/24", "tenant_if": "t1if", "tenant_ip": "192.168.1.2/24"}, "rc": 0, "start": "2019-11-18 03:28:29.410334", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Create Subnet Namespace] ******************************************************************************************************************************
changed: [localhost] => (item={u'route': [{u'ip': u'10.1.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.1.2/24', u'tenant_ns_ip': u'10.1.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_ns_name': u't1', u'tenant_sub_if': u't1s1if'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't1_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM1if1'}, {u'mem': 4, u'name': u't1_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br1if2', u'vmif': u't1VM2if1'}], u'vxlan': [{u'local_ip': u'10.1.1.2', u'tenant_route_ip': u'192.168.1.2', u'dsport': 4789, u'dev': u't1s1if', u'subnet_route': u'10.1.1.0/24', u'remote_route': u'10.2.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.2.1.2'}]}) => {"ansible_loop_var": "item", "changed": true, "cmd": ["ip", "netns", "add", "t1ns1"], "delta": "0:00:00.051961", "end": "2019-11-18 03:28:29.784850", "item": {"bridge_name": "t1br1", "default_route_ip": "10.1.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.1.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.1.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.1.1.2/24"}], "vms": [{"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM1", "vcpu": 4, "vmif": "t1VM1if1"}, {"brif": "t1br1if2", "disk": "10G", "mem": 4, "name": "t1_VM2", "vcpu": 2, "vmif": "t1VM2if1"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.1.2", "remote_ip": "10.2.1.2", "remote_route": "10.2.1.0/24", "subnet_route": "10.1.1.0/24", "tenant_route_ip": "192.168.1.2", "v_name": "vxlan_t1s1"}]}, "rc": 0, "start": "2019-11-18 03:28:29.732889", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}
changed: [localhost] => (item={u'route': [{u'ip': u'10.1.2.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.2.1', u'bridge_name': u't1br2', u'dns': [{u'dnsif': u't1s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s2_dnsbrif'}], u'ns_name': u't1ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.2.2/24', u'tenant_ns_ip': u'10.1.2.1/24', u'tenant_ns_if': u't1ns2if', u'tenant_ns_name': u't1', u'tenant_sub_if': u't1s2if'}], u'subnet_ip': u'2.2.2.0/24', u'vms': [{u'mem': 3, u'name': u't1_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br2if1', u'vmif': u't1VM3if1'}], u'vxlan': [{u'local_ip': [], u'tenant_route_ip': [], u'dsport': [], u'dev': [], u'subnet_route': [], u'remote_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}) => {"ansible_loop_var": "item", "changed": true, "cmd": ["ip", "netns", "add", "t1ns2"], "delta": "0:00:00.051751", "end": "2019-11-18 03:28:30.045522", "item": {"bridge_name": "t1br2", "default_route_ip": "10.1.2.1", "dns": [{"brif": "t1s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t1s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns2", "route": [{"if": "p1", "ip": "10.1.2.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "2.2.2.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns2if", "tenant_ns_ip": "10.1.2.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s2if", "tenant_sub_ip": "10.1.2.2/24"}], "vms": [{"brif": "t1br2if1", "disk": "10G", "mem": 3, "name": "t1_VM3", "vcpu": 2, "vmif": "t1VM3if1"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, "rc": 0, "start": "2019-11-18 03:28:29.993771", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Create Tenant VETH pairs] *****************************************************************************************************************************
changed: [localhost] => (item={u'default_route_ip': u'192.168.1.1', u'name': u't1', u'pns_ip': u'192.168.1.1/24', u'tenant_if': u't1if', u'tenant_ip': u'192.168.1.2/24', u'pns_if': u't1pns_if'}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip link show \"t1if\" ; if [ $? -ne 0 ] ; then ip link add \"t1if\" type veth peer name \"t1pns_if\" ; fi\n", "delta": "0:00:00.010303", "end": "2019-11-18 03:28:30.327394", "item": {"default_route_ip": "192.168.1.1", "name": "t1", "pns_if": "t1pns_if", "pns_ip": "192.168.1.1/24", "tenant_if": "t1if", "tenant_ip": "192.168.1.2/24"}, "rc": 0, "start": "2019-11-18 03:28:30.317091", "stderr": "Device \"t1if\" does not exist.", "stderr_lines": ["Device \"t1if\" does not exist."], "stdout": "", "stdout_lines": []}

TASK [Attach Tenant VETH Pairs] *****************************************************************************************************************************
changed: [localhost] => (item={u'default_route_ip': u'192.168.1.1', u'name': u't1', u'pns_ip': u'192.168.1.1/24', u'tenant_if': u't1if', u'tenant_ip': u'192.168.1.2/24', u'pns_if': u't1pns_if'}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec pns ip link show \"t1pns_if\" ; if [ $? -ne 0 ] ; then ip link set \"t1pns_if\" netns pns ; fi\nip netns exec \"t1\" ip link show \"t1if\" ; if [ $? -ne 0 ] ; then ip link set \"t1if\" netns \"t1\" ; fi\nip netns exec pns ip link set dev \"t1pns_if\" up\nip netns exec \"t1\" ip link set dev \"t1if\" up\n", "delta": "0:00:00.217127", "end": "2019-11-18 03:28:30.788068", "item": {"default_route_ip": "192.168.1.1", "name": "t1", "pns_if": "t1pns_if", "pns_ip": "192.168.1.1/24", "tenant_if": "t1if", "tenant_ip": "192.168.1.2/24"}, "rc": 0, "start": "2019-11-18 03:28:30.570941", "stderr": "Device \"t1pns_if\" does not exist.\nDevice \"t1if\" does not exist.", "stderr_lines": ["Device \"t1pns_if\" does not exist.", "Device \"t1if\" does not exist."], "stdout": "", "stdout_lines": []}

TASK [Add IP addresses to Tenant VETH Pairs] ****************************************************************************************************************
changed: [localhost] => (item={u'default_route_ip': u'192.168.1.1', u'name': u't1', u'pns_ip': u'192.168.1.1/24', u'tenant_if': u't1if', u'tenant_ip': u'192.168.1.2/24', u'pns_if': u't1pns_if'}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec pns ip addr show \"t1pns_if\" | awk 'FNR==3{ print $2 }' | grep -w '^192.168.1.1/24' ; if [ $? -ne 0 ] ; then ip netns exec pns ip addr add \"192.168.1.1/24\" dev \"t1pns_if\" ; fi\nip netns exec \"t1\" ip addr show \"t1if\" | awk 'FNR==3{ print $2 }' | grep -w '^192.168.1.2/24' ; if [ $? -ne 0 ] ; then ip netns exec \"t1\" ip addr add \"192.168.1.2/24\" dev \"t1if\" ; fi\n", "delta": "0:00:00.155719", "end": "2019-11-18 03:28:31.192075", "item": {"default_route_ip": "192.168.1.1", "name": "t1", "pns_if": "t1pns_if", "pns_ip": "192.168.1.1/24", "tenant_if": "t1if", "tenant_ip": "192.168.1.2/24"}, "rc": 0, "start": "2019-11-18 03:28:31.036356", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Create Namespace VETH Pairs] **************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't1_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM1if1'}, {u'mem': 4, u'name': u't1_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br1if2', u'vmif': u't1VM2if1'}], u'vxlan': [{u'local_ip': u'10.1.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.1.2', u'remote_route': u'10.2.1.0/24', u'subnet_route': u'10.1.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.2.1.2'}]}, {u'tenant_sub_ip': u'10.1.1.2/24', u'tenant_ns_ip': u'10.1.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip link show \"t1ns1if\" ; if [ $? -ne 0 ] ; then ip link add \"t1ns1if\" type veth peer name \"t1s1if\" ; fi\n", "delta": "0:00:00.010297", "end": "2019-11-18 03:28:31.456163", "item": [{"bridge_name": "t1br1", "default_route_ip": "10.1.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.1.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "vms": [{"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM1", "vcpu": 4, "vmif": "t1VM1if1"}, {"brif": "t1br1if2", "disk": "10G", "mem": 4, "name": "t1_VM2", "vcpu": 2, "vmif": "t1VM2if1"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.1.2", "remote_ip": "10.2.1.2", "remote_route": "10.2.1.0/24", "subnet_route": "10.1.1.0/24", "tenant_route_ip": "192.168.1.2", "v_name": "vxlan_t1s1"}]}, {"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.1.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.1.1.2/24"}], "rc": 0, "start": "2019-11-18 03:28:31.445866", "stderr": "Device \"t1ns1if\" does not exist.", "stderr_lines": ["Device \"t1ns1if\" does not exist."], "stdout": "", "stdout_lines": []}
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.2.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.2.1', u'bridge_name': u't1br2', u'dns': [{u'dnsif': u't1s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s2_dnsbrif'}], u'ns_name': u't1ns2', u'subnet_ip': u'2.2.2.0/24', u'vms': [{u'mem': 3, u'name': u't1_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br2if1', u'vmif': u't1VM3if1'}], u'vxlan': [{u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}, {u'tenant_sub_ip': u'10.1.2.2/24', u'tenant_ns_ip': u'10.1.2.1/24', u'tenant_ns_if': u't1ns2if', u'tenant_sub_if': u't1s2if', u'tenant_ns_name': u't1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip link show \"t1ns2if\" ; if [ $? -ne 0 ] ; then ip link add \"t1ns2if\" type veth peer name \"t1s2if\" ; fi\n", "delta": "0:00:00.011412", "end": "2019-11-18 03:28:31.679532", "item": [{"bridge_name": "t1br2", "default_route_ip": "10.1.2.1", "dns": [{"brif": "t1s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t1s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns2", "route": [{"if": "p1", "ip": "10.1.2.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "2.2.2.0/24", "vms": [{"brif": "t1br2if1", "disk": "10G", "mem": 3, "name": "t1_VM3", "vcpu": 2, "vmif": "t1VM3if1"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, {"tenant_ns_if": "t1ns2if", "tenant_ns_ip": "10.1.2.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s2if", "tenant_sub_ip": "10.1.2.2/24"}], "rc": 0, "start": "2019-11-18 03:28:31.668120", "stderr": "Device \"t1ns2if\" does not exist.", "stderr_lines": ["Device \"t1ns2if\" does not exist."], "stdout": "", "stdout_lines": []}

TASK [Attach Namespace VETH Pairs] **************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't1_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM1if1'}, {u'mem': 4, u'name': u't1_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br1if2', u'vmif': u't1VM2if1'}], u'vxlan': [{u'local_ip': u'10.1.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.1.2', u'remote_route': u'10.2.1.0/24', u'subnet_route': u'10.1.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.2.1.2'}]}, {u'tenant_sub_ip': u'10.1.1.2/24', u'tenant_ns_ip': u'10.1.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t1\" ip link show \"t1ns1if\" ; if [ $? -ne 0 ] ; then ip link set \"t1ns1if\" netns \"t1\" ; fi\nip netns exec \"t1ns1\" ip link show \"t1s1if\" ; if [ $? -ne 0 ] ; then ip link set \"t1s1if\" netns \"t1ns1\" ; fi\n", "delta": "0:00:00.109309", "end": "2019-11-18 03:28:32.057400", "item": [{"bridge_name": "t1br1", "default_route_ip": "10.1.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.1.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "vms": [{"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM1", "vcpu": 4, "vmif": "t1VM1if1"}, {"brif": "t1br1if2", "disk": "10G", "mem": 4, "name": "t1_VM2", "vcpu": 2, "vmif": "t1VM2if1"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.1.2", "remote_ip": "10.2.1.2", "remote_route": "10.2.1.0/24", "subnet_route": "10.1.1.0/24", "tenant_route_ip": "192.168.1.2", "v_name": "vxlan_t1s1"}]}, {"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.1.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.1.1.2/24"}], "rc": 0, "start": "2019-11-18 03:28:31.948091", "stderr": "Device \"t1ns1if\" does not exist.\nDevice \"t1s1if\" does not exist.", "stderr_lines": ["Device \"t1ns1if\" does not exist.", "Device \"t1s1if\" does not exist."], "stdout": "", "stdout_lines": []}
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.2.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.2.1', u'bridge_name': u't1br2', u'dns': [{u'dnsif': u't1s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s2_dnsbrif'}], u'ns_name': u't1ns2', u'subnet_ip': u'2.2.2.0/24', u'vms': [{u'mem': 3, u'name': u't1_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br2if1', u'vmif': u't1VM3if1'}], u'vxlan': [{u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}, {u'tenant_sub_ip': u'10.1.2.2/24', u'tenant_ns_ip': u'10.1.2.1/24', u'tenant_ns_if': u't1ns2if', u'tenant_sub_if': u't1s2if', u'tenant_ns_name': u't1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t1\" ip link show \"t1ns2if\" ; if [ $? -ne 0 ] ; then ip link set \"t1ns2if\" netns \"t1\" ; fi\nip netns exec \"t1ns2\" ip link show \"t1s2if\" ; if [ $? -ne 0 ] ; then ip link set \"t1s2if\" netns \"t1ns2\" ; fi\n", "delta": "0:00:00.136371", "end": "2019-11-18 03:28:32.400567", "item": [{"bridge_name": "t1br2", "default_route_ip": "10.1.2.1", "dns": [{"brif": "t1s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t1s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns2", "route": [{"if": "p1", "ip": "10.1.2.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "2.2.2.0/24", "vms": [{"brif": "t1br2if1", "disk": "10G", "mem": 3, "name": "t1_VM3", "vcpu": 2, "vmif": "t1VM3if1"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, {"tenant_ns_if": "t1ns2if", "tenant_ns_ip": "10.1.2.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s2if", "tenant_sub_ip": "10.1.2.2/24"}], "rc": 0, "start": "2019-11-18 03:28:32.264196", "stderr": "Device \"t1ns2if\" does not exist.\nDevice \"t1s2if\" does not exist.", "stderr_lines": ["Device \"t1ns2if\" does not exist.", "Device \"t1s2if\" does not exist."], "stdout": "", "stdout_lines": []}

TASK [Set Namespace VETH Pairs UP] **************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't1_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM1if1'}, {u'mem': 4, u'name': u't1_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br1if2', u'vmif': u't1VM2if1'}], u'vxlan': [{u'local_ip': u'10.1.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.1.2', u'remote_route': u'10.2.1.0/24', u'subnet_route': u'10.1.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.2.1.2'}]}, {u'tenant_sub_ip': u'10.1.1.2/24', u'tenant_ns_ip': u'10.1.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t1\" ip link set dev \"t1ns1if\" up\nip netns exec \"t1ns1\" ip link set dev \"t1s1if\" up\n", "delta": "0:00:00.089212", "end": "2019-11-18 03:28:32.760040", "item": [{"bridge_name": "t1br1", "default_route_ip": "10.1.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.1.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "vms": [{"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM1", "vcpu": 4, "vmif": "t1VM1if1"}, {"brif": "t1br1if2", "disk": "10G", "mem": 4, "name": "t1_VM2", "vcpu": 2, "vmif": "t1VM2if1"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.1.2", "remote_ip": "10.2.1.2", "remote_route": "10.2.1.0/24", "subnet_route": "10.1.1.0/24", "tenant_route_ip": "192.168.1.2", "v_name": "vxlan_t1s1"}]}, {"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.1.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.1.1.2/24"}], "rc": 0, "start": "2019-11-18 03:28:32.670828", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.2.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.2.1', u'bridge_name': u't1br2', u'dns': [{u'dnsif': u't1s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s2_dnsbrif'}], u'ns_name': u't1ns2', u'subnet_ip': u'2.2.2.0/24', u'vms': [{u'mem': 3, u'name': u't1_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br2if1', u'vmif': u't1VM3if1'}], u'vxlan': [{u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}, {u'tenant_sub_ip': u'10.1.2.2/24', u'tenant_ns_ip': u'10.1.2.1/24', u'tenant_ns_if': u't1ns2if', u'tenant_sub_if': u't1s2if', u'tenant_ns_name': u't1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t1\" ip link set dev \"t1ns2if\" up\nip netns exec \"t1ns2\" ip link set dev \"t1s2if\" up\n", "delta": "0:00:00.071425", "end": "2019-11-18 03:28:33.043785", "item": [{"bridge_name": "t1br2", "default_route_ip": "10.1.2.1", "dns": [{"brif": "t1s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t1s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns2", "route": [{"if": "p1", "ip": "10.1.2.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "2.2.2.0/24", "vms": [{"brif": "t1br2if1", "disk": "10G", "mem": 3, "name": "t1_VM3", "vcpu": 2, "vmif": "t1VM3if1"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, {"tenant_ns_if": "t1ns2if", "tenant_ns_ip": "10.1.2.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s2if", "tenant_sub_ip": "10.1.2.2/24"}], "rc": 0, "start": "2019-11-18 03:28:32.972360", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Add IP addresses to Namespace VETH Pairs] *************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't1_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM1if1'}, {u'mem': 4, u'name': u't1_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br1if2', u'vmif': u't1VM2if1'}], u'vxlan': [{u'local_ip': u'10.1.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.1.2', u'remote_route': u'10.2.1.0/24', u'subnet_route': u'10.1.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.2.1.2'}]}, {u'tenant_sub_ip': u'10.1.1.2/24', u'tenant_ns_ip': u'10.1.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t1ns1\" ip addr show \"t1s1if\" | awk 'FNR==3{ print $2 }' | grep -w '^10.1.1.2/24' ; if [ $? -ne 0 ] ; then ip netns exec \"t1ns1\" ip addr add \"10.1.1.2/24\" dev \"t1s1if\" ; fi\n\nip netns exec \"t1\" ip addr show \"t1ns1if\" | awk 'FNR==3{ print $2 }' | grep -w '^10.1.1.1/24' ; if [ $? -ne 0 ] ; then ip netns exec \"t1\" ip addr add \"10.1.1.1/24\" dev \"t1ns1if\" ; fi\n", "delta": "0:00:00.148470", "end": "2019-11-18 03:28:33.459751", "item": [{"bridge_name": "t1br1", "default_route_ip": "10.1.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.1.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "vms": [{"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM1", "vcpu": 4, "vmif": "t1VM1if1"}, {"brif": "t1br1if2", "disk": "10G", "mem": 4, "name": "t1_VM2", "vcpu": 2, "vmif": "t1VM2if1"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.1.2", "remote_ip": "10.2.1.2", "remote_route": "10.2.1.0/24", "subnet_route": "10.1.1.0/24", "tenant_route_ip": "192.168.1.2", "v_name": "vxlan_t1s1"}]}, {"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.1.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.1.1.2/24"}], "rc": 0, "start": "2019-11-18 03:28:33.311281", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.2.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.2.1', u'bridge_name': u't1br2', u'dns': [{u'dnsif': u't1s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s2_dnsbrif'}], u'ns_name': u't1ns2', u'subnet_ip': u'2.2.2.0/24', u'vms': [{u'mem': 3, u'name': u't1_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br2if1', u'vmif': u't1VM3if1'}], u'vxlan': [{u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}, {u'tenant_sub_ip': u'10.1.2.2/24', u'tenant_ns_ip': u'10.1.2.1/24', u'tenant_ns_if': u't1ns2if', u'tenant_sub_if': u't1s2if', u'tenant_ns_name': u't1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t1ns2\" ip addr show \"t1s2if\" | awk 'FNR==3{ print $2 }' | grep -w '^10.1.2.2/24' ; if [ $? -ne 0 ] ; then ip netns exec \"t1ns2\" ip addr add \"10.1.2.2/24\" dev \"t1s2if\" ; fi\n\nip netns exec \"t1\" ip addr show \"t1ns2if\" | awk 'FNR==3{ print $2 }' | grep -w '^10.1.2.1/24' ; if [ $? -ne 0 ] ; then ip netns exec \"t1\" ip addr add \"10.1.2.1/24\" dev \"t1ns2if\" ; fi\n", "delta": "0:00:00.145972", "end": "2019-11-18 03:28:33.783779", "item": [{"bridge_name": "t1br2", "default_route_ip": "10.1.2.1", "dns": [{"brif": "t1s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t1s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns2", "route": [{"if": "p1", "ip": "10.1.2.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "2.2.2.0/24", "vms": [{"brif": "t1br2if1", "disk": "10G", "mem": 3, "name": "t1_VM3", "vcpu": 2, "vmif": "t1VM3if1"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, {"tenant_ns_if": "t1ns2if", "tenant_ns_ip": "10.1.2.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s2if", "tenant_sub_ip": "10.1.2.2/24"}], "rc": 0, "start": "2019-11-18 03:28:33.637807", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Add IP Route to Tenant] *******************************************************************************************************************************
changed: [localhost] => (item={u'default_route_ip': u'192.168.1.1', u'name': u't1', u'pns_ip': u'192.168.1.1/24', u'tenant_if': u't1if', u'tenant_ip': u'192.168.1.2/24', u'pns_if': u't1pns_if'}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t1\" ip route show default | grep -w '[d]efault via 192.168.1.1' ; if [ $? -ne 0 ] ; then ip netns exec \"t1\" ip route add default via \"192.168.1.1\" ; fi\n", "delta": "0:00:00.081722", "end": "2019-11-18 03:28:34.103694", "item": {"default_route_ip": "192.168.1.1", "name": "t1", "pns_if": "t1pns_if", "pns_ip": "192.168.1.1/24", "tenant_if": "t1if", "tenant_ip": "192.168.1.2/24"}, "rc": 0, "start": "2019-11-18 03:28:34.021972", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Add IP Route to Tenant Subnet] ************************************************************************************************************************
changed: [localhost] => (item={u'route': [{u'ip': u'10.1.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.1.2/24', u'tenant_ns_ip': u'10.1.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_ns_name': u't1', u'tenant_sub_if': u't1s1if'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't1_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM1if1'}, {u'mem': 4, u'name': u't1_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br1if2', u'vmif': u't1VM2if1'}], u'vxlan': [{u'local_ip': u'10.1.1.2', u'tenant_route_ip': u'192.168.1.2', u'dsport': 4789, u'dev': u't1s1if', u'subnet_route': u'10.1.1.0/24', u'remote_route': u'10.2.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.2.1.2'}]}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t1ns1\" ip route show default | grep -w '[d]efault via 10.1.1.1' ; if [ $? -ne 0 ] ; then ip netns exec \"t1ns1\" ip route add default via \"10.1.1.1\" ; fi\n", "delta": "0:00:00.073120", "end": "2019-11-18 03:28:34.435026", "item": {"bridge_name": "t1br1", "default_route_ip": "10.1.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.1.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.1.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.1.1.2/24"}], "vms": [{"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM1", "vcpu": 4, "vmif": "t1VM1if1"}, {"brif": "t1br1if2", "disk": "10G", "mem": 4, "name": "t1_VM2", "vcpu": 2, "vmif": "t1VM2if1"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.1.2", "remote_ip": "10.2.1.2", "remote_route": "10.2.1.0/24", "subnet_route": "10.1.1.0/24", "tenant_route_ip": "192.168.1.2", "v_name": "vxlan_t1s1"}]}, "rc": 0, "start": "2019-11-18 03:28:34.361906", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}
changed: [localhost] => (item={u'route': [{u'ip': u'10.1.2.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.2.1', u'bridge_name': u't1br2', u'dns': [{u'dnsif': u't1s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s2_dnsbrif'}], u'ns_name': u't1ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.2.2/24', u'tenant_ns_ip': u'10.1.2.1/24', u'tenant_ns_if': u't1ns2if', u'tenant_ns_name': u't1', u'tenant_sub_if': u't1s2if'}], u'subnet_ip': u'2.2.2.0/24', u'vms': [{u'mem': 3, u'name': u't1_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br2if1', u'vmif': u't1VM3if1'}], u'vxlan': [{u'local_ip': [], u'tenant_route_ip': [], u'dsport': [], u'dev': [], u'subnet_route': [], u'remote_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t1ns2\" ip route show default | grep -w '[d]efault via 10.1.2.1' ; if [ $? -ne 0 ] ; then ip netns exec \"t1ns2\" ip route add default via \"10.1.2.1\" ; fi\n", "delta": "0:00:00.093022", "end": "2019-11-18 03:28:34.739911", "item": {"bridge_name": "t1br2", "default_route_ip": "10.1.2.1", "dns": [{"brif": "t1s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t1s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns2", "route": [{"if": "p1", "ip": "10.1.2.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "2.2.2.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns2if", "tenant_ns_ip": "10.1.2.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s2if", "tenant_sub_ip": "10.1.2.2/24"}], "vms": [{"brif": "t1br2if1", "disk": "10G", "mem": 3, "name": "t1_VM3", "vcpu": 2, "vmif": "t1VM3if1"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, "rc": 0, "start": "2019-11-18 03:28:34.646889", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Create bridge inside namespace] ***********************************************************************************************************************
changed: [localhost] => (item={u'route': [{u'ip': u'10.1.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.1.2/24', u'tenant_ns_ip': u'10.1.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_ns_name': u't1', u'tenant_sub_if': u't1s1if'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't1_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM1if1'}, {u'mem': 4, u'name': u't1_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br1if2', u'vmif': u't1VM2if1'}], u'vxlan': [{u'local_ip': u'10.1.1.2', u'tenant_route_ip': u'192.168.1.2', u'dsport': 4789, u'dev': u't1s1if', u'subnet_route': u'10.1.1.0/24', u'remote_route': u'10.2.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.2.1.2'}]}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t1ns1\" brctl show | grep -w '^t1br1'; if [ $? -ne 0 ] ; then ip netns exec \"t1ns1\" brctl addbr \"t1br1\" ; fi\nip netns exec \"t1ns1\" ip link set dev \"t1br1\" up\n", "delta": "0:00:00.104487", "end": "2019-11-18 03:28:35.111942", "item": {"bridge_name": "t1br1", "default_route_ip": "10.1.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.1.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.1.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.1.1.2/24"}], "vms": [{"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM1", "vcpu": 4, "vmif": "t1VM1if1"}, {"brif": "t1br1if2", "disk": "10G", "mem": 4, "name": "t1_VM2", "vcpu": 2, "vmif": "t1VM2if1"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.1.2", "remote_ip": "10.2.1.2", "remote_route": "10.2.1.0/24", "subnet_route": "10.1.1.0/24", "tenant_route_ip": "192.168.1.2", "v_name": "vxlan_t1s1"}]}, "rc": 0, "start": "2019-11-18 03:28:35.007455", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}
changed: [localhost] => (item={u'route': [{u'ip': u'10.1.2.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.2.1', u'bridge_name': u't1br2', u'dns': [{u'dnsif': u't1s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s2_dnsbrif'}], u'ns_name': u't1ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.2.2/24', u'tenant_ns_ip': u'10.1.2.1/24', u'tenant_ns_if': u't1ns2if', u'tenant_ns_name': u't1', u'tenant_sub_if': u't1s2if'}], u'subnet_ip': u'2.2.2.0/24', u'vms': [{u'mem': 3, u'name': u't1_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br2if1', u'vmif': u't1VM3if1'}], u'vxlan': [{u'local_ip': [], u'tenant_route_ip': [], u'dsport': [], u'dev': [], u'subnet_route': [], u'remote_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t1ns2\" brctl show | grep -w '^t1br2'; if [ $? -ne 0 ] ; then ip netns exec \"t1ns2\" brctl addbr \"t1br2\" ; fi\nip netns exec \"t1ns2\" ip link set dev \"t1br2\" up\n", "delta": "0:00:00.099684", "end": "2019-11-18 03:28:35.419987", "item": {"bridge_name": "t1br2", "default_route_ip": "10.1.2.1", "dns": [{"brif": "t1s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t1s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns2", "route": [{"if": "p1", "ip": "10.1.2.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "2.2.2.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns2if", "tenant_ns_ip": "10.1.2.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s2if", "tenant_sub_ip": "10.1.2.2/24"}], "vms": [{"brif": "t1br2if1", "disk": "10G", "mem": 3, "name": "t1_VM3", "vcpu": 2, "vmif": "t1VM3if1"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, "rc": 0, "start": "2019-11-18 03:28:35.320303", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Create DNS VETH Pair] *********************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.1.1', u'bridge_name': u't1br1', u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.1.2/24', u'tenant_ns_ip': u'10.1.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't1_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM1if1'}, {u'mem': 4, u'name': u't1_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br1if2', u'vmif': u't1VM2if1'}], u'vxlan': [{u'local_ip': u'10.1.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.1.2', u'remote_route': u'10.2.1.0/24', u'subnet_route': u'10.1.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.2.1.2'}]}, {u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t1ns1\" ip link show \"t1s1_dnsbrif\" ; if [ $? -ne 0 ] ; then ip netns exec \"t1ns1\" ip link add \"t1s1_dnsbrif\" type veth peer name \"t1s1_dnsif\" ; fi\nip netns exec \"t1ns1\" ip link set dev \"t1s1_dnsbrif\" up\nip netns exec \"t1ns1\" ip link set dev \"t1s1_dnsif\" up\n", "delta": "0:00:00.144237", "end": "2019-11-18 03:28:35.835834", "item": [{"bridge_name": "t1br1", "default_route_ip": "10.1.1.1", "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.1.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.1.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.1.1.2/24"}], "vms": [{"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM1", "vcpu": 4, "vmif": "t1VM1if1"}, {"brif": "t1br1if2", "disk": "10G", "mem": 4, "name": "t1_VM2", "vcpu": 2, "vmif": "t1VM2if1"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.1.2", "remote_ip": "10.2.1.2", "remote_route": "10.2.1.0/24", "subnet_route": "10.1.1.0/24", "tenant_route_ip": "192.168.1.2", "v_name": "vxlan_t1s1"}]}, {"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "rc": 0, "start": "2019-11-18 03:28:35.691597", "stderr": "Device \"t1s1_dnsbrif\" does not exist.", "stderr_lines": ["Device \"t1s1_dnsbrif\" does not exist."], "stdout": "", "stdout_lines": []}
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.2.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.2.1', u'bridge_name': u't1br2', u'ns_name': u't1ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.2.2/24', u'tenant_ns_ip': u'10.1.2.1/24', u'tenant_ns_if': u't1ns2if', u'tenant_sub_if': u't1s2if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'2.2.2.0/24', u'vms': [{u'mem': 3, u'name': u't1_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br2if1', u'vmif': u't1VM3if1'}], u'vxlan': [{u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}, {u'dnsif': u't1s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s2_dnsbrif'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t1ns2\" ip link show \"t1s2_dnsbrif\" ; if [ $? -ne 0 ] ; then ip netns exec \"t1ns2\" ip link add \"t1s2_dnsbrif\" type veth peer name \"t1s2_dnsif\" ; fi\nip netns exec \"t1ns2\" ip link set dev \"t1s2_dnsbrif\" up\nip netns exec \"t1ns2\" ip link set dev \"t1s2_dnsif\" up\n", "delta": "0:00:00.157995", "end": "2019-11-18 03:28:36.203917", "item": [{"bridge_name": "t1br2", "default_route_ip": "10.1.2.1", "ns_name": "t1ns2", "route": [{"if": "p1", "ip": "10.1.2.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "2.2.2.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns2if", "tenant_ns_ip": "10.1.2.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s2if", "tenant_sub_ip": "10.1.2.2/24"}], "vms": [{"brif": "t1br2if1", "disk": "10G", "mem": 3, "name": "t1_VM3", "vcpu": 2, "vmif": "t1VM3if1"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, {"brif": "t1s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t1s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "rc": 0, "start": "2019-11-18 03:28:36.045922", "stderr": "Device \"t1s2_dnsbrif\" does not exist.", "stderr_lines": ["Device \"t1s2_dnsbrif\" does not exist."], "stdout": "", "stdout_lines": []}

TASK [Attach DNS VETH Pair] *********************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.1.1', u'bridge_name': u't1br1', u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.1.2/24', u'tenant_ns_ip': u'10.1.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't1_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM1if1'}, {u'mem': 4, u'name': u't1_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br1if2', u'vmif': u't1VM2if1'}], u'vxlan': [{u'local_ip': u'10.1.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.1.2', u'remote_route': u'10.2.1.0/24', u'subnet_route': u'10.1.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.2.1.2'}]}, {u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t1ns1\" brctl show \"t1br1\" | grep -w 't1s1_dnsbrif' ; if [ $? -ne 0 ] ; then ip netns exec \"t1ns1\" brctl addif \"t1br1\" \"t1s1_dnsbrif\" ; fi\n", "delta": "0:00:00.077981", "end": "2019-11-18 03:28:36.536319", "item": [{"bridge_name": "t1br1", "default_route_ip": "10.1.1.1", "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.1.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.1.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.1.1.2/24"}], "vms": [{"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM1", "vcpu": 4, "vmif": "t1VM1if1"}, {"brif": "t1br1if2", "disk": "10G", "mem": 4, "name": "t1_VM2", "vcpu": 2, "vmif": "t1VM2if1"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.1.2", "remote_ip": "10.2.1.2", "remote_route": "10.2.1.0/24", "subnet_route": "10.1.1.0/24", "tenant_route_ip": "192.168.1.2", "v_name": "vxlan_t1s1"}]}, {"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "rc": 0, "start": "2019-11-18 03:28:36.458338", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.2.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.2.1', u'bridge_name': u't1br2', u'ns_name': u't1ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.2.2/24', u'tenant_ns_ip': u'10.1.2.1/24', u'tenant_ns_if': u't1ns2if', u'tenant_sub_if': u't1s2if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'2.2.2.0/24', u'vms': [{u'mem': 3, u'name': u't1_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br2if1', u'vmif': u't1VM3if1'}], u'vxlan': [{u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}, {u'dnsif': u't1s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s2_dnsbrif'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t1ns2\" brctl show \"t1br2\" | grep -w 't1s2_dnsbrif' ; if [ $? -ne 0 ] ; then ip netns exec \"t1ns2\" brctl addif \"t1br2\" \"t1s2_dnsbrif\" ; fi\n", "delta": "0:00:00.083502", "end": "2019-11-18 03:28:36.807731", "item": [{"bridge_name": "t1br2", "default_route_ip": "10.1.2.1", "ns_name": "t1ns2", "route": [{"if": "p1", "ip": "10.1.2.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "2.2.2.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns2if", "tenant_ns_ip": "10.1.2.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s2if", "tenant_sub_ip": "10.1.2.2/24"}], "vms": [{"brif": "t1br2if1", "disk": "10G", "mem": 3, "name": "t1_VM3", "vcpu": 2, "vmif": "t1VM3if1"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, {"brif": "t1s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t1s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "rc": 0, "start": "2019-11-18 03:28:36.724229", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Create VETH Pairs] ************************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.1.2/24', u'tenant_ns_ip': u'10.1.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.1.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.1.2', u'remote_route': u'10.2.1.0/24', u'subnet_route': u'10.1.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.2.1.2'}]}, {u'mem': 2, u'name': u't1_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM1if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip link show \"t1br1if1\" ; if [ $? -ne 0 ] ; then ip link add \"t1VM1if1\" type veth peer name \"t1br1if1\" ; fi\nip link set dev \"t1br1if1\" up\nip link set dev \"t1VM1if1\" up\n", "delta": "0:00:00.013415", "end": "2019-11-18 03:28:37.063437", "item": [{"bridge_name": "t1br1", "default_route_ip": "10.1.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.1.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.1.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.1.1.2/24"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.1.2", "remote_ip": "10.2.1.2", "remote_route": "10.2.1.0/24", "subnet_route": "10.1.1.0/24", "tenant_route_ip": "192.168.1.2", "v_name": "vxlan_t1s1"}]}, {"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM1", "vcpu": 4, "vmif": "t1VM1if1"}], "rc": 0, "start": "2019-11-18 03:28:37.050022", "stderr": "Device \"t1br1if1\" does not exist.", "stderr_lines": ["Device \"t1br1if1\" does not exist."], "stdout": "", "stdout_lines": []}
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.1.2/24', u'tenant_ns_ip': u'10.1.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.1.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.1.2', u'remote_route': u'10.2.1.0/24', u'subnet_route': u'10.1.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.2.1.2'}]}, {u'mem': 4, u'name': u't1_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br1if2', u'vmif': u't1VM2if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip link show \"t1br1if2\" ; if [ $? -ne 0 ] ; then ip link add \"t1VM2if1\" type veth peer name \"t1br1if2\" ; fi\nip link set dev \"t1br1if2\" up\nip link set dev \"t1VM2if1\" up\n", "delta": "0:00:00.015770", "end": "2019-11-18 03:28:37.276547", "item": [{"bridge_name": "t1br1", "default_route_ip": "10.1.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.1.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.1.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.1.1.2/24"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.1.2", "remote_ip": "10.2.1.2", "remote_route": "10.2.1.0/24", "subnet_route": "10.1.1.0/24", "tenant_route_ip": "192.168.1.2", "v_name": "vxlan_t1s1"}]}, {"brif": "t1br1if2", "disk": "10G", "mem": 4, "name": "t1_VM2", "vcpu": 2, "vmif": "t1VM2if1"}], "rc": 0, "start": "2019-11-18 03:28:37.260777", "stderr": "Device \"t1br1if2\" does not exist.", "stderr_lines": ["Device \"t1br1if2\" does not exist."], "stdout": "", "stdout_lines": []}
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.2.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.2.1', u'bridge_name': u't1br2', u'dns': [{u'dnsif': u't1s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s2_dnsbrif'}], u'ns_name': u't1ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.2.2/24', u'tenant_ns_ip': u'10.1.2.1/24', u'tenant_ns_if': u't1ns2if', u'tenant_sub_if': u't1s2if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'2.2.2.0/24', u'vxlan': [{u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}, {u'mem': 3, u'name': u't1_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br2if1', u'vmif': u't1VM3if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip link show \"t1br2if1\" ; if [ $? -ne 0 ] ; then ip link add \"t1VM3if1\" type veth peer name \"t1br2if1\" ; fi\nip link set dev \"t1br2if1\" up\nip link set dev \"t1VM3if1\" up\n", "delta": "0:00:00.014275", "end": "2019-11-18 03:28:37.479968", "item": [{"bridge_name": "t1br2", "default_route_ip": "10.1.2.1", "dns": [{"brif": "t1s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t1s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns2", "route": [{"if": "p1", "ip": "10.1.2.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "2.2.2.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns2if", "tenant_ns_ip": "10.1.2.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s2if", "tenant_sub_ip": "10.1.2.2/24"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, {"brif": "t1br2if1", "disk": "10G", "mem": 3, "name": "t1_VM3", "vcpu": 2, "vmif": "t1VM3if1"}], "rc": 0, "start": "2019-11-18 03:28:37.465693", "stderr": "Device \"t1br2if1\" does not exist.", "stderr_lines": ["Device \"t1br2if1\" does not exist."], "stdout": "", "stdout_lines": []}

TASK [Attach VETH Pairs] ************************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.1.2/24', u'tenant_ns_ip': u'10.1.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.1.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.1.2', u'remote_route': u'10.2.1.0/24', u'subnet_route': u'10.1.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.2.1.2'}]}, {u'mem': 2, u'name': u't1_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM1if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip link show \"t1br1if1\" ; if [ $? -eq 0 ] ; then ip link set \"t1br1if1\" netns \"t1ns1\" ; fi\nip netns exec \"t1ns1\" brctl show \"t1br1\" | grep -w 't1br1if1' ; if [ $? -ne 0 ] ; then ip netns exec \"t1ns1\" brctl addif \"t1br1\" \"t1br1if1\" ; fi\n", "delta": "0:00:00.103507", "end": "2019-11-18 03:28:37.851801", "item": [{"bridge_name": "t1br1", "default_route_ip": "10.1.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.1.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.1.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.1.1.2/24"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.1.2", "remote_ip": "10.2.1.2", "remote_route": "10.2.1.0/24", "subnet_route": "10.1.1.0/24", "tenant_route_ip": "192.168.1.2", "v_name": "vxlan_t1s1"}]}, {"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM1", "vcpu": 4, "vmif": "t1VM1if1"}], "rc": 0, "start": "2019-11-18 03:28:37.748294", "stderr": "", "stderr_lines": [], "stdout": "20: t1br1if1@t1VM1if1: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP mode DEFAULT group default qlen 1000\n    link/ether be:ab:26:94:4a:01 brd ff:ff:ff:ff:ff:ff", "stdout_lines": ["20: t1br1if1@t1VM1if1: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP mode DEFAULT group default qlen 1000", "    link/ether be:ab:26:94:4a:01 brd ff:ff:ff:ff:ff:ff"]}
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.1.2/24', u'tenant_ns_ip': u'10.1.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.1.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.1.2', u'remote_route': u'10.2.1.0/24', u'subnet_route': u'10.1.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.2.1.2'}]}, {u'mem': 4, u'name': u't1_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br1if2', u'vmif': u't1VM2if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip link show \"t1br1if2\" ; if [ $? -eq 0 ] ; then ip link set \"t1br1if2\" netns \"t1ns1\" ; fi\nip netns exec \"t1ns1\" brctl show \"t1br1\" | grep -w 't1br1if2' ; if [ $? -ne 0 ] ; then ip netns exec \"t1ns1\" brctl addif \"t1br1\" \"t1br1if2\" ; fi\n", "delta": "0:00:00.098914", "end": "2019-11-18 03:28:38.155796", "item": [{"bridge_name": "t1br1", "default_route_ip": "10.1.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.1.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.1.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.1.1.2/24"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.1.2", "remote_ip": "10.2.1.2", "remote_route": "10.2.1.0/24", "subnet_route": "10.1.1.0/24", "tenant_route_ip": "192.168.1.2", "v_name": "vxlan_t1s1"}]}, {"brif": "t1br1if2", "disk": "10G", "mem": 4, "name": "t1_VM2", "vcpu": 2, "vmif": "t1VM2if1"}], "rc": 0, "start": "2019-11-18 03:28:38.056882", "stderr": "", "stderr_lines": [], "stdout": "22: t1br1if2@t1VM2if1: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP mode DEFAULT group default qlen 1000\n    link/ether 3a:5d:a4:08:37:89 brd ff:ff:ff:ff:ff:ff", "stdout_lines": ["22: t1br1if2@t1VM2if1: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP mode DEFAULT group default qlen 1000", "    link/ether 3a:5d:a4:08:37:89 brd ff:ff:ff:ff:ff:ff"]}
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.2.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.2.1', u'bridge_name': u't1br2', u'dns': [{u'dnsif': u't1s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s2_dnsbrif'}], u'ns_name': u't1ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.2.2/24', u'tenant_ns_ip': u'10.1.2.1/24', u'tenant_ns_if': u't1ns2if', u'tenant_sub_if': u't1s2if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'2.2.2.0/24', u'vxlan': [{u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}, {u'mem': 3, u'name': u't1_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br2if1', u'vmif': u't1VM3if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip link show \"t1br2if1\" ; if [ $? -eq 0 ] ; then ip link set \"t1br2if1\" netns \"t1ns2\" ; fi\nip netns exec \"t1ns2\" brctl show \"t1br2\" | grep -w 't1br2if1' ; if [ $? -ne 0 ] ; then ip netns exec \"t1ns2\" brctl addif \"t1br2\" \"t1br2if1\" ; fi\n", "delta": "0:00:00.110693", "end": "2019-11-18 03:28:38.467887", "item": [{"bridge_name": "t1br2", "default_route_ip": "10.1.2.1", "dns": [{"brif": "t1s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t1s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns2", "route": [{"if": "p1", "ip": "10.1.2.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "2.2.2.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns2if", "tenant_ns_ip": "10.1.2.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s2if", "tenant_sub_ip": "10.1.2.2/24"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, {"brif": "t1br2if1", "disk": "10G", "mem": 3, "name": "t1_VM3", "vcpu": 2, "vmif": "t1VM3if1"}], "rc": 0, "start": "2019-11-18 03:28:38.357194", "stderr": "", "stderr_lines": [], "stdout": "24: t1br2if1@t1VM3if1: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP mode DEFAULT group default qlen 1000\n    link/ether 56:29:b7:19:75:f5 brd ff:ff:ff:ff:ff:ff", "stdout_lines": ["24: t1br2if1@t1VM3if1: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP mode DEFAULT group default qlen 1000", "    link/ether 56:29:b7:19:75:f5 brd ff:ff:ff:ff:ff:ff"]}

TASK [All interfaces and bridges UP] ************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.1.2/24', u'tenant_ns_ip': u'10.1.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.1.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.1.2', u'remote_route': u'10.2.1.0/24', u'subnet_route': u'10.1.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.2.1.2'}]}, {u'mem': 2, u'name': u't1_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM1if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t1ns1\" ip link set \"t1br1if1\" up\nip netns exec \"t1ns1\" ip link set dev \"t1br1\" up\n", "delta": "0:00:00.064483", "end": "2019-11-18 03:28:38.811910", "item": [{"bridge_name": "t1br1", "default_route_ip": "10.1.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.1.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.1.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.1.1.2/24"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.1.2", "remote_ip": "10.2.1.2", "remote_route": "10.2.1.0/24", "subnet_route": "10.1.1.0/24", "tenant_route_ip": "192.168.1.2", "v_name": "vxlan_t1s1"}]}, {"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM1", "vcpu": 4, "vmif": "t1VM1if1"}], "rc": 0, "start": "2019-11-18 03:28:38.747427", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.1.2/24', u'tenant_ns_ip': u'10.1.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.1.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.1.2', u'remote_route': u'10.2.1.0/24', u'subnet_route': u'10.1.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.2.1.2'}]}, {u'mem': 4, u'name': u't1_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br1if2', u'vmif': u't1VM2if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t1ns1\" ip link set \"t1br1if2\" up\nip netns exec \"t1ns1\" ip link set dev \"t1br1\" up\n", "delta": "0:00:00.066059", "end": "2019-11-18 03:28:39.087906", "item": [{"bridge_name": "t1br1", "default_route_ip": "10.1.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.1.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.1.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.1.1.2/24"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.1.2", "remote_ip": "10.2.1.2", "remote_route": "10.2.1.0/24", "subnet_route": "10.1.1.0/24", "tenant_route_ip": "192.168.1.2", "v_name": "vxlan_t1s1"}]}, {"brif": "t1br1if2", "disk": "10G", "mem": 4, "name": "t1_VM2", "vcpu": 2, "vmif": "t1VM2if1"}], "rc": 0, "start": "2019-11-18 03:28:39.021847", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.2.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.2.1', u'bridge_name': u't1br2', u'dns': [{u'dnsif': u't1s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s2_dnsbrif'}], u'ns_name': u't1ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.2.2/24', u'tenant_ns_ip': u'10.1.2.1/24', u'tenant_ns_if': u't1ns2if', u'tenant_sub_if': u't1s2if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'2.2.2.0/24', u'vxlan': [{u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}, {u'mem': 3, u'name': u't1_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br2if1', u'vmif': u't1VM3if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t1ns2\" ip link set \"t1br2if1\" up\nip netns exec \"t1ns2\" ip link set dev \"t1br2\" up\n", "delta": "0:00:00.069342", "end": "2019-11-18 03:28:39.359923", "item": [{"bridge_name": "t1br2", "default_route_ip": "10.1.2.1", "dns": [{"brif": "t1s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t1s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns2", "route": [{"if": "p1", "ip": "10.1.2.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "2.2.2.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns2if", "tenant_ns_ip": "10.1.2.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s2if", "tenant_sub_ip": "10.1.2.2/24"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, {"brif": "t1br2if1", "disk": "10G", "mem": 3, "name": "t1_VM3", "vcpu": 2, "vmif": "t1VM3if1"}], "rc": 0, "start": "2019-11-18 03:28:39.290581", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Add IP to DNS Interface] ******************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.1.1', u'bridge_name': u't1br1', u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.1.2/24', u'tenant_ns_ip': u'10.1.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't1_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM1if1'}, {u'mem': 4, u'name': u't1_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br1if2', u'vmif': u't1VM2if1'}], u'vxlan': [{u'local_ip': u'10.1.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.1.2', u'remote_route': u'10.2.1.0/24', u'subnet_route': u'10.1.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.2.1.2'}]}, {u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t1ns1\" ip addr show \"t1s1_dnsif\" | awk 'FNR==3{ print $2 }' | grep -w '^1.1.1.1/24' ; if [ $? -ne 0 ] ; then ip netns exec \"t1ns1\" ip addr add \"1.1.1.1/24\" dev \"t1s1_dnsif\" ; fi\n", "delta": "0:00:00.106974", "end": "2019-11-18 03:28:39.723669", "item": [{"bridge_name": "t1br1", "default_route_ip": "10.1.1.1", "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.1.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.1.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.1.1.2/24"}], "vms": [{"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM1", "vcpu": 4, "vmif": "t1VM1if1"}, {"brif": "t1br1if2", "disk": "10G", "mem": 4, "name": "t1_VM2", "vcpu": 2, "vmif": "t1VM2if1"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.1.2", "remote_ip": "10.2.1.2", "remote_route": "10.2.1.0/24", "subnet_route": "10.1.1.0/24", "tenant_route_ip": "192.168.1.2", "v_name": "vxlan_t1s1"}]}, {"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "rc": 0, "start": "2019-11-18 03:28:39.616695", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.2.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.2.1', u'bridge_name': u't1br2', u'ns_name': u't1ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.2.2/24', u'tenant_ns_ip': u'10.1.2.1/24', u'tenant_ns_if': u't1ns2if', u'tenant_sub_if': u't1s2if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'2.2.2.0/24', u'vms': [{u'mem': 3, u'name': u't1_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br2if1', u'vmif': u't1VM3if1'}], u'vxlan': [{u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}, {u'dnsif': u't1s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s2_dnsbrif'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t1ns2\" ip addr show \"t1s2_dnsif\" | awk 'FNR==3{ print $2 }' | grep -w '^2.2.2.1/24' ; if [ $? -ne 0 ] ; then ip netns exec \"t1ns2\" ip addr add \"2.2.2.1/24\" dev \"t1s2_dnsif\" ; fi\n", "delta": "0:00:00.061674", "end": "2019-11-18 03:28:39.967728", "item": [{"bridge_name": "t1br2", "default_route_ip": "10.1.2.1", "ns_name": "t1ns2", "route": [{"if": "p1", "ip": "10.1.2.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "2.2.2.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns2if", "tenant_ns_ip": "10.1.2.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s2if", "tenant_sub_ip": "10.1.2.2/24"}], "vms": [{"brif": "t1br2if1", "disk": "10G", "mem": 3, "name": "t1_VM3", "vcpu": 2, "vmif": "t1VM3if1"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, {"brif": "t1s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t1s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "rc": 0, "start": "2019-11-18 03:28:39.906054", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Install DHCP Server] **********************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.1.1', u'bridge_name': u't1br1', u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.1.2/24', u'tenant_ns_ip': u'10.1.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't1_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM1if1'}, {u'mem': 4, u'name': u't1_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br1if2', u'vmif': u't1VM2if1'}], u'vxlan': [{u'local_ip': u'10.1.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.1.2', u'remote_route': u'10.2.1.0/24', u'subnet_route': u'10.1.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.2.1.2'}]}, {u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t1ns1\" ps aux | grep -w '[d]nsmasq --interface t1s1_dnsif -z --dhcp-range=1.1.1.5,1.1.1.126' ; if [ $? -ne 0 ] ; then ip netns exec \"t1ns1\" dnsmasq --interface \"t1s1_dnsif\" -z --dhcp-range=1.1.1.5,'1.1.1.126' ; fi\n", "delta": "0:00:00.067558", "end": "2019-11-18 03:28:40.276219", "item": [{"bridge_name": "t1br1", "default_route_ip": "10.1.1.1", "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.1.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.1.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.1.1.2/24"}], "vms": [{"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM1", "vcpu": 4, "vmif": "t1VM1if1"}, {"brif": "t1br1if2", "disk": "10G", "mem": 4, "name": "t1_VM2", "vcpu": 2, "vmif": "t1VM2if1"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.1.2", "remote_ip": "10.2.1.2", "remote_route": "10.2.1.0/24", "subnet_route": "10.1.1.0/24", "tenant_route_ip": "192.168.1.2", "v_name": "vxlan_t1s1"}]}, {"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "rc": 0, "start": "2019-11-18 03:28:40.208661", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.2.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.2.1', u'bridge_name': u't1br2', u'ns_name': u't1ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.2.2/24', u'tenant_ns_ip': u'10.1.2.1/24', u'tenant_ns_if': u't1ns2if', u'tenant_sub_if': u't1s2if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'2.2.2.0/24', u'vms': [{u'mem': 3, u'name': u't1_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br2if1', u'vmif': u't1VM3if1'}], u'vxlan': [{u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}, {u'dnsif': u't1s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s2_dnsbrif'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t1ns2\" ps aux | grep -w '[d]nsmasq --interface t1s2_dnsif -z --dhcp-range=2.2.2.5,2.2.2.254' ; if [ $? -ne 0 ] ; then ip netns exec \"t1ns2\" dnsmasq --interface \"t1s2_dnsif\" -z --dhcp-range=2.2.2.5,'2.2.2.254' ; fi\n", "delta": "0:00:00.061523", "end": "2019-11-18 03:28:40.527970", "item": [{"bridge_name": "t1br2", "default_route_ip": "10.1.2.1", "ns_name": "t1ns2", "route": [{"if": "p1", "ip": "10.1.2.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "2.2.2.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns2if", "tenant_ns_ip": "10.1.2.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s2if", "tenant_sub_ip": "10.1.2.2/24"}], "vms": [{"brif": "t1br2if1", "disk": "10G", "mem": 3, "name": "t1_VM3", "vcpu": 2, "vmif": "t1VM3if1"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, {"brif": "t1s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t1s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "rc": 0, "start": "2019-11-18 03:28:40.466447", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Create VXLAN devices] *********************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.1.2/24', u'tenant_ns_ip': u'10.1.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't1_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM1if1'}, {u'mem': 4, u'name': u't1_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br1if2', u'vmif': u't1VM2if1'}]}, {u'local_ip': u'10.1.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.1.2', u'remote_route': u'10.2.1.0/24', u'subnet_route': u'10.1.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.2.1.2'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t1ns1\" ip link show \"vxlan_t1s1\" ; if [ $? -ne 0 ] ; then ip netns exec \"t1ns1\" ip link add \"vxlan_t1s1\" type vxlan id \"42\" local \"10.1.1.2\" remote \"10.2.1.2\" dstport \"4789\" dev \"t1s1if\"; ip netns exec \"t1ns1\" ip link set dev \"vxlan_t1s1\" up ; fi\n", "delta": "0:00:00.128796", "end": "2019-11-18 03:28:40.960024", "item": [{"bridge_name": "t1br1", "default_route_ip": "10.1.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.1.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.1.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.1.1.2/24"}], "vms": [{"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM1", "vcpu": 4, "vmif": "t1VM1if1"}, {"brif": "t1br1if2", "disk": "10G", "mem": 4, "name": "t1_VM2", "vcpu": 2, "vmif": "t1VM2if1"}]}, {"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.1.2", "remote_ip": "10.2.1.2", "remote_route": "10.2.1.0/24", "subnet_route": "10.1.1.0/24", "tenant_route_ip": "192.168.1.2", "v_name": "vxlan_t1s1"}], "rc": 0, "start": "2019-11-18 03:28:40.831228", "stderr": "Device \"vxlan_t1s1\" does not exist.", "stderr_lines": ["Device \"vxlan_t1s1\" does not exist."], "stdout": "", "stdout_lines": []}
skipping: [localhost] => (item=[{u'route': [{u'ip': u'10.1.2.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.2.1', u'bridge_name': u't1br2', u'dns': [{u'dnsif': u't1s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s2_dnsbrif'}], u'ns_name': u't1ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.2.2/24', u'tenant_ns_ip': u'10.1.2.1/24', u'tenant_ns_if': u't1ns2if', u'tenant_sub_if': u't1s2if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'2.2.2.0/24', u'vms': [{u'mem': 3, u'name': u't1_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br2if1', u'vmif': u't1VM3if1'}]}, {u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}])  => {"ansible_loop_var": "item", "changed": false, "item": [{"bridge_name": "t1br2", "default_route_ip": "10.1.2.1", "dns": [{"brif": "t1s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t1s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns2", "route": [{"if": "p1", "ip": "10.1.2.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "2.2.2.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns2if", "tenant_ns_ip": "10.1.2.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s2if", "tenant_sub_ip": "10.1.2.2/24"}], "vms": [{"brif": "t1br2if1", "disk": "10G", "mem": 3, "name": "t1_VM3", "vcpu": 2, "vmif": "t1VM3if1"}]}, {"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}], "skip_reason": "Conditional result was False"}

TASK [Attach VXLANs to bridge] ******************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.1.2/24', u'tenant_ns_ip': u'10.1.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't1_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM1if1'}, {u'mem': 4, u'name': u't1_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br1if2', u'vmif': u't1VM2if1'}]}, {u'local_ip': u'10.1.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.1.2', u'remote_route': u'10.2.1.0/24', u'subnet_route': u'10.1.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.2.1.2'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t1ns1\" brctl show \"t1br1\" | grep -w 'vxlan_t1s1' ; if [ $? -ne 0 ] ; then ip netns exec \"t1ns1\" brctl addif \"t1br1\" \"vxlan_t1s1\" ; fi\n", "delta": "0:00:00.073455", "end": "2019-11-18 03:28:41.332022", "item": [{"bridge_name": "t1br1", "default_route_ip": "10.1.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.1.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.1.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.1.1.2/24"}], "vms": [{"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM1", "vcpu": 4, "vmif": "t1VM1if1"}, {"brif": "t1br1if2", "disk": "10G", "mem": 4, "name": "t1_VM2", "vcpu": 2, "vmif": "t1VM2if1"}]}, {"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.1.2", "remote_ip": "10.2.1.2", "remote_route": "10.2.1.0/24", "subnet_route": "10.1.1.0/24", "tenant_route_ip": "192.168.1.2", "v_name": "vxlan_t1s1"}], "rc": 0, "start": "2019-11-18 03:28:41.258567", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}
skipping: [localhost] => (item=[{u'route': [{u'ip': u'10.1.2.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.2.1', u'bridge_name': u't1br2', u'dns': [{u'dnsif': u't1s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s2_dnsbrif'}], u'ns_name': u't1ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.2.2/24', u'tenant_ns_ip': u'10.1.2.1/24', u'tenant_ns_if': u't1ns2if', u'tenant_sub_if': u't1s2if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'2.2.2.0/24', u'vms': [{u'mem': 3, u'name': u't1_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br2if1', u'vmif': u't1VM3if1'}]}, {u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}])  => {"ansible_loop_var": "item", "changed": false, "item": [{"bridge_name": "t1br2", "default_route_ip": "10.1.2.1", "dns": [{"brif": "t1s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t1s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns2", "route": [{"if": "p1", "ip": "10.1.2.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "2.2.2.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns2if", "tenant_ns_ip": "10.1.2.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s2if", "tenant_sub_ip": "10.1.2.2/24"}], "vms": [{"brif": "t1br2if1", "disk": "10G", "mem": 3, "name": "t1_VM3", "vcpu": 2, "vmif": "t1VM3if1"}]}, {"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}], "skip_reason": "Conditional result was False"}

PLAY RECAP **************************************************************************************************************************************************
localhost                  : ok=21   changed=21   unreachable=0    failed=0    skipped=0    rescued=0    ignored=0   

Using /etc/ansible/ansible.cfg as config file

PLAY [worker] ***********************************************************************************************************************************************

TASK [Create Tenant Namespace] ******************************************************************************************************************************
changed: [99.99.99.2] => (item={u'default_route_ip': u'192.168.129.1', u'name': u't1', u'pns_ip': u'192.168.129.1/24', u'tenant_if': u't1if', u'tenant_ip': u'192.168.129.2/24', u'pns_if': u't1pns_if'}) => {"ansible_loop_var": "item", "changed": true, "cmd": ["ip", "netns", "add", "t1"], "delta": "0:00:00.049448", "end": "2019-11-18 03:28:43.180662", "item": {"default_route_ip": "192.168.129.1", "name": "t1", "pns_if": "t1pns_if", "pns_ip": "192.168.129.1/24", "tenant_if": "t1if", "tenant_ip": "192.168.129.2/24"}, "rc": 0, "start": "2019-11-18 03:28:43.131214", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Create Subnet Namespace] ******************************************************************************************************************************
changed: [99.99.99.2] => (item={u'route': [{u'ip': u'10.2.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.2.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.1.2/24', u'tenant_ns_ip': u'10.2.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_ns_name': u't1', u'tenant_sub_if': u't1s1if'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't1_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM4if1'}], u'vxlan': [{u'local_ip': u'10.2.1.2', u'tenant_route_ip': u'192.168.129.2', u'dsport': 4789, u'dev': u't1s1if', u'subnet_route': u'10.2.1.0/24', u'remote_route': u'10.1.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.1.1.2'}]}) => {"ansible_loop_var": "item", "changed": true, "cmd": ["ip", "netns", "add", "t1ns1"], "delta": "0:00:00.054134", "end": "2019-11-18 03:28:43.596272", "item": {"bridge_name": "t1br1", "default_route_ip": "10.2.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.2.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.2.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.2.1.2/24"}], "vms": [{"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM4", "vcpu": 4, "vmif": "t1VM4if1"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.1.2", "remote_ip": "10.1.1.2", "remote_route": "10.1.1.0/24", "subnet_route": "10.2.1.0/24", "tenant_route_ip": "192.168.129.2", "v_name": "vxlan_t1s1"}]}, "rc": 0, "start": "2019-11-18 03:28:43.542138", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Create Tenant VETH pairs] *****************************************************************************************************************************
changed: [99.99.99.2] => (item={u'default_route_ip': u'192.168.129.1', u'name': u't1', u'pns_ip': u'192.168.129.1/24', u'tenant_if': u't1if', u'tenant_ip': u'192.168.129.2/24', u'pns_if': u't1pns_if'}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip link show \"t1if\" ; if [ $? -ne 0 ] ; then ip link add \"t1if\" type veth peer name \"t1pns_if\" ; fi\n", "delta": "0:00:00.010528", "end": "2019-11-18 03:28:43.993236", "item": {"default_route_ip": "192.168.129.1", "name": "t1", "pns_if": "t1pns_if", "pns_ip": "192.168.129.1/24", "tenant_if": "t1if", "tenant_ip": "192.168.129.2/24"}, "rc": 0, "start": "2019-11-18 03:28:43.982708", "stderr": "Device \"t1if\" does not exist.", "stderr_lines": ["Device \"t1if\" does not exist."], "stdout": "", "stdout_lines": []}

TASK [Attach Tenant VETH Pairs] *****************************************************************************************************************************
changed: [99.99.99.2] => (item={u'default_route_ip': u'192.168.129.1', u'name': u't1', u'pns_ip': u'192.168.129.1/24', u'tenant_if': u't1if', u'tenant_ip': u'192.168.129.2/24', u'pns_if': u't1pns_if'}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec pns ip link show \"t1pns_if\" ; if [ $? -ne 0 ] ; then ip link set \"t1pns_if\" netns pns ; fi\nip netns exec \"t1\" ip link show \"t1if\" ; if [ $? -ne 0 ] ; then ip link set \"t1if\" netns \"t1\" ; fi\nip netns exec pns ip link set dev \"t1pns_if\" up\nip netns exec \"t1\" ip link set dev \"t1if\" up\n", "delta": "0:00:00.190432", "end": "2019-11-18 03:28:44.546921", "item": {"default_route_ip": "192.168.129.1", "name": "t1", "pns_if": "t1pns_if", "pns_ip": "192.168.129.1/24", "tenant_if": "t1if", "tenant_ip": "192.168.129.2/24"}, "rc": 0, "start": "2019-11-18 03:28:44.356489", "stderr": "Device \"t1pns_if\" does not exist.\nDevice \"t1if\" does not exist.", "stderr_lines": ["Device \"t1pns_if\" does not exist.", "Device \"t1if\" does not exist."], "stdout": "", "stdout_lines": []}

TASK [Add IP addresses to Tenant VETH Pairs] ****************************************************************************************************************
changed: [99.99.99.2] => (item={u'default_route_ip': u'192.168.129.1', u'name': u't1', u'pns_ip': u'192.168.129.1/24', u'tenant_if': u't1if', u'tenant_ip': u'192.168.129.2/24', u'pns_if': u't1pns_if'}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec pns ip addr show \"t1pns_if\" | awk 'FNR==3{ print $2 }' | grep -w '^192.168.129.1/24' ; if [ $? -ne 0 ] ; then ip netns exec pns ip addr add \"192.168.129.1/24\" dev \"t1pns_if\" ; fi\nip netns exec \"t1\" ip addr show \"t1if\" | awk 'FNR==3{ print $2 }' | grep -w '^192.168.129.2/24' ; if [ $? -ne 0 ] ; then ip netns exec \"t1\" ip addr add \"192.168.129.2/24\" dev \"t1if\" ; fi\n", "delta": "0:00:00.155825", "end": "2019-11-18 03:28:45.070959", "item": {"default_route_ip": "192.168.129.1", "name": "t1", "pns_if": "t1pns_if", "pns_ip": "192.168.129.1/24", "tenant_if": "t1if", "tenant_ip": "192.168.129.2/24"}, "rc": 0, "start": "2019-11-18 03:28:44.915134", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Create Namespace VETH Pairs] **************************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.2.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't1_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM4if1'}], u'vxlan': [{u'local_ip': u'10.2.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.129.2', u'remote_route': u'10.1.1.0/24', u'subnet_route': u'10.2.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.1.1.2'}]}, {u'tenant_sub_ip': u'10.2.1.2/24', u'tenant_ns_ip': u'10.2.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip link show \"t1ns1if\" ; if [ $? -ne 0 ] ; then ip link add \"t1ns1if\" type veth peer name \"t1s1if\" ; fi\n", "delta": "0:00:00.010150", "end": "2019-11-18 03:28:45.452362", "item": [{"bridge_name": "t1br1", "default_route_ip": "10.2.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.2.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "vms": [{"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM4", "vcpu": 4, "vmif": "t1VM4if1"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.1.2", "remote_ip": "10.1.1.2", "remote_route": "10.1.1.0/24", "subnet_route": "10.2.1.0/24", "tenant_route_ip": "192.168.129.2", "v_name": "vxlan_t1s1"}]}, {"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.2.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.2.1.2/24"}], "rc": 0, "start": "2019-11-18 03:28:45.442212", "stderr": "Device \"t1ns1if\" does not exist.", "stderr_lines": ["Device \"t1ns1if\" does not exist."], "stdout": "", "stdout_lines": []}

TASK [Attach Namespace VETH Pairs] **************************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.2.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't1_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM4if1'}], u'vxlan': [{u'local_ip': u'10.2.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.129.2', u'remote_route': u'10.1.1.0/24', u'subnet_route': u'10.2.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.1.1.2'}]}, {u'tenant_sub_ip': u'10.2.1.2/24', u'tenant_ns_ip': u'10.2.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t1\" ip link show \"t1ns1if\" ; if [ $? -ne 0 ] ; then ip link set \"t1ns1if\" netns \"t1\" ; fi\nip netns exec \"t1ns1\" ip link show \"t1s1if\" ; if [ $? -ne 0 ] ; then ip link set \"t1s1if\" netns \"t1ns1\" ; fi\n", "delta": "0:00:00.110551", "end": "2019-11-18 03:28:45.944603", "item": [{"bridge_name": "t1br1", "default_route_ip": "10.2.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.2.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "vms": [{"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM4", "vcpu": 4, "vmif": "t1VM4if1"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.1.2", "remote_ip": "10.1.1.2", "remote_route": "10.1.1.0/24", "subnet_route": "10.2.1.0/24", "tenant_route_ip": "192.168.129.2", "v_name": "vxlan_t1s1"}]}, {"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.2.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.2.1.2/24"}], "rc": 0, "start": "2019-11-18 03:28:45.834052", "stderr": "Device \"t1ns1if\" does not exist.\nDevice \"t1s1if\" does not exist.", "stderr_lines": ["Device \"t1ns1if\" does not exist.", "Device \"t1s1if\" does not exist."], "stdout": "", "stdout_lines": []}

TASK [Set Namespace VETH Pairs UP] **************************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.2.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't1_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM4if1'}], u'vxlan': [{u'local_ip': u'10.2.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.129.2', u'remote_route': u'10.1.1.0/24', u'subnet_route': u'10.2.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.1.1.2'}]}, {u'tenant_sub_ip': u'10.2.1.2/24', u'tenant_ns_ip': u'10.2.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t1\" ip link set dev \"t1ns1if\" up\nip netns exec \"t1ns1\" ip link set dev \"t1s1if\" up\n", "delta": "0:00:00.078922", "end": "2019-11-18 03:28:46.387079", "item": [{"bridge_name": "t1br1", "default_route_ip": "10.2.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.2.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "vms": [{"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM4", "vcpu": 4, "vmif": "t1VM4if1"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.1.2", "remote_ip": "10.1.1.2", "remote_route": "10.1.1.0/24", "subnet_route": "10.2.1.0/24", "tenant_route_ip": "192.168.129.2", "v_name": "vxlan_t1s1"}]}, {"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.2.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.2.1.2/24"}], "rc": 0, "start": "2019-11-18 03:28:46.308157", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Add IP addresses to Namespace VETH Pairs] *************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.2.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't1_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM4if1'}], u'vxlan': [{u'local_ip': u'10.2.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.129.2', u'remote_route': u'10.1.1.0/24', u'subnet_route': u'10.2.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.1.1.2'}]}, {u'tenant_sub_ip': u'10.2.1.2/24', u'tenant_ns_ip': u'10.2.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t1ns1\" ip addr show \"t1s1if\" | awk 'FNR==3{ print $2 }' | grep -w '^10.2.1.2/24' ; if [ $? -ne 0 ] ; then ip netns exec \"t1ns1\" ip addr add \"10.2.1.2/24\" dev \"t1s1if\" ; fi\n\nip netns exec \"t1\" ip addr show \"t1ns1if\" | awk 'FNR==3{ print $2 }' | grep -w '^10.2.1.1/24' ; if [ $? -ne 0 ] ; then ip netns exec \"t1\" ip addr add \"10.2.1.1/24\" dev \"t1ns1if\" ; fi\n", "delta": "0:00:00.173564", "end": "2019-11-18 03:28:46.910893", "item": [{"bridge_name": "t1br1", "default_route_ip": "10.2.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.2.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "vms": [{"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM4", "vcpu": 4, "vmif": "t1VM4if1"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.1.2", "remote_ip": "10.1.1.2", "remote_route": "10.1.1.0/24", "subnet_route": "10.2.1.0/24", "tenant_route_ip": "192.168.129.2", "v_name": "vxlan_t1s1"}]}, {"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.2.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.2.1.2/24"}], "rc": 0, "start": "2019-11-18 03:28:46.737329", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Add IP Route to Tenant] *******************************************************************************************************************************
changed: [99.99.99.2] => (item={u'default_route_ip': u'192.168.129.1', u'name': u't1', u'pns_ip': u'192.168.129.1/24', u'tenant_if': u't1if', u'tenant_ip': u'192.168.129.2/24', u'pns_if': u't1pns_if'}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t1\" ip route show default | grep -w '[d]efault via 192.168.129.1' ; if [ $? -ne 0 ] ; then ip netns exec \"t1\" ip route add default via \"192.168.129.1\" ; fi\n", "delta": "0:00:00.078845", "end": "2019-11-18 03:28:47.347097", "item": {"default_route_ip": "192.168.129.1", "name": "t1", "pns_if": "t1pns_if", "pns_ip": "192.168.129.1/24", "tenant_if": "t1if", "tenant_ip": "192.168.129.2/24"}, "rc": 0, "start": "2019-11-18 03:28:47.268252", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Add IP Route to Tenant Subnet] ************************************************************************************************************************
changed: [99.99.99.2] => (item={u'route': [{u'ip': u'10.2.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.2.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.1.2/24', u'tenant_ns_ip': u'10.2.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_ns_name': u't1', u'tenant_sub_if': u't1s1if'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't1_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM4if1'}], u'vxlan': [{u'local_ip': u'10.2.1.2', u'tenant_route_ip': u'192.168.129.2', u'dsport': 4789, u'dev': u't1s1if', u'subnet_route': u'10.2.1.0/24', u'remote_route': u'10.1.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.1.1.2'}]}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t1ns1\" ip route show default | grep -w '[d]efault via 10.2.1.1' ; if [ $? -ne 0 ] ; then ip netns exec \"t1ns1\" ip route add default via \"10.2.1.1\" ; fi\n", "delta": "0:00:00.081489", "end": "2019-11-18 03:28:47.811210", "item": {"bridge_name": "t1br1", "default_route_ip": "10.2.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.2.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.2.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.2.1.2/24"}], "vms": [{"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM4", "vcpu": 4, "vmif": "t1VM4if1"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.1.2", "remote_ip": "10.1.1.2", "remote_route": "10.1.1.0/24", "subnet_route": "10.2.1.0/24", "tenant_route_ip": "192.168.129.2", "v_name": "vxlan_t1s1"}]}, "rc": 0, "start": "2019-11-18 03:28:47.729721", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Create bridge inside namespace] ***********************************************************************************************************************
changed: [99.99.99.2] => (item={u'route': [{u'ip': u'10.2.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.2.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.1.2/24', u'tenant_ns_ip': u'10.2.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_ns_name': u't1', u'tenant_sub_if': u't1s1if'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't1_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM4if1'}], u'vxlan': [{u'local_ip': u'10.2.1.2', u'tenant_route_ip': u'192.168.129.2', u'dsport': 4789, u'dev': u't1s1if', u'subnet_route': u'10.2.1.0/24', u'remote_route': u'10.1.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.1.1.2'}]}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t1ns1\" brctl show | grep -w '^t1br1'; if [ $? -ne 0 ] ; then ip netns exec \"t1ns1\" brctl addbr \"t1br1\" ; fi\nip netns exec \"t1ns1\" ip link set dev \"t1br1\" up\n", "delta": "0:00:00.102964", "end": "2019-11-18 03:28:48.287026", "item": {"bridge_name": "t1br1", "default_route_ip": "10.2.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.2.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.2.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.2.1.2/24"}], "vms": [{"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM4", "vcpu": 4, "vmif": "t1VM4if1"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.1.2", "remote_ip": "10.1.1.2", "remote_route": "10.1.1.0/24", "subnet_route": "10.2.1.0/24", "tenant_route_ip": "192.168.129.2", "v_name": "vxlan_t1s1"}]}, "rc": 0, "start": "2019-11-18 03:28:48.184062", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Create DNS VETH Pair] *********************************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.2.1.1', u'bridge_name': u't1br1', u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.1.2/24', u'tenant_ns_ip': u'10.2.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't1_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM4if1'}], u'vxlan': [{u'local_ip': u'10.2.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.129.2', u'remote_route': u'10.1.1.0/24', u'subnet_route': u'10.2.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.1.1.2'}]}, {u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t1ns1\" ip link show \"t1s1_dnsbrif\" ; if [ $? -ne 0 ] ; then ip netns exec \"t1ns1\" ip link add \"t1s1_dnsbrif\" type veth peer name \"t1s1_dnsif\" ; fi\nip netns exec \"t1ns1\" ip link set dev \"t1s1_dnsbrif\" up\nip netns exec \"t1ns1\" ip link set dev \"t1s1_dnsif\" up\n", "delta": "0:00:00.141353", "end": "2019-11-18 03:28:48.799074", "item": [{"bridge_name": "t1br1", "default_route_ip": "10.2.1.1", "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.2.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.2.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.2.1.2/24"}], "vms": [{"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM4", "vcpu": 4, "vmif": "t1VM4if1"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.1.2", "remote_ip": "10.1.1.2", "remote_route": "10.1.1.0/24", "subnet_route": "10.2.1.0/24", "tenant_route_ip": "192.168.129.2", "v_name": "vxlan_t1s1"}]}, {"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "rc": 0, "start": "2019-11-18 03:28:48.657721", "stderr": "Device \"t1s1_dnsbrif\" does not exist.", "stderr_lines": ["Device \"t1s1_dnsbrif\" does not exist."], "stdout": "", "stdout_lines": []}

TASK [Attach DNS VETH Pair] *********************************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.2.1.1', u'bridge_name': u't1br1', u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.1.2/24', u'tenant_ns_ip': u'10.2.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't1_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM4if1'}], u'vxlan': [{u'local_ip': u'10.2.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.129.2', u'remote_route': u'10.1.1.0/24', u'subnet_route': u'10.2.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.1.1.2'}]}, {u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t1ns1\" brctl show \"t1br1\" | grep -w 't1s1_dnsbrif' ; if [ $? -ne 0 ] ; then ip netns exec \"t1ns1\" brctl addif \"t1br1\" \"t1s1_dnsbrif\" ; fi\n", "delta": "0:00:00.074390", "end": "2019-11-18 03:28:49.219078", "item": [{"bridge_name": "t1br1", "default_route_ip": "10.2.1.1", "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.2.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.2.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.2.1.2/24"}], "vms": [{"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM4", "vcpu": 4, "vmif": "t1VM4if1"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.1.2", "remote_ip": "10.1.1.2", "remote_route": "10.1.1.0/24", "subnet_route": "10.2.1.0/24", "tenant_route_ip": "192.168.129.2", "v_name": "vxlan_t1s1"}]}, {"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "rc": 0, "start": "2019-11-18 03:28:49.144688", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Create VETH Pairs] ************************************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.2.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.1.2/24', u'tenant_ns_ip': u'10.2.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.2.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.129.2', u'remote_route': u'10.1.1.0/24', u'subnet_route': u'10.2.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.1.1.2'}]}, {u'mem': 2, u'name': u't1_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM4if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip link show \"t1br1if1\" ; if [ $? -ne 0 ] ; then ip link add \"t1VM4if1\" type veth peer name \"t1br1if1\" ; fi\nip link set dev \"t1br1if1\" up\nip link set dev \"t1VM4if1\" up\n", "delta": "0:00:00.015311", "end": "2019-11-18 03:28:49.585296", "item": [{"bridge_name": "t1br1", "default_route_ip": "10.2.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.2.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.2.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.2.1.2/24"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.1.2", "remote_ip": "10.1.1.2", "remote_route": "10.1.1.0/24", "subnet_route": "10.2.1.0/24", "tenant_route_ip": "192.168.129.2", "v_name": "vxlan_t1s1"}]}, {"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM4", "vcpu": 4, "vmif": "t1VM4if1"}], "rc": 0, "start": "2019-11-18 03:28:49.569985", "stderr": "Device \"t1br1if1\" does not exist.", "stderr_lines": ["Device \"t1br1if1\" does not exist."], "stdout": "", "stdout_lines": []}

TASK [Attach VETH Pairs] ************************************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.2.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.1.2/24', u'tenant_ns_ip': u'10.2.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.2.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.129.2', u'remote_route': u'10.1.1.0/24', u'subnet_route': u'10.2.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.1.1.2'}]}, {u'mem': 2, u'name': u't1_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM4if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip link show \"t1br1if1\" ; if [ $? -eq 0 ] ; then ip link set \"t1br1if1\" netns \"t1ns1\" ; fi\nip netns exec \"t1ns1\" brctl show \"t1br1\" | grep -w 't1br1if1' ; if [ $? -ne 0 ] ; then ip netns exec \"t1ns1\" brctl addif \"t1br1\" \"t1br1if1\" ; fi\n", "delta": "0:00:00.106737", "end": "2019-11-18 03:28:50.079052", "item": [{"bridge_name": "t1br1", "default_route_ip": "10.2.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.2.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.2.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.2.1.2/24"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.1.2", "remote_ip": "10.1.1.2", "remote_route": "10.1.1.0/24", "subnet_route": "10.2.1.0/24", "tenant_route_ip": "192.168.129.2", "v_name": "vxlan_t1s1"}]}, {"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM4", "vcpu": 4, "vmif": "t1VM4if1"}], "rc": 0, "start": "2019-11-18 03:28:49.972315", "stderr": "", "stderr_lines": [], "stdout": "18: t1br1if1@t1VM4if1: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP mode DEFAULT group default qlen 1000\n    link/ether c6:c4:bf:ab:65:10 brd ff:ff:ff:ff:ff:ff", "stdout_lines": ["18: t1br1if1@t1VM4if1: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP mode DEFAULT group default qlen 1000", "    link/ether c6:c4:bf:ab:65:10 brd ff:ff:ff:ff:ff:ff"]}

TASK [All interfaces and bridges UP] ************************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.2.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.1.2/24', u'tenant_ns_ip': u'10.2.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.2.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.129.2', u'remote_route': u'10.1.1.0/24', u'subnet_route': u'10.2.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.1.1.2'}]}, {u'mem': 2, u'name': u't1_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM4if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t1ns1\" ip link set \"t1br1if1\" up\nip netns exec \"t1ns1\" ip link set dev \"t1br1\" up\n", "delta": "0:00:00.095701", "end": "2019-11-18 03:28:50.579107", "item": [{"bridge_name": "t1br1", "default_route_ip": "10.2.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.2.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.2.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.2.1.2/24"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.1.2", "remote_ip": "10.1.1.2", "remote_route": "10.1.1.0/24", "subnet_route": "10.2.1.0/24", "tenant_route_ip": "192.168.129.2", "v_name": "vxlan_t1s1"}]}, {"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM4", "vcpu": 4, "vmif": "t1VM4if1"}], "rc": 0, "start": "2019-11-18 03:28:50.483406", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Add IP to DNS Interface] ******************************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.2.1.1', u'bridge_name': u't1br1', u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.1.2/24', u'tenant_ns_ip': u'10.2.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't1_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM4if1'}], u'vxlan': [{u'local_ip': u'10.2.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.129.2', u'remote_route': u'10.1.1.0/24', u'subnet_route': u'10.2.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.1.1.2'}]}, {u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t1ns1\" ip addr show \"t1s1_dnsif\" | awk 'FNR==3{ print $2}'| grep -w '^1.1.1.128/24' ; if [ $? -ne 0 ] ; then ip netns exec \"t1ns1\" ip addr add \"1.1.1.128/24\" dev \"t1s1_dnsif\" ; fi\n", "delta": "0:00:00.076037", "end": "2019-11-18 03:28:51.039123", "item": [{"bridge_name": "t1br1", "default_route_ip": "10.2.1.1", "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.2.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.2.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.2.1.2/24"}], "vms": [{"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM4", "vcpu": 4, "vmif": "t1VM4if1"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.1.2", "remote_ip": "10.1.1.2", "remote_route": "10.1.1.0/24", "subnet_route": "10.2.1.0/24", "tenant_route_ip": "192.168.129.2", "v_name": "vxlan_t1s1"}]}, {"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "rc": 0, "start": "2019-11-18 03:28:50.963086", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Install DHCP Server] **********************************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.2.1.1', u'bridge_name': u't1br1', u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.1.2/24', u'tenant_ns_ip': u'10.2.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't1_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM4if1'}], u'vxlan': [{u'local_ip': u'10.2.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.129.2', u'remote_route': u'10.1.1.0/24', u'subnet_route': u'10.2.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.1.1.2'}]}, {u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t1ns1\" ps aux | grep -w '[d]nsmasq --interface t1s1_dnsif -z --dhcp-range=1.1.1.133,1.1.1.254' ; if [ $? -ne 0 ] ; then ip netns exec \"t1ns1\" dnsmasq --interface \"t1s1_dnsif\" -z --dhcp-range=1.1.1.133,'1.1.1.254' ; fi\n", "delta": "0:00:00.075095", "end": "2019-11-18 03:28:51.496822", "item": [{"bridge_name": "t1br1", "default_route_ip": "10.2.1.1", "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.2.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.2.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.2.1.2/24"}], "vms": [{"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM4", "vcpu": 4, "vmif": "t1VM4if1"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.1.2", "remote_ip": "10.1.1.2", "remote_route": "10.1.1.0/24", "subnet_route": "10.2.1.0/24", "tenant_route_ip": "192.168.129.2", "v_name": "vxlan_t1s1"}]}, {"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "rc": 0, "start": "2019-11-18 03:28:51.421727", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Create VXLAN devices] *********************************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.2.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.1.2/24', u'tenant_ns_ip': u'10.2.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't1_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM4if1'}]}, {u'local_ip': u'10.2.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.129.2', u'remote_route': u'10.1.1.0/24', u'subnet_route': u'10.2.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.1.1.2'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t1ns1\" ip link show \"vxlan_t1s1\" ; if [ $? -ne 0 ] ; then ip netns exec \"t1ns1\" ip link add \"vxlan_t1s1\" type vxlan id \"42\" local \"10.2.1.2\" remote \"10.1.1.2\" dstport \"4789\" dev \"t1s1if\" ; ip netns exec \"t1ns1\" ip link set dev \"vxlan_t1s1\" up ; fi\n", "delta": "0:00:00.140430", "end": "2019-11-18 03:28:52.018994", "item": [{"bridge_name": "t1br1", "default_route_ip": "10.2.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.2.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.2.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.2.1.2/24"}], "vms": [{"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM4", "vcpu": 4, "vmif": "t1VM4if1"}]}, {"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.1.2", "remote_ip": "10.1.1.2", "remote_route": "10.1.1.0/24", "subnet_route": "10.2.1.0/24", "tenant_route_ip": "192.168.129.2", "v_name": "vxlan_t1s1"}], "rc": 0, "start": "2019-11-18 03:28:51.878564", "stderr": "Device \"vxlan_t1s1\" does not exist.", "stderr_lines": ["Device \"vxlan_t1s1\" does not exist."], "stdout": "", "stdout_lines": []}

TASK [Attach VXLANs to bridge] ******************************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.2.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.1.2/24', u'tenant_ns_ip': u'10.2.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't1_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM4if1'}]}, {u'local_ip': u'10.2.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.129.2', u'remote_route': u'10.1.1.0/24', u'subnet_route': u'10.2.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.1.1.2'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t1ns1\" brctl show \"t1br1\" | grep -w 'vxlan_t1s1' ; if [ $? -ne 0 ] ; then ip netns exec \"t1ns1\" brctl addif \"t1br1\" \"vxlan_t1s1\" ; fi\n", "delta": "0:00:00.074088", "end": "2019-11-18 03:28:52.491028", "item": [{"bridge_name": "t1br1", "default_route_ip": "10.2.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.2.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.2.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.2.1.2/24"}], "vms": [{"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM4", "vcpu": 4, "vmif": "t1VM4if1"}]}, {"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.1.2", "remote_ip": "10.1.1.2", "remote_route": "10.1.1.0/24", "subnet_route": "10.2.1.0/24", "tenant_route_ip": "192.168.129.2", "v_name": "vxlan_t1s1"}], "rc": 0, "start": "2019-11-18 03:28:52.416940", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

PLAY RECAP **************************************************************************************************************************************************
99.99.99.2                 : ok=21   changed=21   unreachable=0    failed=0    skipped=0    rescued=0    ignored=0   

Using /etc/ansible/ansible.cfg as config file

PLAY [main] *************************************************************************************************************************************************

TASK [Add VXLAN routes in PNS] ******************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.1.2/24', u'tenant_ns_ip': u'10.1.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't1_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM1if1'}, {u'mem': 4, u'name': u't1_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br1if2', u'vmif': u't1VM2if1'}]}, {u'local_ip': u'10.1.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.1.2', u'remote_route': u'10.2.1.0/24', u'subnet_route': u'10.1.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.2.1.2'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec pns ip route show \"10.1.1.0/24\" via \"192.168.1.2\" | grep -w '^10.1.1.0/24' ; if [ $? -ne 0 ] ; then ip netns exec pns ip route add \"10.1.1.0/24\" via \"192.168.1.2\" ; fi\n", "delta": "0:00:00.074618", "end": "2019-11-18 03:28:53.615747", "item": [{"bridge_name": "t1br1", "default_route_ip": "10.1.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.1.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.1.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.1.1.2/24"}], "vms": [{"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM1", "vcpu": 4, "vmif": "t1VM1if1"}, {"brif": "t1br1if2", "disk": "10G", "mem": 4, "name": "t1_VM2", "vcpu": 2, "vmif": "t1VM2if1"}]}, {"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.1.2", "remote_ip": "10.2.1.2", "remote_route": "10.2.1.0/24", "subnet_route": "10.1.1.0/24", "tenant_route_ip": "192.168.1.2", "v_name": "vxlan_t1s1"}], "rc": 0, "start": "2019-11-18 03:28:53.541129", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}
skipping: [localhost] => (item=[{u'route': [{u'ip': u'10.1.2.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.2.1', u'bridge_name': u't1br2', u'dns': [{u'dnsif': u't1s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s2_dnsbrif'}], u'ns_name': u't1ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.2.2/24', u'tenant_ns_ip': u'10.1.2.1/24', u'tenant_ns_if': u't1ns2if', u'tenant_sub_if': u't1s2if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'2.2.2.0/24', u'vms': [{u'mem': 3, u'name': u't1_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br2if1', u'vmif': u't1VM3if1'}]}, {u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}])  => {"ansible_loop_var": "item", "changed": false, "item": [{"bridge_name": "t1br2", "default_route_ip": "10.1.2.1", "dns": [{"brif": "t1s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t1s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns2", "route": [{"if": "p1", "ip": "10.1.2.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "2.2.2.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns2if", "tenant_ns_ip": "10.1.2.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s2if", "tenant_sub_ip": "10.1.2.2/24"}], "vms": [{"brif": "t1br2if1", "disk": "10G", "mem": 3, "name": "t1_VM3", "vcpu": 2, "vmif": "t1VM3if1"}]}, {"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}], "skip_reason": "Conditional result was False"}

TASK [Get PNS ip address] ***********************************************************************************************************************************
ok: [localhost] => {"changed": false, "cmd": "ip netns exec pns ip addr show p1 | awk 'FNR==3{ print $2 }' | awk -F/ '{ print $1 }'\n", "delta": "0:00:00.038930", "end": "2019-11-18 03:28:53.896099", "rc": 0, "start": "2019-11-18 03:28:53.857169", "stderr": "", "stderr_lines": [], "stdout": "192.168.100.238", "stdout_lines": ["192.168.100.238"]}

TASK [Add VXLAN routes to host] *****************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.1.2/24', u'tenant_ns_ip': u'10.1.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't1_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM1if1'}, {u'mem': 4, u'name': u't1_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br1if2', u'vmif': u't1VM2if1'}]}, {u'local_ip': u'10.1.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.1.2', u'remote_route': u'10.2.1.0/24', u'subnet_route': u'10.1.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.2.1.2'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip route show \"10.1.1.0/24\" via \"192.168.100.238\" | grep -w '^10.1.1.0/24' ; if [ $? -ne 0 ] ; then ip route add \"10.1.1.0/24\" via \"192.168.100.238\" ; fi\nip route show \"10.2.1.0/24\" via 99.99.99.2 | grep -w '^10.2.1.0/24'; if [ $? -ne 0 ] ; then ip route add \"10.2.1.0/24\" via 99.99.99.2 ; fi\n", "delta": "0:00:00.007989", "end": "2019-11-18 03:28:54.168056", "item": [{"bridge_name": "t1br1", "default_route_ip": "10.1.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.1.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.1.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.1.1.2/24"}], "vms": [{"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM1", "vcpu": 4, "vmif": "t1VM1if1"}, {"brif": "t1br1if2", "disk": "10G", "mem": 4, "name": "t1_VM2", "vcpu": 2, "vmif": "t1VM2if1"}]}, {"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.1.2", "remote_ip": "10.2.1.2", "remote_route": "10.2.1.0/24", "subnet_route": "10.1.1.0/24", "tenant_route_ip": "192.168.1.2", "v_name": "vxlan_t1s1"}], "rc": 0, "start": "2019-11-18 03:28:54.160067", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}
skipping: [localhost] => (item=[{u'route': [{u'ip': u'10.1.2.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.2.1', u'bridge_name': u't1br2', u'dns': [{u'dnsif': u't1s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s2_dnsbrif'}], u'ns_name': u't1ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.2.2/24', u'tenant_ns_ip': u'10.1.2.1/24', u'tenant_ns_if': u't1ns2if', u'tenant_sub_if': u't1s2if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'2.2.2.0/24', u'vms': [{u'mem': 3, u'name': u't1_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br2if1', u'vmif': u't1VM3if1'}]}, {u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}])  => {"ansible_loop_var": "item", "changed": false, "item": [{"bridge_name": "t1br2", "default_route_ip": "10.1.2.1", "dns": [{"brif": "t1s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t1s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns2", "route": [{"if": "p1", "ip": "10.1.2.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "2.2.2.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns2if", "tenant_ns_ip": "10.1.2.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s2if", "tenant_sub_ip": "10.1.2.2/24"}], "vms": [{"brif": "t1br2if1", "disk": "10G", "mem": 3, "name": "t1_VM3", "vcpu": 2, "vmif": "t1VM3if1"}]}, {"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}], "skip_reason": "Conditional result was False"}

PLAY RECAP **************************************************************************************************************************************************
localhost                  : ok=3    changed=2    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0   

Using /etc/ansible/ansible.cfg as config file

PLAY [worker] ***********************************************************************************************************************************************

TASK [Add VXLAN routes in PNS] ******************************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.2.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.1.2/24', u'tenant_ns_ip': u'10.2.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't1_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM4if1'}]}, {u'local_ip': u'10.2.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.129.2', u'remote_route': u'10.1.1.0/24', u'subnet_route': u'10.2.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.1.1.2'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec pns ip route show \"10.2.1.0/24\" via \"192.168.129.2\" | grep -w '^10.2.1.0/24' ; if [ $? -ne 0 ] ; then ip netns exec pns ip route add \"10.2.1.0/24\" via \"192.168.129.2\" ; fi\n", "delta": "0:00:00.078473", "end": "2019-11-18 03:28:55.286999", "item": [{"bridge_name": "t1br1", "default_route_ip": "10.2.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.2.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.2.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.2.1.2/24"}], "vms": [{"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM4", "vcpu": 4, "vmif": "t1VM4if1"}]}, {"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.1.2", "remote_ip": "10.1.1.2", "remote_route": "10.1.1.0/24", "subnet_route": "10.2.1.0/24", "tenant_route_ip": "192.168.129.2", "v_name": "vxlan_t1s1"}], "rc": 0, "start": "2019-11-18 03:28:55.208526", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Get PNS ip address] ***********************************************************************************************************************************
ok: [99.99.99.2] => {"changed": false, "cmd": "ip netns exec pns ip addr show p1 | awk 'FNR==3{ print $2 }' | awk -F/ '{ print $1 }'\n", "delta": "0:00:00.029725", "end": "2019-11-18 03:28:55.687419", "rc": 0, "start": "2019-11-18 03:28:55.657694", "stderr": "", "stderr_lines": [], "stdout": "192.168.100.50", "stdout_lines": ["192.168.100.50"]}

TASK [Add VXLAN routes to host] *****************************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.2.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.1.2/24', u'tenant_ns_ip': u'10.2.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't1_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM4if1'}]}, {u'local_ip': u'10.2.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.129.2', u'remote_route': u'10.1.1.0/24', u'subnet_route': u'10.2.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.1.1.2'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip route show \"10.2.1.0/24\" via \"192.168.100.50\" | grep -w '^10.2.1.0/24' ; if [ $? -ne 0 ] ; then ip route add \"10.2.1.0/24\" via \"192.168.100.50\" ; fi\nip route show \"10.1.1.0/24\" via 99.99.99.1 | grep -w '^10.1.1.0/24'; if [ $? -ne 0 ] ; then ip route add \"10.1.1.0/24\" via 99.99.99.1 ; fi\n", "delta": "0:00:00.008972", "end": "2019-11-18 03:28:56.094612", "item": [{"bridge_name": "t1br1", "default_route_ip": "10.2.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.2.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.2.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.2.1.2/24"}], "vms": [{"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM4", "vcpu": 4, "vmif": "t1VM4if1"}]}, {"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.1.2", "remote_ip": "10.1.1.2", "remote_route": "10.1.1.0/24", "subnet_route": "10.2.1.0/24", "tenant_route_ip": "192.168.129.2", "v_name": "vxlan_t1s1"}], "rc": 0, "start": "2019-11-18 03:28:56.085640", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

PLAY RECAP **************************************************************************************************************************************************
99.99.99.2                 : ok=3    changed=2    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0   

Using /etc/ansible/ansible.cfg as config file

PLAY [main] *************************************************************************************************************************************************

TASK [Create VM templates (C1)] *****************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.1.2/24', u'tenant_ns_ip': u'10.1.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.1.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.1.2', u'remote_route': u'10.2.1.0/24', u'subnet_route': u'10.1.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.2.1.2'}]}, {u'mem': 2, u'name': u't1_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM1if1'}]) => {"ansible_loop_var": "item", "changed": true, "checksum": "350ba870bd31b7f6ee517845c14237910b5af0bf", "dest": "/root/Migration-as-a-Service/t1/VM_templates/t1_VM1.xml.j2", "gid": 0, "group": "root", "item": [{"bridge_name": "t1br1", "default_route_ip": "10.1.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.1.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.1.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.1.1.2/24"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.1.2", "remote_ip": "10.2.1.2", "remote_route": "10.2.1.0/24", "subnet_route": "10.1.1.0/24", "tenant_route_ip": "192.168.1.2", "v_name": "vxlan_t1s1"}]}, {"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM1", "vcpu": 4, "vmif": "t1VM1if1"}], "md5sum": "fbfc2eb0c2569531f25eea92c26d3bee", "mode": "0644", "owner": "root", "size": 4091, "src": "/root/.ansible/tmp/ansible-tmp-1574047736.75-144204985526120/source", "state": "file", "uid": 0}
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.1.2/24', u'tenant_ns_ip': u'10.1.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.1.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.1.2', u'remote_route': u'10.2.1.0/24', u'subnet_route': u'10.1.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.2.1.2'}]}, {u'mem': 4, u'name': u't1_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br1if2', u'vmif': u't1VM2if1'}]) => {"ansible_loop_var": "item", "changed": true, "checksum": "350ba870bd31b7f6ee517845c14237910b5af0bf", "dest": "/root/Migration-as-a-Service/t1/VM_templates/t1_VM2.xml.j2", "gid": 0, "group": "root", "item": [{"bridge_name": "t1br1", "default_route_ip": "10.1.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.1.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.1.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.1.1.2/24"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.1.2", "remote_ip": "10.2.1.2", "remote_route": "10.2.1.0/24", "subnet_route": "10.1.1.0/24", "tenant_route_ip": "192.168.1.2", "v_name": "vxlan_t1s1"}]}, {"brif": "t1br1if2", "disk": "10G", "mem": 4, "name": "t1_VM2", "vcpu": 2, "vmif": "t1VM2if1"}], "md5sum": "fbfc2eb0c2569531f25eea92c26d3bee", "mode": "0644", "owner": "root", "size": 4091, "src": "/root/.ansible/tmp/ansible-tmp-1574047737.32-142875301529274/source", "state": "file", "uid": 0}
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.2.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.2.1', u'bridge_name': u't1br2', u'dns': [{u'dnsif': u't1s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s2_dnsbrif'}], u'ns_name': u't1ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.2.2/24', u'tenant_ns_ip': u'10.1.2.1/24', u'tenant_ns_if': u't1ns2if', u'tenant_sub_if': u't1s2if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'2.2.2.0/24', u'vxlan': [{u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}, {u'mem': 3, u'name': u't1_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br2if1', u'vmif': u't1VM3if1'}]) => {"ansible_loop_var": "item", "changed": true, "checksum": "350ba870bd31b7f6ee517845c14237910b5af0bf", "dest": "/root/Migration-as-a-Service/t1/VM_templates/t1_VM3.xml.j2", "gid": 0, "group": "root", "item": [{"bridge_name": "t1br2", "default_route_ip": "10.1.2.1", "dns": [{"brif": "t1s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t1s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns2", "route": [{"if": "p1", "ip": "10.1.2.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "2.2.2.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns2if", "tenant_ns_ip": "10.1.2.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s2if", "tenant_sub_ip": "10.1.2.2/24"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, {"brif": "t1br2if1", "disk": "10G", "mem": 3, "name": "t1_VM3", "vcpu": 2, "vmif": "t1VM3if1"}], "md5sum": "fbfc2eb0c2569531f25eea92c26d3bee", "mode": "0644", "owner": "root", "size": 4091, "src": "/root/.ansible/tmp/ansible-tmp-1574047737.55-211388934919210/source", "state": "file", "uid": 0}

PLAY RECAP **************************************************************************************************************************************************
localhost                  : ok=1    changed=1    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0   

Using /etc/ansible/ansible.cfg as config file

PLAY [main] *************************************************************************************************************************************************

TASK [Create VM templates (C2)] *****************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.2.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.2.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.1.2/24', u'tenant_ns_ip': u'10.2.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.2.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.129.2', u'remote_route': u'10.1.1.0/24', u'subnet_route': u'10.2.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.1.1.2'}]}, {u'mem': 2, u'name': u't1_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM4if1'}]) => {"ansible_loop_var": "item", "changed": true, "checksum": "350ba870bd31b7f6ee517845c14237910b5af0bf", "dest": "/root/Migration-as-a-Service/t1/VM_templates/t1_VM4.xml.j2", "gid": 0, "group": "root", "item": [{"bridge_name": "t1br1", "default_route_ip": "10.2.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.2.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.2.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.2.1.2/24"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.1.2", "remote_ip": "10.1.1.2", "remote_route": "10.1.1.0/24", "subnet_route": "10.2.1.0/24", "tenant_route_ip": "192.168.129.2", "v_name": "vxlan_t1s1"}]}, {"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM4", "vcpu": 4, "vmif": "t1VM4if1"}], "md5sum": "fbfc2eb0c2569531f25eea92c26d3bee", "mode": "0644", "owner": "root", "size": 4091, "src": "/root/.ansible/tmp/ansible-tmp-1574047738.34-154897307795077/source", "state": "file", "uid": 0}

PLAY RECAP **************************************************************************************************************************************************
localhost                  : ok=1    changed=1    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0   

Using /etc/ansible/ansible.cfg as config file

PLAY [main] *************************************************************************************************************************************************

TASK [Copy VM image] ****************************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.1.2/24', u'tenant_ns_ip': u'10.1.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.1.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.1.2', u'remote_route': u'10.2.1.0/24', u'subnet_route': u'10.1.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.2.1.2'}]}, {u'mem': 2, u'name': u't1_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM1if1'}]) => {"ansible_loop_var": "item", "changed": true, "checksum": "d86d5962370fcd0c3d05943fc209d9e05fdac89f", "dest": "/var/lib/libvirt/images/t1_VM1.qcow2", "gid": 0, "group": "root", "item": [{"bridge_name": "t1br1", "default_route_ip": "10.1.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.1.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.1.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.1.1.2/24"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.1.2", "remote_ip": "10.2.1.2", "remote_route": "10.2.1.0/24", "subnet_route": "10.1.1.0/24", "tenant_route_ip": "192.168.1.2", "v_name": "vxlan_t1s1"}]}, {"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM1", "vcpu": 4, "vmif": "t1VM1if1"}], "md5sum": "b977a19124b65f2d544ddc62e407114d", "mode": "0644", "owner": "root", "size": 10739318784, "src": "/root/.ansible/tmp/ansible-tmp-1574047739.52-146721615724513/source", "state": "file", "uid": 0}
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.1.2/24', u'tenant_ns_ip': u'10.1.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.1.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.1.2', u'remote_route': u'10.2.1.0/24', u'subnet_route': u'10.1.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.2.1.2'}]}, {u'mem': 4, u'name': u't1_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br1if2', u'vmif': u't1VM2if1'}]) => {"ansible_loop_var": "item", "changed": true, "checksum": "d86d5962370fcd0c3d05943fc209d9e05fdac89f", "dest": "/var/lib/libvirt/images/t1_VM2.qcow2", "gid": 0, "group": "root", "item": [{"bridge_name": "t1br1", "default_route_ip": "10.1.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.1.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.1.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.1.1.2/24"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.1.2", "remote_ip": "10.2.1.2", "remote_route": "10.2.1.0/24", "subnet_route": "10.1.1.0/24", "tenant_route_ip": "192.168.1.2", "v_name": "vxlan_t1s1"}]}, {"brif": "t1br1if2", "disk": "10G", "mem": 4, "name": "t1_VM2", "vcpu": 2, "vmif": "t1VM2if1"}], "md5sum": "b977a19124b65f2d544ddc62e407114d", "mode": "0644", "owner": "root", "size": 10739318784, "src": "/root/.ansible/tmp/ansible-tmp-1574047845.19-21806928046665/source", "state": "file", "uid": 0}
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.2.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.2.1', u'bridge_name': u't1br2', u'dns': [{u'dnsif': u't1s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s2_dnsbrif'}], u'ns_name': u't1ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.2.2/24', u'tenant_ns_ip': u'10.1.2.1/24', u'tenant_ns_if': u't1ns2if', u'tenant_sub_if': u't1s2if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'2.2.2.0/24', u'vxlan': [{u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}, {u'mem': 3, u'name': u't1_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br2if1', u'vmif': u't1VM3if1'}]) => {"ansible_loop_var": "item", "changed": true, "checksum": "d86d5962370fcd0c3d05943fc209d9e05fdac89f", "dest": "/var/lib/libvirt/images/t1_VM3.qcow2", "gid": 0, "group": "root", "item": [{"bridge_name": "t1br2", "default_route_ip": "10.1.2.1", "dns": [{"brif": "t1s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t1s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns2", "route": [{"if": "p1", "ip": "10.1.2.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "2.2.2.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns2if", "tenant_ns_ip": "10.1.2.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s2if", "tenant_sub_ip": "10.1.2.2/24"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, {"brif": "t1br2if1", "disk": "10G", "mem": 3, "name": "t1_VM3", "vcpu": 2, "vmif": "t1VM3if1"}], "md5sum": "b977a19124b65f2d544ddc62e407114d", "mode": "0644", "owner": "root", "size": 10739318784, "src": "/root/.ansible/tmp/ansible-tmp-1574047984.83-52446125809755/source", "state": "file", "uid": 0}

TASK [Create VM templates (C1)] *****************************************************************************************************************************
ok: [localhost] => (item=[{u'route': [{u'ip': u'10.1.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.1.2/24', u'tenant_ns_ip': u'10.1.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.1.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.1.2', u'remote_route': u'10.2.1.0/24', u'subnet_route': u'10.1.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.2.1.2'}]}, {u'mem': 2, u'name': u't1_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM1if1'}]) => {"ansible_loop_var": "item", "changed": false, "checksum": "350ba870bd31b7f6ee517845c14237910b5af0bf", "dest": "/root/Migration-as-a-Service/t1/VM_templates/t1_VM1.xml.j2", "gid": 0, "group": "root", "item": [{"bridge_name": "t1br1", "default_route_ip": "10.1.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.1.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.1.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.1.1.2/24"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.1.2", "remote_ip": "10.2.1.2", "remote_route": "10.2.1.0/24", "subnet_route": "10.1.1.0/24", "tenant_route_ip": "192.168.1.2", "v_name": "vxlan_t1s1"}]}, {"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM1", "vcpu": 4, "vmif": "t1VM1if1"}], "mode": "0644", "owner": "root", "path": "/root/Migration-as-a-Service/t1/VM_templates/t1_VM1.xml.j2", "size": 4091, "state": "file", "uid": 0}
ok: [localhost] => (item=[{u'route': [{u'ip': u'10.1.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.1.2/24', u'tenant_ns_ip': u'10.1.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.1.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.1.2', u'remote_route': u'10.2.1.0/24', u'subnet_route': u'10.1.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.2.1.2'}]}, {u'mem': 4, u'name': u't1_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br1if2', u'vmif': u't1VM2if1'}]) => {"ansible_loop_var": "item", "changed": false, "checksum": "350ba870bd31b7f6ee517845c14237910b5af0bf", "dest": "/root/Migration-as-a-Service/t1/VM_templates/t1_VM2.xml.j2", "gid": 0, "group": "root", "item": [{"bridge_name": "t1br1", "default_route_ip": "10.1.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.1.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.1.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.1.1.2/24"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.1.2", "remote_ip": "10.2.1.2", "remote_route": "10.2.1.0/24", "subnet_route": "10.1.1.0/24", "tenant_route_ip": "192.168.1.2", "v_name": "vxlan_t1s1"}]}, {"brif": "t1br1if2", "disk": "10G", "mem": 4, "name": "t1_VM2", "vcpu": 2, "vmif": "t1VM2if1"}], "mode": "0644", "owner": "root", "path": "/root/Migration-as-a-Service/t1/VM_templates/t1_VM2.xml.j2", "size": 4091, "state": "file", "uid": 0}
ok: [localhost] => (item=[{u'route': [{u'ip': u'10.1.2.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.2.1', u'bridge_name': u't1br2', u'dns': [{u'dnsif': u't1s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s2_dnsbrif'}], u'ns_name': u't1ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.2.2/24', u'tenant_ns_ip': u'10.1.2.1/24', u'tenant_ns_if': u't1ns2if', u'tenant_sub_if': u't1s2if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'2.2.2.0/24', u'vxlan': [{u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}, {u'mem': 3, u'name': u't1_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br2if1', u'vmif': u't1VM3if1'}]) => {"ansible_loop_var": "item", "changed": false, "checksum": "350ba870bd31b7f6ee517845c14237910b5af0bf", "dest": "/root/Migration-as-a-Service/t1/VM_templates/t1_VM3.xml.j2", "gid": 0, "group": "root", "item": [{"bridge_name": "t1br2", "default_route_ip": "10.1.2.1", "dns": [{"brif": "t1s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t1s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns2", "route": [{"if": "p1", "ip": "10.1.2.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "2.2.2.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns2if", "tenant_ns_ip": "10.1.2.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s2if", "tenant_sub_ip": "10.1.2.2/24"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, {"brif": "t1br2if1", "disk": "10G", "mem": 3, "name": "t1_VM3", "vcpu": 2, "vmif": "t1VM3if1"}], "mode": "0644", "owner": "root", "path": "/root/Migration-as-a-Service/t1/VM_templates/t1_VM3.xml.j2", "size": 4091, "state": "file", "uid": 0}

TASK [Get list of running VMs] ******************************************************************************************************************************
ok: [localhost] => {"changed": false, "cmd": ["virsh", "list", "--name"], "delta": "0:00:00.032792", "end": "2019-11-18 03:34:36.396763", "rc": 0, "start": "2019-11-18 03:34:36.363971", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Define VM] ********************************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.1.2/24', u'tenant_ns_ip': u'10.1.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.1.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.1.2', u'remote_route': u'10.2.1.0/24', u'subnet_route': u'10.1.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.2.1.2'}]}, {u'mem': 2, u'name': u't1_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM1if1'}]) => {"ansible_loop_var": "item", "changed": true, "created": "t1_VM1", "item": [{"bridge_name": "t1br1", "default_route_ip": "10.1.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.1.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.1.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.1.1.2/24"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.1.2", "remote_ip": "10.2.1.2", "remote_route": "10.2.1.0/24", "subnet_route": "10.1.1.0/24", "tenant_route_ip": "192.168.1.2", "v_name": "vxlan_t1s1"}]}, {"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM1", "vcpu": 4, "vmif": "t1VM1if1"}], "warnings": ["'xml' is given - ignoring 'name'"]}
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.1.2/24', u'tenant_ns_ip': u'10.1.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.1.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.1.2', u'remote_route': u'10.2.1.0/24', u'subnet_route': u'10.1.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.2.1.2'}]}, {u'mem': 4, u'name': u't1_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br1if2', u'vmif': u't1VM2if1'}]) => {"ansible_loop_var": "item", "changed": true, "created": "t1_VM2", "item": [{"bridge_name": "t1br1", "default_route_ip": "10.1.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.1.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.1.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.1.1.2/24"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.1.2", "remote_ip": "10.2.1.2", "remote_route": "10.2.1.0/24", "subnet_route": "10.1.1.0/24", "tenant_route_ip": "192.168.1.2", "v_name": "vxlan_t1s1"}]}, {"brif": "t1br1if2", "disk": "10G", "mem": 4, "name": "t1_VM2", "vcpu": 2, "vmif": "t1VM2if1"}], "warnings": ["'xml' is given - ignoring 'name'"]}
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.2.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.2.1', u'bridge_name': u't1br2', u'dns': [{u'dnsif': u't1s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s2_dnsbrif'}], u'ns_name': u't1ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.2.2/24', u'tenant_ns_ip': u'10.1.2.1/24', u'tenant_ns_if': u't1ns2if', u'tenant_sub_if': u't1s2if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'2.2.2.0/24', u'vxlan': [{u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}, {u'mem': 3, u'name': u't1_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br2if1', u'vmif': u't1VM3if1'}]) => {"ansible_loop_var": "item", "changed": true, "created": "t1_VM3", "item": [{"bridge_name": "t1br2", "default_route_ip": "10.1.2.1", "dns": [{"brif": "t1s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t1s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns2", "route": [{"if": "p1", "ip": "10.1.2.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "2.2.2.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns2if", "tenant_ns_ip": "10.1.2.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s2if", "tenant_sub_ip": "10.1.2.2/24"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, {"brif": "t1br2if1", "disk": "10G", "mem": 3, "name": "t1_VM3", "vcpu": 2, "vmif": "t1VM3if1"}], "warnings": ["'xml' is given - ignoring 'name'"]}

TASK [Create VM] ********************************************************************************************************************************************
ok: [localhost] => (item=[{u'route': [{u'ip': u'10.1.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.1.2/24', u'tenant_ns_ip': u'10.1.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.1.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.1.2', u'remote_route': u'10.2.1.0/24', u'subnet_route': u'10.1.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.2.1.2'}]}, {u'mem': 2, u'name': u't1_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM1if1'}]) => {"ansible_loop_var": "item", "changed": false, "create": 0, "item": [{"bridge_name": "t1br1", "default_route_ip": "10.1.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.1.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.1.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.1.1.2/24"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.1.2", "remote_ip": "10.2.1.2", "remote_route": "10.2.1.0/24", "subnet_route": "10.1.1.0/24", "tenant_route_ip": "192.168.1.2", "v_name": "vxlan_t1s1"}]}, {"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM1", "vcpu": 4, "vmif": "t1VM1if1"}]}
ok: [localhost] => (item=[{u'route': [{u'ip': u'10.1.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.1.2/24', u'tenant_ns_ip': u'10.1.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.1.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.1.2', u'remote_route': u'10.2.1.0/24', u'subnet_route': u'10.1.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.2.1.2'}]}, {u'mem': 4, u'name': u't1_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br1if2', u'vmif': u't1VM2if1'}]) => {"ansible_loop_var": "item", "changed": false, "create": 0, "item": [{"bridge_name": "t1br1", "default_route_ip": "10.1.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.1.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.1.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.1.1.2/24"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.1.2", "remote_ip": "10.2.1.2", "remote_route": "10.2.1.0/24", "subnet_route": "10.1.1.0/24", "tenant_route_ip": "192.168.1.2", "v_name": "vxlan_t1s1"}]}, {"brif": "t1br1if2", "disk": "10G", "mem": 4, "name": "t1_VM2", "vcpu": 2, "vmif": "t1VM2if1"}]}
ok: [localhost] => (item=[{u'route': [{u'ip': u'10.1.2.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.2.1', u'bridge_name': u't1br2', u'dns': [{u'dnsif': u't1s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s2_dnsbrif'}], u'ns_name': u't1ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.2.2/24', u'tenant_ns_ip': u'10.1.2.1/24', u'tenant_ns_if': u't1ns2if', u'tenant_sub_if': u't1s2if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'2.2.2.0/24', u'vxlan': [{u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}, {u'mem': 3, u'name': u't1_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br2if1', u'vmif': u't1VM3if1'}]) => {"ansible_loop_var": "item", "changed": false, "create": 0, "item": [{"bridge_name": "t1br2", "default_route_ip": "10.1.2.1", "dns": [{"brif": "t1s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t1s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns2", "route": [{"if": "p1", "ip": "10.1.2.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "2.2.2.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns2if", "tenant_ns_ip": "10.1.2.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s2if", "tenant_sub_ip": "10.1.2.2/24"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, {"brif": "t1br2if1", "disk": "10G", "mem": 3, "name": "t1_VM3", "vcpu": 2, "vmif": "t1VM3if1"}]}

TASK [Start VM] *********************************************************************************************************************************************
ok: [localhost] => (item=[{u'route': [{u'ip': u'10.1.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.1.2/24', u'tenant_ns_ip': u'10.1.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.1.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.1.2', u'remote_route': u'10.2.1.0/24', u'subnet_route': u'10.1.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.2.1.2'}]}, {u'mem': 2, u'name': u't1_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM1if1'}]) => {"ansible_loop_var": "item", "changed": false, "item": [{"bridge_name": "t1br1", "default_route_ip": "10.1.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.1.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.1.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.1.1.2/24"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.1.2", "remote_ip": "10.2.1.2", "remote_route": "10.2.1.0/24", "subnet_route": "10.1.1.0/24", "tenant_route_ip": "192.168.1.2", "v_name": "vxlan_t1s1"}]}, {"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM1", "vcpu": 4, "vmif": "t1VM1if1"}]}
ok: [localhost] => (item=[{u'route': [{u'ip': u'10.1.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.1.2/24', u'tenant_ns_ip': u'10.1.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.1.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.1.2', u'remote_route': u'10.2.1.0/24', u'subnet_route': u'10.1.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.2.1.2'}]}, {u'mem': 4, u'name': u't1_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br1if2', u'vmif': u't1VM2if1'}]) => {"ansible_loop_var": "item", "changed": false, "item": [{"bridge_name": "t1br1", "default_route_ip": "10.1.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.1.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.1.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.1.1.2/24"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.1.2", "remote_ip": "10.2.1.2", "remote_route": "10.2.1.0/24", "subnet_route": "10.1.1.0/24", "tenant_route_ip": "192.168.1.2", "v_name": "vxlan_t1s1"}]}, {"brif": "t1br1if2", "disk": "10G", "mem": 4, "name": "t1_VM2", "vcpu": 2, "vmif": "t1VM2if1"}]}
ok: [localhost] => (item=[{u'route': [{u'ip': u'10.1.2.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.2.1', u'bridge_name': u't1br2', u'dns': [{u'dnsif': u't1s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s2_dnsbrif'}], u'ns_name': u't1ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.2.2/24', u'tenant_ns_ip': u'10.1.2.1/24', u'tenant_ns_if': u't1ns2if', u'tenant_sub_if': u't1s2if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'2.2.2.0/24', u'vxlan': [{u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}, {u'mem': 3, u'name': u't1_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br2if1', u'vmif': u't1VM3if1'}]) => {"ansible_loop_var": "item", "changed": false, "item": [{"bridge_name": "t1br2", "default_route_ip": "10.1.2.1", "dns": [{"brif": "t1s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t1s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns2", "route": [{"if": "p1", "ip": "10.1.2.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "2.2.2.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns2if", "tenant_ns_ip": "10.1.2.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s2if", "tenant_sub_ip": "10.1.2.2/24"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, {"brif": "t1br2if1", "disk": "10G", "mem": 3, "name": "t1_VM3", "vcpu": 2, "vmif": "t1VM3if1"}]}

TASK [Attach VM interface] **********************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.1.2/24', u'tenant_ns_ip': u'10.1.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.1.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.1.2', u'remote_route': u'10.2.1.0/24', u'subnet_route': u'10.1.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.2.1.2'}]}, {u'mem': 2, u'name': u't1_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM1if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "virsh domiflist \"t1_VM1\" | grep -w 't1VM1if1' ; if [ $? -ne 0 ] ; then virsh attach-interface \"t1_VM1\" direct \"t1VM1if1\" --live --persistent ; fi\n", "delta": "0:00:00.302549", "end": "2019-11-18 03:35:35.139040", "item": [{"bridge_name": "t1br1", "default_route_ip": "10.1.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.1.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.1.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.1.1.2/24"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.1.2", "remote_ip": "10.2.1.2", "remote_route": "10.2.1.0/24", "subnet_route": "10.1.1.0/24", "tenant_route_ip": "192.168.1.2", "v_name": "vxlan_t1s1"}]}, {"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM1", "vcpu": 4, "vmif": "t1VM1if1"}], "rc": 0, "start": "2019-11-18 03:35:34.836491", "stderr": "", "stderr_lines": [], "stdout": "Interface attached successfully", "stdout_lines": ["Interface attached successfully"]}
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.1.2/24', u'tenant_ns_ip': u'10.1.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.1.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.1.2', u'remote_route': u'10.2.1.0/24', u'subnet_route': u'10.1.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.2.1.2'}]}, {u'mem': 4, u'name': u't1_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br1if2', u'vmif': u't1VM2if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "virsh domiflist \"t1_VM2\" | grep -w 't1VM2if1' ; if [ $? -ne 0 ] ; then virsh attach-interface \"t1_VM2\" direct \"t1VM2if1\" --live --persistent ; fi\n", "delta": "0:00:00.226534", "end": "2019-11-18 03:35:35.493529", "item": [{"bridge_name": "t1br1", "default_route_ip": "10.1.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.1.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.1.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.1.1.2/24"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.1.2", "remote_ip": "10.2.1.2", "remote_route": "10.2.1.0/24", "subnet_route": "10.1.1.0/24", "tenant_route_ip": "192.168.1.2", "v_name": "vxlan_t1s1"}]}, {"brif": "t1br1if2", "disk": "10G", "mem": 4, "name": "t1_VM2", "vcpu": 2, "vmif": "t1VM2if1"}], "rc": 0, "start": "2019-11-18 03:35:35.266995", "stderr": "", "stderr_lines": [], "stdout": "Interface attached successfully", "stdout_lines": ["Interface attached successfully"]}
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.2.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.2.1', u'bridge_name': u't1br2', u'dns': [{u'dnsif': u't1s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s2_dnsbrif'}], u'ns_name': u't1ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.2.2/24', u'tenant_ns_ip': u'10.1.2.1/24', u'tenant_ns_if': u't1ns2if', u'tenant_sub_if': u't1s2if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'2.2.2.0/24', u'vxlan': [{u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}, {u'mem': 3, u'name': u't1_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br2if1', u'vmif': u't1VM3if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "virsh domiflist \"t1_VM3\" | grep -w 't1VM3if1' ; if [ $? -ne 0 ] ; then virsh attach-interface \"t1_VM3\" direct \"t1VM3if1\" --live --persistent ; fi\n", "delta": "0:00:00.242732", "end": "2019-11-18 03:35:35.875618", "item": [{"bridge_name": "t1br2", "default_route_ip": "10.1.2.1", "dns": [{"brif": "t1s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t1s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns2", "route": [{"if": "p1", "ip": "10.1.2.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "2.2.2.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns2if", "tenant_ns_ip": "10.1.2.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s2if", "tenant_sub_ip": "10.1.2.2/24"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, {"brif": "t1br2if1", "disk": "10G", "mem": 3, "name": "t1_VM3", "vcpu": 2, "vmif": "t1VM3if1"}], "rc": 0, "start": "2019-11-18 03:35:35.632886", "stderr": "", "stderr_lines": [], "stdout": "Interface attached successfully", "stdout_lines": ["Interface attached successfully"]}

PLAY RECAP **************************************************************************************************************************************************
localhost                  : ok=7    changed=3    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0   

Using /etc/ansible/ansible.cfg as config file

PLAY [worker] ***********************************************************************************************************************************************

TASK [Copy VM image] ****************************************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.2.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.1.2/24', u'tenant_ns_ip': u'10.2.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.2.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.129.2', u'remote_route': u'10.1.1.0/24', u'subnet_route': u'10.2.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.1.1.2'}]}, {u'mem': 2, u'name': u't1_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM4if1'}]) => {"ansible_loop_var": "item", "changed": true, "checksum": "f8b2ffa2bf201c84196c582f2dec0d33a1eb4b42", "dest": "/var/lib/libvirt/images/t1_VM4.qcow2", "gid": 0, "group": "root", "item": [{"bridge_name": "t1br1", "default_route_ip": "10.2.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.2.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.2.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.2.1.2/24"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.1.2", "remote_ip": "10.1.1.2", "remote_route": "10.1.1.0/24", "subnet_route": "10.2.1.0/24", "tenant_route_ip": "192.168.129.2", "v_name": "vxlan_t1s1"}]}, {"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM4", "vcpu": 4, "vmif": "t1VM4if1"}], "md5sum": "e6d5d524b68797ddd748ba1475985d34", "mode": "0644", "owner": "root", "size": 10739318784, "src": "/root/mainVM.qcow2", "state": "file", "uid": 0}

TASK [Get list of running VMs] ******************************************************************************************************************************
ok: [99.99.99.2] => {"changed": false, "cmd": ["virsh", "list", "--name"], "delta": "0:00:00.018772", "end": "2019-11-18 03:37:26.067446", "rc": 0, "start": "2019-11-18 03:37:26.048674", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Define VM] ********************************************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.2.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.1.2/24', u'tenant_ns_ip': u'10.2.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.2.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.129.2', u'remote_route': u'10.1.1.0/24', u'subnet_route': u'10.2.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.1.1.2'}]}, {u'mem': 2, u'name': u't1_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM4if1'}]) => {"ansible_loop_var": "item", "changed": true, "created": "t1_VM4", "item": [{"bridge_name": "t1br1", "default_route_ip": "10.2.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.2.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.2.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.2.1.2/24"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.1.2", "remote_ip": "10.1.1.2", "remote_route": "10.1.1.0/24", "subnet_route": "10.2.1.0/24", "tenant_route_ip": "192.168.129.2", "v_name": "vxlan_t1s1"}]}, {"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM4", "vcpu": 4, "vmif": "t1VM4if1"}], "warnings": ["'xml' is given - ignoring 'name'"]}

TASK [Create VM] ********************************************************************************************************************************************
ok: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.2.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.1.2/24', u'tenant_ns_ip': u'10.2.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.2.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.129.2', u'remote_route': u'10.1.1.0/24', u'subnet_route': u'10.2.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.1.1.2'}]}, {u'mem': 2, u'name': u't1_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM4if1'}]) => {"ansible_loop_var": "item", "changed": false, "create": 0, "item": [{"bridge_name": "t1br1", "default_route_ip": "10.2.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.2.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.2.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.2.1.2/24"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.1.2", "remote_ip": "10.1.1.2", "remote_route": "10.1.1.0/24", "subnet_route": "10.2.1.0/24", "tenant_route_ip": "192.168.129.2", "v_name": "vxlan_t1s1"}]}, {"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM4", "vcpu": 4, "vmif": "t1VM4if1"}]}

TASK [Start VM] *********************************************************************************************************************************************
ok: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.2.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.1.2/24', u'tenant_ns_ip': u'10.2.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.2.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.129.2', u'remote_route': u'10.1.1.0/24', u'subnet_route': u'10.2.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.1.1.2'}]}, {u'mem': 2, u'name': u't1_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM4if1'}]) => {"ansible_loop_var": "item", "changed": false, "item": [{"bridge_name": "t1br1", "default_route_ip": "10.2.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.2.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.2.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.2.1.2/24"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.1.2", "remote_ip": "10.1.1.2", "remote_route": "10.1.1.0/24", "subnet_route": "10.2.1.0/24", "tenant_route_ip": "192.168.129.2", "v_name": "vxlan_t1s1"}]}, {"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM4", "vcpu": 4, "vmif": "t1VM4if1"}]}

TASK [Attach VM interface] **********************************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.2.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.1.2/24', u'tenant_ns_ip': u'10.2.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.2.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.129.2', u'remote_route': u'10.1.1.0/24', u'subnet_route': u'10.2.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.1.1.2'}]}, {u'mem': 2, u'name': u't1_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM4if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "virsh domiflist \"t1_VM4\" | grep -w 't1VM4if1' ; if [ $? -ne 0 ] ; then virsh attach-interface \"t1_VM4\" direct \"t1VM4if1\" --live --persistent ; fi\n", "delta": "0:00:00.274858", "end": "2019-11-18 03:37:40.777502", "item": [{"bridge_name": "t1br1", "default_route_ip": "10.2.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.2.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.2.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.2.1.2/24"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.1.2", "remote_ip": "10.1.1.2", "remote_route": "10.1.1.0/24", "subnet_route": "10.2.1.0/24", "tenant_route_ip": "192.168.129.2", "v_name": "vxlan_t1s1"}]}, {"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM4", "vcpu": 4, "vmif": "t1VM4if1"}], "rc": 0, "start": "2019-11-18 03:37:40.502644", "stderr": "", "stderr_lines": [], "stdout": "Interface attached successfully", "stdout_lines": ["Interface attached successfully"]}

PLAY RECAP **************************************************************************************************************************************************
99.99.99.2                 : ok=6    changed=3    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0   

INFO:root: 03:42:34.775159 The subnet 1.1.1.0/24 is present in Cloud 1
INFO:root: 03:42:34.775344 The VM VM1 is present in Cloud 1
ERROR:root: 03:42:34.775410 The subnet 1.1.1.0/24 is not present in the destination cloud
INFO:root: 03:50:44.153669 The subnet 1.1.1.0/24 is present in Cloud 1
INFO:root: 03:50:44.153807 The VM VM1 is present in Cloud 1
ERROR:root: 03:50:44.153921 The subnet 1.1.1.0/24 is not present in the destination cloud
INFO:root: 03:57:39.418017 Printing the yaml input file
INFO:root: 03:57:39.418170 {'C1': [{'subnet_addr': '1.1.1.0/24', 'VM': [{'name': 'VM1', 'disk': '10G', 'mem': 2, 'vcpu': 4}, {'name': 'VM2', 'disk': '10G', 'mem': 4, 'vcpu': 2}]}, {'subnet_addr': '2.2.2.0/24', 'VM': [{'name': 'VM3', 'disk': '10G', 'mem': 3, 'vcpu': 2}]}], 'C2': [{'subnet_addr': '1.1.1.0/24', 'VM': [{'name': 'VM4', 'disk': '10G', 'mem': 2, 'vcpu': 4}]}]}
INFO:root: 03:57:39.418272 Provided subnet in C1: 1.1.1.0/24 is valid
INFO:root: 03:57:39.418324 Provided subnet in C1: 2.2.2.0/24 is valid
INFO:root: 03:57:39.418371 Provided subnet in C2: 1.1.1.0/24 is valid
Using /etc/ansible/ansible.cfg as config file

PLAY [main] *************************************************************************************************************************************************

TASK [Create Tenant Namespace] ******************************************************************************************************************************
changed: [localhost] => (item={u'default_route_ip': u'192.168.2.1', u'name': u't2', u'pns_ip': u'192.168.2.1/24', u'tenant_if': u't2if', u'tenant_ip': u'192.168.2.2/24', u'pns_if': u't2pns_if'}) => {"ansible_loop_var": "item", "changed": true, "cmd": ["ip", "netns", "add", "t2"], "delta": "0:00:00.061743", "end": "2019-11-18 03:57:40.704249", "item": {"default_route_ip": "192.168.2.1", "name": "t2", "pns_if": "t2pns_if", "pns_ip": "192.168.2.1/24", "tenant_if": "t2if", "tenant_ip": "192.168.2.2/24"}, "rc": 0, "start": "2019-11-18 03:57:40.642506", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Create Subnet Namespace] ******************************************************************************************************************************
changed: [localhost] => (item={u'route': [{u'ip': u'10.1.11.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.1.11.1', u'bridge_name': u't2br1', u'dns': [{u'dnsif': u't2s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't2s1_dnsbrif'}], u'ns_name': u't2ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.11.2/24', u'tenant_ns_ip': u'10.1.11.1/24', u'tenant_ns_if': u't2ns1if', u'tenant_ns_name': u't2', u'tenant_sub_if': u't2s1if'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't2_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't2br1if1', u'vmif': u't2VM1if1'}, {u'mem': 4, u'name': u't2_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't2br1if2', u'vmif': u't2VM2if1'}], u'vxlan': [{u'local_ip': u'10.1.11.2', u'tenant_route_ip': u'192.168.2.2', u'dsport': 4789, u'dev': u't2s1if', u'subnet_route': u'10.1.11.0/24', u'remote_route': u'10.2.11.0/24', u'v_name': u'vxlan_t2s1', u'id': 42, u'remote_ip': u'10.2.11.2'}]}) => {"ansible_loop_var": "item", "changed": true, "cmd": ["ip", "netns", "add", "t2ns1"], "delta": "0:00:00.054674", "end": "2019-11-18 03:57:41.057217", "item": {"bridge_name": "t2br1", "default_route_ip": "10.1.11.1", "dns": [{"brif": "t2s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t2s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns1", "route": [{"if": "p1", "ip": "10.1.11.1/24", "ns_if": "t2if", "ns_name": "t2"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t2ns1if", "tenant_ns_ip": "10.1.11.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s1if", "tenant_sub_ip": "10.1.11.2/24"}], "vms": [{"brif": "t2br1if1", "disk": "10G", "mem": 2, "name": "t2_VM1", "vcpu": 4, "vmif": "t2VM1if1"}, {"brif": "t2br1if2", "disk": "10G", "mem": 4, "name": "t2_VM2", "vcpu": 2, "vmif": "t2VM2if1"}], "vxlan": [{"dev": "t2s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.11.2", "remote_ip": "10.2.11.2", "remote_route": "10.2.11.0/24", "subnet_route": "10.1.11.0/24", "tenant_route_ip": "192.168.2.2", "v_name": "vxlan_t2s1"}]}, "rc": 0, "start": "2019-11-18 03:57:41.002543", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}
changed: [localhost] => (item={u'route': [{u'ip': u'10.1.12.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.1.12.1', u'bridge_name': u't2br2', u'dns': [{u'dnsif': u't2s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't2s2_dnsbrif'}], u'ns_name': u't2ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.12.2/24', u'tenant_ns_ip': u'10.1.12.1/24', u'tenant_ns_if': u't2ns2if', u'tenant_ns_name': u't2', u'tenant_sub_if': u't2s2if'}], u'subnet_ip': u'2.2.2.0/24', u'vms': [{u'mem': 3, u'name': u't2_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't2br2if1', u'vmif': u't2VM3if1'}], u'vxlan': [{u'local_ip': [], u'tenant_route_ip': [], u'dsport': [], u'dev': [], u'subnet_route': [], u'remote_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}) => {"ansible_loop_var": "item", "changed": true, "cmd": ["ip", "netns", "add", "t2ns2"], "delta": "0:00:00.073189", "end": "2019-11-18 03:57:41.361721", "item": {"bridge_name": "t2br2", "default_route_ip": "10.1.12.1", "dns": [{"brif": "t2s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t2s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns2", "route": [{"if": "p1", "ip": "10.1.12.1/24", "ns_if": "t2if", "ns_name": "t2"}], "subnet_ip": "2.2.2.0/24", "tenant_ns": [{"tenant_ns_if": "t2ns2if", "tenant_ns_ip": "10.1.12.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s2if", "tenant_sub_ip": "10.1.12.2/24"}], "vms": [{"brif": "t2br2if1", "disk": "10G", "mem": 3, "name": "t2_VM3", "vcpu": 2, "vmif": "t2VM3if1"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, "rc": 0, "start": "2019-11-18 03:57:41.288532", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Create Tenant VETH pairs] *****************************************************************************************************************************
changed: [localhost] => (item={u'default_route_ip': u'192.168.2.1', u'name': u't2', u'pns_ip': u'192.168.2.1/24', u'tenant_if': u't2if', u'tenant_ip': u'192.168.2.2/24', u'pns_if': u't2pns_if'}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip link show \"t2if\" ; if [ $? -ne 0 ] ; then ip link add \"t2if\" type veth peer name \"t2pns_if\" ; fi\n", "delta": "0:00:00.008945", "end": "2019-11-18 03:57:41.648265", "item": {"default_route_ip": "192.168.2.1", "name": "t2", "pns_if": "t2pns_if", "pns_ip": "192.168.2.1/24", "tenant_if": "t2if", "tenant_ip": "192.168.2.2/24"}, "rc": 0, "start": "2019-11-18 03:57:41.639320", "stderr": "Device \"t2if\" does not exist.", "stderr_lines": ["Device \"t2if\" does not exist."], "stdout": "", "stdout_lines": []}

TASK [Attach Tenant VETH Pairs] *****************************************************************************************************************************
changed: [localhost] => (item={u'default_route_ip': u'192.168.2.1', u'name': u't2', u'pns_ip': u'192.168.2.1/24', u'tenant_if': u't2if', u'tenant_ip': u'192.168.2.2/24', u'pns_if': u't2pns_if'}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec pns ip link show \"t2pns_if\" ; if [ $? -ne 0 ] ; then ip link set \"t2pns_if\" netns pns ; fi\nip netns exec \"t2\" ip link show \"t2if\" ; if [ $? -ne 0 ] ; then ip link set \"t2if\" netns \"t2\" ; fi\nip netns exec pns ip link set dev \"t2pns_if\" up\nip netns exec \"t2\" ip link set dev \"t2if\" up\n", "delta": "0:00:00.181394", "end": "2019-11-18 03:57:42.079673", "item": {"default_route_ip": "192.168.2.1", "name": "t2", "pns_if": "t2pns_if", "pns_ip": "192.168.2.1/24", "tenant_if": "t2if", "tenant_ip": "192.168.2.2/24"}, "rc": 0, "start": "2019-11-18 03:57:41.898279", "stderr": "Device \"t2pns_if\" does not exist.\nDevice \"t2if\" does not exist.", "stderr_lines": ["Device \"t2pns_if\" does not exist.", "Device \"t2if\" does not exist."], "stdout": "", "stdout_lines": []}

TASK [Add IP addresses to Tenant VETH Pairs] ****************************************************************************************************************
changed: [localhost] => (item={u'default_route_ip': u'192.168.2.1', u'name': u't2', u'pns_ip': u'192.168.2.1/24', u'tenant_if': u't2if', u'tenant_ip': u'192.168.2.2/24', u'pns_if': u't2pns_if'}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec pns ip addr show \"t2pns_if\" | awk 'FNR==3{ print $2 }' | grep -w '^192.168.2.1/24' ; if [ $? -ne 0 ] ; then ip netns exec pns ip addr add \"192.168.2.1/24\" dev \"t2pns_if\" ; fi\nip netns exec \"t2\" ip addr show \"t2if\" | awk 'FNR==3{ print $2 }' | grep -w '^192.168.2.2/24' ; if [ $? -ne 0 ] ; then ip netns exec \"t2\" ip addr add \"192.168.2.2/24\" dev \"t2if\" ; fi\n", "delta": "0:00:00.137569", "end": "2019-11-18 03:57:42.455883", "item": {"default_route_ip": "192.168.2.1", "name": "t2", "pns_if": "t2pns_if", "pns_ip": "192.168.2.1/24", "tenant_if": "t2if", "tenant_ip": "192.168.2.2/24"}, "rc": 0, "start": "2019-11-18 03:57:42.318314", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Create Namespace VETH Pairs] **************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.11.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.1.11.1', u'bridge_name': u't2br1', u'dns': [{u'dnsif': u't2s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't2s1_dnsbrif'}], u'ns_name': u't2ns1', u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't2_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't2br1if1', u'vmif': u't2VM1if1'}, {u'mem': 4, u'name': u't2_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't2br1if2', u'vmif': u't2VM2if1'}], u'vxlan': [{u'local_ip': u'10.1.11.2', u'dsport': 4789, u'dev': u't2s1if', u'tenant_route_ip': u'192.168.2.2', u'remote_route': u'10.2.11.0/24', u'subnet_route': u'10.1.11.0/24', u'v_name': u'vxlan_t2s1', u'id': 42, u'remote_ip': u'10.2.11.2'}]}, {u'tenant_sub_ip': u'10.1.11.2/24', u'tenant_ns_ip': u'10.1.11.1/24', u'tenant_ns_if': u't2ns1if', u'tenant_sub_if': u't2s1if', u'tenant_ns_name': u't2'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip link show \"t2ns1if\" ; if [ $? -ne 0 ] ; then ip link add \"t2ns1if\" type veth peer name \"t2s1if\" ; fi\n", "delta": "0:00:00.011295", "end": "2019-11-18 03:57:42.763729", "item": [{"bridge_name": "t2br1", "default_route_ip": "10.1.11.1", "dns": [{"brif": "t2s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t2s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns1", "route": [{"if": "p1", "ip": "10.1.11.1/24", "ns_if": "t2if", "ns_name": "t2"}], "subnet_ip": "1.1.1.0/24", "vms": [{"brif": "t2br1if1", "disk": "10G", "mem": 2, "name": "t2_VM1", "vcpu": 4, "vmif": "t2VM1if1"}, {"brif": "t2br1if2", "disk": "10G", "mem": 4, "name": "t2_VM2", "vcpu": 2, "vmif": "t2VM2if1"}], "vxlan": [{"dev": "t2s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.11.2", "remote_ip": "10.2.11.2", "remote_route": "10.2.11.0/24", "subnet_route": "10.1.11.0/24", "tenant_route_ip": "192.168.2.2", "v_name": "vxlan_t2s1"}]}, {"tenant_ns_if": "t2ns1if", "tenant_ns_ip": "10.1.11.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s1if", "tenant_sub_ip": "10.1.11.2/24"}], "rc": 0, "start": "2019-11-18 03:57:42.752434", "stderr": "Device \"t2ns1if\" does not exist.", "stderr_lines": ["Device \"t2ns1if\" does not exist."], "stdout": "", "stdout_lines": []}
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.12.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.1.12.1', u'bridge_name': u't2br2', u'dns': [{u'dnsif': u't2s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't2s2_dnsbrif'}], u'ns_name': u't2ns2', u'subnet_ip': u'2.2.2.0/24', u'vms': [{u'mem': 3, u'name': u't2_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't2br2if1', u'vmif': u't2VM3if1'}], u'vxlan': [{u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}, {u'tenant_sub_ip': u'10.1.12.2/24', u'tenant_ns_ip': u'10.1.12.1/24', u'tenant_ns_if': u't2ns2if', u'tenant_sub_if': u't2s2if', u'tenant_ns_name': u't2'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip link show \"t2ns2if\" ; if [ $? -ne 0 ] ; then ip link add \"t2ns2if\" type veth peer name \"t2s2if\" ; fi\n", "delta": "0:00:00.011296", "end": "2019-11-18 03:57:42.989467", "item": [{"bridge_name": "t2br2", "default_route_ip": "10.1.12.1", "dns": [{"brif": "t2s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t2s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns2", "route": [{"if": "p1", "ip": "10.1.12.1/24", "ns_if": "t2if", "ns_name": "t2"}], "subnet_ip": "2.2.2.0/24", "vms": [{"brif": "t2br2if1", "disk": "10G", "mem": 3, "name": "t2_VM3", "vcpu": 2, "vmif": "t2VM3if1"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, {"tenant_ns_if": "t2ns2if", "tenant_ns_ip": "10.1.12.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s2if", "tenant_sub_ip": "10.1.12.2/24"}], "rc": 0, "start": "2019-11-18 03:57:42.978171", "stderr": "Device \"t2ns2if\" does not exist.", "stderr_lines": ["Device \"t2ns2if\" does not exist."], "stdout": "", "stdout_lines": []}

TASK [Attach Namespace VETH Pairs] **************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.11.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.1.11.1', u'bridge_name': u't2br1', u'dns': [{u'dnsif': u't2s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't2s1_dnsbrif'}], u'ns_name': u't2ns1', u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't2_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't2br1if1', u'vmif': u't2VM1if1'}, {u'mem': 4, u'name': u't2_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't2br1if2', u'vmif': u't2VM2if1'}], u'vxlan': [{u'local_ip': u'10.1.11.2', u'dsport': 4789, u'dev': u't2s1if', u'tenant_route_ip': u'192.168.2.2', u'remote_route': u'10.2.11.0/24', u'subnet_route': u'10.1.11.0/24', u'v_name': u'vxlan_t2s1', u'id': 42, u'remote_ip': u'10.2.11.2'}]}, {u'tenant_sub_ip': u'10.1.11.2/24', u'tenant_ns_ip': u'10.1.11.1/24', u'tenant_ns_if': u't2ns1if', u'tenant_sub_if': u't2s1if', u'tenant_ns_name': u't2'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t2\" ip link show \"t2ns1if\" ; if [ $? -ne 0 ] ; then ip link set \"t2ns1if\" netns \"t2\" ; fi\nip netns exec \"t2ns1\" ip link show \"t2s1if\" ; if [ $? -ne 0 ] ; then ip link set \"t2s1if\" netns \"t2ns1\" ; fi\n", "delta": "0:00:00.122014", "end": "2019-11-18 03:57:43.436281", "item": [{"bridge_name": "t2br1", "default_route_ip": "10.1.11.1", "dns": [{"brif": "t2s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t2s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns1", "route": [{"if": "p1", "ip": "10.1.11.1/24", "ns_if": "t2if", "ns_name": "t2"}], "subnet_ip": "1.1.1.0/24", "vms": [{"brif": "t2br1if1", "disk": "10G", "mem": 2, "name": "t2_VM1", "vcpu": 4, "vmif": "t2VM1if1"}, {"brif": "t2br1if2", "disk": "10G", "mem": 4, "name": "t2_VM2", "vcpu": 2, "vmif": "t2VM2if1"}], "vxlan": [{"dev": "t2s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.11.2", "remote_ip": "10.2.11.2", "remote_route": "10.2.11.0/24", "subnet_route": "10.1.11.0/24", "tenant_route_ip": "192.168.2.2", "v_name": "vxlan_t2s1"}]}, {"tenant_ns_if": "t2ns1if", "tenant_ns_ip": "10.1.11.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s1if", "tenant_sub_ip": "10.1.11.2/24"}], "rc": 0, "start": "2019-11-18 03:57:43.314267", "stderr": "Device \"t2ns1if\" does not exist.\nDevice \"t2s1if\" does not exist.", "stderr_lines": ["Device \"t2ns1if\" does not exist.", "Device \"t2s1if\" does not exist."], "stdout": "", "stdout_lines": []}
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.12.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.1.12.1', u'bridge_name': u't2br2', u'dns': [{u'dnsif': u't2s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't2s2_dnsbrif'}], u'ns_name': u't2ns2', u'subnet_ip': u'2.2.2.0/24', u'vms': [{u'mem': 3, u'name': u't2_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't2br2if1', u'vmif': u't2VM3if1'}], u'vxlan': [{u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}, {u'tenant_sub_ip': u'10.1.12.2/24', u'tenant_ns_ip': u'10.1.12.1/24', u'tenant_ns_if': u't2ns2if', u'tenant_sub_if': u't2s2if', u'tenant_ns_name': u't2'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t2\" ip link show \"t2ns2if\" ; if [ $? -ne 0 ] ; then ip link set \"t2ns2if\" netns \"t2\" ; fi\nip netns exec \"t2ns2\" ip link show \"t2s2if\" ; if [ $? -ne 0 ] ; then ip link set \"t2s2if\" netns \"t2ns2\" ; fi\n", "delta": "0:00:00.127135", "end": "2019-11-18 03:57:43.781244", "item": [{"bridge_name": "t2br2", "default_route_ip": "10.1.12.1", "dns": [{"brif": "t2s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t2s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns2", "route": [{"if": "p1", "ip": "10.1.12.1/24", "ns_if": "t2if", "ns_name": "t2"}], "subnet_ip": "2.2.2.0/24", "vms": [{"brif": "t2br2if1", "disk": "10G", "mem": 3, "name": "t2_VM3", "vcpu": 2, "vmif": "t2VM3if1"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, {"tenant_ns_if": "t2ns2if", "tenant_ns_ip": "10.1.12.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s2if", "tenant_sub_ip": "10.1.12.2/24"}], "rc": 0, "start": "2019-11-18 03:57:43.654109", "stderr": "Device \"t2ns2if\" does not exist.\nDevice \"t2s2if\" does not exist.", "stderr_lines": ["Device \"t2ns2if\" does not exist.", "Device \"t2s2if\" does not exist."], "stdout": "", "stdout_lines": []}

TASK [Set Namespace VETH Pairs UP] **************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.11.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.1.11.1', u'bridge_name': u't2br1', u'dns': [{u'dnsif': u't2s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't2s1_dnsbrif'}], u'ns_name': u't2ns1', u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't2_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't2br1if1', u'vmif': u't2VM1if1'}, {u'mem': 4, u'name': u't2_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't2br1if2', u'vmif': u't2VM2if1'}], u'vxlan': [{u'local_ip': u'10.1.11.2', u'dsport': 4789, u'dev': u't2s1if', u'tenant_route_ip': u'192.168.2.2', u'remote_route': u'10.2.11.0/24', u'subnet_route': u'10.1.11.0/24', u'v_name': u'vxlan_t2s1', u'id': 42, u'remote_ip': u'10.2.11.2'}]}, {u'tenant_sub_ip': u'10.1.11.2/24', u'tenant_ns_ip': u'10.1.11.1/24', u'tenant_ns_if': u't2ns1if', u'tenant_sub_if': u't2s1if', u'tenant_ns_name': u't2'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t2\" ip link set dev \"t2ns1if\" up\nip netns exec \"t2ns1\" ip link set dev \"t2s1if\" up\n", "delta": "0:00:00.102089", "end": "2019-11-18 03:57:44.171953", "item": [{"bridge_name": "t2br1", "default_route_ip": "10.1.11.1", "dns": [{"brif": "t2s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t2s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns1", "route": [{"if": "p1", "ip": "10.1.11.1/24", "ns_if": "t2if", "ns_name": "t2"}], "subnet_ip": "1.1.1.0/24", "vms": [{"brif": "t2br1if1", "disk": "10G", "mem": 2, "name": "t2_VM1", "vcpu": 4, "vmif": "t2VM1if1"}, {"brif": "t2br1if2", "disk": "10G", "mem": 4, "name": "t2_VM2", "vcpu": 2, "vmif": "t2VM2if1"}], "vxlan": [{"dev": "t2s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.11.2", "remote_ip": "10.2.11.2", "remote_route": "10.2.11.0/24", "subnet_route": "10.1.11.0/24", "tenant_route_ip": "192.168.2.2", "v_name": "vxlan_t2s1"}]}, {"tenant_ns_if": "t2ns1if", "tenant_ns_ip": "10.1.11.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s1if", "tenant_sub_ip": "10.1.11.2/24"}], "rc": 0, "start": "2019-11-18 03:57:44.069864", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.12.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.1.12.1', u'bridge_name': u't2br2', u'dns': [{u'dnsif': u't2s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't2s2_dnsbrif'}], u'ns_name': u't2ns2', u'subnet_ip': u'2.2.2.0/24', u'vms': [{u'mem': 3, u'name': u't2_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't2br2if1', u'vmif': u't2VM3if1'}], u'vxlan': [{u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}, {u'tenant_sub_ip': u'10.1.12.2/24', u'tenant_ns_ip': u'10.1.12.1/24', u'tenant_ns_if': u't2ns2if', u'tenant_sub_if': u't2s2if', u'tenant_ns_name': u't2'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t2\" ip link set dev \"t2ns2if\" up\nip netns exec \"t2ns2\" ip link set dev \"t2s2if\" up\n", "delta": "0:00:00.088763", "end": "2019-11-18 03:57:44.475909", "item": [{"bridge_name": "t2br2", "default_route_ip": "10.1.12.1", "dns": [{"brif": "t2s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t2s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns2", "route": [{"if": "p1", "ip": "10.1.12.1/24", "ns_if": "t2if", "ns_name": "t2"}], "subnet_ip": "2.2.2.0/24", "vms": [{"brif": "t2br2if1", "disk": "10G", "mem": 3, "name": "t2_VM3", "vcpu": 2, "vmif": "t2VM3if1"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, {"tenant_ns_if": "t2ns2if", "tenant_ns_ip": "10.1.12.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s2if", "tenant_sub_ip": "10.1.12.2/24"}], "rc": 0, "start": "2019-11-18 03:57:44.387146", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Add IP addresses to Namespace VETH Pairs] *************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.11.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.1.11.1', u'bridge_name': u't2br1', u'dns': [{u'dnsif': u't2s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't2s1_dnsbrif'}], u'ns_name': u't2ns1', u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't2_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't2br1if1', u'vmif': u't2VM1if1'}, {u'mem': 4, u'name': u't2_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't2br1if2', u'vmif': u't2VM2if1'}], u'vxlan': [{u'local_ip': u'10.1.11.2', u'dsport': 4789, u'dev': u't2s1if', u'tenant_route_ip': u'192.168.2.2', u'remote_route': u'10.2.11.0/24', u'subnet_route': u'10.1.11.0/24', u'v_name': u'vxlan_t2s1', u'id': 42, u'remote_ip': u'10.2.11.2'}]}, {u'tenant_sub_ip': u'10.1.11.2/24', u'tenant_ns_ip': u'10.1.11.1/24', u'tenant_ns_if': u't2ns1if', u'tenant_sub_if': u't2s1if', u'tenant_ns_name': u't2'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t2ns1\" ip addr show \"t2s1if\" | awk 'FNR==3{ print $2 }' | grep -w '^10.1.11.2/24' ; if [ $? -ne 0 ] ; then ip netns exec \"t2ns1\" ip addr add \"10.1.11.2/24\" dev \"t2s1if\" ; fi\n\nip netns exec \"t2\" ip addr show \"t2ns1if\" | awk 'FNR==3{ print $2 }' | grep -w '^10.1.11.1/24' ; if [ $? -ne 0 ] ; then ip netns exec \"t2\" ip addr add \"10.1.11.1/24\" dev \"t2ns1if\" ; fi\n", "delta": "0:00:00.135532", "end": "2019-11-18 03:57:44.879784", "item": [{"bridge_name": "t2br1", "default_route_ip": "10.1.11.1", "dns": [{"brif": "t2s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t2s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns1", "route": [{"if": "p1", "ip": "10.1.11.1/24", "ns_if": "t2if", "ns_name": "t2"}], "subnet_ip": "1.1.1.0/24", "vms": [{"brif": "t2br1if1", "disk": "10G", "mem": 2, "name": "t2_VM1", "vcpu": 4, "vmif": "t2VM1if1"}, {"brif": "t2br1if2", "disk": "10G", "mem": 4, "name": "t2_VM2", "vcpu": 2, "vmif": "t2VM2if1"}], "vxlan": [{"dev": "t2s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.11.2", "remote_ip": "10.2.11.2", "remote_route": "10.2.11.0/24", "subnet_route": "10.1.11.0/24", "tenant_route_ip": "192.168.2.2", "v_name": "vxlan_t2s1"}]}, {"tenant_ns_if": "t2ns1if", "tenant_ns_ip": "10.1.11.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s1if", "tenant_sub_ip": "10.1.11.2/24"}], "rc": 0, "start": "2019-11-18 03:57:44.744252", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.12.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.1.12.1', u'bridge_name': u't2br2', u'dns': [{u'dnsif': u't2s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't2s2_dnsbrif'}], u'ns_name': u't2ns2', u'subnet_ip': u'2.2.2.0/24', u'vms': [{u'mem': 3, u'name': u't2_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't2br2if1', u'vmif': u't2VM3if1'}], u'vxlan': [{u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}, {u'tenant_sub_ip': u'10.1.12.2/24', u'tenant_ns_ip': u'10.1.12.1/24', u'tenant_ns_if': u't2ns2if', u'tenant_sub_if': u't2s2if', u'tenant_ns_name': u't2'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t2ns2\" ip addr show \"t2s2if\" | awk 'FNR==3{ print $2 }' | grep -w '^10.1.12.2/24' ; if [ $? -ne 0 ] ; then ip netns exec \"t2ns2\" ip addr add \"10.1.12.2/24\" dev \"t2s2if\" ; fi\n\nip netns exec \"t2\" ip addr show \"t2ns2if\" | awk 'FNR==3{ print $2 }' | grep -w '^10.1.12.1/24' ; if [ $? -ne 0 ] ; then ip netns exec \"t2\" ip addr add \"10.1.12.1/24\" dev \"t2ns2if\" ; fi\n", "delta": "0:00:00.137262", "end": "2019-11-18 03:57:45.203709", "item": [{"bridge_name": "t2br2", "default_route_ip": "10.1.12.1", "dns": [{"brif": "t2s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t2s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns2", "route": [{"if": "p1", "ip": "10.1.12.1/24", "ns_if": "t2if", "ns_name": "t2"}], "subnet_ip": "2.2.2.0/24", "vms": [{"brif": "t2br2if1", "disk": "10G", "mem": 3, "name": "t2_VM3", "vcpu": 2, "vmif": "t2VM3if1"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, {"tenant_ns_if": "t2ns2if", "tenant_ns_ip": "10.1.12.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s2if", "tenant_sub_ip": "10.1.12.2/24"}], "rc": 0, "start": "2019-11-18 03:57:45.066447", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Add IP Route to Tenant] *******************************************************************************************************************************
changed: [localhost] => (item={u'default_route_ip': u'192.168.2.1', u'name': u't2', u'pns_ip': u'192.168.2.1/24', u'tenant_if': u't2if', u'tenant_ip': u'192.168.2.2/24', u'pns_if': u't2pns_if'}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t2\" ip route show default | grep -w '[d]efault via 192.168.2.1' ; if [ $? -ne 0 ] ; then ip netns exec \"t2\" ip route add default via \"192.168.2.1\" ; fi\n", "delta": "0:00:00.080029", "end": "2019-11-18 03:57:45.539799", "item": {"default_route_ip": "192.168.2.1", "name": "t2", "pns_if": "t2pns_if", "pns_ip": "192.168.2.1/24", "tenant_if": "t2if", "tenant_ip": "192.168.2.2/24"}, "rc": 0, "start": "2019-11-18 03:57:45.459770", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Add IP Route to Tenant Subnet] ************************************************************************************************************************
changed: [localhost] => (item={u'route': [{u'ip': u'10.1.11.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.1.11.1', u'bridge_name': u't2br1', u'dns': [{u'dnsif': u't2s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't2s1_dnsbrif'}], u'ns_name': u't2ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.11.2/24', u'tenant_ns_ip': u'10.1.11.1/24', u'tenant_ns_if': u't2ns1if', u'tenant_ns_name': u't2', u'tenant_sub_if': u't2s1if'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't2_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't2br1if1', u'vmif': u't2VM1if1'}, {u'mem': 4, u'name': u't2_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't2br1if2', u'vmif': u't2VM2if1'}], u'vxlan': [{u'local_ip': u'10.1.11.2', u'tenant_route_ip': u'192.168.2.2', u'dsport': 4789, u'dev': u't2s1if', u'subnet_route': u'10.1.11.0/24', u'remote_route': u'10.2.11.0/24', u'v_name': u'vxlan_t2s1', u'id': 42, u'remote_ip': u'10.2.11.2'}]}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t2ns1\" ip route show default | grep -w '[d]efault via 10.1.11.1' ; if [ $? -ne 0 ] ; then ip netns exec \"t2ns1\" ip route add default via \"10.1.11.1\" ; fi\n", "delta": "0:00:00.106347", "end": "2019-11-18 03:57:45.924126", "item": {"bridge_name": "t2br1", "default_route_ip": "10.1.11.1", "dns": [{"brif": "t2s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t2s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns1", "route": [{"if": "p1", "ip": "10.1.11.1/24", "ns_if": "t2if", "ns_name": "t2"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t2ns1if", "tenant_ns_ip": "10.1.11.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s1if", "tenant_sub_ip": "10.1.11.2/24"}], "vms": [{"brif": "t2br1if1", "disk": "10G", "mem": 2, "name": "t2_VM1", "vcpu": 4, "vmif": "t2VM1if1"}, {"brif": "t2br1if2", "disk": "10G", "mem": 4, "name": "t2_VM2", "vcpu": 2, "vmif": "t2VM2if1"}], "vxlan": [{"dev": "t2s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.11.2", "remote_ip": "10.2.11.2", "remote_route": "10.2.11.0/24", "subnet_route": "10.1.11.0/24", "tenant_route_ip": "192.168.2.2", "v_name": "vxlan_t2s1"}]}, "rc": 0, "start": "2019-11-18 03:57:45.817779", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}
changed: [localhost] => (item={u'route': [{u'ip': u'10.1.12.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.1.12.1', u'bridge_name': u't2br2', u'dns': [{u'dnsif': u't2s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't2s2_dnsbrif'}], u'ns_name': u't2ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.12.2/24', u'tenant_ns_ip': u'10.1.12.1/24', u'tenant_ns_if': u't2ns2if', u'tenant_ns_name': u't2', u'tenant_sub_if': u't2s2if'}], u'subnet_ip': u'2.2.2.0/24', u'vms': [{u'mem': 3, u'name': u't2_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't2br2if1', u'vmif': u't2VM3if1'}], u'vxlan': [{u'local_ip': [], u'tenant_route_ip': [], u'dsport': [], u'dev': [], u'subnet_route': [], u'remote_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t2ns2\" ip route show default | grep -w '[d]efault via 10.1.12.1' ; if [ $? -ne 0 ] ; then ip netns exec \"t2ns2\" ip route add default via \"10.1.12.1\" ; fi\n", "delta": "0:00:00.076591", "end": "2019-11-18 03:57:46.219959", "item": {"bridge_name": "t2br2", "default_route_ip": "10.1.12.1", "dns": [{"brif": "t2s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t2s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns2", "route": [{"if": "p1", "ip": "10.1.12.1/24", "ns_if": "t2if", "ns_name": "t2"}], "subnet_ip": "2.2.2.0/24", "tenant_ns": [{"tenant_ns_if": "t2ns2if", "tenant_ns_ip": "10.1.12.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s2if", "tenant_sub_ip": "10.1.12.2/24"}], "vms": [{"brif": "t2br2if1", "disk": "10G", "mem": 3, "name": "t2_VM3", "vcpu": 2, "vmif": "t2VM3if1"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, "rc": 0, "start": "2019-11-18 03:57:46.143368", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Create bridge inside namespace] ***********************************************************************************************************************
changed: [localhost] => (item={u'route': [{u'ip': u'10.1.11.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.1.11.1', u'bridge_name': u't2br1', u'dns': [{u'dnsif': u't2s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't2s1_dnsbrif'}], u'ns_name': u't2ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.11.2/24', u'tenant_ns_ip': u'10.1.11.1/24', u'tenant_ns_if': u't2ns1if', u'tenant_ns_name': u't2', u'tenant_sub_if': u't2s1if'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't2_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't2br1if1', u'vmif': u't2VM1if1'}, {u'mem': 4, u'name': u't2_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't2br1if2', u'vmif': u't2VM2if1'}], u'vxlan': [{u'local_ip': u'10.1.11.2', u'tenant_route_ip': u'192.168.2.2', u'dsport': 4789, u'dev': u't2s1if', u'subnet_route': u'10.1.11.0/24', u'remote_route': u'10.2.11.0/24', u'v_name': u'vxlan_t2s1', u'id': 42, u'remote_ip': u'10.2.11.2'}]}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t2ns1\" brctl show | grep -w '^t2br1'; if [ $? -ne 0 ] ; then ip netns exec \"t2ns1\" brctl addbr \"t2br1\" ; fi\nip netns exec \"t2ns1\" ip link set dev \"t2br1\" up\n", "delta": "0:00:00.107545", "end": "2019-11-18 03:57:46.611981", "item": {"bridge_name": "t2br1", "default_route_ip": "10.1.11.1", "dns": [{"brif": "t2s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t2s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns1", "route": [{"if": "p1", "ip": "10.1.11.1/24", "ns_if": "t2if", "ns_name": "t2"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t2ns1if", "tenant_ns_ip": "10.1.11.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s1if", "tenant_sub_ip": "10.1.11.2/24"}], "vms": [{"brif": "t2br1if1", "disk": "10G", "mem": 2, "name": "t2_VM1", "vcpu": 4, "vmif": "t2VM1if1"}, {"brif": "t2br1if2", "disk": "10G", "mem": 4, "name": "t2_VM2", "vcpu": 2, "vmif": "t2VM2if1"}], "vxlan": [{"dev": "t2s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.11.2", "remote_ip": "10.2.11.2", "remote_route": "10.2.11.0/24", "subnet_route": "10.1.11.0/24", "tenant_route_ip": "192.168.2.2", "v_name": "vxlan_t2s1"}]}, "rc": 0, "start": "2019-11-18 03:57:46.504436", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}
changed: [localhost] => (item={u'route': [{u'ip': u'10.1.12.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.1.12.1', u'bridge_name': u't2br2', u'dns': [{u'dnsif': u't2s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't2s2_dnsbrif'}], u'ns_name': u't2ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.12.2/24', u'tenant_ns_ip': u'10.1.12.1/24', u'tenant_ns_if': u't2ns2if', u'tenant_ns_name': u't2', u'tenant_sub_if': u't2s2if'}], u'subnet_ip': u'2.2.2.0/24', u'vms': [{u'mem': 3, u'name': u't2_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't2br2if1', u'vmif': u't2VM3if1'}], u'vxlan': [{u'local_ip': [], u'tenant_route_ip': [], u'dsport': [], u'dev': [], u'subnet_route': [], u'remote_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t2ns2\" brctl show | grep -w '^t2br2'; if [ $? -ne 0 ] ; then ip netns exec \"t2ns2\" brctl addbr \"t2br2\" ; fi\nip netns exec \"t2ns2\" ip link set dev \"t2br2\" up\n", "delta": "0:00:00.105463", "end": "2019-11-18 03:57:46.939896", "item": {"bridge_name": "t2br2", "default_route_ip": "10.1.12.1", "dns": [{"brif": "t2s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t2s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns2", "route": [{"if": "p1", "ip": "10.1.12.1/24", "ns_if": "t2if", "ns_name": "t2"}], "subnet_ip": "2.2.2.0/24", "tenant_ns": [{"tenant_ns_if": "t2ns2if", "tenant_ns_ip": "10.1.12.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s2if", "tenant_sub_ip": "10.1.12.2/24"}], "vms": [{"brif": "t2br2if1", "disk": "10G", "mem": 3, "name": "t2_VM3", "vcpu": 2, "vmif": "t2VM3if1"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, "rc": 0, "start": "2019-11-18 03:57:46.834433", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Create DNS VETH Pair] *********************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.11.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.1.11.1', u'bridge_name': u't2br1', u'ns_name': u't2ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.11.2/24', u'tenant_ns_ip': u'10.1.11.1/24', u'tenant_ns_if': u't2ns1if', u'tenant_sub_if': u't2s1if', u'tenant_ns_name': u't2'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't2_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't2br1if1', u'vmif': u't2VM1if1'}, {u'mem': 4, u'name': u't2_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't2br1if2', u'vmif': u't2VM2if1'}], u'vxlan': [{u'local_ip': u'10.1.11.2', u'dsport': 4789, u'dev': u't2s1if', u'tenant_route_ip': u'192.168.2.2', u'remote_route': u'10.2.11.0/24', u'subnet_route': u'10.1.11.0/24', u'v_name': u'vxlan_t2s1', u'id': 42, u'remote_ip': u'10.2.11.2'}]}, {u'dnsif': u't2s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't2s1_dnsbrif'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t2ns1\" ip link show \"t2s1_dnsbrif\" ; if [ $? -ne 0 ] ; then ip netns exec \"t2ns1\" ip link add \"t2s1_dnsbrif\" type veth peer name \"t2s1_dnsif\" ; fi\nip netns exec \"t2ns1\" ip link set dev \"t2s1_dnsbrif\" up\nip netns exec \"t2ns1\" ip link set dev \"t2s1_dnsif\" up\n", "delta": "0:00:00.140525", "end": "2019-11-18 03:57:47.367975", "item": [{"bridge_name": "t2br1", "default_route_ip": "10.1.11.1", "ns_name": "t2ns1", "route": [{"if": "p1", "ip": "10.1.11.1/24", "ns_if": "t2if", "ns_name": "t2"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t2ns1if", "tenant_ns_ip": "10.1.11.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s1if", "tenant_sub_ip": "10.1.11.2/24"}], "vms": [{"brif": "t2br1if1", "disk": "10G", "mem": 2, "name": "t2_VM1", "vcpu": 4, "vmif": "t2VM1if1"}, {"brif": "t2br1if2", "disk": "10G", "mem": 4, "name": "t2_VM2", "vcpu": 2, "vmif": "t2VM2if1"}], "vxlan": [{"dev": "t2s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.11.2", "remote_ip": "10.2.11.2", "remote_route": "10.2.11.0/24", "subnet_route": "10.1.11.0/24", "tenant_route_ip": "192.168.2.2", "v_name": "vxlan_t2s1"}]}, {"brif": "t2s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t2s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "rc": 0, "start": "2019-11-18 03:57:47.227450", "stderr": "Device \"t2s1_dnsbrif\" does not exist.", "stderr_lines": ["Device \"t2s1_dnsbrif\" does not exist."], "stdout": "", "stdout_lines": []}
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.12.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.1.12.1', u'bridge_name': u't2br2', u'ns_name': u't2ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.12.2/24', u'tenant_ns_ip': u'10.1.12.1/24', u'tenant_ns_if': u't2ns2if', u'tenant_sub_if': u't2s2if', u'tenant_ns_name': u't2'}], u'subnet_ip': u'2.2.2.0/24', u'vms': [{u'mem': 3, u'name': u't2_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't2br2if1', u'vmif': u't2VM3if1'}], u'vxlan': [{u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}, {u'dnsif': u't2s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't2s2_dnsbrif'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t2ns2\" ip link show \"t2s2_dnsbrif\" ; if [ $? -ne 0 ] ; then ip netns exec \"t2ns2\" ip link add \"t2s2_dnsbrif\" type veth peer name \"t2s2_dnsif\" ; fi\nip netns exec \"t2ns2\" ip link set dev \"t2s2_dnsbrif\" up\nip netns exec \"t2ns2\" ip link set dev \"t2s2_dnsif\" up\n", "delta": "0:00:00.155629", "end": "2019-11-18 03:57:47.747821", "item": [{"bridge_name": "t2br2", "default_route_ip": "10.1.12.1", "ns_name": "t2ns2", "route": [{"if": "p1", "ip": "10.1.12.1/24", "ns_if": "t2if", "ns_name": "t2"}], "subnet_ip": "2.2.2.0/24", "tenant_ns": [{"tenant_ns_if": "t2ns2if", "tenant_ns_ip": "10.1.12.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s2if", "tenant_sub_ip": "10.1.12.2/24"}], "vms": [{"brif": "t2br2if1", "disk": "10G", "mem": 3, "name": "t2_VM3", "vcpu": 2, "vmif": "t2VM3if1"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, {"brif": "t2s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t2s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "rc": 0, "start": "2019-11-18 03:57:47.592192", "stderr": "Device \"t2s2_dnsbrif\" does not exist.", "stderr_lines": ["Device \"t2s2_dnsbrif\" does not exist."], "stdout": "", "stdout_lines": []}

TASK [Attach DNS VETH Pair] *********************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.11.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.1.11.1', u'bridge_name': u't2br1', u'ns_name': u't2ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.11.2/24', u'tenant_ns_ip': u'10.1.11.1/24', u'tenant_ns_if': u't2ns1if', u'tenant_sub_if': u't2s1if', u'tenant_ns_name': u't2'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't2_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't2br1if1', u'vmif': u't2VM1if1'}, {u'mem': 4, u'name': u't2_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't2br1if2', u'vmif': u't2VM2if1'}], u'vxlan': [{u'local_ip': u'10.1.11.2', u'dsport': 4789, u'dev': u't2s1if', u'tenant_route_ip': u'192.168.2.2', u'remote_route': u'10.2.11.0/24', u'subnet_route': u'10.1.11.0/24', u'v_name': u'vxlan_t2s1', u'id': 42, u'remote_ip': u'10.2.11.2'}]}, {u'dnsif': u't2s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't2s1_dnsbrif'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t2ns1\" brctl show \"t2br1\" | grep -w 't2s1_dnsbrif' ; if [ $? -ne 0 ] ; then ip netns exec \"t2ns1\" brctl addif \"t2br1\" \"t2s1_dnsbrif\" ; fi\n", "delta": "0:00:00.088116", "end": "2019-11-18 03:57:48.099778", "item": [{"bridge_name": "t2br1", "default_route_ip": "10.1.11.1", "ns_name": "t2ns1", "route": [{"if": "p1", "ip": "10.1.11.1/24", "ns_if": "t2if", "ns_name": "t2"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t2ns1if", "tenant_ns_ip": "10.1.11.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s1if", "tenant_sub_ip": "10.1.11.2/24"}], "vms": [{"brif": "t2br1if1", "disk": "10G", "mem": 2, "name": "t2_VM1", "vcpu": 4, "vmif": "t2VM1if1"}, {"brif": "t2br1if2", "disk": "10G", "mem": 4, "name": "t2_VM2", "vcpu": 2, "vmif": "t2VM2if1"}], "vxlan": [{"dev": "t2s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.11.2", "remote_ip": "10.2.11.2", "remote_route": "10.2.11.0/24", "subnet_route": "10.1.11.0/24", "tenant_route_ip": "192.168.2.2", "v_name": "vxlan_t2s1"}]}, {"brif": "t2s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t2s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "rc": 0, "start": "2019-11-18 03:57:48.011662", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.12.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.1.12.1', u'bridge_name': u't2br2', u'ns_name': u't2ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.12.2/24', u'tenant_ns_ip': u'10.1.12.1/24', u'tenant_ns_if': u't2ns2if', u'tenant_sub_if': u't2s2if', u'tenant_ns_name': u't2'}], u'subnet_ip': u'2.2.2.0/24', u'vms': [{u'mem': 3, u'name': u't2_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't2br2if1', u'vmif': u't2VM3if1'}], u'vxlan': [{u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}, {u'dnsif': u't2s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't2s2_dnsbrif'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t2ns2\" brctl show \"t2br2\" | grep -w 't2s2_dnsbrif' ; if [ $? -ne 0 ] ; then ip netns exec \"t2ns2\" brctl addif \"t2br2\" \"t2s2_dnsbrif\" ; fi\n", "delta": "0:00:00.083276", "end": "2019-11-18 03:57:48.379689", "item": [{"bridge_name": "t2br2", "default_route_ip": "10.1.12.1", "ns_name": "t2ns2", "route": [{"if": "p1", "ip": "10.1.12.1/24", "ns_if": "t2if", "ns_name": "t2"}], "subnet_ip": "2.2.2.0/24", "tenant_ns": [{"tenant_ns_if": "t2ns2if", "tenant_ns_ip": "10.1.12.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s2if", "tenant_sub_ip": "10.1.12.2/24"}], "vms": [{"brif": "t2br2if1", "disk": "10G", "mem": 3, "name": "t2_VM3", "vcpu": 2, "vmif": "t2VM3if1"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, {"brif": "t2s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t2s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "rc": 0, "start": "2019-11-18 03:57:48.296413", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Create VETH Pairs] ************************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.11.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.1.11.1', u'bridge_name': u't2br1', u'dns': [{u'dnsif': u't2s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't2s1_dnsbrif'}], u'ns_name': u't2ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.11.2/24', u'tenant_ns_ip': u'10.1.11.1/24', u'tenant_ns_if': u't2ns1if', u'tenant_sub_if': u't2s1if', u'tenant_ns_name': u't2'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.1.11.2', u'dsport': 4789, u'dev': u't2s1if', u'tenant_route_ip': u'192.168.2.2', u'remote_route': u'10.2.11.0/24', u'subnet_route': u'10.1.11.0/24', u'v_name': u'vxlan_t2s1', u'id': 42, u'remote_ip': u'10.2.11.2'}]}, {u'mem': 2, u'name': u't2_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't2br1if1', u'vmif': u't2VM1if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip link show \"t2br1if1\" ; if [ $? -ne 0 ] ; then ip link add \"t2VM1if1\" type veth peer name \"t2br1if1\" ; fi\nip link set dev \"t2br1if1\" up\nip link set dev \"t2VM1if1\" up\n", "delta": "0:00:00.017928", "end": "2019-11-18 03:57:48.654016", "item": [{"bridge_name": "t2br1", "default_route_ip": "10.1.11.1", "dns": [{"brif": "t2s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t2s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns1", "route": [{"if": "p1", "ip": "10.1.11.1/24", "ns_if": "t2if", "ns_name": "t2"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t2ns1if", "tenant_ns_ip": "10.1.11.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s1if", "tenant_sub_ip": "10.1.11.2/24"}], "vxlan": [{"dev": "t2s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.11.2", "remote_ip": "10.2.11.2", "remote_route": "10.2.11.0/24", "subnet_route": "10.1.11.0/24", "tenant_route_ip": "192.168.2.2", "v_name": "vxlan_t2s1"}]}, {"brif": "t2br1if1", "disk": "10G", "mem": 2, "name": "t2_VM1", "vcpu": 4, "vmif": "t2VM1if1"}], "rc": 0, "start": "2019-11-18 03:57:48.636088", "stderr": "Device \"t2br1if1\" does not exist.", "stderr_lines": ["Device \"t2br1if1\" does not exist."], "stdout": "", "stdout_lines": []}
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.11.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.1.11.1', u'bridge_name': u't2br1', u'dns': [{u'dnsif': u't2s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't2s1_dnsbrif'}], u'ns_name': u't2ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.11.2/24', u'tenant_ns_ip': u'10.1.11.1/24', u'tenant_ns_if': u't2ns1if', u'tenant_sub_if': u't2s1if', u'tenant_ns_name': u't2'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.1.11.2', u'dsport': 4789, u'dev': u't2s1if', u'tenant_route_ip': u'192.168.2.2', u'remote_route': u'10.2.11.0/24', u'subnet_route': u'10.1.11.0/24', u'v_name': u'vxlan_t2s1', u'id': 42, u'remote_ip': u'10.2.11.2'}]}, {u'mem': 4, u'name': u't2_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't2br1if2', u'vmif': u't2VM2if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip link show \"t2br1if2\" ; if [ $? -ne 0 ] ; then ip link add \"t2VM2if1\" type veth peer name \"t2br1if2\" ; fi\nip link set dev \"t2br1if2\" up\nip link set dev \"t2VM2if1\" up\n", "delta": "0:00:00.011622", "end": "2019-11-18 03:57:48.892983", "item": [{"bridge_name": "t2br1", "default_route_ip": "10.1.11.1", "dns": [{"brif": "t2s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t2s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns1", "route": [{"if": "p1", "ip": "10.1.11.1/24", "ns_if": "t2if", "ns_name": "t2"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t2ns1if", "tenant_ns_ip": "10.1.11.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s1if", "tenant_sub_ip": "10.1.11.2/24"}], "vxlan": [{"dev": "t2s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.11.2", "remote_ip": "10.2.11.2", "remote_route": "10.2.11.0/24", "subnet_route": "10.1.11.0/24", "tenant_route_ip": "192.168.2.2", "v_name": "vxlan_t2s1"}]}, {"brif": "t2br1if2", "disk": "10G", "mem": 4, "name": "t2_VM2", "vcpu": 2, "vmif": "t2VM2if1"}], "rc": 0, "start": "2019-11-18 03:57:48.881361", "stderr": "Device \"t2br1if2\" does not exist.", "stderr_lines": ["Device \"t2br1if2\" does not exist."], "stdout": "", "stdout_lines": []}
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.12.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.1.12.1', u'bridge_name': u't2br2', u'dns': [{u'dnsif': u't2s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't2s2_dnsbrif'}], u'ns_name': u't2ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.12.2/24', u'tenant_ns_ip': u'10.1.12.1/24', u'tenant_ns_if': u't2ns2if', u'tenant_sub_if': u't2s2if', u'tenant_ns_name': u't2'}], u'subnet_ip': u'2.2.2.0/24', u'vxlan': [{u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}, {u'mem': 3, u'name': u't2_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't2br2if1', u'vmif': u't2VM3if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip link show \"t2br2if1\" ; if [ $? -ne 0 ] ; then ip link add \"t2VM3if1\" type veth peer name \"t2br2if1\" ; fi\nip link set dev \"t2br2if1\" up\nip link set dev \"t2VM3if1\" up\n", "delta": "0:00:00.013629", "end": "2019-11-18 03:57:49.135662", "item": [{"bridge_name": "t2br2", "default_route_ip": "10.1.12.1", "dns": [{"brif": "t2s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t2s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns2", "route": [{"if": "p1", "ip": "10.1.12.1/24", "ns_if": "t2if", "ns_name": "t2"}], "subnet_ip": "2.2.2.0/24", "tenant_ns": [{"tenant_ns_if": "t2ns2if", "tenant_ns_ip": "10.1.12.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s2if", "tenant_sub_ip": "10.1.12.2/24"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, {"brif": "t2br2if1", "disk": "10G", "mem": 3, "name": "t2_VM3", "vcpu": 2, "vmif": "t2VM3if1"}], "rc": 0, "start": "2019-11-18 03:57:49.122033", "stderr": "Device \"t2br2if1\" does not exist.", "stderr_lines": ["Device \"t2br2if1\" does not exist."], "stdout": "", "stdout_lines": []}

TASK [Attach VETH Pairs] ************************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.11.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.1.11.1', u'bridge_name': u't2br1', u'dns': [{u'dnsif': u't2s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't2s1_dnsbrif'}], u'ns_name': u't2ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.11.2/24', u'tenant_ns_ip': u'10.1.11.1/24', u'tenant_ns_if': u't2ns1if', u'tenant_sub_if': u't2s1if', u'tenant_ns_name': u't2'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.1.11.2', u'dsport': 4789, u'dev': u't2s1if', u'tenant_route_ip': u'192.168.2.2', u'remote_route': u'10.2.11.0/24', u'subnet_route': u'10.1.11.0/24', u'v_name': u'vxlan_t2s1', u'id': 42, u'remote_ip': u'10.2.11.2'}]}, {u'mem': 2, u'name': u't2_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't2br1if1', u'vmif': u't2VM1if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip link show \"t2br1if1\" ; if [ $? -eq 0 ] ; then ip link set \"t2br1if1\" netns \"t2ns1\" ; fi\nip netns exec \"t2ns1\" brctl show \"t2br1\" | grep -w 't2br1if1' ; if [ $? -ne 0 ] ; then ip netns exec \"t2ns1\" brctl addif \"t2br1\" \"t2br1if1\" ; fi\n", "delta": "0:00:00.115203", "end": "2019-11-18 03:57:49.547910", "item": [{"bridge_name": "t2br1", "default_route_ip": "10.1.11.1", "dns": [{"brif": "t2s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t2s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns1", "route": [{"if": "p1", "ip": "10.1.11.1/24", "ns_if": "t2if", "ns_name": "t2"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t2ns1if", "tenant_ns_ip": "10.1.11.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s1if", "tenant_sub_ip": "10.1.11.2/24"}], "vxlan": [{"dev": "t2s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.11.2", "remote_ip": "10.2.11.2", "remote_route": "10.2.11.0/24", "subnet_route": "10.1.11.0/24", "tenant_route_ip": "192.168.2.2", "v_name": "vxlan_t2s1"}]}, {"brif": "t2br1if1", "disk": "10G", "mem": 2, "name": "t2_VM1", "vcpu": 4, "vmif": "t2VM1if1"}], "rc": 0, "start": "2019-11-18 03:57:49.432707", "stderr": "", "stderr_lines": [], "stdout": "35: t2br1if1@t2VM1if1: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP mode DEFAULT group default qlen 1000\n    link/ether 9e:9e:d1:38:bd:49 brd ff:ff:ff:ff:ff:ff", "stdout_lines": ["35: t2br1if1@t2VM1if1: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP mode DEFAULT group default qlen 1000", "    link/ether 9e:9e:d1:38:bd:49 brd ff:ff:ff:ff:ff:ff"]}
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.11.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.1.11.1', u'bridge_name': u't2br1', u'dns': [{u'dnsif': u't2s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't2s1_dnsbrif'}], u'ns_name': u't2ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.11.2/24', u'tenant_ns_ip': u'10.1.11.1/24', u'tenant_ns_if': u't2ns1if', u'tenant_sub_if': u't2s1if', u'tenant_ns_name': u't2'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.1.11.2', u'dsport': 4789, u'dev': u't2s1if', u'tenant_route_ip': u'192.168.2.2', u'remote_route': u'10.2.11.0/24', u'subnet_route': u'10.1.11.0/24', u'v_name': u'vxlan_t2s1', u'id': 42, u'remote_ip': u'10.2.11.2'}]}, {u'mem': 4, u'name': u't2_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't2br1if2', u'vmif': u't2VM2if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip link show \"t2br1if2\" ; if [ $? -eq 0 ] ; then ip link set \"t2br1if2\" netns \"t2ns1\" ; fi\nip netns exec \"t2ns1\" brctl show \"t2br1\" | grep -w 't2br1if2' ; if [ $? -ne 0 ] ; then ip netns exec \"t2ns1\" brctl addif \"t2br1\" \"t2br1if2\" ; fi\n", "delta": "0:00:00.120353", "end": "2019-11-18 03:57:49.903929", "item": [{"bridge_name": "t2br1", "default_route_ip": "10.1.11.1", "dns": [{"brif": "t2s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t2s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns1", "route": [{"if": "p1", "ip": "10.1.11.1/24", "ns_if": "t2if", "ns_name": "t2"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t2ns1if", "tenant_ns_ip": "10.1.11.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s1if", "tenant_sub_ip": "10.1.11.2/24"}], "vxlan": [{"dev": "t2s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.11.2", "remote_ip": "10.2.11.2", "remote_route": "10.2.11.0/24", "subnet_route": "10.1.11.0/24", "tenant_route_ip": "192.168.2.2", "v_name": "vxlan_t2s1"}]}, {"brif": "t2br1if2", "disk": "10G", "mem": 4, "name": "t2_VM2", "vcpu": 2, "vmif": "t2VM2if1"}], "rc": 0, "start": "2019-11-18 03:57:49.783576", "stderr": "", "stderr_lines": [], "stdout": "37: t2br1if2@t2VM2if1: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP mode DEFAULT group default qlen 1000\n    link/ether e6:99:0f:11:69:88 brd ff:ff:ff:ff:ff:ff", "stdout_lines": ["37: t2br1if2@t2VM2if1: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP mode DEFAULT group default qlen 1000", "    link/ether e6:99:0f:11:69:88 brd ff:ff:ff:ff:ff:ff"]}
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.12.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.1.12.1', u'bridge_name': u't2br2', u'dns': [{u'dnsif': u't2s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't2s2_dnsbrif'}], u'ns_name': u't2ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.12.2/24', u'tenant_ns_ip': u'10.1.12.1/24', u'tenant_ns_if': u't2ns2if', u'tenant_sub_if': u't2s2if', u'tenant_ns_name': u't2'}], u'subnet_ip': u'2.2.2.0/24', u'vxlan': [{u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}, {u'mem': 3, u'name': u't2_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't2br2if1', u'vmif': u't2VM3if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip link show \"t2br2if1\" ; if [ $? -eq 0 ] ; then ip link set \"t2br2if1\" netns \"t2ns2\" ; fi\nip netns exec \"t2ns2\" brctl show \"t2br2\" | grep -w 't2br2if1' ; if [ $? -ne 0 ] ; then ip netns exec \"t2ns2\" brctl addif \"t2br2\" \"t2br2if1\" ; fi\n", "delta": "0:00:00.124103", "end": "2019-11-18 03:57:50.251908", "item": [{"bridge_name": "t2br2", "default_route_ip": "10.1.12.1", "dns": [{"brif": "t2s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t2s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns2", "route": [{"if": "p1", "ip": "10.1.12.1/24", "ns_if": "t2if", "ns_name": "t2"}], "subnet_ip": "2.2.2.0/24", "tenant_ns": [{"tenant_ns_if": "t2ns2if", "tenant_ns_ip": "10.1.12.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s2if", "tenant_sub_ip": "10.1.12.2/24"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, {"brif": "t2br2if1", "disk": "10G", "mem": 3, "name": "t2_VM3", "vcpu": 2, "vmif": "t2VM3if1"}], "rc": 0, "start": "2019-11-18 03:57:50.127805", "stderr": "", "stderr_lines": [], "stdout": "39: t2br2if1@t2VM3if1: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP mode DEFAULT group default qlen 1000\n    link/ether 56:ce:bb:38:a4:cf brd ff:ff:ff:ff:ff:ff", "stdout_lines": ["39: t2br2if1@t2VM3if1: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP mode DEFAULT group default qlen 1000", "    link/ether 56:ce:bb:38:a4:cf brd ff:ff:ff:ff:ff:ff"]}

TASK [All interfaces and bridges UP] ************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.11.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.1.11.1', u'bridge_name': u't2br1', u'dns': [{u'dnsif': u't2s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't2s1_dnsbrif'}], u'ns_name': u't2ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.11.2/24', u'tenant_ns_ip': u'10.1.11.1/24', u'tenant_ns_if': u't2ns1if', u'tenant_sub_if': u't2s1if', u'tenant_ns_name': u't2'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.1.11.2', u'dsport': 4789, u'dev': u't2s1if', u'tenant_route_ip': u'192.168.2.2', u'remote_route': u'10.2.11.0/24', u'subnet_route': u'10.1.11.0/24', u'v_name': u'vxlan_t2s1', u'id': 42, u'remote_ip': u'10.2.11.2'}]}, {u'mem': 2, u'name': u't2_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't2br1if1', u'vmif': u't2VM1if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t2ns1\" ip link set \"t2br1if1\" up\nip netns exec \"t2ns1\" ip link set dev \"t2br1\" up\n", "delta": "0:00:00.090735", "end": "2019-11-18 03:57:50.635968", "item": [{"bridge_name": "t2br1", "default_route_ip": "10.1.11.1", "dns": [{"brif": "t2s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t2s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns1", "route": [{"if": "p1", "ip": "10.1.11.1/24", "ns_if": "t2if", "ns_name": "t2"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t2ns1if", "tenant_ns_ip": "10.1.11.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s1if", "tenant_sub_ip": "10.1.11.2/24"}], "vxlan": [{"dev": "t2s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.11.2", "remote_ip": "10.2.11.2", "remote_route": "10.2.11.0/24", "subnet_route": "10.1.11.0/24", "tenant_route_ip": "192.168.2.2", "v_name": "vxlan_t2s1"}]}, {"brif": "t2br1if1", "disk": "10G", "mem": 2, "name": "t2_VM1", "vcpu": 4, "vmif": "t2VM1if1"}], "rc": 0, "start": "2019-11-18 03:57:50.545233", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.11.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.1.11.1', u'bridge_name': u't2br1', u'dns': [{u'dnsif': u't2s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't2s1_dnsbrif'}], u'ns_name': u't2ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.11.2/24', u'tenant_ns_ip': u'10.1.11.1/24', u'tenant_ns_if': u't2ns1if', u'tenant_sub_if': u't2s1if', u'tenant_ns_name': u't2'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.1.11.2', u'dsport': 4789, u'dev': u't2s1if', u'tenant_route_ip': u'192.168.2.2', u'remote_route': u'10.2.11.0/24', u'subnet_route': u'10.1.11.0/24', u'v_name': u'vxlan_t2s1', u'id': 42, u'remote_ip': u'10.2.11.2'}]}, {u'mem': 4, u'name': u't2_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't2br1if2', u'vmif': u't2VM2if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t2ns1\" ip link set \"t2br1if2\" up\nip netns exec \"t2ns1\" ip link set dev \"t2br1\" up\n", "delta": "0:00:00.083564", "end": "2019-11-18 03:57:50.911698", "item": [{"bridge_name": "t2br1", "default_route_ip": "10.1.11.1", "dns": [{"brif": "t2s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t2s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns1", "route": [{"if": "p1", "ip": "10.1.11.1/24", "ns_if": "t2if", "ns_name": "t2"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t2ns1if", "tenant_ns_ip": "10.1.11.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s1if", "tenant_sub_ip": "10.1.11.2/24"}], "vxlan": [{"dev": "t2s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.11.2", "remote_ip": "10.2.11.2", "remote_route": "10.2.11.0/24", "subnet_route": "10.1.11.0/24", "tenant_route_ip": "192.168.2.2", "v_name": "vxlan_t2s1"}]}, {"brif": "t2br1if2", "disk": "10G", "mem": 4, "name": "t2_VM2", "vcpu": 2, "vmif": "t2VM2if1"}], "rc": 0, "start": "2019-11-18 03:57:50.828134", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.12.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.1.12.1', u'bridge_name': u't2br2', u'dns': [{u'dnsif': u't2s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't2s2_dnsbrif'}], u'ns_name': u't2ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.12.2/24', u'tenant_ns_ip': u'10.1.12.1/24', u'tenant_ns_if': u't2ns2if', u'tenant_sub_if': u't2s2if', u'tenant_ns_name': u't2'}], u'subnet_ip': u'2.2.2.0/24', u'vxlan': [{u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}, {u'mem': 3, u'name': u't2_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't2br2if1', u'vmif': u't2VM3if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t2ns2\" ip link set \"t2br2if1\" up\nip netns exec \"t2ns2\" ip link set dev \"t2br2\" up\n", "delta": "0:00:00.079391", "end": "2019-11-18 03:57:51.175829", "item": [{"bridge_name": "t2br2", "default_route_ip": "10.1.12.1", "dns": [{"brif": "t2s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t2s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns2", "route": [{"if": "p1", "ip": "10.1.12.1/24", "ns_if": "t2if", "ns_name": "t2"}], "subnet_ip": "2.2.2.0/24", "tenant_ns": [{"tenant_ns_if": "t2ns2if", "tenant_ns_ip": "10.1.12.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s2if", "tenant_sub_ip": "10.1.12.2/24"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, {"brif": "t2br2if1", "disk": "10G", "mem": 3, "name": "t2_VM3", "vcpu": 2, "vmif": "t2VM3if1"}], "rc": 0, "start": "2019-11-18 03:57:51.096438", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Add IP to DNS Interface] ******************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.11.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.1.11.1', u'bridge_name': u't2br1', u'ns_name': u't2ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.11.2/24', u'tenant_ns_ip': u'10.1.11.1/24', u'tenant_ns_if': u't2ns1if', u'tenant_sub_if': u't2s1if', u'tenant_ns_name': u't2'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't2_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't2br1if1', u'vmif': u't2VM1if1'}, {u'mem': 4, u'name': u't2_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't2br1if2', u'vmif': u't2VM2if1'}], u'vxlan': [{u'local_ip': u'10.1.11.2', u'dsport': 4789, u'dev': u't2s1if', u'tenant_route_ip': u'192.168.2.2', u'remote_route': u'10.2.11.0/24', u'subnet_route': u'10.1.11.0/24', u'v_name': u'vxlan_t2s1', u'id': 42, u'remote_ip': u'10.2.11.2'}]}, {u'dnsif': u't2s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't2s1_dnsbrif'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t2ns1\" ip addr show \"t2s1_dnsif\" | awk 'FNR==3{ print $2 }' | grep -w '^1.1.1.1/24' ; if [ $? -ne 0 ] ; then ip netns exec \"t2ns1\" ip addr add \"1.1.1.1/24\" dev \"t2s1_dnsif\" ; fi\n", "delta": "0:00:00.078493", "end": "2019-11-18 03:57:51.500021", "item": [{"bridge_name": "t2br1", "default_route_ip": "10.1.11.1", "ns_name": "t2ns1", "route": [{"if": "p1", "ip": "10.1.11.1/24", "ns_if": "t2if", "ns_name": "t2"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t2ns1if", "tenant_ns_ip": "10.1.11.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s1if", "tenant_sub_ip": "10.1.11.2/24"}], "vms": [{"brif": "t2br1if1", "disk": "10G", "mem": 2, "name": "t2_VM1", "vcpu": 4, "vmif": "t2VM1if1"}, {"brif": "t2br1if2", "disk": "10G", "mem": 4, "name": "t2_VM2", "vcpu": 2, "vmif": "t2VM2if1"}], "vxlan": [{"dev": "t2s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.11.2", "remote_ip": "10.2.11.2", "remote_route": "10.2.11.0/24", "subnet_route": "10.1.11.0/24", "tenant_route_ip": "192.168.2.2", "v_name": "vxlan_t2s1"}]}, {"brif": "t2s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t2s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "rc": 0, "start": "2019-11-18 03:57:51.421528", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.12.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.1.12.1', u'bridge_name': u't2br2', u'ns_name': u't2ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.12.2/24', u'tenant_ns_ip': u'10.1.12.1/24', u'tenant_ns_if': u't2ns2if', u'tenant_sub_if': u't2s2if', u'tenant_ns_name': u't2'}], u'subnet_ip': u'2.2.2.0/24', u'vms': [{u'mem': 3, u'name': u't2_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't2br2if1', u'vmif': u't2VM3if1'}], u'vxlan': [{u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}, {u'dnsif': u't2s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't2s2_dnsbrif'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t2ns2\" ip addr show \"t2s2_dnsif\" | awk 'FNR==3{ print $2 }' | grep -w '^2.2.2.1/24' ; if [ $? -ne 0 ] ; then ip netns exec \"t2ns2\" ip addr add \"2.2.2.1/24\" dev \"t2s2_dnsif\" ; fi\n", "delta": "0:00:00.076807", "end": "2019-11-18 03:57:51.771691", "item": [{"bridge_name": "t2br2", "default_route_ip": "10.1.12.1", "ns_name": "t2ns2", "route": [{"if": "p1", "ip": "10.1.12.1/24", "ns_if": "t2if", "ns_name": "t2"}], "subnet_ip": "2.2.2.0/24", "tenant_ns": [{"tenant_ns_if": "t2ns2if", "tenant_ns_ip": "10.1.12.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s2if", "tenant_sub_ip": "10.1.12.2/24"}], "vms": [{"brif": "t2br2if1", "disk": "10G", "mem": 3, "name": "t2_VM3", "vcpu": 2, "vmif": "t2VM3if1"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, {"brif": "t2s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t2s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "rc": 0, "start": "2019-11-18 03:57:51.694884", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Install DHCP Server] **********************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.11.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.1.11.1', u'bridge_name': u't2br1', u'ns_name': u't2ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.11.2/24', u'tenant_ns_ip': u'10.1.11.1/24', u'tenant_ns_if': u't2ns1if', u'tenant_sub_if': u't2s1if', u'tenant_ns_name': u't2'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't2_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't2br1if1', u'vmif': u't2VM1if1'}, {u'mem': 4, u'name': u't2_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't2br1if2', u'vmif': u't2VM2if1'}], u'vxlan': [{u'local_ip': u'10.1.11.2', u'dsport': 4789, u'dev': u't2s1if', u'tenant_route_ip': u'192.168.2.2', u'remote_route': u'10.2.11.0/24', u'subnet_route': u'10.1.11.0/24', u'v_name': u'vxlan_t2s1', u'id': 42, u'remote_ip': u'10.2.11.2'}]}, {u'dnsif': u't2s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't2s1_dnsbrif'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t2ns1\" ps aux | grep -w '[d]nsmasq --interface t2s1_dnsif -z --dhcp-range=1.1.1.5,1.1.1.126' ; if [ $? -ne 0 ] ; then ip netns exec \"t2ns1\" dnsmasq --interface \"t2s1_dnsif\" -z --dhcp-range=1.1.1.5,'1.1.1.126' ; fi\n", "delta": "0:00:00.065789", "end": "2019-11-18 03:57:52.108442", "item": [{"bridge_name": "t2br1", "default_route_ip": "10.1.11.1", "ns_name": "t2ns1", "route": [{"if": "p1", "ip": "10.1.11.1/24", "ns_if": "t2if", "ns_name": "t2"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t2ns1if", "tenant_ns_ip": "10.1.11.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s1if", "tenant_sub_ip": "10.1.11.2/24"}], "vms": [{"brif": "t2br1if1", "disk": "10G", "mem": 2, "name": "t2_VM1", "vcpu": 4, "vmif": "t2VM1if1"}, {"brif": "t2br1if2", "disk": "10G", "mem": 4, "name": "t2_VM2", "vcpu": 2, "vmif": "t2VM2if1"}], "vxlan": [{"dev": "t2s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.11.2", "remote_ip": "10.2.11.2", "remote_route": "10.2.11.0/24", "subnet_route": "10.1.11.0/24", "tenant_route_ip": "192.168.2.2", "v_name": "vxlan_t2s1"}]}, {"brif": "t2s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t2s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "rc": 0, "start": "2019-11-18 03:57:52.042653", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.12.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.1.12.1', u'bridge_name': u't2br2', u'ns_name': u't2ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.12.2/24', u'tenant_ns_ip': u'10.1.12.1/24', u'tenant_ns_if': u't2ns2if', u'tenant_sub_if': u't2s2if', u'tenant_ns_name': u't2'}], u'subnet_ip': u'2.2.2.0/24', u'vms': [{u'mem': 3, u'name': u't2_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't2br2if1', u'vmif': u't2VM3if1'}], u'vxlan': [{u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}, {u'dnsif': u't2s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't2s2_dnsbrif'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t2ns2\" ps aux | grep -w '[d]nsmasq --interface t2s2_dnsif -z --dhcp-range=2.2.2.5,2.2.2.254' ; if [ $? -ne 0 ] ; then ip netns exec \"t2ns2\" dnsmasq --interface \"t2s2_dnsif\" -z --dhcp-range=2.2.2.5,'2.2.2.254' ; fi\n", "delta": "0:00:00.069044", "end": "2019-11-18 03:57:52.363982", "item": [{"bridge_name": "t2br2", "default_route_ip": "10.1.12.1", "ns_name": "t2ns2", "route": [{"if": "p1", "ip": "10.1.12.1/24", "ns_if": "t2if", "ns_name": "t2"}], "subnet_ip": "2.2.2.0/24", "tenant_ns": [{"tenant_ns_if": "t2ns2if", "tenant_ns_ip": "10.1.12.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s2if", "tenant_sub_ip": "10.1.12.2/24"}], "vms": [{"brif": "t2br2if1", "disk": "10G", "mem": 3, "name": "t2_VM3", "vcpu": 2, "vmif": "t2VM3if1"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, {"brif": "t2s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t2s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "rc": 0, "start": "2019-11-18 03:57:52.294938", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Create VXLAN devices] *********************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.11.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.1.11.1', u'bridge_name': u't2br1', u'dns': [{u'dnsif': u't2s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't2s1_dnsbrif'}], u'ns_name': u't2ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.11.2/24', u'tenant_ns_ip': u'10.1.11.1/24', u'tenant_ns_if': u't2ns1if', u'tenant_sub_if': u't2s1if', u'tenant_ns_name': u't2'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't2_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't2br1if1', u'vmif': u't2VM1if1'}, {u'mem': 4, u'name': u't2_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't2br1if2', u'vmif': u't2VM2if1'}]}, {u'local_ip': u'10.1.11.2', u'dsport': 4789, u'dev': u't2s1if', u'tenant_route_ip': u'192.168.2.2', u'remote_route': u'10.2.11.0/24', u'subnet_route': u'10.1.11.0/24', u'v_name': u'vxlan_t2s1', u'id': 42, u'remote_ip': u'10.2.11.2'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t2ns1\" ip link show \"vxlan_t2s1\" ; if [ $? -ne 0 ] ; then ip netns exec \"t2ns1\" ip link add \"vxlan_t2s1\" type vxlan id \"42\" local \"10.1.11.2\" remote \"10.2.11.2\" dstport \"4789\" dev \"t2s1if\"; ip netns exec \"t2ns1\" ip link set dev \"vxlan_t2s1\" up ; fi\n", "delta": "0:00:00.118823", "end": "2019-11-18 03:57:52.747832", "item": [{"bridge_name": "t2br1", "default_route_ip": "10.1.11.1", "dns": [{"brif": "t2s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t2s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns1", "route": [{"if": "p1", "ip": "10.1.11.1/24", "ns_if": "t2if", "ns_name": "t2"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t2ns1if", "tenant_ns_ip": "10.1.11.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s1if", "tenant_sub_ip": "10.1.11.2/24"}], "vms": [{"brif": "t2br1if1", "disk": "10G", "mem": 2, "name": "t2_VM1", "vcpu": 4, "vmif": "t2VM1if1"}, {"brif": "t2br1if2", "disk": "10G", "mem": 4, "name": "t2_VM2", "vcpu": 2, "vmif": "t2VM2if1"}]}, {"dev": "t2s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.11.2", "remote_ip": "10.2.11.2", "remote_route": "10.2.11.0/24", "subnet_route": "10.1.11.0/24", "tenant_route_ip": "192.168.2.2", "v_name": "vxlan_t2s1"}], "rc": 0, "start": "2019-11-18 03:57:52.629009", "stderr": "Device \"vxlan_t2s1\" does not exist.", "stderr_lines": ["Device \"vxlan_t2s1\" does not exist."], "stdout": "", "stdout_lines": []}
skipping: [localhost] => (item=[{u'route': [{u'ip': u'10.1.12.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.1.12.1', u'bridge_name': u't2br2', u'dns': [{u'dnsif': u't2s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't2s2_dnsbrif'}], u'ns_name': u't2ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.12.2/24', u'tenant_ns_ip': u'10.1.12.1/24', u'tenant_ns_if': u't2ns2if', u'tenant_sub_if': u't2s2if', u'tenant_ns_name': u't2'}], u'subnet_ip': u'2.2.2.0/24', u'vms': [{u'mem': 3, u'name': u't2_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't2br2if1', u'vmif': u't2VM3if1'}]}, {u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}])  => {"ansible_loop_var": "item", "changed": false, "item": [{"bridge_name": "t2br2", "default_route_ip": "10.1.12.1", "dns": [{"brif": "t2s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t2s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns2", "route": [{"if": "p1", "ip": "10.1.12.1/24", "ns_if": "t2if", "ns_name": "t2"}], "subnet_ip": "2.2.2.0/24", "tenant_ns": [{"tenant_ns_if": "t2ns2if", "tenant_ns_ip": "10.1.12.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s2if", "tenant_sub_ip": "10.1.12.2/24"}], "vms": [{"brif": "t2br2if1", "disk": "10G", "mem": 3, "name": "t2_VM3", "vcpu": 2, "vmif": "t2VM3if1"}]}, {"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}], "skip_reason": "Conditional result was False"}

TASK [Attach VXLANs to bridge] ******************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.11.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.1.11.1', u'bridge_name': u't2br1', u'dns': [{u'dnsif': u't2s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't2s1_dnsbrif'}], u'ns_name': u't2ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.11.2/24', u'tenant_ns_ip': u'10.1.11.1/24', u'tenant_ns_if': u't2ns1if', u'tenant_sub_if': u't2s1if', u'tenant_ns_name': u't2'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't2_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't2br1if1', u'vmif': u't2VM1if1'}, {u'mem': 4, u'name': u't2_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't2br1if2', u'vmif': u't2VM2if1'}]}, {u'local_ip': u'10.1.11.2', u'dsport': 4789, u'dev': u't2s1if', u'tenant_route_ip': u'192.168.2.2', u'remote_route': u'10.2.11.0/24', u'subnet_route': u'10.1.11.0/24', u'v_name': u'vxlan_t2s1', u'id': 42, u'remote_ip': u'10.2.11.2'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t2ns1\" brctl show \"t2br1\" | grep -w 'vxlan_t2s1' ; if [ $? -ne 0 ] ; then ip netns exec \"t2ns1\" brctl addif \"t2br1\" \"vxlan_t2s1\" ; fi\n", "delta": "0:00:00.076990", "end": "2019-11-18 03:57:53.095733", "item": [{"bridge_name": "t2br1", "default_route_ip": "10.1.11.1", "dns": [{"brif": "t2s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t2s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns1", "route": [{"if": "p1", "ip": "10.1.11.1/24", "ns_if": "t2if", "ns_name": "t2"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t2ns1if", "tenant_ns_ip": "10.1.11.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s1if", "tenant_sub_ip": "10.1.11.2/24"}], "vms": [{"brif": "t2br1if1", "disk": "10G", "mem": 2, "name": "t2_VM1", "vcpu": 4, "vmif": "t2VM1if1"}, {"brif": "t2br1if2", "disk": "10G", "mem": 4, "name": "t2_VM2", "vcpu": 2, "vmif": "t2VM2if1"}]}, {"dev": "t2s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.11.2", "remote_ip": "10.2.11.2", "remote_route": "10.2.11.0/24", "subnet_route": "10.1.11.0/24", "tenant_route_ip": "192.168.2.2", "v_name": "vxlan_t2s1"}], "rc": 0, "start": "2019-11-18 03:57:53.018743", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}
skipping: [localhost] => (item=[{u'route': [{u'ip': u'10.1.12.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.1.12.1', u'bridge_name': u't2br2', u'dns': [{u'dnsif': u't2s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't2s2_dnsbrif'}], u'ns_name': u't2ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.12.2/24', u'tenant_ns_ip': u'10.1.12.1/24', u'tenant_ns_if': u't2ns2if', u'tenant_sub_if': u't2s2if', u'tenant_ns_name': u't2'}], u'subnet_ip': u'2.2.2.0/24', u'vms': [{u'mem': 3, u'name': u't2_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't2br2if1', u'vmif': u't2VM3if1'}]}, {u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}])  => {"ansible_loop_var": "item", "changed": false, "item": [{"bridge_name": "t2br2", "default_route_ip": "10.1.12.1", "dns": [{"brif": "t2s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t2s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns2", "route": [{"if": "p1", "ip": "10.1.12.1/24", "ns_if": "t2if", "ns_name": "t2"}], "subnet_ip": "2.2.2.0/24", "tenant_ns": [{"tenant_ns_if": "t2ns2if", "tenant_ns_ip": "10.1.12.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s2if", "tenant_sub_ip": "10.1.12.2/24"}], "vms": [{"brif": "t2br2if1", "disk": "10G", "mem": 3, "name": "t2_VM3", "vcpu": 2, "vmif": "t2VM3if1"}]}, {"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}], "skip_reason": "Conditional result was False"}

PLAY RECAP **************************************************************************************************************************************************
localhost                  : ok=21   changed=21   unreachable=0    failed=0    skipped=0    rescued=0    ignored=0   

Using /etc/ansible/ansible.cfg as config file

PLAY [worker] ***********************************************************************************************************************************************

TASK [Create Tenant Namespace] ******************************************************************************************************************************
changed: [99.99.99.2] => (item={u'default_route_ip': u'192.168.130.1', u'name': u't2', u'pns_ip': u'192.168.130.1/24', u'tenant_if': u't2if', u'tenant_ip': u'192.168.130.2/24', u'pns_if': u't2pns_if'}) => {"ansible_loop_var": "item", "changed": true, "cmd": ["ip", "netns", "add", "t2"], "delta": "0:00:00.066979", "end": "2019-11-18 03:57:54.967555", "item": {"default_route_ip": "192.168.130.1", "name": "t2", "pns_if": "t2pns_if", "pns_ip": "192.168.130.1/24", "tenant_if": "t2if", "tenant_ip": "192.168.130.2/24"}, "rc": 0, "start": "2019-11-18 03:57:54.900576", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Create Subnet Namespace] ******************************************************************************************************************************
changed: [99.99.99.2] => (item={u'route': [{u'ip': u'10.2.11.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.2.11.1', u'bridge_name': u't2br1', u'dns': [{u'dnsif': u't2s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't2s1_dnsbrif'}], u'ns_name': u't2ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.11.2/24', u'tenant_ns_ip': u'10.2.11.1/24', u'tenant_ns_if': u't2ns1if', u'tenant_ns_name': u't2', u'tenant_sub_if': u't2s1if'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't2_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't2br1if1', u'vmif': u't2VM4if1'}], u'vxlan': [{u'local_ip': u'10.2.11.2', u'tenant_route_ip': u'192.168.130.2', u'dsport': 4789, u'dev': u't2s1if', u'subnet_route': u'10.2.11.0/24', u'remote_route': u'10.1.11.0/24', u'v_name': u'vxlan_t2s1', u'id': 42, u'remote_ip': u'10.1.11.2'}]}) => {"ansible_loop_var": "item", "changed": true, "cmd": ["ip", "netns", "add", "t2ns1"], "delta": "0:00:00.062464", "end": "2019-11-18 03:57:55.412900", "item": {"bridge_name": "t2br1", "default_route_ip": "10.2.11.1", "dns": [{"brif": "t2s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t2s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns1", "route": [{"if": "p1", "ip": "10.2.11.1/24", "ns_if": "t2if", "ns_name": "t2"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t2ns1if", "tenant_ns_ip": "10.2.11.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s1if", "tenant_sub_ip": "10.2.11.2/24"}], "vms": [{"brif": "t2br1if1", "disk": "10G", "mem": 2, "name": "t2_VM4", "vcpu": 4, "vmif": "t2VM4if1"}], "vxlan": [{"dev": "t2s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.11.2", "remote_ip": "10.1.11.2", "remote_route": "10.1.11.0/24", "subnet_route": "10.2.11.0/24", "tenant_route_ip": "192.168.130.2", "v_name": "vxlan_t2s1"}]}, "rc": 0, "start": "2019-11-18 03:57:55.350436", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Create Tenant VETH pairs] *****************************************************************************************************************************
changed: [99.99.99.2] => (item={u'default_route_ip': u'192.168.130.1', u'name': u't2', u'pns_ip': u'192.168.130.1/24', u'tenant_if': u't2if', u'tenant_ip': u'192.168.130.2/24', u'pns_if': u't2pns_if'}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip link show \"t2if\" ; if [ $? -ne 0 ] ; then ip link add \"t2if\" type veth peer name \"t2pns_if\" ; fi\n", "delta": "0:00:00.009528", "end": "2019-11-18 03:57:55.806431", "item": {"default_route_ip": "192.168.130.1", "name": "t2", "pns_if": "t2pns_if", "pns_ip": "192.168.130.1/24", "tenant_if": "t2if", "tenant_ip": "192.168.130.2/24"}, "rc": 0, "start": "2019-11-18 03:57:55.796903", "stderr": "Device \"t2if\" does not exist.", "stderr_lines": ["Device \"t2if\" does not exist."], "stdout": "", "stdout_lines": []}

TASK [Attach Tenant VETH Pairs] *****************************************************************************************************************************
changed: [99.99.99.2] => (item={u'default_route_ip': u'192.168.130.1', u'name': u't2', u'pns_ip': u'192.168.130.1/24', u'tenant_if': u't2if', u'tenant_ip': u'192.168.130.2/24', u'pns_if': u't2pns_if'}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec pns ip link show \"t2pns_if\" ; if [ $? -ne 0 ] ; then ip link set \"t2pns_if\" netns pns ; fi\nip netns exec \"t2\" ip link show \"t2if\" ; if [ $? -ne 0 ] ; then ip link set \"t2if\" netns \"t2\" ; fi\nip netns exec pns ip link set dev \"t2pns_if\" up\nip netns exec \"t2\" ip link set dev \"t2if\" up\n", "delta": "0:00:00.191813", "end": "2019-11-18 03:57:56.367178", "item": {"default_route_ip": "192.168.130.1", "name": "t2", "pns_if": "t2pns_if", "pns_ip": "192.168.130.1/24", "tenant_if": "t2if", "tenant_ip": "192.168.130.2/24"}, "rc": 0, "start": "2019-11-18 03:57:56.175365", "stderr": "Device \"t2pns_if\" does not exist.\nDevice \"t2if\" does not exist.", "stderr_lines": ["Device \"t2pns_if\" does not exist.", "Device \"t2if\" does not exist."], "stdout": "", "stdout_lines": []}

TASK [Add IP addresses to Tenant VETH Pairs] ****************************************************************************************************************
changed: [99.99.99.2] => (item={u'default_route_ip': u'192.168.130.1', u'name': u't2', u'pns_ip': u'192.168.130.1/24', u'tenant_if': u't2if', u'tenant_ip': u'192.168.130.2/24', u'pns_if': u't2pns_if'}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec pns ip addr show \"t2pns_if\" | awk 'FNR==3{ print $2 }' | grep -w '^192.168.130.1/24' ; if [ $? -ne 0 ] ; then ip netns exec pns ip addr add \"192.168.130.1/24\" dev \"t2pns_if\" ; fi\nip netns exec \"t2\" ip addr show \"t2if\" | awk 'FNR==3{ print $2 }' | grep -w '^192.168.130.2/24' ; if [ $? -ne 0 ] ; then ip netns exec \"t2\" ip addr add \"192.168.130.2/24\" dev \"t2if\" ; fi\n", "delta": "0:00:00.164686", "end": "2019-11-18 03:57:56.910977", "item": {"default_route_ip": "192.168.130.1", "name": "t2", "pns_if": "t2pns_if", "pns_ip": "192.168.130.1/24", "tenant_if": "t2if", "tenant_ip": "192.168.130.2/24"}, "rc": 0, "start": "2019-11-18 03:57:56.746291", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Create Namespace VETH Pairs] **************************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.11.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.2.11.1', u'bridge_name': u't2br1', u'dns': [{u'dnsif': u't2s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't2s1_dnsbrif'}], u'ns_name': u't2ns1', u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't2_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't2br1if1', u'vmif': u't2VM4if1'}], u'vxlan': [{u'local_ip': u'10.2.11.2', u'dsport': 4789, u'dev': u't2s1if', u'tenant_route_ip': u'192.168.130.2', u'remote_route': u'10.1.11.0/24', u'subnet_route': u'10.2.11.0/24', u'v_name': u'vxlan_t2s1', u'id': 42, u'remote_ip': u'10.1.11.2'}]}, {u'tenant_sub_ip': u'10.2.11.2/24', u'tenant_ns_ip': u'10.2.11.1/24', u'tenant_ns_if': u't2ns1if', u'tenant_sub_if': u't2s1if', u'tenant_ns_name': u't2'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip link show \"t2ns1if\" ; if [ $? -ne 0 ] ; then ip link add \"t2ns1if\" type veth peer name \"t2s1if\" ; fi\n", "delta": "0:00:00.008677", "end": "2019-11-18 03:57:57.269713", "item": [{"bridge_name": "t2br1", "default_route_ip": "10.2.11.1", "dns": [{"brif": "t2s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t2s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns1", "route": [{"if": "p1", "ip": "10.2.11.1/24", "ns_if": "t2if", "ns_name": "t2"}], "subnet_ip": "1.1.1.0/24", "vms": [{"brif": "t2br1if1", "disk": "10G", "mem": 2, "name": "t2_VM4", "vcpu": 4, "vmif": "t2VM4if1"}], "vxlan": [{"dev": "t2s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.11.2", "remote_ip": "10.1.11.2", "remote_route": "10.1.11.0/24", "subnet_route": "10.2.11.0/24", "tenant_route_ip": "192.168.130.2", "v_name": "vxlan_t2s1"}]}, {"tenant_ns_if": "t2ns1if", "tenant_ns_ip": "10.2.11.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s1if", "tenant_sub_ip": "10.2.11.2/24"}], "rc": 0, "start": "2019-11-18 03:57:57.261036", "stderr": "Device \"t2ns1if\" does not exist.", "stderr_lines": ["Device \"t2ns1if\" does not exist."], "stdout": "", "stdout_lines": []}

TASK [Attach Namespace VETH Pairs] **************************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.11.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.2.11.1', u'bridge_name': u't2br1', u'dns': [{u'dnsif': u't2s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't2s1_dnsbrif'}], u'ns_name': u't2ns1', u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't2_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't2br1if1', u'vmif': u't2VM4if1'}], u'vxlan': [{u'local_ip': u'10.2.11.2', u'dsport': 4789, u'dev': u't2s1if', u'tenant_route_ip': u'192.168.130.2', u'remote_route': u'10.1.11.0/24', u'subnet_route': u'10.2.11.0/24', u'v_name': u'vxlan_t2s1', u'id': 42, u'remote_ip': u'10.1.11.2'}]}, {u'tenant_sub_ip': u'10.2.11.2/24', u'tenant_ns_ip': u'10.2.11.1/24', u'tenant_ns_if': u't2ns1if', u'tenant_sub_if': u't2s1if', u'tenant_ns_name': u't2'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t2\" ip link show \"t2ns1if\" ; if [ $? -ne 0 ] ; then ip link set \"t2ns1if\" netns \"t2\" ; fi\nip netns exec \"t2ns1\" ip link show \"t2s1if\" ; if [ $? -ne 0 ] ; then ip link set \"t2s1if\" netns \"t2ns1\" ; fi\n", "delta": "0:00:00.119639", "end": "2019-11-18 03:57:57.756519", "item": [{"bridge_name": "t2br1", "default_route_ip": "10.2.11.1", "dns": [{"brif": "t2s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t2s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns1", "route": [{"if": "p1", "ip": "10.2.11.1/24", "ns_if": "t2if", "ns_name": "t2"}], "subnet_ip": "1.1.1.0/24", "vms": [{"brif": "t2br1if1", "disk": "10G", "mem": 2, "name": "t2_VM4", "vcpu": 4, "vmif": "t2VM4if1"}], "vxlan": [{"dev": "t2s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.11.2", "remote_ip": "10.1.11.2", "remote_route": "10.1.11.0/24", "subnet_route": "10.2.11.0/24", "tenant_route_ip": "192.168.130.2", "v_name": "vxlan_t2s1"}]}, {"tenant_ns_if": "t2ns1if", "tenant_ns_ip": "10.2.11.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s1if", "tenant_sub_ip": "10.2.11.2/24"}], "rc": 0, "start": "2019-11-18 03:57:57.636880", "stderr": "Device \"t2ns1if\" does not exist.\nDevice \"t2s1if\" does not exist.", "stderr_lines": ["Device \"t2ns1if\" does not exist.", "Device \"t2s1if\" does not exist."], "stdout": "", "stdout_lines": []}

TASK [Set Namespace VETH Pairs UP] **************************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.11.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.2.11.1', u'bridge_name': u't2br1', u'dns': [{u'dnsif': u't2s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't2s1_dnsbrif'}], u'ns_name': u't2ns1', u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't2_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't2br1if1', u'vmif': u't2VM4if1'}], u'vxlan': [{u'local_ip': u'10.2.11.2', u'dsport': 4789, u'dev': u't2s1if', u'tenant_route_ip': u'192.168.130.2', u'remote_route': u'10.1.11.0/24', u'subnet_route': u'10.2.11.0/24', u'v_name': u'vxlan_t2s1', u'id': 42, u'remote_ip': u'10.1.11.2'}]}, {u'tenant_sub_ip': u'10.2.11.2/24', u'tenant_ns_ip': u'10.2.11.1/24', u'tenant_ns_if': u't2ns1if', u'tenant_sub_if': u't2s1if', u'tenant_ns_name': u't2'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t2\" ip link set dev \"t2ns1if\" up\nip netns exec \"t2ns1\" ip link set dev \"t2s1if\" up\n", "delta": "0:00:00.081460", "end": "2019-11-18 03:57:58.210937", "item": [{"bridge_name": "t2br1", "default_route_ip": "10.2.11.1", "dns": [{"brif": "t2s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t2s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns1", "route": [{"if": "p1", "ip": "10.2.11.1/24", "ns_if": "t2if", "ns_name": "t2"}], "subnet_ip": "1.1.1.0/24", "vms": [{"brif": "t2br1if1", "disk": "10G", "mem": 2, "name": "t2_VM4", "vcpu": 4, "vmif": "t2VM4if1"}], "vxlan": [{"dev": "t2s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.11.2", "remote_ip": "10.1.11.2", "remote_route": "10.1.11.0/24", "subnet_route": "10.2.11.0/24", "tenant_route_ip": "192.168.130.2", "v_name": "vxlan_t2s1"}]}, {"tenant_ns_if": "t2ns1if", "tenant_ns_ip": "10.2.11.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s1if", "tenant_sub_ip": "10.2.11.2/24"}], "rc": 0, "start": "2019-11-18 03:57:58.129477", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Add IP addresses to Namespace VETH Pairs] *************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.11.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.2.11.1', u'bridge_name': u't2br1', u'dns': [{u'dnsif': u't2s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't2s1_dnsbrif'}], u'ns_name': u't2ns1', u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't2_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't2br1if1', u'vmif': u't2VM4if1'}], u'vxlan': [{u'local_ip': u'10.2.11.2', u'dsport': 4789, u'dev': u't2s1if', u'tenant_route_ip': u'192.168.130.2', u'remote_route': u'10.1.11.0/24', u'subnet_route': u'10.2.11.0/24', u'v_name': u'vxlan_t2s1', u'id': 42, u'remote_ip': u'10.1.11.2'}]}, {u'tenant_sub_ip': u'10.2.11.2/24', u'tenant_ns_ip': u'10.2.11.1/24', u'tenant_ns_if': u't2ns1if', u'tenant_sub_if': u't2s1if', u'tenant_ns_name': u't2'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t2ns1\" ip addr show \"t2s1if\" | awk 'FNR==3{ print $2 }' | grep -w '^10.2.11.2/24' ; if [ $? -ne 0 ] ; then ip netns exec \"t2ns1\" ip addr add \"10.2.11.2/24\" dev \"t2s1if\" ; fi\n\nip netns exec \"t2\" ip addr show \"t2ns1if\" | awk 'FNR==3{ print $2 }' | grep -w '^10.2.11.1/24' ; if [ $? -ne 0 ] ; then ip netns exec \"t2\" ip addr add \"10.2.11.1/24\" dev \"t2ns1if\" ; fi\n", "delta": "0:00:00.168432", "end": "2019-11-18 03:57:58.758970", "item": [{"bridge_name": "t2br1", "default_route_ip": "10.2.11.1", "dns": [{"brif": "t2s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t2s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns1", "route": [{"if": "p1", "ip": "10.2.11.1/24", "ns_if": "t2if", "ns_name": "t2"}], "subnet_ip": "1.1.1.0/24", "vms": [{"brif": "t2br1if1", "disk": "10G", "mem": 2, "name": "t2_VM4", "vcpu": 4, "vmif": "t2VM4if1"}], "vxlan": [{"dev": "t2s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.11.2", "remote_ip": "10.1.11.2", "remote_route": "10.1.11.0/24", "subnet_route": "10.2.11.0/24", "tenant_route_ip": "192.168.130.2", "v_name": "vxlan_t2s1"}]}, {"tenant_ns_if": "t2ns1if", "tenant_ns_ip": "10.2.11.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s1if", "tenant_sub_ip": "10.2.11.2/24"}], "rc": 0, "start": "2019-11-18 03:57:58.590538", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Add IP Route to Tenant] *******************************************************************************************************************************
changed: [99.99.99.2] => (item={u'default_route_ip': u'192.168.130.1', u'name': u't2', u'pns_ip': u'192.168.130.1/24', u'tenant_if': u't2if', u'tenant_ip': u'192.168.130.2/24', u'pns_if': u't2pns_if'}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t2\" ip route show default | grep -w '[d]efault via 192.168.130.1' ; if [ $? -ne 0 ] ; then ip netns exec \"t2\" ip route add default via \"192.168.130.1\" ; fi\n", "delta": "0:00:00.079575", "end": "2019-11-18 03:57:59.215268", "item": {"default_route_ip": "192.168.130.1", "name": "t2", "pns_if": "t2pns_if", "pns_ip": "192.168.130.1/24", "tenant_if": "t2if", "tenant_ip": "192.168.130.2/24"}, "rc": 0, "start": "2019-11-18 03:57:59.135693", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Add IP Route to Tenant Subnet] ************************************************************************************************************************
changed: [99.99.99.2] => (item={u'route': [{u'ip': u'10.2.11.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.2.11.1', u'bridge_name': u't2br1', u'dns': [{u'dnsif': u't2s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't2s1_dnsbrif'}], u'ns_name': u't2ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.11.2/24', u'tenant_ns_ip': u'10.2.11.1/24', u'tenant_ns_if': u't2ns1if', u'tenant_ns_name': u't2', u'tenant_sub_if': u't2s1if'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't2_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't2br1if1', u'vmif': u't2VM4if1'}], u'vxlan': [{u'local_ip': u'10.2.11.2', u'tenant_route_ip': u'192.168.130.2', u'dsport': 4789, u'dev': u't2s1if', u'subnet_route': u'10.2.11.0/24', u'remote_route': u'10.1.11.0/24', u'v_name': u'vxlan_t2s1', u'id': 42, u'remote_ip': u'10.1.11.2'}]}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t2ns1\" ip route show default | grep -w '[d]efault via 10.2.11.1' ; if [ $? -ne 0 ] ; then ip netns exec \"t2ns1\" ip route add default via \"10.2.11.1\" ; fi\n", "delta": "0:00:00.074180", "end": "2019-11-18 03:57:59.678955", "item": {"bridge_name": "t2br1", "default_route_ip": "10.2.11.1", "dns": [{"brif": "t2s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t2s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns1", "route": [{"if": "p1", "ip": "10.2.11.1/24", "ns_if": "t2if", "ns_name": "t2"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t2ns1if", "tenant_ns_ip": "10.2.11.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s1if", "tenant_sub_ip": "10.2.11.2/24"}], "vms": [{"brif": "t2br1if1", "disk": "10G", "mem": 2, "name": "t2_VM4", "vcpu": 4, "vmif": "t2VM4if1"}], "vxlan": [{"dev": "t2s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.11.2", "remote_ip": "10.1.11.2", "remote_route": "10.1.11.0/24", "subnet_route": "10.2.11.0/24", "tenant_route_ip": "192.168.130.2", "v_name": "vxlan_t2s1"}]}, "rc": 0, "start": "2019-11-18 03:57:59.604775", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Create bridge inside namespace] ***********************************************************************************************************************
changed: [99.99.99.2] => (item={u'route': [{u'ip': u'10.2.11.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.2.11.1', u'bridge_name': u't2br1', u'dns': [{u'dnsif': u't2s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't2s1_dnsbrif'}], u'ns_name': u't2ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.11.2/24', u'tenant_ns_ip': u'10.2.11.1/24', u'tenant_ns_if': u't2ns1if', u'tenant_ns_name': u't2', u'tenant_sub_if': u't2s1if'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't2_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't2br1if1', u'vmif': u't2VM4if1'}], u'vxlan': [{u'local_ip': u'10.2.11.2', u'tenant_route_ip': u'192.168.130.2', u'dsport': 4789, u'dev': u't2s1if', u'subnet_route': u'10.2.11.0/24', u'remote_route': u'10.1.11.0/24', u'v_name': u'vxlan_t2s1', u'id': 42, u'remote_ip': u'10.1.11.2'}]}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t2ns1\" brctl show | grep -w '^t2br1'; if [ $? -ne 0 ] ; then ip netns exec \"t2ns1\" brctl addbr \"t2br1\" ; fi\nip netns exec \"t2ns1\" ip link set dev \"t2br1\" up\n", "delta": "0:00:00.132059", "end": "2019-11-18 03:58:00.163108", "item": {"bridge_name": "t2br1", "default_route_ip": "10.2.11.1", "dns": [{"brif": "t2s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t2s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns1", "route": [{"if": "p1", "ip": "10.2.11.1/24", "ns_if": "t2if", "ns_name": "t2"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t2ns1if", "tenant_ns_ip": "10.2.11.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s1if", "tenant_sub_ip": "10.2.11.2/24"}], "vms": [{"brif": "t2br1if1", "disk": "10G", "mem": 2, "name": "t2_VM4", "vcpu": 4, "vmif": "t2VM4if1"}], "vxlan": [{"dev": "t2s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.11.2", "remote_ip": "10.1.11.2", "remote_route": "10.1.11.0/24", "subnet_route": "10.2.11.0/24", "tenant_route_ip": "192.168.130.2", "v_name": "vxlan_t2s1"}]}, "rc": 0, "start": "2019-11-18 03:58:00.031049", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Create DNS VETH Pair] *********************************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.11.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.2.11.1', u'bridge_name': u't2br1', u'ns_name': u't2ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.11.2/24', u'tenant_ns_ip': u'10.2.11.1/24', u'tenant_ns_if': u't2ns1if', u'tenant_sub_if': u't2s1if', u'tenant_ns_name': u't2'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't2_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't2br1if1', u'vmif': u't2VM4if1'}], u'vxlan': [{u'local_ip': u'10.2.11.2', u'dsport': 4789, u'dev': u't2s1if', u'tenant_route_ip': u'192.168.130.2', u'remote_route': u'10.1.11.0/24', u'subnet_route': u'10.2.11.0/24', u'v_name': u'vxlan_t2s1', u'id': 42, u'remote_ip': u'10.1.11.2'}]}, {u'dnsif': u't2s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't2s1_dnsbrif'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t2ns1\" ip link show \"t2s1_dnsbrif\" ; if [ $? -ne 0 ] ; then ip netns exec \"t2ns1\" ip link add \"t2s1_dnsbrif\" type veth peer name \"t2s1_dnsif\" ; fi\nip netns exec \"t2ns1\" ip link set dev \"t2s1_dnsbrif\" up\nip netns exec \"t2ns1\" ip link set dev \"t2s1_dnsif\" up\n", "delta": "0:00:00.177866", "end": "2019-11-18 03:58:00.703060", "item": [{"bridge_name": "t2br1", "default_route_ip": "10.2.11.1", "ns_name": "t2ns1", "route": [{"if": "p1", "ip": "10.2.11.1/24", "ns_if": "t2if", "ns_name": "t2"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t2ns1if", "tenant_ns_ip": "10.2.11.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s1if", "tenant_sub_ip": "10.2.11.2/24"}], "vms": [{"brif": "t2br1if1", "disk": "10G", "mem": 2, "name": "t2_VM4", "vcpu": 4, "vmif": "t2VM4if1"}], "vxlan": [{"dev": "t2s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.11.2", "remote_ip": "10.1.11.2", "remote_route": "10.1.11.0/24", "subnet_route": "10.2.11.0/24", "tenant_route_ip": "192.168.130.2", "v_name": "vxlan_t2s1"}]}, {"brif": "t2s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t2s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "rc": 0, "start": "2019-11-18 03:58:00.525194", "stderr": "Device \"t2s1_dnsbrif\" does not exist.", "stderr_lines": ["Device \"t2s1_dnsbrif\" does not exist."], "stdout": "", "stdout_lines": []}

TASK [Attach DNS VETH Pair] *********************************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.11.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.2.11.1', u'bridge_name': u't2br1', u'ns_name': u't2ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.11.2/24', u'tenant_ns_ip': u'10.2.11.1/24', u'tenant_ns_if': u't2ns1if', u'tenant_sub_if': u't2s1if', u'tenant_ns_name': u't2'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't2_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't2br1if1', u'vmif': u't2VM4if1'}], u'vxlan': [{u'local_ip': u'10.2.11.2', u'dsport': 4789, u'dev': u't2s1if', u'tenant_route_ip': u'192.168.130.2', u'remote_route': u'10.1.11.0/24', u'subnet_route': u'10.2.11.0/24', u'v_name': u'vxlan_t2s1', u'id': 42, u'remote_ip': u'10.1.11.2'}]}, {u'dnsif': u't2s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't2s1_dnsbrif'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t2ns1\" brctl show \"t2br1\" | grep -w 't2s1_dnsbrif' ; if [ $? -ne 0 ] ; then ip netns exec \"t2ns1\" brctl addif \"t2br1\" \"t2s1_dnsbrif\" ; fi\n", "delta": "0:00:00.089453", "end": "2019-11-18 03:58:01.179045", "item": [{"bridge_name": "t2br1", "default_route_ip": "10.2.11.1", "ns_name": "t2ns1", "route": [{"if": "p1", "ip": "10.2.11.1/24", "ns_if": "t2if", "ns_name": "t2"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t2ns1if", "tenant_ns_ip": "10.2.11.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s1if", "tenant_sub_ip": "10.2.11.2/24"}], "vms": [{"brif": "t2br1if1", "disk": "10G", "mem": 2, "name": "t2_VM4", "vcpu": 4, "vmif": "t2VM4if1"}], "vxlan": [{"dev": "t2s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.11.2", "remote_ip": "10.1.11.2", "remote_route": "10.1.11.0/24", "subnet_route": "10.2.11.0/24", "tenant_route_ip": "192.168.130.2", "v_name": "vxlan_t2s1"}]}, {"brif": "t2s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t2s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "rc": 0, "start": "2019-11-18 03:58:01.089592", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Create VETH Pairs] ************************************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.11.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.2.11.1', u'bridge_name': u't2br1', u'dns': [{u'dnsif': u't2s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't2s1_dnsbrif'}], u'ns_name': u't2ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.11.2/24', u'tenant_ns_ip': u'10.2.11.1/24', u'tenant_ns_if': u't2ns1if', u'tenant_sub_if': u't2s1if', u'tenant_ns_name': u't2'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.2.11.2', u'dsport': 4789, u'dev': u't2s1if', u'tenant_route_ip': u'192.168.130.2', u'remote_route': u'10.1.11.0/24', u'subnet_route': u'10.2.11.0/24', u'v_name': u'vxlan_t2s1', u'id': 42, u'remote_ip': u'10.1.11.2'}]}, {u'mem': 2, u'name': u't2_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't2br1if1', u'vmif': u't2VM4if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip link show \"t2br1if1\" ; if [ $? -ne 0 ] ; then ip link add \"t2VM4if1\" type veth peer name \"t2br1if1\" ; fi\nip link set dev \"t2br1if1\" up\nip link set dev \"t2VM4if1\" up\n", "delta": "0:00:00.016534", "end": "2019-11-18 03:58:01.587011", "item": [{"bridge_name": "t2br1", "default_route_ip": "10.2.11.1", "dns": [{"brif": "t2s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t2s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns1", "route": [{"if": "p1", "ip": "10.2.11.1/24", "ns_if": "t2if", "ns_name": "t2"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t2ns1if", "tenant_ns_ip": "10.2.11.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s1if", "tenant_sub_ip": "10.2.11.2/24"}], "vxlan": [{"dev": "t2s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.11.2", "remote_ip": "10.1.11.2", "remote_route": "10.1.11.0/24", "subnet_route": "10.2.11.0/24", "tenant_route_ip": "192.168.130.2", "v_name": "vxlan_t2s1"}]}, {"brif": "t2br1if1", "disk": "10G", "mem": 2, "name": "t2_VM4", "vcpu": 4, "vmif": "t2VM4if1"}], "rc": 0, "start": "2019-11-18 03:58:01.570477", "stderr": "Device \"t2br1if1\" does not exist.", "stderr_lines": ["Device \"t2br1if1\" does not exist."], "stdout": "", "stdout_lines": []}

TASK [Attach VETH Pairs] ************************************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.11.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.2.11.1', u'bridge_name': u't2br1', u'dns': [{u'dnsif': u't2s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't2s1_dnsbrif'}], u'ns_name': u't2ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.11.2/24', u'tenant_ns_ip': u'10.2.11.1/24', u'tenant_ns_if': u't2ns1if', u'tenant_sub_if': u't2s1if', u'tenant_ns_name': u't2'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.2.11.2', u'dsport': 4789, u'dev': u't2s1if', u'tenant_route_ip': u'192.168.130.2', u'remote_route': u'10.1.11.0/24', u'subnet_route': u'10.2.11.0/24', u'v_name': u'vxlan_t2s1', u'id': 42, u'remote_ip': u'10.1.11.2'}]}, {u'mem': 2, u'name': u't2_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't2br1if1', u'vmif': u't2VM4if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip link show \"t2br1if1\" ; if [ $? -eq 0 ] ; then ip link set \"t2br1if1\" netns \"t2ns1\" ; fi\nip netns exec \"t2ns1\" brctl show \"t2br1\" | grep -w 't2br1if1' ; if [ $? -ne 0 ] ; then ip netns exec \"t2ns1\" brctl addif \"t2br1\" \"t2br1if1\" ; fi\n", "delta": "0:00:00.110999", "end": "2019-11-18 03:58:02.119048", "item": [{"bridge_name": "t2br1", "default_route_ip": "10.2.11.1", "dns": [{"brif": "t2s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t2s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns1", "route": [{"if": "p1", "ip": "10.2.11.1/24", "ns_if": "t2if", "ns_name": "t2"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t2ns1if", "tenant_ns_ip": "10.2.11.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s1if", "tenant_sub_ip": "10.2.11.2/24"}], "vxlan": [{"dev": "t2s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.11.2", "remote_ip": "10.1.11.2", "remote_route": "10.1.11.0/24", "subnet_route": "10.2.11.0/24", "tenant_route_ip": "192.168.130.2", "v_name": "vxlan_t2s1"}]}, {"brif": "t2br1if1", "disk": "10G", "mem": 2, "name": "t2_VM4", "vcpu": 4, "vmif": "t2VM4if1"}], "rc": 0, "start": "2019-11-18 03:58:02.008049", "stderr": "", "stderr_lines": [], "stdout": "27: t2br1if1@t2VM4if1: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP mode DEFAULT group default qlen 1000\n    link/ether 36:76:76:8c:4f:a2 brd ff:ff:ff:ff:ff:ff", "stdout_lines": ["27: t2br1if1@t2VM4if1: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP mode DEFAULT group default qlen 1000", "    link/ether 36:76:76:8c:4f:a2 brd ff:ff:ff:ff:ff:ff"]}

TASK [All interfaces and bridges UP] ************************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.11.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.2.11.1', u'bridge_name': u't2br1', u'dns': [{u'dnsif': u't2s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't2s1_dnsbrif'}], u'ns_name': u't2ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.11.2/24', u'tenant_ns_ip': u'10.2.11.1/24', u'tenant_ns_if': u't2ns1if', u'tenant_sub_if': u't2s1if', u'tenant_ns_name': u't2'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.2.11.2', u'dsport': 4789, u'dev': u't2s1if', u'tenant_route_ip': u'192.168.130.2', u'remote_route': u'10.1.11.0/24', u'subnet_route': u'10.2.11.0/24', u'v_name': u'vxlan_t2s1', u'id': 42, u'remote_ip': u'10.1.11.2'}]}, {u'mem': 2, u'name': u't2_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't2br1if1', u'vmif': u't2VM4if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t2ns1\" ip link set \"t2br1if1\" up\nip netns exec \"t2ns1\" ip link set dev \"t2br1\" up\n", "delta": "0:00:00.061681", "end": "2019-11-18 03:58:02.570954", "item": [{"bridge_name": "t2br1", "default_route_ip": "10.2.11.1", "dns": [{"brif": "t2s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t2s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns1", "route": [{"if": "p1", "ip": "10.2.11.1/24", "ns_if": "t2if", "ns_name": "t2"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t2ns1if", "tenant_ns_ip": "10.2.11.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s1if", "tenant_sub_ip": "10.2.11.2/24"}], "vxlan": [{"dev": "t2s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.11.2", "remote_ip": "10.1.11.2", "remote_route": "10.1.11.0/24", "subnet_route": "10.2.11.0/24", "tenant_route_ip": "192.168.130.2", "v_name": "vxlan_t2s1"}]}, {"brif": "t2br1if1", "disk": "10G", "mem": 2, "name": "t2_VM4", "vcpu": 4, "vmif": "t2VM4if1"}], "rc": 0, "start": "2019-11-18 03:58:02.509273", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Add IP to DNS Interface] ******************************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.11.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.2.11.1', u'bridge_name': u't2br1', u'ns_name': u't2ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.11.2/24', u'tenant_ns_ip': u'10.2.11.1/24', u'tenant_ns_if': u't2ns1if', u'tenant_sub_if': u't2s1if', u'tenant_ns_name': u't2'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't2_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't2br1if1', u'vmif': u't2VM4if1'}], u'vxlan': [{u'local_ip': u'10.2.11.2', u'dsport': 4789, u'dev': u't2s1if', u'tenant_route_ip': u'192.168.130.2', u'remote_route': u'10.1.11.0/24', u'subnet_route': u'10.2.11.0/24', u'v_name': u'vxlan_t2s1', u'id': 42, u'remote_ip': u'10.1.11.2'}]}, {u'dnsif': u't2s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't2s1_dnsbrif'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t2ns1\" ip addr show \"t2s1_dnsif\" | awk 'FNR==3{ print $2}'| grep -w '^1.1.1.128/24' ; if [ $? -ne 0 ] ; then ip netns exec \"t2ns1\" ip addr add \"1.1.1.128/24\" dev \"t2s1_dnsif\" ; fi\n", "delta": "0:00:00.096537", "end": "2019-11-18 03:58:03.042962", "item": [{"bridge_name": "t2br1", "default_route_ip": "10.2.11.1", "ns_name": "t2ns1", "route": [{"if": "p1", "ip": "10.2.11.1/24", "ns_if": "t2if", "ns_name": "t2"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t2ns1if", "tenant_ns_ip": "10.2.11.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s1if", "tenant_sub_ip": "10.2.11.2/24"}], "vms": [{"brif": "t2br1if1", "disk": "10G", "mem": 2, "name": "t2_VM4", "vcpu": 4, "vmif": "t2VM4if1"}], "vxlan": [{"dev": "t2s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.11.2", "remote_ip": "10.1.11.2", "remote_route": "10.1.11.0/24", "subnet_route": "10.2.11.0/24", "tenant_route_ip": "192.168.130.2", "v_name": "vxlan_t2s1"}]}, {"brif": "t2s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t2s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "rc": 0, "start": "2019-11-18 03:58:02.946425", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Install DHCP Server] **********************************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.11.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.2.11.1', u'bridge_name': u't2br1', u'ns_name': u't2ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.11.2/24', u'tenant_ns_ip': u'10.2.11.1/24', u'tenant_ns_if': u't2ns1if', u'tenant_sub_if': u't2s1if', u'tenant_ns_name': u't2'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't2_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't2br1if1', u'vmif': u't2VM4if1'}], u'vxlan': [{u'local_ip': u'10.2.11.2', u'dsport': 4789, u'dev': u't2s1if', u'tenant_route_ip': u'192.168.130.2', u'remote_route': u'10.1.11.0/24', u'subnet_route': u'10.2.11.0/24', u'v_name': u'vxlan_t2s1', u'id': 42, u'remote_ip': u'10.1.11.2'}]}, {u'dnsif': u't2s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't2s1_dnsbrif'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t2ns1\" ps aux | grep -w '[d]nsmasq --interface t2s1_dnsif -z --dhcp-range=1.1.1.133,1.1.1.254' ; if [ $? -ne 0 ] ; then ip netns exec \"t2ns1\" dnsmasq --interface \"t2s1_dnsif\" -z --dhcp-range=1.1.1.133,'1.1.1.254' ; fi\n", "delta": "0:00:00.097165", "end": "2019-11-18 03:58:03.513129", "item": [{"bridge_name": "t2br1", "default_route_ip": "10.2.11.1", "ns_name": "t2ns1", "route": [{"if": "p1", "ip": "10.2.11.1/24", "ns_if": "t2if", "ns_name": "t2"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t2ns1if", "tenant_ns_ip": "10.2.11.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s1if", "tenant_sub_ip": "10.2.11.2/24"}], "vms": [{"brif": "t2br1if1", "disk": "10G", "mem": 2, "name": "t2_VM4", "vcpu": 4, "vmif": "t2VM4if1"}], "vxlan": [{"dev": "t2s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.11.2", "remote_ip": "10.1.11.2", "remote_route": "10.1.11.0/24", "subnet_route": "10.2.11.0/24", "tenant_route_ip": "192.168.130.2", "v_name": "vxlan_t2s1"}]}, {"brif": "t2s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t2s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "rc": 0, "start": "2019-11-18 03:58:03.415964", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Create VXLAN devices] *********************************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.11.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.2.11.1', u'bridge_name': u't2br1', u'dns': [{u'dnsif': u't2s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't2s1_dnsbrif'}], u'ns_name': u't2ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.11.2/24', u'tenant_ns_ip': u'10.2.11.1/24', u'tenant_ns_if': u't2ns1if', u'tenant_sub_if': u't2s1if', u'tenant_ns_name': u't2'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't2_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't2br1if1', u'vmif': u't2VM4if1'}]}, {u'local_ip': u'10.2.11.2', u'dsport': 4789, u'dev': u't2s1if', u'tenant_route_ip': u'192.168.130.2', u'remote_route': u'10.1.11.0/24', u'subnet_route': u'10.2.11.0/24', u'v_name': u'vxlan_t2s1', u'id': 42, u'remote_ip': u'10.1.11.2'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t2ns1\" ip link show \"vxlan_t2s1\" ; if [ $? -ne 0 ] ; then ip netns exec \"t2ns1\" ip link add \"vxlan_t2s1\" type vxlan id \"42\" local \"10.2.11.2\" remote \"10.1.11.2\" dstport \"4789\" dev \"t2s1if\" ; ip netns exec \"t2ns1\" ip link set dev \"vxlan_t2s1\" up ; fi\n", "delta": "0:00:00.100038", "end": "2019-11-18 03:58:03.999183", "item": [{"bridge_name": "t2br1", "default_route_ip": "10.2.11.1", "dns": [{"brif": "t2s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t2s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns1", "route": [{"if": "p1", "ip": "10.2.11.1/24", "ns_if": "t2if", "ns_name": "t2"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t2ns1if", "tenant_ns_ip": "10.2.11.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s1if", "tenant_sub_ip": "10.2.11.2/24"}], "vms": [{"brif": "t2br1if1", "disk": "10G", "mem": 2, "name": "t2_VM4", "vcpu": 4, "vmif": "t2VM4if1"}]}, {"dev": "t2s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.11.2", "remote_ip": "10.1.11.2", "remote_route": "10.1.11.0/24", "subnet_route": "10.2.11.0/24", "tenant_route_ip": "192.168.130.2", "v_name": "vxlan_t2s1"}], "rc": 0, "start": "2019-11-18 03:58:03.899145", "stderr": "Device \"vxlan_t2s1\" does not exist.", "stderr_lines": ["Device \"vxlan_t2s1\" does not exist."], "stdout": "", "stdout_lines": []}

TASK [Attach VXLANs to bridge] ******************************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.11.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.2.11.1', u'bridge_name': u't2br1', u'dns': [{u'dnsif': u't2s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't2s1_dnsbrif'}], u'ns_name': u't2ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.11.2/24', u'tenant_ns_ip': u'10.2.11.1/24', u'tenant_ns_if': u't2ns1if', u'tenant_sub_if': u't2s1if', u'tenant_ns_name': u't2'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't2_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't2br1if1', u'vmif': u't2VM4if1'}]}, {u'local_ip': u'10.2.11.2', u'dsport': 4789, u'dev': u't2s1if', u'tenant_route_ip': u'192.168.130.2', u'remote_route': u'10.1.11.0/24', u'subnet_route': u'10.2.11.0/24', u'v_name': u'vxlan_t2s1', u'id': 42, u'remote_ip': u'10.1.11.2'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t2ns1\" brctl show \"t2br1\" | grep -w 'vxlan_t2s1' ; if [ $? -ne 0 ] ; then ip netns exec \"t2ns1\" brctl addif \"t2br1\" \"vxlan_t2s1\" ; fi\n", "delta": "0:00:00.081633", "end": "2019-11-18 03:58:04.470910", "item": [{"bridge_name": "t2br1", "default_route_ip": "10.2.11.1", "dns": [{"brif": "t2s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t2s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns1", "route": [{"if": "p1", "ip": "10.2.11.1/24", "ns_if": "t2if", "ns_name": "t2"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t2ns1if", "tenant_ns_ip": "10.2.11.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s1if", "tenant_sub_ip": "10.2.11.2/24"}], "vms": [{"brif": "t2br1if1", "disk": "10G", "mem": 2, "name": "t2_VM4", "vcpu": 4, "vmif": "t2VM4if1"}]}, {"dev": "t2s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.11.2", "remote_ip": "10.1.11.2", "remote_route": "10.1.11.0/24", "subnet_route": "10.2.11.0/24", "tenant_route_ip": "192.168.130.2", "v_name": "vxlan_t2s1"}], "rc": 0, "start": "2019-11-18 03:58:04.389277", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

PLAY RECAP **************************************************************************************************************************************************
99.99.99.2                 : ok=21   changed=21   unreachable=0    failed=0    skipped=0    rescued=0    ignored=0   

Using /etc/ansible/ansible.cfg as config file

PLAY [main] *************************************************************************************************************************************************

TASK [Add VXLAN routes in PNS] ******************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.11.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.1.11.1', u'bridge_name': u't2br1', u'dns': [{u'dnsif': u't2s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't2s1_dnsbrif'}], u'ns_name': u't2ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.11.2/24', u'tenant_ns_ip': u'10.1.11.1/24', u'tenant_ns_if': u't2ns1if', u'tenant_sub_if': u't2s1if', u'tenant_ns_name': u't2'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't2_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't2br1if1', u'vmif': u't2VM1if1'}, {u'mem': 4, u'name': u't2_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't2br1if2', u'vmif': u't2VM2if1'}]}, {u'local_ip': u'10.1.11.2', u'dsport': 4789, u'dev': u't2s1if', u'tenant_route_ip': u'192.168.2.2', u'remote_route': u'10.2.11.0/24', u'subnet_route': u'10.1.11.0/24', u'v_name': u'vxlan_t2s1', u'id': 42, u'remote_ip': u'10.2.11.2'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec pns ip route show \"10.1.11.0/24\" via \"192.168.2.2\" | grep -w '^10.1.11.0/24' ; if [ $? -ne 0 ] ; then ip netns exec pns ip route add \"10.1.11.0/24\" via \"192.168.2.2\" ; fi\n", "delta": "0:00:00.079996", "end": "2019-11-18 03:58:05.715697", "item": [{"bridge_name": "t2br1", "default_route_ip": "10.1.11.1", "dns": [{"brif": "t2s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t2s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns1", "route": [{"if": "p1", "ip": "10.1.11.1/24", "ns_if": "t2if", "ns_name": "t2"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t2ns1if", "tenant_ns_ip": "10.1.11.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s1if", "tenant_sub_ip": "10.1.11.2/24"}], "vms": [{"brif": "t2br1if1", "disk": "10G", "mem": 2, "name": "t2_VM1", "vcpu": 4, "vmif": "t2VM1if1"}, {"brif": "t2br1if2", "disk": "10G", "mem": 4, "name": "t2_VM2", "vcpu": 2, "vmif": "t2VM2if1"}]}, {"dev": "t2s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.11.2", "remote_ip": "10.2.11.2", "remote_route": "10.2.11.0/24", "subnet_route": "10.1.11.0/24", "tenant_route_ip": "192.168.2.2", "v_name": "vxlan_t2s1"}], "rc": 0, "start": "2019-11-18 03:58:05.635701", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}
skipping: [localhost] => (item=[{u'route': [{u'ip': u'10.1.12.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.1.12.1', u'bridge_name': u't2br2', u'dns': [{u'dnsif': u't2s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't2s2_dnsbrif'}], u'ns_name': u't2ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.12.2/24', u'tenant_ns_ip': u'10.1.12.1/24', u'tenant_ns_if': u't2ns2if', u'tenant_sub_if': u't2s2if', u'tenant_ns_name': u't2'}], u'subnet_ip': u'2.2.2.0/24', u'vms': [{u'mem': 3, u'name': u't2_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't2br2if1', u'vmif': u't2VM3if1'}]}, {u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}])  => {"ansible_loop_var": "item", "changed": false, "item": [{"bridge_name": "t2br2", "default_route_ip": "10.1.12.1", "dns": [{"brif": "t2s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t2s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns2", "route": [{"if": "p1", "ip": "10.1.12.1/24", "ns_if": "t2if", "ns_name": "t2"}], "subnet_ip": "2.2.2.0/24", "tenant_ns": [{"tenant_ns_if": "t2ns2if", "tenant_ns_ip": "10.1.12.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s2if", "tenant_sub_ip": "10.1.12.2/24"}], "vms": [{"brif": "t2br2if1", "disk": "10G", "mem": 3, "name": "t2_VM3", "vcpu": 2, "vmif": "t2VM3if1"}]}, {"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}], "skip_reason": "Conditional result was False"}

TASK [Get PNS ip address] ***********************************************************************************************************************************
ok: [localhost] => {"changed": false, "cmd": "ip netns exec pns ip addr show p1 | awk 'FNR==3{ print $2 }' | awk -F/ '{ print $1 }'\n", "delta": "0:00:00.045213", "end": "2019-11-18 03:58:06.048072", "rc": 0, "start": "2019-11-18 03:58:06.002859", "stderr": "", "stderr_lines": [], "stdout": "192.168.100.238", "stdout_lines": ["192.168.100.238"]}

TASK [Add VXLAN routes to host] *****************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.11.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.1.11.1', u'bridge_name': u't2br1', u'dns': [{u'dnsif': u't2s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't2s1_dnsbrif'}], u'ns_name': u't2ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.11.2/24', u'tenant_ns_ip': u'10.1.11.1/24', u'tenant_ns_if': u't2ns1if', u'tenant_sub_if': u't2s1if', u'tenant_ns_name': u't2'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't2_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't2br1if1', u'vmif': u't2VM1if1'}, {u'mem': 4, u'name': u't2_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't2br1if2', u'vmif': u't2VM2if1'}]}, {u'local_ip': u'10.1.11.2', u'dsport': 4789, u'dev': u't2s1if', u'tenant_route_ip': u'192.168.2.2', u'remote_route': u'10.2.11.0/24', u'subnet_route': u'10.1.11.0/24', u'v_name': u'vxlan_t2s1', u'id': 42, u'remote_ip': u'10.2.11.2'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip route show \"10.1.11.0/24\" via \"192.168.100.238\" | grep -w '^10.1.11.0/24' ; if [ $? -ne 0 ] ; then ip route add \"10.1.11.0/24\" via \"192.168.100.238\" ; fi\nip route show \"10.2.11.0/24\" via 99.99.99.2 | grep -w '^10.2.11.0/24'; if [ $? -ne 0 ] ; then ip route add \"10.2.11.0/24\" via 99.99.99.2 ; fi\n", "delta": "0:00:00.008944", "end": "2019-11-18 03:58:06.366840", "item": [{"bridge_name": "t2br1", "default_route_ip": "10.1.11.1", "dns": [{"brif": "t2s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t2s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns1", "route": [{"if": "p1", "ip": "10.1.11.1/24", "ns_if": "t2if", "ns_name": "t2"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t2ns1if", "tenant_ns_ip": "10.1.11.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s1if", "tenant_sub_ip": "10.1.11.2/24"}], "vms": [{"brif": "t2br1if1", "disk": "10G", "mem": 2, "name": "t2_VM1", "vcpu": 4, "vmif": "t2VM1if1"}, {"brif": "t2br1if2", "disk": "10G", "mem": 4, "name": "t2_VM2", "vcpu": 2, "vmif": "t2VM2if1"}]}, {"dev": "t2s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.11.2", "remote_ip": "10.2.11.2", "remote_route": "10.2.11.0/24", "subnet_route": "10.1.11.0/24", "tenant_route_ip": "192.168.2.2", "v_name": "vxlan_t2s1"}], "rc": 0, "start": "2019-11-18 03:58:06.357896", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}
skipping: [localhost] => (item=[{u'route': [{u'ip': u'10.1.12.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.1.12.1', u'bridge_name': u't2br2', u'dns': [{u'dnsif': u't2s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't2s2_dnsbrif'}], u'ns_name': u't2ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.12.2/24', u'tenant_ns_ip': u'10.1.12.1/24', u'tenant_ns_if': u't2ns2if', u'tenant_sub_if': u't2s2if', u'tenant_ns_name': u't2'}], u'subnet_ip': u'2.2.2.0/24', u'vms': [{u'mem': 3, u'name': u't2_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't2br2if1', u'vmif': u't2VM3if1'}]}, {u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}])  => {"ansible_loop_var": "item", "changed": false, "item": [{"bridge_name": "t2br2", "default_route_ip": "10.1.12.1", "dns": [{"brif": "t2s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t2s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns2", "route": [{"if": "p1", "ip": "10.1.12.1/24", "ns_if": "t2if", "ns_name": "t2"}], "subnet_ip": "2.2.2.0/24", "tenant_ns": [{"tenant_ns_if": "t2ns2if", "tenant_ns_ip": "10.1.12.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s2if", "tenant_sub_ip": "10.1.12.2/24"}], "vms": [{"brif": "t2br2if1", "disk": "10G", "mem": 3, "name": "t2_VM3", "vcpu": 2, "vmif": "t2VM3if1"}]}, {"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}], "skip_reason": "Conditional result was False"}

PLAY RECAP **************************************************************************************************************************************************
localhost                  : ok=3    changed=2    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0   

Using /etc/ansible/ansible.cfg as config file

PLAY [worker] ***********************************************************************************************************************************************

TASK [Add VXLAN routes in PNS] ******************************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.11.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.2.11.1', u'bridge_name': u't2br1', u'dns': [{u'dnsif': u't2s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't2s1_dnsbrif'}], u'ns_name': u't2ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.11.2/24', u'tenant_ns_ip': u'10.2.11.1/24', u'tenant_ns_if': u't2ns1if', u'tenant_sub_if': u't2s1if', u'tenant_ns_name': u't2'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't2_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't2br1if1', u'vmif': u't2VM4if1'}]}, {u'local_ip': u'10.2.11.2', u'dsport': 4789, u'dev': u't2s1if', u'tenant_route_ip': u'192.168.130.2', u'remote_route': u'10.1.11.0/24', u'subnet_route': u'10.2.11.0/24', u'v_name': u'vxlan_t2s1', u'id': 42, u'remote_ip': u'10.1.11.2'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec pns ip route show \"10.2.11.0/24\" via \"192.168.130.2\" | grep -w '^10.2.11.0/24' ; if [ $? -ne 0 ] ; then ip netns exec pns ip route add \"10.2.11.0/24\" via \"192.168.130.2\" ; fi\n", "delta": "0:00:00.073437", "end": "2019-11-18 03:58:07.847111", "item": [{"bridge_name": "t2br1", "default_route_ip": "10.2.11.1", "dns": [{"brif": "t2s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t2s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns1", "route": [{"if": "p1", "ip": "10.2.11.1/24", "ns_if": "t2if", "ns_name": "t2"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t2ns1if", "tenant_ns_ip": "10.2.11.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s1if", "tenant_sub_ip": "10.2.11.2/24"}], "vms": [{"brif": "t2br1if1", "disk": "10G", "mem": 2, "name": "t2_VM4", "vcpu": 4, "vmif": "t2VM4if1"}]}, {"dev": "t2s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.11.2", "remote_ip": "10.1.11.2", "remote_route": "10.1.11.0/24", "subnet_route": "10.2.11.0/24", "tenant_route_ip": "192.168.130.2", "v_name": "vxlan_t2s1"}], "rc": 0, "start": "2019-11-18 03:58:07.773674", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Get PNS ip address] ***********************************************************************************************************************************
ok: [99.99.99.2] => {"changed": false, "cmd": "ip netns exec pns ip addr show p1 | awk 'FNR==3{ print $2 }' | awk -F/ '{ print $1 }'\n", "delta": "0:00:00.045996", "end": "2019-11-18 03:58:08.263480", "rc": 0, "start": "2019-11-18 03:58:08.217484", "stderr": "", "stderr_lines": [], "stdout": "192.168.100.50", "stdout_lines": ["192.168.100.50"]}

TASK [Add VXLAN routes to host] *****************************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.11.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.2.11.1', u'bridge_name': u't2br1', u'dns': [{u'dnsif': u't2s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't2s1_dnsbrif'}], u'ns_name': u't2ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.11.2/24', u'tenant_ns_ip': u'10.2.11.1/24', u'tenant_ns_if': u't2ns1if', u'tenant_sub_if': u't2s1if', u'tenant_ns_name': u't2'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't2_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't2br1if1', u'vmif': u't2VM4if1'}]}, {u'local_ip': u'10.2.11.2', u'dsport': 4789, u'dev': u't2s1if', u'tenant_route_ip': u'192.168.130.2', u'remote_route': u'10.1.11.0/24', u'subnet_route': u'10.2.11.0/24', u'v_name': u'vxlan_t2s1', u'id': 42, u'remote_ip': u'10.1.11.2'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip route show \"10.2.11.0/24\" via \"192.168.100.50\" | grep -w '^10.2.11.0/24' ; if [ $? -ne 0 ] ; then ip route add \"10.2.11.0/24\" via \"192.168.100.50\" ; fi\nip route show \"10.1.11.0/24\" via 99.99.99.1 | grep -w '^10.1.11.0/24'; if [ $? -ne 0 ] ; then ip route add \"10.1.11.0/24\" via 99.99.99.1 ; fi\n", "delta": "0:00:00.009146", "end": "2019-11-18 03:58:08.690378", "item": [{"bridge_name": "t2br1", "default_route_ip": "10.2.11.1", "dns": [{"brif": "t2s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t2s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns1", "route": [{"if": "p1", "ip": "10.2.11.1/24", "ns_if": "t2if", "ns_name": "t2"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t2ns1if", "tenant_ns_ip": "10.2.11.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s1if", "tenant_sub_ip": "10.2.11.2/24"}], "vms": [{"brif": "t2br1if1", "disk": "10G", "mem": 2, "name": "t2_VM4", "vcpu": 4, "vmif": "t2VM4if1"}]}, {"dev": "t2s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.11.2", "remote_ip": "10.1.11.2", "remote_route": "10.1.11.0/24", "subnet_route": "10.2.11.0/24", "tenant_route_ip": "192.168.130.2", "v_name": "vxlan_t2s1"}], "rc": 0, "start": "2019-11-18 03:58:08.681232", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

PLAY RECAP **************************************************************************************************************************************************
99.99.99.2                 : ok=3    changed=2    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0   

Using /etc/ansible/ansible.cfg as config file

PLAY [main] *************************************************************************************************************************************************

TASK [Create VM templates (C1)] *****************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.11.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.1.11.1', u'bridge_name': u't2br1', u'dns': [{u'dnsif': u't2s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't2s1_dnsbrif'}], u'ns_name': u't2ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.11.2/24', u'tenant_ns_ip': u'10.1.11.1/24', u'tenant_ns_if': u't2ns1if', u'tenant_sub_if': u't2s1if', u'tenant_ns_name': u't2'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.1.11.2', u'dsport': 4789, u'dev': u't2s1if', u'tenant_route_ip': u'192.168.2.2', u'remote_route': u'10.2.11.0/24', u'subnet_route': u'10.1.11.0/24', u'v_name': u'vxlan_t2s1', u'id': 42, u'remote_ip': u'10.2.11.2'}]}, {u'mem': 2, u'name': u't2_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't2br1if1', u'vmif': u't2VM1if1'}]) => {"ansible_loop_var": "item", "changed": true, "checksum": "350ba870bd31b7f6ee517845c14237910b5af0bf", "dest": "/root/Migration-as-a-Service/t2/VM_templates/t2_VM1.xml.j2", "gid": 0, "group": "root", "item": [{"bridge_name": "t2br1", "default_route_ip": "10.1.11.1", "dns": [{"brif": "t2s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t2s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns1", "route": [{"if": "p1", "ip": "10.1.11.1/24", "ns_if": "t2if", "ns_name": "t2"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t2ns1if", "tenant_ns_ip": "10.1.11.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s1if", "tenant_sub_ip": "10.1.11.2/24"}], "vxlan": [{"dev": "t2s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.11.2", "remote_ip": "10.2.11.2", "remote_route": "10.2.11.0/24", "subnet_route": "10.1.11.0/24", "tenant_route_ip": "192.168.2.2", "v_name": "vxlan_t2s1"}]}, {"brif": "t2br1if1", "disk": "10G", "mem": 2, "name": "t2_VM1", "vcpu": 4, "vmif": "t2VM1if1"}], "md5sum": "fbfc2eb0c2569531f25eea92c26d3bee", "mode": "0644", "owner": "root", "size": 4091, "src": "/root/.ansible/tmp/ansible-tmp-1574049489.33-25683878661587/source", "state": "file", "uid": 0}
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.11.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.1.11.1', u'bridge_name': u't2br1', u'dns': [{u'dnsif': u't2s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't2s1_dnsbrif'}], u'ns_name': u't2ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.11.2/24', u'tenant_ns_ip': u'10.1.11.1/24', u'tenant_ns_if': u't2ns1if', u'tenant_sub_if': u't2s1if', u'tenant_ns_name': u't2'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.1.11.2', u'dsport': 4789, u'dev': u't2s1if', u'tenant_route_ip': u'192.168.2.2', u'remote_route': u'10.2.11.0/24', u'subnet_route': u'10.1.11.0/24', u'v_name': u'vxlan_t2s1', u'id': 42, u'remote_ip': u'10.2.11.2'}]}, {u'mem': 4, u'name': u't2_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't2br1if2', u'vmif': u't2VM2if1'}]) => {"ansible_loop_var": "item", "changed": true, "checksum": "350ba870bd31b7f6ee517845c14237910b5af0bf", "dest": "/root/Migration-as-a-Service/t2/VM_templates/t2_VM2.xml.j2", "gid": 0, "group": "root", "item": [{"bridge_name": "t2br1", "default_route_ip": "10.1.11.1", "dns": [{"brif": "t2s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t2s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns1", "route": [{"if": "p1", "ip": "10.1.11.1/24", "ns_if": "t2if", "ns_name": "t2"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t2ns1if", "tenant_ns_ip": "10.1.11.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s1if", "tenant_sub_ip": "10.1.11.2/24"}], "vxlan": [{"dev": "t2s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.11.2", "remote_ip": "10.2.11.2", "remote_route": "10.2.11.0/24", "subnet_route": "10.1.11.0/24", "tenant_route_ip": "192.168.2.2", "v_name": "vxlan_t2s1"}]}, {"brif": "t2br1if2", "disk": "10G", "mem": 4, "name": "t2_VM2", "vcpu": 2, "vmif": "t2VM2if1"}], "md5sum": "fbfc2eb0c2569531f25eea92c26d3bee", "mode": "0644", "owner": "root", "size": 4091, "src": "/root/.ansible/tmp/ansible-tmp-1574049489.9-112755614386190/source", "state": "file", "uid": 0}
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.12.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.1.12.1', u'bridge_name': u't2br2', u'dns': [{u'dnsif': u't2s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't2s2_dnsbrif'}], u'ns_name': u't2ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.12.2/24', u'tenant_ns_ip': u'10.1.12.1/24', u'tenant_ns_if': u't2ns2if', u'tenant_sub_if': u't2s2if', u'tenant_ns_name': u't2'}], u'subnet_ip': u'2.2.2.0/24', u'vxlan': [{u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}, {u'mem': 3, u'name': u't2_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't2br2if1', u'vmif': u't2VM3if1'}]) => {"ansible_loop_var": "item", "changed": true, "checksum": "350ba870bd31b7f6ee517845c14237910b5af0bf", "dest": "/root/Migration-as-a-Service/t2/VM_templates/t2_VM3.xml.j2", "gid": 0, "group": "root", "item": [{"bridge_name": "t2br2", "default_route_ip": "10.1.12.1", "dns": [{"brif": "t2s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t2s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns2", "route": [{"if": "p1", "ip": "10.1.12.1/24", "ns_if": "t2if", "ns_name": "t2"}], "subnet_ip": "2.2.2.0/24", "tenant_ns": [{"tenant_ns_if": "t2ns2if", "tenant_ns_ip": "10.1.12.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s2if", "tenant_sub_ip": "10.1.12.2/24"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, {"brif": "t2br2if1", "disk": "10G", "mem": 3, "name": "t2_VM3", "vcpu": 2, "vmif": "t2VM3if1"}], "md5sum": "fbfc2eb0c2569531f25eea92c26d3bee", "mode": "0644", "owner": "root", "size": 4091, "src": "/root/.ansible/tmp/ansible-tmp-1574049490.15-43169897333464/source", "state": "file", "uid": 0}

PLAY RECAP **************************************************************************************************************************************************
localhost                  : ok=1    changed=1    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0   

Using /etc/ansible/ansible.cfg as config file

PLAY [main] *************************************************************************************************************************************************

TASK [Create VM templates (C2)] *****************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.2.11.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.2.11.1', u'bridge_name': u't2br1', u'dns': [{u'dnsif': u't2s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't2s1_dnsbrif'}], u'ns_name': u't2ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.11.2/24', u'tenant_ns_ip': u'10.2.11.1/24', u'tenant_ns_if': u't2ns1if', u'tenant_sub_if': u't2s1if', u'tenant_ns_name': u't2'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.2.11.2', u'dsport': 4789, u'dev': u't2s1if', u'tenant_route_ip': u'192.168.130.2', u'remote_route': u'10.1.11.0/24', u'subnet_route': u'10.2.11.0/24', u'v_name': u'vxlan_t2s1', u'id': 42, u'remote_ip': u'10.1.11.2'}]}, {u'mem': 2, u'name': u't2_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't2br1if1', u'vmif': u't2VM4if1'}]) => {"ansible_loop_var": "item", "changed": true, "checksum": "350ba870bd31b7f6ee517845c14237910b5af0bf", "dest": "/root/Migration-as-a-Service/t2/VM_templates/t2_VM4.xml.j2", "gid": 0, "group": "root", "item": [{"bridge_name": "t2br1", "default_route_ip": "10.2.11.1", "dns": [{"brif": "t2s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t2s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns1", "route": [{"if": "p1", "ip": "10.2.11.1/24", "ns_if": "t2if", "ns_name": "t2"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t2ns1if", "tenant_ns_ip": "10.2.11.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s1if", "tenant_sub_ip": "10.2.11.2/24"}], "vxlan": [{"dev": "t2s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.11.2", "remote_ip": "10.1.11.2", "remote_route": "10.1.11.0/24", "subnet_route": "10.2.11.0/24", "tenant_route_ip": "192.168.130.2", "v_name": "vxlan_t2s1"}]}, {"brif": "t2br1if1", "disk": "10G", "mem": 2, "name": "t2_VM4", "vcpu": 4, "vmif": "t2VM4if1"}], "md5sum": "fbfc2eb0c2569531f25eea92c26d3bee", "mode": "0644", "owner": "root", "size": 4091, "src": "/root/.ansible/tmp/ansible-tmp-1574049491.1-244037182895735/source", "state": "file", "uid": 0}

PLAY RECAP **************************************************************************************************************************************************
localhost                  : ok=1    changed=1    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0   

Using /etc/ansible/ansible.cfg as config file

PLAY [main] *************************************************************************************************************************************************

TASK [Copy VM image] ****************************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.11.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.1.11.1', u'bridge_name': u't2br1', u'dns': [{u'dnsif': u't2s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't2s1_dnsbrif'}], u'ns_name': u't2ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.11.2/24', u'tenant_ns_ip': u'10.1.11.1/24', u'tenant_ns_if': u't2ns1if', u'tenant_sub_if': u't2s1if', u'tenant_ns_name': u't2'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.1.11.2', u'dsport': 4789, u'dev': u't2s1if', u'tenant_route_ip': u'192.168.2.2', u'remote_route': u'10.2.11.0/24', u'subnet_route': u'10.1.11.0/24', u'v_name': u'vxlan_t2s1', u'id': 42, u'remote_ip': u'10.2.11.2'}]}, {u'mem': 2, u'name': u't2_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't2br1if1', u'vmif': u't2VM1if1'}]) => {"ansible_loop_var": "item", "changed": true, "checksum": "d86d5962370fcd0c3d05943fc209d9e05fdac89f", "dest": "/var/lib/libvirt/images/t2_VM1.qcow2", "gid": 0, "group": "root", "item": [{"bridge_name": "t2br1", "default_route_ip": "10.1.11.1", "dns": [{"brif": "t2s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t2s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns1", "route": [{"if": "p1", "ip": "10.1.11.1/24", "ns_if": "t2if", "ns_name": "t2"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t2ns1if", "tenant_ns_ip": "10.1.11.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s1if", "tenant_sub_ip": "10.1.11.2/24"}], "vxlan": [{"dev": "t2s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.11.2", "remote_ip": "10.2.11.2", "remote_route": "10.2.11.0/24", "subnet_route": "10.1.11.0/24", "tenant_route_ip": "192.168.2.2", "v_name": "vxlan_t2s1"}]}, {"brif": "t2br1if1", "disk": "10G", "mem": 2, "name": "t2_VM1", "vcpu": 4, "vmif": "t2VM1if1"}], "md5sum": "b977a19124b65f2d544ddc62e407114d", "mode": "0644", "owner": "root", "size": 10739318784, "src": "/root/.ansible/tmp/ansible-tmp-1574049492.35-277765618901124/source", "state": "file", "uid": 0}
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.11.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.1.11.1', u'bridge_name': u't2br1', u'dns': [{u'dnsif': u't2s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't2s1_dnsbrif'}], u'ns_name': u't2ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.11.2/24', u'tenant_ns_ip': u'10.1.11.1/24', u'tenant_ns_if': u't2ns1if', u'tenant_sub_if': u't2s1if', u'tenant_ns_name': u't2'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.1.11.2', u'dsport': 4789, u'dev': u't2s1if', u'tenant_route_ip': u'192.168.2.2', u'remote_route': u'10.2.11.0/24', u'subnet_route': u'10.1.11.0/24', u'v_name': u'vxlan_t2s1', u'id': 42, u'remote_ip': u'10.2.11.2'}]}, {u'mem': 4, u'name': u't2_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't2br1if2', u'vmif': u't2VM2if1'}]) => {"ansible_loop_var": "item", "changed": true, "checksum": "d86d5962370fcd0c3d05943fc209d9e05fdac89f", "dest": "/var/lib/libvirt/images/t2_VM2.qcow2", "gid": 0, "group": "root", "item": [{"bridge_name": "t2br1", "default_route_ip": "10.1.11.1", "dns": [{"brif": "t2s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t2s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns1", "route": [{"if": "p1", "ip": "10.1.11.1/24", "ns_if": "t2if", "ns_name": "t2"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t2ns1if", "tenant_ns_ip": "10.1.11.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s1if", "tenant_sub_ip": "10.1.11.2/24"}], "vxlan": [{"dev": "t2s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.11.2", "remote_ip": "10.2.11.2", "remote_route": "10.2.11.0/24", "subnet_route": "10.1.11.0/24", "tenant_route_ip": "192.168.2.2", "v_name": "vxlan_t2s1"}]}, {"brif": "t2br1if2", "disk": "10G", "mem": 4, "name": "t2_VM2", "vcpu": 2, "vmif": "t2VM2if1"}], "md5sum": "b977a19124b65f2d544ddc62e407114d", "mode": "0644", "owner": "root", "size": 10739318784, "src": "/root/.ansible/tmp/ansible-tmp-1574049591.52-99425577500211/source", "state": "file", "uid": 0}
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.12.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.1.12.1', u'bridge_name': u't2br2', u'dns': [{u'dnsif': u't2s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't2s2_dnsbrif'}], u'ns_name': u't2ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.12.2/24', u'tenant_ns_ip': u'10.1.12.1/24', u'tenant_ns_if': u't2ns2if', u'tenant_sub_if': u't2s2if', u'tenant_ns_name': u't2'}], u'subnet_ip': u'2.2.2.0/24', u'vxlan': [{u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}, {u'mem': 3, u'name': u't2_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't2br2if1', u'vmif': u't2VM3if1'}]) => {"ansible_loop_var": "item", "changed": true, "checksum": "d86d5962370fcd0c3d05943fc209d9e05fdac89f", "dest": "/var/lib/libvirt/images/t2_VM3.qcow2", "gid": 0, "group": "root", "item": [{"bridge_name": "t2br2", "default_route_ip": "10.1.12.1", "dns": [{"brif": "t2s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t2s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns2", "route": [{"if": "p1", "ip": "10.1.12.1/24", "ns_if": "t2if", "ns_name": "t2"}], "subnet_ip": "2.2.2.0/24", "tenant_ns": [{"tenant_ns_if": "t2ns2if", "tenant_ns_ip": "10.1.12.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s2if", "tenant_sub_ip": "10.1.12.2/24"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, {"brif": "t2br2if1", "disk": "10G", "mem": 3, "name": "t2_VM3", "vcpu": 2, "vmif": "t2VM3if1"}], "md5sum": "b977a19124b65f2d544ddc62e407114d", "mode": "0644", "owner": "root", "size": 10739318784, "src": "/root/.ansible/tmp/ansible-tmp-1574049677.93-224810584280401/source", "state": "file", "uid": 0}

TASK [Create VM templates (C1)] *****************************************************************************************************************************
ok: [localhost] => (item=[{u'route': [{u'ip': u'10.1.11.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.1.11.1', u'bridge_name': u't2br1', u'dns': [{u'dnsif': u't2s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't2s1_dnsbrif'}], u'ns_name': u't2ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.11.2/24', u'tenant_ns_ip': u'10.1.11.1/24', u'tenant_ns_if': u't2ns1if', u'tenant_sub_if': u't2s1if', u'tenant_ns_name': u't2'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.1.11.2', u'dsport': 4789, u'dev': u't2s1if', u'tenant_route_ip': u'192.168.2.2', u'remote_route': u'10.2.11.0/24', u'subnet_route': u'10.1.11.0/24', u'v_name': u'vxlan_t2s1', u'id': 42, u'remote_ip': u'10.2.11.2'}]}, {u'mem': 2, u'name': u't2_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't2br1if1', u'vmif': u't2VM1if1'}]) => {"ansible_loop_var": "item", "changed": false, "checksum": "350ba870bd31b7f6ee517845c14237910b5af0bf", "dest": "/root/Migration-as-a-Service/t2/VM_templates/t2_VM1.xml.j2", "gid": 0, "group": "root", "item": [{"bridge_name": "t2br1", "default_route_ip": "10.1.11.1", "dns": [{"brif": "t2s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t2s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns1", "route": [{"if": "p1", "ip": "10.1.11.1/24", "ns_if": "t2if", "ns_name": "t2"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t2ns1if", "tenant_ns_ip": "10.1.11.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s1if", "tenant_sub_ip": "10.1.11.2/24"}], "vxlan": [{"dev": "t2s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.11.2", "remote_ip": "10.2.11.2", "remote_route": "10.2.11.0/24", "subnet_route": "10.1.11.0/24", "tenant_route_ip": "192.168.2.2", "v_name": "vxlan_t2s1"}]}, {"brif": "t2br1if1", "disk": "10G", "mem": 2, "name": "t2_VM1", "vcpu": 4, "vmif": "t2VM1if1"}], "mode": "0644", "owner": "root", "path": "/root/Migration-as-a-Service/t2/VM_templates/t2_VM1.xml.j2", "size": 4091, "state": "file", "uid": 0}
ok: [localhost] => (item=[{u'route': [{u'ip': u'10.1.11.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.1.11.1', u'bridge_name': u't2br1', u'dns': [{u'dnsif': u't2s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't2s1_dnsbrif'}], u'ns_name': u't2ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.11.2/24', u'tenant_ns_ip': u'10.1.11.1/24', u'tenant_ns_if': u't2ns1if', u'tenant_sub_if': u't2s1if', u'tenant_ns_name': u't2'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.1.11.2', u'dsport': 4789, u'dev': u't2s1if', u'tenant_route_ip': u'192.168.2.2', u'remote_route': u'10.2.11.0/24', u'subnet_route': u'10.1.11.0/24', u'v_name': u'vxlan_t2s1', u'id': 42, u'remote_ip': u'10.2.11.2'}]}, {u'mem': 4, u'name': u't2_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't2br1if2', u'vmif': u't2VM2if1'}]) => {"ansible_loop_var": "item", "changed": false, "checksum": "350ba870bd31b7f6ee517845c14237910b5af0bf", "dest": "/root/Migration-as-a-Service/t2/VM_templates/t2_VM2.xml.j2", "gid": 0, "group": "root", "item": [{"bridge_name": "t2br1", "default_route_ip": "10.1.11.1", "dns": [{"brif": "t2s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t2s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns1", "route": [{"if": "p1", "ip": "10.1.11.1/24", "ns_if": "t2if", "ns_name": "t2"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t2ns1if", "tenant_ns_ip": "10.1.11.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s1if", "tenant_sub_ip": "10.1.11.2/24"}], "vxlan": [{"dev": "t2s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.11.2", "remote_ip": "10.2.11.2", "remote_route": "10.2.11.0/24", "subnet_route": "10.1.11.0/24", "tenant_route_ip": "192.168.2.2", "v_name": "vxlan_t2s1"}]}, {"brif": "t2br1if2", "disk": "10G", "mem": 4, "name": "t2_VM2", "vcpu": 2, "vmif": "t2VM2if1"}], "mode": "0644", "owner": "root", "path": "/root/Migration-as-a-Service/t2/VM_templates/t2_VM2.xml.j2", "size": 4091, "state": "file", "uid": 0}
ok: [localhost] => (item=[{u'route': [{u'ip': u'10.1.12.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.1.12.1', u'bridge_name': u't2br2', u'dns': [{u'dnsif': u't2s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't2s2_dnsbrif'}], u'ns_name': u't2ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.12.2/24', u'tenant_ns_ip': u'10.1.12.1/24', u'tenant_ns_if': u't2ns2if', u'tenant_sub_if': u't2s2if', u'tenant_ns_name': u't2'}], u'subnet_ip': u'2.2.2.0/24', u'vxlan': [{u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}, {u'mem': 3, u'name': u't2_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't2br2if1', u'vmif': u't2VM3if1'}]) => {"ansible_loop_var": "item", "changed": false, "checksum": "350ba870bd31b7f6ee517845c14237910b5af0bf", "dest": "/root/Migration-as-a-Service/t2/VM_templates/t2_VM3.xml.j2", "gid": 0, "group": "root", "item": [{"bridge_name": "t2br2", "default_route_ip": "10.1.12.1", "dns": [{"brif": "t2s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t2s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns2", "route": [{"if": "p1", "ip": "10.1.12.1/24", "ns_if": "t2if", "ns_name": "t2"}], "subnet_ip": "2.2.2.0/24", "tenant_ns": [{"tenant_ns_if": "t2ns2if", "tenant_ns_ip": "10.1.12.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s2if", "tenant_sub_ip": "10.1.12.2/24"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, {"brif": "t2br2if1", "disk": "10G", "mem": 3, "name": "t2_VM3", "vcpu": 2, "vmif": "t2VM3if1"}], "mode": "0644", "owner": "root", "path": "/root/Migration-as-a-Service/t2/VM_templates/t2_VM3.xml.j2", "size": 4091, "state": "file", "uid": 0}

TASK [Get list of running VMs] ******************************************************************************************************************************
ok: [localhost] => {"changed": false, "cmd": ["virsh", "list", "--name"], "delta": "0:00:00.044987", "end": "2019-11-18 04:03:06.051266", "rc": 0, "start": "2019-11-18 04:03:06.006279", "stderr": "", "stderr_lines": [], "stdout": "t1_VM2\nt1_VM3", "stdout_lines": ["t1_VM2", "t1_VM3"]}

TASK [Define VM] ********************************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.11.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.1.11.1', u'bridge_name': u't2br1', u'dns': [{u'dnsif': u't2s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't2s1_dnsbrif'}], u'ns_name': u't2ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.11.2/24', u'tenant_ns_ip': u'10.1.11.1/24', u'tenant_ns_if': u't2ns1if', u'tenant_sub_if': u't2s1if', u'tenant_ns_name': u't2'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.1.11.2', u'dsport': 4789, u'dev': u't2s1if', u'tenant_route_ip': u'192.168.2.2', u'remote_route': u'10.2.11.0/24', u'subnet_route': u'10.1.11.0/24', u'v_name': u'vxlan_t2s1', u'id': 42, u'remote_ip': u'10.2.11.2'}]}, {u'mem': 2, u'name': u't2_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't2br1if1', u'vmif': u't2VM1if1'}]) => {"ansible_loop_var": "item", "changed": true, "created": "t2_VM1", "item": [{"bridge_name": "t2br1", "default_route_ip": "10.1.11.1", "dns": [{"brif": "t2s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t2s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns1", "route": [{"if": "p1", "ip": "10.1.11.1/24", "ns_if": "t2if", "ns_name": "t2"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t2ns1if", "tenant_ns_ip": "10.1.11.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s1if", "tenant_sub_ip": "10.1.11.2/24"}], "vxlan": [{"dev": "t2s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.11.2", "remote_ip": "10.2.11.2", "remote_route": "10.2.11.0/24", "subnet_route": "10.1.11.0/24", "tenant_route_ip": "192.168.2.2", "v_name": "vxlan_t2s1"}]}, {"brif": "t2br1if1", "disk": "10G", "mem": 2, "name": "t2_VM1", "vcpu": 4, "vmif": "t2VM1if1"}], "warnings": ["'xml' is given - ignoring 'name'"]}
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.11.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.1.11.1', u'bridge_name': u't2br1', u'dns': [{u'dnsif': u't2s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't2s1_dnsbrif'}], u'ns_name': u't2ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.11.2/24', u'tenant_ns_ip': u'10.1.11.1/24', u'tenant_ns_if': u't2ns1if', u'tenant_sub_if': u't2s1if', u'tenant_ns_name': u't2'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.1.11.2', u'dsport': 4789, u'dev': u't2s1if', u'tenant_route_ip': u'192.168.2.2', u'remote_route': u'10.2.11.0/24', u'subnet_route': u'10.1.11.0/24', u'v_name': u'vxlan_t2s1', u'id': 42, u'remote_ip': u'10.2.11.2'}]}, {u'mem': 4, u'name': u't2_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't2br1if2', u'vmif': u't2VM2if1'}]) => {"ansible_loop_var": "item", "changed": true, "created": "t2_VM2", "item": [{"bridge_name": "t2br1", "default_route_ip": "10.1.11.1", "dns": [{"brif": "t2s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t2s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns1", "route": [{"if": "p1", "ip": "10.1.11.1/24", "ns_if": "t2if", "ns_name": "t2"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t2ns1if", "tenant_ns_ip": "10.1.11.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s1if", "tenant_sub_ip": "10.1.11.2/24"}], "vxlan": [{"dev": "t2s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.11.2", "remote_ip": "10.2.11.2", "remote_route": "10.2.11.0/24", "subnet_route": "10.1.11.0/24", "tenant_route_ip": "192.168.2.2", "v_name": "vxlan_t2s1"}]}, {"brif": "t2br1if2", "disk": "10G", "mem": 4, "name": "t2_VM2", "vcpu": 2, "vmif": "t2VM2if1"}], "warnings": ["'xml' is given - ignoring 'name'"]}
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.12.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.1.12.1', u'bridge_name': u't2br2', u'dns': [{u'dnsif': u't2s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't2s2_dnsbrif'}], u'ns_name': u't2ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.12.2/24', u'tenant_ns_ip': u'10.1.12.1/24', u'tenant_ns_if': u't2ns2if', u'tenant_sub_if': u't2s2if', u'tenant_ns_name': u't2'}], u'subnet_ip': u'2.2.2.0/24', u'vxlan': [{u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}, {u'mem': 3, u'name': u't2_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't2br2if1', u'vmif': u't2VM3if1'}]) => {"ansible_loop_var": "item", "changed": true, "created": "t2_VM3", "item": [{"bridge_name": "t2br2", "default_route_ip": "10.1.12.1", "dns": [{"brif": "t2s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t2s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns2", "route": [{"if": "p1", "ip": "10.1.12.1/24", "ns_if": "t2if", "ns_name": "t2"}], "subnet_ip": "2.2.2.0/24", "tenant_ns": [{"tenant_ns_if": "t2ns2if", "tenant_ns_ip": "10.1.12.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s2if", "tenant_sub_ip": "10.1.12.2/24"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, {"brif": "t2br2if1", "disk": "10G", "mem": 3, "name": "t2_VM3", "vcpu": 2, "vmif": "t2VM3if1"}], "warnings": ["'xml' is given - ignoring 'name'"]}

TASK [Create VM] ********************************************************************************************************************************************
ok: [localhost] => (item=[{u'route': [{u'ip': u'10.1.11.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.1.11.1', u'bridge_name': u't2br1', u'dns': [{u'dnsif': u't2s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't2s1_dnsbrif'}], u'ns_name': u't2ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.11.2/24', u'tenant_ns_ip': u'10.1.11.1/24', u'tenant_ns_if': u't2ns1if', u'tenant_sub_if': u't2s1if', u'tenant_ns_name': u't2'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.1.11.2', u'dsport': 4789, u'dev': u't2s1if', u'tenant_route_ip': u'192.168.2.2', u'remote_route': u'10.2.11.0/24', u'subnet_route': u'10.1.11.0/24', u'v_name': u'vxlan_t2s1', u'id': 42, u'remote_ip': u'10.2.11.2'}]}, {u'mem': 2, u'name': u't2_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't2br1if1', u'vmif': u't2VM1if1'}]) => {"ansible_loop_var": "item", "changed": false, "create": 0, "item": [{"bridge_name": "t2br1", "default_route_ip": "10.1.11.1", "dns": [{"brif": "t2s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t2s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns1", "route": [{"if": "p1", "ip": "10.1.11.1/24", "ns_if": "t2if", "ns_name": "t2"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t2ns1if", "tenant_ns_ip": "10.1.11.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s1if", "tenant_sub_ip": "10.1.11.2/24"}], "vxlan": [{"dev": "t2s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.11.2", "remote_ip": "10.2.11.2", "remote_route": "10.2.11.0/24", "subnet_route": "10.1.11.0/24", "tenant_route_ip": "192.168.2.2", "v_name": "vxlan_t2s1"}]}, {"brif": "t2br1if1", "disk": "10G", "mem": 2, "name": "t2_VM1", "vcpu": 4, "vmif": "t2VM1if1"}]}
ok: [localhost] => (item=[{u'route': [{u'ip': u'10.1.11.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.1.11.1', u'bridge_name': u't2br1', u'dns': [{u'dnsif': u't2s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't2s1_dnsbrif'}], u'ns_name': u't2ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.11.2/24', u'tenant_ns_ip': u'10.1.11.1/24', u'tenant_ns_if': u't2ns1if', u'tenant_sub_if': u't2s1if', u'tenant_ns_name': u't2'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.1.11.2', u'dsport': 4789, u'dev': u't2s1if', u'tenant_route_ip': u'192.168.2.2', u'remote_route': u'10.2.11.0/24', u'subnet_route': u'10.1.11.0/24', u'v_name': u'vxlan_t2s1', u'id': 42, u'remote_ip': u'10.2.11.2'}]}, {u'mem': 4, u'name': u't2_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't2br1if2', u'vmif': u't2VM2if1'}]) => {"ansible_loop_var": "item", "changed": false, "create": 0, "item": [{"bridge_name": "t2br1", "default_route_ip": "10.1.11.1", "dns": [{"brif": "t2s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t2s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns1", "route": [{"if": "p1", "ip": "10.1.11.1/24", "ns_if": "t2if", "ns_name": "t2"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t2ns1if", "tenant_ns_ip": "10.1.11.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s1if", "tenant_sub_ip": "10.1.11.2/24"}], "vxlan": [{"dev": "t2s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.11.2", "remote_ip": "10.2.11.2", "remote_route": "10.2.11.0/24", "subnet_route": "10.1.11.0/24", "tenant_route_ip": "192.168.2.2", "v_name": "vxlan_t2s1"}]}, {"brif": "t2br1if2", "disk": "10G", "mem": 4, "name": "t2_VM2", "vcpu": 2, "vmif": "t2VM2if1"}]}
ok: [localhost] => (item=[{u'route': [{u'ip': u'10.1.12.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.1.12.1', u'bridge_name': u't2br2', u'dns': [{u'dnsif': u't2s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't2s2_dnsbrif'}], u'ns_name': u't2ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.12.2/24', u'tenant_ns_ip': u'10.1.12.1/24', u'tenant_ns_if': u't2ns2if', u'tenant_sub_if': u't2s2if', u'tenant_ns_name': u't2'}], u'subnet_ip': u'2.2.2.0/24', u'vxlan': [{u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}, {u'mem': 3, u'name': u't2_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't2br2if1', u'vmif': u't2VM3if1'}]) => {"ansible_loop_var": "item", "changed": false, "create": 0, "item": [{"bridge_name": "t2br2", "default_route_ip": "10.1.12.1", "dns": [{"brif": "t2s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t2s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns2", "route": [{"if": "p1", "ip": "10.1.12.1/24", "ns_if": "t2if", "ns_name": "t2"}], "subnet_ip": "2.2.2.0/24", "tenant_ns": [{"tenant_ns_if": "t2ns2if", "tenant_ns_ip": "10.1.12.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s2if", "tenant_sub_ip": "10.1.12.2/24"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, {"brif": "t2br2if1", "disk": "10G", "mem": 3, "name": "t2_VM3", "vcpu": 2, "vmif": "t2VM3if1"}]}

TASK [Start VM] *********************************************************************************************************************************************
ok: [localhost] => (item=[{u'route': [{u'ip': u'10.1.11.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.1.11.1', u'bridge_name': u't2br1', u'dns': [{u'dnsif': u't2s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't2s1_dnsbrif'}], u'ns_name': u't2ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.11.2/24', u'tenant_ns_ip': u'10.1.11.1/24', u'tenant_ns_if': u't2ns1if', u'tenant_sub_if': u't2s1if', u'tenant_ns_name': u't2'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.1.11.2', u'dsport': 4789, u'dev': u't2s1if', u'tenant_route_ip': u'192.168.2.2', u'remote_route': u'10.2.11.0/24', u'subnet_route': u'10.1.11.0/24', u'v_name': u'vxlan_t2s1', u'id': 42, u'remote_ip': u'10.2.11.2'}]}, {u'mem': 2, u'name': u't2_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't2br1if1', u'vmif': u't2VM1if1'}]) => {"ansible_loop_var": "item", "changed": false, "item": [{"bridge_name": "t2br1", "default_route_ip": "10.1.11.1", "dns": [{"brif": "t2s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t2s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns1", "route": [{"if": "p1", "ip": "10.1.11.1/24", "ns_if": "t2if", "ns_name": "t2"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t2ns1if", "tenant_ns_ip": "10.1.11.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s1if", "tenant_sub_ip": "10.1.11.2/24"}], "vxlan": [{"dev": "t2s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.11.2", "remote_ip": "10.2.11.2", "remote_route": "10.2.11.0/24", "subnet_route": "10.1.11.0/24", "tenant_route_ip": "192.168.2.2", "v_name": "vxlan_t2s1"}]}, {"brif": "t2br1if1", "disk": "10G", "mem": 2, "name": "t2_VM1", "vcpu": 4, "vmif": "t2VM1if1"}]}
ok: [localhost] => (item=[{u'route': [{u'ip': u'10.1.11.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.1.11.1', u'bridge_name': u't2br1', u'dns': [{u'dnsif': u't2s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't2s1_dnsbrif'}], u'ns_name': u't2ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.11.2/24', u'tenant_ns_ip': u'10.1.11.1/24', u'tenant_ns_if': u't2ns1if', u'tenant_sub_if': u't2s1if', u'tenant_ns_name': u't2'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.1.11.2', u'dsport': 4789, u'dev': u't2s1if', u'tenant_route_ip': u'192.168.2.2', u'remote_route': u'10.2.11.0/24', u'subnet_route': u'10.1.11.0/24', u'v_name': u'vxlan_t2s1', u'id': 42, u'remote_ip': u'10.2.11.2'}]}, {u'mem': 4, u'name': u't2_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't2br1if2', u'vmif': u't2VM2if1'}]) => {"ansible_loop_var": "item", "changed": false, "item": [{"bridge_name": "t2br1", "default_route_ip": "10.1.11.1", "dns": [{"brif": "t2s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t2s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns1", "route": [{"if": "p1", "ip": "10.1.11.1/24", "ns_if": "t2if", "ns_name": "t2"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t2ns1if", "tenant_ns_ip": "10.1.11.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s1if", "tenant_sub_ip": "10.1.11.2/24"}], "vxlan": [{"dev": "t2s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.11.2", "remote_ip": "10.2.11.2", "remote_route": "10.2.11.0/24", "subnet_route": "10.1.11.0/24", "tenant_route_ip": "192.168.2.2", "v_name": "vxlan_t2s1"}]}, {"brif": "t2br1if2", "disk": "10G", "mem": 4, "name": "t2_VM2", "vcpu": 2, "vmif": "t2VM2if1"}]}
ok: [localhost] => (item=[{u'route': [{u'ip': u'10.1.12.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.1.12.1', u'bridge_name': u't2br2', u'dns': [{u'dnsif': u't2s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't2s2_dnsbrif'}], u'ns_name': u't2ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.12.2/24', u'tenant_ns_ip': u'10.1.12.1/24', u'tenant_ns_if': u't2ns2if', u'tenant_sub_if': u't2s2if', u'tenant_ns_name': u't2'}], u'subnet_ip': u'2.2.2.0/24', u'vxlan': [{u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}, {u'mem': 3, u'name': u't2_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't2br2if1', u'vmif': u't2VM3if1'}]) => {"ansible_loop_var": "item", "changed": false, "item": [{"bridge_name": "t2br2", "default_route_ip": "10.1.12.1", "dns": [{"brif": "t2s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t2s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns2", "route": [{"if": "p1", "ip": "10.1.12.1/24", "ns_if": "t2if", "ns_name": "t2"}], "subnet_ip": "2.2.2.0/24", "tenant_ns": [{"tenant_ns_if": "t2ns2if", "tenant_ns_ip": "10.1.12.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s2if", "tenant_sub_ip": "10.1.12.2/24"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, {"brif": "t2br2if1", "disk": "10G", "mem": 3, "name": "t2_VM3", "vcpu": 2, "vmif": "t2VM3if1"}]}

TASK [Attach VM interface] **********************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.11.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.1.11.1', u'bridge_name': u't2br1', u'dns': [{u'dnsif': u't2s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't2s1_dnsbrif'}], u'ns_name': u't2ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.11.2/24', u'tenant_ns_ip': u'10.1.11.1/24', u'tenant_ns_if': u't2ns1if', u'tenant_sub_if': u't2s1if', u'tenant_ns_name': u't2'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.1.11.2', u'dsport': 4789, u'dev': u't2s1if', u'tenant_route_ip': u'192.168.2.2', u'remote_route': u'10.2.11.0/24', u'subnet_route': u'10.1.11.0/24', u'v_name': u'vxlan_t2s1', u'id': 42, u'remote_ip': u'10.2.11.2'}]}, {u'mem': 2, u'name': u't2_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't2br1if1', u'vmif': u't2VM1if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "virsh domiflist \"t2_VM1\" | grep -w 't2VM1if1' ; if [ $? -ne 0 ] ; then virsh attach-interface \"t2_VM1\" direct \"t2VM1if1\" --live --persistent ; fi\n", "delta": "0:00:00.275285", "end": "2019-11-18 04:03:15.245761", "item": [{"bridge_name": "t2br1", "default_route_ip": "10.1.11.1", "dns": [{"brif": "t2s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t2s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns1", "route": [{"if": "p1", "ip": "10.1.11.1/24", "ns_if": "t2if", "ns_name": "t2"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t2ns1if", "tenant_ns_ip": "10.1.11.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s1if", "tenant_sub_ip": "10.1.11.2/24"}], "vxlan": [{"dev": "t2s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.11.2", "remote_ip": "10.2.11.2", "remote_route": "10.2.11.0/24", "subnet_route": "10.1.11.0/24", "tenant_route_ip": "192.168.2.2", "v_name": "vxlan_t2s1"}]}, {"brif": "t2br1if1", "disk": "10G", "mem": 2, "name": "t2_VM1", "vcpu": 4, "vmif": "t2VM1if1"}], "rc": 0, "start": "2019-11-18 04:03:14.970476", "stderr": "", "stderr_lines": [], "stdout": "Interface attached successfully", "stdout_lines": ["Interface attached successfully"]}
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.11.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.1.11.1', u'bridge_name': u't2br1', u'dns': [{u'dnsif': u't2s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't2s1_dnsbrif'}], u'ns_name': u't2ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.11.2/24', u'tenant_ns_ip': u'10.1.11.1/24', u'tenant_ns_if': u't2ns1if', u'tenant_sub_if': u't2s1if', u'tenant_ns_name': u't2'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.1.11.2', u'dsport': 4789, u'dev': u't2s1if', u'tenant_route_ip': u'192.168.2.2', u'remote_route': u'10.2.11.0/24', u'subnet_route': u'10.1.11.0/24', u'v_name': u'vxlan_t2s1', u'id': 42, u'remote_ip': u'10.2.11.2'}]}, {u'mem': 4, u'name': u't2_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't2br1if2', u'vmif': u't2VM2if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "virsh domiflist \"t2_VM2\" | grep -w 't2VM2if1' ; if [ $? -ne 0 ] ; then virsh attach-interface \"t2_VM2\" direct \"t2VM2if1\" --live --persistent ; fi\n", "delta": "0:00:00.255949", "end": "2019-11-18 04:03:15.667640", "item": [{"bridge_name": "t2br1", "default_route_ip": "10.1.11.1", "dns": [{"brif": "t2s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t2s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns1", "route": [{"if": "p1", "ip": "10.1.11.1/24", "ns_if": "t2if", "ns_name": "t2"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t2ns1if", "tenant_ns_ip": "10.1.11.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s1if", "tenant_sub_ip": "10.1.11.2/24"}], "vxlan": [{"dev": "t2s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.11.2", "remote_ip": "10.2.11.2", "remote_route": "10.2.11.0/24", "subnet_route": "10.1.11.0/24", "tenant_route_ip": "192.168.2.2", "v_name": "vxlan_t2s1"}]}, {"brif": "t2br1if2", "disk": "10G", "mem": 4, "name": "t2_VM2", "vcpu": 2, "vmif": "t2VM2if1"}], "rc": 0, "start": "2019-11-18 04:03:15.411691", "stderr": "", "stderr_lines": [], "stdout": "Interface attached successfully", "stdout_lines": ["Interface attached successfully"]}
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.12.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.1.12.1', u'bridge_name': u't2br2', u'dns': [{u'dnsif': u't2s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't2s2_dnsbrif'}], u'ns_name': u't2ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.12.2/24', u'tenant_ns_ip': u'10.1.12.1/24', u'tenant_ns_if': u't2ns2if', u'tenant_sub_if': u't2s2if', u'tenant_ns_name': u't2'}], u'subnet_ip': u'2.2.2.0/24', u'vxlan': [{u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}, {u'mem': 3, u'name': u't2_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't2br2if1', u'vmif': u't2VM3if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "virsh domiflist \"t2_VM3\" | grep -w 't2VM3if1' ; if [ $? -ne 0 ] ; then virsh attach-interface \"t2_VM3\" direct \"t2VM3if1\" --live --persistent ; fi\n", "delta": "0:00:00.220292", "end": "2019-11-18 04:03:16.019799", "item": [{"bridge_name": "t2br2", "default_route_ip": "10.1.12.1", "dns": [{"brif": "t2s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t2s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns2", "route": [{"if": "p1", "ip": "10.1.12.1/24", "ns_if": "t2if", "ns_name": "t2"}], "subnet_ip": "2.2.2.0/24", "tenant_ns": [{"tenant_ns_if": "t2ns2if", "tenant_ns_ip": "10.1.12.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s2if", "tenant_sub_ip": "10.1.12.2/24"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, {"brif": "t2br2if1", "disk": "10G", "mem": 3, "name": "t2_VM3", "vcpu": 2, "vmif": "t2VM3if1"}], "rc": 0, "start": "2019-11-18 04:03:15.799507", "stderr": "", "stderr_lines": [], "stdout": "Interface attached successfully", "stdout_lines": ["Interface attached successfully"]}

PLAY RECAP **************************************************************************************************************************************************
localhost                  : ok=7    changed=3    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0   

Using /etc/ansible/ansible.cfg as config file

PLAY [worker] ***********************************************************************************************************************************************

TASK [Copy VM image] ****************************************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.11.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.2.11.1', u'bridge_name': u't2br1', u'dns': [{u'dnsif': u't2s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't2s1_dnsbrif'}], u'ns_name': u't2ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.11.2/24', u'tenant_ns_ip': u'10.2.11.1/24', u'tenant_ns_if': u't2ns1if', u'tenant_sub_if': u't2s1if', u'tenant_ns_name': u't2'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.2.11.2', u'dsport': 4789, u'dev': u't2s1if', u'tenant_route_ip': u'192.168.130.2', u'remote_route': u'10.1.11.0/24', u'subnet_route': u'10.2.11.0/24', u'v_name': u'vxlan_t2s1', u'id': 42, u'remote_ip': u'10.1.11.2'}]}, {u'mem': 2, u'name': u't2_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't2br1if1', u'vmif': u't2VM4if1'}]) => {"ansible_loop_var": "item", "changed": true, "checksum": "f8b2ffa2bf201c84196c582f2dec0d33a1eb4b42", "dest": "/var/lib/libvirt/images/t2_VM4.qcow2", "gid": 0, "group": "root", "item": [{"bridge_name": "t2br1", "default_route_ip": "10.2.11.1", "dns": [{"brif": "t2s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t2s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns1", "route": [{"if": "p1", "ip": "10.2.11.1/24", "ns_if": "t2if", "ns_name": "t2"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t2ns1if", "tenant_ns_ip": "10.2.11.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s1if", "tenant_sub_ip": "10.2.11.2/24"}], "vxlan": [{"dev": "t2s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.11.2", "remote_ip": "10.1.11.2", "remote_route": "10.1.11.0/24", "subnet_route": "10.2.11.0/24", "tenant_route_ip": "192.168.130.2", "v_name": "vxlan_t2s1"}]}, {"brif": "t2br1if1", "disk": "10G", "mem": 2, "name": "t2_VM4", "vcpu": 4, "vmif": "t2VM4if1"}], "md5sum": "e6d5d524b68797ddd748ba1475985d34", "mode": "0644", "owner": "root", "size": 10739318784, "src": "/root/mainVM.qcow2", "state": "file", "uid": 0}

TASK [Get list of running VMs] ******************************************************************************************************************************
ok: [99.99.99.2] => {"changed": false, "cmd": ["virsh", "list", "--name"], "delta": "0:00:00.790606", "end": "2019-11-18 04:05:22.819855", "rc": 0, "start": "2019-11-18 04:05:22.029249", "stderr": "", "stderr_lines": [], "stdout": "t1_VM4\nt1_VM1", "stdout_lines": ["t1_VM4", "t1_VM1"]}

TASK [Define VM] ********************************************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.11.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.2.11.1', u'bridge_name': u't2br1', u'dns': [{u'dnsif': u't2s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't2s1_dnsbrif'}], u'ns_name': u't2ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.11.2/24', u'tenant_ns_ip': u'10.2.11.1/24', u'tenant_ns_if': u't2ns1if', u'tenant_sub_if': u't2s1if', u'tenant_ns_name': u't2'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.2.11.2', u'dsport': 4789, u'dev': u't2s1if', u'tenant_route_ip': u'192.168.130.2', u'remote_route': u'10.1.11.0/24', u'subnet_route': u'10.2.11.0/24', u'v_name': u'vxlan_t2s1', u'id': 42, u'remote_ip': u'10.1.11.2'}]}, {u'mem': 2, u'name': u't2_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't2br1if1', u'vmif': u't2VM4if1'}]) => {"ansible_loop_var": "item", "changed": true, "created": "t2_VM4", "item": [{"bridge_name": "t2br1", "default_route_ip": "10.2.11.1", "dns": [{"brif": "t2s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t2s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns1", "route": [{"if": "p1", "ip": "10.2.11.1/24", "ns_if": "t2if", "ns_name": "t2"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t2ns1if", "tenant_ns_ip": "10.2.11.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s1if", "tenant_sub_ip": "10.2.11.2/24"}], "vxlan": [{"dev": "t2s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.11.2", "remote_ip": "10.1.11.2", "remote_route": "10.1.11.0/24", "subnet_route": "10.2.11.0/24", "tenant_route_ip": "192.168.130.2", "v_name": "vxlan_t2s1"}]}, {"brif": "t2br1if1", "disk": "10G", "mem": 2, "name": "t2_VM4", "vcpu": 4, "vmif": "t2VM4if1"}], "warnings": ["'xml' is given - ignoring 'name'"]}

TASK [Create VM] ********************************************************************************************************************************************
ok: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.11.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.2.11.1', u'bridge_name': u't2br1', u'dns': [{u'dnsif': u't2s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't2s1_dnsbrif'}], u'ns_name': u't2ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.11.2/24', u'tenant_ns_ip': u'10.2.11.1/24', u'tenant_ns_if': u't2ns1if', u'tenant_sub_if': u't2s1if', u'tenant_ns_name': u't2'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.2.11.2', u'dsport': 4789, u'dev': u't2s1if', u'tenant_route_ip': u'192.168.130.2', u'remote_route': u'10.1.11.0/24', u'subnet_route': u'10.2.11.0/24', u'v_name': u'vxlan_t2s1', u'id': 42, u'remote_ip': u'10.1.11.2'}]}, {u'mem': 2, u'name': u't2_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't2br1if1', u'vmif': u't2VM4if1'}]) => {"ansible_loop_var": "item", "changed": false, "create": 0, "item": [{"bridge_name": "t2br1", "default_route_ip": "10.2.11.1", "dns": [{"brif": "t2s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t2s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns1", "route": [{"if": "p1", "ip": "10.2.11.1/24", "ns_if": "t2if", "ns_name": "t2"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t2ns1if", "tenant_ns_ip": "10.2.11.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s1if", "tenant_sub_ip": "10.2.11.2/24"}], "vxlan": [{"dev": "t2s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.11.2", "remote_ip": "10.1.11.2", "remote_route": "10.1.11.0/24", "subnet_route": "10.2.11.0/24", "tenant_route_ip": "192.168.130.2", "v_name": "vxlan_t2s1"}]}, {"brif": "t2br1if1", "disk": "10G", "mem": 2, "name": "t2_VM4", "vcpu": 4, "vmif": "t2VM4if1"}]}

TASK [Start VM] *********************************************************************************************************************************************
ok: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.11.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.2.11.1', u'bridge_name': u't2br1', u'dns': [{u'dnsif': u't2s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't2s1_dnsbrif'}], u'ns_name': u't2ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.11.2/24', u'tenant_ns_ip': u'10.2.11.1/24', u'tenant_ns_if': u't2ns1if', u'tenant_sub_if': u't2s1if', u'tenant_ns_name': u't2'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.2.11.2', u'dsport': 4789, u'dev': u't2s1if', u'tenant_route_ip': u'192.168.130.2', u'remote_route': u'10.1.11.0/24', u'subnet_route': u'10.2.11.0/24', u'v_name': u'vxlan_t2s1', u'id': 42, u'remote_ip': u'10.1.11.2'}]}, {u'mem': 2, u'name': u't2_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't2br1if1', u'vmif': u't2VM4if1'}]) => {"ansible_loop_var": "item", "changed": false, "item": [{"bridge_name": "t2br1", "default_route_ip": "10.2.11.1", "dns": [{"brif": "t2s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t2s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns1", "route": [{"if": "p1", "ip": "10.2.11.1/24", "ns_if": "t2if", "ns_name": "t2"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t2ns1if", "tenant_ns_ip": "10.2.11.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s1if", "tenant_sub_ip": "10.2.11.2/24"}], "vxlan": [{"dev": "t2s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.11.2", "remote_ip": "10.1.11.2", "remote_route": "10.1.11.0/24", "subnet_route": "10.2.11.0/24", "tenant_route_ip": "192.168.130.2", "v_name": "vxlan_t2s1"}]}, {"brif": "t2br1if1", "disk": "10G", "mem": 2, "name": "t2_VM4", "vcpu": 4, "vmif": "t2VM4if1"}]}

TASK [Attach VM interface] **********************************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.11.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.2.11.1', u'bridge_name': u't2br1', u'dns': [{u'dnsif': u't2s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't2s1_dnsbrif'}], u'ns_name': u't2ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.11.2/24', u'tenant_ns_ip': u'10.2.11.1/24', u'tenant_ns_if': u't2ns1if', u'tenant_sub_if': u't2s1if', u'tenant_ns_name': u't2'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.2.11.2', u'dsport': 4789, u'dev': u't2s1if', u'tenant_route_ip': u'192.168.130.2', u'remote_route': u'10.1.11.0/24', u'subnet_route': u'10.2.11.0/24', u'v_name': u'vxlan_t2s1', u'id': 42, u'remote_ip': u'10.1.11.2'}]}, {u'mem': 2, u'name': u't2_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't2br1if1', u'vmif': u't2VM4if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "virsh domiflist \"t2_VM4\" | grep -w 't2VM4if1' ; if [ $? -ne 0 ] ; then virsh attach-interface \"t2_VM4\" direct \"t2VM4if1\" --live --persistent ; fi\n", "delta": "0:00:00.259473", "end": "2019-11-18 04:05:27.038385", "item": [{"bridge_name": "t2br1", "default_route_ip": "10.2.11.1", "dns": [{"brif": "t2s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t2s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns1", "route": [{"if": "p1", "ip": "10.2.11.1/24", "ns_if": "t2if", "ns_name": "t2"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t2ns1if", "tenant_ns_ip": "10.2.11.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s1if", "tenant_sub_ip": "10.2.11.2/24"}], "vxlan": [{"dev": "t2s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.11.2", "remote_ip": "10.1.11.2", "remote_route": "10.1.11.0/24", "subnet_route": "10.2.11.0/24", "tenant_route_ip": "192.168.130.2", "v_name": "vxlan_t2s1"}]}, {"brif": "t2br1if1", "disk": "10G", "mem": 2, "name": "t2_VM4", "vcpu": 4, "vmif": "t2VM4if1"}], "rc": 0, "start": "2019-11-18 04:05:26.778912", "stderr": "", "stderr_lines": [], "stdout": "Interface attached successfully", "stdout_lines": ["Interface attached successfully"]}

PLAY RECAP **************************************************************************************************************************************************
99.99.99.2                 : ok=6    changed=3    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0   

INFO:root: 05:17:00.860447 Printing the yaml input file
INFO:root: 05:17:00.860570 {'C1': [{'subnet_addr': '1.1.1.0/24', 'VM': [{'name': 'VM1', 'disk': '10G', 'mem': 2, 'vcpu': 4, 'internet_access': True}, {'name': 'VM2', 'disk': '10G', 'mem': 4, 'vcpu': 2, 'internet_access': False}]}, {'subnet_addr': '2.2.2.0/24', 'VM': [{'name': 'VM3', 'disk': '10G', 'mem': 3, 'vcpu': 2, 'internet_access': True}]}], 'C2': [{'subnet_addr': '1.1.1.0/24', 'VM': [{'name': 'VM4', 'disk': '10G', 'mem': 2, 'vcpu': 4, 'internet_access': True}]}]}
INFO:root: 05:17:00.860675 Provided subnet in C1: 1.1.1.0/24 is valid
INFO:root: 05:17:00.860743 Provided subnet in C1: 2.2.2.0/24 is valid
INFO:root: 05:17:00.860803 Provided subnet in C2: 1.1.1.0/24 is valid
Using /etc/ansible/ansible.cfg as config file

PLAY [main] *************************************************************************************************************************************************

TASK [Create Tenant Namespace] ******************************************************************************************************************************
changed: [localhost] => (item={u'default_route_ip': u'192.168.1.1', u'name': u't1', u'pns_ip': u'192.168.1.1/24', u'tenant_if': u't1if', u'tenant_ip': u'192.168.1.2/24', u'pns_if': u't1pns_if'}) => {"ansible_loop_var": "item", "changed": true, "cmd": ["ip", "netns", "add", "t1"], "delta": "0:00:00.048296", "end": "2019-11-18 05:17:02.281375", "item": {"default_route_ip": "192.168.1.1", "name": "t1", "pns_if": "t1pns_if", "pns_ip": "192.168.1.1/24", "tenant_if": "t1if", "tenant_ip": "192.168.1.2/24"}, "rc": 0, "start": "2019-11-18 05:17:02.233079", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Create Subnet Namespace] ******************************************************************************************************************************
changed: [localhost] => (item={u'route': [{u'ip': u'10.1.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.1.2/24', u'tenant_ns_ip': u'10.1.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_ns_name': u't1', u'tenant_sub_if': u't1s1if'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't1_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM1if1'}, {u'mem': 4, u'name': u't1_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br1if2', u'vmif': u't1VM2if1'}], u'vxlan': [{u'local_ip': u'10.1.1.2', u'tenant_route_ip': u'192.168.1.2', u'dsport': 4789, u'dev': u't1s1if', u'subnet_route': u'10.1.1.0/24', u'remote_route': u'10.2.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.2.1.2'}]}) => {"ansible_loop_var": "item", "changed": true, "cmd": ["ip", "netns", "add", "t1ns1"], "delta": "0:00:00.053942", "end": "2019-11-18 05:17:02.584307", "item": {"bridge_name": "t1br1", "default_route_ip": "10.1.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.1.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.1.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.1.1.2/24"}], "vms": [{"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM1", "vcpu": 4, "vmif": "t1VM1if1"}, {"brif": "t1br1if2", "disk": "10G", "mem": 4, "name": "t1_VM2", "vcpu": 2, "vmif": "t1VM2if1"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.1.2", "remote_ip": "10.2.1.2", "remote_route": "10.2.1.0/24", "subnet_route": "10.1.1.0/24", "tenant_route_ip": "192.168.1.2", "v_name": "vxlan_t1s1"}]}, "rc": 0, "start": "2019-11-18 05:17:02.530365", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}
changed: [localhost] => (item={u'route': [{u'ip': u'10.1.2.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.2.1', u'bridge_name': u't1br2', u'dns': [{u'dnsif': u't1s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s2_dnsbrif'}], u'ns_name': u't1ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.2.2/24', u'tenant_ns_ip': u'10.1.2.1/24', u'tenant_ns_if': u't1ns2if', u'tenant_ns_name': u't1', u'tenant_sub_if': u't1s2if'}], u'subnet_ip': u'2.2.2.0/24', u'vms': [{u'mem': 3, u'name': u't1_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br2if1', u'vmif': u't1VM3if1'}], u'vxlan': [{u'local_ip': [], u'tenant_route_ip': [], u'dsport': [], u'dev': [], u'subnet_route': [], u'remote_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}) => {"ansible_loop_var": "item", "changed": true, "cmd": ["ip", "netns", "add", "t1ns2"], "delta": "0:00:00.052692", "end": "2019-11-18 05:17:02.839206", "item": {"bridge_name": "t1br2", "default_route_ip": "10.1.2.1", "dns": [{"brif": "t1s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t1s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns2", "route": [{"if": "p1", "ip": "10.1.2.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "2.2.2.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns2if", "tenant_ns_ip": "10.1.2.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s2if", "tenant_sub_ip": "10.1.2.2/24"}], "vms": [{"brif": "t1br2if1", "disk": "10G", "mem": 3, "name": "t1_VM3", "vcpu": 2, "vmif": "t1VM3if1"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, "rc": 0, "start": "2019-11-18 05:17:02.786514", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Create Tenant VETH pairs] *****************************************************************************************************************************
changed: [localhost] => (item={u'default_route_ip': u'192.168.1.1', u'name': u't1', u'pns_ip': u'192.168.1.1/24', u'tenant_if': u't1if', u'tenant_ip': u'192.168.1.2/24', u'pns_if': u't1pns_if'}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip link show \"t1if\" ; if [ $? -ne 0 ] ; then ip link add \"t1if\" type veth peer name \"t1pns_if\" ; fi\n", "delta": "0:00:00.009898", "end": "2019-11-18 05:17:03.119844", "item": {"default_route_ip": "192.168.1.1", "name": "t1", "pns_if": "t1pns_if", "pns_ip": "192.168.1.1/24", "tenant_if": "t1if", "tenant_ip": "192.168.1.2/24"}, "rc": 0, "start": "2019-11-18 05:17:03.109946", "stderr": "Device \"t1if\" does not exist.", "stderr_lines": ["Device \"t1if\" does not exist."], "stdout": "", "stdout_lines": []}

TASK [Attach Tenant VETH Pairs] *****************************************************************************************************************************
changed: [localhost] => (item={u'default_route_ip': u'192.168.1.1', u'name': u't1', u'pns_ip': u'192.168.1.1/24', u'tenant_if': u't1if', u'tenant_ip': u'192.168.1.2/24', u'pns_if': u't1pns_if'}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec pns ip link show \"t1pns_if\" ; if [ $? -ne 0 ] ; then ip link set \"t1pns_if\" netns pns ; fi\nip netns exec \"t1\" ip link show \"t1if\" ; if [ $? -ne 0 ] ; then ip link set \"t1if\" netns \"t1\" ; fi\nip netns exec pns ip link set dev \"t1pns_if\" up\nip netns exec \"t1\" ip link set dev \"t1if\" up\n", "delta": "0:00:00.198146", "end": "2019-11-18 05:17:03.605258", "item": {"default_route_ip": "192.168.1.1", "name": "t1", "pns_if": "t1pns_if", "pns_ip": "192.168.1.1/24", "tenant_if": "t1if", "tenant_ip": "192.168.1.2/24"}, "rc": 0, "start": "2019-11-18 05:17:03.407112", "stderr": "Device \"t1pns_if\" does not exist.\nDevice \"t1if\" does not exist.", "stderr_lines": ["Device \"t1pns_if\" does not exist.", "Device \"t1if\" does not exist."], "stdout": "", "stdout_lines": []}

TASK [Add IP addresses to Tenant VETH Pairs] ****************************************************************************************************************
changed: [localhost] => (item={u'default_route_ip': u'192.168.1.1', u'name': u't1', u'pns_ip': u'192.168.1.1/24', u'tenant_if': u't1if', u'tenant_ip': u'192.168.1.2/24', u'pns_if': u't1pns_if'}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec pns ip addr show \"t1pns_if\" | awk 'FNR==3{ print $2 }' | grep -w '^192.168.1.1/24' ; if [ $? -ne 0 ] ; then ip netns exec pns ip addr add \"192.168.1.1/24\" dev \"t1pns_if\" ; fi\nip netns exec \"t1\" ip addr show \"t1if\" | awk 'FNR==3{ print $2 }' | grep -w '^192.168.1.2/24' ; if [ $? -ne 0 ] ; then ip netns exec \"t1\" ip addr add \"192.168.1.2/24\" dev \"t1if\" ; fi\n", "delta": "0:00:00.151382", "end": "2019-11-18 05:17:04.017241", "item": {"default_route_ip": "192.168.1.1", "name": "t1", "pns_if": "t1pns_if", "pns_ip": "192.168.1.1/24", "tenant_if": "t1if", "tenant_ip": "192.168.1.2/24"}, "rc": 0, "start": "2019-11-18 05:17:03.865859", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Create Namespace VETH Pairs] **************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't1_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM1if1'}, {u'mem': 4, u'name': u't1_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br1if2', u'vmif': u't1VM2if1'}], u'vxlan': [{u'local_ip': u'10.1.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.1.2', u'remote_route': u'10.2.1.0/24', u'subnet_route': u'10.1.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.2.1.2'}]}, {u'tenant_sub_ip': u'10.1.1.2/24', u'tenant_ns_ip': u'10.1.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip link show \"t1ns1if\" ; if [ $? -ne 0 ] ; then ip link add \"t1ns1if\" type veth peer name \"t1s1if\" ; fi\n", "delta": "0:00:00.010056", "end": "2019-11-18 05:17:04.289015", "item": [{"bridge_name": "t1br1", "default_route_ip": "10.1.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.1.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "vms": [{"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM1", "vcpu": 4, "vmif": "t1VM1if1"}, {"brif": "t1br1if2", "disk": "10G", "mem": 4, "name": "t1_VM2", "vcpu": 2, "vmif": "t1VM2if1"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.1.2", "remote_ip": "10.2.1.2", "remote_route": "10.2.1.0/24", "subnet_route": "10.1.1.0/24", "tenant_route_ip": "192.168.1.2", "v_name": "vxlan_t1s1"}]}, {"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.1.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.1.1.2/24"}], "rc": 0, "start": "2019-11-18 05:17:04.278959", "stderr": "Device \"t1ns1if\" does not exist.", "stderr_lines": ["Device \"t1ns1if\" does not exist."], "stdout": "", "stdout_lines": []}
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.2.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.2.1', u'bridge_name': u't1br2', u'dns': [{u'dnsif': u't1s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s2_dnsbrif'}], u'ns_name': u't1ns2', u'subnet_ip': u'2.2.2.0/24', u'vms': [{u'mem': 3, u'name': u't1_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br2if1', u'vmif': u't1VM3if1'}], u'vxlan': [{u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}, {u'tenant_sub_ip': u'10.1.2.2/24', u'tenant_ns_ip': u'10.1.2.1/24', u'tenant_ns_if': u't1ns2if', u'tenant_sub_if': u't1s2if', u'tenant_ns_name': u't1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip link show \"t1ns2if\" ; if [ $? -ne 0 ] ; then ip link add \"t1ns2if\" type veth peer name \"t1s2if\" ; fi\n", "delta": "0:00:00.010842", "end": "2019-11-18 05:17:04.503352", "item": [{"bridge_name": "t1br2", "default_route_ip": "10.1.2.1", "dns": [{"brif": "t1s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t1s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns2", "route": [{"if": "p1", "ip": "10.1.2.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "2.2.2.0/24", "vms": [{"brif": "t1br2if1", "disk": "10G", "mem": 3, "name": "t1_VM3", "vcpu": 2, "vmif": "t1VM3if1"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, {"tenant_ns_if": "t1ns2if", "tenant_ns_ip": "10.1.2.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s2if", "tenant_sub_ip": "10.1.2.2/24"}], "rc": 0, "start": "2019-11-18 05:17:04.492510", "stderr": "Device \"t1ns2if\" does not exist.", "stderr_lines": ["Device \"t1ns2if\" does not exist."], "stdout": "", "stdout_lines": []}

TASK [Attach Namespace VETH Pairs] **************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't1_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM1if1'}, {u'mem': 4, u'name': u't1_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br1if2', u'vmif': u't1VM2if1'}], u'vxlan': [{u'local_ip': u'10.1.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.1.2', u'remote_route': u'10.2.1.0/24', u'subnet_route': u'10.1.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.2.1.2'}]}, {u'tenant_sub_ip': u'10.1.1.2/24', u'tenant_ns_ip': u'10.1.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t1\" ip link show \"t1ns1if\" ; if [ $? -ne 0 ] ; then ip link set \"t1ns1if\" netns \"t1\" ; fi\nip netns exec \"t1ns1\" ip link show \"t1s1if\" ; if [ $? -ne 0 ] ; then ip link set \"t1s1if\" netns \"t1ns1\" ; fi\n", "delta": "0:00:00.124565", "end": "2019-11-18 05:17:04.890259", "item": [{"bridge_name": "t1br1", "default_route_ip": "10.1.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.1.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "vms": [{"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM1", "vcpu": 4, "vmif": "t1VM1if1"}, {"brif": "t1br1if2", "disk": "10G", "mem": 4, "name": "t1_VM2", "vcpu": 2, "vmif": "t1VM2if1"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.1.2", "remote_ip": "10.2.1.2", "remote_route": "10.2.1.0/24", "subnet_route": "10.1.1.0/24", "tenant_route_ip": "192.168.1.2", "v_name": "vxlan_t1s1"}]}, {"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.1.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.1.1.2/24"}], "rc": 0, "start": "2019-11-18 05:17:04.765694", "stderr": "Device \"t1ns1if\" does not exist.\nDevice \"t1s1if\" does not exist.", "stderr_lines": ["Device \"t1ns1if\" does not exist.", "Device \"t1s1if\" does not exist."], "stdout": "", "stdout_lines": []}
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.2.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.2.1', u'bridge_name': u't1br2', u'dns': [{u'dnsif': u't1s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s2_dnsbrif'}], u'ns_name': u't1ns2', u'subnet_ip': u'2.2.2.0/24', u'vms': [{u'mem': 3, u'name': u't1_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br2if1', u'vmif': u't1VM3if1'}], u'vxlan': [{u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}, {u'tenant_sub_ip': u'10.1.2.2/24', u'tenant_ns_ip': u'10.1.2.1/24', u'tenant_ns_if': u't1ns2if', u'tenant_sub_if': u't1s2if', u'tenant_ns_name': u't1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t1\" ip link show \"t1ns2if\" ; if [ $? -ne 0 ] ; then ip link set \"t1ns2if\" netns \"t1\" ; fi\nip netns exec \"t1ns2\" ip link show \"t1s2if\" ; if [ $? -ne 0 ] ; then ip link set \"t1s2if\" netns \"t1ns2\" ; fi\n", "delta": "0:00:00.131755", "end": "2019-11-18 05:17:05.199201", "item": [{"bridge_name": "t1br2", "default_route_ip": "10.1.2.1", "dns": [{"brif": "t1s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t1s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns2", "route": [{"if": "p1", "ip": "10.1.2.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "2.2.2.0/24", "vms": [{"brif": "t1br2if1", "disk": "10G", "mem": 3, "name": "t1_VM3", "vcpu": 2, "vmif": "t1VM3if1"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, {"tenant_ns_if": "t1ns2if", "tenant_ns_ip": "10.1.2.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s2if", "tenant_sub_ip": "10.1.2.2/24"}], "rc": 0, "start": "2019-11-18 05:17:05.067446", "stderr": "Device \"t1ns2if\" does not exist.\nDevice \"t1s2if\" does not exist.", "stderr_lines": ["Device \"t1ns2if\" does not exist.", "Device \"t1s2if\" does not exist."], "stdout": "", "stdout_lines": []}

TASK [Set Namespace VETH Pairs UP] **************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't1_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM1if1'}, {u'mem': 4, u'name': u't1_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br1if2', u'vmif': u't1VM2if1'}], u'vxlan': [{u'local_ip': u'10.1.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.1.2', u'remote_route': u'10.2.1.0/24', u'subnet_route': u'10.1.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.2.1.2'}]}, {u'tenant_sub_ip': u'10.1.1.2/24', u'tenant_ns_ip': u'10.1.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t1\" ip link set dev \"t1ns1if\" up\nip netns exec \"t1ns1\" ip link set dev \"t1s1if\" up\n", "delta": "0:00:00.079118", "end": "2019-11-18 05:17:05.513262", "item": [{"bridge_name": "t1br1", "default_route_ip": "10.1.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.1.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "vms": [{"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM1", "vcpu": 4, "vmif": "t1VM1if1"}, {"brif": "t1br1if2", "disk": "10G", "mem": 4, "name": "t1_VM2", "vcpu": 2, "vmif": "t1VM2if1"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.1.2", "remote_ip": "10.2.1.2", "remote_route": "10.2.1.0/24", "subnet_route": "10.1.1.0/24", "tenant_route_ip": "192.168.1.2", "v_name": "vxlan_t1s1"}]}, {"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.1.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.1.1.2/24"}], "rc": 0, "start": "2019-11-18 05:17:05.434144", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.2.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.2.1', u'bridge_name': u't1br2', u'dns': [{u'dnsif': u't1s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s2_dnsbrif'}], u'ns_name': u't1ns2', u'subnet_ip': u'2.2.2.0/24', u'vms': [{u'mem': 3, u'name': u't1_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br2if1', u'vmif': u't1VM3if1'}], u'vxlan': [{u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}, {u'tenant_sub_ip': u'10.1.2.2/24', u'tenant_ns_ip': u'10.1.2.1/24', u'tenant_ns_if': u't1ns2if', u'tenant_sub_if': u't1s2if', u'tenant_ns_name': u't1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t1\" ip link set dev \"t1ns2if\" up\nip netns exec \"t1ns2\" ip link set dev \"t1s2if\" up\n", "delta": "0:00:00.065720", "end": "2019-11-18 05:17:05.757276", "item": [{"bridge_name": "t1br2", "default_route_ip": "10.1.2.1", "dns": [{"brif": "t1s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t1s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns2", "route": [{"if": "p1", "ip": "10.1.2.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "2.2.2.0/24", "vms": [{"brif": "t1br2if1", "disk": "10G", "mem": 3, "name": "t1_VM3", "vcpu": 2, "vmif": "t1VM3if1"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, {"tenant_ns_if": "t1ns2if", "tenant_ns_ip": "10.1.2.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s2if", "tenant_sub_ip": "10.1.2.2/24"}], "rc": 0, "start": "2019-11-18 05:17:05.691556", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Add IP addresses to Namespace VETH Pairs] *************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't1_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM1if1'}, {u'mem': 4, u'name': u't1_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br1if2', u'vmif': u't1VM2if1'}], u'vxlan': [{u'local_ip': u'10.1.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.1.2', u'remote_route': u'10.2.1.0/24', u'subnet_route': u'10.1.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.2.1.2'}]}, {u'tenant_sub_ip': u'10.1.1.2/24', u'tenant_ns_ip': u'10.1.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t1ns1\" ip addr show \"t1s1if\" | awk 'FNR==3{ print $2 }' | grep -w '^10.1.1.2/24' ; if [ $? -ne 0 ] ; then ip netns exec \"t1ns1\" ip addr add \"10.1.1.2/24\" dev \"t1s1if\" ; fi\n\nip netns exec \"t1\" ip addr show \"t1ns1if\" | awk 'FNR==3{ print $2 }' | grep -w '^10.1.1.1/24' ; if [ $? -ne 0 ] ; then ip netns exec \"t1\" ip addr add \"10.1.1.1/24\" dev \"t1ns1if\" ; fi\n", "delta": "0:00:00.154555", "end": "2019-11-18 05:17:06.189314", "item": [{"bridge_name": "t1br1", "default_route_ip": "10.1.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.1.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "vms": [{"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM1", "vcpu": 4, "vmif": "t1VM1if1"}, {"brif": "t1br1if2", "disk": "10G", "mem": 4, "name": "t1_VM2", "vcpu": 2, "vmif": "t1VM2if1"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.1.2", "remote_ip": "10.2.1.2", "remote_route": "10.2.1.0/24", "subnet_route": "10.1.1.0/24", "tenant_route_ip": "192.168.1.2", "v_name": "vxlan_t1s1"}]}, {"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.1.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.1.1.2/24"}], "rc": 0, "start": "2019-11-18 05:17:06.034759", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.2.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.2.1', u'bridge_name': u't1br2', u'dns': [{u'dnsif': u't1s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s2_dnsbrif'}], u'ns_name': u't1ns2', u'subnet_ip': u'2.2.2.0/24', u'vms': [{u'mem': 3, u'name': u't1_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br2if1', u'vmif': u't1VM3if1'}], u'vxlan': [{u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}, {u'tenant_sub_ip': u'10.1.2.2/24', u'tenant_ns_ip': u'10.1.2.1/24', u'tenant_ns_if': u't1ns2if', u'tenant_sub_if': u't1s2if', u'tenant_ns_name': u't1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t1ns2\" ip addr show \"t1s2if\" | awk 'FNR==3{ print $2 }' | grep -w '^10.1.2.2/24' ; if [ $? -ne 0 ] ; then ip netns exec \"t1ns2\" ip addr add \"10.1.2.2/24\" dev \"t1s2if\" ; fi\n\nip netns exec \"t1\" ip addr show \"t1ns2if\" | awk 'FNR==3{ print $2 }' | grep -w '^10.1.2.1/24' ; if [ $? -ne 0 ] ; then ip netns exec \"t1\" ip addr add \"10.1.2.1/24\" dev \"t1ns2if\" ; fi\n", "delta": "0:00:00.155520", "end": "2019-11-18 05:17:06.549286", "item": [{"bridge_name": "t1br2", "default_route_ip": "10.1.2.1", "dns": [{"brif": "t1s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t1s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns2", "route": [{"if": "p1", "ip": "10.1.2.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "2.2.2.0/24", "vms": [{"brif": "t1br2if1", "disk": "10G", "mem": 3, "name": "t1_VM3", "vcpu": 2, "vmif": "t1VM3if1"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, {"tenant_ns_if": "t1ns2if", "tenant_ns_ip": "10.1.2.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s2if", "tenant_sub_ip": "10.1.2.2/24"}], "rc": 0, "start": "2019-11-18 05:17:06.393766", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Add IP Route to Tenant] *******************************************************************************************************************************
changed: [localhost] => (item={u'default_route_ip': u'192.168.1.1', u'name': u't1', u'pns_ip': u'192.168.1.1/24', u'tenant_if': u't1if', u'tenant_ip': u'192.168.1.2/24', u'pns_if': u't1pns_if'}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t1\" ip route show default | grep -w '[d]efault via 192.168.1.1' ; if [ $? -ne 0 ] ; then ip netns exec \"t1\" ip route add default via \"192.168.1.1\" ; fi\n", "delta": "0:00:00.093198", "end": "2019-11-18 05:17:06.921626", "item": {"default_route_ip": "192.168.1.1", "name": "t1", "pns_if": "t1pns_if", "pns_ip": "192.168.1.1/24", "tenant_if": "t1if", "tenant_ip": "192.168.1.2/24"}, "rc": 0, "start": "2019-11-18 05:17:06.828428", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Add IP Route to Tenant Subnet] ************************************************************************************************************************
changed: [localhost] => (item={u'route': [{u'ip': u'10.1.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.1.2/24', u'tenant_ns_ip': u'10.1.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_ns_name': u't1', u'tenant_sub_if': u't1s1if'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't1_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM1if1'}, {u'mem': 4, u'name': u't1_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br1if2', u'vmif': u't1VM2if1'}], u'vxlan': [{u'local_ip': u'10.1.1.2', u'tenant_route_ip': u'192.168.1.2', u'dsport': 4789, u'dev': u't1s1if', u'subnet_route': u'10.1.1.0/24', u'remote_route': u'10.2.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.2.1.2'}]}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t1ns1\" ip route show default | grep -w '[d]efault via 10.1.1.1' ; if [ $? -ne 0 ] ; then ip netns exec \"t1ns1\" ip route add default via \"10.1.1.1\" ; fi\n", "delta": "0:00:00.072987", "end": "2019-11-18 05:17:07.285297", "item": {"bridge_name": "t1br1", "default_route_ip": "10.1.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.1.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.1.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.1.1.2/24"}], "vms": [{"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM1", "vcpu": 4, "vmif": "t1VM1if1"}, {"brif": "t1br1if2", "disk": "10G", "mem": 4, "name": "t1_VM2", "vcpu": 2, "vmif": "t1VM2if1"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.1.2", "remote_ip": "10.2.1.2", "remote_route": "10.2.1.0/24", "subnet_route": "10.1.1.0/24", "tenant_route_ip": "192.168.1.2", "v_name": "vxlan_t1s1"}]}, "rc": 0, "start": "2019-11-18 05:17:07.212310", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}
changed: [localhost] => (item={u'route': [{u'ip': u'10.1.2.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.2.1', u'bridge_name': u't1br2', u'dns': [{u'dnsif': u't1s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s2_dnsbrif'}], u'ns_name': u't1ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.2.2/24', u'tenant_ns_ip': u'10.1.2.1/24', u'tenant_ns_if': u't1ns2if', u'tenant_ns_name': u't1', u'tenant_sub_if': u't1s2if'}], u'subnet_ip': u'2.2.2.0/24', u'vms': [{u'mem': 3, u'name': u't1_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br2if1', u'vmif': u't1VM3if1'}], u'vxlan': [{u'local_ip': [], u'tenant_route_ip': [], u'dsport': [], u'dev': [], u'subnet_route': [], u'remote_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t1ns2\" ip route show default | grep -w '[d]efault via 10.1.2.1' ; if [ $? -ne 0 ] ; then ip netns exec \"t1ns2\" ip route add default via \"10.1.2.1\" ; fi\n", "delta": "0:00:00.070023", "end": "2019-11-18 05:17:07.561504", "item": {"bridge_name": "t1br2", "default_route_ip": "10.1.2.1", "dns": [{"brif": "t1s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t1s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns2", "route": [{"if": "p1", "ip": "10.1.2.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "2.2.2.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns2if", "tenant_ns_ip": "10.1.2.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s2if", "tenant_sub_ip": "10.1.2.2/24"}], "vms": [{"brif": "t1br2if1", "disk": "10G", "mem": 3, "name": "t1_VM3", "vcpu": 2, "vmif": "t1VM3if1"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, "rc": 0, "start": "2019-11-18 05:17:07.491481", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Create bridge inside namespace] ***********************************************************************************************************************
changed: [localhost] => (item={u'route': [{u'ip': u'10.1.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.1.2/24', u'tenant_ns_ip': u'10.1.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_ns_name': u't1', u'tenant_sub_if': u't1s1if'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't1_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM1if1'}, {u'mem': 4, u'name': u't1_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br1if2', u'vmif': u't1VM2if1'}], u'vxlan': [{u'local_ip': u'10.1.1.2', u'tenant_route_ip': u'192.168.1.2', u'dsport': 4789, u'dev': u't1s1if', u'subnet_route': u'10.1.1.0/24', u'remote_route': u'10.2.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.2.1.2'}]}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t1ns1\" brctl show | grep -w '^t1br1'; if [ $? -ne 0 ] ; then ip netns exec \"t1ns1\" brctl addbr \"t1br1\" ; fi\nip netns exec \"t1ns1\" ip link set dev \"t1br1\" up\n", "delta": "0:00:00.109315", "end": "2019-11-18 05:17:07.925240", "item": {"bridge_name": "t1br1", "default_route_ip": "10.1.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.1.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.1.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.1.1.2/24"}], "vms": [{"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM1", "vcpu": 4, "vmif": "t1VM1if1"}, {"brif": "t1br1if2", "disk": "10G", "mem": 4, "name": "t1_VM2", "vcpu": 2, "vmif": "t1VM2if1"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.1.2", "remote_ip": "10.2.1.2", "remote_route": "10.2.1.0/24", "subnet_route": "10.1.1.0/24", "tenant_route_ip": "192.168.1.2", "v_name": "vxlan_t1s1"}]}, "rc": 0, "start": "2019-11-18 05:17:07.815925", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}
changed: [localhost] => (item={u'route': [{u'ip': u'10.1.2.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.2.1', u'bridge_name': u't1br2', u'dns': [{u'dnsif': u't1s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s2_dnsbrif'}], u'ns_name': u't1ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.2.2/24', u'tenant_ns_ip': u'10.1.2.1/24', u'tenant_ns_if': u't1ns2if', u'tenant_ns_name': u't1', u'tenant_sub_if': u't1s2if'}], u'subnet_ip': u'2.2.2.0/24', u'vms': [{u'mem': 3, u'name': u't1_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br2if1', u'vmif': u't1VM3if1'}], u'vxlan': [{u'local_ip': [], u'tenant_route_ip': [], u'dsport': [], u'dev': [], u'subnet_route': [], u'remote_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t1ns2\" brctl show | grep -w '^t1br2'; if [ $? -ne 0 ] ; then ip netns exec \"t1ns2\" brctl addbr \"t1br2\" ; fi\nip netns exec \"t1ns2\" ip link set dev \"t1br2\" up\n", "delta": "0:00:00.105976", "end": "2019-11-18 05:17:08.225353", "item": {"bridge_name": "t1br2", "default_route_ip": "10.1.2.1", "dns": [{"brif": "t1s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t1s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns2", "route": [{"if": "p1", "ip": "10.1.2.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "2.2.2.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns2if", "tenant_ns_ip": "10.1.2.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s2if", "tenant_sub_ip": "10.1.2.2/24"}], "vms": [{"brif": "t1br2if1", "disk": "10G", "mem": 3, "name": "t1_VM3", "vcpu": 2, "vmif": "t1VM3if1"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, "rc": 0, "start": "2019-11-18 05:17:08.119377", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Create DNS VETH Pair] *********************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.1.1', u'bridge_name': u't1br1', u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.1.2/24', u'tenant_ns_ip': u'10.1.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't1_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM1if1'}, {u'mem': 4, u'name': u't1_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br1if2', u'vmif': u't1VM2if1'}], u'vxlan': [{u'local_ip': u'10.1.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.1.2', u'remote_route': u'10.2.1.0/24', u'subnet_route': u'10.1.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.2.1.2'}]}, {u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t1ns1\" ip link show \"t1s1_dnsbrif\" ; if [ $? -ne 0 ] ; then ip netns exec \"t1ns1\" ip link add \"t1s1_dnsbrif\" type veth peer name \"t1s1_dnsif\" ; fi\nip netns exec \"t1ns1\" ip link set dev \"t1s1_dnsbrif\" up\nip netns exec \"t1ns1\" ip link set dev \"t1s1_dnsif\" up\n", "delta": "0:00:00.144784", "end": "2019-11-18 05:17:08.613086", "item": [{"bridge_name": "t1br1", "default_route_ip": "10.1.1.1", "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.1.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.1.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.1.1.2/24"}], "vms": [{"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM1", "vcpu": 4, "vmif": "t1VM1if1"}, {"brif": "t1br1if2", "disk": "10G", "mem": 4, "name": "t1_VM2", "vcpu": 2, "vmif": "t1VM2if1"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.1.2", "remote_ip": "10.2.1.2", "remote_route": "10.2.1.0/24", "subnet_route": "10.1.1.0/24", "tenant_route_ip": "192.168.1.2", "v_name": "vxlan_t1s1"}]}, {"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "rc": 0, "start": "2019-11-18 05:17:08.468302", "stderr": "Device \"t1s1_dnsbrif\" does not exist.", "stderr_lines": ["Device \"t1s1_dnsbrif\" does not exist."], "stdout": "", "stdout_lines": []}
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.2.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.2.1', u'bridge_name': u't1br2', u'ns_name': u't1ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.2.2/24', u'tenant_ns_ip': u'10.1.2.1/24', u'tenant_ns_if': u't1ns2if', u'tenant_sub_if': u't1s2if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'2.2.2.0/24', u'vms': [{u'mem': 3, u'name': u't1_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br2if1', u'vmif': u't1VM3if1'}], u'vxlan': [{u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}, {u'dnsif': u't1s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s2_dnsbrif'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t1ns2\" ip link show \"t1s2_dnsbrif\" ; if [ $? -ne 0 ] ; then ip netns exec \"t1ns2\" ip link add \"t1s2_dnsbrif\" type veth peer name \"t1s2_dnsif\" ; fi\nip netns exec \"t1ns2\" ip link set dev \"t1s2_dnsbrif\" up\nip netns exec \"t1ns2\" ip link set dev \"t1s2_dnsif\" up\n", "delta": "0:00:00.173804", "end": "2019-11-18 05:17:08.965097", "item": [{"bridge_name": "t1br2", "default_route_ip": "10.1.2.1", "ns_name": "t1ns2", "route": [{"if": "p1", "ip": "10.1.2.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "2.2.2.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns2if", "tenant_ns_ip": "10.1.2.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s2if", "tenant_sub_ip": "10.1.2.2/24"}], "vms": [{"brif": "t1br2if1", "disk": "10G", "mem": 3, "name": "t1_VM3", "vcpu": 2, "vmif": "t1VM3if1"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, {"brif": "t1s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t1s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "rc": 0, "start": "2019-11-18 05:17:08.791293", "stderr": "Device \"t1s2_dnsbrif\" does not exist.", "stderr_lines": ["Device \"t1s2_dnsbrif\" does not exist."], "stdout": "", "stdout_lines": []}

TASK [Attach DNS VETH Pair] *********************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.1.1', u'bridge_name': u't1br1', u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.1.2/24', u'tenant_ns_ip': u'10.1.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't1_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM1if1'}, {u'mem': 4, u'name': u't1_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br1if2', u'vmif': u't1VM2if1'}], u'vxlan': [{u'local_ip': u'10.1.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.1.2', u'remote_route': u'10.2.1.0/24', u'subnet_route': u'10.1.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.2.1.2'}]}, {u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t1ns1\" brctl show \"t1br1\" | grep -w 't1s1_dnsbrif' ; if [ $? -ne 0 ] ; then ip netns exec \"t1ns1\" brctl addif \"t1br1\" \"t1s1_dnsbrif\" ; fi\n", "delta": "0:00:00.081913", "end": "2019-11-18 05:17:09.285337", "item": [{"bridge_name": "t1br1", "default_route_ip": "10.1.1.1", "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.1.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.1.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.1.1.2/24"}], "vms": [{"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM1", "vcpu": 4, "vmif": "t1VM1if1"}, {"brif": "t1br1if2", "disk": "10G", "mem": 4, "name": "t1_VM2", "vcpu": 2, "vmif": "t1VM2if1"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.1.2", "remote_ip": "10.2.1.2", "remote_route": "10.2.1.0/24", "subnet_route": "10.1.1.0/24", "tenant_route_ip": "192.168.1.2", "v_name": "vxlan_t1s1"}]}, {"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "rc": 0, "start": "2019-11-18 05:17:09.203424", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.2.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.2.1', u'bridge_name': u't1br2', u'ns_name': u't1ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.2.2/24', u'tenant_ns_ip': u'10.1.2.1/24', u'tenant_ns_if': u't1ns2if', u'tenant_sub_if': u't1s2if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'2.2.2.0/24', u'vms': [{u'mem': 3, u'name': u't1_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br2if1', u'vmif': u't1VM3if1'}], u'vxlan': [{u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}, {u'dnsif': u't1s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s2_dnsbrif'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t1ns2\" brctl show \"t1br2\" | grep -w 't1s2_dnsbrif' ; if [ $? -ne 0 ] ; then ip netns exec \"t1ns2\" brctl addif \"t1br2\" \"t1s2_dnsbrif\" ; fi\n", "delta": "0:00:00.068775", "end": "2019-11-18 05:17:09.545350", "item": [{"bridge_name": "t1br2", "default_route_ip": "10.1.2.1", "ns_name": "t1ns2", "route": [{"if": "p1", "ip": "10.1.2.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "2.2.2.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns2if", "tenant_ns_ip": "10.1.2.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s2if", "tenant_sub_ip": "10.1.2.2/24"}], "vms": [{"brif": "t1br2if1", "disk": "10G", "mem": 3, "name": "t1_VM3", "vcpu": 2, "vmif": "t1VM3if1"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, {"brif": "t1s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t1s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "rc": 0, "start": "2019-11-18 05:17:09.476575", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Create VETH Pairs] ************************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.1.2/24', u'tenant_ns_ip': u'10.1.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.1.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.1.2', u'remote_route': u'10.2.1.0/24', u'subnet_route': u'10.1.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.2.1.2'}]}, {u'mem': 2, u'name': u't1_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM1if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip link show \"t1br1if1\" ; if [ $? -ne 0 ] ; then ip link add \"t1VM1if1\" type veth peer name \"t1br1if1\" ; fi\nip link set dev \"t1br1if1\" up\nip link set dev \"t1VM1if1\" up\n", "delta": "0:00:00.013722", "end": "2019-11-18 05:17:09.799842", "item": [{"bridge_name": "t1br1", "default_route_ip": "10.1.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.1.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.1.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.1.1.2/24"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.1.2", "remote_ip": "10.2.1.2", "remote_route": "10.2.1.0/24", "subnet_route": "10.1.1.0/24", "tenant_route_ip": "192.168.1.2", "v_name": "vxlan_t1s1"}]}, {"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM1", "vcpu": 4, "vmif": "t1VM1if1"}], "rc": 0, "start": "2019-11-18 05:17:09.786120", "stderr": "Device \"t1br1if1\" does not exist.", "stderr_lines": ["Device \"t1br1if1\" does not exist."], "stdout": "", "stdout_lines": []}
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.1.2/24', u'tenant_ns_ip': u'10.1.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.1.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.1.2', u'remote_route': u'10.2.1.0/24', u'subnet_route': u'10.1.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.2.1.2'}]}, {u'mem': 4, u'name': u't1_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br1if2', u'vmif': u't1VM2if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip link show \"t1br1if2\" ; if [ $? -ne 0 ] ; then ip link add \"t1VM2if1\" type veth peer name \"t1br1if2\" ; fi\nip link set dev \"t1br1if2\" up\nip link set dev \"t1VM2if1\" up\n", "delta": "0:00:00.014929", "end": "2019-11-18 05:17:09.999046", "item": [{"bridge_name": "t1br1", "default_route_ip": "10.1.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.1.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.1.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.1.1.2/24"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.1.2", "remote_ip": "10.2.1.2", "remote_route": "10.2.1.0/24", "subnet_route": "10.1.1.0/24", "tenant_route_ip": "192.168.1.2", "v_name": "vxlan_t1s1"}]}, {"brif": "t1br1if2", "disk": "10G", "mem": 4, "name": "t1_VM2", "vcpu": 2, "vmif": "t1VM2if1"}], "rc": 0, "start": "2019-11-18 05:17:09.984117", "stderr": "Device \"t1br1if2\" does not exist.", "stderr_lines": ["Device \"t1br1if2\" does not exist."], "stdout": "", "stdout_lines": []}
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.2.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.2.1', u'bridge_name': u't1br2', u'dns': [{u'dnsif': u't1s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s2_dnsbrif'}], u'ns_name': u't1ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.2.2/24', u'tenant_ns_ip': u'10.1.2.1/24', u'tenant_ns_if': u't1ns2if', u'tenant_sub_if': u't1s2if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'2.2.2.0/24', u'vxlan': [{u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}, {u'mem': 3, u'name': u't1_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br2if1', u'vmif': u't1VM3if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip link show \"t1br2if1\" ; if [ $? -ne 0 ] ; then ip link add \"t1VM3if1\" type veth peer name \"t1br2if1\" ; fi\nip link set dev \"t1br2if1\" up\nip link set dev \"t1VM3if1\" up\n", "delta": "0:00:00.016465", "end": "2019-11-18 05:17:10.227871", "item": [{"bridge_name": "t1br2", "default_route_ip": "10.1.2.1", "dns": [{"brif": "t1s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t1s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns2", "route": [{"if": "p1", "ip": "10.1.2.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "2.2.2.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns2if", "tenant_ns_ip": "10.1.2.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s2if", "tenant_sub_ip": "10.1.2.2/24"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, {"brif": "t1br2if1", "disk": "10G", "mem": 3, "name": "t1_VM3", "vcpu": 2, "vmif": "t1VM3if1"}], "rc": 0, "start": "2019-11-18 05:17:10.211406", "stderr": "Device \"t1br2if1\" does not exist.", "stderr_lines": ["Device \"t1br2if1\" does not exist."], "stdout": "", "stdout_lines": []}

TASK [Attach VETH Pairs] ************************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.1.2/24', u'tenant_ns_ip': u'10.1.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.1.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.1.2', u'remote_route': u'10.2.1.0/24', u'subnet_route': u'10.1.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.2.1.2'}]}, {u'mem': 2, u'name': u't1_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM1if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip link show \"t1br1if1\" ; if [ $? -eq 0 ] ; then ip link set \"t1br1if1\" netns \"t1ns1\" ; fi\nip netns exec \"t1ns1\" brctl show \"t1br1\" | grep -w 't1br1if1' ; if [ $? -ne 0 ] ; then ip netns exec \"t1ns1\" brctl addif \"t1br1\" \"t1br1if1\" ; fi\n", "delta": "0:00:00.112781", "end": "2019-11-18 05:17:10.605197", "item": [{"bridge_name": "t1br1", "default_route_ip": "10.1.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.1.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.1.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.1.1.2/24"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.1.2", "remote_ip": "10.2.1.2", "remote_route": "10.2.1.0/24", "subnet_route": "10.1.1.0/24", "tenant_route_ip": "192.168.1.2", "v_name": "vxlan_t1s1"}]}, {"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM1", "vcpu": 4, "vmif": "t1VM1if1"}], "rc": 0, "start": "2019-11-18 05:17:10.492416", "stderr": "", "stderr_lines": [], "stdout": "18: t1br1if1@t1VM1if1: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP mode DEFAULT group default qlen 1000\n    link/ether e6:00:56:61:53:7b brd ff:ff:ff:ff:ff:ff", "stdout_lines": ["18: t1br1if1@t1VM1if1: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP mode DEFAULT group default qlen 1000", "    link/ether e6:00:56:61:53:7b brd ff:ff:ff:ff:ff:ff"]}
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.1.2/24', u'tenant_ns_ip': u'10.1.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.1.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.1.2', u'remote_route': u'10.2.1.0/24', u'subnet_route': u'10.1.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.2.1.2'}]}, {u'mem': 4, u'name': u't1_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br1if2', u'vmif': u't1VM2if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip link show \"t1br1if2\" ; if [ $? -eq 0 ] ; then ip link set \"t1br1if2\" netns \"t1ns1\" ; fi\nip netns exec \"t1ns1\" brctl show \"t1br1\" | grep -w 't1br1if2' ; if [ $? -ne 0 ] ; then ip netns exec \"t1ns1\" brctl addif \"t1br1\" \"t1br1if2\" ; fi\n", "delta": "0:00:00.116973", "end": "2019-11-18 05:17:10.925343", "item": [{"bridge_name": "t1br1", "default_route_ip": "10.1.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.1.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.1.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.1.1.2/24"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.1.2", "remote_ip": "10.2.1.2", "remote_route": "10.2.1.0/24", "subnet_route": "10.1.1.0/24", "tenant_route_ip": "192.168.1.2", "v_name": "vxlan_t1s1"}]}, {"brif": "t1br1if2", "disk": "10G", "mem": 4, "name": "t1_VM2", "vcpu": 2, "vmif": "t1VM2if1"}], "rc": 0, "start": "2019-11-18 05:17:10.808370", "stderr": "", "stderr_lines": [], "stdout": "20: t1br1if2@t1VM2if1: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP mode DEFAULT group default qlen 1000\n    link/ether 1a:08:2a:38:35:99 brd ff:ff:ff:ff:ff:ff", "stdout_lines": ["20: t1br1if2@t1VM2if1: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP mode DEFAULT group default qlen 1000", "    link/ether 1a:08:2a:38:35:99 brd ff:ff:ff:ff:ff:ff"]}
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.2.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.2.1', u'bridge_name': u't1br2', u'dns': [{u'dnsif': u't1s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s2_dnsbrif'}], u'ns_name': u't1ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.2.2/24', u'tenant_ns_ip': u'10.1.2.1/24', u'tenant_ns_if': u't1ns2if', u'tenant_sub_if': u't1s2if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'2.2.2.0/24', u'vxlan': [{u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}, {u'mem': 3, u'name': u't1_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br2if1', u'vmif': u't1VM3if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip link show \"t1br2if1\" ; if [ $? -eq 0 ] ; then ip link set \"t1br2if1\" netns \"t1ns2\" ; fi\nip netns exec \"t1ns2\" brctl show \"t1br2\" | grep -w 't1br2if1' ; if [ $? -ne 0 ] ; then ip netns exec \"t1ns2\" brctl addif \"t1br2\" \"t1br2if1\" ; fi\n", "delta": "0:00:00.108649", "end": "2019-11-18 05:17:11.221069", "item": [{"bridge_name": "t1br2", "default_route_ip": "10.1.2.1", "dns": [{"brif": "t1s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t1s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns2", "route": [{"if": "p1", "ip": "10.1.2.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "2.2.2.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns2if", "tenant_ns_ip": "10.1.2.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s2if", "tenant_sub_ip": "10.1.2.2/24"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, {"brif": "t1br2if1", "disk": "10G", "mem": 3, "name": "t1_VM3", "vcpu": 2, "vmif": "t1VM3if1"}], "rc": 0, "start": "2019-11-18 05:17:11.112420", "stderr": "", "stderr_lines": [], "stdout": "22: t1br2if1@t1VM3if1: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP mode DEFAULT group default qlen 1000\n    link/ether da:3b:03:66:b9:d5 brd ff:ff:ff:ff:ff:ff", "stdout_lines": ["22: t1br2if1@t1VM3if1: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP mode DEFAULT group default qlen 1000", "    link/ether da:3b:03:66:b9:d5 brd ff:ff:ff:ff:ff:ff"]}

TASK [All interfaces and bridges UP] ************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.1.2/24', u'tenant_ns_ip': u'10.1.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.1.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.1.2', u'remote_route': u'10.2.1.0/24', u'subnet_route': u'10.1.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.2.1.2'}]}, {u'mem': 2, u'name': u't1_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM1if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t1ns1\" ip link set \"t1br1if1\" up\nip netns exec \"t1ns1\" ip link set dev \"t1br1\" up\n", "delta": "0:00:00.060776", "end": "2019-11-18 05:17:11.521207", "item": [{"bridge_name": "t1br1", "default_route_ip": "10.1.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.1.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.1.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.1.1.2/24"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.1.2", "remote_ip": "10.2.1.2", "remote_route": "10.2.1.0/24", "subnet_route": "10.1.1.0/24", "tenant_route_ip": "192.168.1.2", "v_name": "vxlan_t1s1"}]}, {"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM1", "vcpu": 4, "vmif": "t1VM1if1"}], "rc": 0, "start": "2019-11-18 05:17:11.460431", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.1.2/24', u'tenant_ns_ip': u'10.1.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.1.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.1.2', u'remote_route': u'10.2.1.0/24', u'subnet_route': u'10.1.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.2.1.2'}]}, {u'mem': 4, u'name': u't1_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br1if2', u'vmif': u't1VM2if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t1ns1\" ip link set \"t1br1if2\" up\nip netns exec \"t1ns1\" ip link set dev \"t1br1\" up\n", "delta": "0:00:00.070165", "end": "2019-11-18 05:17:11.773202", "item": [{"bridge_name": "t1br1", "default_route_ip": "10.1.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.1.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.1.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.1.1.2/24"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.1.2", "remote_ip": "10.2.1.2", "remote_route": "10.2.1.0/24", "subnet_route": "10.1.1.0/24", "tenant_route_ip": "192.168.1.2", "v_name": "vxlan_t1s1"}]}, {"brif": "t1br1if2", "disk": "10G", "mem": 4, "name": "t1_VM2", "vcpu": 2, "vmif": "t1VM2if1"}], "rc": 0, "start": "2019-11-18 05:17:11.703037", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.2.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.2.1', u'bridge_name': u't1br2', u'dns': [{u'dnsif': u't1s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s2_dnsbrif'}], u'ns_name': u't1ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.2.2/24', u'tenant_ns_ip': u'10.1.2.1/24', u'tenant_ns_if': u't1ns2if', u'tenant_sub_if': u't1s2if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'2.2.2.0/24', u'vxlan': [{u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}, {u'mem': 3, u'name': u't1_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br2if1', u'vmif': u't1VM3if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t1ns2\" ip link set \"t1br2if1\" up\nip netns exec \"t1ns2\" ip link set dev \"t1br2\" up\n", "delta": "0:00:00.074095", "end": "2019-11-18 05:17:12.025251", "item": [{"bridge_name": "t1br2", "default_route_ip": "10.1.2.1", "dns": [{"brif": "t1s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t1s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns2", "route": [{"if": "p1", "ip": "10.1.2.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "2.2.2.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns2if", "tenant_ns_ip": "10.1.2.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s2if", "tenant_sub_ip": "10.1.2.2/24"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, {"brif": "t1br2if1", "disk": "10G", "mem": 3, "name": "t1_VM3", "vcpu": 2, "vmif": "t1VM3if1"}], "rc": 0, "start": "2019-11-18 05:17:11.951156", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Add IP to DNS Interface] ******************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.1.1', u'bridge_name': u't1br1', u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.1.2/24', u'tenant_ns_ip': u'10.1.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't1_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM1if1'}, {u'mem': 4, u'name': u't1_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br1if2', u'vmif': u't1VM2if1'}], u'vxlan': [{u'local_ip': u'10.1.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.1.2', u'remote_route': u'10.2.1.0/24', u'subnet_route': u'10.1.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.2.1.2'}]}, {u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t1ns1\" ip addr show \"t1s1_dnsif\" | awk 'FNR==3{ print $2 }' | grep -w '^1.1.1.1/24' ; if [ $? -ne 0 ] ; then ip netns exec \"t1ns1\" ip addr add \"1.1.1.1/24\" dev \"t1s1_dnsif\" ; fi\n", "delta": "0:00:00.066866", "end": "2019-11-18 05:17:12.337399", "item": [{"bridge_name": "t1br1", "default_route_ip": "10.1.1.1", "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.1.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.1.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.1.1.2/24"}], "vms": [{"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM1", "vcpu": 4, "vmif": "t1VM1if1"}, {"brif": "t1br1if2", "disk": "10G", "mem": 4, "name": "t1_VM2", "vcpu": 2, "vmif": "t1VM2if1"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.1.2", "remote_ip": "10.2.1.2", "remote_route": "10.2.1.0/24", "subnet_route": "10.1.1.0/24", "tenant_route_ip": "192.168.1.2", "v_name": "vxlan_t1s1"}]}, {"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "rc": 0, "start": "2019-11-18 05:17:12.270533", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.2.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.2.1', u'bridge_name': u't1br2', u'ns_name': u't1ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.2.2/24', u'tenant_ns_ip': u'10.1.2.1/24', u'tenant_ns_if': u't1ns2if', u'tenant_sub_if': u't1s2if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'2.2.2.0/24', u'vms': [{u'mem': 3, u'name': u't1_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br2if1', u'vmif': u't1VM3if1'}], u'vxlan': [{u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}, {u'dnsif': u't1s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s2_dnsbrif'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t1ns2\" ip addr show \"t1s2_dnsif\" | awk 'FNR==3{ print $2 }' | grep -w '^2.2.2.1/24' ; if [ $? -ne 0 ] ; then ip netns exec \"t1ns2\" ip addr add \"2.2.2.1/24\" dev \"t1s2_dnsif\" ; fi\n", "delta": "0:00:00.080066", "end": "2019-11-18 05:17:12.597218", "item": [{"bridge_name": "t1br2", "default_route_ip": "10.1.2.1", "ns_name": "t1ns2", "route": [{"if": "p1", "ip": "10.1.2.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "2.2.2.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns2if", "tenant_ns_ip": "10.1.2.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s2if", "tenant_sub_ip": "10.1.2.2/24"}], "vms": [{"brif": "t1br2if1", "disk": "10G", "mem": 3, "name": "t1_VM3", "vcpu": 2, "vmif": "t1VM3if1"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, {"brif": "t1s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t1s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "rc": 0, "start": "2019-11-18 05:17:12.517152", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Install DHCP Server] **********************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.1.1', u'bridge_name': u't1br1', u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.1.2/24', u'tenant_ns_ip': u'10.1.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't1_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM1if1'}, {u'mem': 4, u'name': u't1_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br1if2', u'vmif': u't1VM2if1'}], u'vxlan': [{u'local_ip': u'10.1.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.1.2', u'remote_route': u'10.2.1.0/24', u'subnet_route': u'10.1.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.2.1.2'}]}, {u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t1ns1\" ps aux | grep -w '[d]nsmasq --interface t1s1_dnsif -z --dhcp-range=1.1.1.5,1.1.1.126' ; if [ $? -ne 0 ] ; then ip netns exec \"t1ns1\" dnsmasq --interface \"t1s1_dnsif\" -z --dhcp-range=1.1.1.5,'1.1.1.126' ; fi\n", "delta": "0:00:00.076477", "end": "2019-11-18 05:17:12.917410", "item": [{"bridge_name": "t1br1", "default_route_ip": "10.1.1.1", "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.1.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.1.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.1.1.2/24"}], "vms": [{"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM1", "vcpu": 4, "vmif": "t1VM1if1"}, {"brif": "t1br1if2", "disk": "10G", "mem": 4, "name": "t1_VM2", "vcpu": 2, "vmif": "t1VM2if1"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.1.2", "remote_ip": "10.2.1.2", "remote_route": "10.2.1.0/24", "subnet_route": "10.1.1.0/24", "tenant_route_ip": "192.168.1.2", "v_name": "vxlan_t1s1"}]}, {"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "rc": 0, "start": "2019-11-18 05:17:12.840933", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.2.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.2.1', u'bridge_name': u't1br2', u'ns_name': u't1ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.2.2/24', u'tenant_ns_ip': u'10.1.2.1/24', u'tenant_ns_if': u't1ns2if', u'tenant_sub_if': u't1s2if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'2.2.2.0/24', u'vms': [{u'mem': 3, u'name': u't1_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br2if1', u'vmif': u't1VM3if1'}], u'vxlan': [{u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}, {u'dnsif': u't1s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s2_dnsbrif'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t1ns2\" ps aux | grep -w '[d]nsmasq --interface t1s2_dnsif -z --dhcp-range=2.2.2.5,2.2.2.254' ; if [ $? -ne 0 ] ; then ip netns exec \"t1ns2\" dnsmasq --interface \"t1s2_dnsif\" -z --dhcp-range=2.2.2.5,'2.2.2.254' ; fi\n", "delta": "0:00:00.065046", "end": "2019-11-18 05:17:13.164887", "item": [{"bridge_name": "t1br2", "default_route_ip": "10.1.2.1", "ns_name": "t1ns2", "route": [{"if": "p1", "ip": "10.1.2.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "2.2.2.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns2if", "tenant_ns_ip": "10.1.2.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s2if", "tenant_sub_ip": "10.1.2.2/24"}], "vms": [{"brif": "t1br2if1", "disk": "10G", "mem": 3, "name": "t1_VM3", "vcpu": 2, "vmif": "t1VM3if1"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, {"brif": "t1s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t1s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "rc": 0, "start": "2019-11-18 05:17:13.099841", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Create VXLAN devices] *********************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.1.2/24', u'tenant_ns_ip': u'10.1.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't1_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM1if1'}, {u'mem': 4, u'name': u't1_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br1if2', u'vmif': u't1VM2if1'}]}, {u'local_ip': u'10.1.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.1.2', u'remote_route': u'10.2.1.0/24', u'subnet_route': u'10.1.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.2.1.2'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t1ns1\" ip link show \"vxlan_t1s1\" ; if [ $? -ne 0 ] ; then ip netns exec \"t1ns1\" ip link add \"vxlan_t1s1\" type vxlan id \"42\" local \"10.1.1.2\" remote \"10.2.1.2\" dstport \"4789\" dev \"t1s1if\"; ip netns exec \"t1ns1\" ip link set dev \"vxlan_t1s1\" up ; fi\n", "delta": "0:00:00.123975", "end": "2019-11-18 05:17:13.541143", "item": [{"bridge_name": "t1br1", "default_route_ip": "10.1.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.1.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.1.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.1.1.2/24"}], "vms": [{"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM1", "vcpu": 4, "vmif": "t1VM1if1"}, {"brif": "t1br1if2", "disk": "10G", "mem": 4, "name": "t1_VM2", "vcpu": 2, "vmif": "t1VM2if1"}]}, {"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.1.2", "remote_ip": "10.2.1.2", "remote_route": "10.2.1.0/24", "subnet_route": "10.1.1.0/24", "tenant_route_ip": "192.168.1.2", "v_name": "vxlan_t1s1"}], "rc": 0, "start": "2019-11-18 05:17:13.417168", "stderr": "Device \"vxlan_t1s1\" does not exist.", "stderr_lines": ["Device \"vxlan_t1s1\" does not exist."], "stdout": "", "stdout_lines": []}
skipping: [localhost] => (item=[{u'route': [{u'ip': u'10.1.2.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.2.1', u'bridge_name': u't1br2', u'dns': [{u'dnsif': u't1s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s2_dnsbrif'}], u'ns_name': u't1ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.2.2/24', u'tenant_ns_ip': u'10.1.2.1/24', u'tenant_ns_if': u't1ns2if', u'tenant_sub_if': u't1s2if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'2.2.2.0/24', u'vms': [{u'mem': 3, u'name': u't1_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br2if1', u'vmif': u't1VM3if1'}]}, {u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}])  => {"ansible_loop_var": "item", "changed": false, "item": [{"bridge_name": "t1br2", "default_route_ip": "10.1.2.1", "dns": [{"brif": "t1s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t1s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns2", "route": [{"if": "p1", "ip": "10.1.2.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "2.2.2.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns2if", "tenant_ns_ip": "10.1.2.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s2if", "tenant_sub_ip": "10.1.2.2/24"}], "vms": [{"brif": "t1br2if1", "disk": "10G", "mem": 3, "name": "t1_VM3", "vcpu": 2, "vmif": "t1VM3if1"}]}, {"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}], "skip_reason": "Conditional result was False"}

TASK [Attach VXLANs to bridge] ******************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.1.2/24', u'tenant_ns_ip': u'10.1.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't1_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM1if1'}, {u'mem': 4, u'name': u't1_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br1if2', u'vmif': u't1VM2if1'}]}, {u'local_ip': u'10.1.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.1.2', u'remote_route': u'10.2.1.0/24', u'subnet_route': u'10.1.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.2.1.2'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t1ns1\" brctl show \"t1br1\" | grep -w 'vxlan_t1s1' ; if [ $? -ne 0 ] ; then ip netns exec \"t1ns1\" brctl addif \"t1br1\" \"vxlan_t1s1\" ; fi\n", "delta": "0:00:00.074358", "end": "2019-11-18 05:17:13.877260", "item": [{"bridge_name": "t1br1", "default_route_ip": "10.1.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.1.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.1.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.1.1.2/24"}], "vms": [{"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM1", "vcpu": 4, "vmif": "t1VM1if1"}, {"brif": "t1br1if2", "disk": "10G", "mem": 4, "name": "t1_VM2", "vcpu": 2, "vmif": "t1VM2if1"}]}, {"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.1.2", "remote_ip": "10.2.1.2", "remote_route": "10.2.1.0/24", "subnet_route": "10.1.1.0/24", "tenant_route_ip": "192.168.1.2", "v_name": "vxlan_t1s1"}], "rc": 0, "start": "2019-11-18 05:17:13.802902", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}
skipping: [localhost] => (item=[{u'route': [{u'ip': u'10.1.2.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.2.1', u'bridge_name': u't1br2', u'dns': [{u'dnsif': u't1s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s2_dnsbrif'}], u'ns_name': u't1ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.2.2/24', u'tenant_ns_ip': u'10.1.2.1/24', u'tenant_ns_if': u't1ns2if', u'tenant_sub_if': u't1s2if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'2.2.2.0/24', u'vms': [{u'mem': 3, u'name': u't1_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br2if1', u'vmif': u't1VM3if1'}]}, {u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}])  => {"ansible_loop_var": "item", "changed": false, "item": [{"bridge_name": "t1br2", "default_route_ip": "10.1.2.1", "dns": [{"brif": "t1s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t1s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns2", "route": [{"if": "p1", "ip": "10.1.2.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "2.2.2.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns2if", "tenant_ns_ip": "10.1.2.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s2if", "tenant_sub_ip": "10.1.2.2/24"}], "vms": [{"brif": "t1br2if1", "disk": "10G", "mem": 3, "name": "t1_VM3", "vcpu": 2, "vmif": "t1VM3if1"}]}, {"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}], "skip_reason": "Conditional result was False"}

PLAY RECAP **************************************************************************************************************************************************
localhost                  : ok=21   changed=21   unreachable=0    failed=0    skipped=0    rescued=0    ignored=0   

Using /etc/ansible/ansible.cfg as config file

PLAY [worker] ***********************************************************************************************************************************************

TASK [Create Tenant Namespace] ******************************************************************************************************************************
changed: [99.99.99.2] => (item={u'default_route_ip': u'192.168.129.1', u'name': u't1', u'pns_ip': u'192.168.129.1/24', u'tenant_if': u't1if', u'tenant_ip': u'192.168.129.2/24', u'pns_if': u't1pns_if'}) => {"ansible_loop_var": "item", "changed": true, "cmd": ["ip", "netns", "add", "t1"], "delta": "0:00:00.060571", "end": "2019-11-18 05:17:15.756371", "item": {"default_route_ip": "192.168.129.1", "name": "t1", "pns_if": "t1pns_if", "pns_ip": "192.168.129.1/24", "tenant_if": "t1if", "tenant_ip": "192.168.129.2/24"}, "rc": 0, "start": "2019-11-18 05:17:15.695800", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Create Subnet Namespace] ******************************************************************************************************************************
changed: [99.99.99.2] => (item={u'route': [{u'ip': u'10.2.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.2.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.1.2/24', u'tenant_ns_ip': u'10.2.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_ns_name': u't1', u'tenant_sub_if': u't1s1if'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't1_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM4if1'}], u'vxlan': [{u'local_ip': u'10.2.1.2', u'tenant_route_ip': u'192.168.129.2', u'dsport': 4789, u'dev': u't1s1if', u'subnet_route': u'10.2.1.0/24', u'remote_route': u'10.1.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.1.1.2'}]}) => {"ansible_loop_var": "item", "changed": true, "cmd": ["ip", "netns", "add", "t1ns1"], "delta": "0:00:00.054883", "end": "2019-11-18 05:17:16.211965", "item": {"bridge_name": "t1br1", "default_route_ip": "10.2.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.2.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.2.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.2.1.2/24"}], "vms": [{"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM4", "vcpu": 4, "vmif": "t1VM4if1"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.1.2", "remote_ip": "10.1.1.2", "remote_route": "10.1.1.0/24", "subnet_route": "10.2.1.0/24", "tenant_route_ip": "192.168.129.2", "v_name": "vxlan_t1s1"}]}, "rc": 0, "start": "2019-11-18 05:17:16.157082", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Create Tenant VETH pairs] *****************************************************************************************************************************
changed: [99.99.99.2] => (item={u'default_route_ip': u'192.168.129.1', u'name': u't1', u'pns_ip': u'192.168.129.1/24', u'tenant_if': u't1if', u'tenant_ip': u'192.168.129.2/24', u'pns_if': u't1pns_if'}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip link show \"t1if\" ; if [ $? -ne 0 ] ; then ip link add \"t1if\" type veth peer name \"t1pns_if\" ; fi\n", "delta": "0:00:00.013423", "end": "2019-11-18 05:17:16.618398", "item": {"default_route_ip": "192.168.129.1", "name": "t1", "pns_if": "t1pns_if", "pns_ip": "192.168.129.1/24", "tenant_if": "t1if", "tenant_ip": "192.168.129.2/24"}, "rc": 0, "start": "2019-11-18 05:17:16.604975", "stderr": "Device \"t1if\" does not exist.", "stderr_lines": ["Device \"t1if\" does not exist."], "stdout": "", "stdout_lines": []}

TASK [Attach Tenant VETH Pairs] *****************************************************************************************************************************
changed: [99.99.99.2] => (item={u'default_route_ip': u'192.168.129.1', u'name': u't1', u'pns_ip': u'192.168.129.1/24', u'tenant_if': u't1if', u'tenant_ip': u'192.168.129.2/24', u'pns_if': u't1pns_if'}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec pns ip link show \"t1pns_if\" ; if [ $? -ne 0 ] ; then ip link set \"t1pns_if\" netns pns ; fi\nip netns exec \"t1\" ip link show \"t1if\" ; if [ $? -ne 0 ] ; then ip link set \"t1if\" netns \"t1\" ; fi\nip netns exec pns ip link set dev \"t1pns_if\" up\nip netns exec \"t1\" ip link set dev \"t1if\" up\n", "delta": "0:00:00.192282", "end": "2019-11-18 05:17:17.182517", "item": {"default_route_ip": "192.168.129.1", "name": "t1", "pns_if": "t1pns_if", "pns_ip": "192.168.129.1/24", "tenant_if": "t1if", "tenant_ip": "192.168.129.2/24"}, "rc": 0, "start": "2019-11-18 05:17:16.990235", "stderr": "Device \"t1pns_if\" does not exist.\nDevice \"t1if\" does not exist.", "stderr_lines": ["Device \"t1pns_if\" does not exist.", "Device \"t1if\" does not exist."], "stdout": "", "stdout_lines": []}

TASK [Add IP addresses to Tenant VETH Pairs] ****************************************************************************************************************
changed: [99.99.99.2] => (item={u'default_route_ip': u'192.168.129.1', u'name': u't1', u'pns_ip': u'192.168.129.1/24', u'tenant_if': u't1if', u'tenant_ip': u'192.168.129.2/24', u'pns_if': u't1pns_if'}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec pns ip addr show \"t1pns_if\" | awk 'FNR==3{ print $2 }' | grep -w '^192.168.129.1/24' ; if [ $? -ne 0 ] ; then ip netns exec pns ip addr add \"192.168.129.1/24\" dev \"t1pns_if\" ; fi\nip netns exec \"t1\" ip addr show \"t1if\" | awk 'FNR==3{ print $2 }' | grep -w '^192.168.129.2/24' ; if [ $? -ne 0 ] ; then ip netns exec \"t1\" ip addr add \"192.168.129.2/24\" dev \"t1if\" ; fi\n", "delta": "0:00:00.143831", "end": "2019-11-18 05:17:17.690318", "item": {"default_route_ip": "192.168.129.1", "name": "t1", "pns_if": "t1pns_if", "pns_ip": "192.168.129.1/24", "tenant_if": "t1if", "tenant_ip": "192.168.129.2/24"}, "rc": 0, "start": "2019-11-18 05:17:17.546487", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Create Namespace VETH Pairs] **************************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.2.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't1_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM4if1'}], u'vxlan': [{u'local_ip': u'10.2.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.129.2', u'remote_route': u'10.1.1.0/24', u'subnet_route': u'10.2.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.1.1.2'}]}, {u'tenant_sub_ip': u'10.2.1.2/24', u'tenant_ns_ip': u'10.2.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip link show \"t1ns1if\" ; if [ $? -ne 0 ] ; then ip link add \"t1ns1if\" type veth peer name \"t1s1if\" ; fi\n", "delta": "0:00:00.011776", "end": "2019-11-18 05:17:18.080394", "item": [{"bridge_name": "t1br1", "default_route_ip": "10.2.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.2.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "vms": [{"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM4", "vcpu": 4, "vmif": "t1VM4if1"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.1.2", "remote_ip": "10.1.1.2", "remote_route": "10.1.1.0/24", "subnet_route": "10.2.1.0/24", "tenant_route_ip": "192.168.129.2", "v_name": "vxlan_t1s1"}]}, {"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.2.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.2.1.2/24"}], "rc": 0, "start": "2019-11-18 05:17:18.068618", "stderr": "Device \"t1ns1if\" does not exist.", "stderr_lines": ["Device \"t1ns1if\" does not exist."], "stdout": "", "stdout_lines": []}

TASK [Attach Namespace VETH Pairs] **************************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.2.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't1_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM4if1'}], u'vxlan': [{u'local_ip': u'10.2.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.129.2', u'remote_route': u'10.1.1.0/24', u'subnet_route': u'10.2.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.1.1.2'}]}, {u'tenant_sub_ip': u'10.2.1.2/24', u'tenant_ns_ip': u'10.2.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t1\" ip link show \"t1ns1if\" ; if [ $? -ne 0 ] ; then ip link set \"t1ns1if\" netns \"t1\" ; fi\nip netns exec \"t1ns1\" ip link show \"t1s1if\" ; if [ $? -ne 0 ] ; then ip link set \"t1s1if\" netns \"t1ns1\" ; fi\n", "delta": "0:00:00.176723", "end": "2019-11-18 05:17:18.644940", "item": [{"bridge_name": "t1br1", "default_route_ip": "10.2.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.2.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "vms": [{"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM4", "vcpu": 4, "vmif": "t1VM4if1"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.1.2", "remote_ip": "10.1.1.2", "remote_route": "10.1.1.0/24", "subnet_route": "10.2.1.0/24", "tenant_route_ip": "192.168.129.2", "v_name": "vxlan_t1s1"}]}, {"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.2.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.2.1.2/24"}], "rc": 0, "start": "2019-11-18 05:17:18.468217", "stderr": "Device \"t1ns1if\" does not exist.\nDevice \"t1s1if\" does not exist.", "stderr_lines": ["Device \"t1ns1if\" does not exist.", "Device \"t1s1if\" does not exist."], "stdout": "", "stdout_lines": []}

TASK [Set Namespace VETH Pairs UP] **************************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.2.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't1_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM4if1'}], u'vxlan': [{u'local_ip': u'10.2.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.129.2', u'remote_route': u'10.1.1.0/24', u'subnet_route': u'10.2.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.1.1.2'}]}, {u'tenant_sub_ip': u'10.2.1.2/24', u'tenant_ns_ip': u'10.2.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t1\" ip link set dev \"t1ns1if\" up\nip netns exec \"t1ns1\" ip link set dev \"t1s1if\" up\n", "delta": "0:00:00.087869", "end": "2019-11-18 05:17:19.110498", "item": [{"bridge_name": "t1br1", "default_route_ip": "10.2.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.2.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "vms": [{"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM4", "vcpu": 4, "vmif": "t1VM4if1"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.1.2", "remote_ip": "10.1.1.2", "remote_route": "10.1.1.0/24", "subnet_route": "10.2.1.0/24", "tenant_route_ip": "192.168.129.2", "v_name": "vxlan_t1s1"}]}, {"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.2.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.2.1.2/24"}], "rc": 0, "start": "2019-11-18 05:17:19.022629", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Add IP addresses to Namespace VETH Pairs] *************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.2.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't1_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM4if1'}], u'vxlan': [{u'local_ip': u'10.2.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.129.2', u'remote_route': u'10.1.1.0/24', u'subnet_route': u'10.2.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.1.1.2'}]}, {u'tenant_sub_ip': u'10.2.1.2/24', u'tenant_ns_ip': u'10.2.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t1ns1\" ip addr show \"t1s1if\" | awk 'FNR==3{ print $2 }' | grep -w '^10.2.1.2/24' ; if [ $? -ne 0 ] ; then ip netns exec \"t1ns1\" ip addr add \"10.2.1.2/24\" dev \"t1s1if\" ; fi\n\nip netns exec \"t1\" ip addr show \"t1ns1if\" | awk 'FNR==3{ print $2 }' | grep -w '^10.2.1.1/24' ; if [ $? -ne 0 ] ; then ip netns exec \"t1\" ip addr add \"10.2.1.1/24\" dev \"t1ns1if\" ; fi\n", "delta": "0:00:00.159771", "end": "2019-11-18 05:17:19.666349", "item": [{"bridge_name": "t1br1", "default_route_ip": "10.2.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.2.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "vms": [{"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM4", "vcpu": 4, "vmif": "t1VM4if1"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.1.2", "remote_ip": "10.1.1.2", "remote_route": "10.1.1.0/24", "subnet_route": "10.2.1.0/24", "tenant_route_ip": "192.168.129.2", "v_name": "vxlan_t1s1"}]}, {"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.2.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.2.1.2/24"}], "rc": 0, "start": "2019-11-18 05:17:19.506578", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Add IP Route to Tenant] *******************************************************************************************************************************
changed: [99.99.99.2] => (item={u'default_route_ip': u'192.168.129.1', u'name': u't1', u'pns_ip': u'192.168.129.1/24', u'tenant_if': u't1if', u'tenant_ip': u'192.168.129.2/24', u'pns_if': u't1pns_if'}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t1\" ip route show default | grep -w '[d]efault via 192.168.129.1' ; if [ $? -ne 0 ] ; then ip netns exec \"t1\" ip route add default via \"192.168.129.1\" ; fi\n", "delta": "0:00:00.066907", "end": "2019-11-18 05:17:20.118475", "item": {"default_route_ip": "192.168.129.1", "name": "t1", "pns_if": "t1pns_if", "pns_ip": "192.168.129.1/24", "tenant_if": "t1if", "tenant_ip": "192.168.129.2/24"}, "rc": 0, "start": "2019-11-18 05:17:20.051568", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Add IP Route to Tenant Subnet] ************************************************************************************************************************
changed: [99.99.99.2] => (item={u'route': [{u'ip': u'10.2.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.2.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.1.2/24', u'tenant_ns_ip': u'10.2.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_ns_name': u't1', u'tenant_sub_if': u't1s1if'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't1_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM4if1'}], u'vxlan': [{u'local_ip': u'10.2.1.2', u'tenant_route_ip': u'192.168.129.2', u'dsport': 4789, u'dev': u't1s1if', u'subnet_route': u'10.2.1.0/24', u'remote_route': u'10.1.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.1.1.2'}]}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t1ns1\" ip route show default | grep -w '[d]efault via 10.2.1.1' ; if [ $? -ne 0 ] ; then ip netns exec \"t1ns1\" ip route add default via \"10.2.1.1\" ; fi\n", "delta": "0:00:00.086618", "end": "2019-11-18 05:17:20.578573", "item": {"bridge_name": "t1br1", "default_route_ip": "10.2.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.2.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.2.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.2.1.2/24"}], "vms": [{"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM4", "vcpu": 4, "vmif": "t1VM4if1"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.1.2", "remote_ip": "10.1.1.2", "remote_route": "10.1.1.0/24", "subnet_route": "10.2.1.0/24", "tenant_route_ip": "192.168.129.2", "v_name": "vxlan_t1s1"}]}, "rc": 0, "start": "2019-11-18 05:17:20.491955", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Create bridge inside namespace] ***********************************************************************************************************************
changed: [99.99.99.2] => (item={u'route': [{u'ip': u'10.2.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.2.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.1.2/24', u'tenant_ns_ip': u'10.2.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_ns_name': u't1', u'tenant_sub_if': u't1s1if'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't1_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM4if1'}], u'vxlan': [{u'local_ip': u'10.2.1.2', u'tenant_route_ip': u'192.168.129.2', u'dsport': 4789, u'dev': u't1s1if', u'subnet_route': u'10.2.1.0/24', u'remote_route': u'10.1.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.1.1.2'}]}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t1ns1\" brctl show | grep -w '^t1br1'; if [ $? -ne 0 ] ; then ip netns exec \"t1ns1\" brctl addbr \"t1br1\" ; fi\nip netns exec \"t1ns1\" ip link set dev \"t1br1\" up\n", "delta": "0:00:00.100107", "end": "2019-11-18 05:17:21.050476", "item": {"bridge_name": "t1br1", "default_route_ip": "10.2.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.2.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.2.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.2.1.2/24"}], "vms": [{"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM4", "vcpu": 4, "vmif": "t1VM4if1"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.1.2", "remote_ip": "10.1.1.2", "remote_route": "10.1.1.0/24", "subnet_route": "10.2.1.0/24", "tenant_route_ip": "192.168.129.2", "v_name": "vxlan_t1s1"}]}, "rc": 0, "start": "2019-11-18 05:17:20.950369", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Create DNS VETH Pair] *********************************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.2.1.1', u'bridge_name': u't1br1', u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.1.2/24', u'tenant_ns_ip': u'10.2.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't1_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM4if1'}], u'vxlan': [{u'local_ip': u'10.2.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.129.2', u'remote_route': u'10.1.1.0/24', u'subnet_route': u'10.2.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.1.1.2'}]}, {u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t1ns1\" ip link show \"t1s1_dnsbrif\" ; if [ $? -ne 0 ] ; then ip netns exec \"t1ns1\" ip link add \"t1s1_dnsbrif\" type veth peer name \"t1s1_dnsif\" ; fi\nip netns exec \"t1ns1\" ip link set dev \"t1s1_dnsbrif\" up\nip netns exec \"t1ns1\" ip link set dev \"t1s1_dnsif\" up\n", "delta": "0:00:00.134368", "end": "2019-11-18 05:17:21.574569", "item": [{"bridge_name": "t1br1", "default_route_ip": "10.2.1.1", "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.2.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.2.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.2.1.2/24"}], "vms": [{"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM4", "vcpu": 4, "vmif": "t1VM4if1"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.1.2", "remote_ip": "10.1.1.2", "remote_route": "10.1.1.0/24", "subnet_route": "10.2.1.0/24", "tenant_route_ip": "192.168.129.2", "v_name": "vxlan_t1s1"}]}, {"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "rc": 0, "start": "2019-11-18 05:17:21.440201", "stderr": "Device \"t1s1_dnsbrif\" does not exist.", "stderr_lines": ["Device \"t1s1_dnsbrif\" does not exist."], "stdout": "", "stdout_lines": []}

TASK [Attach DNS VETH Pair] *********************************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.2.1.1', u'bridge_name': u't1br1', u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.1.2/24', u'tenant_ns_ip': u'10.2.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't1_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM4if1'}], u'vxlan': [{u'local_ip': u'10.2.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.129.2', u'remote_route': u'10.1.1.0/24', u'subnet_route': u'10.2.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.1.1.2'}]}, {u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t1ns1\" brctl show \"t1br1\" | grep -w 't1s1_dnsbrif' ; if [ $? -ne 0 ] ; then ip netns exec \"t1ns1\" brctl addif \"t1br1\" \"t1s1_dnsbrif\" ; fi\n", "delta": "0:00:00.086093", "end": "2019-11-18 05:17:22.062694", "item": [{"bridge_name": "t1br1", "default_route_ip": "10.2.1.1", "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.2.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.2.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.2.1.2/24"}], "vms": [{"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM4", "vcpu": 4, "vmif": "t1VM4if1"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.1.2", "remote_ip": "10.1.1.2", "remote_route": "10.1.1.0/24", "subnet_route": "10.2.1.0/24", "tenant_route_ip": "192.168.129.2", "v_name": "vxlan_t1s1"}]}, {"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "rc": 0, "start": "2019-11-18 05:17:21.976601", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Create VETH Pairs] ************************************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.2.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.1.2/24', u'tenant_ns_ip': u'10.2.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.2.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.129.2', u'remote_route': u'10.1.1.0/24', u'subnet_route': u'10.2.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.1.1.2'}]}, {u'mem': 2, u'name': u't1_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM4if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip link show \"t1br1if1\" ; if [ $? -ne 0 ] ; then ip link add \"t1VM4if1\" type veth peer name \"t1br1if1\" ; fi\nip link set dev \"t1br1if1\" up\nip link set dev \"t1VM4if1\" up\n", "delta": "0:00:00.018155", "end": "2019-11-18 05:17:22.477822", "item": [{"bridge_name": "t1br1", "default_route_ip": "10.2.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.2.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.2.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.2.1.2/24"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.1.2", "remote_ip": "10.1.1.2", "remote_route": "10.1.1.0/24", "subnet_route": "10.2.1.0/24", "tenant_route_ip": "192.168.129.2", "v_name": "vxlan_t1s1"}]}, {"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM4", "vcpu": 4, "vmif": "t1VM4if1"}], "rc": 0, "start": "2019-11-18 05:17:22.459667", "stderr": "Device \"t1br1if1\" does not exist.", "stderr_lines": ["Device \"t1br1if1\" does not exist."], "stdout": "", "stdout_lines": []}

TASK [Attach VETH Pairs] ************************************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.2.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.1.2/24', u'tenant_ns_ip': u'10.2.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.2.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.129.2', u'remote_route': u'10.1.1.0/24', u'subnet_route': u'10.2.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.1.1.2'}]}, {u'mem': 2, u'name': u't1_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM4if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip link show \"t1br1if1\" ; if [ $? -eq 0 ] ; then ip link set \"t1br1if1\" netns \"t1ns1\" ; fi\nip netns exec \"t1ns1\" brctl show \"t1br1\" | grep -w 't1br1if1' ; if [ $? -ne 0 ] ; then ip netns exec \"t1ns1\" brctl addif \"t1br1\" \"t1br1if1\" ; fi\n", "delta": "0:00:00.135348", "end": "2019-11-18 05:17:23.014505", "item": [{"bridge_name": "t1br1", "default_route_ip": "10.2.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.2.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.2.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.2.1.2/24"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.1.2", "remote_ip": "10.1.1.2", "remote_route": "10.1.1.0/24", "subnet_route": "10.2.1.0/24", "tenant_route_ip": "192.168.129.2", "v_name": "vxlan_t1s1"}]}, {"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM4", "vcpu": 4, "vmif": "t1VM4if1"}], "rc": 0, "start": "2019-11-18 05:17:22.879157", "stderr": "", "stderr_lines": [], "stdout": "18: t1br1if1@t1VM4if1: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP mode DEFAULT group default qlen 1000\n    link/ether e2:a7:24:52:15:76 brd ff:ff:ff:ff:ff:ff", "stdout_lines": ["18: t1br1if1@t1VM4if1: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP mode DEFAULT group default qlen 1000", "    link/ether e2:a7:24:52:15:76 brd ff:ff:ff:ff:ff:ff"]}

TASK [All interfaces and bridges UP] ************************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.2.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.1.2/24', u'tenant_ns_ip': u'10.2.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.2.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.129.2', u'remote_route': u'10.1.1.0/24', u'subnet_route': u'10.2.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.1.1.2'}]}, {u'mem': 2, u'name': u't1_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM4if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t1ns1\" ip link set \"t1br1if1\" up\nip netns exec \"t1ns1\" ip link set dev \"t1br1\" up\n", "delta": "0:00:00.071244", "end": "2019-11-18 05:17:23.478558", "item": [{"bridge_name": "t1br1", "default_route_ip": "10.2.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.2.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.2.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.2.1.2/24"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.1.2", "remote_ip": "10.1.1.2", "remote_route": "10.1.1.0/24", "subnet_route": "10.2.1.0/24", "tenant_route_ip": "192.168.129.2", "v_name": "vxlan_t1s1"}]}, {"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM4", "vcpu": 4, "vmif": "t1VM4if1"}], "rc": 0, "start": "2019-11-18 05:17:23.407314", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Add IP to DNS Interface] ******************************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.2.1.1', u'bridge_name': u't1br1', u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.1.2/24', u'tenant_ns_ip': u'10.2.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't1_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM4if1'}], u'vxlan': [{u'local_ip': u'10.2.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.129.2', u'remote_route': u'10.1.1.0/24', u'subnet_route': u'10.2.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.1.1.2'}]}, {u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t1ns1\" ip addr show \"t1s1_dnsif\" | awk 'FNR==3{ print $2}'| grep -w '^1.1.1.128/24' ; if [ $? -ne 0 ] ; then ip netns exec \"t1ns1\" ip addr add \"1.1.1.128/24\" dev \"t1s1_dnsif\" ; fi\n", "delta": "0:00:00.079131", "end": "2019-11-18 05:17:23.934570", "item": [{"bridge_name": "t1br1", "default_route_ip": "10.2.1.1", "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.2.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.2.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.2.1.2/24"}], "vms": [{"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM4", "vcpu": 4, "vmif": "t1VM4if1"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.1.2", "remote_ip": "10.1.1.2", "remote_route": "10.1.1.0/24", "subnet_route": "10.2.1.0/24", "tenant_route_ip": "192.168.129.2", "v_name": "vxlan_t1s1"}]}, {"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "rc": 0, "start": "2019-11-18 05:17:23.855439", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Install DHCP Server] **********************************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.2.1.1', u'bridge_name': u't1br1', u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.1.2/24', u'tenant_ns_ip': u'10.2.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't1_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM4if1'}], u'vxlan': [{u'local_ip': u'10.2.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.129.2', u'remote_route': u'10.1.1.0/24', u'subnet_route': u'10.2.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.1.1.2'}]}, {u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t1ns1\" ps aux | grep -w '[d]nsmasq --interface t1s1_dnsif -z --dhcp-range=1.1.1.133,1.1.1.254' ; if [ $? -ne 0 ] ; then ip netns exec \"t1ns1\" dnsmasq --interface \"t1s1_dnsif\" -z --dhcp-range=1.1.1.133,'1.1.1.254' ; fi\n", "delta": "0:00:00.080095", "end": "2019-11-18 05:17:24.412064", "item": [{"bridge_name": "t1br1", "default_route_ip": "10.2.1.1", "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.2.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.2.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.2.1.2/24"}], "vms": [{"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM4", "vcpu": 4, "vmif": "t1VM4if1"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.1.2", "remote_ip": "10.1.1.2", "remote_route": "10.1.1.0/24", "subnet_route": "10.2.1.0/24", "tenant_route_ip": "192.168.129.2", "v_name": "vxlan_t1s1"}]}, {"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "rc": 0, "start": "2019-11-18 05:17:24.331969", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Create VXLAN devices] *********************************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.2.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.1.2/24', u'tenant_ns_ip': u'10.2.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't1_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM4if1'}]}, {u'local_ip': u'10.2.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.129.2', u'remote_route': u'10.1.1.0/24', u'subnet_route': u'10.2.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.1.1.2'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t1ns1\" ip link show \"vxlan_t1s1\" ; if [ $? -ne 0 ] ; then ip netns exec \"t1ns1\" ip link add \"vxlan_t1s1\" type vxlan id \"42\" local \"10.2.1.2\" remote \"10.1.1.2\" dstport \"4789\" dev \"t1s1if\" ; ip netns exec \"t1ns1\" ip link set dev \"vxlan_t1s1\" up ; fi\n", "delta": "0:00:00.156939", "end": "2019-11-18 05:17:24.958441", "item": [{"bridge_name": "t1br1", "default_route_ip": "10.2.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.2.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.2.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.2.1.2/24"}], "vms": [{"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM4", "vcpu": 4, "vmif": "t1VM4if1"}]}, {"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.1.2", "remote_ip": "10.1.1.2", "remote_route": "10.1.1.0/24", "subnet_route": "10.2.1.0/24", "tenant_route_ip": "192.168.129.2", "v_name": "vxlan_t1s1"}], "rc": 0, "start": "2019-11-18 05:17:24.801502", "stderr": "Device \"vxlan_t1s1\" does not exist.", "stderr_lines": ["Device \"vxlan_t1s1\" does not exist."], "stdout": "", "stdout_lines": []}

TASK [Attach VXLANs to bridge] ******************************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.2.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.1.2/24', u'tenant_ns_ip': u'10.2.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't1_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM4if1'}]}, {u'local_ip': u'10.2.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.129.2', u'remote_route': u'10.1.1.0/24', u'subnet_route': u'10.2.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.1.1.2'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t1ns1\" brctl show \"t1br1\" | grep -w 'vxlan_t1s1' ; if [ $? -ne 0 ] ; then ip netns exec \"t1ns1\" brctl addif \"t1br1\" \"vxlan_t1s1\" ; fi\n", "delta": "0:00:00.070262", "end": "2019-11-18 05:17:25.442485", "item": [{"bridge_name": "t1br1", "default_route_ip": "10.2.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.2.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.2.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.2.1.2/24"}], "vms": [{"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM4", "vcpu": 4, "vmif": "t1VM4if1"}]}, {"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.1.2", "remote_ip": "10.1.1.2", "remote_route": "10.1.1.0/24", "subnet_route": "10.2.1.0/24", "tenant_route_ip": "192.168.129.2", "v_name": "vxlan_t1s1"}], "rc": 0, "start": "2019-11-18 05:17:25.372223", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

PLAY RECAP **************************************************************************************************************************************************
99.99.99.2                 : ok=21   changed=21   unreachable=0    failed=0    skipped=0    rescued=0    ignored=0   

Using /etc/ansible/ansible.cfg as config file

PLAY [main] *************************************************************************************************************************************************

TASK [Add VXLAN routes in PNS] ******************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.1.2/24', u'tenant_ns_ip': u'10.1.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't1_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM1if1'}, {u'mem': 4, u'name': u't1_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br1if2', u'vmif': u't1VM2if1'}]}, {u'local_ip': u'10.1.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.1.2', u'remote_route': u'10.2.1.0/24', u'subnet_route': u'10.1.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.2.1.2'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec pns ip route show \"10.1.1.0/24\" via \"192.168.1.2\" | grep -w '^10.1.1.0/24' ; if [ $? -ne 0 ] ; then ip netns exec pns ip route add \"10.1.1.0/24\" via \"192.168.1.2\" ; fi\n", "delta": "0:00:00.071185", "end": "2019-11-18 05:17:26.537068", "item": [{"bridge_name": "t1br1", "default_route_ip": "10.1.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.1.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.1.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.1.1.2/24"}], "vms": [{"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM1", "vcpu": 4, "vmif": "t1VM1if1"}, {"brif": "t1br1if2", "disk": "10G", "mem": 4, "name": "t1_VM2", "vcpu": 2, "vmif": "t1VM2if1"}]}, {"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.1.2", "remote_ip": "10.2.1.2", "remote_route": "10.2.1.0/24", "subnet_route": "10.1.1.0/24", "tenant_route_ip": "192.168.1.2", "v_name": "vxlan_t1s1"}], "rc": 0, "start": "2019-11-18 05:17:26.465883", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}
skipping: [localhost] => (item=[{u'route': [{u'ip': u'10.1.2.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.2.1', u'bridge_name': u't1br2', u'dns': [{u'dnsif': u't1s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s2_dnsbrif'}], u'ns_name': u't1ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.2.2/24', u'tenant_ns_ip': u'10.1.2.1/24', u'tenant_ns_if': u't1ns2if', u'tenant_sub_if': u't1s2if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'2.2.2.0/24', u'vms': [{u'mem': 3, u'name': u't1_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br2if1', u'vmif': u't1VM3if1'}]}, {u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}])  => {"ansible_loop_var": "item", "changed": false, "item": [{"bridge_name": "t1br2", "default_route_ip": "10.1.2.1", "dns": [{"brif": "t1s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t1s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns2", "route": [{"if": "p1", "ip": "10.1.2.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "2.2.2.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns2if", "tenant_ns_ip": "10.1.2.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s2if", "tenant_sub_ip": "10.1.2.2/24"}], "vms": [{"brif": "t1br2if1", "disk": "10G", "mem": 3, "name": "t1_VM3", "vcpu": 2, "vmif": "t1VM3if1"}]}, {"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}], "skip_reason": "Conditional result was False"}

TASK [Get PNS ip address] ***********************************************************************************************************************************
ok: [localhost] => {"changed": false, "cmd": "ip netns exec pns ip addr show p1 | awk 'FNR==3{ print $2 }' | awk -F/ '{ print $1 }'\n", "delta": "0:00:00.036722", "end": "2019-11-18 05:17:26.829674", "rc": 0, "start": "2019-11-18 05:17:26.792952", "stderr": "", "stderr_lines": [], "stdout": "192.168.100.238", "stdout_lines": ["192.168.100.238"]}

TASK [Add VXLAN routes to host] *****************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.1.2/24', u'tenant_ns_ip': u'10.1.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't1_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM1if1'}, {u'mem': 4, u'name': u't1_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br1if2', u'vmif': u't1VM2if1'}]}, {u'local_ip': u'10.1.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.1.2', u'remote_route': u'10.2.1.0/24', u'subnet_route': u'10.1.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.2.1.2'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip route show \"10.1.1.0/24\" via \"192.168.100.238\" | grep -w '^10.1.1.0/24' ; if [ $? -ne 0 ] ; then ip route add \"10.1.1.0/24\" via \"192.168.100.238\" ; fi\nip route show \"10.2.1.0/24\" via 99.99.99.2 | grep -w '^10.2.1.0/24'; if [ $? -ne 0 ] ; then ip route add \"10.2.1.0/24\" via 99.99.99.2 ; fi\n", "delta": "0:00:00.008093", "end": "2019-11-18 05:17:27.153304", "item": [{"bridge_name": "t1br1", "default_route_ip": "10.1.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.1.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.1.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.1.1.2/24"}], "vms": [{"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM1", "vcpu": 4, "vmif": "t1VM1if1"}, {"brif": "t1br1if2", "disk": "10G", "mem": 4, "name": "t1_VM2", "vcpu": 2, "vmif": "t1VM2if1"}]}, {"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.1.2", "remote_ip": "10.2.1.2", "remote_route": "10.2.1.0/24", "subnet_route": "10.1.1.0/24", "tenant_route_ip": "192.168.1.2", "v_name": "vxlan_t1s1"}], "rc": 0, "start": "2019-11-18 05:17:27.145211", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}
skipping: [localhost] => (item=[{u'route': [{u'ip': u'10.1.2.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.2.1', u'bridge_name': u't1br2', u'dns': [{u'dnsif': u't1s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s2_dnsbrif'}], u'ns_name': u't1ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.2.2/24', u'tenant_ns_ip': u'10.1.2.1/24', u'tenant_ns_if': u't1ns2if', u'tenant_sub_if': u't1s2if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'2.2.2.0/24', u'vms': [{u'mem': 3, u'name': u't1_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br2if1', u'vmif': u't1VM3if1'}]}, {u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}])  => {"ansible_loop_var": "item", "changed": false, "item": [{"bridge_name": "t1br2", "default_route_ip": "10.1.2.1", "dns": [{"brif": "t1s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t1s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns2", "route": [{"if": "p1", "ip": "10.1.2.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "2.2.2.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns2if", "tenant_ns_ip": "10.1.2.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s2if", "tenant_sub_ip": "10.1.2.2/24"}], "vms": [{"brif": "t1br2if1", "disk": "10G", "mem": 3, "name": "t1_VM3", "vcpu": 2, "vmif": "t1VM3if1"}]}, {"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}], "skip_reason": "Conditional result was False"}

PLAY RECAP **************************************************************************************************************************************************
localhost                  : ok=3    changed=2    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0   

Using /etc/ansible/ansible.cfg as config file

PLAY [worker] ***********************************************************************************************************************************************

TASK [Add VXLAN routes in PNS] ******************************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.2.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.1.2/24', u'tenant_ns_ip': u'10.2.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't1_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM4if1'}]}, {u'local_ip': u'10.2.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.129.2', u'remote_route': u'10.1.1.0/24', u'subnet_route': u'10.2.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.1.1.2'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec pns ip route show \"10.2.1.0/24\" via \"192.168.129.2\" | grep -w '^10.2.1.0/24' ; if [ $? -ne 0 ] ; then ip netns exec pns ip route add \"10.2.1.0/24\" via \"192.168.129.2\" ; fi\n", "delta": "0:00:00.088331", "end": "2019-11-18 05:17:28.450465", "item": [{"bridge_name": "t1br1", "default_route_ip": "10.2.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.2.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.2.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.2.1.2/24"}], "vms": [{"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM4", "vcpu": 4, "vmif": "t1VM4if1"}]}, {"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.1.2", "remote_ip": "10.1.1.2", "remote_route": "10.1.1.0/24", "subnet_route": "10.2.1.0/24", "tenant_route_ip": "192.168.129.2", "v_name": "vxlan_t1s1"}], "rc": 0, "start": "2019-11-18 05:17:28.362134", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Get PNS ip address] ***********************************************************************************************************************************
ok: [99.99.99.2] => {"changed": false, "cmd": "ip netns exec pns ip addr show p1 | awk 'FNR==3{ print $2 }' | awk -F/ '{ print $1 }'\n", "delta": "0:00:00.036620", "end": "2019-11-18 05:17:28.870772", "rc": 0, "start": "2019-11-18 05:17:28.834152", "stderr": "", "stderr_lines": [], "stdout": "192.168.100.50", "stdout_lines": ["192.168.100.50"]}

TASK [Add VXLAN routes to host] *****************************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.2.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.1.2/24', u'tenant_ns_ip': u'10.2.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't1_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM4if1'}]}, {u'local_ip': u'10.2.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.129.2', u'remote_route': u'10.1.1.0/24', u'subnet_route': u'10.2.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.1.1.2'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip route show \"10.2.1.0/24\" via \"192.168.100.50\" | grep -w '^10.2.1.0/24' ; if [ $? -ne 0 ] ; then ip route add \"10.2.1.0/24\" via \"192.168.100.50\" ; fi\nip route show \"10.1.1.0/24\" via 99.99.99.1 | grep -w '^10.1.1.0/24'; if [ $? -ne 0 ] ; then ip route add \"10.1.1.0/24\" via 99.99.99.1 ; fi\n", "delta": "0:00:00.008802", "end": "2019-11-18 05:17:29.266626", "item": [{"bridge_name": "t1br1", "default_route_ip": "10.2.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.2.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.2.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.2.1.2/24"}], "vms": [{"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM4", "vcpu": 4, "vmif": "t1VM4if1"}]}, {"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.1.2", "remote_ip": "10.1.1.2", "remote_route": "10.1.1.0/24", "subnet_route": "10.2.1.0/24", "tenant_route_ip": "192.168.129.2", "v_name": "vxlan_t1s1"}], "rc": 0, "start": "2019-11-18 05:17:29.257824", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

PLAY RECAP **************************************************************************************************************************************************
99.99.99.2                 : ok=3    changed=2    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0   

Using /etc/ansible/ansible.cfg as config file

PLAY [main] *************************************************************************************************************************************************

TASK [Create VM templates (C1)] *****************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.1.2/24', u'tenant_ns_ip': u'10.1.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.1.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.1.2', u'remote_route': u'10.2.1.0/24', u'subnet_route': u'10.1.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.2.1.2'}]}, {u'mem': 2, u'name': u't1_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM1if1'}]) => {"ansible_loop_var": "item", "changed": true, "checksum": "350ba870bd31b7f6ee517845c14237910b5af0bf", "dest": "/root/Migration-as-a-Service/t1/VM_templates/t1_VM1.xml.j2", "gid": 0, "group": "root", "item": [{"bridge_name": "t1br1", "default_route_ip": "10.1.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.1.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.1.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.1.1.2/24"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.1.2", "remote_ip": "10.2.1.2", "remote_route": "10.2.1.0/24", "subnet_route": "10.1.1.0/24", "tenant_route_ip": "192.168.1.2", "v_name": "vxlan_t1s1"}]}, {"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM1", "vcpu": 4, "vmif": "t1VM1if1"}], "md5sum": "fbfc2eb0c2569531f25eea92c26d3bee", "mode": "0644", "owner": "root", "size": 4091, "src": "/root/.ansible/tmp/ansible-tmp-1574054249.87-78233843595231/source", "state": "file", "uid": 0}
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.1.2/24', u'tenant_ns_ip': u'10.1.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.1.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.1.2', u'remote_route': u'10.2.1.0/24', u'subnet_route': u'10.1.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.2.1.2'}]}, {u'mem': 4, u'name': u't1_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br1if2', u'vmif': u't1VM2if1'}]) => {"ansible_loop_var": "item", "changed": true, "checksum": "350ba870bd31b7f6ee517845c14237910b5af0bf", "dest": "/root/Migration-as-a-Service/t1/VM_templates/t1_VM2.xml.j2", "gid": 0, "group": "root", "item": [{"bridge_name": "t1br1", "default_route_ip": "10.1.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.1.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.1.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.1.1.2/24"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.1.2", "remote_ip": "10.2.1.2", "remote_route": "10.2.1.0/24", "subnet_route": "10.1.1.0/24", "tenant_route_ip": "192.168.1.2", "v_name": "vxlan_t1s1"}]}, {"brif": "t1br1if2", "disk": "10G", "mem": 4, "name": "t1_VM2", "vcpu": 2, "vmif": "t1VM2if1"}], "md5sum": "fbfc2eb0c2569531f25eea92c26d3bee", "mode": "0644", "owner": "root", "size": 4091, "src": "/root/.ansible/tmp/ansible-tmp-1574054250.44-61071864971026/source", "state": "file", "uid": 0}
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.2.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.2.1', u'bridge_name': u't1br2', u'dns': [{u'dnsif': u't1s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s2_dnsbrif'}], u'ns_name': u't1ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.2.2/24', u'tenant_ns_ip': u'10.1.2.1/24', u'tenant_ns_if': u't1ns2if', u'tenant_sub_if': u't1s2if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'2.2.2.0/24', u'vxlan': [{u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}, {u'mem': 3, u'name': u't1_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br2if1', u'vmif': u't1VM3if1'}]) => {"ansible_loop_var": "item", "changed": true, "checksum": "350ba870bd31b7f6ee517845c14237910b5af0bf", "dest": "/root/Migration-as-a-Service/t1/VM_templates/t1_VM3.xml.j2", "gid": 0, "group": "root", "item": [{"bridge_name": "t1br2", "default_route_ip": "10.1.2.1", "dns": [{"brif": "t1s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t1s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns2", "route": [{"if": "p1", "ip": "10.1.2.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "2.2.2.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns2if", "tenant_ns_ip": "10.1.2.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s2if", "tenant_sub_ip": "10.1.2.2/24"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, {"brif": "t1br2if1", "disk": "10G", "mem": 3, "name": "t1_VM3", "vcpu": 2, "vmif": "t1VM3if1"}], "md5sum": "fbfc2eb0c2569531f25eea92c26d3bee", "mode": "0644", "owner": "root", "size": 4091, "src": "/root/.ansible/tmp/ansible-tmp-1574054250.68-126937699245653/source", "state": "file", "uid": 0}

PLAY RECAP **************************************************************************************************************************************************
localhost                  : ok=1    changed=1    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0   

Using /etc/ansible/ansible.cfg as config file

PLAY [main] *************************************************************************************************************************************************

TASK [Create VM templates (C2)] *****************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.2.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.2.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.1.2/24', u'tenant_ns_ip': u'10.2.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.2.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.129.2', u'remote_route': u'10.1.1.0/24', u'subnet_route': u'10.2.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.1.1.2'}]}, {u'mem': 2, u'name': u't1_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM4if1'}]) => {"ansible_loop_var": "item", "changed": true, "checksum": "350ba870bd31b7f6ee517845c14237910b5af0bf", "dest": "/root/Migration-as-a-Service/t1/VM_templates/t1_VM4.xml.j2", "gid": 0, "group": "root", "item": [{"bridge_name": "t1br1", "default_route_ip": "10.2.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.2.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.2.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.2.1.2/24"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.1.2", "remote_ip": "10.1.1.2", "remote_route": "10.1.1.0/24", "subnet_route": "10.2.1.0/24", "tenant_route_ip": "192.168.129.2", "v_name": "vxlan_t1s1"}]}, {"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM4", "vcpu": 4, "vmif": "t1VM4if1"}], "md5sum": "fbfc2eb0c2569531f25eea92c26d3bee", "mode": "0644", "owner": "root", "size": 4091, "src": "/root/.ansible/tmp/ansible-tmp-1574054251.58-137082191962794/source", "state": "file", "uid": 0}

PLAY RECAP **************************************************************************************************************************************************
localhost                  : ok=1    changed=1    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0   

Using /etc/ansible/ansible.cfg as config file

PLAY [main] *************************************************************************************************************************************************

TASK [Copy VM image] ****************************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.1.2/24', u'tenant_ns_ip': u'10.1.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.1.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.1.2', u'remote_route': u'10.2.1.0/24', u'subnet_route': u'10.1.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.2.1.2'}]}, {u'mem': 2, u'name': u't1_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM1if1'}]) => {"ansible_loop_var": "item", "changed": true, "checksum": "d86d5962370fcd0c3d05943fc209d9e05fdac89f", "dest": "/var/lib/libvirt/images/t1_VM1.qcow2", "gid": 0, "group": "root", "item": [{"bridge_name": "t1br1", "default_route_ip": "10.1.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.1.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.1.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.1.1.2/24"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.1.2", "remote_ip": "10.2.1.2", "remote_route": "10.2.1.0/24", "subnet_route": "10.1.1.0/24", "tenant_route_ip": "192.168.1.2", "v_name": "vxlan_t1s1"}]}, {"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM1", "vcpu": 4, "vmif": "t1VM1if1"}], "md5sum": "b977a19124b65f2d544ddc62e407114d", "mode": "0644", "owner": "root", "size": 10739318784, "src": "/root/.ansible/tmp/ansible-tmp-1574054252.87-192290526226641/source", "state": "file", "uid": 0}
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.1.2/24', u'tenant_ns_ip': u'10.1.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.1.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.1.2', u'remote_route': u'10.2.1.0/24', u'subnet_route': u'10.1.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.2.1.2'}]}, {u'mem': 4, u'name': u't1_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br1if2', u'vmif': u't1VM2if1'}]) => {"ansible_loop_var": "item", "changed": true, "checksum": "d86d5962370fcd0c3d05943fc209d9e05fdac89f", "dest": "/var/lib/libvirt/images/t1_VM2.qcow2", "gid": 0, "group": "root", "item": [{"bridge_name": "t1br1", "default_route_ip": "10.1.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.1.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.1.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.1.1.2/24"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.1.2", "remote_ip": "10.2.1.2", "remote_route": "10.2.1.0/24", "subnet_route": "10.1.1.0/24", "tenant_route_ip": "192.168.1.2", "v_name": "vxlan_t1s1"}]}, {"brif": "t1br1if2", "disk": "10G", "mem": 4, "name": "t1_VM2", "vcpu": 2, "vmif": "t1VM2if1"}], "md5sum": "b977a19124b65f2d544ddc62e407114d", "mode": "0644", "owner": "root", "size": 10739318784, "src": "/root/.ansible/tmp/ansible-tmp-1574054354.24-185877516340969/source", "state": "file", "uid": 0}
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.2.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.2.1', u'bridge_name': u't1br2', u'dns': [{u'dnsif': u't1s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s2_dnsbrif'}], u'ns_name': u't1ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.2.2/24', u'tenant_ns_ip': u'10.1.2.1/24', u'tenant_ns_if': u't1ns2if', u'tenant_sub_if': u't1s2if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'2.2.2.0/24', u'vxlan': [{u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}, {u'mem': 3, u'name': u't1_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br2if1', u'vmif': u't1VM3if1'}]) => {"ansible_loop_var": "item", "changed": true, "checksum": "d86d5962370fcd0c3d05943fc209d9e05fdac89f", "dest": "/var/lib/libvirt/images/t1_VM3.qcow2", "gid": 0, "group": "root", "item": [{"bridge_name": "t1br2", "default_route_ip": "10.1.2.1", "dns": [{"brif": "t1s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t1s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns2", "route": [{"if": "p1", "ip": "10.1.2.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "2.2.2.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns2if", "tenant_ns_ip": "10.1.2.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s2if", "tenant_sub_ip": "10.1.2.2/24"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, {"brif": "t1br2if1", "disk": "10G", "mem": 3, "name": "t1_VM3", "vcpu": 2, "vmif": "t1VM3if1"}], "md5sum": "b977a19124b65f2d544ddc62e407114d", "mode": "0644", "owner": "root", "size": 10739318784, "src": "/root/.ansible/tmp/ansible-tmp-1574054484.24-103425965111020/source", "state": "file", "uid": 0}

TASK [Create VM templates (C1)] *****************************************************************************************************************************
ok: [localhost] => (item=[{u'route': [{u'ip': u'10.1.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.1.2/24', u'tenant_ns_ip': u'10.1.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.1.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.1.2', u'remote_route': u'10.2.1.0/24', u'subnet_route': u'10.1.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.2.1.2'}]}, {u'mem': 2, u'name': u't1_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM1if1'}]) => {"ansible_loop_var": "item", "changed": false, "checksum": "350ba870bd31b7f6ee517845c14237910b5af0bf", "dest": "/root/Migration-as-a-Service/t1/VM_templates/t1_VM1.xml.j2", "gid": 0, "group": "root", "item": [{"bridge_name": "t1br1", "default_route_ip": "10.1.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.1.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.1.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.1.1.2/24"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.1.2", "remote_ip": "10.2.1.2", "remote_route": "10.2.1.0/24", "subnet_route": "10.1.1.0/24", "tenant_route_ip": "192.168.1.2", "v_name": "vxlan_t1s1"}]}, {"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM1", "vcpu": 4, "vmif": "t1VM1if1"}], "mode": "0644", "owner": "root", "path": "/root/Migration-as-a-Service/t1/VM_templates/t1_VM1.xml.j2", "size": 4091, "state": "file", "uid": 0}
ok: [localhost] => (item=[{u'route': [{u'ip': u'10.1.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.1.2/24', u'tenant_ns_ip': u'10.1.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.1.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.1.2', u'remote_route': u'10.2.1.0/24', u'subnet_route': u'10.1.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.2.1.2'}]}, {u'mem': 4, u'name': u't1_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br1if2', u'vmif': u't1VM2if1'}]) => {"ansible_loop_var": "item", "changed": false, "checksum": "350ba870bd31b7f6ee517845c14237910b5af0bf", "dest": "/root/Migration-as-a-Service/t1/VM_templates/t1_VM2.xml.j2", "gid": 0, "group": "root", "item": [{"bridge_name": "t1br1", "default_route_ip": "10.1.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.1.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.1.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.1.1.2/24"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.1.2", "remote_ip": "10.2.1.2", "remote_route": "10.2.1.0/24", "subnet_route": "10.1.1.0/24", "tenant_route_ip": "192.168.1.2", "v_name": "vxlan_t1s1"}]}, {"brif": "t1br1if2", "disk": "10G", "mem": 4, "name": "t1_VM2", "vcpu": 2, "vmif": "t1VM2if1"}], "mode": "0644", "owner": "root", "path": "/root/Migration-as-a-Service/t1/VM_templates/t1_VM2.xml.j2", "size": 4091, "state": "file", "uid": 0}
ok: [localhost] => (item=[{u'route': [{u'ip': u'10.1.2.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.2.1', u'bridge_name': u't1br2', u'dns': [{u'dnsif': u't1s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s2_dnsbrif'}], u'ns_name': u't1ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.2.2/24', u'tenant_ns_ip': u'10.1.2.1/24', u'tenant_ns_if': u't1ns2if', u'tenant_sub_if': u't1s2if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'2.2.2.0/24', u'vxlan': [{u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}, {u'mem': 3, u'name': u't1_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br2if1', u'vmif': u't1VM3if1'}]) => {"ansible_loop_var": "item", "changed": false, "checksum": "350ba870bd31b7f6ee517845c14237910b5af0bf", "dest": "/root/Migration-as-a-Service/t1/VM_templates/t1_VM3.xml.j2", "gid": 0, "group": "root", "item": [{"bridge_name": "t1br2", "default_route_ip": "10.1.2.1", "dns": [{"brif": "t1s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t1s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns2", "route": [{"if": "p1", "ip": "10.1.2.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "2.2.2.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns2if", "tenant_ns_ip": "10.1.2.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s2if", "tenant_sub_ip": "10.1.2.2/24"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, {"brif": "t1br2if1", "disk": "10G", "mem": 3, "name": "t1_VM3", "vcpu": 2, "vmif": "t1VM3if1"}], "mode": "0644", "owner": "root", "path": "/root/Migration-as-a-Service/t1/VM_templates/t1_VM3.xml.j2", "size": 4091, "state": "file", "uid": 0}

TASK [Get list of running VMs] ******************************************************************************************************************************
ok: [localhost] => {"changed": false, "cmd": ["virsh", "list", "--name"], "delta": "0:00:00.325742", "end": "2019-11-18 05:23:11.263270", "rc": 0, "start": "2019-11-18 05:23:10.937528", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Define VM] ********************************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.1.2/24', u'tenant_ns_ip': u'10.1.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.1.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.1.2', u'remote_route': u'10.2.1.0/24', u'subnet_route': u'10.1.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.2.1.2'}]}, {u'mem': 2, u'name': u't1_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM1if1'}]) => {"ansible_loop_var": "item", "changed": true, "created": "t1_VM1", "item": [{"bridge_name": "t1br1", "default_route_ip": "10.1.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.1.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.1.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.1.1.2/24"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.1.2", "remote_ip": "10.2.1.2", "remote_route": "10.2.1.0/24", "subnet_route": "10.1.1.0/24", "tenant_route_ip": "192.168.1.2", "v_name": "vxlan_t1s1"}]}, {"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM1", "vcpu": 4, "vmif": "t1VM1if1"}], "warnings": ["'xml' is given - ignoring 'name'"]}
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.1.2/24', u'tenant_ns_ip': u'10.1.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.1.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.1.2', u'remote_route': u'10.2.1.0/24', u'subnet_route': u'10.1.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.2.1.2'}]}, {u'mem': 4, u'name': u't1_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br1if2', u'vmif': u't1VM2if1'}]) => {"ansible_loop_var": "item", "changed": true, "created": "t1_VM2", "item": [{"bridge_name": "t1br1", "default_route_ip": "10.1.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.1.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.1.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.1.1.2/24"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.1.2", "remote_ip": "10.2.1.2", "remote_route": "10.2.1.0/24", "subnet_route": "10.1.1.0/24", "tenant_route_ip": "192.168.1.2", "v_name": "vxlan_t1s1"}]}, {"brif": "t1br1if2", "disk": "10G", "mem": 4, "name": "t1_VM2", "vcpu": 2, "vmif": "t1VM2if1"}], "warnings": ["'xml' is given - ignoring 'name'"]}
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.2.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.2.1', u'bridge_name': u't1br2', u'dns': [{u'dnsif': u't1s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s2_dnsbrif'}], u'ns_name': u't1ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.2.2/24', u'tenant_ns_ip': u'10.1.2.1/24', u'tenant_ns_if': u't1ns2if', u'tenant_sub_if': u't1s2if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'2.2.2.0/24', u'vxlan': [{u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}, {u'mem': 3, u'name': u't1_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br2if1', u'vmif': u't1VM3if1'}]) => {"ansible_loop_var": "item", "changed": true, "created": "t1_VM3", "item": [{"bridge_name": "t1br2", "default_route_ip": "10.1.2.1", "dns": [{"brif": "t1s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t1s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns2", "route": [{"if": "p1", "ip": "10.1.2.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "2.2.2.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns2if", "tenant_ns_ip": "10.1.2.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s2if", "tenant_sub_ip": "10.1.2.2/24"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, {"brif": "t1br2if1", "disk": "10G", "mem": 3, "name": "t1_VM3", "vcpu": 2, "vmif": "t1VM3if1"}], "warnings": ["'xml' is given - ignoring 'name'"]}

TASK [Create VM] ********************************************************************************************************************************************
ok: [localhost] => (item=[{u'route': [{u'ip': u'10.1.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.1.2/24', u'tenant_ns_ip': u'10.1.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.1.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.1.2', u'remote_route': u'10.2.1.0/24', u'subnet_route': u'10.1.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.2.1.2'}]}, {u'mem': 2, u'name': u't1_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM1if1'}]) => {"ansible_loop_var": "item", "changed": false, "create": 0, "item": [{"bridge_name": "t1br1", "default_route_ip": "10.1.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.1.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.1.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.1.1.2/24"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.1.2", "remote_ip": "10.2.1.2", "remote_route": "10.2.1.0/24", "subnet_route": "10.1.1.0/24", "tenant_route_ip": "192.168.1.2", "v_name": "vxlan_t1s1"}]}, {"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM1", "vcpu": 4, "vmif": "t1VM1if1"}]}
ok: [localhost] => (item=[{u'route': [{u'ip': u'10.1.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.1.2/24', u'tenant_ns_ip': u'10.1.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.1.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.1.2', u'remote_route': u'10.2.1.0/24', u'subnet_route': u'10.1.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.2.1.2'}]}, {u'mem': 4, u'name': u't1_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br1if2', u'vmif': u't1VM2if1'}]) => {"ansible_loop_var": "item", "changed": false, "create": 0, "item": [{"bridge_name": "t1br1", "default_route_ip": "10.1.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.1.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.1.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.1.1.2/24"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.1.2", "remote_ip": "10.2.1.2", "remote_route": "10.2.1.0/24", "subnet_route": "10.1.1.0/24", "tenant_route_ip": "192.168.1.2", "v_name": "vxlan_t1s1"}]}, {"brif": "t1br1if2", "disk": "10G", "mem": 4, "name": "t1_VM2", "vcpu": 2, "vmif": "t1VM2if1"}]}
ok: [localhost] => (item=[{u'route': [{u'ip': u'10.1.2.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.2.1', u'bridge_name': u't1br2', u'dns': [{u'dnsif': u't1s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s2_dnsbrif'}], u'ns_name': u't1ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.2.2/24', u'tenant_ns_ip': u'10.1.2.1/24', u'tenant_ns_if': u't1ns2if', u'tenant_sub_if': u't1s2if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'2.2.2.0/24', u'vxlan': [{u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}, {u'mem': 3, u'name': u't1_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br2if1', u'vmif': u't1VM3if1'}]) => {"ansible_loop_var": "item", "changed": false, "create": 0, "item": [{"bridge_name": "t1br2", "default_route_ip": "10.1.2.1", "dns": [{"brif": "t1s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t1s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns2", "route": [{"if": "p1", "ip": "10.1.2.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "2.2.2.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns2if", "tenant_ns_ip": "10.1.2.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s2if", "tenant_sub_ip": "10.1.2.2/24"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, {"brif": "t1br2if1", "disk": "10G", "mem": 3, "name": "t1_VM3", "vcpu": 2, "vmif": "t1VM3if1"}]}

TASK [Start VM] *********************************************************************************************************************************************
ok: [localhost] => (item=[{u'route': [{u'ip': u'10.1.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.1.2/24', u'tenant_ns_ip': u'10.1.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.1.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.1.2', u'remote_route': u'10.2.1.0/24', u'subnet_route': u'10.1.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.2.1.2'}]}, {u'mem': 2, u'name': u't1_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM1if1'}]) => {"ansible_loop_var": "item", "changed": false, "item": [{"bridge_name": "t1br1", "default_route_ip": "10.1.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.1.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.1.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.1.1.2/24"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.1.2", "remote_ip": "10.2.1.2", "remote_route": "10.2.1.0/24", "subnet_route": "10.1.1.0/24", "tenant_route_ip": "192.168.1.2", "v_name": "vxlan_t1s1"}]}, {"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM1", "vcpu": 4, "vmif": "t1VM1if1"}]}
ok: [localhost] => (item=[{u'route': [{u'ip': u'10.1.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.1.2/24', u'tenant_ns_ip': u'10.1.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.1.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.1.2', u'remote_route': u'10.2.1.0/24', u'subnet_route': u'10.1.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.2.1.2'}]}, {u'mem': 4, u'name': u't1_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br1if2', u'vmif': u't1VM2if1'}]) => {"ansible_loop_var": "item", "changed": false, "item": [{"bridge_name": "t1br1", "default_route_ip": "10.1.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.1.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.1.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.1.1.2/24"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.1.2", "remote_ip": "10.2.1.2", "remote_route": "10.2.1.0/24", "subnet_route": "10.1.1.0/24", "tenant_route_ip": "192.168.1.2", "v_name": "vxlan_t1s1"}]}, {"brif": "t1br1if2", "disk": "10G", "mem": 4, "name": "t1_VM2", "vcpu": 2, "vmif": "t1VM2if1"}]}
ok: [localhost] => (item=[{u'route': [{u'ip': u'10.1.2.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.2.1', u'bridge_name': u't1br2', u'dns': [{u'dnsif': u't1s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s2_dnsbrif'}], u'ns_name': u't1ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.2.2/24', u'tenant_ns_ip': u'10.1.2.1/24', u'tenant_ns_if': u't1ns2if', u'tenant_sub_if': u't1s2if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'2.2.2.0/24', u'vxlan': [{u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}, {u'mem': 3, u'name': u't1_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br2if1', u'vmif': u't1VM3if1'}]) => {"ansible_loop_var": "item", "changed": false, "item": [{"bridge_name": "t1br2", "default_route_ip": "10.1.2.1", "dns": [{"brif": "t1s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t1s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns2", "route": [{"if": "p1", "ip": "10.1.2.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "2.2.2.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns2if", "tenant_ns_ip": "10.1.2.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s2if", "tenant_sub_ip": "10.1.2.2/24"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, {"brif": "t1br2if1", "disk": "10G", "mem": 3, "name": "t1_VM3", "vcpu": 2, "vmif": "t1VM3if1"}]}

TASK [Attach VM interface] **********************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.1.2/24', u'tenant_ns_ip': u'10.1.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.1.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.1.2', u'remote_route': u'10.2.1.0/24', u'subnet_route': u'10.1.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.2.1.2'}]}, {u'mem': 2, u'name': u't1_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM1if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "virsh domiflist \"t1_VM1\" | grep -w 't1VM1if1' ; if [ $? -ne 0 ] ; then virsh attach-interface \"t1_VM1\" direct \"t1VM1if1\" --live --persistent ; fi\n", "delta": "0:00:00.263181", "end": "2019-11-18 05:23:20.567657", "item": [{"bridge_name": "t1br1", "default_route_ip": "10.1.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.1.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.1.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.1.1.2/24"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.1.2", "remote_ip": "10.2.1.2", "remote_route": "10.2.1.0/24", "subnet_route": "10.1.1.0/24", "tenant_route_ip": "192.168.1.2", "v_name": "vxlan_t1s1"}]}, {"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM1", "vcpu": 4, "vmif": "t1VM1if1"}], "rc": 0, "start": "2019-11-18 05:23:20.304476", "stderr": "", "stderr_lines": [], "stdout": "Interface attached successfully", "stdout_lines": ["Interface attached successfully"]}
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.1.2/24', u'tenant_ns_ip': u'10.1.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.1.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.1.2', u'remote_route': u'10.2.1.0/24', u'subnet_route': u'10.1.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.2.1.2'}]}, {u'mem': 4, u'name': u't1_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br1if2', u'vmif': u't1VM2if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "virsh domiflist \"t1_VM2\" | grep -w 't1VM2if1' ; if [ $? -ne 0 ] ; then virsh attach-interface \"t1_VM2\" direct \"t1VM2if1\" --live --persistent ; fi\n", "delta": "0:00:00.208877", "end": "2019-11-18 05:23:20.936029", "item": [{"bridge_name": "t1br1", "default_route_ip": "10.1.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.1.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.1.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.1.1.2/24"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.1.2", "remote_ip": "10.2.1.2", "remote_route": "10.2.1.0/24", "subnet_route": "10.1.1.0/24", "tenant_route_ip": "192.168.1.2", "v_name": "vxlan_t1s1"}]}, {"brif": "t1br1if2", "disk": "10G", "mem": 4, "name": "t1_VM2", "vcpu": 2, "vmif": "t1VM2if1"}], "rc": 0, "start": "2019-11-18 05:23:20.727152", "stderr": "", "stderr_lines": [], "stdout": "Interface attached successfully", "stdout_lines": ["Interface attached successfully"]}
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.2.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.2.1', u'bridge_name': u't1br2', u'dns': [{u'dnsif': u't1s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s2_dnsbrif'}], u'ns_name': u't1ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.2.2/24', u'tenant_ns_ip': u'10.1.2.1/24', u'tenant_ns_if': u't1ns2if', u'tenant_sub_if': u't1s2if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'2.2.2.0/24', u'vxlan': [{u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}, {u'mem': 3, u'name': u't1_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br2if1', u'vmif': u't1VM3if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "virsh domiflist \"t1_VM3\" | grep -w 't1VM3if1' ; if [ $? -ne 0 ] ; then virsh attach-interface \"t1_VM3\" direct \"t1VM3if1\" --live --persistent ; fi\n", "delta": "0:00:00.231631", "end": "2019-11-18 05:23:21.304242", "item": [{"bridge_name": "t1br2", "default_route_ip": "10.1.2.1", "dns": [{"brif": "t1s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t1s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns2", "route": [{"if": "p1", "ip": "10.1.2.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "2.2.2.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns2if", "tenant_ns_ip": "10.1.2.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s2if", "tenant_sub_ip": "10.1.2.2/24"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, {"brif": "t1br2if1", "disk": "10G", "mem": 3, "name": "t1_VM3", "vcpu": 2, "vmif": "t1VM3if1"}], "rc": 0, "start": "2019-11-18 05:23:21.072611", "stderr": "", "stderr_lines": [], "stdout": "Interface attached successfully", "stdout_lines": ["Interface attached successfully"]}

TASK [Attach VM interent interface] *************************************************************************************************************************
changed: [localhost] => (item=[{u'subnet_addr': u'1.1.1.0/24'}, {u'mem': 2, u'vcpu': 4, u'disk': u'10G', u'name': u'VM1', u'internet_access': True}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "virsh domiflist 't1_VM1' | grep -w 'default' ; if [ $? -ne 0 ] ; then virsh attach-interface --domain 't1_VM1' --type network --source default --live --config ; fi\n", "delta": "0:00:00.212972", "end": "2019-11-18 05:23:21.661256", "item": [{"subnet_addr": "1.1.1.0/24"}, {"disk": "10G", "internet_access": true, "mem": 2, "name": "VM1", "vcpu": 4}], "rc": 0, "start": "2019-11-18 05:23:21.448284", "stderr": "", "stderr_lines": [], "stdout": "Interface attached successfully", "stdout_lines": ["Interface attached successfully"]}
skipping: [localhost] => (item=[{u'subnet_addr': u'1.1.1.0/24'}, {u'mem': 4, u'vcpu': 2, u'disk': u'10G', u'name': u'VM2', u'internet_access': False}])  => {"ansible_loop_var": "item", "changed": false, "item": [{"subnet_addr": "1.1.1.0/24"}, {"disk": "10G", "internet_access": false, "mem": 4, "name": "VM2", "vcpu": 2}], "skip_reason": "Conditional result was False"}
changed: [localhost] => (item=[{u'subnet_addr': u'2.2.2.0/24'}, {u'mem': 3, u'vcpu': 2, u'disk': u'10G', u'name': u'VM3', u'internet_access': True}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "virsh domiflist 't1_VM3' | grep -w 'default' ; if [ $? -ne 0 ] ; then virsh attach-interface --domain 't1_VM3' --type network --source default --live --config ; fi\n", "delta": "0:00:00.245146", "end": "2019-11-18 05:23:22.044833", "item": [{"subnet_addr": "2.2.2.0/24"}, {"disk": "10G", "internet_access": true, "mem": 3, "name": "VM3", "vcpu": 2}], "rc": 0, "start": "2019-11-18 05:23:21.799687", "stderr": "", "stderr_lines": [], "stdout": "Interface attached successfully", "stdout_lines": ["Interface attached successfully"]}

PLAY RECAP **************************************************************************************************************************************************
localhost                  : ok=8    changed=4    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0   

Using /etc/ansible/ansible.cfg as config file

PLAY [worker] ***********************************************************************************************************************************************

TASK [Copy VM image] ****************************************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.2.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.1.2/24', u'tenant_ns_ip': u'10.2.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.2.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.129.2', u'remote_route': u'10.1.1.0/24', u'subnet_route': u'10.2.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.1.1.2'}]}, {u'mem': 2, u'name': u't1_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM4if1'}]) => {"ansible_loop_var": "item", "changed": true, "checksum": "f8b2ffa2bf201c84196c582f2dec0d33a1eb4b42", "dest": "/var/lib/libvirt/images/t1_VM4.qcow2", "gid": 0, "group": "root", "item": [{"bridge_name": "t1br1", "default_route_ip": "10.2.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.2.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.2.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.2.1.2/24"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.1.2", "remote_ip": "10.1.1.2", "remote_route": "10.1.1.0/24", "subnet_route": "10.2.1.0/24", "tenant_route_ip": "192.168.129.2", "v_name": "vxlan_t1s1"}]}, {"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM4", "vcpu": 4, "vmif": "t1VM4if1"}], "md5sum": "e6d5d524b68797ddd748ba1475985d34", "mode": "0644", "owner": "root", "size": 10739318784, "src": "/root/mainVM.qcow2", "state": "file", "uid": 0}

TASK [Get list of running VMs] ******************************************************************************************************************************
ok: [99.99.99.2] => {"changed": false, "cmd": ["virsh", "list", "--name"], "delta": "0:00:00.024817", "end": "2019-11-18 05:24:42.908959", "rc": 0, "start": "2019-11-18 05:24:42.884142", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Define VM] ********************************************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.2.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.1.2/24', u'tenant_ns_ip': u'10.2.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.2.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.129.2', u'remote_route': u'10.1.1.0/24', u'subnet_route': u'10.2.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.1.1.2'}]}, {u'mem': 2, u'name': u't1_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM4if1'}]) => {"ansible_loop_var": "item", "changed": true, "created": "t1_VM4", "item": [{"bridge_name": "t1br1", "default_route_ip": "10.2.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.2.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.2.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.2.1.2/24"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.1.2", "remote_ip": "10.1.1.2", "remote_route": "10.1.1.0/24", "subnet_route": "10.2.1.0/24", "tenant_route_ip": "192.168.129.2", "v_name": "vxlan_t1s1"}]}, {"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM4", "vcpu": 4, "vmif": "t1VM4if1"}], "warnings": ["'xml' is given - ignoring 'name'"]}

TASK [Create VM] ********************************************************************************************************************************************
ok: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.2.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.1.2/24', u'tenant_ns_ip': u'10.2.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.2.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.129.2', u'remote_route': u'10.1.1.0/24', u'subnet_route': u'10.2.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.1.1.2'}]}, {u'mem': 2, u'name': u't1_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM4if1'}]) => {"ansible_loop_var": "item", "changed": false, "create": 0, "item": [{"bridge_name": "t1br1", "default_route_ip": "10.2.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.2.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.2.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.2.1.2/24"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.1.2", "remote_ip": "10.1.1.2", "remote_route": "10.1.1.0/24", "subnet_route": "10.2.1.0/24", "tenant_route_ip": "192.168.129.2", "v_name": "vxlan_t1s1"}]}, {"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM4", "vcpu": 4, "vmif": "t1VM4if1"}]}

TASK [Start VM] *********************************************************************************************************************************************
ok: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.2.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.1.2/24', u'tenant_ns_ip': u'10.2.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.2.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.129.2', u'remote_route': u'10.1.1.0/24', u'subnet_route': u'10.2.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.1.1.2'}]}, {u'mem': 2, u'name': u't1_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM4if1'}]) => {"ansible_loop_var": "item", "changed": false, "item": [{"bridge_name": "t1br1", "default_route_ip": "10.2.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.2.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.2.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.2.1.2/24"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.1.2", "remote_ip": "10.1.1.2", "remote_route": "10.1.1.0/24", "subnet_route": "10.2.1.0/24", "tenant_route_ip": "192.168.129.2", "v_name": "vxlan_t1s1"}]}, {"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM4", "vcpu": 4, "vmif": "t1VM4if1"}]}

TASK [Attach VM interface] **********************************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.2.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.1.2/24', u'tenant_ns_ip': u'10.2.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.2.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.129.2', u'remote_route': u'10.1.1.0/24', u'subnet_route': u'10.2.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.1.1.2'}]}, {u'mem': 2, u'name': u't1_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM4if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "virsh domiflist \"t1_VM4\" | grep -w 't1VM4if1' ; if [ $? -ne 0 ] ; then virsh attach-interface \"t1_VM4\" direct \"t1VM4if1\" --live --persistent ; fi\n", "delta": "0:00:00.286128", "end": "2019-11-18 05:25:14.942852", "item": [{"bridge_name": "t1br1", "default_route_ip": "10.2.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.2.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.2.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.2.1.2/24"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.1.2", "remote_ip": "10.1.1.2", "remote_route": "10.1.1.0/24", "subnet_route": "10.2.1.0/24", "tenant_route_ip": "192.168.129.2", "v_name": "vxlan_t1s1"}]}, {"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM4", "vcpu": 4, "vmif": "t1VM4if1"}], "rc": 0, "start": "2019-11-18 05:25:14.656724", "stderr": "", "stderr_lines": [], "stdout": "Interface attached successfully", "stdout_lines": ["Interface attached successfully"]}

TASK [Attach VM interent interface] *************************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'subnet_addr': u'1.1.1.0/24'}, {u'mem': 2, u'vcpu': 4, u'disk': u'10G', u'name': u'VM4', u'internet_access': True}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "virsh domiflist 't1_VM4' | grep -w 'default' ; if [ $? -ne 0 ] ; then virsh attach-interface --domain 't1_VM4' --type network --source default --live --config ; fi\n", "delta": "0:00:00.208756", "end": "2019-11-18 05:25:15.453896", "item": [{"subnet_addr": "1.1.1.0/24"}, {"disk": "10G", "internet_access": true, "mem": 2, "name": "VM4", "vcpu": 4}], "rc": 0, "start": "2019-11-18 05:25:15.245140", "stderr": "", "stderr_lines": [], "stdout": "Interface attached successfully", "stdout_lines": ["Interface attached successfully"]}

PLAY RECAP **************************************************************************************************************************************************
99.99.99.2                 : ok=7    changed=4    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0   

INFO:root: 05:26:29.022338 Unable to open user input yaml file
INFO:root: 05:26:29.231704 Unable to open user input yaml file
INFO:root: 05:38:27.029701 Unable to open user input yaml file
INFO:root: 05:38:27.204012 Unable to open user input yaml file
INFO:root: 05:43:26.767095 The subnet 1.1.1.0/24 is present in Cloud 1
INFO:root: 05:43:26.767184 The subnet 1.1.1.0/24 is present in Cloud 2
INFO:root: 05:43:26.767221 The VM VM1 is present in Cloud 1
INFO:root: 05:43:26.767249 The VM VM4 is present in Cloud 2
INFO:root: 05:43:26.767295 The subnet 1.1.1.0/24 is present in destination cloud
INFO:root: 05:43:26.767326 The subnet 1.1.1.0/24 is present in destination cloud
INFO:root: 05:49:05.182509 The subnet 1.1.1.0/24 is present in Cloud 1
INFO:root: 05:49:05.182601 The subnet 1.1.1.0/24 is present in Cloud 2
INFO:root: 05:49:05.182640 The VM VM1 is present in Cloud 1
INFO:root: 05:49:05.182670 The VM VM4 is present in Cloud 2
INFO:root: 05:49:05.182720 The subnet 1.1.1.0/24 is present in destination cloud
INFO:root: 05:49:05.182770 The subnet 1.1.1.0/24 is present in destination cloud
INFO:root: 07:21:39.583127 The subnet 1.1.1.0/24 is present in Cloud 1
INFO:root: 07:21:39.583442 The subnet 1.1.1.0/24 is present in Cloud 2
INFO:root: 07:21:39.583481 The VM VM1 is present in Cloud 1
INFO:root: 07:21:39.583539 The VM VM4 is present in Cloud 2
INFO:root: 07:21:39.583599 The subnet 1.1.1.0/24 is present in destination cloud
INFO:root: 07:21:39.583642 The subnet 1.1.1.0/24 is present in destination cloud
INFO:root: 07:23:49.428126 The subnet 1.1.1.0/24 is present in Cloud 1
INFO:root: 07:23:49.428224 The subnet 1.1.1.0/24 is present in Cloud 2
INFO:root: 07:23:49.428263 The VM VM1 is present in Cloud 1
INFO:root: 07:23:49.428292 The VM VM4 is present in Cloud 2
INFO:root: 07:23:49.428345 The subnet 1.1.1.0/24 is present in destination cloud
INFO:root: 07:23:49.428381 The subnet 1.1.1.0/24 is present in destination cloud
INFO:root: 07:28:57.182219 The subnet 1.1.1.0/24 is present in Cloud 1
INFO:root: 07:28:57.182325 The subnet 1.1.1.0/24 is present in Cloud 2
INFO:root: 07:28:57.182366 The VM VM1 is present in Cloud 1
INFO:root: 07:28:57.182396 The VM VM4 is present in Cloud 2
INFO:root: 07:28:57.182443 The subnet 1.1.1.0/24 is present in destination cloud
INFO:root: 07:28:57.182494 The subnet 1.1.1.0/24 is present in destination cloud
INFO:root: 07:32:13.306818 The subnet 1.1.1.0/24 is present in Cloud 1
INFO:root: 07:32:13.307011 The subnet 1.1.1.0/24 is present in Cloud 2
INFO:root: 07:32:13.307052 The VM VM1 is present in Cloud 1
INFO:root: 07:32:13.307082 The VM VM4 is present in Cloud 2
INFO:root: 07:32:13.307147 The subnet 1.1.1.0/24 is present in destination cloud
INFO:root: 07:32:13.307181 The subnet 1.1.1.0/24 is present in destination cloud
INFO:root: 07:40:59.431020 Printing the yaml input file
INFO:root: 07:40:59.431136 {'C1': [{'subnet_addr': '1.1.1.0/24', 'VM': [{'name': 'VM1', 'disk': '10G', 'mem': 2, 'vcpu': 4, 'internet_access': True}, {'name': 'VM2', 'disk': '10G', 'mem': 4, 'vcpu': 2, 'internet_access': False}]}, {'subnet_addr': '2.2.2.0/24', 'VM': [{'name': 'VM3', 'disk': '10G', 'mem': 3, 'vcpu': 2, 'internet_access': True}]}], 'C2': [{'subnet_addr': '1.1.1.0/24', 'VM': [{'name': 'VM4', 'disk': '10G', 'mem': 2, 'vcpu': 4, 'internet_access': True}]}]}
INFO:root: 07:40:59.431232 Provided subnet in C1: 1.1.1.0/24 is valid
INFO:root: 07:40:59.431281 Provided subnet in C1: 2.2.2.0/24 is valid
INFO:root: 07:40:59.431324 Provided subnet in C2: 1.1.1.0/24 is valid
Using /etc/ansible/ansible.cfg as config file

PLAY [main] *************************************************************************************************************************************************

TASK [Create Tenant Namespace] ******************************************************************************************************************************
changed: [localhost] => (item={u'default_route_ip': u'192.168.2.1', u'name': u't2', u'pns_ip': u'192.168.2.1/24', u'tenant_if': u't2if', u'tenant_ip': u'192.168.2.2/24', u'pns_if': u't2pns_if'}) => {"ansible_loop_var": "item", "changed": true, "cmd": ["ip", "netns", "add", "t2"], "delta": "0:00:00.061090", "end": "2019-11-18 07:41:00.793855", "item": {"default_route_ip": "192.168.2.1", "name": "t2", "pns_if": "t2pns_if", "pns_ip": "192.168.2.1/24", "tenant_if": "t2if", "tenant_ip": "192.168.2.2/24"}, "rc": 0, "start": "2019-11-18 07:41:00.732765", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Create Subnet Namespace] ******************************************************************************************************************************
changed: [localhost] => (item={u'route': [{u'ip': u'10.1.11.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.1.11.1', u'bridge_name': u't2br1', u'dns': [{u'dnsif': u't2s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't2s1_dnsbrif'}], u'ns_name': u't2ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.11.2/24', u'tenant_ns_ip': u'10.1.11.1/24', u'tenant_ns_if': u't2ns1if', u'tenant_ns_name': u't2', u'tenant_sub_if': u't2s1if'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't2_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't2br1if1', u'vmif': u't2VM1if1'}, {u'mem': 4, u'name': u't2_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't2br1if2', u'vmif': u't2VM2if1'}], u'vxlan': [{u'local_ip': u'10.1.11.2', u'tenant_route_ip': u'192.168.2.2', u'dsport': 4789, u'dev': u't2s1if', u'subnet_route': u'10.1.11.0/24', u'remote_route': u'10.2.11.0/24', u'v_name': u'vxlan_t2s1', u'id': 42, u'remote_ip': u'10.2.11.2'}]}) => {"ansible_loop_var": "item", "changed": true, "cmd": ["ip", "netns", "add", "t2ns1"], "delta": "0:00:00.058893", "end": "2019-11-18 07:41:01.118474", "item": {"bridge_name": "t2br1", "default_route_ip": "10.1.11.1", "dns": [{"brif": "t2s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t2s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns1", "route": [{"if": "p1", "ip": "10.1.11.1/24", "ns_if": "t2if", "ns_name": "t2"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t2ns1if", "tenant_ns_ip": "10.1.11.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s1if", "tenant_sub_ip": "10.1.11.2/24"}], "vms": [{"brif": "t2br1if1", "disk": "10G", "mem": 2, "name": "t2_VM1", "vcpu": 4, "vmif": "t2VM1if1"}, {"brif": "t2br1if2", "disk": "10G", "mem": 4, "name": "t2_VM2", "vcpu": 2, "vmif": "t2VM2if1"}], "vxlan": [{"dev": "t2s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.11.2", "remote_ip": "10.2.11.2", "remote_route": "10.2.11.0/24", "subnet_route": "10.1.11.0/24", "tenant_route_ip": "192.168.2.2", "v_name": "vxlan_t2s1"}]}, "rc": 0, "start": "2019-11-18 07:41:01.059581", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}
changed: [localhost] => (item={u'route': [{u'ip': u'10.1.12.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.1.12.1', u'bridge_name': u't2br2', u'dns': [{u'dnsif': u't2s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't2s2_dnsbrif'}], u'ns_name': u't2ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.12.2/24', u'tenant_ns_ip': u'10.1.12.1/24', u'tenant_ns_if': u't2ns2if', u'tenant_ns_name': u't2', u'tenant_sub_if': u't2s2if'}], u'subnet_ip': u'2.2.2.0/24', u'vms': [{u'mem': 3, u'name': u't2_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't2br2if1', u'vmif': u't2VM3if1'}], u'vxlan': [{u'local_ip': [], u'tenant_route_ip': [], u'dsport': [], u'dev': [], u'subnet_route': [], u'remote_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}) => {"ansible_loop_var": "item", "changed": true, "cmd": ["ip", "netns", "add", "t2ns2"], "delta": "0:00:00.052852", "end": "2019-11-18 07:41:01.358911", "item": {"bridge_name": "t2br2", "default_route_ip": "10.1.12.1", "dns": [{"brif": "t2s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t2s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns2", "route": [{"if": "p1", "ip": "10.1.12.1/24", "ns_if": "t2if", "ns_name": "t2"}], "subnet_ip": "2.2.2.0/24", "tenant_ns": [{"tenant_ns_if": "t2ns2if", "tenant_ns_ip": "10.1.12.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s2if", "tenant_sub_ip": "10.1.12.2/24"}], "vms": [{"brif": "t2br2if1", "disk": "10G", "mem": 3, "name": "t2_VM3", "vcpu": 2, "vmif": "t2VM3if1"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, "rc": 0, "start": "2019-11-18 07:41:01.306059", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Create Tenant VETH pairs] *****************************************************************************************************************************
changed: [localhost] => (item={u'default_route_ip': u'192.168.2.1', u'name': u't2', u'pns_ip': u'192.168.2.1/24', u'tenant_if': u't2if', u'tenant_ip': u'192.168.2.2/24', u'pns_if': u't2pns_if'}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip link show \"t2if\" ; if [ $? -ne 0 ] ; then ip link add \"t2if\" type veth peer name \"t2pns_if\" ; fi\n", "delta": "0:00:00.012332", "end": "2019-11-18 07:41:01.622754", "item": {"default_route_ip": "192.168.2.1", "name": "t2", "pns_if": "t2pns_if", "pns_ip": "192.168.2.1/24", "tenant_if": "t2if", "tenant_ip": "192.168.2.2/24"}, "rc": 0, "start": "2019-11-18 07:41:01.610422", "stderr": "Device \"t2if\" does not exist.", "stderr_lines": ["Device \"t2if\" does not exist."], "stdout": "", "stdout_lines": []}

TASK [Attach Tenant VETH Pairs] *****************************************************************************************************************************
changed: [localhost] => (item={u'default_route_ip': u'192.168.2.1', u'name': u't2', u'pns_ip': u'192.168.2.1/24', u'tenant_if': u't2if', u'tenant_ip': u'192.168.2.2/24', u'pns_if': u't2pns_if'}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec pns ip link show \"t2pns_if\" ; if [ $? -ne 0 ] ; then ip link set \"t2pns_if\" netns pns ; fi\nip netns exec \"t2\" ip link show \"t2if\" ; if [ $? -ne 0 ] ; then ip link set \"t2if\" netns \"t2\" ; fi\nip netns exec pns ip link set dev \"t2pns_if\" up\nip netns exec \"t2\" ip link set dev \"t2if\" up\n", "delta": "0:00:00.205986", "end": "2019-11-18 07:41:02.081201", "item": {"default_route_ip": "192.168.2.1", "name": "t2", "pns_if": "t2pns_if", "pns_ip": "192.168.2.1/24", "tenant_if": "t2if", "tenant_ip": "192.168.2.2/24"}, "rc": 0, "start": "2019-11-18 07:41:01.875215", "stderr": "Device \"t2pns_if\" does not exist.\nDevice \"t2if\" does not exist.", "stderr_lines": ["Device \"t2pns_if\" does not exist.", "Device \"t2if\" does not exist."], "stdout": "", "stdout_lines": []}

TASK [Add IP addresses to Tenant VETH Pairs] ****************************************************************************************************************
changed: [localhost] => (item={u'default_route_ip': u'192.168.2.1', u'name': u't2', u'pns_ip': u'192.168.2.1/24', u'tenant_if': u't2if', u'tenant_ip': u'192.168.2.2/24', u'pns_if': u't2pns_if'}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec pns ip addr show \"t2pns_if\" | awk 'FNR==3{ print $2 }' | grep -w '^192.168.2.1/24' ; if [ $? -ne 0 ] ; then ip netns exec pns ip addr add \"192.168.2.1/24\" dev \"t2pns_if\" ; fi\nip netns exec \"t2\" ip addr show \"t2if\" | awk 'FNR==3{ print $2 }' | grep -w '^192.168.2.2/24' ; if [ $? -ne 0 ] ; then ip netns exec \"t2\" ip addr add \"192.168.2.2/24\" dev \"t2if\" ; fi\n", "delta": "0:00:00.147300", "end": "2019-11-18 07:41:02.473202", "item": {"default_route_ip": "192.168.2.1", "name": "t2", "pns_if": "t2pns_if", "pns_ip": "192.168.2.1/24", "tenant_if": "t2if", "tenant_ip": "192.168.2.2/24"}, "rc": 0, "start": "2019-11-18 07:41:02.325902", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Create Namespace VETH Pairs] **************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.11.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.1.11.1', u'bridge_name': u't2br1', u'dns': [{u'dnsif': u't2s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't2s1_dnsbrif'}], u'ns_name': u't2ns1', u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't2_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't2br1if1', u'vmif': u't2VM1if1'}, {u'mem': 4, u'name': u't2_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't2br1if2', u'vmif': u't2VM2if1'}], u'vxlan': [{u'local_ip': u'10.1.11.2', u'dsport': 4789, u'dev': u't2s1if', u'tenant_route_ip': u'192.168.2.2', u'remote_route': u'10.2.11.0/24', u'subnet_route': u'10.1.11.0/24', u'v_name': u'vxlan_t2s1', u'id': 42, u'remote_ip': u'10.2.11.2'}]}, {u'tenant_sub_ip': u'10.1.11.2/24', u'tenant_ns_ip': u'10.1.11.1/24', u'tenant_ns_if': u't2ns1if', u'tenant_sub_if': u't2s1if', u'tenant_ns_name': u't2'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip link show \"t2ns1if\" ; if [ $? -ne 0 ] ; then ip link add \"t2ns1if\" type veth peer name \"t2s1if\" ; fi\n", "delta": "0:00:00.009012", "end": "2019-11-18 07:41:02.732834", "item": [{"bridge_name": "t2br1", "default_route_ip": "10.1.11.1", "dns": [{"brif": "t2s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t2s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns1", "route": [{"if": "p1", "ip": "10.1.11.1/24", "ns_if": "t2if", "ns_name": "t2"}], "subnet_ip": "1.1.1.0/24", "vms": [{"brif": "t2br1if1", "disk": "10G", "mem": 2, "name": "t2_VM1", "vcpu": 4, "vmif": "t2VM1if1"}, {"brif": "t2br1if2", "disk": "10G", "mem": 4, "name": "t2_VM2", "vcpu": 2, "vmif": "t2VM2if1"}], "vxlan": [{"dev": "t2s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.11.2", "remote_ip": "10.2.11.2", "remote_route": "10.2.11.0/24", "subnet_route": "10.1.11.0/24", "tenant_route_ip": "192.168.2.2", "v_name": "vxlan_t2s1"}]}, {"tenant_ns_if": "t2ns1if", "tenant_ns_ip": "10.1.11.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s1if", "tenant_sub_ip": "10.1.11.2/24"}], "rc": 0, "start": "2019-11-18 07:41:02.723822", "stderr": "Device \"t2ns1if\" does not exist.", "stderr_lines": ["Device \"t2ns1if\" does not exist."], "stdout": "", "stdout_lines": []}
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.12.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.1.12.1', u'bridge_name': u't2br2', u'dns': [{u'dnsif': u't2s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't2s2_dnsbrif'}], u'ns_name': u't2ns2', u'subnet_ip': u'2.2.2.0/24', u'vms': [{u'mem': 3, u'name': u't2_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't2br2if1', u'vmif': u't2VM3if1'}], u'vxlan': [{u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}, {u'tenant_sub_ip': u'10.1.12.2/24', u'tenant_ns_ip': u'10.1.12.1/24', u'tenant_ns_if': u't2ns2if', u'tenant_sub_if': u't2s2if', u'tenant_ns_name': u't2'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip link show \"t2ns2if\" ; if [ $? -ne 0 ] ; then ip link add \"t2ns2if\" type veth peer name \"t2s2if\" ; fi\n", "delta": "0:00:00.010610", "end": "2019-11-18 07:41:02.932942", "item": [{"bridge_name": "t2br2", "default_route_ip": "10.1.12.1", "dns": [{"brif": "t2s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t2s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns2", "route": [{"if": "p1", "ip": "10.1.12.1/24", "ns_if": "t2if", "ns_name": "t2"}], "subnet_ip": "2.2.2.0/24", "vms": [{"brif": "t2br2if1", "disk": "10G", "mem": 3, "name": "t2_VM3", "vcpu": 2, "vmif": "t2VM3if1"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, {"tenant_ns_if": "t2ns2if", "tenant_ns_ip": "10.1.12.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s2if", "tenant_sub_ip": "10.1.12.2/24"}], "rc": 0, "start": "2019-11-18 07:41:02.922332", "stderr": "Device \"t2ns2if\" does not exist.", "stderr_lines": ["Device \"t2ns2if\" does not exist."], "stdout": "", "stdout_lines": []}

TASK [Attach Namespace VETH Pairs] **************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.11.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.1.11.1', u'bridge_name': u't2br1', u'dns': [{u'dnsif': u't2s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't2s1_dnsbrif'}], u'ns_name': u't2ns1', u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't2_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't2br1if1', u'vmif': u't2VM1if1'}, {u'mem': 4, u'name': u't2_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't2br1if2', u'vmif': u't2VM2if1'}], u'vxlan': [{u'local_ip': u'10.1.11.2', u'dsport': 4789, u'dev': u't2s1if', u'tenant_route_ip': u'192.168.2.2', u'remote_route': u'10.2.11.0/24', u'subnet_route': u'10.1.11.0/24', u'v_name': u'vxlan_t2s1', u'id': 42, u'remote_ip': u'10.2.11.2'}]}, {u'tenant_sub_ip': u'10.1.11.2/24', u'tenant_ns_ip': u'10.1.11.1/24', u'tenant_ns_if': u't2ns1if', u'tenant_sub_if': u't2s1if', u'tenant_ns_name': u't2'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t2\" ip link show \"t2ns1if\" ; if [ $? -ne 0 ] ; then ip link set \"t2ns1if\" netns \"t2\" ; fi\nip netns exec \"t2ns1\" ip link show \"t2s1if\" ; if [ $? -ne 0 ] ; then ip link set \"t2s1if\" netns \"t2ns1\" ; fi\n", "delta": "0:00:00.131518", "end": "2019-11-18 07:41:03.316001", "item": [{"bridge_name": "t2br1", "default_route_ip": "10.1.11.1", "dns": [{"brif": "t2s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t2s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns1", "route": [{"if": "p1", "ip": "10.1.11.1/24", "ns_if": "t2if", "ns_name": "t2"}], "subnet_ip": "1.1.1.0/24", "vms": [{"brif": "t2br1if1", "disk": "10G", "mem": 2, "name": "t2_VM1", "vcpu": 4, "vmif": "t2VM1if1"}, {"brif": "t2br1if2", "disk": "10G", "mem": 4, "name": "t2_VM2", "vcpu": 2, "vmif": "t2VM2if1"}], "vxlan": [{"dev": "t2s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.11.2", "remote_ip": "10.2.11.2", "remote_route": "10.2.11.0/24", "subnet_route": "10.1.11.0/24", "tenant_route_ip": "192.168.2.2", "v_name": "vxlan_t2s1"}]}, {"tenant_ns_if": "t2ns1if", "tenant_ns_ip": "10.1.11.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s1if", "tenant_sub_ip": "10.1.11.2/24"}], "rc": 0, "start": "2019-11-18 07:41:03.184483", "stderr": "Device \"t2ns1if\" does not exist.\nDevice \"t2s1if\" does not exist.", "stderr_lines": ["Device \"t2ns1if\" does not exist.", "Device \"t2s1if\" does not exist."], "stdout": "", "stdout_lines": []}
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.12.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.1.12.1', u'bridge_name': u't2br2', u'dns': [{u'dnsif': u't2s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't2s2_dnsbrif'}], u'ns_name': u't2ns2', u'subnet_ip': u'2.2.2.0/24', u'vms': [{u'mem': 3, u'name': u't2_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't2br2if1', u'vmif': u't2VM3if1'}], u'vxlan': [{u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}, {u'tenant_sub_ip': u'10.1.12.2/24', u'tenant_ns_ip': u'10.1.12.1/24', u'tenant_ns_if': u't2ns2if', u'tenant_sub_if': u't2s2if', u'tenant_ns_name': u't2'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t2\" ip link show \"t2ns2if\" ; if [ $? -ne 0 ] ; then ip link set \"t2ns2if\" netns \"t2\" ; fi\nip netns exec \"t2ns2\" ip link show \"t2s2if\" ; if [ $? -ne 0 ] ; then ip link set \"t2s2if\" netns \"t2ns2\" ; fi\n", "delta": "0:00:00.108405", "end": "2019-11-18 07:41:03.623073", "item": [{"bridge_name": "t2br2", "default_route_ip": "10.1.12.1", "dns": [{"brif": "t2s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t2s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns2", "route": [{"if": "p1", "ip": "10.1.12.1/24", "ns_if": "t2if", "ns_name": "t2"}], "subnet_ip": "2.2.2.0/24", "vms": [{"brif": "t2br2if1", "disk": "10G", "mem": 3, "name": "t2_VM3", "vcpu": 2, "vmif": "t2VM3if1"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, {"tenant_ns_if": "t2ns2if", "tenant_ns_ip": "10.1.12.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s2if", "tenant_sub_ip": "10.1.12.2/24"}], "rc": 0, "start": "2019-11-18 07:41:03.514668", "stderr": "Device \"t2ns2if\" does not exist.\nDevice \"t2s2if\" does not exist.", "stderr_lines": ["Device \"t2ns2if\" does not exist.", "Device \"t2s2if\" does not exist."], "stdout": "", "stdout_lines": []}

TASK [Set Namespace VETH Pairs UP] **************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.11.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.1.11.1', u'bridge_name': u't2br1', u'dns': [{u'dnsif': u't2s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't2s1_dnsbrif'}], u'ns_name': u't2ns1', u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't2_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't2br1if1', u'vmif': u't2VM1if1'}, {u'mem': 4, u'name': u't2_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't2br1if2', u'vmif': u't2VM2if1'}], u'vxlan': [{u'local_ip': u'10.1.11.2', u'dsport': 4789, u'dev': u't2s1if', u'tenant_route_ip': u'192.168.2.2', u'remote_route': u'10.2.11.0/24', u'subnet_route': u'10.1.11.0/24', u'v_name': u'vxlan_t2s1', u'id': 42, u'remote_ip': u'10.2.11.2'}]}, {u'tenant_sub_ip': u'10.1.11.2/24', u'tenant_ns_ip': u'10.1.11.1/24', u'tenant_ns_if': u't2ns1if', u'tenant_sub_if': u't2s1if', u'tenant_ns_name': u't2'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t2\" ip link set dev \"t2ns1if\" up\nip netns exec \"t2ns1\" ip link set dev \"t2s1if\" up\n", "delta": "0:00:00.077857", "end": "2019-11-18 07:41:03.989419", "item": [{"bridge_name": "t2br1", "default_route_ip": "10.1.11.1", "dns": [{"brif": "t2s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t2s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns1", "route": [{"if": "p1", "ip": "10.1.11.1/24", "ns_if": "t2if", "ns_name": "t2"}], "subnet_ip": "1.1.1.0/24", "vms": [{"brif": "t2br1if1", "disk": "10G", "mem": 2, "name": "t2_VM1", "vcpu": 4, "vmif": "t2VM1if1"}, {"brif": "t2br1if2", "disk": "10G", "mem": 4, "name": "t2_VM2", "vcpu": 2, "vmif": "t2VM2if1"}], "vxlan": [{"dev": "t2s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.11.2", "remote_ip": "10.2.11.2", "remote_route": "10.2.11.0/24", "subnet_route": "10.1.11.0/24", "tenant_route_ip": "192.168.2.2", "v_name": "vxlan_t2s1"}]}, {"tenant_ns_if": "t2ns1if", "tenant_ns_ip": "10.1.11.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s1if", "tenant_sub_ip": "10.1.11.2/24"}], "rc": 0, "start": "2019-11-18 07:41:03.911562", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.12.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.1.12.1', u'bridge_name': u't2br2', u'dns': [{u'dnsif': u't2s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't2s2_dnsbrif'}], u'ns_name': u't2ns2', u'subnet_ip': u'2.2.2.0/24', u'vms': [{u'mem': 3, u'name': u't2_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't2br2if1', u'vmif': u't2VM3if1'}], u'vxlan': [{u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}, {u'tenant_sub_ip': u'10.1.12.2/24', u'tenant_ns_ip': u'10.1.12.1/24', u'tenant_ns_if': u't2ns2if', u'tenant_sub_if': u't2s2if', u'tenant_ns_name': u't2'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t2\" ip link set dev \"t2ns2if\" up\nip netns exec \"t2ns2\" ip link set dev \"t2s2if\" up\n", "delta": "0:00:00.074334", "end": "2019-11-18 07:41:04.257176", "item": [{"bridge_name": "t2br2", "default_route_ip": "10.1.12.1", "dns": [{"brif": "t2s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t2s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns2", "route": [{"if": "p1", "ip": "10.1.12.1/24", "ns_if": "t2if", "ns_name": "t2"}], "subnet_ip": "2.2.2.0/24", "vms": [{"brif": "t2br2if1", "disk": "10G", "mem": 3, "name": "t2_VM3", "vcpu": 2, "vmif": "t2VM3if1"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, {"tenant_ns_if": "t2ns2if", "tenant_ns_ip": "10.1.12.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s2if", "tenant_sub_ip": "10.1.12.2/24"}], "rc": 0, "start": "2019-11-18 07:41:04.182842", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Add IP addresses to Namespace VETH Pairs] *************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.11.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.1.11.1', u'bridge_name': u't2br1', u'dns': [{u'dnsif': u't2s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't2s1_dnsbrif'}], u'ns_name': u't2ns1', u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't2_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't2br1if1', u'vmif': u't2VM1if1'}, {u'mem': 4, u'name': u't2_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't2br1if2', u'vmif': u't2VM2if1'}], u'vxlan': [{u'local_ip': u'10.1.11.2', u'dsport': 4789, u'dev': u't2s1if', u'tenant_route_ip': u'192.168.2.2', u'remote_route': u'10.2.11.0/24', u'subnet_route': u'10.1.11.0/24', u'v_name': u'vxlan_t2s1', u'id': 42, u'remote_ip': u'10.2.11.2'}]}, {u'tenant_sub_ip': u'10.1.11.2/24', u'tenant_ns_ip': u'10.1.11.1/24', u'tenant_ns_if': u't2ns1if', u'tenant_sub_if': u't2s1if', u'tenant_ns_name': u't2'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t2ns1\" ip addr show \"t2s1if\" | awk 'FNR==3{ print $2 }' | grep -w '^10.1.11.2/24' ; if [ $? -ne 0 ] ; then ip netns exec \"t2ns1\" ip addr add \"10.1.11.2/24\" dev \"t2s1if\" ; fi\n\nip netns exec \"t2\" ip addr show \"t2ns1if\" | awk 'FNR==3{ print $2 }' | grep -w '^10.1.11.1/24' ; if [ $? -ne 0 ] ; then ip netns exec \"t2\" ip addr add \"10.1.11.1/24\" dev \"t2ns1if\" ; fi\n", "delta": "0:00:00.166368", "end": "2019-11-18 07:41:04.681158", "item": [{"bridge_name": "t2br1", "default_route_ip": "10.1.11.1", "dns": [{"brif": "t2s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t2s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns1", "route": [{"if": "p1", "ip": "10.1.11.1/24", "ns_if": "t2if", "ns_name": "t2"}], "subnet_ip": "1.1.1.0/24", "vms": [{"brif": "t2br1if1", "disk": "10G", "mem": 2, "name": "t2_VM1", "vcpu": 4, "vmif": "t2VM1if1"}, {"brif": "t2br1if2", "disk": "10G", "mem": 4, "name": "t2_VM2", "vcpu": 2, "vmif": "t2VM2if1"}], "vxlan": [{"dev": "t2s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.11.2", "remote_ip": "10.2.11.2", "remote_route": "10.2.11.0/24", "subnet_route": "10.1.11.0/24", "tenant_route_ip": "192.168.2.2", "v_name": "vxlan_t2s1"}]}, {"tenant_ns_if": "t2ns1if", "tenant_ns_ip": "10.1.11.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s1if", "tenant_sub_ip": "10.1.11.2/24"}], "rc": 0, "start": "2019-11-18 07:41:04.514790", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.12.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.1.12.1', u'bridge_name': u't2br2', u'dns': [{u'dnsif': u't2s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't2s2_dnsbrif'}], u'ns_name': u't2ns2', u'subnet_ip': u'2.2.2.0/24', u'vms': [{u'mem': 3, u'name': u't2_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't2br2if1', u'vmif': u't2VM3if1'}], u'vxlan': [{u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}, {u'tenant_sub_ip': u'10.1.12.2/24', u'tenant_ns_ip': u'10.1.12.1/24', u'tenant_ns_if': u't2ns2if', u'tenant_sub_if': u't2s2if', u'tenant_ns_name': u't2'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t2ns2\" ip addr show \"t2s2if\" | awk 'FNR==3{ print $2 }' | grep -w '^10.1.12.2/24' ; if [ $? -ne 0 ] ; then ip netns exec \"t2ns2\" ip addr add \"10.1.12.2/24\" dev \"t2s2if\" ; fi\n\nip netns exec \"t2\" ip addr show \"t2ns2if\" | awk 'FNR==3{ print $2 }' | grep -w '^10.1.12.1/24' ; if [ $? -ne 0 ] ; then ip netns exec \"t2\" ip addr add \"10.1.12.1/24\" dev \"t2ns2if\" ; fi\n", "delta": "0:00:00.164069", "end": "2019-11-18 07:41:05.029437", "item": [{"bridge_name": "t2br2", "default_route_ip": "10.1.12.1", "dns": [{"brif": "t2s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t2s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns2", "route": [{"if": "p1", "ip": "10.1.12.1/24", "ns_if": "t2if", "ns_name": "t2"}], "subnet_ip": "2.2.2.0/24", "vms": [{"brif": "t2br2if1", "disk": "10G", "mem": 3, "name": "t2_VM3", "vcpu": 2, "vmif": "t2VM3if1"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, {"tenant_ns_if": "t2ns2if", "tenant_ns_ip": "10.1.12.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s2if", "tenant_sub_ip": "10.1.12.2/24"}], "rc": 0, "start": "2019-11-18 07:41:04.865368", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Add IP Route to Tenant] *******************************************************************************************************************************
changed: [localhost] => (item={u'default_route_ip': u'192.168.2.1', u'name': u't2', u'pns_ip': u'192.168.2.1/24', u'tenant_if': u't2if', u'tenant_ip': u'192.168.2.2/24', u'pns_if': u't2pns_if'}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t2\" ip route show default | grep -w '[d]efault via 192.168.2.1' ; if [ $? -ne 0 ] ; then ip netns exec \"t2\" ip route add default via \"192.168.2.1\" ; fi\n", "delta": "0:00:00.082794", "end": "2019-11-18 07:41:05.389426", "item": {"default_route_ip": "192.168.2.1", "name": "t2", "pns_if": "t2pns_if", "pns_ip": "192.168.2.1/24", "tenant_if": "t2if", "tenant_ip": "192.168.2.2/24"}, "rc": 0, "start": "2019-11-18 07:41:05.306632", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Add IP Route to Tenant Subnet] ************************************************************************************************************************
changed: [localhost] => (item={u'route': [{u'ip': u'10.1.11.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.1.11.1', u'bridge_name': u't2br1', u'dns': [{u'dnsif': u't2s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't2s1_dnsbrif'}], u'ns_name': u't2ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.11.2/24', u'tenant_ns_ip': u'10.1.11.1/24', u'tenant_ns_if': u't2ns1if', u'tenant_ns_name': u't2', u'tenant_sub_if': u't2s1if'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't2_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't2br1if1', u'vmif': u't2VM1if1'}, {u'mem': 4, u'name': u't2_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't2br1if2', u'vmif': u't2VM2if1'}], u'vxlan': [{u'local_ip': u'10.1.11.2', u'tenant_route_ip': u'192.168.2.2', u'dsport': 4789, u'dev': u't2s1if', u'subnet_route': u'10.1.11.0/24', u'remote_route': u'10.2.11.0/24', u'v_name': u'vxlan_t2s1', u'id': 42, u'remote_ip': u'10.2.11.2'}]}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t2ns1\" ip route show default | grep -w '[d]efault via 10.1.11.1' ; if [ $? -ne 0 ] ; then ip netns exec \"t2ns1\" ip route add default via \"10.1.11.1\" ; fi\n", "delta": "0:00:00.085714", "end": "2019-11-18 07:41:05.765337", "item": {"bridge_name": "t2br1", "default_route_ip": "10.1.11.1", "dns": [{"brif": "t2s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t2s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns1", "route": [{"if": "p1", "ip": "10.1.11.1/24", "ns_if": "t2if", "ns_name": "t2"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t2ns1if", "tenant_ns_ip": "10.1.11.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s1if", "tenant_sub_ip": "10.1.11.2/24"}], "vms": [{"brif": "t2br1if1", "disk": "10G", "mem": 2, "name": "t2_VM1", "vcpu": 4, "vmif": "t2VM1if1"}, {"brif": "t2br1if2", "disk": "10G", "mem": 4, "name": "t2_VM2", "vcpu": 2, "vmif": "t2VM2if1"}], "vxlan": [{"dev": "t2s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.11.2", "remote_ip": "10.2.11.2", "remote_route": "10.2.11.0/24", "subnet_route": "10.1.11.0/24", "tenant_route_ip": "192.168.2.2", "v_name": "vxlan_t2s1"}]}, "rc": 0, "start": "2019-11-18 07:41:05.679623", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}
changed: [localhost] => (item={u'route': [{u'ip': u'10.1.12.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.1.12.1', u'bridge_name': u't2br2', u'dns': [{u'dnsif': u't2s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't2s2_dnsbrif'}], u'ns_name': u't2ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.12.2/24', u'tenant_ns_ip': u'10.1.12.1/24', u'tenant_ns_if': u't2ns2if', u'tenant_ns_name': u't2', u'tenant_sub_if': u't2s2if'}], u'subnet_ip': u'2.2.2.0/24', u'vms': [{u'mem': 3, u'name': u't2_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't2br2if1', u'vmif': u't2VM3if1'}], u'vxlan': [{u'local_ip': [], u'tenant_route_ip': [], u'dsport': [], u'dev': [], u'subnet_route': [], u'remote_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t2ns2\" ip route show default | grep -w '[d]efault via 10.1.12.1' ; if [ $? -ne 0 ] ; then ip netns exec \"t2ns2\" ip route add default via \"10.1.12.1\" ; fi\n", "delta": "0:00:00.069520", "end": "2019-11-18 07:41:06.057451", "item": {"bridge_name": "t2br2", "default_route_ip": "10.1.12.1", "dns": [{"brif": "t2s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t2s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns2", "route": [{"if": "p1", "ip": "10.1.12.1/24", "ns_if": "t2if", "ns_name": "t2"}], "subnet_ip": "2.2.2.0/24", "tenant_ns": [{"tenant_ns_if": "t2ns2if", "tenant_ns_ip": "10.1.12.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s2if", "tenant_sub_ip": "10.1.12.2/24"}], "vms": [{"brif": "t2br2if1", "disk": "10G", "mem": 3, "name": "t2_VM3", "vcpu": 2, "vmif": "t2VM3if1"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, "rc": 0, "start": "2019-11-18 07:41:05.987931", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Create bridge inside namespace] ***********************************************************************************************************************
changed: [localhost] => (item={u'route': [{u'ip': u'10.1.11.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.1.11.1', u'bridge_name': u't2br1', u'dns': [{u'dnsif': u't2s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't2s1_dnsbrif'}], u'ns_name': u't2ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.11.2/24', u'tenant_ns_ip': u'10.1.11.1/24', u'tenant_ns_if': u't2ns1if', u'tenant_ns_name': u't2', u'tenant_sub_if': u't2s1if'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't2_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't2br1if1', u'vmif': u't2VM1if1'}, {u'mem': 4, u'name': u't2_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't2br1if2', u'vmif': u't2VM2if1'}], u'vxlan': [{u'local_ip': u'10.1.11.2', u'tenant_route_ip': u'192.168.2.2', u'dsport': 4789, u'dev': u't2s1if', u'subnet_route': u'10.1.11.0/24', u'remote_route': u'10.2.11.0/24', u'v_name': u'vxlan_t2s1', u'id': 42, u'remote_ip': u'10.2.11.2'}]}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t2ns1\" brctl show | grep -w '^t2br1'; if [ $? -ne 0 ] ; then ip netns exec \"t2ns1\" brctl addbr \"t2br1\" ; fi\nip netns exec \"t2ns1\" ip link set dev \"t2br1\" up\n", "delta": "0:00:00.140407", "end": "2019-11-18 07:41:06.489562", "item": {"bridge_name": "t2br1", "default_route_ip": "10.1.11.1", "dns": [{"brif": "t2s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t2s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns1", "route": [{"if": "p1", "ip": "10.1.11.1/24", "ns_if": "t2if", "ns_name": "t2"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t2ns1if", "tenant_ns_ip": "10.1.11.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s1if", "tenant_sub_ip": "10.1.11.2/24"}], "vms": [{"brif": "t2br1if1", "disk": "10G", "mem": 2, "name": "t2_VM1", "vcpu": 4, "vmif": "t2VM1if1"}, {"brif": "t2br1if2", "disk": "10G", "mem": 4, "name": "t2_VM2", "vcpu": 2, "vmif": "t2VM2if1"}], "vxlan": [{"dev": "t2s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.11.2", "remote_ip": "10.2.11.2", "remote_route": "10.2.11.0/24", "subnet_route": "10.1.11.0/24", "tenant_route_ip": "192.168.2.2", "v_name": "vxlan_t2s1"}]}, "rc": 0, "start": "2019-11-18 07:41:06.349155", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}
changed: [localhost] => (item={u'route': [{u'ip': u'10.1.12.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.1.12.1', u'bridge_name': u't2br2', u'dns': [{u'dnsif': u't2s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't2s2_dnsbrif'}], u'ns_name': u't2ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.12.2/24', u'tenant_ns_ip': u'10.1.12.1/24', u'tenant_ns_if': u't2ns2if', u'tenant_ns_name': u't2', u'tenant_sub_if': u't2s2if'}], u'subnet_ip': u'2.2.2.0/24', u'vms': [{u'mem': 3, u'name': u't2_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't2br2if1', u'vmif': u't2VM3if1'}], u'vxlan': [{u'local_ip': [], u'tenant_route_ip': [], u'dsport': [], u'dev': [], u'subnet_route': [], u'remote_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t2ns2\" brctl show | grep -w '^t2br2'; if [ $? -ne 0 ] ; then ip netns exec \"t2ns2\" brctl addbr \"t2br2\" ; fi\nip netns exec \"t2ns2\" ip link set dev \"t2br2\" up\n", "delta": "0:00:00.117062", "end": "2019-11-18 07:41:06.841469", "item": {"bridge_name": "t2br2", "default_route_ip": "10.1.12.1", "dns": [{"brif": "t2s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t2s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns2", "route": [{"if": "p1", "ip": "10.1.12.1/24", "ns_if": "t2if", "ns_name": "t2"}], "subnet_ip": "2.2.2.0/24", "tenant_ns": [{"tenant_ns_if": "t2ns2if", "tenant_ns_ip": "10.1.12.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s2if", "tenant_sub_ip": "10.1.12.2/24"}], "vms": [{"brif": "t2br2if1", "disk": "10G", "mem": 3, "name": "t2_VM3", "vcpu": 2, "vmif": "t2VM3if1"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, "rc": 0, "start": "2019-11-18 07:41:06.724407", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Create DNS VETH Pair] *********************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.11.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.1.11.1', u'bridge_name': u't2br1', u'ns_name': u't2ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.11.2/24', u'tenant_ns_ip': u'10.1.11.1/24', u'tenant_ns_if': u't2ns1if', u'tenant_sub_if': u't2s1if', u'tenant_ns_name': u't2'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't2_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't2br1if1', u'vmif': u't2VM1if1'}, {u'mem': 4, u'name': u't2_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't2br1if2', u'vmif': u't2VM2if1'}], u'vxlan': [{u'local_ip': u'10.1.11.2', u'dsport': 4789, u'dev': u't2s1if', u'tenant_route_ip': u'192.168.2.2', u'remote_route': u'10.2.11.0/24', u'subnet_route': u'10.1.11.0/24', u'v_name': u'vxlan_t2s1', u'id': 42, u'remote_ip': u'10.2.11.2'}]}, {u'dnsif': u't2s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't2s1_dnsbrif'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t2ns1\" ip link show \"t2s1_dnsbrif\" ; if [ $? -ne 0 ] ; then ip netns exec \"t2ns1\" ip link add \"t2s1_dnsbrif\" type veth peer name \"t2s1_dnsif\" ; fi\nip netns exec \"t2ns1\" ip link set dev \"t2s1_dnsbrif\" up\nip netns exec \"t2ns1\" ip link set dev \"t2s1_dnsif\" up\n", "delta": "0:00:00.147908", "end": "2019-11-18 07:41:07.273213", "item": [{"bridge_name": "t2br1", "default_route_ip": "10.1.11.1", "ns_name": "t2ns1", "route": [{"if": "p1", "ip": "10.1.11.1/24", "ns_if": "t2if", "ns_name": "t2"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t2ns1if", "tenant_ns_ip": "10.1.11.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s1if", "tenant_sub_ip": "10.1.11.2/24"}], "vms": [{"brif": "t2br1if1", "disk": "10G", "mem": 2, "name": "t2_VM1", "vcpu": 4, "vmif": "t2VM1if1"}, {"brif": "t2br1if2", "disk": "10G", "mem": 4, "name": "t2_VM2", "vcpu": 2, "vmif": "t2VM2if1"}], "vxlan": [{"dev": "t2s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.11.2", "remote_ip": "10.2.11.2", "remote_route": "10.2.11.0/24", "subnet_route": "10.1.11.0/24", "tenant_route_ip": "192.168.2.2", "v_name": "vxlan_t2s1"}]}, {"brif": "t2s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t2s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "rc": 0, "start": "2019-11-18 07:41:07.125305", "stderr": "Device \"t2s1_dnsbrif\" does not exist.", "stderr_lines": ["Device \"t2s1_dnsbrif\" does not exist."], "stdout": "", "stdout_lines": []}
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.12.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.1.12.1', u'bridge_name': u't2br2', u'ns_name': u't2ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.12.2/24', u'tenant_ns_ip': u'10.1.12.1/24', u'tenant_ns_if': u't2ns2if', u'tenant_sub_if': u't2s2if', u'tenant_ns_name': u't2'}], u'subnet_ip': u'2.2.2.0/24', u'vms': [{u'mem': 3, u'name': u't2_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't2br2if1', u'vmif': u't2VM3if1'}], u'vxlan': [{u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}, {u'dnsif': u't2s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't2s2_dnsbrif'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t2ns2\" ip link show \"t2s2_dnsbrif\" ; if [ $? -ne 0 ] ; then ip netns exec \"t2ns2\" ip link add \"t2s2_dnsbrif\" type veth peer name \"t2s2_dnsif\" ; fi\nip netns exec \"t2ns2\" ip link set dev \"t2s2_dnsbrif\" up\nip netns exec \"t2ns2\" ip link set dev \"t2s2_dnsif\" up\n", "delta": "0:00:00.163286", "end": "2019-11-18 07:41:07.625232", "item": [{"bridge_name": "t2br2", "default_route_ip": "10.1.12.1", "ns_name": "t2ns2", "route": [{"if": "p1", "ip": "10.1.12.1/24", "ns_if": "t2if", "ns_name": "t2"}], "subnet_ip": "2.2.2.0/24", "tenant_ns": [{"tenant_ns_if": "t2ns2if", "tenant_ns_ip": "10.1.12.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s2if", "tenant_sub_ip": "10.1.12.2/24"}], "vms": [{"brif": "t2br2if1", "disk": "10G", "mem": 3, "name": "t2_VM3", "vcpu": 2, "vmif": "t2VM3if1"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, {"brif": "t2s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t2s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "rc": 0, "start": "2019-11-18 07:41:07.461946", "stderr": "Device \"t2s2_dnsbrif\" does not exist.", "stderr_lines": ["Device \"t2s2_dnsbrif\" does not exist."], "stdout": "", "stdout_lines": []}

TASK [Attach DNS VETH Pair] *********************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.11.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.1.11.1', u'bridge_name': u't2br1', u'ns_name': u't2ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.11.2/24', u'tenant_ns_ip': u'10.1.11.1/24', u'tenant_ns_if': u't2ns1if', u'tenant_sub_if': u't2s1if', u'tenant_ns_name': u't2'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't2_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't2br1if1', u'vmif': u't2VM1if1'}, {u'mem': 4, u'name': u't2_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't2br1if2', u'vmif': u't2VM2if1'}], u'vxlan': [{u'local_ip': u'10.1.11.2', u'dsport': 4789, u'dev': u't2s1if', u'tenant_route_ip': u'192.168.2.2', u'remote_route': u'10.2.11.0/24', u'subnet_route': u'10.1.11.0/24', u'v_name': u'vxlan_t2s1', u'id': 42, u'remote_ip': u'10.2.11.2'}]}, {u'dnsif': u't2s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't2s1_dnsbrif'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t2ns1\" brctl show \"t2br1\" | grep -w 't2s1_dnsbrif' ; if [ $? -ne 0 ] ; then ip netns exec \"t2ns1\" brctl addif \"t2br1\" \"t2s1_dnsbrif\" ; fi\n", "delta": "0:00:00.082969", "end": "2019-11-18 07:41:07.965166", "item": [{"bridge_name": "t2br1", "default_route_ip": "10.1.11.1", "ns_name": "t2ns1", "route": [{"if": "p1", "ip": "10.1.11.1/24", "ns_if": "t2if", "ns_name": "t2"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t2ns1if", "tenant_ns_ip": "10.1.11.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s1if", "tenant_sub_ip": "10.1.11.2/24"}], "vms": [{"brif": "t2br1if1", "disk": "10G", "mem": 2, "name": "t2_VM1", "vcpu": 4, "vmif": "t2VM1if1"}, {"brif": "t2br1if2", "disk": "10G", "mem": 4, "name": "t2_VM2", "vcpu": 2, "vmif": "t2VM2if1"}], "vxlan": [{"dev": "t2s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.11.2", "remote_ip": "10.2.11.2", "remote_route": "10.2.11.0/24", "subnet_route": "10.1.11.0/24", "tenant_route_ip": "192.168.2.2", "v_name": "vxlan_t2s1"}]}, {"brif": "t2s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t2s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "rc": 0, "start": "2019-11-18 07:41:07.882197", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.12.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.1.12.1', u'bridge_name': u't2br2', u'ns_name': u't2ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.12.2/24', u'tenant_ns_ip': u'10.1.12.1/24', u'tenant_ns_if': u't2ns2if', u'tenant_sub_if': u't2s2if', u'tenant_ns_name': u't2'}], u'subnet_ip': u'2.2.2.0/24', u'vms': [{u'mem': 3, u'name': u't2_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't2br2if1', u'vmif': u't2VM3if1'}], u'vxlan': [{u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}, {u'dnsif': u't2s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't2s2_dnsbrif'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t2ns2\" brctl show \"t2br2\" | grep -w 't2s2_dnsbrif' ; if [ $? -ne 0 ] ; then ip netns exec \"t2ns2\" brctl addif \"t2br2\" \"t2s2_dnsbrif\" ; fi\n", "delta": "0:00:00.082318", "end": "2019-11-18 07:41:08.269419", "item": [{"bridge_name": "t2br2", "default_route_ip": "10.1.12.1", "ns_name": "t2ns2", "route": [{"if": "p1", "ip": "10.1.12.1/24", "ns_if": "t2if", "ns_name": "t2"}], "subnet_ip": "2.2.2.0/24", "tenant_ns": [{"tenant_ns_if": "t2ns2if", "tenant_ns_ip": "10.1.12.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s2if", "tenant_sub_ip": "10.1.12.2/24"}], "vms": [{"brif": "t2br2if1", "disk": "10G", "mem": 3, "name": "t2_VM3", "vcpu": 2, "vmif": "t2VM3if1"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, {"brif": "t2s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t2s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "rc": 0, "start": "2019-11-18 07:41:08.187101", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Create VETH Pairs] ************************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.11.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.1.11.1', u'bridge_name': u't2br1', u'dns': [{u'dnsif': u't2s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't2s1_dnsbrif'}], u'ns_name': u't2ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.11.2/24', u'tenant_ns_ip': u'10.1.11.1/24', u'tenant_ns_if': u't2ns1if', u'tenant_sub_if': u't2s1if', u'tenant_ns_name': u't2'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.1.11.2', u'dsport': 4789, u'dev': u't2s1if', u'tenant_route_ip': u'192.168.2.2', u'remote_route': u'10.2.11.0/24', u'subnet_route': u'10.1.11.0/24', u'v_name': u'vxlan_t2s1', u'id': 42, u'remote_ip': u'10.2.11.2'}]}, {u'mem': 2, u'name': u't2_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't2br1if1', u'vmif': u't2VM1if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip link show \"t2br1if1\" ; if [ $? -ne 0 ] ; then ip link add \"t2VM1if1\" type veth peer name \"t2br1if1\" ; fi\nip link set dev \"t2br1if1\" up\nip link set dev \"t2VM1if1\" up\n", "delta": "0:00:00.018095", "end": "2019-11-18 07:41:08.574726", "item": [{"bridge_name": "t2br1", "default_route_ip": "10.1.11.1", "dns": [{"brif": "t2s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t2s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns1", "route": [{"if": "p1", "ip": "10.1.11.1/24", "ns_if": "t2if", "ns_name": "t2"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t2ns1if", "tenant_ns_ip": "10.1.11.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s1if", "tenant_sub_ip": "10.1.11.2/24"}], "vxlan": [{"dev": "t2s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.11.2", "remote_ip": "10.2.11.2", "remote_route": "10.2.11.0/24", "subnet_route": "10.1.11.0/24", "tenant_route_ip": "192.168.2.2", "v_name": "vxlan_t2s1"}]}, {"brif": "t2br1if1", "disk": "10G", "mem": 2, "name": "t2_VM1", "vcpu": 4, "vmif": "t2VM1if1"}], "rc": 0, "start": "2019-11-18 07:41:08.556631", "stderr": "Device \"t2br1if1\" does not exist.", "stderr_lines": ["Device \"t2br1if1\" does not exist."], "stdout": "", "stdout_lines": []}
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.11.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.1.11.1', u'bridge_name': u't2br1', u'dns': [{u'dnsif': u't2s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't2s1_dnsbrif'}], u'ns_name': u't2ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.11.2/24', u'tenant_ns_ip': u'10.1.11.1/24', u'tenant_ns_if': u't2ns1if', u'tenant_sub_if': u't2s1if', u'tenant_ns_name': u't2'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.1.11.2', u'dsport': 4789, u'dev': u't2s1if', u'tenant_route_ip': u'192.168.2.2', u'remote_route': u'10.2.11.0/24', u'subnet_route': u'10.1.11.0/24', u'v_name': u'vxlan_t2s1', u'id': 42, u'remote_ip': u'10.2.11.2'}]}, {u'mem': 4, u'name': u't2_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't2br1if2', u'vmif': u't2VM2if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip link show \"t2br1if2\" ; if [ $? -ne 0 ] ; then ip link add \"t2VM2if1\" type veth peer name \"t2br1if2\" ; fi\nip link set dev \"t2br1if2\" up\nip link set dev \"t2VM2if1\" up\n", "delta": "0:00:00.016783", "end": "2019-11-18 07:41:08.814056", "item": [{"bridge_name": "t2br1", "default_route_ip": "10.1.11.1", "dns": [{"brif": "t2s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t2s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns1", "route": [{"if": "p1", "ip": "10.1.11.1/24", "ns_if": "t2if", "ns_name": "t2"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t2ns1if", "tenant_ns_ip": "10.1.11.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s1if", "tenant_sub_ip": "10.1.11.2/24"}], "vxlan": [{"dev": "t2s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.11.2", "remote_ip": "10.2.11.2", "remote_route": "10.2.11.0/24", "subnet_route": "10.1.11.0/24", "tenant_route_ip": "192.168.2.2", "v_name": "vxlan_t2s1"}]}, {"brif": "t2br1if2", "disk": "10G", "mem": 4, "name": "t2_VM2", "vcpu": 2, "vmif": "t2VM2if1"}], "rc": 0, "start": "2019-11-18 07:41:08.797273", "stderr": "Device \"t2br1if2\" does not exist.", "stderr_lines": ["Device \"t2br1if2\" does not exist."], "stdout": "", "stdout_lines": []}
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.12.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.1.12.1', u'bridge_name': u't2br2', u'dns': [{u'dnsif': u't2s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't2s2_dnsbrif'}], u'ns_name': u't2ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.12.2/24', u'tenant_ns_ip': u'10.1.12.1/24', u'tenant_ns_if': u't2ns2if', u'tenant_sub_if': u't2s2if', u'tenant_ns_name': u't2'}], u'subnet_ip': u'2.2.2.0/24', u'vxlan': [{u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}, {u'mem': 3, u'name': u't2_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't2br2if1', u'vmif': u't2VM3if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip link show \"t2br2if1\" ; if [ $? -ne 0 ] ; then ip link add \"t2VM3if1\" type veth peer name \"t2br2if1\" ; fi\nip link set dev \"t2br2if1\" up\nip link set dev \"t2VM3if1\" up\n", "delta": "0:00:00.019549", "end": "2019-11-18 07:41:09.065004", "item": [{"bridge_name": "t2br2", "default_route_ip": "10.1.12.1", "dns": [{"brif": "t2s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t2s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns2", "route": [{"if": "p1", "ip": "10.1.12.1/24", "ns_if": "t2if", "ns_name": "t2"}], "subnet_ip": "2.2.2.0/24", "tenant_ns": [{"tenant_ns_if": "t2ns2if", "tenant_ns_ip": "10.1.12.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s2if", "tenant_sub_ip": "10.1.12.2/24"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, {"brif": "t2br2if1", "disk": "10G", "mem": 3, "name": "t2_VM3", "vcpu": 2, "vmif": "t2VM3if1"}], "rc": 0, "start": "2019-11-18 07:41:09.045455", "stderr": "Device \"t2br2if1\" does not exist.", "stderr_lines": ["Device \"t2br2if1\" does not exist."], "stdout": "", "stdout_lines": []}

TASK [Attach VETH Pairs] ************************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.11.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.1.11.1', u'bridge_name': u't2br1', u'dns': [{u'dnsif': u't2s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't2s1_dnsbrif'}], u'ns_name': u't2ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.11.2/24', u'tenant_ns_ip': u'10.1.11.1/24', u'tenant_ns_if': u't2ns1if', u'tenant_sub_if': u't2s1if', u'tenant_ns_name': u't2'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.1.11.2', u'dsport': 4789, u'dev': u't2s1if', u'tenant_route_ip': u'192.168.2.2', u'remote_route': u'10.2.11.0/24', u'subnet_route': u'10.1.11.0/24', u'v_name': u'vxlan_t2s1', u'id': 42, u'remote_ip': u'10.2.11.2'}]}, {u'mem': 2, u'name': u't2_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't2br1if1', u'vmif': u't2VM1if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip link show \"t2br1if1\" ; if [ $? -eq 0 ] ; then ip link set \"t2br1if1\" netns \"t2ns1\" ; fi\nip netns exec \"t2ns1\" brctl show \"t2br1\" | grep -w 't2br1if1' ; if [ $? -ne 0 ] ; then ip netns exec \"t2ns1\" brctl addif \"t2br1\" \"t2br1if1\" ; fi\n", "delta": "0:00:00.107076", "end": "2019-11-18 07:41:09.453369", "item": [{"bridge_name": "t2br1", "default_route_ip": "10.1.11.1", "dns": [{"brif": "t2s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t2s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns1", "route": [{"if": "p1", "ip": "10.1.11.1/24", "ns_if": "t2if", "ns_name": "t2"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t2ns1if", "tenant_ns_ip": "10.1.11.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s1if", "tenant_sub_ip": "10.1.11.2/24"}], "vxlan": [{"dev": "t2s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.11.2", "remote_ip": "10.2.11.2", "remote_route": "10.2.11.0/24", "subnet_route": "10.1.11.0/24", "tenant_route_ip": "192.168.2.2", "v_name": "vxlan_t2s1"}]}, {"brif": "t2br1if1", "disk": "10G", "mem": 2, "name": "t2_VM1", "vcpu": 4, "vmif": "t2VM1if1"}], "rc": 0, "start": "2019-11-18 07:41:09.346293", "stderr": "", "stderr_lines": [], "stdout": "35: t2br1if1@t2VM1if1: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP mode DEFAULT group default qlen 1000\n    link/ether e2:bb:4b:a2:20:10 brd ff:ff:ff:ff:ff:ff", "stdout_lines": ["35: t2br1if1@t2VM1if1: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP mode DEFAULT group default qlen 1000", "    link/ether e2:bb:4b:a2:20:10 brd ff:ff:ff:ff:ff:ff"]}
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.11.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.1.11.1', u'bridge_name': u't2br1', u'dns': [{u'dnsif': u't2s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't2s1_dnsbrif'}], u'ns_name': u't2ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.11.2/24', u'tenant_ns_ip': u'10.1.11.1/24', u'tenant_ns_if': u't2ns1if', u'tenant_sub_if': u't2s1if', u'tenant_ns_name': u't2'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.1.11.2', u'dsport': 4789, u'dev': u't2s1if', u'tenant_route_ip': u'192.168.2.2', u'remote_route': u'10.2.11.0/24', u'subnet_route': u'10.1.11.0/24', u'v_name': u'vxlan_t2s1', u'id': 42, u'remote_ip': u'10.2.11.2'}]}, {u'mem': 4, u'name': u't2_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't2br1if2', u'vmif': u't2VM2if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip link show \"t2br1if2\" ; if [ $? -eq 0 ] ; then ip link set \"t2br1if2\" netns \"t2ns1\" ; fi\nip netns exec \"t2ns1\" brctl show \"t2br1\" | grep -w 't2br1if2' ; if [ $? -ne 0 ] ; then ip netns exec \"t2ns1\" brctl addif \"t2br1\" \"t2br1if2\" ; fi\n", "delta": "0:00:00.112833", "end": "2019-11-18 07:41:09.781330", "item": [{"bridge_name": "t2br1", "default_route_ip": "10.1.11.1", "dns": [{"brif": "t2s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t2s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns1", "route": [{"if": "p1", "ip": "10.1.11.1/24", "ns_if": "t2if", "ns_name": "t2"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t2ns1if", "tenant_ns_ip": "10.1.11.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s1if", "tenant_sub_ip": "10.1.11.2/24"}], "vxlan": [{"dev": "t2s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.11.2", "remote_ip": "10.2.11.2", "remote_route": "10.2.11.0/24", "subnet_route": "10.1.11.0/24", "tenant_route_ip": "192.168.2.2", "v_name": "vxlan_t2s1"}]}, {"brif": "t2br1if2", "disk": "10G", "mem": 4, "name": "t2_VM2", "vcpu": 2, "vmif": "t2VM2if1"}], "rc": 0, "start": "2019-11-18 07:41:09.668497", "stderr": "", "stderr_lines": [], "stdout": "37: t2br1if2@t2VM2if1: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP mode DEFAULT group default qlen 1000\n    link/ether 06:03:4e:37:dd:f7 brd ff:ff:ff:ff:ff:ff", "stdout_lines": ["37: t2br1if2@t2VM2if1: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP mode DEFAULT group default qlen 1000", "    link/ether 06:03:4e:37:dd:f7 brd ff:ff:ff:ff:ff:ff"]}
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.12.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.1.12.1', u'bridge_name': u't2br2', u'dns': [{u'dnsif': u't2s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't2s2_dnsbrif'}], u'ns_name': u't2ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.12.2/24', u'tenant_ns_ip': u'10.1.12.1/24', u'tenant_ns_if': u't2ns2if', u'tenant_sub_if': u't2s2if', u'tenant_ns_name': u't2'}], u'subnet_ip': u'2.2.2.0/24', u'vxlan': [{u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}, {u'mem': 3, u'name': u't2_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't2br2if1', u'vmif': u't2VM3if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip link show \"t2br2if1\" ; if [ $? -eq 0 ] ; then ip link set \"t2br2if1\" netns \"t2ns2\" ; fi\nip netns exec \"t2ns2\" brctl show \"t2br2\" | grep -w 't2br2if1' ; if [ $? -ne 0 ] ; then ip netns exec \"t2ns2\" brctl addif \"t2br2\" \"t2br2if1\" ; fi\n", "delta": "0:00:00.113558", "end": "2019-11-18 07:41:10.113397", "item": [{"bridge_name": "t2br2", "default_route_ip": "10.1.12.1", "dns": [{"brif": "t2s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t2s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns2", "route": [{"if": "p1", "ip": "10.1.12.1/24", "ns_if": "t2if", "ns_name": "t2"}], "subnet_ip": "2.2.2.0/24", "tenant_ns": [{"tenant_ns_if": "t2ns2if", "tenant_ns_ip": "10.1.12.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s2if", "tenant_sub_ip": "10.1.12.2/24"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, {"brif": "t2br2if1", "disk": "10G", "mem": 3, "name": "t2_VM3", "vcpu": 2, "vmif": "t2VM3if1"}], "rc": 0, "start": "2019-11-18 07:41:09.999839", "stderr": "", "stderr_lines": [], "stdout": "39: t2br2if1@t2VM3if1: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP mode DEFAULT group default qlen 1000\n    link/ether d6:b8:92:1b:04:4a brd ff:ff:ff:ff:ff:ff", "stdout_lines": ["39: t2br2if1@t2VM3if1: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP mode DEFAULT group default qlen 1000", "    link/ether d6:b8:92:1b:04:4a brd ff:ff:ff:ff:ff:ff"]}

TASK [All interfaces and bridges UP] ************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.11.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.1.11.1', u'bridge_name': u't2br1', u'dns': [{u'dnsif': u't2s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't2s1_dnsbrif'}], u'ns_name': u't2ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.11.2/24', u'tenant_ns_ip': u'10.1.11.1/24', u'tenant_ns_if': u't2ns1if', u'tenant_sub_if': u't2s1if', u'tenant_ns_name': u't2'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.1.11.2', u'dsport': 4789, u'dev': u't2s1if', u'tenant_route_ip': u'192.168.2.2', u'remote_route': u'10.2.11.0/24', u'subnet_route': u'10.1.11.0/24', u'v_name': u'vxlan_t2s1', u'id': 42, u'remote_ip': u'10.2.11.2'}]}, {u'mem': 2, u'name': u't2_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't2br1if1', u'vmif': u't2VM1if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t2ns1\" ip link set \"t2br1if1\" up\nip netns exec \"t2ns1\" ip link set dev \"t2br1\" up\n", "delta": "0:00:00.066896", "end": "2019-11-18 07:41:10.425191", "item": [{"bridge_name": "t2br1", "default_route_ip": "10.1.11.1", "dns": [{"brif": "t2s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t2s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns1", "route": [{"if": "p1", "ip": "10.1.11.1/24", "ns_if": "t2if", "ns_name": "t2"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t2ns1if", "tenant_ns_ip": "10.1.11.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s1if", "tenant_sub_ip": "10.1.11.2/24"}], "vxlan": [{"dev": "t2s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.11.2", "remote_ip": "10.2.11.2", "remote_route": "10.2.11.0/24", "subnet_route": "10.1.11.0/24", "tenant_route_ip": "192.168.2.2", "v_name": "vxlan_t2s1"}]}, {"brif": "t2br1if1", "disk": "10G", "mem": 2, "name": "t2_VM1", "vcpu": 4, "vmif": "t2VM1if1"}], "rc": 0, "start": "2019-11-18 07:41:10.358295", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.11.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.1.11.1', u'bridge_name': u't2br1', u'dns': [{u'dnsif': u't2s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't2s1_dnsbrif'}], u'ns_name': u't2ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.11.2/24', u'tenant_ns_ip': u'10.1.11.1/24', u'tenant_ns_if': u't2ns1if', u'tenant_sub_if': u't2s1if', u'tenant_ns_name': u't2'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.1.11.2', u'dsport': 4789, u'dev': u't2s1if', u'tenant_route_ip': u'192.168.2.2', u'remote_route': u'10.2.11.0/24', u'subnet_route': u'10.1.11.0/24', u'v_name': u'vxlan_t2s1', u'id': 42, u'remote_ip': u'10.2.11.2'}]}, {u'mem': 4, u'name': u't2_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't2br1if2', u'vmif': u't2VM2if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t2ns1\" ip link set \"t2br1if2\" up\nip netns exec \"t2ns1\" ip link set dev \"t2br1\" up\n", "delta": "0:00:00.065943", "end": "2019-11-18 07:41:10.677225", "item": [{"bridge_name": "t2br1", "default_route_ip": "10.1.11.1", "dns": [{"brif": "t2s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t2s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns1", "route": [{"if": "p1", "ip": "10.1.11.1/24", "ns_if": "t2if", "ns_name": "t2"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t2ns1if", "tenant_ns_ip": "10.1.11.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s1if", "tenant_sub_ip": "10.1.11.2/24"}], "vxlan": [{"dev": "t2s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.11.2", "remote_ip": "10.2.11.2", "remote_route": "10.2.11.0/24", "subnet_route": "10.1.11.0/24", "tenant_route_ip": "192.168.2.2", "v_name": "vxlan_t2s1"}]}, {"brif": "t2br1if2", "disk": "10G", "mem": 4, "name": "t2_VM2", "vcpu": 2, "vmif": "t2VM2if1"}], "rc": 0, "start": "2019-11-18 07:41:10.611282", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.12.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.1.12.1', u'bridge_name': u't2br2', u'dns': [{u'dnsif': u't2s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't2s2_dnsbrif'}], u'ns_name': u't2ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.12.2/24', u'tenant_ns_ip': u'10.1.12.1/24', u'tenant_ns_if': u't2ns2if', u'tenant_sub_if': u't2s2if', u'tenant_ns_name': u't2'}], u'subnet_ip': u'2.2.2.0/24', u'vxlan': [{u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}, {u'mem': 3, u'name': u't2_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't2br2if1', u'vmif': u't2VM3if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t2ns2\" ip link set \"t2br2if1\" up\nip netns exec \"t2ns2\" ip link set dev \"t2br2\" up\n", "delta": "0:00:00.102997", "end": "2019-11-18 07:41:10.977237", "item": [{"bridge_name": "t2br2", "default_route_ip": "10.1.12.1", "dns": [{"brif": "t2s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t2s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns2", "route": [{"if": "p1", "ip": "10.1.12.1/24", "ns_if": "t2if", "ns_name": "t2"}], "subnet_ip": "2.2.2.0/24", "tenant_ns": [{"tenant_ns_if": "t2ns2if", "tenant_ns_ip": "10.1.12.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s2if", "tenant_sub_ip": "10.1.12.2/24"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, {"brif": "t2br2if1", "disk": "10G", "mem": 3, "name": "t2_VM3", "vcpu": 2, "vmif": "t2VM3if1"}], "rc": 0, "start": "2019-11-18 07:41:10.874240", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Add IP to DNS Interface] ******************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.11.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.1.11.1', u'bridge_name': u't2br1', u'ns_name': u't2ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.11.2/24', u'tenant_ns_ip': u'10.1.11.1/24', u'tenant_ns_if': u't2ns1if', u'tenant_sub_if': u't2s1if', u'tenant_ns_name': u't2'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't2_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't2br1if1', u'vmif': u't2VM1if1'}, {u'mem': 4, u'name': u't2_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't2br1if2', u'vmif': u't2VM2if1'}], u'vxlan': [{u'local_ip': u'10.1.11.2', u'dsport': 4789, u'dev': u't2s1if', u'tenant_route_ip': u'192.168.2.2', u'remote_route': u'10.2.11.0/24', u'subnet_route': u'10.1.11.0/24', u'v_name': u'vxlan_t2s1', u'id': 42, u'remote_ip': u'10.2.11.2'}]}, {u'dnsif': u't2s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't2s1_dnsbrif'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t2ns1\" ip addr show \"t2s1_dnsif\" | awk 'FNR==3{ print $2 }' | grep -w '^1.1.1.1/24' ; if [ $? -ne 0 ] ; then ip netns exec \"t2ns1\" ip addr add \"1.1.1.1/24\" dev \"t2s1_dnsif\" ; fi\n", "delta": "0:00:00.078182", "end": "2019-11-18 07:41:11.305241", "item": [{"bridge_name": "t2br1", "default_route_ip": "10.1.11.1", "ns_name": "t2ns1", "route": [{"if": "p1", "ip": "10.1.11.1/24", "ns_if": "t2if", "ns_name": "t2"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t2ns1if", "tenant_ns_ip": "10.1.11.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s1if", "tenant_sub_ip": "10.1.11.2/24"}], "vms": [{"brif": "t2br1if1", "disk": "10G", "mem": 2, "name": "t2_VM1", "vcpu": 4, "vmif": "t2VM1if1"}, {"brif": "t2br1if2", "disk": "10G", "mem": 4, "name": "t2_VM2", "vcpu": 2, "vmif": "t2VM2if1"}], "vxlan": [{"dev": "t2s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.11.2", "remote_ip": "10.2.11.2", "remote_route": "10.2.11.0/24", "subnet_route": "10.1.11.0/24", "tenant_route_ip": "192.168.2.2", "v_name": "vxlan_t2s1"}]}, {"brif": "t2s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t2s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "rc": 0, "start": "2019-11-18 07:41:11.227059", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.12.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.1.12.1', u'bridge_name': u't2br2', u'ns_name': u't2ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.12.2/24', u'tenant_ns_ip': u'10.1.12.1/24', u'tenant_ns_if': u't2ns2if', u'tenant_sub_if': u't2s2if', u'tenant_ns_name': u't2'}], u'subnet_ip': u'2.2.2.0/24', u'vms': [{u'mem': 3, u'name': u't2_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't2br2if1', u'vmif': u't2VM3if1'}], u'vxlan': [{u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}, {u'dnsif': u't2s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't2s2_dnsbrif'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t2ns2\" ip addr show \"t2s2_dnsif\" | awk 'FNR==3{ print $2 }' | grep -w '^2.2.2.1/24' ; if [ $? -ne 0 ] ; then ip netns exec \"t2ns2\" ip addr add \"2.2.2.1/24\" dev \"t2s2_dnsif\" ; fi\n", "delta": "0:00:00.079617", "end": "2019-11-18 07:41:11.577241", "item": [{"bridge_name": "t2br2", "default_route_ip": "10.1.12.1", "ns_name": "t2ns2", "route": [{"if": "p1", "ip": "10.1.12.1/24", "ns_if": "t2if", "ns_name": "t2"}], "subnet_ip": "2.2.2.0/24", "tenant_ns": [{"tenant_ns_if": "t2ns2if", "tenant_ns_ip": "10.1.12.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s2if", "tenant_sub_ip": "10.1.12.2/24"}], "vms": [{"brif": "t2br2if1", "disk": "10G", "mem": 3, "name": "t2_VM3", "vcpu": 2, "vmif": "t2VM3if1"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, {"brif": "t2s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t2s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "rc": 0, "start": "2019-11-18 07:41:11.497624", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Install DHCP Server] **********************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.11.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.1.11.1', u'bridge_name': u't2br1', u'ns_name': u't2ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.11.2/24', u'tenant_ns_ip': u'10.1.11.1/24', u'tenant_ns_if': u't2ns1if', u'tenant_sub_if': u't2s1if', u'tenant_ns_name': u't2'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't2_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't2br1if1', u'vmif': u't2VM1if1'}, {u'mem': 4, u'name': u't2_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't2br1if2', u'vmif': u't2VM2if1'}], u'vxlan': [{u'local_ip': u'10.1.11.2', u'dsport': 4789, u'dev': u't2s1if', u'tenant_route_ip': u'192.168.2.2', u'remote_route': u'10.2.11.0/24', u'subnet_route': u'10.1.11.0/24', u'v_name': u'vxlan_t2s1', u'id': 42, u'remote_ip': u'10.2.11.2'}]}, {u'dnsif': u't2s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't2s1_dnsbrif'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t2ns1\" ps aux | grep -w '[d]nsmasq --interface t2s1_dnsif -z --dhcp-range=1.1.1.5,1.1.1.126' ; if [ $? -ne 0 ] ; then ip netns exec \"t2ns1\" dnsmasq --interface \"t2s1_dnsif\" -z --dhcp-range=1.1.1.5,'1.1.1.126' ; fi\n", "delta": "0:00:00.072421", "end": "2019-11-18 07:41:11.913908", "item": [{"bridge_name": "t2br1", "default_route_ip": "10.1.11.1", "ns_name": "t2ns1", "route": [{"if": "p1", "ip": "10.1.11.1/24", "ns_if": "t2if", "ns_name": "t2"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t2ns1if", "tenant_ns_ip": "10.1.11.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s1if", "tenant_sub_ip": "10.1.11.2/24"}], "vms": [{"brif": "t2br1if1", "disk": "10G", "mem": 2, "name": "t2_VM1", "vcpu": 4, "vmif": "t2VM1if1"}, {"brif": "t2br1if2", "disk": "10G", "mem": 4, "name": "t2_VM2", "vcpu": 2, "vmif": "t2VM2if1"}], "vxlan": [{"dev": "t2s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.11.2", "remote_ip": "10.2.11.2", "remote_route": "10.2.11.0/24", "subnet_route": "10.1.11.0/24", "tenant_route_ip": "192.168.2.2", "v_name": "vxlan_t2s1"}]}, {"brif": "t2s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t2s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "rc": 0, "start": "2019-11-18 07:41:11.841487", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.12.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.1.12.1', u'bridge_name': u't2br2', u'ns_name': u't2ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.12.2/24', u'tenant_ns_ip': u'10.1.12.1/24', u'tenant_ns_if': u't2ns2if', u'tenant_sub_if': u't2s2if', u'tenant_ns_name': u't2'}], u'subnet_ip': u'2.2.2.0/24', u'vms': [{u'mem': 3, u'name': u't2_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't2br2if1', u'vmif': u't2VM3if1'}], u'vxlan': [{u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}, {u'dnsif': u't2s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't2s2_dnsbrif'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t2ns2\" ps aux | grep -w '[d]nsmasq --interface t2s2_dnsif -z --dhcp-range=2.2.2.5,2.2.2.254' ; if [ $? -ne 0 ] ; then ip netns exec \"t2ns2\" dnsmasq --interface \"t2s2_dnsif\" -z --dhcp-range=2.2.2.5,'2.2.2.254' ; fi\n", "delta": "0:00:00.075619", "end": "2019-11-18 07:41:12.181775", "item": [{"bridge_name": "t2br2", "default_route_ip": "10.1.12.1", "ns_name": "t2ns2", "route": [{"if": "p1", "ip": "10.1.12.1/24", "ns_if": "t2if", "ns_name": "t2"}], "subnet_ip": "2.2.2.0/24", "tenant_ns": [{"tenant_ns_if": "t2ns2if", "tenant_ns_ip": "10.1.12.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s2if", "tenant_sub_ip": "10.1.12.2/24"}], "vms": [{"brif": "t2br2if1", "disk": "10G", "mem": 3, "name": "t2_VM3", "vcpu": 2, "vmif": "t2VM3if1"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, {"brif": "t2s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t2s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "rc": 0, "start": "2019-11-18 07:41:12.106156", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Create VXLAN devices] *********************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.11.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.1.11.1', u'bridge_name': u't2br1', u'dns': [{u'dnsif': u't2s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't2s1_dnsbrif'}], u'ns_name': u't2ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.11.2/24', u'tenant_ns_ip': u'10.1.11.1/24', u'tenant_ns_if': u't2ns1if', u'tenant_sub_if': u't2s1if', u'tenant_ns_name': u't2'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't2_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't2br1if1', u'vmif': u't2VM1if1'}, {u'mem': 4, u'name': u't2_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't2br1if2', u'vmif': u't2VM2if1'}]}, {u'local_ip': u'10.1.11.2', u'dsport': 4789, u'dev': u't2s1if', u'tenant_route_ip': u'192.168.2.2', u'remote_route': u'10.2.11.0/24', u'subnet_route': u'10.1.11.0/24', u'v_name': u'vxlan_t2s1', u'id': 42, u'remote_ip': u'10.2.11.2'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t2ns1\" ip link show \"vxlan_t2s1\" ; if [ $? -ne 0 ] ; then ip netns exec \"t2ns1\" ip link add \"vxlan_t2s1\" type vxlan id \"42\" local \"10.1.11.2\" remote \"10.2.11.2\" dstport \"4789\" dev \"t2s1if\"; ip netns exec \"t2ns1\" ip link set dev \"vxlan_t2s1\" up ; fi\n", "delta": "0:00:00.096971", "end": "2019-11-18 07:41:12.541350", "item": [{"bridge_name": "t2br1", "default_route_ip": "10.1.11.1", "dns": [{"brif": "t2s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t2s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns1", "route": [{"if": "p1", "ip": "10.1.11.1/24", "ns_if": "t2if", "ns_name": "t2"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t2ns1if", "tenant_ns_ip": "10.1.11.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s1if", "tenant_sub_ip": "10.1.11.2/24"}], "vms": [{"brif": "t2br1if1", "disk": "10G", "mem": 2, "name": "t2_VM1", "vcpu": 4, "vmif": "t2VM1if1"}, {"brif": "t2br1if2", "disk": "10G", "mem": 4, "name": "t2_VM2", "vcpu": 2, "vmif": "t2VM2if1"}]}, {"dev": "t2s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.11.2", "remote_ip": "10.2.11.2", "remote_route": "10.2.11.0/24", "subnet_route": "10.1.11.0/24", "tenant_route_ip": "192.168.2.2", "v_name": "vxlan_t2s1"}], "rc": 0, "start": "2019-11-18 07:41:12.444379", "stderr": "Device \"vxlan_t2s1\" does not exist.", "stderr_lines": ["Device \"vxlan_t2s1\" does not exist."], "stdout": "", "stdout_lines": []}
skipping: [localhost] => (item=[{u'route': [{u'ip': u'10.1.12.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.1.12.1', u'bridge_name': u't2br2', u'dns': [{u'dnsif': u't2s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't2s2_dnsbrif'}], u'ns_name': u't2ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.12.2/24', u'tenant_ns_ip': u'10.1.12.1/24', u'tenant_ns_if': u't2ns2if', u'tenant_sub_if': u't2s2if', u'tenant_ns_name': u't2'}], u'subnet_ip': u'2.2.2.0/24', u'vms': [{u'mem': 3, u'name': u't2_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't2br2if1', u'vmif': u't2VM3if1'}]}, {u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}])  => {"ansible_loop_var": "item", "changed": false, "item": [{"bridge_name": "t2br2", "default_route_ip": "10.1.12.1", "dns": [{"brif": "t2s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t2s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns2", "route": [{"if": "p1", "ip": "10.1.12.1/24", "ns_if": "t2if", "ns_name": "t2"}], "subnet_ip": "2.2.2.0/24", "tenant_ns": [{"tenant_ns_if": "t2ns2if", "tenant_ns_ip": "10.1.12.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s2if", "tenant_sub_ip": "10.1.12.2/24"}], "vms": [{"brif": "t2br2if1", "disk": "10G", "mem": 3, "name": "t2_VM3", "vcpu": 2, "vmif": "t2VM3if1"}]}, {"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}], "skip_reason": "Conditional result was False"}

TASK [Attach VXLANs to bridge] ******************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.11.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.1.11.1', u'bridge_name': u't2br1', u'dns': [{u'dnsif': u't2s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't2s1_dnsbrif'}], u'ns_name': u't2ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.11.2/24', u'tenant_ns_ip': u'10.1.11.1/24', u'tenant_ns_if': u't2ns1if', u'tenant_sub_if': u't2s1if', u'tenant_ns_name': u't2'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't2_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't2br1if1', u'vmif': u't2VM1if1'}, {u'mem': 4, u'name': u't2_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't2br1if2', u'vmif': u't2VM2if1'}]}, {u'local_ip': u'10.1.11.2', u'dsport': 4789, u'dev': u't2s1if', u'tenant_route_ip': u'192.168.2.2', u'remote_route': u'10.2.11.0/24', u'subnet_route': u'10.1.11.0/24', u'v_name': u'vxlan_t2s1', u'id': 42, u'remote_ip': u'10.2.11.2'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t2ns1\" brctl show \"t2br1\" | grep -w 'vxlan_t2s1' ; if [ $? -ne 0 ] ; then ip netns exec \"t2ns1\" brctl addif \"t2br1\" \"vxlan_t2s1\" ; fi\n", "delta": "0:00:00.091316", "end": "2019-11-18 07:41:12.905299", "item": [{"bridge_name": "t2br1", "default_route_ip": "10.1.11.1", "dns": [{"brif": "t2s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t2s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns1", "route": [{"if": "p1", "ip": "10.1.11.1/24", "ns_if": "t2if", "ns_name": "t2"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t2ns1if", "tenant_ns_ip": "10.1.11.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s1if", "tenant_sub_ip": "10.1.11.2/24"}], "vms": [{"brif": "t2br1if1", "disk": "10G", "mem": 2, "name": "t2_VM1", "vcpu": 4, "vmif": "t2VM1if1"}, {"brif": "t2br1if2", "disk": "10G", "mem": 4, "name": "t2_VM2", "vcpu": 2, "vmif": "t2VM2if1"}]}, {"dev": "t2s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.11.2", "remote_ip": "10.2.11.2", "remote_route": "10.2.11.0/24", "subnet_route": "10.1.11.0/24", "tenant_route_ip": "192.168.2.2", "v_name": "vxlan_t2s1"}], "rc": 0, "start": "2019-11-18 07:41:12.813983", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}
skipping: [localhost] => (item=[{u'route': [{u'ip': u'10.1.12.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.1.12.1', u'bridge_name': u't2br2', u'dns': [{u'dnsif': u't2s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't2s2_dnsbrif'}], u'ns_name': u't2ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.12.2/24', u'tenant_ns_ip': u'10.1.12.1/24', u'tenant_ns_if': u't2ns2if', u'tenant_sub_if': u't2s2if', u'tenant_ns_name': u't2'}], u'subnet_ip': u'2.2.2.0/24', u'vms': [{u'mem': 3, u'name': u't2_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't2br2if1', u'vmif': u't2VM3if1'}]}, {u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}])  => {"ansible_loop_var": "item", "changed": false, "item": [{"bridge_name": "t2br2", "default_route_ip": "10.1.12.1", "dns": [{"brif": "t2s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t2s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns2", "route": [{"if": "p1", "ip": "10.1.12.1/24", "ns_if": "t2if", "ns_name": "t2"}], "subnet_ip": "2.2.2.0/24", "tenant_ns": [{"tenant_ns_if": "t2ns2if", "tenant_ns_ip": "10.1.12.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s2if", "tenant_sub_ip": "10.1.12.2/24"}], "vms": [{"brif": "t2br2if1", "disk": "10G", "mem": 3, "name": "t2_VM3", "vcpu": 2, "vmif": "t2VM3if1"}]}, {"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}], "skip_reason": "Conditional result was False"}

PLAY RECAP **************************************************************************************************************************************************
localhost                  : ok=21   changed=21   unreachable=0    failed=0    skipped=0    rescued=0    ignored=0   

Using /etc/ansible/ansible.cfg as config file

PLAY [worker] ***********************************************************************************************************************************************

TASK [Create Tenant Namespace] ******************************************************************************************************************************
changed: [99.99.99.2] => (item={u'default_route_ip': u'192.168.130.1', u'name': u't2', u'pns_ip': u'192.168.130.1/24', u'tenant_if': u't2if', u'tenant_ip': u'192.168.130.2/24', u'pns_if': u't2pns_if'}) => {"ansible_loop_var": "item", "changed": true, "cmd": ["ip", "netns", "add", "t2"], "delta": "0:00:00.052719", "end": "2019-11-18 07:41:14.893017", "item": {"default_route_ip": "192.168.130.1", "name": "t2", "pns_if": "t2pns_if", "pns_ip": "192.168.130.1/24", "tenant_if": "t2if", "tenant_ip": "192.168.130.2/24"}, "rc": 0, "start": "2019-11-18 07:41:14.840298", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Create Subnet Namespace] ******************************************************************************************************************************
changed: [99.99.99.2] => (item={u'route': [{u'ip': u'10.2.11.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.2.11.1', u'bridge_name': u't2br1', u'dns': [{u'dnsif': u't2s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't2s1_dnsbrif'}], u'ns_name': u't2ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.11.2/24', u'tenant_ns_ip': u'10.2.11.1/24', u'tenant_ns_if': u't2ns1if', u'tenant_ns_name': u't2', u'tenant_sub_if': u't2s1if'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't2_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't2br1if1', u'vmif': u't2VM4if1'}], u'vxlan': [{u'local_ip': u'10.2.11.2', u'tenant_route_ip': u'192.168.130.2', u'dsport': 4789, u'dev': u't2s1if', u'subnet_route': u'10.2.11.0/24', u'remote_route': u'10.1.11.0/24', u'v_name': u'vxlan_t2s1', u'id': 42, u'remote_ip': u'10.1.11.2'}]}) => {"ansible_loop_var": "item", "changed": true, "cmd": ["ip", "netns", "add", "t2ns1"], "delta": "0:00:00.053758", "end": "2019-11-18 07:41:15.316509", "item": {"bridge_name": "t2br1", "default_route_ip": "10.2.11.1", "dns": [{"brif": "t2s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t2s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns1", "route": [{"if": "p1", "ip": "10.2.11.1/24", "ns_if": "t2if", "ns_name": "t2"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t2ns1if", "tenant_ns_ip": "10.2.11.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s1if", "tenant_sub_ip": "10.2.11.2/24"}], "vms": [{"brif": "t2br1if1", "disk": "10G", "mem": 2, "name": "t2_VM4", "vcpu": 4, "vmif": "t2VM4if1"}], "vxlan": [{"dev": "t2s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.11.2", "remote_ip": "10.1.11.2", "remote_route": "10.1.11.0/24", "subnet_route": "10.2.11.0/24", "tenant_route_ip": "192.168.130.2", "v_name": "vxlan_t2s1"}]}, "rc": 0, "start": "2019-11-18 07:41:15.262751", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Create Tenant VETH pairs] *****************************************************************************************************************************
changed: [99.99.99.2] => (item={u'default_route_ip': u'192.168.130.1', u'name': u't2', u'pns_ip': u'192.168.130.1/24', u'tenant_if': u't2if', u'tenant_ip': u'192.168.130.2/24', u'pns_if': u't2pns_if'}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip link show \"t2if\" ; if [ $? -ne 0 ] ; then ip link add \"t2if\" type veth peer name \"t2pns_if\" ; fi\n", "delta": "0:00:00.009213", "end": "2019-11-18 07:41:15.698084", "item": {"default_route_ip": "192.168.130.1", "name": "t2", "pns_if": "t2pns_if", "pns_ip": "192.168.130.1/24", "tenant_if": "t2if", "tenant_ip": "192.168.130.2/24"}, "rc": 0, "start": "2019-11-18 07:41:15.688871", "stderr": "Device \"t2if\" does not exist.", "stderr_lines": ["Device \"t2if\" does not exist."], "stdout": "", "stdout_lines": []}

TASK [Attach Tenant VETH Pairs] *****************************************************************************************************************************
changed: [99.99.99.2] => (item={u'default_route_ip': u'192.168.130.1', u'name': u't2', u'pns_ip': u'192.168.130.1/24', u'tenant_if': u't2if', u'tenant_ip': u'192.168.130.2/24', u'pns_if': u't2pns_if'}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec pns ip link show \"t2pns_if\" ; if [ $? -ne 0 ] ; then ip link set \"t2pns_if\" netns pns ; fi\nip netns exec \"t2\" ip link show \"t2if\" ; if [ $? -ne 0 ] ; then ip link set \"t2if\" netns \"t2\" ; fi\nip netns exec pns ip link set dev \"t2pns_if\" up\nip netns exec \"t2\" ip link set dev \"t2if\" up\n", "delta": "0:00:00.192839", "end": "2019-11-18 07:41:16.254270", "item": {"default_route_ip": "192.168.130.1", "name": "t2", "pns_if": "t2pns_if", "pns_ip": "192.168.130.1/24", "tenant_if": "t2if", "tenant_ip": "192.168.130.2/24"}, "rc": 0, "start": "2019-11-18 07:41:16.061431", "stderr": "Device \"t2pns_if\" does not exist.\nDevice \"t2if\" does not exist.", "stderr_lines": ["Device \"t2pns_if\" does not exist.", "Device \"t2if\" does not exist."], "stdout": "", "stdout_lines": []}

TASK [Add IP addresses to Tenant VETH Pairs] ****************************************************************************************************************
changed: [99.99.99.2] => (item={u'default_route_ip': u'192.168.130.1', u'name': u't2', u'pns_ip': u'192.168.130.1/24', u'tenant_if': u't2if', u'tenant_ip': u'192.168.130.2/24', u'pns_if': u't2pns_if'}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec pns ip addr show \"t2pns_if\" | awk 'FNR==3{ print $2 }' | grep -w '^192.168.130.1/24' ; if [ $? -ne 0 ] ; then ip netns exec pns ip addr add \"192.168.130.1/24\" dev \"t2pns_if\" ; fi\nip netns exec \"t2\" ip addr show \"t2if\" | awk 'FNR==3{ print $2 }' | grep -w '^192.168.130.2/24' ; if [ $? -ne 0 ] ; then ip netns exec \"t2\" ip addr add \"192.168.130.2/24\" dev \"t2if\" ; fi\n", "delta": "0:00:00.139938", "end": "2019-11-18 07:41:16.742489", "item": {"default_route_ip": "192.168.130.1", "name": "t2", "pns_if": "t2pns_if", "pns_ip": "192.168.130.1/24", "tenant_if": "t2if", "tenant_ip": "192.168.130.2/24"}, "rc": 0, "start": "2019-11-18 07:41:16.602551", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Create Namespace VETH Pairs] **************************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.11.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.2.11.1', u'bridge_name': u't2br1', u'dns': [{u'dnsif': u't2s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't2s1_dnsbrif'}], u'ns_name': u't2ns1', u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't2_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't2br1if1', u'vmif': u't2VM4if1'}], u'vxlan': [{u'local_ip': u'10.2.11.2', u'dsport': 4789, u'dev': u't2s1if', u'tenant_route_ip': u'192.168.130.2', u'remote_route': u'10.1.11.0/24', u'subnet_route': u'10.2.11.0/24', u'v_name': u'vxlan_t2s1', u'id': 42, u'remote_ip': u'10.1.11.2'}]}, {u'tenant_sub_ip': u'10.2.11.2/24', u'tenant_ns_ip': u'10.2.11.1/24', u'tenant_ns_if': u't2ns1if', u'tenant_sub_if': u't2s1if', u'tenant_ns_name': u't2'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip link show \"t2ns1if\" ; if [ $? -ne 0 ] ; then ip link add \"t2ns1if\" type veth peer name \"t2s1if\" ; fi\n", "delta": "0:00:00.008444", "end": "2019-11-18 07:41:17.092650", "item": [{"bridge_name": "t2br1", "default_route_ip": "10.2.11.1", "dns": [{"brif": "t2s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t2s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns1", "route": [{"if": "p1", "ip": "10.2.11.1/24", "ns_if": "t2if", "ns_name": "t2"}], "subnet_ip": "1.1.1.0/24", "vms": [{"brif": "t2br1if1", "disk": "10G", "mem": 2, "name": "t2_VM4", "vcpu": 4, "vmif": "t2VM4if1"}], "vxlan": [{"dev": "t2s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.11.2", "remote_ip": "10.1.11.2", "remote_route": "10.1.11.0/24", "subnet_route": "10.2.11.0/24", "tenant_route_ip": "192.168.130.2", "v_name": "vxlan_t2s1"}]}, {"tenant_ns_if": "t2ns1if", "tenant_ns_ip": "10.2.11.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s1if", "tenant_sub_ip": "10.2.11.2/24"}], "rc": 0, "start": "2019-11-18 07:41:17.084206", "stderr": "Device \"t2ns1if\" does not exist.", "stderr_lines": ["Device \"t2ns1if\" does not exist."], "stdout": "", "stdout_lines": []}

TASK [Attach Namespace VETH Pairs] **************************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.11.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.2.11.1', u'bridge_name': u't2br1', u'dns': [{u'dnsif': u't2s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't2s1_dnsbrif'}], u'ns_name': u't2ns1', u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't2_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't2br1if1', u'vmif': u't2VM4if1'}], u'vxlan': [{u'local_ip': u'10.2.11.2', u'dsport': 4789, u'dev': u't2s1if', u'tenant_route_ip': u'192.168.130.2', u'remote_route': u'10.1.11.0/24', u'subnet_route': u'10.2.11.0/24', u'v_name': u'vxlan_t2s1', u'id': 42, u'remote_ip': u'10.1.11.2'}]}, {u'tenant_sub_ip': u'10.2.11.2/24', u'tenant_ns_ip': u'10.2.11.1/24', u'tenant_ns_if': u't2ns1if', u'tenant_sub_if': u't2s1if', u'tenant_ns_name': u't2'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t2\" ip link show \"t2ns1if\" ; if [ $? -ne 0 ] ; then ip link set \"t2ns1if\" netns \"t2\" ; fi\nip netns exec \"t2ns1\" ip link show \"t2s1if\" ; if [ $? -ne 0 ] ; then ip link set \"t2s1if\" netns \"t2ns1\" ; fi\n", "delta": "0:00:00.121767", "end": "2019-11-18 07:41:17.565039", "item": [{"bridge_name": "t2br1", "default_route_ip": "10.2.11.1", "dns": [{"brif": "t2s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t2s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns1", "route": [{"if": "p1", "ip": "10.2.11.1/24", "ns_if": "t2if", "ns_name": "t2"}], "subnet_ip": "1.1.1.0/24", "vms": [{"brif": "t2br1if1", "disk": "10G", "mem": 2, "name": "t2_VM4", "vcpu": 4, "vmif": "t2VM4if1"}], "vxlan": [{"dev": "t2s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.11.2", "remote_ip": "10.1.11.2", "remote_route": "10.1.11.0/24", "subnet_route": "10.2.11.0/24", "tenant_route_ip": "192.168.130.2", "v_name": "vxlan_t2s1"}]}, {"tenant_ns_if": "t2ns1if", "tenant_ns_ip": "10.2.11.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s1if", "tenant_sub_ip": "10.2.11.2/24"}], "rc": 0, "start": "2019-11-18 07:41:17.443272", "stderr": "Device \"t2ns1if\" does not exist.\nDevice \"t2s1if\" does not exist.", "stderr_lines": ["Device \"t2ns1if\" does not exist.", "Device \"t2s1if\" does not exist."], "stdout": "", "stdout_lines": []}

TASK [Set Namespace VETH Pairs UP] **************************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.11.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.2.11.1', u'bridge_name': u't2br1', u'dns': [{u'dnsif': u't2s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't2s1_dnsbrif'}], u'ns_name': u't2ns1', u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't2_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't2br1if1', u'vmif': u't2VM4if1'}], u'vxlan': [{u'local_ip': u'10.2.11.2', u'dsport': 4789, u'dev': u't2s1if', u'tenant_route_ip': u'192.168.130.2', u'remote_route': u'10.1.11.0/24', u'subnet_route': u'10.2.11.0/24', u'v_name': u'vxlan_t2s1', u'id': 42, u'remote_ip': u'10.1.11.2'}]}, {u'tenant_sub_ip': u'10.2.11.2/24', u'tenant_ns_ip': u'10.2.11.1/24', u'tenant_ns_if': u't2ns1if', u'tenant_sub_if': u't2s1if', u'tenant_ns_name': u't2'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t2\" ip link set dev \"t2ns1if\" up\nip netns exec \"t2ns1\" ip link set dev \"t2s1if\" up\n", "delta": "0:00:00.091356", "end": "2019-11-18 07:41:18.014751", "item": [{"bridge_name": "t2br1", "default_route_ip": "10.2.11.1", "dns": [{"brif": "t2s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t2s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns1", "route": [{"if": "p1", "ip": "10.2.11.1/24", "ns_if": "t2if", "ns_name": "t2"}], "subnet_ip": "1.1.1.0/24", "vms": [{"brif": "t2br1if1", "disk": "10G", "mem": 2, "name": "t2_VM4", "vcpu": 4, "vmif": "t2VM4if1"}], "vxlan": [{"dev": "t2s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.11.2", "remote_ip": "10.1.11.2", "remote_route": "10.1.11.0/24", "subnet_route": "10.2.11.0/24", "tenant_route_ip": "192.168.130.2", "v_name": "vxlan_t2s1"}]}, {"tenant_ns_if": "t2ns1if", "tenant_ns_ip": "10.2.11.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s1if", "tenant_sub_ip": "10.2.11.2/24"}], "rc": 0, "start": "2019-11-18 07:41:17.923395", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Add IP addresses to Namespace VETH Pairs] *************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.11.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.2.11.1', u'bridge_name': u't2br1', u'dns': [{u'dnsif': u't2s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't2s1_dnsbrif'}], u'ns_name': u't2ns1', u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't2_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't2br1if1', u'vmif': u't2VM4if1'}], u'vxlan': [{u'local_ip': u'10.2.11.2', u'dsport': 4789, u'dev': u't2s1if', u'tenant_route_ip': u'192.168.130.2', u'remote_route': u'10.1.11.0/24', u'subnet_route': u'10.2.11.0/24', u'v_name': u'vxlan_t2s1', u'id': 42, u'remote_ip': u'10.1.11.2'}]}, {u'tenant_sub_ip': u'10.2.11.2/24', u'tenant_ns_ip': u'10.2.11.1/24', u'tenant_ns_if': u't2ns1if', u'tenant_sub_if': u't2s1if', u'tenant_ns_name': u't2'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t2ns1\" ip addr show \"t2s1if\" | awk 'FNR==3{ print $2 }' | grep -w '^10.2.11.2/24' ; if [ $? -ne 0 ] ; then ip netns exec \"t2ns1\" ip addr add \"10.2.11.2/24\" dev \"t2s1if\" ; fi\n\nip netns exec \"t2\" ip addr show \"t2ns1if\" | awk 'FNR==3{ print $2 }' | grep -w '^10.2.11.1/24' ; if [ $? -ne 0 ] ; then ip netns exec \"t2\" ip addr add \"10.2.11.1/24\" dev \"t2ns1if\" ; fi\n", "delta": "0:00:00.148271", "end": "2019-11-18 07:41:18.526402", "item": [{"bridge_name": "t2br1", "default_route_ip": "10.2.11.1", "dns": [{"brif": "t2s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t2s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns1", "route": [{"if": "p1", "ip": "10.2.11.1/24", "ns_if": "t2if", "ns_name": "t2"}], "subnet_ip": "1.1.1.0/24", "vms": [{"brif": "t2br1if1", "disk": "10G", "mem": 2, "name": "t2_VM4", "vcpu": 4, "vmif": "t2VM4if1"}], "vxlan": [{"dev": "t2s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.11.2", "remote_ip": "10.1.11.2", "remote_route": "10.1.11.0/24", "subnet_route": "10.2.11.0/24", "tenant_route_ip": "192.168.130.2", "v_name": "vxlan_t2s1"}]}, {"tenant_ns_if": "t2ns1if", "tenant_ns_ip": "10.2.11.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s1if", "tenant_sub_ip": "10.2.11.2/24"}], "rc": 0, "start": "2019-11-18 07:41:18.378131", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Add IP Route to Tenant] *******************************************************************************************************************************
changed: [99.99.99.2] => (item={u'default_route_ip': u'192.168.130.1', u'name': u't2', u'pns_ip': u'192.168.130.1/24', u'tenant_if': u't2if', u'tenant_ip': u'192.168.130.2/24', u'pns_if': u't2pns_if'}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t2\" ip route show default | grep -w '[d]efault via 192.168.130.1' ; if [ $? -ne 0 ] ; then ip netns exec \"t2\" ip route add default via \"192.168.130.1\" ; fi\n", "delta": "0:00:00.072311", "end": "2019-11-18 07:41:18.954290", "item": {"default_route_ip": "192.168.130.1", "name": "t2", "pns_if": "t2pns_if", "pns_ip": "192.168.130.1/24", "tenant_if": "t2if", "tenant_ip": "192.168.130.2/24"}, "rc": 0, "start": "2019-11-18 07:41:18.881979", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Add IP Route to Tenant Subnet] ************************************************************************************************************************
changed: [99.99.99.2] => (item={u'route': [{u'ip': u'10.2.11.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.2.11.1', u'bridge_name': u't2br1', u'dns': [{u'dnsif': u't2s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't2s1_dnsbrif'}], u'ns_name': u't2ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.11.2/24', u'tenant_ns_ip': u'10.2.11.1/24', u'tenant_ns_if': u't2ns1if', u'tenant_ns_name': u't2', u'tenant_sub_if': u't2s1if'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't2_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't2br1if1', u'vmif': u't2VM4if1'}], u'vxlan': [{u'local_ip': u'10.2.11.2', u'tenant_route_ip': u'192.168.130.2', u'dsport': 4789, u'dev': u't2s1if', u'subnet_route': u'10.2.11.0/24', u'remote_route': u'10.1.11.0/24', u'v_name': u'vxlan_t2s1', u'id': 42, u'remote_ip': u'10.1.11.2'}]}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t2ns1\" ip route show default | grep -w '[d]efault via 10.2.11.1' ; if [ $? -ne 0 ] ; then ip netns exec \"t2ns1\" ip route add default via \"10.2.11.1\" ; fi\n", "delta": "0:00:00.096882", "end": "2019-11-18 07:41:19.406328", "item": {"bridge_name": "t2br1", "default_route_ip": "10.2.11.1", "dns": [{"brif": "t2s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t2s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns1", "route": [{"if": "p1", "ip": "10.2.11.1/24", "ns_if": "t2if", "ns_name": "t2"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t2ns1if", "tenant_ns_ip": "10.2.11.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s1if", "tenant_sub_ip": "10.2.11.2/24"}], "vms": [{"brif": "t2br1if1", "disk": "10G", "mem": 2, "name": "t2_VM4", "vcpu": 4, "vmif": "t2VM4if1"}], "vxlan": [{"dev": "t2s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.11.2", "remote_ip": "10.1.11.2", "remote_route": "10.1.11.0/24", "subnet_route": "10.2.11.0/24", "tenant_route_ip": "192.168.130.2", "v_name": "vxlan_t2s1"}]}, "rc": 0, "start": "2019-11-18 07:41:19.309446", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Create bridge inside namespace] ***********************************************************************************************************************
changed: [99.99.99.2] => (item={u'route': [{u'ip': u'10.2.11.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.2.11.1', u'bridge_name': u't2br1', u'dns': [{u'dnsif': u't2s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't2s1_dnsbrif'}], u'ns_name': u't2ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.11.2/24', u'tenant_ns_ip': u'10.2.11.1/24', u'tenant_ns_if': u't2ns1if', u'tenant_ns_name': u't2', u'tenant_sub_if': u't2s1if'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't2_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't2br1if1', u'vmif': u't2VM4if1'}], u'vxlan': [{u'local_ip': u'10.2.11.2', u'tenant_route_ip': u'192.168.130.2', u'dsport': 4789, u'dev': u't2s1if', u'subnet_route': u'10.2.11.0/24', u'remote_route': u'10.1.11.0/24', u'v_name': u'vxlan_t2s1', u'id': 42, u'remote_ip': u'10.1.11.2'}]}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t2ns1\" brctl show | grep -w '^t2br1'; if [ $? -ne 0 ] ; then ip netns exec \"t2ns1\" brctl addbr \"t2br1\" ; fi\nip netns exec \"t2ns1\" ip link set dev \"t2br1\" up\n", "delta": "0:00:00.108475", "end": "2019-11-18 07:41:19.886479", "item": {"bridge_name": "t2br1", "default_route_ip": "10.2.11.1", "dns": [{"brif": "t2s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t2s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns1", "route": [{"if": "p1", "ip": "10.2.11.1/24", "ns_if": "t2if", "ns_name": "t2"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t2ns1if", "tenant_ns_ip": "10.2.11.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s1if", "tenant_sub_ip": "10.2.11.2/24"}], "vms": [{"brif": "t2br1if1", "disk": "10G", "mem": 2, "name": "t2_VM4", "vcpu": 4, "vmif": "t2VM4if1"}], "vxlan": [{"dev": "t2s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.11.2", "remote_ip": "10.1.11.2", "remote_route": "10.1.11.0/24", "subnet_route": "10.2.11.0/24", "tenant_route_ip": "192.168.130.2", "v_name": "vxlan_t2s1"}]}, "rc": 0, "start": "2019-11-18 07:41:19.778004", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Create DNS VETH Pair] *********************************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.11.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.2.11.1', u'bridge_name': u't2br1', u'ns_name': u't2ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.11.2/24', u'tenant_ns_ip': u'10.2.11.1/24', u'tenant_ns_if': u't2ns1if', u'tenant_sub_if': u't2s1if', u'tenant_ns_name': u't2'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't2_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't2br1if1', u'vmif': u't2VM4if1'}], u'vxlan': [{u'local_ip': u'10.2.11.2', u'dsport': 4789, u'dev': u't2s1if', u'tenant_route_ip': u'192.168.130.2', u'remote_route': u'10.1.11.0/24', u'subnet_route': u'10.2.11.0/24', u'v_name': u'vxlan_t2s1', u'id': 42, u'remote_ip': u'10.1.11.2'}]}, {u'dnsif': u't2s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't2s1_dnsbrif'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t2ns1\" ip link show \"t2s1_dnsbrif\" ; if [ $? -ne 0 ] ; then ip netns exec \"t2ns1\" ip link add \"t2s1_dnsbrif\" type veth peer name \"t2s1_dnsif\" ; fi\nip netns exec \"t2ns1\" ip link set dev \"t2s1_dnsbrif\" up\nip netns exec \"t2ns1\" ip link set dev \"t2s1_dnsif\" up\n", "delta": "0:00:00.160500", "end": "2019-11-18 07:41:20.418482", "item": [{"bridge_name": "t2br1", "default_route_ip": "10.2.11.1", "ns_name": "t2ns1", "route": [{"if": "p1", "ip": "10.2.11.1/24", "ns_if": "t2if", "ns_name": "t2"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t2ns1if", "tenant_ns_ip": "10.2.11.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s1if", "tenant_sub_ip": "10.2.11.2/24"}], "vms": [{"brif": "t2br1if1", "disk": "10G", "mem": 2, "name": "t2_VM4", "vcpu": 4, "vmif": "t2VM4if1"}], "vxlan": [{"dev": "t2s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.11.2", "remote_ip": "10.1.11.2", "remote_route": "10.1.11.0/24", "subnet_route": "10.2.11.0/24", "tenant_route_ip": "192.168.130.2", "v_name": "vxlan_t2s1"}]}, {"brif": "t2s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t2s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "rc": 0, "start": "2019-11-18 07:41:20.257982", "stderr": "Device \"t2s1_dnsbrif\" does not exist.", "stderr_lines": ["Device \"t2s1_dnsbrif\" does not exist."], "stdout": "", "stdout_lines": []}

TASK [Attach DNS VETH Pair] *********************************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.11.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.2.11.1', u'bridge_name': u't2br1', u'ns_name': u't2ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.11.2/24', u'tenant_ns_ip': u'10.2.11.1/24', u'tenant_ns_if': u't2ns1if', u'tenant_sub_if': u't2s1if', u'tenant_ns_name': u't2'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't2_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't2br1if1', u'vmif': u't2VM4if1'}], u'vxlan': [{u'local_ip': u'10.2.11.2', u'dsport': 4789, u'dev': u't2s1if', u'tenant_route_ip': u'192.168.130.2', u'remote_route': u'10.1.11.0/24', u'subnet_route': u'10.2.11.0/24', u'v_name': u'vxlan_t2s1', u'id': 42, u'remote_ip': u'10.1.11.2'}]}, {u'dnsif': u't2s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't2s1_dnsbrif'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t2ns1\" brctl show \"t2br1\" | grep -w 't2s1_dnsbrif' ; if [ $? -ne 0 ] ; then ip netns exec \"t2ns1\" brctl addif \"t2br1\" \"t2s1_dnsbrif\" ; fi\n", "delta": "0:00:00.079054", "end": "2019-11-18 07:41:20.878380", "item": [{"bridge_name": "t2br1", "default_route_ip": "10.2.11.1", "ns_name": "t2ns1", "route": [{"if": "p1", "ip": "10.2.11.1/24", "ns_if": "t2if", "ns_name": "t2"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t2ns1if", "tenant_ns_ip": "10.2.11.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s1if", "tenant_sub_ip": "10.2.11.2/24"}], "vms": [{"brif": "t2br1if1", "disk": "10G", "mem": 2, "name": "t2_VM4", "vcpu": 4, "vmif": "t2VM4if1"}], "vxlan": [{"dev": "t2s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.11.2", "remote_ip": "10.1.11.2", "remote_route": "10.1.11.0/24", "subnet_route": "10.2.11.0/24", "tenant_route_ip": "192.168.130.2", "v_name": "vxlan_t2s1"}]}, {"brif": "t2s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t2s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "rc": 0, "start": "2019-11-18 07:41:20.799326", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Create VETH Pairs] ************************************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.11.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.2.11.1', u'bridge_name': u't2br1', u'dns': [{u'dnsif': u't2s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't2s1_dnsbrif'}], u'ns_name': u't2ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.11.2/24', u'tenant_ns_ip': u'10.2.11.1/24', u'tenant_ns_if': u't2ns1if', u'tenant_sub_if': u't2s1if', u'tenant_ns_name': u't2'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.2.11.2', u'dsport': 4789, u'dev': u't2s1if', u'tenant_route_ip': u'192.168.130.2', u'remote_route': u'10.1.11.0/24', u'subnet_route': u'10.2.11.0/24', u'v_name': u'vxlan_t2s1', u'id': 42, u'remote_ip': u'10.1.11.2'}]}, {u'mem': 2, u'name': u't2_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't2br1if1', u'vmif': u't2VM4if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip link show \"t2br1if1\" ; if [ $? -ne 0 ] ; then ip link add \"t2VM4if1\" type veth peer name \"t2br1if1\" ; fi\nip link set dev \"t2br1if1\" up\nip link set dev \"t2VM4if1\" up\n", "delta": "0:00:00.017811", "end": "2019-11-18 07:41:21.288256", "item": [{"bridge_name": "t2br1", "default_route_ip": "10.2.11.1", "dns": [{"brif": "t2s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t2s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns1", "route": [{"if": "p1", "ip": "10.2.11.1/24", "ns_if": "t2if", "ns_name": "t2"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t2ns1if", "tenant_ns_ip": "10.2.11.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s1if", "tenant_sub_ip": "10.2.11.2/24"}], "vxlan": [{"dev": "t2s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.11.2", "remote_ip": "10.1.11.2", "remote_route": "10.1.11.0/24", "subnet_route": "10.2.11.0/24", "tenant_route_ip": "192.168.130.2", "v_name": "vxlan_t2s1"}]}, {"brif": "t2br1if1", "disk": "10G", "mem": 2, "name": "t2_VM4", "vcpu": 4, "vmif": "t2VM4if1"}], "rc": 0, "start": "2019-11-18 07:41:21.270445", "stderr": "Device \"t2br1if1\" does not exist.", "stderr_lines": ["Device \"t2br1if1\" does not exist."], "stdout": "", "stdout_lines": []}

TASK [Attach VETH Pairs] ************************************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.11.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.2.11.1', u'bridge_name': u't2br1', u'dns': [{u'dnsif': u't2s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't2s1_dnsbrif'}], u'ns_name': u't2ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.11.2/24', u'tenant_ns_ip': u'10.2.11.1/24', u'tenant_ns_if': u't2ns1if', u'tenant_sub_if': u't2s1if', u'tenant_ns_name': u't2'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.2.11.2', u'dsport': 4789, u'dev': u't2s1if', u'tenant_route_ip': u'192.168.130.2', u'remote_route': u'10.1.11.0/24', u'subnet_route': u'10.2.11.0/24', u'v_name': u'vxlan_t2s1', u'id': 42, u'remote_ip': u'10.1.11.2'}]}, {u'mem': 2, u'name': u't2_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't2br1if1', u'vmif': u't2VM4if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip link show \"t2br1if1\" ; if [ $? -eq 0 ] ; then ip link set \"t2br1if1\" netns \"t2ns1\" ; fi\nip netns exec \"t2ns1\" brctl show \"t2br1\" | grep -w 't2br1if1' ; if [ $? -ne 0 ] ; then ip netns exec \"t2ns1\" brctl addif \"t2br1\" \"t2br1if1\" ; fi\n", "delta": "0:00:00.109303", "end": "2019-11-18 07:41:21.822446", "item": [{"bridge_name": "t2br1", "default_route_ip": "10.2.11.1", "dns": [{"brif": "t2s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t2s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns1", "route": [{"if": "p1", "ip": "10.2.11.1/24", "ns_if": "t2if", "ns_name": "t2"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t2ns1if", "tenant_ns_ip": "10.2.11.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s1if", "tenant_sub_ip": "10.2.11.2/24"}], "vxlan": [{"dev": "t2s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.11.2", "remote_ip": "10.1.11.2", "remote_route": "10.1.11.0/24", "subnet_route": "10.2.11.0/24", "tenant_route_ip": "192.168.130.2", "v_name": "vxlan_t2s1"}]}, {"brif": "t2br1if1", "disk": "10G", "mem": 2, "name": "t2_VM4", "vcpu": 4, "vmif": "t2VM4if1"}], "rc": 0, "start": "2019-11-18 07:41:21.713143", "stderr": "", "stderr_lines": [], "stdout": "29: t2br1if1@t2VM4if1: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP mode DEFAULT group default qlen 1000\n    link/ether a6:a7:19:8c:8f:46 brd ff:ff:ff:ff:ff:ff", "stdout_lines": ["29: t2br1if1@t2VM4if1: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP mode DEFAULT group default qlen 1000", "    link/ether a6:a7:19:8c:8f:46 brd ff:ff:ff:ff:ff:ff"]}

TASK [All interfaces and bridges UP] ************************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.11.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.2.11.1', u'bridge_name': u't2br1', u'dns': [{u'dnsif': u't2s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't2s1_dnsbrif'}], u'ns_name': u't2ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.11.2/24', u'tenant_ns_ip': u'10.2.11.1/24', u'tenant_ns_if': u't2ns1if', u'tenant_sub_if': u't2s1if', u'tenant_ns_name': u't2'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.2.11.2', u'dsport': 4789, u'dev': u't2s1if', u'tenant_route_ip': u'192.168.130.2', u'remote_route': u'10.1.11.0/24', u'subnet_route': u'10.2.11.0/24', u'v_name': u'vxlan_t2s1', u'id': 42, u'remote_ip': u'10.1.11.2'}]}, {u'mem': 2, u'name': u't2_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't2br1if1', u'vmif': u't2VM4if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t2ns1\" ip link set \"t2br1if1\" up\nip netns exec \"t2ns1\" ip link set dev \"t2br1\" up\n", "delta": "0:00:00.076068", "end": "2019-11-18 07:41:22.290466", "item": [{"bridge_name": "t2br1", "default_route_ip": "10.2.11.1", "dns": [{"brif": "t2s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t2s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns1", "route": [{"if": "p1", "ip": "10.2.11.1/24", "ns_if": "t2if", "ns_name": "t2"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t2ns1if", "tenant_ns_ip": "10.2.11.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s1if", "tenant_sub_ip": "10.2.11.2/24"}], "vxlan": [{"dev": "t2s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.11.2", "remote_ip": "10.1.11.2", "remote_route": "10.1.11.0/24", "subnet_route": "10.2.11.0/24", "tenant_route_ip": "192.168.130.2", "v_name": "vxlan_t2s1"}]}, {"brif": "t2br1if1", "disk": "10G", "mem": 2, "name": "t2_VM4", "vcpu": 4, "vmif": "t2VM4if1"}], "rc": 0, "start": "2019-11-18 07:41:22.214398", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Add IP to DNS Interface] ******************************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.11.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.2.11.1', u'bridge_name': u't2br1', u'ns_name': u't2ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.11.2/24', u'tenant_ns_ip': u'10.2.11.1/24', u'tenant_ns_if': u't2ns1if', u'tenant_sub_if': u't2s1if', u'tenant_ns_name': u't2'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't2_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't2br1if1', u'vmif': u't2VM4if1'}], u'vxlan': [{u'local_ip': u'10.2.11.2', u'dsport': 4789, u'dev': u't2s1if', u'tenant_route_ip': u'192.168.130.2', u'remote_route': u'10.1.11.0/24', u'subnet_route': u'10.2.11.0/24', u'v_name': u'vxlan_t2s1', u'id': 42, u'remote_ip': u'10.1.11.2'}]}, {u'dnsif': u't2s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't2s1_dnsbrif'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t2ns1\" ip addr show \"t2s1_dnsif\" | awk 'FNR==3{ print $2}'| grep -w '^1.1.1.128/24' ; if [ $? -ne 0 ] ; then ip netns exec \"t2ns1\" ip addr add \"1.1.1.128/24\" dev \"t2s1_dnsif\" ; fi\n", "delta": "0:00:00.079031", "end": "2019-11-18 07:41:22.754348", "item": [{"bridge_name": "t2br1", "default_route_ip": "10.2.11.1", "ns_name": "t2ns1", "route": [{"if": "p1", "ip": "10.2.11.1/24", "ns_if": "t2if", "ns_name": "t2"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t2ns1if", "tenant_ns_ip": "10.2.11.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s1if", "tenant_sub_ip": "10.2.11.2/24"}], "vms": [{"brif": "t2br1if1", "disk": "10G", "mem": 2, "name": "t2_VM4", "vcpu": 4, "vmif": "t2VM4if1"}], "vxlan": [{"dev": "t2s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.11.2", "remote_ip": "10.1.11.2", "remote_route": "10.1.11.0/24", "subnet_route": "10.2.11.0/24", "tenant_route_ip": "192.168.130.2", "v_name": "vxlan_t2s1"}]}, {"brif": "t2s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t2s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "rc": 0, "start": "2019-11-18 07:41:22.675317", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Install DHCP Server] **********************************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.11.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.2.11.1', u'bridge_name': u't2br1', u'ns_name': u't2ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.11.2/24', u'tenant_ns_ip': u'10.2.11.1/24', u'tenant_ns_if': u't2ns1if', u'tenant_sub_if': u't2s1if', u'tenant_ns_name': u't2'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't2_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't2br1if1', u'vmif': u't2VM4if1'}], u'vxlan': [{u'local_ip': u'10.2.11.2', u'dsport': 4789, u'dev': u't2s1if', u'tenant_route_ip': u'192.168.130.2', u'remote_route': u'10.1.11.0/24', u'subnet_route': u'10.2.11.0/24', u'v_name': u'vxlan_t2s1', u'id': 42, u'remote_ip': u'10.1.11.2'}]}, {u'dnsif': u't2s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't2s1_dnsbrif'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t2ns1\" ps aux | grep -w '[d]nsmasq --interface t2s1_dnsif -z --dhcp-range=1.1.1.133,1.1.1.254' ; if [ $? -ne 0 ] ; then ip netns exec \"t2ns1\" dnsmasq --interface \"t2s1_dnsif\" -z --dhcp-range=1.1.1.133,'1.1.1.254' ; fi\n", "delta": "0:00:00.076606", "end": "2019-11-18 07:41:23.179796", "item": [{"bridge_name": "t2br1", "default_route_ip": "10.2.11.1", "ns_name": "t2ns1", "route": [{"if": "p1", "ip": "10.2.11.1/24", "ns_if": "t2if", "ns_name": "t2"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t2ns1if", "tenant_ns_ip": "10.2.11.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s1if", "tenant_sub_ip": "10.2.11.2/24"}], "vms": [{"brif": "t2br1if1", "disk": "10G", "mem": 2, "name": "t2_VM4", "vcpu": 4, "vmif": "t2VM4if1"}], "vxlan": [{"dev": "t2s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.11.2", "remote_ip": "10.1.11.2", "remote_route": "10.1.11.0/24", "subnet_route": "10.2.11.0/24", "tenant_route_ip": "192.168.130.2", "v_name": "vxlan_t2s1"}]}, {"brif": "t2s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t2s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "rc": 0, "start": "2019-11-18 07:41:23.103190", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Create VXLAN devices] *********************************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.11.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.2.11.1', u'bridge_name': u't2br1', u'dns': [{u'dnsif': u't2s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't2s1_dnsbrif'}], u'ns_name': u't2ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.11.2/24', u'tenant_ns_ip': u'10.2.11.1/24', u'tenant_ns_if': u't2ns1if', u'tenant_sub_if': u't2s1if', u'tenant_ns_name': u't2'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't2_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't2br1if1', u'vmif': u't2VM4if1'}]}, {u'local_ip': u'10.2.11.2', u'dsport': 4789, u'dev': u't2s1if', u'tenant_route_ip': u'192.168.130.2', u'remote_route': u'10.1.11.0/24', u'subnet_route': u'10.2.11.0/24', u'v_name': u'vxlan_t2s1', u'id': 42, u'remote_ip': u'10.1.11.2'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t2ns1\" ip link show \"vxlan_t2s1\" ; if [ $? -ne 0 ] ; then ip netns exec \"t2ns1\" ip link add \"vxlan_t2s1\" type vxlan id \"42\" local \"10.2.11.2\" remote \"10.1.11.2\" dstport \"4789\" dev \"t2s1if\" ; ip netns exec \"t2ns1\" ip link set dev \"vxlan_t2s1\" up ; fi\n", "delta": "0:00:00.122550", "end": "2019-11-18 07:41:23.694387", "item": [{"bridge_name": "t2br1", "default_route_ip": "10.2.11.1", "dns": [{"brif": "t2s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t2s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns1", "route": [{"if": "p1", "ip": "10.2.11.1/24", "ns_if": "t2if", "ns_name": "t2"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t2ns1if", "tenant_ns_ip": "10.2.11.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s1if", "tenant_sub_ip": "10.2.11.2/24"}], "vms": [{"brif": "t2br1if1", "disk": "10G", "mem": 2, "name": "t2_VM4", "vcpu": 4, "vmif": "t2VM4if1"}]}, {"dev": "t2s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.11.2", "remote_ip": "10.1.11.2", "remote_route": "10.1.11.0/24", "subnet_route": "10.2.11.0/24", "tenant_route_ip": "192.168.130.2", "v_name": "vxlan_t2s1"}], "rc": 0, "start": "2019-11-18 07:41:23.571837", "stderr": "Device \"vxlan_t2s1\" does not exist.", "stderr_lines": ["Device \"vxlan_t2s1\" does not exist."], "stdout": "", "stdout_lines": []}

TASK [Attach VXLANs to bridge] ******************************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.11.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.2.11.1', u'bridge_name': u't2br1', u'dns': [{u'dnsif': u't2s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't2s1_dnsbrif'}], u'ns_name': u't2ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.11.2/24', u'tenant_ns_ip': u'10.2.11.1/24', u'tenant_ns_if': u't2ns1if', u'tenant_sub_if': u't2s1if', u'tenant_ns_name': u't2'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't2_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't2br1if1', u'vmif': u't2VM4if1'}]}, {u'local_ip': u'10.2.11.2', u'dsport': 4789, u'dev': u't2s1if', u'tenant_route_ip': u'192.168.130.2', u'remote_route': u'10.1.11.0/24', u'subnet_route': u'10.2.11.0/24', u'v_name': u'vxlan_t2s1', u'id': 42, u'remote_ip': u'10.1.11.2'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t2ns1\" brctl show \"t2br1\" | grep -w 'vxlan_t2s1' ; if [ $? -ne 0 ] ; then ip netns exec \"t2ns1\" brctl addif \"t2br1\" \"vxlan_t2s1\" ; fi\n", "delta": "0:00:00.086634", "end": "2019-11-18 07:41:24.190455", "item": [{"bridge_name": "t2br1", "default_route_ip": "10.2.11.1", "dns": [{"brif": "t2s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t2s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns1", "route": [{"if": "p1", "ip": "10.2.11.1/24", "ns_if": "t2if", "ns_name": "t2"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t2ns1if", "tenant_ns_ip": "10.2.11.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s1if", "tenant_sub_ip": "10.2.11.2/24"}], "vms": [{"brif": "t2br1if1", "disk": "10G", "mem": 2, "name": "t2_VM4", "vcpu": 4, "vmif": "t2VM4if1"}]}, {"dev": "t2s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.11.2", "remote_ip": "10.1.11.2", "remote_route": "10.1.11.0/24", "subnet_route": "10.2.11.0/24", "tenant_route_ip": "192.168.130.2", "v_name": "vxlan_t2s1"}], "rc": 0, "start": "2019-11-18 07:41:24.103821", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

PLAY RECAP **************************************************************************************************************************************************
99.99.99.2                 : ok=21   changed=21   unreachable=0    failed=0    skipped=0    rescued=0    ignored=0   

Using /etc/ansible/ansible.cfg as config file

PLAY [main] *************************************************************************************************************************************************

TASK [Add VXLAN routes in PNS] ******************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.11.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.1.11.1', u'bridge_name': u't2br1', u'dns': [{u'dnsif': u't2s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't2s1_dnsbrif'}], u'ns_name': u't2ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.11.2/24', u'tenant_ns_ip': u'10.1.11.1/24', u'tenant_ns_if': u't2ns1if', u'tenant_sub_if': u't2s1if', u'tenant_ns_name': u't2'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't2_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't2br1if1', u'vmif': u't2VM1if1'}, {u'mem': 4, u'name': u't2_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't2br1if2', u'vmif': u't2VM2if1'}]}, {u'local_ip': u'10.1.11.2', u'dsport': 4789, u'dev': u't2s1if', u'tenant_route_ip': u'192.168.2.2', u'remote_route': u'10.2.11.0/24', u'subnet_route': u'10.1.11.0/24', u'v_name': u'vxlan_t2s1', u'id': 42, u'remote_ip': u'10.2.11.2'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec pns ip route show \"10.1.11.0/24\" via \"192.168.2.2\" | grep -w '^10.1.11.0/24' ; if [ $? -ne 0 ] ; then ip netns exec pns ip route add \"10.1.11.0/24\" via \"192.168.2.2\" ; fi\n", "delta": "0:00:00.066077", "end": "2019-11-18 07:41:25.545481", "item": [{"bridge_name": "t2br1", "default_route_ip": "10.1.11.1", "dns": [{"brif": "t2s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t2s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns1", "route": [{"if": "p1", "ip": "10.1.11.1/24", "ns_if": "t2if", "ns_name": "t2"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t2ns1if", "tenant_ns_ip": "10.1.11.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s1if", "tenant_sub_ip": "10.1.11.2/24"}], "vms": [{"brif": "t2br1if1", "disk": "10G", "mem": 2, "name": "t2_VM1", "vcpu": 4, "vmif": "t2VM1if1"}, {"brif": "t2br1if2", "disk": "10G", "mem": 4, "name": "t2_VM2", "vcpu": 2, "vmif": "t2VM2if1"}]}, {"dev": "t2s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.11.2", "remote_ip": "10.2.11.2", "remote_route": "10.2.11.0/24", "subnet_route": "10.1.11.0/24", "tenant_route_ip": "192.168.2.2", "v_name": "vxlan_t2s1"}], "rc": 0, "start": "2019-11-18 07:41:25.479404", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}
skipping: [localhost] => (item=[{u'route': [{u'ip': u'10.1.12.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.1.12.1', u'bridge_name': u't2br2', u'dns': [{u'dnsif': u't2s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't2s2_dnsbrif'}], u'ns_name': u't2ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.12.2/24', u'tenant_ns_ip': u'10.1.12.1/24', u'tenant_ns_if': u't2ns2if', u'tenant_sub_if': u't2s2if', u'tenant_ns_name': u't2'}], u'subnet_ip': u'2.2.2.0/24', u'vms': [{u'mem': 3, u'name': u't2_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't2br2if1', u'vmif': u't2VM3if1'}]}, {u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}])  => {"ansible_loop_var": "item", "changed": false, "item": [{"bridge_name": "t2br2", "default_route_ip": "10.1.12.1", "dns": [{"brif": "t2s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t2s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns2", "route": [{"if": "p1", "ip": "10.1.12.1/24", "ns_if": "t2if", "ns_name": "t2"}], "subnet_ip": "2.2.2.0/24", "tenant_ns": [{"tenant_ns_if": "t2ns2if", "tenant_ns_ip": "10.1.12.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s2if", "tenant_sub_ip": "10.1.12.2/24"}], "vms": [{"brif": "t2br2if1", "disk": "10G", "mem": 3, "name": "t2_VM3", "vcpu": 2, "vmif": "t2VM3if1"}]}, {"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}], "skip_reason": "Conditional result was False"}

TASK [Get PNS ip address] ***********************************************************************************************************************************
ok: [localhost] => {"changed": false, "cmd": "ip netns exec pns ip addr show p1 | awk 'FNR==3{ print $2 }' | awk -F/ '{ print $1 }'\n", "delta": "0:00:00.046322", "end": "2019-11-18 07:41:25.833541", "rc": 0, "start": "2019-11-18 07:41:25.787219", "stderr": "", "stderr_lines": [], "stdout": "192.168.100.238", "stdout_lines": ["192.168.100.238"]}

TASK [Add VXLAN routes to host] *****************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.11.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.1.11.1', u'bridge_name': u't2br1', u'dns': [{u'dnsif': u't2s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't2s1_dnsbrif'}], u'ns_name': u't2ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.11.2/24', u'tenant_ns_ip': u'10.1.11.1/24', u'tenant_ns_if': u't2ns1if', u'tenant_sub_if': u't2s1if', u'tenant_ns_name': u't2'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't2_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't2br1if1', u'vmif': u't2VM1if1'}, {u'mem': 4, u'name': u't2_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't2br1if2', u'vmif': u't2VM2if1'}]}, {u'local_ip': u'10.1.11.2', u'dsport': 4789, u'dev': u't2s1if', u'tenant_route_ip': u'192.168.2.2', u'remote_route': u'10.2.11.0/24', u'subnet_route': u'10.1.11.0/24', u'v_name': u'vxlan_t2s1', u'id': 42, u'remote_ip': u'10.2.11.2'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip route show \"10.1.11.0/24\" via \"192.168.100.238\" | grep -w '^10.1.11.0/24' ; if [ $? -ne 0 ] ; then ip route add \"10.1.11.0/24\" via \"192.168.100.238\" ; fi\nip route show \"10.2.11.0/24\" via 99.99.99.2 | grep -w '^10.2.11.0/24'; if [ $? -ne 0 ] ; then ip route add \"10.2.11.0/24\" via 99.99.99.2 ; fi\n", "delta": "0:00:00.008737", "end": "2019-11-18 07:41:26.107603", "item": [{"bridge_name": "t2br1", "default_route_ip": "10.1.11.1", "dns": [{"brif": "t2s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t2s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns1", "route": [{"if": "p1", "ip": "10.1.11.1/24", "ns_if": "t2if", "ns_name": "t2"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t2ns1if", "tenant_ns_ip": "10.1.11.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s1if", "tenant_sub_ip": "10.1.11.2/24"}], "vms": [{"brif": "t2br1if1", "disk": "10G", "mem": 2, "name": "t2_VM1", "vcpu": 4, "vmif": "t2VM1if1"}, {"brif": "t2br1if2", "disk": "10G", "mem": 4, "name": "t2_VM2", "vcpu": 2, "vmif": "t2VM2if1"}]}, {"dev": "t2s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.11.2", "remote_ip": "10.2.11.2", "remote_route": "10.2.11.0/24", "subnet_route": "10.1.11.0/24", "tenant_route_ip": "192.168.2.2", "v_name": "vxlan_t2s1"}], "rc": 0, "start": "2019-11-18 07:41:26.098866", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}
skipping: [localhost] => (item=[{u'route': [{u'ip': u'10.1.12.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.1.12.1', u'bridge_name': u't2br2', u'dns': [{u'dnsif': u't2s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't2s2_dnsbrif'}], u'ns_name': u't2ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.12.2/24', u'tenant_ns_ip': u'10.1.12.1/24', u'tenant_ns_if': u't2ns2if', u'tenant_sub_if': u't2s2if', u'tenant_ns_name': u't2'}], u'subnet_ip': u'2.2.2.0/24', u'vms': [{u'mem': 3, u'name': u't2_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't2br2if1', u'vmif': u't2VM3if1'}]}, {u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}])  => {"ansible_loop_var": "item", "changed": false, "item": [{"bridge_name": "t2br2", "default_route_ip": "10.1.12.1", "dns": [{"brif": "t2s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t2s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns2", "route": [{"if": "p1", "ip": "10.1.12.1/24", "ns_if": "t2if", "ns_name": "t2"}], "subnet_ip": "2.2.2.0/24", "tenant_ns": [{"tenant_ns_if": "t2ns2if", "tenant_ns_ip": "10.1.12.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s2if", "tenant_sub_ip": "10.1.12.2/24"}], "vms": [{"brif": "t2br2if1", "disk": "10G", "mem": 3, "name": "t2_VM3", "vcpu": 2, "vmif": "t2VM3if1"}]}, {"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}], "skip_reason": "Conditional result was False"}

PLAY RECAP **************************************************************************************************************************************************
localhost                  : ok=3    changed=2    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0   

Using /etc/ansible/ansible.cfg as config file

PLAY [worker] ***********************************************************************************************************************************************

TASK [Add VXLAN routes in PNS] ******************************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.11.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.2.11.1', u'bridge_name': u't2br1', u'dns': [{u'dnsif': u't2s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't2s1_dnsbrif'}], u'ns_name': u't2ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.11.2/24', u'tenant_ns_ip': u'10.2.11.1/24', u'tenant_ns_if': u't2ns1if', u'tenant_sub_if': u't2s1if', u'tenant_ns_name': u't2'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't2_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't2br1if1', u'vmif': u't2VM4if1'}]}, {u'local_ip': u'10.2.11.2', u'dsport': 4789, u'dev': u't2s1if', u'tenant_route_ip': u'192.168.130.2', u'remote_route': u'10.1.11.0/24', u'subnet_route': u'10.2.11.0/24', u'v_name': u'vxlan_t2s1', u'id': 42, u'remote_ip': u'10.1.11.2'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec pns ip route show \"10.2.11.0/24\" via \"192.168.130.2\" | grep -w '^10.2.11.0/24' ; if [ $? -ne 0 ] ; then ip netns exec pns ip route add \"10.2.11.0/24\" via \"192.168.130.2\" ; fi\n", "delta": "0:00:00.078222", "end": "2019-11-18 07:41:27.318377", "item": [{"bridge_name": "t2br1", "default_route_ip": "10.2.11.1", "dns": [{"brif": "t2s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t2s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns1", "route": [{"if": "p1", "ip": "10.2.11.1/24", "ns_if": "t2if", "ns_name": "t2"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t2ns1if", "tenant_ns_ip": "10.2.11.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s1if", "tenant_sub_ip": "10.2.11.2/24"}], "vms": [{"brif": "t2br1if1", "disk": "10G", "mem": 2, "name": "t2_VM4", "vcpu": 4, "vmif": "t2VM4if1"}]}, {"dev": "t2s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.11.2", "remote_ip": "10.1.11.2", "remote_route": "10.1.11.0/24", "subnet_route": "10.2.11.0/24", "tenant_route_ip": "192.168.130.2", "v_name": "vxlan_t2s1"}], "rc": 0, "start": "2019-11-18 07:41:27.240155", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Get PNS ip address] ***********************************************************************************************************************************
ok: [99.99.99.2] => {"changed": false, "cmd": "ip netns exec pns ip addr show p1 | awk 'FNR==3{ print $2 }' | awk -F/ '{ print $1 }'\n", "delta": "0:00:00.035812", "end": "2019-11-18 07:41:27.722523", "rc": 0, "start": "2019-11-18 07:41:27.686711", "stderr": "", "stderr_lines": [], "stdout": "192.168.100.50", "stdout_lines": ["192.168.100.50"]}

TASK [Add VXLAN routes to host] *****************************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.11.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.2.11.1', u'bridge_name': u't2br1', u'dns': [{u'dnsif': u't2s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't2s1_dnsbrif'}], u'ns_name': u't2ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.11.2/24', u'tenant_ns_ip': u'10.2.11.1/24', u'tenant_ns_if': u't2ns1if', u'tenant_sub_if': u't2s1if', u'tenant_ns_name': u't2'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't2_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't2br1if1', u'vmif': u't2VM4if1'}]}, {u'local_ip': u'10.2.11.2', u'dsport': 4789, u'dev': u't2s1if', u'tenant_route_ip': u'192.168.130.2', u'remote_route': u'10.1.11.0/24', u'subnet_route': u'10.2.11.0/24', u'v_name': u'vxlan_t2s1', u'id': 42, u'remote_ip': u'10.1.11.2'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip route show \"10.2.11.0/24\" via \"192.168.100.50\" | grep -w '^10.2.11.0/24' ; if [ $? -ne 0 ] ; then ip route add \"10.2.11.0/24\" via \"192.168.100.50\" ; fi\nip route show \"10.1.11.0/24\" via 99.99.99.1 | grep -w '^10.1.11.0/24'; if [ $? -ne 0 ] ; then ip route add \"10.1.11.0/24\" via 99.99.99.1 ; fi\n", "delta": "0:00:00.009160", "end": "2019-11-18 07:41:28.126299", "item": [{"bridge_name": "t2br1", "default_route_ip": "10.2.11.1", "dns": [{"brif": "t2s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t2s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns1", "route": [{"if": "p1", "ip": "10.2.11.1/24", "ns_if": "t2if", "ns_name": "t2"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t2ns1if", "tenant_ns_ip": "10.2.11.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s1if", "tenant_sub_ip": "10.2.11.2/24"}], "vms": [{"brif": "t2br1if1", "disk": "10G", "mem": 2, "name": "t2_VM4", "vcpu": 4, "vmif": "t2VM4if1"}]}, {"dev": "t2s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.11.2", "remote_ip": "10.1.11.2", "remote_route": "10.1.11.0/24", "subnet_route": "10.2.11.0/24", "tenant_route_ip": "192.168.130.2", "v_name": "vxlan_t2s1"}], "rc": 0, "start": "2019-11-18 07:41:28.117139", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

PLAY RECAP **************************************************************************************************************************************************
99.99.99.2                 : ok=3    changed=2    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0   

Using /etc/ansible/ansible.cfg as config file

PLAY [main] *************************************************************************************************************************************************

TASK [Create VM templates (C1)] *****************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.11.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.1.11.1', u'bridge_name': u't2br1', u'dns': [{u'dnsif': u't2s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't2s1_dnsbrif'}], u'ns_name': u't2ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.11.2/24', u'tenant_ns_ip': u'10.1.11.1/24', u'tenant_ns_if': u't2ns1if', u'tenant_sub_if': u't2s1if', u'tenant_ns_name': u't2'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.1.11.2', u'dsport': 4789, u'dev': u't2s1if', u'tenant_route_ip': u'192.168.2.2', u'remote_route': u'10.2.11.0/24', u'subnet_route': u'10.1.11.0/24', u'v_name': u'vxlan_t2s1', u'id': 42, u'remote_ip': u'10.2.11.2'}]}, {u'mem': 2, u'name': u't2_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't2br1if1', u'vmif': u't2VM1if1'}]) => {"ansible_loop_var": "item", "changed": true, "checksum": "350ba870bd31b7f6ee517845c14237910b5af0bf", "dest": "/root/Migration-as-a-Service/t2/VM_templates/t2_VM1.xml.j2", "gid": 0, "group": "root", "item": [{"bridge_name": "t2br1", "default_route_ip": "10.1.11.1", "dns": [{"brif": "t2s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t2s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns1", "route": [{"if": "p1", "ip": "10.1.11.1/24", "ns_if": "t2if", "ns_name": "t2"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t2ns1if", "tenant_ns_ip": "10.1.11.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s1if", "tenant_sub_ip": "10.1.11.2/24"}], "vxlan": [{"dev": "t2s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.11.2", "remote_ip": "10.2.11.2", "remote_route": "10.2.11.0/24", "subnet_route": "10.1.11.0/24", "tenant_route_ip": "192.168.2.2", "v_name": "vxlan_t2s1"}]}, {"brif": "t2br1if1", "disk": "10G", "mem": 2, "name": "t2_VM1", "vcpu": 4, "vmif": "t2VM1if1"}], "md5sum": "fbfc2eb0c2569531f25eea92c26d3bee", "mode": "0644", "owner": "root", "size": 4091, "src": "/root/.ansible/tmp/ansible-tmp-1574062888.74-38204172027942/source", "state": "file", "uid": 0}
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.11.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.1.11.1', u'bridge_name': u't2br1', u'dns': [{u'dnsif': u't2s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't2s1_dnsbrif'}], u'ns_name': u't2ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.11.2/24', u'tenant_ns_ip': u'10.1.11.1/24', u'tenant_ns_if': u't2ns1if', u'tenant_sub_if': u't2s1if', u'tenant_ns_name': u't2'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.1.11.2', u'dsport': 4789, u'dev': u't2s1if', u'tenant_route_ip': u'192.168.2.2', u'remote_route': u'10.2.11.0/24', u'subnet_route': u'10.1.11.0/24', u'v_name': u'vxlan_t2s1', u'id': 42, u'remote_ip': u'10.2.11.2'}]}, {u'mem': 4, u'name': u't2_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't2br1if2', u'vmif': u't2VM2if1'}]) => {"ansible_loop_var": "item", "changed": true, "checksum": "350ba870bd31b7f6ee517845c14237910b5af0bf", "dest": "/root/Migration-as-a-Service/t2/VM_templates/t2_VM2.xml.j2", "gid": 0, "group": "root", "item": [{"bridge_name": "t2br1", "default_route_ip": "10.1.11.1", "dns": [{"brif": "t2s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t2s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns1", "route": [{"if": "p1", "ip": "10.1.11.1/24", "ns_if": "t2if", "ns_name": "t2"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t2ns1if", "tenant_ns_ip": "10.1.11.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s1if", "tenant_sub_ip": "10.1.11.2/24"}], "vxlan": [{"dev": "t2s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.11.2", "remote_ip": "10.2.11.2", "remote_route": "10.2.11.0/24", "subnet_route": "10.1.11.0/24", "tenant_route_ip": "192.168.2.2", "v_name": "vxlan_t2s1"}]}, {"brif": "t2br1if2", "disk": "10G", "mem": 4, "name": "t2_VM2", "vcpu": 2, "vmif": "t2VM2if1"}], "md5sum": "fbfc2eb0c2569531f25eea92c26d3bee", "mode": "0644", "owner": "root", "size": 4091, "src": "/root/.ansible/tmp/ansible-tmp-1574062889.28-185877579585713/source", "state": "file", "uid": 0}
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.12.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.1.12.1', u'bridge_name': u't2br2', u'dns': [{u'dnsif': u't2s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't2s2_dnsbrif'}], u'ns_name': u't2ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.12.2/24', u'tenant_ns_ip': u'10.1.12.1/24', u'tenant_ns_if': u't2ns2if', u'tenant_sub_if': u't2s2if', u'tenant_ns_name': u't2'}], u'subnet_ip': u'2.2.2.0/24', u'vxlan': [{u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}, {u'mem': 3, u'name': u't2_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't2br2if1', u'vmif': u't2VM3if1'}]) => {"ansible_loop_var": "item", "changed": true, "checksum": "350ba870bd31b7f6ee517845c14237910b5af0bf", "dest": "/root/Migration-as-a-Service/t2/VM_templates/t2_VM3.xml.j2", "gid": 0, "group": "root", "item": [{"bridge_name": "t2br2", "default_route_ip": "10.1.12.1", "dns": [{"brif": "t2s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t2s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns2", "route": [{"if": "p1", "ip": "10.1.12.1/24", "ns_if": "t2if", "ns_name": "t2"}], "subnet_ip": "2.2.2.0/24", "tenant_ns": [{"tenant_ns_if": "t2ns2if", "tenant_ns_ip": "10.1.12.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s2if", "tenant_sub_ip": "10.1.12.2/24"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, {"brif": "t2br2if1", "disk": "10G", "mem": 3, "name": "t2_VM3", "vcpu": 2, "vmif": "t2VM3if1"}], "md5sum": "fbfc2eb0c2569531f25eea92c26d3bee", "mode": "0644", "owner": "root", "size": 4091, "src": "/root/.ansible/tmp/ansible-tmp-1574062889.53-171442189003467/source", "state": "file", "uid": 0}

PLAY RECAP **************************************************************************************************************************************************
localhost                  : ok=1    changed=1    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0   

Using /etc/ansible/ansible.cfg as config file

PLAY [main] *************************************************************************************************************************************************

TASK [Create VM templates (C2)] *****************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.2.11.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.2.11.1', u'bridge_name': u't2br1', u'dns': [{u'dnsif': u't2s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't2s1_dnsbrif'}], u'ns_name': u't2ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.11.2/24', u'tenant_ns_ip': u'10.2.11.1/24', u'tenant_ns_if': u't2ns1if', u'tenant_sub_if': u't2s1if', u'tenant_ns_name': u't2'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.2.11.2', u'dsport': 4789, u'dev': u't2s1if', u'tenant_route_ip': u'192.168.130.2', u'remote_route': u'10.1.11.0/24', u'subnet_route': u'10.2.11.0/24', u'v_name': u'vxlan_t2s1', u'id': 42, u'remote_ip': u'10.1.11.2'}]}, {u'mem': 2, u'name': u't2_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't2br1if1', u'vmif': u't2VM4if1'}]) => {"ansible_loop_var": "item", "changed": true, "checksum": "350ba870bd31b7f6ee517845c14237910b5af0bf", "dest": "/root/Migration-as-a-Service/t2/VM_templates/t2_VM4.xml.j2", "gid": 0, "group": "root", "item": [{"bridge_name": "t2br1", "default_route_ip": "10.2.11.1", "dns": [{"brif": "t2s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t2s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns1", "route": [{"if": "p1", "ip": "10.2.11.1/24", "ns_if": "t2if", "ns_name": "t2"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t2ns1if", "tenant_ns_ip": "10.2.11.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s1if", "tenant_sub_ip": "10.2.11.2/24"}], "vxlan": [{"dev": "t2s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.11.2", "remote_ip": "10.1.11.2", "remote_route": "10.1.11.0/24", "subnet_route": "10.2.11.0/24", "tenant_route_ip": "192.168.130.2", "v_name": "vxlan_t2s1"}]}, {"brif": "t2br1if1", "disk": "10G", "mem": 2, "name": "t2_VM4", "vcpu": 4, "vmif": "t2VM4if1"}], "md5sum": "fbfc2eb0c2569531f25eea92c26d3bee", "mode": "0644", "owner": "root", "size": 4091, "src": "/root/.ansible/tmp/ansible-tmp-1574062890.44-271385688384657/source", "state": "file", "uid": 0}

PLAY RECAP **************************************************************************************************************************************************
localhost                  : ok=1    changed=1    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0   

Using /etc/ansible/ansible.cfg as config file

PLAY [main] *************************************************************************************************************************************************

TASK [Copy VM image] ****************************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.11.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.1.11.1', u'bridge_name': u't2br1', u'dns': [{u'dnsif': u't2s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't2s1_dnsbrif'}], u'ns_name': u't2ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.11.2/24', u'tenant_ns_ip': u'10.1.11.1/24', u'tenant_ns_if': u't2ns1if', u'tenant_sub_if': u't2s1if', u'tenant_ns_name': u't2'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.1.11.2', u'dsport': 4789, u'dev': u't2s1if', u'tenant_route_ip': u'192.168.2.2', u'remote_route': u'10.2.11.0/24', u'subnet_route': u'10.1.11.0/24', u'v_name': u'vxlan_t2s1', u'id': 42, u'remote_ip': u'10.2.11.2'}]}, {u'mem': 2, u'name': u't2_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't2br1if1', u'vmif': u't2VM1if1'}]) => {"ansible_loop_var": "item", "changed": true, "checksum": "d86d5962370fcd0c3d05943fc209d9e05fdac89f", "dest": "/var/lib/libvirt/images/t2_VM1.qcow2", "gid": 0, "group": "root", "item": [{"bridge_name": "t2br1", "default_route_ip": "10.1.11.1", "dns": [{"brif": "t2s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t2s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns1", "route": [{"if": "p1", "ip": "10.1.11.1/24", "ns_if": "t2if", "ns_name": "t2"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t2ns1if", "tenant_ns_ip": "10.1.11.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s1if", "tenant_sub_ip": "10.1.11.2/24"}], "vxlan": [{"dev": "t2s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.11.2", "remote_ip": "10.2.11.2", "remote_route": "10.2.11.0/24", "subnet_route": "10.1.11.0/24", "tenant_route_ip": "192.168.2.2", "v_name": "vxlan_t2s1"}]}, {"brif": "t2br1if1", "disk": "10G", "mem": 2, "name": "t2_VM1", "vcpu": 4, "vmif": "t2VM1if1"}], "md5sum": "b977a19124b65f2d544ddc62e407114d", "mode": "0644", "owner": "root", "size": 10739318784, "src": "/root/.ansible/tmp/ansible-tmp-1574062891.74-172296875113854/source", "state": "file", "uid": 0}
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.11.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.1.11.1', u'bridge_name': u't2br1', u'dns': [{u'dnsif': u't2s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't2s1_dnsbrif'}], u'ns_name': u't2ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.11.2/24', u'tenant_ns_ip': u'10.1.11.1/24', u'tenant_ns_if': u't2ns1if', u'tenant_sub_if': u't2s1if', u'tenant_ns_name': u't2'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.1.11.2', u'dsport': 4789, u'dev': u't2s1if', u'tenant_route_ip': u'192.168.2.2', u'remote_route': u'10.2.11.0/24', u'subnet_route': u'10.1.11.0/24', u'v_name': u'vxlan_t2s1', u'id': 42, u'remote_ip': u'10.2.11.2'}]}, {u'mem': 4, u'name': u't2_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't2br1if2', u'vmif': u't2VM2if1'}]) => {"ansible_loop_var": "item", "changed": true, "checksum": "d86d5962370fcd0c3d05943fc209d9e05fdac89f", "dest": "/var/lib/libvirt/images/t2_VM2.qcow2", "gid": 0, "group": "root", "item": [{"bridge_name": "t2br1", "default_route_ip": "10.1.11.1", "dns": [{"brif": "t2s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t2s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns1", "route": [{"if": "p1", "ip": "10.1.11.1/24", "ns_if": "t2if", "ns_name": "t2"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t2ns1if", "tenant_ns_ip": "10.1.11.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s1if", "tenant_sub_ip": "10.1.11.2/24"}], "vxlan": [{"dev": "t2s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.11.2", "remote_ip": "10.2.11.2", "remote_route": "10.2.11.0/24", "subnet_route": "10.1.11.0/24", "tenant_route_ip": "192.168.2.2", "v_name": "vxlan_t2s1"}]}, {"brif": "t2br1if2", "disk": "10G", "mem": 4, "name": "t2_VM2", "vcpu": 2, "vmif": "t2VM2if1"}], "md5sum": "b977a19124b65f2d544ddc62e407114d", "mode": "0644", "owner": "root", "size": 10739318784, "src": "/root/.ansible/tmp/ansible-tmp-1574062981.99-173374909481937/source", "state": "file", "uid": 0}
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.12.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.1.12.1', u'bridge_name': u't2br2', u'dns': [{u'dnsif': u't2s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't2s2_dnsbrif'}], u'ns_name': u't2ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.12.2/24', u'tenant_ns_ip': u'10.1.12.1/24', u'tenant_ns_if': u't2ns2if', u'tenant_sub_if': u't2s2if', u'tenant_ns_name': u't2'}], u'subnet_ip': u'2.2.2.0/24', u'vxlan': [{u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}, {u'mem': 3, u'name': u't2_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't2br2if1', u'vmif': u't2VM3if1'}]) => {"ansible_loop_var": "item", "changed": true, "checksum": "d86d5962370fcd0c3d05943fc209d9e05fdac89f", "dest": "/var/lib/libvirt/images/t2_VM3.qcow2", "gid": 0, "group": "root", "item": [{"bridge_name": "t2br2", "default_route_ip": "10.1.12.1", "dns": [{"brif": "t2s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t2s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns2", "route": [{"if": "p1", "ip": "10.1.12.1/24", "ns_if": "t2if", "ns_name": "t2"}], "subnet_ip": "2.2.2.0/24", "tenant_ns": [{"tenant_ns_if": "t2ns2if", "tenant_ns_ip": "10.1.12.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s2if", "tenant_sub_ip": "10.1.12.2/24"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, {"brif": "t2br2if1", "disk": "10G", "mem": 3, "name": "t2_VM3", "vcpu": 2, "vmif": "t2VM3if1"}], "md5sum": "b977a19124b65f2d544ddc62e407114d", "mode": "0644", "owner": "root", "size": 10739318784, "src": "/root/.ansible/tmp/ansible-tmp-1574063090.39-70761858168715/source", "state": "file", "uid": 0}

TASK [Create VM templates (C1)] *****************************************************************************************************************************
ok: [localhost] => (item=[{u'route': [{u'ip': u'10.1.11.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.1.11.1', u'bridge_name': u't2br1', u'dns': [{u'dnsif': u't2s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't2s1_dnsbrif'}], u'ns_name': u't2ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.11.2/24', u'tenant_ns_ip': u'10.1.11.1/24', u'tenant_ns_if': u't2ns1if', u'tenant_sub_if': u't2s1if', u'tenant_ns_name': u't2'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.1.11.2', u'dsport': 4789, u'dev': u't2s1if', u'tenant_route_ip': u'192.168.2.2', u'remote_route': u'10.2.11.0/24', u'subnet_route': u'10.1.11.0/24', u'v_name': u'vxlan_t2s1', u'id': 42, u'remote_ip': u'10.2.11.2'}]}, {u'mem': 2, u'name': u't2_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't2br1if1', u'vmif': u't2VM1if1'}]) => {"ansible_loop_var": "item", "changed": false, "checksum": "350ba870bd31b7f6ee517845c14237910b5af0bf", "dest": "/root/Migration-as-a-Service/t2/VM_templates/t2_VM1.xml.j2", "gid": 0, "group": "root", "item": [{"bridge_name": "t2br1", "default_route_ip": "10.1.11.1", "dns": [{"brif": "t2s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t2s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns1", "route": [{"if": "p1", "ip": "10.1.11.1/24", "ns_if": "t2if", "ns_name": "t2"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t2ns1if", "tenant_ns_ip": "10.1.11.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s1if", "tenant_sub_ip": "10.1.11.2/24"}], "vxlan": [{"dev": "t2s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.11.2", "remote_ip": "10.2.11.2", "remote_route": "10.2.11.0/24", "subnet_route": "10.1.11.0/24", "tenant_route_ip": "192.168.2.2", "v_name": "vxlan_t2s1"}]}, {"brif": "t2br1if1", "disk": "10G", "mem": 2, "name": "t2_VM1", "vcpu": 4, "vmif": "t2VM1if1"}], "mode": "0644", "owner": "root", "path": "/root/Migration-as-a-Service/t2/VM_templates/t2_VM1.xml.j2", "size": 4091, "state": "file", "uid": 0}
ok: [localhost] => (item=[{u'route': [{u'ip': u'10.1.11.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.1.11.1', u'bridge_name': u't2br1', u'dns': [{u'dnsif': u't2s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't2s1_dnsbrif'}], u'ns_name': u't2ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.11.2/24', u'tenant_ns_ip': u'10.1.11.1/24', u'tenant_ns_if': u't2ns1if', u'tenant_sub_if': u't2s1if', u'tenant_ns_name': u't2'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.1.11.2', u'dsport': 4789, u'dev': u't2s1if', u'tenant_route_ip': u'192.168.2.2', u'remote_route': u'10.2.11.0/24', u'subnet_route': u'10.1.11.0/24', u'v_name': u'vxlan_t2s1', u'id': 42, u'remote_ip': u'10.2.11.2'}]}, {u'mem': 4, u'name': u't2_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't2br1if2', u'vmif': u't2VM2if1'}]) => {"ansible_loop_var": "item", "changed": false, "checksum": "350ba870bd31b7f6ee517845c14237910b5af0bf", "dest": "/root/Migration-as-a-Service/t2/VM_templates/t2_VM2.xml.j2", "gid": 0, "group": "root", "item": [{"bridge_name": "t2br1", "default_route_ip": "10.1.11.1", "dns": [{"brif": "t2s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t2s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns1", "route": [{"if": "p1", "ip": "10.1.11.1/24", "ns_if": "t2if", "ns_name": "t2"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t2ns1if", "tenant_ns_ip": "10.1.11.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s1if", "tenant_sub_ip": "10.1.11.2/24"}], "vxlan": [{"dev": "t2s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.11.2", "remote_ip": "10.2.11.2", "remote_route": "10.2.11.0/24", "subnet_route": "10.1.11.0/24", "tenant_route_ip": "192.168.2.2", "v_name": "vxlan_t2s1"}]}, {"brif": "t2br1if2", "disk": "10G", "mem": 4, "name": "t2_VM2", "vcpu": 2, "vmif": "t2VM2if1"}], "mode": "0644", "owner": "root", "path": "/root/Migration-as-a-Service/t2/VM_templates/t2_VM2.xml.j2", "size": 4091, "state": "file", "uid": 0}
ok: [localhost] => (item=[{u'route': [{u'ip': u'10.1.12.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.1.12.1', u'bridge_name': u't2br2', u'dns': [{u'dnsif': u't2s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't2s2_dnsbrif'}], u'ns_name': u't2ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.12.2/24', u'tenant_ns_ip': u'10.1.12.1/24', u'tenant_ns_if': u't2ns2if', u'tenant_sub_if': u't2s2if', u'tenant_ns_name': u't2'}], u'subnet_ip': u'2.2.2.0/24', u'vxlan': [{u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}, {u'mem': 3, u'name': u't2_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't2br2if1', u'vmif': u't2VM3if1'}]) => {"ansible_loop_var": "item", "changed": false, "checksum": "350ba870bd31b7f6ee517845c14237910b5af0bf", "dest": "/root/Migration-as-a-Service/t2/VM_templates/t2_VM3.xml.j2", "gid": 0, "group": "root", "item": [{"bridge_name": "t2br2", "default_route_ip": "10.1.12.1", "dns": [{"brif": "t2s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t2s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns2", "route": [{"if": "p1", "ip": "10.1.12.1/24", "ns_if": "t2if", "ns_name": "t2"}], "subnet_ip": "2.2.2.0/24", "tenant_ns": [{"tenant_ns_if": "t2ns2if", "tenant_ns_ip": "10.1.12.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s2if", "tenant_sub_ip": "10.1.12.2/24"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, {"brif": "t2br2if1", "disk": "10G", "mem": 3, "name": "t2_VM3", "vcpu": 2, "vmif": "t2VM3if1"}], "mode": "0644", "owner": "root", "path": "/root/Migration-as-a-Service/t2/VM_templates/t2_VM3.xml.j2", "size": 4091, "state": "file", "uid": 0}

TASK [Get list of running VMs] ******************************************************************************************************************************
ok: [localhost] => {"changed": false, "cmd": ["virsh", "list", "--name"], "delta": "0:00:00.048554", "end": "2019-11-18 07:46:24.331732", "rc": 0, "start": "2019-11-18 07:46:24.283178", "stderr": "", "stderr_lines": [], "stdout": "t1_VM2\nt1_VM3", "stdout_lines": ["t1_VM2", "t1_VM3"]}

TASK [Define VM] ********************************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.11.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.1.11.1', u'bridge_name': u't2br1', u'dns': [{u'dnsif': u't2s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't2s1_dnsbrif'}], u'ns_name': u't2ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.11.2/24', u'tenant_ns_ip': u'10.1.11.1/24', u'tenant_ns_if': u't2ns1if', u'tenant_sub_if': u't2s1if', u'tenant_ns_name': u't2'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.1.11.2', u'dsport': 4789, u'dev': u't2s1if', u'tenant_route_ip': u'192.168.2.2', u'remote_route': u'10.2.11.0/24', u'subnet_route': u'10.1.11.0/24', u'v_name': u'vxlan_t2s1', u'id': 42, u'remote_ip': u'10.2.11.2'}]}, {u'mem': 2, u'name': u't2_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't2br1if1', u'vmif': u't2VM1if1'}]) => {"ansible_loop_var": "item", "changed": true, "created": "t2_VM1", "item": [{"bridge_name": "t2br1", "default_route_ip": "10.1.11.1", "dns": [{"brif": "t2s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t2s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns1", "route": [{"if": "p1", "ip": "10.1.11.1/24", "ns_if": "t2if", "ns_name": "t2"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t2ns1if", "tenant_ns_ip": "10.1.11.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s1if", "tenant_sub_ip": "10.1.11.2/24"}], "vxlan": [{"dev": "t2s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.11.2", "remote_ip": "10.2.11.2", "remote_route": "10.2.11.0/24", "subnet_route": "10.1.11.0/24", "tenant_route_ip": "192.168.2.2", "v_name": "vxlan_t2s1"}]}, {"brif": "t2br1if1", "disk": "10G", "mem": 2, "name": "t2_VM1", "vcpu": 4, "vmif": "t2VM1if1"}], "warnings": ["'xml' is given - ignoring 'name'"]}
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.11.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.1.11.1', u'bridge_name': u't2br1', u'dns': [{u'dnsif': u't2s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't2s1_dnsbrif'}], u'ns_name': u't2ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.11.2/24', u'tenant_ns_ip': u'10.1.11.1/24', u'tenant_ns_if': u't2ns1if', u'tenant_sub_if': u't2s1if', u'tenant_ns_name': u't2'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.1.11.2', u'dsport': 4789, u'dev': u't2s1if', u'tenant_route_ip': u'192.168.2.2', u'remote_route': u'10.2.11.0/24', u'subnet_route': u'10.1.11.0/24', u'v_name': u'vxlan_t2s1', u'id': 42, u'remote_ip': u'10.2.11.2'}]}, {u'mem': 4, u'name': u't2_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't2br1if2', u'vmif': u't2VM2if1'}]) => {"ansible_loop_var": "item", "changed": true, "created": "t2_VM2", "item": [{"bridge_name": "t2br1", "default_route_ip": "10.1.11.1", "dns": [{"brif": "t2s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t2s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns1", "route": [{"if": "p1", "ip": "10.1.11.1/24", "ns_if": "t2if", "ns_name": "t2"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t2ns1if", "tenant_ns_ip": "10.1.11.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s1if", "tenant_sub_ip": "10.1.11.2/24"}], "vxlan": [{"dev": "t2s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.11.2", "remote_ip": "10.2.11.2", "remote_route": "10.2.11.0/24", "subnet_route": "10.1.11.0/24", "tenant_route_ip": "192.168.2.2", "v_name": "vxlan_t2s1"}]}, {"brif": "t2br1if2", "disk": "10G", "mem": 4, "name": "t2_VM2", "vcpu": 2, "vmif": "t2VM2if1"}], "warnings": ["'xml' is given - ignoring 'name'"]}
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.12.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.1.12.1', u'bridge_name': u't2br2', u'dns': [{u'dnsif': u't2s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't2s2_dnsbrif'}], u'ns_name': u't2ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.12.2/24', u'tenant_ns_ip': u'10.1.12.1/24', u'tenant_ns_if': u't2ns2if', u'tenant_sub_if': u't2s2if', u'tenant_ns_name': u't2'}], u'subnet_ip': u'2.2.2.0/24', u'vxlan': [{u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}, {u'mem': 3, u'name': u't2_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't2br2if1', u'vmif': u't2VM3if1'}]) => {"ansible_loop_var": "item", "changed": true, "created": "t2_VM3", "item": [{"bridge_name": "t2br2", "default_route_ip": "10.1.12.1", "dns": [{"brif": "t2s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t2s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns2", "route": [{"if": "p1", "ip": "10.1.12.1/24", "ns_if": "t2if", "ns_name": "t2"}], "subnet_ip": "2.2.2.0/24", "tenant_ns": [{"tenant_ns_if": "t2ns2if", "tenant_ns_ip": "10.1.12.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s2if", "tenant_sub_ip": "10.1.12.2/24"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, {"brif": "t2br2if1", "disk": "10G", "mem": 3, "name": "t2_VM3", "vcpu": 2, "vmif": "t2VM3if1"}], "warnings": ["'xml' is given - ignoring 'name'"]}

TASK [Create VM] ********************************************************************************************************************************************
ok: [localhost] => (item=[{u'route': [{u'ip': u'10.1.11.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.1.11.1', u'bridge_name': u't2br1', u'dns': [{u'dnsif': u't2s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't2s1_dnsbrif'}], u'ns_name': u't2ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.11.2/24', u'tenant_ns_ip': u'10.1.11.1/24', u'tenant_ns_if': u't2ns1if', u'tenant_sub_if': u't2s1if', u'tenant_ns_name': u't2'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.1.11.2', u'dsport': 4789, u'dev': u't2s1if', u'tenant_route_ip': u'192.168.2.2', u'remote_route': u'10.2.11.0/24', u'subnet_route': u'10.1.11.0/24', u'v_name': u'vxlan_t2s1', u'id': 42, u'remote_ip': u'10.2.11.2'}]}, {u'mem': 2, u'name': u't2_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't2br1if1', u'vmif': u't2VM1if1'}]) => {"ansible_loop_var": "item", "changed": false, "create": 0, "item": [{"bridge_name": "t2br1", "default_route_ip": "10.1.11.1", "dns": [{"brif": "t2s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t2s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns1", "route": [{"if": "p1", "ip": "10.1.11.1/24", "ns_if": "t2if", "ns_name": "t2"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t2ns1if", "tenant_ns_ip": "10.1.11.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s1if", "tenant_sub_ip": "10.1.11.2/24"}], "vxlan": [{"dev": "t2s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.11.2", "remote_ip": "10.2.11.2", "remote_route": "10.2.11.0/24", "subnet_route": "10.1.11.0/24", "tenant_route_ip": "192.168.2.2", "v_name": "vxlan_t2s1"}]}, {"brif": "t2br1if1", "disk": "10G", "mem": 2, "name": "t2_VM1", "vcpu": 4, "vmif": "t2VM1if1"}]}
ok: [localhost] => (item=[{u'route': [{u'ip': u'10.1.11.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.1.11.1', u'bridge_name': u't2br1', u'dns': [{u'dnsif': u't2s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't2s1_dnsbrif'}], u'ns_name': u't2ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.11.2/24', u'tenant_ns_ip': u'10.1.11.1/24', u'tenant_ns_if': u't2ns1if', u'tenant_sub_if': u't2s1if', u'tenant_ns_name': u't2'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.1.11.2', u'dsport': 4789, u'dev': u't2s1if', u'tenant_route_ip': u'192.168.2.2', u'remote_route': u'10.2.11.0/24', u'subnet_route': u'10.1.11.0/24', u'v_name': u'vxlan_t2s1', u'id': 42, u'remote_ip': u'10.2.11.2'}]}, {u'mem': 4, u'name': u't2_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't2br1if2', u'vmif': u't2VM2if1'}]) => {"ansible_loop_var": "item", "changed": false, "create": 0, "item": [{"bridge_name": "t2br1", "default_route_ip": "10.1.11.1", "dns": [{"brif": "t2s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t2s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns1", "route": [{"if": "p1", "ip": "10.1.11.1/24", "ns_if": "t2if", "ns_name": "t2"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t2ns1if", "tenant_ns_ip": "10.1.11.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s1if", "tenant_sub_ip": "10.1.11.2/24"}], "vxlan": [{"dev": "t2s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.11.2", "remote_ip": "10.2.11.2", "remote_route": "10.2.11.0/24", "subnet_route": "10.1.11.0/24", "tenant_route_ip": "192.168.2.2", "v_name": "vxlan_t2s1"}]}, {"brif": "t2br1if2", "disk": "10G", "mem": 4, "name": "t2_VM2", "vcpu": 2, "vmif": "t2VM2if1"}]}
ok: [localhost] => (item=[{u'route': [{u'ip': u'10.1.12.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.1.12.1', u'bridge_name': u't2br2', u'dns': [{u'dnsif': u't2s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't2s2_dnsbrif'}], u'ns_name': u't2ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.12.2/24', u'tenant_ns_ip': u'10.1.12.1/24', u'tenant_ns_if': u't2ns2if', u'tenant_sub_if': u't2s2if', u'tenant_ns_name': u't2'}], u'subnet_ip': u'2.2.2.0/24', u'vxlan': [{u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}, {u'mem': 3, u'name': u't2_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't2br2if1', u'vmif': u't2VM3if1'}]) => {"ansible_loop_var": "item", "changed": false, "create": 0, "item": [{"bridge_name": "t2br2", "default_route_ip": "10.1.12.1", "dns": [{"brif": "t2s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t2s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns2", "route": [{"if": "p1", "ip": "10.1.12.1/24", "ns_if": "t2if", "ns_name": "t2"}], "subnet_ip": "2.2.2.0/24", "tenant_ns": [{"tenant_ns_if": "t2ns2if", "tenant_ns_ip": "10.1.12.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s2if", "tenant_sub_ip": "10.1.12.2/24"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, {"brif": "t2br2if1", "disk": "10G", "mem": 3, "name": "t2_VM3", "vcpu": 2, "vmif": "t2VM3if1"}]}

TASK [Start VM] *********************************************************************************************************************************************
ok: [localhost] => (item=[{u'route': [{u'ip': u'10.1.11.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.1.11.1', u'bridge_name': u't2br1', u'dns': [{u'dnsif': u't2s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't2s1_dnsbrif'}], u'ns_name': u't2ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.11.2/24', u'tenant_ns_ip': u'10.1.11.1/24', u'tenant_ns_if': u't2ns1if', u'tenant_sub_if': u't2s1if', u'tenant_ns_name': u't2'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.1.11.2', u'dsport': 4789, u'dev': u't2s1if', u'tenant_route_ip': u'192.168.2.2', u'remote_route': u'10.2.11.0/24', u'subnet_route': u'10.1.11.0/24', u'v_name': u'vxlan_t2s1', u'id': 42, u'remote_ip': u'10.2.11.2'}]}, {u'mem': 2, u'name': u't2_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't2br1if1', u'vmif': u't2VM1if1'}]) => {"ansible_loop_var": "item", "changed": false, "item": [{"bridge_name": "t2br1", "default_route_ip": "10.1.11.1", "dns": [{"brif": "t2s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t2s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns1", "route": [{"if": "p1", "ip": "10.1.11.1/24", "ns_if": "t2if", "ns_name": "t2"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t2ns1if", "tenant_ns_ip": "10.1.11.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s1if", "tenant_sub_ip": "10.1.11.2/24"}], "vxlan": [{"dev": "t2s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.11.2", "remote_ip": "10.2.11.2", "remote_route": "10.2.11.0/24", "subnet_route": "10.1.11.0/24", "tenant_route_ip": "192.168.2.2", "v_name": "vxlan_t2s1"}]}, {"brif": "t2br1if1", "disk": "10G", "mem": 2, "name": "t2_VM1", "vcpu": 4, "vmif": "t2VM1if1"}]}
ok: [localhost] => (item=[{u'route': [{u'ip': u'10.1.11.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.1.11.1', u'bridge_name': u't2br1', u'dns': [{u'dnsif': u't2s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't2s1_dnsbrif'}], u'ns_name': u't2ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.11.2/24', u'tenant_ns_ip': u'10.1.11.1/24', u'tenant_ns_if': u't2ns1if', u'tenant_sub_if': u't2s1if', u'tenant_ns_name': u't2'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.1.11.2', u'dsport': 4789, u'dev': u't2s1if', u'tenant_route_ip': u'192.168.2.2', u'remote_route': u'10.2.11.0/24', u'subnet_route': u'10.1.11.0/24', u'v_name': u'vxlan_t2s1', u'id': 42, u'remote_ip': u'10.2.11.2'}]}, {u'mem': 4, u'name': u't2_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't2br1if2', u'vmif': u't2VM2if1'}]) => {"ansible_loop_var": "item", "changed": false, "item": [{"bridge_name": "t2br1", "default_route_ip": "10.1.11.1", "dns": [{"brif": "t2s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t2s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns1", "route": [{"if": "p1", "ip": "10.1.11.1/24", "ns_if": "t2if", "ns_name": "t2"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t2ns1if", "tenant_ns_ip": "10.1.11.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s1if", "tenant_sub_ip": "10.1.11.2/24"}], "vxlan": [{"dev": "t2s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.11.2", "remote_ip": "10.2.11.2", "remote_route": "10.2.11.0/24", "subnet_route": "10.1.11.0/24", "tenant_route_ip": "192.168.2.2", "v_name": "vxlan_t2s1"}]}, {"brif": "t2br1if2", "disk": "10G", "mem": 4, "name": "t2_VM2", "vcpu": 2, "vmif": "t2VM2if1"}]}
ok: [localhost] => (item=[{u'route': [{u'ip': u'10.1.12.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.1.12.1', u'bridge_name': u't2br2', u'dns': [{u'dnsif': u't2s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't2s2_dnsbrif'}], u'ns_name': u't2ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.12.2/24', u'tenant_ns_ip': u'10.1.12.1/24', u'tenant_ns_if': u't2ns2if', u'tenant_sub_if': u't2s2if', u'tenant_ns_name': u't2'}], u'subnet_ip': u'2.2.2.0/24', u'vxlan': [{u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}, {u'mem': 3, u'name': u't2_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't2br2if1', u'vmif': u't2VM3if1'}]) => {"ansible_loop_var": "item", "changed": false, "item": [{"bridge_name": "t2br2", "default_route_ip": "10.1.12.1", "dns": [{"brif": "t2s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t2s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns2", "route": [{"if": "p1", "ip": "10.1.12.1/24", "ns_if": "t2if", "ns_name": "t2"}], "subnet_ip": "2.2.2.0/24", "tenant_ns": [{"tenant_ns_if": "t2ns2if", "tenant_ns_ip": "10.1.12.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s2if", "tenant_sub_ip": "10.1.12.2/24"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, {"brif": "t2br2if1", "disk": "10G", "mem": 3, "name": "t2_VM3", "vcpu": 2, "vmif": "t2VM3if1"}]}

TASK [Attach VM interface] **********************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.11.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.1.11.1', u'bridge_name': u't2br1', u'dns': [{u'dnsif': u't2s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't2s1_dnsbrif'}], u'ns_name': u't2ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.11.2/24', u'tenant_ns_ip': u'10.1.11.1/24', u'tenant_ns_if': u't2ns1if', u'tenant_sub_if': u't2s1if', u'tenant_ns_name': u't2'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.1.11.2', u'dsport': 4789, u'dev': u't2s1if', u'tenant_route_ip': u'192.168.2.2', u'remote_route': u'10.2.11.0/24', u'subnet_route': u'10.1.11.0/24', u'v_name': u'vxlan_t2s1', u'id': 42, u'remote_ip': u'10.2.11.2'}]}, {u'mem': 2, u'name': u't2_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't2br1if1', u'vmif': u't2VM1if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "virsh domiflist \"t2_VM1\" | grep -w 't2VM1if1' ; if [ $? -ne 0 ] ; then virsh attach-interface \"t2_VM1\" direct \"t2VM1if1\" --live --persistent ; fi\n", "delta": "0:00:00.319132", "end": "2019-11-18 07:46:42.442768", "item": [{"bridge_name": "t2br1", "default_route_ip": "10.1.11.1", "dns": [{"brif": "t2s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t2s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns1", "route": [{"if": "p1", "ip": "10.1.11.1/24", "ns_if": "t2if", "ns_name": "t2"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t2ns1if", "tenant_ns_ip": "10.1.11.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s1if", "tenant_sub_ip": "10.1.11.2/24"}], "vxlan": [{"dev": "t2s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.11.2", "remote_ip": "10.2.11.2", "remote_route": "10.2.11.0/24", "subnet_route": "10.1.11.0/24", "tenant_route_ip": "192.168.2.2", "v_name": "vxlan_t2s1"}]}, {"brif": "t2br1if1", "disk": "10G", "mem": 2, "name": "t2_VM1", "vcpu": 4, "vmif": "t2VM1if1"}], "rc": 0, "start": "2019-11-18 07:46:42.123636", "stderr": "", "stderr_lines": [], "stdout": "Interface attached successfully", "stdout_lines": ["Interface attached successfully"]}
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.11.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.1.11.1', u'bridge_name': u't2br1', u'dns': [{u'dnsif': u't2s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't2s1_dnsbrif'}], u'ns_name': u't2ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.11.2/24', u'tenant_ns_ip': u'10.1.11.1/24', u'tenant_ns_if': u't2ns1if', u'tenant_sub_if': u't2s1if', u'tenant_ns_name': u't2'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.1.11.2', u'dsport': 4789, u'dev': u't2s1if', u'tenant_route_ip': u'192.168.2.2', u'remote_route': u'10.2.11.0/24', u'subnet_route': u'10.1.11.0/24', u'v_name': u'vxlan_t2s1', u'id': 42, u'remote_ip': u'10.2.11.2'}]}, {u'mem': 4, u'name': u't2_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't2br1if2', u'vmif': u't2VM2if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "virsh domiflist \"t2_VM2\" | grep -w 't2VM2if1' ; if [ $? -ne 0 ] ; then virsh attach-interface \"t2_VM2\" direct \"t2VM2if1\" --live --persistent ; fi\n", "delta": "0:00:00.234019", "end": "2019-11-18 07:46:42.827973", "item": [{"bridge_name": "t2br1", "default_route_ip": "10.1.11.1", "dns": [{"brif": "t2s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t2s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns1", "route": [{"if": "p1", "ip": "10.1.11.1/24", "ns_if": "t2if", "ns_name": "t2"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t2ns1if", "tenant_ns_ip": "10.1.11.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s1if", "tenant_sub_ip": "10.1.11.2/24"}], "vxlan": [{"dev": "t2s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.11.2", "remote_ip": "10.2.11.2", "remote_route": "10.2.11.0/24", "subnet_route": "10.1.11.0/24", "tenant_route_ip": "192.168.2.2", "v_name": "vxlan_t2s1"}]}, {"brif": "t2br1if2", "disk": "10G", "mem": 4, "name": "t2_VM2", "vcpu": 2, "vmif": "t2VM2if1"}], "rc": 0, "start": "2019-11-18 07:46:42.593954", "stderr": "", "stderr_lines": [], "stdout": "Interface attached successfully", "stdout_lines": ["Interface attached successfully"]}
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.12.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.1.12.1', u'bridge_name': u't2br2', u'dns': [{u'dnsif': u't2s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't2s2_dnsbrif'}], u'ns_name': u't2ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.12.2/24', u'tenant_ns_ip': u'10.1.12.1/24', u'tenant_ns_if': u't2ns2if', u'tenant_sub_if': u't2s2if', u'tenant_ns_name': u't2'}], u'subnet_ip': u'2.2.2.0/24', u'vxlan': [{u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}, {u'mem': 3, u'name': u't2_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't2br2if1', u'vmif': u't2VM3if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "virsh domiflist \"t2_VM3\" | grep -w 't2VM3if1' ; if [ $? -ne 0 ] ; then virsh attach-interface \"t2_VM3\" direct \"t2VM3if1\" --live --persistent ; fi\n", "delta": "0:00:00.240228", "end": "2019-11-18 07:46:43.212164", "item": [{"bridge_name": "t2br2", "default_route_ip": "10.1.12.1", "dns": [{"brif": "t2s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t2s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns2", "route": [{"if": "p1", "ip": "10.1.12.1/24", "ns_if": "t2if", "ns_name": "t2"}], "subnet_ip": "2.2.2.0/24", "tenant_ns": [{"tenant_ns_if": "t2ns2if", "tenant_ns_ip": "10.1.12.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s2if", "tenant_sub_ip": "10.1.12.2/24"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, {"brif": "t2br2if1", "disk": "10G", "mem": 3, "name": "t2_VM3", "vcpu": 2, "vmif": "t2VM3if1"}], "rc": 0, "start": "2019-11-18 07:46:42.971936", "stderr": "", "stderr_lines": [], "stdout": "Interface attached successfully", "stdout_lines": ["Interface attached successfully"]}

TASK [Attach VM interent interface] *************************************************************************************************************************
changed: [localhost] => (item=[{u'subnet_addr': u'1.1.1.0/24'}, {u'mem': 2, u'vcpu': 4, u'disk': u'10G', u'name': u'VM1', u'internet_access': True}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "virsh domiflist 't2_VM1' | grep -w 'default' ; if [ $? -ne 0 ] ; then virsh attach-interface --domain 't2_VM1' --type network --source default --live --config ; fi\n", "delta": "0:00:00.249053", "end": "2019-11-18 07:46:43.647917", "item": [{"subnet_addr": "1.1.1.0/24"}, {"disk": "10G", "internet_access": true, "mem": 2, "name": "VM1", "vcpu": 4}], "rc": 0, "start": "2019-11-18 07:46:43.398864", "stderr": "", "stderr_lines": [], "stdout": "Interface attached successfully", "stdout_lines": ["Interface attached successfully"]}
skipping: [localhost] => (item=[{u'subnet_addr': u'1.1.1.0/24'}, {u'mem': 4, u'vcpu': 2, u'disk': u'10G', u'name': u'VM2', u'internet_access': False}])  => {"ansible_loop_var": "item", "changed": false, "item": [{"subnet_addr": "1.1.1.0/24"}, {"disk": "10G", "internet_access": false, "mem": 4, "name": "VM2", "vcpu": 2}], "skip_reason": "Conditional result was False"}
changed: [localhost] => (item=[{u'subnet_addr': u'2.2.2.0/24'}, {u'mem': 3, u'vcpu': 2, u'disk': u'10G', u'name': u'VM3', u'internet_access': True}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "virsh domiflist 't2_VM3' | grep -w 'default' ; if [ $? -ne 0 ] ; then virsh attach-interface --domain 't2_VM3' --type network --source default --live --config ; fi\n", "delta": "0:00:00.229415", "end": "2019-11-18 07:46:44.043460", "item": [{"subnet_addr": "2.2.2.0/24"}, {"disk": "10G", "internet_access": true, "mem": 3, "name": "VM3", "vcpu": 2}], "rc": 0, "start": "2019-11-18 07:46:43.814045", "stderr": "", "stderr_lines": [], "stdout": "Interface attached successfully", "stdout_lines": ["Interface attached successfully"]}

PLAY RECAP **************************************************************************************************************************************************
localhost                  : ok=8    changed=4    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0   

Using /etc/ansible/ansible.cfg as config file

PLAY [worker] ***********************************************************************************************************************************************

TASK [Copy VM image] ****************************************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.11.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.2.11.1', u'bridge_name': u't2br1', u'dns': [{u'dnsif': u't2s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't2s1_dnsbrif'}], u'ns_name': u't2ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.11.2/24', u'tenant_ns_ip': u'10.2.11.1/24', u'tenant_ns_if': u't2ns1if', u'tenant_sub_if': u't2s1if', u'tenant_ns_name': u't2'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.2.11.2', u'dsport': 4789, u'dev': u't2s1if', u'tenant_route_ip': u'192.168.130.2', u'remote_route': u'10.1.11.0/24', u'subnet_route': u'10.2.11.0/24', u'v_name': u'vxlan_t2s1', u'id': 42, u'remote_ip': u'10.1.11.2'}]}, {u'mem': 2, u'name': u't2_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't2br1if1', u'vmif': u't2VM4if1'}]) => {"ansible_loop_var": "item", "changed": true, "checksum": "f8b2ffa2bf201c84196c582f2dec0d33a1eb4b42", "dest": "/var/lib/libvirt/images/t2_VM4.qcow2", "gid": 0, "group": "root", "item": [{"bridge_name": "t2br1", "default_route_ip": "10.2.11.1", "dns": [{"brif": "t2s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t2s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns1", "route": [{"if": "p1", "ip": "10.2.11.1/24", "ns_if": "t2if", "ns_name": "t2"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t2ns1if", "tenant_ns_ip": "10.2.11.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s1if", "tenant_sub_ip": "10.2.11.2/24"}], "vxlan": [{"dev": "t2s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.11.2", "remote_ip": "10.1.11.2", "remote_route": "10.1.11.0/24", "subnet_route": "10.2.11.0/24", "tenant_route_ip": "192.168.130.2", "v_name": "vxlan_t2s1"}]}, {"brif": "t2br1if1", "disk": "10G", "mem": 2, "name": "t2_VM4", "vcpu": 4, "vmif": "t2VM4if1"}], "md5sum": "e6d5d524b68797ddd748ba1475985d34", "mode": "0644", "owner": "root", "size": 10739318784, "src": "/root/mainVM.qcow2", "state": "file", "uid": 0}

TASK [Get list of running VMs] ******************************************************************************************************************************
ok: [99.99.99.2] => {"changed": false, "cmd": ["virsh", "list", "--name"], "delta": "0:00:05.272407", "end": "2019-11-18 07:48:19.478535", "rc": 0, "start": "2019-11-18 07:48:14.206128", "stderr": "", "stderr_lines": [], "stdout": "t1_VM4\nt1_VM1", "stdout_lines": ["t1_VM4", "t1_VM1"]}

TASK [Define VM] ********************************************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.11.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.2.11.1', u'bridge_name': u't2br1', u'dns': [{u'dnsif': u't2s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't2s1_dnsbrif'}], u'ns_name': u't2ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.11.2/24', u'tenant_ns_ip': u'10.2.11.1/24', u'tenant_ns_if': u't2ns1if', u'tenant_sub_if': u't2s1if', u'tenant_ns_name': u't2'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.2.11.2', u'dsport': 4789, u'dev': u't2s1if', u'tenant_route_ip': u'192.168.130.2', u'remote_route': u'10.1.11.0/24', u'subnet_route': u'10.2.11.0/24', u'v_name': u'vxlan_t2s1', u'id': 42, u'remote_ip': u'10.1.11.2'}]}, {u'mem': 2, u'name': u't2_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't2br1if1', u'vmif': u't2VM4if1'}]) => {"ansible_loop_var": "item", "changed": true, "created": "t2_VM4", "item": [{"bridge_name": "t2br1", "default_route_ip": "10.2.11.1", "dns": [{"brif": "t2s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t2s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns1", "route": [{"if": "p1", "ip": "10.2.11.1/24", "ns_if": "t2if", "ns_name": "t2"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t2ns1if", "tenant_ns_ip": "10.2.11.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s1if", "tenant_sub_ip": "10.2.11.2/24"}], "vxlan": [{"dev": "t2s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.11.2", "remote_ip": "10.1.11.2", "remote_route": "10.1.11.0/24", "subnet_route": "10.2.11.0/24", "tenant_route_ip": "192.168.130.2", "v_name": "vxlan_t2s1"}]}, {"brif": "t2br1if1", "disk": "10G", "mem": 2, "name": "t2_VM4", "vcpu": 4, "vmif": "t2VM4if1"}], "warnings": ["'xml' is given - ignoring 'name'"]}

TASK [Create VM] ********************************************************************************************************************************************
ok: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.11.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.2.11.1', u'bridge_name': u't2br1', u'dns': [{u'dnsif': u't2s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't2s1_dnsbrif'}], u'ns_name': u't2ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.11.2/24', u'tenant_ns_ip': u'10.2.11.1/24', u'tenant_ns_if': u't2ns1if', u'tenant_sub_if': u't2s1if', u'tenant_ns_name': u't2'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.2.11.2', u'dsport': 4789, u'dev': u't2s1if', u'tenant_route_ip': u'192.168.130.2', u'remote_route': u'10.1.11.0/24', u'subnet_route': u'10.2.11.0/24', u'v_name': u'vxlan_t2s1', u'id': 42, u'remote_ip': u'10.1.11.2'}]}, {u'mem': 2, u'name': u't2_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't2br1if1', u'vmif': u't2VM4if1'}]) => {"ansible_loop_var": "item", "changed": false, "create": 0, "item": [{"bridge_name": "t2br1", "default_route_ip": "10.2.11.1", "dns": [{"brif": "t2s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t2s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns1", "route": [{"if": "p1", "ip": "10.2.11.1/24", "ns_if": "t2if", "ns_name": "t2"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t2ns1if", "tenant_ns_ip": "10.2.11.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s1if", "tenant_sub_ip": "10.2.11.2/24"}], "vxlan": [{"dev": "t2s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.11.2", "remote_ip": "10.1.11.2", "remote_route": "10.1.11.0/24", "subnet_route": "10.2.11.0/24", "tenant_route_ip": "192.168.130.2", "v_name": "vxlan_t2s1"}]}, {"brif": "t2br1if1", "disk": "10G", "mem": 2, "name": "t2_VM4", "vcpu": 4, "vmif": "t2VM4if1"}]}

TASK [Start VM] *********************************************************************************************************************************************
ok: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.11.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.2.11.1', u'bridge_name': u't2br1', u'dns': [{u'dnsif': u't2s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't2s1_dnsbrif'}], u'ns_name': u't2ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.11.2/24', u'tenant_ns_ip': u'10.2.11.1/24', u'tenant_ns_if': u't2ns1if', u'tenant_sub_if': u't2s1if', u'tenant_ns_name': u't2'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.2.11.2', u'dsport': 4789, u'dev': u't2s1if', u'tenant_route_ip': u'192.168.130.2', u'remote_route': u'10.1.11.0/24', u'subnet_route': u'10.2.11.0/24', u'v_name': u'vxlan_t2s1', u'id': 42, u'remote_ip': u'10.1.11.2'}]}, {u'mem': 2, u'name': u't2_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't2br1if1', u'vmif': u't2VM4if1'}]) => {"ansible_loop_var": "item", "changed": false, "item": [{"bridge_name": "t2br1", "default_route_ip": "10.2.11.1", "dns": [{"brif": "t2s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t2s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns1", "route": [{"if": "p1", "ip": "10.2.11.1/24", "ns_if": "t2if", "ns_name": "t2"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t2ns1if", "tenant_ns_ip": "10.2.11.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s1if", "tenant_sub_ip": "10.2.11.2/24"}], "vxlan": [{"dev": "t2s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.11.2", "remote_ip": "10.1.11.2", "remote_route": "10.1.11.0/24", "subnet_route": "10.2.11.0/24", "tenant_route_ip": "192.168.130.2", "v_name": "vxlan_t2s1"}]}, {"brif": "t2br1if1", "disk": "10G", "mem": 2, "name": "t2_VM4", "vcpu": 4, "vmif": "t2VM4if1"}]}

TASK [Attach VM interface] **********************************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.11.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.2.11.1', u'bridge_name': u't2br1', u'dns': [{u'dnsif': u't2s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't2s1_dnsbrif'}], u'ns_name': u't2ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.11.2/24', u'tenant_ns_ip': u'10.2.11.1/24', u'tenant_ns_if': u't2ns1if', u'tenant_sub_if': u't2s1if', u'tenant_ns_name': u't2'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.2.11.2', u'dsport': 4789, u'dev': u't2s1if', u'tenant_route_ip': u'192.168.130.2', u'remote_route': u'10.1.11.0/24', u'subnet_route': u'10.2.11.0/24', u'v_name': u'vxlan_t2s1', u'id': 42, u'remote_ip': u'10.1.11.2'}]}, {u'mem': 2, u'name': u't2_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't2br1if1', u'vmif': u't2VM4if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "virsh domiflist \"t2_VM4\" | grep -w 't2VM4if1' ; if [ $? -ne 0 ] ; then virsh attach-interface \"t2_VM4\" direct \"t2VM4if1\" --live --persistent ; fi\n", "delta": "0:00:00.265294", "end": "2019-11-18 07:48:37.090925", "item": [{"bridge_name": "t2br1", "default_route_ip": "10.2.11.1", "dns": [{"brif": "t2s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t2s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns1", "route": [{"if": "p1", "ip": "10.2.11.1/24", "ns_if": "t2if", "ns_name": "t2"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t2ns1if", "tenant_ns_ip": "10.2.11.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s1if", "tenant_sub_ip": "10.2.11.2/24"}], "vxlan": [{"dev": "t2s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.11.2", "remote_ip": "10.1.11.2", "remote_route": "10.1.11.0/24", "subnet_route": "10.2.11.0/24", "tenant_route_ip": "192.168.130.2", "v_name": "vxlan_t2s1"}]}, {"brif": "t2br1if1", "disk": "10G", "mem": 2, "name": "t2_VM4", "vcpu": 4, "vmif": "t2VM4if1"}], "rc": 0, "start": "2019-11-18 07:48:36.825631", "stderr": "", "stderr_lines": [], "stdout": "Interface attached successfully", "stdout_lines": ["Interface attached successfully"]}

TASK [Attach VM interent interface] *************************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'subnet_addr': u'1.1.1.0/24'}, {u'mem': 2, u'vcpu': 4, u'disk': u'10G', u'name': u'VM4', u'internet_access': True}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "virsh domiflist 't2_VM4' | grep -w 'default' ; if [ $? -ne 0 ] ; then virsh attach-interface --domain 't2_VM4' --type network --source default --live --config ; fi\n", "delta": "0:00:00.245521", "end": "2019-11-18 07:48:37.639148", "item": [{"subnet_addr": "1.1.1.0/24"}, {"disk": "10G", "internet_access": true, "mem": 2, "name": "VM4", "vcpu": 4}], "rc": 0, "start": "2019-11-18 07:48:37.393627", "stderr": "", "stderr_lines": [], "stdout": "Interface attached successfully", "stdout_lines": ["Interface attached successfully"]}

PLAY RECAP **************************************************************************************************************************************************
99.99.99.2                 : ok=7    changed=4    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0   

INFO:root: 07:50:14.698195 The subnet 1.1.1.0/24 is present in Cloud 1
INFO:root: 07:50:14.698313 The subnet 1.1.1.0/24 is present in Cloud 2
INFO:root: 07:50:14.698353 The VM VM1 is present in Cloud 1
INFO:root: 07:50:14.698385 The VM VM4 is present in Cloud 2
INFO:root: 07:50:14.698432 The subnet 1.1.1.0/24 is present in destination cloud
INFO:root: 07:50:14.698468 The subnet 1.1.1.0/24 is present in destination cloud
INFO:root: 08:21:08.909831 Printing the yaml input file
INFO:root: 08:21:08.910351 {'C1': [{'subnet_addr': '1.1.1.0/24', 'VM': [{'name': 'VM1', 'disk': '10G', 'mem': 2, 'vcpu': 4, 'internet_access': True}, {'name': 'VM2', 'disk': '10G', 'mem': 4, 'vcpu': 2, 'internet_access': False}]}, {'subnet_addr': '2.2.2.0/24', 'VM': [{'name': 'VM3', 'disk': '10G', 'mem': 3, 'vcpu': 2, 'internet_access': True}]}], 'C2': [{'subnet_addr': '1.1.1.0/24', 'VM': [{'name': 'VM4', 'disk': '10G', 'mem': 2, 'vcpu': 4, 'internet_access': True}]}]}
INFO:root: 08:21:08.910504 Provided subnet in C1: 1.1.1.0/24 is valid
INFO:root: 08:21:08.910557 Provided subnet in C1: 2.2.2.0/24 is valid
INFO:root: 08:21:08.910601 Provided subnet in C2: 1.1.1.0/24 is valid
Using /etc/ansible/ansible.cfg as config file

PLAY [main] *************************************************************************************************************************************************

TASK [Create Tenant Namespace] ******************************************************************************************************************************
changed: [localhost] => (item={u'default_route_ip': u'192.168.3.1', u'name': u't3', u'pns_ip': u'192.168.3.1/24', u'tenant_if': u't3if', u'tenant_ip': u'192.168.3.2/24', u'pns_if': u't3pns_if'}) => {"ansible_loop_var": "item", "changed": true, "cmd": ["ip", "netns", "add", "t3"], "delta": "0:00:00.057434", "end": "2019-11-18 08:21:10.138033", "item": {"default_route_ip": "192.168.3.1", "name": "t3", "pns_if": "t3pns_if", "pns_ip": "192.168.3.1/24", "tenant_if": "t3if", "tenant_ip": "192.168.3.2/24"}, "rc": 0, "start": "2019-11-18 08:21:10.080599", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Create Subnet Namespace] ******************************************************************************************************************************
changed: [localhost] => (item={u'route': [{u'ip': u'10.1.21.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.1.21.1', u'bridge_name': u't3br1', u'dns': [{u'dnsif': u't3s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't3s1_dnsbrif'}], u'ns_name': u't3ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.21.2/24', u'tenant_ns_ip': u'10.1.21.1/24', u'tenant_ns_if': u't3ns1if', u'tenant_ns_name': u't3', u'tenant_sub_if': u't3s1if'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't3_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't3br1if1', u'vmif': u't3VM1if1'}, {u'mem': 4, u'name': u't3_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't3br1if2', u'vmif': u't3VM2if1'}], u'vxlan': [{u'local_ip': u'10.1.21.2', u'tenant_route_ip': u'192.168.3.2', u'dsport': 4789, u'dev': u't3s1if', u'subnet_route': u'10.1.21.0/24', u'remote_route': u'10.2.21.0/24', u'v_name': u'vxlan_t3s1', u'id': 42, u'remote_ip': u'10.2.21.2'}]}) => {"ansible_loop_var": "item", "changed": true, "cmd": ["ip", "netns", "add", "t3ns1"], "delta": "0:00:00.053652", "end": "2019-11-18 08:21:10.483315", "item": {"bridge_name": "t3br1", "default_route_ip": "10.1.21.1", "dns": [{"brif": "t3s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t3s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t3ns1", "route": [{"if": "p1", "ip": "10.1.21.1/24", "ns_if": "t3if", "ns_name": "t3"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t3ns1if", "tenant_ns_ip": "10.1.21.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s1if", "tenant_sub_ip": "10.1.21.2/24"}], "vms": [{"brif": "t3br1if1", "disk": "10G", "mem": 2, "name": "t3_VM1", "vcpu": 4, "vmif": "t3VM1if1"}, {"brif": "t3br1if2", "disk": "10G", "mem": 4, "name": "t3_VM2", "vcpu": 2, "vmif": "t3VM2if1"}], "vxlan": [{"dev": "t3s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.21.2", "remote_ip": "10.2.21.2", "remote_route": "10.2.21.0/24", "subnet_route": "10.1.21.0/24", "tenant_route_ip": "192.168.3.2", "v_name": "vxlan_t3s1"}]}, "rc": 0, "start": "2019-11-18 08:21:10.429663", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}
changed: [localhost] => (item={u'route': [{u'ip': u'10.1.22.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.1.22.1', u'bridge_name': u't3br2', u'dns': [{u'dnsif': u't3s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't3s2_dnsbrif'}], u'ns_name': u't3ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.22.2/24', u'tenant_ns_ip': u'10.1.22.1/24', u'tenant_ns_if': u't3ns2if', u'tenant_ns_name': u't3', u'tenant_sub_if': u't3s2if'}], u'subnet_ip': u'2.2.2.0/24', u'vms': [{u'mem': 3, u'name': u't3_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't3br2if1', u'vmif': u't3VM3if1'}], u'vxlan': [{u'local_ip': [], u'tenant_route_ip': [], u'dsport': [], u'dev': [], u'subnet_route': [], u'remote_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}) => {"ansible_loop_var": "item", "changed": true, "cmd": ["ip", "netns", "add", "t3ns2"], "delta": "0:00:00.060625", "end": "2019-11-18 08:21:10.790936", "item": {"bridge_name": "t3br2", "default_route_ip": "10.1.22.1", "dns": [{"brif": "t3s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t3s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t3ns2", "route": [{"if": "p1", "ip": "10.1.22.1/24", "ns_if": "t3if", "ns_name": "t3"}], "subnet_ip": "2.2.2.0/24", "tenant_ns": [{"tenant_ns_if": "t3ns2if", "tenant_ns_ip": "10.1.22.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s2if", "tenant_sub_ip": "10.1.22.2/24"}], "vms": [{"brif": "t3br2if1", "disk": "10G", "mem": 3, "name": "t3_VM3", "vcpu": 2, "vmif": "t3VM3if1"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, "rc": 0, "start": "2019-11-18 08:21:10.730311", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Create Tenant VETH pairs] *****************************************************************************************************************************
changed: [localhost] => (item={u'default_route_ip': u'192.168.3.1', u'name': u't3', u'pns_ip': u'192.168.3.1/24', u'tenant_if': u't3if', u'tenant_ip': u'192.168.3.2/24', u'pns_if': u't3pns_if'}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip link show \"t3if\" ; if [ $? -ne 0 ] ; then ip link add \"t3if\" type veth peer name \"t3pns_if\" ; fi\n", "delta": "0:00:00.014674", "end": "2019-11-18 08:21:11.058778", "item": {"default_route_ip": "192.168.3.1", "name": "t3", "pns_if": "t3pns_if", "pns_ip": "192.168.3.1/24", "tenant_if": "t3if", "tenant_ip": "192.168.3.2/24"}, "rc": 0, "start": "2019-11-18 08:21:11.044104", "stderr": "Device \"t3if\" does not exist.", "stderr_lines": ["Device \"t3if\" does not exist."], "stdout": "", "stdout_lines": []}

TASK [Attach Tenant VETH Pairs] *****************************************************************************************************************************
changed: [localhost] => (item={u'default_route_ip': u'192.168.3.1', u'name': u't3', u'pns_ip': u'192.168.3.1/24', u'tenant_if': u't3if', u'tenant_ip': u'192.168.3.2/24', u'pns_if': u't3pns_if'}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec pns ip link show \"t3pns_if\" ; if [ $? -ne 0 ] ; then ip link set \"t3pns_if\" netns pns ; fi\nip netns exec \"t3\" ip link show \"t3if\" ; if [ $? -ne 0 ] ; then ip link set \"t3if\" netns \"t3\" ; fi\nip netns exec pns ip link set dev \"t3pns_if\" up\nip netns exec \"t3\" ip link set dev \"t3if\" up\n", "delta": "0:00:00.196573", "end": "2019-11-18 08:21:11.517202", "item": {"default_route_ip": "192.168.3.1", "name": "t3", "pns_if": "t3pns_if", "pns_ip": "192.168.3.1/24", "tenant_if": "t3if", "tenant_ip": "192.168.3.2/24"}, "rc": 0, "start": "2019-11-18 08:21:11.320629", "stderr": "Device \"t3pns_if\" does not exist.\nDevice \"t3if\" does not exist.", "stderr_lines": ["Device \"t3pns_if\" does not exist.", "Device \"t3if\" does not exist."], "stdout": "", "stdout_lines": []}

TASK [Add IP addresses to Tenant VETH Pairs] ****************************************************************************************************************
changed: [localhost] => (item={u'default_route_ip': u'192.168.3.1', u'name': u't3', u'pns_ip': u'192.168.3.1/24', u'tenant_if': u't3if', u'tenant_ip': u'192.168.3.2/24', u'pns_if': u't3pns_if'}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec pns ip addr show \"t3pns_if\" | awk 'FNR==3{ print $2 }' | grep -w '^192.168.3.1/24' ; if [ $? -ne 0 ] ; then ip netns exec pns ip addr add \"192.168.3.1/24\" dev \"t3pns_if\" ; fi\nip netns exec \"t3\" ip addr show \"t3if\" | awk 'FNR==3{ print $2 }' | grep -w '^192.168.3.2/24' ; if [ $? -ne 0 ] ; then ip netns exec \"t3\" ip addr add \"192.168.3.2/24\" dev \"t3if\" ; fi\n", "delta": "0:00:00.167011", "end": "2019-11-18 08:21:11.957433", "item": {"default_route_ip": "192.168.3.1", "name": "t3", "pns_if": "t3pns_if", "pns_ip": "192.168.3.1/24", "tenant_if": "t3if", "tenant_ip": "192.168.3.2/24"}, "rc": 0, "start": "2019-11-18 08:21:11.790422", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Create Namespace VETH Pairs] **************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.21.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.1.21.1', u'bridge_name': u't3br1', u'dns': [{u'dnsif': u't3s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't3s1_dnsbrif'}], u'ns_name': u't3ns1', u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't3_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't3br1if1', u'vmif': u't3VM1if1'}, {u'mem': 4, u'name': u't3_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't3br1if2', u'vmif': u't3VM2if1'}], u'vxlan': [{u'local_ip': u'10.1.21.2', u'dsport': 4789, u'dev': u't3s1if', u'tenant_route_ip': u'192.168.3.2', u'remote_route': u'10.2.21.0/24', u'subnet_route': u'10.1.21.0/24', u'v_name': u'vxlan_t3s1', u'id': 42, u'remote_ip': u'10.2.21.2'}]}, {u'tenant_sub_ip': u'10.1.21.2/24', u'tenant_ns_ip': u'10.1.21.1/24', u'tenant_ns_if': u't3ns1if', u'tenant_sub_if': u't3s1if', u'tenant_ns_name': u't3'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip link show \"t3ns1if\" ; if [ $? -ne 0 ] ; then ip link add \"t3ns1if\" type veth peer name \"t3s1if\" ; fi\n", "delta": "0:00:00.010263", "end": "2019-11-18 08:21:12.266949", "item": [{"bridge_name": "t3br1", "default_route_ip": "10.1.21.1", "dns": [{"brif": "t3s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t3s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t3ns1", "route": [{"if": "p1", "ip": "10.1.21.1/24", "ns_if": "t3if", "ns_name": "t3"}], "subnet_ip": "1.1.1.0/24", "vms": [{"brif": "t3br1if1", "disk": "10G", "mem": 2, "name": "t3_VM1", "vcpu": 4, "vmif": "t3VM1if1"}, {"brif": "t3br1if2", "disk": "10G", "mem": 4, "name": "t3_VM2", "vcpu": 2, "vmif": "t3VM2if1"}], "vxlan": [{"dev": "t3s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.21.2", "remote_ip": "10.2.21.2", "remote_route": "10.2.21.0/24", "subnet_route": "10.1.21.0/24", "tenant_route_ip": "192.168.3.2", "v_name": "vxlan_t3s1"}]}, {"tenant_ns_if": "t3ns1if", "tenant_ns_ip": "10.1.21.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s1if", "tenant_sub_ip": "10.1.21.2/24"}], "rc": 0, "start": "2019-11-18 08:21:12.256686", "stderr": "Device \"t3ns1if\" does not exist.", "stderr_lines": ["Device \"t3ns1if\" does not exist."], "stdout": "", "stdout_lines": []}
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.22.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.1.22.1', u'bridge_name': u't3br2', u'dns': [{u'dnsif': u't3s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't3s2_dnsbrif'}], u'ns_name': u't3ns2', u'subnet_ip': u'2.2.2.0/24', u'vms': [{u'mem': 3, u'name': u't3_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't3br2if1', u'vmif': u't3VM3if1'}], u'vxlan': [{u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}, {u'tenant_sub_ip': u'10.1.22.2/24', u'tenant_ns_ip': u'10.1.22.1/24', u'tenant_ns_if': u't3ns2if', u'tenant_sub_if': u't3s2if', u'tenant_ns_name': u't3'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip link show \"t3ns2if\" ; if [ $? -ne 0 ] ; then ip link add \"t3ns2if\" type veth peer name \"t3s2if\" ; fi\n", "delta": "0:00:00.013446", "end": "2019-11-18 08:21:12.505822", "item": [{"bridge_name": "t3br2", "default_route_ip": "10.1.22.1", "dns": [{"brif": "t3s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t3s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t3ns2", "route": [{"if": "p1", "ip": "10.1.22.1/24", "ns_if": "t3if", "ns_name": "t3"}], "subnet_ip": "2.2.2.0/24", "vms": [{"brif": "t3br2if1", "disk": "10G", "mem": 3, "name": "t3_VM3", "vcpu": 2, "vmif": "t3VM3if1"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, {"tenant_ns_if": "t3ns2if", "tenant_ns_ip": "10.1.22.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s2if", "tenant_sub_ip": "10.1.22.2/24"}], "rc": 0, "start": "2019-11-18 08:21:12.492376", "stderr": "Device \"t3ns2if\" does not exist.", "stderr_lines": ["Device \"t3ns2if\" does not exist."], "stdout": "", "stdout_lines": []}

TASK [Attach Namespace VETH Pairs] **************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.21.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.1.21.1', u'bridge_name': u't3br1', u'dns': [{u'dnsif': u't3s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't3s1_dnsbrif'}], u'ns_name': u't3ns1', u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't3_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't3br1if1', u'vmif': u't3VM1if1'}, {u'mem': 4, u'name': u't3_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't3br1if2', u'vmif': u't3VM2if1'}], u'vxlan': [{u'local_ip': u'10.1.21.2', u'dsport': 4789, u'dev': u't3s1if', u'tenant_route_ip': u'192.168.3.2', u'remote_route': u'10.2.21.0/24', u'subnet_route': u'10.1.21.0/24', u'v_name': u'vxlan_t3s1', u'id': 42, u'remote_ip': u'10.2.21.2'}]}, {u'tenant_sub_ip': u'10.1.21.2/24', u'tenant_ns_ip': u'10.1.21.1/24', u'tenant_ns_if': u't3ns1if', u'tenant_sub_if': u't3s1if', u'tenant_ns_name': u't3'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t3\" ip link show \"t3ns1if\" ; if [ $? -ne 0 ] ; then ip link set \"t3ns1if\" netns \"t3\" ; fi\nip netns exec \"t3ns1\" ip link show \"t3s1if\" ; if [ $? -ne 0 ] ; then ip link set \"t3s1if\" netns \"t3ns1\" ; fi\n", "delta": "0:00:00.119168", "end": "2019-11-18 08:21:12.924201", "item": [{"bridge_name": "t3br1", "default_route_ip": "10.1.21.1", "dns": [{"brif": "t3s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t3s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t3ns1", "route": [{"if": "p1", "ip": "10.1.21.1/24", "ns_if": "t3if", "ns_name": "t3"}], "subnet_ip": "1.1.1.0/24", "vms": [{"brif": "t3br1if1", "disk": "10G", "mem": 2, "name": "t3_VM1", "vcpu": 4, "vmif": "t3VM1if1"}, {"brif": "t3br1if2", "disk": "10G", "mem": 4, "name": "t3_VM2", "vcpu": 2, "vmif": "t3VM2if1"}], "vxlan": [{"dev": "t3s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.21.2", "remote_ip": "10.2.21.2", "remote_route": "10.2.21.0/24", "subnet_route": "10.1.21.0/24", "tenant_route_ip": "192.168.3.2", "v_name": "vxlan_t3s1"}]}, {"tenant_ns_if": "t3ns1if", "tenant_ns_ip": "10.1.21.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s1if", "tenant_sub_ip": "10.1.21.2/24"}], "rc": 0, "start": "2019-11-18 08:21:12.805033", "stderr": "Device \"t3ns1if\" does not exist.\nDevice \"t3s1if\" does not exist.", "stderr_lines": ["Device \"t3ns1if\" does not exist.", "Device \"t3s1if\" does not exist."], "stdout": "", "stdout_lines": []}
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.22.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.1.22.1', u'bridge_name': u't3br2', u'dns': [{u'dnsif': u't3s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't3s2_dnsbrif'}], u'ns_name': u't3ns2', u'subnet_ip': u'2.2.2.0/24', u'vms': [{u'mem': 3, u'name': u't3_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't3br2if1', u'vmif': u't3VM3if1'}], u'vxlan': [{u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}, {u'tenant_sub_ip': u'10.1.22.2/24', u'tenant_ns_ip': u'10.1.22.1/24', u'tenant_ns_if': u't3ns2if', u'tenant_sub_if': u't3s2if', u'tenant_ns_name': u't3'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t3\" ip link show \"t3ns2if\" ; if [ $? -ne 0 ] ; then ip link set \"t3ns2if\" netns \"t3\" ; fi\nip netns exec \"t3ns2\" ip link show \"t3s2if\" ; if [ $? -ne 0 ] ; then ip link set \"t3s2if\" netns \"t3ns2\" ; fi\n", "delta": "0:00:00.126655", "end": "2019-11-18 08:21:13.283713", "item": [{"bridge_name": "t3br2", "default_route_ip": "10.1.22.1", "dns": [{"brif": "t3s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t3s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t3ns2", "route": [{"if": "p1", "ip": "10.1.22.1/24", "ns_if": "t3if", "ns_name": "t3"}], "subnet_ip": "2.2.2.0/24", "vms": [{"brif": "t3br2if1", "disk": "10G", "mem": 3, "name": "t3_VM3", "vcpu": 2, "vmif": "t3VM3if1"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, {"tenant_ns_if": "t3ns2if", "tenant_ns_ip": "10.1.22.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s2if", "tenant_sub_ip": "10.1.22.2/24"}], "rc": 0, "start": "2019-11-18 08:21:13.157058", "stderr": "Device \"t3ns2if\" does not exist.\nDevice \"t3s2if\" does not exist.", "stderr_lines": ["Device \"t3ns2if\" does not exist.", "Device \"t3s2if\" does not exist."], "stdout": "", "stdout_lines": []}

TASK [Set Namespace VETH Pairs UP] **************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.21.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.1.21.1', u'bridge_name': u't3br1', u'dns': [{u'dnsif': u't3s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't3s1_dnsbrif'}], u'ns_name': u't3ns1', u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't3_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't3br1if1', u'vmif': u't3VM1if1'}, {u'mem': 4, u'name': u't3_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't3br1if2', u'vmif': u't3VM2if1'}], u'vxlan': [{u'local_ip': u'10.1.21.2', u'dsport': 4789, u'dev': u't3s1if', u'tenant_route_ip': u'192.168.3.2', u'remote_route': u'10.2.21.0/24', u'subnet_route': u'10.1.21.0/24', u'v_name': u'vxlan_t3s1', u'id': 42, u'remote_ip': u'10.2.21.2'}]}, {u'tenant_sub_ip': u'10.1.21.2/24', u'tenant_ns_ip': u'10.1.21.1/24', u'tenant_ns_if': u't3ns1if', u'tenant_sub_if': u't3s1if', u'tenant_ns_name': u't3'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t3\" ip link set dev \"t3ns1if\" up\nip netns exec \"t3ns1\" ip link set dev \"t3s1if\" up\n", "delta": "0:00:00.079236", "end": "2019-11-18 08:21:13.645987", "item": [{"bridge_name": "t3br1", "default_route_ip": "10.1.21.1", "dns": [{"brif": "t3s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t3s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t3ns1", "route": [{"if": "p1", "ip": "10.1.21.1/24", "ns_if": "t3if", "ns_name": "t3"}], "subnet_ip": "1.1.1.0/24", "vms": [{"brif": "t3br1if1", "disk": "10G", "mem": 2, "name": "t3_VM1", "vcpu": 4, "vmif": "t3VM1if1"}, {"brif": "t3br1if2", "disk": "10G", "mem": 4, "name": "t3_VM2", "vcpu": 2, "vmif": "t3VM2if1"}], "vxlan": [{"dev": "t3s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.21.2", "remote_ip": "10.2.21.2", "remote_route": "10.2.21.0/24", "subnet_route": "10.1.21.0/24", "tenant_route_ip": "192.168.3.2", "v_name": "vxlan_t3s1"}]}, {"tenant_ns_if": "t3ns1if", "tenant_ns_ip": "10.1.21.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s1if", "tenant_sub_ip": "10.1.21.2/24"}], "rc": 0, "start": "2019-11-18 08:21:13.566751", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.22.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.1.22.1', u'bridge_name': u't3br2', u'dns': [{u'dnsif': u't3s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't3s2_dnsbrif'}], u'ns_name': u't3ns2', u'subnet_ip': u'2.2.2.0/24', u'vms': [{u'mem': 3, u'name': u't3_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't3br2if1', u'vmif': u't3VM3if1'}], u'vxlan': [{u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}, {u'tenant_sub_ip': u'10.1.22.2/24', u'tenant_ns_ip': u'10.1.22.1/24', u'tenant_ns_if': u't3ns2if', u'tenant_sub_if': u't3s2if', u'tenant_ns_name': u't3'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t3\" ip link set dev \"t3ns2if\" up\nip netns exec \"t3ns2\" ip link set dev \"t3s2if\" up\n", "delta": "0:00:00.082958", "end": "2019-11-18 08:21:13.917078", "item": [{"bridge_name": "t3br2", "default_route_ip": "10.1.22.1", "dns": [{"brif": "t3s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t3s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t3ns2", "route": [{"if": "p1", "ip": "10.1.22.1/24", "ns_if": "t3if", "ns_name": "t3"}], "subnet_ip": "2.2.2.0/24", "vms": [{"brif": "t3br2if1", "disk": "10G", "mem": 3, "name": "t3_VM3", "vcpu": 2, "vmif": "t3VM3if1"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, {"tenant_ns_if": "t3ns2if", "tenant_ns_ip": "10.1.22.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s2if", "tenant_sub_ip": "10.1.22.2/24"}], "rc": 0, "start": "2019-11-18 08:21:13.834120", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Add IP addresses to Namespace VETH Pairs] *************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.21.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.1.21.1', u'bridge_name': u't3br1', u'dns': [{u'dnsif': u't3s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't3s1_dnsbrif'}], u'ns_name': u't3ns1', u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't3_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't3br1if1', u'vmif': u't3VM1if1'}, {u'mem': 4, u'name': u't3_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't3br1if2', u'vmif': u't3VM2if1'}], u'vxlan': [{u'local_ip': u'10.1.21.2', u'dsport': 4789, u'dev': u't3s1if', u'tenant_route_ip': u'192.168.3.2', u'remote_route': u'10.2.21.0/24', u'subnet_route': u'10.1.21.0/24', u'v_name': u'vxlan_t3s1', u'id': 42, u'remote_ip': u'10.2.21.2'}]}, {u'tenant_sub_ip': u'10.1.21.2/24', u'tenant_ns_ip': u'10.1.21.1/24', u'tenant_ns_if': u't3ns1if', u'tenant_sub_if': u't3s1if', u'tenant_ns_name': u't3'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t3ns1\" ip addr show \"t3s1if\" | awk 'FNR==3{ print $2 }' | grep -w '^10.1.21.2/24' ; if [ $? -ne 0 ] ; then ip netns exec \"t3ns1\" ip addr add \"10.1.21.2/24\" dev \"t3s1if\" ; fi\n\nip netns exec \"t3\" ip addr show \"t3ns1if\" | awk 'FNR==3{ print $2 }' | grep -w '^10.1.21.1/24' ; if [ $? -ne 0 ] ; then ip netns exec \"t3\" ip addr add \"10.1.21.1/24\" dev \"t3ns1if\" ; fi\n", "delta": "0:00:00.146896", "end": "2019-11-18 08:21:14.325223", "item": [{"bridge_name": "t3br1", "default_route_ip": "10.1.21.1", "dns": [{"brif": "t3s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t3s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t3ns1", "route": [{"if": "p1", "ip": "10.1.21.1/24", "ns_if": "t3if", "ns_name": "t3"}], "subnet_ip": "1.1.1.0/24", "vms": [{"brif": "t3br1if1", "disk": "10G", "mem": 2, "name": "t3_VM1", "vcpu": 4, "vmif": "t3VM1if1"}, {"brif": "t3br1if2", "disk": "10G", "mem": 4, "name": "t3_VM2", "vcpu": 2, "vmif": "t3VM2if1"}], "vxlan": [{"dev": "t3s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.21.2", "remote_ip": "10.2.21.2", "remote_route": "10.2.21.0/24", "subnet_route": "10.1.21.0/24", "tenant_route_ip": "192.168.3.2", "v_name": "vxlan_t3s1"}]}, {"tenant_ns_if": "t3ns1if", "tenant_ns_ip": "10.1.21.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s1if", "tenant_sub_ip": "10.1.21.2/24"}], "rc": 0, "start": "2019-11-18 08:21:14.178327", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.22.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.1.22.1', u'bridge_name': u't3br2', u'dns': [{u'dnsif': u't3s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't3s2_dnsbrif'}], u'ns_name': u't3ns2', u'subnet_ip': u'2.2.2.0/24', u'vms': [{u'mem': 3, u'name': u't3_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't3br2if1', u'vmif': u't3VM3if1'}], u'vxlan': [{u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}, {u'tenant_sub_ip': u'10.1.22.2/24', u'tenant_ns_ip': u'10.1.22.1/24', u'tenant_ns_if': u't3ns2if', u'tenant_sub_if': u't3s2if', u'tenant_ns_name': u't3'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t3ns2\" ip addr show \"t3s2if\" | awk 'FNR==3{ print $2 }' | grep -w '^10.1.22.2/24' ; if [ $? -ne 0 ] ; then ip netns exec \"t3ns2\" ip addr add \"10.1.22.2/24\" dev \"t3s2if\" ; fi\n\nip netns exec \"t3\" ip addr show \"t3ns2if\" | awk 'FNR==3{ print $2 }' | grep -w '^10.1.22.1/24' ; if [ $? -ne 0 ] ; then ip netns exec \"t3\" ip addr add \"10.1.22.1/24\" dev \"t3ns2if\" ; fi\n", "delta": "0:00:00.163622", "end": "2019-11-18 08:21:14.677310", "item": [{"bridge_name": "t3br2", "default_route_ip": "10.1.22.1", "dns": [{"brif": "t3s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t3s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t3ns2", "route": [{"if": "p1", "ip": "10.1.22.1/24", "ns_if": "t3if", "ns_name": "t3"}], "subnet_ip": "2.2.2.0/24", "vms": [{"brif": "t3br2if1", "disk": "10G", "mem": 3, "name": "t3_VM3", "vcpu": 2, "vmif": "t3VM3if1"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, {"tenant_ns_if": "t3ns2if", "tenant_ns_ip": "10.1.22.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s2if", "tenant_sub_ip": "10.1.22.2/24"}], "rc": 0, "start": "2019-11-18 08:21:14.513688", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Add IP Route to Tenant] *******************************************************************************************************************************
changed: [localhost] => (item={u'default_route_ip': u'192.168.3.1', u'name': u't3', u'pns_ip': u'192.168.3.1/24', u'tenant_if': u't3if', u'tenant_ip': u'192.168.3.2/24', u'pns_if': u't3pns_if'}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t3\" ip route show default | grep -w '[d]efault via 192.168.3.1' ; if [ $? -ne 0 ] ; then ip netns exec \"t3\" ip route add default via \"192.168.3.1\" ; fi\n", "delta": "0:00:00.081106", "end": "2019-11-18 08:21:15.049353", "item": {"default_route_ip": "192.168.3.1", "name": "t3", "pns_if": "t3pns_if", "pns_ip": "192.168.3.1/24", "tenant_if": "t3if", "tenant_ip": "192.168.3.2/24"}, "rc": 0, "start": "2019-11-18 08:21:14.968247", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Add IP Route to Tenant Subnet] ************************************************************************************************************************
changed: [localhost] => (item={u'route': [{u'ip': u'10.1.21.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.1.21.1', u'bridge_name': u't3br1', u'dns': [{u'dnsif': u't3s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't3s1_dnsbrif'}], u'ns_name': u't3ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.21.2/24', u'tenant_ns_ip': u'10.1.21.1/24', u'tenant_ns_if': u't3ns1if', u'tenant_ns_name': u't3', u'tenant_sub_if': u't3s1if'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't3_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't3br1if1', u'vmif': u't3VM1if1'}, {u'mem': 4, u'name': u't3_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't3br1if2', u'vmif': u't3VM2if1'}], u'vxlan': [{u'local_ip': u'10.1.21.2', u'tenant_route_ip': u'192.168.3.2', u'dsport': 4789, u'dev': u't3s1if', u'subnet_route': u'10.1.21.0/24', u'remote_route': u'10.2.21.0/24', u'v_name': u'vxlan_t3s1', u'id': 42, u'remote_ip': u'10.2.21.2'}]}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t3ns1\" ip route show default | grep -w '[d]efault via 10.1.21.1' ; if [ $? -ne 0 ] ; then ip netns exec \"t3ns1\" ip route add default via \"10.1.21.1\" ; fi\n", "delta": "0:00:00.083946", "end": "2019-11-18 08:21:15.425457", "item": {"bridge_name": "t3br1", "default_route_ip": "10.1.21.1", "dns": [{"brif": "t3s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t3s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t3ns1", "route": [{"if": "p1", "ip": "10.1.21.1/24", "ns_if": "t3if", "ns_name": "t3"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t3ns1if", "tenant_ns_ip": "10.1.21.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s1if", "tenant_sub_ip": "10.1.21.2/24"}], "vms": [{"brif": "t3br1if1", "disk": "10G", "mem": 2, "name": "t3_VM1", "vcpu": 4, "vmif": "t3VM1if1"}, {"brif": "t3br1if2", "disk": "10G", "mem": 4, "name": "t3_VM2", "vcpu": 2, "vmif": "t3VM2if1"}], "vxlan": [{"dev": "t3s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.21.2", "remote_ip": "10.2.21.2", "remote_route": "10.2.21.0/24", "subnet_route": "10.1.21.0/24", "tenant_route_ip": "192.168.3.2", "v_name": "vxlan_t3s1"}]}, "rc": 0, "start": "2019-11-18 08:21:15.341511", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}
changed: [localhost] => (item={u'route': [{u'ip': u'10.1.22.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.1.22.1', u'bridge_name': u't3br2', u'dns': [{u'dnsif': u't3s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't3s2_dnsbrif'}], u'ns_name': u't3ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.22.2/24', u'tenant_ns_ip': u'10.1.22.1/24', u'tenant_ns_if': u't3ns2if', u'tenant_ns_name': u't3', u'tenant_sub_if': u't3s2if'}], u'subnet_ip': u'2.2.2.0/24', u'vms': [{u'mem': 3, u'name': u't3_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't3br2if1', u'vmif': u't3VM3if1'}], u'vxlan': [{u'local_ip': [], u'tenant_route_ip': [], u'dsport': [], u'dev': [], u'subnet_route': [], u'remote_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t3ns2\" ip route show default | grep -w '[d]efault via 10.1.22.1' ; if [ $? -ne 0 ] ; then ip netns exec \"t3ns2\" ip route add default via \"10.1.22.1\" ; fi\n", "delta": "0:00:00.070779", "end": "2019-11-18 08:21:15.721346", "item": {"bridge_name": "t3br2", "default_route_ip": "10.1.22.1", "dns": [{"brif": "t3s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t3s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t3ns2", "route": [{"if": "p1", "ip": "10.1.22.1/24", "ns_if": "t3if", "ns_name": "t3"}], "subnet_ip": "2.2.2.0/24", "tenant_ns": [{"tenant_ns_if": "t3ns2if", "tenant_ns_ip": "10.1.22.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s2if", "tenant_sub_ip": "10.1.22.2/24"}], "vms": [{"brif": "t3br2if1", "disk": "10G", "mem": 3, "name": "t3_VM3", "vcpu": 2, "vmif": "t3VM3if1"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, "rc": 0, "start": "2019-11-18 08:21:15.650567", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Create bridge inside namespace] ***********************************************************************************************************************
changed: [localhost] => (item={u'route': [{u'ip': u'10.1.21.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.1.21.1', u'bridge_name': u't3br1', u'dns': [{u'dnsif': u't3s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't3s1_dnsbrif'}], u'ns_name': u't3ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.21.2/24', u'tenant_ns_ip': u'10.1.21.1/24', u'tenant_ns_if': u't3ns1if', u'tenant_ns_name': u't3', u'tenant_sub_if': u't3s1if'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't3_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't3br1if1', u'vmif': u't3VM1if1'}, {u'mem': 4, u'name': u't3_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't3br1if2', u'vmif': u't3VM2if1'}], u'vxlan': [{u'local_ip': u'10.1.21.2', u'tenant_route_ip': u'192.168.3.2', u'dsport': 4789, u'dev': u't3s1if', u'subnet_route': u'10.1.21.0/24', u'remote_route': u'10.2.21.0/24', u'v_name': u'vxlan_t3s1', u'id': 42, u'remote_ip': u'10.2.21.2'}]}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t3ns1\" brctl show | grep -w '^t3br1'; if [ $? -ne 0 ] ; then ip netns exec \"t3ns1\" brctl addbr \"t3br1\" ; fi\nip netns exec \"t3ns1\" ip link set dev \"t3br1\" up\n", "delta": "0:00:00.110524", "end": "2019-11-18 08:21:16.129459", "item": {"bridge_name": "t3br1", "default_route_ip": "10.1.21.1", "dns": [{"brif": "t3s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t3s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t3ns1", "route": [{"if": "p1", "ip": "10.1.21.1/24", "ns_if": "t3if", "ns_name": "t3"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t3ns1if", "tenant_ns_ip": "10.1.21.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s1if", "tenant_sub_ip": "10.1.21.2/24"}], "vms": [{"brif": "t3br1if1", "disk": "10G", "mem": 2, "name": "t3_VM1", "vcpu": 4, "vmif": "t3VM1if1"}, {"brif": "t3br1if2", "disk": "10G", "mem": 4, "name": "t3_VM2", "vcpu": 2, "vmif": "t3VM2if1"}], "vxlan": [{"dev": "t3s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.21.2", "remote_ip": "10.2.21.2", "remote_route": "10.2.21.0/24", "subnet_route": "10.1.21.0/24", "tenant_route_ip": "192.168.3.2", "v_name": "vxlan_t3s1"}]}, "rc": 0, "start": "2019-11-18 08:21:16.018935", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}
changed: [localhost] => (item={u'route': [{u'ip': u'10.1.22.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.1.22.1', u'bridge_name': u't3br2', u'dns': [{u'dnsif': u't3s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't3s2_dnsbrif'}], u'ns_name': u't3ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.22.2/24', u'tenant_ns_ip': u'10.1.22.1/24', u'tenant_ns_if': u't3ns2if', u'tenant_ns_name': u't3', u'tenant_sub_if': u't3s2if'}], u'subnet_ip': u'2.2.2.0/24', u'vms': [{u'mem': 3, u'name': u't3_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't3br2if1', u'vmif': u't3VM3if1'}], u'vxlan': [{u'local_ip': [], u'tenant_route_ip': [], u'dsport': [], u'dev': [], u'subnet_route': [], u'remote_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t3ns2\" brctl show | grep -w '^t3br2'; if [ $? -ne 0 ] ; then ip netns exec \"t3ns2\" brctl addbr \"t3br2\" ; fi\nip netns exec \"t3ns2\" ip link set dev \"t3br2\" up\n", "delta": "0:00:00.115592", "end": "2019-11-18 08:21:16.469457", "item": {"bridge_name": "t3br2", "default_route_ip": "10.1.22.1", "dns": [{"brif": "t3s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t3s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t3ns2", "route": [{"if": "p1", "ip": "10.1.22.1/24", "ns_if": "t3if", "ns_name": "t3"}], "subnet_ip": "2.2.2.0/24", "tenant_ns": [{"tenant_ns_if": "t3ns2if", "tenant_ns_ip": "10.1.22.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s2if", "tenant_sub_ip": "10.1.22.2/24"}], "vms": [{"brif": "t3br2if1", "disk": "10G", "mem": 3, "name": "t3_VM3", "vcpu": 2, "vmif": "t3VM3if1"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, "rc": 0, "start": "2019-11-18 08:21:16.353865", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Create DNS VETH Pair] *********************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.21.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.1.21.1', u'bridge_name': u't3br1', u'ns_name': u't3ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.21.2/24', u'tenant_ns_ip': u'10.1.21.1/24', u'tenant_ns_if': u't3ns1if', u'tenant_sub_if': u't3s1if', u'tenant_ns_name': u't3'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't3_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't3br1if1', u'vmif': u't3VM1if1'}, {u'mem': 4, u'name': u't3_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't3br1if2', u'vmif': u't3VM2if1'}], u'vxlan': [{u'local_ip': u'10.1.21.2', u'dsport': 4789, u'dev': u't3s1if', u'tenant_route_ip': u'192.168.3.2', u'remote_route': u'10.2.21.0/24', u'subnet_route': u'10.1.21.0/24', u'v_name': u'vxlan_t3s1', u'id': 42, u'remote_ip': u'10.2.21.2'}]}, {u'dnsif': u't3s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't3s1_dnsbrif'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t3ns1\" ip link show \"t3s1_dnsbrif\" ; if [ $? -ne 0 ] ; then ip netns exec \"t3ns1\" ip link add \"t3s1_dnsbrif\" type veth peer name \"t3s1_dnsif\" ; fi\nip netns exec \"t3ns1\" ip link set dev \"t3s1_dnsbrif\" up\nip netns exec \"t3ns1\" ip link set dev \"t3s1_dnsif\" up\n", "delta": "0:00:00.154496", "end": "2019-11-18 08:21:16.913288", "item": [{"bridge_name": "t3br1", "default_route_ip": "10.1.21.1", "ns_name": "t3ns1", "route": [{"if": "p1", "ip": "10.1.21.1/24", "ns_if": "t3if", "ns_name": "t3"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t3ns1if", "tenant_ns_ip": "10.1.21.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s1if", "tenant_sub_ip": "10.1.21.2/24"}], "vms": [{"brif": "t3br1if1", "disk": "10G", "mem": 2, "name": "t3_VM1", "vcpu": 4, "vmif": "t3VM1if1"}, {"brif": "t3br1if2", "disk": "10G", "mem": 4, "name": "t3_VM2", "vcpu": 2, "vmif": "t3VM2if1"}], "vxlan": [{"dev": "t3s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.21.2", "remote_ip": "10.2.21.2", "remote_route": "10.2.21.0/24", "subnet_route": "10.1.21.0/24", "tenant_route_ip": "192.168.3.2", "v_name": "vxlan_t3s1"}]}, {"brif": "t3s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t3s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "rc": 0, "start": "2019-11-18 08:21:16.758792", "stderr": "Device \"t3s1_dnsbrif\" does not exist.", "stderr_lines": ["Device \"t3s1_dnsbrif\" does not exist."], "stdout": "", "stdout_lines": []}
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.22.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.1.22.1', u'bridge_name': u't3br2', u'ns_name': u't3ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.22.2/24', u'tenant_ns_ip': u'10.1.22.1/24', u'tenant_ns_if': u't3ns2if', u'tenant_sub_if': u't3s2if', u'tenant_ns_name': u't3'}], u'subnet_ip': u'2.2.2.0/24', u'vms': [{u'mem': 3, u'name': u't3_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't3br2if1', u'vmif': u't3VM3if1'}], u'vxlan': [{u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}, {u'dnsif': u't3s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't3s2_dnsbrif'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t3ns2\" ip link show \"t3s2_dnsbrif\" ; if [ $? -ne 0 ] ; then ip netns exec \"t3ns2\" ip link add \"t3s2_dnsbrif\" type veth peer name \"t3s2_dnsif\" ; fi\nip netns exec \"t3ns2\" ip link set dev \"t3s2_dnsbrif\" up\nip netns exec \"t3ns2\" ip link set dev \"t3s2_dnsif\" up\n", "delta": "0:00:00.145250", "end": "2019-11-18 08:21:17.249240", "item": [{"bridge_name": "t3br2", "default_route_ip": "10.1.22.1", "ns_name": "t3ns2", "route": [{"if": "p1", "ip": "10.1.22.1/24", "ns_if": "t3if", "ns_name": "t3"}], "subnet_ip": "2.2.2.0/24", "tenant_ns": [{"tenant_ns_if": "t3ns2if", "tenant_ns_ip": "10.1.22.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s2if", "tenant_sub_ip": "10.1.22.2/24"}], "vms": [{"brif": "t3br2if1", "disk": "10G", "mem": 3, "name": "t3_VM3", "vcpu": 2, "vmif": "t3VM3if1"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, {"brif": "t3s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t3s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "rc": 0, "start": "2019-11-18 08:21:17.103990", "stderr": "Device \"t3s2_dnsbrif\" does not exist.", "stderr_lines": ["Device \"t3s2_dnsbrif\" does not exist."], "stdout": "", "stdout_lines": []}

TASK [Attach DNS VETH Pair] *********************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.21.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.1.21.1', u'bridge_name': u't3br1', u'ns_name': u't3ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.21.2/24', u'tenant_ns_ip': u'10.1.21.1/24', u'tenant_ns_if': u't3ns1if', u'tenant_sub_if': u't3s1if', u'tenant_ns_name': u't3'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't3_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't3br1if1', u'vmif': u't3VM1if1'}, {u'mem': 4, u'name': u't3_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't3br1if2', u'vmif': u't3VM2if1'}], u'vxlan': [{u'local_ip': u'10.1.21.2', u'dsport': 4789, u'dev': u't3s1if', u'tenant_route_ip': u'192.168.3.2', u'remote_route': u'10.2.21.0/24', u'subnet_route': u'10.1.21.0/24', u'v_name': u'vxlan_t3s1', u'id': 42, u'remote_ip': u'10.2.21.2'}]}, {u'dnsif': u't3s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't3s1_dnsbrif'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t3ns1\" brctl show \"t3br1\" | grep -w 't3s1_dnsbrif' ; if [ $? -ne 0 ] ; then ip netns exec \"t3ns1\" brctl addif \"t3br1\" \"t3s1_dnsbrif\" ; fi\n", "delta": "0:00:00.072116", "end": "2019-11-18 08:21:17.573139", "item": [{"bridge_name": "t3br1", "default_route_ip": "10.1.21.1", "ns_name": "t3ns1", "route": [{"if": "p1", "ip": "10.1.21.1/24", "ns_if": "t3if", "ns_name": "t3"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t3ns1if", "tenant_ns_ip": "10.1.21.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s1if", "tenant_sub_ip": "10.1.21.2/24"}], "vms": [{"brif": "t3br1if1", "disk": "10G", "mem": 2, "name": "t3_VM1", "vcpu": 4, "vmif": "t3VM1if1"}, {"brif": "t3br1if2", "disk": "10G", "mem": 4, "name": "t3_VM2", "vcpu": 2, "vmif": "t3VM2if1"}], "vxlan": [{"dev": "t3s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.21.2", "remote_ip": "10.2.21.2", "remote_route": "10.2.21.0/24", "subnet_route": "10.1.21.0/24", "tenant_route_ip": "192.168.3.2", "v_name": "vxlan_t3s1"}]}, {"brif": "t3s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t3s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "rc": 0, "start": "2019-11-18 08:21:17.501023", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.22.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.1.22.1', u'bridge_name': u't3br2', u'ns_name': u't3ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.22.2/24', u'tenant_ns_ip': u'10.1.22.1/24', u'tenant_ns_if': u't3ns2if', u'tenant_sub_if': u't3s2if', u'tenant_ns_name': u't3'}], u'subnet_ip': u'2.2.2.0/24', u'vms': [{u'mem': 3, u'name': u't3_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't3br2if1', u'vmif': u't3VM3if1'}], u'vxlan': [{u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}, {u'dnsif': u't3s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't3s2_dnsbrif'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t3ns2\" brctl show \"t3br2\" | grep -w 't3s2_dnsbrif' ; if [ $? -ne 0 ] ; then ip netns exec \"t3ns2\" brctl addif \"t3br2\" \"t3s2_dnsbrif\" ; fi\n", "delta": "0:00:00.100913", "end": "2019-11-18 08:21:17.877445", "item": [{"bridge_name": "t3br2", "default_route_ip": "10.1.22.1", "ns_name": "t3ns2", "route": [{"if": "p1", "ip": "10.1.22.1/24", "ns_if": "t3if", "ns_name": "t3"}], "subnet_ip": "2.2.2.0/24", "tenant_ns": [{"tenant_ns_if": "t3ns2if", "tenant_ns_ip": "10.1.22.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s2if", "tenant_sub_ip": "10.1.22.2/24"}], "vms": [{"brif": "t3br2if1", "disk": "10G", "mem": 3, "name": "t3_VM3", "vcpu": 2, "vmif": "t3VM3if1"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, {"brif": "t3s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t3s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "rc": 0, "start": "2019-11-18 08:21:17.776532", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Create VETH Pairs] ************************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.21.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.1.21.1', u'bridge_name': u't3br1', u'dns': [{u'dnsif': u't3s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't3s1_dnsbrif'}], u'ns_name': u't3ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.21.2/24', u'tenant_ns_ip': u'10.1.21.1/24', u'tenant_ns_if': u't3ns1if', u'tenant_sub_if': u't3s1if', u'tenant_ns_name': u't3'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.1.21.2', u'dsport': 4789, u'dev': u't3s1if', u'tenant_route_ip': u'192.168.3.2', u'remote_route': u'10.2.21.0/24', u'subnet_route': u'10.1.21.0/24', u'v_name': u'vxlan_t3s1', u'id': 42, u'remote_ip': u'10.2.21.2'}]}, {u'mem': 2, u'name': u't3_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't3br1if1', u'vmif': u't3VM1if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip link show \"t3br1if1\" ; if [ $? -ne 0 ] ; then ip link add \"t3VM1if1\" type veth peer name \"t3br1if1\" ; fi\nip link set dev \"t3br1if1\" up\nip link set dev \"t3VM1if1\" up\n", "delta": "0:00:00.014856", "end": "2019-11-18 08:21:18.193651", "item": [{"bridge_name": "t3br1", "default_route_ip": "10.1.21.1", "dns": [{"brif": "t3s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t3s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t3ns1", "route": [{"if": "p1", "ip": "10.1.21.1/24", "ns_if": "t3if", "ns_name": "t3"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t3ns1if", "tenant_ns_ip": "10.1.21.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s1if", "tenant_sub_ip": "10.1.21.2/24"}], "vxlan": [{"dev": "t3s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.21.2", "remote_ip": "10.2.21.2", "remote_route": "10.2.21.0/24", "subnet_route": "10.1.21.0/24", "tenant_route_ip": "192.168.3.2", "v_name": "vxlan_t3s1"}]}, {"brif": "t3br1if1", "disk": "10G", "mem": 2, "name": "t3_VM1", "vcpu": 4, "vmif": "t3VM1if1"}], "rc": 0, "start": "2019-11-18 08:21:18.178795", "stderr": "Device \"t3br1if1\" does not exist.", "stderr_lines": ["Device \"t3br1if1\" does not exist."], "stdout": "", "stdout_lines": []}
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.21.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.1.21.1', u'bridge_name': u't3br1', u'dns': [{u'dnsif': u't3s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't3s1_dnsbrif'}], u'ns_name': u't3ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.21.2/24', u'tenant_ns_ip': u'10.1.21.1/24', u'tenant_ns_if': u't3ns1if', u'tenant_sub_if': u't3s1if', u'tenant_ns_name': u't3'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.1.21.2', u'dsport': 4789, u'dev': u't3s1if', u'tenant_route_ip': u'192.168.3.2', u'remote_route': u'10.2.21.0/24', u'subnet_route': u'10.1.21.0/24', u'v_name': u'vxlan_t3s1', u'id': 42, u'remote_ip': u'10.2.21.2'}]}, {u'mem': 4, u'name': u't3_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't3br1if2', u'vmif': u't3VM2if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip link show \"t3br1if2\" ; if [ $? -ne 0 ] ; then ip link add \"t3VM2if1\" type veth peer name \"t3br1if2\" ; fi\nip link set dev \"t3br1if2\" up\nip link set dev \"t3VM2if1\" up\n", "delta": "0:00:00.019510", "end": "2019-11-18 08:21:18.440097", "item": [{"bridge_name": "t3br1", "default_route_ip": "10.1.21.1", "dns": [{"brif": "t3s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t3s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t3ns1", "route": [{"if": "p1", "ip": "10.1.21.1/24", "ns_if": "t3if", "ns_name": "t3"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t3ns1if", "tenant_ns_ip": "10.1.21.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s1if", "tenant_sub_ip": "10.1.21.2/24"}], "vxlan": [{"dev": "t3s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.21.2", "remote_ip": "10.2.21.2", "remote_route": "10.2.21.0/24", "subnet_route": "10.1.21.0/24", "tenant_route_ip": "192.168.3.2", "v_name": "vxlan_t3s1"}]}, {"brif": "t3br1if2", "disk": "10G", "mem": 4, "name": "t3_VM2", "vcpu": 2, "vmif": "t3VM2if1"}], "rc": 0, "start": "2019-11-18 08:21:18.420587", "stderr": "Device \"t3br1if2\" does not exist.", "stderr_lines": ["Device \"t3br1if2\" does not exist."], "stdout": "", "stdout_lines": []}
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.22.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.1.22.1', u'bridge_name': u't3br2', u'dns': [{u'dnsif': u't3s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't3s2_dnsbrif'}], u'ns_name': u't3ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.22.2/24', u'tenant_ns_ip': u'10.1.22.1/24', u'tenant_ns_if': u't3ns2if', u'tenant_sub_if': u't3s2if', u'tenant_ns_name': u't3'}], u'subnet_ip': u'2.2.2.0/24', u'vxlan': [{u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}, {u'mem': 3, u'name': u't3_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't3br2if1', u'vmif': u't3VM3if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip link show \"t3br2if1\" ; if [ $? -ne 0 ] ; then ip link add \"t3VM3if1\" type veth peer name \"t3br2if1\" ; fi\nip link set dev \"t3br2if1\" up\nip link set dev \"t3VM3if1\" up\n", "delta": "0:00:00.018064", "end": "2019-11-18 08:21:18.686444", "item": [{"bridge_name": "t3br2", "default_route_ip": "10.1.22.1", "dns": [{"brif": "t3s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t3s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t3ns2", "route": [{"if": "p1", "ip": "10.1.22.1/24", "ns_if": "t3if", "ns_name": "t3"}], "subnet_ip": "2.2.2.0/24", "tenant_ns": [{"tenant_ns_if": "t3ns2if", "tenant_ns_ip": "10.1.22.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s2if", "tenant_sub_ip": "10.1.22.2/24"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, {"brif": "t3br2if1", "disk": "10G", "mem": 3, "name": "t3_VM3", "vcpu": 2, "vmif": "t3VM3if1"}], "rc": 0, "start": "2019-11-18 08:21:18.668380", "stderr": "Device \"t3br2if1\" does not exist.", "stderr_lines": ["Device \"t3br2if1\" does not exist."], "stdout": "", "stdout_lines": []}

TASK [Attach VETH Pairs] ************************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.21.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.1.21.1', u'bridge_name': u't3br1', u'dns': [{u'dnsif': u't3s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't3s1_dnsbrif'}], u'ns_name': u't3ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.21.2/24', u'tenant_ns_ip': u'10.1.21.1/24', u'tenant_ns_if': u't3ns1if', u'tenant_sub_if': u't3s1if', u'tenant_ns_name': u't3'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.1.21.2', u'dsport': 4789, u'dev': u't3s1if', u'tenant_route_ip': u'192.168.3.2', u'remote_route': u'10.2.21.0/24', u'subnet_route': u'10.1.21.0/24', u'v_name': u'vxlan_t3s1', u'id': 42, u'remote_ip': u'10.2.21.2'}]}, {u'mem': 2, u'name': u't3_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't3br1if1', u'vmif': u't3VM1if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip link show \"t3br1if1\" ; if [ $? -eq 0 ] ; then ip link set \"t3br1if1\" netns \"t3ns1\" ; fi\nip netns exec \"t3ns1\" brctl show \"t3br1\" | grep -w 't3br1if1' ; if [ $? -ne 0 ] ; then ip netns exec \"t3ns1\" brctl addif \"t3br1\" \"t3br1if1\" ; fi\n", "delta": "0:00:00.111772", "end": "2019-11-18 08:21:19.089301", "item": [{"bridge_name": "t3br1", "default_route_ip": "10.1.21.1", "dns": [{"brif": "t3s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t3s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t3ns1", "route": [{"if": "p1", "ip": "10.1.21.1/24", "ns_if": "t3if", "ns_name": "t3"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t3ns1if", "tenant_ns_ip": "10.1.21.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s1if", "tenant_sub_ip": "10.1.21.2/24"}], "vxlan": [{"dev": "t3s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.21.2", "remote_ip": "10.2.21.2", "remote_route": "10.2.21.0/24", "subnet_route": "10.1.21.0/24", "tenant_route_ip": "192.168.3.2", "v_name": "vxlan_t3s1"}]}, {"brif": "t3br1if1", "disk": "10G", "mem": 2, "name": "t3_VM1", "vcpu": 4, "vmif": "t3VM1if1"}], "rc": 0, "start": "2019-11-18 08:21:18.977529", "stderr": "", "stderr_lines": [], "stdout": "52: t3br1if1@t3VM1if1: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP mode DEFAULT group default qlen 1000\n    link/ether 62:20:09:1e:eb:94 brd ff:ff:ff:ff:ff:ff", "stdout_lines": ["52: t3br1if1@t3VM1if1: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP mode DEFAULT group default qlen 1000", "    link/ether 62:20:09:1e:eb:94 brd ff:ff:ff:ff:ff:ff"]}
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.21.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.1.21.1', u'bridge_name': u't3br1', u'dns': [{u'dnsif': u't3s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't3s1_dnsbrif'}], u'ns_name': u't3ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.21.2/24', u'tenant_ns_ip': u'10.1.21.1/24', u'tenant_ns_if': u't3ns1if', u'tenant_sub_if': u't3s1if', u'tenant_ns_name': u't3'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.1.21.2', u'dsport': 4789, u'dev': u't3s1if', u'tenant_route_ip': u'192.168.3.2', u'remote_route': u'10.2.21.0/24', u'subnet_route': u'10.1.21.0/24', u'v_name': u'vxlan_t3s1', u'id': 42, u'remote_ip': u'10.2.21.2'}]}, {u'mem': 4, u'name': u't3_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't3br1if2', u'vmif': u't3VM2if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip link show \"t3br1if2\" ; if [ $? -eq 0 ] ; then ip link set \"t3br1if2\" netns \"t3ns1\" ; fi\nip netns exec \"t3ns1\" brctl show \"t3br1\" | grep -w 't3br1if2' ; if [ $? -ne 0 ] ; then ip netns exec \"t3ns1\" brctl addif \"t3br1\" \"t3br1if2\" ; fi\n", "delta": "0:00:00.117070", "end": "2019-11-18 08:21:19.429379", "item": [{"bridge_name": "t3br1", "default_route_ip": "10.1.21.1", "dns": [{"brif": "t3s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t3s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t3ns1", "route": [{"if": "p1", "ip": "10.1.21.1/24", "ns_if": "t3if", "ns_name": "t3"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t3ns1if", "tenant_ns_ip": "10.1.21.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s1if", "tenant_sub_ip": "10.1.21.2/24"}], "vxlan": [{"dev": "t3s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.21.2", "remote_ip": "10.2.21.2", "remote_route": "10.2.21.0/24", "subnet_route": "10.1.21.0/24", "tenant_route_ip": "192.168.3.2", "v_name": "vxlan_t3s1"}]}, {"brif": "t3br1if2", "disk": "10G", "mem": 4, "name": "t3_VM2", "vcpu": 2, "vmif": "t3VM2if1"}], "rc": 0, "start": "2019-11-18 08:21:19.312309", "stderr": "", "stderr_lines": [], "stdout": "54: t3br1if2@t3VM2if1: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP mode DEFAULT group default qlen 1000\n    link/ether 86:c0:a7:11:33:12 brd ff:ff:ff:ff:ff:ff", "stdout_lines": ["54: t3br1if2@t3VM2if1: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP mode DEFAULT group default qlen 1000", "    link/ether 86:c0:a7:11:33:12 brd ff:ff:ff:ff:ff:ff"]}
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.22.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.1.22.1', u'bridge_name': u't3br2', u'dns': [{u'dnsif': u't3s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't3s2_dnsbrif'}], u'ns_name': u't3ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.22.2/24', u'tenant_ns_ip': u'10.1.22.1/24', u'tenant_ns_if': u't3ns2if', u'tenant_sub_if': u't3s2if', u'tenant_ns_name': u't3'}], u'subnet_ip': u'2.2.2.0/24', u'vxlan': [{u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}, {u'mem': 3, u'name': u't3_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't3br2if1', u'vmif': u't3VM3if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip link show \"t3br2if1\" ; if [ $? -eq 0 ] ; then ip link set \"t3br2if1\" netns \"t3ns2\" ; fi\nip netns exec \"t3ns2\" brctl show \"t3br2\" | grep -w 't3br2if1' ; if [ $? -ne 0 ] ; then ip netns exec \"t3ns2\" brctl addif \"t3br2\" \"t3br2if1\" ; fi\n", "delta": "0:00:00.101646", "end": "2019-11-18 08:21:19.761392", "item": [{"bridge_name": "t3br2", "default_route_ip": "10.1.22.1", "dns": [{"brif": "t3s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t3s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t3ns2", "route": [{"if": "p1", "ip": "10.1.22.1/24", "ns_if": "t3if", "ns_name": "t3"}], "subnet_ip": "2.2.2.0/24", "tenant_ns": [{"tenant_ns_if": "t3ns2if", "tenant_ns_ip": "10.1.22.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s2if", "tenant_sub_ip": "10.1.22.2/24"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, {"brif": "t3br2if1", "disk": "10G", "mem": 3, "name": "t3_VM3", "vcpu": 2, "vmif": "t3VM3if1"}], "rc": 0, "start": "2019-11-18 08:21:19.659746", "stderr": "", "stderr_lines": [], "stdout": "56: t3br2if1@t3VM3if1: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP mode DEFAULT group default qlen 1000\n    link/ether fe:66:5c:b5:23:5f brd ff:ff:ff:ff:ff:ff", "stdout_lines": ["56: t3br2if1@t3VM3if1: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP mode DEFAULT group default qlen 1000", "    link/ether fe:66:5c:b5:23:5f brd ff:ff:ff:ff:ff:ff"]}

TASK [All interfaces and bridges UP] ************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.21.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.1.21.1', u'bridge_name': u't3br1', u'dns': [{u'dnsif': u't3s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't3s1_dnsbrif'}], u'ns_name': u't3ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.21.2/24', u'tenant_ns_ip': u'10.1.21.1/24', u'tenant_ns_if': u't3ns1if', u'tenant_sub_if': u't3s1if', u'tenant_ns_name': u't3'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.1.21.2', u'dsport': 4789, u'dev': u't3s1if', u'tenant_route_ip': u'192.168.3.2', u'remote_route': u'10.2.21.0/24', u'subnet_route': u'10.1.21.0/24', u'v_name': u'vxlan_t3s1', u'id': 42, u'remote_ip': u'10.2.21.2'}]}, {u'mem': 2, u'name': u't3_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't3br1if1', u'vmif': u't3VM1if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t3ns1\" ip link set \"t3br1if1\" up\nip netns exec \"t3ns1\" ip link set dev \"t3br1\" up\n", "delta": "0:00:00.074032", "end": "2019-11-18 08:21:20.097317", "item": [{"bridge_name": "t3br1", "default_route_ip": "10.1.21.1", "dns": [{"brif": "t3s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t3s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t3ns1", "route": [{"if": "p1", "ip": "10.1.21.1/24", "ns_if": "t3if", "ns_name": "t3"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t3ns1if", "tenant_ns_ip": "10.1.21.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s1if", "tenant_sub_ip": "10.1.21.2/24"}], "vxlan": [{"dev": "t3s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.21.2", "remote_ip": "10.2.21.2", "remote_route": "10.2.21.0/24", "subnet_route": "10.1.21.0/24", "tenant_route_ip": "192.168.3.2", "v_name": "vxlan_t3s1"}]}, {"brif": "t3br1if1", "disk": "10G", "mem": 2, "name": "t3_VM1", "vcpu": 4, "vmif": "t3VM1if1"}], "rc": 0, "start": "2019-11-18 08:21:20.023285", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.21.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.1.21.1', u'bridge_name': u't3br1', u'dns': [{u'dnsif': u't3s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't3s1_dnsbrif'}], u'ns_name': u't3ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.21.2/24', u'tenant_ns_ip': u'10.1.21.1/24', u'tenant_ns_if': u't3ns1if', u'tenant_sub_if': u't3s1if', u'tenant_ns_name': u't3'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.1.21.2', u'dsport': 4789, u'dev': u't3s1if', u'tenant_route_ip': u'192.168.3.2', u'remote_route': u'10.2.21.0/24', u'subnet_route': u'10.1.21.0/24', u'v_name': u'vxlan_t3s1', u'id': 42, u'remote_ip': u'10.2.21.2'}]}, {u'mem': 4, u'name': u't3_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't3br1if2', u'vmif': u't3VM2if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t3ns1\" ip link set \"t3br1if2\" up\nip netns exec \"t3ns1\" ip link set dev \"t3br1\" up\n", "delta": "0:00:00.070540", "end": "2019-11-18 08:21:20.361258", "item": [{"bridge_name": "t3br1", "default_route_ip": "10.1.21.1", "dns": [{"brif": "t3s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t3s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t3ns1", "route": [{"if": "p1", "ip": "10.1.21.1/24", "ns_if": "t3if", "ns_name": "t3"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t3ns1if", "tenant_ns_ip": "10.1.21.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s1if", "tenant_sub_ip": "10.1.21.2/24"}], "vxlan": [{"dev": "t3s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.21.2", "remote_ip": "10.2.21.2", "remote_route": "10.2.21.0/24", "subnet_route": "10.1.21.0/24", "tenant_route_ip": "192.168.3.2", "v_name": "vxlan_t3s1"}]}, {"brif": "t3br1if2", "disk": "10G", "mem": 4, "name": "t3_VM2", "vcpu": 2, "vmif": "t3VM2if1"}], "rc": 0, "start": "2019-11-18 08:21:20.290718", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.22.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.1.22.1', u'bridge_name': u't3br2', u'dns': [{u'dnsif': u't3s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't3s2_dnsbrif'}], u'ns_name': u't3ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.22.2/24', u'tenant_ns_ip': u'10.1.22.1/24', u'tenant_ns_if': u't3ns2if', u'tenant_sub_if': u't3s2if', u'tenant_ns_name': u't3'}], u'subnet_ip': u'2.2.2.0/24', u'vxlan': [{u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}, {u'mem': 3, u'name': u't3_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't3br2if1', u'vmif': u't3VM3if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t3ns2\" ip link set \"t3br2if1\" up\nip netns exec \"t3ns2\" ip link set dev \"t3br2\" up\n", "delta": "0:00:00.074745", "end": "2019-11-18 08:21:20.621395", "item": [{"bridge_name": "t3br2", "default_route_ip": "10.1.22.1", "dns": [{"brif": "t3s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t3s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t3ns2", "route": [{"if": "p1", "ip": "10.1.22.1/24", "ns_if": "t3if", "ns_name": "t3"}], "subnet_ip": "2.2.2.0/24", "tenant_ns": [{"tenant_ns_if": "t3ns2if", "tenant_ns_ip": "10.1.22.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s2if", "tenant_sub_ip": "10.1.22.2/24"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, {"brif": "t3br2if1", "disk": "10G", "mem": 3, "name": "t3_VM3", "vcpu": 2, "vmif": "t3VM3if1"}], "rc": 0, "start": "2019-11-18 08:21:20.546650", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Add IP to DNS Interface] ******************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.21.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.1.21.1', u'bridge_name': u't3br1', u'ns_name': u't3ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.21.2/24', u'tenant_ns_ip': u'10.1.21.1/24', u'tenant_ns_if': u't3ns1if', u'tenant_sub_if': u't3s1if', u'tenant_ns_name': u't3'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't3_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't3br1if1', u'vmif': u't3VM1if1'}, {u'mem': 4, u'name': u't3_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't3br1if2', u'vmif': u't3VM2if1'}], u'vxlan': [{u'local_ip': u'10.1.21.2', u'dsport': 4789, u'dev': u't3s1if', u'tenant_route_ip': u'192.168.3.2', u'remote_route': u'10.2.21.0/24', u'subnet_route': u'10.1.21.0/24', u'v_name': u'vxlan_t3s1', u'id': 42, u'remote_ip': u'10.2.21.2'}]}, {u'dnsif': u't3s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't3s1_dnsbrif'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t3ns1\" ip addr show \"t3s1_dnsif\" | awk 'FNR==3{ print $2 }' | grep -w '^1.1.1.1/24' ; if [ $? -ne 0 ] ; then ip netns exec \"t3ns1\" ip addr add \"1.1.1.1/24\" dev \"t3s1_dnsif\" ; fi\n", "delta": "0:00:00.068654", "end": "2019-11-18 08:21:20.973385", "item": [{"bridge_name": "t3br1", "default_route_ip": "10.1.21.1", "ns_name": "t3ns1", "route": [{"if": "p1", "ip": "10.1.21.1/24", "ns_if": "t3if", "ns_name": "t3"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t3ns1if", "tenant_ns_ip": "10.1.21.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s1if", "tenant_sub_ip": "10.1.21.2/24"}], "vms": [{"brif": "t3br1if1", "disk": "10G", "mem": 2, "name": "t3_VM1", "vcpu": 4, "vmif": "t3VM1if1"}, {"brif": "t3br1if2", "disk": "10G", "mem": 4, "name": "t3_VM2", "vcpu": 2, "vmif": "t3VM2if1"}], "vxlan": [{"dev": "t3s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.21.2", "remote_ip": "10.2.21.2", "remote_route": "10.2.21.0/24", "subnet_route": "10.1.21.0/24", "tenant_route_ip": "192.168.3.2", "v_name": "vxlan_t3s1"}]}, {"brif": "t3s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t3s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "rc": 0, "start": "2019-11-18 08:21:20.904731", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.22.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.1.22.1', u'bridge_name': u't3br2', u'ns_name': u't3ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.22.2/24', u'tenant_ns_ip': u'10.1.22.1/24', u'tenant_ns_if': u't3ns2if', u'tenant_sub_if': u't3s2if', u'tenant_ns_name': u't3'}], u'subnet_ip': u'2.2.2.0/24', u'vms': [{u'mem': 3, u'name': u't3_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't3br2if1', u'vmif': u't3VM3if1'}], u'vxlan': [{u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}, {u'dnsif': u't3s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't3s2_dnsbrif'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t3ns2\" ip addr show \"t3s2_dnsif\" | awk 'FNR==3{ print $2 }' | grep -w '^2.2.2.1/24' ; if [ $? -ne 0 ] ; then ip netns exec \"t3ns2\" ip addr add \"2.2.2.1/24\" dev \"t3s2_dnsif\" ; fi\n", "delta": "0:00:00.079707", "end": "2019-11-18 08:21:21.277417", "item": [{"bridge_name": "t3br2", "default_route_ip": "10.1.22.1", "ns_name": "t3ns2", "route": [{"if": "p1", "ip": "10.1.22.1/24", "ns_if": "t3if", "ns_name": "t3"}], "subnet_ip": "2.2.2.0/24", "tenant_ns": [{"tenant_ns_if": "t3ns2if", "tenant_ns_ip": "10.1.22.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s2if", "tenant_sub_ip": "10.1.22.2/24"}], "vms": [{"brif": "t3br2if1", "disk": "10G", "mem": 3, "name": "t3_VM3", "vcpu": 2, "vmif": "t3VM3if1"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, {"brif": "t3s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t3s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "rc": 0, "start": "2019-11-18 08:21:21.197710", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Install DHCP Server] **********************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.21.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.1.21.1', u'bridge_name': u't3br1', u'ns_name': u't3ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.21.2/24', u'tenant_ns_ip': u'10.1.21.1/24', u'tenant_ns_if': u't3ns1if', u'tenant_sub_if': u't3s1if', u'tenant_ns_name': u't3'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't3_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't3br1if1', u'vmif': u't3VM1if1'}, {u'mem': 4, u'name': u't3_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't3br1if2', u'vmif': u't3VM2if1'}], u'vxlan': [{u'local_ip': u'10.1.21.2', u'dsport': 4789, u'dev': u't3s1if', u'tenant_route_ip': u'192.168.3.2', u'remote_route': u'10.2.21.0/24', u'subnet_route': u'10.1.21.0/24', u'v_name': u'vxlan_t3s1', u'id': 42, u'remote_ip': u'10.2.21.2'}]}, {u'dnsif': u't3s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't3s1_dnsbrif'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t3ns1\" ps aux | grep -w '[d]nsmasq --interface t3s1_dnsif -z --dhcp-range=1.1.1.5,1.1.1.126' ; if [ $? -ne 0 ] ; then ip netns exec \"t3ns1\" dnsmasq --interface \"t3s1_dnsif\" -z --dhcp-range=1.1.1.5,'1.1.1.126' ; fi\n", "delta": "0:00:00.082701", "end": "2019-11-18 08:21:21.659069", "item": [{"bridge_name": "t3br1", "default_route_ip": "10.1.21.1", "ns_name": "t3ns1", "route": [{"if": "p1", "ip": "10.1.21.1/24", "ns_if": "t3if", "ns_name": "t3"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t3ns1if", "tenant_ns_ip": "10.1.21.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s1if", "tenant_sub_ip": "10.1.21.2/24"}], "vms": [{"brif": "t3br1if1", "disk": "10G", "mem": 2, "name": "t3_VM1", "vcpu": 4, "vmif": "t3VM1if1"}, {"brif": "t3br1if2", "disk": "10G", "mem": 4, "name": "t3_VM2", "vcpu": 2, "vmif": "t3VM2if1"}], "vxlan": [{"dev": "t3s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.21.2", "remote_ip": "10.2.21.2", "remote_route": "10.2.21.0/24", "subnet_route": "10.1.21.0/24", "tenant_route_ip": "192.168.3.2", "v_name": "vxlan_t3s1"}]}, {"brif": "t3s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t3s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "rc": 0, "start": "2019-11-18 08:21:21.576368", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.22.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.1.22.1', u'bridge_name': u't3br2', u'ns_name': u't3ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.22.2/24', u'tenant_ns_ip': u'10.1.22.1/24', u'tenant_ns_if': u't3ns2if', u'tenant_sub_if': u't3s2if', u'tenant_ns_name': u't3'}], u'subnet_ip': u'2.2.2.0/24', u'vms': [{u'mem': 3, u'name': u't3_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't3br2if1', u'vmif': u't3VM3if1'}], u'vxlan': [{u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}, {u'dnsif': u't3s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't3s2_dnsbrif'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t3ns2\" ps aux | grep -w '[d]nsmasq --interface t3s2_dnsif -z --dhcp-range=2.2.2.5,2.2.2.254' ; if [ $? -ne 0 ] ; then ip netns exec \"t3ns2\" dnsmasq --interface \"t3s2_dnsif\" -z --dhcp-range=2.2.2.5,'2.2.2.254' ; fi\n", "delta": "0:00:00.076442", "end": "2019-11-18 08:21:21.977431", "item": [{"bridge_name": "t3br2", "default_route_ip": "10.1.22.1", "ns_name": "t3ns2", "route": [{"if": "p1", "ip": "10.1.22.1/24", "ns_if": "t3if", "ns_name": "t3"}], "subnet_ip": "2.2.2.0/24", "tenant_ns": [{"tenant_ns_if": "t3ns2if", "tenant_ns_ip": "10.1.22.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s2if", "tenant_sub_ip": "10.1.22.2/24"}], "vms": [{"brif": "t3br2if1", "disk": "10G", "mem": 3, "name": "t3_VM3", "vcpu": 2, "vmif": "t3VM3if1"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, {"brif": "t3s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t3s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "rc": 0, "start": "2019-11-18 08:21:21.900989", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Create VXLAN devices] *********************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.21.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.1.21.1', u'bridge_name': u't3br1', u'dns': [{u'dnsif': u't3s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't3s1_dnsbrif'}], u'ns_name': u't3ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.21.2/24', u'tenant_ns_ip': u'10.1.21.1/24', u'tenant_ns_if': u't3ns1if', u'tenant_sub_if': u't3s1if', u'tenant_ns_name': u't3'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't3_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't3br1if1', u'vmif': u't3VM1if1'}, {u'mem': 4, u'name': u't3_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't3br1if2', u'vmif': u't3VM2if1'}]}, {u'local_ip': u'10.1.21.2', u'dsport': 4789, u'dev': u't3s1if', u'tenant_route_ip': u'192.168.3.2', u'remote_route': u'10.2.21.0/24', u'subnet_route': u'10.1.21.0/24', u'v_name': u'vxlan_t3s1', u'id': 42, u'remote_ip': u'10.2.21.2'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t3ns1\" ip link show \"vxlan_t3s1\" ; if [ $? -ne 0 ] ; then ip netns exec \"t3ns1\" ip link add \"vxlan_t3s1\" type vxlan id \"42\" local \"10.1.21.2\" remote \"10.2.21.2\" dstport \"4789\" dev \"t3s1if\"; ip netns exec \"t3ns1\" ip link set dev \"vxlan_t3s1\" up ; fi\n", "delta": "0:00:00.104069", "end": "2019-11-18 08:21:22.385311", "item": [{"bridge_name": "t3br1", "default_route_ip": "10.1.21.1", "dns": [{"brif": "t3s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t3s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t3ns1", "route": [{"if": "p1", "ip": "10.1.21.1/24", "ns_if": "t3if", "ns_name": "t3"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t3ns1if", "tenant_ns_ip": "10.1.21.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s1if", "tenant_sub_ip": "10.1.21.2/24"}], "vms": [{"brif": "t3br1if1", "disk": "10G", "mem": 2, "name": "t3_VM1", "vcpu": 4, "vmif": "t3VM1if1"}, {"brif": "t3br1if2", "disk": "10G", "mem": 4, "name": "t3_VM2", "vcpu": 2, "vmif": "t3VM2if1"}]}, {"dev": "t3s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.21.2", "remote_ip": "10.2.21.2", "remote_route": "10.2.21.0/24", "subnet_route": "10.1.21.0/24", "tenant_route_ip": "192.168.3.2", "v_name": "vxlan_t3s1"}], "rc": 0, "start": "2019-11-18 08:21:22.281242", "stderr": "Device \"vxlan_t3s1\" does not exist.", "stderr_lines": ["Device \"vxlan_t3s1\" does not exist."], "stdout": "", "stdout_lines": []}
skipping: [localhost] => (item=[{u'route': [{u'ip': u'10.1.22.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.1.22.1', u'bridge_name': u't3br2', u'dns': [{u'dnsif': u't3s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't3s2_dnsbrif'}], u'ns_name': u't3ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.22.2/24', u'tenant_ns_ip': u'10.1.22.1/24', u'tenant_ns_if': u't3ns2if', u'tenant_sub_if': u't3s2if', u'tenant_ns_name': u't3'}], u'subnet_ip': u'2.2.2.0/24', u'vms': [{u'mem': 3, u'name': u't3_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't3br2if1', u'vmif': u't3VM3if1'}]}, {u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}])  => {"ansible_loop_var": "item", "changed": false, "item": [{"bridge_name": "t3br2", "default_route_ip": "10.1.22.1", "dns": [{"brif": "t3s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t3s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t3ns2", "route": [{"if": "p1", "ip": "10.1.22.1/24", "ns_if": "t3if", "ns_name": "t3"}], "subnet_ip": "2.2.2.0/24", "tenant_ns": [{"tenant_ns_if": "t3ns2if", "tenant_ns_ip": "10.1.22.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s2if", "tenant_sub_ip": "10.1.22.2/24"}], "vms": [{"brif": "t3br2if1", "disk": "10G", "mem": 3, "name": "t3_VM3", "vcpu": 2, "vmif": "t3VM3if1"}]}, {"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}], "skip_reason": "Conditional result was False"}

TASK [Attach VXLANs to bridge] ******************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.21.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.1.21.1', u'bridge_name': u't3br1', u'dns': [{u'dnsif': u't3s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't3s1_dnsbrif'}], u'ns_name': u't3ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.21.2/24', u'tenant_ns_ip': u'10.1.21.1/24', u'tenant_ns_if': u't3ns1if', u'tenant_sub_if': u't3s1if', u'tenant_ns_name': u't3'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't3_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't3br1if1', u'vmif': u't3VM1if1'}, {u'mem': 4, u'name': u't3_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't3br1if2', u'vmif': u't3VM2if1'}]}, {u'local_ip': u'10.1.21.2', u'dsport': 4789, u'dev': u't3s1if', u'tenant_route_ip': u'192.168.3.2', u'remote_route': u'10.2.21.0/24', u'subnet_route': u'10.1.21.0/24', u'v_name': u'vxlan_t3s1', u'id': 42, u'remote_ip': u'10.2.21.2'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t3ns1\" brctl show \"t3br1\" | grep -w 'vxlan_t3s1' ; if [ $? -ne 0 ] ; then ip netns exec \"t3ns1\" brctl addif \"t3br1\" \"vxlan_t3s1\" ; fi\n", "delta": "0:00:00.068941", "end": "2019-11-18 08:21:22.757389", "item": [{"bridge_name": "t3br1", "default_route_ip": "10.1.21.1", "dns": [{"brif": "t3s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t3s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t3ns1", "route": [{"if": "p1", "ip": "10.1.21.1/24", "ns_if": "t3if", "ns_name": "t3"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t3ns1if", "tenant_ns_ip": "10.1.21.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s1if", "tenant_sub_ip": "10.1.21.2/24"}], "vms": [{"brif": "t3br1if1", "disk": "10G", "mem": 2, "name": "t3_VM1", "vcpu": 4, "vmif": "t3VM1if1"}, {"brif": "t3br1if2", "disk": "10G", "mem": 4, "name": "t3_VM2", "vcpu": 2, "vmif": "t3VM2if1"}]}, {"dev": "t3s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.21.2", "remote_ip": "10.2.21.2", "remote_route": "10.2.21.0/24", "subnet_route": "10.1.21.0/24", "tenant_route_ip": "192.168.3.2", "v_name": "vxlan_t3s1"}], "rc": 0, "start": "2019-11-18 08:21:22.688448", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}
skipping: [localhost] => (item=[{u'route': [{u'ip': u'10.1.22.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.1.22.1', u'bridge_name': u't3br2', u'dns': [{u'dnsif': u't3s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't3s2_dnsbrif'}], u'ns_name': u't3ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.22.2/24', u'tenant_ns_ip': u'10.1.22.1/24', u'tenant_ns_if': u't3ns2if', u'tenant_sub_if': u't3s2if', u'tenant_ns_name': u't3'}], u'subnet_ip': u'2.2.2.0/24', u'vms': [{u'mem': 3, u'name': u't3_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't3br2if1', u'vmif': u't3VM3if1'}]}, {u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}])  => {"ansible_loop_var": "item", "changed": false, "item": [{"bridge_name": "t3br2", "default_route_ip": "10.1.22.1", "dns": [{"brif": "t3s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t3s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t3ns2", "route": [{"if": "p1", "ip": "10.1.22.1/24", "ns_if": "t3if", "ns_name": "t3"}], "subnet_ip": "2.2.2.0/24", "tenant_ns": [{"tenant_ns_if": "t3ns2if", "tenant_ns_ip": "10.1.22.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s2if", "tenant_sub_ip": "10.1.22.2/24"}], "vms": [{"brif": "t3br2if1", "disk": "10G", "mem": 3, "name": "t3_VM3", "vcpu": 2, "vmif": "t3VM3if1"}]}, {"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}], "skip_reason": "Conditional result was False"}

PLAY RECAP **************************************************************************************************************************************************
localhost                  : ok=21   changed=21   unreachable=0    failed=0    skipped=0    rescued=0    ignored=0   

Using /etc/ansible/ansible.cfg as config file

PLAY [worker] ***********************************************************************************************************************************************

TASK [Create Tenant Namespace] ******************************************************************************************************************************
changed: [99.99.99.2] => (item={u'default_route_ip': u'192.168.131.1', u'name': u't3', u'pns_ip': u'192.168.131.1/24', u'tenant_if': u't3if', u'tenant_ip': u'192.168.131.2/24', u'pns_if': u't3pns_if'}) => {"ansible_loop_var": "item", "changed": true, "cmd": ["ip", "netns", "add", "t3"], "delta": "0:00:00.056604", "end": "2019-11-18 08:21:24.667080", "item": {"default_route_ip": "192.168.131.1", "name": "t3", "pns_if": "t3pns_if", "pns_ip": "192.168.131.1/24", "tenant_if": "t3if", "tenant_ip": "192.168.131.2/24"}, "rc": 0, "start": "2019-11-18 08:21:24.610476", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Create Subnet Namespace] ******************************************************************************************************************************
changed: [99.99.99.2] => (item={u'route': [{u'ip': u'10.2.21.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.2.21.1', u'bridge_name': u't3br1', u'dns': [{u'dnsif': u't3s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't3s1_dnsbrif'}], u'ns_name': u't3ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.21.2/24', u'tenant_ns_ip': u'10.2.21.1/24', u'tenant_ns_if': u't3ns1if', u'tenant_ns_name': u't3', u'tenant_sub_if': u't3s1if'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't3_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't3br1if1', u'vmif': u't3VM4if1'}], u'vxlan': [{u'local_ip': u'10.2.21.2', u'tenant_route_ip': u'192.168.131.2', u'dsport': 4789, u'dev': u't3s1if', u'subnet_route': u'10.2.21.0/24', u'remote_route': u'10.1.21.0/24', u'v_name': u'vxlan_t3s1', u'id': 42, u'remote_ip': u'10.1.21.2'}]}) => {"ansible_loop_var": "item", "changed": true, "cmd": ["ip", "netns", "add", "t3ns1"], "delta": "0:00:00.051684", "end": "2019-11-18 08:21:25.090705", "item": {"bridge_name": "t3br1", "default_route_ip": "10.2.21.1", "dns": [{"brif": "t3s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t3s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "ns_name": "t3ns1", "route": [{"if": "p1", "ip": "10.2.21.1/24", "ns_if": "t3if", "ns_name": "t3"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t3ns1if", "tenant_ns_ip": "10.2.21.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s1if", "tenant_sub_ip": "10.2.21.2/24"}], "vms": [{"brif": "t3br1if1", "disk": "10G", "mem": 2, "name": "t3_VM4", "vcpu": 4, "vmif": "t3VM4if1"}], "vxlan": [{"dev": "t3s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.21.2", "remote_ip": "10.1.21.2", "remote_route": "10.1.21.0/24", "subnet_route": "10.2.21.0/24", "tenant_route_ip": "192.168.131.2", "v_name": "vxlan_t3s1"}]}, "rc": 0, "start": "2019-11-18 08:21:25.039021", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Create Tenant VETH pairs] *****************************************************************************************************************************
changed: [99.99.99.2] => (item={u'default_route_ip': u'192.168.131.1', u'name': u't3', u'pns_ip': u'192.168.131.1/24', u'tenant_if': u't3if', u'tenant_ip': u'192.168.131.2/24', u'pns_if': u't3pns_if'}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip link show \"t3if\" ; if [ $? -ne 0 ] ; then ip link add \"t3if\" type veth peer name \"t3pns_if\" ; fi\n", "delta": "0:00:00.012465", "end": "2019-11-18 08:21:25.469902", "item": {"default_route_ip": "192.168.131.1", "name": "t3", "pns_if": "t3pns_if", "pns_ip": "192.168.131.1/24", "tenant_if": "t3if", "tenant_ip": "192.168.131.2/24"}, "rc": 0, "start": "2019-11-18 08:21:25.457437", "stderr": "Device \"t3if\" does not exist.", "stderr_lines": ["Device \"t3if\" does not exist."], "stdout": "", "stdout_lines": []}

TASK [Attach Tenant VETH Pairs] *****************************************************************************************************************************
changed: [99.99.99.2] => (item={u'default_route_ip': u'192.168.131.1', u'name': u't3', u'pns_ip': u'192.168.131.1/24', u'tenant_if': u't3if', u'tenant_ip': u'192.168.131.2/24', u'pns_if': u't3pns_if'}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec pns ip link show \"t3pns_if\" ; if [ $? -ne 0 ] ; then ip link set \"t3pns_if\" netns pns ; fi\nip netns exec \"t3\" ip link show \"t3if\" ; if [ $? -ne 0 ] ; then ip link set \"t3if\" netns \"t3\" ; fi\nip netns exec pns ip link set dev \"t3pns_if\" up\nip netns exec \"t3\" ip link set dev \"t3if\" up\n", "delta": "0:00:00.180929", "end": "2019-11-18 08:21:26.034269", "item": {"default_route_ip": "192.168.131.1", "name": "t3", "pns_if": "t3pns_if", "pns_ip": "192.168.131.1/24", "tenant_if": "t3if", "tenant_ip": "192.168.131.2/24"}, "rc": 0, "start": "2019-11-18 08:21:25.853340", "stderr": "Device \"t3pns_if\" does not exist.\nDevice \"t3if\" does not exist.", "stderr_lines": ["Device \"t3pns_if\" does not exist.", "Device \"t3if\" does not exist."], "stdout": "", "stdout_lines": []}

TASK [Add IP addresses to Tenant VETH Pairs] ****************************************************************************************************************
changed: [99.99.99.2] => (item={u'default_route_ip': u'192.168.131.1', u'name': u't3', u'pns_ip': u'192.168.131.1/24', u'tenant_if': u't3if', u'tenant_ip': u'192.168.131.2/24', u'pns_if': u't3pns_if'}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec pns ip addr show \"t3pns_if\" | awk 'FNR==3{ print $2 }' | grep -w '^192.168.131.1/24' ; if [ $? -ne 0 ] ; then ip netns exec pns ip addr add \"192.168.131.1/24\" dev \"t3pns_if\" ; fi\nip netns exec \"t3\" ip addr show \"t3if\" | awk 'FNR==3{ print $2 }' | grep -w '^192.168.131.2/24' ; if [ $? -ne 0 ] ; then ip netns exec \"t3\" ip addr add \"192.168.131.2/24\" dev \"t3if\" ; fi\n", "delta": "0:00:00.147413", "end": "2019-11-18 08:21:26.558471", "item": {"default_route_ip": "192.168.131.1", "name": "t3", "pns_if": "t3pns_if", "pns_ip": "192.168.131.1/24", "tenant_if": "t3if", "tenant_ip": "192.168.131.2/24"}, "rc": 0, "start": "2019-11-18 08:21:26.411058", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Create Namespace VETH Pairs] **************************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.21.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.2.21.1', u'bridge_name': u't3br1', u'dns': [{u'dnsif': u't3s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't3s1_dnsbrif'}], u'ns_name': u't3ns1', u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't3_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't3br1if1', u'vmif': u't3VM4if1'}], u'vxlan': [{u'local_ip': u'10.2.21.2', u'dsport': 4789, u'dev': u't3s1if', u'tenant_route_ip': u'192.168.131.2', u'remote_route': u'10.1.21.0/24', u'subnet_route': u'10.2.21.0/24', u'v_name': u'vxlan_t3s1', u'id': 42, u'remote_ip': u'10.1.21.2'}]}, {u'tenant_sub_ip': u'10.2.21.2/24', u'tenant_ns_ip': u'10.2.21.1/24', u'tenant_ns_if': u't3ns1if', u'tenant_sub_if': u't3s1if', u'tenant_ns_name': u't3'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip link show \"t3ns1if\" ; if [ $? -ne 0 ] ; then ip link add \"t3ns1if\" type veth peer name \"t3s1if\" ; fi\n", "delta": "0:00:00.011818", "end": "2019-11-18 08:21:26.940629", "item": [{"bridge_name": "t3br1", "default_route_ip": "10.2.21.1", "dns": [{"brif": "t3s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t3s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "ns_name": "t3ns1", "route": [{"if": "p1", "ip": "10.2.21.1/24", "ns_if": "t3if", "ns_name": "t3"}], "subnet_ip": "1.1.1.0/24", "vms": [{"brif": "t3br1if1", "disk": "10G", "mem": 2, "name": "t3_VM4", "vcpu": 4, "vmif": "t3VM4if1"}], "vxlan": [{"dev": "t3s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.21.2", "remote_ip": "10.1.21.2", "remote_route": "10.1.21.0/24", "subnet_route": "10.2.21.0/24", "tenant_route_ip": "192.168.131.2", "v_name": "vxlan_t3s1"}]}, {"tenant_ns_if": "t3ns1if", "tenant_ns_ip": "10.2.21.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s1if", "tenant_sub_ip": "10.2.21.2/24"}], "rc": 0, "start": "2019-11-18 08:21:26.928811", "stderr": "Device \"t3ns1if\" does not exist.", "stderr_lines": ["Device \"t3ns1if\" does not exist."], "stdout": "", "stdout_lines": []}

TASK [Attach Namespace VETH Pairs] **************************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.21.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.2.21.1', u'bridge_name': u't3br1', u'dns': [{u'dnsif': u't3s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't3s1_dnsbrif'}], u'ns_name': u't3ns1', u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't3_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't3br1if1', u'vmif': u't3VM4if1'}], u'vxlan': [{u'local_ip': u'10.2.21.2', u'dsport': 4789, u'dev': u't3s1if', u'tenant_route_ip': u'192.168.131.2', u'remote_route': u'10.1.21.0/24', u'subnet_route': u'10.2.21.0/24', u'v_name': u'vxlan_t3s1', u'id': 42, u'remote_ip': u'10.1.21.2'}]}, {u'tenant_sub_ip': u'10.2.21.2/24', u'tenant_ns_ip': u'10.2.21.1/24', u'tenant_ns_if': u't3ns1if', u'tenant_sub_if': u't3s1if', u'tenant_ns_name': u't3'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t3\" ip link show \"t3ns1if\" ; if [ $? -ne 0 ] ; then ip link set \"t3ns1if\" netns \"t3\" ; fi\nip netns exec \"t3ns1\" ip link show \"t3s1if\" ; if [ $? -ne 0 ] ; then ip link set \"t3s1if\" netns \"t3ns1\" ; fi\n", "delta": "0:00:00.134866", "end": "2019-11-18 08:21:27.493417", "item": [{"bridge_name": "t3br1", "default_route_ip": "10.2.21.1", "dns": [{"brif": "t3s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t3s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "ns_name": "t3ns1", "route": [{"if": "p1", "ip": "10.2.21.1/24", "ns_if": "t3if", "ns_name": "t3"}], "subnet_ip": "1.1.1.0/24", "vms": [{"brif": "t3br1if1", "disk": "10G", "mem": 2, "name": "t3_VM4", "vcpu": 4, "vmif": "t3VM4if1"}], "vxlan": [{"dev": "t3s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.21.2", "remote_ip": "10.1.21.2", "remote_route": "10.1.21.0/24", "subnet_route": "10.2.21.0/24", "tenant_route_ip": "192.168.131.2", "v_name": "vxlan_t3s1"}]}, {"tenant_ns_if": "t3ns1if", "tenant_ns_ip": "10.2.21.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s1if", "tenant_sub_ip": "10.2.21.2/24"}], "rc": 0, "start": "2019-11-18 08:21:27.358551", "stderr": "Device \"t3ns1if\" does not exist.\nDevice \"t3s1if\" does not exist.", "stderr_lines": ["Device \"t3ns1if\" does not exist.", "Device \"t3s1if\" does not exist."], "stdout": "", "stdout_lines": []}

TASK [Set Namespace VETH Pairs UP] **************************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.21.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.2.21.1', u'bridge_name': u't3br1', u'dns': [{u'dnsif': u't3s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't3s1_dnsbrif'}], u'ns_name': u't3ns1', u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't3_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't3br1if1', u'vmif': u't3VM4if1'}], u'vxlan': [{u'local_ip': u'10.2.21.2', u'dsport': 4789, u'dev': u't3s1if', u'tenant_route_ip': u'192.168.131.2', u'remote_route': u'10.1.21.0/24', u'subnet_route': u'10.2.21.0/24', u'v_name': u'vxlan_t3s1', u'id': 42, u'remote_ip': u'10.1.21.2'}]}, {u'tenant_sub_ip': u'10.2.21.2/24', u'tenant_ns_ip': u'10.2.21.1/24', u'tenant_ns_if': u't3ns1if', u'tenant_sub_if': u't3s1if', u'tenant_ns_name': u't3'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t3\" ip link set dev \"t3ns1if\" up\nip netns exec \"t3ns1\" ip link set dev \"t3s1if\" up\n", "delta": "0:00:00.081032", "end": "2019-11-18 08:21:27.978312", "item": [{"bridge_name": "t3br1", "default_route_ip": "10.2.21.1", "dns": [{"brif": "t3s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t3s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "ns_name": "t3ns1", "route": [{"if": "p1", "ip": "10.2.21.1/24", "ns_if": "t3if", "ns_name": "t3"}], "subnet_ip": "1.1.1.0/24", "vms": [{"brif": "t3br1if1", "disk": "10G", "mem": 2, "name": "t3_VM4", "vcpu": 4, "vmif": "t3VM4if1"}], "vxlan": [{"dev": "t3s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.21.2", "remote_ip": "10.1.21.2", "remote_route": "10.1.21.0/24", "subnet_route": "10.2.21.0/24", "tenant_route_ip": "192.168.131.2", "v_name": "vxlan_t3s1"}]}, {"tenant_ns_if": "t3ns1if", "tenant_ns_ip": "10.2.21.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s1if", "tenant_sub_ip": "10.2.21.2/24"}], "rc": 0, "start": "2019-11-18 08:21:27.897280", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Add IP addresses to Namespace VETH Pairs] *************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.21.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.2.21.1', u'bridge_name': u't3br1', u'dns': [{u'dnsif': u't3s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't3s1_dnsbrif'}], u'ns_name': u't3ns1', u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't3_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't3br1if1', u'vmif': u't3VM4if1'}], u'vxlan': [{u'local_ip': u'10.2.21.2', u'dsport': 4789, u'dev': u't3s1if', u'tenant_route_ip': u'192.168.131.2', u'remote_route': u'10.1.21.0/24', u'subnet_route': u'10.2.21.0/24', u'v_name': u'vxlan_t3s1', u'id': 42, u'remote_ip': u'10.1.21.2'}]}, {u'tenant_sub_ip': u'10.2.21.2/24', u'tenant_ns_ip': u'10.2.21.1/24', u'tenant_ns_if': u't3ns1if', u'tenant_sub_if': u't3s1if', u'tenant_ns_name': u't3'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t3ns1\" ip addr show \"t3s1if\" | awk 'FNR==3{ print $2 }' | grep -w '^10.2.21.2/24' ; if [ $? -ne 0 ] ; then ip netns exec \"t3ns1\" ip addr add \"10.2.21.2/24\" dev \"t3s1if\" ; fi\n\nip netns exec \"t3\" ip addr show \"t3ns1if\" | awk 'FNR==3{ print $2 }' | grep -w '^10.2.21.1/24' ; if [ $? -ne 0 ] ; then ip netns exec \"t3\" ip addr add \"10.2.21.1/24\" dev \"t3ns1if\" ; fi\n", "delta": "0:00:00.146721", "end": "2019-11-18 08:21:28.534366", "item": [{"bridge_name": "t3br1", "default_route_ip": "10.2.21.1", "dns": [{"brif": "t3s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t3s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "ns_name": "t3ns1", "route": [{"if": "p1", "ip": "10.2.21.1/24", "ns_if": "t3if", "ns_name": "t3"}], "subnet_ip": "1.1.1.0/24", "vms": [{"brif": "t3br1if1", "disk": "10G", "mem": 2, "name": "t3_VM4", "vcpu": 4, "vmif": "t3VM4if1"}], "vxlan": [{"dev": "t3s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.21.2", "remote_ip": "10.1.21.2", "remote_route": "10.1.21.0/24", "subnet_route": "10.2.21.0/24", "tenant_route_ip": "192.168.131.2", "v_name": "vxlan_t3s1"}]}, {"tenant_ns_if": "t3ns1if", "tenant_ns_ip": "10.2.21.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s1if", "tenant_sub_ip": "10.2.21.2/24"}], "rc": 0, "start": "2019-11-18 08:21:28.387645", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Add IP Route to Tenant] *******************************************************************************************************************************
changed: [99.99.99.2] => (item={u'default_route_ip': u'192.168.131.1', u'name': u't3', u'pns_ip': u'192.168.131.1/24', u'tenant_if': u't3if', u'tenant_ip': u'192.168.131.2/24', u'pns_if': u't3pns_if'}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t3\" ip route show default | grep -w '[d]efault via 192.168.131.1' ; if [ $? -ne 0 ] ; then ip netns exec \"t3\" ip route add default via \"192.168.131.1\" ; fi\n", "delta": "0:00:00.088603", "end": "2019-11-18 08:21:29.018417", "item": {"default_route_ip": "192.168.131.1", "name": "t3", "pns_if": "t3pns_if", "pns_ip": "192.168.131.1/24", "tenant_if": "t3if", "tenant_ip": "192.168.131.2/24"}, "rc": 0, "start": "2019-11-18 08:21:28.929814", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Add IP Route to Tenant Subnet] ************************************************************************************************************************
changed: [99.99.99.2] => (item={u'route': [{u'ip': u'10.2.21.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.2.21.1', u'bridge_name': u't3br1', u'dns': [{u'dnsif': u't3s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't3s1_dnsbrif'}], u'ns_name': u't3ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.21.2/24', u'tenant_ns_ip': u'10.2.21.1/24', u'tenant_ns_if': u't3ns1if', u'tenant_ns_name': u't3', u'tenant_sub_if': u't3s1if'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't3_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't3br1if1', u'vmif': u't3VM4if1'}], u'vxlan': [{u'local_ip': u'10.2.21.2', u'tenant_route_ip': u'192.168.131.2', u'dsport': 4789, u'dev': u't3s1if', u'subnet_route': u'10.2.21.0/24', u'remote_route': u'10.1.21.0/24', u'v_name': u'vxlan_t3s1', u'id': 42, u'remote_ip': u'10.1.21.2'}]}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t3ns1\" ip route show default | grep -w '[d]efault via 10.2.21.1' ; if [ $? -ne 0 ] ; then ip netns exec \"t3ns1\" ip route add default via \"10.2.21.1\" ; fi\n", "delta": "0:00:00.077485", "end": "2019-11-18 08:21:29.494381", "item": {"bridge_name": "t3br1", "default_route_ip": "10.2.21.1", "dns": [{"brif": "t3s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t3s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "ns_name": "t3ns1", "route": [{"if": "p1", "ip": "10.2.21.1/24", "ns_if": "t3if", "ns_name": "t3"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t3ns1if", "tenant_ns_ip": "10.2.21.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s1if", "tenant_sub_ip": "10.2.21.2/24"}], "vms": [{"brif": "t3br1if1", "disk": "10G", "mem": 2, "name": "t3_VM4", "vcpu": 4, "vmif": "t3VM4if1"}], "vxlan": [{"dev": "t3s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.21.2", "remote_ip": "10.1.21.2", "remote_route": "10.1.21.0/24", "subnet_route": "10.2.21.0/24", "tenant_route_ip": "192.168.131.2", "v_name": "vxlan_t3s1"}]}, "rc": 0, "start": "2019-11-18 08:21:29.416896", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Create bridge inside namespace] ***********************************************************************************************************************
changed: [99.99.99.2] => (item={u'route': [{u'ip': u'10.2.21.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.2.21.1', u'bridge_name': u't3br1', u'dns': [{u'dnsif': u't3s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't3s1_dnsbrif'}], u'ns_name': u't3ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.21.2/24', u'tenant_ns_ip': u'10.2.21.1/24', u'tenant_ns_if': u't3ns1if', u'tenant_ns_name': u't3', u'tenant_sub_if': u't3s1if'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't3_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't3br1if1', u'vmif': u't3VM4if1'}], u'vxlan': [{u'local_ip': u'10.2.21.2', u'tenant_route_ip': u'192.168.131.2', u'dsport': 4789, u'dev': u't3s1if', u'subnet_route': u'10.2.21.0/24', u'remote_route': u'10.1.21.0/24', u'v_name': u'vxlan_t3s1', u'id': 42, u'remote_ip': u'10.1.21.2'}]}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t3ns1\" brctl show | grep -w '^t3br1'; if [ $? -ne 0 ] ; then ip netns exec \"t3ns1\" brctl addbr \"t3br1\" ; fi\nip netns exec \"t3ns1\" ip link set dev \"t3br1\" up\n", "delta": "0:00:00.122559", "end": "2019-11-18 08:21:29.986547", "item": {"bridge_name": "t3br1", "default_route_ip": "10.2.21.1", "dns": [{"brif": "t3s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t3s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "ns_name": "t3ns1", "route": [{"if": "p1", "ip": "10.2.21.1/24", "ns_if": "t3if", "ns_name": "t3"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t3ns1if", "tenant_ns_ip": "10.2.21.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s1if", "tenant_sub_ip": "10.2.21.2/24"}], "vms": [{"brif": "t3br1if1", "disk": "10G", "mem": 2, "name": "t3_VM4", "vcpu": 4, "vmif": "t3VM4if1"}], "vxlan": [{"dev": "t3s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.21.2", "remote_ip": "10.1.21.2", "remote_route": "10.1.21.0/24", "subnet_route": "10.2.21.0/24", "tenant_route_ip": "192.168.131.2", "v_name": "vxlan_t3s1"}]}, "rc": 0, "start": "2019-11-18 08:21:29.863988", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Create DNS VETH Pair] *********************************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.21.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.2.21.1', u'bridge_name': u't3br1', u'ns_name': u't3ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.21.2/24', u'tenant_ns_ip': u'10.2.21.1/24', u'tenant_ns_if': u't3ns1if', u'tenant_sub_if': u't3s1if', u'tenant_ns_name': u't3'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't3_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't3br1if1', u'vmif': u't3VM4if1'}], u'vxlan': [{u'local_ip': u'10.2.21.2', u'dsport': 4789, u'dev': u't3s1if', u'tenant_route_ip': u'192.168.131.2', u'remote_route': u'10.1.21.0/24', u'subnet_route': u'10.2.21.0/24', u'v_name': u'vxlan_t3s1', u'id': 42, u'remote_ip': u'10.1.21.2'}]}, {u'dnsif': u't3s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't3s1_dnsbrif'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t3ns1\" ip link show \"t3s1_dnsbrif\" ; if [ $? -ne 0 ] ; then ip netns exec \"t3ns1\" ip link add \"t3s1_dnsbrif\" type veth peer name \"t3s1_dnsif\" ; fi\nip netns exec \"t3ns1\" ip link set dev \"t3s1_dnsbrif\" up\nip netns exec \"t3ns1\" ip link set dev \"t3s1_dnsif\" up\n", "delta": "0:00:00.138628", "end": "2019-11-18 08:21:30.510393", "item": [{"bridge_name": "t3br1", "default_route_ip": "10.2.21.1", "ns_name": "t3ns1", "route": [{"if": "p1", "ip": "10.2.21.1/24", "ns_if": "t3if", "ns_name": "t3"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t3ns1if", "tenant_ns_ip": "10.2.21.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s1if", "tenant_sub_ip": "10.2.21.2/24"}], "vms": [{"brif": "t3br1if1", "disk": "10G", "mem": 2, "name": "t3_VM4", "vcpu": 4, "vmif": "t3VM4if1"}], "vxlan": [{"dev": "t3s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.21.2", "remote_ip": "10.1.21.2", "remote_route": "10.1.21.0/24", "subnet_route": "10.2.21.0/24", "tenant_route_ip": "192.168.131.2", "v_name": "vxlan_t3s1"}]}, {"brif": "t3s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t3s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "rc": 0, "start": "2019-11-18 08:21:30.371765", "stderr": "Device \"t3s1_dnsbrif\" does not exist.", "stderr_lines": ["Device \"t3s1_dnsbrif\" does not exist."], "stdout": "", "stdout_lines": []}

TASK [Attach DNS VETH Pair] *********************************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.21.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.2.21.1', u'bridge_name': u't3br1', u'ns_name': u't3ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.21.2/24', u'tenant_ns_ip': u'10.2.21.1/24', u'tenant_ns_if': u't3ns1if', u'tenant_sub_if': u't3s1if', u'tenant_ns_name': u't3'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't3_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't3br1if1', u'vmif': u't3VM4if1'}], u'vxlan': [{u'local_ip': u'10.2.21.2', u'dsport': 4789, u'dev': u't3s1if', u'tenant_route_ip': u'192.168.131.2', u'remote_route': u'10.1.21.0/24', u'subnet_route': u'10.2.21.0/24', u'v_name': u'vxlan_t3s1', u'id': 42, u'remote_ip': u'10.1.21.2'}]}, {u'dnsif': u't3s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't3s1_dnsbrif'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t3ns1\" brctl show \"t3br1\" | grep -w 't3s1_dnsbrif' ; if [ $? -ne 0 ] ; then ip netns exec \"t3ns1\" brctl addif \"t3br1\" \"t3s1_dnsbrif\" ; fi\n", "delta": "0:00:00.083700", "end": "2019-11-18 08:21:30.990270", "item": [{"bridge_name": "t3br1", "default_route_ip": "10.2.21.1", "ns_name": "t3ns1", "route": [{"if": "p1", "ip": "10.2.21.1/24", "ns_if": "t3if", "ns_name": "t3"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t3ns1if", "tenant_ns_ip": "10.2.21.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s1if", "tenant_sub_ip": "10.2.21.2/24"}], "vms": [{"brif": "t3br1if1", "disk": "10G", "mem": 2, "name": "t3_VM4", "vcpu": 4, "vmif": "t3VM4if1"}], "vxlan": [{"dev": "t3s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.21.2", "remote_ip": "10.1.21.2", "remote_route": "10.1.21.0/24", "subnet_route": "10.2.21.0/24", "tenant_route_ip": "192.168.131.2", "v_name": "vxlan_t3s1"}]}, {"brif": "t3s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t3s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "rc": 0, "start": "2019-11-18 08:21:30.906570", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Create VETH Pairs] ************************************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.21.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.2.21.1', u'bridge_name': u't3br1', u'dns': [{u'dnsif': u't3s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't3s1_dnsbrif'}], u'ns_name': u't3ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.21.2/24', u'tenant_ns_ip': u'10.2.21.1/24', u'tenant_ns_if': u't3ns1if', u'tenant_sub_if': u't3s1if', u'tenant_ns_name': u't3'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.2.21.2', u'dsport': 4789, u'dev': u't3s1if', u'tenant_route_ip': u'192.168.131.2', u'remote_route': u'10.1.21.0/24', u'subnet_route': u'10.2.21.0/24', u'v_name': u'vxlan_t3s1', u'id': 42, u'remote_ip': u'10.1.21.2'}]}, {u'mem': 2, u'name': u't3_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't3br1if1', u'vmif': u't3VM4if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip link show \"t3br1if1\" ; if [ $? -ne 0 ] ; then ip link add \"t3VM4if1\" type veth peer name \"t3br1if1\" ; fi\nip link set dev \"t3br1if1\" up\nip link set dev \"t3VM4if1\" up\n", "delta": "0:00:00.016656", "end": "2019-11-18 08:21:31.420852", "item": [{"bridge_name": "t3br1", "default_route_ip": "10.2.21.1", "dns": [{"brif": "t3s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t3s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "ns_name": "t3ns1", "route": [{"if": "p1", "ip": "10.2.21.1/24", "ns_if": "t3if", "ns_name": "t3"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t3ns1if", "tenant_ns_ip": "10.2.21.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s1if", "tenant_sub_ip": "10.2.21.2/24"}], "vxlan": [{"dev": "t3s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.21.2", "remote_ip": "10.1.21.2", "remote_route": "10.1.21.0/24", "subnet_route": "10.2.21.0/24", "tenant_route_ip": "192.168.131.2", "v_name": "vxlan_t3s1"}]}, {"brif": "t3br1if1", "disk": "10G", "mem": 2, "name": "t3_VM4", "vcpu": 4, "vmif": "t3VM4if1"}], "rc": 0, "start": "2019-11-18 08:21:31.404196", "stderr": "Device \"t3br1if1\" does not exist.", "stderr_lines": ["Device \"t3br1if1\" does not exist."], "stdout": "", "stdout_lines": []}

TASK [Attach VETH Pairs] ************************************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.21.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.2.21.1', u'bridge_name': u't3br1', u'dns': [{u'dnsif': u't3s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't3s1_dnsbrif'}], u'ns_name': u't3ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.21.2/24', u'tenant_ns_ip': u'10.2.21.1/24', u'tenant_ns_if': u't3ns1if', u'tenant_sub_if': u't3s1if', u'tenant_ns_name': u't3'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.2.21.2', u'dsport': 4789, u'dev': u't3s1if', u'tenant_route_ip': u'192.168.131.2', u'remote_route': u'10.1.21.0/24', u'subnet_route': u'10.2.21.0/24', u'v_name': u'vxlan_t3s1', u'id': 42, u'remote_ip': u'10.1.21.2'}]}, {u'mem': 2, u'name': u't3_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't3br1if1', u'vmif': u't3VM4if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip link show \"t3br1if1\" ; if [ $? -eq 0 ] ; then ip link set \"t3br1if1\" netns \"t3ns1\" ; fi\nip netns exec \"t3ns1\" brctl show \"t3br1\" | grep -w 't3br1if1' ; if [ $? -ne 0 ] ; then ip netns exec \"t3ns1\" brctl addif \"t3br1\" \"t3br1if1\" ; fi\n", "delta": "0:00:00.143221", "end": "2019-11-18 08:21:31.966467", "item": [{"bridge_name": "t3br1", "default_route_ip": "10.2.21.1", "dns": [{"brif": "t3s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t3s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "ns_name": "t3ns1", "route": [{"if": "p1", "ip": "10.2.21.1/24", "ns_if": "t3if", "ns_name": "t3"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t3ns1if", "tenant_ns_ip": "10.2.21.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s1if", "tenant_sub_ip": "10.2.21.2/24"}], "vxlan": [{"dev": "t3s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.21.2", "remote_ip": "10.1.21.2", "remote_route": "10.1.21.0/24", "subnet_route": "10.2.21.0/24", "tenant_route_ip": "192.168.131.2", "v_name": "vxlan_t3s1"}]}, {"brif": "t3br1if1", "disk": "10G", "mem": 2, "name": "t3_VM4", "vcpu": 4, "vmif": "t3VM4if1"}], "rc": 0, "start": "2019-11-18 08:21:31.823246", "stderr": "", "stderr_lines": [], "stdout": "41: t3br1if1@t3VM4if1: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP mode DEFAULT group default qlen 1000\n    link/ether 0a:7a:f6:bd:97:23 brd ff:ff:ff:ff:ff:ff", "stdout_lines": ["41: t3br1if1@t3VM4if1: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP mode DEFAULT group default qlen 1000", "    link/ether 0a:7a:f6:bd:97:23 brd ff:ff:ff:ff:ff:ff"]}

TASK [All interfaces and bridges UP] ************************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.21.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.2.21.1', u'bridge_name': u't3br1', u'dns': [{u'dnsif': u't3s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't3s1_dnsbrif'}], u'ns_name': u't3ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.21.2/24', u'tenant_ns_ip': u'10.2.21.1/24', u'tenant_ns_if': u't3ns1if', u'tenant_sub_if': u't3s1if', u'tenant_ns_name': u't3'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.2.21.2', u'dsport': 4789, u'dev': u't3s1if', u'tenant_route_ip': u'192.168.131.2', u'remote_route': u'10.1.21.0/24', u'subnet_route': u'10.2.21.0/24', u'v_name': u'vxlan_t3s1', u'id': 42, u'remote_ip': u'10.1.21.2'}]}, {u'mem': 2, u'name': u't3_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't3br1if1', u'vmif': u't3VM4if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t3ns1\" ip link set \"t3br1if1\" up\nip netns exec \"t3ns1\" ip link set dev \"t3br1\" up\n", "delta": "0:00:00.071427", "end": "2019-11-18 08:21:32.402501", "item": [{"bridge_name": "t3br1", "default_route_ip": "10.2.21.1", "dns": [{"brif": "t3s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t3s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "ns_name": "t3ns1", "route": [{"if": "p1", "ip": "10.2.21.1/24", "ns_if": "t3if", "ns_name": "t3"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t3ns1if", "tenant_ns_ip": "10.2.21.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s1if", "tenant_sub_ip": "10.2.21.2/24"}], "vxlan": [{"dev": "t3s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.21.2", "remote_ip": "10.1.21.2", "remote_route": "10.1.21.0/24", "subnet_route": "10.2.21.0/24", "tenant_route_ip": "192.168.131.2", "v_name": "vxlan_t3s1"}]}, {"brif": "t3br1if1", "disk": "10G", "mem": 2, "name": "t3_VM4", "vcpu": 4, "vmif": "t3VM4if1"}], "rc": 0, "start": "2019-11-18 08:21:32.331074", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Add IP to DNS Interface] ******************************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.21.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.2.21.1', u'bridge_name': u't3br1', u'ns_name': u't3ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.21.2/24', u'tenant_ns_ip': u'10.2.21.1/24', u'tenant_ns_if': u't3ns1if', u'tenant_sub_if': u't3s1if', u'tenant_ns_name': u't3'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't3_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't3br1if1', u'vmif': u't3VM4if1'}], u'vxlan': [{u'local_ip': u'10.2.21.2', u'dsport': 4789, u'dev': u't3s1if', u'tenant_route_ip': u'192.168.131.2', u'remote_route': u'10.1.21.0/24', u'subnet_route': u'10.2.21.0/24', u'v_name': u'vxlan_t3s1', u'id': 42, u'remote_ip': u'10.1.21.2'}]}, {u'dnsif': u't3s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't3s1_dnsbrif'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t3ns1\" ip addr show \"t3s1_dnsif\" | awk 'FNR==3{ print $2}'| grep -w '^1.1.1.128/24' ; if [ $? -ne 0 ] ; then ip netns exec \"t3ns1\" ip addr add \"1.1.1.128/24\" dev \"t3s1_dnsif\" ; fi\n", "delta": "0:00:00.094708", "end": "2019-11-18 08:21:32.874522", "item": [{"bridge_name": "t3br1", "default_route_ip": "10.2.21.1", "ns_name": "t3ns1", "route": [{"if": "p1", "ip": "10.2.21.1/24", "ns_if": "t3if", "ns_name": "t3"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t3ns1if", "tenant_ns_ip": "10.2.21.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s1if", "tenant_sub_ip": "10.2.21.2/24"}], "vms": [{"brif": "t3br1if1", "disk": "10G", "mem": 2, "name": "t3_VM4", "vcpu": 4, "vmif": "t3VM4if1"}], "vxlan": [{"dev": "t3s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.21.2", "remote_ip": "10.1.21.2", "remote_route": "10.1.21.0/24", "subnet_route": "10.2.21.0/24", "tenant_route_ip": "192.168.131.2", "v_name": "vxlan_t3s1"}]}, {"brif": "t3s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t3s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "rc": 0, "start": "2019-11-18 08:21:32.779814", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Install DHCP Server] **********************************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.21.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.2.21.1', u'bridge_name': u't3br1', u'ns_name': u't3ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.21.2/24', u'tenant_ns_ip': u'10.2.21.1/24', u'tenant_ns_if': u't3ns1if', u'tenant_sub_if': u't3s1if', u'tenant_ns_name': u't3'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't3_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't3br1if1', u'vmif': u't3VM4if1'}], u'vxlan': [{u'local_ip': u'10.2.21.2', u'dsport': 4789, u'dev': u't3s1if', u'tenant_route_ip': u'192.168.131.2', u'remote_route': u'10.1.21.0/24', u'subnet_route': u'10.2.21.0/24', u'v_name': u'vxlan_t3s1', u'id': 42, u'remote_ip': u'10.1.21.2'}]}, {u'dnsif': u't3s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't3s1_dnsbrif'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t3ns1\" ps aux | grep -w '[d]nsmasq --interface t3s1_dnsif -z --dhcp-range=1.1.1.133,1.1.1.254' ; if [ $? -ne 0 ] ; then ip netns exec \"t3ns1\" dnsmasq --interface \"t3s1_dnsif\" -z --dhcp-range=1.1.1.133,'1.1.1.254' ; fi\n", "delta": "0:00:00.079090", "end": "2019-11-18 08:21:33.348515", "item": [{"bridge_name": "t3br1", "default_route_ip": "10.2.21.1", "ns_name": "t3ns1", "route": [{"if": "p1", "ip": "10.2.21.1/24", "ns_if": "t3if", "ns_name": "t3"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t3ns1if", "tenant_ns_ip": "10.2.21.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s1if", "tenant_sub_ip": "10.2.21.2/24"}], "vms": [{"brif": "t3br1if1", "disk": "10G", "mem": 2, "name": "t3_VM4", "vcpu": 4, "vmif": "t3VM4if1"}], "vxlan": [{"dev": "t3s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.21.2", "remote_ip": "10.1.21.2", "remote_route": "10.1.21.0/24", "subnet_route": "10.2.21.0/24", "tenant_route_ip": "192.168.131.2", "v_name": "vxlan_t3s1"}]}, {"brif": "t3s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t3s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "rc": 0, "start": "2019-11-18 08:21:33.269425", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Create VXLAN devices] *********************************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.21.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.2.21.1', u'bridge_name': u't3br1', u'dns': [{u'dnsif': u't3s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't3s1_dnsbrif'}], u'ns_name': u't3ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.21.2/24', u'tenant_ns_ip': u'10.2.21.1/24', u'tenant_ns_if': u't3ns1if', u'tenant_sub_if': u't3s1if', u'tenant_ns_name': u't3'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't3_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't3br1if1', u'vmif': u't3VM4if1'}]}, {u'local_ip': u'10.2.21.2', u'dsport': 4789, u'dev': u't3s1if', u'tenant_route_ip': u'192.168.131.2', u'remote_route': u'10.1.21.0/24', u'subnet_route': u'10.2.21.0/24', u'v_name': u'vxlan_t3s1', u'id': 42, u'remote_ip': u'10.1.21.2'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t3ns1\" ip link show \"vxlan_t3s1\" ; if [ $? -ne 0 ] ; then ip netns exec \"t3ns1\" ip link add \"vxlan_t3s1\" type vxlan id \"42\" local \"10.2.21.2\" remote \"10.1.21.2\" dstport \"4789\" dev \"t3s1if\" ; ip netns exec \"t3ns1\" ip link set dev \"vxlan_t3s1\" up ; fi\n", "delta": "0:00:00.141997", "end": "2019-11-18 08:21:33.886387", "item": [{"bridge_name": "t3br1", "default_route_ip": "10.2.21.1", "dns": [{"brif": "t3s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t3s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "ns_name": "t3ns1", "route": [{"if": "p1", "ip": "10.2.21.1/24", "ns_if": "t3if", "ns_name": "t3"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t3ns1if", "tenant_ns_ip": "10.2.21.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s1if", "tenant_sub_ip": "10.2.21.2/24"}], "vms": [{"brif": "t3br1if1", "disk": "10G", "mem": 2, "name": "t3_VM4", "vcpu": 4, "vmif": "t3VM4if1"}]}, {"dev": "t3s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.21.2", "remote_ip": "10.1.21.2", "remote_route": "10.1.21.0/24", "subnet_route": "10.2.21.0/24", "tenant_route_ip": "192.168.131.2", "v_name": "vxlan_t3s1"}], "rc": 0, "start": "2019-11-18 08:21:33.744390", "stderr": "Device \"vxlan_t3s1\" does not exist.", "stderr_lines": ["Device \"vxlan_t3s1\" does not exist."], "stdout": "", "stdout_lines": []}

TASK [Attach VXLANs to bridge] ******************************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.21.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.2.21.1', u'bridge_name': u't3br1', u'dns': [{u'dnsif': u't3s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't3s1_dnsbrif'}], u'ns_name': u't3ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.21.2/24', u'tenant_ns_ip': u'10.2.21.1/24', u'tenant_ns_if': u't3ns1if', u'tenant_sub_if': u't3s1if', u'tenant_ns_name': u't3'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't3_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't3br1if1', u'vmif': u't3VM4if1'}]}, {u'local_ip': u'10.2.21.2', u'dsport': 4789, u'dev': u't3s1if', u'tenant_route_ip': u'192.168.131.2', u'remote_route': u'10.1.21.0/24', u'subnet_route': u'10.2.21.0/24', u'v_name': u'vxlan_t3s1', u'id': 42, u'remote_ip': u'10.1.21.2'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t3ns1\" brctl show \"t3br1\" | grep -w 'vxlan_t3s1' ; if [ $? -ne 0 ] ; then ip netns exec \"t3ns1\" brctl addif \"t3br1\" \"vxlan_t3s1\" ; fi\n", "delta": "0:00:00.081875", "end": "2019-11-18 08:21:34.370424", "item": [{"bridge_name": "t3br1", "default_route_ip": "10.2.21.1", "dns": [{"brif": "t3s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t3s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "ns_name": "t3ns1", "route": [{"if": "p1", "ip": "10.2.21.1/24", "ns_if": "t3if", "ns_name": "t3"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t3ns1if", "tenant_ns_ip": "10.2.21.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s1if", "tenant_sub_ip": "10.2.21.2/24"}], "vms": [{"brif": "t3br1if1", "disk": "10G", "mem": 2, "name": "t3_VM4", "vcpu": 4, "vmif": "t3VM4if1"}]}, {"dev": "t3s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.21.2", "remote_ip": "10.1.21.2", "remote_route": "10.1.21.0/24", "subnet_route": "10.2.21.0/24", "tenant_route_ip": "192.168.131.2", "v_name": "vxlan_t3s1"}], "rc": 0, "start": "2019-11-18 08:21:34.288549", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

PLAY RECAP **************************************************************************************************************************************************
99.99.99.2                 : ok=21   changed=21   unreachable=0    failed=0    skipped=0    rescued=0    ignored=0   

Using /etc/ansible/ansible.cfg as config file

PLAY [main] *************************************************************************************************************************************************

TASK [Add VXLAN routes in PNS] ******************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.21.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.1.21.1', u'bridge_name': u't3br1', u'dns': [{u'dnsif': u't3s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't3s1_dnsbrif'}], u'ns_name': u't3ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.21.2/24', u'tenant_ns_ip': u'10.1.21.1/24', u'tenant_ns_if': u't3ns1if', u'tenant_sub_if': u't3s1if', u'tenant_ns_name': u't3'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't3_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't3br1if1', u'vmif': u't3VM1if1'}, {u'mem': 4, u'name': u't3_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't3br1if2', u'vmif': u't3VM2if1'}]}, {u'local_ip': u'10.1.21.2', u'dsport': 4789, u'dev': u't3s1if', u'tenant_route_ip': u'192.168.3.2', u'remote_route': u'10.2.21.0/24', u'subnet_route': u'10.1.21.0/24', u'v_name': u'vxlan_t3s1', u'id': 42, u'remote_ip': u'10.2.21.2'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec pns ip route show \"10.1.21.0/24\" via \"192.168.3.2\" | grep -w '^10.1.21.0/24' ; if [ $? -ne 0 ] ; then ip netns exec pns ip route add \"10.1.21.0/24\" via \"192.168.3.2\" ; fi\n", "delta": "0:00:00.065476", "end": "2019-11-18 08:21:35.461276", "item": [{"bridge_name": "t3br1", "default_route_ip": "10.1.21.1", "dns": [{"brif": "t3s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t3s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t3ns1", "route": [{"if": "p1", "ip": "10.1.21.1/24", "ns_if": "t3if", "ns_name": "t3"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t3ns1if", "tenant_ns_ip": "10.1.21.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s1if", "tenant_sub_ip": "10.1.21.2/24"}], "vms": [{"brif": "t3br1if1", "disk": "10G", "mem": 2, "name": "t3_VM1", "vcpu": 4, "vmif": "t3VM1if1"}, {"brif": "t3br1if2", "disk": "10G", "mem": 4, "name": "t3_VM2", "vcpu": 2, "vmif": "t3VM2if1"}]}, {"dev": "t3s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.21.2", "remote_ip": "10.2.21.2", "remote_route": "10.2.21.0/24", "subnet_route": "10.1.21.0/24", "tenant_route_ip": "192.168.3.2", "v_name": "vxlan_t3s1"}], "rc": 0, "start": "2019-11-18 08:21:35.395800", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}
skipping: [localhost] => (item=[{u'route': [{u'ip': u'10.1.22.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.1.22.1', u'bridge_name': u't3br2', u'dns': [{u'dnsif': u't3s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't3s2_dnsbrif'}], u'ns_name': u't3ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.22.2/24', u'tenant_ns_ip': u'10.1.22.1/24', u'tenant_ns_if': u't3ns2if', u'tenant_sub_if': u't3s2if', u'tenant_ns_name': u't3'}], u'subnet_ip': u'2.2.2.0/24', u'vms': [{u'mem': 3, u'name': u't3_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't3br2if1', u'vmif': u't3VM3if1'}]}, {u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}])  => {"ansible_loop_var": "item", "changed": false, "item": [{"bridge_name": "t3br2", "default_route_ip": "10.1.22.1", "dns": [{"brif": "t3s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t3s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t3ns2", "route": [{"if": "p1", "ip": "10.1.22.1/24", "ns_if": "t3if", "ns_name": "t3"}], "subnet_ip": "2.2.2.0/24", "tenant_ns": [{"tenant_ns_if": "t3ns2if", "tenant_ns_ip": "10.1.22.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s2if", "tenant_sub_ip": "10.1.22.2/24"}], "vms": [{"brif": "t3br2if1", "disk": "10G", "mem": 3, "name": "t3_VM3", "vcpu": 2, "vmif": "t3VM3if1"}]}, {"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}], "skip_reason": "Conditional result was False"}

TASK [Get PNS ip address] ***********************************************************************************************************************************
ok: [localhost] => {"changed": false, "cmd": "ip netns exec pns ip addr show p1 | awk 'FNR==3{ print $2 }' | awk -F/ '{ print $1 }'\n", "delta": "0:00:00.036132", "end": "2019-11-18 08:21:35.749394", "rc": 0, "start": "2019-11-18 08:21:35.713262", "stderr": "", "stderr_lines": [], "stdout": "192.168.100.238", "stdout_lines": ["192.168.100.238"]}

TASK [Add VXLAN routes to host] *****************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.21.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.1.21.1', u'bridge_name': u't3br1', u'dns': [{u'dnsif': u't3s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't3s1_dnsbrif'}], u'ns_name': u't3ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.21.2/24', u'tenant_ns_ip': u'10.1.21.1/24', u'tenant_ns_if': u't3ns1if', u'tenant_sub_if': u't3s1if', u'tenant_ns_name': u't3'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't3_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't3br1if1', u'vmif': u't3VM1if1'}, {u'mem': 4, u'name': u't3_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't3br1if2', u'vmif': u't3VM2if1'}]}, {u'local_ip': u'10.1.21.2', u'dsport': 4789, u'dev': u't3s1if', u'tenant_route_ip': u'192.168.3.2', u'remote_route': u'10.2.21.0/24', u'subnet_route': u'10.1.21.0/24', u'v_name': u'vxlan_t3s1', u'id': 42, u'remote_ip': u'10.2.21.2'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip route show \"10.1.21.0/24\" via \"192.168.100.238\" | grep -w '^10.1.21.0/24' ; if [ $? -ne 0 ] ; then ip route add \"10.1.21.0/24\" via \"192.168.100.238\" ; fi\nip route show \"10.2.21.0/24\" via 99.99.99.2 | grep -w '^10.2.21.0/24'; if [ $? -ne 0 ] ; then ip route add \"10.2.21.0/24\" via 99.99.99.2 ; fi\n", "delta": "0:00:00.009570", "end": "2019-11-18 08:21:36.038053", "item": [{"bridge_name": "t3br1", "default_route_ip": "10.1.21.1", "dns": [{"brif": "t3s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t3s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t3ns1", "route": [{"if": "p1", "ip": "10.1.21.1/24", "ns_if": "t3if", "ns_name": "t3"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t3ns1if", "tenant_ns_ip": "10.1.21.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s1if", "tenant_sub_ip": "10.1.21.2/24"}], "vms": [{"brif": "t3br1if1", "disk": "10G", "mem": 2, "name": "t3_VM1", "vcpu": 4, "vmif": "t3VM1if1"}, {"brif": "t3br1if2", "disk": "10G", "mem": 4, "name": "t3_VM2", "vcpu": 2, "vmif": "t3VM2if1"}]}, {"dev": "t3s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.21.2", "remote_ip": "10.2.21.2", "remote_route": "10.2.21.0/24", "subnet_route": "10.1.21.0/24", "tenant_route_ip": "192.168.3.2", "v_name": "vxlan_t3s1"}], "rc": 0, "start": "2019-11-18 08:21:36.028483", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}
skipping: [localhost] => (item=[{u'route': [{u'ip': u'10.1.22.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.1.22.1', u'bridge_name': u't3br2', u'dns': [{u'dnsif': u't3s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't3s2_dnsbrif'}], u'ns_name': u't3ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.22.2/24', u'tenant_ns_ip': u'10.1.22.1/24', u'tenant_ns_if': u't3ns2if', u'tenant_sub_if': u't3s2if', u'tenant_ns_name': u't3'}], u'subnet_ip': u'2.2.2.0/24', u'vms': [{u'mem': 3, u'name': u't3_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't3br2if1', u'vmif': u't3VM3if1'}]}, {u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}])  => {"ansible_loop_var": "item", "changed": false, "item": [{"bridge_name": "t3br2", "default_route_ip": "10.1.22.1", "dns": [{"brif": "t3s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t3s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t3ns2", "route": [{"if": "p1", "ip": "10.1.22.1/24", "ns_if": "t3if", "ns_name": "t3"}], "subnet_ip": "2.2.2.0/24", "tenant_ns": [{"tenant_ns_if": "t3ns2if", "tenant_ns_ip": "10.1.22.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s2if", "tenant_sub_ip": "10.1.22.2/24"}], "vms": [{"brif": "t3br2if1", "disk": "10G", "mem": 3, "name": "t3_VM3", "vcpu": 2, "vmif": "t3VM3if1"}]}, {"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}], "skip_reason": "Conditional result was False"}

PLAY RECAP **************************************************************************************************************************************************
localhost                  : ok=3    changed=2    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0   

Using /etc/ansible/ansible.cfg as config file

PLAY [worker] ***********************************************************************************************************************************************

TASK [Add VXLAN routes in PNS] ******************************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.21.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.2.21.1', u'bridge_name': u't3br1', u'dns': [{u'dnsif': u't3s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't3s1_dnsbrif'}], u'ns_name': u't3ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.21.2/24', u'tenant_ns_ip': u'10.2.21.1/24', u'tenant_ns_if': u't3ns1if', u'tenant_sub_if': u't3s1if', u'tenant_ns_name': u't3'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't3_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't3br1if1', u'vmif': u't3VM4if1'}]}, {u'local_ip': u'10.2.21.2', u'dsport': 4789, u'dev': u't3s1if', u'tenant_route_ip': u'192.168.131.2', u'remote_route': u'10.1.21.0/24', u'subnet_route': u'10.2.21.0/24', u'v_name': u'vxlan_t3s1', u'id': 42, u'remote_ip': u'10.1.21.2'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec pns ip route show \"10.2.21.0/24\" via \"192.168.131.2\" | grep -w '^10.2.21.0/24' ; if [ $? -ne 0 ] ; then ip netns exec pns ip route add \"10.2.21.0/24\" via \"192.168.131.2\" ; fi\n", "delta": "0:00:00.074421", "end": "2019-11-18 08:21:37.250320", "item": [{"bridge_name": "t3br1", "default_route_ip": "10.2.21.1", "dns": [{"brif": "t3s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t3s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "ns_name": "t3ns1", "route": [{"if": "p1", "ip": "10.2.21.1/24", "ns_if": "t3if", "ns_name": "t3"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t3ns1if", "tenant_ns_ip": "10.2.21.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s1if", "tenant_sub_ip": "10.2.21.2/24"}], "vms": [{"brif": "t3br1if1", "disk": "10G", "mem": 2, "name": "t3_VM4", "vcpu": 4, "vmif": "t3VM4if1"}]}, {"dev": "t3s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.21.2", "remote_ip": "10.1.21.2", "remote_route": "10.1.21.0/24", "subnet_route": "10.2.21.0/24", "tenant_route_ip": "192.168.131.2", "v_name": "vxlan_t3s1"}], "rc": 0, "start": "2019-11-18 08:21:37.175899", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Get PNS ip address] ***********************************************************************************************************************************
ok: [99.99.99.2] => {"changed": false, "cmd": "ip netns exec pns ip addr show p1 | awk 'FNR==3{ print $2 }' | awk -F/ '{ print $1 }'\n", "delta": "0:00:00.045270", "end": "2019-11-18 08:21:37.650629", "rc": 0, "start": "2019-11-18 08:21:37.605359", "stderr": "", "stderr_lines": [], "stdout": "192.168.100.50", "stdout_lines": ["192.168.100.50"]}

TASK [Add VXLAN routes to host] *****************************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.21.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.2.21.1', u'bridge_name': u't3br1', u'dns': [{u'dnsif': u't3s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't3s1_dnsbrif'}], u'ns_name': u't3ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.21.2/24', u'tenant_ns_ip': u'10.2.21.1/24', u'tenant_ns_if': u't3ns1if', u'tenant_sub_if': u't3s1if', u'tenant_ns_name': u't3'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't3_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't3br1if1', u'vmif': u't3VM4if1'}]}, {u'local_ip': u'10.2.21.2', u'dsport': 4789, u'dev': u't3s1if', u'tenant_route_ip': u'192.168.131.2', u'remote_route': u'10.1.21.0/24', u'subnet_route': u'10.2.21.0/24', u'v_name': u'vxlan_t3s1', u'id': 42, u'remote_ip': u'10.1.21.2'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip route show \"10.2.21.0/24\" via \"192.168.100.50\" | grep -w '^10.2.21.0/24' ; if [ $? -ne 0 ] ; then ip route add \"10.2.21.0/24\" via \"192.168.100.50\" ; fi\nip route show \"10.1.21.0/24\" via 99.99.99.1 | grep -w '^10.1.21.0/24'; if [ $? -ne 0 ] ; then ip route add \"10.1.21.0/24\" via 99.99.99.1 ; fi\n", "delta": "0:00:00.008306", "end": "2019-11-18 08:21:38.075336", "item": [{"bridge_name": "t3br1", "default_route_ip": "10.2.21.1", "dns": [{"brif": "t3s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t3s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "ns_name": "t3ns1", "route": [{"if": "p1", "ip": "10.2.21.1/24", "ns_if": "t3if", "ns_name": "t3"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t3ns1if", "tenant_ns_ip": "10.2.21.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s1if", "tenant_sub_ip": "10.2.21.2/24"}], "vms": [{"brif": "t3br1if1", "disk": "10G", "mem": 2, "name": "t3_VM4", "vcpu": 4, "vmif": "t3VM4if1"}]}, {"dev": "t3s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.21.2", "remote_ip": "10.1.21.2", "remote_route": "10.1.21.0/24", "subnet_route": "10.2.21.0/24", "tenant_route_ip": "192.168.131.2", "v_name": "vxlan_t3s1"}], "rc": 0, "start": "2019-11-18 08:21:38.067030", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

PLAY RECAP **************************************************************************************************************************************************
99.99.99.2                 : ok=3    changed=2    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0   

Using /etc/ansible/ansible.cfg as config file

PLAY [main] *************************************************************************************************************************************************

TASK [Create VM templates (C1)] *****************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.21.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.1.21.1', u'bridge_name': u't3br1', u'dns': [{u'dnsif': u't3s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't3s1_dnsbrif'}], u'ns_name': u't3ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.21.2/24', u'tenant_ns_ip': u'10.1.21.1/24', u'tenant_ns_if': u't3ns1if', u'tenant_sub_if': u't3s1if', u'tenant_ns_name': u't3'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.1.21.2', u'dsport': 4789, u'dev': u't3s1if', u'tenant_route_ip': u'192.168.3.2', u'remote_route': u'10.2.21.0/24', u'subnet_route': u'10.1.21.0/24', u'v_name': u'vxlan_t3s1', u'id': 42, u'remote_ip': u'10.2.21.2'}]}, {u'mem': 2, u'name': u't3_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't3br1if1', u'vmif': u't3VM1if1'}]) => {"ansible_loop_var": "item", "changed": true, "checksum": "350ba870bd31b7f6ee517845c14237910b5af0bf", "dest": "/root/Migration-as-a-Service/t3/VM_templates/t3_VM1.xml.j2", "gid": 0, "group": "root", "item": [{"bridge_name": "t3br1", "default_route_ip": "10.1.21.1", "dns": [{"brif": "t3s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t3s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t3ns1", "route": [{"if": "p1", "ip": "10.1.21.1/24", "ns_if": "t3if", "ns_name": "t3"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t3ns1if", "tenant_ns_ip": "10.1.21.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s1if", "tenant_sub_ip": "10.1.21.2/24"}], "vxlan": [{"dev": "t3s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.21.2", "remote_ip": "10.2.21.2", "remote_route": "10.2.21.0/24", "subnet_route": "10.1.21.0/24", "tenant_route_ip": "192.168.3.2", "v_name": "vxlan_t3s1"}]}, {"brif": "t3br1if1", "disk": "10G", "mem": 2, "name": "t3_VM1", "vcpu": 4, "vmif": "t3VM1if1"}], "md5sum": "fbfc2eb0c2569531f25eea92c26d3bee", "mode": "0644", "owner": "root", "size": 4091, "src": "/root/.ansible/tmp/ansible-tmp-1574065298.69-79413414173413/source", "state": "file", "uid": 0}
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.21.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.1.21.1', u'bridge_name': u't3br1', u'dns': [{u'dnsif': u't3s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't3s1_dnsbrif'}], u'ns_name': u't3ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.21.2/24', u'tenant_ns_ip': u'10.1.21.1/24', u'tenant_ns_if': u't3ns1if', u'tenant_sub_if': u't3s1if', u'tenant_ns_name': u't3'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.1.21.2', u'dsport': 4789, u'dev': u't3s1if', u'tenant_route_ip': u'192.168.3.2', u'remote_route': u'10.2.21.0/24', u'subnet_route': u'10.1.21.0/24', u'v_name': u'vxlan_t3s1', u'id': 42, u'remote_ip': u'10.2.21.2'}]}, {u'mem': 4, u'name': u't3_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't3br1if2', u'vmif': u't3VM2if1'}]) => {"ansible_loop_var": "item", "changed": true, "checksum": "350ba870bd31b7f6ee517845c14237910b5af0bf", "dest": "/root/Migration-as-a-Service/t3/VM_templates/t3_VM2.xml.j2", "gid": 0, "group": "root", "item": [{"bridge_name": "t3br1", "default_route_ip": "10.1.21.1", "dns": [{"brif": "t3s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t3s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t3ns1", "route": [{"if": "p1", "ip": "10.1.21.1/24", "ns_if": "t3if", "ns_name": "t3"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t3ns1if", "tenant_ns_ip": "10.1.21.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s1if", "tenant_sub_ip": "10.1.21.2/24"}], "vxlan": [{"dev": "t3s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.21.2", "remote_ip": "10.2.21.2", "remote_route": "10.2.21.0/24", "subnet_route": "10.1.21.0/24", "tenant_route_ip": "192.168.3.2", "v_name": "vxlan_t3s1"}]}, {"brif": "t3br1if2", "disk": "10G", "mem": 4, "name": "t3_VM2", "vcpu": 2, "vmif": "t3VM2if1"}], "md5sum": "fbfc2eb0c2569531f25eea92c26d3bee", "mode": "0644", "owner": "root", "size": 4091, "src": "/root/.ansible/tmp/ansible-tmp-1574065299.3-26665631928456/source", "state": "file", "uid": 0}
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.22.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.1.22.1', u'bridge_name': u't3br2', u'dns': [{u'dnsif': u't3s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't3s2_dnsbrif'}], u'ns_name': u't3ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.22.2/24', u'tenant_ns_ip': u'10.1.22.1/24', u'tenant_ns_if': u't3ns2if', u'tenant_sub_if': u't3s2if', u'tenant_ns_name': u't3'}], u'subnet_ip': u'2.2.2.0/24', u'vxlan': [{u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}, {u'mem': 3, u'name': u't3_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't3br2if1', u'vmif': u't3VM3if1'}]) => {"ansible_loop_var": "item", "changed": true, "checksum": "350ba870bd31b7f6ee517845c14237910b5af0bf", "dest": "/root/Migration-as-a-Service/t3/VM_templates/t3_VM3.xml.j2", "gid": 0, "group": "root", "item": [{"bridge_name": "t3br2", "default_route_ip": "10.1.22.1", "dns": [{"brif": "t3s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t3s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t3ns2", "route": [{"if": "p1", "ip": "10.1.22.1/24", "ns_if": "t3if", "ns_name": "t3"}], "subnet_ip": "2.2.2.0/24", "tenant_ns": [{"tenant_ns_if": "t3ns2if", "tenant_ns_ip": "10.1.22.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s2if", "tenant_sub_ip": "10.1.22.2/24"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, {"brif": "t3br2if1", "disk": "10G", "mem": 3, "name": "t3_VM3", "vcpu": 2, "vmif": "t3VM3if1"}], "md5sum": "fbfc2eb0c2569531f25eea92c26d3bee", "mode": "0644", "owner": "root", "size": 4091, "src": "/root/.ansible/tmp/ansible-tmp-1574065299.59-240185036618832/source", "state": "file", "uid": 0}

PLAY RECAP **************************************************************************************************************************************************
localhost                  : ok=1    changed=1    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0   

Using /etc/ansible/ansible.cfg as config file

PLAY [main] *************************************************************************************************************************************************

TASK [Create VM templates (C2)] *****************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.2.21.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.2.21.1', u'bridge_name': u't3br1', u'dns': [{u'dnsif': u't3s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't3s1_dnsbrif'}], u'ns_name': u't3ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.21.2/24', u'tenant_ns_ip': u'10.2.21.1/24', u'tenant_ns_if': u't3ns1if', u'tenant_sub_if': u't3s1if', u'tenant_ns_name': u't3'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.2.21.2', u'dsport': 4789, u'dev': u't3s1if', u'tenant_route_ip': u'192.168.131.2', u'remote_route': u'10.1.21.0/24', u'subnet_route': u'10.2.21.0/24', u'v_name': u'vxlan_t3s1', u'id': 42, u'remote_ip': u'10.1.21.2'}]}, {u'mem': 2, u'name': u't3_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't3br1if1', u'vmif': u't3VM4if1'}]) => {"ansible_loop_var": "item", "changed": true, "checksum": "350ba870bd31b7f6ee517845c14237910b5af0bf", "dest": "/root/Migration-as-a-Service/t3/VM_templates/t3_VM4.xml.j2", "gid": 0, "group": "root", "item": [{"bridge_name": "t3br1", "default_route_ip": "10.2.21.1", "dns": [{"brif": "t3s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t3s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "ns_name": "t3ns1", "route": [{"if": "p1", "ip": "10.2.21.1/24", "ns_if": "t3if", "ns_name": "t3"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t3ns1if", "tenant_ns_ip": "10.2.21.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s1if", "tenant_sub_ip": "10.2.21.2/24"}], "vxlan": [{"dev": "t3s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.21.2", "remote_ip": "10.1.21.2", "remote_route": "10.1.21.0/24", "subnet_route": "10.2.21.0/24", "tenant_route_ip": "192.168.131.2", "v_name": "vxlan_t3s1"}]}, {"brif": "t3br1if1", "disk": "10G", "mem": 2, "name": "t3_VM4", "vcpu": 4, "vmif": "t3VM4if1"}], "md5sum": "fbfc2eb0c2569531f25eea92c26d3bee", "mode": "0644", "owner": "root", "size": 4091, "src": "/root/.ansible/tmp/ansible-tmp-1574065300.53-273221874840291/source", "state": "file", "uid": 0}

PLAY RECAP **************************************************************************************************************************************************
localhost                  : ok=1    changed=1    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0   

Using /etc/ansible/ansible.cfg as config file

PLAY [main] *************************************************************************************************************************************************

TASK [Copy VM image] ****************************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.21.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.1.21.1', u'bridge_name': u't3br1', u'dns': [{u'dnsif': u't3s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't3s1_dnsbrif'}], u'ns_name': u't3ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.21.2/24', u'tenant_ns_ip': u'10.1.21.1/24', u'tenant_ns_if': u't3ns1if', u'tenant_sub_if': u't3s1if', u'tenant_ns_name': u't3'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.1.21.2', u'dsport': 4789, u'dev': u't3s1if', u'tenant_route_ip': u'192.168.3.2', u'remote_route': u'10.2.21.0/24', u'subnet_route': u'10.1.21.0/24', u'v_name': u'vxlan_t3s1', u'id': 42, u'remote_ip': u'10.2.21.2'}]}, {u'mem': 2, u'name': u't3_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't3br1if1', u'vmif': u't3VM1if1'}]) => {"ansible_loop_var": "item", "changed": true, "checksum": "d86d5962370fcd0c3d05943fc209d9e05fdac89f", "dest": "/var/lib/libvirt/images/t3_VM1.qcow2", "gid": 0, "group": "root", "item": [{"bridge_name": "t3br1", "default_route_ip": "10.1.21.1", "dns": [{"brif": "t3s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t3s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t3ns1", "route": [{"if": "p1", "ip": "10.1.21.1/24", "ns_if": "t3if", "ns_name": "t3"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t3ns1if", "tenant_ns_ip": "10.1.21.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s1if", "tenant_sub_ip": "10.1.21.2/24"}], "vxlan": [{"dev": "t3s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.21.2", "remote_ip": "10.2.21.2", "remote_route": "10.2.21.0/24", "subnet_route": "10.1.21.0/24", "tenant_route_ip": "192.168.3.2", "v_name": "vxlan_t3s1"}]}, {"brif": "t3br1if1", "disk": "10G", "mem": 2, "name": "t3_VM1", "vcpu": 4, "vmif": "t3VM1if1"}], "md5sum": "b977a19124b65f2d544ddc62e407114d", "mode": "0644", "owner": "root", "size": 10739318784, "src": "/root/.ansible/tmp/ansible-tmp-1574065301.76-207952534954010/source", "state": "file", "uid": 0}
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.21.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.1.21.1', u'bridge_name': u't3br1', u'dns': [{u'dnsif': u't3s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't3s1_dnsbrif'}], u'ns_name': u't3ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.21.2/24', u'tenant_ns_ip': u'10.1.21.1/24', u'tenant_ns_if': u't3ns1if', u'tenant_sub_if': u't3s1if', u'tenant_ns_name': u't3'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.1.21.2', u'dsport': 4789, u'dev': u't3s1if', u'tenant_route_ip': u'192.168.3.2', u'remote_route': u'10.2.21.0/24', u'subnet_route': u'10.1.21.0/24', u'v_name': u'vxlan_t3s1', u'id': 42, u'remote_ip': u'10.2.21.2'}]}, {u'mem': 4, u'name': u't3_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't3br1if2', u'vmif': u't3VM2if1'}]) => {"ansible_loop_var": "item", "changed": true, "checksum": "d86d5962370fcd0c3d05943fc209d9e05fdac89f", "dest": "/var/lib/libvirt/images/t3_VM2.qcow2", "gid": 0, "group": "root", "item": [{"bridge_name": "t3br1", "default_route_ip": "10.1.21.1", "dns": [{"brif": "t3s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t3s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t3ns1", "route": [{"if": "p1", "ip": "10.1.21.1/24", "ns_if": "t3if", "ns_name": "t3"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t3ns1if", "tenant_ns_ip": "10.1.21.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s1if", "tenant_sub_ip": "10.1.21.2/24"}], "vxlan": [{"dev": "t3s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.21.2", "remote_ip": "10.2.21.2", "remote_route": "10.2.21.0/24", "subnet_route": "10.1.21.0/24", "tenant_route_ip": "192.168.3.2", "v_name": "vxlan_t3s1"}]}, {"brif": "t3br1if2", "disk": "10G", "mem": 4, "name": "t3_VM2", "vcpu": 2, "vmif": "t3VM2if1"}], "md5sum": "b977a19124b65f2d544ddc62e407114d", "mode": "0644", "owner": "root", "size": 10739318784, "src": "/root/.ansible/tmp/ansible-tmp-1574065418.66-155096050091631/source", "state": "file", "uid": 0}
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.22.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.1.22.1', u'bridge_name': u't3br2', u'dns': [{u'dnsif': u't3s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't3s2_dnsbrif'}], u'ns_name': u't3ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.22.2/24', u'tenant_ns_ip': u'10.1.22.1/24', u'tenant_ns_if': u't3ns2if', u'tenant_sub_if': u't3s2if', u'tenant_ns_name': u't3'}], u'subnet_ip': u'2.2.2.0/24', u'vxlan': [{u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}, {u'mem': 3, u'name': u't3_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't3br2if1', u'vmif': u't3VM3if1'}]) => {"ansible_loop_var": "item", "changed": true, "checksum": "d86d5962370fcd0c3d05943fc209d9e05fdac89f", "dest": "/var/lib/libvirt/images/t3_VM3.qcow2", "gid": 0, "group": "root", "item": [{"bridge_name": "t3br2", "default_route_ip": "10.1.22.1", "dns": [{"brif": "t3s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t3s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t3ns2", "route": [{"if": "p1", "ip": "10.1.22.1/24", "ns_if": "t3if", "ns_name": "t3"}], "subnet_ip": "2.2.2.0/24", "tenant_ns": [{"tenant_ns_if": "t3ns2if", "tenant_ns_ip": "10.1.22.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s2if", "tenant_sub_ip": "10.1.22.2/24"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, {"brif": "t3br2if1", "disk": "10G", "mem": 3, "name": "t3_VM3", "vcpu": 2, "vmif": "t3VM3if1"}], "md5sum": "b977a19124b65f2d544ddc62e407114d", "mode": "0644", "owner": "root", "size": 10739318784, "src": "/root/.ansible/tmp/ansible-tmp-1574065506.35-238889193043129/source", "state": "file", "uid": 0}

TASK [Create VM templates (C1)] *****************************************************************************************************************************
ok: [localhost] => (item=[{u'route': [{u'ip': u'10.1.21.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.1.21.1', u'bridge_name': u't3br1', u'dns': [{u'dnsif': u't3s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't3s1_dnsbrif'}], u'ns_name': u't3ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.21.2/24', u'tenant_ns_ip': u'10.1.21.1/24', u'tenant_ns_if': u't3ns1if', u'tenant_sub_if': u't3s1if', u'tenant_ns_name': u't3'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.1.21.2', u'dsport': 4789, u'dev': u't3s1if', u'tenant_route_ip': u'192.168.3.2', u'remote_route': u'10.2.21.0/24', u'subnet_route': u'10.1.21.0/24', u'v_name': u'vxlan_t3s1', u'id': 42, u'remote_ip': u'10.2.21.2'}]}, {u'mem': 2, u'name': u't3_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't3br1if1', u'vmif': u't3VM1if1'}]) => {"ansible_loop_var": "item", "changed": false, "checksum": "350ba870bd31b7f6ee517845c14237910b5af0bf", "dest": "/root/Migration-as-a-Service/t3/VM_templates/t3_VM1.xml.j2", "gid": 0, "group": "root", "item": [{"bridge_name": "t3br1", "default_route_ip": "10.1.21.1", "dns": [{"brif": "t3s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t3s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t3ns1", "route": [{"if": "p1", "ip": "10.1.21.1/24", "ns_if": "t3if", "ns_name": "t3"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t3ns1if", "tenant_ns_ip": "10.1.21.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s1if", "tenant_sub_ip": "10.1.21.2/24"}], "vxlan": [{"dev": "t3s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.21.2", "remote_ip": "10.2.21.2", "remote_route": "10.2.21.0/24", "subnet_route": "10.1.21.0/24", "tenant_route_ip": "192.168.3.2", "v_name": "vxlan_t3s1"}]}, {"brif": "t3br1if1", "disk": "10G", "mem": 2, "name": "t3_VM1", "vcpu": 4, "vmif": "t3VM1if1"}], "mode": "0644", "owner": "root", "path": "/root/Migration-as-a-Service/t3/VM_templates/t3_VM1.xml.j2", "size": 4091, "state": "file", "uid": 0}
ok: [localhost] => (item=[{u'route': [{u'ip': u'10.1.21.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.1.21.1', u'bridge_name': u't3br1', u'dns': [{u'dnsif': u't3s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't3s1_dnsbrif'}], u'ns_name': u't3ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.21.2/24', u'tenant_ns_ip': u'10.1.21.1/24', u'tenant_ns_if': u't3ns1if', u'tenant_sub_if': u't3s1if', u'tenant_ns_name': u't3'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.1.21.2', u'dsport': 4789, u'dev': u't3s1if', u'tenant_route_ip': u'192.168.3.2', u'remote_route': u'10.2.21.0/24', u'subnet_route': u'10.1.21.0/24', u'v_name': u'vxlan_t3s1', u'id': 42, u'remote_ip': u'10.2.21.2'}]}, {u'mem': 4, u'name': u't3_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't3br1if2', u'vmif': u't3VM2if1'}]) => {"ansible_loop_var": "item", "changed": false, "checksum": "350ba870bd31b7f6ee517845c14237910b5af0bf", "dest": "/root/Migration-as-a-Service/t3/VM_templates/t3_VM2.xml.j2", "gid": 0, "group": "root", "item": [{"bridge_name": "t3br1", "default_route_ip": "10.1.21.1", "dns": [{"brif": "t3s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t3s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t3ns1", "route": [{"if": "p1", "ip": "10.1.21.1/24", "ns_if": "t3if", "ns_name": "t3"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t3ns1if", "tenant_ns_ip": "10.1.21.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s1if", "tenant_sub_ip": "10.1.21.2/24"}], "vxlan": [{"dev": "t3s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.21.2", "remote_ip": "10.2.21.2", "remote_route": "10.2.21.0/24", "subnet_route": "10.1.21.0/24", "tenant_route_ip": "192.168.3.2", "v_name": "vxlan_t3s1"}]}, {"brif": "t3br1if2", "disk": "10G", "mem": 4, "name": "t3_VM2", "vcpu": 2, "vmif": "t3VM2if1"}], "mode": "0644", "owner": "root", "path": "/root/Migration-as-a-Service/t3/VM_templates/t3_VM2.xml.j2", "size": 4091, "state": "file", "uid": 0}
ok: [localhost] => (item=[{u'route': [{u'ip': u'10.1.22.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.1.22.1', u'bridge_name': u't3br2', u'dns': [{u'dnsif': u't3s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't3s2_dnsbrif'}], u'ns_name': u't3ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.22.2/24', u'tenant_ns_ip': u'10.1.22.1/24', u'tenant_ns_if': u't3ns2if', u'tenant_sub_if': u't3s2if', u'tenant_ns_name': u't3'}], u'subnet_ip': u'2.2.2.0/24', u'vxlan': [{u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}, {u'mem': 3, u'name': u't3_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't3br2if1', u'vmif': u't3VM3if1'}]) => {"ansible_loop_var": "item", "changed": false, "checksum": "350ba870bd31b7f6ee517845c14237910b5af0bf", "dest": "/root/Migration-as-a-Service/t3/VM_templates/t3_VM3.xml.j2", "gid": 0, "group": "root", "item": [{"bridge_name": "t3br2", "default_route_ip": "10.1.22.1", "dns": [{"brif": "t3s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t3s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t3ns2", "route": [{"if": "p1", "ip": "10.1.22.1/24", "ns_if": "t3if", "ns_name": "t3"}], "subnet_ip": "2.2.2.0/24", "tenant_ns": [{"tenant_ns_if": "t3ns2if", "tenant_ns_ip": "10.1.22.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s2if", "tenant_sub_ip": "10.1.22.2/24"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, {"brif": "t3br2if1", "disk": "10G", "mem": 3, "name": "t3_VM3", "vcpu": 2, "vmif": "t3VM3if1"}], "mode": "0644", "owner": "root", "path": "/root/Migration-as-a-Service/t3/VM_templates/t3_VM3.xml.j2", "size": 4091, "state": "file", "uid": 0}

TASK [Get list of running VMs] ******************************************************************************************************************************
ok: [localhost] => {"changed": false, "cmd": ["virsh", "list", "--name"], "delta": "0:00:00.071541", "end": "2019-11-18 08:26:56.524854", "rc": 0, "start": "2019-11-18 08:26:56.453313", "stderr": "", "stderr_lines": [], "stdout": "t1_VM2\nt1_VM3\nt2_VM2\nt2_VM3", "stdout_lines": ["t1_VM2", "t1_VM3", "t2_VM2", "t2_VM3"]}

TASK [Define VM] ********************************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.21.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.1.21.1', u'bridge_name': u't3br1', u'dns': [{u'dnsif': u't3s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't3s1_dnsbrif'}], u'ns_name': u't3ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.21.2/24', u'tenant_ns_ip': u'10.1.21.1/24', u'tenant_ns_if': u't3ns1if', u'tenant_sub_if': u't3s1if', u'tenant_ns_name': u't3'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.1.21.2', u'dsport': 4789, u'dev': u't3s1if', u'tenant_route_ip': u'192.168.3.2', u'remote_route': u'10.2.21.0/24', u'subnet_route': u'10.1.21.0/24', u'v_name': u'vxlan_t3s1', u'id': 42, u'remote_ip': u'10.2.21.2'}]}, {u'mem': 2, u'name': u't3_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't3br1if1', u'vmif': u't3VM1if1'}]) => {"ansible_loop_var": "item", "changed": true, "created": "t3_VM1", "item": [{"bridge_name": "t3br1", "default_route_ip": "10.1.21.1", "dns": [{"brif": "t3s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t3s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t3ns1", "route": [{"if": "p1", "ip": "10.1.21.1/24", "ns_if": "t3if", "ns_name": "t3"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t3ns1if", "tenant_ns_ip": "10.1.21.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s1if", "tenant_sub_ip": "10.1.21.2/24"}], "vxlan": [{"dev": "t3s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.21.2", "remote_ip": "10.2.21.2", "remote_route": "10.2.21.0/24", "subnet_route": "10.1.21.0/24", "tenant_route_ip": "192.168.3.2", "v_name": "vxlan_t3s1"}]}, {"brif": "t3br1if1", "disk": "10G", "mem": 2, "name": "t3_VM1", "vcpu": 4, "vmif": "t3VM1if1"}], "warnings": ["'xml' is given - ignoring 'name'"]}
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.21.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.1.21.1', u'bridge_name': u't3br1', u'dns': [{u'dnsif': u't3s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't3s1_dnsbrif'}], u'ns_name': u't3ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.21.2/24', u'tenant_ns_ip': u'10.1.21.1/24', u'tenant_ns_if': u't3ns1if', u'tenant_sub_if': u't3s1if', u'tenant_ns_name': u't3'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.1.21.2', u'dsport': 4789, u'dev': u't3s1if', u'tenant_route_ip': u'192.168.3.2', u'remote_route': u'10.2.21.0/24', u'subnet_route': u'10.1.21.0/24', u'v_name': u'vxlan_t3s1', u'id': 42, u'remote_ip': u'10.2.21.2'}]}, {u'mem': 4, u'name': u't3_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't3br1if2', u'vmif': u't3VM2if1'}]) => {"ansible_loop_var": "item", "changed": true, "created": "t3_VM2", "item": [{"bridge_name": "t3br1", "default_route_ip": "10.1.21.1", "dns": [{"brif": "t3s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t3s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t3ns1", "route": [{"if": "p1", "ip": "10.1.21.1/24", "ns_if": "t3if", "ns_name": "t3"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t3ns1if", "tenant_ns_ip": "10.1.21.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s1if", "tenant_sub_ip": "10.1.21.2/24"}], "vxlan": [{"dev": "t3s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.21.2", "remote_ip": "10.2.21.2", "remote_route": "10.2.21.0/24", "subnet_route": "10.1.21.0/24", "tenant_route_ip": "192.168.3.2", "v_name": "vxlan_t3s1"}]}, {"brif": "t3br1if2", "disk": "10G", "mem": 4, "name": "t3_VM2", "vcpu": 2, "vmif": "t3VM2if1"}], "warnings": ["'xml' is given - ignoring 'name'"]}
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.22.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.1.22.1', u'bridge_name': u't3br2', u'dns': [{u'dnsif': u't3s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't3s2_dnsbrif'}], u'ns_name': u't3ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.22.2/24', u'tenant_ns_ip': u'10.1.22.1/24', u'tenant_ns_if': u't3ns2if', u'tenant_sub_if': u't3s2if', u'tenant_ns_name': u't3'}], u'subnet_ip': u'2.2.2.0/24', u'vxlan': [{u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}, {u'mem': 3, u'name': u't3_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't3br2if1', u'vmif': u't3VM3if1'}]) => {"ansible_loop_var": "item", "changed": true, "created": "t3_VM3", "item": [{"bridge_name": "t3br2", "default_route_ip": "10.1.22.1", "dns": [{"brif": "t3s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t3s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t3ns2", "route": [{"if": "p1", "ip": "10.1.22.1/24", "ns_if": "t3if", "ns_name": "t3"}], "subnet_ip": "2.2.2.0/24", "tenant_ns": [{"tenant_ns_if": "t3ns2if", "tenant_ns_ip": "10.1.22.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s2if", "tenant_sub_ip": "10.1.22.2/24"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, {"brif": "t3br2if1", "disk": "10G", "mem": 3, "name": "t3_VM3", "vcpu": 2, "vmif": "t3VM3if1"}], "warnings": ["'xml' is given - ignoring 'name'"]}

TASK [Create VM] ********************************************************************************************************************************************
ok: [localhost] => (item=[{u'route': [{u'ip': u'10.1.21.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.1.21.1', u'bridge_name': u't3br1', u'dns': [{u'dnsif': u't3s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't3s1_dnsbrif'}], u'ns_name': u't3ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.21.2/24', u'tenant_ns_ip': u'10.1.21.1/24', u'tenant_ns_if': u't3ns1if', u'tenant_sub_if': u't3s1if', u'tenant_ns_name': u't3'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.1.21.2', u'dsport': 4789, u'dev': u't3s1if', u'tenant_route_ip': u'192.168.3.2', u'remote_route': u'10.2.21.0/24', u'subnet_route': u'10.1.21.0/24', u'v_name': u'vxlan_t3s1', u'id': 42, u'remote_ip': u'10.2.21.2'}]}, {u'mem': 2, u'name': u't3_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't3br1if1', u'vmif': u't3VM1if1'}]) => {"ansible_loop_var": "item", "changed": false, "create": 0, "item": [{"bridge_name": "t3br1", "default_route_ip": "10.1.21.1", "dns": [{"brif": "t3s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t3s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t3ns1", "route": [{"if": "p1", "ip": "10.1.21.1/24", "ns_if": "t3if", "ns_name": "t3"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t3ns1if", "tenant_ns_ip": "10.1.21.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s1if", "tenant_sub_ip": "10.1.21.2/24"}], "vxlan": [{"dev": "t3s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.21.2", "remote_ip": "10.2.21.2", "remote_route": "10.2.21.0/24", "subnet_route": "10.1.21.0/24", "tenant_route_ip": "192.168.3.2", "v_name": "vxlan_t3s1"}]}, {"brif": "t3br1if1", "disk": "10G", "mem": 2, "name": "t3_VM1", "vcpu": 4, "vmif": "t3VM1if1"}]}
ok: [localhost] => (item=[{u'route': [{u'ip': u'10.1.21.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.1.21.1', u'bridge_name': u't3br1', u'dns': [{u'dnsif': u't3s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't3s1_dnsbrif'}], u'ns_name': u't3ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.21.2/24', u'tenant_ns_ip': u'10.1.21.1/24', u'tenant_ns_if': u't3ns1if', u'tenant_sub_if': u't3s1if', u'tenant_ns_name': u't3'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.1.21.2', u'dsport': 4789, u'dev': u't3s1if', u'tenant_route_ip': u'192.168.3.2', u'remote_route': u'10.2.21.0/24', u'subnet_route': u'10.1.21.0/24', u'v_name': u'vxlan_t3s1', u'id': 42, u'remote_ip': u'10.2.21.2'}]}, {u'mem': 4, u'name': u't3_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't3br1if2', u'vmif': u't3VM2if1'}]) => {"ansible_loop_var": "item", "changed": false, "create": 0, "item": [{"bridge_name": "t3br1", "default_route_ip": "10.1.21.1", "dns": [{"brif": "t3s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t3s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t3ns1", "route": [{"if": "p1", "ip": "10.1.21.1/24", "ns_if": "t3if", "ns_name": "t3"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t3ns1if", "tenant_ns_ip": "10.1.21.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s1if", "tenant_sub_ip": "10.1.21.2/24"}], "vxlan": [{"dev": "t3s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.21.2", "remote_ip": "10.2.21.2", "remote_route": "10.2.21.0/24", "subnet_route": "10.1.21.0/24", "tenant_route_ip": "192.168.3.2", "v_name": "vxlan_t3s1"}]}, {"brif": "t3br1if2", "disk": "10G", "mem": 4, "name": "t3_VM2", "vcpu": 2, "vmif": "t3VM2if1"}]}
ok: [localhost] => (item=[{u'route': [{u'ip': u'10.1.22.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.1.22.1', u'bridge_name': u't3br2', u'dns': [{u'dnsif': u't3s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't3s2_dnsbrif'}], u'ns_name': u't3ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.22.2/24', u'tenant_ns_ip': u'10.1.22.1/24', u'tenant_ns_if': u't3ns2if', u'tenant_sub_if': u't3s2if', u'tenant_ns_name': u't3'}], u'subnet_ip': u'2.2.2.0/24', u'vxlan': [{u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}, {u'mem': 3, u'name': u't3_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't3br2if1', u'vmif': u't3VM3if1'}]) => {"ansible_loop_var": "item", "changed": false, "create": 0, "item": [{"bridge_name": "t3br2", "default_route_ip": "10.1.22.1", "dns": [{"brif": "t3s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t3s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t3ns2", "route": [{"if": "p1", "ip": "10.1.22.1/24", "ns_if": "t3if", "ns_name": "t3"}], "subnet_ip": "2.2.2.0/24", "tenant_ns": [{"tenant_ns_if": "t3ns2if", "tenant_ns_ip": "10.1.22.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s2if", "tenant_sub_ip": "10.1.22.2/24"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, {"brif": "t3br2if1", "disk": "10G", "mem": 3, "name": "t3_VM3", "vcpu": 2, "vmif": "t3VM3if1"}]}

TASK [Start VM] *********************************************************************************************************************************************
ok: [localhost] => (item=[{u'route': [{u'ip': u'10.1.21.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.1.21.1', u'bridge_name': u't3br1', u'dns': [{u'dnsif': u't3s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't3s1_dnsbrif'}], u'ns_name': u't3ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.21.2/24', u'tenant_ns_ip': u'10.1.21.1/24', u'tenant_ns_if': u't3ns1if', u'tenant_sub_if': u't3s1if', u'tenant_ns_name': u't3'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.1.21.2', u'dsport': 4789, u'dev': u't3s1if', u'tenant_route_ip': u'192.168.3.2', u'remote_route': u'10.2.21.0/24', u'subnet_route': u'10.1.21.0/24', u'v_name': u'vxlan_t3s1', u'id': 42, u'remote_ip': u'10.2.21.2'}]}, {u'mem': 2, u'name': u't3_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't3br1if1', u'vmif': u't3VM1if1'}]) => {"ansible_loop_var": "item", "changed": false, "item": [{"bridge_name": "t3br1", "default_route_ip": "10.1.21.1", "dns": [{"brif": "t3s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t3s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t3ns1", "route": [{"if": "p1", "ip": "10.1.21.1/24", "ns_if": "t3if", "ns_name": "t3"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t3ns1if", "tenant_ns_ip": "10.1.21.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s1if", "tenant_sub_ip": "10.1.21.2/24"}], "vxlan": [{"dev": "t3s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.21.2", "remote_ip": "10.2.21.2", "remote_route": "10.2.21.0/24", "subnet_route": "10.1.21.0/24", "tenant_route_ip": "192.168.3.2", "v_name": "vxlan_t3s1"}]}, {"brif": "t3br1if1", "disk": "10G", "mem": 2, "name": "t3_VM1", "vcpu": 4, "vmif": "t3VM1if1"}]}
ok: [localhost] => (item=[{u'route': [{u'ip': u'10.1.21.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.1.21.1', u'bridge_name': u't3br1', u'dns': [{u'dnsif': u't3s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't3s1_dnsbrif'}], u'ns_name': u't3ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.21.2/24', u'tenant_ns_ip': u'10.1.21.1/24', u'tenant_ns_if': u't3ns1if', u'tenant_sub_if': u't3s1if', u'tenant_ns_name': u't3'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.1.21.2', u'dsport': 4789, u'dev': u't3s1if', u'tenant_route_ip': u'192.168.3.2', u'remote_route': u'10.2.21.0/24', u'subnet_route': u'10.1.21.0/24', u'v_name': u'vxlan_t3s1', u'id': 42, u'remote_ip': u'10.2.21.2'}]}, {u'mem': 4, u'name': u't3_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't3br1if2', u'vmif': u't3VM2if1'}]) => {"ansible_loop_var": "item", "changed": false, "item": [{"bridge_name": "t3br1", "default_route_ip": "10.1.21.1", "dns": [{"brif": "t3s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t3s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t3ns1", "route": [{"if": "p1", "ip": "10.1.21.1/24", "ns_if": "t3if", "ns_name": "t3"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t3ns1if", "tenant_ns_ip": "10.1.21.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s1if", "tenant_sub_ip": "10.1.21.2/24"}], "vxlan": [{"dev": "t3s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.21.2", "remote_ip": "10.2.21.2", "remote_route": "10.2.21.0/24", "subnet_route": "10.1.21.0/24", "tenant_route_ip": "192.168.3.2", "v_name": "vxlan_t3s1"}]}, {"brif": "t3br1if2", "disk": "10G", "mem": 4, "name": "t3_VM2", "vcpu": 2, "vmif": "t3VM2if1"}]}
ok: [localhost] => (item=[{u'route': [{u'ip': u'10.1.22.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.1.22.1', u'bridge_name': u't3br2', u'dns': [{u'dnsif': u't3s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't3s2_dnsbrif'}], u'ns_name': u't3ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.22.2/24', u'tenant_ns_ip': u'10.1.22.1/24', u'tenant_ns_if': u't3ns2if', u'tenant_sub_if': u't3s2if', u'tenant_ns_name': u't3'}], u'subnet_ip': u'2.2.2.0/24', u'vxlan': [{u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}, {u'mem': 3, u'name': u't3_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't3br2if1', u'vmif': u't3VM3if1'}]) => {"ansible_loop_var": "item", "changed": false, "item": [{"bridge_name": "t3br2", "default_route_ip": "10.1.22.1", "dns": [{"brif": "t3s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t3s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t3ns2", "route": [{"if": "p1", "ip": "10.1.22.1/24", "ns_if": "t3if", "ns_name": "t3"}], "subnet_ip": "2.2.2.0/24", "tenant_ns": [{"tenant_ns_if": "t3ns2if", "tenant_ns_ip": "10.1.22.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s2if", "tenant_sub_ip": "10.1.22.2/24"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, {"brif": "t3br2if1", "disk": "10G", "mem": 3, "name": "t3_VM3", "vcpu": 2, "vmif": "t3VM3if1"}]}

TASK [Attach VM interface] **********************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.21.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.1.21.1', u'bridge_name': u't3br1', u'dns': [{u'dnsif': u't3s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't3s1_dnsbrif'}], u'ns_name': u't3ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.21.2/24', u'tenant_ns_ip': u'10.1.21.1/24', u'tenant_ns_if': u't3ns1if', u'tenant_sub_if': u't3s1if', u'tenant_ns_name': u't3'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.1.21.2', u'dsport': 4789, u'dev': u't3s1if', u'tenant_route_ip': u'192.168.3.2', u'remote_route': u'10.2.21.0/24', u'subnet_route': u'10.1.21.0/24', u'v_name': u'vxlan_t3s1', u'id': 42, u'remote_ip': u'10.2.21.2'}]}, {u'mem': 2, u'name': u't3_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't3br1if1', u'vmif': u't3VM1if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "virsh domiflist \"t3_VM1\" | grep -w 't3VM1if1' ; if [ $? -ne 0 ] ; then virsh attach-interface \"t3_VM1\" direct \"t3VM1if1\" --live --persistent ; fi\n", "delta": "0:00:00.327336", "end": "2019-11-18 08:27:02.507714", "item": [{"bridge_name": "t3br1", "default_route_ip": "10.1.21.1", "dns": [{"brif": "t3s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t3s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t3ns1", "route": [{"if": "p1", "ip": "10.1.21.1/24", "ns_if": "t3if", "ns_name": "t3"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t3ns1if", "tenant_ns_ip": "10.1.21.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s1if", "tenant_sub_ip": "10.1.21.2/24"}], "vxlan": [{"dev": "t3s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.21.2", "remote_ip": "10.2.21.2", "remote_route": "10.2.21.0/24", "subnet_route": "10.1.21.0/24", "tenant_route_ip": "192.168.3.2", "v_name": "vxlan_t3s1"}]}, {"brif": "t3br1if1", "disk": "10G", "mem": 2, "name": "t3_VM1", "vcpu": 4, "vmif": "t3VM1if1"}], "rc": 0, "start": "2019-11-18 08:27:02.180378", "stderr": "", "stderr_lines": [], "stdout": "Interface attached successfully", "stdout_lines": ["Interface attached successfully"]}
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.21.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.1.21.1', u'bridge_name': u't3br1', u'dns': [{u'dnsif': u't3s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't3s1_dnsbrif'}], u'ns_name': u't3ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.21.2/24', u'tenant_ns_ip': u'10.1.21.1/24', u'tenant_ns_if': u't3ns1if', u'tenant_sub_if': u't3s1if', u'tenant_ns_name': u't3'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.1.21.2', u'dsport': 4789, u'dev': u't3s1if', u'tenant_route_ip': u'192.168.3.2', u'remote_route': u'10.2.21.0/24', u'subnet_route': u'10.1.21.0/24', u'v_name': u'vxlan_t3s1', u'id': 42, u'remote_ip': u'10.2.21.2'}]}, {u'mem': 4, u'name': u't3_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't3br1if2', u'vmif': u't3VM2if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "virsh domiflist \"t3_VM2\" | grep -w 't3VM2if1' ; if [ $? -ne 0 ] ; then virsh attach-interface \"t3_VM2\" direct \"t3VM2if1\" --live --persistent ; fi\n", "delta": "0:00:00.228092", "end": "2019-11-18 08:27:02.893301", "item": [{"bridge_name": "t3br1", "default_route_ip": "10.1.21.1", "dns": [{"brif": "t3s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t3s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t3ns1", "route": [{"if": "p1", "ip": "10.1.21.1/24", "ns_if": "t3if", "ns_name": "t3"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t3ns1if", "tenant_ns_ip": "10.1.21.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s1if", "tenant_sub_ip": "10.1.21.2/24"}], "vxlan": [{"dev": "t3s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.21.2", "remote_ip": "10.2.21.2", "remote_route": "10.2.21.0/24", "subnet_route": "10.1.21.0/24", "tenant_route_ip": "192.168.3.2", "v_name": "vxlan_t3s1"}]}, {"brif": "t3br1if2", "disk": "10G", "mem": 4, "name": "t3_VM2", "vcpu": 2, "vmif": "t3VM2if1"}], "rc": 0, "start": "2019-11-18 08:27:02.665209", "stderr": "", "stderr_lines": [], "stdout": "Interface attached successfully", "stdout_lines": ["Interface attached successfully"]}
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.22.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.1.22.1', u'bridge_name': u't3br2', u'dns': [{u'dnsif': u't3s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't3s2_dnsbrif'}], u'ns_name': u't3ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.22.2/24', u'tenant_ns_ip': u'10.1.22.1/24', u'tenant_ns_if': u't3ns2if', u'tenant_sub_if': u't3s2if', u'tenant_ns_name': u't3'}], u'subnet_ip': u'2.2.2.0/24', u'vxlan': [{u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}, {u'mem': 3, u'name': u't3_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't3br2if1', u'vmif': u't3VM3if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "virsh domiflist \"t3_VM3\" | grep -w 't3VM3if1' ; if [ $? -ne 0 ] ; then virsh attach-interface \"t3_VM3\" direct \"t3VM3if1\" --live --persistent ; fi\n", "delta": "0:00:00.234158", "end": "2019-11-18 08:27:03.259447", "item": [{"bridge_name": "t3br2", "default_route_ip": "10.1.22.1", "dns": [{"brif": "t3s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t3s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t3ns2", "route": [{"if": "p1", "ip": "10.1.22.1/24", "ns_if": "t3if", "ns_name": "t3"}], "subnet_ip": "2.2.2.0/24", "tenant_ns": [{"tenant_ns_if": "t3ns2if", "tenant_ns_ip": "10.1.22.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s2if", "tenant_sub_ip": "10.1.22.2/24"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, {"brif": "t3br2if1", "disk": "10G", "mem": 3, "name": "t3_VM3", "vcpu": 2, "vmif": "t3VM3if1"}], "rc": 0, "start": "2019-11-18 08:27:03.025289", "stderr": "", "stderr_lines": [], "stdout": "Interface attached successfully", "stdout_lines": ["Interface attached successfully"]}

TASK [Attach VM interent interface] *************************************************************************************************************************
changed: [localhost] => (item=[{u'subnet_addr': u'1.1.1.0/24'}, {u'mem': 2, u'vcpu': 4, u'disk': u'10G', u'name': u'VM1', u'internet_access': True}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "virsh domiflist 't3_VM1' | grep -w 'default' ; if [ $? -ne 0 ] ; then virsh attach-interface --domain 't3_VM1' --type network --source default --live --config ; fi\n", "delta": "0:00:00.240423", "end": "2019-11-18 08:27:03.671612", "item": [{"subnet_addr": "1.1.1.0/24"}, {"disk": "10G", "internet_access": true, "mem": 2, "name": "VM1", "vcpu": 4}], "rc": 0, "start": "2019-11-18 08:27:03.431189", "stderr": "", "stderr_lines": [], "stdout": "Interface attached successfully", "stdout_lines": ["Interface attached successfully"]}
skipping: [localhost] => (item=[{u'subnet_addr': u'1.1.1.0/24'}, {u'mem': 4, u'vcpu': 2, u'disk': u'10G', u'name': u'VM2', u'internet_access': False}])  => {"ansible_loop_var": "item", "changed": false, "item": [{"subnet_addr": "1.1.1.0/24"}, {"disk": "10G", "internet_access": false, "mem": 4, "name": "VM2", "vcpu": 2}], "skip_reason": "Conditional result was False"}
changed: [localhost] => (item=[{u'subnet_addr': u'2.2.2.0/24'}, {u'mem': 3, u'vcpu': 2, u'disk': u'10G', u'name': u'VM3', u'internet_access': True}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "virsh domiflist 't3_VM3' | grep -w 'default' ; if [ $? -ne 0 ] ; then virsh attach-interface --domain 't3_VM3' --type network --source default --live --config ; fi\n", "delta": "0:00:00.245790", "end": "2019-11-18 08:27:04.073124", "item": [{"subnet_addr": "2.2.2.0/24"}, {"disk": "10G", "internet_access": true, "mem": 3, "name": "VM3", "vcpu": 2}], "rc": 0, "start": "2019-11-18 08:27:03.827334", "stderr": "", "stderr_lines": [], "stdout": "Interface attached successfully", "stdout_lines": ["Interface attached successfully"]}

PLAY RECAP **************************************************************************************************************************************************
localhost                  : ok=8    changed=4    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0   

Using /etc/ansible/ansible.cfg as config file

PLAY [worker] ***********************************************************************************************************************************************

TASK [Copy VM image] ****************************************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.21.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.2.21.1', u'bridge_name': u't3br1', u'dns': [{u'dnsif': u't3s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't3s1_dnsbrif'}], u'ns_name': u't3ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.21.2/24', u'tenant_ns_ip': u'10.2.21.1/24', u'tenant_ns_if': u't3ns1if', u'tenant_sub_if': u't3s1if', u'tenant_ns_name': u't3'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.2.21.2', u'dsport': 4789, u'dev': u't3s1if', u'tenant_route_ip': u'192.168.131.2', u'remote_route': u'10.1.21.0/24', u'subnet_route': u'10.2.21.0/24', u'v_name': u'vxlan_t3s1', u'id': 42, u'remote_ip': u'10.1.21.2'}]}, {u'mem': 2, u'name': u't3_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't3br1if1', u'vmif': u't3VM4if1'}]) => {"ansible_loop_var": "item", "changed": true, "checksum": "f8b2ffa2bf201c84196c582f2dec0d33a1eb4b42", "dest": "/var/lib/libvirt/images/t3_VM4.qcow2", "gid": 0, "group": "root", "item": [{"bridge_name": "t3br1", "default_route_ip": "10.2.21.1", "dns": [{"brif": "t3s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t3s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "ns_name": "t3ns1", "route": [{"if": "p1", "ip": "10.2.21.1/24", "ns_if": "t3if", "ns_name": "t3"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t3ns1if", "tenant_ns_ip": "10.2.21.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s1if", "tenant_sub_ip": "10.2.21.2/24"}], "vxlan": [{"dev": "t3s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.21.2", "remote_ip": "10.1.21.2", "remote_route": "10.1.21.0/24", "subnet_route": "10.2.21.0/24", "tenant_route_ip": "192.168.131.2", "v_name": "vxlan_t3s1"}]}, {"brif": "t3br1if1", "disk": "10G", "mem": 2, "name": "t3_VM4", "vcpu": 4, "vmif": "t3VM4if1"}], "md5sum": "e6d5d524b68797ddd748ba1475985d34", "mode": "0644", "owner": "root", "size": 10739318784, "src": "/root/mainVM.qcow2", "state": "file", "uid": 0}

TASK [Get list of running VMs] ******************************************************************************************************************************
ok: [99.99.99.2] => {"changed": false, "cmd": ["virsh", "list", "--name"], "delta": "0:00:00.428437", "end": "2019-11-18 08:28:42.439506", "rc": 0, "start": "2019-11-18 08:28:42.011069", "stderr": "", "stderr_lines": [], "stdout": "t1_VM4\nt1_VM1\nt2_VM4\nt2_VM1", "stdout_lines": ["t1_VM4", "t1_VM1", "t2_VM4", "t2_VM1"]}

TASK [Define VM] ********************************************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.21.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.2.21.1', u'bridge_name': u't3br1', u'dns': [{u'dnsif': u't3s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't3s1_dnsbrif'}], u'ns_name': u't3ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.21.2/24', u'tenant_ns_ip': u'10.2.21.1/24', u'tenant_ns_if': u't3ns1if', u'tenant_sub_if': u't3s1if', u'tenant_ns_name': u't3'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.2.21.2', u'dsport': 4789, u'dev': u't3s1if', u'tenant_route_ip': u'192.168.131.2', u'remote_route': u'10.1.21.0/24', u'subnet_route': u'10.2.21.0/24', u'v_name': u'vxlan_t3s1', u'id': 42, u'remote_ip': u'10.1.21.2'}]}, {u'mem': 2, u'name': u't3_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't3br1if1', u'vmif': u't3VM4if1'}]) => {"ansible_loop_var": "item", "changed": true, "created": "t3_VM4", "item": [{"bridge_name": "t3br1", "default_route_ip": "10.2.21.1", "dns": [{"brif": "t3s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t3s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "ns_name": "t3ns1", "route": [{"if": "p1", "ip": "10.2.21.1/24", "ns_if": "t3if", "ns_name": "t3"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t3ns1if", "tenant_ns_ip": "10.2.21.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s1if", "tenant_sub_ip": "10.2.21.2/24"}], "vxlan": [{"dev": "t3s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.21.2", "remote_ip": "10.1.21.2", "remote_route": "10.1.21.0/24", "subnet_route": "10.2.21.0/24", "tenant_route_ip": "192.168.131.2", "v_name": "vxlan_t3s1"}]}, {"brif": "t3br1if1", "disk": "10G", "mem": 2, "name": "t3_VM4", "vcpu": 4, "vmif": "t3VM4if1"}], "warnings": ["'xml' is given - ignoring 'name'"]}

TASK [Create VM] ********************************************************************************************************************************************
ok: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.21.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.2.21.1', u'bridge_name': u't3br1', u'dns': [{u'dnsif': u't3s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't3s1_dnsbrif'}], u'ns_name': u't3ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.21.2/24', u'tenant_ns_ip': u'10.2.21.1/24', u'tenant_ns_if': u't3ns1if', u'tenant_sub_if': u't3s1if', u'tenant_ns_name': u't3'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.2.21.2', u'dsport': 4789, u'dev': u't3s1if', u'tenant_route_ip': u'192.168.131.2', u'remote_route': u'10.1.21.0/24', u'subnet_route': u'10.2.21.0/24', u'v_name': u'vxlan_t3s1', u'id': 42, u'remote_ip': u'10.1.21.2'}]}, {u'mem': 2, u'name': u't3_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't3br1if1', u'vmif': u't3VM4if1'}]) => {"ansible_loop_var": "item", "changed": false, "create": 0, "item": [{"bridge_name": "t3br1", "default_route_ip": "10.2.21.1", "dns": [{"brif": "t3s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t3s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "ns_name": "t3ns1", "route": [{"if": "p1", "ip": "10.2.21.1/24", "ns_if": "t3if", "ns_name": "t3"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t3ns1if", "tenant_ns_ip": "10.2.21.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s1if", "tenant_sub_ip": "10.2.21.2/24"}], "vxlan": [{"dev": "t3s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.21.2", "remote_ip": "10.1.21.2", "remote_route": "10.1.21.0/24", "subnet_route": "10.2.21.0/24", "tenant_route_ip": "192.168.131.2", "v_name": "vxlan_t3s1"}]}, {"brif": "t3br1if1", "disk": "10G", "mem": 2, "name": "t3_VM4", "vcpu": 4, "vmif": "t3VM4if1"}]}

TASK [Start VM] *********************************************************************************************************************************************
ok: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.21.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.2.21.1', u'bridge_name': u't3br1', u'dns': [{u'dnsif': u't3s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't3s1_dnsbrif'}], u'ns_name': u't3ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.21.2/24', u'tenant_ns_ip': u'10.2.21.1/24', u'tenant_ns_if': u't3ns1if', u'tenant_sub_if': u't3s1if', u'tenant_ns_name': u't3'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.2.21.2', u'dsport': 4789, u'dev': u't3s1if', u'tenant_route_ip': u'192.168.131.2', u'remote_route': u'10.1.21.0/24', u'subnet_route': u'10.2.21.0/24', u'v_name': u'vxlan_t3s1', u'id': 42, u'remote_ip': u'10.1.21.2'}]}, {u'mem': 2, u'name': u't3_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't3br1if1', u'vmif': u't3VM4if1'}]) => {"ansible_loop_var": "item", "changed": false, "item": [{"bridge_name": "t3br1", "default_route_ip": "10.2.21.1", "dns": [{"brif": "t3s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t3s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "ns_name": "t3ns1", "route": [{"if": "p1", "ip": "10.2.21.1/24", "ns_if": "t3if", "ns_name": "t3"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t3ns1if", "tenant_ns_ip": "10.2.21.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s1if", "tenant_sub_ip": "10.2.21.2/24"}], "vxlan": [{"dev": "t3s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.21.2", "remote_ip": "10.1.21.2", "remote_route": "10.1.21.0/24", "subnet_route": "10.2.21.0/24", "tenant_route_ip": "192.168.131.2", "v_name": "vxlan_t3s1"}]}, {"brif": "t3br1if1", "disk": "10G", "mem": 2, "name": "t3_VM4", "vcpu": 4, "vmif": "t3VM4if1"}]}

TASK [Attach VM interface] **********************************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.21.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.2.21.1', u'bridge_name': u't3br1', u'dns': [{u'dnsif': u't3s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't3s1_dnsbrif'}], u'ns_name': u't3ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.21.2/24', u'tenant_ns_ip': u'10.2.21.1/24', u'tenant_ns_if': u't3ns1if', u'tenant_sub_if': u't3s1if', u'tenant_ns_name': u't3'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.2.21.2', u'dsport': 4789, u'dev': u't3s1if', u'tenant_route_ip': u'192.168.131.2', u'remote_route': u'10.1.21.0/24', u'subnet_route': u'10.2.21.0/24', u'v_name': u'vxlan_t3s1', u'id': 42, u'remote_ip': u'10.1.21.2'}]}, {u'mem': 2, u'name': u't3_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't3br1if1', u'vmif': u't3VM4if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "virsh domiflist \"t3_VM4\" | grep -w 't3VM4if1' ; if [ $? -ne 0 ] ; then virsh attach-interface \"t3_VM4\" direct \"t3VM4if1\" --live --persistent ; fi\n", "delta": "0:00:00.239424", "end": "2019-11-18 08:29:15.319579", "item": [{"bridge_name": "t3br1", "default_route_ip": "10.2.21.1", "dns": [{"brif": "t3s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t3s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "ns_name": "t3ns1", "route": [{"if": "p1", "ip": "10.2.21.1/24", "ns_if": "t3if", "ns_name": "t3"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t3ns1if", "tenant_ns_ip": "10.2.21.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s1if", "tenant_sub_ip": "10.2.21.2/24"}], "vxlan": [{"dev": "t3s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.21.2", "remote_ip": "10.1.21.2", "remote_route": "10.1.21.0/24", "subnet_route": "10.2.21.0/24", "tenant_route_ip": "192.168.131.2", "v_name": "vxlan_t3s1"}]}, {"brif": "t3br1if1", "disk": "10G", "mem": 2, "name": "t3_VM4", "vcpu": 4, "vmif": "t3VM4if1"}], "rc": 0, "start": "2019-11-18 08:29:15.080155", "stderr": "", "stderr_lines": [], "stdout": "Interface attached successfully", "stdout_lines": ["Interface attached successfully"]}

TASK [Attach VM interent interface] *************************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'subnet_addr': u'1.1.1.0/24'}, {u'mem': 2, u'vcpu': 4, u'disk': u'10G', u'name': u'VM4', u'internet_access': True}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "virsh domiflist 't3_VM4' | grep -w 'default' ; if [ $? -ne 0 ] ; then virsh attach-interface --domain 't3_VM4' --type network --source default --live --config ; fi\n", "delta": "0:00:00.229887", "end": "2019-11-18 08:29:15.826946", "item": [{"subnet_addr": "1.1.1.0/24"}, {"disk": "10G", "internet_access": true, "mem": 2, "name": "VM4", "vcpu": 4}], "rc": 0, "start": "2019-11-18 08:29:15.597059", "stderr": "", "stderr_lines": [], "stdout": "Interface attached successfully", "stdout_lines": ["Interface attached successfully"]}

PLAY RECAP **************************************************************************************************************************************************
99.99.99.2                 : ok=7    changed=4    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0   

INFO:root: 08:30:17.250802 The subnet 1.1.1.0/24 is present in Cloud 1
INFO:root: 08:30:17.250983 The subnet 1.1.1.0/24 is present in Cloud 2
INFO:root: 08:30:17.251023 The VM VM1 is present in Cloud 1
INFO:root: 08:30:17.251053 The VM VM4 is present in Cloud 2
INFO:root: 08:30:17.251112 The subnet 1.1.1.0/24 is present in destination cloud
INFO:root: 08:30:17.251144 The subnet 1.1.1.0/24 is present in destination cloud
INFO:root: 10:33:06.048175 Printing the yaml input file
INFO:root: 10:33:06.062423 {'C1': [{'subnet_addr': '1.1.1.0/24', 'VM': [{'name': 'VM1', 'disk': '10G', 'mem': 2, 'vcpu': 4, 'internet_access': True}, {'name': 'VM2', 'disk': '10G', 'mem': 4, 'vcpu': 2, 'internet_access': False}]}, {'subnet_addr': '2.2.2.0/24', 'VM': [{'name': 'VM3', 'disk': '10G', 'mem': 3, 'vcpu': 2, 'internet_access': True}]}], 'C2': [{'subnet_addr': '1.1.1.0/24', 'VM': [{'name': 'VM4', 'disk': '10G', 'mem': 2, 'vcpu': 4, 'internet_access': True}]}]}
INFO:root: 10:33:06.063013 Provided subnet in C1: 1.1.1.0/24 is valid
INFO:root: 10:33:06.063077 Provided subnet in C1: 2.2.2.0/24 is valid
INFO:root: 10:33:06.063123 Provided subnet in C2: 1.1.1.0/24 is valid
Using /etc/ansible/ansible.cfg as config file

PLAY [main] *************************************************************************************************************************************************

TASK [Create Tenant Namespace] ******************************************************************************************************************************
changed: [localhost] => (item={u'default_route_ip': u'192.168.4.1', u'name': u't4', u'pns_ip': u'192.168.4.1/24', u'tenant_if': u't4if', u'tenant_ip': u'192.168.4.2/24', u'pns_if': u't4pns_if'}) => {"ansible_loop_var": "item", "changed": true, "cmd": ["ip", "netns", "add", "t4"], "delta": "0:00:00.050852", "end": "2019-11-18 10:33:07.521583", "item": {"default_route_ip": "192.168.4.1", "name": "t4", "pns_if": "t4pns_if", "pns_ip": "192.168.4.1/24", "tenant_if": "t4if", "tenant_ip": "192.168.4.2/24"}, "rc": 0, "start": "2019-11-18 10:33:07.470731", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Create Subnet Namespace] ******************************************************************************************************************************
changed: [localhost] => (item={u'route': [{u'ip': u'10.1.31.1/24', u'ns_name': u't4', u'ns_if': u't4if', u'if': u'p1'}], u'default_route_ip': u'10.1.31.1', u'bridge_name': u't4br1', u'dns': [{u'dnsif': u't4s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't4s1_dnsbrif'}], u'ns_name': u't4ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.31.2/24', u'tenant_ns_ip': u'10.1.31.1/24', u'tenant_ns_if': u't4ns1if', u'tenant_ns_name': u't4', u'tenant_sub_if': u't4s1if'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't4_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't4br1if1', u'vmif': u't4VM1if1'}, {u'mem': 4, u'name': u't4_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't4br1if2', u'vmif': u't4VM2if1'}], u'vxlan': [{u'local_ip': u'10.1.31.2', u'tenant_route_ip': u'192.168.4.2', u'dsport': 4789, u'dev': u't4s1if', u'subnet_route': u'10.1.31.0/24', u'remote_route': u'10.2.31.0/24', u'v_name': u'vxlan_t4s1', u'id': 42, u'remote_ip': u'10.2.31.2'}]}) => {"ansible_loop_var": "item", "changed": true, "cmd": ["ip", "netns", "add", "t4ns1"], "delta": "0:00:00.056241", "end": "2019-11-18 10:33:07.837448", "item": {"bridge_name": "t4br1", "default_route_ip": "10.1.31.1", "dns": [{"brif": "t4s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t4s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t4ns1", "route": [{"if": "p1", "ip": "10.1.31.1/24", "ns_if": "t4if", "ns_name": "t4"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t4ns1if", "tenant_ns_ip": "10.1.31.1/24", "tenant_ns_name": "t4", "tenant_sub_if": "t4s1if", "tenant_sub_ip": "10.1.31.2/24"}], "vms": [{"brif": "t4br1if1", "disk": "10G", "mem": 2, "name": "t4_VM1", "vcpu": 4, "vmif": "t4VM1if1"}, {"brif": "t4br1if2", "disk": "10G", "mem": 4, "name": "t4_VM2", "vcpu": 2, "vmif": "t4VM2if1"}], "vxlan": [{"dev": "t4s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.31.2", "remote_ip": "10.2.31.2", "remote_route": "10.2.31.0/24", "subnet_route": "10.1.31.0/24", "tenant_route_ip": "192.168.4.2", "v_name": "vxlan_t4s1"}]}, "rc": 0, "start": "2019-11-18 10:33:07.781207", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}
changed: [localhost] => (item={u'route': [{u'ip': u'10.1.32.1/24', u'ns_name': u't4', u'ns_if': u't4if', u'if': u'p1'}], u'default_route_ip': u'10.1.32.1', u'bridge_name': u't4br2', u'dns': [{u'dnsif': u't4s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't4s2_dnsbrif'}], u'ns_name': u't4ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.32.2/24', u'tenant_ns_ip': u'10.1.32.1/24', u'tenant_ns_if': u't4ns2if', u'tenant_ns_name': u't4', u'tenant_sub_if': u't4s2if'}], u'subnet_ip': u'2.2.2.0/24', u'vms': [{u'mem': 3, u'name': u't4_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't4br2if1', u'vmif': u't4VM3if1'}], u'vxlan': [{u'local_ip': [], u'tenant_route_ip': [], u'dsport': [], u'dev': [], u'subnet_route': [], u'remote_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}) => {"ansible_loop_var": "item", "changed": true, "cmd": ["ip", "netns", "add", "t4ns2"], "delta": "0:00:00.058682", "end": "2019-11-18 10:33:08.117974", "item": {"bridge_name": "t4br2", "default_route_ip": "10.1.32.1", "dns": [{"brif": "t4s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t4s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t4ns2", "route": [{"if": "p1", "ip": "10.1.32.1/24", "ns_if": "t4if", "ns_name": "t4"}], "subnet_ip": "2.2.2.0/24", "tenant_ns": [{"tenant_ns_if": "t4ns2if", "tenant_ns_ip": "10.1.32.1/24", "tenant_ns_name": "t4", "tenant_sub_if": "t4s2if", "tenant_sub_ip": "10.1.32.2/24"}], "vms": [{"brif": "t4br2if1", "disk": "10G", "mem": 3, "name": "t4_VM3", "vcpu": 2, "vmif": "t4VM3if1"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, "rc": 0, "start": "2019-11-18 10:33:08.059292", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Create Tenant VETH pairs] *****************************************************************************************************************************
changed: [localhost] => (item={u'default_route_ip': u'192.168.4.1', u'name': u't4', u'pns_ip': u'192.168.4.1/24', u'tenant_if': u't4if', u'tenant_ip': u'192.168.4.2/24', u'pns_if': u't4pns_if'}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip link show \"t4if\" ; if [ $? -ne 0 ] ; then ip link add \"t4if\" type veth peer name \"t4pns_if\" ; fi\n", "delta": "0:00:00.014840", "end": "2019-11-18 10:33:08.417233", "item": {"default_route_ip": "192.168.4.1", "name": "t4", "pns_if": "t4pns_if", "pns_ip": "192.168.4.1/24", "tenant_if": "t4if", "tenant_ip": "192.168.4.2/24"}, "rc": 0, "start": "2019-11-18 10:33:08.402393", "stderr": "Device \"t4if\" does not exist.", "stderr_lines": ["Device \"t4if\" does not exist."], "stdout": "", "stdout_lines": []}

TASK [Attach Tenant VETH Pairs] *****************************************************************************************************************************
changed: [localhost] => (item={u'default_route_ip': u'192.168.4.1', u'name': u't4', u'pns_ip': u'192.168.4.1/24', u'tenant_if': u't4if', u'tenant_ip': u'192.168.4.2/24', u'pns_if': u't4pns_if'}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec pns ip link show \"t4pns_if\" ; if [ $? -ne 0 ] ; then ip link set \"t4pns_if\" netns pns ; fi\nip netns exec \"t4\" ip link show \"t4if\" ; if [ $? -ne 0 ] ; then ip link set \"t4if\" netns \"t4\" ; fi\nip netns exec pns ip link set dev \"t4pns_if\" up\nip netns exec \"t4\" ip link set dev \"t4if\" up\n", "delta": "0:00:00.188363", "end": "2019-11-18 10:33:08.901309", "item": {"default_route_ip": "192.168.4.1", "name": "t4", "pns_if": "t4pns_if", "pns_ip": "192.168.4.1/24", "tenant_if": "t4if", "tenant_ip": "192.168.4.2/24"}, "rc": 0, "start": "2019-11-18 10:33:08.712946", "stderr": "Device \"t4pns_if\" does not exist.\nDevice \"t4if\" does not exist.", "stderr_lines": ["Device \"t4pns_if\" does not exist.", "Device \"t4if\" does not exist."], "stdout": "", "stdout_lines": []}

TASK [Add IP addresses to Tenant VETH Pairs] ****************************************************************************************************************
changed: [localhost] => (item={u'default_route_ip': u'192.168.4.1', u'name': u't4', u'pns_ip': u'192.168.4.1/24', u'tenant_if': u't4if', u'tenant_ip': u'192.168.4.2/24', u'pns_if': u't4pns_if'}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec pns ip addr show \"t4pns_if\" | awk 'FNR==3{ print $2 }' | grep -w '^192.168.4.1/24' ; if [ $? -ne 0 ] ; then ip netns exec pns ip addr add \"192.168.4.1/24\" dev \"t4pns_if\" ; fi\nip netns exec \"t4\" ip addr show \"t4if\" | awk 'FNR==3{ print $2 }' | grep -w '^192.168.4.2/24' ; if [ $? -ne 0 ] ; then ip netns exec \"t4\" ip addr add \"192.168.4.2/24\" dev \"t4if\" ; fi\n", "delta": "0:00:00.167599", "end": "2019-11-18 10:33:09.357633", "item": {"default_route_ip": "192.168.4.1", "name": "t4", "pns_if": "t4pns_if", "pns_ip": "192.168.4.1/24", "tenant_if": "t4if", "tenant_ip": "192.168.4.2/24"}, "rc": 0, "start": "2019-11-18 10:33:09.190034", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Create Namespace VETH Pairs] **************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.31.1/24', u'ns_name': u't4', u'ns_if': u't4if', u'if': u'p1'}], u'default_route_ip': u'10.1.31.1', u'bridge_name': u't4br1', u'dns': [{u'dnsif': u't4s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't4s1_dnsbrif'}], u'ns_name': u't4ns1', u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't4_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't4br1if1', u'vmif': u't4VM1if1'}, {u'mem': 4, u'name': u't4_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't4br1if2', u'vmif': u't4VM2if1'}], u'vxlan': [{u'local_ip': u'10.1.31.2', u'dsport': 4789, u'dev': u't4s1if', u'tenant_route_ip': u'192.168.4.2', u'remote_route': u'10.2.31.0/24', u'subnet_route': u'10.1.31.0/24', u'v_name': u'vxlan_t4s1', u'id': 42, u'remote_ip': u'10.2.31.2'}]}, {u'tenant_sub_ip': u'10.1.31.2/24', u'tenant_ns_ip': u'10.1.31.1/24', u'tenant_ns_if': u't4ns1if', u'tenant_sub_if': u't4s1if', u'tenant_ns_name': u't4'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip link show \"t4ns1if\" ; if [ $? -ne 0 ] ; then ip link add \"t4ns1if\" type veth peer name \"t4s1if\" ; fi\n", "delta": "0:00:00.014415", "end": "2019-11-18 10:33:09.659608", "item": [{"bridge_name": "t4br1", "default_route_ip": "10.1.31.1", "dns": [{"brif": "t4s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t4s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t4ns1", "route": [{"if": "p1", "ip": "10.1.31.1/24", "ns_if": "t4if", "ns_name": "t4"}], "subnet_ip": "1.1.1.0/24", "vms": [{"brif": "t4br1if1", "disk": "10G", "mem": 2, "name": "t4_VM1", "vcpu": 4, "vmif": "t4VM1if1"}, {"brif": "t4br1if2", "disk": "10G", "mem": 4, "name": "t4_VM2", "vcpu": 2, "vmif": "t4VM2if1"}], "vxlan": [{"dev": "t4s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.31.2", "remote_ip": "10.2.31.2", "remote_route": "10.2.31.0/24", "subnet_route": "10.1.31.0/24", "tenant_route_ip": "192.168.4.2", "v_name": "vxlan_t4s1"}]}, {"tenant_ns_if": "t4ns1if", "tenant_ns_ip": "10.1.31.1/24", "tenant_ns_name": "t4", "tenant_sub_if": "t4s1if", "tenant_sub_ip": "10.1.31.2/24"}], "rc": 0, "start": "2019-11-18 10:33:09.645193", "stderr": "Device \"t4ns1if\" does not exist.", "stderr_lines": ["Device \"t4ns1if\" does not exist."], "stdout": "", "stdout_lines": []}
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.32.1/24', u'ns_name': u't4', u'ns_if': u't4if', u'if': u'p1'}], u'default_route_ip': u'10.1.32.1', u'bridge_name': u't4br2', u'dns': [{u'dnsif': u't4s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't4s2_dnsbrif'}], u'ns_name': u't4ns2', u'subnet_ip': u'2.2.2.0/24', u'vms': [{u'mem': 3, u'name': u't4_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't4br2if1', u'vmif': u't4VM3if1'}], u'vxlan': [{u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}, {u'tenant_sub_ip': u'10.1.32.2/24', u'tenant_ns_ip': u'10.1.32.1/24', u'tenant_ns_if': u't4ns2if', u'tenant_sub_if': u't4s2if', u'tenant_ns_name': u't4'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip link show \"t4ns2if\" ; if [ $? -ne 0 ] ; then ip link add \"t4ns2if\" type veth peer name \"t4s2if\" ; fi\n", "delta": "0:00:00.014388", "end": "2019-11-18 10:33:09.912584", "item": [{"bridge_name": "t4br2", "default_route_ip": "10.1.32.1", "dns": [{"brif": "t4s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t4s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t4ns2", "route": [{"if": "p1", "ip": "10.1.32.1/24", "ns_if": "t4if", "ns_name": "t4"}], "subnet_ip": "2.2.2.0/24", "vms": [{"brif": "t4br2if1", "disk": "10G", "mem": 3, "name": "t4_VM3", "vcpu": 2, "vmif": "t4VM3if1"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, {"tenant_ns_if": "t4ns2if", "tenant_ns_ip": "10.1.32.1/24", "tenant_ns_name": "t4", "tenant_sub_if": "t4s2if", "tenant_sub_ip": "10.1.32.2/24"}], "rc": 0, "start": "2019-11-18 10:33:09.898196", "stderr": "Device \"t4ns2if\" does not exist.", "stderr_lines": ["Device \"t4ns2if\" does not exist."], "stdout": "", "stdout_lines": []}

TASK [Attach Namespace VETH Pairs] **************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.31.1/24', u'ns_name': u't4', u'ns_if': u't4if', u'if': u'p1'}], u'default_route_ip': u'10.1.31.1', u'bridge_name': u't4br1', u'dns': [{u'dnsif': u't4s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't4s1_dnsbrif'}], u'ns_name': u't4ns1', u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't4_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't4br1if1', u'vmif': u't4VM1if1'}, {u'mem': 4, u'name': u't4_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't4br1if2', u'vmif': u't4VM2if1'}], u'vxlan': [{u'local_ip': u'10.1.31.2', u'dsport': 4789, u'dev': u't4s1if', u'tenant_route_ip': u'192.168.4.2', u'remote_route': u'10.2.31.0/24', u'subnet_route': u'10.1.31.0/24', u'v_name': u'vxlan_t4s1', u'id': 42, u'remote_ip': u'10.2.31.2'}]}, {u'tenant_sub_ip': u'10.1.31.2/24', u'tenant_ns_ip': u'10.1.31.1/24', u'tenant_ns_if': u't4ns1if', u'tenant_sub_if': u't4s1if', u'tenant_ns_name': u't4'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t4\" ip link show \"t4ns1if\" ; if [ $? -ne 0 ] ; then ip link set \"t4ns1if\" netns \"t4\" ; fi\nip netns exec \"t4ns1\" ip link show \"t4s1if\" ; if [ $? -ne 0 ] ; then ip link set \"t4s1if\" netns \"t4ns1\" ; fi\n", "delta": "0:00:00.111392", "end": "2019-11-18 10:33:10.296515", "item": [{"bridge_name": "t4br1", "default_route_ip": "10.1.31.1", "dns": [{"brif": "t4s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t4s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t4ns1", "route": [{"if": "p1", "ip": "10.1.31.1/24", "ns_if": "t4if", "ns_name": "t4"}], "subnet_ip": "1.1.1.0/24", "vms": [{"brif": "t4br1if1", "disk": "10G", "mem": 2, "name": "t4_VM1", "vcpu": 4, "vmif": "t4VM1if1"}, {"brif": "t4br1if2", "disk": "10G", "mem": 4, "name": "t4_VM2", "vcpu": 2, "vmif": "t4VM2if1"}], "vxlan": [{"dev": "t4s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.31.2", "remote_ip": "10.2.31.2", "remote_route": "10.2.31.0/24", "subnet_route": "10.1.31.0/24", "tenant_route_ip": "192.168.4.2", "v_name": "vxlan_t4s1"}]}, {"tenant_ns_if": "t4ns1if", "tenant_ns_ip": "10.1.31.1/24", "tenant_ns_name": "t4", "tenant_sub_if": "t4s1if", "tenant_sub_ip": "10.1.31.2/24"}], "rc": 0, "start": "2019-11-18 10:33:10.185123", "stderr": "Device \"t4ns1if\" does not exist.\nDevice \"t4s1if\" does not exist.", "stderr_lines": ["Device \"t4ns1if\" does not exist.", "Device \"t4s1if\" does not exist."], "stdout": "", "stdout_lines": []}
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.32.1/24', u'ns_name': u't4', u'ns_if': u't4if', u'if': u'p1'}], u'default_route_ip': u'10.1.32.1', u'bridge_name': u't4br2', u'dns': [{u'dnsif': u't4s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't4s2_dnsbrif'}], u'ns_name': u't4ns2', u'subnet_ip': u'2.2.2.0/24', u'vms': [{u'mem': 3, u'name': u't4_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't4br2if1', u'vmif': u't4VM3if1'}], u'vxlan': [{u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}, {u'tenant_sub_ip': u'10.1.32.2/24', u'tenant_ns_ip': u'10.1.32.1/24', u'tenant_ns_if': u't4ns2if', u'tenant_sub_if': u't4s2if', u'tenant_ns_name': u't4'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t4\" ip link show \"t4ns2if\" ; if [ $? -ne 0 ] ; then ip link set \"t4ns2if\" netns \"t4\" ; fi\nip netns exec \"t4ns2\" ip link show \"t4s2if\" ; if [ $? -ne 0 ] ; then ip link set \"t4s2if\" netns \"t4ns2\" ; fi\n", "delta": "0:00:00.115489", "end": "2019-11-18 10:33:10.606544", "item": [{"bridge_name": "t4br2", "default_route_ip": "10.1.32.1", "dns": [{"brif": "t4s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t4s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t4ns2", "route": [{"if": "p1", "ip": "10.1.32.1/24", "ns_if": "t4if", "ns_name": "t4"}], "subnet_ip": "2.2.2.0/24", "vms": [{"brif": "t4br2if1", "disk": "10G", "mem": 3, "name": "t4_VM3", "vcpu": 2, "vmif": "t4VM3if1"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, {"tenant_ns_if": "t4ns2if", "tenant_ns_ip": "10.1.32.1/24", "tenant_ns_name": "t4", "tenant_sub_if": "t4s2if", "tenant_sub_ip": "10.1.32.2/24"}], "rc": 0, "start": "2019-11-18 10:33:10.491055", "stderr": "Device \"t4ns2if\" does not exist.\nDevice \"t4s2if\" does not exist.", "stderr_lines": ["Device \"t4ns2if\" does not exist.", "Device \"t4s2if\" does not exist."], "stdout": "", "stdout_lines": []}

TASK [Set Namespace VETH Pairs UP] **************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.31.1/24', u'ns_name': u't4', u'ns_if': u't4if', u'if': u'p1'}], u'default_route_ip': u'10.1.31.1', u'bridge_name': u't4br1', u'dns': [{u'dnsif': u't4s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't4s1_dnsbrif'}], u'ns_name': u't4ns1', u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't4_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't4br1if1', u'vmif': u't4VM1if1'}, {u'mem': 4, u'name': u't4_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't4br1if2', u'vmif': u't4VM2if1'}], u'vxlan': [{u'local_ip': u'10.1.31.2', u'dsport': 4789, u'dev': u't4s1if', u'tenant_route_ip': u'192.168.4.2', u'remote_route': u'10.2.31.0/24', u'subnet_route': u'10.1.31.0/24', u'v_name': u'vxlan_t4s1', u'id': 42, u'remote_ip': u'10.2.31.2'}]}, {u'tenant_sub_ip': u'10.1.31.2/24', u'tenant_ns_ip': u'10.1.31.1/24', u'tenant_ns_if': u't4ns1if', u'tenant_sub_if': u't4s1if', u'tenant_ns_name': u't4'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t4\" ip link set dev \"t4ns1if\" up\nip netns exec \"t4ns1\" ip link set dev \"t4s1if\" up\n", "delta": "0:00:00.091801", "end": "2019-11-18 10:33:10.945243", "item": [{"bridge_name": "t4br1", "default_route_ip": "10.1.31.1", "dns": [{"brif": "t4s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t4s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t4ns1", "route": [{"if": "p1", "ip": "10.1.31.1/24", "ns_if": "t4if", "ns_name": "t4"}], "subnet_ip": "1.1.1.0/24", "vms": [{"brif": "t4br1if1", "disk": "10G", "mem": 2, "name": "t4_VM1", "vcpu": 4, "vmif": "t4VM1if1"}, {"brif": "t4br1if2", "disk": "10G", "mem": 4, "name": "t4_VM2", "vcpu": 2, "vmif": "t4VM2if1"}], "vxlan": [{"dev": "t4s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.31.2", "remote_ip": "10.2.31.2", "remote_route": "10.2.31.0/24", "subnet_route": "10.1.31.0/24", "tenant_route_ip": "192.168.4.2", "v_name": "vxlan_t4s1"}]}, {"tenant_ns_if": "t4ns1if", "tenant_ns_ip": "10.1.31.1/24", "tenant_ns_name": "t4", "tenant_sub_if": "t4s1if", "tenant_sub_ip": "10.1.31.2/24"}], "rc": 0, "start": "2019-11-18 10:33:10.853442", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.32.1/24', u'ns_name': u't4', u'ns_if': u't4if', u'if': u'p1'}], u'default_route_ip': u'10.1.32.1', u'bridge_name': u't4br2', u'dns': [{u'dnsif': u't4s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't4s2_dnsbrif'}], u'ns_name': u't4ns2', u'subnet_ip': u'2.2.2.0/24', u'vms': [{u'mem': 3, u'name': u't4_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't4br2if1', u'vmif': u't4VM3if1'}], u'vxlan': [{u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}, {u'tenant_sub_ip': u'10.1.32.2/24', u'tenant_ns_ip': u'10.1.32.1/24', u'tenant_ns_if': u't4ns2if', u'tenant_sub_if': u't4s2if', u'tenant_ns_name': u't4'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t4\" ip link set dev \"t4ns2if\" up\nip netns exec \"t4ns2\" ip link set dev \"t4s2if\" up\n", "delta": "0:00:00.089415", "end": "2019-11-18 10:33:11.261654", "item": [{"bridge_name": "t4br2", "default_route_ip": "10.1.32.1", "dns": [{"brif": "t4s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t4s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t4ns2", "route": [{"if": "p1", "ip": "10.1.32.1/24", "ns_if": "t4if", "ns_name": "t4"}], "subnet_ip": "2.2.2.0/24", "vms": [{"brif": "t4br2if1", "disk": "10G", "mem": 3, "name": "t4_VM3", "vcpu": 2, "vmif": "t4VM3if1"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, {"tenant_ns_if": "t4ns2if", "tenant_ns_ip": "10.1.32.1/24", "tenant_ns_name": "t4", "tenant_sub_if": "t4s2if", "tenant_sub_ip": "10.1.32.2/24"}], "rc": 0, "start": "2019-11-18 10:33:11.172239", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Add IP addresses to Namespace VETH Pairs] *************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.31.1/24', u'ns_name': u't4', u'ns_if': u't4if', u'if': u'p1'}], u'default_route_ip': u'10.1.31.1', u'bridge_name': u't4br1', u'dns': [{u'dnsif': u't4s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't4s1_dnsbrif'}], u'ns_name': u't4ns1', u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't4_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't4br1if1', u'vmif': u't4VM1if1'}, {u'mem': 4, u'name': u't4_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't4br1if2', u'vmif': u't4VM2if1'}], u'vxlan': [{u'local_ip': u'10.1.31.2', u'dsport': 4789, u'dev': u't4s1if', u'tenant_route_ip': u'192.168.4.2', u'remote_route': u'10.2.31.0/24', u'subnet_route': u'10.1.31.0/24', u'v_name': u'vxlan_t4s1', u'id': 42, u'remote_ip': u'10.2.31.2'}]}, {u'tenant_sub_ip': u'10.1.31.2/24', u'tenant_ns_ip': u'10.1.31.1/24', u'tenant_ns_if': u't4ns1if', u'tenant_sub_if': u't4s1if', u'tenant_ns_name': u't4'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t4ns1\" ip addr show \"t4s1if\" | awk 'FNR==3{ print $2 }' | grep -w '^10.1.31.2/24' ; if [ $? -ne 0 ] ; then ip netns exec \"t4ns1\" ip addr add \"10.1.31.2/24\" dev \"t4s1if\" ; fi\n\nip netns exec \"t4\" ip addr show \"t4ns1if\" | awk 'FNR==3{ print $2 }' | grep -w '^10.1.31.1/24' ; if [ $? -ne 0 ] ; then ip netns exec \"t4\" ip addr add \"10.1.31.1/24\" dev \"t4ns1if\" ; fi\n", "delta": "0:00:00.176549", "end": "2019-11-18 10:33:11.725379", "item": [{"bridge_name": "t4br1", "default_route_ip": "10.1.31.1", "dns": [{"brif": "t4s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t4s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t4ns1", "route": [{"if": "p1", "ip": "10.1.31.1/24", "ns_if": "t4if", "ns_name": "t4"}], "subnet_ip": "1.1.1.0/24", "vms": [{"brif": "t4br1if1", "disk": "10G", "mem": 2, "name": "t4_VM1", "vcpu": 4, "vmif": "t4VM1if1"}, {"brif": "t4br1if2", "disk": "10G", "mem": 4, "name": "t4_VM2", "vcpu": 2, "vmif": "t4VM2if1"}], "vxlan": [{"dev": "t4s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.31.2", "remote_ip": "10.2.31.2", "remote_route": "10.2.31.0/24", "subnet_route": "10.1.31.0/24", "tenant_route_ip": "192.168.4.2", "v_name": "vxlan_t4s1"}]}, {"tenant_ns_if": "t4ns1if", "tenant_ns_ip": "10.1.31.1/24", "tenant_ns_name": "t4", "tenant_sub_if": "t4s1if", "tenant_sub_ip": "10.1.31.2/24"}], "rc": 0, "start": "2019-11-18 10:33:11.548830", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.32.1/24', u'ns_name': u't4', u'ns_if': u't4if', u'if': u'p1'}], u'default_route_ip': u'10.1.32.1', u'bridge_name': u't4br2', u'dns': [{u'dnsif': u't4s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't4s2_dnsbrif'}], u'ns_name': u't4ns2', u'subnet_ip': u'2.2.2.0/24', u'vms': [{u'mem': 3, u'name': u't4_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't4br2if1', u'vmif': u't4VM3if1'}], u'vxlan': [{u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}, {u'tenant_sub_ip': u'10.1.32.2/24', u'tenant_ns_ip': u'10.1.32.1/24', u'tenant_ns_if': u't4ns2if', u'tenant_sub_if': u't4s2if', u'tenant_ns_name': u't4'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t4ns2\" ip addr show \"t4s2if\" | awk 'FNR==3{ print $2 }' | grep -w '^10.1.32.2/24' ; if [ $? -ne 0 ] ; then ip netns exec \"t4ns2\" ip addr add \"10.1.32.2/24\" dev \"t4s2if\" ; fi\n\nip netns exec \"t4\" ip addr show \"t4ns2if\" | awk 'FNR==3{ print $2 }' | grep -w '^10.1.32.1/24' ; if [ $? -ne 0 ] ; then ip netns exec \"t4\" ip addr add \"10.1.32.1/24\" dev \"t4ns2if\" ; fi\n", "delta": "0:00:00.156453", "end": "2019-11-18 10:33:12.109473", "item": [{"bridge_name": "t4br2", "default_route_ip": "10.1.32.1", "dns": [{"brif": "t4s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t4s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t4ns2", "route": [{"if": "p1", "ip": "10.1.32.1/24", "ns_if": "t4if", "ns_name": "t4"}], "subnet_ip": "2.2.2.0/24", "vms": [{"brif": "t4br2if1", "disk": "10G", "mem": 3, "name": "t4_VM3", "vcpu": 2, "vmif": "t4VM3if1"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, {"tenant_ns_if": "t4ns2if", "tenant_ns_ip": "10.1.32.1/24", "tenant_ns_name": "t4", "tenant_sub_if": "t4s2if", "tenant_sub_ip": "10.1.32.2/24"}], "rc": 0, "start": "2019-11-18 10:33:11.953020", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Add IP Route to Tenant] *******************************************************************************************************************************
changed: [localhost] => (item={u'default_route_ip': u'192.168.4.1', u'name': u't4', u'pns_ip': u'192.168.4.1/24', u'tenant_if': u't4if', u'tenant_ip': u'192.168.4.2/24', u'pns_if': u't4pns_if'}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t4\" ip route show default | grep -w '[d]efault via 192.168.4.1' ; if [ $? -ne 0 ] ; then ip netns exec \"t4\" ip route add default via \"192.168.4.1\" ; fi\n", "delta": "0:00:00.066680", "end": "2019-11-18 10:33:12.489518", "item": {"default_route_ip": "192.168.4.1", "name": "t4", "pns_if": "t4pns_if", "pns_ip": "192.168.4.1/24", "tenant_if": "t4if", "tenant_ip": "192.168.4.2/24"}, "rc": 0, "start": "2019-11-18 10:33:12.422838", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Add IP Route to Tenant Subnet] ************************************************************************************************************************
changed: [localhost] => (item={u'route': [{u'ip': u'10.1.31.1/24', u'ns_name': u't4', u'ns_if': u't4if', u'if': u'p1'}], u'default_route_ip': u'10.1.31.1', u'bridge_name': u't4br1', u'dns': [{u'dnsif': u't4s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't4s1_dnsbrif'}], u'ns_name': u't4ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.31.2/24', u'tenant_ns_ip': u'10.1.31.1/24', u'tenant_ns_if': u't4ns1if', u'tenant_ns_name': u't4', u'tenant_sub_if': u't4s1if'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't4_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't4br1if1', u'vmif': u't4VM1if1'}, {u'mem': 4, u'name': u't4_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't4br1if2', u'vmif': u't4VM2if1'}], u'vxlan': [{u'local_ip': u'10.1.31.2', u'tenant_route_ip': u'192.168.4.2', u'dsport': 4789, u'dev': u't4s1if', u'subnet_route': u'10.1.31.0/24', u'remote_route': u'10.2.31.0/24', u'v_name': u'vxlan_t4s1', u'id': 42, u'remote_ip': u'10.2.31.2'}]}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t4ns1\" ip route show default | grep -w '[d]efault via 10.1.31.1' ; if [ $? -ne 0 ] ; then ip netns exec \"t4ns1\" ip route add default via \"10.1.31.1\" ; fi\n", "delta": "0:00:00.085265", "end": "2019-11-18 10:33:12.881471", "item": {"bridge_name": "t4br1", "default_route_ip": "10.1.31.1", "dns": [{"brif": "t4s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t4s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t4ns1", "route": [{"if": "p1", "ip": "10.1.31.1/24", "ns_if": "t4if", "ns_name": "t4"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t4ns1if", "tenant_ns_ip": "10.1.31.1/24", "tenant_ns_name": "t4", "tenant_sub_if": "t4s1if", "tenant_sub_ip": "10.1.31.2/24"}], "vms": [{"brif": "t4br1if1", "disk": "10G", "mem": 2, "name": "t4_VM1", "vcpu": 4, "vmif": "t4VM1if1"}, {"brif": "t4br1if2", "disk": "10G", "mem": 4, "name": "t4_VM2", "vcpu": 2, "vmif": "t4VM2if1"}], "vxlan": [{"dev": "t4s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.31.2", "remote_ip": "10.2.31.2", "remote_route": "10.2.31.0/24", "subnet_route": "10.1.31.0/24", "tenant_route_ip": "192.168.4.2", "v_name": "vxlan_t4s1"}]}, "rc": 0, "start": "2019-11-18 10:33:12.796206", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}
changed: [localhost] => (item={u'route': [{u'ip': u'10.1.32.1/24', u'ns_name': u't4', u'ns_if': u't4if', u'if': u'p1'}], u'default_route_ip': u'10.1.32.1', u'bridge_name': u't4br2', u'dns': [{u'dnsif': u't4s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't4s2_dnsbrif'}], u'ns_name': u't4ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.32.2/24', u'tenant_ns_ip': u'10.1.32.1/24', u'tenant_ns_if': u't4ns2if', u'tenant_ns_name': u't4', u'tenant_sub_if': u't4s2if'}], u'subnet_ip': u'2.2.2.0/24', u'vms': [{u'mem': 3, u'name': u't4_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't4br2if1', u'vmif': u't4VM3if1'}], u'vxlan': [{u'local_ip': [], u'tenant_route_ip': [], u'dsport': [], u'dev': [], u'subnet_route': [], u'remote_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t4ns2\" ip route show default | grep -w '[d]efault via 10.1.32.1' ; if [ $? -ne 0 ] ; then ip netns exec \"t4ns2\" ip route add default via \"10.1.32.1\" ; fi\n", "delta": "0:00:00.084204", "end": "2019-11-18 10:33:13.165230", "item": {"bridge_name": "t4br2", "default_route_ip": "10.1.32.1", "dns": [{"brif": "t4s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t4s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t4ns2", "route": [{"if": "p1", "ip": "10.1.32.1/24", "ns_if": "t4if", "ns_name": "t4"}], "subnet_ip": "2.2.2.0/24", "tenant_ns": [{"tenant_ns_if": "t4ns2if", "tenant_ns_ip": "10.1.32.1/24", "tenant_ns_name": "t4", "tenant_sub_if": "t4s2if", "tenant_sub_ip": "10.1.32.2/24"}], "vms": [{"brif": "t4br2if1", "disk": "10G", "mem": 3, "name": "t4_VM3", "vcpu": 2, "vmif": "t4VM3if1"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, "rc": 0, "start": "2019-11-18 10:33:13.081026", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Create bridge inside namespace] ***********************************************************************************************************************
changed: [localhost] => (item={u'route': [{u'ip': u'10.1.31.1/24', u'ns_name': u't4', u'ns_if': u't4if', u'if': u'p1'}], u'default_route_ip': u'10.1.31.1', u'bridge_name': u't4br1', u'dns': [{u'dnsif': u't4s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't4s1_dnsbrif'}], u'ns_name': u't4ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.31.2/24', u'tenant_ns_ip': u'10.1.31.1/24', u'tenant_ns_if': u't4ns1if', u'tenant_ns_name': u't4', u'tenant_sub_if': u't4s1if'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't4_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't4br1if1', u'vmif': u't4VM1if1'}, {u'mem': 4, u'name': u't4_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't4br1if2', u'vmif': u't4VM2if1'}], u'vxlan': [{u'local_ip': u'10.1.31.2', u'tenant_route_ip': u'192.168.4.2', u'dsport': 4789, u'dev': u't4s1if', u'subnet_route': u'10.1.31.0/24', u'remote_route': u'10.2.31.0/24', u'v_name': u'vxlan_t4s1', u'id': 42, u'remote_ip': u'10.2.31.2'}]}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t4ns1\" brctl show | grep -w '^t4br1'; if [ $? -ne 0 ] ; then ip netns exec \"t4ns1\" brctl addbr \"t4br1\" ; fi\nip netns exec \"t4ns1\" ip link set dev \"t4br1\" up\n", "delta": "0:00:00.118059", "end": "2019-11-18 10:33:13.533321", "item": {"bridge_name": "t4br1", "default_route_ip": "10.1.31.1", "dns": [{"brif": "t4s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t4s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t4ns1", "route": [{"if": "p1", "ip": "10.1.31.1/24", "ns_if": "t4if", "ns_name": "t4"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t4ns1if", "tenant_ns_ip": "10.1.31.1/24", "tenant_ns_name": "t4", "tenant_sub_if": "t4s1if", "tenant_sub_ip": "10.1.31.2/24"}], "vms": [{"brif": "t4br1if1", "disk": "10G", "mem": 2, "name": "t4_VM1", "vcpu": 4, "vmif": "t4VM1if1"}, {"brif": "t4br1if2", "disk": "10G", "mem": 4, "name": "t4_VM2", "vcpu": 2, "vmif": "t4VM2if1"}], "vxlan": [{"dev": "t4s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.31.2", "remote_ip": "10.2.31.2", "remote_route": "10.2.31.0/24", "subnet_route": "10.1.31.0/24", "tenant_route_ip": "192.168.4.2", "v_name": "vxlan_t4s1"}]}, "rc": 0, "start": "2019-11-18 10:33:13.415262", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}
changed: [localhost] => (item={u'route': [{u'ip': u'10.1.32.1/24', u'ns_name': u't4', u'ns_if': u't4if', u'if': u'p1'}], u'default_route_ip': u'10.1.32.1', u'bridge_name': u't4br2', u'dns': [{u'dnsif': u't4s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't4s2_dnsbrif'}], u'ns_name': u't4ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.32.2/24', u'tenant_ns_ip': u'10.1.32.1/24', u'tenant_ns_if': u't4ns2if', u'tenant_ns_name': u't4', u'tenant_sub_if': u't4s2if'}], u'subnet_ip': u'2.2.2.0/24', u'vms': [{u'mem': 3, u'name': u't4_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't4br2if1', u'vmif': u't4VM3if1'}], u'vxlan': [{u'local_ip': [], u'tenant_route_ip': [], u'dsport': [], u'dev': [], u'subnet_route': [], u'remote_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t4ns2\" brctl show | grep -w '^t4br2'; if [ $? -ne 0 ] ; then ip netns exec \"t4ns2\" brctl addbr \"t4br2\" ; fi\nip netns exec \"t4ns2\" ip link set dev \"t4br2\" up\n", "delta": "0:00:00.129767", "end": "2019-11-18 10:33:13.849444", "item": {"bridge_name": "t4br2", "default_route_ip": "10.1.32.1", "dns": [{"brif": "t4s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t4s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t4ns2", "route": [{"if": "p1", "ip": "10.1.32.1/24", "ns_if": "t4if", "ns_name": "t4"}], "subnet_ip": "2.2.2.0/24", "tenant_ns": [{"tenant_ns_if": "t4ns2if", "tenant_ns_ip": "10.1.32.1/24", "tenant_ns_name": "t4", "tenant_sub_if": "t4s2if", "tenant_sub_ip": "10.1.32.2/24"}], "vms": [{"brif": "t4br2if1", "disk": "10G", "mem": 3, "name": "t4_VM3", "vcpu": 2, "vmif": "t4VM3if1"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, "rc": 0, "start": "2019-11-18 10:33:13.719677", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Create DNS VETH Pair] *********************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.31.1/24', u'ns_name': u't4', u'ns_if': u't4if', u'if': u'p1'}], u'default_route_ip': u'10.1.31.1', u'bridge_name': u't4br1', u'ns_name': u't4ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.31.2/24', u'tenant_ns_ip': u'10.1.31.1/24', u'tenant_ns_if': u't4ns1if', u'tenant_sub_if': u't4s1if', u'tenant_ns_name': u't4'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't4_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't4br1if1', u'vmif': u't4VM1if1'}, {u'mem': 4, u'name': u't4_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't4br1if2', u'vmif': u't4VM2if1'}], u'vxlan': [{u'local_ip': u'10.1.31.2', u'dsport': 4789, u'dev': u't4s1if', u'tenant_route_ip': u'192.168.4.2', u'remote_route': u'10.2.31.0/24', u'subnet_route': u'10.1.31.0/24', u'v_name': u'vxlan_t4s1', u'id': 42, u'remote_ip': u'10.2.31.2'}]}, {u'dnsif': u't4s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't4s1_dnsbrif'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t4ns1\" ip link show \"t4s1_dnsbrif\" ; if [ $? -ne 0 ] ; then ip netns exec \"t4ns1\" ip link add \"t4s1_dnsbrif\" type veth peer name \"t4s1_dnsif\" ; fi\nip netns exec \"t4ns1\" ip link set dev \"t4s1_dnsbrif\" up\nip netns exec \"t4ns1\" ip link set dev \"t4s1_dnsif\" up\n", "delta": "0:00:00.171519", "end": "2019-11-18 10:33:14.273299", "item": [{"bridge_name": "t4br1", "default_route_ip": "10.1.31.1", "ns_name": "t4ns1", "route": [{"if": "p1", "ip": "10.1.31.1/24", "ns_if": "t4if", "ns_name": "t4"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t4ns1if", "tenant_ns_ip": "10.1.31.1/24", "tenant_ns_name": "t4", "tenant_sub_if": "t4s1if", "tenant_sub_ip": "10.1.31.2/24"}], "vms": [{"brif": "t4br1if1", "disk": "10G", "mem": 2, "name": "t4_VM1", "vcpu": 4, "vmif": "t4VM1if1"}, {"brif": "t4br1if2", "disk": "10G", "mem": 4, "name": "t4_VM2", "vcpu": 2, "vmif": "t4VM2if1"}], "vxlan": [{"dev": "t4s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.31.2", "remote_ip": "10.2.31.2", "remote_route": "10.2.31.0/24", "subnet_route": "10.1.31.0/24", "tenant_route_ip": "192.168.4.2", "v_name": "vxlan_t4s1"}]}, {"brif": "t4s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t4s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "rc": 0, "start": "2019-11-18 10:33:14.101780", "stderr": "Device \"t4s1_dnsbrif\" does not exist.", "stderr_lines": ["Device \"t4s1_dnsbrif\" does not exist."], "stdout": "", "stdout_lines": []}
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.32.1/24', u'ns_name': u't4', u'ns_if': u't4if', u'if': u'p1'}], u'default_route_ip': u'10.1.32.1', u'bridge_name': u't4br2', u'ns_name': u't4ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.32.2/24', u'tenant_ns_ip': u'10.1.32.1/24', u'tenant_ns_if': u't4ns2if', u'tenant_sub_if': u't4s2if', u'tenant_ns_name': u't4'}], u'subnet_ip': u'2.2.2.0/24', u'vms': [{u'mem': 3, u'name': u't4_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't4br2if1', u'vmif': u't4VM3if1'}], u'vxlan': [{u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}, {u'dnsif': u't4s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't4s2_dnsbrif'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t4ns2\" ip link show \"t4s2_dnsbrif\" ; if [ $? -ne 0 ] ; then ip netns exec \"t4ns2\" ip link add \"t4s2_dnsbrif\" type veth peer name \"t4s2_dnsif\" ; fi\nip netns exec \"t4ns2\" ip link set dev \"t4s2_dnsbrif\" up\nip netns exec \"t4ns2\" ip link set dev \"t4s2_dnsif\" up\n", "delta": "0:00:00.154446", "end": "2019-11-18 10:33:14.617155", "item": [{"bridge_name": "t4br2", "default_route_ip": "10.1.32.1", "ns_name": "t4ns2", "route": [{"if": "p1", "ip": "10.1.32.1/24", "ns_if": "t4if", "ns_name": "t4"}], "subnet_ip": "2.2.2.0/24", "tenant_ns": [{"tenant_ns_if": "t4ns2if", "tenant_ns_ip": "10.1.32.1/24", "tenant_ns_name": "t4", "tenant_sub_if": "t4s2if", "tenant_sub_ip": "10.1.32.2/24"}], "vms": [{"brif": "t4br2if1", "disk": "10G", "mem": 3, "name": "t4_VM3", "vcpu": 2, "vmif": "t4VM3if1"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, {"brif": "t4s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t4s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "rc": 0, "start": "2019-11-18 10:33:14.462709", "stderr": "Device \"t4s2_dnsbrif\" does not exist.", "stderr_lines": ["Device \"t4s2_dnsbrif\" does not exist."], "stdout": "", "stdout_lines": []}

TASK [Attach DNS VETH Pair] *********************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.31.1/24', u'ns_name': u't4', u'ns_if': u't4if', u'if': u'p1'}], u'default_route_ip': u'10.1.31.1', u'bridge_name': u't4br1', u'ns_name': u't4ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.31.2/24', u'tenant_ns_ip': u'10.1.31.1/24', u'tenant_ns_if': u't4ns1if', u'tenant_sub_if': u't4s1if', u'tenant_ns_name': u't4'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't4_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't4br1if1', u'vmif': u't4VM1if1'}, {u'mem': 4, u'name': u't4_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't4br1if2', u'vmif': u't4VM2if1'}], u'vxlan': [{u'local_ip': u'10.1.31.2', u'dsport': 4789, u'dev': u't4s1if', u'tenant_route_ip': u'192.168.4.2', u'remote_route': u'10.2.31.0/24', u'subnet_route': u'10.1.31.0/24', u'v_name': u'vxlan_t4s1', u'id': 42, u'remote_ip': u'10.2.31.2'}]}, {u'dnsif': u't4s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't4s1_dnsbrif'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t4ns1\" brctl show \"t4br1\" | grep -w 't4s1_dnsbrif' ; if [ $? -ne 0 ] ; then ip netns exec \"t4ns1\" brctl addif \"t4br1\" \"t4s1_dnsbrif\" ; fi\n", "delta": "0:00:00.087205", "end": "2019-11-18 10:33:14.961116", "item": [{"bridge_name": "t4br1", "default_route_ip": "10.1.31.1", "ns_name": "t4ns1", "route": [{"if": "p1", "ip": "10.1.31.1/24", "ns_if": "t4if", "ns_name": "t4"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t4ns1if", "tenant_ns_ip": "10.1.31.1/24", "tenant_ns_name": "t4", "tenant_sub_if": "t4s1if", "tenant_sub_ip": "10.1.31.2/24"}], "vms": [{"brif": "t4br1if1", "disk": "10G", "mem": 2, "name": "t4_VM1", "vcpu": 4, "vmif": "t4VM1if1"}, {"brif": "t4br1if2", "disk": "10G", "mem": 4, "name": "t4_VM2", "vcpu": 2, "vmif": "t4VM2if1"}], "vxlan": [{"dev": "t4s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.31.2", "remote_ip": "10.2.31.2", "remote_route": "10.2.31.0/24", "subnet_route": "10.1.31.0/24", "tenant_route_ip": "192.168.4.2", "v_name": "vxlan_t4s1"}]}, {"brif": "t4s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t4s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "rc": 0, "start": "2019-11-18 10:33:14.873911", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.32.1/24', u'ns_name': u't4', u'ns_if': u't4if', u'if': u'p1'}], u'default_route_ip': u'10.1.32.1', u'bridge_name': u't4br2', u'ns_name': u't4ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.32.2/24', u'tenant_ns_ip': u'10.1.32.1/24', u'tenant_ns_if': u't4ns2if', u'tenant_sub_if': u't4s2if', u'tenant_ns_name': u't4'}], u'subnet_ip': u'2.2.2.0/24', u'vms': [{u'mem': 3, u'name': u't4_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't4br2if1', u'vmif': u't4VM3if1'}], u'vxlan': [{u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}, {u'dnsif': u't4s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't4s2_dnsbrif'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t4ns2\" brctl show \"t4br2\" | grep -w 't4s2_dnsbrif' ; if [ $? -ne 0 ] ; then ip netns exec \"t4ns2\" brctl addif \"t4br2\" \"t4s2_dnsbrif\" ; fi\n", "delta": "0:00:00.092434", "end": "2019-11-18 10:33:15.273298", "item": [{"bridge_name": "t4br2", "default_route_ip": "10.1.32.1", "ns_name": "t4ns2", "route": [{"if": "p1", "ip": "10.1.32.1/24", "ns_if": "t4if", "ns_name": "t4"}], "subnet_ip": "2.2.2.0/24", "tenant_ns": [{"tenant_ns_if": "t4ns2if", "tenant_ns_ip": "10.1.32.1/24", "tenant_ns_name": "t4", "tenant_sub_if": "t4s2if", "tenant_sub_ip": "10.1.32.2/24"}], "vms": [{"brif": "t4br2if1", "disk": "10G", "mem": 3, "name": "t4_VM3", "vcpu": 2, "vmif": "t4VM3if1"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, {"brif": "t4s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t4s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "rc": 0, "start": "2019-11-18 10:33:15.180864", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Create VETH Pairs] ************************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.31.1/24', u'ns_name': u't4', u'ns_if': u't4if', u'if': u'p1'}], u'default_route_ip': u'10.1.31.1', u'bridge_name': u't4br1', u'dns': [{u'dnsif': u't4s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't4s1_dnsbrif'}], u'ns_name': u't4ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.31.2/24', u'tenant_ns_ip': u'10.1.31.1/24', u'tenant_ns_if': u't4ns1if', u'tenant_sub_if': u't4s1if', u'tenant_ns_name': u't4'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.1.31.2', u'dsport': 4789, u'dev': u't4s1if', u'tenant_route_ip': u'192.168.4.2', u'remote_route': u'10.2.31.0/24', u'subnet_route': u'10.1.31.0/24', u'v_name': u'vxlan_t4s1', u'id': 42, u'remote_ip': u'10.2.31.2'}]}, {u'mem': 2, u'name': u't4_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't4br1if1', u'vmif': u't4VM1if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip link show \"t4br1if1\" ; if [ $? -ne 0 ] ; then ip link add \"t4VM1if1\" type veth peer name \"t4br1if1\" ; fi\nip link set dev \"t4br1if1\" up\nip link set dev \"t4VM1if1\" up\n", "delta": "0:00:00.018960", "end": "2019-11-18 10:33:15.584066", "item": [{"bridge_name": "t4br1", "default_route_ip": "10.1.31.1", "dns": [{"brif": "t4s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t4s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t4ns1", "route": [{"if": "p1", "ip": "10.1.31.1/24", "ns_if": "t4if", "ns_name": "t4"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t4ns1if", "tenant_ns_ip": "10.1.31.1/24", "tenant_ns_name": "t4", "tenant_sub_if": "t4s1if", "tenant_sub_ip": "10.1.31.2/24"}], "vxlan": [{"dev": "t4s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.31.2", "remote_ip": "10.2.31.2", "remote_route": "10.2.31.0/24", "subnet_route": "10.1.31.0/24", "tenant_route_ip": "192.168.4.2", "v_name": "vxlan_t4s1"}]}, {"brif": "t4br1if1", "disk": "10G", "mem": 2, "name": "t4_VM1", "vcpu": 4, "vmif": "t4VM1if1"}], "rc": 0, "start": "2019-11-18 10:33:15.565106", "stderr": "Device \"t4br1if1\" does not exist.", "stderr_lines": ["Device \"t4br1if1\" does not exist."], "stdout": "", "stdout_lines": []}
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.31.1/24', u'ns_name': u't4', u'ns_if': u't4if', u'if': u'p1'}], u'default_route_ip': u'10.1.31.1', u'bridge_name': u't4br1', u'dns': [{u'dnsif': u't4s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't4s1_dnsbrif'}], u'ns_name': u't4ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.31.2/24', u'tenant_ns_ip': u'10.1.31.1/24', u'tenant_ns_if': u't4ns1if', u'tenant_sub_if': u't4s1if', u'tenant_ns_name': u't4'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.1.31.2', u'dsport': 4789, u'dev': u't4s1if', u'tenant_route_ip': u'192.168.4.2', u'remote_route': u'10.2.31.0/24', u'subnet_route': u'10.1.31.0/24', u'v_name': u'vxlan_t4s1', u'id': 42, u'remote_ip': u'10.2.31.2'}]}, {u'mem': 4, u'name': u't4_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't4br1if2', u'vmif': u't4VM2if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip link show \"t4br1if2\" ; if [ $? -ne 0 ] ; then ip link add \"t4VM2if1\" type veth peer name \"t4br1if2\" ; fi\nip link set dev \"t4br1if2\" up\nip link set dev \"t4VM2if1\" up\n", "delta": "0:00:00.018229", "end": "2019-11-18 10:33:15.835372", "item": [{"bridge_name": "t4br1", "default_route_ip": "10.1.31.1", "dns": [{"brif": "t4s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t4s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t4ns1", "route": [{"if": "p1", "ip": "10.1.31.1/24", "ns_if": "t4if", "ns_name": "t4"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t4ns1if", "tenant_ns_ip": "10.1.31.1/24", "tenant_ns_name": "t4", "tenant_sub_if": "t4s1if", "tenant_sub_ip": "10.1.31.2/24"}], "vxlan": [{"dev": "t4s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.31.2", "remote_ip": "10.2.31.2", "remote_route": "10.2.31.0/24", "subnet_route": "10.1.31.0/24", "tenant_route_ip": "192.168.4.2", "v_name": "vxlan_t4s1"}]}, {"brif": "t4br1if2", "disk": "10G", "mem": 4, "name": "t4_VM2", "vcpu": 2, "vmif": "t4VM2if1"}], "rc": 0, "start": "2019-11-18 10:33:15.817143", "stderr": "Device \"t4br1if2\" does not exist.", "stderr_lines": ["Device \"t4br1if2\" does not exist."], "stdout": "", "stdout_lines": []}
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.32.1/24', u'ns_name': u't4', u'ns_if': u't4if', u'if': u'p1'}], u'default_route_ip': u'10.1.32.1', u'bridge_name': u't4br2', u'dns': [{u'dnsif': u't4s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't4s2_dnsbrif'}], u'ns_name': u't4ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.32.2/24', u'tenant_ns_ip': u'10.1.32.1/24', u'tenant_ns_if': u't4ns2if', u'tenant_sub_if': u't4s2if', u'tenant_ns_name': u't4'}], u'subnet_ip': u'2.2.2.0/24', u'vxlan': [{u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}, {u'mem': 3, u'name': u't4_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't4br2if1', u'vmif': u't4VM3if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip link show \"t4br2if1\" ; if [ $? -ne 0 ] ; then ip link add \"t4VM3if1\" type veth peer name \"t4br2if1\" ; fi\nip link set dev \"t4br2if1\" up\nip link set dev \"t4VM3if1\" up\n", "delta": "0:00:00.018228", "end": "2019-11-18 10:33:16.080060", "item": [{"bridge_name": "t4br2", "default_route_ip": "10.1.32.1", "dns": [{"brif": "t4s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t4s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t4ns2", "route": [{"if": "p1", "ip": "10.1.32.1/24", "ns_if": "t4if", "ns_name": "t4"}], "subnet_ip": "2.2.2.0/24", "tenant_ns": [{"tenant_ns_if": "t4ns2if", "tenant_ns_ip": "10.1.32.1/24", "tenant_ns_name": "t4", "tenant_sub_if": "t4s2if", "tenant_sub_ip": "10.1.32.2/24"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, {"brif": "t4br2if1", "disk": "10G", "mem": 3, "name": "t4_VM3", "vcpu": 2, "vmif": "t4VM3if1"}], "rc": 0, "start": "2019-11-18 10:33:16.061832", "stderr": "Device \"t4br2if1\" does not exist.", "stderr_lines": ["Device \"t4br2if1\" does not exist."], "stdout": "", "stdout_lines": []}

TASK [Attach VETH Pairs] ************************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.31.1/24', u'ns_name': u't4', u'ns_if': u't4if', u'if': u'p1'}], u'default_route_ip': u'10.1.31.1', u'bridge_name': u't4br1', u'dns': [{u'dnsif': u't4s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't4s1_dnsbrif'}], u'ns_name': u't4ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.31.2/24', u'tenant_ns_ip': u'10.1.31.1/24', u'tenant_ns_if': u't4ns1if', u'tenant_sub_if': u't4s1if', u'tenant_ns_name': u't4'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.1.31.2', u'dsport': 4789, u'dev': u't4s1if', u'tenant_route_ip': u'192.168.4.2', u'remote_route': u'10.2.31.0/24', u'subnet_route': u'10.1.31.0/24', u'v_name': u'vxlan_t4s1', u'id': 42, u'remote_ip': u'10.2.31.2'}]}, {u'mem': 2, u'name': u't4_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't4br1if1', u'vmif': u't4VM1if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip link show \"t4br1if1\" ; if [ $? -eq 0 ] ; then ip link set \"t4br1if1\" netns \"t4ns1\" ; fi\nip netns exec \"t4ns1\" brctl show \"t4br1\" | grep -w 't4br1if1' ; if [ $? -ne 0 ] ; then ip netns exec \"t4ns1\" brctl addif \"t4br1\" \"t4br1if1\" ; fi\n", "delta": "0:00:00.109603", "end": "2019-11-18 10:33:16.469229", "item": [{"bridge_name": "t4br1", "default_route_ip": "10.1.31.1", "dns": [{"brif": "t4s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t4s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t4ns1", "route": [{"if": "p1", "ip": "10.1.31.1/24", "ns_if": "t4if", "ns_name": "t4"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t4ns1if", "tenant_ns_ip": "10.1.31.1/24", "tenant_ns_name": "t4", "tenant_sub_if": "t4s1if", "tenant_sub_ip": "10.1.31.2/24"}], "vxlan": [{"dev": "t4s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.31.2", "remote_ip": "10.2.31.2", "remote_route": "10.2.31.0/24", "subnet_route": "10.1.31.0/24", "tenant_route_ip": "192.168.4.2", "v_name": "vxlan_t4s1"}]}, {"brif": "t4br1if1", "disk": "10G", "mem": 2, "name": "t4_VM1", "vcpu": 4, "vmif": "t4VM1if1"}], "rc": 0, "start": "2019-11-18 10:33:16.359626", "stderr": "", "stderr_lines": [], "stdout": "81: t4br1if1@t4VM1if1: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP mode DEFAULT group default qlen 1000\n    link/ether 06:be:4a:7b:3c:cb brd ff:ff:ff:ff:ff:ff", "stdout_lines": ["81: t4br1if1@t4VM1if1: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP mode DEFAULT group default qlen 1000", "    link/ether 06:be:4a:7b:3c:cb brd ff:ff:ff:ff:ff:ff"]}
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.31.1/24', u'ns_name': u't4', u'ns_if': u't4if', u'if': u'p1'}], u'default_route_ip': u'10.1.31.1', u'bridge_name': u't4br1', u'dns': [{u'dnsif': u't4s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't4s1_dnsbrif'}], u'ns_name': u't4ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.31.2/24', u'tenant_ns_ip': u'10.1.31.1/24', u'tenant_ns_if': u't4ns1if', u'tenant_sub_if': u't4s1if', u'tenant_ns_name': u't4'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.1.31.2', u'dsport': 4789, u'dev': u't4s1if', u'tenant_route_ip': u'192.168.4.2', u'remote_route': u'10.2.31.0/24', u'subnet_route': u'10.1.31.0/24', u'v_name': u'vxlan_t4s1', u'id': 42, u'remote_ip': u'10.2.31.2'}]}, {u'mem': 4, u'name': u't4_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't4br1if2', u'vmif': u't4VM2if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip link show \"t4br1if2\" ; if [ $? -eq 0 ] ; then ip link set \"t4br1if2\" netns \"t4ns1\" ; fi\nip netns exec \"t4ns1\" brctl show \"t4br1\" | grep -w 't4br1if2' ; if [ $? -ne 0 ] ; then ip netns exec \"t4ns1\" brctl addif \"t4br1\" \"t4br1if2\" ; fi\n", "delta": "0:00:00.114826", "end": "2019-11-18 10:33:16.797219", "item": [{"bridge_name": "t4br1", "default_route_ip": "10.1.31.1", "dns": [{"brif": "t4s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t4s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t4ns1", "route": [{"if": "p1", "ip": "10.1.31.1/24", "ns_if": "t4if", "ns_name": "t4"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t4ns1if", "tenant_ns_ip": "10.1.31.1/24", "tenant_ns_name": "t4", "tenant_sub_if": "t4s1if", "tenant_sub_ip": "10.1.31.2/24"}], "vxlan": [{"dev": "t4s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.31.2", "remote_ip": "10.2.31.2", "remote_route": "10.2.31.0/24", "subnet_route": "10.1.31.0/24", "tenant_route_ip": "192.168.4.2", "v_name": "vxlan_t4s1"}]}, {"brif": "t4br1if2", "disk": "10G", "mem": 4, "name": "t4_VM2", "vcpu": 2, "vmif": "t4VM2if1"}], "rc": 0, "start": "2019-11-18 10:33:16.682393", "stderr": "", "stderr_lines": [], "stdout": "83: t4br1if2@t4VM2if1: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP mode DEFAULT group default qlen 1000\n    link/ether da:6b:3c:cc:93:9c brd ff:ff:ff:ff:ff:ff", "stdout_lines": ["83: t4br1if2@t4VM2if1: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP mode DEFAULT group default qlen 1000", "    link/ether da:6b:3c:cc:93:9c brd ff:ff:ff:ff:ff:ff"]}
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.32.1/24', u'ns_name': u't4', u'ns_if': u't4if', u'if': u'p1'}], u'default_route_ip': u'10.1.32.1', u'bridge_name': u't4br2', u'dns': [{u'dnsif': u't4s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't4s2_dnsbrif'}], u'ns_name': u't4ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.32.2/24', u'tenant_ns_ip': u'10.1.32.1/24', u'tenant_ns_if': u't4ns2if', u'tenant_sub_if': u't4s2if', u'tenant_ns_name': u't4'}], u'subnet_ip': u'2.2.2.0/24', u'vxlan': [{u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}, {u'mem': 3, u'name': u't4_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't4br2if1', u'vmif': u't4VM3if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip link show \"t4br2if1\" ; if [ $? -eq 0 ] ; then ip link set \"t4br2if1\" netns \"t4ns2\" ; fi\nip netns exec \"t4ns2\" brctl show \"t4br2\" | grep -w 't4br2if1' ; if [ $? -ne 0 ] ; then ip netns exec \"t4ns2\" brctl addif \"t4br2\" \"t4br2if1\" ; fi\n", "delta": "0:00:00.104155", "end": "2019-11-18 10:33:17.093346", "item": [{"bridge_name": "t4br2", "default_route_ip": "10.1.32.1", "dns": [{"brif": "t4s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t4s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t4ns2", "route": [{"if": "p1", "ip": "10.1.32.1/24", "ns_if": "t4if", "ns_name": "t4"}], "subnet_ip": "2.2.2.0/24", "tenant_ns": [{"tenant_ns_if": "t4ns2if", "tenant_ns_ip": "10.1.32.1/24", "tenant_ns_name": "t4", "tenant_sub_if": "t4s2if", "tenant_sub_ip": "10.1.32.2/24"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, {"brif": "t4br2if1", "disk": "10G", "mem": 3, "name": "t4_VM3", "vcpu": 2, "vmif": "t4VM3if1"}], "rc": 0, "start": "2019-11-18 10:33:16.989191", "stderr": "", "stderr_lines": [], "stdout": "85: t4br2if1@t4VM3if1: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP mode DEFAULT group default qlen 1000\n    link/ether b2:01:af:f1:f2:39 brd ff:ff:ff:ff:ff:ff", "stdout_lines": ["85: t4br2if1@t4VM3if1: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP mode DEFAULT group default qlen 1000", "    link/ether b2:01:af:f1:f2:39 brd ff:ff:ff:ff:ff:ff"]}

TASK [All interfaces and bridges UP] ************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.31.1/24', u'ns_name': u't4', u'ns_if': u't4if', u'if': u'p1'}], u'default_route_ip': u'10.1.31.1', u'bridge_name': u't4br1', u'dns': [{u'dnsif': u't4s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't4s1_dnsbrif'}], u'ns_name': u't4ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.31.2/24', u'tenant_ns_ip': u'10.1.31.1/24', u'tenant_ns_if': u't4ns1if', u'tenant_sub_if': u't4s1if', u'tenant_ns_name': u't4'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.1.31.2', u'dsport': 4789, u'dev': u't4s1if', u'tenant_route_ip': u'192.168.4.2', u'remote_route': u'10.2.31.0/24', u'subnet_route': u'10.1.31.0/24', u'v_name': u'vxlan_t4s1', u'id': 42, u'remote_ip': u'10.2.31.2'}]}, {u'mem': 2, u'name': u't4_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't4br1if1', u'vmif': u't4VM1if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t4ns1\" ip link set \"t4br1if1\" up\nip netns exec \"t4ns1\" ip link set dev \"t4br1\" up\n", "delta": "0:00:00.073308", "end": "2019-11-18 10:33:17.453361", "item": [{"bridge_name": "t4br1", "default_route_ip": "10.1.31.1", "dns": [{"brif": "t4s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t4s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t4ns1", "route": [{"if": "p1", "ip": "10.1.31.1/24", "ns_if": "t4if", "ns_name": "t4"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t4ns1if", "tenant_ns_ip": "10.1.31.1/24", "tenant_ns_name": "t4", "tenant_sub_if": "t4s1if", "tenant_sub_ip": "10.1.31.2/24"}], "vxlan": [{"dev": "t4s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.31.2", "remote_ip": "10.2.31.2", "remote_route": "10.2.31.0/24", "subnet_route": "10.1.31.0/24", "tenant_route_ip": "192.168.4.2", "v_name": "vxlan_t4s1"}]}, {"brif": "t4br1if1", "disk": "10G", "mem": 2, "name": "t4_VM1", "vcpu": 4, "vmif": "t4VM1if1"}], "rc": 0, "start": "2019-11-18 10:33:17.380053", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.31.1/24', u'ns_name': u't4', u'ns_if': u't4if', u'if': u'p1'}], u'default_route_ip': u'10.1.31.1', u'bridge_name': u't4br1', u'dns': [{u'dnsif': u't4s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't4s1_dnsbrif'}], u'ns_name': u't4ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.31.2/24', u'tenant_ns_ip': u'10.1.31.1/24', u'tenant_ns_if': u't4ns1if', u'tenant_sub_if': u't4s1if', u'tenant_ns_name': u't4'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.1.31.2', u'dsport': 4789, u'dev': u't4s1if', u'tenant_route_ip': u'192.168.4.2', u'remote_route': u'10.2.31.0/24', u'subnet_route': u'10.1.31.0/24', u'v_name': u'vxlan_t4s1', u'id': 42, u'remote_ip': u'10.2.31.2'}]}, {u'mem': 4, u'name': u't4_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't4br1if2', u'vmif': u't4VM2if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t4ns1\" ip link set \"t4br1if2\" up\nip netns exec \"t4ns1\" ip link set dev \"t4br1\" up\n", "delta": "0:00:00.076723", "end": "2019-11-18 10:33:17.765394", "item": [{"bridge_name": "t4br1", "default_route_ip": "10.1.31.1", "dns": [{"brif": "t4s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t4s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t4ns1", "route": [{"if": "p1", "ip": "10.1.31.1/24", "ns_if": "t4if", "ns_name": "t4"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t4ns1if", "tenant_ns_ip": "10.1.31.1/24", "tenant_ns_name": "t4", "tenant_sub_if": "t4s1if", "tenant_sub_ip": "10.1.31.2/24"}], "vxlan": [{"dev": "t4s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.31.2", "remote_ip": "10.2.31.2", "remote_route": "10.2.31.0/24", "subnet_route": "10.1.31.0/24", "tenant_route_ip": "192.168.4.2", "v_name": "vxlan_t4s1"}]}, {"brif": "t4br1if2", "disk": "10G", "mem": 4, "name": "t4_VM2", "vcpu": 2, "vmif": "t4VM2if1"}], "rc": 0, "start": "2019-11-18 10:33:17.688671", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.32.1/24', u'ns_name': u't4', u'ns_if': u't4if', u'if': u'p1'}], u'default_route_ip': u'10.1.32.1', u'bridge_name': u't4br2', u'dns': [{u'dnsif': u't4s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't4s2_dnsbrif'}], u'ns_name': u't4ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.32.2/24', u'tenant_ns_ip': u'10.1.32.1/24', u'tenant_ns_if': u't4ns2if', u'tenant_sub_if': u't4s2if', u'tenant_ns_name': u't4'}], u'subnet_ip': u'2.2.2.0/24', u'vxlan': [{u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}, {u'mem': 3, u'name': u't4_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't4br2if1', u'vmif': u't4VM3if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t4ns2\" ip link set \"t4br2if1\" up\nip netns exec \"t4ns2\" ip link set dev \"t4br2\" up\n", "delta": "0:00:00.082513", "end": "2019-11-18 10:33:18.094495", "item": [{"bridge_name": "t4br2", "default_route_ip": "10.1.32.1", "dns": [{"brif": "t4s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t4s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t4ns2", "route": [{"if": "p1", "ip": "10.1.32.1/24", "ns_if": "t4if", "ns_name": "t4"}], "subnet_ip": "2.2.2.0/24", "tenant_ns": [{"tenant_ns_if": "t4ns2if", "tenant_ns_ip": "10.1.32.1/24", "tenant_ns_name": "t4", "tenant_sub_if": "t4s2if", "tenant_sub_ip": "10.1.32.2/24"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, {"brif": "t4br2if1", "disk": "10G", "mem": 3, "name": "t4_VM3", "vcpu": 2, "vmif": "t4VM3if1"}], "rc": 0, "start": "2019-11-18 10:33:18.011982", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Add IP to DNS Interface] ******************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.31.1/24', u'ns_name': u't4', u'ns_if': u't4if', u'if': u'p1'}], u'default_route_ip': u'10.1.31.1', u'bridge_name': u't4br1', u'ns_name': u't4ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.31.2/24', u'tenant_ns_ip': u'10.1.31.1/24', u'tenant_ns_if': u't4ns1if', u'tenant_sub_if': u't4s1if', u'tenant_ns_name': u't4'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't4_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't4br1if1', u'vmif': u't4VM1if1'}, {u'mem': 4, u'name': u't4_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't4br1if2', u'vmif': u't4VM2if1'}], u'vxlan': [{u'local_ip': u'10.1.31.2', u'dsport': 4789, u'dev': u't4s1if', u'tenant_route_ip': u'192.168.4.2', u'remote_route': u'10.2.31.0/24', u'subnet_route': u'10.1.31.0/24', u'v_name': u'vxlan_t4s1', u'id': 42, u'remote_ip': u'10.2.31.2'}]}, {u'dnsif': u't4s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't4s1_dnsbrif'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t4ns1\" ip addr show \"t4s1_dnsif\" | awk 'FNR==3{ print $2 }' | grep -w '^1.1.1.1/24' ; if [ $? -ne 0 ] ; then ip netns exec \"t4ns1\" ip addr add \"1.1.1.1/24\" dev \"t4s1_dnsif\" ; fi\n", "delta": "0:00:00.079164", "end": "2019-11-18 10:33:18.485997", "item": [{"bridge_name": "t4br1", "default_route_ip": "10.1.31.1", "ns_name": "t4ns1", "route": [{"if": "p1", "ip": "10.1.31.1/24", "ns_if": "t4if", "ns_name": "t4"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t4ns1if", "tenant_ns_ip": "10.1.31.1/24", "tenant_ns_name": "t4", "tenant_sub_if": "t4s1if", "tenant_sub_ip": "10.1.31.2/24"}], "vms": [{"brif": "t4br1if1", "disk": "10G", "mem": 2, "name": "t4_VM1", "vcpu": 4, "vmif": "t4VM1if1"}, {"brif": "t4br1if2", "disk": "10G", "mem": 4, "name": "t4_VM2", "vcpu": 2, "vmif": "t4VM2if1"}], "vxlan": [{"dev": "t4s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.31.2", "remote_ip": "10.2.31.2", "remote_route": "10.2.31.0/24", "subnet_route": "10.1.31.0/24", "tenant_route_ip": "192.168.4.2", "v_name": "vxlan_t4s1"}]}, {"brif": "t4s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t4s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "rc": 0, "start": "2019-11-18 10:33:18.406833", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.32.1/24', u'ns_name': u't4', u'ns_if': u't4if', u'if': u'p1'}], u'default_route_ip': u'10.1.32.1', u'bridge_name': u't4br2', u'ns_name': u't4ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.32.2/24', u'tenant_ns_ip': u'10.1.32.1/24', u'tenant_ns_if': u't4ns2if', u'tenant_sub_if': u't4s2if', u'tenant_ns_name': u't4'}], u'subnet_ip': u'2.2.2.0/24', u'vms': [{u'mem': 3, u'name': u't4_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't4br2if1', u'vmif': u't4VM3if1'}], u'vxlan': [{u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}, {u'dnsif': u't4s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't4s2_dnsbrif'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t4ns2\" ip addr show \"t4s2_dnsif\" | awk 'FNR==3{ print $2 }' | grep -w '^2.2.2.1/24' ; if [ $? -ne 0 ] ; then ip netns exec \"t4ns2\" ip addr add \"2.2.2.1/24\" dev \"t4s2_dnsif\" ; fi\n", "delta": "0:00:00.088812", "end": "2019-11-18 10:33:18.801546", "item": [{"bridge_name": "t4br2", "default_route_ip": "10.1.32.1", "ns_name": "t4ns2", "route": [{"if": "p1", "ip": "10.1.32.1/24", "ns_if": "t4if", "ns_name": "t4"}], "subnet_ip": "2.2.2.0/24", "tenant_ns": [{"tenant_ns_if": "t4ns2if", "tenant_ns_ip": "10.1.32.1/24", "tenant_ns_name": "t4", "tenant_sub_if": "t4s2if", "tenant_sub_ip": "10.1.32.2/24"}], "vms": [{"brif": "t4br2if1", "disk": "10G", "mem": 3, "name": "t4_VM3", "vcpu": 2, "vmif": "t4VM3if1"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, {"brif": "t4s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t4s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "rc": 0, "start": "2019-11-18 10:33:18.712734", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Install DHCP Server] **********************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.31.1/24', u'ns_name': u't4', u'ns_if': u't4if', u'if': u'p1'}], u'default_route_ip': u'10.1.31.1', u'bridge_name': u't4br1', u'ns_name': u't4ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.31.2/24', u'tenant_ns_ip': u'10.1.31.1/24', u'tenant_ns_if': u't4ns1if', u'tenant_sub_if': u't4s1if', u'tenant_ns_name': u't4'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't4_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't4br1if1', u'vmif': u't4VM1if1'}, {u'mem': 4, u'name': u't4_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't4br1if2', u'vmif': u't4VM2if1'}], u'vxlan': [{u'local_ip': u'10.1.31.2', u'dsport': 4789, u'dev': u't4s1if', u'tenant_route_ip': u'192.168.4.2', u'remote_route': u'10.2.31.0/24', u'subnet_route': u'10.1.31.0/24', u'v_name': u'vxlan_t4s1', u'id': 42, u'remote_ip': u'10.2.31.2'}]}, {u'dnsif': u't4s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't4s1_dnsbrif'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t4ns1\" ps aux | grep -w '[d]nsmasq --interface t4s1_dnsif -z --dhcp-range=1.1.1.5,1.1.1.126' ; if [ $? -ne 0 ] ; then ip netns exec \"t4ns1\" dnsmasq --interface \"t4s1_dnsif\" -z --dhcp-range=1.1.1.5,'1.1.1.126' ; fi\n", "delta": "0:00:00.121381", "end": "2019-11-18 10:33:19.208909", "item": [{"bridge_name": "t4br1", "default_route_ip": "10.1.31.1", "ns_name": "t4ns1", "route": [{"if": "p1", "ip": "10.1.31.1/24", "ns_if": "t4if", "ns_name": "t4"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t4ns1if", "tenant_ns_ip": "10.1.31.1/24", "tenant_ns_name": "t4", "tenant_sub_if": "t4s1if", "tenant_sub_ip": "10.1.31.2/24"}], "vms": [{"brif": "t4br1if1", "disk": "10G", "mem": 2, "name": "t4_VM1", "vcpu": 4, "vmif": "t4VM1if1"}, {"brif": "t4br1if2", "disk": "10G", "mem": 4, "name": "t4_VM2", "vcpu": 2, "vmif": "t4VM2if1"}], "vxlan": [{"dev": "t4s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.31.2", "remote_ip": "10.2.31.2", "remote_route": "10.2.31.0/24", "subnet_route": "10.1.31.0/24", "tenant_route_ip": "192.168.4.2", "v_name": "vxlan_t4s1"}]}, {"brif": "t4s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t4s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "rc": 0, "start": "2019-11-18 10:33:19.087528", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.32.1/24', u'ns_name': u't4', u'ns_if': u't4if', u'if': u'p1'}], u'default_route_ip': u'10.1.32.1', u'bridge_name': u't4br2', u'ns_name': u't4ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.32.2/24', u'tenant_ns_ip': u'10.1.32.1/24', u'tenant_ns_if': u't4ns2if', u'tenant_sub_if': u't4s2if', u'tenant_ns_name': u't4'}], u'subnet_ip': u'2.2.2.0/24', u'vms': [{u'mem': 3, u'name': u't4_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't4br2if1', u'vmif': u't4VM3if1'}], u'vxlan': [{u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}, {u'dnsif': u't4s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't4s2_dnsbrif'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t4ns2\" ps aux | grep -w '[d]nsmasq --interface t4s2_dnsif -z --dhcp-range=2.2.2.5,2.2.2.254' ; if [ $? -ne 0 ] ; then ip netns exec \"t4ns2\" dnsmasq --interface \"t4s2_dnsif\" -z --dhcp-range=2.2.2.5,'2.2.2.254' ; fi\n", "delta": "0:00:00.081073", "end": "2019-11-18 10:33:19.501654", "item": [{"bridge_name": "t4br2", "default_route_ip": "10.1.32.1", "ns_name": "t4ns2", "route": [{"if": "p1", "ip": "10.1.32.1/24", "ns_if": "t4if", "ns_name": "t4"}], "subnet_ip": "2.2.2.0/24", "tenant_ns": [{"tenant_ns_if": "t4ns2if", "tenant_ns_ip": "10.1.32.1/24", "tenant_ns_name": "t4", "tenant_sub_if": "t4s2if", "tenant_sub_ip": "10.1.32.2/24"}], "vms": [{"brif": "t4br2if1", "disk": "10G", "mem": 3, "name": "t4_VM3", "vcpu": 2, "vmif": "t4VM3if1"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, {"brif": "t4s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t4s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "rc": 0, "start": "2019-11-18 10:33:19.420581", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Create VXLAN devices] *********************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.31.1/24', u'ns_name': u't4', u'ns_if': u't4if', u'if': u'p1'}], u'default_route_ip': u'10.1.31.1', u'bridge_name': u't4br1', u'dns': [{u'dnsif': u't4s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't4s1_dnsbrif'}], u'ns_name': u't4ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.31.2/24', u'tenant_ns_ip': u'10.1.31.1/24', u'tenant_ns_if': u't4ns1if', u'tenant_sub_if': u't4s1if', u'tenant_ns_name': u't4'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't4_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't4br1if1', u'vmif': u't4VM1if1'}, {u'mem': 4, u'name': u't4_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't4br1if2', u'vmif': u't4VM2if1'}]}, {u'local_ip': u'10.1.31.2', u'dsport': 4789, u'dev': u't4s1if', u'tenant_route_ip': u'192.168.4.2', u'remote_route': u'10.2.31.0/24', u'subnet_route': u'10.1.31.0/24', u'v_name': u'vxlan_t4s1', u'id': 42, u'remote_ip': u'10.2.31.2'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t4ns1\" ip link show \"vxlan_t4s1\" ; if [ $? -ne 0 ] ; then ip netns exec \"t4ns1\" ip link add \"vxlan_t4s1\" type vxlan id \"42\" local \"10.1.31.2\" remote \"10.2.31.2\" dstport \"4789\" dev \"t4s1if\"; ip netns exec \"t4ns1\" ip link set dev \"vxlan_t4s1\" up ; fi\n", "delta": "0:00:00.126963", "end": "2019-11-18 10:33:19.913092", "item": [{"bridge_name": "t4br1", "default_route_ip": "10.1.31.1", "dns": [{"brif": "t4s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t4s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t4ns1", "route": [{"if": "p1", "ip": "10.1.31.1/24", "ns_if": "t4if", "ns_name": "t4"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t4ns1if", "tenant_ns_ip": "10.1.31.1/24", "tenant_ns_name": "t4", "tenant_sub_if": "t4s1if", "tenant_sub_ip": "10.1.31.2/24"}], "vms": [{"brif": "t4br1if1", "disk": "10G", "mem": 2, "name": "t4_VM1", "vcpu": 4, "vmif": "t4VM1if1"}, {"brif": "t4br1if2", "disk": "10G", "mem": 4, "name": "t4_VM2", "vcpu": 2, "vmif": "t4VM2if1"}]}, {"dev": "t4s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.31.2", "remote_ip": "10.2.31.2", "remote_route": "10.2.31.0/24", "subnet_route": "10.1.31.0/24", "tenant_route_ip": "192.168.4.2", "v_name": "vxlan_t4s1"}], "rc": 0, "start": "2019-11-18 10:33:19.786129", "stderr": "Device \"vxlan_t4s1\" does not exist.", "stderr_lines": ["Device \"vxlan_t4s1\" does not exist."], "stdout": "", "stdout_lines": []}
skipping: [localhost] => (item=[{u'route': [{u'ip': u'10.1.32.1/24', u'ns_name': u't4', u'ns_if': u't4if', u'if': u'p1'}], u'default_route_ip': u'10.1.32.1', u'bridge_name': u't4br2', u'dns': [{u'dnsif': u't4s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't4s2_dnsbrif'}], u'ns_name': u't4ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.32.2/24', u'tenant_ns_ip': u'10.1.32.1/24', u'tenant_ns_if': u't4ns2if', u'tenant_sub_if': u't4s2if', u'tenant_ns_name': u't4'}], u'subnet_ip': u'2.2.2.0/24', u'vms': [{u'mem': 3, u'name': u't4_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't4br2if1', u'vmif': u't4VM3if1'}]}, {u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}])  => {"ansible_loop_var": "item", "changed": false, "item": [{"bridge_name": "t4br2", "default_route_ip": "10.1.32.1", "dns": [{"brif": "t4s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t4s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t4ns2", "route": [{"if": "p1", "ip": "10.1.32.1/24", "ns_if": "t4if", "ns_name": "t4"}], "subnet_ip": "2.2.2.0/24", "tenant_ns": [{"tenant_ns_if": "t4ns2if", "tenant_ns_ip": "10.1.32.1/24", "tenant_ns_name": "t4", "tenant_sub_if": "t4s2if", "tenant_sub_ip": "10.1.32.2/24"}], "vms": [{"brif": "t4br2if1", "disk": "10G", "mem": 3, "name": "t4_VM3", "vcpu": 2, "vmif": "t4VM3if1"}]}, {"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}], "skip_reason": "Conditional result was False"}

TASK [Attach VXLANs to bridge] ******************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.31.1/24', u'ns_name': u't4', u'ns_if': u't4if', u'if': u'p1'}], u'default_route_ip': u'10.1.31.1', u'bridge_name': u't4br1', u'dns': [{u'dnsif': u't4s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't4s1_dnsbrif'}], u'ns_name': u't4ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.31.2/24', u'tenant_ns_ip': u'10.1.31.1/24', u'tenant_ns_if': u't4ns1if', u'tenant_sub_if': u't4s1if', u'tenant_ns_name': u't4'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't4_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't4br1if1', u'vmif': u't4VM1if1'}, {u'mem': 4, u'name': u't4_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't4br1if2', u'vmif': u't4VM2if1'}]}, {u'local_ip': u'10.1.31.2', u'dsport': 4789, u'dev': u't4s1if', u'tenant_route_ip': u'192.168.4.2', u'remote_route': u'10.2.31.0/24', u'subnet_route': u'10.1.31.0/24', u'v_name': u'vxlan_t4s1', u'id': 42, u'remote_ip': u'10.2.31.2'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t4ns1\" brctl show \"t4br1\" | grep -w 'vxlan_t4s1' ; if [ $? -ne 0 ] ; then ip netns exec \"t4ns1\" brctl addif \"t4br1\" \"vxlan_t4s1\" ; fi\n", "delta": "0:00:00.078891", "end": "2019-11-18 10:33:20.273144", "item": [{"bridge_name": "t4br1", "default_route_ip": "10.1.31.1", "dns": [{"brif": "t4s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t4s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t4ns1", "route": [{"if": "p1", "ip": "10.1.31.1/24", "ns_if": "t4if", "ns_name": "t4"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t4ns1if", "tenant_ns_ip": "10.1.31.1/24", "tenant_ns_name": "t4", "tenant_sub_if": "t4s1if", "tenant_sub_ip": "10.1.31.2/24"}], "vms": [{"brif": "t4br1if1", "disk": "10G", "mem": 2, "name": "t4_VM1", "vcpu": 4, "vmif": "t4VM1if1"}, {"brif": "t4br1if2", "disk": "10G", "mem": 4, "name": "t4_VM2", "vcpu": 2, "vmif": "t4VM2if1"}]}, {"dev": "t4s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.31.2", "remote_ip": "10.2.31.2", "remote_route": "10.2.31.0/24", "subnet_route": "10.1.31.0/24", "tenant_route_ip": "192.168.4.2", "v_name": "vxlan_t4s1"}], "rc": 0, "start": "2019-11-18 10:33:20.194253", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}
skipping: [localhost] => (item=[{u'route': [{u'ip': u'10.1.32.1/24', u'ns_name': u't4', u'ns_if': u't4if', u'if': u'p1'}], u'default_route_ip': u'10.1.32.1', u'bridge_name': u't4br2', u'dns': [{u'dnsif': u't4s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't4s2_dnsbrif'}], u'ns_name': u't4ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.32.2/24', u'tenant_ns_ip': u'10.1.32.1/24', u'tenant_ns_if': u't4ns2if', u'tenant_sub_if': u't4s2if', u'tenant_ns_name': u't4'}], u'subnet_ip': u'2.2.2.0/24', u'vms': [{u'mem': 3, u'name': u't4_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't4br2if1', u'vmif': u't4VM3if1'}]}, {u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}])  => {"ansible_loop_var": "item", "changed": false, "item": [{"bridge_name": "t4br2", "default_route_ip": "10.1.32.1", "dns": [{"brif": "t4s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t4s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t4ns2", "route": [{"if": "p1", "ip": "10.1.32.1/24", "ns_if": "t4if", "ns_name": "t4"}], "subnet_ip": "2.2.2.0/24", "tenant_ns": [{"tenant_ns_if": "t4ns2if", "tenant_ns_ip": "10.1.32.1/24", "tenant_ns_name": "t4", "tenant_sub_if": "t4s2if", "tenant_sub_ip": "10.1.32.2/24"}], "vms": [{"brif": "t4br2if1", "disk": "10G", "mem": 3, "name": "t4_VM3", "vcpu": 2, "vmif": "t4VM3if1"}]}, {"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}], "skip_reason": "Conditional result was False"}

PLAY RECAP **************************************************************************************************************************************************
localhost                  : ok=21   changed=21   unreachable=0    failed=0    skipped=0    rescued=0    ignored=0   

Using /etc/ansible/ansible.cfg as config file

PLAY [worker] ***********************************************************************************************************************************************

TASK [Create Tenant Namespace] ******************************************************************************************************************************
changed: [99.99.99.2] => (item={u'default_route_ip': u'192.168.132.1', u'name': u't4', u'pns_ip': u'192.168.132.1/24', u'tenant_if': u't4if', u'tenant_ip': u'192.168.132.2/24', u'pns_if': u't4pns_if'}) => {"ansible_loop_var": "item", "changed": true, "cmd": ["ip", "netns", "add", "t4"], "delta": "0:00:00.095132", "end": "2019-11-18 10:33:22.283032", "item": {"default_route_ip": "192.168.132.1", "name": "t4", "pns_if": "t4pns_if", "pns_ip": "192.168.132.1/24", "tenant_if": "t4if", "tenant_ip": "192.168.132.2/24"}, "rc": 0, "start": "2019-11-18 10:33:22.187900", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Create Subnet Namespace] ******************************************************************************************************************************
changed: [99.99.99.2] => (item={u'route': [{u'ip': u'10.2.31.1/24', u'ns_name': u't4', u'ns_if': u't4if', u'if': u'p1'}], u'default_route_ip': u'10.2.31.1', u'bridge_name': u't4br1', u'dns': [{u'dnsif': u't4s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't4s1_dnsbrif'}], u'ns_name': u't4ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.31.2/24', u'tenant_ns_ip': u'10.2.31.1/24', u'tenant_ns_if': u't4ns1if', u'tenant_ns_name': u't4', u'tenant_sub_if': u't4s1if'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't4_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't4br1if1', u'vmif': u't4VM4if1'}], u'vxlan': [{u'local_ip': u'10.2.31.2', u'tenant_route_ip': u'192.168.132.2', u'dsport': 4789, u'dev': u't4s1if', u'subnet_route': u'10.2.31.0/24', u'remote_route': u'10.1.31.0/24', u'v_name': u'vxlan_t4s1', u'id': 42, u'remote_ip': u'10.1.31.2'}]}) => {"ansible_loop_var": "item", "changed": true, "cmd": ["ip", "netns", "add", "t4ns1"], "delta": "0:00:00.056269", "end": "2019-11-18 10:33:22.752283", "item": {"bridge_name": "t4br1", "default_route_ip": "10.2.31.1", "dns": [{"brif": "t4s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t4s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "ns_name": "t4ns1", "route": [{"if": "p1", "ip": "10.2.31.1/24", "ns_if": "t4if", "ns_name": "t4"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t4ns1if", "tenant_ns_ip": "10.2.31.1/24", "tenant_ns_name": "t4", "tenant_sub_if": "t4s1if", "tenant_sub_ip": "10.2.31.2/24"}], "vms": [{"brif": "t4br1if1", "disk": "10G", "mem": 2, "name": "t4_VM4", "vcpu": 4, "vmif": "t4VM4if1"}], "vxlan": [{"dev": "t4s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.31.2", "remote_ip": "10.1.31.2", "remote_route": "10.1.31.0/24", "subnet_route": "10.2.31.0/24", "tenant_route_ip": "192.168.132.2", "v_name": "vxlan_t4s1"}]}, "rc": 0, "start": "2019-11-18 10:33:22.696014", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Create Tenant VETH pairs] *****************************************************************************************************************************
changed: [99.99.99.2] => (item={u'default_route_ip': u'192.168.132.1', u'name': u't4', u'pns_ip': u'192.168.132.1/24', u'tenant_if': u't4if', u'tenant_ip': u'192.168.132.2/24', u'pns_if': u't4pns_if'}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip link show \"t4if\" ; if [ $? -ne 0 ] ; then ip link add \"t4if\" type veth peer name \"t4pns_if\" ; fi\n", "delta": "0:00:00.059519", "end": "2019-11-18 10:33:23.165205", "item": {"default_route_ip": "192.168.132.1", "name": "t4", "pns_if": "t4pns_if", "pns_ip": "192.168.132.1/24", "tenant_if": "t4if", "tenant_ip": "192.168.132.2/24"}, "rc": 0, "start": "2019-11-18 10:33:23.105686", "stderr": "Device \"t4if\" does not exist.", "stderr_lines": ["Device \"t4if\" does not exist."], "stdout": "", "stdout_lines": []}

TASK [Attach Tenant VETH Pairs] *****************************************************************************************************************************
changed: [99.99.99.2] => (item={u'default_route_ip': u'192.168.132.1', u'name': u't4', u'pns_ip': u'192.168.132.1/24', u'tenant_if': u't4if', u'tenant_ip': u'192.168.132.2/24', u'pns_if': u't4pns_if'}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec pns ip link show \"t4pns_if\" ; if [ $? -ne 0 ] ; then ip link set \"t4pns_if\" netns pns ; fi\nip netns exec \"t4\" ip link show \"t4if\" ; if [ $? -ne 0 ] ; then ip link set \"t4if\" netns \"t4\" ; fi\nip netns exec pns ip link set dev \"t4pns_if\" up\nip netns exec \"t4\" ip link set dev \"t4if\" up\n", "delta": "0:00:00.178397", "end": "2019-11-18 10:33:23.718382", "item": {"default_route_ip": "192.168.132.1", "name": "t4", "pns_if": "t4pns_if", "pns_ip": "192.168.132.1/24", "tenant_if": "t4if", "tenant_ip": "192.168.132.2/24"}, "rc": 0, "start": "2019-11-18 10:33:23.539985", "stderr": "Device \"t4pns_if\" does not exist.\nDevice \"t4if\" does not exist.", "stderr_lines": ["Device \"t4pns_if\" does not exist.", "Device \"t4if\" does not exist."], "stdout": "", "stdout_lines": []}

TASK [Add IP addresses to Tenant VETH Pairs] ****************************************************************************************************************
changed: [99.99.99.2] => (item={u'default_route_ip': u'192.168.132.1', u'name': u't4', u'pns_ip': u'192.168.132.1/24', u'tenant_if': u't4if', u'tenant_ip': u'192.168.132.2/24', u'pns_if': u't4pns_if'}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec pns ip addr show \"t4pns_if\" | awk 'FNR==3{ print $2 }' | grep -w '^192.168.132.1/24' ; if [ $? -ne 0 ] ; then ip netns exec pns ip addr add \"192.168.132.1/24\" dev \"t4pns_if\" ; fi\nip netns exec \"t4\" ip addr show \"t4if\" | awk 'FNR==3{ print $2 }' | grep -w '^192.168.132.2/24' ; if [ $? -ne 0 ] ; then ip netns exec \"t4\" ip addr add \"192.168.132.2/24\" dev \"t4if\" ; fi\n", "delta": "0:00:00.169118", "end": "2019-11-18 10:33:24.270386", "item": {"default_route_ip": "192.168.132.1", "name": "t4", "pns_if": "t4pns_if", "pns_ip": "192.168.132.1/24", "tenant_if": "t4if", "tenant_ip": "192.168.132.2/24"}, "rc": 0, "start": "2019-11-18 10:33:24.101268", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Create Namespace VETH Pairs] **************************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.31.1/24', u'ns_name': u't4', u'ns_if': u't4if', u'if': u'p1'}], u'default_route_ip': u'10.2.31.1', u'bridge_name': u't4br1', u'dns': [{u'dnsif': u't4s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't4s1_dnsbrif'}], u'ns_name': u't4ns1', u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't4_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't4br1if1', u'vmif': u't4VM4if1'}], u'vxlan': [{u'local_ip': u'10.2.31.2', u'dsport': 4789, u'dev': u't4s1if', u'tenant_route_ip': u'192.168.132.2', u'remote_route': u'10.1.31.0/24', u'subnet_route': u'10.2.31.0/24', u'v_name': u'vxlan_t4s1', u'id': 42, u'remote_ip': u'10.1.31.2'}]}, {u'tenant_sub_ip': u'10.2.31.2/24', u'tenant_ns_ip': u'10.2.31.1/24', u'tenant_ns_if': u't4ns1if', u'tenant_sub_if': u't4s1if', u'tenant_ns_name': u't4'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip link show \"t4ns1if\" ; if [ $? -ne 0 ] ; then ip link add \"t4ns1if\" type veth peer name \"t4s1if\" ; fi\n", "delta": "0:00:00.012352", "end": "2019-11-18 10:33:24.692299", "item": [{"bridge_name": "t4br1", "default_route_ip": "10.2.31.1", "dns": [{"brif": "t4s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t4s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "ns_name": "t4ns1", "route": [{"if": "p1", "ip": "10.2.31.1/24", "ns_if": "t4if", "ns_name": "t4"}], "subnet_ip": "1.1.1.0/24", "vms": [{"brif": "t4br1if1", "disk": "10G", "mem": 2, "name": "t4_VM4", "vcpu": 4, "vmif": "t4VM4if1"}], "vxlan": [{"dev": "t4s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.31.2", "remote_ip": "10.1.31.2", "remote_route": "10.1.31.0/24", "subnet_route": "10.2.31.0/24", "tenant_route_ip": "192.168.132.2", "v_name": "vxlan_t4s1"}]}, {"tenant_ns_if": "t4ns1if", "tenant_ns_ip": "10.2.31.1/24", "tenant_ns_name": "t4", "tenant_sub_if": "t4s1if", "tenant_sub_ip": "10.2.31.2/24"}], "rc": 0, "start": "2019-11-18 10:33:24.679947", "stderr": "Device \"t4ns1if\" does not exist.", "stderr_lines": ["Device \"t4ns1if\" does not exist."], "stdout": "", "stdout_lines": []}

TASK [Attach Namespace VETH Pairs] **************************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.31.1/24', u'ns_name': u't4', u'ns_if': u't4if', u'if': u'p1'}], u'default_route_ip': u'10.2.31.1', u'bridge_name': u't4br1', u'dns': [{u'dnsif': u't4s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't4s1_dnsbrif'}], u'ns_name': u't4ns1', u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't4_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't4br1if1', u'vmif': u't4VM4if1'}], u'vxlan': [{u'local_ip': u'10.2.31.2', u'dsport': 4789, u'dev': u't4s1if', u'tenant_route_ip': u'192.168.132.2', u'remote_route': u'10.1.31.0/24', u'subnet_route': u'10.2.31.0/24', u'v_name': u'vxlan_t4s1', u'id': 42, u'remote_ip': u'10.1.31.2'}]}, {u'tenant_sub_ip': u'10.2.31.2/24', u'tenant_ns_ip': u'10.2.31.1/24', u'tenant_ns_if': u't4ns1if', u'tenant_sub_if': u't4s1if', u'tenant_ns_name': u't4'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t4\" ip link show \"t4ns1if\" ; if [ $? -ne 0 ] ; then ip link set \"t4ns1if\" netns \"t4\" ; fi\nip netns exec \"t4ns1\" ip link show \"t4s1if\" ; if [ $? -ne 0 ] ; then ip link set \"t4s1if\" netns \"t4ns1\" ; fi\n", "delta": "0:00:00.121174", "end": "2019-11-18 10:33:25.215026", "item": [{"bridge_name": "t4br1", "default_route_ip": "10.2.31.1", "dns": [{"brif": "t4s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t4s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "ns_name": "t4ns1", "route": [{"if": "p1", "ip": "10.2.31.1/24", "ns_if": "t4if", "ns_name": "t4"}], "subnet_ip": "1.1.1.0/24", "vms": [{"brif": "t4br1if1", "disk": "10G", "mem": 2, "name": "t4_VM4", "vcpu": 4, "vmif": "t4VM4if1"}], "vxlan": [{"dev": "t4s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.31.2", "remote_ip": "10.1.31.2", "remote_route": "10.1.31.0/24", "subnet_route": "10.2.31.0/24", "tenant_route_ip": "192.168.132.2", "v_name": "vxlan_t4s1"}]}, {"tenant_ns_if": "t4ns1if", "tenant_ns_ip": "10.2.31.1/24", "tenant_ns_name": "t4", "tenant_sub_if": "t4s1if", "tenant_sub_ip": "10.2.31.2/24"}], "rc": 0, "start": "2019-11-18 10:33:25.093852", "stderr": "Device \"t4ns1if\" does not exist.\nDevice \"t4s1if\" does not exist.", "stderr_lines": ["Device \"t4ns1if\" does not exist.", "Device \"t4s1if\" does not exist."], "stdout": "", "stdout_lines": []}

TASK [Set Namespace VETH Pairs UP] **************************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.31.1/24', u'ns_name': u't4', u'ns_if': u't4if', u'if': u'p1'}], u'default_route_ip': u'10.2.31.1', u'bridge_name': u't4br1', u'dns': [{u'dnsif': u't4s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't4s1_dnsbrif'}], u'ns_name': u't4ns1', u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't4_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't4br1if1', u'vmif': u't4VM4if1'}], u'vxlan': [{u'local_ip': u'10.2.31.2', u'dsport': 4789, u'dev': u't4s1if', u'tenant_route_ip': u'192.168.132.2', u'remote_route': u'10.1.31.0/24', u'subnet_route': u'10.2.31.0/24', u'v_name': u'vxlan_t4s1', u'id': 42, u'remote_ip': u'10.1.31.2'}]}, {u'tenant_sub_ip': u'10.2.31.2/24', u'tenant_ns_ip': u'10.2.31.1/24', u'tenant_ns_if': u't4ns1if', u'tenant_sub_if': u't4s1if', u'tenant_ns_name': u't4'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t4\" ip link set dev \"t4ns1if\" up\nip netns exec \"t4ns1\" ip link set dev \"t4s1if\" up\n", "delta": "0:00:00.095796", "end": "2019-11-18 10:33:25.674334", "item": [{"bridge_name": "t4br1", "default_route_ip": "10.2.31.1", "dns": [{"brif": "t4s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t4s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "ns_name": "t4ns1", "route": [{"if": "p1", "ip": "10.2.31.1/24", "ns_if": "t4if", "ns_name": "t4"}], "subnet_ip": "1.1.1.0/24", "vms": [{"brif": "t4br1if1", "disk": "10G", "mem": 2, "name": "t4_VM4", "vcpu": 4, "vmif": "t4VM4if1"}], "vxlan": [{"dev": "t4s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.31.2", "remote_ip": "10.1.31.2", "remote_route": "10.1.31.0/24", "subnet_route": "10.2.31.0/24", "tenant_route_ip": "192.168.132.2", "v_name": "vxlan_t4s1"}]}, {"tenant_ns_if": "t4ns1if", "tenant_ns_ip": "10.2.31.1/24", "tenant_ns_name": "t4", "tenant_sub_if": "t4s1if", "tenant_sub_ip": "10.2.31.2/24"}], "rc": 0, "start": "2019-11-18 10:33:25.578538", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Add IP addresses to Namespace VETH Pairs] *************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.31.1/24', u'ns_name': u't4', u'ns_if': u't4if', u'if': u'p1'}], u'default_route_ip': u'10.2.31.1', u'bridge_name': u't4br1', u'dns': [{u'dnsif': u't4s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't4s1_dnsbrif'}], u'ns_name': u't4ns1', u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't4_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't4br1if1', u'vmif': u't4VM4if1'}], u'vxlan': [{u'local_ip': u'10.2.31.2', u'dsport': 4789, u'dev': u't4s1if', u'tenant_route_ip': u'192.168.132.2', u'remote_route': u'10.1.31.0/24', u'subnet_route': u'10.2.31.0/24', u'v_name': u'vxlan_t4s1', u'id': 42, u'remote_ip': u'10.1.31.2'}]}, {u'tenant_sub_ip': u'10.2.31.2/24', u'tenant_ns_ip': u'10.2.31.1/24', u'tenant_ns_if': u't4ns1if', u'tenant_sub_if': u't4s1if', u'tenant_ns_name': u't4'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t4ns1\" ip addr show \"t4s1if\" | awk 'FNR==3{ print $2 }' | grep -w '^10.2.31.2/24' ; if [ $? -ne 0 ] ; then ip netns exec \"t4ns1\" ip addr add \"10.2.31.2/24\" dev \"t4s1if\" ; fi\n\nip netns exec \"t4\" ip addr show \"t4ns1if\" | awk 'FNR==3{ print $2 }' | grep -w '^10.2.31.1/24' ; if [ $? -ne 0 ] ; then ip netns exec \"t4\" ip addr add \"10.2.31.1/24\" dev \"t4ns1if\" ; fi\n", "delta": "0:00:00.165241", "end": "2019-11-18 10:33:26.202315", "item": [{"bridge_name": "t4br1", "default_route_ip": "10.2.31.1", "dns": [{"brif": "t4s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t4s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "ns_name": "t4ns1", "route": [{"if": "p1", "ip": "10.2.31.1/24", "ns_if": "t4if", "ns_name": "t4"}], "subnet_ip": "1.1.1.0/24", "vms": [{"brif": "t4br1if1", "disk": "10G", "mem": 2, "name": "t4_VM4", "vcpu": 4, "vmif": "t4VM4if1"}], "vxlan": [{"dev": "t4s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.31.2", "remote_ip": "10.1.31.2", "remote_route": "10.1.31.0/24", "subnet_route": "10.2.31.0/24", "tenant_route_ip": "192.168.132.2", "v_name": "vxlan_t4s1"}]}, {"tenant_ns_if": "t4ns1if", "tenant_ns_ip": "10.2.31.1/24", "tenant_ns_name": "t4", "tenant_sub_if": "t4s1if", "tenant_sub_ip": "10.2.31.2/24"}], "rc": 0, "start": "2019-11-18 10:33:26.037074", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Add IP Route to Tenant] *******************************************************************************************************************************
changed: [99.99.99.2] => (item={u'default_route_ip': u'192.168.132.1', u'name': u't4', u'pns_ip': u'192.168.132.1/24', u'tenant_if': u't4if', u'tenant_ip': u'192.168.132.2/24', u'pns_if': u't4pns_if'}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t4\" ip route show default | grep -w '[d]efault via 192.168.132.1' ; if [ $? -ne 0 ] ; then ip netns exec \"t4\" ip route add default via \"192.168.132.1\" ; fi\n", "delta": "0:00:00.088938", "end": "2019-11-18 10:33:26.694660", "item": {"default_route_ip": "192.168.132.1", "name": "t4", "pns_if": "t4pns_if", "pns_ip": "192.168.132.1/24", "tenant_if": "t4if", "tenant_ip": "192.168.132.2/24"}, "rc": 0, "start": "2019-11-18 10:33:26.605722", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Add IP Route to Tenant Subnet] ************************************************************************************************************************
changed: [99.99.99.2] => (item={u'route': [{u'ip': u'10.2.31.1/24', u'ns_name': u't4', u'ns_if': u't4if', u'if': u'p1'}], u'default_route_ip': u'10.2.31.1', u'bridge_name': u't4br1', u'dns': [{u'dnsif': u't4s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't4s1_dnsbrif'}], u'ns_name': u't4ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.31.2/24', u'tenant_ns_ip': u'10.2.31.1/24', u'tenant_ns_if': u't4ns1if', u'tenant_ns_name': u't4', u'tenant_sub_if': u't4s1if'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't4_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't4br1if1', u'vmif': u't4VM4if1'}], u'vxlan': [{u'local_ip': u'10.2.31.2', u'tenant_route_ip': u'192.168.132.2', u'dsport': 4789, u'dev': u't4s1if', u'subnet_route': u'10.2.31.0/24', u'remote_route': u'10.1.31.0/24', u'v_name': u'vxlan_t4s1', u'id': 42, u'remote_ip': u'10.1.31.2'}]}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t4ns1\" ip route show default | grep -w '[d]efault via 10.2.31.1' ; if [ $? -ne 0 ] ; then ip netns exec \"t4ns1\" ip route add default via \"10.2.31.1\" ; fi\n", "delta": "0:00:00.083981", "end": "2019-11-18 10:33:27.158603", "item": {"bridge_name": "t4br1", "default_route_ip": "10.2.31.1", "dns": [{"brif": "t4s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t4s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "ns_name": "t4ns1", "route": [{"if": "p1", "ip": "10.2.31.1/24", "ns_if": "t4if", "ns_name": "t4"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t4ns1if", "tenant_ns_ip": "10.2.31.1/24", "tenant_ns_name": "t4", "tenant_sub_if": "t4s1if", "tenant_sub_ip": "10.2.31.2/24"}], "vms": [{"brif": "t4br1if1", "disk": "10G", "mem": 2, "name": "t4_VM4", "vcpu": 4, "vmif": "t4VM4if1"}], "vxlan": [{"dev": "t4s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.31.2", "remote_ip": "10.1.31.2", "remote_route": "10.1.31.0/24", "subnet_route": "10.2.31.0/24", "tenant_route_ip": "192.168.132.2", "v_name": "vxlan_t4s1"}]}, "rc": 0, "start": "2019-11-18 10:33:27.074622", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Create bridge inside namespace] ***********************************************************************************************************************
changed: [99.99.99.2] => (item={u'route': [{u'ip': u'10.2.31.1/24', u'ns_name': u't4', u'ns_if': u't4if', u'if': u'p1'}], u'default_route_ip': u'10.2.31.1', u'bridge_name': u't4br1', u'dns': [{u'dnsif': u't4s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't4s1_dnsbrif'}], u'ns_name': u't4ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.31.2/24', u'tenant_ns_ip': u'10.2.31.1/24', u'tenant_ns_if': u't4ns1if', u'tenant_ns_name': u't4', u'tenant_sub_if': u't4s1if'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't4_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't4br1if1', u'vmif': u't4VM4if1'}], u'vxlan': [{u'local_ip': u'10.2.31.2', u'tenant_route_ip': u'192.168.132.2', u'dsport': 4789, u'dev': u't4s1if', u'subnet_route': u'10.2.31.0/24', u'remote_route': u'10.1.31.0/24', u'v_name': u'vxlan_t4s1', u'id': 42, u'remote_ip': u'10.1.31.2'}]}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t4ns1\" brctl show | grep -w '^t4br1'; if [ $? -ne 0 ] ; then ip netns exec \"t4ns1\" brctl addbr \"t4br1\" ; fi\nip netns exec \"t4ns1\" ip link set dev \"t4br1\" up\n", "delta": "0:00:00.100932", "end": "2019-11-18 10:33:27.674512", "item": {"bridge_name": "t4br1", "default_route_ip": "10.2.31.1", "dns": [{"brif": "t4s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t4s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "ns_name": "t4ns1", "route": [{"if": "p1", "ip": "10.2.31.1/24", "ns_if": "t4if", "ns_name": "t4"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t4ns1if", "tenant_ns_ip": "10.2.31.1/24", "tenant_ns_name": "t4", "tenant_sub_if": "t4s1if", "tenant_sub_ip": "10.2.31.2/24"}], "vms": [{"brif": "t4br1if1", "disk": "10G", "mem": 2, "name": "t4_VM4", "vcpu": 4, "vmif": "t4VM4if1"}], "vxlan": [{"dev": "t4s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.31.2", "remote_ip": "10.1.31.2", "remote_route": "10.1.31.0/24", "subnet_route": "10.2.31.0/24", "tenant_route_ip": "192.168.132.2", "v_name": "vxlan_t4s1"}]}, "rc": 0, "start": "2019-11-18 10:33:27.573580", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Create DNS VETH Pair] *********************************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.31.1/24', u'ns_name': u't4', u'ns_if': u't4if', u'if': u'p1'}], u'default_route_ip': u'10.2.31.1', u'bridge_name': u't4br1', u'ns_name': u't4ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.31.2/24', u'tenant_ns_ip': u'10.2.31.1/24', u'tenant_ns_if': u't4ns1if', u'tenant_sub_if': u't4s1if', u'tenant_ns_name': u't4'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't4_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't4br1if1', u'vmif': u't4VM4if1'}], u'vxlan': [{u'local_ip': u'10.2.31.2', u'dsport': 4789, u'dev': u't4s1if', u'tenant_route_ip': u'192.168.132.2', u'remote_route': u'10.1.31.0/24', u'subnet_route': u'10.2.31.0/24', u'v_name': u'vxlan_t4s1', u'id': 42, u'remote_ip': u'10.1.31.2'}]}, {u'dnsif': u't4s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't4s1_dnsbrif'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t4ns1\" ip link show \"t4s1_dnsbrif\" ; if [ $? -ne 0 ] ; then ip netns exec \"t4ns1\" ip link add \"t4s1_dnsbrif\" type veth peer name \"t4s1_dnsif\" ; fi\nip netns exec \"t4ns1\" ip link set dev \"t4s1_dnsbrif\" up\nip netns exec \"t4ns1\" ip link set dev \"t4s1_dnsif\" up\n", "delta": "0:00:00.136112", "end": "2019-11-18 10:33:28.198444", "item": [{"bridge_name": "t4br1", "default_route_ip": "10.2.31.1", "ns_name": "t4ns1", "route": [{"if": "p1", "ip": "10.2.31.1/24", "ns_if": "t4if", "ns_name": "t4"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t4ns1if", "tenant_ns_ip": "10.2.31.1/24", "tenant_ns_name": "t4", "tenant_sub_if": "t4s1if", "tenant_sub_ip": "10.2.31.2/24"}], "vms": [{"brif": "t4br1if1", "disk": "10G", "mem": 2, "name": "t4_VM4", "vcpu": 4, "vmif": "t4VM4if1"}], "vxlan": [{"dev": "t4s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.31.2", "remote_ip": "10.1.31.2", "remote_route": "10.1.31.0/24", "subnet_route": "10.2.31.0/24", "tenant_route_ip": "192.168.132.2", "v_name": "vxlan_t4s1"}]}, {"brif": "t4s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t4s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "rc": 0, "start": "2019-11-18 10:33:28.062332", "stderr": "Device \"t4s1_dnsbrif\" does not exist.", "stderr_lines": ["Device \"t4s1_dnsbrif\" does not exist."], "stdout": "", "stdout_lines": []}

TASK [Attach DNS VETH Pair] *********************************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.31.1/24', u'ns_name': u't4', u'ns_if': u't4if', u'if': u'p1'}], u'default_route_ip': u'10.2.31.1', u'bridge_name': u't4br1', u'ns_name': u't4ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.31.2/24', u'tenant_ns_ip': u'10.2.31.1/24', u'tenant_ns_if': u't4ns1if', u'tenant_sub_if': u't4s1if', u'tenant_ns_name': u't4'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't4_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't4br1if1', u'vmif': u't4VM4if1'}], u'vxlan': [{u'local_ip': u'10.2.31.2', u'dsport': 4789, u'dev': u't4s1if', u'tenant_route_ip': u'192.168.132.2', u'remote_route': u'10.1.31.0/24', u'subnet_route': u'10.2.31.0/24', u'v_name': u'vxlan_t4s1', u'id': 42, u'remote_ip': u'10.1.31.2'}]}, {u'dnsif': u't4s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't4s1_dnsbrif'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t4ns1\" brctl show \"t4br1\" | grep -w 't4s1_dnsbrif' ; if [ $? -ne 0 ] ; then ip netns exec \"t4ns1\" brctl addif \"t4br1\" \"t4s1_dnsbrif\" ; fi\n", "delta": "0:00:00.067557", "end": "2019-11-18 10:33:28.630555", "item": [{"bridge_name": "t4br1", "default_route_ip": "10.2.31.1", "ns_name": "t4ns1", "route": [{"if": "p1", "ip": "10.2.31.1/24", "ns_if": "t4if", "ns_name": "t4"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t4ns1if", "tenant_ns_ip": "10.2.31.1/24", "tenant_ns_name": "t4", "tenant_sub_if": "t4s1if", "tenant_sub_ip": "10.2.31.2/24"}], "vms": [{"brif": "t4br1if1", "disk": "10G", "mem": 2, "name": "t4_VM4", "vcpu": 4, "vmif": "t4VM4if1"}], "vxlan": [{"dev": "t4s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.31.2", "remote_ip": "10.1.31.2", "remote_route": "10.1.31.0/24", "subnet_route": "10.2.31.0/24", "tenant_route_ip": "192.168.132.2", "v_name": "vxlan_t4s1"}]}, {"brif": "t4s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t4s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "rc": 0, "start": "2019-11-18 10:33:28.562998", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Create VETH Pairs] ************************************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.31.1/24', u'ns_name': u't4', u'ns_if': u't4if', u'if': u'p1'}], u'default_route_ip': u'10.2.31.1', u'bridge_name': u't4br1', u'dns': [{u'dnsif': u't4s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't4s1_dnsbrif'}], u'ns_name': u't4ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.31.2/24', u'tenant_ns_ip': u'10.2.31.1/24', u'tenant_ns_if': u't4ns1if', u'tenant_sub_if': u't4s1if', u'tenant_ns_name': u't4'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.2.31.2', u'dsport': 4789, u'dev': u't4s1if', u'tenant_route_ip': u'192.168.132.2', u'remote_route': u'10.1.31.0/24', u'subnet_route': u'10.2.31.0/24', u'v_name': u'vxlan_t4s1', u'id': 42, u'remote_ip': u'10.1.31.2'}]}, {u'mem': 2, u'name': u't4_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't4br1if1', u'vmif': u't4VM4if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip link show \"t4br1if1\" ; if [ $? -ne 0 ] ; then ip link add \"t4VM4if1\" type veth peer name \"t4br1if1\" ; fi\nip link set dev \"t4br1if1\" up\nip link set dev \"t4VM4if1\" up\n", "delta": "0:00:00.018387", "end": "2019-11-18 10:33:29.019255", "item": [{"bridge_name": "t4br1", "default_route_ip": "10.2.31.1", "dns": [{"brif": "t4s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t4s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "ns_name": "t4ns1", "route": [{"if": "p1", "ip": "10.2.31.1/24", "ns_if": "t4if", "ns_name": "t4"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t4ns1if", "tenant_ns_ip": "10.2.31.1/24", "tenant_ns_name": "t4", "tenant_sub_if": "t4s1if", "tenant_sub_ip": "10.2.31.2/24"}], "vxlan": [{"dev": "t4s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.31.2", "remote_ip": "10.1.31.2", "remote_route": "10.1.31.0/24", "subnet_route": "10.2.31.0/24", "tenant_route_ip": "192.168.132.2", "v_name": "vxlan_t4s1"}]}, {"brif": "t4br1if1", "disk": "10G", "mem": 2, "name": "t4_VM4", "vcpu": 4, "vmif": "t4VM4if1"}], "rc": 0, "start": "2019-11-18 10:33:29.000868", "stderr": "Device \"t4br1if1\" does not exist.", "stderr_lines": ["Device \"t4br1if1\" does not exist."], "stdout": "", "stdout_lines": []}

TASK [Attach VETH Pairs] ************************************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.31.1/24', u'ns_name': u't4', u'ns_if': u't4if', u'if': u'p1'}], u'default_route_ip': u'10.2.31.1', u'bridge_name': u't4br1', u'dns': [{u'dnsif': u't4s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't4s1_dnsbrif'}], u'ns_name': u't4ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.31.2/24', u'tenant_ns_ip': u'10.2.31.1/24', u'tenant_ns_if': u't4ns1if', u'tenant_sub_if': u't4s1if', u'tenant_ns_name': u't4'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.2.31.2', u'dsport': 4789, u'dev': u't4s1if', u'tenant_route_ip': u'192.168.132.2', u'remote_route': u'10.1.31.0/24', u'subnet_route': u'10.2.31.0/24', u'v_name': u'vxlan_t4s1', u'id': 42, u'remote_ip': u'10.1.31.2'}]}, {u'mem': 2, u'name': u't4_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't4br1if1', u'vmif': u't4VM4if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip link show \"t4br1if1\" ; if [ $? -eq 0 ] ; then ip link set \"t4br1if1\" netns \"t4ns1\" ; fi\nip netns exec \"t4ns1\" brctl show \"t4br1\" | grep -w 't4br1if1' ; if [ $? -ne 0 ] ; then ip netns exec \"t4ns1\" brctl addif \"t4br1\" \"t4br1if1\" ; fi\n", "delta": "0:00:00.105064", "end": "2019-11-18 10:33:29.482421", "item": [{"bridge_name": "t4br1", "default_route_ip": "10.2.31.1", "dns": [{"brif": "t4s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t4s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "ns_name": "t4ns1", "route": [{"if": "p1", "ip": "10.2.31.1/24", "ns_if": "t4if", "ns_name": "t4"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t4ns1if", "tenant_ns_ip": "10.2.31.1/24", "tenant_ns_name": "t4", "tenant_sub_if": "t4s1if", "tenant_sub_ip": "10.2.31.2/24"}], "vxlan": [{"dev": "t4s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.31.2", "remote_ip": "10.1.31.2", "remote_route": "10.1.31.0/24", "subnet_route": "10.2.31.0/24", "tenant_route_ip": "192.168.132.2", "v_name": "vxlan_t4s1"}]}, {"brif": "t4br1if1", "disk": "10G", "mem": 2, "name": "t4_VM4", "vcpu": 4, "vmif": "t4VM4if1"}], "rc": 0, "start": "2019-11-18 10:33:29.377357", "stderr": "", "stderr_lines": [], "stdout": "53: t4br1if1@t4VM4if1: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP mode DEFAULT group default qlen 1000\n    link/ether 66:65:a0:2e:8b:8e brd ff:ff:ff:ff:ff:ff", "stdout_lines": ["53: t4br1if1@t4VM4if1: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP mode DEFAULT group default qlen 1000", "    link/ether 66:65:a0:2e:8b:8e brd ff:ff:ff:ff:ff:ff"]}

TASK [All interfaces and bridges UP] ************************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.31.1/24', u'ns_name': u't4', u'ns_if': u't4if', u'if': u'p1'}], u'default_route_ip': u'10.2.31.1', u'bridge_name': u't4br1', u'dns': [{u'dnsif': u't4s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't4s1_dnsbrif'}], u'ns_name': u't4ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.31.2/24', u'tenant_ns_ip': u'10.2.31.1/24', u'tenant_ns_if': u't4ns1if', u'tenant_sub_if': u't4s1if', u'tenant_ns_name': u't4'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.2.31.2', u'dsport': 4789, u'dev': u't4s1if', u'tenant_route_ip': u'192.168.132.2', u'remote_route': u'10.1.31.0/24', u'subnet_route': u'10.2.31.0/24', u'v_name': u'vxlan_t4s1', u'id': 42, u'remote_ip': u'10.1.31.2'}]}, {u'mem': 2, u'name': u't4_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't4br1if1', u'vmif': u't4VM4if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t4ns1\" ip link set \"t4br1if1\" up\nip netns exec \"t4ns1\" ip link set dev \"t4br1\" up\n", "delta": "0:00:00.079859", "end": "2019-11-18 10:33:29.922446", "item": [{"bridge_name": "t4br1", "default_route_ip": "10.2.31.1", "dns": [{"brif": "t4s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t4s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "ns_name": "t4ns1", "route": [{"if": "p1", "ip": "10.2.31.1/24", "ns_if": "t4if", "ns_name": "t4"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t4ns1if", "tenant_ns_ip": "10.2.31.1/24", "tenant_ns_name": "t4", "tenant_sub_if": "t4s1if", "tenant_sub_ip": "10.2.31.2/24"}], "vxlan": [{"dev": "t4s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.31.2", "remote_ip": "10.1.31.2", "remote_route": "10.1.31.0/24", "subnet_route": "10.2.31.0/24", "tenant_route_ip": "192.168.132.2", "v_name": "vxlan_t4s1"}]}, {"brif": "t4br1if1", "disk": "10G", "mem": 2, "name": "t4_VM4", "vcpu": 4, "vmif": "t4VM4if1"}], "rc": 0, "start": "2019-11-18 10:33:29.842587", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Add IP to DNS Interface] ******************************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.31.1/24', u'ns_name': u't4', u'ns_if': u't4if', u'if': u'p1'}], u'default_route_ip': u'10.2.31.1', u'bridge_name': u't4br1', u'ns_name': u't4ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.31.2/24', u'tenant_ns_ip': u'10.2.31.1/24', u'tenant_ns_if': u't4ns1if', u'tenant_sub_if': u't4s1if', u'tenant_ns_name': u't4'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't4_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't4br1if1', u'vmif': u't4VM4if1'}], u'vxlan': [{u'local_ip': u'10.2.31.2', u'dsport': 4789, u'dev': u't4s1if', u'tenant_route_ip': u'192.168.132.2', u'remote_route': u'10.1.31.0/24', u'subnet_route': u'10.2.31.0/24', u'v_name': u'vxlan_t4s1', u'id': 42, u'remote_ip': u'10.1.31.2'}]}, {u'dnsif': u't4s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't4s1_dnsbrif'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t4ns1\" ip addr show \"t4s1_dnsif\" | awk 'FNR==3{ print $2}'| grep -w '^1.1.1.128/24' ; if [ $? -ne 0 ] ; then ip netns exec \"t4ns1\" ip addr add \"1.1.1.128/24\" dev \"t4s1_dnsif\" ; fi\n", "delta": "0:00:00.085947", "end": "2019-11-18 10:33:30.378608", "item": [{"bridge_name": "t4br1", "default_route_ip": "10.2.31.1", "ns_name": "t4ns1", "route": [{"if": "p1", "ip": "10.2.31.1/24", "ns_if": "t4if", "ns_name": "t4"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t4ns1if", "tenant_ns_ip": "10.2.31.1/24", "tenant_ns_name": "t4", "tenant_sub_if": "t4s1if", "tenant_sub_ip": "10.2.31.2/24"}], "vms": [{"brif": "t4br1if1", "disk": "10G", "mem": 2, "name": "t4_VM4", "vcpu": 4, "vmif": "t4VM4if1"}], "vxlan": [{"dev": "t4s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.31.2", "remote_ip": "10.1.31.2", "remote_route": "10.1.31.0/24", "subnet_route": "10.2.31.0/24", "tenant_route_ip": "192.168.132.2", "v_name": "vxlan_t4s1"}]}, {"brif": "t4s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t4s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "rc": 0, "start": "2019-11-18 10:33:30.292661", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Install DHCP Server] **********************************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.31.1/24', u'ns_name': u't4', u'ns_if': u't4if', u'if': u'p1'}], u'default_route_ip': u'10.2.31.1', u'bridge_name': u't4br1', u'ns_name': u't4ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.31.2/24', u'tenant_ns_ip': u'10.2.31.1/24', u'tenant_ns_if': u't4ns1if', u'tenant_sub_if': u't4s1if', u'tenant_ns_name': u't4'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't4_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't4br1if1', u'vmif': u't4VM4if1'}], u'vxlan': [{u'local_ip': u'10.2.31.2', u'dsport': 4789, u'dev': u't4s1if', u'tenant_route_ip': u'192.168.132.2', u'remote_route': u'10.1.31.0/24', u'subnet_route': u'10.2.31.0/24', u'v_name': u'vxlan_t4s1', u'id': 42, u'remote_ip': u'10.1.31.2'}]}, {u'dnsif': u't4s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't4s1_dnsbrif'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t4ns1\" ps aux | grep -w '[d]nsmasq --interface t4s1_dnsif -z --dhcp-range=1.1.1.133,1.1.1.254' ; if [ $? -ne 0 ] ; then ip netns exec \"t4ns1\" dnsmasq --interface \"t4s1_dnsif\" -z --dhcp-range=1.1.1.133,'1.1.1.254' ; fi\n", "delta": "0:00:00.101945", "end": "2019-11-18 10:33:30.844520", "item": [{"bridge_name": "t4br1", "default_route_ip": "10.2.31.1", "ns_name": "t4ns1", "route": [{"if": "p1", "ip": "10.2.31.1/24", "ns_if": "t4if", "ns_name": "t4"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t4ns1if", "tenant_ns_ip": "10.2.31.1/24", "tenant_ns_name": "t4", "tenant_sub_if": "t4s1if", "tenant_sub_ip": "10.2.31.2/24"}], "vms": [{"brif": "t4br1if1", "disk": "10G", "mem": 2, "name": "t4_VM4", "vcpu": 4, "vmif": "t4VM4if1"}], "vxlan": [{"dev": "t4s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.31.2", "remote_ip": "10.1.31.2", "remote_route": "10.1.31.0/24", "subnet_route": "10.2.31.0/24", "tenant_route_ip": "192.168.132.2", "v_name": "vxlan_t4s1"}]}, {"brif": "t4s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t4s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "rc": 0, "start": "2019-11-18 10:33:30.742575", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Create VXLAN devices] *********************************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.31.1/24', u'ns_name': u't4', u'ns_if': u't4if', u'if': u'p1'}], u'default_route_ip': u'10.2.31.1', u'bridge_name': u't4br1', u'dns': [{u'dnsif': u't4s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't4s1_dnsbrif'}], u'ns_name': u't4ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.31.2/24', u'tenant_ns_ip': u'10.2.31.1/24', u'tenant_ns_if': u't4ns1if', u'tenant_sub_if': u't4s1if', u'tenant_ns_name': u't4'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't4_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't4br1if1', u'vmif': u't4VM4if1'}]}, {u'local_ip': u'10.2.31.2', u'dsport': 4789, u'dev': u't4s1if', u'tenant_route_ip': u'192.168.132.2', u'remote_route': u'10.1.31.0/24', u'subnet_route': u'10.2.31.0/24', u'v_name': u'vxlan_t4s1', u'id': 42, u'remote_ip': u'10.1.31.2'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t4ns1\" ip link show \"vxlan_t4s1\" ; if [ $? -ne 0 ] ; then ip netns exec \"t4ns1\" ip link add \"vxlan_t4s1\" type vxlan id \"42\" local \"10.2.31.2\" remote \"10.1.31.2\" dstport \"4789\" dev \"t4s1if\" ; ip netns exec \"t4ns1\" ip link set dev \"vxlan_t4s1\" up ; fi\n", "delta": "0:00:00.104486", "end": "2019-11-18 10:33:31.346404", "item": [{"bridge_name": "t4br1", "default_route_ip": "10.2.31.1", "dns": [{"brif": "t4s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t4s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "ns_name": "t4ns1", "route": [{"if": "p1", "ip": "10.2.31.1/24", "ns_if": "t4if", "ns_name": "t4"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t4ns1if", "tenant_ns_ip": "10.2.31.1/24", "tenant_ns_name": "t4", "tenant_sub_if": "t4s1if", "tenant_sub_ip": "10.2.31.2/24"}], "vms": [{"brif": "t4br1if1", "disk": "10G", "mem": 2, "name": "t4_VM4", "vcpu": 4, "vmif": "t4VM4if1"}]}, {"dev": "t4s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.31.2", "remote_ip": "10.1.31.2", "remote_route": "10.1.31.0/24", "subnet_route": "10.2.31.0/24", "tenant_route_ip": "192.168.132.2", "v_name": "vxlan_t4s1"}], "rc": 0, "start": "2019-11-18 10:33:31.241918", "stderr": "Device \"vxlan_t4s1\" does not exist.", "stderr_lines": ["Device \"vxlan_t4s1\" does not exist."], "stdout": "", "stdout_lines": []}

TASK [Attach VXLANs to bridge] ******************************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.31.1/24', u'ns_name': u't4', u'ns_if': u't4if', u'if': u'p1'}], u'default_route_ip': u'10.2.31.1', u'bridge_name': u't4br1', u'dns': [{u'dnsif': u't4s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't4s1_dnsbrif'}], u'ns_name': u't4ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.31.2/24', u'tenant_ns_ip': u'10.2.31.1/24', u'tenant_ns_if': u't4ns1if', u'tenant_sub_if': u't4s1if', u'tenant_ns_name': u't4'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't4_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't4br1if1', u'vmif': u't4VM4if1'}]}, {u'local_ip': u'10.2.31.2', u'dsport': 4789, u'dev': u't4s1if', u'tenant_route_ip': u'192.168.132.2', u'remote_route': u'10.1.31.0/24', u'subnet_route': u'10.2.31.0/24', u'v_name': u'vxlan_t4s1', u'id': 42, u'remote_ip': u'10.1.31.2'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t4ns1\" brctl show \"t4br1\" | grep -w 'vxlan_t4s1' ; if [ $? -ne 0 ] ; then ip netns exec \"t4ns1\" brctl addif \"t4br1\" \"vxlan_t4s1\" ; fi\n", "delta": "0:00:00.072094", "end": "2019-11-18 10:33:31.818422", "item": [{"bridge_name": "t4br1", "default_route_ip": "10.2.31.1", "dns": [{"brif": "t4s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t4s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "ns_name": "t4ns1", "route": [{"if": "p1", "ip": "10.2.31.1/24", "ns_if": "t4if", "ns_name": "t4"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t4ns1if", "tenant_ns_ip": "10.2.31.1/24", "tenant_ns_name": "t4", "tenant_sub_if": "t4s1if", "tenant_sub_ip": "10.2.31.2/24"}], "vms": [{"brif": "t4br1if1", "disk": "10G", "mem": 2, "name": "t4_VM4", "vcpu": 4, "vmif": "t4VM4if1"}]}, {"dev": "t4s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.31.2", "remote_ip": "10.1.31.2", "remote_route": "10.1.31.0/24", "subnet_route": "10.2.31.0/24", "tenant_route_ip": "192.168.132.2", "v_name": "vxlan_t4s1"}], "rc": 0, "start": "2019-11-18 10:33:31.746328", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

PLAY RECAP **************************************************************************************************************************************************
99.99.99.2                 : ok=21   changed=21   unreachable=0    failed=0    skipped=0    rescued=0    ignored=0   

Using /etc/ansible/ansible.cfg as config file

PLAY [main] *************************************************************************************************************************************************

TASK [Add VXLAN routes in PNS] ******************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.31.1/24', u'ns_name': u't4', u'ns_if': u't4if', u'if': u'p1'}], u'default_route_ip': u'10.1.31.1', u'bridge_name': u't4br1', u'dns': [{u'dnsif': u't4s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't4s1_dnsbrif'}], u'ns_name': u't4ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.31.2/24', u'tenant_ns_ip': u'10.1.31.1/24', u'tenant_ns_if': u't4ns1if', u'tenant_sub_if': u't4s1if', u'tenant_ns_name': u't4'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't4_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't4br1if1', u'vmif': u't4VM1if1'}, {u'mem': 4, u'name': u't4_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't4br1if2', u'vmif': u't4VM2if1'}]}, {u'local_ip': u'10.1.31.2', u'dsport': 4789, u'dev': u't4s1if', u'tenant_route_ip': u'192.168.4.2', u'remote_route': u'10.2.31.0/24', u'subnet_route': u'10.1.31.0/24', u'v_name': u'vxlan_t4s1', u'id': 42, u'remote_ip': u'10.2.31.2'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec pns ip route show \"10.1.31.0/24\" via \"192.168.4.2\" | grep -w '^10.1.31.0/24' ; if [ $? -ne 0 ] ; then ip netns exec pns ip route add \"10.1.31.0/24\" via \"192.168.4.2\" ; fi\n", "delta": "0:00:00.084075", "end": "2019-11-18 10:33:32.917374", "item": [{"bridge_name": "t4br1", "default_route_ip": "10.1.31.1", "dns": [{"brif": "t4s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t4s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t4ns1", "route": [{"if": "p1", "ip": "10.1.31.1/24", "ns_if": "t4if", "ns_name": "t4"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t4ns1if", "tenant_ns_ip": "10.1.31.1/24", "tenant_ns_name": "t4", "tenant_sub_if": "t4s1if", "tenant_sub_ip": "10.1.31.2/24"}], "vms": [{"brif": "t4br1if1", "disk": "10G", "mem": 2, "name": "t4_VM1", "vcpu": 4, "vmif": "t4VM1if1"}, {"brif": "t4br1if2", "disk": "10G", "mem": 4, "name": "t4_VM2", "vcpu": 2, "vmif": "t4VM2if1"}]}, {"dev": "t4s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.31.2", "remote_ip": "10.2.31.2", "remote_route": "10.2.31.0/24", "subnet_route": "10.1.31.0/24", "tenant_route_ip": "192.168.4.2", "v_name": "vxlan_t4s1"}], "rc": 0, "start": "2019-11-18 10:33:32.833299", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}
skipping: [localhost] => (item=[{u'route': [{u'ip': u'10.1.32.1/24', u'ns_name': u't4', u'ns_if': u't4if', u'if': u'p1'}], u'default_route_ip': u'10.1.32.1', u'bridge_name': u't4br2', u'dns': [{u'dnsif': u't4s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't4s2_dnsbrif'}], u'ns_name': u't4ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.32.2/24', u'tenant_ns_ip': u'10.1.32.1/24', u'tenant_ns_if': u't4ns2if', u'tenant_sub_if': u't4s2if', u'tenant_ns_name': u't4'}], u'subnet_ip': u'2.2.2.0/24', u'vms': [{u'mem': 3, u'name': u't4_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't4br2if1', u'vmif': u't4VM3if1'}]}, {u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}])  => {"ansible_loop_var": "item", "changed": false, "item": [{"bridge_name": "t4br2", "default_route_ip": "10.1.32.1", "dns": [{"brif": "t4s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t4s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t4ns2", "route": [{"if": "p1", "ip": "10.1.32.1/24", "ns_if": "t4if", "ns_name": "t4"}], "subnet_ip": "2.2.2.0/24", "tenant_ns": [{"tenant_ns_if": "t4ns2if", "tenant_ns_ip": "10.1.32.1/24", "tenant_ns_name": "t4", "tenant_sub_if": "t4s2if", "tenant_sub_ip": "10.1.32.2/24"}], "vms": [{"brif": "t4br2if1", "disk": "10G", "mem": 3, "name": "t4_VM3", "vcpu": 2, "vmif": "t4VM3if1"}]}, {"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}], "skip_reason": "Conditional result was False"}

TASK [Get PNS ip address] ***********************************************************************************************************************************
ok: [localhost] => {"changed": false, "cmd": "ip netns exec pns ip addr show p1 | awk 'FNR==3{ print $2 }' | awk -F/ '{ print $1 }'\n", "delta": "0:00:00.036108", "end": "2019-11-18 10:33:33.233617", "rc": 0, "start": "2019-11-18 10:33:33.197509", "stderr": "", "stderr_lines": [], "stdout": "192.168.100.238", "stdout_lines": ["192.168.100.238"]}

TASK [Add VXLAN routes to host] *****************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.31.1/24', u'ns_name': u't4', u'ns_if': u't4if', u'if': u'p1'}], u'default_route_ip': u'10.1.31.1', u'bridge_name': u't4br1', u'dns': [{u'dnsif': u't4s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't4s1_dnsbrif'}], u'ns_name': u't4ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.31.2/24', u'tenant_ns_ip': u'10.1.31.1/24', u'tenant_ns_if': u't4ns1if', u'tenant_sub_if': u't4s1if', u'tenant_ns_name': u't4'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't4_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't4br1if1', u'vmif': u't4VM1if1'}, {u'mem': 4, u'name': u't4_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't4br1if2', u'vmif': u't4VM2if1'}]}, {u'local_ip': u'10.1.31.2', u'dsport': 4789, u'dev': u't4s1if', u'tenant_route_ip': u'192.168.4.2', u'remote_route': u'10.2.31.0/24', u'subnet_route': u'10.1.31.0/24', u'v_name': u'vxlan_t4s1', u'id': 42, u'remote_ip': u'10.2.31.2'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip route show \"10.1.31.0/24\" via \"192.168.100.238\" | grep -w '^10.1.31.0/24' ; if [ $? -ne 0 ] ; then ip route add \"10.1.31.0/24\" via \"192.168.100.238\" ; fi\nip route show \"10.2.31.0/24\" via 99.99.99.2 | grep -w '^10.2.31.0/24'; if [ $? -ne 0 ] ; then ip route add \"10.2.31.0/24\" via 99.99.99.2 ; fi\n", "delta": "0:00:00.006850", "end": "2019-11-18 10:33:33.514825", "item": [{"bridge_name": "t4br1", "default_route_ip": "10.1.31.1", "dns": [{"brif": "t4s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t4s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t4ns1", "route": [{"if": "p1", "ip": "10.1.31.1/24", "ns_if": "t4if", "ns_name": "t4"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t4ns1if", "tenant_ns_ip": "10.1.31.1/24", "tenant_ns_name": "t4", "tenant_sub_if": "t4s1if", "tenant_sub_ip": "10.1.31.2/24"}], "vms": [{"brif": "t4br1if1", "disk": "10G", "mem": 2, "name": "t4_VM1", "vcpu": 4, "vmif": "t4VM1if1"}, {"brif": "t4br1if2", "disk": "10G", "mem": 4, "name": "t4_VM2", "vcpu": 2, "vmif": "t4VM2if1"}]}, {"dev": "t4s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.31.2", "remote_ip": "10.2.31.2", "remote_route": "10.2.31.0/24", "subnet_route": "10.1.31.0/24", "tenant_route_ip": "192.168.4.2", "v_name": "vxlan_t4s1"}], "rc": 0, "start": "2019-11-18 10:33:33.507975", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}
skipping: [localhost] => (item=[{u'route': [{u'ip': u'10.1.32.1/24', u'ns_name': u't4', u'ns_if': u't4if', u'if': u'p1'}], u'default_route_ip': u'10.1.32.1', u'bridge_name': u't4br2', u'dns': [{u'dnsif': u't4s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't4s2_dnsbrif'}], u'ns_name': u't4ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.32.2/24', u'tenant_ns_ip': u'10.1.32.1/24', u'tenant_ns_if': u't4ns2if', u'tenant_sub_if': u't4s2if', u'tenant_ns_name': u't4'}], u'subnet_ip': u'2.2.2.0/24', u'vms': [{u'mem': 3, u'name': u't4_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't4br2if1', u'vmif': u't4VM3if1'}]}, {u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}])  => {"ansible_loop_var": "item", "changed": false, "item": [{"bridge_name": "t4br2", "default_route_ip": "10.1.32.1", "dns": [{"brif": "t4s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t4s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t4ns2", "route": [{"if": "p1", "ip": "10.1.32.1/24", "ns_if": "t4if", "ns_name": "t4"}], "subnet_ip": "2.2.2.0/24", "tenant_ns": [{"tenant_ns_if": "t4ns2if", "tenant_ns_ip": "10.1.32.1/24", "tenant_ns_name": "t4", "tenant_sub_if": "t4s2if", "tenant_sub_ip": "10.1.32.2/24"}], "vms": [{"brif": "t4br2if1", "disk": "10G", "mem": 3, "name": "t4_VM3", "vcpu": 2, "vmif": "t4VM3if1"}]}, {"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}], "skip_reason": "Conditional result was False"}

PLAY RECAP **************************************************************************************************************************************************
localhost                  : ok=3    changed=2    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0   

Using /etc/ansible/ansible.cfg as config file

PLAY [worker] ***********************************************************************************************************************************************

TASK [Add VXLAN routes in PNS] ******************************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.31.1/24', u'ns_name': u't4', u'ns_if': u't4if', u'if': u'p1'}], u'default_route_ip': u'10.2.31.1', u'bridge_name': u't4br1', u'dns': [{u'dnsif': u't4s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't4s1_dnsbrif'}], u'ns_name': u't4ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.31.2/24', u'tenant_ns_ip': u'10.2.31.1/24', u'tenant_ns_if': u't4ns1if', u'tenant_sub_if': u't4s1if', u'tenant_ns_name': u't4'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't4_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't4br1if1', u'vmif': u't4VM4if1'}]}, {u'local_ip': u'10.2.31.2', u'dsport': 4789, u'dev': u't4s1if', u'tenant_route_ip': u'192.168.132.2', u'remote_route': u'10.1.31.0/24', u'subnet_route': u'10.2.31.0/24', u'v_name': u'vxlan_t4s1', u'id': 42, u'remote_ip': u'10.1.31.2'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec pns ip route show \"10.2.31.0/24\" via \"192.168.132.2\" | grep -w '^10.2.31.0/24' ; if [ $? -ne 0 ] ; then ip netns exec pns ip route add \"10.2.31.0/24\" via \"192.168.132.2\" ; fi\n", "delta": "0:00:00.084805", "end": "2019-11-18 10:33:34.734442", "item": [{"bridge_name": "t4br1", "default_route_ip": "10.2.31.1", "dns": [{"brif": "t4s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t4s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "ns_name": "t4ns1", "route": [{"if": "p1", "ip": "10.2.31.1/24", "ns_if": "t4if", "ns_name": "t4"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t4ns1if", "tenant_ns_ip": "10.2.31.1/24", "tenant_ns_name": "t4", "tenant_sub_if": "t4s1if", "tenant_sub_ip": "10.2.31.2/24"}], "vms": [{"brif": "t4br1if1", "disk": "10G", "mem": 2, "name": "t4_VM4", "vcpu": 4, "vmif": "t4VM4if1"}]}, {"dev": "t4s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.31.2", "remote_ip": "10.1.31.2", "remote_route": "10.1.31.0/24", "subnet_route": "10.2.31.0/24", "tenant_route_ip": "192.168.132.2", "v_name": "vxlan_t4s1"}], "rc": 0, "start": "2019-11-18 10:33:34.649637", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Get PNS ip address] ***********************************************************************************************************************************
ok: [99.99.99.2] => {"changed": false, "cmd": "ip netns exec pns ip addr show p1 | awk 'FNR==3{ print $2 }' | awk -F/ '{ print $1 }'\n", "delta": "0:00:00.043102", "end": "2019-11-18 10:33:35.138746", "rc": 0, "start": "2019-11-18 10:33:35.095644", "stderr": "", "stderr_lines": [], "stdout": "192.168.100.50", "stdout_lines": ["192.168.100.50"]}

TASK [Add VXLAN routes to host] *****************************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.31.1/24', u'ns_name': u't4', u'ns_if': u't4if', u'if': u'p1'}], u'default_route_ip': u'10.2.31.1', u'bridge_name': u't4br1', u'dns': [{u'dnsif': u't4s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't4s1_dnsbrif'}], u'ns_name': u't4ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.31.2/24', u'tenant_ns_ip': u'10.2.31.1/24', u'tenant_ns_if': u't4ns1if', u'tenant_sub_if': u't4s1if', u'tenant_ns_name': u't4'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't4_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't4br1if1', u'vmif': u't4VM4if1'}]}, {u'local_ip': u'10.2.31.2', u'dsport': 4789, u'dev': u't4s1if', u'tenant_route_ip': u'192.168.132.2', u'remote_route': u'10.1.31.0/24', u'subnet_route': u'10.2.31.0/24', u'v_name': u'vxlan_t4s1', u'id': 42, u'remote_ip': u'10.1.31.2'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip route show \"10.2.31.0/24\" via \"192.168.100.50\" | grep -w '^10.2.31.0/24' ; if [ $? -ne 0 ] ; then ip route add \"10.2.31.0/24\" via \"192.168.100.50\" ; fi\nip route show \"10.1.31.0/24\" via 99.99.99.1 | grep -w '^10.1.31.0/24'; if [ $? -ne 0 ] ; then ip route add \"10.1.31.0/24\" via 99.99.99.1 ; fi\n", "delta": "0:00:00.009653", "end": "2019-11-18 10:33:35.522040", "item": [{"bridge_name": "t4br1", "default_route_ip": "10.2.31.1", "dns": [{"brif": "t4s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t4s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "ns_name": "t4ns1", "route": [{"if": "p1", "ip": "10.2.31.1/24", "ns_if": "t4if", "ns_name": "t4"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t4ns1if", "tenant_ns_ip": "10.2.31.1/24", "tenant_ns_name": "t4", "tenant_sub_if": "t4s1if", "tenant_sub_ip": "10.2.31.2/24"}], "vms": [{"brif": "t4br1if1", "disk": "10G", "mem": 2, "name": "t4_VM4", "vcpu": 4, "vmif": "t4VM4if1"}]}, {"dev": "t4s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.31.2", "remote_ip": "10.1.31.2", "remote_route": "10.1.31.0/24", "subnet_route": "10.2.31.0/24", "tenant_route_ip": "192.168.132.2", "v_name": "vxlan_t4s1"}], "rc": 0, "start": "2019-11-18 10:33:35.512387", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

PLAY RECAP **************************************************************************************************************************************************
99.99.99.2                 : ok=3    changed=2    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0   

Using /etc/ansible/ansible.cfg as config file

PLAY [main] *************************************************************************************************************************************************

TASK [Create VM templates (C1)] *****************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.31.1/24', u'ns_name': u't4', u'ns_if': u't4if', u'if': u'p1'}], u'default_route_ip': u'10.1.31.1', u'bridge_name': u't4br1', u'dns': [{u'dnsif': u't4s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't4s1_dnsbrif'}], u'ns_name': u't4ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.31.2/24', u'tenant_ns_ip': u'10.1.31.1/24', u'tenant_ns_if': u't4ns1if', u'tenant_sub_if': u't4s1if', u'tenant_ns_name': u't4'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.1.31.2', u'dsport': 4789, u'dev': u't4s1if', u'tenant_route_ip': u'192.168.4.2', u'remote_route': u'10.2.31.0/24', u'subnet_route': u'10.1.31.0/24', u'v_name': u'vxlan_t4s1', u'id': 42, u'remote_ip': u'10.2.31.2'}]}, {u'mem': 2, u'name': u't4_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't4br1if1', u'vmif': u't4VM1if1'}]) => {"ansible_loop_var": "item", "changed": true, "checksum": "350ba870bd31b7f6ee517845c14237910b5af0bf", "dest": "/root/Migration-as-a-Service/t4/VM_templates/t4_VM1.xml.j2", "gid": 0, "group": "root", "item": [{"bridge_name": "t4br1", "default_route_ip": "10.1.31.1", "dns": [{"brif": "t4s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t4s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t4ns1", "route": [{"if": "p1", "ip": "10.1.31.1/24", "ns_if": "t4if", "ns_name": "t4"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t4ns1if", "tenant_ns_ip": "10.1.31.1/24", "tenant_ns_name": "t4", "tenant_sub_if": "t4s1if", "tenant_sub_ip": "10.1.31.2/24"}], "vxlan": [{"dev": "t4s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.31.2", "remote_ip": "10.2.31.2", "remote_route": "10.2.31.0/24", "subnet_route": "10.1.31.0/24", "tenant_route_ip": "192.168.4.2", "v_name": "vxlan_t4s1"}]}, {"brif": "t4br1if1", "disk": "10G", "mem": 2, "name": "t4_VM1", "vcpu": 4, "vmif": "t4VM1if1"}], "md5sum": "fbfc2eb0c2569531f25eea92c26d3bee", "mode": "0644", "owner": "root", "size": 4091, "src": "/root/.ansible/tmp/ansible-tmp-1574073216.2-176297162440960/source", "state": "file", "uid": 0}
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.31.1/24', u'ns_name': u't4', u'ns_if': u't4if', u'if': u'p1'}], u'default_route_ip': u'10.1.31.1', u'bridge_name': u't4br1', u'dns': [{u'dnsif': u't4s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't4s1_dnsbrif'}], u'ns_name': u't4ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.31.2/24', u'tenant_ns_ip': u'10.1.31.1/24', u'tenant_ns_if': u't4ns1if', u'tenant_sub_if': u't4s1if', u'tenant_ns_name': u't4'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.1.31.2', u'dsport': 4789, u'dev': u't4s1if', u'tenant_route_ip': u'192.168.4.2', u'remote_route': u'10.2.31.0/24', u'subnet_route': u'10.1.31.0/24', u'v_name': u'vxlan_t4s1', u'id': 42, u'remote_ip': u'10.2.31.2'}]}, {u'mem': 4, u'name': u't4_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't4br1if2', u'vmif': u't4VM2if1'}]) => {"ansible_loop_var": "item", "changed": true, "checksum": "350ba870bd31b7f6ee517845c14237910b5af0bf", "dest": "/root/Migration-as-a-Service/t4/VM_templates/t4_VM2.xml.j2", "gid": 0, "group": "root", "item": [{"bridge_name": "t4br1", "default_route_ip": "10.1.31.1", "dns": [{"brif": "t4s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t4s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t4ns1", "route": [{"if": "p1", "ip": "10.1.31.1/24", "ns_if": "t4if", "ns_name": "t4"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t4ns1if", "tenant_ns_ip": "10.1.31.1/24", "tenant_ns_name": "t4", "tenant_sub_if": "t4s1if", "tenant_sub_ip": "10.1.31.2/24"}], "vxlan": [{"dev": "t4s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.31.2", "remote_ip": "10.2.31.2", "remote_route": "10.2.31.0/24", "subnet_route": "10.1.31.0/24", "tenant_route_ip": "192.168.4.2", "v_name": "vxlan_t4s1"}]}, {"brif": "t4br1if2", "disk": "10G", "mem": 4, "name": "t4_VM2", "vcpu": 2, "vmif": "t4VM2if1"}], "md5sum": "fbfc2eb0c2569531f25eea92c26d3bee", "mode": "0644", "owner": "root", "size": 4091, "src": "/root/.ansible/tmp/ansible-tmp-1574073216.84-36707183455972/source", "state": "file", "uid": 0}
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.32.1/24', u'ns_name': u't4', u'ns_if': u't4if', u'if': u'p1'}], u'default_route_ip': u'10.1.32.1', u'bridge_name': u't4br2', u'dns': [{u'dnsif': u't4s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't4s2_dnsbrif'}], u'ns_name': u't4ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.32.2/24', u'tenant_ns_ip': u'10.1.32.1/24', u'tenant_ns_if': u't4ns2if', u'tenant_sub_if': u't4s2if', u'tenant_ns_name': u't4'}], u'subnet_ip': u'2.2.2.0/24', u'vxlan': [{u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}, {u'mem': 3, u'name': u't4_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't4br2if1', u'vmif': u't4VM3if1'}]) => {"ansible_loop_var": "item", "changed": true, "checksum": "350ba870bd31b7f6ee517845c14237910b5af0bf", "dest": "/root/Migration-as-a-Service/t4/VM_templates/t4_VM3.xml.j2", "gid": 0, "group": "root", "item": [{"bridge_name": "t4br2", "default_route_ip": "10.1.32.1", "dns": [{"brif": "t4s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t4s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t4ns2", "route": [{"if": "p1", "ip": "10.1.32.1/24", "ns_if": "t4if", "ns_name": "t4"}], "subnet_ip": "2.2.2.0/24", "tenant_ns": [{"tenant_ns_if": "t4ns2if", "tenant_ns_ip": "10.1.32.1/24", "tenant_ns_name": "t4", "tenant_sub_if": "t4s2if", "tenant_sub_ip": "10.1.32.2/24"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, {"brif": "t4br2if1", "disk": "10G", "mem": 3, "name": "t4_VM3", "vcpu": 2, "vmif": "t4VM3if1"}], "md5sum": "fbfc2eb0c2569531f25eea92c26d3bee", "mode": "0644", "owner": "root", "size": 4091, "src": "/root/.ansible/tmp/ansible-tmp-1574073217.08-250270014596076/source", "state": "file", "uid": 0}

PLAY RECAP **************************************************************************************************************************************************
localhost                  : ok=1    changed=1    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0   

Using /etc/ansible/ansible.cfg as config file

PLAY [main] *************************************************************************************************************************************************

TASK [Create VM templates (C2)] *****************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.2.31.1/24', u'ns_name': u't4', u'ns_if': u't4if', u'if': u'p1'}], u'default_route_ip': u'10.2.31.1', u'bridge_name': u't4br1', u'dns': [{u'dnsif': u't4s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't4s1_dnsbrif'}], u'ns_name': u't4ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.31.2/24', u'tenant_ns_ip': u'10.2.31.1/24', u'tenant_ns_if': u't4ns1if', u'tenant_sub_if': u't4s1if', u'tenant_ns_name': u't4'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.2.31.2', u'dsport': 4789, u'dev': u't4s1if', u'tenant_route_ip': u'192.168.132.2', u'remote_route': u'10.1.31.0/24', u'subnet_route': u'10.2.31.0/24', u'v_name': u'vxlan_t4s1', u'id': 42, u'remote_ip': u'10.1.31.2'}]}, {u'mem': 2, u'name': u't4_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't4br1if1', u'vmif': u't4VM4if1'}]) => {"ansible_loop_var": "item", "changed": true, "checksum": "350ba870bd31b7f6ee517845c14237910b5af0bf", "dest": "/root/Migration-as-a-Service/t4/VM_templates/t4_VM4.xml.j2", "gid": 0, "group": "root", "item": [{"bridge_name": "t4br1", "default_route_ip": "10.2.31.1", "dns": [{"brif": "t4s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t4s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "ns_name": "t4ns1", "route": [{"if": "p1", "ip": "10.2.31.1/24", "ns_if": "t4if", "ns_name": "t4"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t4ns1if", "tenant_ns_ip": "10.2.31.1/24", "tenant_ns_name": "t4", "tenant_sub_if": "t4s1if", "tenant_sub_ip": "10.2.31.2/24"}], "vxlan": [{"dev": "t4s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.31.2", "remote_ip": "10.1.31.2", "remote_route": "10.1.31.0/24", "subnet_route": "10.2.31.0/24", "tenant_route_ip": "192.168.132.2", "v_name": "vxlan_t4s1"}]}, {"brif": "t4br1if1", "disk": "10G", "mem": 2, "name": "t4_VM4", "vcpu": 4, "vmif": "t4VM4if1"}], "md5sum": "fbfc2eb0c2569531f25eea92c26d3bee", "mode": "0644", "owner": "root", "size": 4091, "src": "/root/.ansible/tmp/ansible-tmp-1574073217.85-133670993674705/source", "state": "file", "uid": 0}

PLAY RECAP **************************************************************************************************************************************************
localhost                  : ok=1    changed=1    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0   

Using /etc/ansible/ansible.cfg as config file

PLAY [main] *************************************************************************************************************************************************

TASK [Copy VM image] ****************************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.31.1/24', u'ns_name': u't4', u'ns_if': u't4if', u'if': u'p1'}], u'default_route_ip': u'10.1.31.1', u'bridge_name': u't4br1', u'dns': [{u'dnsif': u't4s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't4s1_dnsbrif'}], u'ns_name': u't4ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.31.2/24', u'tenant_ns_ip': u'10.1.31.1/24', u'tenant_ns_if': u't4ns1if', u'tenant_sub_if': u't4s1if', u'tenant_ns_name': u't4'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.1.31.2', u'dsport': 4789, u'dev': u't4s1if', u'tenant_route_ip': u'192.168.4.2', u'remote_route': u'10.2.31.0/24', u'subnet_route': u'10.1.31.0/24', u'v_name': u'vxlan_t4s1', u'id': 42, u'remote_ip': u'10.2.31.2'}]}, {u'mem': 2, u'name': u't4_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't4br1if1', u'vmif': u't4VM1if1'}]) => {"ansible_loop_var": "item", "changed": true, "checksum": "d86d5962370fcd0c3d05943fc209d9e05fdac89f", "dest": "/var/lib/libvirt/images/t4_VM1.qcow2", "gid": 0, "group": "root", "item": [{"bridge_name": "t4br1", "default_route_ip": "10.1.31.1", "dns": [{"brif": "t4s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t4s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t4ns1", "route": [{"if": "p1", "ip": "10.1.31.1/24", "ns_if": "t4if", "ns_name": "t4"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t4ns1if", "tenant_ns_ip": "10.1.31.1/24", "tenant_ns_name": "t4", "tenant_sub_if": "t4s1if", "tenant_sub_ip": "10.1.31.2/24"}], "vxlan": [{"dev": "t4s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.31.2", "remote_ip": "10.2.31.2", "remote_route": "10.2.31.0/24", "subnet_route": "10.1.31.0/24", "tenant_route_ip": "192.168.4.2", "v_name": "vxlan_t4s1"}]}, {"brif": "t4br1if1", "disk": "10G", "mem": 2, "name": "t4_VM1", "vcpu": 4, "vmif": "t4VM1if1"}], "md5sum": "b977a19124b65f2d544ddc62e407114d", "mode": "0644", "owner": "root", "size": 10739318784, "src": "/root/.ansible/tmp/ansible-tmp-1574073219.13-273749575212490/source", "state": "file", "uid": 0}
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.31.1/24', u'ns_name': u't4', u'ns_if': u't4if', u'if': u'p1'}], u'default_route_ip': u'10.1.31.1', u'bridge_name': u't4br1', u'dns': [{u'dnsif': u't4s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't4s1_dnsbrif'}], u'ns_name': u't4ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.31.2/24', u'tenant_ns_ip': u'10.1.31.1/24', u'tenant_ns_if': u't4ns1if', u'tenant_sub_if': u't4s1if', u'tenant_ns_name': u't4'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.1.31.2', u'dsport': 4789, u'dev': u't4s1if', u'tenant_route_ip': u'192.168.4.2', u'remote_route': u'10.2.31.0/24', u'subnet_route': u'10.1.31.0/24', u'v_name': u'vxlan_t4s1', u'id': 42, u'remote_ip': u'10.2.31.2'}]}, {u'mem': 4, u'name': u't4_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't4br1if2', u'vmif': u't4VM2if1'}]) => {"ansible_loop_var": "item", "changed": true, "checksum": "d86d5962370fcd0c3d05943fc209d9e05fdac89f", "dest": "/var/lib/libvirt/images/t4_VM2.qcow2", "gid": 0, "group": "root", "item": [{"bridge_name": "t4br1", "default_route_ip": "10.1.31.1", "dns": [{"brif": "t4s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t4s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t4ns1", "route": [{"if": "p1", "ip": "10.1.31.1/24", "ns_if": "t4if", "ns_name": "t4"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t4ns1if", "tenant_ns_ip": "10.1.31.1/24", "tenant_ns_name": "t4", "tenant_sub_if": "t4s1if", "tenant_sub_ip": "10.1.31.2/24"}], "vxlan": [{"dev": "t4s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.31.2", "remote_ip": "10.2.31.2", "remote_route": "10.2.31.0/24", "subnet_route": "10.1.31.0/24", "tenant_route_ip": "192.168.4.2", "v_name": "vxlan_t4s1"}]}, {"brif": "t4br1if2", "disk": "10G", "mem": 4, "name": "t4_VM2", "vcpu": 2, "vmif": "t4VM2if1"}], "md5sum": "b977a19124b65f2d544ddc62e407114d", "mode": "0644", "owner": "root", "size": 10739318784, "src": "/root/.ansible/tmp/ansible-tmp-1574073389.87-18632045114957/source", "state": "file", "uid": 0}
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.32.1/24', u'ns_name': u't4', u'ns_if': u't4if', u'if': u'p1'}], u'default_route_ip': u'10.1.32.1', u'bridge_name': u't4br2', u'dns': [{u'dnsif': u't4s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't4s2_dnsbrif'}], u'ns_name': u't4ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.32.2/24', u'tenant_ns_ip': u'10.1.32.1/24', u'tenant_ns_if': u't4ns2if', u'tenant_sub_if': u't4s2if', u'tenant_ns_name': u't4'}], u'subnet_ip': u'2.2.2.0/24', u'vxlan': [{u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}, {u'mem': 3, u'name': u't4_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't4br2if1', u'vmif': u't4VM3if1'}]) => {"ansible_loop_var": "item", "changed": true, "checksum": "d86d5962370fcd0c3d05943fc209d9e05fdac89f", "dest": "/var/lib/libvirt/images/t4_VM3.qcow2", "gid": 0, "group": "root", "item": [{"bridge_name": "t4br2", "default_route_ip": "10.1.32.1", "dns": [{"brif": "t4s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t4s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t4ns2", "route": [{"if": "p1", "ip": "10.1.32.1/24", "ns_if": "t4if", "ns_name": "t4"}], "subnet_ip": "2.2.2.0/24", "tenant_ns": [{"tenant_ns_if": "t4ns2if", "tenant_ns_ip": "10.1.32.1/24", "tenant_ns_name": "t4", "tenant_sub_if": "t4s2if", "tenant_sub_ip": "10.1.32.2/24"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, {"brif": "t4br2if1", "disk": "10G", "mem": 3, "name": "t4_VM3", "vcpu": 2, "vmif": "t4VM3if1"}], "md5sum": "b977a19124b65f2d544ddc62e407114d", "mode": "0644", "owner": "root", "size": 10739318784, "src": "/root/.ansible/tmp/ansible-tmp-1574073572.8-70714417831661/source", "state": "file", "uid": 0}

TASK [Create VM templates (C1)] *****************************************************************************************************************************
ok: [localhost] => (item=[{u'route': [{u'ip': u'10.1.31.1/24', u'ns_name': u't4', u'ns_if': u't4if', u'if': u'p1'}], u'default_route_ip': u'10.1.31.1', u'bridge_name': u't4br1', u'dns': [{u'dnsif': u't4s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't4s1_dnsbrif'}], u'ns_name': u't4ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.31.2/24', u'tenant_ns_ip': u'10.1.31.1/24', u'tenant_ns_if': u't4ns1if', u'tenant_sub_if': u't4s1if', u'tenant_ns_name': u't4'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.1.31.2', u'dsport': 4789, u'dev': u't4s1if', u'tenant_route_ip': u'192.168.4.2', u'remote_route': u'10.2.31.0/24', u'subnet_route': u'10.1.31.0/24', u'v_name': u'vxlan_t4s1', u'id': 42, u'remote_ip': u'10.2.31.2'}]}, {u'mem': 2, u'name': u't4_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't4br1if1', u'vmif': u't4VM1if1'}]) => {"ansible_loop_var": "item", "changed": false, "checksum": "350ba870bd31b7f6ee517845c14237910b5af0bf", "dest": "/root/Migration-as-a-Service/t4/VM_templates/t4_VM1.xml.j2", "gid": 0, "group": "root", "item": [{"bridge_name": "t4br1", "default_route_ip": "10.1.31.1", "dns": [{"brif": "t4s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t4s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t4ns1", "route": [{"if": "p1", "ip": "10.1.31.1/24", "ns_if": "t4if", "ns_name": "t4"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t4ns1if", "tenant_ns_ip": "10.1.31.1/24", "tenant_ns_name": "t4", "tenant_sub_if": "t4s1if", "tenant_sub_ip": "10.1.31.2/24"}], "vxlan": [{"dev": "t4s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.31.2", "remote_ip": "10.2.31.2", "remote_route": "10.2.31.0/24", "subnet_route": "10.1.31.0/24", "tenant_route_ip": "192.168.4.2", "v_name": "vxlan_t4s1"}]}, {"brif": "t4br1if1", "disk": "10G", "mem": 2, "name": "t4_VM1", "vcpu": 4, "vmif": "t4VM1if1"}], "mode": "0644", "owner": "root", "path": "/root/Migration-as-a-Service/t4/VM_templates/t4_VM1.xml.j2", "size": 4091, "state": "file", "uid": 0}
ok: [localhost] => (item=[{u'route': [{u'ip': u'10.1.31.1/24', u'ns_name': u't4', u'ns_if': u't4if', u'if': u'p1'}], u'default_route_ip': u'10.1.31.1', u'bridge_name': u't4br1', u'dns': [{u'dnsif': u't4s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't4s1_dnsbrif'}], u'ns_name': u't4ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.31.2/24', u'tenant_ns_ip': u'10.1.31.1/24', u'tenant_ns_if': u't4ns1if', u'tenant_sub_if': u't4s1if', u'tenant_ns_name': u't4'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.1.31.2', u'dsport': 4789, u'dev': u't4s1if', u'tenant_route_ip': u'192.168.4.2', u'remote_route': u'10.2.31.0/24', u'subnet_route': u'10.1.31.0/24', u'v_name': u'vxlan_t4s1', u'id': 42, u'remote_ip': u'10.2.31.2'}]}, {u'mem': 4, u'name': u't4_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't4br1if2', u'vmif': u't4VM2if1'}]) => {"ansible_loop_var": "item", "changed": false, "checksum": "350ba870bd31b7f6ee517845c14237910b5af0bf", "dest": "/root/Migration-as-a-Service/t4/VM_templates/t4_VM2.xml.j2", "gid": 0, "group": "root", "item": [{"bridge_name": "t4br1", "default_route_ip": "10.1.31.1", "dns": [{"brif": "t4s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t4s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t4ns1", "route": [{"if": "p1", "ip": "10.1.31.1/24", "ns_if": "t4if", "ns_name": "t4"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t4ns1if", "tenant_ns_ip": "10.1.31.1/24", "tenant_ns_name": "t4", "tenant_sub_if": "t4s1if", "tenant_sub_ip": "10.1.31.2/24"}], "vxlan": [{"dev": "t4s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.31.2", "remote_ip": "10.2.31.2", "remote_route": "10.2.31.0/24", "subnet_route": "10.1.31.0/24", "tenant_route_ip": "192.168.4.2", "v_name": "vxlan_t4s1"}]}, {"brif": "t4br1if2", "disk": "10G", "mem": 4, "name": "t4_VM2", "vcpu": 2, "vmif": "t4VM2if1"}], "mode": "0644", "owner": "root", "path": "/root/Migration-as-a-Service/t4/VM_templates/t4_VM2.xml.j2", "size": 4091, "state": "file", "uid": 0}
ok: [localhost] => (item=[{u'route': [{u'ip': u'10.1.32.1/24', u'ns_name': u't4', u'ns_if': u't4if', u'if': u'p1'}], u'default_route_ip': u'10.1.32.1', u'bridge_name': u't4br2', u'dns': [{u'dnsif': u't4s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't4s2_dnsbrif'}], u'ns_name': u't4ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.32.2/24', u'tenant_ns_ip': u'10.1.32.1/24', u'tenant_ns_if': u't4ns2if', u'tenant_sub_if': u't4s2if', u'tenant_ns_name': u't4'}], u'subnet_ip': u'2.2.2.0/24', u'vxlan': [{u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}, {u'mem': 3, u'name': u't4_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't4br2if1', u'vmif': u't4VM3if1'}]) => {"ansible_loop_var": "item", "changed": false, "checksum": "350ba870bd31b7f6ee517845c14237910b5af0bf", "dest": "/root/Migration-as-a-Service/t4/VM_templates/t4_VM3.xml.j2", "gid": 0, "group": "root", "item": [{"bridge_name": "t4br2", "default_route_ip": "10.1.32.1", "dns": [{"brif": "t4s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t4s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t4ns2", "route": [{"if": "p1", "ip": "10.1.32.1/24", "ns_if": "t4if", "ns_name": "t4"}], "subnet_ip": "2.2.2.0/24", "tenant_ns": [{"tenant_ns_if": "t4ns2if", "tenant_ns_ip": "10.1.32.1/24", "tenant_ns_name": "t4", "tenant_sub_if": "t4s2if", "tenant_sub_ip": "10.1.32.2/24"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, {"brif": "t4br2if1", "disk": "10G", "mem": 3, "name": "t4_VM3", "vcpu": 2, "vmif": "t4VM3if1"}], "mode": "0644", "owner": "root", "path": "/root/Migration-as-a-Service/t4/VM_templates/t4_VM3.xml.j2", "size": 4091, "state": "file", "uid": 0}

TASK [Get list of running VMs] ******************************************************************************************************************************
ok: [localhost] => {"changed": false, "cmd": ["virsh", "list", "--name"], "delta": "0:00:00.207762", "end": "2019-11-18 10:42:01.823498", "rc": 0, "start": "2019-11-18 10:42:01.615736", "stderr": "", "stderr_lines": [], "stdout": "t1_VM2\nt1_VM3\nt2_VM2\nt2_VM3\nt3_VM2\nt3_VM3\nt1_VM4\nt2_VM4\nt3_VM4", "stdout_lines": ["t1_VM2", "t1_VM3", "t2_VM2", "t2_VM3", "t3_VM2", "t3_VM3", "t1_VM4", "t2_VM4", "t3_VM4"]}

TASK [Define VM] ********************************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.31.1/24', u'ns_name': u't4', u'ns_if': u't4if', u'if': u'p1'}], u'default_route_ip': u'10.1.31.1', u'bridge_name': u't4br1', u'dns': [{u'dnsif': u't4s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't4s1_dnsbrif'}], u'ns_name': u't4ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.31.2/24', u'tenant_ns_ip': u'10.1.31.1/24', u'tenant_ns_if': u't4ns1if', u'tenant_sub_if': u't4s1if', u'tenant_ns_name': u't4'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.1.31.2', u'dsport': 4789, u'dev': u't4s1if', u'tenant_route_ip': u'192.168.4.2', u'remote_route': u'10.2.31.0/24', u'subnet_route': u'10.1.31.0/24', u'v_name': u'vxlan_t4s1', u'id': 42, u'remote_ip': u'10.2.31.2'}]}, {u'mem': 2, u'name': u't4_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't4br1if1', u'vmif': u't4VM1if1'}]) => {"ansible_loop_var": "item", "changed": true, "created": "t4_VM1", "item": [{"bridge_name": "t4br1", "default_route_ip": "10.1.31.1", "dns": [{"brif": "t4s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t4s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t4ns1", "route": [{"if": "p1", "ip": "10.1.31.1/24", "ns_if": "t4if", "ns_name": "t4"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t4ns1if", "tenant_ns_ip": "10.1.31.1/24", "tenant_ns_name": "t4", "tenant_sub_if": "t4s1if", "tenant_sub_ip": "10.1.31.2/24"}], "vxlan": [{"dev": "t4s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.31.2", "remote_ip": "10.2.31.2", "remote_route": "10.2.31.0/24", "subnet_route": "10.1.31.0/24", "tenant_route_ip": "192.168.4.2", "v_name": "vxlan_t4s1"}]}, {"brif": "t4br1if1", "disk": "10G", "mem": 2, "name": "t4_VM1", "vcpu": 4, "vmif": "t4VM1if1"}], "warnings": ["'xml' is given - ignoring 'name'"]}
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.31.1/24', u'ns_name': u't4', u'ns_if': u't4if', u'if': u'p1'}], u'default_route_ip': u'10.1.31.1', u'bridge_name': u't4br1', u'dns': [{u'dnsif': u't4s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't4s1_dnsbrif'}], u'ns_name': u't4ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.31.2/24', u'tenant_ns_ip': u'10.1.31.1/24', u'tenant_ns_if': u't4ns1if', u'tenant_sub_if': u't4s1if', u'tenant_ns_name': u't4'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.1.31.2', u'dsport': 4789, u'dev': u't4s1if', u'tenant_route_ip': u'192.168.4.2', u'remote_route': u'10.2.31.0/24', u'subnet_route': u'10.1.31.0/24', u'v_name': u'vxlan_t4s1', u'id': 42, u'remote_ip': u'10.2.31.2'}]}, {u'mem': 4, u'name': u't4_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't4br1if2', u'vmif': u't4VM2if1'}]) => {"ansible_loop_var": "item", "changed": true, "created": "t4_VM2", "item": [{"bridge_name": "t4br1", "default_route_ip": "10.1.31.1", "dns": [{"brif": "t4s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t4s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t4ns1", "route": [{"if": "p1", "ip": "10.1.31.1/24", "ns_if": "t4if", "ns_name": "t4"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t4ns1if", "tenant_ns_ip": "10.1.31.1/24", "tenant_ns_name": "t4", "tenant_sub_if": "t4s1if", "tenant_sub_ip": "10.1.31.2/24"}], "vxlan": [{"dev": "t4s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.31.2", "remote_ip": "10.2.31.2", "remote_route": "10.2.31.0/24", "subnet_route": "10.1.31.0/24", "tenant_route_ip": "192.168.4.2", "v_name": "vxlan_t4s1"}]}, {"brif": "t4br1if2", "disk": "10G", "mem": 4, "name": "t4_VM2", "vcpu": 2, "vmif": "t4VM2if1"}], "warnings": ["'xml' is given - ignoring 'name'"]}
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.32.1/24', u'ns_name': u't4', u'ns_if': u't4if', u'if': u'p1'}], u'default_route_ip': u'10.1.32.1', u'bridge_name': u't4br2', u'dns': [{u'dnsif': u't4s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't4s2_dnsbrif'}], u'ns_name': u't4ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.32.2/24', u'tenant_ns_ip': u'10.1.32.1/24', u'tenant_ns_if': u't4ns2if', u'tenant_sub_if': u't4s2if', u'tenant_ns_name': u't4'}], u'subnet_ip': u'2.2.2.0/24', u'vxlan': [{u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}, {u'mem': 3, u'name': u't4_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't4br2if1', u'vmif': u't4VM3if1'}]) => {"ansible_loop_var": "item", "changed": true, "created": "t4_VM3", "item": [{"bridge_name": "t4br2", "default_route_ip": "10.1.32.1", "dns": [{"brif": "t4s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t4s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t4ns2", "route": [{"if": "p1", "ip": "10.1.32.1/24", "ns_if": "t4if", "ns_name": "t4"}], "subnet_ip": "2.2.2.0/24", "tenant_ns": [{"tenant_ns_if": "t4ns2if", "tenant_ns_ip": "10.1.32.1/24", "tenant_ns_name": "t4", "tenant_sub_if": "t4s2if", "tenant_sub_ip": "10.1.32.2/24"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, {"brif": "t4br2if1", "disk": "10G", "mem": 3, "name": "t4_VM3", "vcpu": 2, "vmif": "t4VM3if1"}], "warnings": ["'xml' is given - ignoring 'name'"]}

TASK [Create VM] ********************************************************************************************************************************************
ok: [localhost] => (item=[{u'route': [{u'ip': u'10.1.31.1/24', u'ns_name': u't4', u'ns_if': u't4if', u'if': u'p1'}], u'default_route_ip': u'10.1.31.1', u'bridge_name': u't4br1', u'dns': [{u'dnsif': u't4s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't4s1_dnsbrif'}], u'ns_name': u't4ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.31.2/24', u'tenant_ns_ip': u'10.1.31.1/24', u'tenant_ns_if': u't4ns1if', u'tenant_sub_if': u't4s1if', u'tenant_ns_name': u't4'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.1.31.2', u'dsport': 4789, u'dev': u't4s1if', u'tenant_route_ip': u'192.168.4.2', u'remote_route': u'10.2.31.0/24', u'subnet_route': u'10.1.31.0/24', u'v_name': u'vxlan_t4s1', u'id': 42, u'remote_ip': u'10.2.31.2'}]}, {u'mem': 2, u'name': u't4_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't4br1if1', u'vmif': u't4VM1if1'}]) => {"ansible_loop_var": "item", "changed": false, "create": 0, "item": [{"bridge_name": "t4br1", "default_route_ip": "10.1.31.1", "dns": [{"brif": "t4s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t4s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t4ns1", "route": [{"if": "p1", "ip": "10.1.31.1/24", "ns_if": "t4if", "ns_name": "t4"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t4ns1if", "tenant_ns_ip": "10.1.31.1/24", "tenant_ns_name": "t4", "tenant_sub_if": "t4s1if", "tenant_sub_ip": "10.1.31.2/24"}], "vxlan": [{"dev": "t4s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.31.2", "remote_ip": "10.2.31.2", "remote_route": "10.2.31.0/24", "subnet_route": "10.1.31.0/24", "tenant_route_ip": "192.168.4.2", "v_name": "vxlan_t4s1"}]}, {"brif": "t4br1if1", "disk": "10G", "mem": 2, "name": "t4_VM1", "vcpu": 4, "vmif": "t4VM1if1"}]}
ok: [localhost] => (item=[{u'route': [{u'ip': u'10.1.31.1/24', u'ns_name': u't4', u'ns_if': u't4if', u'if': u'p1'}], u'default_route_ip': u'10.1.31.1', u'bridge_name': u't4br1', u'dns': [{u'dnsif': u't4s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't4s1_dnsbrif'}], u'ns_name': u't4ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.31.2/24', u'tenant_ns_ip': u'10.1.31.1/24', u'tenant_ns_if': u't4ns1if', u'tenant_sub_if': u't4s1if', u'tenant_ns_name': u't4'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.1.31.2', u'dsport': 4789, u'dev': u't4s1if', u'tenant_route_ip': u'192.168.4.2', u'remote_route': u'10.2.31.0/24', u'subnet_route': u'10.1.31.0/24', u'v_name': u'vxlan_t4s1', u'id': 42, u'remote_ip': u'10.2.31.2'}]}, {u'mem': 4, u'name': u't4_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't4br1if2', u'vmif': u't4VM2if1'}]) => {"ansible_loop_var": "item", "changed": false, "create": 0, "item": [{"bridge_name": "t4br1", "default_route_ip": "10.1.31.1", "dns": [{"brif": "t4s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t4s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t4ns1", "route": [{"if": "p1", "ip": "10.1.31.1/24", "ns_if": "t4if", "ns_name": "t4"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t4ns1if", "tenant_ns_ip": "10.1.31.1/24", "tenant_ns_name": "t4", "tenant_sub_if": "t4s1if", "tenant_sub_ip": "10.1.31.2/24"}], "vxlan": [{"dev": "t4s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.31.2", "remote_ip": "10.2.31.2", "remote_route": "10.2.31.0/24", "subnet_route": "10.1.31.0/24", "tenant_route_ip": "192.168.4.2", "v_name": "vxlan_t4s1"}]}, {"brif": "t4br1if2", "disk": "10G", "mem": 4, "name": "t4_VM2", "vcpu": 2, "vmif": "t4VM2if1"}]}
ok: [localhost] => (item=[{u'route': [{u'ip': u'10.1.32.1/24', u'ns_name': u't4', u'ns_if': u't4if', u'if': u'p1'}], u'default_route_ip': u'10.1.32.1', u'bridge_name': u't4br2', u'dns': [{u'dnsif': u't4s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't4s2_dnsbrif'}], u'ns_name': u't4ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.32.2/24', u'tenant_ns_ip': u'10.1.32.1/24', u'tenant_ns_if': u't4ns2if', u'tenant_sub_if': u't4s2if', u'tenant_ns_name': u't4'}], u'subnet_ip': u'2.2.2.0/24', u'vxlan': [{u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}, {u'mem': 3, u'name': u't4_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't4br2if1', u'vmif': u't4VM3if1'}]) => {"ansible_loop_var": "item", "changed": false, "create": 0, "item": [{"bridge_name": "t4br2", "default_route_ip": "10.1.32.1", "dns": [{"brif": "t4s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t4s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t4ns2", "route": [{"if": "p1", "ip": "10.1.32.1/24", "ns_if": "t4if", "ns_name": "t4"}], "subnet_ip": "2.2.2.0/24", "tenant_ns": [{"tenant_ns_if": "t4ns2if", "tenant_ns_ip": "10.1.32.1/24", "tenant_ns_name": "t4", "tenant_sub_if": "t4s2if", "tenant_sub_ip": "10.1.32.2/24"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, {"brif": "t4br2if1", "disk": "10G", "mem": 3, "name": "t4_VM3", "vcpu": 2, "vmif": "t4VM3if1"}]}

TASK [Start VM] *********************************************************************************************************************************************
ok: [localhost] => (item=[{u'route': [{u'ip': u'10.1.31.1/24', u'ns_name': u't4', u'ns_if': u't4if', u'if': u'p1'}], u'default_route_ip': u'10.1.31.1', u'bridge_name': u't4br1', u'dns': [{u'dnsif': u't4s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't4s1_dnsbrif'}], u'ns_name': u't4ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.31.2/24', u'tenant_ns_ip': u'10.1.31.1/24', u'tenant_ns_if': u't4ns1if', u'tenant_sub_if': u't4s1if', u'tenant_ns_name': u't4'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.1.31.2', u'dsport': 4789, u'dev': u't4s1if', u'tenant_route_ip': u'192.168.4.2', u'remote_route': u'10.2.31.0/24', u'subnet_route': u'10.1.31.0/24', u'v_name': u'vxlan_t4s1', u'id': 42, u'remote_ip': u'10.2.31.2'}]}, {u'mem': 2, u'name': u't4_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't4br1if1', u'vmif': u't4VM1if1'}]) => {"ansible_loop_var": "item", "changed": false, "item": [{"bridge_name": "t4br1", "default_route_ip": "10.1.31.1", "dns": [{"brif": "t4s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t4s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t4ns1", "route": [{"if": "p1", "ip": "10.1.31.1/24", "ns_if": "t4if", "ns_name": "t4"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t4ns1if", "tenant_ns_ip": "10.1.31.1/24", "tenant_ns_name": "t4", "tenant_sub_if": "t4s1if", "tenant_sub_ip": "10.1.31.2/24"}], "vxlan": [{"dev": "t4s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.31.2", "remote_ip": "10.2.31.2", "remote_route": "10.2.31.0/24", "subnet_route": "10.1.31.0/24", "tenant_route_ip": "192.168.4.2", "v_name": "vxlan_t4s1"}]}, {"brif": "t4br1if1", "disk": "10G", "mem": 2, "name": "t4_VM1", "vcpu": 4, "vmif": "t4VM1if1"}]}
ok: [localhost] => (item=[{u'route': [{u'ip': u'10.1.31.1/24', u'ns_name': u't4', u'ns_if': u't4if', u'if': u'p1'}], u'default_route_ip': u'10.1.31.1', u'bridge_name': u't4br1', u'dns': [{u'dnsif': u't4s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't4s1_dnsbrif'}], u'ns_name': u't4ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.31.2/24', u'tenant_ns_ip': u'10.1.31.1/24', u'tenant_ns_if': u't4ns1if', u'tenant_sub_if': u't4s1if', u'tenant_ns_name': u't4'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.1.31.2', u'dsport': 4789, u'dev': u't4s1if', u'tenant_route_ip': u'192.168.4.2', u'remote_route': u'10.2.31.0/24', u'subnet_route': u'10.1.31.0/24', u'v_name': u'vxlan_t4s1', u'id': 42, u'remote_ip': u'10.2.31.2'}]}, {u'mem': 4, u'name': u't4_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't4br1if2', u'vmif': u't4VM2if1'}]) => {"ansible_loop_var": "item", "changed": false, "item": [{"bridge_name": "t4br1", "default_route_ip": "10.1.31.1", "dns": [{"brif": "t4s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t4s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t4ns1", "route": [{"if": "p1", "ip": "10.1.31.1/24", "ns_if": "t4if", "ns_name": "t4"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t4ns1if", "tenant_ns_ip": "10.1.31.1/24", "tenant_ns_name": "t4", "tenant_sub_if": "t4s1if", "tenant_sub_ip": "10.1.31.2/24"}], "vxlan": [{"dev": "t4s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.31.2", "remote_ip": "10.2.31.2", "remote_route": "10.2.31.0/24", "subnet_route": "10.1.31.0/24", "tenant_route_ip": "192.168.4.2", "v_name": "vxlan_t4s1"}]}, {"brif": "t4br1if2", "disk": "10G", "mem": 4, "name": "t4_VM2", "vcpu": 2, "vmif": "t4VM2if1"}]}
ok: [localhost] => (item=[{u'route': [{u'ip': u'10.1.32.1/24', u'ns_name': u't4', u'ns_if': u't4if', u'if': u'p1'}], u'default_route_ip': u'10.1.32.1', u'bridge_name': u't4br2', u'dns': [{u'dnsif': u't4s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't4s2_dnsbrif'}], u'ns_name': u't4ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.32.2/24', u'tenant_ns_ip': u'10.1.32.1/24', u'tenant_ns_if': u't4ns2if', u'tenant_sub_if': u't4s2if', u'tenant_ns_name': u't4'}], u'subnet_ip': u'2.2.2.0/24', u'vxlan': [{u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}, {u'mem': 3, u'name': u't4_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't4br2if1', u'vmif': u't4VM3if1'}]) => {"ansible_loop_var": "item", "changed": false, "item": [{"bridge_name": "t4br2", "default_route_ip": "10.1.32.1", "dns": [{"brif": "t4s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t4s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t4ns2", "route": [{"if": "p1", "ip": "10.1.32.1/24", "ns_if": "t4if", "ns_name": "t4"}], "subnet_ip": "2.2.2.0/24", "tenant_ns": [{"tenant_ns_if": "t4ns2if", "tenant_ns_ip": "10.1.32.1/24", "tenant_ns_name": "t4", "tenant_sub_if": "t4s2if", "tenant_sub_ip": "10.1.32.2/24"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, {"brif": "t4br2if1", "disk": "10G", "mem": 3, "name": "t4_VM3", "vcpu": 2, "vmif": "t4VM3if1"}]}

TASK [Attach VM interface] **********************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.31.1/24', u'ns_name': u't4', u'ns_if': u't4if', u'if': u'p1'}], u'default_route_ip': u'10.1.31.1', u'bridge_name': u't4br1', u'dns': [{u'dnsif': u't4s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't4s1_dnsbrif'}], u'ns_name': u't4ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.31.2/24', u'tenant_ns_ip': u'10.1.31.1/24', u'tenant_ns_if': u't4ns1if', u'tenant_sub_if': u't4s1if', u'tenant_ns_name': u't4'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.1.31.2', u'dsport': 4789, u'dev': u't4s1if', u'tenant_route_ip': u'192.168.4.2', u'remote_route': u'10.2.31.0/24', u'subnet_route': u'10.1.31.0/24', u'v_name': u'vxlan_t4s1', u'id': 42, u'remote_ip': u'10.2.31.2'}]}, {u'mem': 2, u'name': u't4_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't4br1if1', u'vmif': u't4VM1if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "virsh domiflist \"t4_VM1\" | grep -w 't4VM1if1' ; if [ $? -ne 0 ] ; then virsh attach-interface \"t4_VM1\" direct \"t4VM1if1\" --live --persistent ; fi\n", "delta": "0:00:00.304010", "end": "2019-11-18 10:42:07.483709", "item": [{"bridge_name": "t4br1", "default_route_ip": "10.1.31.1", "dns": [{"brif": "t4s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t4s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t4ns1", "route": [{"if": "p1", "ip": "10.1.31.1/24", "ns_if": "t4if", "ns_name": "t4"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t4ns1if", "tenant_ns_ip": "10.1.31.1/24", "tenant_ns_name": "t4", "tenant_sub_if": "t4s1if", "tenant_sub_ip": "10.1.31.2/24"}], "vxlan": [{"dev": "t4s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.31.2", "remote_ip": "10.2.31.2", "remote_route": "10.2.31.0/24", "subnet_route": "10.1.31.0/24", "tenant_route_ip": "192.168.4.2", "v_name": "vxlan_t4s1"}]}, {"brif": "t4br1if1", "disk": "10G", "mem": 2, "name": "t4_VM1", "vcpu": 4, "vmif": "t4VM1if1"}], "rc": 0, "start": "2019-11-18 10:42:07.179699", "stderr": "", "stderr_lines": [], "stdout": "Interface attached successfully", "stdout_lines": ["Interface attached successfully"]}
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.31.1/24', u'ns_name': u't4', u'ns_if': u't4if', u'if': u'p1'}], u'default_route_ip': u'10.1.31.1', u'bridge_name': u't4br1', u'dns': [{u'dnsif': u't4s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't4s1_dnsbrif'}], u'ns_name': u't4ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.31.2/24', u'tenant_ns_ip': u'10.1.31.1/24', u'tenant_ns_if': u't4ns1if', u'tenant_sub_if': u't4s1if', u'tenant_ns_name': u't4'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.1.31.2', u'dsport': 4789, u'dev': u't4s1if', u'tenant_route_ip': u'192.168.4.2', u'remote_route': u'10.2.31.0/24', u'subnet_route': u'10.1.31.0/24', u'v_name': u'vxlan_t4s1', u'id': 42, u'remote_ip': u'10.2.31.2'}]}, {u'mem': 4, u'name': u't4_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't4br1if2', u'vmif': u't4VM2if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "virsh domiflist \"t4_VM2\" | grep -w 't4VM2if1' ; if [ $? -ne 0 ] ; then virsh attach-interface \"t4_VM2\" direct \"t4VM2if1\" --live --persistent ; fi\n", "delta": "0:00:00.264219", "end": "2019-11-18 10:42:07.915542", "item": [{"bridge_name": "t4br1", "default_route_ip": "10.1.31.1", "dns": [{"brif": "t4s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t4s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t4ns1", "route": [{"if": "p1", "ip": "10.1.31.1/24", "ns_if": "t4if", "ns_name": "t4"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t4ns1if", "tenant_ns_ip": "10.1.31.1/24", "tenant_ns_name": "t4", "tenant_sub_if": "t4s1if", "tenant_sub_ip": "10.1.31.2/24"}], "vxlan": [{"dev": "t4s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.31.2", "remote_ip": "10.2.31.2", "remote_route": "10.2.31.0/24", "subnet_route": "10.1.31.0/24", "tenant_route_ip": "192.168.4.2", "v_name": "vxlan_t4s1"}]}, {"brif": "t4br1if2", "disk": "10G", "mem": 4, "name": "t4_VM2", "vcpu": 2, "vmif": "t4VM2if1"}], "rc": 0, "start": "2019-11-18 10:42:07.651323", "stderr": "", "stderr_lines": [], "stdout": "Interface attached successfully", "stdout_lines": ["Interface attached successfully"]}
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.32.1/24', u'ns_name': u't4', u'ns_if': u't4if', u'if': u'p1'}], u'default_route_ip': u'10.1.32.1', u'bridge_name': u't4br2', u'dns': [{u'dnsif': u't4s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't4s2_dnsbrif'}], u'ns_name': u't4ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.32.2/24', u'tenant_ns_ip': u'10.1.32.1/24', u'tenant_ns_if': u't4ns2if', u'tenant_sub_if': u't4s2if', u'tenant_ns_name': u't4'}], u'subnet_ip': u'2.2.2.0/24', u'vxlan': [{u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}, {u'mem': 3, u'name': u't4_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't4br2if1', u'vmif': u't4VM3if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "virsh domiflist \"t4_VM3\" | grep -w 't4VM3if1' ; if [ $? -ne 0 ] ; then virsh attach-interface \"t4_VM3\" direct \"t4VM3if1\" --live --persistent ; fi\n", "delta": "0:00:00.245493", "end": "2019-11-18 10:42:08.325261", "item": [{"bridge_name": "t4br2", "default_route_ip": "10.1.32.1", "dns": [{"brif": "t4s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t4s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t4ns2", "route": [{"if": "p1", "ip": "10.1.32.1/24", "ns_if": "t4if", "ns_name": "t4"}], "subnet_ip": "2.2.2.0/24", "tenant_ns": [{"tenant_ns_if": "t4ns2if", "tenant_ns_ip": "10.1.32.1/24", "tenant_ns_name": "t4", "tenant_sub_if": "t4s2if", "tenant_sub_ip": "10.1.32.2/24"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, {"brif": "t4br2if1", "disk": "10G", "mem": 3, "name": "t4_VM3", "vcpu": 2, "vmif": "t4VM3if1"}], "rc": 0, "start": "2019-11-18 10:42:08.079768", "stderr": "", "stderr_lines": [], "stdout": "Interface attached successfully", "stdout_lines": ["Interface attached successfully"]}

PLAY RECAP **************************************************************************************************************************************************
localhost                  : ok=7    changed=3    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0   

Using /etc/ansible/ansible.cfg as config file

PLAY [worker] ***********************************************************************************************************************************************

TASK [Copy VM image] ****************************************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.31.1/24', u'ns_name': u't4', u'ns_if': u't4if', u'if': u'p1'}], u'default_route_ip': u'10.2.31.1', u'bridge_name': u't4br1', u'dns': [{u'dnsif': u't4s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't4s1_dnsbrif'}], u'ns_name': u't4ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.31.2/24', u'tenant_ns_ip': u'10.2.31.1/24', u'tenant_ns_if': u't4ns1if', u'tenant_sub_if': u't4s1if', u'tenant_ns_name': u't4'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.2.31.2', u'dsport': 4789, u'dev': u't4s1if', u'tenant_route_ip': u'192.168.132.2', u'remote_route': u'10.1.31.0/24', u'subnet_route': u'10.2.31.0/24', u'v_name': u'vxlan_t4s1', u'id': 42, u'remote_ip': u'10.1.31.2'}]}, {u'mem': 2, u'name': u't4_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't4br1if1', u'vmif': u't4VM4if1'}]) => {"ansible_loop_var": "item", "changed": true, "checksum": "f8b2ffa2bf201c84196c582f2dec0d33a1eb4b42", "dest": "/var/lib/libvirt/images/t4_VM4.qcow2", "gid": 0, "group": "root", "item": [{"bridge_name": "t4br1", "default_route_ip": "10.2.31.1", "dns": [{"brif": "t4s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t4s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "ns_name": "t4ns1", "route": [{"if": "p1", "ip": "10.2.31.1/24", "ns_if": "t4if", "ns_name": "t4"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t4ns1if", "tenant_ns_ip": "10.2.31.1/24", "tenant_ns_name": "t4", "tenant_sub_if": "t4s1if", "tenant_sub_ip": "10.2.31.2/24"}], "vxlan": [{"dev": "t4s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.31.2", "remote_ip": "10.1.31.2", "remote_route": "10.1.31.0/24", "subnet_route": "10.2.31.0/24", "tenant_route_ip": "192.168.132.2", "v_name": "vxlan_t4s1"}]}, {"brif": "t4br1if1", "disk": "10G", "mem": 2, "name": "t4_VM4", "vcpu": 4, "vmif": "t4VM4if1"}], "md5sum": "e6d5d524b68797ddd748ba1475985d34", "mode": "0644", "owner": "root", "size": 10739318784, "src": "/root/mainVM.qcow2", "state": "file", "uid": 0}

TASK [Get list of running VMs] ******************************************************************************************************************************
ok: [99.99.99.2] => {"changed": false, "cmd": ["virsh", "list", "--name"], "delta": "0:00:00.023927", "end": "2019-11-18 10:44:18.243332", "rc": 0, "start": "2019-11-18 10:44:18.219405", "stderr": "", "stderr_lines": [], "stdout": "t1_VM1\nt2_VM1\nt3_VM1", "stdout_lines": ["t1_VM1", "t2_VM1", "t3_VM1"]}

TASK [Define VM] ********************************************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.31.1/24', u'ns_name': u't4', u'ns_if': u't4if', u'if': u'p1'}], u'default_route_ip': u'10.2.31.1', u'bridge_name': u't4br1', u'dns': [{u'dnsif': u't4s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't4s1_dnsbrif'}], u'ns_name': u't4ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.31.2/24', u'tenant_ns_ip': u'10.2.31.1/24', u'tenant_ns_if': u't4ns1if', u'tenant_sub_if': u't4s1if', u'tenant_ns_name': u't4'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.2.31.2', u'dsport': 4789, u'dev': u't4s1if', u'tenant_route_ip': u'192.168.132.2', u'remote_route': u'10.1.31.0/24', u'subnet_route': u'10.2.31.0/24', u'v_name': u'vxlan_t4s1', u'id': 42, u'remote_ip': u'10.1.31.2'}]}, {u'mem': 2, u'name': u't4_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't4br1if1', u'vmif': u't4VM4if1'}]) => {"ansible_loop_var": "item", "changed": true, "created": "t4_VM4", "item": [{"bridge_name": "t4br1", "default_route_ip": "10.2.31.1", "dns": [{"brif": "t4s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t4s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "ns_name": "t4ns1", "route": [{"if": "p1", "ip": "10.2.31.1/24", "ns_if": "t4if", "ns_name": "t4"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t4ns1if", "tenant_ns_ip": "10.2.31.1/24", "tenant_ns_name": "t4", "tenant_sub_if": "t4s1if", "tenant_sub_ip": "10.2.31.2/24"}], "vxlan": [{"dev": "t4s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.31.2", "remote_ip": "10.1.31.2", "remote_route": "10.1.31.0/24", "subnet_route": "10.2.31.0/24", "tenant_route_ip": "192.168.132.2", "v_name": "vxlan_t4s1"}]}, {"brif": "t4br1if1", "disk": "10G", "mem": 2, "name": "t4_VM4", "vcpu": 4, "vmif": "t4VM4if1"}], "warnings": ["'xml' is given - ignoring 'name'"]}

TASK [Create VM] ********************************************************************************************************************************************
ok: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.31.1/24', u'ns_name': u't4', u'ns_if': u't4if', u'if': u'p1'}], u'default_route_ip': u'10.2.31.1', u'bridge_name': u't4br1', u'dns': [{u'dnsif': u't4s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't4s1_dnsbrif'}], u'ns_name': u't4ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.31.2/24', u'tenant_ns_ip': u'10.2.31.1/24', u'tenant_ns_if': u't4ns1if', u'tenant_sub_if': u't4s1if', u'tenant_ns_name': u't4'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.2.31.2', u'dsport': 4789, u'dev': u't4s1if', u'tenant_route_ip': u'192.168.132.2', u'remote_route': u'10.1.31.0/24', u'subnet_route': u'10.2.31.0/24', u'v_name': u'vxlan_t4s1', u'id': 42, u'remote_ip': u'10.1.31.2'}]}, {u'mem': 2, u'name': u't4_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't4br1if1', u'vmif': u't4VM4if1'}]) => {"ansible_loop_var": "item", "changed": false, "create": 0, "item": [{"bridge_name": "t4br1", "default_route_ip": "10.2.31.1", "dns": [{"brif": "t4s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t4s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "ns_name": "t4ns1", "route": [{"if": "p1", "ip": "10.2.31.1/24", "ns_if": "t4if", "ns_name": "t4"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t4ns1if", "tenant_ns_ip": "10.2.31.1/24", "tenant_ns_name": "t4", "tenant_sub_if": "t4s1if", "tenant_sub_ip": "10.2.31.2/24"}], "vxlan": [{"dev": "t4s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.31.2", "remote_ip": "10.1.31.2", "remote_route": "10.1.31.0/24", "subnet_route": "10.2.31.0/24", "tenant_route_ip": "192.168.132.2", "v_name": "vxlan_t4s1"}]}, {"brif": "t4br1if1", "disk": "10G", "mem": 2, "name": "t4_VM4", "vcpu": 4, "vmif": "t4VM4if1"}]}

TASK [Start VM] *********************************************************************************************************************************************
ok: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.31.1/24', u'ns_name': u't4', u'ns_if': u't4if', u'if': u'p1'}], u'default_route_ip': u'10.2.31.1', u'bridge_name': u't4br1', u'dns': [{u'dnsif': u't4s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't4s1_dnsbrif'}], u'ns_name': u't4ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.31.2/24', u'tenant_ns_ip': u'10.2.31.1/24', u'tenant_ns_if': u't4ns1if', u'tenant_sub_if': u't4s1if', u'tenant_ns_name': u't4'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.2.31.2', u'dsport': 4789, u'dev': u't4s1if', u'tenant_route_ip': u'192.168.132.2', u'remote_route': u'10.1.31.0/24', u'subnet_route': u'10.2.31.0/24', u'v_name': u'vxlan_t4s1', u'id': 42, u'remote_ip': u'10.1.31.2'}]}, {u'mem': 2, u'name': u't4_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't4br1if1', u'vmif': u't4VM4if1'}]) => {"ansible_loop_var": "item", "changed": false, "item": [{"bridge_name": "t4br1", "default_route_ip": "10.2.31.1", "dns": [{"brif": "t4s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t4s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "ns_name": "t4ns1", "route": [{"if": "p1", "ip": "10.2.31.1/24", "ns_if": "t4if", "ns_name": "t4"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t4ns1if", "tenant_ns_ip": "10.2.31.1/24", "tenant_ns_name": "t4", "tenant_sub_if": "t4s1if", "tenant_sub_ip": "10.2.31.2/24"}], "vxlan": [{"dev": "t4s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.31.2", "remote_ip": "10.1.31.2", "remote_route": "10.1.31.0/24", "subnet_route": "10.2.31.0/24", "tenant_route_ip": "192.168.132.2", "v_name": "vxlan_t4s1"}]}, {"brif": "t4br1if1", "disk": "10G", "mem": 2, "name": "t4_VM4", "vcpu": 4, "vmif": "t4VM4if1"}]}

TASK [Attach VM interface] **********************************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.31.1/24', u'ns_name': u't4', u'ns_if': u't4if', u'if': u'p1'}], u'default_route_ip': u'10.2.31.1', u'bridge_name': u't4br1', u'dns': [{u'dnsif': u't4s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't4s1_dnsbrif'}], u'ns_name': u't4ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.31.2/24', u'tenant_ns_ip': u'10.2.31.1/24', u'tenant_ns_if': u't4ns1if', u'tenant_sub_if': u't4s1if', u'tenant_ns_name': u't4'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.2.31.2', u'dsport': 4789, u'dev': u't4s1if', u'tenant_route_ip': u'192.168.132.2', u'remote_route': u'10.1.31.0/24', u'subnet_route': u'10.2.31.0/24', u'v_name': u'vxlan_t4s1', u'id': 42, u'remote_ip': u'10.1.31.2'}]}, {u'mem': 2, u'name': u't4_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't4br1if1', u'vmif': u't4VM4if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "virsh domiflist \"t4_VM4\" | grep -w 't4VM4if1' ; if [ $? -ne 0 ] ; then virsh attach-interface \"t4_VM4\" direct \"t4VM4if1\" --live --persistent ; fi\n", "delta": "0:00:00.289218", "end": "2019-11-18 10:44:22.266750", "item": [{"bridge_name": "t4br1", "default_route_ip": "10.2.31.1", "dns": [{"brif": "t4s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t4s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "ns_name": "t4ns1", "route": [{"if": "p1", "ip": "10.2.31.1/24", "ns_if": "t4if", "ns_name": "t4"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t4ns1if", "tenant_ns_ip": "10.2.31.1/24", "tenant_ns_name": "t4", "tenant_sub_if": "t4s1if", "tenant_sub_ip": "10.2.31.2/24"}], "vxlan": [{"dev": "t4s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.31.2", "remote_ip": "10.1.31.2", "remote_route": "10.1.31.0/24", "subnet_route": "10.2.31.0/24", "tenant_route_ip": "192.168.132.2", "v_name": "vxlan_t4s1"}]}, {"brif": "t4br1if1", "disk": "10G", "mem": 2, "name": "t4_VM4", "vcpu": 4, "vmif": "t4VM4if1"}], "rc": 0, "start": "2019-11-18 10:44:21.977532", "stderr": "", "stderr_lines": [], "stdout": "Interface attached successfully", "stdout_lines": ["Interface attached successfully"]}

PLAY RECAP **************************************************************************************************************************************************
99.99.99.2                 : ok=6    changed=3    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0   

INFO:root: 10:45:32.467158 The subnet 1.1.1.0/24 is present in Cloud 1
INFO:root: 10:45:32.467345 The subnet 1.1.1.0/24 is present in Cloud 2
INFO:root: 10:45:32.467386 The VM VM1 is present in Cloud 1
INFO:root: 10:45:32.467417 The VM VM4 is present in Cloud 2
INFO:root: 10:45:32.467473 The subnet 1.1.1.0/24 is present in destination cloud
INFO:root: 10:45:32.467506 The subnet 1.1.1.0/24 is present in destination cloud
INFO:root: 11:21:23.833672 Printing the yaml input file
INFO:root: 11:21:23.834221 {'C1': [{'subnet_addr': '1.1.1.0/24', 'VM': [{'name': 'VM1', 'disk': '10G', 'mem': 2, 'vcpu': 4, 'internet_access': True}, {'name': 'VM2', 'disk': '10G', 'mem': 4, 'vcpu': 2, 'internet_access': False}]}, {'subnet_addr': '2.2.2.0/24', 'VM': [{'name': 'VM3', 'disk': '10G', 'mem': 3, 'vcpu': 2, 'internet_access': True}]}], 'C2': [{'subnet_addr': '1.1.1.0/24', 'VM': [{'name': 'VM4', 'disk': '10G', 'mem': 2, 'vcpu': 4, 'internet_access': True}]}]}
INFO:root: 11:21:23.834364 Provided subnet in C1: 1.1.1.0/24 is valid
INFO:root: 11:21:23.834415 Provided subnet in C1: 2.2.2.0/24 is valid
INFO:root: 11:21:23.834459 Provided subnet in C2: 1.1.1.0/24 is valid
Using /etc/ansible/ansible.cfg as config file

PLAY [main] *************************************************************************************************************************************************

TASK [Create Tenant Namespace] ******************************************************************************************************************************
changed: [localhost] => (item={u'default_route_ip': u'192.168.5.1', u'name': u't5', u'pns_ip': u'192.168.5.1/24', u'tenant_if': u't5if', u'tenant_ip': u'192.168.5.2/24', u'pns_if': u't5pns_if'}) => {"ansible_loop_var": "item", "changed": true, "cmd": ["ip", "netns", "add", "t5"], "delta": "0:00:00.062736", "end": "2019-11-18 11:21:25.189572", "item": {"default_route_ip": "192.168.5.1", "name": "t5", "pns_if": "t5pns_if", "pns_ip": "192.168.5.1/24", "tenant_if": "t5if", "tenant_ip": "192.168.5.2/24"}, "rc": 0, "start": "2019-11-18 11:21:25.126836", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Create Subnet Namespace] ******************************************************************************************************************************
changed: [localhost] => (item={u'route': [{u'ip': u'10.1.41.1/24', u'ns_name': u't5', u'ns_if': u't5if', u'if': u'p1'}], u'default_route_ip': u'10.1.41.1', u'bridge_name': u't5br1', u'dns': [{u'dnsif': u't5s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't5s1_dnsbrif'}], u'ns_name': u't5ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.41.2/24', u'tenant_ns_ip': u'10.1.41.1/24', u'tenant_ns_if': u't5ns1if', u'tenant_ns_name': u't5', u'tenant_sub_if': u't5s1if'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't5_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't5br1if1', u'vmif': u't5VM1if1'}, {u'mem': 4, u'name': u't5_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't5br1if2', u'vmif': u't5VM2if1'}], u'vxlan': [{u'local_ip': u'10.1.41.2', u'tenant_route_ip': u'192.168.5.2', u'dsport': 4789, u'dev': u't5s1if', u'subnet_route': u'10.1.41.0/24', u'remote_route': u'10.2.41.0/24', u'v_name': u'vxlan_t5s1', u'id': 42, u'remote_ip': u'10.2.41.2'}]}) => {"ansible_loop_var": "item", "changed": true, "cmd": ["ip", "netns", "add", "t5ns1"], "delta": "0:00:00.050761", "end": "2019-11-18 11:21:25.490927", "item": {"bridge_name": "t5br1", "default_route_ip": "10.1.41.1", "dns": [{"brif": "t5s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t5s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t5ns1", "route": [{"if": "p1", "ip": "10.1.41.1/24", "ns_if": "t5if", "ns_name": "t5"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t5ns1if", "tenant_ns_ip": "10.1.41.1/24", "tenant_ns_name": "t5", "tenant_sub_if": "t5s1if", "tenant_sub_ip": "10.1.41.2/24"}], "vms": [{"brif": "t5br1if1", "disk": "10G", "mem": 2, "name": "t5_VM1", "vcpu": 4, "vmif": "t5VM1if1"}, {"brif": "t5br1if2", "disk": "10G", "mem": 4, "name": "t5_VM2", "vcpu": 2, "vmif": "t5VM2if1"}], "vxlan": [{"dev": "t5s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.41.2", "remote_ip": "10.2.41.2", "remote_route": "10.2.41.0/24", "subnet_route": "10.1.41.0/24", "tenant_route_ip": "192.168.5.2", "v_name": "vxlan_t5s1"}]}, "rc": 0, "start": "2019-11-18 11:21:25.440166", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}
changed: [localhost] => (item={u'route': [{u'ip': u'10.1.42.1/24', u'ns_name': u't5', u'ns_if': u't5if', u'if': u'p1'}], u'default_route_ip': u'10.1.42.1', u'bridge_name': u't5br2', u'dns': [{u'dnsif': u't5s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't5s2_dnsbrif'}], u'ns_name': u't5ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.42.2/24', u'tenant_ns_ip': u'10.1.42.1/24', u'tenant_ns_if': u't5ns2if', u'tenant_ns_name': u't5', u'tenant_sub_if': u't5s2if'}], u'subnet_ip': u'2.2.2.0/24', u'vms': [{u'mem': 3, u'name': u't5_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't5br2if1', u'vmif': u't5VM3if1'}], u'vxlan': [{u'local_ip': [], u'tenant_route_ip': [], u'dsport': [], u'dev': [], u'subnet_route': [], u'remote_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}) => {"ansible_loop_var": "item", "changed": true, "cmd": ["ip", "netns", "add", "t5ns2"], "delta": "0:00:00.073716", "end": "2019-11-18 11:21:25.754589", "item": {"bridge_name": "t5br2", "default_route_ip": "10.1.42.1", "dns": [{"brif": "t5s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t5s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t5ns2", "route": [{"if": "p1", "ip": "10.1.42.1/24", "ns_if": "t5if", "ns_name": "t5"}], "subnet_ip": "2.2.2.0/24", "tenant_ns": [{"tenant_ns_if": "t5ns2if", "tenant_ns_ip": "10.1.42.1/24", "tenant_ns_name": "t5", "tenant_sub_if": "t5s2if", "tenant_sub_ip": "10.1.42.2/24"}], "vms": [{"brif": "t5br2if1", "disk": "10G", "mem": 3, "name": "t5_VM3", "vcpu": 2, "vmif": "t5VM3if1"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, "rc": 0, "start": "2019-11-18 11:21:25.680873", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Create Tenant VETH pairs] *****************************************************************************************************************************
changed: [localhost] => (item={u'default_route_ip': u'192.168.5.1', u'name': u't5', u'pns_ip': u'192.168.5.1/24', u'tenant_if': u't5if', u'tenant_ip': u'192.168.5.2/24', u'pns_if': u't5pns_if'}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip link show \"t5if\" ; if [ $? -ne 0 ] ; then ip link add \"t5if\" type veth peer name \"t5pns_if\" ; fi\n", "delta": "0:00:00.028018", "end": "2019-11-18 11:21:26.087210", "item": {"default_route_ip": "192.168.5.1", "name": "t5", "pns_if": "t5pns_if", "pns_ip": "192.168.5.1/24", "tenant_if": "t5if", "tenant_ip": "192.168.5.2/24"}, "rc": 0, "start": "2019-11-18 11:21:26.059192", "stderr": "Device \"t5if\" does not exist.", "stderr_lines": ["Device \"t5if\" does not exist."], "stdout": "", "stdout_lines": []}

TASK [Attach Tenant VETH Pairs] *****************************************************************************************************************************
changed: [localhost] => (item={u'default_route_ip': u'192.168.5.1', u'name': u't5', u'pns_ip': u'192.168.5.1/24', u'tenant_if': u't5if', u'tenant_ip': u'192.168.5.2/24', u'pns_if': u't5pns_if'}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec pns ip link show \"t5pns_if\" ; if [ $? -ne 0 ] ; then ip link set \"t5pns_if\" netns pns ; fi\nip netns exec \"t5\" ip link show \"t5if\" ; if [ $? -ne 0 ] ; then ip link set \"t5if\" netns \"t5\" ; fi\nip netns exec pns ip link set dev \"t5pns_if\" up\nip netns exec \"t5\" ip link set dev \"t5if\" up\n", "delta": "0:00:00.234509", "end": "2019-11-18 11:21:26.609419", "item": {"default_route_ip": "192.168.5.1", "name": "t5", "pns_if": "t5pns_if", "pns_ip": "192.168.5.1/24", "tenant_if": "t5if", "tenant_ip": "192.168.5.2/24"}, "rc": 0, "start": "2019-11-18 11:21:26.374910", "stderr": "Device \"t5pns_if\" does not exist.\nDevice \"t5if\" does not exist.", "stderr_lines": ["Device \"t5pns_if\" does not exist.", "Device \"t5if\" does not exist."], "stdout": "", "stdout_lines": []}

TASK [Add IP addresses to Tenant VETH Pairs] ****************************************************************************************************************
changed: [localhost] => (item={u'default_route_ip': u'192.168.5.1', u'name': u't5', u'pns_ip': u'192.168.5.1/24', u'tenant_if': u't5if', u'tenant_ip': u'192.168.5.2/24', u'pns_if': u't5pns_if'}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec pns ip addr show \"t5pns_if\" | awk 'FNR==3{ print $2 }' | grep -w '^192.168.5.1/24' ; if [ $? -ne 0 ] ; then ip netns exec pns ip addr add \"192.168.5.1/24\" dev \"t5pns_if\" ; fi\nip netns exec \"t5\" ip addr show \"t5if\" | awk 'FNR==3{ print $2 }' | grep -w '^192.168.5.2/24' ; if [ $? -ne 0 ] ; then ip netns exec \"t5\" ip addr add \"192.168.5.2/24\" dev \"t5if\" ; fi\n", "delta": "0:00:00.134011", "end": "2019-11-18 11:21:27.029538", "item": {"default_route_ip": "192.168.5.1", "name": "t5", "pns_if": "t5pns_if", "pns_ip": "192.168.5.1/24", "tenant_if": "t5if", "tenant_ip": "192.168.5.2/24"}, "rc": 0, "start": "2019-11-18 11:21:26.895527", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Create Namespace VETH Pairs] **************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.41.1/24', u'ns_name': u't5', u'ns_if': u't5if', u'if': u'p1'}], u'default_route_ip': u'10.1.41.1', u'bridge_name': u't5br1', u'dns': [{u'dnsif': u't5s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't5s1_dnsbrif'}], u'ns_name': u't5ns1', u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't5_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't5br1if1', u'vmif': u't5VM1if1'}, {u'mem': 4, u'name': u't5_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't5br1if2', u'vmif': u't5VM2if1'}], u'vxlan': [{u'local_ip': u'10.1.41.2', u'dsport': 4789, u'dev': u't5s1if', u'tenant_route_ip': u'192.168.5.2', u'remote_route': u'10.2.41.0/24', u'subnet_route': u'10.1.41.0/24', u'v_name': u'vxlan_t5s1', u'id': 42, u'remote_ip': u'10.2.41.2'}]}, {u'tenant_sub_ip': u'10.1.41.2/24', u'tenant_ns_ip': u'10.1.41.1/24', u'tenant_ns_if': u't5ns1if', u'tenant_sub_if': u't5s1if', u'tenant_ns_name': u't5'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip link show \"t5ns1if\" ; if [ $? -ne 0 ] ; then ip link add \"t5ns1if\" type veth peer name \"t5s1if\" ; fi\n", "delta": "0:00:00.011934", "end": "2019-11-18 11:21:27.329205", "item": [{"bridge_name": "t5br1", "default_route_ip": "10.1.41.1", "dns": [{"brif": "t5s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t5s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t5ns1", "route": [{"if": "p1", "ip": "10.1.41.1/24", "ns_if": "t5if", "ns_name": "t5"}], "subnet_ip": "1.1.1.0/24", "vms": [{"brif": "t5br1if1", "disk": "10G", "mem": 2, "name": "t5_VM1", "vcpu": 4, "vmif": "t5VM1if1"}, {"brif": "t5br1if2", "disk": "10G", "mem": 4, "name": "t5_VM2", "vcpu": 2, "vmif": "t5VM2if1"}], "vxlan": [{"dev": "t5s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.41.2", "remote_ip": "10.2.41.2", "remote_route": "10.2.41.0/24", "subnet_route": "10.1.41.0/24", "tenant_route_ip": "192.168.5.2", "v_name": "vxlan_t5s1"}]}, {"tenant_ns_if": "t5ns1if", "tenant_ns_ip": "10.1.41.1/24", "tenant_ns_name": "t5", "tenant_sub_if": "t5s1if", "tenant_sub_ip": "10.1.41.2/24"}], "rc": 0, "start": "2019-11-18 11:21:27.317271", "stderr": "Device \"t5ns1if\" does not exist.", "stderr_lines": ["Device \"t5ns1if\" does not exist."], "stdout": "", "stdout_lines": []}
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.42.1/24', u'ns_name': u't5', u'ns_if': u't5if', u'if': u'p1'}], u'default_route_ip': u'10.1.42.1', u'bridge_name': u't5br2', u'dns': [{u'dnsif': u't5s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't5s2_dnsbrif'}], u'ns_name': u't5ns2', u'subnet_ip': u'2.2.2.0/24', u'vms': [{u'mem': 3, u'name': u't5_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't5br2if1', u'vmif': u't5VM3if1'}], u'vxlan': [{u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}, {u'tenant_sub_ip': u'10.1.42.2/24', u'tenant_ns_ip': u'10.1.42.1/24', u'tenant_ns_if': u't5ns2if', u'tenant_sub_if': u't5s2if', u'tenant_ns_name': u't5'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip link show \"t5ns2if\" ; if [ $? -ne 0 ] ; then ip link add \"t5ns2if\" type veth peer name \"t5s2if\" ; fi\n", "delta": "0:00:00.009415", "end": "2019-11-18 11:21:27.573667", "item": [{"bridge_name": "t5br2", "default_route_ip": "10.1.42.1", "dns": [{"brif": "t5s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t5s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t5ns2", "route": [{"if": "p1", "ip": "10.1.42.1/24", "ns_if": "t5if", "ns_name": "t5"}], "subnet_ip": "2.2.2.0/24", "vms": [{"brif": "t5br2if1", "disk": "10G", "mem": 3, "name": "t5_VM3", "vcpu": 2, "vmif": "t5VM3if1"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, {"tenant_ns_if": "t5ns2if", "tenant_ns_ip": "10.1.42.1/24", "tenant_ns_name": "t5", "tenant_sub_if": "t5s2if", "tenant_sub_ip": "10.1.42.2/24"}], "rc": 0, "start": "2019-11-18 11:21:27.564252", "stderr": "Device \"t5ns2if\" does not exist.", "stderr_lines": ["Device \"t5ns2if\" does not exist."], "stdout": "", "stdout_lines": []}

TASK [Attach Namespace VETH Pairs] **************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.41.1/24', u'ns_name': u't5', u'ns_if': u't5if', u'if': u'p1'}], u'default_route_ip': u'10.1.41.1', u'bridge_name': u't5br1', u'dns': [{u'dnsif': u't5s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't5s1_dnsbrif'}], u'ns_name': u't5ns1', u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't5_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't5br1if1', u'vmif': u't5VM1if1'}, {u'mem': 4, u'name': u't5_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't5br1if2', u'vmif': u't5VM2if1'}], u'vxlan': [{u'local_ip': u'10.1.41.2', u'dsport': 4789, u'dev': u't5s1if', u'tenant_route_ip': u'192.168.5.2', u'remote_route': u'10.2.41.0/24', u'subnet_route': u'10.1.41.0/24', u'v_name': u'vxlan_t5s1', u'id': 42, u'remote_ip': u'10.2.41.2'}]}, {u'tenant_sub_ip': u'10.1.41.2/24', u'tenant_ns_ip': u'10.1.41.1/24', u'tenant_ns_if': u't5ns1if', u'tenant_sub_if': u't5s1if', u'tenant_ns_name': u't5'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t5\" ip link show \"t5ns1if\" ; if [ $? -ne 0 ] ; then ip link set \"t5ns1if\" netns \"t5\" ; fi\nip netns exec \"t5ns1\" ip link show \"t5s1if\" ; if [ $? -ne 0 ] ; then ip link set \"t5s1if\" netns \"t5ns1\" ; fi\n", "delta": "0:00:00.132712", "end": "2019-11-18 11:21:27.988925", "item": [{"bridge_name": "t5br1", "default_route_ip": "10.1.41.1", "dns": [{"brif": "t5s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t5s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t5ns1", "route": [{"if": "p1", "ip": "10.1.41.1/24", "ns_if": "t5if", "ns_name": "t5"}], "subnet_ip": "1.1.1.0/24", "vms": [{"brif": "t5br1if1", "disk": "10G", "mem": 2, "name": "t5_VM1", "vcpu": 4, "vmif": "t5VM1if1"}, {"brif": "t5br1if2", "disk": "10G", "mem": 4, "name": "t5_VM2", "vcpu": 2, "vmif": "t5VM2if1"}], "vxlan": [{"dev": "t5s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.41.2", "remote_ip": "10.2.41.2", "remote_route": "10.2.41.0/24", "subnet_route": "10.1.41.0/24", "tenant_route_ip": "192.168.5.2", "v_name": "vxlan_t5s1"}]}, {"tenant_ns_if": "t5ns1if", "tenant_ns_ip": "10.1.41.1/24", "tenant_ns_name": "t5", "tenant_sub_if": "t5s1if", "tenant_sub_ip": "10.1.41.2/24"}], "rc": 0, "start": "2019-11-18 11:21:27.856213", "stderr": "Device \"t5ns1if\" does not exist.\nDevice \"t5s1if\" does not exist.", "stderr_lines": ["Device \"t5ns1if\" does not exist.", "Device \"t5s1if\" does not exist."], "stdout": "", "stdout_lines": []}
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.42.1/24', u'ns_name': u't5', u'ns_if': u't5if', u'if': u'p1'}], u'default_route_ip': u'10.1.42.1', u'bridge_name': u't5br2', u'dns': [{u'dnsif': u't5s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't5s2_dnsbrif'}], u'ns_name': u't5ns2', u'subnet_ip': u'2.2.2.0/24', u'vms': [{u'mem': 3, u'name': u't5_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't5br2if1', u'vmif': u't5VM3if1'}], u'vxlan': [{u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}, {u'tenant_sub_ip': u'10.1.42.2/24', u'tenant_ns_ip': u'10.1.42.1/24', u'tenant_ns_if': u't5ns2if', u'tenant_sub_if': u't5s2if', u'tenant_ns_name': u't5'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t5\" ip link show \"t5ns2if\" ; if [ $? -ne 0 ] ; then ip link set \"t5ns2if\" netns \"t5\" ; fi\nip netns exec \"t5ns2\" ip link show \"t5s2if\" ; if [ $? -ne 0 ] ; then ip link set \"t5s2if\" netns \"t5ns2\" ; fi\n", "delta": "0:00:00.123221", "end": "2019-11-18 11:21:28.313070", "item": [{"bridge_name": "t5br2", "default_route_ip": "10.1.42.1", "dns": [{"brif": "t5s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t5s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t5ns2", "route": [{"if": "p1", "ip": "10.1.42.1/24", "ns_if": "t5if", "ns_name": "t5"}], "subnet_ip": "2.2.2.0/24", "vms": [{"brif": "t5br2if1", "disk": "10G", "mem": 3, "name": "t5_VM3", "vcpu": 2, "vmif": "t5VM3if1"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, {"tenant_ns_if": "t5ns2if", "tenant_ns_ip": "10.1.42.1/24", "tenant_ns_name": "t5", "tenant_sub_if": "t5s2if", "tenant_sub_ip": "10.1.42.2/24"}], "rc": 0, "start": "2019-11-18 11:21:28.189849", "stderr": "Device \"t5ns2if\" does not exist.\nDevice \"t5s2if\" does not exist.", "stderr_lines": ["Device \"t5ns2if\" does not exist.", "Device \"t5s2if\" does not exist."], "stdout": "", "stdout_lines": []}

TASK [Set Namespace VETH Pairs UP] **************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.41.1/24', u'ns_name': u't5', u'ns_if': u't5if', u'if': u'p1'}], u'default_route_ip': u'10.1.41.1', u'bridge_name': u't5br1', u'dns': [{u'dnsif': u't5s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't5s1_dnsbrif'}], u'ns_name': u't5ns1', u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't5_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't5br1if1', u'vmif': u't5VM1if1'}, {u'mem': 4, u'name': u't5_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't5br1if2', u'vmif': u't5VM2if1'}], u'vxlan': [{u'local_ip': u'10.1.41.2', u'dsport': 4789, u'dev': u't5s1if', u'tenant_route_ip': u'192.168.5.2', u'remote_route': u'10.2.41.0/24', u'subnet_route': u'10.1.41.0/24', u'v_name': u'vxlan_t5s1', u'id': 42, u'remote_ip': u'10.2.41.2'}]}, {u'tenant_sub_ip': u'10.1.41.2/24', u'tenant_ns_ip': u'10.1.41.1/24', u'tenant_ns_if': u't5ns1if', u'tenant_sub_if': u't5s1if', u'tenant_ns_name': u't5'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t5\" ip link set dev \"t5ns1if\" up\nip netns exec \"t5ns1\" ip link set dev \"t5s1if\" up\n", "delta": "0:00:00.075973", "end": "2019-11-18 11:21:28.637387", "item": [{"bridge_name": "t5br1", "default_route_ip": "10.1.41.1", "dns": [{"brif": "t5s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t5s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t5ns1", "route": [{"if": "p1", "ip": "10.1.41.1/24", "ns_if": "t5if", "ns_name": "t5"}], "subnet_ip": "1.1.1.0/24", "vms": [{"brif": "t5br1if1", "disk": "10G", "mem": 2, "name": "t5_VM1", "vcpu": 4, "vmif": "t5VM1if1"}, {"brif": "t5br1if2", "disk": "10G", "mem": 4, "name": "t5_VM2", "vcpu": 2, "vmif": "t5VM2if1"}], "vxlan": [{"dev": "t5s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.41.2", "remote_ip": "10.2.41.2", "remote_route": "10.2.41.0/24", "subnet_route": "10.1.41.0/24", "tenant_route_ip": "192.168.5.2", "v_name": "vxlan_t5s1"}]}, {"tenant_ns_if": "t5ns1if", "tenant_ns_ip": "10.1.41.1/24", "tenant_ns_name": "t5", "tenant_sub_if": "t5s1if", "tenant_sub_ip": "10.1.41.2/24"}], "rc": 0, "start": "2019-11-18 11:21:28.561414", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.42.1/24', u'ns_name': u't5', u'ns_if': u't5if', u'if': u'p1'}], u'default_route_ip': u'10.1.42.1', u'bridge_name': u't5br2', u'dns': [{u'dnsif': u't5s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't5s2_dnsbrif'}], u'ns_name': u't5ns2', u'subnet_ip': u'2.2.2.0/24', u'vms': [{u'mem': 3, u'name': u't5_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't5br2if1', u'vmif': u't5VM3if1'}], u'vxlan': [{u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}, {u'tenant_sub_ip': u'10.1.42.2/24', u'tenant_ns_ip': u'10.1.42.1/24', u'tenant_ns_if': u't5ns2if', u'tenant_sub_if': u't5s2if', u'tenant_ns_name': u't5'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t5\" ip link set dev \"t5ns2if\" up\nip netns exec \"t5ns2\" ip link set dev \"t5s2if\" up\n", "delta": "0:00:00.098517", "end": "2019-11-18 11:21:28.929368", "item": [{"bridge_name": "t5br2", "default_route_ip": "10.1.42.1", "dns": [{"brif": "t5s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t5s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t5ns2", "route": [{"if": "p1", "ip": "10.1.42.1/24", "ns_if": "t5if", "ns_name": "t5"}], "subnet_ip": "2.2.2.0/24", "vms": [{"brif": "t5br2if1", "disk": "10G", "mem": 3, "name": "t5_VM3", "vcpu": 2, "vmif": "t5VM3if1"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, {"tenant_ns_if": "t5ns2if", "tenant_ns_ip": "10.1.42.1/24", "tenant_ns_name": "t5", "tenant_sub_if": "t5s2if", "tenant_sub_ip": "10.1.42.2/24"}], "rc": 0, "start": "2019-11-18 11:21:28.830851", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Add IP addresses to Namespace VETH Pairs] *************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.41.1/24', u'ns_name': u't5', u'ns_if': u't5if', u'if': u'p1'}], u'default_route_ip': u'10.1.41.1', u'bridge_name': u't5br1', u'dns': [{u'dnsif': u't5s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't5s1_dnsbrif'}], u'ns_name': u't5ns1', u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't5_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't5br1if1', u'vmif': u't5VM1if1'}, {u'mem': 4, u'name': u't5_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't5br1if2', u'vmif': u't5VM2if1'}], u'vxlan': [{u'local_ip': u'10.1.41.2', u'dsport': 4789, u'dev': u't5s1if', u'tenant_route_ip': u'192.168.5.2', u'remote_route': u'10.2.41.0/24', u'subnet_route': u'10.1.41.0/24', u'v_name': u'vxlan_t5s1', u'id': 42, u'remote_ip': u'10.2.41.2'}]}, {u'tenant_sub_ip': u'10.1.41.2/24', u'tenant_ns_ip': u'10.1.41.1/24', u'tenant_ns_if': u't5ns1if', u'tenant_sub_if': u't5s1if', u'tenant_ns_name': u't5'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t5ns1\" ip addr show \"t5s1if\" | awk 'FNR==3{ print $2 }' | grep -w '^10.1.41.2/24' ; if [ $? -ne 0 ] ; then ip netns exec \"t5ns1\" ip addr add \"10.1.41.2/24\" dev \"t5s1if\" ; fi\n\nip netns exec \"t5\" ip addr show \"t5ns1if\" | awk 'FNR==3{ print $2 }' | grep -w '^10.1.41.1/24' ; if [ $? -ne 0 ] ; then ip netns exec \"t5\" ip addr add \"10.1.41.1/24\" dev \"t5ns1if\" ; fi\n", "delta": "0:00:00.158567", "end": "2019-11-18 11:21:29.381238", "item": [{"bridge_name": "t5br1", "default_route_ip": "10.1.41.1", "dns": [{"brif": "t5s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t5s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t5ns1", "route": [{"if": "p1", "ip": "10.1.41.1/24", "ns_if": "t5if", "ns_name": "t5"}], "subnet_ip": "1.1.1.0/24", "vms": [{"brif": "t5br1if1", "disk": "10G", "mem": 2, "name": "t5_VM1", "vcpu": 4, "vmif": "t5VM1if1"}, {"brif": "t5br1if2", "disk": "10G", "mem": 4, "name": "t5_VM2", "vcpu": 2, "vmif": "t5VM2if1"}], "vxlan": [{"dev": "t5s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.41.2", "remote_ip": "10.2.41.2", "remote_route": "10.2.41.0/24", "subnet_route": "10.1.41.0/24", "tenant_route_ip": "192.168.5.2", "v_name": "vxlan_t5s1"}]}, {"tenant_ns_if": "t5ns1if", "tenant_ns_ip": "10.1.41.1/24", "tenant_ns_name": "t5", "tenant_sub_if": "t5s1if", "tenant_sub_ip": "10.1.41.2/24"}], "rc": 0, "start": "2019-11-18 11:21:29.222671", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.42.1/24', u'ns_name': u't5', u'ns_if': u't5if', u'if': u'p1'}], u'default_route_ip': u'10.1.42.1', u'bridge_name': u't5br2', u'dns': [{u'dnsif': u't5s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't5s2_dnsbrif'}], u'ns_name': u't5ns2', u'subnet_ip': u'2.2.2.0/24', u'vms': [{u'mem': 3, u'name': u't5_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't5br2if1', u'vmif': u't5VM3if1'}], u'vxlan': [{u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}, {u'tenant_sub_ip': u'10.1.42.2/24', u'tenant_ns_ip': u'10.1.42.1/24', u'tenant_ns_if': u't5ns2if', u'tenant_sub_if': u't5s2if', u'tenant_ns_name': u't5'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t5ns2\" ip addr show \"t5s2if\" | awk 'FNR==3{ print $2 }' | grep -w '^10.1.42.2/24' ; if [ $? -ne 0 ] ; then ip netns exec \"t5ns2\" ip addr add \"10.1.42.2/24\" dev \"t5s2if\" ; fi\n\nip netns exec \"t5\" ip addr show \"t5ns2if\" | awk 'FNR==3{ print $2 }' | grep -w '^10.1.42.1/24' ; if [ $? -ne 0 ] ; then ip netns exec \"t5\" ip addr add \"10.1.42.1/24\" dev \"t5ns2if\" ; fi\n", "delta": "0:00:00.159408", "end": "2019-11-18 11:21:29.765323", "item": [{"bridge_name": "t5br2", "default_route_ip": "10.1.42.1", "dns": [{"brif": "t5s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t5s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t5ns2", "route": [{"if": "p1", "ip": "10.1.42.1/24", "ns_if": "t5if", "ns_name": "t5"}], "subnet_ip": "2.2.2.0/24", "vms": [{"brif": "t5br2if1", "disk": "10G", "mem": 3, "name": "t5_VM3", "vcpu": 2, "vmif": "t5VM3if1"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, {"tenant_ns_if": "t5ns2if", "tenant_ns_ip": "10.1.42.1/24", "tenant_ns_name": "t5", "tenant_sub_if": "t5s2if", "tenant_sub_ip": "10.1.42.2/24"}], "rc": 0, "start": "2019-11-18 11:21:29.605915", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Add IP Route to Tenant] *******************************************************************************************************************************
changed: [localhost] => (item={u'default_route_ip': u'192.168.5.1', u'name': u't5', u'pns_ip': u'192.168.5.1/24', u'tenant_if': u't5if', u'tenant_ip': u'192.168.5.2/24', u'pns_if': u't5pns_if'}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t5\" ip route show default | grep -w '[d]efault via 192.168.5.1' ; if [ $? -ne 0 ] ; then ip netns exec \"t5\" ip route add default via \"192.168.5.1\" ; fi\n", "delta": "0:00:00.078863", "end": "2019-11-18 11:21:30.125382", "item": {"default_route_ip": "192.168.5.1", "name": "t5", "pns_if": "t5pns_if", "pns_ip": "192.168.5.1/24", "tenant_if": "t5if", "tenant_ip": "192.168.5.2/24"}, "rc": 0, "start": "2019-11-18 11:21:30.046519", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Add IP Route to Tenant Subnet] ************************************************************************************************************************
changed: [localhost] => (item={u'route': [{u'ip': u'10.1.41.1/24', u'ns_name': u't5', u'ns_if': u't5if', u'if': u'p1'}], u'default_route_ip': u'10.1.41.1', u'bridge_name': u't5br1', u'dns': [{u'dnsif': u't5s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't5s1_dnsbrif'}], u'ns_name': u't5ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.41.2/24', u'tenant_ns_ip': u'10.1.41.1/24', u'tenant_ns_if': u't5ns1if', u'tenant_ns_name': u't5', u'tenant_sub_if': u't5s1if'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't5_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't5br1if1', u'vmif': u't5VM1if1'}, {u'mem': 4, u'name': u't5_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't5br1if2', u'vmif': u't5VM2if1'}], u'vxlan': [{u'local_ip': u'10.1.41.2', u'tenant_route_ip': u'192.168.5.2', u'dsport': 4789, u'dev': u't5s1if', u'subnet_route': u'10.1.41.0/24', u'remote_route': u'10.2.41.0/24', u'v_name': u'vxlan_t5s1', u'id': 42, u'remote_ip': u'10.2.41.2'}]}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t5ns1\" ip route show default | grep -w '[d]efault via 10.1.41.1' ; if [ $? -ne 0 ] ; then ip netns exec \"t5ns1\" ip route add default via \"10.1.41.1\" ; fi\n", "delta": "0:00:00.072840", "end": "2019-11-18 11:21:30.481311", "item": {"bridge_name": "t5br1", "default_route_ip": "10.1.41.1", "dns": [{"brif": "t5s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t5s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t5ns1", "route": [{"if": "p1", "ip": "10.1.41.1/24", "ns_if": "t5if", "ns_name": "t5"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t5ns1if", "tenant_ns_ip": "10.1.41.1/24", "tenant_ns_name": "t5", "tenant_sub_if": "t5s1if", "tenant_sub_ip": "10.1.41.2/24"}], "vms": [{"brif": "t5br1if1", "disk": "10G", "mem": 2, "name": "t5_VM1", "vcpu": 4, "vmif": "t5VM1if1"}, {"brif": "t5br1if2", "disk": "10G", "mem": 4, "name": "t5_VM2", "vcpu": 2, "vmif": "t5VM2if1"}], "vxlan": [{"dev": "t5s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.41.2", "remote_ip": "10.2.41.2", "remote_route": "10.2.41.0/24", "subnet_route": "10.1.41.0/24", "tenant_route_ip": "192.168.5.2", "v_name": "vxlan_t5s1"}]}, "rc": 0, "start": "2019-11-18 11:21:30.408471", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}
changed: [localhost] => (item={u'route': [{u'ip': u'10.1.42.1/24', u'ns_name': u't5', u'ns_if': u't5if', u'if': u'p1'}], u'default_route_ip': u'10.1.42.1', u'bridge_name': u't5br2', u'dns': [{u'dnsif': u't5s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't5s2_dnsbrif'}], u'ns_name': u't5ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.42.2/24', u'tenant_ns_ip': u'10.1.42.1/24', u'tenant_ns_if': u't5ns2if', u'tenant_ns_name': u't5', u'tenant_sub_if': u't5s2if'}], u'subnet_ip': u'2.2.2.0/24', u'vms': [{u'mem': 3, u'name': u't5_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't5br2if1', u'vmif': u't5VM3if1'}], u'vxlan': [{u'local_ip': [], u'tenant_route_ip': [], u'dsport': [], u'dev': [], u'subnet_route': [], u'remote_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t5ns2\" ip route show default | grep -w '[d]efault via 10.1.42.1' ; if [ $? -ne 0 ] ; then ip netns exec \"t5ns2\" ip route add default via \"10.1.42.1\" ; fi\n", "delta": "0:00:00.083259", "end": "2019-11-18 11:21:30.781212", "item": {"bridge_name": "t5br2", "default_route_ip": "10.1.42.1", "dns": [{"brif": "t5s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t5s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t5ns2", "route": [{"if": "p1", "ip": "10.1.42.1/24", "ns_if": "t5if", "ns_name": "t5"}], "subnet_ip": "2.2.2.0/24", "tenant_ns": [{"tenant_ns_if": "t5ns2if", "tenant_ns_ip": "10.1.42.1/24", "tenant_ns_name": "t5", "tenant_sub_if": "t5s2if", "tenant_sub_ip": "10.1.42.2/24"}], "vms": [{"brif": "t5br2if1", "disk": "10G", "mem": 3, "name": "t5_VM3", "vcpu": 2, "vmif": "t5VM3if1"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, "rc": 0, "start": "2019-11-18 11:21:30.697953", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Create bridge inside namespace] ***********************************************************************************************************************
changed: [localhost] => (item={u'route': [{u'ip': u'10.1.41.1/24', u'ns_name': u't5', u'ns_if': u't5if', u'if': u'p1'}], u'default_route_ip': u'10.1.41.1', u'bridge_name': u't5br1', u'dns': [{u'dnsif': u't5s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't5s1_dnsbrif'}], u'ns_name': u't5ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.41.2/24', u'tenant_ns_ip': u'10.1.41.1/24', u'tenant_ns_if': u't5ns1if', u'tenant_ns_name': u't5', u'tenant_sub_if': u't5s1if'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't5_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't5br1if1', u'vmif': u't5VM1if1'}, {u'mem': 4, u'name': u't5_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't5br1if2', u'vmif': u't5VM2if1'}], u'vxlan': [{u'local_ip': u'10.1.41.2', u'tenant_route_ip': u'192.168.5.2', u'dsport': 4789, u'dev': u't5s1if', u'subnet_route': u'10.1.41.0/24', u'remote_route': u'10.2.41.0/24', u'v_name': u'vxlan_t5s1', u'id': 42, u'remote_ip': u'10.2.41.2'}]}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t5ns1\" brctl show | grep -w '^t5br1'; if [ $? -ne 0 ] ; then ip netns exec \"t5ns1\" brctl addbr \"t5br1\" ; fi\nip netns exec \"t5ns1\" ip link set dev \"t5br1\" up\n", "delta": "0:00:00.118366", "end": "2019-11-18 11:21:31.157390", "item": {"bridge_name": "t5br1", "default_route_ip": "10.1.41.1", "dns": [{"brif": "t5s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t5s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t5ns1", "route": [{"if": "p1", "ip": "10.1.41.1/24", "ns_if": "t5if", "ns_name": "t5"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t5ns1if", "tenant_ns_ip": "10.1.41.1/24", "tenant_ns_name": "t5", "tenant_sub_if": "t5s1if", "tenant_sub_ip": "10.1.41.2/24"}], "vms": [{"brif": "t5br1if1", "disk": "10G", "mem": 2, "name": "t5_VM1", "vcpu": 4, "vmif": "t5VM1if1"}, {"brif": "t5br1if2", "disk": "10G", "mem": 4, "name": "t5_VM2", "vcpu": 2, "vmif": "t5VM2if1"}], "vxlan": [{"dev": "t5s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.41.2", "remote_ip": "10.2.41.2", "remote_route": "10.2.41.0/24", "subnet_route": "10.1.41.0/24", "tenant_route_ip": "192.168.5.2", "v_name": "vxlan_t5s1"}]}, "rc": 0, "start": "2019-11-18 11:21:31.039024", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}
changed: [localhost] => (item={u'route': [{u'ip': u'10.1.42.1/24', u'ns_name': u't5', u'ns_if': u't5if', u'if': u'p1'}], u'default_route_ip': u'10.1.42.1', u'bridge_name': u't5br2', u'dns': [{u'dnsif': u't5s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't5s2_dnsbrif'}], u'ns_name': u't5ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.42.2/24', u'tenant_ns_ip': u'10.1.42.1/24', u'tenant_ns_if': u't5ns2if', u'tenant_ns_name': u't5', u'tenant_sub_if': u't5s2if'}], u'subnet_ip': u'2.2.2.0/24', u'vms': [{u'mem': 3, u'name': u't5_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't5br2if1', u'vmif': u't5VM3if1'}], u'vxlan': [{u'local_ip': [], u'tenant_route_ip': [], u'dsport': [], u'dev': [], u'subnet_route': [], u'remote_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t5ns2\" brctl show | grep -w '^t5br2'; if [ $? -ne 0 ] ; then ip netns exec \"t5ns2\" brctl addbr \"t5br2\" ; fi\nip netns exec \"t5ns2\" ip link set dev \"t5br2\" up\n", "delta": "0:00:00.119845", "end": "2019-11-18 11:21:31.457162", "item": {"bridge_name": "t5br2", "default_route_ip": "10.1.42.1", "dns": [{"brif": "t5s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t5s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t5ns2", "route": [{"if": "p1", "ip": "10.1.42.1/24", "ns_if": "t5if", "ns_name": "t5"}], "subnet_ip": "2.2.2.0/24", "tenant_ns": [{"tenant_ns_if": "t5ns2if", "tenant_ns_ip": "10.1.42.1/24", "tenant_ns_name": "t5", "tenant_sub_if": "t5s2if", "tenant_sub_ip": "10.1.42.2/24"}], "vms": [{"brif": "t5br2if1", "disk": "10G", "mem": 3, "name": "t5_VM3", "vcpu": 2, "vmif": "t5VM3if1"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, "rc": 0, "start": "2019-11-18 11:21:31.337317", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Create DNS VETH Pair] *********************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.41.1/24', u'ns_name': u't5', u'ns_if': u't5if', u'if': u'p1'}], u'default_route_ip': u'10.1.41.1', u'bridge_name': u't5br1', u'ns_name': u't5ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.41.2/24', u'tenant_ns_ip': u'10.1.41.1/24', u'tenant_ns_if': u't5ns1if', u'tenant_sub_if': u't5s1if', u'tenant_ns_name': u't5'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't5_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't5br1if1', u'vmif': u't5VM1if1'}, {u'mem': 4, u'name': u't5_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't5br1if2', u'vmif': u't5VM2if1'}], u'vxlan': [{u'local_ip': u'10.1.41.2', u'dsport': 4789, u'dev': u't5s1if', u'tenant_route_ip': u'192.168.5.2', u'remote_route': u'10.2.41.0/24', u'subnet_route': u'10.1.41.0/24', u'v_name': u'vxlan_t5s1', u'id': 42, u'remote_ip': u'10.2.41.2'}]}, {u'dnsif': u't5s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't5s1_dnsbrif'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t5ns1\" ip link show \"t5s1_dnsbrif\" ; if [ $? -ne 0 ] ; then ip netns exec \"t5ns1\" ip link add \"t5s1_dnsbrif\" type veth peer name \"t5s1_dnsif\" ; fi\nip netns exec \"t5ns1\" ip link set dev \"t5s1_dnsbrif\" up\nip netns exec \"t5ns1\" ip link set dev \"t5s1_dnsif\" up\n", "delta": "0:00:00.169151", "end": "2019-11-18 11:21:31.881281", "item": [{"bridge_name": "t5br1", "default_route_ip": "10.1.41.1", "ns_name": "t5ns1", "route": [{"if": "p1", "ip": "10.1.41.1/24", "ns_if": "t5if", "ns_name": "t5"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t5ns1if", "tenant_ns_ip": "10.1.41.1/24", "tenant_ns_name": "t5", "tenant_sub_if": "t5s1if", "tenant_sub_ip": "10.1.41.2/24"}], "vms": [{"brif": "t5br1if1", "disk": "10G", "mem": 2, "name": "t5_VM1", "vcpu": 4, "vmif": "t5VM1if1"}, {"brif": "t5br1if2", "disk": "10G", "mem": 4, "name": "t5_VM2", "vcpu": 2, "vmif": "t5VM2if1"}], "vxlan": [{"dev": "t5s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.41.2", "remote_ip": "10.2.41.2", "remote_route": "10.2.41.0/24", "subnet_route": "10.1.41.0/24", "tenant_route_ip": "192.168.5.2", "v_name": "vxlan_t5s1"}]}, {"brif": "t5s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t5s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "rc": 0, "start": "2019-11-18 11:21:31.712130", "stderr": "Device \"t5s1_dnsbrif\" does not exist.", "stderr_lines": ["Device \"t5s1_dnsbrif\" does not exist."], "stdout": "", "stdout_lines": []}
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.42.1/24', u'ns_name': u't5', u'ns_if': u't5if', u'if': u'p1'}], u'default_route_ip': u'10.1.42.1', u'bridge_name': u't5br2', u'ns_name': u't5ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.42.2/24', u'tenant_ns_ip': u'10.1.42.1/24', u'tenant_ns_if': u't5ns2if', u'tenant_sub_if': u't5s2if', u'tenant_ns_name': u't5'}], u'subnet_ip': u'2.2.2.0/24', u'vms': [{u'mem': 3, u'name': u't5_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't5br2if1', u'vmif': u't5VM3if1'}], u'vxlan': [{u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}, {u'dnsif': u't5s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't5s2_dnsbrif'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t5ns2\" ip link show \"t5s2_dnsbrif\" ; if [ $? -ne 0 ] ; then ip netns exec \"t5ns2\" ip link add \"t5s2_dnsbrif\" type veth peer name \"t5s2_dnsif\" ; fi\nip netns exec \"t5ns2\" ip link set dev \"t5s2_dnsbrif\" up\nip netns exec \"t5ns2\" ip link set dev \"t5s2_dnsif\" up\n", "delta": "0:00:00.155529", "end": "2019-11-18 11:21:32.245453", "item": [{"bridge_name": "t5br2", "default_route_ip": "10.1.42.1", "ns_name": "t5ns2", "route": [{"if": "p1", "ip": "10.1.42.1/24", "ns_if": "t5if", "ns_name": "t5"}], "subnet_ip": "2.2.2.0/24", "tenant_ns": [{"tenant_ns_if": "t5ns2if", "tenant_ns_ip": "10.1.42.1/24", "tenant_ns_name": "t5", "tenant_sub_if": "t5s2if", "tenant_sub_ip": "10.1.42.2/24"}], "vms": [{"brif": "t5br2if1", "disk": "10G", "mem": 3, "name": "t5_VM3", "vcpu": 2, "vmif": "t5VM3if1"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, {"brif": "t5s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t5s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "rc": 0, "start": "2019-11-18 11:21:32.089924", "stderr": "Device \"t5s2_dnsbrif\" does not exist.", "stderr_lines": ["Device \"t5s2_dnsbrif\" does not exist."], "stdout": "", "stdout_lines": []}

TASK [Attach DNS VETH Pair] *********************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.41.1/24', u'ns_name': u't5', u'ns_if': u't5if', u'if': u'p1'}], u'default_route_ip': u'10.1.41.1', u'bridge_name': u't5br1', u'ns_name': u't5ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.41.2/24', u'tenant_ns_ip': u'10.1.41.1/24', u'tenant_ns_if': u't5ns1if', u'tenant_sub_if': u't5s1if', u'tenant_ns_name': u't5'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't5_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't5br1if1', u'vmif': u't5VM1if1'}, {u'mem': 4, u'name': u't5_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't5br1if2', u'vmif': u't5VM2if1'}], u'vxlan': [{u'local_ip': u'10.1.41.2', u'dsport': 4789, u'dev': u't5s1if', u'tenant_route_ip': u'192.168.5.2', u'remote_route': u'10.2.41.0/24', u'subnet_route': u'10.1.41.0/24', u'v_name': u'vxlan_t5s1', u'id': 42, u'remote_ip': u'10.2.41.2'}]}, {u'dnsif': u't5s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't5s1_dnsbrif'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t5ns1\" brctl show \"t5br1\" | grep -w 't5s1_dnsbrif' ; if [ $? -ne 0 ] ; then ip netns exec \"t5ns1\" brctl addif \"t5br1\" \"t5s1_dnsbrif\" ; fi\n", "delta": "0:00:00.102514", "end": "2019-11-18 11:21:32.605374", "item": [{"bridge_name": "t5br1", "default_route_ip": "10.1.41.1", "ns_name": "t5ns1", "route": [{"if": "p1", "ip": "10.1.41.1/24", "ns_if": "t5if", "ns_name": "t5"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t5ns1if", "tenant_ns_ip": "10.1.41.1/24", "tenant_ns_name": "t5", "tenant_sub_if": "t5s1if", "tenant_sub_ip": "10.1.41.2/24"}], "vms": [{"brif": "t5br1if1", "disk": "10G", "mem": 2, "name": "t5_VM1", "vcpu": 4, "vmif": "t5VM1if1"}, {"brif": "t5br1if2", "disk": "10G", "mem": 4, "name": "t5_VM2", "vcpu": 2, "vmif": "t5VM2if1"}], "vxlan": [{"dev": "t5s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.41.2", "remote_ip": "10.2.41.2", "remote_route": "10.2.41.0/24", "subnet_route": "10.1.41.0/24", "tenant_route_ip": "192.168.5.2", "v_name": "vxlan_t5s1"}]}, {"brif": "t5s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t5s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "rc": 0, "start": "2019-11-18 11:21:32.502860", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.42.1/24', u'ns_name': u't5', u'ns_if': u't5if', u'if': u'p1'}], u'default_route_ip': u'10.1.42.1', u'bridge_name': u't5br2', u'ns_name': u't5ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.42.2/24', u'tenant_ns_ip': u'10.1.42.1/24', u'tenant_ns_if': u't5ns2if', u'tenant_sub_if': u't5s2if', u'tenant_ns_name': u't5'}], u'subnet_ip': u'2.2.2.0/24', u'vms': [{u'mem': 3, u'name': u't5_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't5br2if1', u'vmif': u't5VM3if1'}], u'vxlan': [{u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}, {u'dnsif': u't5s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't5s2_dnsbrif'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t5ns2\" brctl show \"t5br2\" | grep -w 't5s2_dnsbrif' ; if [ $? -ne 0 ] ; then ip netns exec \"t5ns2\" brctl addif \"t5br2\" \"t5s2_dnsbrif\" ; fi\n", "delta": "0:00:00.080301", "end": "2019-11-18 11:21:32.913146", "item": [{"bridge_name": "t5br2", "default_route_ip": "10.1.42.1", "ns_name": "t5ns2", "route": [{"if": "p1", "ip": "10.1.42.1/24", "ns_if": "t5if", "ns_name": "t5"}], "subnet_ip": "2.2.2.0/24", "tenant_ns": [{"tenant_ns_if": "t5ns2if", "tenant_ns_ip": "10.1.42.1/24", "tenant_ns_name": "t5", "tenant_sub_if": "t5s2if", "tenant_sub_ip": "10.1.42.2/24"}], "vms": [{"brif": "t5br2if1", "disk": "10G", "mem": 3, "name": "t5_VM3", "vcpu": 2, "vmif": "t5VM3if1"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, {"brif": "t5s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t5s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "rc": 0, "start": "2019-11-18 11:21:32.832845", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Create VETH Pairs] ************************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.41.1/24', u'ns_name': u't5', u'ns_if': u't5if', u'if': u'p1'}], u'default_route_ip': u'10.1.41.1', u'bridge_name': u't5br1', u'dns': [{u'dnsif': u't5s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't5s1_dnsbrif'}], u'ns_name': u't5ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.41.2/24', u'tenant_ns_ip': u'10.1.41.1/24', u'tenant_ns_if': u't5ns1if', u'tenant_sub_if': u't5s1if', u'tenant_ns_name': u't5'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.1.41.2', u'dsport': 4789, u'dev': u't5s1if', u'tenant_route_ip': u'192.168.5.2', u'remote_route': u'10.2.41.0/24', u'subnet_route': u'10.1.41.0/24', u'v_name': u'vxlan_t5s1', u'id': 42, u'remote_ip': u'10.2.41.2'}]}, {u'mem': 2, u'name': u't5_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't5br1if1', u'vmif': u't5VM1if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip link show \"t5br1if1\" ; if [ $? -ne 0 ] ; then ip link add \"t5VM1if1\" type veth peer name \"t5br1if1\" ; fi\nip link set dev \"t5br1if1\" up\nip link set dev \"t5VM1if1\" up\n", "delta": "0:00:00.015826", "end": "2019-11-18 11:21:33.187081", "item": [{"bridge_name": "t5br1", "default_route_ip": "10.1.41.1", "dns": [{"brif": "t5s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t5s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t5ns1", "route": [{"if": "p1", "ip": "10.1.41.1/24", "ns_if": "t5if", "ns_name": "t5"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t5ns1if", "tenant_ns_ip": "10.1.41.1/24", "tenant_ns_name": "t5", "tenant_sub_if": "t5s1if", "tenant_sub_ip": "10.1.41.2/24"}], "vxlan": [{"dev": "t5s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.41.2", "remote_ip": "10.2.41.2", "remote_route": "10.2.41.0/24", "subnet_route": "10.1.41.0/24", "tenant_route_ip": "192.168.5.2", "v_name": "vxlan_t5s1"}]}, {"brif": "t5br1if1", "disk": "10G", "mem": 2, "name": "t5_VM1", "vcpu": 4, "vmif": "t5VM1if1"}], "rc": 0, "start": "2019-11-18 11:21:33.171255", "stderr": "Device \"t5br1if1\" does not exist.", "stderr_lines": ["Device \"t5br1if1\" does not exist."], "stdout": "", "stdout_lines": []}
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.41.1/24', u'ns_name': u't5', u'ns_if': u't5if', u'if': u'p1'}], u'default_route_ip': u'10.1.41.1', u'bridge_name': u't5br1', u'dns': [{u'dnsif': u't5s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't5s1_dnsbrif'}], u'ns_name': u't5ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.41.2/24', u'tenant_ns_ip': u'10.1.41.1/24', u'tenant_ns_if': u't5ns1if', u'tenant_sub_if': u't5s1if', u'tenant_ns_name': u't5'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.1.41.2', u'dsport': 4789, u'dev': u't5s1if', u'tenant_route_ip': u'192.168.5.2', u'remote_route': u'10.2.41.0/24', u'subnet_route': u'10.1.41.0/24', u'v_name': u'vxlan_t5s1', u'id': 42, u'remote_ip': u'10.2.41.2'}]}, {u'mem': 4, u'name': u't5_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't5br1if2', u'vmif': u't5VM2if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip link show \"t5br1if2\" ; if [ $? -ne 0 ] ; then ip link add \"t5VM2if1\" type veth peer name \"t5br1if2\" ; fi\nip link set dev \"t5br1if2\" up\nip link set dev \"t5VM2if1\" up\n", "delta": "0:00:00.020646", "end": "2019-11-18 11:21:33.433080", "item": [{"bridge_name": "t5br1", "default_route_ip": "10.1.41.1", "dns": [{"brif": "t5s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t5s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t5ns1", "route": [{"if": "p1", "ip": "10.1.41.1/24", "ns_if": "t5if", "ns_name": "t5"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t5ns1if", "tenant_ns_ip": "10.1.41.1/24", "tenant_ns_name": "t5", "tenant_sub_if": "t5s1if", "tenant_sub_ip": "10.1.41.2/24"}], "vxlan": [{"dev": "t5s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.41.2", "remote_ip": "10.2.41.2", "remote_route": "10.2.41.0/24", "subnet_route": "10.1.41.0/24", "tenant_route_ip": "192.168.5.2", "v_name": "vxlan_t5s1"}]}, {"brif": "t5br1if2", "disk": "10G", "mem": 4, "name": "t5_VM2", "vcpu": 2, "vmif": "t5VM2if1"}], "rc": 0, "start": "2019-11-18 11:21:33.412434", "stderr": "Device \"t5br1if2\" does not exist.", "stderr_lines": ["Device \"t5br1if2\" does not exist."], "stdout": "", "stdout_lines": []}
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.42.1/24', u'ns_name': u't5', u'ns_if': u't5if', u'if': u'p1'}], u'default_route_ip': u'10.1.42.1', u'bridge_name': u't5br2', u'dns': [{u'dnsif': u't5s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't5s2_dnsbrif'}], u'ns_name': u't5ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.42.2/24', u'tenant_ns_ip': u'10.1.42.1/24', u'tenant_ns_if': u't5ns2if', u'tenant_sub_if': u't5s2if', u'tenant_ns_name': u't5'}], u'subnet_ip': u'2.2.2.0/24', u'vxlan': [{u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}, {u'mem': 3, u'name': u't5_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't5br2if1', u'vmif': u't5VM3if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip link show \"t5br2if1\" ; if [ $? -ne 0 ] ; then ip link add \"t5VM3if1\" type veth peer name \"t5br2if1\" ; fi\nip link set dev \"t5br2if1\" up\nip link set dev \"t5VM3if1\" up\n", "delta": "0:00:00.016077", "end": "2019-11-18 11:21:33.685101", "item": [{"bridge_name": "t5br2", "default_route_ip": "10.1.42.1", "dns": [{"brif": "t5s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t5s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t5ns2", "route": [{"if": "p1", "ip": "10.1.42.1/24", "ns_if": "t5if", "ns_name": "t5"}], "subnet_ip": "2.2.2.0/24", "tenant_ns": [{"tenant_ns_if": "t5ns2if", "tenant_ns_ip": "10.1.42.1/24", "tenant_ns_name": "t5", "tenant_sub_if": "t5s2if", "tenant_sub_ip": "10.1.42.2/24"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, {"brif": "t5br2if1", "disk": "10G", "mem": 3, "name": "t5_VM3", "vcpu": 2, "vmif": "t5VM3if1"}], "rc": 0, "start": "2019-11-18 11:21:33.669024", "stderr": "Device \"t5br2if1\" does not exist.", "stderr_lines": ["Device \"t5br2if1\" does not exist."], "stdout": "", "stdout_lines": []}

TASK [Attach VETH Pairs] ************************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.41.1/24', u'ns_name': u't5', u'ns_if': u't5if', u'if': u'p1'}], u'default_route_ip': u'10.1.41.1', u'bridge_name': u't5br1', u'dns': [{u'dnsif': u't5s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't5s1_dnsbrif'}], u'ns_name': u't5ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.41.2/24', u'tenant_ns_ip': u'10.1.41.1/24', u'tenant_ns_if': u't5ns1if', u'tenant_sub_if': u't5s1if', u'tenant_ns_name': u't5'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.1.41.2', u'dsport': 4789, u'dev': u't5s1if', u'tenant_route_ip': u'192.168.5.2', u'remote_route': u'10.2.41.0/24', u'subnet_route': u'10.1.41.0/24', u'v_name': u'vxlan_t5s1', u'id': 42, u'remote_ip': u'10.2.41.2'}]}, {u'mem': 2, u'name': u't5_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't5br1if1', u'vmif': u't5VM1if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip link show \"t5br1if1\" ; if [ $? -eq 0 ] ; then ip link set \"t5br1if1\" netns \"t5ns1\" ; fi\nip netns exec \"t5ns1\" brctl show \"t5br1\" | grep -w 't5br1if1' ; if [ $? -ne 0 ] ; then ip netns exec \"t5ns1\" brctl addif \"t5br1\" \"t5br1if1\" ; fi\n", "delta": "0:00:00.109520", "end": "2019-11-18 11:21:34.069407", "item": [{"bridge_name": "t5br1", "default_route_ip": "10.1.41.1", "dns": [{"brif": "t5s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t5s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t5ns1", "route": [{"if": "p1", "ip": "10.1.41.1/24", "ns_if": "t5if", "ns_name": "t5"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t5ns1if", "tenant_ns_ip": "10.1.41.1/24", "tenant_ns_name": "t5", "tenant_sub_if": "t5s1if", "tenant_sub_ip": "10.1.41.2/24"}], "vxlan": [{"dev": "t5s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.41.2", "remote_ip": "10.2.41.2", "remote_route": "10.2.41.0/24", "subnet_route": "10.1.41.0/24", "tenant_route_ip": "192.168.5.2", "v_name": "vxlan_t5s1"}]}, {"brif": "t5br1if1", "disk": "10G", "mem": 2, "name": "t5_VM1", "vcpu": 4, "vmif": "t5VM1if1"}], "rc": 0, "start": "2019-11-18 11:21:33.959887", "stderr": "", "stderr_lines": [], "stdout": "99: t5br1if1@t5VM1if1: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP mode DEFAULT group default qlen 1000\n    link/ether d2:db:1e:3d:49:cd brd ff:ff:ff:ff:ff:ff", "stdout_lines": ["99: t5br1if1@t5VM1if1: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP mode DEFAULT group default qlen 1000", "    link/ether d2:db:1e:3d:49:cd brd ff:ff:ff:ff:ff:ff"]}
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.41.1/24', u'ns_name': u't5', u'ns_if': u't5if', u'if': u'p1'}], u'default_route_ip': u'10.1.41.1', u'bridge_name': u't5br1', u'dns': [{u'dnsif': u't5s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't5s1_dnsbrif'}], u'ns_name': u't5ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.41.2/24', u'tenant_ns_ip': u'10.1.41.1/24', u'tenant_ns_if': u't5ns1if', u'tenant_sub_if': u't5s1if', u'tenant_ns_name': u't5'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.1.41.2', u'dsport': 4789, u'dev': u't5s1if', u'tenant_route_ip': u'192.168.5.2', u'remote_route': u'10.2.41.0/24', u'subnet_route': u'10.1.41.0/24', u'v_name': u'vxlan_t5s1', u'id': 42, u'remote_ip': u'10.2.41.2'}]}, {u'mem': 4, u'name': u't5_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't5br1if2', u'vmif': u't5VM2if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip link show \"t5br1if2\" ; if [ $? -eq 0 ] ; then ip link set \"t5br1if2\" netns \"t5ns1\" ; fi\nip netns exec \"t5ns1\" brctl show \"t5br1\" | grep -w 't5br1if2' ; if [ $? -ne 0 ] ; then ip netns exec \"t5ns1\" brctl addif \"t5br1\" \"t5br1if2\" ; fi\n", "delta": "0:00:00.135920", "end": "2019-11-18 11:21:34.409531", "item": [{"bridge_name": "t5br1", "default_route_ip": "10.1.41.1", "dns": [{"brif": "t5s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t5s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t5ns1", "route": [{"if": "p1", "ip": "10.1.41.1/24", "ns_if": "t5if", "ns_name": "t5"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t5ns1if", "tenant_ns_ip": "10.1.41.1/24", "tenant_ns_name": "t5", "tenant_sub_if": "t5s1if", "tenant_sub_ip": "10.1.41.2/24"}], "vxlan": [{"dev": "t5s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.41.2", "remote_ip": "10.2.41.2", "remote_route": "10.2.41.0/24", "subnet_route": "10.1.41.0/24", "tenant_route_ip": "192.168.5.2", "v_name": "vxlan_t5s1"}]}, {"brif": "t5br1if2", "disk": "10G", "mem": 4, "name": "t5_VM2", "vcpu": 2, "vmif": "t5VM2if1"}], "rc": 0, "start": "2019-11-18 11:21:34.273611", "stderr": "", "stderr_lines": [], "stdout": "101: t5br1if2@t5VM2if1: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP mode DEFAULT group default qlen 1000\n    link/ether 7a:9f:21:aa:5b:36 brd ff:ff:ff:ff:ff:ff", "stdout_lines": ["101: t5br1if2@t5VM2if1: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP mode DEFAULT group default qlen 1000", "    link/ether 7a:9f:21:aa:5b:36 brd ff:ff:ff:ff:ff:ff"]}
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.42.1/24', u'ns_name': u't5', u'ns_if': u't5if', u'if': u'p1'}], u'default_route_ip': u'10.1.42.1', u'bridge_name': u't5br2', u'dns': [{u'dnsif': u't5s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't5s2_dnsbrif'}], u'ns_name': u't5ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.42.2/24', u'tenant_ns_ip': u'10.1.42.1/24', u'tenant_ns_if': u't5ns2if', u'tenant_sub_if': u't5s2if', u'tenant_ns_name': u't5'}], u'subnet_ip': u'2.2.2.0/24', u'vxlan': [{u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}, {u'mem': 3, u'name': u't5_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't5br2if1', u'vmif': u't5VM3if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip link show \"t5br2if1\" ; if [ $? -eq 0 ] ; then ip link set \"t5br2if1\" netns \"t5ns2\" ; fi\nip netns exec \"t5ns2\" brctl show \"t5br2\" | grep -w 't5br2if1' ; if [ $? -ne 0 ] ; then ip netns exec \"t5ns2\" brctl addif \"t5br2\" \"t5br2if1\" ; fi\n", "delta": "0:00:00.108403", "end": "2019-11-18 11:21:34.729374", "item": [{"bridge_name": "t5br2", "default_route_ip": "10.1.42.1", "dns": [{"brif": "t5s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t5s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t5ns2", "route": [{"if": "p1", "ip": "10.1.42.1/24", "ns_if": "t5if", "ns_name": "t5"}], "subnet_ip": "2.2.2.0/24", "tenant_ns": [{"tenant_ns_if": "t5ns2if", "tenant_ns_ip": "10.1.42.1/24", "tenant_ns_name": "t5", "tenant_sub_if": "t5s2if", "tenant_sub_ip": "10.1.42.2/24"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, {"brif": "t5br2if1", "disk": "10G", "mem": 3, "name": "t5_VM3", "vcpu": 2, "vmif": "t5VM3if1"}], "rc": 0, "start": "2019-11-18 11:21:34.620971", "stderr": "", "stderr_lines": [], "stdout": "103: t5br2if1@t5VM3if1: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP mode DEFAULT group default qlen 1000\n    link/ether f6:37:76:b6:53:9e brd ff:ff:ff:ff:ff:ff", "stdout_lines": ["103: t5br2if1@t5VM3if1: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP mode DEFAULT group default qlen 1000", "    link/ether f6:37:76:b6:53:9e brd ff:ff:ff:ff:ff:ff"]}

TASK [All interfaces and bridges UP] ************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.41.1/24', u'ns_name': u't5', u'ns_if': u't5if', u'if': u'p1'}], u'default_route_ip': u'10.1.41.1', u'bridge_name': u't5br1', u'dns': [{u'dnsif': u't5s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't5s1_dnsbrif'}], u'ns_name': u't5ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.41.2/24', u'tenant_ns_ip': u'10.1.41.1/24', u'tenant_ns_if': u't5ns1if', u'tenant_sub_if': u't5s1if', u'tenant_ns_name': u't5'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.1.41.2', u'dsport': 4789, u'dev': u't5s1if', u'tenant_route_ip': u'192.168.5.2', u'remote_route': u'10.2.41.0/24', u'subnet_route': u'10.1.41.0/24', u'v_name': u'vxlan_t5s1', u'id': 42, u'remote_ip': u'10.2.41.2'}]}, {u'mem': 2, u'name': u't5_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't5br1if1', u'vmif': u't5VM1if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t5ns1\" ip link set \"t5br1if1\" up\nip netns exec \"t5ns1\" ip link set dev \"t5br1\" up\n", "delta": "0:00:00.076516", "end": "2019-11-18 11:21:35.129489", "item": [{"bridge_name": "t5br1", "default_route_ip": "10.1.41.1", "dns": [{"brif": "t5s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t5s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t5ns1", "route": [{"if": "p1", "ip": "10.1.41.1/24", "ns_if": "t5if", "ns_name": "t5"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t5ns1if", "tenant_ns_ip": "10.1.41.1/24", "tenant_ns_name": "t5", "tenant_sub_if": "t5s1if", "tenant_sub_ip": "10.1.41.2/24"}], "vxlan": [{"dev": "t5s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.41.2", "remote_ip": "10.2.41.2", "remote_route": "10.2.41.0/24", "subnet_route": "10.1.41.0/24", "tenant_route_ip": "192.168.5.2", "v_name": "vxlan_t5s1"}]}, {"brif": "t5br1if1", "disk": "10G", "mem": 2, "name": "t5_VM1", "vcpu": 4, "vmif": "t5VM1if1"}], "rc": 0, "start": "2019-11-18 11:21:35.052973", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.41.1/24', u'ns_name': u't5', u'ns_if': u't5if', u'if': u'p1'}], u'default_route_ip': u'10.1.41.1', u'bridge_name': u't5br1', u'dns': [{u'dnsif': u't5s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't5s1_dnsbrif'}], u'ns_name': u't5ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.41.2/24', u'tenant_ns_ip': u'10.1.41.1/24', u'tenant_ns_if': u't5ns1if', u'tenant_sub_if': u't5s1if', u'tenant_ns_name': u't5'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.1.41.2', u'dsport': 4789, u'dev': u't5s1if', u'tenant_route_ip': u'192.168.5.2', u'remote_route': u'10.2.41.0/24', u'subnet_route': u'10.1.41.0/24', u'v_name': u'vxlan_t5s1', u'id': 42, u'remote_ip': u'10.2.41.2'}]}, {u'mem': 4, u'name': u't5_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't5br1if2', u'vmif': u't5VM2if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t5ns1\" ip link set \"t5br1if2\" up\nip netns exec \"t5ns1\" ip link set dev \"t5br1\" up\n", "delta": "0:00:00.071290", "end": "2019-11-18 11:21:35.425582", "item": [{"bridge_name": "t5br1", "default_route_ip": "10.1.41.1", "dns": [{"brif": "t5s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t5s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t5ns1", "route": [{"if": "p1", "ip": "10.1.41.1/24", "ns_if": "t5if", "ns_name": "t5"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t5ns1if", "tenant_ns_ip": "10.1.41.1/24", "tenant_ns_name": "t5", "tenant_sub_if": "t5s1if", "tenant_sub_ip": "10.1.41.2/24"}], "vxlan": [{"dev": "t5s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.41.2", "remote_ip": "10.2.41.2", "remote_route": "10.2.41.0/24", "subnet_route": "10.1.41.0/24", "tenant_route_ip": "192.168.5.2", "v_name": "vxlan_t5s1"}]}, {"brif": "t5br1if2", "disk": "10G", "mem": 4, "name": "t5_VM2", "vcpu": 2, "vmif": "t5VM2if1"}], "rc": 0, "start": "2019-11-18 11:21:35.354292", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.42.1/24', u'ns_name': u't5', u'ns_if': u't5if', u'if': u'p1'}], u'default_route_ip': u'10.1.42.1', u'bridge_name': u't5br2', u'dns': [{u'dnsif': u't5s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't5s2_dnsbrif'}], u'ns_name': u't5ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.42.2/24', u'tenant_ns_ip': u'10.1.42.1/24', u'tenant_ns_if': u't5ns2if', u'tenant_sub_if': u't5s2if', u'tenant_ns_name': u't5'}], u'subnet_ip': u'2.2.2.0/24', u'vxlan': [{u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}, {u'mem': 3, u'name': u't5_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't5br2if1', u'vmif': u't5VM3if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t5ns2\" ip link set \"t5br2if1\" up\nip netns exec \"t5ns2\" ip link set dev \"t5br2\" up\n", "delta": "0:00:00.073220", "end": "2019-11-18 11:21:35.729527", "item": [{"bridge_name": "t5br2", "default_route_ip": "10.1.42.1", "dns": [{"brif": "t5s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t5s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t5ns2", "route": [{"if": "p1", "ip": "10.1.42.1/24", "ns_if": "t5if", "ns_name": "t5"}], "subnet_ip": "2.2.2.0/24", "tenant_ns": [{"tenant_ns_if": "t5ns2if", "tenant_ns_ip": "10.1.42.1/24", "tenant_ns_name": "t5", "tenant_sub_if": "t5s2if", "tenant_sub_ip": "10.1.42.2/24"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, {"brif": "t5br2if1", "disk": "10G", "mem": 3, "name": "t5_VM3", "vcpu": 2, "vmif": "t5VM3if1"}], "rc": 0, "start": "2019-11-18 11:21:35.656307", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Add IP to DNS Interface] ******************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.41.1/24', u'ns_name': u't5', u'ns_if': u't5if', u'if': u'p1'}], u'default_route_ip': u'10.1.41.1', u'bridge_name': u't5br1', u'ns_name': u't5ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.41.2/24', u'tenant_ns_ip': u'10.1.41.1/24', u'tenant_ns_if': u't5ns1if', u'tenant_sub_if': u't5s1if', u'tenant_ns_name': u't5'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't5_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't5br1if1', u'vmif': u't5VM1if1'}, {u'mem': 4, u'name': u't5_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't5br1if2', u'vmif': u't5VM2if1'}], u'vxlan': [{u'local_ip': u'10.1.41.2', u'dsport': 4789, u'dev': u't5s1if', u'tenant_route_ip': u'192.168.5.2', u'remote_route': u'10.2.41.0/24', u'subnet_route': u'10.1.41.0/24', u'v_name': u'vxlan_t5s1', u'id': 42, u'remote_ip': u'10.2.41.2'}]}, {u'dnsif': u't5s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't5s1_dnsbrif'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t5ns1\" ip addr show \"t5s1_dnsif\" | awk 'FNR==3{ print $2 }' | grep -w '^1.1.1.1/24' ; if [ $? -ne 0 ] ; then ip netns exec \"t5ns1\" ip addr add \"1.1.1.1/24\" dev \"t5s1_dnsif\" ; fi\n", "delta": "0:00:00.073519", "end": "2019-11-18 11:21:36.109320", "item": [{"bridge_name": "t5br1", "default_route_ip": "10.1.41.1", "ns_name": "t5ns1", "route": [{"if": "p1", "ip": "10.1.41.1/24", "ns_if": "t5if", "ns_name": "t5"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t5ns1if", "tenant_ns_ip": "10.1.41.1/24", "tenant_ns_name": "t5", "tenant_sub_if": "t5s1if", "tenant_sub_ip": "10.1.41.2/24"}], "vms": [{"brif": "t5br1if1", "disk": "10G", "mem": 2, "name": "t5_VM1", "vcpu": 4, "vmif": "t5VM1if1"}, {"brif": "t5br1if2", "disk": "10G", "mem": 4, "name": "t5_VM2", "vcpu": 2, "vmif": "t5VM2if1"}], "vxlan": [{"dev": "t5s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.41.2", "remote_ip": "10.2.41.2", "remote_route": "10.2.41.0/24", "subnet_route": "10.1.41.0/24", "tenant_route_ip": "192.168.5.2", "v_name": "vxlan_t5s1"}]}, {"brif": "t5s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t5s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "rc": 0, "start": "2019-11-18 11:21:36.035801", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.42.1/24', u'ns_name': u't5', u'ns_if': u't5if', u'if': u'p1'}], u'default_route_ip': u'10.1.42.1', u'bridge_name': u't5br2', u'ns_name': u't5ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.42.2/24', u'tenant_ns_ip': u'10.1.42.1/24', u'tenant_ns_if': u't5ns2if', u'tenant_sub_if': u't5s2if', u'tenant_ns_name': u't5'}], u'subnet_ip': u'2.2.2.0/24', u'vms': [{u'mem': 3, u'name': u't5_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't5br2if1', u'vmif': u't5VM3if1'}], u'vxlan': [{u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}, {u'dnsif': u't5s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't5s2_dnsbrif'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t5ns2\" ip addr show \"t5s2_dnsif\" | awk 'FNR==3{ print $2 }' | grep -w '^2.2.2.1/24' ; if [ $? -ne 0 ] ; then ip netns exec \"t5ns2\" ip addr add \"2.2.2.1/24\" dev \"t5s2_dnsif\" ; fi\n", "delta": "0:00:00.080425", "end": "2019-11-18 11:21:36.429348", "item": [{"bridge_name": "t5br2", "default_route_ip": "10.1.42.1", "ns_name": "t5ns2", "route": [{"if": "p1", "ip": "10.1.42.1/24", "ns_if": "t5if", "ns_name": "t5"}], "subnet_ip": "2.2.2.0/24", "tenant_ns": [{"tenant_ns_if": "t5ns2if", "tenant_ns_ip": "10.1.42.1/24", "tenant_ns_name": "t5", "tenant_sub_if": "t5s2if", "tenant_sub_ip": "10.1.42.2/24"}], "vms": [{"brif": "t5br2if1", "disk": "10G", "mem": 3, "name": "t5_VM3", "vcpu": 2, "vmif": "t5VM3if1"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, {"brif": "t5s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t5s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "rc": 0, "start": "2019-11-18 11:21:36.348923", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Install DHCP Server] **********************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.41.1/24', u'ns_name': u't5', u'ns_if': u't5if', u'if': u'p1'}], u'default_route_ip': u'10.1.41.1', u'bridge_name': u't5br1', u'ns_name': u't5ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.41.2/24', u'tenant_ns_ip': u'10.1.41.1/24', u'tenant_ns_if': u't5ns1if', u'tenant_sub_if': u't5s1if', u'tenant_ns_name': u't5'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't5_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't5br1if1', u'vmif': u't5VM1if1'}, {u'mem': 4, u'name': u't5_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't5br1if2', u'vmif': u't5VM2if1'}], u'vxlan': [{u'local_ip': u'10.1.41.2', u'dsport': 4789, u'dev': u't5s1if', u'tenant_route_ip': u'192.168.5.2', u'remote_route': u'10.2.41.0/24', u'subnet_route': u'10.1.41.0/24', u'v_name': u'vxlan_t5s1', u'id': 42, u'remote_ip': u'10.2.41.2'}]}, {u'dnsif': u't5s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't5s1_dnsbrif'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t5ns1\" ps aux | grep -w '[d]nsmasq --interface t5s1_dnsif -z --dhcp-range=1.1.1.5,1.1.1.126' ; if [ $? -ne 0 ] ; then ip netns exec \"t5ns1\" dnsmasq --interface \"t5s1_dnsif\" -z --dhcp-range=1.1.1.5,'1.1.1.126' ; fi\n", "delta": "0:00:00.075193", "end": "2019-11-18 11:21:36.806215", "item": [{"bridge_name": "t5br1", "default_route_ip": "10.1.41.1", "ns_name": "t5ns1", "route": [{"if": "p1", "ip": "10.1.41.1/24", "ns_if": "t5if", "ns_name": "t5"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t5ns1if", "tenant_ns_ip": "10.1.41.1/24", "tenant_ns_name": "t5", "tenant_sub_if": "t5s1if", "tenant_sub_ip": "10.1.41.2/24"}], "vms": [{"brif": "t5br1if1", "disk": "10G", "mem": 2, "name": "t5_VM1", "vcpu": 4, "vmif": "t5VM1if1"}, {"brif": "t5br1if2", "disk": "10G", "mem": 4, "name": "t5_VM2", "vcpu": 2, "vmif": "t5VM2if1"}], "vxlan": [{"dev": "t5s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.41.2", "remote_ip": "10.2.41.2", "remote_route": "10.2.41.0/24", "subnet_route": "10.1.41.0/24", "tenant_route_ip": "192.168.5.2", "v_name": "vxlan_t5s1"}]}, {"brif": "t5s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t5s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "rc": 0, "start": "2019-11-18 11:21:36.731022", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.42.1/24', u'ns_name': u't5', u'ns_if': u't5if', u'if': u'p1'}], u'default_route_ip': u'10.1.42.1', u'bridge_name': u't5br2', u'ns_name': u't5ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.42.2/24', u'tenant_ns_ip': u'10.1.42.1/24', u'tenant_ns_if': u't5ns2if', u'tenant_sub_if': u't5s2if', u'tenant_ns_name': u't5'}], u'subnet_ip': u'2.2.2.0/24', u'vms': [{u'mem': 3, u'name': u't5_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't5br2if1', u'vmif': u't5VM3if1'}], u'vxlan': [{u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}, {u'dnsif': u't5s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't5s2_dnsbrif'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t5ns2\" ps aux | grep -w '[d]nsmasq --interface t5s2_dnsif -z --dhcp-range=2.2.2.5,2.2.2.254' ; if [ $? -ne 0 ] ; then ip netns exec \"t5ns2\" dnsmasq --interface \"t5s2_dnsif\" -z --dhcp-range=2.2.2.5,'2.2.2.254' ; fi\n", "delta": "0:00:00.073481", "end": "2019-11-18 11:21:37.074049", "item": [{"bridge_name": "t5br2", "default_route_ip": "10.1.42.1", "ns_name": "t5ns2", "route": [{"if": "p1", "ip": "10.1.42.1/24", "ns_if": "t5if", "ns_name": "t5"}], "subnet_ip": "2.2.2.0/24", "tenant_ns": [{"tenant_ns_if": "t5ns2if", "tenant_ns_ip": "10.1.42.1/24", "tenant_ns_name": "t5", "tenant_sub_if": "t5s2if", "tenant_sub_ip": "10.1.42.2/24"}], "vms": [{"brif": "t5br2if1", "disk": "10G", "mem": 3, "name": "t5_VM3", "vcpu": 2, "vmif": "t5VM3if1"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, {"brif": "t5s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t5s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "rc": 0, "start": "2019-11-18 11:21:37.000568", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Create VXLAN devices] *********************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.41.1/24', u'ns_name': u't5', u'ns_if': u't5if', u'if': u'p1'}], u'default_route_ip': u'10.1.41.1', u'bridge_name': u't5br1', u'dns': [{u'dnsif': u't5s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't5s1_dnsbrif'}], u'ns_name': u't5ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.41.2/24', u'tenant_ns_ip': u'10.1.41.1/24', u'tenant_ns_if': u't5ns1if', u'tenant_sub_if': u't5s1if', u'tenant_ns_name': u't5'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't5_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't5br1if1', u'vmif': u't5VM1if1'}, {u'mem': 4, u'name': u't5_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't5br1if2', u'vmif': u't5VM2if1'}]}, {u'local_ip': u'10.1.41.2', u'dsport': 4789, u'dev': u't5s1if', u'tenant_route_ip': u'192.168.5.2', u'remote_route': u'10.2.41.0/24', u'subnet_route': u'10.1.41.0/24', u'v_name': u'vxlan_t5s1', u'id': 42, u'remote_ip': u'10.2.41.2'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t5ns1\" ip link show \"vxlan_t5s1\" ; if [ $? -ne 0 ] ; then ip netns exec \"t5ns1\" ip link add \"vxlan_t5s1\" type vxlan id \"42\" local \"10.1.41.2\" remote \"10.2.41.2\" dstport \"4789\" dev \"t5s1if\"; ip netns exec \"t5ns1\" ip link set dev \"vxlan_t5s1\" up ; fi\n", "delta": "0:00:00.107223", "end": "2019-11-18 11:21:37.441193", "item": [{"bridge_name": "t5br1", "default_route_ip": "10.1.41.1", "dns": [{"brif": "t5s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t5s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t5ns1", "route": [{"if": "p1", "ip": "10.1.41.1/24", "ns_if": "t5if", "ns_name": "t5"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t5ns1if", "tenant_ns_ip": "10.1.41.1/24", "tenant_ns_name": "t5", "tenant_sub_if": "t5s1if", "tenant_sub_ip": "10.1.41.2/24"}], "vms": [{"brif": "t5br1if1", "disk": "10G", "mem": 2, "name": "t5_VM1", "vcpu": 4, "vmif": "t5VM1if1"}, {"brif": "t5br1if2", "disk": "10G", "mem": 4, "name": "t5_VM2", "vcpu": 2, "vmif": "t5VM2if1"}]}, {"dev": "t5s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.41.2", "remote_ip": "10.2.41.2", "remote_route": "10.2.41.0/24", "subnet_route": "10.1.41.0/24", "tenant_route_ip": "192.168.5.2", "v_name": "vxlan_t5s1"}], "rc": 0, "start": "2019-11-18 11:21:37.333970", "stderr": "Device \"vxlan_t5s1\" does not exist.", "stderr_lines": ["Device \"vxlan_t5s1\" does not exist."], "stdout": "", "stdout_lines": []}
skipping: [localhost] => (item=[{u'route': [{u'ip': u'10.1.42.1/24', u'ns_name': u't5', u'ns_if': u't5if', u'if': u'p1'}], u'default_route_ip': u'10.1.42.1', u'bridge_name': u't5br2', u'dns': [{u'dnsif': u't5s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't5s2_dnsbrif'}], u'ns_name': u't5ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.42.2/24', u'tenant_ns_ip': u'10.1.42.1/24', u'tenant_ns_if': u't5ns2if', u'tenant_sub_if': u't5s2if', u'tenant_ns_name': u't5'}], u'subnet_ip': u'2.2.2.0/24', u'vms': [{u'mem': 3, u'name': u't5_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't5br2if1', u'vmif': u't5VM3if1'}]}, {u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}])  => {"ansible_loop_var": "item", "changed": false, "item": [{"bridge_name": "t5br2", "default_route_ip": "10.1.42.1", "dns": [{"brif": "t5s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t5s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t5ns2", "route": [{"if": "p1", "ip": "10.1.42.1/24", "ns_if": "t5if", "ns_name": "t5"}], "subnet_ip": "2.2.2.0/24", "tenant_ns": [{"tenant_ns_if": "t5ns2if", "tenant_ns_ip": "10.1.42.1/24", "tenant_ns_name": "t5", "tenant_sub_if": "t5s2if", "tenant_sub_ip": "10.1.42.2/24"}], "vms": [{"brif": "t5br2if1", "disk": "10G", "mem": 3, "name": "t5_VM3", "vcpu": 2, "vmif": "t5VM3if1"}]}, {"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}], "skip_reason": "Conditional result was False"}

TASK [Attach VXLANs to bridge] ******************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.41.1/24', u'ns_name': u't5', u'ns_if': u't5if', u'if': u'p1'}], u'default_route_ip': u'10.1.41.1', u'bridge_name': u't5br1', u'dns': [{u'dnsif': u't5s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't5s1_dnsbrif'}], u'ns_name': u't5ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.41.2/24', u'tenant_ns_ip': u'10.1.41.1/24', u'tenant_ns_if': u't5ns1if', u'tenant_sub_if': u't5s1if', u'tenant_ns_name': u't5'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't5_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't5br1if1', u'vmif': u't5VM1if1'}, {u'mem': 4, u'name': u't5_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't5br1if2', u'vmif': u't5VM2if1'}]}, {u'local_ip': u'10.1.41.2', u'dsport': 4789, u'dev': u't5s1if', u'tenant_route_ip': u'192.168.5.2', u'remote_route': u'10.2.41.0/24', u'subnet_route': u'10.1.41.0/24', u'v_name': u'vxlan_t5s1', u'id': 42, u'remote_ip': u'10.2.41.2'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t5ns1\" brctl show \"t5br1\" | grep -w 'vxlan_t5s1' ; if [ $? -ne 0 ] ; then ip netns exec \"t5ns1\" brctl addif \"t5br1\" \"vxlan_t5s1\" ; fi\n", "delta": "0:00:00.069963", "end": "2019-11-18 11:21:37.789271", "item": [{"bridge_name": "t5br1", "default_route_ip": "10.1.41.1", "dns": [{"brif": "t5s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t5s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t5ns1", "route": [{"if": "p1", "ip": "10.1.41.1/24", "ns_if": "t5if", "ns_name": "t5"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t5ns1if", "tenant_ns_ip": "10.1.41.1/24", "tenant_ns_name": "t5", "tenant_sub_if": "t5s1if", "tenant_sub_ip": "10.1.41.2/24"}], "vms": [{"brif": "t5br1if1", "disk": "10G", "mem": 2, "name": "t5_VM1", "vcpu": 4, "vmif": "t5VM1if1"}, {"brif": "t5br1if2", "disk": "10G", "mem": 4, "name": "t5_VM2", "vcpu": 2, "vmif": "t5VM2if1"}]}, {"dev": "t5s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.41.2", "remote_ip": "10.2.41.2", "remote_route": "10.2.41.0/24", "subnet_route": "10.1.41.0/24", "tenant_route_ip": "192.168.5.2", "v_name": "vxlan_t5s1"}], "rc": 0, "start": "2019-11-18 11:21:37.719308", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}
skipping: [localhost] => (item=[{u'route': [{u'ip': u'10.1.42.1/24', u'ns_name': u't5', u'ns_if': u't5if', u'if': u'p1'}], u'default_route_ip': u'10.1.42.1', u'bridge_name': u't5br2', u'dns': [{u'dnsif': u't5s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't5s2_dnsbrif'}], u'ns_name': u't5ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.42.2/24', u'tenant_ns_ip': u'10.1.42.1/24', u'tenant_ns_if': u't5ns2if', u'tenant_sub_if': u't5s2if', u'tenant_ns_name': u't5'}], u'subnet_ip': u'2.2.2.0/24', u'vms': [{u'mem': 3, u'name': u't5_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't5br2if1', u'vmif': u't5VM3if1'}]}, {u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}])  => {"ansible_loop_var": "item", "changed": false, "item": [{"bridge_name": "t5br2", "default_route_ip": "10.1.42.1", "dns": [{"brif": "t5s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t5s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t5ns2", "route": [{"if": "p1", "ip": "10.1.42.1/24", "ns_if": "t5if", "ns_name": "t5"}], "subnet_ip": "2.2.2.0/24", "tenant_ns": [{"tenant_ns_if": "t5ns2if", "tenant_ns_ip": "10.1.42.1/24", "tenant_ns_name": "t5", "tenant_sub_if": "t5s2if", "tenant_sub_ip": "10.1.42.2/24"}], "vms": [{"brif": "t5br2if1", "disk": "10G", "mem": 3, "name": "t5_VM3", "vcpu": 2, "vmif": "t5VM3if1"}]}, {"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}], "skip_reason": "Conditional result was False"}

PLAY RECAP **************************************************************************************************************************************************
localhost                  : ok=21   changed=21   unreachable=0    failed=0    skipped=0    rescued=0    ignored=0   

Using /etc/ansible/ansible.cfg as config file

PLAY [worker] ***********************************************************************************************************************************************

TASK [Create Tenant Namespace] ******************************************************************************************************************************
changed: [99.99.99.2] => (item={u'default_route_ip': u'192.168.133.1', u'name': u't5', u'pns_ip': u'192.168.133.1/24', u'tenant_if': u't5if', u'tenant_ip': u'192.168.133.2/24', u'pns_if': u't5pns_if'}) => {"ansible_loop_var": "item", "changed": true, "cmd": ["ip", "netns", "add", "t5"], "delta": "0:00:00.150648", "end": "2019-11-18 11:21:39.797726", "item": {"default_route_ip": "192.168.133.1", "name": "t5", "pns_if": "t5pns_if", "pns_ip": "192.168.133.1/24", "tenant_if": "t5if", "tenant_ip": "192.168.133.2/24"}, "rc": 0, "start": "2019-11-18 11:21:39.647078", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Create Subnet Namespace] ******************************************************************************************************************************
changed: [99.99.99.2] => (item={u'route': [{u'ip': u'10.2.41.1/24', u'ns_name': u't5', u'ns_if': u't5if', u'if': u'p1'}], u'default_route_ip': u'10.2.41.1', u'bridge_name': u't5br1', u'dns': [{u'dnsif': u't5s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't5s1_dnsbrif'}], u'ns_name': u't5ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.41.2/24', u'tenant_ns_ip': u'10.2.41.1/24', u'tenant_ns_if': u't5ns1if', u'tenant_ns_name': u't5', u'tenant_sub_if': u't5s1if'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't5_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't5br1if1', u'vmif': u't5VM4if1'}], u'vxlan': [{u'local_ip': u'10.2.41.2', u'tenant_route_ip': u'192.168.133.2', u'dsport': 4789, u'dev': u't5s1if', u'subnet_route': u'10.2.41.0/24', u'remote_route': u'10.1.41.0/24', u'v_name': u'vxlan_t5s1', u'id': 42, u'remote_ip': u'10.1.41.2'}]}) => {"ansible_loop_var": "item", "changed": true, "cmd": ["ip", "netns", "add", "t5ns1"], "delta": "0:00:00.061866", "end": "2019-11-18 11:21:40.239934", "item": {"bridge_name": "t5br1", "default_route_ip": "10.2.41.1", "dns": [{"brif": "t5s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t5s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "ns_name": "t5ns1", "route": [{"if": "p1", "ip": "10.2.41.1/24", "ns_if": "t5if", "ns_name": "t5"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t5ns1if", "tenant_ns_ip": "10.2.41.1/24", "tenant_ns_name": "t5", "tenant_sub_if": "t5s1if", "tenant_sub_ip": "10.2.41.2/24"}], "vms": [{"brif": "t5br1if1", "disk": "10G", "mem": 2, "name": "t5_VM4", "vcpu": 4, "vmif": "t5VM4if1"}], "vxlan": [{"dev": "t5s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.41.2", "remote_ip": "10.1.41.2", "remote_route": "10.1.41.0/24", "subnet_route": "10.2.41.0/24", "tenant_route_ip": "192.168.133.2", "v_name": "vxlan_t5s1"}]}, "rc": 0, "start": "2019-11-18 11:21:40.178068", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Create Tenant VETH pairs] *****************************************************************************************************************************
changed: [99.99.99.2] => (item={u'default_route_ip': u'192.168.133.1', u'name': u't5', u'pns_ip': u'192.168.133.1/24', u'tenant_if': u't5if', u'tenant_ip': u'192.168.133.2/24', u'pns_if': u't5pns_if'}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip link show \"t5if\" ; if [ $? -ne 0 ] ; then ip link add \"t5if\" type veth peer name \"t5pns_if\" ; fi\n", "delta": "0:00:00.025482", "end": "2019-11-18 11:21:40.633837", "item": {"default_route_ip": "192.168.133.1", "name": "t5", "pns_if": "t5pns_if", "pns_ip": "192.168.133.1/24", "tenant_if": "t5if", "tenant_ip": "192.168.133.2/24"}, "rc": 0, "start": "2019-11-18 11:21:40.608355", "stderr": "Device \"t5if\" does not exist.", "stderr_lines": ["Device \"t5if\" does not exist."], "stdout": "", "stdout_lines": []}

TASK [Attach Tenant VETH Pairs] *****************************************************************************************************************************
changed: [99.99.99.2] => (item={u'default_route_ip': u'192.168.133.1', u'name': u't5', u'pns_ip': u'192.168.133.1/24', u'tenant_if': u't5if', u'tenant_ip': u'192.168.133.2/24', u'pns_if': u't5pns_if'}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec pns ip link show \"t5pns_if\" ; if [ $? -ne 0 ] ; then ip link set \"t5pns_if\" netns pns ; fi\nip netns exec \"t5\" ip link show \"t5if\" ; if [ $? -ne 0 ] ; then ip link set \"t5if\" netns \"t5\" ; fi\nip netns exec pns ip link set dev \"t5pns_if\" up\nip netns exec \"t5\" ip link set dev \"t5if\" up\n", "delta": "0:00:00.185364", "end": "2019-11-18 11:21:41.210521", "item": {"default_route_ip": "192.168.133.1", "name": "t5", "pns_if": "t5pns_if", "pns_ip": "192.168.133.1/24", "tenant_if": "t5if", "tenant_ip": "192.168.133.2/24"}, "rc": 0, "start": "2019-11-18 11:21:41.025157", "stderr": "Device \"t5pns_if\" does not exist.\nDevice \"t5if\" does not exist.", "stderr_lines": ["Device \"t5pns_if\" does not exist.", "Device \"t5if\" does not exist."], "stdout": "", "stdout_lines": []}

TASK [Add IP addresses to Tenant VETH Pairs] ****************************************************************************************************************
changed: [99.99.99.2] => (item={u'default_route_ip': u'192.168.133.1', u'name': u't5', u'pns_ip': u'192.168.133.1/24', u'tenant_if': u't5if', u'tenant_ip': u'192.168.133.2/24', u'pns_if': u't5pns_if'}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec pns ip addr show \"t5pns_if\" | awk 'FNR==3{ print $2 }' | grep -w '^192.168.133.1/24' ; if [ $? -ne 0 ] ; then ip netns exec pns ip addr add \"192.168.133.1/24\" dev \"t5pns_if\" ; fi\nip netns exec \"t5\" ip addr show \"t5if\" | awk 'FNR==3{ print $2 }' | grep -w '^192.168.133.2/24' ; if [ $? -ne 0 ] ; then ip netns exec \"t5\" ip addr add \"192.168.133.2/24\" dev \"t5if\" ; fi\n", "delta": "0:00:00.146042", "end": "2019-11-18 11:21:41.762379", "item": {"default_route_ip": "192.168.133.1", "name": "t5", "pns_if": "t5pns_if", "pns_ip": "192.168.133.1/24", "tenant_if": "t5if", "tenant_ip": "192.168.133.2/24"}, "rc": 0, "start": "2019-11-18 11:21:41.616337", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Create Namespace VETH Pairs] **************************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.41.1/24', u'ns_name': u't5', u'ns_if': u't5if', u'if': u'p1'}], u'default_route_ip': u'10.2.41.1', u'bridge_name': u't5br1', u'dns': [{u'dnsif': u't5s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't5s1_dnsbrif'}], u'ns_name': u't5ns1', u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't5_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't5br1if1', u'vmif': u't5VM4if1'}], u'vxlan': [{u'local_ip': u'10.2.41.2', u'dsport': 4789, u'dev': u't5s1if', u'tenant_route_ip': u'192.168.133.2', u'remote_route': u'10.1.41.0/24', u'subnet_route': u'10.2.41.0/24', u'v_name': u'vxlan_t5s1', u'id': 42, u'remote_ip': u'10.1.41.2'}]}, {u'tenant_sub_ip': u'10.2.41.2/24', u'tenant_ns_ip': u'10.2.41.1/24', u'tenant_ns_if': u't5ns1if', u'tenant_sub_if': u't5s1if', u'tenant_ns_name': u't5'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip link show \"t5ns1if\" ; if [ $? -ne 0 ] ; then ip link add \"t5ns1if\" type veth peer name \"t5s1if\" ; fi\n", "delta": "0:00:00.013002", "end": "2019-11-18 11:21:42.150137", "item": [{"bridge_name": "t5br1", "default_route_ip": "10.2.41.1", "dns": [{"brif": "t5s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t5s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "ns_name": "t5ns1", "route": [{"if": "p1", "ip": "10.2.41.1/24", "ns_if": "t5if", "ns_name": "t5"}], "subnet_ip": "1.1.1.0/24", "vms": [{"brif": "t5br1if1", "disk": "10G", "mem": 2, "name": "t5_VM4", "vcpu": 4, "vmif": "t5VM4if1"}], "vxlan": [{"dev": "t5s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.41.2", "remote_ip": "10.1.41.2", "remote_route": "10.1.41.0/24", "subnet_route": "10.2.41.0/24", "tenant_route_ip": "192.168.133.2", "v_name": "vxlan_t5s1"}]}, {"tenant_ns_if": "t5ns1if", "tenant_ns_ip": "10.2.41.1/24", "tenant_ns_name": "t5", "tenant_sub_if": "t5s1if", "tenant_sub_ip": "10.2.41.2/24"}], "rc": 0, "start": "2019-11-18 11:21:42.137135", "stderr": "Device \"t5ns1if\" does not exist.", "stderr_lines": ["Device \"t5ns1if\" does not exist."], "stdout": "", "stdout_lines": []}

TASK [Attach Namespace VETH Pairs] **************************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.41.1/24', u'ns_name': u't5', u'ns_if': u't5if', u'if': u'p1'}], u'default_route_ip': u'10.2.41.1', u'bridge_name': u't5br1', u'dns': [{u'dnsif': u't5s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't5s1_dnsbrif'}], u'ns_name': u't5ns1', u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't5_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't5br1if1', u'vmif': u't5VM4if1'}], u'vxlan': [{u'local_ip': u'10.2.41.2', u'dsport': 4789, u'dev': u't5s1if', u'tenant_route_ip': u'192.168.133.2', u'remote_route': u'10.1.41.0/24', u'subnet_route': u'10.2.41.0/24', u'v_name': u'vxlan_t5s1', u'id': 42, u'remote_ip': u'10.1.41.2'}]}, {u'tenant_sub_ip': u'10.2.41.2/24', u'tenant_ns_ip': u'10.2.41.1/24', u'tenant_ns_if': u't5ns1if', u'tenant_sub_if': u't5s1if', u'tenant_ns_name': u't5'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t5\" ip link show \"t5ns1if\" ; if [ $? -ne 0 ] ; then ip link set \"t5ns1if\" netns \"t5\" ; fi\nip netns exec \"t5ns1\" ip link show \"t5s1if\" ; if [ $? -ne 0 ] ; then ip link set \"t5s1if\" netns \"t5ns1\" ; fi\n", "delta": "0:00:00.118144", "end": "2019-11-18 11:21:42.664779", "item": [{"bridge_name": "t5br1", "default_route_ip": "10.2.41.1", "dns": [{"brif": "t5s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t5s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "ns_name": "t5ns1", "route": [{"if": "p1", "ip": "10.2.41.1/24", "ns_if": "t5if", "ns_name": "t5"}], "subnet_ip": "1.1.1.0/24", "vms": [{"brif": "t5br1if1", "disk": "10G", "mem": 2, "name": "t5_VM4", "vcpu": 4, "vmif": "t5VM4if1"}], "vxlan": [{"dev": "t5s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.41.2", "remote_ip": "10.1.41.2", "remote_route": "10.1.41.0/24", "subnet_route": "10.2.41.0/24", "tenant_route_ip": "192.168.133.2", "v_name": "vxlan_t5s1"}]}, {"tenant_ns_if": "t5ns1if", "tenant_ns_ip": "10.2.41.1/24", "tenant_ns_name": "t5", "tenant_sub_if": "t5s1if", "tenant_sub_ip": "10.2.41.2/24"}], "rc": 0, "start": "2019-11-18 11:21:42.546635", "stderr": "Device \"t5ns1if\" does not exist.\nDevice \"t5s1if\" does not exist.", "stderr_lines": ["Device \"t5ns1if\" does not exist.", "Device \"t5s1if\" does not exist."], "stdout": "", "stdout_lines": []}

TASK [Set Namespace VETH Pairs UP] **************************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.41.1/24', u'ns_name': u't5', u'ns_if': u't5if', u'if': u'p1'}], u'default_route_ip': u'10.2.41.1', u'bridge_name': u't5br1', u'dns': [{u'dnsif': u't5s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't5s1_dnsbrif'}], u'ns_name': u't5ns1', u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't5_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't5br1if1', u'vmif': u't5VM4if1'}], u'vxlan': [{u'local_ip': u'10.2.41.2', u'dsport': 4789, u'dev': u't5s1if', u'tenant_route_ip': u'192.168.133.2', u'remote_route': u'10.1.41.0/24', u'subnet_route': u'10.2.41.0/24', u'v_name': u'vxlan_t5s1', u'id': 42, u'remote_ip': u'10.1.41.2'}]}, {u'tenant_sub_ip': u'10.2.41.2/24', u'tenant_ns_ip': u'10.2.41.1/24', u'tenant_ns_if': u't5ns1if', u'tenant_sub_if': u't5s1if', u'tenant_ns_name': u't5'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t5\" ip link set dev \"t5ns1if\" up\nip netns exec \"t5ns1\" ip link set dev \"t5s1if\" up\n", "delta": "0:00:00.087164", "end": "2019-11-18 11:21:43.150467", "item": [{"bridge_name": "t5br1", "default_route_ip": "10.2.41.1", "dns": [{"brif": "t5s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t5s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "ns_name": "t5ns1", "route": [{"if": "p1", "ip": "10.2.41.1/24", "ns_if": "t5if", "ns_name": "t5"}], "subnet_ip": "1.1.1.0/24", "vms": [{"brif": "t5br1if1", "disk": "10G", "mem": 2, "name": "t5_VM4", "vcpu": 4, "vmif": "t5VM4if1"}], "vxlan": [{"dev": "t5s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.41.2", "remote_ip": "10.1.41.2", "remote_route": "10.1.41.0/24", "subnet_route": "10.2.41.0/24", "tenant_route_ip": "192.168.133.2", "v_name": "vxlan_t5s1"}]}, {"tenant_ns_if": "t5ns1if", "tenant_ns_ip": "10.2.41.1/24", "tenant_ns_name": "t5", "tenant_sub_if": "t5s1if", "tenant_sub_ip": "10.2.41.2/24"}], "rc": 0, "start": "2019-11-18 11:21:43.063303", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Add IP addresses to Namespace VETH Pairs] *************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.41.1/24', u'ns_name': u't5', u'ns_if': u't5if', u'if': u'p1'}], u'default_route_ip': u'10.2.41.1', u'bridge_name': u't5br1', u'dns': [{u'dnsif': u't5s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't5s1_dnsbrif'}], u'ns_name': u't5ns1', u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't5_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't5br1if1', u'vmif': u't5VM4if1'}], u'vxlan': [{u'local_ip': u'10.2.41.2', u'dsport': 4789, u'dev': u't5s1if', u'tenant_route_ip': u'192.168.133.2', u'remote_route': u'10.1.41.0/24', u'subnet_route': u'10.2.41.0/24', u'v_name': u'vxlan_t5s1', u'id': 42, u'remote_ip': u'10.1.41.2'}]}, {u'tenant_sub_ip': u'10.2.41.2/24', u'tenant_ns_ip': u'10.2.41.1/24', u'tenant_ns_if': u't5ns1if', u'tenant_sub_if': u't5s1if', u'tenant_ns_name': u't5'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t5ns1\" ip addr show \"t5s1if\" | awk 'FNR==3{ print $2 }' | grep -w '^10.2.41.2/24' ; if [ $? -ne 0 ] ; then ip netns exec \"t5ns1\" ip addr add \"10.2.41.2/24\" dev \"t5s1if\" ; fi\n\nip netns exec \"t5\" ip addr show \"t5ns1if\" | awk 'FNR==3{ print $2 }' | grep -w '^10.2.41.1/24' ; if [ $? -ne 0 ] ; then ip netns exec \"t5\" ip addr add \"10.2.41.1/24\" dev \"t5ns1if\" ; fi\n", "delta": "0:00:00.167493", "end": "2019-11-18 11:21:43.706335", "item": [{"bridge_name": "t5br1", "default_route_ip": "10.2.41.1", "dns": [{"brif": "t5s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t5s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "ns_name": "t5ns1", "route": [{"if": "p1", "ip": "10.2.41.1/24", "ns_if": "t5if", "ns_name": "t5"}], "subnet_ip": "1.1.1.0/24", "vms": [{"brif": "t5br1if1", "disk": "10G", "mem": 2, "name": "t5_VM4", "vcpu": 4, "vmif": "t5VM4if1"}], "vxlan": [{"dev": "t5s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.41.2", "remote_ip": "10.1.41.2", "remote_route": "10.1.41.0/24", "subnet_route": "10.2.41.0/24", "tenant_route_ip": "192.168.133.2", "v_name": "vxlan_t5s1"}]}, {"tenant_ns_if": "t5ns1if", "tenant_ns_ip": "10.2.41.1/24", "tenant_ns_name": "t5", "tenant_sub_if": "t5s1if", "tenant_sub_ip": "10.2.41.2/24"}], "rc": 0, "start": "2019-11-18 11:21:43.538842", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Add IP Route to Tenant] *******************************************************************************************************************************
changed: [99.99.99.2] => (item={u'default_route_ip': u'192.168.133.1', u'name': u't5', u'pns_ip': u'192.168.133.1/24', u'tenant_if': u't5if', u'tenant_ip': u'192.168.133.2/24', u'pns_if': u't5pns_if'}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t5\" ip route show default | grep -w '[d]efault via 192.168.133.1' ; if [ $? -ne 0 ] ; then ip netns exec \"t5\" ip route add default via \"192.168.133.1\" ; fi\n", "delta": "0:00:00.083575", "end": "2019-11-18 11:21:44.146579", "item": {"default_route_ip": "192.168.133.1", "name": "t5", "pns_if": "t5pns_if", "pns_ip": "192.168.133.1/24", "tenant_if": "t5if", "tenant_ip": "192.168.133.2/24"}, "rc": 0, "start": "2019-11-18 11:21:44.063004", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Add IP Route to Tenant Subnet] ************************************************************************************************************************
changed: [99.99.99.2] => (item={u'route': [{u'ip': u'10.2.41.1/24', u'ns_name': u't5', u'ns_if': u't5if', u'if': u'p1'}], u'default_route_ip': u'10.2.41.1', u'bridge_name': u't5br1', u'dns': [{u'dnsif': u't5s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't5s1_dnsbrif'}], u'ns_name': u't5ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.41.2/24', u'tenant_ns_ip': u'10.2.41.1/24', u'tenant_ns_if': u't5ns1if', u'tenant_ns_name': u't5', u'tenant_sub_if': u't5s1if'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't5_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't5br1if1', u'vmif': u't5VM4if1'}], u'vxlan': [{u'local_ip': u'10.2.41.2', u'tenant_route_ip': u'192.168.133.2', u'dsport': 4789, u'dev': u't5s1if', u'subnet_route': u'10.2.41.0/24', u'remote_route': u'10.1.41.0/24', u'v_name': u'vxlan_t5s1', u'id': 42, u'remote_ip': u'10.1.41.2'}]}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t5ns1\" ip route show default | grep -w '[d]efault via 10.2.41.1' ; if [ $? -ne 0 ] ; then ip netns exec \"t5ns1\" ip route add default via \"10.2.41.1\" ; fi\n", "delta": "0:00:00.080946", "end": "2019-11-18 11:21:44.618431", "item": {"bridge_name": "t5br1", "default_route_ip": "10.2.41.1", "dns": [{"brif": "t5s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t5s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "ns_name": "t5ns1", "route": [{"if": "p1", "ip": "10.2.41.1/24", "ns_if": "t5if", "ns_name": "t5"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t5ns1if", "tenant_ns_ip": "10.2.41.1/24", "tenant_ns_name": "t5", "tenant_sub_if": "t5s1if", "tenant_sub_ip": "10.2.41.2/24"}], "vms": [{"brif": "t5br1if1", "disk": "10G", "mem": 2, "name": "t5_VM4", "vcpu": 4, "vmif": "t5VM4if1"}], "vxlan": [{"dev": "t5s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.41.2", "remote_ip": "10.1.41.2", "remote_route": "10.1.41.0/24", "subnet_route": "10.2.41.0/24", "tenant_route_ip": "192.168.133.2", "v_name": "vxlan_t5s1"}]}, "rc": 0, "start": "2019-11-18 11:21:44.537485", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Create bridge inside namespace] ***********************************************************************************************************************
changed: [99.99.99.2] => (item={u'route': [{u'ip': u'10.2.41.1/24', u'ns_name': u't5', u'ns_if': u't5if', u'if': u'p1'}], u'default_route_ip': u'10.2.41.1', u'bridge_name': u't5br1', u'dns': [{u'dnsif': u't5s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't5s1_dnsbrif'}], u'ns_name': u't5ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.41.2/24', u'tenant_ns_ip': u'10.2.41.1/24', u'tenant_ns_if': u't5ns1if', u'tenant_ns_name': u't5', u'tenant_sub_if': u't5s1if'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't5_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't5br1if1', u'vmif': u't5VM4if1'}], u'vxlan': [{u'local_ip': u'10.2.41.2', u'tenant_route_ip': u'192.168.133.2', u'dsport': 4789, u'dev': u't5s1if', u'subnet_route': u'10.2.41.0/24', u'remote_route': u'10.1.41.0/24', u'v_name': u'vxlan_t5s1', u'id': 42, u'remote_ip': u'10.1.41.2'}]}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t5ns1\" brctl show | grep -w '^t5br1'; if [ $? -ne 0 ] ; then ip netns exec \"t5ns1\" brctl addbr \"t5br1\" ; fi\nip netns exec \"t5ns1\" ip link set dev \"t5br1\" up\n", "delta": "0:00:00.117776", "end": "2019-11-18 11:21:45.126676", "item": {"bridge_name": "t5br1", "default_route_ip": "10.2.41.1", "dns": [{"brif": "t5s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t5s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "ns_name": "t5ns1", "route": [{"if": "p1", "ip": "10.2.41.1/24", "ns_if": "t5if", "ns_name": "t5"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t5ns1if", "tenant_ns_ip": "10.2.41.1/24", "tenant_ns_name": "t5", "tenant_sub_if": "t5s1if", "tenant_sub_ip": "10.2.41.2/24"}], "vms": [{"brif": "t5br1if1", "disk": "10G", "mem": 2, "name": "t5_VM4", "vcpu": 4, "vmif": "t5VM4if1"}], "vxlan": [{"dev": "t5s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.41.2", "remote_ip": "10.1.41.2", "remote_route": "10.1.41.0/24", "subnet_route": "10.2.41.0/24", "tenant_route_ip": "192.168.133.2", "v_name": "vxlan_t5s1"}]}, "rc": 0, "start": "2019-11-18 11:21:45.008900", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Create DNS VETH Pair] *********************************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.41.1/24', u'ns_name': u't5', u'ns_if': u't5if', u'if': u'p1'}], u'default_route_ip': u'10.2.41.1', u'bridge_name': u't5br1', u'ns_name': u't5ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.41.2/24', u'tenant_ns_ip': u'10.2.41.1/24', u'tenant_ns_if': u't5ns1if', u'tenant_sub_if': u't5s1if', u'tenant_ns_name': u't5'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't5_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't5br1if1', u'vmif': u't5VM4if1'}], u'vxlan': [{u'local_ip': u'10.2.41.2', u'dsport': 4789, u'dev': u't5s1if', u'tenant_route_ip': u'192.168.133.2', u'remote_route': u'10.1.41.0/24', u'subnet_route': u'10.2.41.0/24', u'v_name': u'vxlan_t5s1', u'id': 42, u'remote_ip': u'10.1.41.2'}]}, {u'dnsif': u't5s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't5s1_dnsbrif'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t5ns1\" ip link show \"t5s1_dnsbrif\" ; if [ $? -ne 0 ] ; then ip netns exec \"t5ns1\" ip link add \"t5s1_dnsbrif\" type veth peer name \"t5s1_dnsif\" ; fi\nip netns exec \"t5ns1\" ip link set dev \"t5s1_dnsbrif\" up\nip netns exec \"t5ns1\" ip link set dev \"t5s1_dnsif\" up\n", "delta": "0:00:00.172080", "end": "2019-11-18 11:21:45.706588", "item": [{"bridge_name": "t5br1", "default_route_ip": "10.2.41.1", "ns_name": "t5ns1", "route": [{"if": "p1", "ip": "10.2.41.1/24", "ns_if": "t5if", "ns_name": "t5"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t5ns1if", "tenant_ns_ip": "10.2.41.1/24", "tenant_ns_name": "t5", "tenant_sub_if": "t5s1if", "tenant_sub_ip": "10.2.41.2/24"}], "vms": [{"brif": "t5br1if1", "disk": "10G", "mem": 2, "name": "t5_VM4", "vcpu": 4, "vmif": "t5VM4if1"}], "vxlan": [{"dev": "t5s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.41.2", "remote_ip": "10.1.41.2", "remote_route": "10.1.41.0/24", "subnet_route": "10.2.41.0/24", "tenant_route_ip": "192.168.133.2", "v_name": "vxlan_t5s1"}]}, {"brif": "t5s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t5s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "rc": 0, "start": "2019-11-18 11:21:45.534508", "stderr": "Device \"t5s1_dnsbrif\" does not exist.", "stderr_lines": ["Device \"t5s1_dnsbrif\" does not exist."], "stdout": "", "stdout_lines": []}

TASK [Attach DNS VETH Pair] *********************************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.41.1/24', u'ns_name': u't5', u'ns_if': u't5if', u'if': u'p1'}], u'default_route_ip': u'10.2.41.1', u'bridge_name': u't5br1', u'ns_name': u't5ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.41.2/24', u'tenant_ns_ip': u'10.2.41.1/24', u'tenant_ns_if': u't5ns1if', u'tenant_sub_if': u't5s1if', u'tenant_ns_name': u't5'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't5_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't5br1if1', u'vmif': u't5VM4if1'}], u'vxlan': [{u'local_ip': u'10.2.41.2', u'dsport': 4789, u'dev': u't5s1if', u'tenant_route_ip': u'192.168.133.2', u'remote_route': u'10.1.41.0/24', u'subnet_route': u'10.2.41.0/24', u'v_name': u'vxlan_t5s1', u'id': 42, u'remote_ip': u'10.1.41.2'}]}, {u'dnsif': u't5s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't5s1_dnsbrif'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t5ns1\" brctl show \"t5br1\" | grep -w 't5s1_dnsbrif' ; if [ $? -ne 0 ] ; then ip netns exec \"t5ns1\" brctl addif \"t5br1\" \"t5s1_dnsbrif\" ; fi\n", "delta": "0:00:00.086143", "end": "2019-11-18 11:21:46.226535", "item": [{"bridge_name": "t5br1", "default_route_ip": "10.2.41.1", "ns_name": "t5ns1", "route": [{"if": "p1", "ip": "10.2.41.1/24", "ns_if": "t5if", "ns_name": "t5"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t5ns1if", "tenant_ns_ip": "10.2.41.1/24", "tenant_ns_name": "t5", "tenant_sub_if": "t5s1if", "tenant_sub_ip": "10.2.41.2/24"}], "vms": [{"brif": "t5br1if1", "disk": "10G", "mem": 2, "name": "t5_VM4", "vcpu": 4, "vmif": "t5VM4if1"}], "vxlan": [{"dev": "t5s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.41.2", "remote_ip": "10.1.41.2", "remote_route": "10.1.41.0/24", "subnet_route": "10.2.41.0/24", "tenant_route_ip": "192.168.133.2", "v_name": "vxlan_t5s1"}]}, {"brif": "t5s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t5s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "rc": 0, "start": "2019-11-18 11:21:46.140392", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Create VETH Pairs] ************************************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.41.1/24', u'ns_name': u't5', u'ns_if': u't5if', u'if': u'p1'}], u'default_route_ip': u'10.2.41.1', u'bridge_name': u't5br1', u'dns': [{u'dnsif': u't5s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't5s1_dnsbrif'}], u'ns_name': u't5ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.41.2/24', u'tenant_ns_ip': u'10.2.41.1/24', u'tenant_ns_if': u't5ns1if', u'tenant_sub_if': u't5s1if', u'tenant_ns_name': u't5'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.2.41.2', u'dsport': 4789, u'dev': u't5s1if', u'tenant_route_ip': u'192.168.133.2', u'remote_route': u'10.1.41.0/24', u'subnet_route': u'10.2.41.0/24', u'v_name': u'vxlan_t5s1', u'id': 42, u'remote_ip': u'10.1.41.2'}]}, {u'mem': 2, u'name': u't5_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't5br1if1', u'vmif': u't5VM4if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip link show \"t5br1if1\" ; if [ $? -ne 0 ] ; then ip link add \"t5VM4if1\" type veth peer name \"t5br1if1\" ; fi\nip link set dev \"t5br1if1\" up\nip link set dev \"t5VM4if1\" up\n", "delta": "0:00:00.017402", "end": "2019-11-18 11:21:46.607521", "item": [{"bridge_name": "t5br1", "default_route_ip": "10.2.41.1", "dns": [{"brif": "t5s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t5s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "ns_name": "t5ns1", "route": [{"if": "p1", "ip": "10.2.41.1/24", "ns_if": "t5if", "ns_name": "t5"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t5ns1if", "tenant_ns_ip": "10.2.41.1/24", "tenant_ns_name": "t5", "tenant_sub_if": "t5s1if", "tenant_sub_ip": "10.2.41.2/24"}], "vxlan": [{"dev": "t5s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.41.2", "remote_ip": "10.1.41.2", "remote_route": "10.1.41.0/24", "subnet_route": "10.2.41.0/24", "tenant_route_ip": "192.168.133.2", "v_name": "vxlan_t5s1"}]}, {"brif": "t5br1if1", "disk": "10G", "mem": 2, "name": "t5_VM4", "vcpu": 4, "vmif": "t5VM4if1"}], "rc": 0, "start": "2019-11-18 11:21:46.590119", "stderr": "Device \"t5br1if1\" does not exist.", "stderr_lines": ["Device \"t5br1if1\" does not exist."], "stdout": "", "stdout_lines": []}

TASK [Attach VETH Pairs] ************************************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.41.1/24', u'ns_name': u't5', u'ns_if': u't5if', u'if': u'p1'}], u'default_route_ip': u'10.2.41.1', u'bridge_name': u't5br1', u'dns': [{u'dnsif': u't5s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't5s1_dnsbrif'}], u'ns_name': u't5ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.41.2/24', u'tenant_ns_ip': u'10.2.41.1/24', u'tenant_ns_if': u't5ns1if', u'tenant_sub_if': u't5s1if', u'tenant_ns_name': u't5'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.2.41.2', u'dsport': 4789, u'dev': u't5s1if', u'tenant_route_ip': u'192.168.133.2', u'remote_route': u'10.1.41.0/24', u'subnet_route': u'10.2.41.0/24', u'v_name': u'vxlan_t5s1', u'id': 42, u'remote_ip': u'10.1.41.2'}]}, {u'mem': 2, u'name': u't5_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't5br1if1', u'vmif': u't5VM4if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip link show \"t5br1if1\" ; if [ $? -eq 0 ] ; then ip link set \"t5br1if1\" netns \"t5ns1\" ; fi\nip netns exec \"t5ns1\" brctl show \"t5br1\" | grep -w 't5br1if1' ; if [ $? -ne 0 ] ; then ip netns exec \"t5ns1\" brctl addif \"t5br1\" \"t5br1if1\" ; fi\n", "delta": "0:00:00.114491", "end": "2019-11-18 11:21:47.110464", "item": [{"bridge_name": "t5br1", "default_route_ip": "10.2.41.1", "dns": [{"brif": "t5s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t5s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "ns_name": "t5ns1", "route": [{"if": "p1", "ip": "10.2.41.1/24", "ns_if": "t5if", "ns_name": "t5"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t5ns1if", "tenant_ns_ip": "10.2.41.1/24", "tenant_ns_name": "t5", "tenant_sub_if": "t5s1if", "tenant_sub_ip": "10.2.41.2/24"}], "vxlan": [{"dev": "t5s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.41.2", "remote_ip": "10.1.41.2", "remote_route": "10.1.41.0/24", "subnet_route": "10.2.41.0/24", "tenant_route_ip": "192.168.133.2", "v_name": "vxlan_t5s1"}]}, {"brif": "t5br1if1", "disk": "10G", "mem": 2, "name": "t5_VM4", "vcpu": 4, "vmif": "t5VM4if1"}], "rc": 0, "start": "2019-11-18 11:21:46.995973", "stderr": "", "stderr_lines": [], "stdout": "63: t5br1if1@t5VM4if1: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP mode DEFAULT group default qlen 1000\n    link/ether 92:ba:f6:c2:f5:d1 brd ff:ff:ff:ff:ff:ff", "stdout_lines": ["63: t5br1if1@t5VM4if1: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP mode DEFAULT group default qlen 1000", "    link/ether 92:ba:f6:c2:f5:d1 brd ff:ff:ff:ff:ff:ff"]}

TASK [All interfaces and bridges UP] ************************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.41.1/24', u'ns_name': u't5', u'ns_if': u't5if', u'if': u'p1'}], u'default_route_ip': u'10.2.41.1', u'bridge_name': u't5br1', u'dns': [{u'dnsif': u't5s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't5s1_dnsbrif'}], u'ns_name': u't5ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.41.2/24', u'tenant_ns_ip': u'10.2.41.1/24', u'tenant_ns_if': u't5ns1if', u'tenant_sub_if': u't5s1if', u'tenant_ns_name': u't5'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.2.41.2', u'dsport': 4789, u'dev': u't5s1if', u'tenant_route_ip': u'192.168.133.2', u'remote_route': u'10.1.41.0/24', u'subnet_route': u'10.2.41.0/24', u'v_name': u'vxlan_t5s1', u'id': 42, u'remote_ip': u'10.1.41.2'}]}, {u'mem': 2, u'name': u't5_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't5br1if1', u'vmif': u't5VM4if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t5ns1\" ip link set \"t5br1if1\" up\nip netns exec \"t5ns1\" ip link set dev \"t5br1\" up\n", "delta": "0:00:00.075917", "end": "2019-11-18 11:21:47.582584", "item": [{"bridge_name": "t5br1", "default_route_ip": "10.2.41.1", "dns": [{"brif": "t5s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t5s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "ns_name": "t5ns1", "route": [{"if": "p1", "ip": "10.2.41.1/24", "ns_if": "t5if", "ns_name": "t5"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t5ns1if", "tenant_ns_ip": "10.2.41.1/24", "tenant_ns_name": "t5", "tenant_sub_if": "t5s1if", "tenant_sub_ip": "10.2.41.2/24"}], "vxlan": [{"dev": "t5s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.41.2", "remote_ip": "10.1.41.2", "remote_route": "10.1.41.0/24", "subnet_route": "10.2.41.0/24", "tenant_route_ip": "192.168.133.2", "v_name": "vxlan_t5s1"}]}, {"brif": "t5br1if1", "disk": "10G", "mem": 2, "name": "t5_VM4", "vcpu": 4, "vmif": "t5VM4if1"}], "rc": 0, "start": "2019-11-18 11:21:47.506667", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Add IP to DNS Interface] ******************************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.41.1/24', u'ns_name': u't5', u'ns_if': u't5if', u'if': u'p1'}], u'default_route_ip': u'10.2.41.1', u'bridge_name': u't5br1', u'ns_name': u't5ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.41.2/24', u'tenant_ns_ip': u'10.2.41.1/24', u'tenant_ns_if': u't5ns1if', u'tenant_sub_if': u't5s1if', u'tenant_ns_name': u't5'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't5_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't5br1if1', u'vmif': u't5VM4if1'}], u'vxlan': [{u'local_ip': u'10.2.41.2', u'dsport': 4789, u'dev': u't5s1if', u'tenant_route_ip': u'192.168.133.2', u'remote_route': u'10.1.41.0/24', u'subnet_route': u'10.2.41.0/24', u'v_name': u'vxlan_t5s1', u'id': 42, u'remote_ip': u'10.1.41.2'}]}, {u'dnsif': u't5s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't5s1_dnsbrif'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t5ns1\" ip addr show \"t5s1_dnsif\" | awk 'FNR==3{ print $2}'| grep -w '^1.1.1.128/24' ; if [ $? -ne 0 ] ; then ip netns exec \"t5ns1\" ip addr add \"1.1.1.128/24\" dev \"t5s1_dnsif\" ; fi\n", "delta": "0:00:00.078353", "end": "2019-11-18 11:21:48.058583", "item": [{"bridge_name": "t5br1", "default_route_ip": "10.2.41.1", "ns_name": "t5ns1", "route": [{"if": "p1", "ip": "10.2.41.1/24", "ns_if": "t5if", "ns_name": "t5"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t5ns1if", "tenant_ns_ip": "10.2.41.1/24", "tenant_ns_name": "t5", "tenant_sub_if": "t5s1if", "tenant_sub_ip": "10.2.41.2/24"}], "vms": [{"brif": "t5br1if1", "disk": "10G", "mem": 2, "name": "t5_VM4", "vcpu": 4, "vmif": "t5VM4if1"}], "vxlan": [{"dev": "t5s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.41.2", "remote_ip": "10.1.41.2", "remote_route": "10.1.41.0/24", "subnet_route": "10.2.41.0/24", "tenant_route_ip": "192.168.133.2", "v_name": "vxlan_t5s1"}]}, {"brif": "t5s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t5s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "rc": 0, "start": "2019-11-18 11:21:47.980230", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Install DHCP Server] **********************************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.41.1/24', u'ns_name': u't5', u'ns_if': u't5if', u'if': u'p1'}], u'default_route_ip': u'10.2.41.1', u'bridge_name': u't5br1', u'ns_name': u't5ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.41.2/24', u'tenant_ns_ip': u'10.2.41.1/24', u'tenant_ns_if': u't5ns1if', u'tenant_sub_if': u't5s1if', u'tenant_ns_name': u't5'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't5_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't5br1if1', u'vmif': u't5VM4if1'}], u'vxlan': [{u'local_ip': u'10.2.41.2', u'dsport': 4789, u'dev': u't5s1if', u'tenant_route_ip': u'192.168.133.2', u'remote_route': u'10.1.41.0/24', u'subnet_route': u'10.2.41.0/24', u'v_name': u'vxlan_t5s1', u'id': 42, u'remote_ip': u'10.1.41.2'}]}, {u'dnsif': u't5s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't5s1_dnsbrif'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t5ns1\" ps aux | grep -w '[d]nsmasq --interface t5s1_dnsif -z --dhcp-range=1.1.1.133,1.1.1.254' ; if [ $? -ne 0 ] ; then ip netns exec \"t5ns1\" dnsmasq --interface \"t5s1_dnsif\" -z --dhcp-range=1.1.1.133,'1.1.1.254' ; fi\n", "delta": "0:00:00.120933", "end": "2019-11-18 11:21:48.583522", "item": [{"bridge_name": "t5br1", "default_route_ip": "10.2.41.1", "ns_name": "t5ns1", "route": [{"if": "p1", "ip": "10.2.41.1/24", "ns_if": "t5if", "ns_name": "t5"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t5ns1if", "tenant_ns_ip": "10.2.41.1/24", "tenant_ns_name": "t5", "tenant_sub_if": "t5s1if", "tenant_sub_ip": "10.2.41.2/24"}], "vms": [{"brif": "t5br1if1", "disk": "10G", "mem": 2, "name": "t5_VM4", "vcpu": 4, "vmif": "t5VM4if1"}], "vxlan": [{"dev": "t5s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.41.2", "remote_ip": "10.1.41.2", "remote_route": "10.1.41.0/24", "subnet_route": "10.2.41.0/24", "tenant_route_ip": "192.168.133.2", "v_name": "vxlan_t5s1"}]}, {"brif": "t5s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t5s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "rc": 0, "start": "2019-11-18 11:21:48.462589", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Create VXLAN devices] *********************************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.41.1/24', u'ns_name': u't5', u'ns_if': u't5if', u'if': u'p1'}], u'default_route_ip': u'10.2.41.1', u'bridge_name': u't5br1', u'dns': [{u'dnsif': u't5s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't5s1_dnsbrif'}], u'ns_name': u't5ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.41.2/24', u'tenant_ns_ip': u'10.2.41.1/24', u'tenant_ns_if': u't5ns1if', u'tenant_sub_if': u't5s1if', u'tenant_ns_name': u't5'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't5_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't5br1if1', u'vmif': u't5VM4if1'}]}, {u'local_ip': u'10.2.41.2', u'dsport': 4789, u'dev': u't5s1if', u'tenant_route_ip': u'192.168.133.2', u'remote_route': u'10.1.41.0/24', u'subnet_route': u'10.2.41.0/24', u'v_name': u'vxlan_t5s1', u'id': 42, u'remote_ip': u'10.1.41.2'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t5ns1\" ip link show \"vxlan_t5s1\" ; if [ $? -ne 0 ] ; then ip netns exec \"t5ns1\" ip link add \"vxlan_t5s1\" type vxlan id \"42\" local \"10.2.41.2\" remote \"10.1.41.2\" dstport \"4789\" dev \"t5s1if\" ; ip netns exec \"t5ns1\" ip link set dev \"vxlan_t5s1\" up ; fi\n", "delta": "0:00:00.115236", "end": "2019-11-18 11:21:49.110382", "item": [{"bridge_name": "t5br1", "default_route_ip": "10.2.41.1", "dns": [{"brif": "t5s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t5s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "ns_name": "t5ns1", "route": [{"if": "p1", "ip": "10.2.41.1/24", "ns_if": "t5if", "ns_name": "t5"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t5ns1if", "tenant_ns_ip": "10.2.41.1/24", "tenant_ns_name": "t5", "tenant_sub_if": "t5s1if", "tenant_sub_ip": "10.2.41.2/24"}], "vms": [{"brif": "t5br1if1", "disk": "10G", "mem": 2, "name": "t5_VM4", "vcpu": 4, "vmif": "t5VM4if1"}]}, {"dev": "t5s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.41.2", "remote_ip": "10.1.41.2", "remote_route": "10.1.41.0/24", "subnet_route": "10.2.41.0/24", "tenant_route_ip": "192.168.133.2", "v_name": "vxlan_t5s1"}], "rc": 0, "start": "2019-11-18 11:21:48.995146", "stderr": "Device \"vxlan_t5s1\" does not exist.", "stderr_lines": ["Device \"vxlan_t5s1\" does not exist."], "stdout": "", "stdout_lines": []}

TASK [Attach VXLANs to bridge] ******************************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.41.1/24', u'ns_name': u't5', u'ns_if': u't5if', u'if': u'p1'}], u'default_route_ip': u'10.2.41.1', u'bridge_name': u't5br1', u'dns': [{u'dnsif': u't5s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't5s1_dnsbrif'}], u'ns_name': u't5ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.41.2/24', u'tenant_ns_ip': u'10.2.41.1/24', u'tenant_ns_if': u't5ns1if', u'tenant_sub_if': u't5s1if', u'tenant_ns_name': u't5'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't5_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't5br1if1', u'vmif': u't5VM4if1'}]}, {u'local_ip': u'10.2.41.2', u'dsport': 4789, u'dev': u't5s1if', u'tenant_route_ip': u'192.168.133.2', u'remote_route': u'10.1.41.0/24', u'subnet_route': u'10.2.41.0/24', u'v_name': u'vxlan_t5s1', u'id': 42, u'remote_ip': u'10.1.41.2'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t5ns1\" brctl show \"t5br1\" | grep -w 'vxlan_t5s1' ; if [ $? -ne 0 ] ; then ip netns exec \"t5ns1\" brctl addif \"t5br1\" \"vxlan_t5s1\" ; fi\n", "delta": "0:00:00.076242", "end": "2019-11-18 11:21:49.606503", "item": [{"bridge_name": "t5br1", "default_route_ip": "10.2.41.1", "dns": [{"brif": "t5s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t5s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "ns_name": "t5ns1", "route": [{"if": "p1", "ip": "10.2.41.1/24", "ns_if": "t5if", "ns_name": "t5"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t5ns1if", "tenant_ns_ip": "10.2.41.1/24", "tenant_ns_name": "t5", "tenant_sub_if": "t5s1if", "tenant_sub_ip": "10.2.41.2/24"}], "vms": [{"brif": "t5br1if1", "disk": "10G", "mem": 2, "name": "t5_VM4", "vcpu": 4, "vmif": "t5VM4if1"}]}, {"dev": "t5s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.41.2", "remote_ip": "10.1.41.2", "remote_route": "10.1.41.0/24", "subnet_route": "10.2.41.0/24", "tenant_route_ip": "192.168.133.2", "v_name": "vxlan_t5s1"}], "rc": 0, "start": "2019-11-18 11:21:49.530261", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

PLAY RECAP **************************************************************************************************************************************************
99.99.99.2                 : ok=21   changed=21   unreachable=0    failed=0    skipped=0    rescued=0    ignored=0   

Using /etc/ansible/ansible.cfg as config file

PLAY [main] *************************************************************************************************************************************************

TASK [Add VXLAN routes in PNS] ******************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.41.1/24', u'ns_name': u't5', u'ns_if': u't5if', u'if': u'p1'}], u'default_route_ip': u'10.1.41.1', u'bridge_name': u't5br1', u'dns': [{u'dnsif': u't5s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't5s1_dnsbrif'}], u'ns_name': u't5ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.41.2/24', u'tenant_ns_ip': u'10.1.41.1/24', u'tenant_ns_if': u't5ns1if', u'tenant_sub_if': u't5s1if', u'tenant_ns_name': u't5'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't5_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't5br1if1', u'vmif': u't5VM1if1'}, {u'mem': 4, u'name': u't5_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't5br1if2', u'vmif': u't5VM2if1'}]}, {u'local_ip': u'10.1.41.2', u'dsport': 4789, u'dev': u't5s1if', u'tenant_route_ip': u'192.168.5.2', u'remote_route': u'10.2.41.0/24', u'subnet_route': u'10.1.41.0/24', u'v_name': u'vxlan_t5s1', u'id': 42, u'remote_ip': u'10.2.41.2'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec pns ip route show \"10.1.41.0/24\" via \"192.168.5.2\" | grep -w '^10.1.41.0/24' ; if [ $? -ne 0 ] ; then ip netns exec pns ip route add \"10.1.41.0/24\" via \"192.168.5.2\" ; fi\n", "delta": "0:00:00.089641", "end": "2019-11-18 11:21:50.861313", "item": [{"bridge_name": "t5br1", "default_route_ip": "10.1.41.1", "dns": [{"brif": "t5s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t5s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t5ns1", "route": [{"if": "p1", "ip": "10.1.41.1/24", "ns_if": "t5if", "ns_name": "t5"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t5ns1if", "tenant_ns_ip": "10.1.41.1/24", "tenant_ns_name": "t5", "tenant_sub_if": "t5s1if", "tenant_sub_ip": "10.1.41.2/24"}], "vms": [{"brif": "t5br1if1", "disk": "10G", "mem": 2, "name": "t5_VM1", "vcpu": 4, "vmif": "t5VM1if1"}, {"brif": "t5br1if2", "disk": "10G", "mem": 4, "name": "t5_VM2", "vcpu": 2, "vmif": "t5VM2if1"}]}, {"dev": "t5s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.41.2", "remote_ip": "10.2.41.2", "remote_route": "10.2.41.0/24", "subnet_route": "10.1.41.0/24", "tenant_route_ip": "192.168.5.2", "v_name": "vxlan_t5s1"}], "rc": 0, "start": "2019-11-18 11:21:50.771672", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}
skipping: [localhost] => (item=[{u'route': [{u'ip': u'10.1.42.1/24', u'ns_name': u't5', u'ns_if': u't5if', u'if': u'p1'}], u'default_route_ip': u'10.1.42.1', u'bridge_name': u't5br2', u'dns': [{u'dnsif': u't5s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't5s2_dnsbrif'}], u'ns_name': u't5ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.42.2/24', u'tenant_ns_ip': u'10.1.42.1/24', u'tenant_ns_if': u't5ns2if', u'tenant_sub_if': u't5s2if', u'tenant_ns_name': u't5'}], u'subnet_ip': u'2.2.2.0/24', u'vms': [{u'mem': 3, u'name': u't5_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't5br2if1', u'vmif': u't5VM3if1'}]}, {u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}])  => {"ansible_loop_var": "item", "changed": false, "item": [{"bridge_name": "t5br2", "default_route_ip": "10.1.42.1", "dns": [{"brif": "t5s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t5s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t5ns2", "route": [{"if": "p1", "ip": "10.1.42.1/24", "ns_if": "t5if", "ns_name": "t5"}], "subnet_ip": "2.2.2.0/24", "tenant_ns": [{"tenant_ns_if": "t5ns2if", "tenant_ns_ip": "10.1.42.1/24", "tenant_ns_name": "t5", "tenant_sub_if": "t5s2if", "tenant_sub_ip": "10.1.42.2/24"}], "vms": [{"brif": "t5br2if1", "disk": "10G", "mem": 3, "name": "t5_VM3", "vcpu": 2, "vmif": "t5VM3if1"}]}, {"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}], "skip_reason": "Conditional result was False"}

TASK [Get PNS ip address] ***********************************************************************************************************************************
ok: [localhost] => {"changed": false, "cmd": "ip netns exec pns ip addr show p1 | awk 'FNR==3{ print $2 }' | awk -F/ '{ print $1 }'\n", "delta": "0:00:00.036175", "end": "2019-11-18 11:21:51.194066", "rc": 0, "start": "2019-11-18 11:21:51.157891", "stderr": "", "stderr_lines": [], "stdout": "192.168.100.238", "stdout_lines": ["192.168.100.238"]}

TASK [Add VXLAN routes to host] *****************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.41.1/24', u'ns_name': u't5', u'ns_if': u't5if', u'if': u'p1'}], u'default_route_ip': u'10.1.41.1', u'bridge_name': u't5br1', u'dns': [{u'dnsif': u't5s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't5s1_dnsbrif'}], u'ns_name': u't5ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.41.2/24', u'tenant_ns_ip': u'10.1.41.1/24', u'tenant_ns_if': u't5ns1if', u'tenant_sub_if': u't5s1if', u'tenant_ns_name': u't5'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't5_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't5br1if1', u'vmif': u't5VM1if1'}, {u'mem': 4, u'name': u't5_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't5br1if2', u'vmif': u't5VM2if1'}]}, {u'local_ip': u'10.1.41.2', u'dsport': 4789, u'dev': u't5s1if', u'tenant_route_ip': u'192.168.5.2', u'remote_route': u'10.2.41.0/24', u'subnet_route': u'10.1.41.0/24', u'v_name': u'vxlan_t5s1', u'id': 42, u'remote_ip': u'10.2.41.2'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip route show \"10.1.41.0/24\" via \"192.168.100.238\" | grep -w '^10.1.41.0/24' ; if [ $? -ne 0 ] ; then ip route add \"10.1.41.0/24\" via \"192.168.100.238\" ; fi\nip route show \"10.2.41.0/24\" via 99.99.99.2 | grep -w '^10.2.41.0/24'; if [ $? -ne 0 ] ; then ip route add \"10.2.41.0/24\" via 99.99.99.2 ; fi\n", "delta": "0:00:00.011859", "end": "2019-11-18 11:21:51.510959", "item": [{"bridge_name": "t5br1", "default_route_ip": "10.1.41.1", "dns": [{"brif": "t5s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t5s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t5ns1", "route": [{"if": "p1", "ip": "10.1.41.1/24", "ns_if": "t5if", "ns_name": "t5"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t5ns1if", "tenant_ns_ip": "10.1.41.1/24", "tenant_ns_name": "t5", "tenant_sub_if": "t5s1if", "tenant_sub_ip": "10.1.41.2/24"}], "vms": [{"brif": "t5br1if1", "disk": "10G", "mem": 2, "name": "t5_VM1", "vcpu": 4, "vmif": "t5VM1if1"}, {"brif": "t5br1if2", "disk": "10G", "mem": 4, "name": "t5_VM2", "vcpu": 2, "vmif": "t5VM2if1"}]}, {"dev": "t5s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.41.2", "remote_ip": "10.2.41.2", "remote_route": "10.2.41.0/24", "subnet_route": "10.1.41.0/24", "tenant_route_ip": "192.168.5.2", "v_name": "vxlan_t5s1"}], "rc": 0, "start": "2019-11-18 11:21:51.499100", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}
skipping: [localhost] => (item=[{u'route': [{u'ip': u'10.1.42.1/24', u'ns_name': u't5', u'ns_if': u't5if', u'if': u'p1'}], u'default_route_ip': u'10.1.42.1', u'bridge_name': u't5br2', u'dns': [{u'dnsif': u't5s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't5s2_dnsbrif'}], u'ns_name': u't5ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.42.2/24', u'tenant_ns_ip': u'10.1.42.1/24', u'tenant_ns_if': u't5ns2if', u'tenant_sub_if': u't5s2if', u'tenant_ns_name': u't5'}], u'subnet_ip': u'2.2.2.0/24', u'vms': [{u'mem': 3, u'name': u't5_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't5br2if1', u'vmif': u't5VM3if1'}]}, {u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}])  => {"ansible_loop_var": "item", "changed": false, "item": [{"bridge_name": "t5br2", "default_route_ip": "10.1.42.1", "dns": [{"brif": "t5s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t5s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t5ns2", "route": [{"if": "p1", "ip": "10.1.42.1/24", "ns_if": "t5if", "ns_name": "t5"}], "subnet_ip": "2.2.2.0/24", "tenant_ns": [{"tenant_ns_if": "t5ns2if", "tenant_ns_ip": "10.1.42.1/24", "tenant_ns_name": "t5", "tenant_sub_if": "t5s2if", "tenant_sub_ip": "10.1.42.2/24"}], "vms": [{"brif": "t5br2if1", "disk": "10G", "mem": 3, "name": "t5_VM3", "vcpu": 2, "vmif": "t5VM3if1"}]}, {"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}], "skip_reason": "Conditional result was False"}

PLAY RECAP **************************************************************************************************************************************************
localhost                  : ok=3    changed=2    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0   

Using /etc/ansible/ansible.cfg as config file

PLAY [worker] ***********************************************************************************************************************************************

TASK [Add VXLAN routes in PNS] ******************************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.41.1/24', u'ns_name': u't5', u'ns_if': u't5if', u'if': u'p1'}], u'default_route_ip': u'10.2.41.1', u'bridge_name': u't5br1', u'dns': [{u'dnsif': u't5s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't5s1_dnsbrif'}], u'ns_name': u't5ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.41.2/24', u'tenant_ns_ip': u'10.2.41.1/24', u'tenant_ns_if': u't5ns1if', u'tenant_sub_if': u't5s1if', u'tenant_ns_name': u't5'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't5_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't5br1if1', u'vmif': u't5VM4if1'}]}, {u'local_ip': u'10.2.41.2', u'dsport': 4789, u'dev': u't5s1if', u'tenant_route_ip': u'192.168.133.2', u'remote_route': u'10.1.41.0/24', u'subnet_route': u'10.2.41.0/24', u'v_name': u'vxlan_t5s1', u'id': 42, u'remote_ip': u'10.1.41.2'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec pns ip route show \"10.2.41.0/24\" via \"192.168.133.2\" | grep -w '^10.2.41.0/24' ; if [ $? -ne 0 ] ; then ip netns exec pns ip route add \"10.2.41.0/24\" via \"192.168.133.2\" ; fi\n", "delta": "0:00:00.069470", "end": "2019-11-18 11:21:52.666407", "item": [{"bridge_name": "t5br1", "default_route_ip": "10.2.41.1", "dns": [{"brif": "t5s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t5s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "ns_name": "t5ns1", "route": [{"if": "p1", "ip": "10.2.41.1/24", "ns_if": "t5if", "ns_name": "t5"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t5ns1if", "tenant_ns_ip": "10.2.41.1/24", "tenant_ns_name": "t5", "tenant_sub_if": "t5s1if", "tenant_sub_ip": "10.2.41.2/24"}], "vms": [{"brif": "t5br1if1", "disk": "10G", "mem": 2, "name": "t5_VM4", "vcpu": 4, "vmif": "t5VM4if1"}]}, {"dev": "t5s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.41.2", "remote_ip": "10.1.41.2", "remote_route": "10.1.41.0/24", "subnet_route": "10.2.41.0/24", "tenant_route_ip": "192.168.133.2", "v_name": "vxlan_t5s1"}], "rc": 0, "start": "2019-11-18 11:21:52.596937", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Get PNS ip address] ***********************************************************************************************************************************
ok: [99.99.99.2] => {"changed": false, "cmd": "ip netns exec pns ip addr show p1 | awk 'FNR==3{ print $2 }' | awk -F/ '{ print $1 }'\n", "delta": "0:00:00.033866", "end": "2019-11-18 11:21:53.094889", "rc": 0, "start": "2019-11-18 11:21:53.061023", "stderr": "", "stderr_lines": [], "stdout": "192.168.100.50", "stdout_lines": ["192.168.100.50"]}

TASK [Add VXLAN routes to host] *****************************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.41.1/24', u'ns_name': u't5', u'ns_if': u't5if', u'if': u'p1'}], u'default_route_ip': u'10.2.41.1', u'bridge_name': u't5br1', u'dns': [{u'dnsif': u't5s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't5s1_dnsbrif'}], u'ns_name': u't5ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.41.2/24', u'tenant_ns_ip': u'10.2.41.1/24', u'tenant_ns_if': u't5ns1if', u'tenant_sub_if': u't5s1if', u'tenant_ns_name': u't5'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't5_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't5br1if1', u'vmif': u't5VM4if1'}]}, {u'local_ip': u'10.2.41.2', u'dsport': 4789, u'dev': u't5s1if', u'tenant_route_ip': u'192.168.133.2', u'remote_route': u'10.1.41.0/24', u'subnet_route': u'10.2.41.0/24', u'v_name': u'vxlan_t5s1', u'id': 42, u'remote_ip': u'10.1.41.2'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip route show \"10.2.41.0/24\" via \"192.168.100.50\" | grep -w '^10.2.41.0/24' ; if [ $? -ne 0 ] ; then ip route add \"10.2.41.0/24\" via \"192.168.100.50\" ; fi\nip route show \"10.1.41.0/24\" via 99.99.99.1 | grep -w '^10.1.41.0/24'; if [ $? -ne 0 ] ; then ip route add \"10.1.41.0/24\" via 99.99.99.1 ; fi\n", "delta": "0:00:00.009740", "end": "2019-11-18 11:21:53.519540", "item": [{"bridge_name": "t5br1", "default_route_ip": "10.2.41.1", "dns": [{"brif": "t5s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t5s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "ns_name": "t5ns1", "route": [{"if": "p1", "ip": "10.2.41.1/24", "ns_if": "t5if", "ns_name": "t5"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t5ns1if", "tenant_ns_ip": "10.2.41.1/24", "tenant_ns_name": "t5", "tenant_sub_if": "t5s1if", "tenant_sub_ip": "10.2.41.2/24"}], "vms": [{"brif": "t5br1if1", "disk": "10G", "mem": 2, "name": "t5_VM4", "vcpu": 4, "vmif": "t5VM4if1"}]}, {"dev": "t5s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.41.2", "remote_ip": "10.1.41.2", "remote_route": "10.1.41.0/24", "subnet_route": "10.2.41.0/24", "tenant_route_ip": "192.168.133.2", "v_name": "vxlan_t5s1"}], "rc": 0, "start": "2019-11-18 11:21:53.509800", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

PLAY RECAP **************************************************************************************************************************************************
99.99.99.2                 : ok=3    changed=2    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0   

Using /etc/ansible/ansible.cfg as config file

PLAY [main] *************************************************************************************************************************************************

TASK [Create VM templates (C1)] *****************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.41.1/24', u'ns_name': u't5', u'ns_if': u't5if', u'if': u'p1'}], u'default_route_ip': u'10.1.41.1', u'bridge_name': u't5br1', u'dns': [{u'dnsif': u't5s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't5s1_dnsbrif'}], u'ns_name': u't5ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.41.2/24', u'tenant_ns_ip': u'10.1.41.1/24', u'tenant_ns_if': u't5ns1if', u'tenant_sub_if': u't5s1if', u'tenant_ns_name': u't5'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.1.41.2', u'dsport': 4789, u'dev': u't5s1if', u'tenant_route_ip': u'192.168.5.2', u'remote_route': u'10.2.41.0/24', u'subnet_route': u'10.1.41.0/24', u'v_name': u'vxlan_t5s1', u'id': 42, u'remote_ip': u'10.2.41.2'}]}, {u'mem': 2, u'name': u't5_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't5br1if1', u'vmif': u't5VM1if1'}]) => {"ansible_loop_var": "item", "changed": true, "checksum": "350ba870bd31b7f6ee517845c14237910b5af0bf", "dest": "/root/Migration-as-a-Service/t5/VM_templates/t5_VM1.xml.j2", "gid": 0, "group": "root", "item": [{"bridge_name": "t5br1", "default_route_ip": "10.1.41.1", "dns": [{"brif": "t5s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t5s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t5ns1", "route": [{"if": "p1", "ip": "10.1.41.1/24", "ns_if": "t5if", "ns_name": "t5"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t5ns1if", "tenant_ns_ip": "10.1.41.1/24", "tenant_ns_name": "t5", "tenant_sub_if": "t5s1if", "tenant_sub_ip": "10.1.41.2/24"}], "vxlan": [{"dev": "t5s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.41.2", "remote_ip": "10.2.41.2", "remote_route": "10.2.41.0/24", "subnet_route": "10.1.41.0/24", "tenant_route_ip": "192.168.5.2", "v_name": "vxlan_t5s1"}]}, {"brif": "t5br1if1", "disk": "10G", "mem": 2, "name": "t5_VM1", "vcpu": 4, "vmif": "t5VM1if1"}], "md5sum": "fbfc2eb0c2569531f25eea92c26d3bee", "mode": "0644", "owner": "root", "size": 4091, "src": "/root/.ansible/tmp/ansible-tmp-1574076114.28-109899421015211/source", "state": "file", "uid": 0}
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.41.1/24', u'ns_name': u't5', u'ns_if': u't5if', u'if': u'p1'}], u'default_route_ip': u'10.1.41.1', u'bridge_name': u't5br1', u'dns': [{u'dnsif': u't5s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't5s1_dnsbrif'}], u'ns_name': u't5ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.41.2/24', u'tenant_ns_ip': u'10.1.41.1/24', u'tenant_ns_if': u't5ns1if', u'tenant_sub_if': u't5s1if', u'tenant_ns_name': u't5'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.1.41.2', u'dsport': 4789, u'dev': u't5s1if', u'tenant_route_ip': u'192.168.5.2', u'remote_route': u'10.2.41.0/24', u'subnet_route': u'10.1.41.0/24', u'v_name': u'vxlan_t5s1', u'id': 42, u'remote_ip': u'10.2.41.2'}]}, {u'mem': 4, u'name': u't5_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't5br1if2', u'vmif': u't5VM2if1'}]) => {"ansible_loop_var": "item", "changed": true, "checksum": "350ba870bd31b7f6ee517845c14237910b5af0bf", "dest": "/root/Migration-as-a-Service/t5/VM_templates/t5_VM2.xml.j2", "gid": 0, "group": "root", "item": [{"bridge_name": "t5br1", "default_route_ip": "10.1.41.1", "dns": [{"brif": "t5s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t5s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t5ns1", "route": [{"if": "p1", "ip": "10.1.41.1/24", "ns_if": "t5if", "ns_name": "t5"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t5ns1if", "tenant_ns_ip": "10.1.41.1/24", "tenant_ns_name": "t5", "tenant_sub_if": "t5s1if", "tenant_sub_ip": "10.1.41.2/24"}], "vxlan": [{"dev": "t5s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.41.2", "remote_ip": "10.2.41.2", "remote_route": "10.2.41.0/24", "subnet_route": "10.1.41.0/24", "tenant_route_ip": "192.168.5.2", "v_name": "vxlan_t5s1"}]}, {"brif": "t5br1if2", "disk": "10G", "mem": 4, "name": "t5_VM2", "vcpu": 2, "vmif": "t5VM2if1"}], "md5sum": "fbfc2eb0c2569531f25eea92c26d3bee", "mode": "0644", "owner": "root", "size": 4091, "src": "/root/.ansible/tmp/ansible-tmp-1574076114.88-248600793075933/source", "state": "file", "uid": 0}
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.42.1/24', u'ns_name': u't5', u'ns_if': u't5if', u'if': u'p1'}], u'default_route_ip': u'10.1.42.1', u'bridge_name': u't5br2', u'dns': [{u'dnsif': u't5s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't5s2_dnsbrif'}], u'ns_name': u't5ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.42.2/24', u'tenant_ns_ip': u'10.1.42.1/24', u'tenant_ns_if': u't5ns2if', u'tenant_sub_if': u't5s2if', u'tenant_ns_name': u't5'}], u'subnet_ip': u'2.2.2.0/24', u'vxlan': [{u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}, {u'mem': 3, u'name': u't5_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't5br2if1', u'vmif': u't5VM3if1'}]) => {"ansible_loop_var": "item", "changed": true, "checksum": "350ba870bd31b7f6ee517845c14237910b5af0bf", "dest": "/root/Migration-as-a-Service/t5/VM_templates/t5_VM3.xml.j2", "gid": 0, "group": "root", "item": [{"bridge_name": "t5br2", "default_route_ip": "10.1.42.1", "dns": [{"brif": "t5s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t5s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t5ns2", "route": [{"if": "p1", "ip": "10.1.42.1/24", "ns_if": "t5if", "ns_name": "t5"}], "subnet_ip": "2.2.2.0/24", "tenant_ns": [{"tenant_ns_if": "t5ns2if", "tenant_ns_ip": "10.1.42.1/24", "tenant_ns_name": "t5", "tenant_sub_if": "t5s2if", "tenant_sub_ip": "10.1.42.2/24"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, {"brif": "t5br2if1", "disk": "10G", "mem": 3, "name": "t5_VM3", "vcpu": 2, "vmif": "t5VM3if1"}], "md5sum": "fbfc2eb0c2569531f25eea92c26d3bee", "mode": "0644", "owner": "root", "size": 4091, "src": "/root/.ansible/tmp/ansible-tmp-1574076115.1-220109381113181/source", "state": "file", "uid": 0}

PLAY RECAP **************************************************************************************************************************************************
localhost                  : ok=1    changed=1    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0   

Using /etc/ansible/ansible.cfg as config file

PLAY [main] *************************************************************************************************************************************************

TASK [Create VM templates (C2)] *****************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.2.41.1/24', u'ns_name': u't5', u'ns_if': u't5if', u'if': u'p1'}], u'default_route_ip': u'10.2.41.1', u'bridge_name': u't5br1', u'dns': [{u'dnsif': u't5s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't5s1_dnsbrif'}], u'ns_name': u't5ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.41.2/24', u'tenant_ns_ip': u'10.2.41.1/24', u'tenant_ns_if': u't5ns1if', u'tenant_sub_if': u't5s1if', u'tenant_ns_name': u't5'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.2.41.2', u'dsport': 4789, u'dev': u't5s1if', u'tenant_route_ip': u'192.168.133.2', u'remote_route': u'10.1.41.0/24', u'subnet_route': u'10.2.41.0/24', u'v_name': u'vxlan_t5s1', u'id': 42, u'remote_ip': u'10.1.41.2'}]}, {u'mem': 2, u'name': u't5_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't5br1if1', u'vmif': u't5VM4if1'}]) => {"ansible_loop_var": "item", "changed": true, "checksum": "350ba870bd31b7f6ee517845c14237910b5af0bf", "dest": "/root/Migration-as-a-Service/t5/VM_templates/t5_VM4.xml.j2", "gid": 0, "group": "root", "item": [{"bridge_name": "t5br1", "default_route_ip": "10.2.41.1", "dns": [{"brif": "t5s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t5s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "ns_name": "t5ns1", "route": [{"if": "p1", "ip": "10.2.41.1/24", "ns_if": "t5if", "ns_name": "t5"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t5ns1if", "tenant_ns_ip": "10.2.41.1/24", "tenant_ns_name": "t5", "tenant_sub_if": "t5s1if", "tenant_sub_ip": "10.2.41.2/24"}], "vxlan": [{"dev": "t5s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.41.2", "remote_ip": "10.1.41.2", "remote_route": "10.1.41.0/24", "subnet_route": "10.2.41.0/24", "tenant_route_ip": "192.168.133.2", "v_name": "vxlan_t5s1"}]}, {"brif": "t5br1if1", "disk": "10G", "mem": 2, "name": "t5_VM4", "vcpu": 4, "vmif": "t5VM4if1"}], "md5sum": "fbfc2eb0c2569531f25eea92c26d3bee", "mode": "0644", "owner": "root", "size": 4091, "src": "/root/.ansible/tmp/ansible-tmp-1574076115.93-44790941788137/source", "state": "file", "uid": 0}

PLAY RECAP **************************************************************************************************************************************************
localhost                  : ok=1    changed=1    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0   

Using /etc/ansible/ansible.cfg as config file

PLAY [main] *************************************************************************************************************************************************

TASK [Copy VM image] ****************************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.41.1/24', u'ns_name': u't5', u'ns_if': u't5if', u'if': u'p1'}], u'default_route_ip': u'10.1.41.1', u'bridge_name': u't5br1', u'dns': [{u'dnsif': u't5s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't5s1_dnsbrif'}], u'ns_name': u't5ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.41.2/24', u'tenant_ns_ip': u'10.1.41.1/24', u'tenant_ns_if': u't5ns1if', u'tenant_sub_if': u't5s1if', u'tenant_ns_name': u't5'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.1.41.2', u'dsport': 4789, u'dev': u't5s1if', u'tenant_route_ip': u'192.168.5.2', u'remote_route': u'10.2.41.0/24', u'subnet_route': u'10.1.41.0/24', u'v_name': u'vxlan_t5s1', u'id': 42, u'remote_ip': u'10.2.41.2'}]}, {u'mem': 2, u'name': u't5_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't5br1if1', u'vmif': u't5VM1if1'}]) => {"ansible_loop_var": "item", "changed": true, "checksum": "d86d5962370fcd0c3d05943fc209d9e05fdac89f", "dest": "/var/lib/libvirt/images/t5_VM1.qcow2", "gid": 0, "group": "root", "item": [{"bridge_name": "t5br1", "default_route_ip": "10.1.41.1", "dns": [{"brif": "t5s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t5s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t5ns1", "route": [{"if": "p1", "ip": "10.1.41.1/24", "ns_if": "t5if", "ns_name": "t5"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t5ns1if", "tenant_ns_ip": "10.1.41.1/24", "tenant_ns_name": "t5", "tenant_sub_if": "t5s1if", "tenant_sub_ip": "10.1.41.2/24"}], "vxlan": [{"dev": "t5s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.41.2", "remote_ip": "10.2.41.2", "remote_route": "10.2.41.0/24", "subnet_route": "10.1.41.0/24", "tenant_route_ip": "192.168.5.2", "v_name": "vxlan_t5s1"}]}, {"brif": "t5br1if1", "disk": "10G", "mem": 2, "name": "t5_VM1", "vcpu": 4, "vmif": "t5VM1if1"}], "md5sum": "b977a19124b65f2d544ddc62e407114d", "mode": "0644", "owner": "root", "size": 10739318784, "src": "/root/.ansible/tmp/ansible-tmp-1574076117.27-53883501610902/source", "state": "file", "uid": 0}
fatal: [localhost]: FAILED! => {"msg": "failed to transfer file to /root/.ansible/tmp/ansible-tmp-1574076247.24-158840385358955/source: [Errno 28] No space left on device"}

PLAY RECAP **************************************************************************************************************************************************
localhost                  : ok=0    changed=0    unreachable=0    failed=1    skipped=0    rescued=0    ignored=0   

INFO:root: 11:37:22.568980 Printing the yaml input file
INFO:root: 11:37:22.581042 {'C1': [{'subnet_addr': '1.1.1.0/24', 'VM': [{'name': 'VM1', 'disk': '10G', 'mem': 2, 'vcpu': 4, 'internet_access': True}, {'name': 'VM2', 'disk': '10G', 'mem': 4, 'vcpu': 2, 'internet_access': False}]}, {'subnet_addr': '2.2.2.0/24', 'VM': [{'name': 'VM3', 'disk': '10G', 'mem': 3, 'vcpu': 2, 'internet_access': True}]}], 'C2': [{'subnet_addr': '1.1.1.0/24', 'VM': [{'name': 'VM4', 'disk': '10G', 'mem': 2, 'vcpu': 4, 'internet_access': True}]}]}
INFO:root: 11:37:22.581358 Provided subnet in C1: 1.1.1.0/24 is valid
INFO:root: 11:37:22.581467 Provided subnet in C1: 2.2.2.0/24 is valid
INFO:root: 11:37:22.581517 Provided subnet in C2: 1.1.1.0/24 is valid
Using /etc/ansible/ansible.cfg as config file

PLAY [main] *************************************************************************************************************************************************

TASK [Create Tenant Namespace] ******************************************************************************************************************************
changed: [localhost] => (item={u'default_route_ip': u'192.168.1.1', u'name': u't1', u'pns_ip': u'192.168.1.1/24', u'tenant_if': u't1if', u'tenant_ip': u'192.168.1.2/24', u'pns_if': u't1pns_if'}) => {"ansible_loop_var": "item", "changed": true, "cmd": ["ip", "netns", "add", "t1"], "delta": "0:00:00.049152", "end": "2019-11-18 11:37:24.012703", "item": {"default_route_ip": "192.168.1.1", "name": "t1", "pns_if": "t1pns_if", "pns_ip": "192.168.1.1/24", "tenant_if": "t1if", "tenant_ip": "192.168.1.2/24"}, "rc": 0, "start": "2019-11-18 11:37:23.963551", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Create Subnet Namespace] ******************************************************************************************************************************
changed: [localhost] => (item={u'route': [{u'ip': u'10.1.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.1.2/24', u'tenant_ns_ip': u'10.1.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_ns_name': u't1', u'tenant_sub_if': u't1s1if'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't1_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM1if1'}, {u'mem': 4, u'name': u't1_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br1if2', u'vmif': u't1VM2if1'}], u'vxlan': [{u'local_ip': u'10.1.1.2', u'tenant_route_ip': u'192.168.1.2', u'dsport': 4789, u'dev': u't1s1if', u'subnet_route': u'10.1.1.0/24', u'remote_route': u'10.2.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.2.1.2'}]}) => {"ansible_loop_var": "item", "changed": true, "cmd": ["ip", "netns", "add", "t1ns1"], "delta": "0:00:00.048956", "end": "2019-11-18 11:37:24.344632", "item": {"bridge_name": "t1br1", "default_route_ip": "10.1.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.1.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.1.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.1.1.2/24"}], "vms": [{"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM1", "vcpu": 4, "vmif": "t1VM1if1"}, {"brif": "t1br1if2", "disk": "10G", "mem": 4, "name": "t1_VM2", "vcpu": 2, "vmif": "t1VM2if1"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.1.2", "remote_ip": "10.2.1.2", "remote_route": "10.2.1.0/24", "subnet_route": "10.1.1.0/24", "tenant_route_ip": "192.168.1.2", "v_name": "vxlan_t1s1"}]}, "rc": 0, "start": "2019-11-18 11:37:24.295676", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}
changed: [localhost] => (item={u'route': [{u'ip': u'10.1.2.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.2.1', u'bridge_name': u't1br2', u'dns': [{u'dnsif': u't1s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s2_dnsbrif'}], u'ns_name': u't1ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.2.2/24', u'tenant_ns_ip': u'10.1.2.1/24', u'tenant_ns_if': u't1ns2if', u'tenant_ns_name': u't1', u'tenant_sub_if': u't1s2if'}], u'subnet_ip': u'2.2.2.0/24', u'vms': [{u'mem': 3, u'name': u't1_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br2if1', u'vmif': u't1VM3if1'}], u'vxlan': [{u'local_ip': [], u'tenant_route_ip': [], u'dsport': [], u'dev': [], u'subnet_route': [], u'remote_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}) => {"ansible_loop_var": "item", "changed": true, "cmd": ["ip", "netns", "add", "t1ns2"], "delta": "0:00:00.055181", "end": "2019-11-18 11:37:24.602578", "item": {"bridge_name": "t1br2", "default_route_ip": "10.1.2.1", "dns": [{"brif": "t1s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t1s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns2", "route": [{"if": "p1", "ip": "10.1.2.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "2.2.2.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns2if", "tenant_ns_ip": "10.1.2.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s2if", "tenant_sub_ip": "10.1.2.2/24"}], "vms": [{"brif": "t1br2if1", "disk": "10G", "mem": 3, "name": "t1_VM3", "vcpu": 2, "vmif": "t1VM3if1"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, "rc": 0, "start": "2019-11-18 11:37:24.547397", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Create Tenant VETH pairs] *****************************************************************************************************************************
changed: [localhost] => (item={u'default_route_ip': u'192.168.1.1', u'name': u't1', u'pns_ip': u'192.168.1.1/24', u'tenant_if': u't1if', u'tenant_ip': u'192.168.1.2/24', u'pns_if': u't1pns_if'}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip link show \"t1if\" ; if [ $? -ne 0 ] ; then ip link add \"t1if\" type veth peer name \"t1pns_if\" ; fi\n", "delta": "0:00:00.010404", "end": "2019-11-18 11:37:24.845118", "item": {"default_route_ip": "192.168.1.1", "name": "t1", "pns_if": "t1pns_if", "pns_ip": "192.168.1.1/24", "tenant_if": "t1if", "tenant_ip": "192.168.1.2/24"}, "rc": 0, "start": "2019-11-18 11:37:24.834714", "stderr": "Device \"t1if\" does not exist.", "stderr_lines": ["Device \"t1if\" does not exist."], "stdout": "", "stdout_lines": []}

TASK [Attach Tenant VETH Pairs] *****************************************************************************************************************************
changed: [localhost] => (item={u'default_route_ip': u'192.168.1.1', u'name': u't1', u'pns_ip': u'192.168.1.1/24', u'tenant_if': u't1if', u'tenant_ip': u'192.168.1.2/24', u'pns_if': u't1pns_if'}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec pns ip link show \"t1pns_if\" ; if [ $? -ne 0 ] ; then ip link set \"t1pns_if\" netns pns ; fi\nip netns exec \"t1\" ip link show \"t1if\" ; if [ $? -ne 0 ] ; then ip link set \"t1if\" netns \"t1\" ; fi\nip netns exec pns ip link set dev \"t1pns_if\" up\nip netns exec \"t1\" ip link set dev \"t1if\" up\n", "delta": "0:00:00.182803", "end": "2019-11-18 11:37:25.268278", "item": {"default_route_ip": "192.168.1.1", "name": "t1", "pns_if": "t1pns_if", "pns_ip": "192.168.1.1/24", "tenant_if": "t1if", "tenant_ip": "192.168.1.2/24"}, "rc": 0, "start": "2019-11-18 11:37:25.085475", "stderr": "Device \"t1pns_if\" does not exist.\nDevice \"t1if\" does not exist.", "stderr_lines": ["Device \"t1pns_if\" does not exist.", "Device \"t1if\" does not exist."], "stdout": "", "stdout_lines": []}

TASK [Add IP addresses to Tenant VETH Pairs] ****************************************************************************************************************
changed: [localhost] => (item={u'default_route_ip': u'192.168.1.1', u'name': u't1', u'pns_ip': u'192.168.1.1/24', u'tenant_if': u't1if', u'tenant_ip': u'192.168.1.2/24', u'pns_if': u't1pns_if'}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec pns ip addr show \"t1pns_if\" | awk 'FNR==3{ print $2 }' | grep -w '^192.168.1.1/24' ; if [ $? -ne 0 ] ; then ip netns exec pns ip addr add \"192.168.1.1/24\" dev \"t1pns_if\" ; fi\nip netns exec \"t1\" ip addr show \"t1if\" | awk 'FNR==3{ print $2 }' | grep -w '^192.168.1.2/24' ; if [ $? -ne 0 ] ; then ip netns exec \"t1\" ip addr add \"192.168.1.2/24\" dev \"t1if\" ; fi\n", "delta": "0:00:00.144979", "end": "2019-11-18 11:37:25.660579", "item": {"default_route_ip": "192.168.1.1", "name": "t1", "pns_if": "t1pns_if", "pns_ip": "192.168.1.1/24", "tenant_if": "t1if", "tenant_ip": "192.168.1.2/24"}, "rc": 0, "start": "2019-11-18 11:37:25.515600", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Create Namespace VETH Pairs] **************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't1_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM1if1'}, {u'mem': 4, u'name': u't1_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br1if2', u'vmif': u't1VM2if1'}], u'vxlan': [{u'local_ip': u'10.1.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.1.2', u'remote_route': u'10.2.1.0/24', u'subnet_route': u'10.1.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.2.1.2'}]}, {u'tenant_sub_ip': u'10.1.1.2/24', u'tenant_ns_ip': u'10.1.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip link show \"t1ns1if\" ; if [ $? -ne 0 ] ; then ip link add \"t1ns1if\" type veth peer name \"t1s1if\" ; fi\n", "delta": "0:00:00.008399", "end": "2019-11-18 11:37:25.951333", "item": [{"bridge_name": "t1br1", "default_route_ip": "10.1.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.1.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "vms": [{"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM1", "vcpu": 4, "vmif": "t1VM1if1"}, {"brif": "t1br1if2", "disk": "10G", "mem": 4, "name": "t1_VM2", "vcpu": 2, "vmif": "t1VM2if1"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.1.2", "remote_ip": "10.2.1.2", "remote_route": "10.2.1.0/24", "subnet_route": "10.1.1.0/24", "tenant_route_ip": "192.168.1.2", "v_name": "vxlan_t1s1"}]}, {"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.1.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.1.1.2/24"}], "rc": 0, "start": "2019-11-18 11:37:25.942934", "stderr": "Device \"t1ns1if\" does not exist.", "stderr_lines": ["Device \"t1ns1if\" does not exist."], "stdout": "", "stdout_lines": []}
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.2.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.2.1', u'bridge_name': u't1br2', u'dns': [{u'dnsif': u't1s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s2_dnsbrif'}], u'ns_name': u't1ns2', u'subnet_ip': u'2.2.2.0/24', u'vms': [{u'mem': 3, u'name': u't1_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br2if1', u'vmif': u't1VM3if1'}], u'vxlan': [{u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}, {u'tenant_sub_ip': u'10.1.2.2/24', u'tenant_ns_ip': u'10.1.2.1/24', u'tenant_ns_if': u't1ns2if', u'tenant_sub_if': u't1s2if', u'tenant_ns_name': u't1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip link show \"t1ns2if\" ; if [ $? -ne 0 ] ; then ip link add \"t1ns2if\" type veth peer name \"t1s2if\" ; fi\n", "delta": "0:00:00.009030", "end": "2019-11-18 11:37:26.168144", "item": [{"bridge_name": "t1br2", "default_route_ip": "10.1.2.1", "dns": [{"brif": "t1s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t1s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns2", "route": [{"if": "p1", "ip": "10.1.2.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "2.2.2.0/24", "vms": [{"brif": "t1br2if1", "disk": "10G", "mem": 3, "name": "t1_VM3", "vcpu": 2, "vmif": "t1VM3if1"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, {"tenant_ns_if": "t1ns2if", "tenant_ns_ip": "10.1.2.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s2if", "tenant_sub_ip": "10.1.2.2/24"}], "rc": 0, "start": "2019-11-18 11:37:26.159114", "stderr": "Device \"t1ns2if\" does not exist.", "stderr_lines": ["Device \"t1ns2if\" does not exist."], "stdout": "", "stdout_lines": []}

TASK [Attach Namespace VETH Pairs] **************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't1_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM1if1'}, {u'mem': 4, u'name': u't1_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br1if2', u'vmif': u't1VM2if1'}], u'vxlan': [{u'local_ip': u'10.1.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.1.2', u'remote_route': u'10.2.1.0/24', u'subnet_route': u'10.1.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.2.1.2'}]}, {u'tenant_sub_ip': u'10.1.1.2/24', u'tenant_ns_ip': u'10.1.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t1\" ip link show \"t1ns1if\" ; if [ $? -ne 0 ] ; then ip link set \"t1ns1if\" netns \"t1\" ; fi\nip netns exec \"t1ns1\" ip link show \"t1s1if\" ; if [ $? -ne 0 ] ; then ip link set \"t1s1if\" netns \"t1ns1\" ; fi\n", "delta": "0:00:00.112151", "end": "2019-11-18 11:37:26.551023", "item": [{"bridge_name": "t1br1", "default_route_ip": "10.1.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.1.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "vms": [{"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM1", "vcpu": 4, "vmif": "t1VM1if1"}, {"brif": "t1br1if2", "disk": "10G", "mem": 4, "name": "t1_VM2", "vcpu": 2, "vmif": "t1VM2if1"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.1.2", "remote_ip": "10.2.1.2", "remote_route": "10.2.1.0/24", "subnet_route": "10.1.1.0/24", "tenant_route_ip": "192.168.1.2", "v_name": "vxlan_t1s1"}]}, {"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.1.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.1.1.2/24"}], "rc": 0, "start": "2019-11-18 11:37:26.438872", "stderr": "Device \"t1ns1if\" does not exist.\nDevice \"t1s1if\" does not exist.", "stderr_lines": ["Device \"t1ns1if\" does not exist.", "Device \"t1s1if\" does not exist."], "stdout": "", "stdout_lines": []}
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.2.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.2.1', u'bridge_name': u't1br2', u'dns': [{u'dnsif': u't1s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s2_dnsbrif'}], u'ns_name': u't1ns2', u'subnet_ip': u'2.2.2.0/24', u'vms': [{u'mem': 3, u'name': u't1_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br2if1', u'vmif': u't1VM3if1'}], u'vxlan': [{u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}, {u'tenant_sub_ip': u'10.1.2.2/24', u'tenant_ns_ip': u'10.1.2.1/24', u'tenant_ns_if': u't1ns2if', u'tenant_sub_if': u't1s2if', u'tenant_ns_name': u't1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t1\" ip link show \"t1ns2if\" ; if [ $? -ne 0 ] ; then ip link set \"t1ns2if\" netns \"t1\" ; fi\nip netns exec \"t1ns2\" ip link show \"t1s2if\" ; if [ $? -ne 0 ] ; then ip link set \"t1s2if\" netns \"t1ns2\" ; fi\n", "delta": "0:00:00.102715", "end": "2019-11-18 11:37:26.857749", "item": [{"bridge_name": "t1br2", "default_route_ip": "10.1.2.1", "dns": [{"brif": "t1s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t1s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns2", "route": [{"if": "p1", "ip": "10.1.2.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "2.2.2.0/24", "vms": [{"brif": "t1br2if1", "disk": "10G", "mem": 3, "name": "t1_VM3", "vcpu": 2, "vmif": "t1VM3if1"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, {"tenant_ns_if": "t1ns2if", "tenant_ns_ip": "10.1.2.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s2if", "tenant_sub_ip": "10.1.2.2/24"}], "rc": 0, "start": "2019-11-18 11:37:26.755034", "stderr": "Device \"t1ns2if\" does not exist.\nDevice \"t1s2if\" does not exist.", "stderr_lines": ["Device \"t1ns2if\" does not exist.", "Device \"t1s2if\" does not exist."], "stdout": "", "stdout_lines": []}

TASK [Set Namespace VETH Pairs UP] **************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't1_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM1if1'}, {u'mem': 4, u'name': u't1_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br1if2', u'vmif': u't1VM2if1'}], u'vxlan': [{u'local_ip': u'10.1.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.1.2', u'remote_route': u'10.2.1.0/24', u'subnet_route': u'10.1.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.2.1.2'}]}, {u'tenant_sub_ip': u'10.1.1.2/24', u'tenant_ns_ip': u'10.1.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t1\" ip link set dev \"t1ns1if\" up\nip netns exec \"t1ns1\" ip link set dev \"t1s1if\" up\n", "delta": "0:00:00.088771", "end": "2019-11-18 11:37:27.208413", "item": [{"bridge_name": "t1br1", "default_route_ip": "10.1.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.1.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "vms": [{"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM1", "vcpu": 4, "vmif": "t1VM1if1"}, {"brif": "t1br1if2", "disk": "10G", "mem": 4, "name": "t1_VM2", "vcpu": 2, "vmif": "t1VM2if1"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.1.2", "remote_ip": "10.2.1.2", "remote_route": "10.2.1.0/24", "subnet_route": "10.1.1.0/24", "tenant_route_ip": "192.168.1.2", "v_name": "vxlan_t1s1"}]}, {"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.1.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.1.1.2/24"}], "rc": 0, "start": "2019-11-18 11:37:27.119642", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.2.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.2.1', u'bridge_name': u't1br2', u'dns': [{u'dnsif': u't1s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s2_dnsbrif'}], u'ns_name': u't1ns2', u'subnet_ip': u'2.2.2.0/24', u'vms': [{u'mem': 3, u'name': u't1_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br2if1', u'vmif': u't1VM3if1'}], u'vxlan': [{u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}, {u'tenant_sub_ip': u'10.1.2.2/24', u'tenant_ns_ip': u'10.1.2.1/24', u'tenant_ns_if': u't1ns2if', u'tenant_sub_if': u't1s2if', u'tenant_ns_name': u't1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t1\" ip link set dev \"t1ns2if\" up\nip netns exec \"t1ns2\" ip link set dev \"t1s2if\" up\n", "delta": "0:00:00.074091", "end": "2019-11-18 11:37:27.484600", "item": [{"bridge_name": "t1br2", "default_route_ip": "10.1.2.1", "dns": [{"brif": "t1s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t1s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns2", "route": [{"if": "p1", "ip": "10.1.2.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "2.2.2.0/24", "vms": [{"brif": "t1br2if1", "disk": "10G", "mem": 3, "name": "t1_VM3", "vcpu": 2, "vmif": "t1VM3if1"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, {"tenant_ns_if": "t1ns2if", "tenant_ns_ip": "10.1.2.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s2if", "tenant_sub_ip": "10.1.2.2/24"}], "rc": 0, "start": "2019-11-18 11:37:27.410509", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Add IP addresses to Namespace VETH Pairs] *************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't1_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM1if1'}, {u'mem': 4, u'name': u't1_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br1if2', u'vmif': u't1VM2if1'}], u'vxlan': [{u'local_ip': u'10.1.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.1.2', u'remote_route': u'10.2.1.0/24', u'subnet_route': u'10.1.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.2.1.2'}]}, {u'tenant_sub_ip': u'10.1.1.2/24', u'tenant_ns_ip': u'10.1.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t1ns1\" ip addr show \"t1s1if\" | awk 'FNR==3{ print $2 }' | grep -w '^10.1.1.2/24' ; if [ $? -ne 0 ] ; then ip netns exec \"t1ns1\" ip addr add \"10.1.1.2/24\" dev \"t1s1if\" ; fi\n\nip netns exec \"t1\" ip addr show \"t1ns1if\" | awk 'FNR==3{ print $2 }' | grep -w '^10.1.1.1/24' ; if [ $? -ne 0 ] ; then ip netns exec \"t1\" ip addr add \"10.1.1.1/24\" dev \"t1ns1if\" ; fi\n", "delta": "0:00:00.143401", "end": "2019-11-18 11:37:27.872506", "item": [{"bridge_name": "t1br1", "default_route_ip": "10.1.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.1.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "vms": [{"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM1", "vcpu": 4, "vmif": "t1VM1if1"}, {"brif": "t1br1if2", "disk": "10G", "mem": 4, "name": "t1_VM2", "vcpu": 2, "vmif": "t1VM2if1"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.1.2", "remote_ip": "10.2.1.2", "remote_route": "10.2.1.0/24", "subnet_route": "10.1.1.0/24", "tenant_route_ip": "192.168.1.2", "v_name": "vxlan_t1s1"}]}, {"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.1.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.1.1.2/24"}], "rc": 0, "start": "2019-11-18 11:37:27.729105", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.2.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.2.1', u'bridge_name': u't1br2', u'dns': [{u'dnsif': u't1s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s2_dnsbrif'}], u'ns_name': u't1ns2', u'subnet_ip': u'2.2.2.0/24', u'vms': [{u'mem': 3, u'name': u't1_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br2if1', u'vmif': u't1VM3if1'}], u'vxlan': [{u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}, {u'tenant_sub_ip': u'10.1.2.2/24', u'tenant_ns_ip': u'10.1.2.1/24', u'tenant_ns_if': u't1ns2if', u'tenant_sub_if': u't1s2if', u'tenant_ns_name': u't1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t1ns2\" ip addr show \"t1s2if\" | awk 'FNR==3{ print $2 }' | grep -w '^10.1.2.2/24' ; if [ $? -ne 0 ] ; then ip netns exec \"t1ns2\" ip addr add \"10.1.2.2/24\" dev \"t1s2if\" ; fi\n\nip netns exec \"t1\" ip addr show \"t1ns2if\" | awk 'FNR==3{ print $2 }' | grep -w '^10.1.2.1/24' ; if [ $? -ne 0 ] ; then ip netns exec \"t1\" ip addr add \"10.1.2.1/24\" dev \"t1ns2if\" ; fi\n", "delta": "0:00:00.157215", "end": "2019-11-18 11:37:28.208607", "item": [{"bridge_name": "t1br2", "default_route_ip": "10.1.2.1", "dns": [{"brif": "t1s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t1s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns2", "route": [{"if": "p1", "ip": "10.1.2.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "2.2.2.0/24", "vms": [{"brif": "t1br2if1", "disk": "10G", "mem": 3, "name": "t1_VM3", "vcpu": 2, "vmif": "t1VM3if1"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, {"tenant_ns_if": "t1ns2if", "tenant_ns_ip": "10.1.2.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s2if", "tenant_sub_ip": "10.1.2.2/24"}], "rc": 0, "start": "2019-11-18 11:37:28.051392", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Add IP Route to Tenant] *******************************************************************************************************************************
changed: [localhost] => (item={u'default_route_ip': u'192.168.1.1', u'name': u't1', u'pns_ip': u'192.168.1.1/24', u'tenant_if': u't1if', u'tenant_ip': u'192.168.1.2/24', u'pns_if': u't1pns_if'}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t1\" ip route show default | grep -w '[d]efault via 192.168.1.1' ; if [ $? -ne 0 ] ; then ip netns exec \"t1\" ip route add default via \"192.168.1.1\" ; fi\n", "delta": "0:00:00.081392", "end": "2019-11-18 11:37:28.520413", "item": {"default_route_ip": "192.168.1.1", "name": "t1", "pns_if": "t1pns_if", "pns_ip": "192.168.1.1/24", "tenant_if": "t1if", "tenant_ip": "192.168.1.2/24"}, "rc": 0, "start": "2019-11-18 11:37:28.439021", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Add IP Route to Tenant Subnet] ************************************************************************************************************************
changed: [localhost] => (item={u'route': [{u'ip': u'10.1.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.1.2/24', u'tenant_ns_ip': u'10.1.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_ns_name': u't1', u'tenant_sub_if': u't1s1if'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't1_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM1if1'}, {u'mem': 4, u'name': u't1_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br1if2', u'vmif': u't1VM2if1'}], u'vxlan': [{u'local_ip': u'10.1.1.2', u'tenant_route_ip': u'192.168.1.2', u'dsport': 4789, u'dev': u't1s1if', u'subnet_route': u'10.1.1.0/24', u'remote_route': u'10.2.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.2.1.2'}]}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t1ns1\" ip route show default | grep -w '[d]efault via 10.1.1.1' ; if [ $? -ne 0 ] ; then ip netns exec \"t1ns1\" ip route add default via \"10.1.1.1\" ; fi\n", "delta": "0:00:00.069971", "end": "2019-11-18 11:37:28.852513", "item": {"bridge_name": "t1br1", "default_route_ip": "10.1.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.1.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.1.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.1.1.2/24"}], "vms": [{"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM1", "vcpu": 4, "vmif": "t1VM1if1"}, {"brif": "t1br1if2", "disk": "10G", "mem": 4, "name": "t1_VM2", "vcpu": 2, "vmif": "t1VM2if1"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.1.2", "remote_ip": "10.2.1.2", "remote_route": "10.2.1.0/24", "subnet_route": "10.1.1.0/24", "tenant_route_ip": "192.168.1.2", "v_name": "vxlan_t1s1"}]}, "rc": 0, "start": "2019-11-18 11:37:28.782542", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}
changed: [localhost] => (item={u'route': [{u'ip': u'10.1.2.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.2.1', u'bridge_name': u't1br2', u'dns': [{u'dnsif': u't1s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s2_dnsbrif'}], u'ns_name': u't1ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.2.2/24', u'tenant_ns_ip': u'10.1.2.1/24', u'tenant_ns_if': u't1ns2if', u'tenant_ns_name': u't1', u'tenant_sub_if': u't1s2if'}], u'subnet_ip': u'2.2.2.0/24', u'vms': [{u'mem': 3, u'name': u't1_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br2if1', u'vmif': u't1VM3if1'}], u'vxlan': [{u'local_ip': [], u'tenant_route_ip': [], u'dsport': [], u'dev': [], u'subnet_route': [], u'remote_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t1ns2\" ip route show default | grep -w '[d]efault via 10.1.2.1' ; if [ $? -ne 0 ] ; then ip netns exec \"t1ns2\" ip route add default via \"10.1.2.1\" ; fi\n", "delta": "0:00:00.063651", "end": "2019-11-18 11:37:29.120594", "item": {"bridge_name": "t1br2", "default_route_ip": "10.1.2.1", "dns": [{"brif": "t1s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t1s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns2", "route": [{"if": "p1", "ip": "10.1.2.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "2.2.2.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns2if", "tenant_ns_ip": "10.1.2.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s2if", "tenant_sub_ip": "10.1.2.2/24"}], "vms": [{"brif": "t1br2if1", "disk": "10G", "mem": 3, "name": "t1_VM3", "vcpu": 2, "vmif": "t1VM3if1"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, "rc": 0, "start": "2019-11-18 11:37:29.056943", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Create bridge inside namespace] ***********************************************************************************************************************
changed: [localhost] => (item={u'route': [{u'ip': u'10.1.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.1.2/24', u'tenant_ns_ip': u'10.1.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_ns_name': u't1', u'tenant_sub_if': u't1s1if'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't1_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM1if1'}, {u'mem': 4, u'name': u't1_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br1if2', u'vmif': u't1VM2if1'}], u'vxlan': [{u'local_ip': u'10.1.1.2', u'tenant_route_ip': u'192.168.1.2', u'dsport': 4789, u'dev': u't1s1if', u'subnet_route': u'10.1.1.0/24', u'remote_route': u'10.2.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.2.1.2'}]}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t1ns1\" brctl show | grep -w '^t1br1'; if [ $? -ne 0 ] ; then ip netns exec \"t1ns1\" brctl addbr \"t1br1\" ; fi\nip netns exec \"t1ns1\" ip link set dev \"t1br1\" up\n", "delta": "0:00:00.121478", "end": "2019-11-18 11:37:29.512604", "item": {"bridge_name": "t1br1", "default_route_ip": "10.1.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.1.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.1.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.1.1.2/24"}], "vms": [{"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM1", "vcpu": 4, "vmif": "t1VM1if1"}, {"brif": "t1br1if2", "disk": "10G", "mem": 4, "name": "t1_VM2", "vcpu": 2, "vmif": "t1VM2if1"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.1.2", "remote_ip": "10.2.1.2", "remote_route": "10.2.1.0/24", "subnet_route": "10.1.1.0/24", "tenant_route_ip": "192.168.1.2", "v_name": "vxlan_t1s1"}]}, "rc": 0, "start": "2019-11-18 11:37:29.391126", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}
changed: [localhost] => (item={u'route': [{u'ip': u'10.1.2.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.2.1', u'bridge_name': u't1br2', u'dns': [{u'dnsif': u't1s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s2_dnsbrif'}], u'ns_name': u't1ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.2.2/24', u'tenant_ns_ip': u'10.1.2.1/24', u'tenant_ns_if': u't1ns2if', u'tenant_ns_name': u't1', u'tenant_sub_if': u't1s2if'}], u'subnet_ip': u'2.2.2.0/24', u'vms': [{u'mem': 3, u'name': u't1_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br2if1', u'vmif': u't1VM3if1'}], u'vxlan': [{u'local_ip': [], u'tenant_route_ip': [], u'dsport': [], u'dev': [], u'subnet_route': [], u'remote_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t1ns2\" brctl show | grep -w '^t1br2'; if [ $? -ne 0 ] ; then ip netns exec \"t1ns2\" brctl addbr \"t1br2\" ; fi\nip netns exec \"t1ns2\" ip link set dev \"t1br2\" up\n", "delta": "0:00:00.150428", "end": "2019-11-18 11:37:29.872508", "item": {"bridge_name": "t1br2", "default_route_ip": "10.1.2.1", "dns": [{"brif": "t1s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t1s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns2", "route": [{"if": "p1", "ip": "10.1.2.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "2.2.2.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns2if", "tenant_ns_ip": "10.1.2.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s2if", "tenant_sub_ip": "10.1.2.2/24"}], "vms": [{"brif": "t1br2if1", "disk": "10G", "mem": 3, "name": "t1_VM3", "vcpu": 2, "vmif": "t1VM3if1"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, "rc": 0, "start": "2019-11-18 11:37:29.722080", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Create DNS VETH Pair] *********************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.1.1', u'bridge_name': u't1br1', u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.1.2/24', u'tenant_ns_ip': u'10.1.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't1_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM1if1'}, {u'mem': 4, u'name': u't1_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br1if2', u'vmif': u't1VM2if1'}], u'vxlan': [{u'local_ip': u'10.1.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.1.2', u'remote_route': u'10.2.1.0/24', u'subnet_route': u'10.1.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.2.1.2'}]}, {u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t1ns1\" ip link show \"t1s1_dnsbrif\" ; if [ $? -ne 0 ] ; then ip netns exec \"t1ns1\" ip link add \"t1s1_dnsbrif\" type veth peer name \"t1s1_dnsif\" ; fi\nip netns exec \"t1ns1\" ip link set dev \"t1s1_dnsbrif\" up\nip netns exec \"t1ns1\" ip link set dev \"t1s1_dnsif\" up\n", "delta": "0:00:00.179557", "end": "2019-11-18 11:37:30.324651", "item": [{"bridge_name": "t1br1", "default_route_ip": "10.1.1.1", "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.1.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.1.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.1.1.2/24"}], "vms": [{"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM1", "vcpu": 4, "vmif": "t1VM1if1"}, {"brif": "t1br1if2", "disk": "10G", "mem": 4, "name": "t1_VM2", "vcpu": 2, "vmif": "t1VM2if1"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.1.2", "remote_ip": "10.2.1.2", "remote_route": "10.2.1.0/24", "subnet_route": "10.1.1.0/24", "tenant_route_ip": "192.168.1.2", "v_name": "vxlan_t1s1"}]}, {"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "rc": 0, "start": "2019-11-18 11:37:30.145094", "stderr": "Device \"t1s1_dnsbrif\" does not exist.", "stderr_lines": ["Device \"t1s1_dnsbrif\" does not exist."], "stdout": "", "stdout_lines": []}
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.2.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.2.1', u'bridge_name': u't1br2', u'ns_name': u't1ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.2.2/24', u'tenant_ns_ip': u'10.1.2.1/24', u'tenant_ns_if': u't1ns2if', u'tenant_sub_if': u't1s2if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'2.2.2.0/24', u'vms': [{u'mem': 3, u'name': u't1_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br2if1', u'vmif': u't1VM3if1'}], u'vxlan': [{u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}, {u'dnsif': u't1s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s2_dnsbrif'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t1ns2\" ip link show \"t1s2_dnsbrif\" ; if [ $? -ne 0 ] ; then ip netns exec \"t1ns2\" ip link add \"t1s2_dnsbrif\" type veth peer name \"t1s2_dnsif\" ; fi\nip netns exec \"t1ns2\" ip link set dev \"t1s2_dnsbrif\" up\nip netns exec \"t1ns2\" ip link set dev \"t1s2_dnsif\" up\n", "delta": "0:00:00.164593", "end": "2019-11-18 11:37:30.704289", "item": [{"bridge_name": "t1br2", "default_route_ip": "10.1.2.1", "ns_name": "t1ns2", "route": [{"if": "p1", "ip": "10.1.2.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "2.2.2.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns2if", "tenant_ns_ip": "10.1.2.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s2if", "tenant_sub_ip": "10.1.2.2/24"}], "vms": [{"brif": "t1br2if1", "disk": "10G", "mem": 3, "name": "t1_VM3", "vcpu": 2, "vmif": "t1VM3if1"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, {"brif": "t1s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t1s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "rc": 0, "start": "2019-11-18 11:37:30.539696", "stderr": "Device \"t1s2_dnsbrif\" does not exist.", "stderr_lines": ["Device \"t1s2_dnsbrif\" does not exist."], "stdout": "", "stdout_lines": []}

TASK [Attach DNS VETH Pair] *********************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.1.1', u'bridge_name': u't1br1', u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.1.2/24', u'tenant_ns_ip': u'10.1.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't1_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM1if1'}, {u'mem': 4, u'name': u't1_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br1if2', u'vmif': u't1VM2if1'}], u'vxlan': [{u'local_ip': u'10.1.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.1.2', u'remote_route': u'10.2.1.0/24', u'subnet_route': u'10.1.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.2.1.2'}]}, {u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t1ns1\" brctl show \"t1br1\" | grep -w 't1s1_dnsbrif' ; if [ $? -ne 0 ] ; then ip netns exec \"t1ns1\" brctl addif \"t1br1\" \"t1s1_dnsbrif\" ; fi\n", "delta": "0:00:00.081300", "end": "2019-11-18 11:37:31.020411", "item": [{"bridge_name": "t1br1", "default_route_ip": "10.1.1.1", "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.1.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.1.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.1.1.2/24"}], "vms": [{"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM1", "vcpu": 4, "vmif": "t1VM1if1"}, {"brif": "t1br1if2", "disk": "10G", "mem": 4, "name": "t1_VM2", "vcpu": 2, "vmif": "t1VM2if1"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.1.2", "remote_ip": "10.2.1.2", "remote_route": "10.2.1.0/24", "subnet_route": "10.1.1.0/24", "tenant_route_ip": "192.168.1.2", "v_name": "vxlan_t1s1"}]}, {"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "rc": 0, "start": "2019-11-18 11:37:30.939111", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.2.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.2.1', u'bridge_name': u't1br2', u'ns_name': u't1ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.2.2/24', u'tenant_ns_ip': u'10.1.2.1/24', u'tenant_ns_if': u't1ns2if', u'tenant_sub_if': u't1s2if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'2.2.2.0/24', u'vms': [{u'mem': 3, u'name': u't1_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br2if1', u'vmif': u't1VM3if1'}], u'vxlan': [{u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}, {u'dnsif': u't1s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s2_dnsbrif'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t1ns2\" brctl show \"t1br2\" | grep -w 't1s2_dnsbrif' ; if [ $? -ne 0 ] ; then ip netns exec \"t1ns2\" brctl addif \"t1br2\" \"t1s2_dnsbrif\" ; fi\n", "delta": "0:00:00.094264", "end": "2019-11-18 11:37:31.296209", "item": [{"bridge_name": "t1br2", "default_route_ip": "10.1.2.1", "ns_name": "t1ns2", "route": [{"if": "p1", "ip": "10.1.2.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "2.2.2.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns2if", "tenant_ns_ip": "10.1.2.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s2if", "tenant_sub_ip": "10.1.2.2/24"}], "vms": [{"brif": "t1br2if1", "disk": "10G", "mem": 3, "name": "t1_VM3", "vcpu": 2, "vmif": "t1VM3if1"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, {"brif": "t1s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t1s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "rc": 0, "start": "2019-11-18 11:37:31.201945", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Create VETH Pairs] ************************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.1.2/24', u'tenant_ns_ip': u'10.1.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.1.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.1.2', u'remote_route': u'10.2.1.0/24', u'subnet_route': u'10.1.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.2.1.2'}]}, {u'mem': 2, u'name': u't1_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM1if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip link show \"t1br1if1\" ; if [ $? -ne 0 ] ; then ip link add \"t1VM1if1\" type veth peer name \"t1br1if1\" ; fi\nip link set dev \"t1br1if1\" up\nip link set dev \"t1VM1if1\" up\n", "delta": "0:00:00.016250", "end": "2019-11-18 11:37:31.545634", "item": [{"bridge_name": "t1br1", "default_route_ip": "10.1.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.1.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.1.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.1.1.2/24"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.1.2", "remote_ip": "10.2.1.2", "remote_route": "10.2.1.0/24", "subnet_route": "10.1.1.0/24", "tenant_route_ip": "192.168.1.2", "v_name": "vxlan_t1s1"}]}, {"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM1", "vcpu": 4, "vmif": "t1VM1if1"}], "rc": 0, "start": "2019-11-18 11:37:31.529384", "stderr": "Device \"t1br1if1\" does not exist.", "stderr_lines": ["Device \"t1br1if1\" does not exist."], "stdout": "", "stdout_lines": []}
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.1.2/24', u'tenant_ns_ip': u'10.1.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.1.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.1.2', u'remote_route': u'10.2.1.0/24', u'subnet_route': u'10.1.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.2.1.2'}]}, {u'mem': 4, u'name': u't1_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br1if2', u'vmif': u't1VM2if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip link show \"t1br1if2\" ; if [ $? -ne 0 ] ; then ip link add \"t1VM2if1\" type veth peer name \"t1br1if2\" ; fi\nip link set dev \"t1br1if2\" up\nip link set dev \"t1VM2if1\" up\n", "delta": "0:00:00.016091", "end": "2019-11-18 11:37:31.778300", "item": [{"bridge_name": "t1br1", "default_route_ip": "10.1.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.1.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.1.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.1.1.2/24"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.1.2", "remote_ip": "10.2.1.2", "remote_route": "10.2.1.0/24", "subnet_route": "10.1.1.0/24", "tenant_route_ip": "192.168.1.2", "v_name": "vxlan_t1s1"}]}, {"brif": "t1br1if2", "disk": "10G", "mem": 4, "name": "t1_VM2", "vcpu": 2, "vmif": "t1VM2if1"}], "rc": 0, "start": "2019-11-18 11:37:31.762209", "stderr": "Device \"t1br1if2\" does not exist.", "stderr_lines": ["Device \"t1br1if2\" does not exist."], "stdout": "", "stdout_lines": []}
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.2.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.2.1', u'bridge_name': u't1br2', u'dns': [{u'dnsif': u't1s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s2_dnsbrif'}], u'ns_name': u't1ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.2.2/24', u'tenant_ns_ip': u'10.1.2.1/24', u'tenant_ns_if': u't1ns2if', u'tenant_sub_if': u't1s2if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'2.2.2.0/24', u'vxlan': [{u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}, {u'mem': 3, u'name': u't1_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br2if1', u'vmif': u't1VM3if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip link show \"t1br2if1\" ; if [ $? -ne 0 ] ; then ip link add \"t1VM3if1\" type veth peer name \"t1br2if1\" ; fi\nip link set dev \"t1br2if1\" up\nip link set dev \"t1VM3if1\" up\n", "delta": "0:00:00.019777", "end": "2019-11-18 11:37:32.009433", "item": [{"bridge_name": "t1br2", "default_route_ip": "10.1.2.1", "dns": [{"brif": "t1s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t1s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns2", "route": [{"if": "p1", "ip": "10.1.2.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "2.2.2.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns2if", "tenant_ns_ip": "10.1.2.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s2if", "tenant_sub_ip": "10.1.2.2/24"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, {"brif": "t1br2if1", "disk": "10G", "mem": 3, "name": "t1_VM3", "vcpu": 2, "vmif": "t1VM3if1"}], "rc": 0, "start": "2019-11-18 11:37:31.989656", "stderr": "Device \"t1br2if1\" does not exist.", "stderr_lines": ["Device \"t1br2if1\" does not exist."], "stdout": "", "stdout_lines": []}

TASK [Attach VETH Pairs] ************************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.1.2/24', u'tenant_ns_ip': u'10.1.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.1.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.1.2', u'remote_route': u'10.2.1.0/24', u'subnet_route': u'10.1.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.2.1.2'}]}, {u'mem': 2, u'name': u't1_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM1if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip link show \"t1br1if1\" ; if [ $? -eq 0 ] ; then ip link set \"t1br1if1\" netns \"t1ns1\" ; fi\nip netns exec \"t1ns1\" brctl show \"t1br1\" | grep -w 't1br1if1' ; if [ $? -ne 0 ] ; then ip netns exec \"t1ns1\" brctl addif \"t1br1\" \"t1br1if1\" ; fi\n", "delta": "0:00:00.091588", "end": "2019-11-18 11:37:32.372402", "item": [{"bridge_name": "t1br1", "default_route_ip": "10.1.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.1.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.1.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.1.1.2/24"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.1.2", "remote_ip": "10.2.1.2", "remote_route": "10.2.1.0/24", "subnet_route": "10.1.1.0/24", "tenant_route_ip": "192.168.1.2", "v_name": "vxlan_t1s1"}]}, {"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM1", "vcpu": 4, "vmif": "t1VM1if1"}], "rc": 0, "start": "2019-11-18 11:37:32.280814", "stderr": "", "stderr_lines": [], "stdout": "20: t1br1if1@t1VM1if1: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP mode DEFAULT group default qlen 1000\n    link/ether fa:3e:ed:4d:be:ce brd ff:ff:ff:ff:ff:ff", "stdout_lines": ["20: t1br1if1@t1VM1if1: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP mode DEFAULT group default qlen 1000", "    link/ether fa:3e:ed:4d:be:ce brd ff:ff:ff:ff:ff:ff"]}
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.1.2/24', u'tenant_ns_ip': u'10.1.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.1.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.1.2', u'remote_route': u'10.2.1.0/24', u'subnet_route': u'10.1.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.2.1.2'}]}, {u'mem': 4, u'name': u't1_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br1if2', u'vmif': u't1VM2if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip link show \"t1br1if2\" ; if [ $? -eq 0 ] ; then ip link set \"t1br1if2\" netns \"t1ns1\" ; fi\nip netns exec \"t1ns1\" brctl show \"t1br1\" | grep -w 't1br1if2' ; if [ $? -ne 0 ] ; then ip netns exec \"t1ns1\" brctl addif \"t1br1\" \"t1br1if2\" ; fi\n", "delta": "0:00:00.103021", "end": "2019-11-18 11:37:32.680433", "item": [{"bridge_name": "t1br1", "default_route_ip": "10.1.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.1.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.1.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.1.1.2/24"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.1.2", "remote_ip": "10.2.1.2", "remote_route": "10.2.1.0/24", "subnet_route": "10.1.1.0/24", "tenant_route_ip": "192.168.1.2", "v_name": "vxlan_t1s1"}]}, {"brif": "t1br1if2", "disk": "10G", "mem": 4, "name": "t1_VM2", "vcpu": 2, "vmif": "t1VM2if1"}], "rc": 0, "start": "2019-11-18 11:37:32.577412", "stderr": "", "stderr_lines": [], "stdout": "22: t1br1if2@t1VM2if1: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP mode DEFAULT group default qlen 1000\n    link/ether 72:1c:e1:b5:6d:9c brd ff:ff:ff:ff:ff:ff", "stdout_lines": ["22: t1br1if2@t1VM2if1: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP mode DEFAULT group default qlen 1000", "    link/ether 72:1c:e1:b5:6d:9c brd ff:ff:ff:ff:ff:ff"]}
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.2.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.2.1', u'bridge_name': u't1br2', u'dns': [{u'dnsif': u't1s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s2_dnsbrif'}], u'ns_name': u't1ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.2.2/24', u'tenant_ns_ip': u'10.1.2.1/24', u'tenant_ns_if': u't1ns2if', u'tenant_sub_if': u't1s2if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'2.2.2.0/24', u'vxlan': [{u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}, {u'mem': 3, u'name': u't1_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br2if1', u'vmif': u't1VM3if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip link show \"t1br2if1\" ; if [ $? -eq 0 ] ; then ip link set \"t1br2if1\" netns \"t1ns2\" ; fi\nip netns exec \"t1ns2\" brctl show \"t1br2\" | grep -w 't1br2if1' ; if [ $? -ne 0 ] ; then ip netns exec \"t1ns2\" brctl addif \"t1br2\" \"t1br2if1\" ; fi\n", "delta": "0:00:00.124534", "end": "2019-11-18 11:37:33.004527", "item": [{"bridge_name": "t1br2", "default_route_ip": "10.1.2.1", "dns": [{"brif": "t1s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t1s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns2", "route": [{"if": "p1", "ip": "10.1.2.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "2.2.2.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns2if", "tenant_ns_ip": "10.1.2.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s2if", "tenant_sub_ip": "10.1.2.2/24"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, {"brif": "t1br2if1", "disk": "10G", "mem": 3, "name": "t1_VM3", "vcpu": 2, "vmif": "t1VM3if1"}], "rc": 0, "start": "2019-11-18 11:37:32.879993", "stderr": "", "stderr_lines": [], "stdout": "24: t1br2if1@t1VM3if1: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP mode DEFAULT group default qlen 1000\n    link/ether 3a:b6:31:f0:93:16 brd ff:ff:ff:ff:ff:ff", "stdout_lines": ["24: t1br2if1@t1VM3if1: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP mode DEFAULT group default qlen 1000", "    link/ether 3a:b6:31:f0:93:16 brd ff:ff:ff:ff:ff:ff"]}

TASK [All interfaces and bridges UP] ************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.1.2/24', u'tenant_ns_ip': u'10.1.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.1.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.1.2', u'remote_route': u'10.2.1.0/24', u'subnet_route': u'10.1.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.2.1.2'}]}, {u'mem': 2, u'name': u't1_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM1if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t1ns1\" ip link set \"t1br1if1\" up\nip netns exec \"t1ns1\" ip link set dev \"t1br1\" up\n", "delta": "0:00:00.088342", "end": "2019-11-18 11:37:33.352559", "item": [{"bridge_name": "t1br1", "default_route_ip": "10.1.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.1.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.1.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.1.1.2/24"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.1.2", "remote_ip": "10.2.1.2", "remote_route": "10.2.1.0/24", "subnet_route": "10.1.1.0/24", "tenant_route_ip": "192.168.1.2", "v_name": "vxlan_t1s1"}]}, {"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM1", "vcpu": 4, "vmif": "t1VM1if1"}], "rc": 0, "start": "2019-11-18 11:37:33.264217", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.1.2/24', u'tenant_ns_ip': u'10.1.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.1.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.1.2', u'remote_route': u'10.2.1.0/24', u'subnet_route': u'10.1.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.2.1.2'}]}, {u'mem': 4, u'name': u't1_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br1if2', u'vmif': u't1VM2if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t1ns1\" ip link set \"t1br1if2\" up\nip netns exec \"t1ns1\" ip link set dev \"t1br1\" up\n", "delta": "0:00:00.081841", "end": "2019-11-18 11:37:33.636621", "item": [{"bridge_name": "t1br1", "default_route_ip": "10.1.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.1.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.1.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.1.1.2/24"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.1.2", "remote_ip": "10.2.1.2", "remote_route": "10.2.1.0/24", "subnet_route": "10.1.1.0/24", "tenant_route_ip": "192.168.1.2", "v_name": "vxlan_t1s1"}]}, {"brif": "t1br1if2", "disk": "10G", "mem": 4, "name": "t1_VM2", "vcpu": 2, "vmif": "t1VM2if1"}], "rc": 0, "start": "2019-11-18 11:37:33.554780", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.2.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.2.1', u'bridge_name': u't1br2', u'dns': [{u'dnsif': u't1s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s2_dnsbrif'}], u'ns_name': u't1ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.2.2/24', u'tenant_ns_ip': u'10.1.2.1/24', u'tenant_ns_if': u't1ns2if', u'tenant_sub_if': u't1s2if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'2.2.2.0/24', u'vxlan': [{u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}, {u'mem': 3, u'name': u't1_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br2if1', u'vmif': u't1VM3if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t1ns2\" ip link set \"t1br2if1\" up\nip netns exec \"t1ns2\" ip link set dev \"t1br2\" up\n", "delta": "0:00:00.087382", "end": "2019-11-18 11:37:33.904715", "item": [{"bridge_name": "t1br2", "default_route_ip": "10.1.2.1", "dns": [{"brif": "t1s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t1s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns2", "route": [{"if": "p1", "ip": "10.1.2.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "2.2.2.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns2if", "tenant_ns_ip": "10.1.2.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s2if", "tenant_sub_ip": "10.1.2.2/24"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, {"brif": "t1br2if1", "disk": "10G", "mem": 3, "name": "t1_VM3", "vcpu": 2, "vmif": "t1VM3if1"}], "rc": 0, "start": "2019-11-18 11:37:33.817333", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Add IP to DNS Interface] ******************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.1.1', u'bridge_name': u't1br1', u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.1.2/24', u'tenant_ns_ip': u'10.1.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't1_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM1if1'}, {u'mem': 4, u'name': u't1_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br1if2', u'vmif': u't1VM2if1'}], u'vxlan': [{u'local_ip': u'10.1.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.1.2', u'remote_route': u'10.2.1.0/24', u'subnet_route': u'10.1.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.2.1.2'}]}, {u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t1ns1\" ip addr show \"t1s1_dnsif\" | awk 'FNR==3{ print $2 }' | grep -w '^1.1.1.1/24' ; if [ $? -ne 0 ] ; then ip netns exec \"t1ns1\" ip addr add \"1.1.1.1/24\" dev \"t1s1_dnsif\" ; fi\n", "delta": "0:00:00.098690", "end": "2019-11-18 11:37:34.260542", "item": [{"bridge_name": "t1br1", "default_route_ip": "10.1.1.1", "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.1.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.1.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.1.1.2/24"}], "vms": [{"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM1", "vcpu": 4, "vmif": "t1VM1if1"}, {"brif": "t1br1if2", "disk": "10G", "mem": 4, "name": "t1_VM2", "vcpu": 2, "vmif": "t1VM2if1"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.1.2", "remote_ip": "10.2.1.2", "remote_route": "10.2.1.0/24", "subnet_route": "10.1.1.0/24", "tenant_route_ip": "192.168.1.2", "v_name": "vxlan_t1s1"}]}, {"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "rc": 0, "start": "2019-11-18 11:37:34.161852", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.2.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.2.1', u'bridge_name': u't1br2', u'ns_name': u't1ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.2.2/24', u'tenant_ns_ip': u'10.1.2.1/24', u'tenant_ns_if': u't1ns2if', u'tenant_sub_if': u't1s2if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'2.2.2.0/24', u'vms': [{u'mem': 3, u'name': u't1_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br2if1', u'vmif': u't1VM3if1'}], u'vxlan': [{u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}, {u'dnsif': u't1s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s2_dnsbrif'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t1ns2\" ip addr show \"t1s2_dnsif\" | awk 'FNR==3{ print $2 }' | grep -w '^2.2.2.1/24' ; if [ $? -ne 0 ] ; then ip netns exec \"t1ns2\" ip addr add \"2.2.2.1/24\" dev \"t1s2_dnsif\" ; fi\n", "delta": "0:00:00.087251", "end": "2019-11-18 11:37:34.548377", "item": [{"bridge_name": "t1br2", "default_route_ip": "10.1.2.1", "ns_name": "t1ns2", "route": [{"if": "p1", "ip": "10.1.2.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "2.2.2.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns2if", "tenant_ns_ip": "10.1.2.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s2if", "tenant_sub_ip": "10.1.2.2/24"}], "vms": [{"brif": "t1br2if1", "disk": "10G", "mem": 3, "name": "t1_VM3", "vcpu": 2, "vmif": "t1VM3if1"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, {"brif": "t1s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t1s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "rc": 0, "start": "2019-11-18 11:37:34.461126", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Install DHCP Server] **********************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.1.1', u'bridge_name': u't1br1', u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.1.2/24', u'tenant_ns_ip': u'10.1.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't1_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM1if1'}, {u'mem': 4, u'name': u't1_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br1if2', u'vmif': u't1VM2if1'}], u'vxlan': [{u'local_ip': u'10.1.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.1.2', u'remote_route': u'10.2.1.0/24', u'subnet_route': u'10.1.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.2.1.2'}]}, {u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t1ns1\" ps aux | grep -w '[d]nsmasq --interface t1s1_dnsif -z --dhcp-range=1.1.1.5,1.1.1.126' ; if [ $? -ne 0 ] ; then ip netns exec \"t1ns1\" dnsmasq --interface \"t1s1_dnsif\" -z --dhcp-range=1.1.1.5,'1.1.1.126' ; fi\n", "delta": "0:00:00.062821", "end": "2019-11-18 11:37:34.885296", "item": [{"bridge_name": "t1br1", "default_route_ip": "10.1.1.1", "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.1.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.1.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.1.1.2/24"}], "vms": [{"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM1", "vcpu": 4, "vmif": "t1VM1if1"}, {"brif": "t1br1if2", "disk": "10G", "mem": 4, "name": "t1_VM2", "vcpu": 2, "vmif": "t1VM2if1"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.1.2", "remote_ip": "10.2.1.2", "remote_route": "10.2.1.0/24", "subnet_route": "10.1.1.0/24", "tenant_route_ip": "192.168.1.2", "v_name": "vxlan_t1s1"}]}, {"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "rc": 0, "start": "2019-11-18 11:37:34.822475", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.2.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.2.1', u'bridge_name': u't1br2', u'ns_name': u't1ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.2.2/24', u'tenant_ns_ip': u'10.1.2.1/24', u'tenant_ns_if': u't1ns2if', u'tenant_sub_if': u't1s2if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'2.2.2.0/24', u'vms': [{u'mem': 3, u'name': u't1_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br2if1', u'vmif': u't1VM3if1'}], u'vxlan': [{u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}, {u'dnsif': u't1s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s2_dnsbrif'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t1ns2\" ps aux | grep -w '[d]nsmasq --interface t1s2_dnsif -z --dhcp-range=2.2.2.5,2.2.2.254' ; if [ $? -ne 0 ] ; then ip netns exec \"t1ns2\" dnsmasq --interface \"t1s2_dnsif\" -z --dhcp-range=2.2.2.5,'2.2.2.254' ; fi\n", "delta": "0:00:00.068354", "end": "2019-11-18 11:37:35.164517", "item": [{"bridge_name": "t1br2", "default_route_ip": "10.1.2.1", "ns_name": "t1ns2", "route": [{"if": "p1", "ip": "10.1.2.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "2.2.2.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns2if", "tenant_ns_ip": "10.1.2.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s2if", "tenant_sub_ip": "10.1.2.2/24"}], "vms": [{"brif": "t1br2if1", "disk": "10G", "mem": 3, "name": "t1_VM3", "vcpu": 2, "vmif": "t1VM3if1"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, {"brif": "t1s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t1s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "rc": 0, "start": "2019-11-18 11:37:35.096163", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Create VXLAN devices] *********************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.1.2/24', u'tenant_ns_ip': u'10.1.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't1_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM1if1'}, {u'mem': 4, u'name': u't1_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br1if2', u'vmif': u't1VM2if1'}]}, {u'local_ip': u'10.1.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.1.2', u'remote_route': u'10.2.1.0/24', u'subnet_route': u'10.1.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.2.1.2'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t1ns1\" ip link show \"vxlan_t1s1\" ; if [ $? -ne 0 ] ; then ip netns exec \"t1ns1\" ip link add \"vxlan_t1s1\" type vxlan id \"42\" local \"10.1.1.2\" remote \"10.2.1.2\" dstport \"4789\" dev \"t1s1if\"; ip netns exec \"t1ns1\" ip link set dev \"vxlan_t1s1\" up ; fi\n", "delta": "0:00:00.129558", "end": "2019-11-18 11:37:35.572397", "item": [{"bridge_name": "t1br1", "default_route_ip": "10.1.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.1.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.1.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.1.1.2/24"}], "vms": [{"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM1", "vcpu": 4, "vmif": "t1VM1if1"}, {"brif": "t1br1if2", "disk": "10G", "mem": 4, "name": "t1_VM2", "vcpu": 2, "vmif": "t1VM2if1"}]}, {"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.1.2", "remote_ip": "10.2.1.2", "remote_route": "10.2.1.0/24", "subnet_route": "10.1.1.0/24", "tenant_route_ip": "192.168.1.2", "v_name": "vxlan_t1s1"}], "rc": 0, "start": "2019-11-18 11:37:35.442839", "stderr": "Device \"vxlan_t1s1\" does not exist.", "stderr_lines": ["Device \"vxlan_t1s1\" does not exist."], "stdout": "", "stdout_lines": []}
skipping: [localhost] => (item=[{u'route': [{u'ip': u'10.1.2.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.2.1', u'bridge_name': u't1br2', u'dns': [{u'dnsif': u't1s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s2_dnsbrif'}], u'ns_name': u't1ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.2.2/24', u'tenant_ns_ip': u'10.1.2.1/24', u'tenant_ns_if': u't1ns2if', u'tenant_sub_if': u't1s2if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'2.2.2.0/24', u'vms': [{u'mem': 3, u'name': u't1_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br2if1', u'vmif': u't1VM3if1'}]}, {u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}])  => {"ansible_loop_var": "item", "changed": false, "item": [{"bridge_name": "t1br2", "default_route_ip": "10.1.2.1", "dns": [{"brif": "t1s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t1s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns2", "route": [{"if": "p1", "ip": "10.1.2.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "2.2.2.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns2if", "tenant_ns_ip": "10.1.2.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s2if", "tenant_sub_ip": "10.1.2.2/24"}], "vms": [{"brif": "t1br2if1", "disk": "10G", "mem": 3, "name": "t1_VM3", "vcpu": 2, "vmif": "t1VM3if1"}]}, {"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}], "skip_reason": "Conditional result was False"}

TASK [Attach VXLANs to bridge] ******************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.1.2/24', u'tenant_ns_ip': u'10.1.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't1_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM1if1'}, {u'mem': 4, u'name': u't1_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br1if2', u'vmif': u't1VM2if1'}]}, {u'local_ip': u'10.1.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.1.2', u'remote_route': u'10.2.1.0/24', u'subnet_route': u'10.1.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.2.1.2'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t1ns1\" brctl show \"t1br1\" | grep -w 'vxlan_t1s1' ; if [ $? -ne 0 ] ; then ip netns exec \"t1ns1\" brctl addif \"t1br1\" \"vxlan_t1s1\" ; fi\n", "delta": "0:00:00.070588", "end": "2019-11-18 11:37:35.932518", "item": [{"bridge_name": "t1br1", "default_route_ip": "10.1.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.1.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.1.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.1.1.2/24"}], "vms": [{"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM1", "vcpu": 4, "vmif": "t1VM1if1"}, {"brif": "t1br1if2", "disk": "10G", "mem": 4, "name": "t1_VM2", "vcpu": 2, "vmif": "t1VM2if1"}]}, {"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.1.2", "remote_ip": "10.2.1.2", "remote_route": "10.2.1.0/24", "subnet_route": "10.1.1.0/24", "tenant_route_ip": "192.168.1.2", "v_name": "vxlan_t1s1"}], "rc": 0, "start": "2019-11-18 11:37:35.861930", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}
skipping: [localhost] => (item=[{u'route': [{u'ip': u'10.1.2.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.2.1', u'bridge_name': u't1br2', u'dns': [{u'dnsif': u't1s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s2_dnsbrif'}], u'ns_name': u't1ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.2.2/24', u'tenant_ns_ip': u'10.1.2.1/24', u'tenant_ns_if': u't1ns2if', u'tenant_sub_if': u't1s2if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'2.2.2.0/24', u'vms': [{u'mem': 3, u'name': u't1_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br2if1', u'vmif': u't1VM3if1'}]}, {u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}])  => {"ansible_loop_var": "item", "changed": false, "item": [{"bridge_name": "t1br2", "default_route_ip": "10.1.2.1", "dns": [{"brif": "t1s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t1s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns2", "route": [{"if": "p1", "ip": "10.1.2.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "2.2.2.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns2if", "tenant_ns_ip": "10.1.2.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s2if", "tenant_sub_ip": "10.1.2.2/24"}], "vms": [{"brif": "t1br2if1", "disk": "10G", "mem": 3, "name": "t1_VM3", "vcpu": 2, "vmif": "t1VM3if1"}]}, {"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}], "skip_reason": "Conditional result was False"}

PLAY RECAP **************************************************************************************************************************************************
localhost                  : ok=21   changed=21   unreachable=0    failed=0    skipped=0    rescued=0    ignored=0   

Using /etc/ansible/ansible.cfg as config file

PLAY [worker] ***********************************************************************************************************************************************

TASK [Create Tenant Namespace] ******************************************************************************************************************************
changed: [99.99.99.2] => (item={u'default_route_ip': u'192.168.129.1', u'name': u't1', u'pns_ip': u'192.168.129.1/24', u'tenant_if': u't1if', u'tenant_ip': u'192.168.129.2/24', u'pns_if': u't1pns_if'}) => {"ansible_loop_var": "item", "changed": true, "cmd": ["ip", "netns", "add", "t1"], "delta": "0:00:00.054433", "end": "2019-11-18 11:37:37.821329", "item": {"default_route_ip": "192.168.129.1", "name": "t1", "pns_if": "t1pns_if", "pns_ip": "192.168.129.1/24", "tenant_if": "t1if", "tenant_ip": "192.168.129.2/24"}, "rc": 0, "start": "2019-11-18 11:37:37.766896", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Create Subnet Namespace] ******************************************************************************************************************************
changed: [99.99.99.2] => (item={u'route': [{u'ip': u'10.2.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.2.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.1.2/24', u'tenant_ns_ip': u'10.2.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_ns_name': u't1', u'tenant_sub_if': u't1s1if'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't1_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM4if1'}], u'vxlan': [{u'local_ip': u'10.2.1.2', u'tenant_route_ip': u'192.168.129.2', u'dsport': 4789, u'dev': u't1s1if', u'subnet_route': u'10.2.1.0/24', u'remote_route': u'10.1.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.1.1.2'}]}) => {"ansible_loop_var": "item", "changed": true, "cmd": ["ip", "netns", "add", "t1ns1"], "delta": "0:00:00.055901", "end": "2019-11-18 11:37:38.277356", "item": {"bridge_name": "t1br1", "default_route_ip": "10.2.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.2.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.2.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.2.1.2/24"}], "vms": [{"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM4", "vcpu": 4, "vmif": "t1VM4if1"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.1.2", "remote_ip": "10.1.1.2", "remote_route": "10.1.1.0/24", "subnet_route": "10.2.1.0/24", "tenant_route_ip": "192.168.129.2", "v_name": "vxlan_t1s1"}]}, "rc": 0, "start": "2019-11-18 11:37:38.221455", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Create Tenant VETH pairs] *****************************************************************************************************************************
changed: [99.99.99.2] => (item={u'default_route_ip': u'192.168.129.1', u'name': u't1', u'pns_ip': u'192.168.129.1/24', u'tenant_if': u't1if', u'tenant_ip': u'192.168.129.2/24', u'pns_if': u't1pns_if'}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip link show \"t1if\" ; if [ $? -ne 0 ] ; then ip link add \"t1if\" type veth peer name \"t1pns_if\" ; fi\n", "delta": "0:00:00.012403", "end": "2019-11-18 11:37:38.670536", "item": {"default_route_ip": "192.168.129.1", "name": "t1", "pns_if": "t1pns_if", "pns_ip": "192.168.129.1/24", "tenant_if": "t1if", "tenant_ip": "192.168.129.2/24"}, "rc": 0, "start": "2019-11-18 11:37:38.658133", "stderr": "Device \"t1if\" does not exist.", "stderr_lines": ["Device \"t1if\" does not exist."], "stdout": "", "stdout_lines": []}

TASK [Attach Tenant VETH Pairs] *****************************************************************************************************************************
changed: [99.99.99.2] => (item={u'default_route_ip': u'192.168.129.1', u'name': u't1', u'pns_ip': u'192.168.129.1/24', u'tenant_if': u't1if', u'tenant_ip': u'192.168.129.2/24', u'pns_if': u't1pns_if'}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec pns ip link show \"t1pns_if\" ; if [ $? -ne 0 ] ; then ip link set \"t1pns_if\" netns pns ; fi\nip netns exec \"t1\" ip link show \"t1if\" ; if [ $? -ne 0 ] ; then ip link set \"t1if\" netns \"t1\" ; fi\nip netns exec pns ip link set dev \"t1pns_if\" up\nip netns exec \"t1\" ip link set dev \"t1if\" up\n", "delta": "0:00:00.193689", "end": "2019-11-18 11:37:39.256190", "item": {"default_route_ip": "192.168.129.1", "name": "t1", "pns_if": "t1pns_if", "pns_ip": "192.168.129.1/24", "tenant_if": "t1if", "tenant_ip": "192.168.129.2/24"}, "rc": 0, "start": "2019-11-18 11:37:39.062501", "stderr": "Device \"t1pns_if\" does not exist.\nDevice \"t1if\" does not exist.", "stderr_lines": ["Device \"t1pns_if\" does not exist.", "Device \"t1if\" does not exist."], "stdout": "", "stdout_lines": []}

TASK [Add IP addresses to Tenant VETH Pairs] ****************************************************************************************************************
changed: [99.99.99.2] => (item={u'default_route_ip': u'192.168.129.1', u'name': u't1', u'pns_ip': u'192.168.129.1/24', u'tenant_if': u't1if', u'tenant_ip': u'192.168.129.2/24', u'pns_if': u't1pns_if'}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec pns ip addr show \"t1pns_if\" | awk 'FNR==3{ print $2 }' | grep -w '^192.168.129.1/24' ; if [ $? -ne 0 ] ; then ip netns exec pns ip addr add \"192.168.129.1/24\" dev \"t1pns_if\" ; fi\nip netns exec \"t1\" ip addr show \"t1if\" | awk 'FNR==3{ print $2 }' | grep -w '^192.168.129.2/24' ; if [ $? -ne 0 ] ; then ip netns exec \"t1\" ip addr add \"192.168.129.2/24\" dev \"t1if\" ; fi\n", "delta": "0:00:00.164910", "end": "2019-11-18 11:37:39.816087", "item": {"default_route_ip": "192.168.129.1", "name": "t1", "pns_if": "t1pns_if", "pns_ip": "192.168.129.1/24", "tenant_if": "t1if", "tenant_ip": "192.168.129.2/24"}, "rc": 0, "start": "2019-11-18 11:37:39.651177", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Create Namespace VETH Pairs] **************************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.2.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't1_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM4if1'}], u'vxlan': [{u'local_ip': u'10.2.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.129.2', u'remote_route': u'10.1.1.0/24', u'subnet_route': u'10.2.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.1.1.2'}]}, {u'tenant_sub_ip': u'10.2.1.2/24', u'tenant_ns_ip': u'10.2.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip link show \"t1ns1if\" ; if [ $? -ne 0 ] ; then ip link add \"t1ns1if\" type veth peer name \"t1s1if\" ; fi\n", "delta": "0:00:00.014134", "end": "2019-11-18 11:37:40.208699", "item": [{"bridge_name": "t1br1", "default_route_ip": "10.2.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.2.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "vms": [{"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM4", "vcpu": 4, "vmif": "t1VM4if1"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.1.2", "remote_ip": "10.1.1.2", "remote_route": "10.1.1.0/24", "subnet_route": "10.2.1.0/24", "tenant_route_ip": "192.168.129.2", "v_name": "vxlan_t1s1"}]}, {"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.2.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.2.1.2/24"}], "rc": 0, "start": "2019-11-18 11:37:40.194565", "stderr": "Device \"t1ns1if\" does not exist.", "stderr_lines": ["Device \"t1ns1if\" does not exist."], "stdout": "", "stdout_lines": []}

TASK [Attach Namespace VETH Pairs] **************************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.2.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't1_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM4if1'}], u'vxlan': [{u'local_ip': u'10.2.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.129.2', u'remote_route': u'10.1.1.0/24', u'subnet_route': u'10.2.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.1.1.2'}]}, {u'tenant_sub_ip': u'10.2.1.2/24', u'tenant_ns_ip': u'10.2.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t1\" ip link show \"t1ns1if\" ; if [ $? -ne 0 ] ; then ip link set \"t1ns1if\" netns \"t1\" ; fi\nip netns exec \"t1ns1\" ip link show \"t1s1if\" ; if [ $? -ne 0 ] ; then ip link set \"t1s1if\" netns \"t1ns1\" ; fi\n", "delta": "0:00:00.128039", "end": "2019-11-18 11:37:40.702139", "item": [{"bridge_name": "t1br1", "default_route_ip": "10.2.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.2.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "vms": [{"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM4", "vcpu": 4, "vmif": "t1VM4if1"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.1.2", "remote_ip": "10.1.1.2", "remote_route": "10.1.1.0/24", "subnet_route": "10.2.1.0/24", "tenant_route_ip": "192.168.129.2", "v_name": "vxlan_t1s1"}]}, {"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.2.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.2.1.2/24"}], "rc": 0, "start": "2019-11-18 11:37:40.574100", "stderr": "Device \"t1ns1if\" does not exist.\nDevice \"t1s1if\" does not exist.", "stderr_lines": ["Device \"t1ns1if\" does not exist.", "Device \"t1s1if\" does not exist."], "stdout": "", "stdout_lines": []}

TASK [Set Namespace VETH Pairs UP] **************************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.2.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't1_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM4if1'}], u'vxlan': [{u'local_ip': u'10.2.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.129.2', u'remote_route': u'10.1.1.0/24', u'subnet_route': u'10.2.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.1.1.2'}]}, {u'tenant_sub_ip': u'10.2.1.2/24', u'tenant_ns_ip': u'10.2.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t1\" ip link set dev \"t1ns1if\" up\nip netns exec \"t1ns1\" ip link set dev \"t1s1if\" up\n", "delta": "0:00:00.074574", "end": "2019-11-18 11:37:41.152042", "item": [{"bridge_name": "t1br1", "default_route_ip": "10.2.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.2.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "vms": [{"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM4", "vcpu": 4, "vmif": "t1VM4if1"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.1.2", "remote_ip": "10.1.1.2", "remote_route": "10.1.1.0/24", "subnet_route": "10.2.1.0/24", "tenant_route_ip": "192.168.129.2", "v_name": "vxlan_t1s1"}]}, {"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.2.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.2.1.2/24"}], "rc": 0, "start": "2019-11-18 11:37:41.077468", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Add IP addresses to Namespace VETH Pairs] *************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.2.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't1_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM4if1'}], u'vxlan': [{u'local_ip': u'10.2.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.129.2', u'remote_route': u'10.1.1.0/24', u'subnet_route': u'10.2.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.1.1.2'}]}, {u'tenant_sub_ip': u'10.2.1.2/24', u'tenant_ns_ip': u'10.2.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t1ns1\" ip addr show \"t1s1if\" | awk 'FNR==3{ print $2 }' | grep -w '^10.2.1.2/24' ; if [ $? -ne 0 ] ; then ip netns exec \"t1ns1\" ip addr add \"10.2.1.2/24\" dev \"t1s1if\" ; fi\n\nip netns exec \"t1\" ip addr show \"t1ns1if\" | awk 'FNR==3{ print $2 }' | grep -w '^10.2.1.1/24' ; if [ $? -ne 0 ] ; then ip netns exec \"t1\" ip addr add \"10.2.1.1/24\" dev \"t1ns1if\" ; fi\n", "delta": "0:00:00.150237", "end": "2019-11-18 11:37:41.696058", "item": [{"bridge_name": "t1br1", "default_route_ip": "10.2.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.2.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "vms": [{"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM4", "vcpu": 4, "vmif": "t1VM4if1"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.1.2", "remote_ip": "10.1.1.2", "remote_route": "10.1.1.0/24", "subnet_route": "10.2.1.0/24", "tenant_route_ip": "192.168.129.2", "v_name": "vxlan_t1s1"}]}, {"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.2.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.2.1.2/24"}], "rc": 0, "start": "2019-11-18 11:37:41.545821", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Add IP Route to Tenant] *******************************************************************************************************************************
changed: [99.99.99.2] => (item={u'default_route_ip': u'192.168.129.1', u'name': u't1', u'pns_ip': u'192.168.129.1/24', u'tenant_if': u't1if', u'tenant_ip': u'192.168.129.2/24', u'pns_if': u't1pns_if'}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t1\" ip route show default | grep -w '[d]efault via 192.168.129.1' ; if [ $? -ne 0 ] ; then ip netns exec \"t1\" ip route add default via \"192.168.129.1\" ; fi\n", "delta": "0:00:00.074077", "end": "2019-11-18 11:37:42.164126", "item": {"default_route_ip": "192.168.129.1", "name": "t1", "pns_if": "t1pns_if", "pns_ip": "192.168.129.1/24", "tenant_if": "t1if", "tenant_ip": "192.168.129.2/24"}, "rc": 0, "start": "2019-11-18 11:37:42.090049", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Add IP Route to Tenant Subnet] ************************************************************************************************************************
changed: [99.99.99.2] => (item={u'route': [{u'ip': u'10.2.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.2.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.1.2/24', u'tenant_ns_ip': u'10.2.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_ns_name': u't1', u'tenant_sub_if': u't1s1if'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't1_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM4if1'}], u'vxlan': [{u'local_ip': u'10.2.1.2', u'tenant_route_ip': u'192.168.129.2', u'dsport': 4789, u'dev': u't1s1if', u'subnet_route': u'10.2.1.0/24', u'remote_route': u'10.1.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.1.1.2'}]}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t1ns1\" ip route show default | grep -w '[d]efault via 10.2.1.1' ; if [ $? -ne 0 ] ; then ip netns exec \"t1ns1\" ip route add default via \"10.2.1.1\" ; fi\n", "delta": "0:00:00.072577", "end": "2019-11-18 11:37:42.616023", "item": {"bridge_name": "t1br1", "default_route_ip": "10.2.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.2.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.2.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.2.1.2/24"}], "vms": [{"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM4", "vcpu": 4, "vmif": "t1VM4if1"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.1.2", "remote_ip": "10.1.1.2", "remote_route": "10.1.1.0/24", "subnet_route": "10.2.1.0/24", "tenant_route_ip": "192.168.129.2", "v_name": "vxlan_t1s1"}]}, "rc": 0, "start": "2019-11-18 11:37:42.543446", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Create bridge inside namespace] ***********************************************************************************************************************
changed: [99.99.99.2] => (item={u'route': [{u'ip': u'10.2.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.2.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.1.2/24', u'tenant_ns_ip': u'10.2.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_ns_name': u't1', u'tenant_sub_if': u't1s1if'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't1_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM4if1'}], u'vxlan': [{u'local_ip': u'10.2.1.2', u'tenant_route_ip': u'192.168.129.2', u'dsport': 4789, u'dev': u't1s1if', u'subnet_route': u'10.2.1.0/24', u'remote_route': u'10.1.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.1.1.2'}]}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t1ns1\" brctl show | grep -w '^t1br1'; if [ $? -ne 0 ] ; then ip netns exec \"t1ns1\" brctl addbr \"t1br1\" ; fi\nip netns exec \"t1ns1\" ip link set dev \"t1br1\" up\n", "delta": "0:00:00.115711", "end": "2019-11-18 11:37:43.132109", "item": {"bridge_name": "t1br1", "default_route_ip": "10.2.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.2.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.2.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.2.1.2/24"}], "vms": [{"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM4", "vcpu": 4, "vmif": "t1VM4if1"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.1.2", "remote_ip": "10.1.1.2", "remote_route": "10.1.1.0/24", "subnet_route": "10.2.1.0/24", "tenant_route_ip": "192.168.129.2", "v_name": "vxlan_t1s1"}]}, "rc": 0, "start": "2019-11-18 11:37:43.016398", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Create DNS VETH Pair] *********************************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.2.1.1', u'bridge_name': u't1br1', u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.1.2/24', u'tenant_ns_ip': u'10.2.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't1_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM4if1'}], u'vxlan': [{u'local_ip': u'10.2.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.129.2', u'remote_route': u'10.1.1.0/24', u'subnet_route': u'10.2.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.1.1.2'}]}, {u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t1ns1\" ip link show \"t1s1_dnsbrif\" ; if [ $? -ne 0 ] ; then ip netns exec \"t1ns1\" ip link add \"t1s1_dnsbrif\" type veth peer name \"t1s1_dnsif\" ; fi\nip netns exec \"t1ns1\" ip link set dev \"t1s1_dnsbrif\" up\nip netns exec \"t1ns1\" ip link set dev \"t1s1_dnsif\" up\n", "delta": "0:00:00.144538", "end": "2019-11-18 11:37:43.672093", "item": [{"bridge_name": "t1br1", "default_route_ip": "10.2.1.1", "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.2.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.2.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.2.1.2/24"}], "vms": [{"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM4", "vcpu": 4, "vmif": "t1VM4if1"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.1.2", "remote_ip": "10.1.1.2", "remote_route": "10.1.1.0/24", "subnet_route": "10.2.1.0/24", "tenant_route_ip": "192.168.129.2", "v_name": "vxlan_t1s1"}]}, {"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "rc": 0, "start": "2019-11-18 11:37:43.527555", "stderr": "Device \"t1s1_dnsbrif\" does not exist.", "stderr_lines": ["Device \"t1s1_dnsbrif\" does not exist."], "stdout": "", "stdout_lines": []}

TASK [Attach DNS VETH Pair] *********************************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.2.1.1', u'bridge_name': u't1br1', u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.1.2/24', u'tenant_ns_ip': u'10.2.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't1_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM4if1'}], u'vxlan': [{u'local_ip': u'10.2.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.129.2', u'remote_route': u'10.1.1.0/24', u'subnet_route': u'10.2.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.1.1.2'}]}, {u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t1ns1\" brctl show \"t1br1\" | grep -w 't1s1_dnsbrif' ; if [ $? -ne 0 ] ; then ip netns exec \"t1ns1\" brctl addif \"t1br1\" \"t1s1_dnsbrif\" ; fi\n", "delta": "0:00:00.079241", "end": "2019-11-18 11:37:44.152019", "item": [{"bridge_name": "t1br1", "default_route_ip": "10.2.1.1", "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.2.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.2.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.2.1.2/24"}], "vms": [{"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM4", "vcpu": 4, "vmif": "t1VM4if1"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.1.2", "remote_ip": "10.1.1.2", "remote_route": "10.1.1.0/24", "subnet_route": "10.2.1.0/24", "tenant_route_ip": "192.168.129.2", "v_name": "vxlan_t1s1"}]}, {"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "rc": 0, "start": "2019-11-18 11:37:44.072778", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Create VETH Pairs] ************************************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.2.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.1.2/24', u'tenant_ns_ip': u'10.2.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.2.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.129.2', u'remote_route': u'10.1.1.0/24', u'subnet_route': u'10.2.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.1.1.2'}]}, {u'mem': 2, u'name': u't1_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM4if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip link show \"t1br1if1\" ; if [ $? -ne 0 ] ; then ip link add \"t1VM4if1\" type veth peer name \"t1br1if1\" ; fi\nip link set dev \"t1br1if1\" up\nip link set dev \"t1VM4if1\" up\n", "delta": "0:00:00.019668", "end": "2019-11-18 11:37:44.598606", "item": [{"bridge_name": "t1br1", "default_route_ip": "10.2.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.2.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.2.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.2.1.2/24"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.1.2", "remote_ip": "10.1.1.2", "remote_route": "10.1.1.0/24", "subnet_route": "10.2.1.0/24", "tenant_route_ip": "192.168.129.2", "v_name": "vxlan_t1s1"}]}, {"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM4", "vcpu": 4, "vmif": "t1VM4if1"}], "rc": 0, "start": "2019-11-18 11:37:44.578938", "stderr": "Device \"t1br1if1\" does not exist.", "stderr_lines": ["Device \"t1br1if1\" does not exist."], "stdout": "", "stdout_lines": []}

TASK [Attach VETH Pairs] ************************************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.2.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.1.2/24', u'tenant_ns_ip': u'10.2.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.2.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.129.2', u'remote_route': u'10.1.1.0/24', u'subnet_route': u'10.2.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.1.1.2'}]}, {u'mem': 2, u'name': u't1_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM4if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip link show \"t1br1if1\" ; if [ $? -eq 0 ] ; then ip link set \"t1br1if1\" netns \"t1ns1\" ; fi\nip netns exec \"t1ns1\" brctl show \"t1br1\" | grep -w 't1br1if1' ; if [ $? -ne 0 ] ; then ip netns exec \"t1ns1\" brctl addif \"t1br1\" \"t1br1if1\" ; fi\n", "delta": "0:00:00.104631", "end": "2019-11-18 11:37:45.112075", "item": [{"bridge_name": "t1br1", "default_route_ip": "10.2.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.2.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.2.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.2.1.2/24"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.1.2", "remote_ip": "10.1.1.2", "remote_route": "10.1.1.0/24", "subnet_route": "10.2.1.0/24", "tenant_route_ip": "192.168.129.2", "v_name": "vxlan_t1s1"}]}, {"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM4", "vcpu": 4, "vmif": "t1VM4if1"}], "rc": 0, "start": "2019-11-18 11:37:45.007444", "stderr": "", "stderr_lines": [], "stdout": "18: t1br1if1@t1VM4if1: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP mode DEFAULT group default qlen 1000\n    link/ether 3a:92:28:c2:18:a1 brd ff:ff:ff:ff:ff:ff", "stdout_lines": ["18: t1br1if1@t1VM4if1: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP mode DEFAULT group default qlen 1000", "    link/ether 3a:92:28:c2:18:a1 brd ff:ff:ff:ff:ff:ff"]}

TASK [All interfaces and bridges UP] ************************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.2.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.1.2/24', u'tenant_ns_ip': u'10.2.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.2.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.129.2', u'remote_route': u'10.1.1.0/24', u'subnet_route': u'10.2.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.1.1.2'}]}, {u'mem': 2, u'name': u't1_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM4if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t1ns1\" ip link set \"t1br1if1\" up\nip netns exec \"t1ns1\" ip link set dev \"t1br1\" up\n", "delta": "0:00:00.071038", "end": "2019-11-18 11:37:45.560195", "item": [{"bridge_name": "t1br1", "default_route_ip": "10.2.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.2.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.2.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.2.1.2/24"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.1.2", "remote_ip": "10.1.1.2", "remote_route": "10.1.1.0/24", "subnet_route": "10.2.1.0/24", "tenant_route_ip": "192.168.129.2", "v_name": "vxlan_t1s1"}]}, {"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM4", "vcpu": 4, "vmif": "t1VM4if1"}], "rc": 0, "start": "2019-11-18 11:37:45.489157", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Add IP to DNS Interface] ******************************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.2.1.1', u'bridge_name': u't1br1', u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.1.2/24', u'tenant_ns_ip': u'10.2.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't1_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM4if1'}], u'vxlan': [{u'local_ip': u'10.2.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.129.2', u'remote_route': u'10.1.1.0/24', u'subnet_route': u'10.2.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.1.1.2'}]}, {u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t1ns1\" ip addr show \"t1s1_dnsif\" | awk 'FNR==3{ print $2}'| grep -w '^1.1.1.128/24' ; if [ $? -ne 0 ] ; then ip netns exec \"t1ns1\" ip addr add \"1.1.1.128/24\" dev \"t1s1_dnsif\" ; fi\n", "delta": "0:00:00.076904", "end": "2019-11-18 11:37:46.052202", "item": [{"bridge_name": "t1br1", "default_route_ip": "10.2.1.1", "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.2.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.2.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.2.1.2/24"}], "vms": [{"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM4", "vcpu": 4, "vmif": "t1VM4if1"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.1.2", "remote_ip": "10.1.1.2", "remote_route": "10.1.1.0/24", "subnet_route": "10.2.1.0/24", "tenant_route_ip": "192.168.129.2", "v_name": "vxlan_t1s1"}]}, {"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "rc": 0, "start": "2019-11-18 11:37:45.975298", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Install DHCP Server] **********************************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.2.1.1', u'bridge_name': u't1br1', u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.1.2/24', u'tenant_ns_ip': u'10.2.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't1_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM4if1'}], u'vxlan': [{u'local_ip': u'10.2.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.129.2', u'remote_route': u'10.1.1.0/24', u'subnet_route': u'10.2.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.1.1.2'}]}, {u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t1ns1\" ps aux | grep -w '[d]nsmasq --interface t1s1_dnsif -z --dhcp-range=1.1.1.133,1.1.1.254' ; if [ $? -ne 0 ] ; then ip netns exec \"t1ns1\" dnsmasq --interface \"t1s1_dnsif\" -z --dhcp-range=1.1.1.133,'1.1.1.254' ; fi\n", "delta": "0:00:00.073567", "end": "2019-11-18 11:37:46.524910", "item": [{"bridge_name": "t1br1", "default_route_ip": "10.2.1.1", "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.2.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.2.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.2.1.2/24"}], "vms": [{"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM4", "vcpu": 4, "vmif": "t1VM4if1"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.1.2", "remote_ip": "10.1.1.2", "remote_route": "10.1.1.0/24", "subnet_route": "10.2.1.0/24", "tenant_route_ip": "192.168.129.2", "v_name": "vxlan_t1s1"}]}, {"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "rc": 0, "start": "2019-11-18 11:37:46.451343", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Create VXLAN devices] *********************************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.2.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.1.2/24', u'tenant_ns_ip': u'10.2.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't1_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM4if1'}]}, {u'local_ip': u'10.2.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.129.2', u'remote_route': u'10.1.1.0/24', u'subnet_route': u'10.2.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.1.1.2'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t1ns1\" ip link show \"vxlan_t1s1\" ; if [ $? -ne 0 ] ; then ip netns exec \"t1ns1\" ip link add \"vxlan_t1s1\" type vxlan id \"42\" local \"10.2.1.2\" remote \"10.1.1.2\" dstport \"4789\" dev \"t1s1if\" ; ip netns exec \"t1ns1\" ip link set dev \"vxlan_t1s1\" up ; fi\n", "delta": "0:00:00.142132", "end": "2019-11-18 11:37:47.080018", "item": [{"bridge_name": "t1br1", "default_route_ip": "10.2.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.2.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.2.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.2.1.2/24"}], "vms": [{"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM4", "vcpu": 4, "vmif": "t1VM4if1"}]}, {"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.1.2", "remote_ip": "10.1.1.2", "remote_route": "10.1.1.0/24", "subnet_route": "10.2.1.0/24", "tenant_route_ip": "192.168.129.2", "v_name": "vxlan_t1s1"}], "rc": 0, "start": "2019-11-18 11:37:46.937886", "stderr": "Device \"vxlan_t1s1\" does not exist.", "stderr_lines": ["Device \"vxlan_t1s1\" does not exist."], "stdout": "", "stdout_lines": []}

TASK [Attach VXLANs to bridge] ******************************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.2.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.1.2/24', u'tenant_ns_ip': u'10.2.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't1_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM4if1'}]}, {u'local_ip': u'10.2.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.129.2', u'remote_route': u'10.1.1.0/24', u'subnet_route': u'10.2.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.1.1.2'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t1ns1\" brctl show \"t1br1\" | grep -w 'vxlan_t1s1' ; if [ $? -ne 0 ] ; then ip netns exec \"t1ns1\" brctl addif \"t1br1\" \"vxlan_t1s1\" ; fi\n", "delta": "0:00:00.067800", "end": "2019-11-18 11:37:47.552108", "item": [{"bridge_name": "t1br1", "default_route_ip": "10.2.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.2.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.2.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.2.1.2/24"}], "vms": [{"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM4", "vcpu": 4, "vmif": "t1VM4if1"}]}, {"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.1.2", "remote_ip": "10.1.1.2", "remote_route": "10.1.1.0/24", "subnet_route": "10.2.1.0/24", "tenant_route_ip": "192.168.129.2", "v_name": "vxlan_t1s1"}], "rc": 0, "start": "2019-11-18 11:37:47.484308", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

PLAY RECAP **************************************************************************************************************************************************
99.99.99.2                 : ok=21   changed=21   unreachable=0    failed=0    skipped=0    rescued=0    ignored=0   

Using /etc/ansible/ansible.cfg as config file

PLAY [main] *************************************************************************************************************************************************

TASK [Add VXLAN routes in PNS] ******************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.1.2/24', u'tenant_ns_ip': u'10.1.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't1_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM1if1'}, {u'mem': 4, u'name': u't1_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br1if2', u'vmif': u't1VM2if1'}]}, {u'local_ip': u'10.1.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.1.2', u'remote_route': u'10.2.1.0/24', u'subnet_route': u'10.1.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.2.1.2'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec pns ip route show \"10.1.1.0/24\" via \"192.168.1.2\" | grep -w '^10.1.1.0/24' ; if [ $? -ne 0 ] ; then ip netns exec pns ip route add \"10.1.1.0/24\" via \"192.168.1.2\" ; fi\n", "delta": "0:00:00.070104", "end": "2019-11-18 11:37:48.792239", "item": [{"bridge_name": "t1br1", "default_route_ip": "10.1.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.1.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.1.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.1.1.2/24"}], "vms": [{"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM1", "vcpu": 4, "vmif": "t1VM1if1"}, {"brif": "t1br1if2", "disk": "10G", "mem": 4, "name": "t1_VM2", "vcpu": 2, "vmif": "t1VM2if1"}]}, {"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.1.2", "remote_ip": "10.2.1.2", "remote_route": "10.2.1.0/24", "subnet_route": "10.1.1.0/24", "tenant_route_ip": "192.168.1.2", "v_name": "vxlan_t1s1"}], "rc": 0, "start": "2019-11-18 11:37:48.722135", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}
skipping: [localhost] => (item=[{u'route': [{u'ip': u'10.1.2.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.2.1', u'bridge_name': u't1br2', u'dns': [{u'dnsif': u't1s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s2_dnsbrif'}], u'ns_name': u't1ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.2.2/24', u'tenant_ns_ip': u'10.1.2.1/24', u'tenant_ns_if': u't1ns2if', u'tenant_sub_if': u't1s2if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'2.2.2.0/24', u'vms': [{u'mem': 3, u'name': u't1_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br2if1', u'vmif': u't1VM3if1'}]}, {u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}])  => {"ansible_loop_var": "item", "changed": false, "item": [{"bridge_name": "t1br2", "default_route_ip": "10.1.2.1", "dns": [{"brif": "t1s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t1s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns2", "route": [{"if": "p1", "ip": "10.1.2.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "2.2.2.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns2if", "tenant_ns_ip": "10.1.2.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s2if", "tenant_sub_ip": "10.1.2.2/24"}], "vms": [{"brif": "t1br2if1", "disk": "10G", "mem": 3, "name": "t1_VM3", "vcpu": 2, "vmif": "t1VM3if1"}]}, {"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}], "skip_reason": "Conditional result was False"}

TASK [Get PNS ip address] ***********************************************************************************************************************************
ok: [localhost] => {"changed": false, "cmd": "ip netns exec pns ip addr show p1 | awk 'FNR==3{ print $2 }' | awk -F/ '{ print $1 }'\n", "delta": "0:00:00.034019", "end": "2019-11-18 11:37:49.084764", "rc": 0, "start": "2019-11-18 11:37:49.050745", "stderr": "", "stderr_lines": [], "stdout": "192.168.100.238", "stdout_lines": ["192.168.100.238"]}

TASK [Add VXLAN routes to host] *****************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.1.2/24', u'tenant_ns_ip': u'10.1.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't1_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM1if1'}, {u'mem': 4, u'name': u't1_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br1if2', u'vmif': u't1VM2if1'}]}, {u'local_ip': u'10.1.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.1.2', u'remote_route': u'10.2.1.0/24', u'subnet_route': u'10.1.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.2.1.2'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip route show \"10.1.1.0/24\" via \"192.168.100.238\" | grep -w '^10.1.1.0/24' ; if [ $? -ne 0 ] ; then ip route add \"10.1.1.0/24\" via \"192.168.100.238\" ; fi\nip route show \"10.2.1.0/24\" via 99.99.99.2 | grep -w '^10.2.1.0/24'; if [ $? -ne 0 ] ; then ip route add \"10.2.1.0/24\" via 99.99.99.2 ; fi\n", "delta": "0:00:00.007626", "end": "2019-11-18 11:37:49.360497", "item": [{"bridge_name": "t1br1", "default_route_ip": "10.1.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.1.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.1.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.1.1.2/24"}], "vms": [{"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM1", "vcpu": 4, "vmif": "t1VM1if1"}, {"brif": "t1br1if2", "disk": "10G", "mem": 4, "name": "t1_VM2", "vcpu": 2, "vmif": "t1VM2if1"}]}, {"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.1.2", "remote_ip": "10.2.1.2", "remote_route": "10.2.1.0/24", "subnet_route": "10.1.1.0/24", "tenant_route_ip": "192.168.1.2", "v_name": "vxlan_t1s1"}], "rc": 0, "start": "2019-11-18 11:37:49.352871", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}
skipping: [localhost] => (item=[{u'route': [{u'ip': u'10.1.2.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.2.1', u'bridge_name': u't1br2', u'dns': [{u'dnsif': u't1s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s2_dnsbrif'}], u'ns_name': u't1ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.2.2/24', u'tenant_ns_ip': u'10.1.2.1/24', u'tenant_ns_if': u't1ns2if', u'tenant_sub_if': u't1s2if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'2.2.2.0/24', u'vms': [{u'mem': 3, u'name': u't1_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br2if1', u'vmif': u't1VM3if1'}]}, {u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}])  => {"ansible_loop_var": "item", "changed": false, "item": [{"bridge_name": "t1br2", "default_route_ip": "10.1.2.1", "dns": [{"brif": "t1s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t1s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns2", "route": [{"if": "p1", "ip": "10.1.2.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "2.2.2.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns2if", "tenant_ns_ip": "10.1.2.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s2if", "tenant_sub_ip": "10.1.2.2/24"}], "vms": [{"brif": "t1br2if1", "disk": "10G", "mem": 3, "name": "t1_VM3", "vcpu": 2, "vmif": "t1VM3if1"}]}, {"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}], "skip_reason": "Conditional result was False"}

PLAY RECAP **************************************************************************************************************************************************
localhost                  : ok=3    changed=2    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0   

Using /etc/ansible/ansible.cfg as config file

PLAY [worker] ***********************************************************************************************************************************************

TASK [Add VXLAN routes in PNS] ******************************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.2.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.1.2/24', u'tenant_ns_ip': u'10.2.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't1_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM4if1'}]}, {u'local_ip': u'10.2.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.129.2', u'remote_route': u'10.1.1.0/24', u'subnet_route': u'10.2.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.1.1.2'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec pns ip route show \"10.2.1.0/24\" via \"192.168.129.2\" | grep -w '^10.2.1.0/24' ; if [ $? -ne 0 ] ; then ip netns exec pns ip route add \"10.2.1.0/24\" via \"192.168.129.2\" ; fi\n", "delta": "0:00:00.086425", "end": "2019-11-18 11:37:50.564153", "item": [{"bridge_name": "t1br1", "default_route_ip": "10.2.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.2.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.2.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.2.1.2/24"}], "vms": [{"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM4", "vcpu": 4, "vmif": "t1VM4if1"}]}, {"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.1.2", "remote_ip": "10.1.1.2", "remote_route": "10.1.1.0/24", "subnet_route": "10.2.1.0/24", "tenant_route_ip": "192.168.129.2", "v_name": "vxlan_t1s1"}], "rc": 0, "start": "2019-11-18 11:37:50.477728", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Get PNS ip address] ***********************************************************************************************************************************
ok: [99.99.99.2] => {"changed": false, "cmd": "ip netns exec pns ip addr show p1 | awk 'FNR==3{ print $2 }' | awk -F/ '{ print $1 }'\n", "delta": "0:00:00.040963", "end": "2019-11-18 11:37:51.004413", "rc": 0, "start": "2019-11-18 11:37:50.963450", "stderr": "", "stderr_lines": [], "stdout": "192.168.100.50", "stdout_lines": ["192.168.100.50"]}

TASK [Add VXLAN routes to host] *****************************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.2.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.1.2/24', u'tenant_ns_ip': u'10.2.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't1_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM4if1'}]}, {u'local_ip': u'10.2.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.129.2', u'remote_route': u'10.1.1.0/24', u'subnet_route': u'10.2.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.1.1.2'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip route show \"10.2.1.0/24\" via \"192.168.100.50\" | grep -w '^10.2.1.0/24' ; if [ $? -ne 0 ] ; then ip route add \"10.2.1.0/24\" via \"192.168.100.50\" ; fi\nip route show \"10.1.1.0/24\" via 99.99.99.1 | grep -w '^10.1.1.0/24'; if [ $? -ne 0 ] ; then ip route add \"10.1.1.0/24\" via 99.99.99.1 ; fi\n", "delta": "0:00:00.008650", "end": "2019-11-18 11:37:51.425284", "item": [{"bridge_name": "t1br1", "default_route_ip": "10.2.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.2.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.2.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.2.1.2/24"}], "vms": [{"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM4", "vcpu": 4, "vmif": "t1VM4if1"}]}, {"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.1.2", "remote_ip": "10.1.1.2", "remote_route": "10.1.1.0/24", "subnet_route": "10.2.1.0/24", "tenant_route_ip": "192.168.129.2", "v_name": "vxlan_t1s1"}], "rc": 0, "start": "2019-11-18 11:37:51.416634", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

PLAY RECAP **************************************************************************************************************************************************
99.99.99.2                 : ok=3    changed=2    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0   

Using /etc/ansible/ansible.cfg as config file

PLAY [main] *************************************************************************************************************************************************

TASK [Create VM templates (C1)] *****************************************************************************************************************************
ok: [localhost] => (item=[{u'route': [{u'ip': u'10.1.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.1.2/24', u'tenant_ns_ip': u'10.1.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.1.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.1.2', u'remote_route': u'10.2.1.0/24', u'subnet_route': u'10.1.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.2.1.2'}]}, {u'mem': 2, u'name': u't1_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM1if1'}]) => {"ansible_loop_var": "item", "changed": false, "checksum": "350ba870bd31b7f6ee517845c14237910b5af0bf", "dest": "/root/Migration-as-a-Service/t1/VM_templates/t1_VM1.xml.j2", "gid": 0, "group": "root", "item": [{"bridge_name": "t1br1", "default_route_ip": "10.1.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.1.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.1.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.1.1.2/24"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.1.2", "remote_ip": "10.2.1.2", "remote_route": "10.2.1.0/24", "subnet_route": "10.1.1.0/24", "tenant_route_ip": "192.168.1.2", "v_name": "vxlan_t1s1"}]}, {"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM1", "vcpu": 4, "vmif": "t1VM1if1"}], "mode": "0644", "owner": "root", "path": "/root/Migration-as-a-Service/t1/VM_templates/t1_VM1.xml.j2", "size": 4091, "state": "file", "uid": 0}
ok: [localhost] => (item=[{u'route': [{u'ip': u'10.1.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.1.2/24', u'tenant_ns_ip': u'10.1.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.1.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.1.2', u'remote_route': u'10.2.1.0/24', u'subnet_route': u'10.1.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.2.1.2'}]}, {u'mem': 4, u'name': u't1_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br1if2', u'vmif': u't1VM2if1'}]) => {"ansible_loop_var": "item", "changed": false, "checksum": "350ba870bd31b7f6ee517845c14237910b5af0bf", "dest": "/root/Migration-as-a-Service/t1/VM_templates/t1_VM2.xml.j2", "gid": 0, "group": "root", "item": [{"bridge_name": "t1br1", "default_route_ip": "10.1.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.1.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.1.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.1.1.2/24"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.1.2", "remote_ip": "10.2.1.2", "remote_route": "10.2.1.0/24", "subnet_route": "10.1.1.0/24", "tenant_route_ip": "192.168.1.2", "v_name": "vxlan_t1s1"}]}, {"brif": "t1br1if2", "disk": "10G", "mem": 4, "name": "t1_VM2", "vcpu": 2, "vmif": "t1VM2if1"}], "mode": "0644", "owner": "root", "path": "/root/Migration-as-a-Service/t1/VM_templates/t1_VM2.xml.j2", "size": 4091, "state": "file", "uid": 0}
ok: [localhost] => (item=[{u'route': [{u'ip': u'10.1.2.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.2.1', u'bridge_name': u't1br2', u'dns': [{u'dnsif': u't1s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s2_dnsbrif'}], u'ns_name': u't1ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.2.2/24', u'tenant_ns_ip': u'10.1.2.1/24', u'tenant_ns_if': u't1ns2if', u'tenant_sub_if': u't1s2if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'2.2.2.0/24', u'vxlan': [{u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}, {u'mem': 3, u'name': u't1_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br2if1', u'vmif': u't1VM3if1'}]) => {"ansible_loop_var": "item", "changed": false, "checksum": "350ba870bd31b7f6ee517845c14237910b5af0bf", "dest": "/root/Migration-as-a-Service/t1/VM_templates/t1_VM3.xml.j2", "gid": 0, "group": "root", "item": [{"bridge_name": "t1br2", "default_route_ip": "10.1.2.1", "dns": [{"brif": "t1s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t1s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns2", "route": [{"if": "p1", "ip": "10.1.2.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "2.2.2.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns2if", "tenant_ns_ip": "10.1.2.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s2if", "tenant_sub_ip": "10.1.2.2/24"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, {"brif": "t1br2if1", "disk": "10G", "mem": 3, "name": "t1_VM3", "vcpu": 2, "vmif": "t1VM3if1"}], "mode": "0644", "owner": "root", "path": "/root/Migration-as-a-Service/t1/VM_templates/t1_VM3.xml.j2", "size": 4091, "state": "file", "uid": 0}

PLAY RECAP **************************************************************************************************************************************************
localhost                  : ok=1    changed=0    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0   

Using /etc/ansible/ansible.cfg as config file

PLAY [main] *************************************************************************************************************************************************

TASK [Create VM templates (C2)] *****************************************************************************************************************************
ok: [localhost] => (item=[{u'route': [{u'ip': u'10.2.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.2.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.1.2/24', u'tenant_ns_ip': u'10.2.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.2.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.129.2', u'remote_route': u'10.1.1.0/24', u'subnet_route': u'10.2.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.1.1.2'}]}, {u'mem': 2, u'name': u't1_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM4if1'}]) => {"ansible_loop_var": "item", "changed": false, "checksum": "350ba870bd31b7f6ee517845c14237910b5af0bf", "dest": "/root/Migration-as-a-Service/t1/VM_templates/t1_VM4.xml.j2", "gid": 0, "group": "root", "item": [{"bridge_name": "t1br1", "default_route_ip": "10.2.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.2.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.2.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.2.1.2/24"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.1.2", "remote_ip": "10.1.1.2", "remote_route": "10.1.1.0/24", "subnet_route": "10.2.1.0/24", "tenant_route_ip": "192.168.129.2", "v_name": "vxlan_t1s1"}]}, {"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM4", "vcpu": 4, "vmif": "t1VM4if1"}], "mode": "0644", "owner": "root", "path": "/root/Migration-as-a-Service/t1/VM_templates/t1_VM4.xml.j2", "size": 4091, "state": "file", "uid": 0}

PLAY RECAP **************************************************************************************************************************************************
localhost                  : ok=1    changed=0    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0   

Using /etc/ansible/ansible.cfg as config file

PLAY [main] *************************************************************************************************************************************************

TASK [Copy VM image] ****************************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.1.2/24', u'tenant_ns_ip': u'10.1.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.1.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.1.2', u'remote_route': u'10.2.1.0/24', u'subnet_route': u'10.1.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.2.1.2'}]}, {u'mem': 2, u'name': u't1_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM1if1'}]) => {"ansible_loop_var": "item", "changed": true, "checksum": "d86d5962370fcd0c3d05943fc209d9e05fdac89f", "dest": "/var/lib/libvirt/images/t1_VM1.qcow2", "gid": 0, "group": "root", "item": [{"bridge_name": "t1br1", "default_route_ip": "10.1.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.1.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.1.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.1.1.2/24"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.1.2", "remote_ip": "10.2.1.2", "remote_route": "10.2.1.0/24", "subnet_route": "10.1.1.0/24", "tenant_route_ip": "192.168.1.2", "v_name": "vxlan_t1s1"}]}, {"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM1", "vcpu": 4, "vmif": "t1VM1if1"}], "md5sum": "b977a19124b65f2d544ddc62e407114d", "mode": "0644", "owner": "root", "size": 10739318784, "src": "/root/.ansible/tmp/ansible-tmp-1574077075.31-177153298994279/source", "state": "file", "uid": 0}
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.1.2/24', u'tenant_ns_ip': u'10.1.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.1.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.1.2', u'remote_route': u'10.2.1.0/24', u'subnet_route': u'10.1.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.2.1.2'}]}, {u'mem': 4, u'name': u't1_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br1if2', u'vmif': u't1VM2if1'}]) => {"ansible_loop_var": "item", "changed": true, "checksum": "d86d5962370fcd0c3d05943fc209d9e05fdac89f", "dest": "/var/lib/libvirt/images/t1_VM2.qcow2", "gid": 0, "group": "root", "item": [{"bridge_name": "t1br1", "default_route_ip": "10.1.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.1.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.1.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.1.1.2/24"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.1.2", "remote_ip": "10.2.1.2", "remote_route": "10.2.1.0/24", "subnet_route": "10.1.1.0/24", "tenant_route_ip": "192.168.1.2", "v_name": "vxlan_t1s1"}]}, {"brif": "t1br1if2", "disk": "10G", "mem": 4, "name": "t1_VM2", "vcpu": 2, "vmif": "t1VM2if1"}], "md5sum": "b977a19124b65f2d544ddc62e407114d", "mode": "0644", "owner": "root", "size": 10739318784, "src": "/root/.ansible/tmp/ansible-tmp-1574077161.96-46262602730422/source", "state": "file", "uid": 0}
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.2.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.2.1', u'bridge_name': u't1br2', u'dns': [{u'dnsif': u't1s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s2_dnsbrif'}], u'ns_name': u't1ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.2.2/24', u'tenant_ns_ip': u'10.1.2.1/24', u'tenant_ns_if': u't1ns2if', u'tenant_sub_if': u't1s2if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'2.2.2.0/24', u'vxlan': [{u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}, {u'mem': 3, u'name': u't1_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br2if1', u'vmif': u't1VM3if1'}]) => {"ansible_loop_var": "item", "changed": true, "checksum": "d86d5962370fcd0c3d05943fc209d9e05fdac89f", "dest": "/var/lib/libvirt/images/t1_VM3.qcow2", "gid": 0, "group": "root", "item": [{"bridge_name": "t1br2", "default_route_ip": "10.1.2.1", "dns": [{"brif": "t1s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t1s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns2", "route": [{"if": "p1", "ip": "10.1.2.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "2.2.2.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns2if", "tenant_ns_ip": "10.1.2.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s2if", "tenant_sub_ip": "10.1.2.2/24"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, {"brif": "t1br2if1", "disk": "10G", "mem": 3, "name": "t1_VM3", "vcpu": 2, "vmif": "t1VM3if1"}], "md5sum": "b977a19124b65f2d544ddc62e407114d", "mode": "0644", "owner": "root", "size": 10739318784, "src": "/root/.ansible/tmp/ansible-tmp-1574077238.43-165842526118498/source", "state": "file", "uid": 0}

TASK [Create VM templates (C1)] *****************************************************************************************************************************
ok: [localhost] => (item=[{u'route': [{u'ip': u'10.1.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.1.2/24', u'tenant_ns_ip': u'10.1.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.1.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.1.2', u'remote_route': u'10.2.1.0/24', u'subnet_route': u'10.1.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.2.1.2'}]}, {u'mem': 2, u'name': u't1_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM1if1'}]) => {"ansible_loop_var": "item", "changed": false, "checksum": "350ba870bd31b7f6ee517845c14237910b5af0bf", "dest": "/root/Migration-as-a-Service/t1/VM_templates/t1_VM1.xml.j2", "gid": 0, "group": "root", "item": [{"bridge_name": "t1br1", "default_route_ip": "10.1.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.1.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.1.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.1.1.2/24"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.1.2", "remote_ip": "10.2.1.2", "remote_route": "10.2.1.0/24", "subnet_route": "10.1.1.0/24", "tenant_route_ip": "192.168.1.2", "v_name": "vxlan_t1s1"}]}, {"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM1", "vcpu": 4, "vmif": "t1VM1if1"}], "mode": "0644", "owner": "root", "path": "/root/Migration-as-a-Service/t1/VM_templates/t1_VM1.xml.j2", "size": 4091, "state": "file", "uid": 0}
ok: [localhost] => (item=[{u'route': [{u'ip': u'10.1.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.1.2/24', u'tenant_ns_ip': u'10.1.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.1.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.1.2', u'remote_route': u'10.2.1.0/24', u'subnet_route': u'10.1.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.2.1.2'}]}, {u'mem': 4, u'name': u't1_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br1if2', u'vmif': u't1VM2if1'}]) => {"ansible_loop_var": "item", "changed": false, "checksum": "350ba870bd31b7f6ee517845c14237910b5af0bf", "dest": "/root/Migration-as-a-Service/t1/VM_templates/t1_VM2.xml.j2", "gid": 0, "group": "root", "item": [{"bridge_name": "t1br1", "default_route_ip": "10.1.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.1.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.1.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.1.1.2/24"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.1.2", "remote_ip": "10.2.1.2", "remote_route": "10.2.1.0/24", "subnet_route": "10.1.1.0/24", "tenant_route_ip": "192.168.1.2", "v_name": "vxlan_t1s1"}]}, {"brif": "t1br1if2", "disk": "10G", "mem": 4, "name": "t1_VM2", "vcpu": 2, "vmif": "t1VM2if1"}], "mode": "0644", "owner": "root", "path": "/root/Migration-as-a-Service/t1/VM_templates/t1_VM2.xml.j2", "size": 4091, "state": "file", "uid": 0}
ok: [localhost] => (item=[{u'route': [{u'ip': u'10.1.2.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.2.1', u'bridge_name': u't1br2', u'dns': [{u'dnsif': u't1s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s2_dnsbrif'}], u'ns_name': u't1ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.2.2/24', u'tenant_ns_ip': u'10.1.2.1/24', u'tenant_ns_if': u't1ns2if', u'tenant_sub_if': u't1s2if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'2.2.2.0/24', u'vxlan': [{u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}, {u'mem': 3, u'name': u't1_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br2if1', u'vmif': u't1VM3if1'}]) => {"ansible_loop_var": "item", "changed": false, "checksum": "350ba870bd31b7f6ee517845c14237910b5af0bf", "dest": "/root/Migration-as-a-Service/t1/VM_templates/t1_VM3.xml.j2", "gid": 0, "group": "root", "item": [{"bridge_name": "t1br2", "default_route_ip": "10.1.2.1", "dns": [{"brif": "t1s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t1s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns2", "route": [{"if": "p1", "ip": "10.1.2.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "2.2.2.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns2if", "tenant_ns_ip": "10.1.2.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s2if", "tenant_sub_ip": "10.1.2.2/24"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, {"brif": "t1br2if1", "disk": "10G", "mem": 3, "name": "t1_VM3", "vcpu": 2, "vmif": "t1VM3if1"}], "mode": "0644", "owner": "root", "path": "/root/Migration-as-a-Service/t1/VM_templates/t1_VM3.xml.j2", "size": 4091, "state": "file", "uid": 0}

TASK [Get list of running VMs] ******************************************************************************************************************************
ok: [localhost] => {"changed": false, "cmd": ["virsh", "list", "--name"], "delta": "0:00:01.348343", "end": "2019-11-18 11:42:13.712551", "rc": 0, "start": "2019-11-18 11:42:12.364208", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Define VM] ********************************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.1.2/24', u'tenant_ns_ip': u'10.1.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.1.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.1.2', u'remote_route': u'10.2.1.0/24', u'subnet_route': u'10.1.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.2.1.2'}]}, {u'mem': 2, u'name': u't1_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM1if1'}]) => {"ansible_loop_var": "item", "changed": true, "created": "t1_VM1", "item": [{"bridge_name": "t1br1", "default_route_ip": "10.1.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.1.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.1.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.1.1.2/24"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.1.2", "remote_ip": "10.2.1.2", "remote_route": "10.2.1.0/24", "subnet_route": "10.1.1.0/24", "tenant_route_ip": "192.168.1.2", "v_name": "vxlan_t1s1"}]}, {"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM1", "vcpu": 4, "vmif": "t1VM1if1"}], "warnings": ["'xml' is given - ignoring 'name'"]}
ok: [localhost] => (item=[{u'route': [{u'ip': u'10.1.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.1.2/24', u'tenant_ns_ip': u'10.1.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.1.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.1.2', u'remote_route': u'10.2.1.0/24', u'subnet_route': u'10.1.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.2.1.2'}]}, {u'mem': 4, u'name': u't1_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br1if2', u'vmif': u't1VM2if1'}]) => {"ansible_loop_var": "item", "changed": false, "item": [{"bridge_name": "t1br1", "default_route_ip": "10.1.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.1.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.1.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.1.1.2/24"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.1.2", "remote_ip": "10.2.1.2", "remote_route": "10.2.1.0/24", "subnet_route": "10.1.1.0/24", "tenant_route_ip": "192.168.1.2", "v_name": "vxlan_t1s1"}]}, {"brif": "t1br1if2", "disk": "10G", "mem": 4, "name": "t1_VM2", "vcpu": 2, "vmif": "t1VM2if1"}], "warnings": ["'xml' is given - ignoring 'name'"]}
ok: [localhost] => (item=[{u'route': [{u'ip': u'10.1.2.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.2.1', u'bridge_name': u't1br2', u'dns': [{u'dnsif': u't1s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s2_dnsbrif'}], u'ns_name': u't1ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.2.2/24', u'tenant_ns_ip': u'10.1.2.1/24', u'tenant_ns_if': u't1ns2if', u'tenant_sub_if': u't1s2if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'2.2.2.0/24', u'vxlan': [{u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}, {u'mem': 3, u'name': u't1_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br2if1', u'vmif': u't1VM3if1'}]) => {"ansible_loop_var": "item", "changed": false, "item": [{"bridge_name": "t1br2", "default_route_ip": "10.1.2.1", "dns": [{"brif": "t1s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t1s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns2", "route": [{"if": "p1", "ip": "10.1.2.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "2.2.2.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns2if", "tenant_ns_ip": "10.1.2.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s2if", "tenant_sub_ip": "10.1.2.2/24"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, {"brif": "t1br2if1", "disk": "10G", "mem": 3, "name": "t1_VM3", "vcpu": 2, "vmif": "t1VM3if1"}], "warnings": ["'xml' is given - ignoring 'name'"]}

TASK [Create VM] ********************************************************************************************************************************************
ok: [localhost] => (item=[{u'route': [{u'ip': u'10.1.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.1.2/24', u'tenant_ns_ip': u'10.1.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.1.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.1.2', u'remote_route': u'10.2.1.0/24', u'subnet_route': u'10.1.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.2.1.2'}]}, {u'mem': 2, u'name': u't1_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM1if1'}]) => {"ansible_loop_var": "item", "changed": false, "create": 0, "item": [{"bridge_name": "t1br1", "default_route_ip": "10.1.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.1.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.1.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.1.1.2/24"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.1.2", "remote_ip": "10.2.1.2", "remote_route": "10.2.1.0/24", "subnet_route": "10.1.1.0/24", "tenant_route_ip": "192.168.1.2", "v_name": "vxlan_t1s1"}]}, {"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM1", "vcpu": 4, "vmif": "t1VM1if1"}]}
ok: [localhost] => (item=[{u'route': [{u'ip': u'10.1.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.1.2/24', u'tenant_ns_ip': u'10.1.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.1.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.1.2', u'remote_route': u'10.2.1.0/24', u'subnet_route': u'10.1.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.2.1.2'}]}, {u'mem': 4, u'name': u't1_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br1if2', u'vmif': u't1VM2if1'}]) => {"ansible_loop_var": "item", "changed": false, "create": 0, "item": [{"bridge_name": "t1br1", "default_route_ip": "10.1.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.1.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.1.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.1.1.2/24"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.1.2", "remote_ip": "10.2.1.2", "remote_route": "10.2.1.0/24", "subnet_route": "10.1.1.0/24", "tenant_route_ip": "192.168.1.2", "v_name": "vxlan_t1s1"}]}, {"brif": "t1br1if2", "disk": "10G", "mem": 4, "name": "t1_VM2", "vcpu": 2, "vmif": "t1VM2if1"}]}
ok: [localhost] => (item=[{u'route': [{u'ip': u'10.1.2.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.2.1', u'bridge_name': u't1br2', u'dns': [{u'dnsif': u't1s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s2_dnsbrif'}], u'ns_name': u't1ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.2.2/24', u'tenant_ns_ip': u'10.1.2.1/24', u'tenant_ns_if': u't1ns2if', u'tenant_sub_if': u't1s2if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'2.2.2.0/24', u'vxlan': [{u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}, {u'mem': 3, u'name': u't1_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br2if1', u'vmif': u't1VM3if1'}]) => {"ansible_loop_var": "item", "changed": false, "create": 0, "item": [{"bridge_name": "t1br2", "default_route_ip": "10.1.2.1", "dns": [{"brif": "t1s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t1s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns2", "route": [{"if": "p1", "ip": "10.1.2.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "2.2.2.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns2if", "tenant_ns_ip": "10.1.2.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s2if", "tenant_sub_ip": "10.1.2.2/24"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, {"brif": "t1br2if1", "disk": "10G", "mem": 3, "name": "t1_VM3", "vcpu": 2, "vmif": "t1VM3if1"}]}

TASK [Start VM] *********************************************************************************************************************************************
ok: [localhost] => (item=[{u'route': [{u'ip': u'10.1.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.1.2/24', u'tenant_ns_ip': u'10.1.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.1.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.1.2', u'remote_route': u'10.2.1.0/24', u'subnet_route': u'10.1.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.2.1.2'}]}, {u'mem': 2, u'name': u't1_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM1if1'}]) => {"ansible_loop_var": "item", "changed": false, "item": [{"bridge_name": "t1br1", "default_route_ip": "10.1.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.1.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.1.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.1.1.2/24"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.1.2", "remote_ip": "10.2.1.2", "remote_route": "10.2.1.0/24", "subnet_route": "10.1.1.0/24", "tenant_route_ip": "192.168.1.2", "v_name": "vxlan_t1s1"}]}, {"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM1", "vcpu": 4, "vmif": "t1VM1if1"}]}
ok: [localhost] => (item=[{u'route': [{u'ip': u'10.1.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.1.2/24', u'tenant_ns_ip': u'10.1.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.1.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.1.2', u'remote_route': u'10.2.1.0/24', u'subnet_route': u'10.1.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.2.1.2'}]}, {u'mem': 4, u'name': u't1_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br1if2', u'vmif': u't1VM2if1'}]) => {"ansible_loop_var": "item", "changed": false, "item": [{"bridge_name": "t1br1", "default_route_ip": "10.1.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.1.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.1.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.1.1.2/24"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.1.2", "remote_ip": "10.2.1.2", "remote_route": "10.2.1.0/24", "subnet_route": "10.1.1.0/24", "tenant_route_ip": "192.168.1.2", "v_name": "vxlan_t1s1"}]}, {"brif": "t1br1if2", "disk": "10G", "mem": 4, "name": "t1_VM2", "vcpu": 2, "vmif": "t1VM2if1"}]}
ok: [localhost] => (item=[{u'route': [{u'ip': u'10.1.2.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.2.1', u'bridge_name': u't1br2', u'dns': [{u'dnsif': u't1s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s2_dnsbrif'}], u'ns_name': u't1ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.2.2/24', u'tenant_ns_ip': u'10.1.2.1/24', u'tenant_ns_if': u't1ns2if', u'tenant_sub_if': u't1s2if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'2.2.2.0/24', u'vxlan': [{u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}, {u'mem': 3, u'name': u't1_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br2if1', u'vmif': u't1VM3if1'}]) => {"ansible_loop_var": "item", "changed": false, "item": [{"bridge_name": "t1br2", "default_route_ip": "10.1.2.1", "dns": [{"brif": "t1s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t1s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns2", "route": [{"if": "p1", "ip": "10.1.2.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "2.2.2.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns2if", "tenant_ns_ip": "10.1.2.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s2if", "tenant_sub_ip": "10.1.2.2/24"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, {"brif": "t1br2if1", "disk": "10G", "mem": 3, "name": "t1_VM3", "vcpu": 2, "vmif": "t1VM3if1"}]}

TASK [Attach VM interface] **********************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.1.2/24', u'tenant_ns_ip': u'10.1.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.1.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.1.2', u'remote_route': u'10.2.1.0/24', u'subnet_route': u'10.1.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.2.1.2'}]}, {u'mem': 2, u'name': u't1_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM1if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "virsh domiflist \"t1_VM1\" | grep -w 't1VM1if1' ; if [ $? -ne 0 ] ; then virsh attach-interface \"t1_VM1\" direct \"t1VM1if1\" --live --persistent ; fi\n", "delta": "0:00:00.220530", "end": "2019-11-18 11:42:31.649505", "item": [{"bridge_name": "t1br1", "default_route_ip": "10.1.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.1.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.1.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.1.1.2/24"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.1.2", "remote_ip": "10.2.1.2", "remote_route": "10.2.1.0/24", "subnet_route": "10.1.1.0/24", "tenant_route_ip": "192.168.1.2", "v_name": "vxlan_t1s1"}]}, {"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM1", "vcpu": 4, "vmif": "t1VM1if1"}], "rc": 0, "start": "2019-11-18 11:42:31.428975", "stderr": "", "stderr_lines": [], "stdout": "Interface attached successfully", "stdout_lines": ["Interface attached successfully"]}
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.1.2/24', u'tenant_ns_ip': u'10.1.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.1.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.1.2', u'remote_route': u'10.2.1.0/24', u'subnet_route': u'10.1.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.2.1.2'}]}, {u'mem': 4, u'name': u't1_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br1if2', u'vmif': u't1VM2if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "virsh domiflist \"t1_VM2\" | grep -w 't1VM2if1' ; if [ $? -ne 0 ] ; then virsh attach-interface \"t1_VM2\" direct \"t1VM2if1\" --live --persistent ; fi\n", "delta": "0:00:00.018927", "end": "2019-11-18 11:42:31.792228", "item": [{"bridge_name": "t1br1", "default_route_ip": "10.1.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.1.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.1.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.1.1.2/24"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.1.2", "remote_ip": "10.2.1.2", "remote_route": "10.2.1.0/24", "subnet_route": "10.1.1.0/24", "tenant_route_ip": "192.168.1.2", "v_name": "vxlan_t1s1"}]}, {"brif": "t1br1if2", "disk": "10G", "mem": 4, "name": "t1_VM2", "vcpu": 2, "vmif": "t1VM2if1"}], "rc": 0, "start": "2019-11-18 11:42:31.773301", "stderr": "", "stderr_lines": [], "stdout": "macvtap0   direct     t1VM2if1   rtl8139     52:54:00:40:a1:97", "stdout_lines": ["macvtap0   direct     t1VM2if1   rtl8139     52:54:00:40:a1:97"]}
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.2.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.2.1', u'bridge_name': u't1br2', u'dns': [{u'dnsif': u't1s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s2_dnsbrif'}], u'ns_name': u't1ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.2.2/24', u'tenant_ns_ip': u'10.1.2.1/24', u'tenant_ns_if': u't1ns2if', u'tenant_sub_if': u't1s2if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'2.2.2.0/24', u'vxlan': [{u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}, {u'mem': 3, u'name': u't1_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br2if1', u'vmif': u't1VM3if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "virsh domiflist \"t1_VM3\" | grep -w 't1VM3if1' ; if [ $? -ne 0 ] ; then virsh attach-interface \"t1_VM3\" direct \"t1VM3if1\" --live --persistent ; fi\n", "delta": "0:00:00.020024", "end": "2019-11-18 11:42:31.932200", "item": [{"bridge_name": "t1br2", "default_route_ip": "10.1.2.1", "dns": [{"brif": "t1s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t1s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns2", "route": [{"if": "p1", "ip": "10.1.2.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "2.2.2.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns2if", "tenant_ns_ip": "10.1.2.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s2if", "tenant_sub_ip": "10.1.2.2/24"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, {"brif": "t1br2if1", "disk": "10G", "mem": 3, "name": "t1_VM3", "vcpu": 2, "vmif": "t1VM3if1"}], "rc": 0, "start": "2019-11-18 11:42:31.912176", "stderr": "", "stderr_lines": [], "stdout": "macvtap1   direct     t1VM3if1   rtl8139     52:54:00:07:5e:f4", "stdout_lines": ["macvtap1   direct     t1VM3if1   rtl8139     52:54:00:07:5e:f4"]}

PLAY RECAP **************************************************************************************************************************************************
localhost                  : ok=7    changed=3    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0   

Using /etc/ansible/ansible.cfg as config file

PLAY [worker] ***********************************************************************************************************************************************

TASK [Copy VM image] ****************************************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.2.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.1.2/24', u'tenant_ns_ip': u'10.2.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.2.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.129.2', u'remote_route': u'10.1.1.0/24', u'subnet_route': u'10.2.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.1.1.2'}]}, {u'mem': 2, u'name': u't1_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM4if1'}]) => {"ansible_loop_var": "item", "changed": true, "checksum": "f8b2ffa2bf201c84196c582f2dec0d33a1eb4b42", "dest": "/var/lib/libvirt/images/t1_VM4.qcow2", "gid": 0, "group": "root", "item": [{"bridge_name": "t1br1", "default_route_ip": "10.2.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.2.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.2.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.2.1.2/24"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.1.2", "remote_ip": "10.1.1.2", "remote_route": "10.1.1.0/24", "subnet_route": "10.2.1.0/24", "tenant_route_ip": "192.168.129.2", "v_name": "vxlan_t1s1"}]}, {"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM4", "vcpu": 4, "vmif": "t1VM4if1"}], "md5sum": "e6d5d524b68797ddd748ba1475985d34", "mode": "0644", "owner": "root", "size": 10739318784, "src": "/root/mainVM.qcow2", "state": "file", "uid": 0}

TASK [Get list of running VMs] ******************************************************************************************************************************
ok: [99.99.99.2] => {"changed": false, "cmd": ["virsh", "list", "--name"], "delta": "0:00:00.018740", "end": "2019-11-18 11:43:54.648457", "rc": 0, "start": "2019-11-18 11:43:54.629717", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Define VM] ********************************************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.2.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.1.2/24', u'tenant_ns_ip': u'10.2.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.2.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.129.2', u'remote_route': u'10.1.1.0/24', u'subnet_route': u'10.2.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.1.1.2'}]}, {u'mem': 2, u'name': u't1_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM4if1'}]) => {"ansible_loop_var": "item", "changed": true, "created": "t1_VM4", "item": [{"bridge_name": "t1br1", "default_route_ip": "10.2.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.2.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.2.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.2.1.2/24"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.1.2", "remote_ip": "10.1.1.2", "remote_route": "10.1.1.0/24", "subnet_route": "10.2.1.0/24", "tenant_route_ip": "192.168.129.2", "v_name": "vxlan_t1s1"}]}, {"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM4", "vcpu": 4, "vmif": "t1VM4if1"}], "warnings": ["'xml' is given - ignoring 'name'"]}

TASK [Create VM] ********************************************************************************************************************************************
ok: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.2.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.1.2/24', u'tenant_ns_ip': u'10.2.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.2.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.129.2', u'remote_route': u'10.1.1.0/24', u'subnet_route': u'10.2.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.1.1.2'}]}, {u'mem': 2, u'name': u't1_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM4if1'}]) => {"ansible_loop_var": "item", "changed": false, "create": 0, "item": [{"bridge_name": "t1br1", "default_route_ip": "10.2.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.2.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.2.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.2.1.2/24"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.1.2", "remote_ip": "10.1.1.2", "remote_route": "10.1.1.0/24", "subnet_route": "10.2.1.0/24", "tenant_route_ip": "192.168.129.2", "v_name": "vxlan_t1s1"}]}, {"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM4", "vcpu": 4, "vmif": "t1VM4if1"}]}

TASK [Start VM] *********************************************************************************************************************************************
ok: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.2.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.1.2/24', u'tenant_ns_ip': u'10.2.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.2.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.129.2', u'remote_route': u'10.1.1.0/24', u'subnet_route': u'10.2.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.1.1.2'}]}, {u'mem': 2, u'name': u't1_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM4if1'}]) => {"ansible_loop_var": "item", "changed": false, "item": [{"bridge_name": "t1br1", "default_route_ip": "10.2.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.2.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.2.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.2.1.2/24"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.1.2", "remote_ip": "10.1.1.2", "remote_route": "10.1.1.0/24", "subnet_route": "10.2.1.0/24", "tenant_route_ip": "192.168.129.2", "v_name": "vxlan_t1s1"}]}, {"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM4", "vcpu": 4, "vmif": "t1VM4if1"}]}

TASK [Attach VM interface] **********************************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.2.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.1.2/24', u'tenant_ns_ip': u'10.2.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.2.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.129.2', u'remote_route': u'10.1.1.0/24', u'subnet_route': u'10.2.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.1.1.2'}]}, {u'mem': 2, u'name': u't1_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM4if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "virsh domiflist \"t1_VM4\" | grep -w 't1VM4if1' ; if [ $? -ne 0 ] ; then virsh attach-interface \"t1_VM4\" direct \"t1VM4if1\" --live --persistent ; fi\n", "delta": "0:00:00.327556", "end": "2019-11-18 11:44:33.041780", "item": [{"bridge_name": "t1br1", "default_route_ip": "10.2.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.2.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.2.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.2.1.2/24"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.1.2", "remote_ip": "10.1.1.2", "remote_route": "10.1.1.0/24", "subnet_route": "10.2.1.0/24", "tenant_route_ip": "192.168.129.2", "v_name": "vxlan_t1s1"}]}, {"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM4", "vcpu": 4, "vmif": "t1VM4if1"}], "rc": 0, "start": "2019-11-18 11:44:32.714224", "stderr": "", "stderr_lines": [], "stdout": "Interface attached successfully", "stdout_lines": ["Interface attached successfully"]}

PLAY RECAP **************************************************************************************************************************************************
99.99.99.2                 : ok=6    changed=3    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0   

INFO:root: 11:55:21.964382 The subnet 1.1.1.0/24 is present in Cloud 1
INFO:root: 11:55:21.964497 The subnet 1.1.1.0/24 is present in Cloud 2
INFO:root: 11:55:21.964538 The VM VM1 is present in Cloud 1
INFO:root: 11:55:21.964568 The VM VM4 is present in Cloud 2
INFO:root: 11:55:21.964615 The subnet 1.1.1.0/24 is present in destination cloud
INFO:root: 11:55:21.964647 The subnet 1.1.1.0/24 is present in destination cloud
INFO:root: 11:55:22.142708 source cloud is C1
INFO:root: 11:55:22.144779 source cloud is C2
INFO:paramiko.transport:Connected (version 2.0, client OpenSSH_7.6p1)
INFO:paramiko.transport:Authentication (publickey) successful!
INFO:root: 12:38:36.872458 Printing the yaml input file
INFO:root: 12:38:36.872602 {'C1': [{'subnet_addr': '1.1.1.0/24', 'VM': [{'name': 'VM1', 'disk': '10G', 'mem': 2, 'vcpu': 4, 'internet_access': True}, {'name': 'VM2', 'disk': '10G', 'mem': 4, 'vcpu': 2, 'internet_access': False}]}, {'subnet_addr': '2.2.2.0/24', 'VM': [{'name': 'VM3', 'disk': '10G', 'mem': 3, 'vcpu': 2, 'internet_access': True}]}], 'C2': [{'subnet_addr': '1.1.1.0/24', 'VM': [{'name': 'VM4', 'disk': '10G', 'mem': 2, 'vcpu': 4, 'internet_access': True}]}]}
INFO:root: 12:38:36.872696 Provided subnet in C1: 1.1.1.0/24 is valid
INFO:root: 12:38:36.872747 Provided subnet in C1: 2.2.2.0/24 is valid
INFO:root: 12:38:36.872809 Provided subnet in C2: 1.1.1.0/24 is valid
Using /etc/ansible/ansible.cfg as config file

PLAY [main] *************************************************************************************************************************************************

TASK [Create Tenant Namespace] ******************************************************************************************************************************
changed: [localhost] => (item={u'default_route_ip': u'192.168.1.1', u'name': u't1', u'pns_ip': u'192.168.1.1/24', u'tenant_if': u't1if', u'tenant_ip': u'192.168.1.2/24', u'pns_if': u't1pns_if'}) => {"ansible_loop_var": "item", "changed": true, "cmd": ["ip", "netns", "add", "t1"], "delta": "0:00:00.063910", "end": "2019-11-18 12:38:38.256854", "item": {"default_route_ip": "192.168.1.1", "name": "t1", "pns_if": "t1pns_if", "pns_ip": "192.168.1.1/24", "tenant_if": "t1if", "tenant_ip": "192.168.1.2/24"}, "rc": 0, "start": "2019-11-18 12:38:38.192944", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Create Subnet Namespace] ******************************************************************************************************************************
changed: [localhost] => (item={u'route': [{u'ip': u'10.1.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.1.2/24', u'tenant_ns_ip': u'10.1.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_ns_name': u't1', u'tenant_sub_if': u't1s1if'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't1_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM1if1'}, {u'mem': 4, u'name': u't1_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br1if2', u'vmif': u't1VM2if1'}], u'vxlan': [{u'local_ip': u'10.1.1.2', u'tenant_route_ip': u'192.168.1.2', u'dsport': 4789, u'dev': u't1s1if', u'subnet_route': u'10.1.1.0/24', u'remote_route': u'10.2.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.2.1.2'}]}) => {"ansible_loop_var": "item", "changed": true, "cmd": ["ip", "netns", "add", "t1ns1"], "delta": "0:00:00.055242", "end": "2019-11-18 12:38:38.552476", "item": {"bridge_name": "t1br1", "default_route_ip": "10.1.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.1.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.1.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.1.1.2/24"}], "vms": [{"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM1", "vcpu": 4, "vmif": "t1VM1if1"}, {"brif": "t1br1if2", "disk": "10G", "mem": 4, "name": "t1_VM2", "vcpu": 2, "vmif": "t1VM2if1"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.1.2", "remote_ip": "10.2.1.2", "remote_route": "10.2.1.0/24", "subnet_route": "10.1.1.0/24", "tenant_route_ip": "192.168.1.2", "v_name": "vxlan_t1s1"}]}, "rc": 0, "start": "2019-11-18 12:38:38.497234", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}
changed: [localhost] => (item={u'route': [{u'ip': u'10.1.2.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.2.1', u'bridge_name': u't1br2', u'dns': [{u'dnsif': u't1s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s2_dnsbrif'}], u'ns_name': u't1ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.2.2/24', u'tenant_ns_ip': u'10.1.2.1/24', u'tenant_ns_if': u't1ns2if', u'tenant_ns_name': u't1', u'tenant_sub_if': u't1s2if'}], u'subnet_ip': u'2.2.2.0/24', u'vms': [{u'mem': 3, u'name': u't1_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br2if1', u'vmif': u't1VM3if1'}], u'vxlan': [{u'local_ip': [], u'tenant_route_ip': [], u'dsport': [], u'dev': [], u'subnet_route': [], u'remote_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}) => {"ansible_loop_var": "item", "changed": true, "cmd": ["ip", "netns", "add", "t1ns2"], "delta": "0:00:00.052751", "end": "2019-11-18 12:38:38.789520", "item": {"bridge_name": "t1br2", "default_route_ip": "10.1.2.1", "dns": [{"brif": "t1s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t1s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns2", "route": [{"if": "p1", "ip": "10.1.2.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "2.2.2.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns2if", "tenant_ns_ip": "10.1.2.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s2if", "tenant_sub_ip": "10.1.2.2/24"}], "vms": [{"brif": "t1br2if1", "disk": "10G", "mem": 3, "name": "t1_VM3", "vcpu": 2, "vmif": "t1VM3if1"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, "rc": 0, "start": "2019-11-18 12:38:38.736769", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Create Tenant VETH pairs] *****************************************************************************************************************************
changed: [localhost] => (item={u'default_route_ip': u'192.168.1.1', u'name': u't1', u'pns_ip': u'192.168.1.1/24', u'tenant_if': u't1if', u'tenant_ip': u'192.168.1.2/24', u'pns_if': u't1pns_if'}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip link show \"t1if\" ; if [ $? -ne 0 ] ; then ip link add \"t1if\" type veth peer name \"t1pns_if\" ; fi\n", "delta": "0:00:00.009183", "end": "2019-11-18 12:38:39.046062", "item": {"default_route_ip": "192.168.1.1", "name": "t1", "pns_if": "t1pns_if", "pns_ip": "192.168.1.1/24", "tenant_if": "t1if", "tenant_ip": "192.168.1.2/24"}, "rc": 0, "start": "2019-11-18 12:38:39.036879", "stderr": "Device \"t1if\" does not exist.", "stderr_lines": ["Device \"t1if\" does not exist."], "stdout": "", "stdout_lines": []}

TASK [Attach Tenant VETH Pairs] *****************************************************************************************************************************
changed: [localhost] => (item={u'default_route_ip': u'192.168.1.1', u'name': u't1', u'pns_ip': u'192.168.1.1/24', u'tenant_if': u't1if', u'tenant_ip': u'192.168.1.2/24', u'pns_if': u't1pns_if'}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec pns ip link show \"t1pns_if\" ; if [ $? -ne 0 ] ; then ip link set \"t1pns_if\" netns pns ; fi\nip netns exec \"t1\" ip link show \"t1if\" ; if [ $? -ne 0 ] ; then ip link set \"t1if\" netns \"t1\" ; fi\nip netns exec pns ip link set dev \"t1pns_if\" up\nip netns exec \"t1\" ip link set dev \"t1if\" up\n", "delta": "0:00:00.191452", "end": "2019-11-18 12:38:39.479985", "item": {"default_route_ip": "192.168.1.1", "name": "t1", "pns_if": "t1pns_if", "pns_ip": "192.168.1.1/24", "tenant_if": "t1if", "tenant_ip": "192.168.1.2/24"}, "rc": 0, "start": "2019-11-18 12:38:39.288533", "stderr": "Device \"t1pns_if\" does not exist.\nDevice \"t1if\" does not exist.", "stderr_lines": ["Device \"t1pns_if\" does not exist.", "Device \"t1if\" does not exist."], "stdout": "", "stdout_lines": []}

TASK [Add IP addresses to Tenant VETH Pairs] ****************************************************************************************************************
changed: [localhost] => (item={u'default_route_ip': u'192.168.1.1', u'name': u't1', u'pns_ip': u'192.168.1.1/24', u'tenant_if': u't1if', u'tenant_ip': u'192.168.1.2/24', u'pns_if': u't1pns_if'}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec pns ip addr show \"t1pns_if\" | awk 'FNR==3{ print $2 }' | grep -w '^192.168.1.1/24' ; if [ $? -ne 0 ] ; then ip netns exec pns ip addr add \"192.168.1.1/24\" dev \"t1pns_if\" ; fi\nip netns exec \"t1\" ip addr show \"t1if\" | awk 'FNR==3{ print $2 }' | grep -w '^192.168.1.2/24' ; if [ $? -ne 0 ] ; then ip netns exec \"t1\" ip addr add \"192.168.1.2/24\" dev \"t1if\" ; fi\n", "delta": "0:00:00.145313", "end": "2019-11-18 12:38:39.864141", "item": {"default_route_ip": "192.168.1.1", "name": "t1", "pns_if": "t1pns_if", "pns_ip": "192.168.1.1/24", "tenant_if": "t1if", "tenant_ip": "192.168.1.2/24"}, "rc": 0, "start": "2019-11-18 12:38:39.718828", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Create Namespace VETH Pairs] **************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't1_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM1if1'}, {u'mem': 4, u'name': u't1_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br1if2', u'vmif': u't1VM2if1'}], u'vxlan': [{u'local_ip': u'10.1.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.1.2', u'remote_route': u'10.2.1.0/24', u'subnet_route': u'10.1.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.2.1.2'}]}, {u'tenant_sub_ip': u'10.1.1.2/24', u'tenant_ns_ip': u'10.1.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip link show \"t1ns1if\" ; if [ $? -ne 0 ] ; then ip link add \"t1ns1if\" type veth peer name \"t1s1if\" ; fi\n", "delta": "0:00:00.010449", "end": "2019-11-18 12:38:40.124295", "item": [{"bridge_name": "t1br1", "default_route_ip": "10.1.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.1.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "vms": [{"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM1", "vcpu": 4, "vmif": "t1VM1if1"}, {"brif": "t1br1if2", "disk": "10G", "mem": 4, "name": "t1_VM2", "vcpu": 2, "vmif": "t1VM2if1"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.1.2", "remote_ip": "10.2.1.2", "remote_route": "10.2.1.0/24", "subnet_route": "10.1.1.0/24", "tenant_route_ip": "192.168.1.2", "v_name": "vxlan_t1s1"}]}, {"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.1.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.1.1.2/24"}], "rc": 0, "start": "2019-11-18 12:38:40.113846", "stderr": "Device \"t1ns1if\" does not exist.", "stderr_lines": ["Device \"t1ns1if\" does not exist."], "stdout": "", "stdout_lines": []}
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.2.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.2.1', u'bridge_name': u't1br2', u'dns': [{u'dnsif': u't1s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s2_dnsbrif'}], u'ns_name': u't1ns2', u'subnet_ip': u'2.2.2.0/24', u'vms': [{u'mem': 3, u'name': u't1_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br2if1', u'vmif': u't1VM3if1'}], u'vxlan': [{u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}, {u'tenant_sub_ip': u'10.1.2.2/24', u'tenant_ns_ip': u'10.1.2.1/24', u'tenant_ns_if': u't1ns2if', u'tenant_sub_if': u't1s2if', u'tenant_ns_name': u't1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip link show \"t1ns2if\" ; if [ $? -ne 0 ] ; then ip link add \"t1ns2if\" type veth peer name \"t1s2if\" ; fi\n", "delta": "0:00:00.009487", "end": "2019-11-18 12:38:40.320265", "item": [{"bridge_name": "t1br2", "default_route_ip": "10.1.2.1", "dns": [{"brif": "t1s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t1s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns2", "route": [{"if": "p1", "ip": "10.1.2.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "2.2.2.0/24", "vms": [{"brif": "t1br2if1", "disk": "10G", "mem": 3, "name": "t1_VM3", "vcpu": 2, "vmif": "t1VM3if1"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, {"tenant_ns_if": "t1ns2if", "tenant_ns_ip": "10.1.2.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s2if", "tenant_sub_ip": "10.1.2.2/24"}], "rc": 0, "start": "2019-11-18 12:38:40.310778", "stderr": "Device \"t1ns2if\" does not exist.", "stderr_lines": ["Device \"t1ns2if\" does not exist."], "stdout": "", "stdout_lines": []}

TASK [Attach Namespace VETH Pairs] **************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't1_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM1if1'}, {u'mem': 4, u'name': u't1_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br1if2', u'vmif': u't1VM2if1'}], u'vxlan': [{u'local_ip': u'10.1.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.1.2', u'remote_route': u'10.2.1.0/24', u'subnet_route': u'10.1.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.2.1.2'}]}, {u'tenant_sub_ip': u'10.1.1.2/24', u'tenant_ns_ip': u'10.1.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t1\" ip link show \"t1ns1if\" ; if [ $? -ne 0 ] ; then ip link set \"t1ns1if\" netns \"t1\" ; fi\nip netns exec \"t1ns1\" ip link show \"t1s1if\" ; if [ $? -ne 0 ] ; then ip link set \"t1s1if\" netns \"t1ns1\" ; fi\n", "delta": "0:00:00.128643", "end": "2019-11-18 12:38:40.690619", "item": [{"bridge_name": "t1br1", "default_route_ip": "10.1.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.1.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "vms": [{"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM1", "vcpu": 4, "vmif": "t1VM1if1"}, {"brif": "t1br1if2", "disk": "10G", "mem": 4, "name": "t1_VM2", "vcpu": 2, "vmif": "t1VM2if1"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.1.2", "remote_ip": "10.2.1.2", "remote_route": "10.2.1.0/24", "subnet_route": "10.1.1.0/24", "tenant_route_ip": "192.168.1.2", "v_name": "vxlan_t1s1"}]}, {"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.1.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.1.1.2/24"}], "rc": 0, "start": "2019-11-18 12:38:40.561976", "stderr": "Device \"t1ns1if\" does not exist.\nDevice \"t1s1if\" does not exist.", "stderr_lines": ["Device \"t1ns1if\" does not exist.", "Device \"t1s1if\" does not exist."], "stdout": "", "stdout_lines": []}
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.2.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.2.1', u'bridge_name': u't1br2', u'dns': [{u'dnsif': u't1s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s2_dnsbrif'}], u'ns_name': u't1ns2', u'subnet_ip': u'2.2.2.0/24', u'vms': [{u'mem': 3, u'name': u't1_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br2if1', u'vmif': u't1VM3if1'}], u'vxlan': [{u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}, {u'tenant_sub_ip': u'10.1.2.2/24', u'tenant_ns_ip': u'10.1.2.1/24', u'tenant_ns_if': u't1ns2if', u'tenant_sub_if': u't1s2if', u'tenant_ns_name': u't1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t1\" ip link show \"t1ns2if\" ; if [ $? -ne 0 ] ; then ip link set \"t1ns2if\" netns \"t1\" ; fi\nip netns exec \"t1ns2\" ip link show \"t1s2if\" ; if [ $? -ne 0 ] ; then ip link set \"t1s2if\" netns \"t1ns2\" ; fi\n", "delta": "0:00:00.139896", "end": "2019-11-18 12:38:41.014274", "item": [{"bridge_name": "t1br2", "default_route_ip": "10.1.2.1", "dns": [{"brif": "t1s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t1s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns2", "route": [{"if": "p1", "ip": "10.1.2.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "2.2.2.0/24", "vms": [{"brif": "t1br2if1", "disk": "10G", "mem": 3, "name": "t1_VM3", "vcpu": 2, "vmif": "t1VM3if1"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, {"tenant_ns_if": "t1ns2if", "tenant_ns_ip": "10.1.2.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s2if", "tenant_sub_ip": "10.1.2.2/24"}], "rc": 0, "start": "2019-11-18 12:38:40.874378", "stderr": "Device \"t1ns2if\" does not exist.\nDevice \"t1s2if\" does not exist.", "stderr_lines": ["Device \"t1ns2if\" does not exist.", "Device \"t1s2if\" does not exist."], "stdout": "", "stdout_lines": []}

TASK [Set Namespace VETH Pairs UP] **************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't1_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM1if1'}, {u'mem': 4, u'name': u't1_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br1if2', u'vmif': u't1VM2if1'}], u'vxlan': [{u'local_ip': u'10.1.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.1.2', u'remote_route': u'10.2.1.0/24', u'subnet_route': u'10.1.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.2.1.2'}]}, {u'tenant_sub_ip': u'10.1.1.2/24', u'tenant_ns_ip': u'10.1.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t1\" ip link set dev \"t1ns1if\" up\nip netns exec \"t1ns1\" ip link set dev \"t1s1if\" up\n", "delta": "0:00:00.067293", "end": "2019-11-18 12:38:41.348116", "item": [{"bridge_name": "t1br1", "default_route_ip": "10.1.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.1.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "vms": [{"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM1", "vcpu": 4, "vmif": "t1VM1if1"}, {"brif": "t1br1if2", "disk": "10G", "mem": 4, "name": "t1_VM2", "vcpu": 2, "vmif": "t1VM2if1"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.1.2", "remote_ip": "10.2.1.2", "remote_route": "10.2.1.0/24", "subnet_route": "10.1.1.0/24", "tenant_route_ip": "192.168.1.2", "v_name": "vxlan_t1s1"}]}, {"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.1.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.1.1.2/24"}], "rc": 0, "start": "2019-11-18 12:38:41.280823", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.2.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.2.1', u'bridge_name': u't1br2', u'dns': [{u'dnsif': u't1s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s2_dnsbrif'}], u'ns_name': u't1ns2', u'subnet_ip': u'2.2.2.0/24', u'vms': [{u'mem': 3, u'name': u't1_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br2if1', u'vmif': u't1VM3if1'}], u'vxlan': [{u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}, {u'tenant_sub_ip': u'10.1.2.2/24', u'tenant_ns_ip': u'10.1.2.1/24', u'tenant_ns_if': u't1ns2if', u'tenant_sub_if': u't1s2if', u'tenant_ns_name': u't1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t1\" ip link set dev \"t1ns2if\" up\nip netns exec \"t1ns2\" ip link set dev \"t1s2if\" up\n", "delta": "0:00:00.071766", "end": "2019-11-18 12:38:41.620253", "item": [{"bridge_name": "t1br2", "default_route_ip": "10.1.2.1", "dns": [{"brif": "t1s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t1s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns2", "route": [{"if": "p1", "ip": "10.1.2.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "2.2.2.0/24", "vms": [{"brif": "t1br2if1", "disk": "10G", "mem": 3, "name": "t1_VM3", "vcpu": 2, "vmif": "t1VM3if1"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, {"tenant_ns_if": "t1ns2if", "tenant_ns_ip": "10.1.2.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s2if", "tenant_sub_ip": "10.1.2.2/24"}], "rc": 0, "start": "2019-11-18 12:38:41.548487", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Add IP addresses to Namespace VETH Pairs] *************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't1_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM1if1'}, {u'mem': 4, u'name': u't1_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br1if2', u'vmif': u't1VM2if1'}], u'vxlan': [{u'local_ip': u'10.1.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.1.2', u'remote_route': u'10.2.1.0/24', u'subnet_route': u'10.1.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.2.1.2'}]}, {u'tenant_sub_ip': u'10.1.1.2/24', u'tenant_ns_ip': u'10.1.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t1ns1\" ip addr show \"t1s1if\" | awk 'FNR==3{ print $2 }' | grep -w '^10.1.1.2/24' ; if [ $? -ne 0 ] ; then ip netns exec \"t1ns1\" ip addr add \"10.1.1.2/24\" dev \"t1s1if\" ; fi\n\nip netns exec \"t1\" ip addr show \"t1ns1if\" | awk 'FNR==3{ print $2 }' | grep -w '^10.1.1.1/24' ; if [ $? -ne 0 ] ; then ip netns exec \"t1\" ip addr add \"10.1.1.1/24\" dev \"t1ns1if\" ; fi\n", "delta": "0:00:00.144945", "end": "2019-11-18 12:38:42.027916", "item": [{"bridge_name": "t1br1", "default_route_ip": "10.1.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.1.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "vms": [{"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM1", "vcpu": 4, "vmif": "t1VM1if1"}, {"brif": "t1br1if2", "disk": "10G", "mem": 4, "name": "t1_VM2", "vcpu": 2, "vmif": "t1VM2if1"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.1.2", "remote_ip": "10.2.1.2", "remote_route": "10.2.1.0/24", "subnet_route": "10.1.1.0/24", "tenant_route_ip": "192.168.1.2", "v_name": "vxlan_t1s1"}]}, {"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.1.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.1.1.2/24"}], "rc": 0, "start": "2019-11-18 12:38:41.882971", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.2.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.2.1', u'bridge_name': u't1br2', u'dns': [{u'dnsif': u't1s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s2_dnsbrif'}], u'ns_name': u't1ns2', u'subnet_ip': u'2.2.2.0/24', u'vms': [{u'mem': 3, u'name': u't1_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br2if1', u'vmif': u't1VM3if1'}], u'vxlan': [{u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}, {u'tenant_sub_ip': u'10.1.2.2/24', u'tenant_ns_ip': u'10.1.2.1/24', u'tenant_ns_if': u't1ns2if', u'tenant_sub_if': u't1s2if', u'tenant_ns_name': u't1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t1ns2\" ip addr show \"t1s2if\" | awk 'FNR==3{ print $2 }' | grep -w '^10.1.2.2/24' ; if [ $? -ne 0 ] ; then ip netns exec \"t1ns2\" ip addr add \"10.1.2.2/24\" dev \"t1s2if\" ; fi\n\nip netns exec \"t1\" ip addr show \"t1ns2if\" | awk 'FNR==3{ print $2 }' | grep -w '^10.1.2.1/24' ; if [ $? -ne 0 ] ; then ip netns exec \"t1\" ip addr add \"10.1.2.1/24\" dev \"t1ns2if\" ; fi\n", "delta": "0:00:00.163471", "end": "2019-11-18 12:38:42.375959", "item": [{"bridge_name": "t1br2", "default_route_ip": "10.1.2.1", "dns": [{"brif": "t1s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t1s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns2", "route": [{"if": "p1", "ip": "10.1.2.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "2.2.2.0/24", "vms": [{"brif": "t1br2if1", "disk": "10G", "mem": 3, "name": "t1_VM3", "vcpu": 2, "vmif": "t1VM3if1"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, {"tenant_ns_if": "t1ns2if", "tenant_ns_ip": "10.1.2.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s2if", "tenant_sub_ip": "10.1.2.2/24"}], "rc": 0, "start": "2019-11-18 12:38:42.212488", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Add IP Route to Tenant] *******************************************************************************************************************************
changed: [localhost] => (item={u'default_route_ip': u'192.168.1.1', u'name': u't1', u'pns_ip': u'192.168.1.1/24', u'tenant_if': u't1if', u'tenant_ip': u'192.168.1.2/24', u'pns_if': u't1pns_if'}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t1\" ip route show default | grep -w '[d]efault via 192.168.1.1' ; if [ $? -ne 0 ] ; then ip netns exec \"t1\" ip route add default via \"192.168.1.1\" ; fi\n", "delta": "0:00:00.083757", "end": "2019-11-18 12:38:42.716074", "item": {"default_route_ip": "192.168.1.1", "name": "t1", "pns_if": "t1pns_if", "pns_ip": "192.168.1.1/24", "tenant_if": "t1if", "tenant_ip": "192.168.1.2/24"}, "rc": 0, "start": "2019-11-18 12:38:42.632317", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Add IP Route to Tenant Subnet] ************************************************************************************************************************
changed: [localhost] => (item={u'route': [{u'ip': u'10.1.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.1.2/24', u'tenant_ns_ip': u'10.1.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_ns_name': u't1', u'tenant_sub_if': u't1s1if'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't1_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM1if1'}, {u'mem': 4, u'name': u't1_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br1if2', u'vmif': u't1VM2if1'}], u'vxlan': [{u'local_ip': u'10.1.1.2', u'tenant_route_ip': u'192.168.1.2', u'dsport': 4789, u'dev': u't1s1if', u'subnet_route': u'10.1.1.0/24', u'remote_route': u'10.2.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.2.1.2'}]}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t1ns1\" ip route show default | grep -w '[d]efault via 10.1.1.1' ; if [ $? -ne 0 ] ; then ip netns exec \"t1ns1\" ip route add default via \"10.1.1.1\" ; fi\n", "delta": "0:00:00.075293", "end": "2019-11-18 12:38:43.072177", "item": {"bridge_name": "t1br1", "default_route_ip": "10.1.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.1.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.1.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.1.1.2/24"}], "vms": [{"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM1", "vcpu": 4, "vmif": "t1VM1if1"}, {"brif": "t1br1if2", "disk": "10G", "mem": 4, "name": "t1_VM2", "vcpu": 2, "vmif": "t1VM2if1"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.1.2", "remote_ip": "10.2.1.2", "remote_route": "10.2.1.0/24", "subnet_route": "10.1.1.0/24", "tenant_route_ip": "192.168.1.2", "v_name": "vxlan_t1s1"}]}, "rc": 0, "start": "2019-11-18 12:38:42.996884", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}
changed: [localhost] => (item={u'route': [{u'ip': u'10.1.2.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.2.1', u'bridge_name': u't1br2', u'dns': [{u'dnsif': u't1s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s2_dnsbrif'}], u'ns_name': u't1ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.2.2/24', u'tenant_ns_ip': u'10.1.2.1/24', u'tenant_ns_if': u't1ns2if', u'tenant_ns_name': u't1', u'tenant_sub_if': u't1s2if'}], u'subnet_ip': u'2.2.2.0/24', u'vms': [{u'mem': 3, u'name': u't1_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br2if1', u'vmif': u't1VM3if1'}], u'vxlan': [{u'local_ip': [], u'tenant_route_ip': [], u'dsport': [], u'dev': [], u'subnet_route': [], u'remote_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t1ns2\" ip route show default | grep -w '[d]efault via 10.1.2.1' ; if [ $? -ne 0 ] ; then ip netns exec \"t1ns2\" ip route add default via \"10.1.2.1\" ; fi\n", "delta": "0:00:00.073144", "end": "2019-11-18 12:38:43.360112", "item": {"bridge_name": "t1br2", "default_route_ip": "10.1.2.1", "dns": [{"brif": "t1s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t1s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns2", "route": [{"if": "p1", "ip": "10.1.2.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "2.2.2.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns2if", "tenant_ns_ip": "10.1.2.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s2if", "tenant_sub_ip": "10.1.2.2/24"}], "vms": [{"brif": "t1br2if1", "disk": "10G", "mem": 3, "name": "t1_VM3", "vcpu": 2, "vmif": "t1VM3if1"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, "rc": 0, "start": "2019-11-18 12:38:43.286968", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Create bridge inside namespace] ***********************************************************************************************************************
changed: [localhost] => (item={u'route': [{u'ip': u'10.1.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.1.2/24', u'tenant_ns_ip': u'10.1.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_ns_name': u't1', u'tenant_sub_if': u't1s1if'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't1_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM1if1'}, {u'mem': 4, u'name': u't1_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br1if2', u'vmif': u't1VM2if1'}], u'vxlan': [{u'local_ip': u'10.1.1.2', u'tenant_route_ip': u'192.168.1.2', u'dsport': 4789, u'dev': u't1s1if', u'subnet_route': u'10.1.1.0/24', u'remote_route': u'10.2.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.2.1.2'}]}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t1ns1\" brctl show | grep -w '^t1br1'; if [ $? -ne 0 ] ; then ip netns exec \"t1ns1\" brctl addbr \"t1br1\" ; fi\nip netns exec \"t1ns1\" ip link set dev \"t1br1\" up\n", "delta": "0:00:00.111015", "end": "2019-11-18 12:38:43.752103", "item": {"bridge_name": "t1br1", "default_route_ip": "10.1.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.1.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.1.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.1.1.2/24"}], "vms": [{"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM1", "vcpu": 4, "vmif": "t1VM1if1"}, {"brif": "t1br1if2", "disk": "10G", "mem": 4, "name": "t1_VM2", "vcpu": 2, "vmif": "t1VM2if1"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.1.2", "remote_ip": "10.2.1.2", "remote_route": "10.2.1.0/24", "subnet_route": "10.1.1.0/24", "tenant_route_ip": "192.168.1.2", "v_name": "vxlan_t1s1"}]}, "rc": 0, "start": "2019-11-18 12:38:43.641088", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}
changed: [localhost] => (item={u'route': [{u'ip': u'10.1.2.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.2.1', u'bridge_name': u't1br2', u'dns': [{u'dnsif': u't1s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s2_dnsbrif'}], u'ns_name': u't1ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.2.2/24', u'tenant_ns_ip': u'10.1.2.1/24', u'tenant_ns_if': u't1ns2if', u'tenant_ns_name': u't1', u'tenant_sub_if': u't1s2if'}], u'subnet_ip': u'2.2.2.0/24', u'vms': [{u'mem': 3, u'name': u't1_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br2if1', u'vmif': u't1VM3if1'}], u'vxlan': [{u'local_ip': [], u'tenant_route_ip': [], u'dsport': [], u'dev': [], u'subnet_route': [], u'remote_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t1ns2\" brctl show | grep -w '^t1br2'; if [ $? -ne 0 ] ; then ip netns exec \"t1ns2\" brctl addbr \"t1br2\" ; fi\nip netns exec \"t1ns2\" ip link set dev \"t1br2\" up\n", "delta": "0:00:00.167332", "end": "2019-11-18 12:38:44.144204", "item": {"bridge_name": "t1br2", "default_route_ip": "10.1.2.1", "dns": [{"brif": "t1s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t1s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns2", "route": [{"if": "p1", "ip": "10.1.2.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "2.2.2.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns2if", "tenant_ns_ip": "10.1.2.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s2if", "tenant_sub_ip": "10.1.2.2/24"}], "vms": [{"brif": "t1br2if1", "disk": "10G", "mem": 3, "name": "t1_VM3", "vcpu": 2, "vmif": "t1VM3if1"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, "rc": 0, "start": "2019-11-18 12:38:43.976872", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Create DNS VETH Pair] *********************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.1.1', u'bridge_name': u't1br1', u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.1.2/24', u'tenant_ns_ip': u'10.1.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't1_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM1if1'}, {u'mem': 4, u'name': u't1_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br1if2', u'vmif': u't1VM2if1'}], u'vxlan': [{u'local_ip': u'10.1.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.1.2', u'remote_route': u'10.2.1.0/24', u'subnet_route': u'10.1.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.2.1.2'}]}, {u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t1ns1\" ip link show \"t1s1_dnsbrif\" ; if [ $? -ne 0 ] ; then ip netns exec \"t1ns1\" ip link add \"t1s1_dnsbrif\" type veth peer name \"t1s1_dnsif\" ; fi\nip netns exec \"t1ns1\" ip link set dev \"t1s1_dnsbrif\" up\nip netns exec \"t1ns1\" ip link set dev \"t1s1_dnsif\" up\n", "delta": "0:00:00.149022", "end": "2019-11-18 12:38:44.572029", "item": [{"bridge_name": "t1br1", "default_route_ip": "10.1.1.1", "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.1.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.1.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.1.1.2/24"}], "vms": [{"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM1", "vcpu": 4, "vmif": "t1VM1if1"}, {"brif": "t1br1if2", "disk": "10G", "mem": 4, "name": "t1_VM2", "vcpu": 2, "vmif": "t1VM2if1"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.1.2", "remote_ip": "10.2.1.2", "remote_route": "10.2.1.0/24", "subnet_route": "10.1.1.0/24", "tenant_route_ip": "192.168.1.2", "v_name": "vxlan_t1s1"}]}, {"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "rc": 0, "start": "2019-11-18 12:38:44.423007", "stderr": "Device \"t1s1_dnsbrif\" does not exist.", "stderr_lines": ["Device \"t1s1_dnsbrif\" does not exist."], "stdout": "", "stdout_lines": []}
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.2.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.2.1', u'bridge_name': u't1br2', u'ns_name': u't1ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.2.2/24', u'tenant_ns_ip': u'10.1.2.1/24', u'tenant_ns_if': u't1ns2if', u'tenant_sub_if': u't1s2if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'2.2.2.0/24', u'vms': [{u'mem': 3, u'name': u't1_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br2if1', u'vmif': u't1VM3if1'}], u'vxlan': [{u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}, {u'dnsif': u't1s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s2_dnsbrif'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t1ns2\" ip link show \"t1s2_dnsbrif\" ; if [ $? -ne 0 ] ; then ip netns exec \"t1ns2\" ip link add \"t1s2_dnsbrif\" type veth peer name \"t1s2_dnsif\" ; fi\nip netns exec \"t1ns2\" ip link set dev \"t1s2_dnsbrif\" up\nip netns exec \"t1ns2\" ip link set dev \"t1s2_dnsif\" up\n", "delta": "0:00:00.157744", "end": "2019-11-18 12:38:44.924051", "item": [{"bridge_name": "t1br2", "default_route_ip": "10.1.2.1", "ns_name": "t1ns2", "route": [{"if": "p1", "ip": "10.1.2.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "2.2.2.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns2if", "tenant_ns_ip": "10.1.2.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s2if", "tenant_sub_ip": "10.1.2.2/24"}], "vms": [{"brif": "t1br2if1", "disk": "10G", "mem": 3, "name": "t1_VM3", "vcpu": 2, "vmif": "t1VM3if1"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, {"brif": "t1s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t1s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "rc": 0, "start": "2019-11-18 12:38:44.766307", "stderr": "Device \"t1s2_dnsbrif\" does not exist.", "stderr_lines": ["Device \"t1s2_dnsbrif\" does not exist."], "stdout": "", "stdout_lines": []}

TASK [Attach DNS VETH Pair] *********************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.1.1', u'bridge_name': u't1br1', u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.1.2/24', u'tenant_ns_ip': u'10.1.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't1_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM1if1'}, {u'mem': 4, u'name': u't1_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br1if2', u'vmif': u't1VM2if1'}], u'vxlan': [{u'local_ip': u'10.1.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.1.2', u'remote_route': u'10.2.1.0/24', u'subnet_route': u'10.1.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.2.1.2'}]}, {u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t1ns1\" brctl show \"t1br1\" | grep -w 't1s1_dnsbrif' ; if [ $? -ne 0 ] ; then ip netns exec \"t1ns1\" brctl addif \"t1br1\" \"t1s1_dnsbrif\" ; fi\n", "delta": "0:00:00.083479", "end": "2019-11-18 12:38:45.252089", "item": [{"bridge_name": "t1br1", "default_route_ip": "10.1.1.1", "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.1.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.1.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.1.1.2/24"}], "vms": [{"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM1", "vcpu": 4, "vmif": "t1VM1if1"}, {"brif": "t1br1if2", "disk": "10G", "mem": 4, "name": "t1_VM2", "vcpu": 2, "vmif": "t1VM2if1"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.1.2", "remote_ip": "10.2.1.2", "remote_route": "10.2.1.0/24", "subnet_route": "10.1.1.0/24", "tenant_route_ip": "192.168.1.2", "v_name": "vxlan_t1s1"}]}, {"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "rc": 0, "start": "2019-11-18 12:38:45.168610", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.2.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.2.1', u'bridge_name': u't1br2', u'ns_name': u't1ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.2.2/24', u'tenant_ns_ip': u'10.1.2.1/24', u'tenant_ns_if': u't1ns2if', u'tenant_sub_if': u't1s2if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'2.2.2.0/24', u'vms': [{u'mem': 3, u'name': u't1_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br2if1', u'vmif': u't1VM3if1'}], u'vxlan': [{u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}, {u'dnsif': u't1s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s2_dnsbrif'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t1ns2\" brctl show \"t1br2\" | grep -w 't1s2_dnsbrif' ; if [ $? -ne 0 ] ; then ip netns exec \"t1ns2\" brctl addif \"t1br2\" \"t1s2_dnsbrif\" ; fi\n", "delta": "0:00:00.074335", "end": "2019-11-18 12:38:45.508105", "item": [{"bridge_name": "t1br2", "default_route_ip": "10.1.2.1", "ns_name": "t1ns2", "route": [{"if": "p1", "ip": "10.1.2.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "2.2.2.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns2if", "tenant_ns_ip": "10.1.2.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s2if", "tenant_sub_ip": "10.1.2.2/24"}], "vms": [{"brif": "t1br2if1", "disk": "10G", "mem": 3, "name": "t1_VM3", "vcpu": 2, "vmif": "t1VM3if1"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, {"brif": "t1s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t1s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "rc": 0, "start": "2019-11-18 12:38:45.433770", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Create VETH Pairs] ************************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.1.2/24', u'tenant_ns_ip': u'10.1.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.1.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.1.2', u'remote_route': u'10.2.1.0/24', u'subnet_route': u'10.1.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.2.1.2'}]}, {u'mem': 2, u'name': u't1_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM1if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip link show \"t1br1if1\" ; if [ $? -ne 0 ] ; then ip link add \"t1VM1if1\" type veth peer name \"t1br1if1\" ; fi\nip link set dev \"t1br1if1\" up\nip link set dev \"t1VM1if1\" up\n", "delta": "0:00:00.015066", "end": "2019-11-18 12:38:45.794170", "item": [{"bridge_name": "t1br1", "default_route_ip": "10.1.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.1.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.1.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.1.1.2/24"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.1.2", "remote_ip": "10.2.1.2", "remote_route": "10.2.1.0/24", "subnet_route": "10.1.1.0/24", "tenant_route_ip": "192.168.1.2", "v_name": "vxlan_t1s1"}]}, {"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM1", "vcpu": 4, "vmif": "t1VM1if1"}], "rc": 0, "start": "2019-11-18 12:38:45.779104", "stderr": "Device \"t1br1if1\" does not exist.", "stderr_lines": ["Device \"t1br1if1\" does not exist."], "stdout": "", "stdout_lines": []}
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.1.2/24', u'tenant_ns_ip': u'10.1.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.1.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.1.2', u'remote_route': u'10.2.1.0/24', u'subnet_route': u'10.1.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.2.1.2'}]}, {u'mem': 4, u'name': u't1_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br1if2', u'vmif': u't1VM2if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip link show \"t1br1if2\" ; if [ $? -ne 0 ] ; then ip link add \"t1VM2if1\" type veth peer name \"t1br1if2\" ; fi\nip link set dev \"t1br1if2\" up\nip link set dev \"t1VM2if1\" up\n", "delta": "0:00:00.015837", "end": "2019-11-18 12:38:46.020703", "item": [{"bridge_name": "t1br1", "default_route_ip": "10.1.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.1.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.1.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.1.1.2/24"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.1.2", "remote_ip": "10.2.1.2", "remote_route": "10.2.1.0/24", "subnet_route": "10.1.1.0/24", "tenant_route_ip": "192.168.1.2", "v_name": "vxlan_t1s1"}]}, {"brif": "t1br1if2", "disk": "10G", "mem": 4, "name": "t1_VM2", "vcpu": 2, "vmif": "t1VM2if1"}], "rc": 0, "start": "2019-11-18 12:38:46.004866", "stderr": "Device \"t1br1if2\" does not exist.", "stderr_lines": ["Device \"t1br1if2\" does not exist."], "stdout": "", "stdout_lines": []}
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.2.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.2.1', u'bridge_name': u't1br2', u'dns': [{u'dnsif': u't1s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s2_dnsbrif'}], u'ns_name': u't1ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.2.2/24', u'tenant_ns_ip': u'10.1.2.1/24', u'tenant_ns_if': u't1ns2if', u'tenant_sub_if': u't1s2if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'2.2.2.0/24', u'vxlan': [{u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}, {u'mem': 3, u'name': u't1_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br2if1', u'vmif': u't1VM3if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip link show \"t1br2if1\" ; if [ $? -ne 0 ] ; then ip link add \"t1VM3if1\" type veth peer name \"t1br2if1\" ; fi\nip link set dev \"t1br2if1\" up\nip link set dev \"t1VM3if1\" up\n", "delta": "0:00:00.016277", "end": "2019-11-18 12:38:46.246072", "item": [{"bridge_name": "t1br2", "default_route_ip": "10.1.2.1", "dns": [{"brif": "t1s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t1s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns2", "route": [{"if": "p1", "ip": "10.1.2.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "2.2.2.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns2if", "tenant_ns_ip": "10.1.2.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s2if", "tenant_sub_ip": "10.1.2.2/24"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, {"brif": "t1br2if1", "disk": "10G", "mem": 3, "name": "t1_VM3", "vcpu": 2, "vmif": "t1VM3if1"}], "rc": 0, "start": "2019-11-18 12:38:46.229795", "stderr": "Device \"t1br2if1\" does not exist.", "stderr_lines": ["Device \"t1br2if1\" does not exist."], "stdout": "", "stdout_lines": []}

TASK [Attach VETH Pairs] ************************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.1.2/24', u'tenant_ns_ip': u'10.1.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.1.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.1.2', u'remote_route': u'10.2.1.0/24', u'subnet_route': u'10.1.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.2.1.2'}]}, {u'mem': 2, u'name': u't1_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM1if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip link show \"t1br1if1\" ; if [ $? -eq 0 ] ; then ip link set \"t1br1if1\" netns \"t1ns1\" ; fi\nip netns exec \"t1ns1\" brctl show \"t1br1\" | grep -w 't1br1if1' ; if [ $? -ne 0 ] ; then ip netns exec \"t1ns1\" brctl addif \"t1br1\" \"t1br1if1\" ; fi\n", "delta": "0:00:00.107189", "end": "2019-11-18 12:38:46.624114", "item": [{"bridge_name": "t1br1", "default_route_ip": "10.1.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.1.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.1.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.1.1.2/24"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.1.2", "remote_ip": "10.2.1.2", "remote_route": "10.2.1.0/24", "subnet_route": "10.1.1.0/24", "tenant_route_ip": "192.168.1.2", "v_name": "vxlan_t1s1"}]}, {"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM1", "vcpu": 4, "vmif": "t1VM1if1"}], "rc": 0, "start": "2019-11-18 12:38:46.516925", "stderr": "", "stderr_lines": [], "stdout": "20: t1br1if1@t1VM1if1: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP mode DEFAULT group default qlen 1000\n    link/ether 0e:88:d7:1c:9f:4b brd ff:ff:ff:ff:ff:ff", "stdout_lines": ["20: t1br1if1@t1VM1if1: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP mode DEFAULT group default qlen 1000", "    link/ether 0e:88:d7:1c:9f:4b brd ff:ff:ff:ff:ff:ff"]}
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.1.2/24', u'tenant_ns_ip': u'10.1.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.1.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.1.2', u'remote_route': u'10.2.1.0/24', u'subnet_route': u'10.1.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.2.1.2'}]}, {u'mem': 4, u'name': u't1_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br1if2', u'vmif': u't1VM2if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip link show \"t1br1if2\" ; if [ $? -eq 0 ] ; then ip link set \"t1br1if2\" netns \"t1ns1\" ; fi\nip netns exec \"t1ns1\" brctl show \"t1br1\" | grep -w 't1br1if2' ; if [ $? -ne 0 ] ; then ip netns exec \"t1ns1\" brctl addif \"t1br1\" \"t1br1if2\" ; fi\n", "delta": "0:00:00.090561", "end": "2019-11-18 12:38:46.916121", "item": [{"bridge_name": "t1br1", "default_route_ip": "10.1.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.1.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.1.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.1.1.2/24"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.1.2", "remote_ip": "10.2.1.2", "remote_route": "10.2.1.0/24", "subnet_route": "10.1.1.0/24", "tenant_route_ip": "192.168.1.2", "v_name": "vxlan_t1s1"}]}, {"brif": "t1br1if2", "disk": "10G", "mem": 4, "name": "t1_VM2", "vcpu": 2, "vmif": "t1VM2if1"}], "rc": 0, "start": "2019-11-18 12:38:46.825560", "stderr": "", "stderr_lines": [], "stdout": "22: t1br1if2@t1VM2if1: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP mode DEFAULT group default qlen 1000\n    link/ether da:f7:f5:b2:61:19 brd ff:ff:ff:ff:ff:ff", "stdout_lines": ["22: t1br1if2@t1VM2if1: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP mode DEFAULT group default qlen 1000", "    link/ether da:f7:f5:b2:61:19 brd ff:ff:ff:ff:ff:ff"]}
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.2.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.2.1', u'bridge_name': u't1br2', u'dns': [{u'dnsif': u't1s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s2_dnsbrif'}], u'ns_name': u't1ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.2.2/24', u'tenant_ns_ip': u'10.1.2.1/24', u'tenant_ns_if': u't1ns2if', u'tenant_sub_if': u't1s2if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'2.2.2.0/24', u'vxlan': [{u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}, {u'mem': 3, u'name': u't1_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br2if1', u'vmif': u't1VM3if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip link show \"t1br2if1\" ; if [ $? -eq 0 ] ; then ip link set \"t1br2if1\" netns \"t1ns2\" ; fi\nip netns exec \"t1ns2\" brctl show \"t1br2\" | grep -w 't1br2if1' ; if [ $? -ne 0 ] ; then ip netns exec \"t1ns2\" brctl addif \"t1br2\" \"t1br2if1\" ; fi\n", "delta": "0:00:00.115630", "end": "2019-11-18 12:38:47.240135", "item": [{"bridge_name": "t1br2", "default_route_ip": "10.1.2.1", "dns": [{"brif": "t1s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t1s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns2", "route": [{"if": "p1", "ip": "10.1.2.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "2.2.2.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns2if", "tenant_ns_ip": "10.1.2.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s2if", "tenant_sub_ip": "10.1.2.2/24"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, {"brif": "t1br2if1", "disk": "10G", "mem": 3, "name": "t1_VM3", "vcpu": 2, "vmif": "t1VM3if1"}], "rc": 0, "start": "2019-11-18 12:38:47.124505", "stderr": "", "stderr_lines": [], "stdout": "24: t1br2if1@t1VM3if1: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP mode DEFAULT group default qlen 1000\n    link/ether 36:a9:fe:de:21:65 brd ff:ff:ff:ff:ff:ff", "stdout_lines": ["24: t1br2if1@t1VM3if1: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP mode DEFAULT group default qlen 1000", "    link/ether 36:a9:fe:de:21:65 brd ff:ff:ff:ff:ff:ff"]}

TASK [All interfaces and bridges UP] ************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.1.2/24', u'tenant_ns_ip': u'10.1.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.1.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.1.2', u'remote_route': u'10.2.1.0/24', u'subnet_route': u'10.1.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.2.1.2'}]}, {u'mem': 2, u'name': u't1_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM1if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t1ns1\" ip link set \"t1br1if1\" up\nip netns exec \"t1ns1\" ip link set dev \"t1br1\" up\n", "delta": "0:00:00.077057", "end": "2019-11-18 12:38:47.588056", "item": [{"bridge_name": "t1br1", "default_route_ip": "10.1.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.1.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.1.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.1.1.2/24"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.1.2", "remote_ip": "10.2.1.2", "remote_route": "10.2.1.0/24", "subnet_route": "10.1.1.0/24", "tenant_route_ip": "192.168.1.2", "v_name": "vxlan_t1s1"}]}, {"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM1", "vcpu": 4, "vmif": "t1VM1if1"}], "rc": 0, "start": "2019-11-18 12:38:47.510999", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.1.2/24', u'tenant_ns_ip': u'10.1.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.1.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.1.2', u'remote_route': u'10.2.1.0/24', u'subnet_route': u'10.1.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.2.1.2'}]}, {u'mem': 4, u'name': u't1_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br1if2', u'vmif': u't1VM2if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t1ns1\" ip link set \"t1br1if2\" up\nip netns exec \"t1ns1\" ip link set dev \"t1br1\" up\n", "delta": "0:00:00.084277", "end": "2019-11-18 12:38:47.856150", "item": [{"bridge_name": "t1br1", "default_route_ip": "10.1.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.1.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.1.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.1.1.2/24"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.1.2", "remote_ip": "10.2.1.2", "remote_route": "10.2.1.0/24", "subnet_route": "10.1.1.0/24", "tenant_route_ip": "192.168.1.2", "v_name": "vxlan_t1s1"}]}, {"brif": "t1br1if2", "disk": "10G", "mem": 4, "name": "t1_VM2", "vcpu": 2, "vmif": "t1VM2if1"}], "rc": 0, "start": "2019-11-18 12:38:47.771873", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.2.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.2.1', u'bridge_name': u't1br2', u'dns': [{u'dnsif': u't1s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s2_dnsbrif'}], u'ns_name': u't1ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.2.2/24', u'tenant_ns_ip': u'10.1.2.1/24', u'tenant_ns_if': u't1ns2if', u'tenant_sub_if': u't1s2if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'2.2.2.0/24', u'vxlan': [{u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}, {u'mem': 3, u'name': u't1_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br2if1', u'vmif': u't1VM3if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t1ns2\" ip link set \"t1br2if1\" up\nip netns exec \"t1ns2\" ip link set dev \"t1br2\" up\n", "delta": "0:00:00.079100", "end": "2019-11-18 12:38:48.123920", "item": [{"bridge_name": "t1br2", "default_route_ip": "10.1.2.1", "dns": [{"brif": "t1s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t1s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns2", "route": [{"if": "p1", "ip": "10.1.2.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "2.2.2.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns2if", "tenant_ns_ip": "10.1.2.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s2if", "tenant_sub_ip": "10.1.2.2/24"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, {"brif": "t1br2if1", "disk": "10G", "mem": 3, "name": "t1_VM3", "vcpu": 2, "vmif": "t1VM3if1"}], "rc": 0, "start": "2019-11-18 12:38:48.044820", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Add IP to DNS Interface] ******************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.1.1', u'bridge_name': u't1br1', u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.1.2/24', u'tenant_ns_ip': u'10.1.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't1_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM1if1'}, {u'mem': 4, u'name': u't1_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br1if2', u'vmif': u't1VM2if1'}], u'vxlan': [{u'local_ip': u'10.1.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.1.2', u'remote_route': u'10.2.1.0/24', u'subnet_route': u'10.1.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.2.1.2'}]}, {u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t1ns1\" ip addr show \"t1s1_dnsif\" | awk 'FNR==3{ print $2 }' | grep -w '^1.1.1.1/24' ; if [ $? -ne 0 ] ; then ip netns exec \"t1ns1\" ip addr add \"1.1.1.1/24\" dev \"t1s1_dnsif\" ; fi\n", "delta": "0:00:00.100845", "end": "2019-11-18 12:38:48.459877", "item": [{"bridge_name": "t1br1", "default_route_ip": "10.1.1.1", "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.1.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.1.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.1.1.2/24"}], "vms": [{"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM1", "vcpu": 4, "vmif": "t1VM1if1"}, {"brif": "t1br1if2", "disk": "10G", "mem": 4, "name": "t1_VM2", "vcpu": 2, "vmif": "t1VM2if1"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.1.2", "remote_ip": "10.2.1.2", "remote_route": "10.2.1.0/24", "subnet_route": "10.1.1.0/24", "tenant_route_ip": "192.168.1.2", "v_name": "vxlan_t1s1"}]}, {"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "rc": 0, "start": "2019-11-18 12:38:48.359032", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.2.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.2.1', u'bridge_name': u't1br2', u'ns_name': u't1ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.2.2/24', u'tenant_ns_ip': u'10.1.2.1/24', u'tenant_ns_if': u't1ns2if', u'tenant_sub_if': u't1s2if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'2.2.2.0/24', u'vms': [{u'mem': 3, u'name': u't1_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br2if1', u'vmif': u't1VM3if1'}], u'vxlan': [{u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}, {u'dnsif': u't1s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s2_dnsbrif'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t1ns2\" ip addr show \"t1s2_dnsif\" | awk 'FNR==3{ print $2 }' | grep -w '^2.2.2.1/24' ; if [ $? -ne 0 ] ; then ip netns exec \"t1ns2\" ip addr add \"2.2.2.1/24\" dev \"t1s2_dnsif\" ; fi\n", "delta": "0:00:00.079110", "end": "2019-11-18 12:38:48.751936", "item": [{"bridge_name": "t1br2", "default_route_ip": "10.1.2.1", "ns_name": "t1ns2", "route": [{"if": "p1", "ip": "10.1.2.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "2.2.2.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns2if", "tenant_ns_ip": "10.1.2.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s2if", "tenant_sub_ip": "10.1.2.2/24"}], "vms": [{"brif": "t1br2if1", "disk": "10G", "mem": 3, "name": "t1_VM3", "vcpu": 2, "vmif": "t1VM3if1"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, {"brif": "t1s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t1s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "rc": 0, "start": "2019-11-18 12:38:48.672826", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Install DHCP Server] **********************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.1.1', u'bridge_name': u't1br1', u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.1.2/24', u'tenant_ns_ip': u'10.1.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't1_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM1if1'}, {u'mem': 4, u'name': u't1_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br1if2', u'vmif': u't1VM2if1'}], u'vxlan': [{u'local_ip': u'10.1.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.1.2', u'remote_route': u'10.2.1.0/24', u'subnet_route': u'10.1.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.2.1.2'}]}, {u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t1ns1\" ps aux | grep -w '[d]nsmasq --interface t1s1_dnsif -z --dhcp-range=1.1.1.5,1.1.1.126' ; if [ $? -ne 0 ] ; then ip netns exec \"t1ns1\" dnsmasq --interface \"t1s1_dnsif\" -z --dhcp-range=1.1.1.5,'1.1.1.126' ; fi\n", "delta": "0:00:00.074763", "end": "2019-11-18 12:38:49.098086", "item": [{"bridge_name": "t1br1", "default_route_ip": "10.1.1.1", "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.1.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.1.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.1.1.2/24"}], "vms": [{"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM1", "vcpu": 4, "vmif": "t1VM1if1"}, {"brif": "t1br1if2", "disk": "10G", "mem": 4, "name": "t1_VM2", "vcpu": 2, "vmif": "t1VM2if1"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.1.2", "remote_ip": "10.2.1.2", "remote_route": "10.2.1.0/24", "subnet_route": "10.1.1.0/24", "tenant_route_ip": "192.168.1.2", "v_name": "vxlan_t1s1"}]}, {"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "rc": 0, "start": "2019-11-18 12:38:49.023323", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.2.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.2.1', u'bridge_name': u't1br2', u'ns_name': u't1ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.2.2/24', u'tenant_ns_ip': u'10.1.2.1/24', u'tenant_ns_if': u't1ns2if', u'tenant_sub_if': u't1s2if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'2.2.2.0/24', u'vms': [{u'mem': 3, u'name': u't1_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br2if1', u'vmif': u't1VM3if1'}], u'vxlan': [{u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}, {u'dnsif': u't1s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s2_dnsbrif'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t1ns2\" ps aux | grep -w '[d]nsmasq --interface t1s2_dnsif -z --dhcp-range=2.2.2.5,2.2.2.254' ; if [ $? -ne 0 ] ; then ip netns exec \"t1ns2\" dnsmasq --interface \"t1s2_dnsif\" -z --dhcp-range=2.2.2.5,'2.2.2.254' ; fi\n", "delta": "0:00:00.072273", "end": "2019-11-18 12:38:49.400519", "item": [{"bridge_name": "t1br2", "default_route_ip": "10.1.2.1", "ns_name": "t1ns2", "route": [{"if": "p1", "ip": "10.1.2.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "2.2.2.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns2if", "tenant_ns_ip": "10.1.2.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s2if", "tenant_sub_ip": "10.1.2.2/24"}], "vms": [{"brif": "t1br2if1", "disk": "10G", "mem": 3, "name": "t1_VM3", "vcpu": 2, "vmif": "t1VM3if1"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, {"brif": "t1s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t1s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "rc": 0, "start": "2019-11-18 12:38:49.328246", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Create VXLAN devices] *********************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.1.2/24', u'tenant_ns_ip': u'10.1.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't1_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM1if1'}, {u'mem': 4, u'name': u't1_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br1if2', u'vmif': u't1VM2if1'}]}, {u'local_ip': u'10.1.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.1.2', u'remote_route': u'10.2.1.0/24', u'subnet_route': u'10.1.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.2.1.2'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t1ns1\" ip link show \"vxlan_t1s1\" ; if [ $? -ne 0 ] ; then ip netns exec \"t1ns1\" ip link add \"vxlan_t1s1\" type vxlan id \"42\" local \"10.1.1.2\" remote \"10.2.1.2\" dstport \"4789\" dev \"t1s1if\"; ip netns exec \"t1ns1\" ip link set dev \"vxlan_t1s1\" up ; fi\n", "delta": "0:00:00.116293", "end": "2019-11-18 12:38:49.796182", "item": [{"bridge_name": "t1br1", "default_route_ip": "10.1.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.1.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.1.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.1.1.2/24"}], "vms": [{"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM1", "vcpu": 4, "vmif": "t1VM1if1"}, {"brif": "t1br1if2", "disk": "10G", "mem": 4, "name": "t1_VM2", "vcpu": 2, "vmif": "t1VM2if1"}]}, {"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.1.2", "remote_ip": "10.2.1.2", "remote_route": "10.2.1.0/24", "subnet_route": "10.1.1.0/24", "tenant_route_ip": "192.168.1.2", "v_name": "vxlan_t1s1"}], "rc": 0, "start": "2019-11-18 12:38:49.679889", "stderr": "Device \"vxlan_t1s1\" does not exist.", "stderr_lines": ["Device \"vxlan_t1s1\" does not exist."], "stdout": "", "stdout_lines": []}
skipping: [localhost] => (item=[{u'route': [{u'ip': u'10.1.2.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.2.1', u'bridge_name': u't1br2', u'dns': [{u'dnsif': u't1s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s2_dnsbrif'}], u'ns_name': u't1ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.2.2/24', u'tenant_ns_ip': u'10.1.2.1/24', u'tenant_ns_if': u't1ns2if', u'tenant_sub_if': u't1s2if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'2.2.2.0/24', u'vms': [{u'mem': 3, u'name': u't1_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br2if1', u'vmif': u't1VM3if1'}]}, {u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}])  => {"ansible_loop_var": "item", "changed": false, "item": [{"bridge_name": "t1br2", "default_route_ip": "10.1.2.1", "dns": [{"brif": "t1s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t1s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns2", "route": [{"if": "p1", "ip": "10.1.2.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "2.2.2.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns2if", "tenant_ns_ip": "10.1.2.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s2if", "tenant_sub_ip": "10.1.2.2/24"}], "vms": [{"brif": "t1br2if1", "disk": "10G", "mem": 3, "name": "t1_VM3", "vcpu": 2, "vmif": "t1VM3if1"}]}, {"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}], "skip_reason": "Conditional result was False"}

TASK [Attach VXLANs to bridge] ******************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.1.2/24', u'tenant_ns_ip': u'10.1.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't1_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM1if1'}, {u'mem': 4, u'name': u't1_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br1if2', u'vmif': u't1VM2if1'}]}, {u'local_ip': u'10.1.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.1.2', u'remote_route': u'10.2.1.0/24', u'subnet_route': u'10.1.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.2.1.2'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t1ns1\" brctl show \"t1br1\" | grep -w 'vxlan_t1s1' ; if [ $? -ne 0 ] ; then ip netns exec \"t1ns1\" brctl addif \"t1br1\" \"vxlan_t1s1\" ; fi\n", "delta": "0:00:00.080413", "end": "2019-11-18 12:38:50.172134", "item": [{"bridge_name": "t1br1", "default_route_ip": "10.1.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.1.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.1.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.1.1.2/24"}], "vms": [{"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM1", "vcpu": 4, "vmif": "t1VM1if1"}, {"brif": "t1br1if2", "disk": "10G", "mem": 4, "name": "t1_VM2", "vcpu": 2, "vmif": "t1VM2if1"}]}, {"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.1.2", "remote_ip": "10.2.1.2", "remote_route": "10.2.1.0/24", "subnet_route": "10.1.1.0/24", "tenant_route_ip": "192.168.1.2", "v_name": "vxlan_t1s1"}], "rc": 0, "start": "2019-11-18 12:38:50.091721", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}
skipping: [localhost] => (item=[{u'route': [{u'ip': u'10.1.2.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.2.1', u'bridge_name': u't1br2', u'dns': [{u'dnsif': u't1s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s2_dnsbrif'}], u'ns_name': u't1ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.2.2/24', u'tenant_ns_ip': u'10.1.2.1/24', u'tenant_ns_if': u't1ns2if', u'tenant_sub_if': u't1s2if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'2.2.2.0/24', u'vms': [{u'mem': 3, u'name': u't1_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br2if1', u'vmif': u't1VM3if1'}]}, {u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}])  => {"ansible_loop_var": "item", "changed": false, "item": [{"bridge_name": "t1br2", "default_route_ip": "10.1.2.1", "dns": [{"brif": "t1s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t1s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns2", "route": [{"if": "p1", "ip": "10.1.2.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "2.2.2.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns2if", "tenant_ns_ip": "10.1.2.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s2if", "tenant_sub_ip": "10.1.2.2/24"}], "vms": [{"brif": "t1br2if1", "disk": "10G", "mem": 3, "name": "t1_VM3", "vcpu": 2, "vmif": "t1VM3if1"}]}, {"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}], "skip_reason": "Conditional result was False"}

PLAY RECAP **************************************************************************************************************************************************
localhost                  : ok=21   changed=21   unreachable=0    failed=0    skipped=0    rescued=0    ignored=0   

Using /etc/ansible/ansible.cfg as config file

PLAY [worker] ***********************************************************************************************************************************************

TASK [Create Tenant Namespace] ******************************************************************************************************************************
changed: [99.99.99.2] => (item={u'default_route_ip': u'192.168.129.1', u'name': u't1', u'pns_ip': u'192.168.129.1/24', u'tenant_if': u't1if', u'tenant_ip': u'192.168.129.2/24', u'pns_if': u't1pns_if'}) => {"ansible_loop_var": "item", "changed": true, "cmd": ["ip", "netns", "add", "t1"], "delta": "0:00:00.061248", "end": "2019-11-18 12:38:52.067450", "item": {"default_route_ip": "192.168.129.1", "name": "t1", "pns_if": "t1pns_if", "pns_ip": "192.168.129.1/24", "tenant_if": "t1if", "tenant_ip": "192.168.129.2/24"}, "rc": 0, "start": "2019-11-18 12:38:52.006202", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Create Subnet Namespace] ******************************************************************************************************************************
changed: [99.99.99.2] => (item={u'route': [{u'ip': u'10.2.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.2.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.1.2/24', u'tenant_ns_ip': u'10.2.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_ns_name': u't1', u'tenant_sub_if': u't1s1if'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't1_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM4if1'}], u'vxlan': [{u'local_ip': u'10.2.1.2', u'tenant_route_ip': u'192.168.129.2', u'dsport': 4789, u'dev': u't1s1if', u'subnet_route': u'10.2.1.0/24', u'remote_route': u'10.1.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.1.1.2'}]}) => {"ansible_loop_var": "item", "changed": true, "cmd": ["ip", "netns", "add", "t1ns1"], "delta": "0:00:00.052288", "end": "2019-11-18 12:38:52.491534", "item": {"bridge_name": "t1br1", "default_route_ip": "10.2.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.2.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.2.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.2.1.2/24"}], "vms": [{"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM4", "vcpu": 4, "vmif": "t1VM4if1"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.1.2", "remote_ip": "10.1.1.2", "remote_route": "10.1.1.0/24", "subnet_route": "10.2.1.0/24", "tenant_route_ip": "192.168.129.2", "v_name": "vxlan_t1s1"}]}, "rc": 0, "start": "2019-11-18 12:38:52.439246", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Create Tenant VETH pairs] *****************************************************************************************************************************
changed: [99.99.99.2] => (item={u'default_route_ip': u'192.168.129.1', u'name': u't1', u'pns_ip': u'192.168.129.1/24', u'tenant_if': u't1if', u'tenant_ip': u'192.168.129.2/24', u'pns_if': u't1pns_if'}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip link show \"t1if\" ; if [ $? -ne 0 ] ; then ip link add \"t1if\" type veth peer name \"t1pns_if\" ; fi\n", "delta": "0:00:00.014152", "end": "2019-11-18 12:38:52.931152", "item": {"default_route_ip": "192.168.129.1", "name": "t1", "pns_if": "t1pns_if", "pns_ip": "192.168.129.1/24", "tenant_if": "t1if", "tenant_ip": "192.168.129.2/24"}, "rc": 0, "start": "2019-11-18 12:38:52.917000", "stderr": "Device \"t1if\" does not exist.", "stderr_lines": ["Device \"t1if\" does not exist."], "stdout": "", "stdout_lines": []}

TASK [Attach Tenant VETH Pairs] *****************************************************************************************************************************
changed: [99.99.99.2] => (item={u'default_route_ip': u'192.168.129.1', u'name': u't1', u'pns_ip': u'192.168.129.1/24', u'tenant_if': u't1if', u'tenant_ip': u'192.168.129.2/24', u'pns_if': u't1pns_if'}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec pns ip link show \"t1pns_if\" ; if [ $? -ne 0 ] ; then ip link set \"t1pns_if\" netns pns ; fi\nip netns exec \"t1\" ip link show \"t1if\" ; if [ $? -ne 0 ] ; then ip link set \"t1if\" netns \"t1\" ; fi\nip netns exec pns ip link set dev \"t1pns_if\" up\nip netns exec \"t1\" ip link set dev \"t1if\" up\n", "delta": "0:00:00.181141", "end": "2019-11-18 12:38:53.501644", "item": {"default_route_ip": "192.168.129.1", "name": "t1", "pns_if": "t1pns_if", "pns_ip": "192.168.129.1/24", "tenant_if": "t1if", "tenant_ip": "192.168.129.2/24"}, "rc": 0, "start": "2019-11-18 12:38:53.320503", "stderr": "Device \"t1pns_if\" does not exist.\nDevice \"t1if\" does not exist.", "stderr_lines": ["Device \"t1pns_if\" does not exist.", "Device \"t1if\" does not exist."], "stdout": "", "stdout_lines": []}

TASK [Add IP addresses to Tenant VETH Pairs] ****************************************************************************************************************
changed: [99.99.99.2] => (item={u'default_route_ip': u'192.168.129.1', u'name': u't1', u'pns_ip': u'192.168.129.1/24', u'tenant_if': u't1if', u'tenant_ip': u'192.168.129.2/24', u'pns_if': u't1pns_if'}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec pns ip addr show \"t1pns_if\" | awk 'FNR==3{ print $2 }' | grep -w '^192.168.129.1/24' ; if [ $? -ne 0 ] ; then ip netns exec pns ip addr add \"192.168.129.1/24\" dev \"t1pns_if\" ; fi\nip netns exec \"t1\" ip addr show \"t1if\" | awk 'FNR==3{ print $2 }' | grep -w '^192.168.129.2/24' ; if [ $? -ne 0 ] ; then ip netns exec \"t1\" ip addr add \"192.168.129.2/24\" dev \"t1if\" ; fi\n", "delta": "0:00:00.140392", "end": "2019-11-18 12:38:54.009574", "item": {"default_route_ip": "192.168.129.1", "name": "t1", "pns_if": "t1pns_if", "pns_ip": "192.168.129.1/24", "tenant_if": "t1if", "tenant_ip": "192.168.129.2/24"}, "rc": 0, "start": "2019-11-18 12:38:53.869182", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Create Namespace VETH Pairs] **************************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.2.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't1_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM4if1'}], u'vxlan': [{u'local_ip': u'10.2.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.129.2', u'remote_route': u'10.1.1.0/24', u'subnet_route': u'10.2.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.1.1.2'}]}, {u'tenant_sub_ip': u'10.2.1.2/24', u'tenant_ns_ip': u'10.2.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip link show \"t1ns1if\" ; if [ $? -ne 0 ] ; then ip link add \"t1ns1if\" type veth peer name \"t1s1if\" ; fi\n", "delta": "0:00:00.011583", "end": "2019-11-18 12:38:54.378894", "item": [{"bridge_name": "t1br1", "default_route_ip": "10.2.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.2.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "vms": [{"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM4", "vcpu": 4, "vmif": "t1VM4if1"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.1.2", "remote_ip": "10.1.1.2", "remote_route": "10.1.1.0/24", "subnet_route": "10.2.1.0/24", "tenant_route_ip": "192.168.129.2", "v_name": "vxlan_t1s1"}]}, {"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.2.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.2.1.2/24"}], "rc": 0, "start": "2019-11-18 12:38:54.367311", "stderr": "Device \"t1ns1if\" does not exist.", "stderr_lines": ["Device \"t1ns1if\" does not exist."], "stdout": "", "stdout_lines": []}

TASK [Attach Namespace VETH Pairs] **************************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.2.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't1_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM4if1'}], u'vxlan': [{u'local_ip': u'10.2.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.129.2', u'remote_route': u'10.1.1.0/24', u'subnet_route': u'10.2.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.1.1.2'}]}, {u'tenant_sub_ip': u'10.2.1.2/24', u'tenant_ns_ip': u'10.2.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t1\" ip link show \"t1ns1if\" ; if [ $? -ne 0 ] ; then ip link set \"t1ns1if\" netns \"t1\" ; fi\nip netns exec \"t1ns1\" ip link show \"t1s1if\" ; if [ $? -ne 0 ] ; then ip link set \"t1s1if\" netns \"t1ns1\" ; fi\n", "delta": "0:00:00.104878", "end": "2019-11-18 12:38:54.866919", "item": [{"bridge_name": "t1br1", "default_route_ip": "10.2.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.2.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "vms": [{"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM4", "vcpu": 4, "vmif": "t1VM4if1"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.1.2", "remote_ip": "10.1.1.2", "remote_route": "10.1.1.0/24", "subnet_route": "10.2.1.0/24", "tenant_route_ip": "192.168.129.2", "v_name": "vxlan_t1s1"}]}, {"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.2.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.2.1.2/24"}], "rc": 0, "start": "2019-11-18 12:38:54.762041", "stderr": "Device \"t1ns1if\" does not exist.\nDevice \"t1s1if\" does not exist.", "stderr_lines": ["Device \"t1ns1if\" does not exist.", "Device \"t1s1if\" does not exist."], "stdout": "", "stdout_lines": []}

TASK [Set Namespace VETH Pairs UP] **************************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.2.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't1_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM4if1'}], u'vxlan': [{u'local_ip': u'10.2.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.129.2', u'remote_route': u'10.1.1.0/24', u'subnet_route': u'10.2.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.1.1.2'}]}, {u'tenant_sub_ip': u'10.2.1.2/24', u'tenant_ns_ip': u'10.2.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t1\" ip link set dev \"t1ns1if\" up\nip netns exec \"t1ns1\" ip link set dev \"t1s1if\" up\n", "delta": "0:00:00.079029", "end": "2019-11-18 12:38:55.313667", "item": [{"bridge_name": "t1br1", "default_route_ip": "10.2.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.2.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "vms": [{"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM4", "vcpu": 4, "vmif": "t1VM4if1"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.1.2", "remote_ip": "10.1.1.2", "remote_route": "10.1.1.0/24", "subnet_route": "10.2.1.0/24", "tenant_route_ip": "192.168.129.2", "v_name": "vxlan_t1s1"}]}, {"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.2.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.2.1.2/24"}], "rc": 0, "start": "2019-11-18 12:38:55.234638", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Add IP addresses to Namespace VETH Pairs] *************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.2.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't1_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM4if1'}], u'vxlan': [{u'local_ip': u'10.2.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.129.2', u'remote_route': u'10.1.1.0/24', u'subnet_route': u'10.2.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.1.1.2'}]}, {u'tenant_sub_ip': u'10.2.1.2/24', u'tenant_ns_ip': u'10.2.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t1ns1\" ip addr show \"t1s1if\" | awk 'FNR==3{ print $2 }' | grep -w '^10.2.1.2/24' ; if [ $? -ne 0 ] ; then ip netns exec \"t1ns1\" ip addr add \"10.2.1.2/24\" dev \"t1s1if\" ; fi\n\nip netns exec \"t1\" ip addr show \"t1ns1if\" | awk 'FNR==3{ print $2 }' | grep -w '^10.2.1.1/24' ; if [ $? -ne 0 ] ; then ip netns exec \"t1\" ip addr add \"10.2.1.1/24\" dev \"t1ns1if\" ; fi\n", "delta": "0:00:00.164008", "end": "2019-11-18 12:38:55.845696", "item": [{"bridge_name": "t1br1", "default_route_ip": "10.2.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.2.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "vms": [{"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM4", "vcpu": 4, "vmif": "t1VM4if1"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.1.2", "remote_ip": "10.1.1.2", "remote_route": "10.1.1.0/24", "subnet_route": "10.2.1.0/24", "tenant_route_ip": "192.168.129.2", "v_name": "vxlan_t1s1"}]}, {"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.2.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.2.1.2/24"}], "rc": 0, "start": "2019-11-18 12:38:55.681688", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Add IP Route to Tenant] *******************************************************************************************************************************
changed: [99.99.99.2] => (item={u'default_route_ip': u'192.168.129.1', u'name': u't1', u'pns_ip': u'192.168.129.1/24', u'tenant_if': u't1if', u'tenant_ip': u'192.168.129.2/24', u'pns_if': u't1pns_if'}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t1\" ip route show default | grep -w '[d]efault via 192.168.129.1' ; if [ $? -ne 0 ] ; then ip netns exec \"t1\" ip route add default via \"192.168.129.1\" ; fi\n", "delta": "0:00:00.074006", "end": "2019-11-18 12:38:56.309838", "item": {"default_route_ip": "192.168.129.1", "name": "t1", "pns_if": "t1pns_if", "pns_ip": "192.168.129.1/24", "tenant_if": "t1if", "tenant_ip": "192.168.129.2/24"}, "rc": 0, "start": "2019-11-18 12:38:56.235832", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Add IP Route to Tenant Subnet] ************************************************************************************************************************
changed: [99.99.99.2] => (item={u'route': [{u'ip': u'10.2.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.2.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.1.2/24', u'tenant_ns_ip': u'10.2.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_ns_name': u't1', u'tenant_sub_if': u't1s1if'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't1_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM4if1'}], u'vxlan': [{u'local_ip': u'10.2.1.2', u'tenant_route_ip': u'192.168.129.2', u'dsport': 4789, u'dev': u't1s1if', u'subnet_route': u'10.2.1.0/24', u'remote_route': u'10.1.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.1.1.2'}]}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t1ns1\" ip route show default | grep -w '[d]efault via 10.2.1.1' ; if [ $? -ne 0 ] ; then ip netns exec \"t1ns1\" ip route add default via \"10.2.1.1\" ; fi\n", "delta": "0:00:00.078999", "end": "2019-11-18 12:38:56.749808", "item": {"bridge_name": "t1br1", "default_route_ip": "10.2.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.2.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.2.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.2.1.2/24"}], "vms": [{"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM4", "vcpu": 4, "vmif": "t1VM4if1"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.1.2", "remote_ip": "10.1.1.2", "remote_route": "10.1.1.0/24", "subnet_route": "10.2.1.0/24", "tenant_route_ip": "192.168.129.2", "v_name": "vxlan_t1s1"}]}, "rc": 0, "start": "2019-11-18 12:38:56.670809", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Create bridge inside namespace] ***********************************************************************************************************************
changed: [99.99.99.2] => (item={u'route': [{u'ip': u'10.2.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.2.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.1.2/24', u'tenant_ns_ip': u'10.2.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_ns_name': u't1', u'tenant_sub_if': u't1s1if'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't1_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM4if1'}], u'vxlan': [{u'local_ip': u'10.2.1.2', u'tenant_route_ip': u'192.168.129.2', u'dsport': 4789, u'dev': u't1s1if', u'subnet_route': u'10.2.1.0/24', u'remote_route': u'10.1.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.1.1.2'}]}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t1ns1\" brctl show | grep -w '^t1br1'; if [ $? -ne 0 ] ; then ip netns exec \"t1ns1\" brctl addbr \"t1br1\" ; fi\nip netns exec \"t1ns1\" ip link set dev \"t1br1\" up\n", "delta": "0:00:00.109883", "end": "2019-11-18 12:38:57.237754", "item": {"bridge_name": "t1br1", "default_route_ip": "10.2.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.2.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.2.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.2.1.2/24"}], "vms": [{"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM4", "vcpu": 4, "vmif": "t1VM4if1"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.1.2", "remote_ip": "10.1.1.2", "remote_route": "10.1.1.0/24", "subnet_route": "10.2.1.0/24", "tenant_route_ip": "192.168.129.2", "v_name": "vxlan_t1s1"}]}, "rc": 0, "start": "2019-11-18 12:38:57.127871", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Create DNS VETH Pair] *********************************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.2.1.1', u'bridge_name': u't1br1', u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.1.2/24', u'tenant_ns_ip': u'10.2.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't1_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM4if1'}], u'vxlan': [{u'local_ip': u'10.2.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.129.2', u'remote_route': u'10.1.1.0/24', u'subnet_route': u'10.2.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.1.1.2'}]}, {u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t1ns1\" ip link show \"t1s1_dnsbrif\" ; if [ $? -ne 0 ] ; then ip netns exec \"t1ns1\" ip link add \"t1s1_dnsbrif\" type veth peer name \"t1s1_dnsif\" ; fi\nip netns exec \"t1ns1\" ip link set dev \"t1s1_dnsbrif\" up\nip netns exec \"t1ns1\" ip link set dev \"t1s1_dnsif\" up\n", "delta": "0:00:00.138096", "end": "2019-11-18 12:38:57.757626", "item": [{"bridge_name": "t1br1", "default_route_ip": "10.2.1.1", "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.2.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.2.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.2.1.2/24"}], "vms": [{"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM4", "vcpu": 4, "vmif": "t1VM4if1"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.1.2", "remote_ip": "10.1.1.2", "remote_route": "10.1.1.0/24", "subnet_route": "10.2.1.0/24", "tenant_route_ip": "192.168.129.2", "v_name": "vxlan_t1s1"}]}, {"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "rc": 0, "start": "2019-11-18 12:38:57.619530", "stderr": "Device \"t1s1_dnsbrif\" does not exist.", "stderr_lines": ["Device \"t1s1_dnsbrif\" does not exist."], "stdout": "", "stdout_lines": []}

TASK [Attach DNS VETH Pair] *********************************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.2.1.1', u'bridge_name': u't1br1', u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.1.2/24', u'tenant_ns_ip': u'10.2.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't1_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM4if1'}], u'vxlan': [{u'local_ip': u'10.2.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.129.2', u'remote_route': u'10.1.1.0/24', u'subnet_route': u'10.2.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.1.1.2'}]}, {u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t1ns1\" brctl show \"t1br1\" | grep -w 't1s1_dnsbrif' ; if [ $? -ne 0 ] ; then ip netns exec \"t1ns1\" brctl addif \"t1br1\" \"t1s1_dnsbrif\" ; fi\n", "delta": "0:00:00.078576", "end": "2019-11-18 12:38:58.197741", "item": [{"bridge_name": "t1br1", "default_route_ip": "10.2.1.1", "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.2.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.2.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.2.1.2/24"}], "vms": [{"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM4", "vcpu": 4, "vmif": "t1VM4if1"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.1.2", "remote_ip": "10.1.1.2", "remote_route": "10.1.1.0/24", "subnet_route": "10.2.1.0/24", "tenant_route_ip": "192.168.129.2", "v_name": "vxlan_t1s1"}]}, {"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "rc": 0, "start": "2019-11-18 12:38:58.119165", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Create VETH Pairs] ************************************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.2.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.1.2/24', u'tenant_ns_ip': u'10.2.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.2.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.129.2', u'remote_route': u'10.1.1.0/24', u'subnet_route': u'10.2.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.1.1.2'}]}, {u'mem': 2, u'name': u't1_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM4if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip link show \"t1br1if1\" ; if [ $? -ne 0 ] ; then ip link add \"t1VM4if1\" type veth peer name \"t1br1if1\" ; fi\nip link set dev \"t1br1if1\" up\nip link set dev \"t1VM4if1\" up\n", "delta": "0:00:00.012473", "end": "2019-11-18 12:38:58.564141", "item": [{"bridge_name": "t1br1", "default_route_ip": "10.2.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.2.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.2.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.2.1.2/24"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.1.2", "remote_ip": "10.1.1.2", "remote_route": "10.1.1.0/24", "subnet_route": "10.2.1.0/24", "tenant_route_ip": "192.168.129.2", "v_name": "vxlan_t1s1"}]}, {"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM4", "vcpu": 4, "vmif": "t1VM4if1"}], "rc": 0, "start": "2019-11-18 12:38:58.551668", "stderr": "Device \"t1br1if1\" does not exist.", "stderr_lines": ["Device \"t1br1if1\" does not exist."], "stdout": "", "stdout_lines": []}

TASK [Attach VETH Pairs] ************************************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.2.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.1.2/24', u'tenant_ns_ip': u'10.2.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.2.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.129.2', u'remote_route': u'10.1.1.0/24', u'subnet_route': u'10.2.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.1.1.2'}]}, {u'mem': 2, u'name': u't1_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM4if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip link show \"t1br1if1\" ; if [ $? -eq 0 ] ; then ip link set \"t1br1if1\" netns \"t1ns1\" ; fi\nip netns exec \"t1ns1\" brctl show \"t1br1\" | grep -w 't1br1if1' ; if [ $? -ne 0 ] ; then ip netns exec \"t1ns1\" brctl addif \"t1br1\" \"t1br1if1\" ; fi\n", "delta": "0:00:00.114790", "end": "2019-11-18 12:38:59.041809", "item": [{"bridge_name": "t1br1", "default_route_ip": "10.2.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.2.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.2.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.2.1.2/24"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.1.2", "remote_ip": "10.1.1.2", "remote_route": "10.1.1.0/24", "subnet_route": "10.2.1.0/24", "tenant_route_ip": "192.168.129.2", "v_name": "vxlan_t1s1"}]}, {"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM4", "vcpu": 4, "vmif": "t1VM4if1"}], "rc": 0, "start": "2019-11-18 12:38:58.927019", "stderr": "", "stderr_lines": [], "stdout": "18: t1br1if1@t1VM4if1: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP mode DEFAULT group default qlen 1000\n    link/ether b2:b4:27:11:c9:b5 brd ff:ff:ff:ff:ff:ff", "stdout_lines": ["18: t1br1if1@t1VM4if1: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP mode DEFAULT group default qlen 1000", "    link/ether b2:b4:27:11:c9:b5 brd ff:ff:ff:ff:ff:ff"]}

TASK [All interfaces and bridges UP] ************************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.2.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.1.2/24', u'tenant_ns_ip': u'10.2.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.2.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.129.2', u'remote_route': u'10.1.1.0/24', u'subnet_route': u'10.2.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.1.1.2'}]}, {u'mem': 2, u'name': u't1_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM4if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t1ns1\" ip link set \"t1br1if1\" up\nip netns exec \"t1ns1\" ip link set dev \"t1br1\" up\n", "delta": "0:00:00.077606", "end": "2019-11-18 12:38:59.481708", "item": [{"bridge_name": "t1br1", "default_route_ip": "10.2.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.2.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.2.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.2.1.2/24"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.1.2", "remote_ip": "10.1.1.2", "remote_route": "10.1.1.0/24", "subnet_route": "10.2.1.0/24", "tenant_route_ip": "192.168.129.2", "v_name": "vxlan_t1s1"}]}, {"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM4", "vcpu": 4, "vmif": "t1VM4if1"}], "rc": 0, "start": "2019-11-18 12:38:59.404102", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Add IP to DNS Interface] ******************************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.2.1.1', u'bridge_name': u't1br1', u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.1.2/24', u'tenant_ns_ip': u'10.2.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't1_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM4if1'}], u'vxlan': [{u'local_ip': u'10.2.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.129.2', u'remote_route': u'10.1.1.0/24', u'subnet_route': u'10.2.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.1.1.2'}]}, {u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t1ns1\" ip addr show \"t1s1_dnsif\" | awk 'FNR==3{ print $2}'| grep -w '^1.1.1.128/24' ; if [ $? -ne 0 ] ; then ip netns exec \"t1ns1\" ip addr add \"1.1.1.128/24\" dev \"t1s1_dnsif\" ; fi\n", "delta": "0:00:00.079860", "end": "2019-11-18 12:38:59.921798", "item": [{"bridge_name": "t1br1", "default_route_ip": "10.2.1.1", "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.2.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.2.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.2.1.2/24"}], "vms": [{"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM4", "vcpu": 4, "vmif": "t1VM4if1"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.1.2", "remote_ip": "10.1.1.2", "remote_route": "10.1.1.0/24", "subnet_route": "10.2.1.0/24", "tenant_route_ip": "192.168.129.2", "v_name": "vxlan_t1s1"}]}, {"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "rc": 0, "start": "2019-11-18 12:38:59.841938", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Install DHCP Server] **********************************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.2.1.1', u'bridge_name': u't1br1', u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.1.2/24', u'tenant_ns_ip': u'10.2.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't1_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM4if1'}], u'vxlan': [{u'local_ip': u'10.2.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.129.2', u'remote_route': u'10.1.1.0/24', u'subnet_route': u'10.2.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.1.1.2'}]}, {u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t1ns1\" ps aux | grep -w '[d]nsmasq --interface t1s1_dnsif -z --dhcp-range=1.1.1.133,1.1.1.254' ; if [ $? -ne 0 ] ; then ip netns exec \"t1ns1\" dnsmasq --interface \"t1s1_dnsif\" -z --dhcp-range=1.1.1.133,'1.1.1.254' ; fi\n", "delta": "0:00:00.069075", "end": "2019-11-18 12:39:00.366733", "item": [{"bridge_name": "t1br1", "default_route_ip": "10.2.1.1", "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.2.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.2.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.2.1.2/24"}], "vms": [{"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM4", "vcpu": 4, "vmif": "t1VM4if1"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.1.2", "remote_ip": "10.1.1.2", "remote_route": "10.1.1.0/24", "subnet_route": "10.2.1.0/24", "tenant_route_ip": "192.168.129.2", "v_name": "vxlan_t1s1"}]}, {"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "rc": 0, "start": "2019-11-18 12:39:00.297658", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Create VXLAN devices] *********************************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.2.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.1.2/24', u'tenant_ns_ip': u'10.2.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't1_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM4if1'}]}, {u'local_ip': u'10.2.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.129.2', u'remote_route': u'10.1.1.0/24', u'subnet_route': u'10.2.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.1.1.2'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t1ns1\" ip link show \"vxlan_t1s1\" ; if [ $? -ne 0 ] ; then ip netns exec \"t1ns1\" ip link add \"vxlan_t1s1\" type vxlan id \"42\" local \"10.2.1.2\" remote \"10.1.1.2\" dstport \"4789\" dev \"t1s1if\" ; ip netns exec \"t1ns1\" ip link set dev \"vxlan_t1s1\" up ; fi\n", "delta": "0:00:00.171226", "end": "2019-11-18 12:39:00.929756", "item": [{"bridge_name": "t1br1", "default_route_ip": "10.2.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.2.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.2.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.2.1.2/24"}], "vms": [{"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM4", "vcpu": 4, "vmif": "t1VM4if1"}]}, {"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.1.2", "remote_ip": "10.1.1.2", "remote_route": "10.1.1.0/24", "subnet_route": "10.2.1.0/24", "tenant_route_ip": "192.168.129.2", "v_name": "vxlan_t1s1"}], "rc": 0, "start": "2019-11-18 12:39:00.758530", "stderr": "Device \"vxlan_t1s1\" does not exist.", "stderr_lines": ["Device \"vxlan_t1s1\" does not exist."], "stdout": "", "stdout_lines": []}

TASK [Attach VXLANs to bridge] ******************************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.2.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.1.2/24', u'tenant_ns_ip': u'10.2.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't1_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM4if1'}]}, {u'local_ip': u'10.2.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.129.2', u'remote_route': u'10.1.1.0/24', u'subnet_route': u'10.2.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.1.1.2'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t1ns1\" brctl show \"t1br1\" | grep -w 'vxlan_t1s1' ; if [ $? -ne 0 ] ; then ip netns exec \"t1ns1\" brctl addif \"t1br1\" \"vxlan_t1s1\" ; fi\n", "delta": "0:00:00.065457", "end": "2019-11-18 12:39:01.381701", "item": [{"bridge_name": "t1br1", "default_route_ip": "10.2.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.2.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.2.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.2.1.2/24"}], "vms": [{"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM4", "vcpu": 4, "vmif": "t1VM4if1"}]}, {"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.1.2", "remote_ip": "10.1.1.2", "remote_route": "10.1.1.0/24", "subnet_route": "10.2.1.0/24", "tenant_route_ip": "192.168.129.2", "v_name": "vxlan_t1s1"}], "rc": 0, "start": "2019-11-18 12:39:01.316244", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

PLAY RECAP **************************************************************************************************************************************************
99.99.99.2                 : ok=21   changed=21   unreachable=0    failed=0    skipped=0    rescued=0    ignored=0   

Using /etc/ansible/ansible.cfg as config file

PLAY [main] *************************************************************************************************************************************************

TASK [Add VXLAN routes in PNS] ******************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.1.2/24', u'tenant_ns_ip': u'10.1.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't1_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM1if1'}, {u'mem': 4, u'name': u't1_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br1if2', u'vmif': u't1VM2if1'}]}, {u'local_ip': u'10.1.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.1.2', u'remote_route': u'10.2.1.0/24', u'subnet_route': u'10.1.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.2.1.2'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec pns ip route show \"10.1.1.0/24\" via \"192.168.1.2\" | grep -w '^10.1.1.0/24' ; if [ $? -ne 0 ] ; then ip netns exec pns ip route add \"10.1.1.0/24\" via \"192.168.1.2\" ; fi\n", "delta": "0:00:00.070037", "end": "2019-11-18 12:39:02.471963", "item": [{"bridge_name": "t1br1", "default_route_ip": "10.1.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.1.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.1.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.1.1.2/24"}], "vms": [{"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM1", "vcpu": 4, "vmif": "t1VM1if1"}, {"brif": "t1br1if2", "disk": "10G", "mem": 4, "name": "t1_VM2", "vcpu": 2, "vmif": "t1VM2if1"}]}, {"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.1.2", "remote_ip": "10.2.1.2", "remote_route": "10.2.1.0/24", "subnet_route": "10.1.1.0/24", "tenant_route_ip": "192.168.1.2", "v_name": "vxlan_t1s1"}], "rc": 0, "start": "2019-11-18 12:39:02.401926", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}
skipping: [localhost] => (item=[{u'route': [{u'ip': u'10.1.2.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.2.1', u'bridge_name': u't1br2', u'dns': [{u'dnsif': u't1s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s2_dnsbrif'}], u'ns_name': u't1ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.2.2/24', u'tenant_ns_ip': u'10.1.2.1/24', u'tenant_ns_if': u't1ns2if', u'tenant_sub_if': u't1s2if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'2.2.2.0/24', u'vms': [{u'mem': 3, u'name': u't1_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br2if1', u'vmif': u't1VM3if1'}]}, {u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}])  => {"ansible_loop_var": "item", "changed": false, "item": [{"bridge_name": "t1br2", "default_route_ip": "10.1.2.1", "dns": [{"brif": "t1s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t1s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns2", "route": [{"if": "p1", "ip": "10.1.2.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "2.2.2.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns2if", "tenant_ns_ip": "10.1.2.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s2if", "tenant_sub_ip": "10.1.2.2/24"}], "vms": [{"brif": "t1br2if1", "disk": "10G", "mem": 3, "name": "t1_VM3", "vcpu": 2, "vmif": "t1VM3if1"}]}, {"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}], "skip_reason": "Conditional result was False"}

TASK [Get PNS ip address] ***********************************************************************************************************************************
ok: [localhost] => {"changed": false, "cmd": "ip netns exec pns ip addr show p1 | awk 'FNR==3{ print $2 }' | awk -F/ '{ print $1 }'\n", "delta": "0:00:00.038330", "end": "2019-11-18 12:39:02.756223", "rc": 0, "start": "2019-11-18 12:39:02.717893", "stderr": "", "stderr_lines": [], "stdout": "192.168.100.238", "stdout_lines": ["192.168.100.238"]}

TASK [Add VXLAN routes to host] *****************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.1.2/24', u'tenant_ns_ip': u'10.1.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't1_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM1if1'}, {u'mem': 4, u'name': u't1_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br1if2', u'vmif': u't1VM2if1'}]}, {u'local_ip': u'10.1.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.1.2', u'remote_route': u'10.2.1.0/24', u'subnet_route': u'10.1.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.2.1.2'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip route show \"10.1.1.0/24\" via \"192.168.100.238\" | grep -w '^10.1.1.0/24' ; if [ $? -ne 0 ] ; then ip route add \"10.1.1.0/24\" via \"192.168.100.238\" ; fi\nip route show \"10.2.1.0/24\" via 99.99.99.2 | grep -w '^10.2.1.0/24'; if [ $? -ne 0 ] ; then ip route add \"10.2.1.0/24\" via 99.99.99.2 ; fi\n", "delta": "0:00:00.007851", "end": "2019-11-18 12:39:03.019304", "item": [{"bridge_name": "t1br1", "default_route_ip": "10.1.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.1.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.1.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.1.1.2/24"}], "vms": [{"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM1", "vcpu": 4, "vmif": "t1VM1if1"}, {"brif": "t1br1if2", "disk": "10G", "mem": 4, "name": "t1_VM2", "vcpu": 2, "vmif": "t1VM2if1"}]}, {"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.1.2", "remote_ip": "10.2.1.2", "remote_route": "10.2.1.0/24", "subnet_route": "10.1.1.0/24", "tenant_route_ip": "192.168.1.2", "v_name": "vxlan_t1s1"}], "rc": 0, "start": "2019-11-18 12:39:03.011453", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}
skipping: [localhost] => (item=[{u'route': [{u'ip': u'10.1.2.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.2.1', u'bridge_name': u't1br2', u'dns': [{u'dnsif': u't1s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s2_dnsbrif'}], u'ns_name': u't1ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.2.2/24', u'tenant_ns_ip': u'10.1.2.1/24', u'tenant_ns_if': u't1ns2if', u'tenant_sub_if': u't1s2if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'2.2.2.0/24', u'vms': [{u'mem': 3, u'name': u't1_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br2if1', u'vmif': u't1VM3if1'}]}, {u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}])  => {"ansible_loop_var": "item", "changed": false, "item": [{"bridge_name": "t1br2", "default_route_ip": "10.1.2.1", "dns": [{"brif": "t1s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t1s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns2", "route": [{"if": "p1", "ip": "10.1.2.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "2.2.2.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns2if", "tenant_ns_ip": "10.1.2.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s2if", "tenant_sub_ip": "10.1.2.2/24"}], "vms": [{"brif": "t1br2if1", "disk": "10G", "mem": 3, "name": "t1_VM3", "vcpu": 2, "vmif": "t1VM3if1"}]}, {"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}], "skip_reason": "Conditional result was False"}

PLAY RECAP **************************************************************************************************************************************************
localhost                  : ok=3    changed=2    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0   

Using /etc/ansible/ansible.cfg as config file

PLAY [worker] ***********************************************************************************************************************************************

TASK [Add VXLAN routes in PNS] ******************************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.2.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.1.2/24', u'tenant_ns_ip': u'10.2.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't1_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM4if1'}]}, {u'local_ip': u'10.2.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.129.2', u'remote_route': u'10.1.1.0/24', u'subnet_route': u'10.2.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.1.1.2'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec pns ip route show \"10.2.1.0/24\" via \"192.168.129.2\" | grep -w '^10.2.1.0/24' ; if [ $? -ne 0 ] ; then ip netns exec pns ip route add \"10.2.1.0/24\" via \"192.168.129.2\" ; fi\n", "delta": "0:00:00.065956", "end": "2019-11-18 12:39:04.133740", "item": [{"bridge_name": "t1br1", "default_route_ip": "10.2.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.2.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.2.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.2.1.2/24"}], "vms": [{"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM4", "vcpu": 4, "vmif": "t1VM4if1"}]}, {"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.1.2", "remote_ip": "10.1.1.2", "remote_route": "10.1.1.0/24", "subnet_route": "10.2.1.0/24", "tenant_route_ip": "192.168.129.2", "v_name": "vxlan_t1s1"}], "rc": 0, "start": "2019-11-18 12:39:04.067784", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Get PNS ip address] ***********************************************************************************************************************************
ok: [99.99.99.2] => {"changed": false, "cmd": "ip netns exec pns ip addr show p1 | awk 'FNR==3{ print $2 }' | awk -F/ '{ print $1 }'\n", "delta": "0:00:00.033465", "end": "2019-11-18 12:39:04.553892", "rc": 0, "start": "2019-11-18 12:39:04.520427", "stderr": "", "stderr_lines": [], "stdout": "192.168.100.50", "stdout_lines": ["192.168.100.50"]}

TASK [Add VXLAN routes to host] *****************************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.2.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.1.2/24', u'tenant_ns_ip': u'10.2.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'1.1.1.0/24', u'vms': [{u'mem': 2, u'name': u't1_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM4if1'}]}, {u'local_ip': u'10.2.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.129.2', u'remote_route': u'10.1.1.0/24', u'subnet_route': u'10.2.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.1.1.2'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip route show \"10.2.1.0/24\" via \"192.168.100.50\" | grep -w '^10.2.1.0/24' ; if [ $? -ne 0 ] ; then ip route add \"10.2.1.0/24\" via \"192.168.100.50\" ; fi\nip route show \"10.1.1.0/24\" via 99.99.99.1 | grep -w '^10.1.1.0/24'; if [ $? -ne 0 ] ; then ip route add \"10.1.1.0/24\" via 99.99.99.1 ; fi\n", "delta": "0:00:00.008071", "end": "2019-11-18 12:39:04.966415", "item": [{"bridge_name": "t1br1", "default_route_ip": "10.2.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.2.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.2.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.2.1.2/24"}], "vms": [{"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM4", "vcpu": 4, "vmif": "t1VM4if1"}]}, {"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.1.2", "remote_ip": "10.1.1.2", "remote_route": "10.1.1.0/24", "subnet_route": "10.2.1.0/24", "tenant_route_ip": "192.168.129.2", "v_name": "vxlan_t1s1"}], "rc": 0, "start": "2019-11-18 12:39:04.958344", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

PLAY RECAP **************************************************************************************************************************************************
99.99.99.2                 : ok=3    changed=2    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0   

Using /etc/ansible/ansible.cfg as config file

PLAY [main] *************************************************************************************************************************************************

TASK [Create VM templates (C1)] *****************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.1.2/24', u'tenant_ns_ip': u'10.1.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.1.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.1.2', u'remote_route': u'10.2.1.0/24', u'subnet_route': u'10.1.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.2.1.2'}]}, {u'mem': 2, u'name': u't1_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM1if1'}]) => {"ansible_loop_var": "item", "changed": true, "checksum": "350ba870bd31b7f6ee517845c14237910b5af0bf", "dest": "/root/Migration-as-a-Service/t1/VM_templates/t1_VM1.xml.j2", "gid": 0, "group": "root", "item": [{"bridge_name": "t1br1", "default_route_ip": "10.1.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.1.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.1.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.1.1.2/24"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.1.2", "remote_ip": "10.2.1.2", "remote_route": "10.2.1.0/24", "subnet_route": "10.1.1.0/24", "tenant_route_ip": "192.168.1.2", "v_name": "vxlan_t1s1"}]}, {"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM1", "vcpu": 4, "vmif": "t1VM1if1"}], "md5sum": "fbfc2eb0c2569531f25eea92c26d3bee", "mode": "0644", "owner": "root", "size": 4091, "src": "/root/.ansible/tmp/ansible-tmp-1574080745.63-10878179719369/source", "state": "file", "uid": 0}
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.1.2/24', u'tenant_ns_ip': u'10.1.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.1.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.1.2', u'remote_route': u'10.2.1.0/24', u'subnet_route': u'10.1.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.2.1.2'}]}, {u'mem': 4, u'name': u't1_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br1if2', u'vmif': u't1VM2if1'}]) => {"ansible_loop_var": "item", "changed": true, "checksum": "350ba870bd31b7f6ee517845c14237910b5af0bf", "dest": "/root/Migration-as-a-Service/t1/VM_templates/t1_VM2.xml.j2", "gid": 0, "group": "root", "item": [{"bridge_name": "t1br1", "default_route_ip": "10.1.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.1.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.1.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.1.1.2/24"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.1.2", "remote_ip": "10.2.1.2", "remote_route": "10.2.1.0/24", "subnet_route": "10.1.1.0/24", "tenant_route_ip": "192.168.1.2", "v_name": "vxlan_t1s1"}]}, {"brif": "t1br1if2", "disk": "10G", "mem": 4, "name": "t1_VM2", "vcpu": 2, "vmif": "t1VM2if1"}], "md5sum": "fbfc2eb0c2569531f25eea92c26d3bee", "mode": "0644", "owner": "root", "size": 4091, "src": "/root/.ansible/tmp/ansible-tmp-1574080746.13-140206030404277/source", "state": "file", "uid": 0}
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.2.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.2.1', u'bridge_name': u't1br2', u'dns': [{u'dnsif': u't1s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s2_dnsbrif'}], u'ns_name': u't1ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.2.2/24', u'tenant_ns_ip': u'10.1.2.1/24', u'tenant_ns_if': u't1ns2if', u'tenant_sub_if': u't1s2if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'2.2.2.0/24', u'vxlan': [{u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}, {u'mem': 3, u'name': u't1_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br2if1', u'vmif': u't1VM3if1'}]) => {"ansible_loop_var": "item", "changed": true, "checksum": "350ba870bd31b7f6ee517845c14237910b5af0bf", "dest": "/root/Migration-as-a-Service/t1/VM_templates/t1_VM3.xml.j2", "gid": 0, "group": "root", "item": [{"bridge_name": "t1br2", "default_route_ip": "10.1.2.1", "dns": [{"brif": "t1s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t1s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns2", "route": [{"if": "p1", "ip": "10.1.2.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "2.2.2.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns2if", "tenant_ns_ip": "10.1.2.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s2if", "tenant_sub_ip": "10.1.2.2/24"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, {"brif": "t1br2if1", "disk": "10G", "mem": 3, "name": "t1_VM3", "vcpu": 2, "vmif": "t1VM3if1"}], "md5sum": "fbfc2eb0c2569531f25eea92c26d3bee", "mode": "0644", "owner": "root", "size": 4091, "src": "/root/.ansible/tmp/ansible-tmp-1574080746.34-133827380441025/source", "state": "file", "uid": 0}

PLAY RECAP **************************************************************************************************************************************************
localhost                  : ok=1    changed=1    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0   

Using /etc/ansible/ansible.cfg as config file

PLAY [main] *************************************************************************************************************************************************

TASK [Create VM templates (C2)] *****************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.2.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.2.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.1.2/24', u'tenant_ns_ip': u'10.2.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.2.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.129.2', u'remote_route': u'10.1.1.0/24', u'subnet_route': u'10.2.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.1.1.2'}]}, {u'mem': 2, u'name': u't1_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM4if1'}]) => {"ansible_loop_var": "item", "changed": true, "checksum": "350ba870bd31b7f6ee517845c14237910b5af0bf", "dest": "/root/Migration-as-a-Service/t1/VM_templates/t1_VM4.xml.j2", "gid": 0, "group": "root", "item": [{"bridge_name": "t1br1", "default_route_ip": "10.2.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.2.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.2.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.2.1.2/24"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.1.2", "remote_ip": "10.1.1.2", "remote_route": "10.1.1.0/24", "subnet_route": "10.2.1.0/24", "tenant_route_ip": "192.168.129.2", "v_name": "vxlan_t1s1"}]}, {"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM4", "vcpu": 4, "vmif": "t1VM4if1"}], "md5sum": "fbfc2eb0c2569531f25eea92c26d3bee", "mode": "0644", "owner": "root", "size": 4091, "src": "/root/.ansible/tmp/ansible-tmp-1574080747.15-106462281694190/source", "state": "file", "uid": 0}

PLAY RECAP **************************************************************************************************************************************************
localhost                  : ok=1    changed=1    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0   

Using /etc/ansible/ansible.cfg as config file

PLAY [main] *************************************************************************************************************************************************

TASK [Copy VM image] ****************************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.1.2/24', u'tenant_ns_ip': u'10.1.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.1.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.1.2', u'remote_route': u'10.2.1.0/24', u'subnet_route': u'10.1.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.2.1.2'}]}, {u'mem': 2, u'name': u't1_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM1if1'}]) => {"ansible_loop_var": "item", "changed": true, "checksum": "d86d5962370fcd0c3d05943fc209d9e05fdac89f", "dest": "/var/lib/libvirt/images/t1_VM1.qcow2", "gid": 0, "group": "root", "item": [{"bridge_name": "t1br1", "default_route_ip": "10.1.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.1.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.1.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.1.1.2/24"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.1.2", "remote_ip": "10.2.1.2", "remote_route": "10.2.1.0/24", "subnet_route": "10.1.1.0/24", "tenant_route_ip": "192.168.1.2", "v_name": "vxlan_t1s1"}]}, {"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM1", "vcpu": 4, "vmif": "t1VM1if1"}], "md5sum": "b977a19124b65f2d544ddc62e407114d", "mode": "0644", "owner": "root", "size": 10739318784, "src": "/root/.ansible/tmp/ansible-tmp-1574080748.46-5935534724973/source", "state": "file", "uid": 0}
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.1.2/24', u'tenant_ns_ip': u'10.1.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.1.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.1.2', u'remote_route': u'10.2.1.0/24', u'subnet_route': u'10.1.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.2.1.2'}]}, {u'mem': 4, u'name': u't1_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br1if2', u'vmif': u't1VM2if1'}]) => {"ansible_loop_var": "item", "changed": true, "checksum": "d86d5962370fcd0c3d05943fc209d9e05fdac89f", "dest": "/var/lib/libvirt/images/t1_VM2.qcow2", "gid": 0, "group": "root", "item": [{"bridge_name": "t1br1", "default_route_ip": "10.1.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.1.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.1.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.1.1.2/24"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.1.2", "remote_ip": "10.2.1.2", "remote_route": "10.2.1.0/24", "subnet_route": "10.1.1.0/24", "tenant_route_ip": "192.168.1.2", "v_name": "vxlan_t1s1"}]}, {"brif": "t1br1if2", "disk": "10G", "mem": 4, "name": "t1_VM2", "vcpu": 2, "vmif": "t1VM2if1"}], "md5sum": "b977a19124b65f2d544ddc62e407114d", "mode": "0644", "owner": "root", "size": 10739318784, "src": "/root/.ansible/tmp/ansible-tmp-1574080845.88-11780551687509/source", "state": "file", "uid": 0}
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.2.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.2.1', u'bridge_name': u't1br2', u'dns': [{u'dnsif': u't1s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s2_dnsbrif'}], u'ns_name': u't1ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.2.2/24', u'tenant_ns_ip': u'10.1.2.1/24', u'tenant_ns_if': u't1ns2if', u'tenant_sub_if': u't1s2if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'2.2.2.0/24', u'vxlan': [{u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}, {u'mem': 3, u'name': u't1_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br2if1', u'vmif': u't1VM3if1'}]) => {"ansible_loop_var": "item", "changed": true, "checksum": "d86d5962370fcd0c3d05943fc209d9e05fdac89f", "dest": "/var/lib/libvirt/images/t1_VM3.qcow2", "gid": 0, "group": "root", "item": [{"bridge_name": "t1br2", "default_route_ip": "10.1.2.1", "dns": [{"brif": "t1s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t1s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns2", "route": [{"if": "p1", "ip": "10.1.2.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "2.2.2.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns2if", "tenant_ns_ip": "10.1.2.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s2if", "tenant_sub_ip": "10.1.2.2/24"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, {"brif": "t1br2if1", "disk": "10G", "mem": 3, "name": "t1_VM3", "vcpu": 2, "vmif": "t1VM3if1"}], "md5sum": "b977a19124b65f2d544ddc62e407114d", "mode": "0644", "owner": "root", "size": 10739318784, "src": "/root/.ansible/tmp/ansible-tmp-1574080922.74-47631267725744/source", "state": "file", "uid": 0}

TASK [Create VM templates (C1)] *****************************************************************************************************************************
ok: [localhost] => (item=[{u'route': [{u'ip': u'10.1.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.1.2/24', u'tenant_ns_ip': u'10.1.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.1.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.1.2', u'remote_route': u'10.2.1.0/24', u'subnet_route': u'10.1.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.2.1.2'}]}, {u'mem': 2, u'name': u't1_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM1if1'}]) => {"ansible_loop_var": "item", "changed": false, "checksum": "350ba870bd31b7f6ee517845c14237910b5af0bf", "dest": "/root/Migration-as-a-Service/t1/VM_templates/t1_VM1.xml.j2", "gid": 0, "group": "root", "item": [{"bridge_name": "t1br1", "default_route_ip": "10.1.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.1.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.1.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.1.1.2/24"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.1.2", "remote_ip": "10.2.1.2", "remote_route": "10.2.1.0/24", "subnet_route": "10.1.1.0/24", "tenant_route_ip": "192.168.1.2", "v_name": "vxlan_t1s1"}]}, {"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM1", "vcpu": 4, "vmif": "t1VM1if1"}], "mode": "0644", "owner": "root", "path": "/root/Migration-as-a-Service/t1/VM_templates/t1_VM1.xml.j2", "size": 4091, "state": "file", "uid": 0}
ok: [localhost] => (item=[{u'route': [{u'ip': u'10.1.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.1.2/24', u'tenant_ns_ip': u'10.1.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.1.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.1.2', u'remote_route': u'10.2.1.0/24', u'subnet_route': u'10.1.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.2.1.2'}]}, {u'mem': 4, u'name': u't1_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br1if2', u'vmif': u't1VM2if1'}]) => {"ansible_loop_var": "item", "changed": false, "checksum": "350ba870bd31b7f6ee517845c14237910b5af0bf", "dest": "/root/Migration-as-a-Service/t1/VM_templates/t1_VM2.xml.j2", "gid": 0, "group": "root", "item": [{"bridge_name": "t1br1", "default_route_ip": "10.1.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.1.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.1.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.1.1.2/24"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.1.2", "remote_ip": "10.2.1.2", "remote_route": "10.2.1.0/24", "subnet_route": "10.1.1.0/24", "tenant_route_ip": "192.168.1.2", "v_name": "vxlan_t1s1"}]}, {"brif": "t1br1if2", "disk": "10G", "mem": 4, "name": "t1_VM2", "vcpu": 2, "vmif": "t1VM2if1"}], "mode": "0644", "owner": "root", "path": "/root/Migration-as-a-Service/t1/VM_templates/t1_VM2.xml.j2", "size": 4091, "state": "file", "uid": 0}
ok: [localhost] => (item=[{u'route': [{u'ip': u'10.1.2.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.2.1', u'bridge_name': u't1br2', u'dns': [{u'dnsif': u't1s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s2_dnsbrif'}], u'ns_name': u't1ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.2.2/24', u'tenant_ns_ip': u'10.1.2.1/24', u'tenant_ns_if': u't1ns2if', u'tenant_sub_if': u't1s2if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'2.2.2.0/24', u'vxlan': [{u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}, {u'mem': 3, u'name': u't1_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br2if1', u'vmif': u't1VM3if1'}]) => {"ansible_loop_var": "item", "changed": false, "checksum": "350ba870bd31b7f6ee517845c14237910b5af0bf", "dest": "/root/Migration-as-a-Service/t1/VM_templates/t1_VM3.xml.j2", "gid": 0, "group": "root", "item": [{"bridge_name": "t1br2", "default_route_ip": "10.1.2.1", "dns": [{"brif": "t1s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t1s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns2", "route": [{"if": "p1", "ip": "10.1.2.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "2.2.2.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns2if", "tenant_ns_ip": "10.1.2.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s2if", "tenant_sub_ip": "10.1.2.2/24"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, {"brif": "t1br2if1", "disk": "10G", "mem": 3, "name": "t1_VM3", "vcpu": 2, "vmif": "t1VM3if1"}], "mode": "0644", "owner": "root", "path": "/root/Migration-as-a-Service/t1/VM_templates/t1_VM3.xml.j2", "size": 4091, "state": "file", "uid": 0}

TASK [Get list of running VMs] ******************************************************************************************************************************
ok: [localhost] => {"changed": false, "cmd": ["virsh", "list", "--name"], "delta": "0:00:00.943974", "end": "2019-11-18 12:43:42.355762", "rc": 0, "start": "2019-11-18 12:43:41.411788", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Define VM] ********************************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.1.2/24', u'tenant_ns_ip': u'10.1.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.1.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.1.2', u'remote_route': u'10.2.1.0/24', u'subnet_route': u'10.1.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.2.1.2'}]}, {u'mem': 2, u'name': u't1_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM1if1'}]) => {"ansible_loop_var": "item", "changed": true, "created": "t1_VM1", "item": [{"bridge_name": "t1br1", "default_route_ip": "10.1.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.1.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.1.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.1.1.2/24"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.1.2", "remote_ip": "10.2.1.2", "remote_route": "10.2.1.0/24", "subnet_route": "10.1.1.0/24", "tenant_route_ip": "192.168.1.2", "v_name": "vxlan_t1s1"}]}, {"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM1", "vcpu": 4, "vmif": "t1VM1if1"}], "warnings": ["'xml' is given - ignoring 'name'"]}
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.1.2/24', u'tenant_ns_ip': u'10.1.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.1.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.1.2', u'remote_route': u'10.2.1.0/24', u'subnet_route': u'10.1.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.2.1.2'}]}, {u'mem': 4, u'name': u't1_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br1if2', u'vmif': u't1VM2if1'}]) => {"ansible_loop_var": "item", "changed": true, "created": "t1_VM2", "item": [{"bridge_name": "t1br1", "default_route_ip": "10.1.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.1.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.1.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.1.1.2/24"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.1.2", "remote_ip": "10.2.1.2", "remote_route": "10.2.1.0/24", "subnet_route": "10.1.1.0/24", "tenant_route_ip": "192.168.1.2", "v_name": "vxlan_t1s1"}]}, {"brif": "t1br1if2", "disk": "10G", "mem": 4, "name": "t1_VM2", "vcpu": 2, "vmif": "t1VM2if1"}], "warnings": ["'xml' is given - ignoring 'name'"]}
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.2.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.2.1', u'bridge_name': u't1br2', u'dns': [{u'dnsif': u't1s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s2_dnsbrif'}], u'ns_name': u't1ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.2.2/24', u'tenant_ns_ip': u'10.1.2.1/24', u'tenant_ns_if': u't1ns2if', u'tenant_sub_if': u't1s2if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'2.2.2.0/24', u'vxlan': [{u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}, {u'mem': 3, u'name': u't1_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br2if1', u'vmif': u't1VM3if1'}]) => {"ansible_loop_var": "item", "changed": true, "created": "t1_VM3", "item": [{"bridge_name": "t1br2", "default_route_ip": "10.1.2.1", "dns": [{"brif": "t1s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t1s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns2", "route": [{"if": "p1", "ip": "10.1.2.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "2.2.2.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns2if", "tenant_ns_ip": "10.1.2.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s2if", "tenant_sub_ip": "10.1.2.2/24"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, {"brif": "t1br2if1", "disk": "10G", "mem": 3, "name": "t1_VM3", "vcpu": 2, "vmif": "t1VM3if1"}], "warnings": ["'xml' is given - ignoring 'name'"]}

TASK [Create VM] ********************************************************************************************************************************************
ok: [localhost] => (item=[{u'route': [{u'ip': u'10.1.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.1.2/24', u'tenant_ns_ip': u'10.1.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.1.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.1.2', u'remote_route': u'10.2.1.0/24', u'subnet_route': u'10.1.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.2.1.2'}]}, {u'mem': 2, u'name': u't1_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM1if1'}]) => {"ansible_loop_var": "item", "changed": false, "create": 0, "item": [{"bridge_name": "t1br1", "default_route_ip": "10.1.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.1.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.1.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.1.1.2/24"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.1.2", "remote_ip": "10.2.1.2", "remote_route": "10.2.1.0/24", "subnet_route": "10.1.1.0/24", "tenant_route_ip": "192.168.1.2", "v_name": "vxlan_t1s1"}]}, {"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM1", "vcpu": 4, "vmif": "t1VM1if1"}]}
ok: [localhost] => (item=[{u'route': [{u'ip': u'10.1.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.1.2/24', u'tenant_ns_ip': u'10.1.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.1.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.1.2', u'remote_route': u'10.2.1.0/24', u'subnet_route': u'10.1.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.2.1.2'}]}, {u'mem': 4, u'name': u't1_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br1if2', u'vmif': u't1VM2if1'}]) => {"ansible_loop_var": "item", "changed": false, "create": 0, "item": [{"bridge_name": "t1br1", "default_route_ip": "10.1.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.1.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.1.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.1.1.2/24"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.1.2", "remote_ip": "10.2.1.2", "remote_route": "10.2.1.0/24", "subnet_route": "10.1.1.0/24", "tenant_route_ip": "192.168.1.2", "v_name": "vxlan_t1s1"}]}, {"brif": "t1br1if2", "disk": "10G", "mem": 4, "name": "t1_VM2", "vcpu": 2, "vmif": "t1VM2if1"}]}
ok: [localhost] => (item=[{u'route': [{u'ip': u'10.1.2.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.2.1', u'bridge_name': u't1br2', u'dns': [{u'dnsif': u't1s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s2_dnsbrif'}], u'ns_name': u't1ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.2.2/24', u'tenant_ns_ip': u'10.1.2.1/24', u'tenant_ns_if': u't1ns2if', u'tenant_sub_if': u't1s2if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'2.2.2.0/24', u'vxlan': [{u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}, {u'mem': 3, u'name': u't1_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br2if1', u'vmif': u't1VM3if1'}]) => {"ansible_loop_var": "item", "changed": false, "create": 0, "item": [{"bridge_name": "t1br2", "default_route_ip": "10.1.2.1", "dns": [{"brif": "t1s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t1s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns2", "route": [{"if": "p1", "ip": "10.1.2.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "2.2.2.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns2if", "tenant_ns_ip": "10.1.2.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s2if", "tenant_sub_ip": "10.1.2.2/24"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, {"brif": "t1br2if1", "disk": "10G", "mem": 3, "name": "t1_VM3", "vcpu": 2, "vmif": "t1VM3if1"}]}

TASK [Start VM] *********************************************************************************************************************************************
ok: [localhost] => (item=[{u'route': [{u'ip': u'10.1.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.1.2/24', u'tenant_ns_ip': u'10.1.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.1.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.1.2', u'remote_route': u'10.2.1.0/24', u'subnet_route': u'10.1.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.2.1.2'}]}, {u'mem': 2, u'name': u't1_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM1if1'}]) => {"ansible_loop_var": "item", "changed": false, "item": [{"bridge_name": "t1br1", "default_route_ip": "10.1.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.1.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.1.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.1.1.2/24"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.1.2", "remote_ip": "10.2.1.2", "remote_route": "10.2.1.0/24", "subnet_route": "10.1.1.0/24", "tenant_route_ip": "192.168.1.2", "v_name": "vxlan_t1s1"}]}, {"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM1", "vcpu": 4, "vmif": "t1VM1if1"}]}
ok: [localhost] => (item=[{u'route': [{u'ip': u'10.1.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.1.2/24', u'tenant_ns_ip': u'10.1.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.1.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.1.2', u'remote_route': u'10.2.1.0/24', u'subnet_route': u'10.1.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.2.1.2'}]}, {u'mem': 4, u'name': u't1_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br1if2', u'vmif': u't1VM2if1'}]) => {"ansible_loop_var": "item", "changed": false, "item": [{"bridge_name": "t1br1", "default_route_ip": "10.1.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.1.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.1.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.1.1.2/24"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.1.2", "remote_ip": "10.2.1.2", "remote_route": "10.2.1.0/24", "subnet_route": "10.1.1.0/24", "tenant_route_ip": "192.168.1.2", "v_name": "vxlan_t1s1"}]}, {"brif": "t1br1if2", "disk": "10G", "mem": 4, "name": "t1_VM2", "vcpu": 2, "vmif": "t1VM2if1"}]}
ok: [localhost] => (item=[{u'route': [{u'ip': u'10.1.2.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.2.1', u'bridge_name': u't1br2', u'dns': [{u'dnsif': u't1s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s2_dnsbrif'}], u'ns_name': u't1ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.2.2/24', u'tenant_ns_ip': u'10.1.2.1/24', u'tenant_ns_if': u't1ns2if', u'tenant_sub_if': u't1s2if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'2.2.2.0/24', u'vxlan': [{u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}, {u'mem': 3, u'name': u't1_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br2if1', u'vmif': u't1VM3if1'}]) => {"ansible_loop_var": "item", "changed": false, "item": [{"bridge_name": "t1br2", "default_route_ip": "10.1.2.1", "dns": [{"brif": "t1s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t1s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns2", "route": [{"if": "p1", "ip": "10.1.2.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "2.2.2.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns2if", "tenant_ns_ip": "10.1.2.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s2if", "tenant_sub_ip": "10.1.2.2/24"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, {"brif": "t1br2if1", "disk": "10G", "mem": 3, "name": "t1_VM3", "vcpu": 2, "vmif": "t1VM3if1"}]}

TASK [Attach VM interface] **********************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.1.2/24', u'tenant_ns_ip': u'10.1.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.1.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.1.2', u'remote_route': u'10.2.1.0/24', u'subnet_route': u'10.1.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.2.1.2'}]}, {u'mem': 2, u'name': u't1_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM1if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "virsh domiflist \"t1_VM1\" | grep -w 't1VM1if1' ; if [ $? -ne 0 ] ; then virsh attach-interface \"t1_VM1\" direct \"t1VM1if1\" --live --persistent ; fi\n", "delta": "0:00:00.296342", "end": "2019-11-18 12:43:47.251525", "item": [{"bridge_name": "t1br1", "default_route_ip": "10.1.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.1.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.1.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.1.1.2/24"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.1.2", "remote_ip": "10.2.1.2", "remote_route": "10.2.1.0/24", "subnet_route": "10.1.1.0/24", "tenant_route_ip": "192.168.1.2", "v_name": "vxlan_t1s1"}]}, {"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM1", "vcpu": 4, "vmif": "t1VM1if1"}], "rc": 0, "start": "2019-11-18 12:43:46.955183", "stderr": "", "stderr_lines": [], "stdout": "Interface attached successfully", "stdout_lines": ["Interface attached successfully"]}
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.1.2/24', u'tenant_ns_ip': u'10.1.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.1.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.1.2', u'remote_route': u'10.2.1.0/24', u'subnet_route': u'10.1.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.2.1.2'}]}, {u'mem': 4, u'name': u't1_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br1if2', u'vmif': u't1VM2if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "virsh domiflist \"t1_VM2\" | grep -w 't1VM2if1' ; if [ $? -ne 0 ] ; then virsh attach-interface \"t1_VM2\" direct \"t1VM2if1\" --live --persistent ; fi\n", "delta": "0:00:00.218693", "end": "2019-11-18 12:43:47.632034", "item": [{"bridge_name": "t1br1", "default_route_ip": "10.1.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.1.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.1.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.1.1.2/24"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.1.2", "remote_ip": "10.2.1.2", "remote_route": "10.2.1.0/24", "subnet_route": "10.1.1.0/24", "tenant_route_ip": "192.168.1.2", "v_name": "vxlan_t1s1"}]}, {"brif": "t1br1if2", "disk": "10G", "mem": 4, "name": "t1_VM2", "vcpu": 2, "vmif": "t1VM2if1"}], "rc": 0, "start": "2019-11-18 12:43:47.413341", "stderr": "", "stderr_lines": [], "stdout": "Interface attached successfully", "stdout_lines": ["Interface attached successfully"]}
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.2.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.2.1', u'bridge_name': u't1br2', u'dns': [{u'dnsif': u't1s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s2_dnsbrif'}], u'ns_name': u't1ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.2.2/24', u'tenant_ns_ip': u'10.1.2.1/24', u'tenant_ns_if': u't1ns2if', u'tenant_sub_if': u't1s2if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'2.2.2.0/24', u'vxlan': [{u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}, {u'mem': 3, u'name': u't1_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br2if1', u'vmif': u't1VM3if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "virsh domiflist \"t1_VM3\" | grep -w 't1VM3if1' ; if [ $? -ne 0 ] ; then virsh attach-interface \"t1_VM3\" direct \"t1VM3if1\" --live --persistent ; fi\n", "delta": "0:00:00.227473", "end": "2019-11-18 12:43:48.013286", "item": [{"bridge_name": "t1br2", "default_route_ip": "10.1.2.1", "dns": [{"brif": "t1s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t1s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns2", "route": [{"if": "p1", "ip": "10.1.2.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "2.2.2.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns2if", "tenant_ns_ip": "10.1.2.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s2if", "tenant_sub_ip": "10.1.2.2/24"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, {"brif": "t1br2if1", "disk": "10G", "mem": 3, "name": "t1_VM3", "vcpu": 2, "vmif": "t1VM3if1"}], "rc": 0, "start": "2019-11-18 12:43:47.785813", "stderr": "", "stderr_lines": [], "stdout": "Interface attached successfully", "stdout_lines": ["Interface attached successfully"]}

PLAY RECAP **************************************************************************************************************************************************
localhost                  : ok=7    changed=3    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0   

Using /etc/ansible/ansible.cfg as config file

PLAY [worker] ***********************************************************************************************************************************************

TASK [Copy VM image] ****************************************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.2.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.1.2/24', u'tenant_ns_ip': u'10.2.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.2.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.129.2', u'remote_route': u'10.1.1.0/24', u'subnet_route': u'10.2.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.1.1.2'}]}, {u'mem': 2, u'name': u't1_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM4if1'}]) => {"ansible_loop_var": "item", "changed": true, "checksum": "f8b2ffa2bf201c84196c582f2dec0d33a1eb4b42", "dest": "/var/lib/libvirt/images/t1_VM4.qcow2", "gid": 0, "group": "root", "item": [{"bridge_name": "t1br1", "default_route_ip": "10.2.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.2.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.2.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.2.1.2/24"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.1.2", "remote_ip": "10.1.1.2", "remote_route": "10.1.1.0/24", "subnet_route": "10.2.1.0/24", "tenant_route_ip": "192.168.129.2", "v_name": "vxlan_t1s1"}]}, {"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM4", "vcpu": 4, "vmif": "t1VM4if1"}], "md5sum": "e6d5d524b68797ddd748ba1475985d34", "mode": "0644", "owner": "root", "size": 10739318784, "src": "/root/mainVM.qcow2", "state": "file", "uid": 0}

TASK [Get list of running VMs] ******************************************************************************************************************************
ok: [99.99.99.2] => {"changed": false, "cmd": ["virsh", "list", "--name"], "delta": "0:00:00.018397", "end": "2019-11-18 12:45:52.729967", "rc": 0, "start": "2019-11-18 12:45:52.711570", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Define VM] ********************************************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.2.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.1.2/24', u'tenant_ns_ip': u'10.2.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.2.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.129.2', u'remote_route': u'10.1.1.0/24', u'subnet_route': u'10.2.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.1.1.2'}]}, {u'mem': 2, u'name': u't1_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM4if1'}]) => {"ansible_loop_var": "item", "changed": true, "created": "t1_VM4", "item": [{"bridge_name": "t1br1", "default_route_ip": "10.2.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.2.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.2.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.2.1.2/24"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.1.2", "remote_ip": "10.1.1.2", "remote_route": "10.1.1.0/24", "subnet_route": "10.2.1.0/24", "tenant_route_ip": "192.168.129.2", "v_name": "vxlan_t1s1"}]}, {"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM4", "vcpu": 4, "vmif": "t1VM4if1"}], "warnings": ["'xml' is given - ignoring 'name'"]}

TASK [Create VM] ********************************************************************************************************************************************
ok: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.2.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.1.2/24', u'tenant_ns_ip': u'10.2.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.2.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.129.2', u'remote_route': u'10.1.1.0/24', u'subnet_route': u'10.2.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.1.1.2'}]}, {u'mem': 2, u'name': u't1_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM4if1'}]) => {"ansible_loop_var": "item", "changed": false, "create": 0, "item": [{"bridge_name": "t1br1", "default_route_ip": "10.2.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.2.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.2.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.2.1.2/24"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.1.2", "remote_ip": "10.1.1.2", "remote_route": "10.1.1.0/24", "subnet_route": "10.2.1.0/24", "tenant_route_ip": "192.168.129.2", "v_name": "vxlan_t1s1"}]}, {"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM4", "vcpu": 4, "vmif": "t1VM4if1"}]}

TASK [Start VM] *********************************************************************************************************************************************
ok: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.2.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.1.2/24', u'tenant_ns_ip': u'10.2.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.2.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.129.2', u'remote_route': u'10.1.1.0/24', u'subnet_route': u'10.2.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.1.1.2'}]}, {u'mem': 2, u'name': u't1_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM4if1'}]) => {"ansible_loop_var": "item", "changed": false, "item": [{"bridge_name": "t1br1", "default_route_ip": "10.2.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.2.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.2.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.2.1.2/24"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.1.2", "remote_ip": "10.1.1.2", "remote_route": "10.1.1.0/24", "subnet_route": "10.2.1.0/24", "tenant_route_ip": "192.168.129.2", "v_name": "vxlan_t1s1"}]}, {"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM4", "vcpu": 4, "vmif": "t1VM4if1"}]}

TASK [Attach VM interface] **********************************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.2.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.1.2/24', u'tenant_ns_ip': u'10.2.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}], u'subnet_ip': u'1.1.1.0/24', u'vxlan': [{u'local_ip': u'10.2.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.129.2', u'remote_route': u'10.1.1.0/24', u'subnet_route': u'10.2.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.1.1.2'}]}, {u'mem': 2, u'name': u't1_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM4if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "virsh domiflist \"t1_VM4\" | grep -w 't1VM4if1' ; if [ $? -ne 0 ] ; then virsh attach-interface \"t1_VM4\" direct \"t1VM4if1\" --live --persistent ; fi\n", "delta": "0:00:00.260822", "end": "2019-11-18 12:45:58.884128", "item": [{"bridge_name": "t1br1", "default_route_ip": "10.2.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.2.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "subnet_ip": "1.1.1.0/24", "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.2.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.2.1.2/24"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.1.2", "remote_ip": "10.1.1.2", "remote_route": "10.1.1.0/24", "subnet_route": "10.2.1.0/24", "tenant_route_ip": "192.168.129.2", "v_name": "vxlan_t1s1"}]}, {"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM4", "vcpu": 4, "vmif": "t1VM4if1"}], "rc": 0, "start": "2019-11-18 12:45:58.623306", "stderr": "", "stderr_lines": [], "stdout": "Interface attached successfully", "stdout_lines": ["Interface attached successfully"]}

PLAY RECAP **************************************************************************************************************************************************
99.99.99.2                 : ok=6    changed=3    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0   

INFO:root: 12:46:43.278909 The subnet 1.1.1.0/24 is present in Cloud 1
INFO:root: 12:46:43.279012 The subnet 1.1.1.0/24 is present in Cloud 2
INFO:root: 12:46:43.279070 The VM VM1 is present in Cloud 1
INFO:root: 12:46:43.279102 The VM VM4 is present in Cloud 2
INFO:root: 12:46:43.279147 The subnet 1.1.1.0/24 is present in destination cloud
INFO:root: 12:46:43.279182 The subnet 1.1.1.0/24 is present in destination cloud
INFO:root: 12:46:43.461372 source cloud is C1
INFO:root: 12:46:43.462741 source cloud is C2
INFO:paramiko.transport:Connected (version 2.0, client OpenSSH_7.6p1)
INFO:paramiko.transport:Authentication (publickey) successful!
