Using /etc/ansible/ansible.cfg as config file

PLAY [worker] ***********************************************************************************************************************************************

TASK [Copy VM image] ****************************************************************************************************************************************
ok: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.11.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.2.11.1', u'bridge_name': u't2br1', u'dns': [{u'dnsif': u't2s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't2s1_dnsbrif'}], u'ns_name': u't2ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.11.2/24', u'tenant_ns_ip': u'10.2.11.1/24', u'tenant_ns_if': u't2s1if', u'tenant_sub_if': u's1if', u'tenant_ns_name': u't2'}], u'bridge_ip': u'1.1.1.1', u'vxlan': [{u'local_ip': u'10.2.11.2', u'dsport': 4789, u'dev': u's1if', u'tenant_route_ip': u'192.168.130.2', u'remote_route': u'10.1.11.0/24', u'subnet_route': u'10.2.11.0/24', u'v_name': u'vxlan_t2s1', u'id': 42, u'remote_ip': u'10.1.11.2'}]}, {u'mem': 2, u'name': u't2_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't2br1if1', u'vmif': u't2VM4if1'}]) => {"ansible_loop_var": "item", "changed": false, "dest": "/var/lib/libvirt/images/t2_VM4.qcow2", "gid": 0, "group": "root", "item": [{"bridge_ip": "1.1.1.1", "bridge_name": "t2br1", "default_route_ip": "10.2.11.1", "dns": [{"brif": "t2s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t2s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns1", "route": [{"if": "p1", "ip": "10.2.11.1/24", "ns_if": "t2if", "ns_name": "t2"}], "tenant_ns": [{"tenant_ns_if": "t2s1if", "tenant_ns_ip": "10.2.11.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "s1if", "tenant_sub_ip": "10.2.11.2/24"}], "vxlan": [{"dev": "s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.11.2", "remote_ip": "10.1.11.2", "remote_route": "10.1.11.0/24", "subnet_route": "10.2.11.0/24", "tenant_route_ip": "192.168.130.2", "v_name": "vxlan_t2s1"}]}, {"brif": "t2br1if1", "disk": "10G", "mem": 2, "name": "t2_VM4", "vcpu": 4, "vmif": "t2VM4if1"}], "mode": "0644", "msg": "file already exists", "owner": "root", "size": 10739318784, "src": "/root/mainVM.qcow2", "state": "file", "uid": 0}

TASK [Get list of running VMs] ******************************************************************************************************************************
ok: [99.99.99.2] => {"changed": false, "cmd": ["virsh", "list", "--name"], "delta": "0:00:00.020988", "end": "2019-11-17 08:45:02.066643", "rc": 0, "start": "2019-11-17 08:45:02.045655", "stderr": "", "stderr_lines": [], "stdout": "Test\nVM2\nt1_VM4", "stdout_lines": ["Test", "VM2", "t1_VM4"]}

TASK [Define VM] ********************************************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.11.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.2.11.1', u'bridge_name': u't2br1', u'dns': [{u'dnsif': u't2s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't2s1_dnsbrif'}], u'ns_name': u't2ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.11.2/24', u'tenant_ns_ip': u'10.2.11.1/24', u'tenant_ns_if': u't2s1if', u'tenant_sub_if': u's1if', u'tenant_ns_name': u't2'}], u'bridge_ip': u'1.1.1.1', u'vxlan': [{u'local_ip': u'10.2.11.2', u'dsport': 4789, u'dev': u's1if', u'tenant_route_ip': u'192.168.130.2', u'remote_route': u'10.1.11.0/24', u'subnet_route': u'10.2.11.0/24', u'v_name': u'vxlan_t2s1', u'id': 42, u'remote_ip': u'10.1.11.2'}]}, {u'mem': 2, u'name': u't2_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't2br1if1', u'vmif': u't2VM4if1'}]) => {"ansible_loop_var": "item", "changed": true, "created": "t2_VM4", "item": [{"bridge_ip": "1.1.1.1", "bridge_name": "t2br1", "default_route_ip": "10.2.11.1", "dns": [{"brif": "t2s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t2s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns1", "route": [{"if": "p1", "ip": "10.2.11.1/24", "ns_if": "t2if", "ns_name": "t2"}], "tenant_ns": [{"tenant_ns_if": "t2s1if", "tenant_ns_ip": "10.2.11.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "s1if", "tenant_sub_ip": "10.2.11.2/24"}], "vxlan": [{"dev": "s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.11.2", "remote_ip": "10.1.11.2", "remote_route": "10.1.11.0/24", "subnet_route": "10.2.11.0/24", "tenant_route_ip": "192.168.130.2", "v_name": "vxlan_t2s1"}]}, {"brif": "t2br1if1", "disk": "10G", "mem": 2, "name": "t2_VM4", "vcpu": 4, "vmif": "t2VM4if1"}], "warnings": ["'xml' is given - ignoring 'name'"]}

TASK [Create VM] ********************************************************************************************************************************************
ok: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.11.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.2.11.1', u'bridge_name': u't2br1', u'dns': [{u'dnsif': u't2s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't2s1_dnsbrif'}], u'ns_name': u't2ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.11.2/24', u'tenant_ns_ip': u'10.2.11.1/24', u'tenant_ns_if': u't2s1if', u'tenant_sub_if': u's1if', u'tenant_ns_name': u't2'}], u'bridge_ip': u'1.1.1.1', u'vxlan': [{u'local_ip': u'10.2.11.2', u'dsport': 4789, u'dev': u's1if', u'tenant_route_ip': u'192.168.130.2', u'remote_route': u'10.1.11.0/24', u'subnet_route': u'10.2.11.0/24', u'v_name': u'vxlan_t2s1', u'id': 42, u'remote_ip': u'10.1.11.2'}]}, {u'mem': 2, u'name': u't2_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't2br1if1', u'vmif': u't2VM4if1'}]) => {"ansible_loop_var": "item", "changed": false, "create": 0, "item": [{"bridge_ip": "1.1.1.1", "bridge_name": "t2br1", "default_route_ip": "10.2.11.1", "dns": [{"brif": "t2s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t2s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns1", "route": [{"if": "p1", "ip": "10.2.11.1/24", "ns_if": "t2if", "ns_name": "t2"}], "tenant_ns": [{"tenant_ns_if": "t2s1if", "tenant_ns_ip": "10.2.11.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "s1if", "tenant_sub_ip": "10.2.11.2/24"}], "vxlan": [{"dev": "s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.11.2", "remote_ip": "10.1.11.2", "remote_route": "10.1.11.0/24", "subnet_route": "10.2.11.0/24", "tenant_route_ip": "192.168.130.2", "v_name": "vxlan_t2s1"}]}, {"brif": "t2br1if1", "disk": "10G", "mem": 2, "name": "t2_VM4", "vcpu": 4, "vmif": "t2VM4if1"}]}

TASK [Start VM] *********************************************************************************************************************************************
ok: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.11.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.2.11.1', u'bridge_name': u't2br1', u'dns': [{u'dnsif': u't2s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't2s1_dnsbrif'}], u'ns_name': u't2ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.11.2/24', u'tenant_ns_ip': u'10.2.11.1/24', u'tenant_ns_if': u't2s1if', u'tenant_sub_if': u's1if', u'tenant_ns_name': u't2'}], u'bridge_ip': u'1.1.1.1', u'vxlan': [{u'local_ip': u'10.2.11.2', u'dsport': 4789, u'dev': u's1if', u'tenant_route_ip': u'192.168.130.2', u'remote_route': u'10.1.11.0/24', u'subnet_route': u'10.2.11.0/24', u'v_name': u'vxlan_t2s1', u'id': 42, u'remote_ip': u'10.1.11.2'}]}, {u'mem': 2, u'name': u't2_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't2br1if1', u'vmif': u't2VM4if1'}]) => {"ansible_loop_var": "item", "changed": false, "item": [{"bridge_ip": "1.1.1.1", "bridge_name": "t2br1", "default_route_ip": "10.2.11.1", "dns": [{"brif": "t2s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t2s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns1", "route": [{"if": "p1", "ip": "10.2.11.1/24", "ns_if": "t2if", "ns_name": "t2"}], "tenant_ns": [{"tenant_ns_if": "t2s1if", "tenant_ns_ip": "10.2.11.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "s1if", "tenant_sub_ip": "10.2.11.2/24"}], "vxlan": [{"dev": "s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.11.2", "remote_ip": "10.1.11.2", "remote_route": "10.1.11.0/24", "subnet_route": "10.2.11.0/24", "tenant_route_ip": "192.168.130.2", "v_name": "vxlan_t2s1"}]}, {"brif": "t2br1if1", "disk": "10G", "mem": 2, "name": "t2_VM4", "vcpu": 4, "vmif": "t2VM4if1"}]}

TASK [Attach VM interface] **********************************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.11.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.2.11.1', u'bridge_name': u't2br1', u'dns': [{u'dnsif': u't2s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't2s1_dnsbrif'}], u'ns_name': u't2ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.11.2/24', u'tenant_ns_ip': u'10.2.11.1/24', u'tenant_ns_if': u't2s1if', u'tenant_sub_if': u's1if', u'tenant_ns_name': u't2'}], u'bridge_ip': u'1.1.1.1', u'vxlan': [{u'local_ip': u'10.2.11.2', u'dsport': 4789, u'dev': u's1if', u'tenant_route_ip': u'192.168.130.2', u'remote_route': u'10.1.11.0/24', u'subnet_route': u'10.2.11.0/24', u'v_name': u'vxlan_t2s1', u'id': 42, u'remote_ip': u'10.1.11.2'}]}, {u'mem': 2, u'name': u't2_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't2br1if1', u'vmif': u't2VM4if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "virsh domiflist \"t2_VM4\" | grep -w 't2VM4if1' ; if [ $? -ne 0 ] ; then virsh attach-interface \"t2_VM4\" direct \"t2VM4if1\" --live --persistent ; fi\n", "delta": "0:00:00.272161", "end": "2019-11-17 08:45:04.776674", "item": [{"bridge_ip": "1.1.1.1", "bridge_name": "t2br1", "default_route_ip": "10.2.11.1", "dns": [{"brif": "t2s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t2s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns1", "route": [{"if": "p1", "ip": "10.2.11.1/24", "ns_if": "t2if", "ns_name": "t2"}], "tenant_ns": [{"tenant_ns_if": "t2s1if", "tenant_ns_ip": "10.2.11.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "s1if", "tenant_sub_ip": "10.2.11.2/24"}], "vxlan": [{"dev": "s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.11.2", "remote_ip": "10.1.11.2", "remote_route": "10.1.11.0/24", "subnet_route": "10.2.11.0/24", "tenant_route_ip": "192.168.130.2", "v_name": "vxlan_t2s1"}]}, {"brif": "t2br1if1", "disk": "10G", "mem": 2, "name": "t2_VM4", "vcpu": 4, "vmif": "t2VM4if1"}], "rc": 0, "start": "2019-11-17 08:45:04.504513", "stderr": "", "stderr_lines": [], "stdout": "Interface attached successfully", "stdout_lines": ["Interface attached successfully"]}

PLAY RECAP **************************************************************************************************************************************************
99.99.99.2                 : ok=6    changed=2    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0   

INFO:root: 08:49:48.367310 {'C1': [{'subnet_addr': '1.1.1.0/24', 'VM': [{'name': 'VM1', 'disk': '10G', 'mem': 2, 'vcpu': 4}, {'name': 'VM2', 'disk': '10G', 'mem': 4, 'vcpu': 2}]}, {'subnet_addr': '2.2.2.0/24', 'VM': [{'name': 'VM3', 'disk': '10G', 'mem': 3, 'vcpu': 2}]}], 'C2': [{'subnet_addr': '1.1.1.0/24', 'VM': [{'name': 'VM4', 'disk': '10G', 'mem': 2, 'vcpu': 4}]}]}
INFO:root: 08:49:48.367584 Provided subnet in C1: 1.1.1.0/24 is valid
ERROR:root: 08:49:48.367666ERR: Multiple subnet in the C1 are same
Using /etc/ansible/ansible.cfg as config file

PLAY [main] *************************************************************************************************************************************************

TASK [Create Tenant Namespace] ******************************************************************************************************************************
changed: [localhost] => (item={u'default_route_ip': u'192.168.3.1', u'name': u't3', u'pns_ip': u'192.168.3.1/24', u'tenant_if': u't3if', u'tenant_ip': u'192.168.3.2/24', u'pns_if': u't3pns_if'}) => {"ansible_loop_var": "item", "changed": true, "cmd": ["ip", "netns", "add", "t3"], "delta": "0:00:00.062008", "end": "2019-11-17 08:49:49.517211", "item": {"default_route_ip": "192.168.3.1", "name": "t3", "pns_if": "t3pns_if", "pns_ip": "192.168.3.1/24", "tenant_if": "t3if", "tenant_ip": "192.168.3.2/24"}, "rc": 0, "start": "2019-11-17 08:49:49.455203", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Create Subnet Namespace] ******************************************************************************************************************************
changed: [localhost] => (item={u'route': [{u'ip': u'10.1.21.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.1.21.1', u'bridge_name': u't3br1', u'dns': [{u'dnsif': u't3s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't3s1_dnsbrif'}], u'ns_name': u't3ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.21.2/24', u'tenant_ns_ip': u'10.1.21.1/24', u'tenant_ns_if': u't3s1if', u'tenant_ns_name': u't3', u'tenant_sub_if': u's1if'}], u'bridge_ip': u'1.1.1.1', u'vms': [{u'mem': 2, u'name': u't3_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't3br1if1', u'vmif': u't3VM1if1'}, {u'mem': 4, u'name': u't3_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't3br1if2', u'vmif': u't3VM2if1'}], u'vxlan': [{u'local_ip': u'10.1.21.2', u'tenant_route_ip': u'192.168.3.2', u'dsport': 4789, u'dev': u's1if', u'subnet_route': u'10.1.21.0/24', u'remote_route': u'10.2.21.0/24', u'v_name': u'vxlan_t3s1', u'id': 42, u'remote_ip': u'10.2.21.2'}]}) => {"ansible_loop_var": "item", "changed": true, "cmd": ["ip", "netns", "add", "t3ns1"], "delta": "0:00:00.050679", "end": "2019-11-17 08:49:49.848929", "item": {"bridge_ip": "1.1.1.1", "bridge_name": "t3br1", "default_route_ip": "10.1.21.1", "dns": [{"brif": "t3s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t3s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t3ns1", "route": [{"if": "p1", "ip": "10.1.21.1/24", "ns_if": "t3if", "ns_name": "t3"}], "tenant_ns": [{"tenant_ns_if": "t3s1if", "tenant_ns_ip": "10.1.21.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "s1if", "tenant_sub_ip": "10.1.21.2/24"}], "vms": [{"brif": "t3br1if1", "disk": "10G", "mem": 2, "name": "t3_VM1", "vcpu": 4, "vmif": "t3VM1if1"}, {"brif": "t3br1if2", "disk": "10G", "mem": 4, "name": "t3_VM2", "vcpu": 2, "vmif": "t3VM2if1"}], "vxlan": [{"dev": "s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.21.2", "remote_ip": "10.2.21.2", "remote_route": "10.2.21.0/24", "subnet_route": "10.1.21.0/24", "tenant_route_ip": "192.168.3.2", "v_name": "vxlan_t3s1"}]}, "rc": 0, "start": "2019-11-17 08:49:49.798250", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}
changed: [localhost] => (item={u'route': [{u'ip': u'10.1.22.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.1.22.1', u'bridge_name': u't3br2', u'dns': [{u'dnsif': u't3s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't3s2_dnsbrif'}], u'ns_name': u't3ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.22.2/24', u'tenant_ns_ip': u'10.1.22.1/24', u'tenant_ns_if': u't3s2if', u'tenant_ns_name': u't3', u'tenant_sub_if': u's2if'}], u'bridge_ip': u'2.2.2.1', u'vms': [{u'mem': 3, u'name': u't3_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't3br2if1', u'vmif': u't3VM3if1'}], u'vxlan': [{u'local_ip': [], u'tenant_route_ip': [], u'dsport': [], u'dev': [], u'subnet_route': [], u'remote_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}) => {"ansible_loop_var": "item", "changed": true, "cmd": ["ip", "netns", "add", "t3ns2"], "delta": "0:00:00.069014", "end": "2019-11-17 08:49:50.142512", "item": {"bridge_ip": "2.2.2.1", "bridge_name": "t3br2", "default_route_ip": "10.1.22.1", "dns": [{"brif": "t3s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t3s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t3ns2", "route": [{"if": "p1", "ip": "10.1.22.1/24", "ns_if": "t3if", "ns_name": "t3"}], "tenant_ns": [{"tenant_ns_if": "t3s2if", "tenant_ns_ip": "10.1.22.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "s2if", "tenant_sub_ip": "10.1.22.2/24"}], "vms": [{"brif": "t3br2if1", "disk": "10G", "mem": 3, "name": "t3_VM3", "vcpu": 2, "vmif": "t3VM3if1"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, "rc": 0, "start": "2019-11-17 08:49:50.073498", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Create Tenant VETH pairs] *****************************************************************************************************************************
changed: [localhost] => (item={u'default_route_ip': u'192.168.3.1', u'name': u't3', u'pns_ip': u'192.168.3.1/24', u'tenant_if': u't3if', u'tenant_ip': u'192.168.3.2/24', u'pns_if': u't3pns_if'}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip link show \"t3if\" ; if [ $? -ne 0 ] ; then ip link add \"t3if\" type veth peer name \"t3pns_if\" ; fi\n", "delta": "0:00:00.013840", "end": "2019-11-17 08:49:50.444174", "item": {"default_route_ip": "192.168.3.1", "name": "t3", "pns_if": "t3pns_if", "pns_ip": "192.168.3.1/24", "tenant_if": "t3if", "tenant_ip": "192.168.3.2/24"}, "rc": 0, "start": "2019-11-17 08:49:50.430334", "stderr": "Device \"t3if\" does not exist.", "stderr_lines": ["Device \"t3if\" does not exist."], "stdout": "", "stdout_lines": []}

TASK [Attach Tenant VETH Pairs] *****************************************************************************************************************************
changed: [localhost] => (item={u'default_route_ip': u'192.168.3.1', u'name': u't3', u'pns_ip': u'192.168.3.1/24', u'tenant_if': u't3if', u'tenant_ip': u'192.168.3.2/24', u'pns_if': u't3pns_if'}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec pns ip link show \"t3pns_if\" ; if [ $? -ne 0 ] ; then ip link set \"t3pns_if\" netns pns ; fi\nip netns exec \"t3\" ip link show \"t3if\" ; if [ $? -ne 0 ] ; then ip link set \"t3if\" netns \"t3\" ; fi\nip netns exec pns ip link set dev \"t3pns_if\" up\nip netns exec \"t3\" ip link set dev \"t3if\" up\n", "delta": "0:00:00.218347", "end": "2019-11-17 08:49:50.952475", "item": {"default_route_ip": "192.168.3.1", "name": "t3", "pns_if": "t3pns_if", "pns_ip": "192.168.3.1/24", "tenant_if": "t3if", "tenant_ip": "192.168.3.2/24"}, "rc": 0, "start": "2019-11-17 08:49:50.734128", "stderr": "Device \"t3pns_if\" does not exist.\nDevice \"t3if\" does not exist.", "stderr_lines": ["Device \"t3pns_if\" does not exist.", "Device \"t3if\" does not exist."], "stdout": "", "stdout_lines": []}

TASK [Add IP addresses to Tenant VETH Pairs] ****************************************************************************************************************
changed: [localhost] => (item={u'default_route_ip': u'192.168.3.1', u'name': u't3', u'pns_ip': u'192.168.3.1/24', u'tenant_if': u't3if', u'tenant_ip': u'192.168.3.2/24', u'pns_if': u't3pns_if'}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec pns ip addr show \"t3pns_if\" | awk 'FNR==3{ print $2 }' | grep -w '^192.168.3.1/24' ; if [ $? -ne 0 ] ; then ip netns exec pns ip addr add \"192.168.3.1/24\" dev \"t3pns_if\" ; fi\nip netns exec \"t3\" ip addr show \"t3if\" | awk 'FNR==3{ print $2 }' | grep -w '^192.168.3.2/24' ; if [ $? -ne 0 ] ; then ip netns exec \"t3\" ip addr add \"192.168.3.2/24\" dev \"t3if\" ; fi\n", "delta": "0:00:00.146209", "end": "2019-11-17 08:49:51.380363", "item": {"default_route_ip": "192.168.3.1", "name": "t3", "pns_if": "t3pns_if", "pns_ip": "192.168.3.1/24", "tenant_if": "t3if", "tenant_ip": "192.168.3.2/24"}, "rc": 0, "start": "2019-11-17 08:49:51.234154", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Create Namespace VETH Pairs] **************************************************************************************************************************
failed: [localhost] (item=[{u'route': [{u'ip': u'10.1.21.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.1.21.1', u'bridge_name': u't3br1', u'dns': [{u'dnsif': u't3s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't3s1_dnsbrif'}], u'ns_name': u't3ns1', u'bridge_ip': u'1.1.1.1', u'vms': [{u'mem': 2, u'name': u't3_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't3br1if1', u'vmif': u't3VM1if1'}, {u'mem': 4, u'name': u't3_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't3br1if2', u'vmif': u't3VM2if1'}], u'vxlan': [{u'local_ip': u'10.1.21.2', u'dsport': 4789, u'dev': u's1if', u'tenant_route_ip': u'192.168.3.2', u'remote_route': u'10.2.21.0/24', u'subnet_route': u'10.1.21.0/24', u'v_name': u'vxlan_t3s1', u'id': 42, u'remote_ip': u'10.2.21.2'}]}, {u'tenant_sub_ip': u'10.1.21.2/24', u'tenant_ns_ip': u'10.1.21.1/24', u'tenant_ns_if': u't3s1if', u'tenant_sub_if': u's1if', u'tenant_ns_name': u't3'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip link show \"t3s1if\" ; if [ $? -ne 0 ] ; then ip link add \"t3s1if\" type veth peer name \"s1if\" ; fi\n", "delta": "0:00:00.008255", "end": "2019-11-17 08:49:51.656106", "item": [{"bridge_ip": "1.1.1.1", "bridge_name": "t3br1", "default_route_ip": "10.1.21.1", "dns": [{"brif": "t3s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t3s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t3ns1", "route": [{"if": "p1", "ip": "10.1.21.1/24", "ns_if": "t3if", "ns_name": "t3"}], "vms": [{"brif": "t3br1if1", "disk": "10G", "mem": 2, "name": "t3_VM1", "vcpu": 4, "vmif": "t3VM1if1"}, {"brif": "t3br1if2", "disk": "10G", "mem": 4, "name": "t3_VM2", "vcpu": 2, "vmif": "t3VM2if1"}], "vxlan": [{"dev": "s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.21.2", "remote_ip": "10.2.21.2", "remote_route": "10.2.21.0/24", "subnet_route": "10.1.21.0/24", "tenant_route_ip": "192.168.3.2", "v_name": "vxlan_t3s1"}]}, {"tenant_ns_if": "t3s1if", "tenant_ns_ip": "10.1.21.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "s1if", "tenant_sub_ip": "10.1.21.2/24"}], "msg": "non-zero return code", "rc": 2, "start": "2019-11-17 08:49:51.647851", "stderr": "Device \"t3s1if\" does not exist.\nRTNETLINK answers: File exists", "stderr_lines": ["Device \"t3s1if\" does not exist.", "RTNETLINK answers: File exists"], "stdout": "", "stdout_lines": []}
failed: [localhost] (item=[{u'route': [{u'ip': u'10.1.22.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.1.22.1', u'bridge_name': u't3br2', u'dns': [{u'dnsif': u't3s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't3s2_dnsbrif'}], u'ns_name': u't3ns2', u'bridge_ip': u'2.2.2.1', u'vms': [{u'mem': 3, u'name': u't3_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't3br2if1', u'vmif': u't3VM3if1'}], u'vxlan': [{u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}, {u'tenant_sub_ip': u'10.1.22.2/24', u'tenant_ns_ip': u'10.1.22.1/24', u'tenant_ns_if': u't3s2if', u'tenant_sub_if': u's2if', u'tenant_ns_name': u't3'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip link show \"t3s2if\" ; if [ $? -ne 0 ] ; then ip link add \"t3s2if\" type veth peer name \"s2if\" ; fi\n", "delta": "0:00:00.009129", "end": "2019-11-17 08:49:51.864094", "item": [{"bridge_ip": "2.2.2.1", "bridge_name": "t3br2", "default_route_ip": "10.1.22.1", "dns": [{"brif": "t3s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t3s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t3ns2", "route": [{"if": "p1", "ip": "10.1.22.1/24", "ns_if": "t3if", "ns_name": "t3"}], "vms": [{"brif": "t3br2if1", "disk": "10G", "mem": 3, "name": "t3_VM3", "vcpu": 2, "vmif": "t3VM3if1"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, {"tenant_ns_if": "t3s2if", "tenant_ns_ip": "10.1.22.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "s2if", "tenant_sub_ip": "10.1.22.2/24"}], "msg": "non-zero return code", "rc": 2, "start": "2019-11-17 08:49:51.854965", "stderr": "Device \"t3s2if\" does not exist.\nRTNETLINK answers: File exists", "stderr_lines": ["Device \"t3s2if\" does not exist.", "RTNETLINK answers: File exists"], "stdout": "", "stdout_lines": []}

PLAY RECAP **************************************************************************************************************************************************
localhost                  : ok=5    changed=5    unreachable=0    failed=1    skipped=0    rescued=0    ignored=0   

Using /etc/ansible/ansible.cfg as config file

PLAY [worker] ***********************************************************************************************************************************************

TASK [Create Tenant Namespace] ******************************************************************************************************************************
changed: [99.99.99.2] => (item={u'default_route_ip': u'192.168.131.1', u'name': u't3', u'pns_ip': u'192.168.131.1/24', u'tenant_if': u't3if', u'tenant_ip': u'192.168.131.2/24', u'pns_if': u't3pns_if'}) => {"ansible_loop_var": "item", "changed": true, "cmd": ["ip", "netns", "add", "t3"], "delta": "0:00:00.052749", "end": "2019-11-17 08:49:53.742111", "item": {"default_route_ip": "192.168.131.1", "name": "t3", "pns_if": "t3pns_if", "pns_ip": "192.168.131.1/24", "tenant_if": "t3if", "tenant_ip": "192.168.131.2/24"}, "rc": 0, "start": "2019-11-17 08:49:53.689362", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Create Subnet Namespace] ******************************************************************************************************************************
changed: [99.99.99.2] => (item={u'route': [{u'ip': u'10.2.21.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.2.21.1', u'bridge_name': u't3br1', u'dns': [{u'dnsif': u't3s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't3s1_dnsbrif'}], u'ns_name': u't3ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.21.2/24', u'tenant_ns_ip': u'10.2.21.1/24', u'tenant_ns_if': u't3s1if', u'tenant_ns_name': u't3', u'tenant_sub_if': u's1if'}], u'bridge_ip': u'1.1.1.1', u'vms': [{u'mem': 2, u'name': u't3_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't3br1if1', u'vmif': u't3VM4if1'}], u'vxlan': [{u'local_ip': u'10.2.21.2', u'tenant_route_ip': u'192.168.131.2', u'dsport': 4789, u'dev': u's1if', u'subnet_route': u'10.2.21.0/24', u'remote_route': u'10.1.21.0/24', u'v_name': u'vxlan_t3s1', u'id': 42, u'remote_ip': u'10.1.21.2'}]}) => {"ansible_loop_var": "item", "changed": true, "cmd": ["ip", "netns", "add", "t3ns1"], "delta": "0:00:00.054350", "end": "2019-11-17 08:49:54.225177", "item": {"bridge_ip": "1.1.1.1", "bridge_name": "t3br1", "default_route_ip": "10.2.21.1", "dns": [{"brif": "t3s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t3s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "ns_name": "t3ns1", "route": [{"if": "p1", "ip": "10.2.21.1/24", "ns_if": "t3if", "ns_name": "t3"}], "tenant_ns": [{"tenant_ns_if": "t3s1if", "tenant_ns_ip": "10.2.21.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "s1if", "tenant_sub_ip": "10.2.21.2/24"}], "vms": [{"brif": "t3br1if1", "disk": "10G", "mem": 2, "name": "t3_VM4", "vcpu": 4, "vmif": "t3VM4if1"}], "vxlan": [{"dev": "s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.21.2", "remote_ip": "10.1.21.2", "remote_route": "10.1.21.0/24", "subnet_route": "10.2.21.0/24", "tenant_route_ip": "192.168.131.2", "v_name": "vxlan_t3s1"}]}, "rc": 0, "start": "2019-11-17 08:49:54.170827", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Create Tenant VETH pairs] *****************************************************************************************************************************
changed: [99.99.99.2] => (item={u'default_route_ip': u'192.168.131.1', u'name': u't3', u'pns_ip': u'192.168.131.1/24', u'tenant_if': u't3if', u'tenant_ip': u'192.168.131.2/24', u'pns_if': u't3pns_if'}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip link show \"t3if\" ; if [ $? -ne 0 ] ; then ip link add \"t3if\" type veth peer name \"t3pns_if\" ; fi\n", "delta": "0:00:00.009866", "end": "2019-11-17 08:49:54.632602", "item": {"default_route_ip": "192.168.131.1", "name": "t3", "pns_if": "t3pns_if", "pns_ip": "192.168.131.1/24", "tenant_if": "t3if", "tenant_ip": "192.168.131.2/24"}, "rc": 0, "start": "2019-11-17 08:49:54.622736", "stderr": "Device \"t3if\" does not exist.", "stderr_lines": ["Device \"t3if\" does not exist."], "stdout": "", "stdout_lines": []}

TASK [Attach Tenant VETH Pairs] *****************************************************************************************************************************
changed: [99.99.99.2] => (item={u'default_route_ip': u'192.168.131.1', u'name': u't3', u'pns_ip': u'192.168.131.1/24', u'tenant_if': u't3if', u'tenant_ip': u'192.168.131.2/24', u'pns_if': u't3pns_if'}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec pns ip link show \"t3pns_if\" ; if [ $? -ne 0 ] ; then ip link set \"t3pns_if\" netns pns ; fi\nip netns exec \"t3\" ip link show \"t3if\" ; if [ $? -ne 0 ] ; then ip link set \"t3if\" netns \"t3\" ; fi\nip netns exec pns ip link set dev \"t3pns_if\" up\nip netns exec \"t3\" ip link set dev \"t3if\" up\n", "delta": "0:00:00.190736", "end": "2019-11-17 08:49:55.211278", "item": {"default_route_ip": "192.168.131.1", "name": "t3", "pns_if": "t3pns_if", "pns_ip": "192.168.131.1/24", "tenant_if": "t3if", "tenant_ip": "192.168.131.2/24"}, "rc": 0, "start": "2019-11-17 08:49:55.020542", "stderr": "Device \"t3pns_if\" does not exist.\nDevice \"t3if\" does not exist.", "stderr_lines": ["Device \"t3pns_if\" does not exist.", "Device \"t3if\" does not exist."], "stdout": "", "stdout_lines": []}

TASK [Add IP addresses to Tenant VETH Pairs] ****************************************************************************************************************
changed: [99.99.99.2] => (item={u'default_route_ip': u'192.168.131.1', u'name': u't3', u'pns_ip': u'192.168.131.1/24', u'tenant_if': u't3if', u'tenant_ip': u'192.168.131.2/24', u'pns_if': u't3pns_if'}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec pns ip addr show \"t3pns_if\" | awk 'FNR==3{ print $2 }' | grep -w '^192.168.131.1/24' ; if [ $? -ne 0 ] ; then ip netns exec pns ip addr add \"192.168.131.1/24\" dev \"t3pns_if\" ; fi\nip netns exec \"t3\" ip addr show \"t3if\" | awk 'FNR==3{ print $2 }' | grep -w '^192.168.131.2/24' ; if [ $? -ne 0 ] ; then ip netns exec \"t3\" ip addr add \"192.168.131.2/24\" dev \"t3if\" ; fi\n", "delta": "0:00:00.140618", "end": "2019-11-17 08:49:55.719827", "item": {"default_route_ip": "192.168.131.1", "name": "t3", "pns_if": "t3pns_if", "pns_ip": "192.168.131.1/24", "tenant_if": "t3if", "tenant_ip": "192.168.131.2/24"}, "rc": 0, "start": "2019-11-17 08:49:55.579209", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Create Namespace VETH Pairs] **************************************************************************************************************************
failed: [99.99.99.2] (item=[{u'route': [{u'ip': u'10.2.21.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.2.21.1', u'bridge_name': u't3br1', u'dns': [{u'dnsif': u't3s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't3s1_dnsbrif'}], u'ns_name': u't3ns1', u'bridge_ip': u'1.1.1.1', u'vms': [{u'mem': 2, u'name': u't3_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't3br1if1', u'vmif': u't3VM4if1'}], u'vxlan': [{u'local_ip': u'10.2.21.2', u'dsport': 4789, u'dev': u's1if', u'tenant_route_ip': u'192.168.131.2', u'remote_route': u'10.1.21.0/24', u'subnet_route': u'10.2.21.0/24', u'v_name': u'vxlan_t3s1', u'id': 42, u'remote_ip': u'10.1.21.2'}]}, {u'tenant_sub_ip': u'10.2.21.2/24', u'tenant_ns_ip': u'10.2.21.1/24', u'tenant_ns_if': u't3s1if', u'tenant_sub_if': u's1if', u'tenant_ns_name': u't3'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip link show \"t3s1if\" ; if [ $? -ne 0 ] ; then ip link add \"t3s1if\" type veth peer name \"s1if\" ; fi\n", "delta": "0:00:00.010087", "end": "2019-11-17 08:49:56.174348", "item": [{"bridge_ip": "1.1.1.1", "bridge_name": "t3br1", "default_route_ip": "10.2.21.1", "dns": [{"brif": "t3s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t3s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "ns_name": "t3ns1", "route": [{"if": "p1", "ip": "10.2.21.1/24", "ns_if": "t3if", "ns_name": "t3"}], "vms": [{"brif": "t3br1if1", "disk": "10G", "mem": 2, "name": "t3_VM4", "vcpu": 4, "vmif": "t3VM4if1"}], "vxlan": [{"dev": "s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.21.2", "remote_ip": "10.1.21.2", "remote_route": "10.1.21.0/24", "subnet_route": "10.2.21.0/24", "tenant_route_ip": "192.168.131.2", "v_name": "vxlan_t3s1"}]}, {"tenant_ns_if": "t3s1if", "tenant_ns_ip": "10.2.21.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "s1if", "tenant_sub_ip": "10.2.21.2/24"}], "msg": "non-zero return code", "rc": 2, "start": "2019-11-17 08:49:56.164261", "stderr": "Device \"t3s1if\" does not exist.\nRTNETLINK answers: File exists", "stderr_lines": ["Device \"t3s1if\" does not exist.", "RTNETLINK answers: File exists"], "stdout": "", "stdout_lines": []}

PLAY RECAP **************************************************************************************************************************************************
99.99.99.2                 : ok=5    changed=5    unreachable=0    failed=1    skipped=0    rescued=0    ignored=0   

Using /etc/ansible/ansible.cfg as config file

PLAY [main] *************************************************************************************************************************************************

TASK [Add VXLAN routes in PNS] ******************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.21.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.1.21.1', u'bridge_name': u't3br1', u'dns': [{u'dnsif': u't3s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't3s1_dnsbrif'}], u'ns_name': u't3ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.21.2/24', u'tenant_ns_ip': u'10.1.21.1/24', u'tenant_ns_if': u't3s1if', u'tenant_sub_if': u's1if', u'tenant_ns_name': u't3'}], u'bridge_ip': u'1.1.1.1', u'vms': [{u'mem': 2, u'name': u't3_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't3br1if1', u'vmif': u't3VM1if1'}, {u'mem': 4, u'name': u't3_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't3br1if2', u'vmif': u't3VM2if1'}]}, {u'local_ip': u'10.1.21.2', u'dsport': 4789, u'dev': u's1if', u'tenant_route_ip': u'192.168.3.2', u'remote_route': u'10.2.21.0/24', u'subnet_route': u'10.1.21.0/24', u'v_name': u'vxlan_t3s1', u'id': 42, u'remote_ip': u'10.2.21.2'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec pns ip route show \"10.1.21.0/24\" via \"192.168.3.2\" | grep -w '^10.1.21.0/24' ; if [ $? -ne 0 ] ; then ip netns exec pns ip route add \"10.1.21.0/24\" via \"192.168.3.2\" ; fi\n", "delta": "0:00:00.080682", "end": "2019-11-17 08:49:57.428384", "item": [{"bridge_ip": "1.1.1.1", "bridge_name": "t3br1", "default_route_ip": "10.1.21.1", "dns": [{"brif": "t3s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t3s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t3ns1", "route": [{"if": "p1", "ip": "10.1.21.1/24", "ns_if": "t3if", "ns_name": "t3"}], "tenant_ns": [{"tenant_ns_if": "t3s1if", "tenant_ns_ip": "10.1.21.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "s1if", "tenant_sub_ip": "10.1.21.2/24"}], "vms": [{"brif": "t3br1if1", "disk": "10G", "mem": 2, "name": "t3_VM1", "vcpu": 4, "vmif": "t3VM1if1"}, {"brif": "t3br1if2", "disk": "10G", "mem": 4, "name": "t3_VM2", "vcpu": 2, "vmif": "t3VM2if1"}]}, {"dev": "s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.21.2", "remote_ip": "10.2.21.2", "remote_route": "10.2.21.0/24", "subnet_route": "10.1.21.0/24", "tenant_route_ip": "192.168.3.2", "v_name": "vxlan_t3s1"}], "rc": 0, "start": "2019-11-17 08:49:57.347702", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}
skipping: [localhost] => (item=[{u'route': [{u'ip': u'10.1.22.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.1.22.1', u'bridge_name': u't3br2', u'dns': [{u'dnsif': u't3s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't3s2_dnsbrif'}], u'ns_name': u't3ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.22.2/24', u'tenant_ns_ip': u'10.1.22.1/24', u'tenant_ns_if': u't3s2if', u'tenant_sub_if': u's2if', u'tenant_ns_name': u't3'}], u'bridge_ip': u'2.2.2.1', u'vms': [{u'mem': 3, u'name': u't3_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't3br2if1', u'vmif': u't3VM3if1'}]}, {u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}])  => {"ansible_loop_var": "item", "changed": false, "item": [{"bridge_ip": "2.2.2.1", "bridge_name": "t3br2", "default_route_ip": "10.1.22.1", "dns": [{"brif": "t3s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t3s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t3ns2", "route": [{"if": "p1", "ip": "10.1.22.1/24", "ns_if": "t3if", "ns_name": "t3"}], "tenant_ns": [{"tenant_ns_if": "t3s2if", "tenant_ns_ip": "10.1.22.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "s2if", "tenant_sub_ip": "10.1.22.2/24"}], "vms": [{"brif": "t3br2if1", "disk": "10G", "mem": 3, "name": "t3_VM3", "vcpu": 2, "vmif": "t3VM3if1"}]}, {"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}], "skip_reason": "Conditional result was False"}

TASK [Get PNS ip address] ***********************************************************************************************************************************
ok: [localhost] => {"changed": false, "cmd": "ip netns exec pns ip addr show p1 | awk 'FNR==3{ print $2 }' | awk -F/ '{ print $1 }'\n", "delta": "0:00:00.041414", "end": "2019-11-17 08:49:57.736733", "rc": 0, "start": "2019-11-17 08:49:57.695319", "stderr": "", "stderr_lines": [], "stdout": "192.168.100.116", "stdout_lines": ["192.168.100.116"]}

TASK [Add VXLAN routes to host] *****************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.21.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.1.21.1', u'bridge_name': u't3br1', u'dns': [{u'dnsif': u't3s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't3s1_dnsbrif'}], u'ns_name': u't3ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.21.2/24', u'tenant_ns_ip': u'10.1.21.1/24', u'tenant_ns_if': u't3s1if', u'tenant_sub_if': u's1if', u'tenant_ns_name': u't3'}], u'bridge_ip': u'1.1.1.1', u'vms': [{u'mem': 2, u'name': u't3_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't3br1if1', u'vmif': u't3VM1if1'}, {u'mem': 4, u'name': u't3_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't3br1if2', u'vmif': u't3VM2if1'}]}, {u'local_ip': u'10.1.21.2', u'dsport': 4789, u'dev': u's1if', u'tenant_route_ip': u'192.168.3.2', u'remote_route': u'10.2.21.0/24', u'subnet_route': u'10.1.21.0/24', u'v_name': u'vxlan_t3s1', u'id': 42, u'remote_ip': u'10.2.21.2'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip route show \"10.1.21.0/24\" via \"192.168.100.116\" | grep -w '^10.1.21.0/24' ; if [ $? -ne 0 ] ; then ip route add \"10.1.21.0/24\" via \"192.168.100.116\" ; fi\nip route show \"10.2.21.0/24\" via 99.99.99.2 | grep -w '^10.2.21.0/24'; if [ $? -ne 0 ] ; then ip route add \"10.2.21.0/24\" via 99.99.99.2 ; fi\n", "delta": "0:00:00.015396", "end": "2019-11-17 08:49:58.020165", "item": [{"bridge_ip": "1.1.1.1", "bridge_name": "t3br1", "default_route_ip": "10.1.21.1", "dns": [{"brif": "t3s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t3s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t3ns1", "route": [{"if": "p1", "ip": "10.1.21.1/24", "ns_if": "t3if", "ns_name": "t3"}], "tenant_ns": [{"tenant_ns_if": "t3s1if", "tenant_ns_ip": "10.1.21.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "s1if", "tenant_sub_ip": "10.1.21.2/24"}], "vms": [{"brif": "t3br1if1", "disk": "10G", "mem": 2, "name": "t3_VM1", "vcpu": 4, "vmif": "t3VM1if1"}, {"brif": "t3br1if2", "disk": "10G", "mem": 4, "name": "t3_VM2", "vcpu": 2, "vmif": "t3VM2if1"}]}, {"dev": "s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.21.2", "remote_ip": "10.2.21.2", "remote_route": "10.2.21.0/24", "subnet_route": "10.1.21.0/24", "tenant_route_ip": "192.168.3.2", "v_name": "vxlan_t3s1"}], "rc": 0, "start": "2019-11-17 08:49:58.004769", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}
skipping: [localhost] => (item=[{u'route': [{u'ip': u'10.1.22.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.1.22.1', u'bridge_name': u't3br2', u'dns': [{u'dnsif': u't3s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't3s2_dnsbrif'}], u'ns_name': u't3ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.22.2/24', u'tenant_ns_ip': u'10.1.22.1/24', u'tenant_ns_if': u't3s2if', u'tenant_sub_if': u's2if', u'tenant_ns_name': u't3'}], u'bridge_ip': u'2.2.2.1', u'vms': [{u'mem': 3, u'name': u't3_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't3br2if1', u'vmif': u't3VM3if1'}]}, {u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}])  => {"ansible_loop_var": "item", "changed": false, "item": [{"bridge_ip": "2.2.2.1", "bridge_name": "t3br2", "default_route_ip": "10.1.22.1", "dns": [{"brif": "t3s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t3s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t3ns2", "route": [{"if": "p1", "ip": "10.1.22.1/24", "ns_if": "t3if", "ns_name": "t3"}], "tenant_ns": [{"tenant_ns_if": "t3s2if", "tenant_ns_ip": "10.1.22.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "s2if", "tenant_sub_ip": "10.1.22.2/24"}], "vms": [{"brif": "t3br2if1", "disk": "10G", "mem": 3, "name": "t3_VM3", "vcpu": 2, "vmif": "t3VM3if1"}]}, {"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}], "skip_reason": "Conditional result was False"}

PLAY RECAP **************************************************************************************************************************************************
localhost                  : ok=3    changed=2    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0   

Using /etc/ansible/ansible.cfg as config file

PLAY [worker] ***********************************************************************************************************************************************

TASK [Add VXLAN routes in PNS] ******************************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.21.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.2.21.1', u'bridge_name': u't3br1', u'dns': [{u'dnsif': u't3s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't3s1_dnsbrif'}], u'ns_name': u't3ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.21.2/24', u'tenant_ns_ip': u'10.2.21.1/24', u'tenant_ns_if': u't3s1if', u'tenant_sub_if': u's1if', u'tenant_ns_name': u't3'}], u'bridge_ip': u'1.1.1.1', u'vms': [{u'mem': 2, u'name': u't3_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't3br1if1', u'vmif': u't3VM4if1'}]}, {u'local_ip': u'10.2.21.2', u'dsport': 4789, u'dev': u's1if', u'tenant_route_ip': u'192.168.131.2', u'remote_route': u'10.1.21.0/24', u'subnet_route': u'10.2.21.0/24', u'v_name': u'vxlan_t3s1', u'id': 42, u'remote_ip': u'10.1.21.2'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec pns ip route show \"10.2.21.0/24\" via \"192.168.131.2\" | grep -w '^10.2.21.0/24' ; if [ $? -ne 0 ] ; then ip netns exec pns ip route add \"10.2.21.0/24\" via \"192.168.131.2\" ; fi\n", "delta": "0:00:00.076845", "end": "2019-11-17 08:49:59.299326", "item": [{"bridge_ip": "1.1.1.1", "bridge_name": "t3br1", "default_route_ip": "10.2.21.1", "dns": [{"brif": "t3s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t3s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "ns_name": "t3ns1", "route": [{"if": "p1", "ip": "10.2.21.1/24", "ns_if": "t3if", "ns_name": "t3"}], "tenant_ns": [{"tenant_ns_if": "t3s1if", "tenant_ns_ip": "10.2.21.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "s1if", "tenant_sub_ip": "10.2.21.2/24"}], "vms": [{"brif": "t3br1if1", "disk": "10G", "mem": 2, "name": "t3_VM4", "vcpu": 4, "vmif": "t3VM4if1"}]}, {"dev": "s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.21.2", "remote_ip": "10.1.21.2", "remote_route": "10.1.21.0/24", "subnet_route": "10.2.21.0/24", "tenant_route_ip": "192.168.131.2", "v_name": "vxlan_t3s1"}], "rc": 0, "start": "2019-11-17 08:49:59.222481", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Get PNS ip address] ***********************************************************************************************************************************
ok: [99.99.99.2] => {"changed": false, "cmd": "ip netns exec pns ip addr show p1 | awk 'FNR==3{ print $2 }' | awk -F/ '{ print $1 }'\n", "delta": "0:00:00.046002", "end": "2019-11-17 08:49:59.783771", "rc": 0, "start": "2019-11-17 08:49:59.737769", "stderr": "", "stderr_lines": [], "stdout": "192.168.100.92", "stdout_lines": ["192.168.100.92"]}

TASK [Add VXLAN routes to host] *****************************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.21.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.2.21.1', u'bridge_name': u't3br1', u'dns': [{u'dnsif': u't3s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't3s1_dnsbrif'}], u'ns_name': u't3ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.21.2/24', u'tenant_ns_ip': u'10.2.21.1/24', u'tenant_ns_if': u't3s1if', u'tenant_sub_if': u's1if', u'tenant_ns_name': u't3'}], u'bridge_ip': u'1.1.1.1', u'vms': [{u'mem': 2, u'name': u't3_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't3br1if1', u'vmif': u't3VM4if1'}]}, {u'local_ip': u'10.2.21.2', u'dsport': 4789, u'dev': u's1if', u'tenant_route_ip': u'192.168.131.2', u'remote_route': u'10.1.21.0/24', u'subnet_route': u'10.2.21.0/24', u'v_name': u'vxlan_t3s1', u'id': 42, u'remote_ip': u'10.1.21.2'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip route show \"10.2.21.0/24\" via \"192.168.100.92\" | grep -w '^10.2.21.0/24' ; if [ $? -ne 0 ] ; then ip route add \"10.2.21.0/24\" via \"192.168.100.92\" ; fi\nip route show \"10.1.21.0/24\" via 99.99.99.1 | grep -w '^10.1.21.0/24'; if [ $? -ne 0 ] ; then ip route add \"10.1.21.0/24\" via 99.99.99.1 ; fi\n", "delta": "0:00:00.011178", "end": "2019-11-17 08:50:00.236747", "item": [{"bridge_ip": "1.1.1.1", "bridge_name": "t3br1", "default_route_ip": "10.2.21.1", "dns": [{"brif": "t3s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t3s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "ns_name": "t3ns1", "route": [{"if": "p1", "ip": "10.2.21.1/24", "ns_if": "t3if", "ns_name": "t3"}], "tenant_ns": [{"tenant_ns_if": "t3s1if", "tenant_ns_ip": "10.2.21.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "s1if", "tenant_sub_ip": "10.2.21.2/24"}], "vms": [{"brif": "t3br1if1", "disk": "10G", "mem": 2, "name": "t3_VM4", "vcpu": 4, "vmif": "t3VM4if1"}]}, {"dev": "s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.21.2", "remote_ip": "10.1.21.2", "remote_route": "10.1.21.0/24", "subnet_route": "10.2.21.0/24", "tenant_route_ip": "192.168.131.2", "v_name": "vxlan_t3s1"}], "rc": 0, "start": "2019-11-17 08:50:00.225569", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

PLAY RECAP **************************************************************************************************************************************************
99.99.99.2                 : ok=3    changed=2    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0   

Using /etc/ansible/ansible.cfg as config file

PLAY [main] *************************************************************************************************************************************************

TASK [Create VM templates (C1)] *****************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.21.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.1.21.1', u'bridge_name': u't3br1', u'dns': [{u'dnsif': u't3s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't3s1_dnsbrif'}], u'ns_name': u't3ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.21.2/24', u'tenant_ns_ip': u'10.1.21.1/24', u'tenant_ns_if': u't3s1if', u'tenant_sub_if': u's1if', u'tenant_ns_name': u't3'}], u'bridge_ip': u'1.1.1.1', u'vxlan': [{u'local_ip': u'10.1.21.2', u'dsport': 4789, u'dev': u's1if', u'tenant_route_ip': u'192.168.3.2', u'remote_route': u'10.2.21.0/24', u'subnet_route': u'10.1.21.0/24', u'v_name': u'vxlan_t3s1', u'id': 42, u'remote_ip': u'10.2.21.2'}]}, {u'mem': 2, u'name': u't3_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't3br1if1', u'vmif': u't3VM1if1'}]) => {"ansible_loop_var": "item", "changed": true, "checksum": "350ba870bd31b7f6ee517845c14237910b5af0bf", "dest": "/root/Migration-as-a-Service/t3/VM_templates/t3_VM1.xml.j2", "gid": 0, "group": "root", "item": [{"bridge_ip": "1.1.1.1", "bridge_name": "t3br1", "default_route_ip": "10.1.21.1", "dns": [{"brif": "t3s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t3s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t3ns1", "route": [{"if": "p1", "ip": "10.1.21.1/24", "ns_if": "t3if", "ns_name": "t3"}], "tenant_ns": [{"tenant_ns_if": "t3s1if", "tenant_ns_ip": "10.1.21.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "s1if", "tenant_sub_ip": "10.1.21.2/24"}], "vxlan": [{"dev": "s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.21.2", "remote_ip": "10.2.21.2", "remote_route": "10.2.21.0/24", "subnet_route": "10.1.21.0/24", "tenant_route_ip": "192.168.3.2", "v_name": "vxlan_t3s1"}]}, {"brif": "t3br1if1", "disk": "10G", "mem": 2, "name": "t3_VM1", "vcpu": 4, "vmif": "t3VM1if1"}], "md5sum": "fbfc2eb0c2569531f25eea92c26d3bee", "mode": "0644", "owner": "root", "size": 4091, "src": "/root/.ansible/tmp/ansible-tmp-1573980600.92-89661618462564/source", "state": "file", "uid": 0}
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.21.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.1.21.1', u'bridge_name': u't3br1', u'dns': [{u'dnsif': u't3s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't3s1_dnsbrif'}], u'ns_name': u't3ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.21.2/24', u'tenant_ns_ip': u'10.1.21.1/24', u'tenant_ns_if': u't3s1if', u'tenant_sub_if': u's1if', u'tenant_ns_name': u't3'}], u'bridge_ip': u'1.1.1.1', u'vxlan': [{u'local_ip': u'10.1.21.2', u'dsport': 4789, u'dev': u's1if', u'tenant_route_ip': u'192.168.3.2', u'remote_route': u'10.2.21.0/24', u'subnet_route': u'10.1.21.0/24', u'v_name': u'vxlan_t3s1', u'id': 42, u'remote_ip': u'10.2.21.2'}]}, {u'mem': 4, u'name': u't3_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't3br1if2', u'vmif': u't3VM2if1'}]) => {"ansible_loop_var": "item", "changed": true, "checksum": "350ba870bd31b7f6ee517845c14237910b5af0bf", "dest": "/root/Migration-as-a-Service/t3/VM_templates/t3_VM2.xml.j2", "gid": 0, "group": "root", "item": [{"bridge_ip": "1.1.1.1", "bridge_name": "t3br1", "default_route_ip": "10.1.21.1", "dns": [{"brif": "t3s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t3s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t3ns1", "route": [{"if": "p1", "ip": "10.1.21.1/24", "ns_if": "t3if", "ns_name": "t3"}], "tenant_ns": [{"tenant_ns_if": "t3s1if", "tenant_ns_ip": "10.1.21.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "s1if", "tenant_sub_ip": "10.1.21.2/24"}], "vxlan": [{"dev": "s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.21.2", "remote_ip": "10.2.21.2", "remote_route": "10.2.21.0/24", "subnet_route": "10.1.21.0/24", "tenant_route_ip": "192.168.3.2", "v_name": "vxlan_t3s1"}]}, {"brif": "t3br1if2", "disk": "10G", "mem": 4, "name": "t3_VM2", "vcpu": 2, "vmif": "t3VM2if1"}], "md5sum": "fbfc2eb0c2569531f25eea92c26d3bee", "mode": "0644", "owner": "root", "size": 4091, "src": "/root/.ansible/tmp/ansible-tmp-1573980601.46-69000923130677/source", "state": "file", "uid": 0}
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.22.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.1.22.1', u'bridge_name': u't3br2', u'dns': [{u'dnsif': u't3s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't3s2_dnsbrif'}], u'ns_name': u't3ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.22.2/24', u'tenant_ns_ip': u'10.1.22.1/24', u'tenant_ns_if': u't3s2if', u'tenant_sub_if': u's2if', u'tenant_ns_name': u't3'}], u'bridge_ip': u'2.2.2.1', u'vxlan': [{u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}, {u'mem': 3, u'name': u't3_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't3br2if1', u'vmif': u't3VM3if1'}]) => {"ansible_loop_var": "item", "changed": true, "checksum": "350ba870bd31b7f6ee517845c14237910b5af0bf", "dest": "/root/Migration-as-a-Service/t3/VM_templates/t3_VM3.xml.j2", "gid": 0, "group": "root", "item": [{"bridge_ip": "2.2.2.1", "bridge_name": "t3br2", "default_route_ip": "10.1.22.1", "dns": [{"brif": "t3s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t3s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t3ns2", "route": [{"if": "p1", "ip": "10.1.22.1/24", "ns_if": "t3if", "ns_name": "t3"}], "tenant_ns": [{"tenant_ns_if": "t3s2if", "tenant_ns_ip": "10.1.22.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "s2if", "tenant_sub_ip": "10.1.22.2/24"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, {"brif": "t3br2if1", "disk": "10G", "mem": 3, "name": "t3_VM3", "vcpu": 2, "vmif": "t3VM3if1"}], "md5sum": "fbfc2eb0c2569531f25eea92c26d3bee", "mode": "0644", "owner": "root", "size": 4091, "src": "/root/.ansible/tmp/ansible-tmp-1573980601.7-92374912157897/source", "state": "file", "uid": 0}

PLAY RECAP **************************************************************************************************************************************************
localhost                  : ok=1    changed=1    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0   

Using /etc/ansible/ansible.cfg as config file

PLAY [main] *************************************************************************************************************************************************

TASK [Create VM templates (C2)] *****************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.2.21.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.2.21.1', u'bridge_name': u't3br1', u'dns': [{u'dnsif': u't3s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't3s1_dnsbrif'}], u'ns_name': u't3ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.21.2/24', u'tenant_ns_ip': u'10.2.21.1/24', u'tenant_ns_if': u't3s1if', u'tenant_sub_if': u's1if', u'tenant_ns_name': u't3'}], u'bridge_ip': u'1.1.1.1', u'vxlan': [{u'local_ip': u'10.2.21.2', u'dsport': 4789, u'dev': u's1if', u'tenant_route_ip': u'192.168.131.2', u'remote_route': u'10.1.21.0/24', u'subnet_route': u'10.2.21.0/24', u'v_name': u'vxlan_t3s1', u'id': 42, u'remote_ip': u'10.1.21.2'}]}, {u'mem': 2, u'name': u't3_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't3br1if1', u'vmif': u't3VM4if1'}]) => {"ansible_loop_var": "item", "changed": true, "checksum": "350ba870bd31b7f6ee517845c14237910b5af0bf", "dest": "/root/Migration-as-a-Service/t3/VM_templates/t3_VM4.xml.j2", "gid": 0, "group": "root", "item": [{"bridge_ip": "1.1.1.1", "bridge_name": "t3br1", "default_route_ip": "10.2.21.1", "dns": [{"brif": "t3s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t3s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "ns_name": "t3ns1", "route": [{"if": "p1", "ip": "10.2.21.1/24", "ns_if": "t3if", "ns_name": "t3"}], "tenant_ns": [{"tenant_ns_if": "t3s1if", "tenant_ns_ip": "10.2.21.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "s1if", "tenant_sub_ip": "10.2.21.2/24"}], "vxlan": [{"dev": "s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.21.2", "remote_ip": "10.1.21.2", "remote_route": "10.1.21.0/24", "subnet_route": "10.2.21.0/24", "tenant_route_ip": "192.168.131.2", "v_name": "vxlan_t3s1"}]}, {"brif": "t3br1if1", "disk": "10G", "mem": 2, "name": "t3_VM4", "vcpu": 4, "vmif": "t3VM4if1"}], "md5sum": "fbfc2eb0c2569531f25eea92c26d3bee", "mode": "0644", "owner": "root", "size": 4091, "src": "/root/.ansible/tmp/ansible-tmp-1573980602.62-39029423016112/source", "state": "file", "uid": 0}

PLAY RECAP **************************************************************************************************************************************************
localhost                  : ok=1    changed=1    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0   

Using /etc/ansible/ansible.cfg as config file

PLAY [main] *************************************************************************************************************************************************

TASK [Copy VM image] ****************************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.21.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.1.21.1', u'bridge_name': u't3br1', u'dns': [{u'dnsif': u't3s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't3s1_dnsbrif'}], u'ns_name': u't3ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.21.2/24', u'tenant_ns_ip': u'10.1.21.1/24', u'tenant_ns_if': u't3s1if', u'tenant_sub_if': u's1if', u'tenant_ns_name': u't3'}], u'bridge_ip': u'1.1.1.1', u'vxlan': [{u'local_ip': u'10.1.21.2', u'dsport': 4789, u'dev': u's1if', u'tenant_route_ip': u'192.168.3.2', u'remote_route': u'10.2.21.0/24', u'subnet_route': u'10.1.21.0/24', u'v_name': u'vxlan_t3s1', u'id': 42, u'remote_ip': u'10.2.21.2'}]}, {u'mem': 2, u'name': u't3_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't3br1if1', u'vmif': u't3VM1if1'}]) => {"ansible_loop_var": "item", "changed": true, "checksum": "d86d5962370fcd0c3d05943fc209d9e05fdac89f", "dest": "/var/lib/libvirt/images/t3_VM1.qcow2", "gid": 0, "group": "root", "item": [{"bridge_ip": "1.1.1.1", "bridge_name": "t3br1", "default_route_ip": "10.1.21.1", "dns": [{"brif": "t3s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t3s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t3ns1", "route": [{"if": "p1", "ip": "10.1.21.1/24", "ns_if": "t3if", "ns_name": "t3"}], "tenant_ns": [{"tenant_ns_if": "t3s1if", "tenant_ns_ip": "10.1.21.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "s1if", "tenant_sub_ip": "10.1.21.2/24"}], "vxlan": [{"dev": "s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.21.2", "remote_ip": "10.2.21.2", "remote_route": "10.2.21.0/24", "subnet_route": "10.1.21.0/24", "tenant_route_ip": "192.168.3.2", "v_name": "vxlan_t3s1"}]}, {"brif": "t3br1if1", "disk": "10G", "mem": 2, "name": "t3_VM1", "vcpu": 4, "vmif": "t3VM1if1"}], "md5sum": "b977a19124b65f2d544ddc62e407114d", "mode": "0644", "owner": "root", "size": 10739318784, "src": "/root/.ansible/tmp/ansible-tmp-1573980603.93-122831072469660/source", "state": "file", "uid": 0}
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.21.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.1.21.1', u'bridge_name': u't3br1', u'dns': [{u'dnsif': u't3s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't3s1_dnsbrif'}], u'ns_name': u't3ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.21.2/24', u'tenant_ns_ip': u'10.1.21.1/24', u'tenant_ns_if': u't3s1if', u'tenant_sub_if': u's1if', u'tenant_ns_name': u't3'}], u'bridge_ip': u'1.1.1.1', u'vxlan': [{u'local_ip': u'10.1.21.2', u'dsport': 4789, u'dev': u's1if', u'tenant_route_ip': u'192.168.3.2', u'remote_route': u'10.2.21.0/24', u'subnet_route': u'10.1.21.0/24', u'v_name': u'vxlan_t3s1', u'id': 42, u'remote_ip': u'10.2.21.2'}]}, {u'mem': 4, u'name': u't3_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't3br1if2', u'vmif': u't3VM2if1'}]) => {"ansible_loop_var": "item", "changed": true, "checksum": "d86d5962370fcd0c3d05943fc209d9e05fdac89f", "dest": "/var/lib/libvirt/images/t3_VM2.qcow2", "gid": 0, "group": "root", "item": [{"bridge_ip": "1.1.1.1", "bridge_name": "t3br1", "default_route_ip": "10.1.21.1", "dns": [{"brif": "t3s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t3s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t3ns1", "route": [{"if": "p1", "ip": "10.1.21.1/24", "ns_if": "t3if", "ns_name": "t3"}], "tenant_ns": [{"tenant_ns_if": "t3s1if", "tenant_ns_ip": "10.1.21.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "s1if", "tenant_sub_ip": "10.1.21.2/24"}], "vxlan": [{"dev": "s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.21.2", "remote_ip": "10.2.21.2", "remote_route": "10.2.21.0/24", "subnet_route": "10.1.21.0/24", "tenant_route_ip": "192.168.3.2", "v_name": "vxlan_t3s1"}]}, {"brif": "t3br1if2", "disk": "10G", "mem": 4, "name": "t3_VM2", "vcpu": 2, "vmif": "t3VM2if1"}], "md5sum": "b977a19124b65f2d544ddc62e407114d", "mode": "0644", "owner": "root", "size": 10739318784, "src": "/root/.ansible/tmp/ansible-tmp-1573980725.41-218818029584349/source", "state": "file", "uid": 0}
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.22.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.1.22.1', u'bridge_name': u't3br2', u'dns': [{u'dnsif': u't3s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't3s2_dnsbrif'}], u'ns_name': u't3ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.22.2/24', u'tenant_ns_ip': u'10.1.22.1/24', u'tenant_ns_if': u't3s2if', u'tenant_sub_if': u's2if', u'tenant_ns_name': u't3'}], u'bridge_ip': u'2.2.2.1', u'vxlan': [{u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}, {u'mem': 3, u'name': u't3_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't3br2if1', u'vmif': u't3VM3if1'}]) => {"ansible_loop_var": "item", "changed": true, "checksum": "d86d5962370fcd0c3d05943fc209d9e05fdac89f", "dest": "/var/lib/libvirt/images/t3_VM3.qcow2", "gid": 0, "group": "root", "item": [{"bridge_ip": "2.2.2.1", "bridge_name": "t3br2", "default_route_ip": "10.1.22.1", "dns": [{"brif": "t3s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t3s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t3ns2", "route": [{"if": "p1", "ip": "10.1.22.1/24", "ns_if": "t3if", "ns_name": "t3"}], "tenant_ns": [{"tenant_ns_if": "t3s2if", "tenant_ns_ip": "10.1.22.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "s2if", "tenant_sub_ip": "10.1.22.2/24"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, {"brif": "t3br2if1", "disk": "10G", "mem": 3, "name": "t3_VM3", "vcpu": 2, "vmif": "t3VM3if1"}], "md5sum": "b977a19124b65f2d544ddc62e407114d", "mode": "0644", "owner": "root", "size": 10739318784, "src": "/root/.ansible/tmp/ansible-tmp-1573980820.68-201454166601991/source", "state": "file", "uid": 0}

TASK [Create VM templates (C1)] *****************************************************************************************************************************
ok: [localhost] => (item=[{u'route': [{u'ip': u'10.1.21.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.1.21.1', u'bridge_name': u't3br1', u'dns': [{u'dnsif': u't3s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't3s1_dnsbrif'}], u'ns_name': u't3ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.21.2/24', u'tenant_ns_ip': u'10.1.21.1/24', u'tenant_ns_if': u't3s1if', u'tenant_sub_if': u's1if', u'tenant_ns_name': u't3'}], u'bridge_ip': u'1.1.1.1', u'vxlan': [{u'local_ip': u'10.1.21.2', u'dsport': 4789, u'dev': u's1if', u'tenant_route_ip': u'192.168.3.2', u'remote_route': u'10.2.21.0/24', u'subnet_route': u'10.1.21.0/24', u'v_name': u'vxlan_t3s1', u'id': 42, u'remote_ip': u'10.2.21.2'}]}, {u'mem': 2, u'name': u't3_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't3br1if1', u'vmif': u't3VM1if1'}]) => {"ansible_loop_var": "item", "changed": false, "checksum": "350ba870bd31b7f6ee517845c14237910b5af0bf", "dest": "/root/Migration-as-a-Service/t3/VM_templates/t3_VM1.xml.j2", "gid": 0, "group": "root", "item": [{"bridge_ip": "1.1.1.1", "bridge_name": "t3br1", "default_route_ip": "10.1.21.1", "dns": [{"brif": "t3s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t3s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t3ns1", "route": [{"if": "p1", "ip": "10.1.21.1/24", "ns_if": "t3if", "ns_name": "t3"}], "tenant_ns": [{"tenant_ns_if": "t3s1if", "tenant_ns_ip": "10.1.21.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "s1if", "tenant_sub_ip": "10.1.21.2/24"}], "vxlan": [{"dev": "s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.21.2", "remote_ip": "10.2.21.2", "remote_route": "10.2.21.0/24", "subnet_route": "10.1.21.0/24", "tenant_route_ip": "192.168.3.2", "v_name": "vxlan_t3s1"}]}, {"brif": "t3br1if1", "disk": "10G", "mem": 2, "name": "t3_VM1", "vcpu": 4, "vmif": "t3VM1if1"}], "mode": "0644", "owner": "root", "path": "/root/Migration-as-a-Service/t3/VM_templates/t3_VM1.xml.j2", "size": 4091, "state": "file", "uid": 0}
ok: [localhost] => (item=[{u'route': [{u'ip': u'10.1.21.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.1.21.1', u'bridge_name': u't3br1', u'dns': [{u'dnsif': u't3s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't3s1_dnsbrif'}], u'ns_name': u't3ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.21.2/24', u'tenant_ns_ip': u'10.1.21.1/24', u'tenant_ns_if': u't3s1if', u'tenant_sub_if': u's1if', u'tenant_ns_name': u't3'}], u'bridge_ip': u'1.1.1.1', u'vxlan': [{u'local_ip': u'10.1.21.2', u'dsport': 4789, u'dev': u's1if', u'tenant_route_ip': u'192.168.3.2', u'remote_route': u'10.2.21.0/24', u'subnet_route': u'10.1.21.0/24', u'v_name': u'vxlan_t3s1', u'id': 42, u'remote_ip': u'10.2.21.2'}]}, {u'mem': 4, u'name': u't3_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't3br1if2', u'vmif': u't3VM2if1'}]) => {"ansible_loop_var": "item", "changed": false, "checksum": "350ba870bd31b7f6ee517845c14237910b5af0bf", "dest": "/root/Migration-as-a-Service/t3/VM_templates/t3_VM2.xml.j2", "gid": 0, "group": "root", "item": [{"bridge_ip": "1.1.1.1", "bridge_name": "t3br1", "default_route_ip": "10.1.21.1", "dns": [{"brif": "t3s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t3s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t3ns1", "route": [{"if": "p1", "ip": "10.1.21.1/24", "ns_if": "t3if", "ns_name": "t3"}], "tenant_ns": [{"tenant_ns_if": "t3s1if", "tenant_ns_ip": "10.1.21.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "s1if", "tenant_sub_ip": "10.1.21.2/24"}], "vxlan": [{"dev": "s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.21.2", "remote_ip": "10.2.21.2", "remote_route": "10.2.21.0/24", "subnet_route": "10.1.21.0/24", "tenant_route_ip": "192.168.3.2", "v_name": "vxlan_t3s1"}]}, {"brif": "t3br1if2", "disk": "10G", "mem": 4, "name": "t3_VM2", "vcpu": 2, "vmif": "t3VM2if1"}], "mode": "0644", "owner": "root", "path": "/root/Migration-as-a-Service/t3/VM_templates/t3_VM2.xml.j2", "size": 4091, "state": "file", "uid": 0}
ok: [localhost] => (item=[{u'route': [{u'ip': u'10.1.22.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.1.22.1', u'bridge_name': u't3br2', u'dns': [{u'dnsif': u't3s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't3s2_dnsbrif'}], u'ns_name': u't3ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.22.2/24', u'tenant_ns_ip': u'10.1.22.1/24', u'tenant_ns_if': u't3s2if', u'tenant_sub_if': u's2if', u'tenant_ns_name': u't3'}], u'bridge_ip': u'2.2.2.1', u'vxlan': [{u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}, {u'mem': 3, u'name': u't3_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't3br2if1', u'vmif': u't3VM3if1'}]) => {"ansible_loop_var": "item", "changed": false, "checksum": "350ba870bd31b7f6ee517845c14237910b5af0bf", "dest": "/root/Migration-as-a-Service/t3/VM_templates/t3_VM3.xml.j2", "gid": 0, "group": "root", "item": [{"bridge_ip": "2.2.2.1", "bridge_name": "t3br2", "default_route_ip": "10.1.22.1", "dns": [{"brif": "t3s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t3s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t3ns2", "route": [{"if": "p1", "ip": "10.1.22.1/24", "ns_if": "t3if", "ns_name": "t3"}], "tenant_ns": [{"tenant_ns_if": "t3s2if", "tenant_ns_ip": "10.1.22.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "s2if", "tenant_sub_ip": "10.1.22.2/24"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, {"brif": "t3br2if1", "disk": "10G", "mem": 3, "name": "t3_VM3", "vcpu": 2, "vmif": "t3VM3if1"}], "mode": "0644", "owner": "root", "path": "/root/Migration-as-a-Service/t3/VM_templates/t3_VM3.xml.j2", "size": 4091, "state": "file", "uid": 0}

TASK [Get list of running VMs] ******************************************************************************************************************************
ok: [localhost] => {"changed": false, "cmd": ["virsh", "list", "--name"], "delta": "0:00:00.189545", "end": "2019-11-17 08:55:14.178865", "rc": 0, "start": "2019-11-17 08:55:13.989320", "stderr": "", "stderr_lines": [], "stdout": "VM1\nVM3\nt2_VM1\nt2_VM2\nt2_VM3", "stdout_lines": ["VM1", "VM3", "t2_VM1", "t2_VM2", "t2_VM3"]}

TASK [Define VM] ********************************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.21.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.1.21.1', u'bridge_name': u't3br1', u'dns': [{u'dnsif': u't3s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't3s1_dnsbrif'}], u'ns_name': u't3ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.21.2/24', u'tenant_ns_ip': u'10.1.21.1/24', u'tenant_ns_if': u't3s1if', u'tenant_sub_if': u's1if', u'tenant_ns_name': u't3'}], u'bridge_ip': u'1.1.1.1', u'vxlan': [{u'local_ip': u'10.1.21.2', u'dsport': 4789, u'dev': u's1if', u'tenant_route_ip': u'192.168.3.2', u'remote_route': u'10.2.21.0/24', u'subnet_route': u'10.1.21.0/24', u'v_name': u'vxlan_t3s1', u'id': 42, u'remote_ip': u'10.2.21.2'}]}, {u'mem': 2, u'name': u't3_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't3br1if1', u'vmif': u't3VM1if1'}]) => {"ansible_loop_var": "item", "changed": true, "created": "t3_VM1", "item": [{"bridge_ip": "1.1.1.1", "bridge_name": "t3br1", "default_route_ip": "10.1.21.1", "dns": [{"brif": "t3s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t3s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t3ns1", "route": [{"if": "p1", "ip": "10.1.21.1/24", "ns_if": "t3if", "ns_name": "t3"}], "tenant_ns": [{"tenant_ns_if": "t3s1if", "tenant_ns_ip": "10.1.21.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "s1if", "tenant_sub_ip": "10.1.21.2/24"}], "vxlan": [{"dev": "s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.21.2", "remote_ip": "10.2.21.2", "remote_route": "10.2.21.0/24", "subnet_route": "10.1.21.0/24", "tenant_route_ip": "192.168.3.2", "v_name": "vxlan_t3s1"}]}, {"brif": "t3br1if1", "disk": "10G", "mem": 2, "name": "t3_VM1", "vcpu": 4, "vmif": "t3VM1if1"}], "warnings": ["'xml' is given - ignoring 'name'"]}
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.21.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.1.21.1', u'bridge_name': u't3br1', u'dns': [{u'dnsif': u't3s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't3s1_dnsbrif'}], u'ns_name': u't3ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.21.2/24', u'tenant_ns_ip': u'10.1.21.1/24', u'tenant_ns_if': u't3s1if', u'tenant_sub_if': u's1if', u'tenant_ns_name': u't3'}], u'bridge_ip': u'1.1.1.1', u'vxlan': [{u'local_ip': u'10.1.21.2', u'dsport': 4789, u'dev': u's1if', u'tenant_route_ip': u'192.168.3.2', u'remote_route': u'10.2.21.0/24', u'subnet_route': u'10.1.21.0/24', u'v_name': u'vxlan_t3s1', u'id': 42, u'remote_ip': u'10.2.21.2'}]}, {u'mem': 4, u'name': u't3_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't3br1if2', u'vmif': u't3VM2if1'}]) => {"ansible_loop_var": "item", "changed": true, "created": "t3_VM2", "item": [{"bridge_ip": "1.1.1.1", "bridge_name": "t3br1", "default_route_ip": "10.1.21.1", "dns": [{"brif": "t3s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t3s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t3ns1", "route": [{"if": "p1", "ip": "10.1.21.1/24", "ns_if": "t3if", "ns_name": "t3"}], "tenant_ns": [{"tenant_ns_if": "t3s1if", "tenant_ns_ip": "10.1.21.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "s1if", "tenant_sub_ip": "10.1.21.2/24"}], "vxlan": [{"dev": "s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.21.2", "remote_ip": "10.2.21.2", "remote_route": "10.2.21.0/24", "subnet_route": "10.1.21.0/24", "tenant_route_ip": "192.168.3.2", "v_name": "vxlan_t3s1"}]}, {"brif": "t3br1if2", "disk": "10G", "mem": 4, "name": "t3_VM2", "vcpu": 2, "vmif": "t3VM2if1"}], "warnings": ["'xml' is given - ignoring 'name'"]}
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.22.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.1.22.1', u'bridge_name': u't3br2', u'dns': [{u'dnsif': u't3s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't3s2_dnsbrif'}], u'ns_name': u't3ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.22.2/24', u'tenant_ns_ip': u'10.1.22.1/24', u'tenant_ns_if': u't3s2if', u'tenant_sub_if': u's2if', u'tenant_ns_name': u't3'}], u'bridge_ip': u'2.2.2.1', u'vxlan': [{u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}, {u'mem': 3, u'name': u't3_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't3br2if1', u'vmif': u't3VM3if1'}]) => {"ansible_loop_var": "item", "changed": true, "created": "t3_VM3", "item": [{"bridge_ip": "2.2.2.1", "bridge_name": "t3br2", "default_route_ip": "10.1.22.1", "dns": [{"brif": "t3s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t3s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t3ns2", "route": [{"if": "p1", "ip": "10.1.22.1/24", "ns_if": "t3if", "ns_name": "t3"}], "tenant_ns": [{"tenant_ns_if": "t3s2if", "tenant_ns_ip": "10.1.22.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "s2if", "tenant_sub_ip": "10.1.22.2/24"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, {"brif": "t3br2if1", "disk": "10G", "mem": 3, "name": "t3_VM3", "vcpu": 2, "vmif": "t3VM3if1"}], "warnings": ["'xml' is given - ignoring 'name'"]}

TASK [Create VM] ********************************************************************************************************************************************
ok: [localhost] => (item=[{u'route': [{u'ip': u'10.1.21.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.1.21.1', u'bridge_name': u't3br1', u'dns': [{u'dnsif': u't3s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't3s1_dnsbrif'}], u'ns_name': u't3ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.21.2/24', u'tenant_ns_ip': u'10.1.21.1/24', u'tenant_ns_if': u't3s1if', u'tenant_sub_if': u's1if', u'tenant_ns_name': u't3'}], u'bridge_ip': u'1.1.1.1', u'vxlan': [{u'local_ip': u'10.1.21.2', u'dsport': 4789, u'dev': u's1if', u'tenant_route_ip': u'192.168.3.2', u'remote_route': u'10.2.21.0/24', u'subnet_route': u'10.1.21.0/24', u'v_name': u'vxlan_t3s1', u'id': 42, u'remote_ip': u'10.2.21.2'}]}, {u'mem': 2, u'name': u't3_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't3br1if1', u'vmif': u't3VM1if1'}]) => {"ansible_loop_var": "item", "changed": false, "create": 0, "item": [{"bridge_ip": "1.1.1.1", "bridge_name": "t3br1", "default_route_ip": "10.1.21.1", "dns": [{"brif": "t3s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t3s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t3ns1", "route": [{"if": "p1", "ip": "10.1.21.1/24", "ns_if": "t3if", "ns_name": "t3"}], "tenant_ns": [{"tenant_ns_if": "t3s1if", "tenant_ns_ip": "10.1.21.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "s1if", "tenant_sub_ip": "10.1.21.2/24"}], "vxlan": [{"dev": "s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.21.2", "remote_ip": "10.2.21.2", "remote_route": "10.2.21.0/24", "subnet_route": "10.1.21.0/24", "tenant_route_ip": "192.168.3.2", "v_name": "vxlan_t3s1"}]}, {"brif": "t3br1if1", "disk": "10G", "mem": 2, "name": "t3_VM1", "vcpu": 4, "vmif": "t3VM1if1"}]}
ok: [localhost] => (item=[{u'route': [{u'ip': u'10.1.21.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.1.21.1', u'bridge_name': u't3br1', u'dns': [{u'dnsif': u't3s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't3s1_dnsbrif'}], u'ns_name': u't3ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.21.2/24', u'tenant_ns_ip': u'10.1.21.1/24', u'tenant_ns_if': u't3s1if', u'tenant_sub_if': u's1if', u'tenant_ns_name': u't3'}], u'bridge_ip': u'1.1.1.1', u'vxlan': [{u'local_ip': u'10.1.21.2', u'dsport': 4789, u'dev': u's1if', u'tenant_route_ip': u'192.168.3.2', u'remote_route': u'10.2.21.0/24', u'subnet_route': u'10.1.21.0/24', u'v_name': u'vxlan_t3s1', u'id': 42, u'remote_ip': u'10.2.21.2'}]}, {u'mem': 4, u'name': u't3_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't3br1if2', u'vmif': u't3VM2if1'}]) => {"ansible_loop_var": "item", "changed": false, "create": 0, "item": [{"bridge_ip": "1.1.1.1", "bridge_name": "t3br1", "default_route_ip": "10.1.21.1", "dns": [{"brif": "t3s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t3s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t3ns1", "route": [{"if": "p1", "ip": "10.1.21.1/24", "ns_if": "t3if", "ns_name": "t3"}], "tenant_ns": [{"tenant_ns_if": "t3s1if", "tenant_ns_ip": "10.1.21.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "s1if", "tenant_sub_ip": "10.1.21.2/24"}], "vxlan": [{"dev": "s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.21.2", "remote_ip": "10.2.21.2", "remote_route": "10.2.21.0/24", "subnet_route": "10.1.21.0/24", "tenant_route_ip": "192.168.3.2", "v_name": "vxlan_t3s1"}]}, {"brif": "t3br1if2", "disk": "10G", "mem": 4, "name": "t3_VM2", "vcpu": 2, "vmif": "t3VM2if1"}]}
ok: [localhost] => (item=[{u'route': [{u'ip': u'10.1.22.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.1.22.1', u'bridge_name': u't3br2', u'dns': [{u'dnsif': u't3s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't3s2_dnsbrif'}], u'ns_name': u't3ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.22.2/24', u'tenant_ns_ip': u'10.1.22.1/24', u'tenant_ns_if': u't3s2if', u'tenant_sub_if': u's2if', u'tenant_ns_name': u't3'}], u'bridge_ip': u'2.2.2.1', u'vxlan': [{u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}, {u'mem': 3, u'name': u't3_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't3br2if1', u'vmif': u't3VM3if1'}]) => {"ansible_loop_var": "item", "changed": false, "create": 0, "item": [{"bridge_ip": "2.2.2.1", "bridge_name": "t3br2", "default_route_ip": "10.1.22.1", "dns": [{"brif": "t3s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t3s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t3ns2", "route": [{"if": "p1", "ip": "10.1.22.1/24", "ns_if": "t3if", "ns_name": "t3"}], "tenant_ns": [{"tenant_ns_if": "t3s2if", "tenant_ns_ip": "10.1.22.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "s2if", "tenant_sub_ip": "10.1.22.2/24"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, {"brif": "t3br2if1", "disk": "10G", "mem": 3, "name": "t3_VM3", "vcpu": 2, "vmif": "t3VM3if1"}]}

TASK [Start VM] *********************************************************************************************************************************************
ok: [localhost] => (item=[{u'route': [{u'ip': u'10.1.21.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.1.21.1', u'bridge_name': u't3br1', u'dns': [{u'dnsif': u't3s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't3s1_dnsbrif'}], u'ns_name': u't3ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.21.2/24', u'tenant_ns_ip': u'10.1.21.1/24', u'tenant_ns_if': u't3s1if', u'tenant_sub_if': u's1if', u'tenant_ns_name': u't3'}], u'bridge_ip': u'1.1.1.1', u'vxlan': [{u'local_ip': u'10.1.21.2', u'dsport': 4789, u'dev': u's1if', u'tenant_route_ip': u'192.168.3.2', u'remote_route': u'10.2.21.0/24', u'subnet_route': u'10.1.21.0/24', u'v_name': u'vxlan_t3s1', u'id': 42, u'remote_ip': u'10.2.21.2'}]}, {u'mem': 2, u'name': u't3_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't3br1if1', u'vmif': u't3VM1if1'}]) => {"ansible_loop_var": "item", "changed": false, "item": [{"bridge_ip": "1.1.1.1", "bridge_name": "t3br1", "default_route_ip": "10.1.21.1", "dns": [{"brif": "t3s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t3s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t3ns1", "route": [{"if": "p1", "ip": "10.1.21.1/24", "ns_if": "t3if", "ns_name": "t3"}], "tenant_ns": [{"tenant_ns_if": "t3s1if", "tenant_ns_ip": "10.1.21.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "s1if", "tenant_sub_ip": "10.1.21.2/24"}], "vxlan": [{"dev": "s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.21.2", "remote_ip": "10.2.21.2", "remote_route": "10.2.21.0/24", "subnet_route": "10.1.21.0/24", "tenant_route_ip": "192.168.3.2", "v_name": "vxlan_t3s1"}]}, {"brif": "t3br1if1", "disk": "10G", "mem": 2, "name": "t3_VM1", "vcpu": 4, "vmif": "t3VM1if1"}]}
ok: [localhost] => (item=[{u'route': [{u'ip': u'10.1.21.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.1.21.1', u'bridge_name': u't3br1', u'dns': [{u'dnsif': u't3s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't3s1_dnsbrif'}], u'ns_name': u't3ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.21.2/24', u'tenant_ns_ip': u'10.1.21.1/24', u'tenant_ns_if': u't3s1if', u'tenant_sub_if': u's1if', u'tenant_ns_name': u't3'}], u'bridge_ip': u'1.1.1.1', u'vxlan': [{u'local_ip': u'10.1.21.2', u'dsport': 4789, u'dev': u's1if', u'tenant_route_ip': u'192.168.3.2', u'remote_route': u'10.2.21.0/24', u'subnet_route': u'10.1.21.0/24', u'v_name': u'vxlan_t3s1', u'id': 42, u'remote_ip': u'10.2.21.2'}]}, {u'mem': 4, u'name': u't3_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't3br1if2', u'vmif': u't3VM2if1'}]) => {"ansible_loop_var": "item", "changed": false, "item": [{"bridge_ip": "1.1.1.1", "bridge_name": "t3br1", "default_route_ip": "10.1.21.1", "dns": [{"brif": "t3s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t3s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t3ns1", "route": [{"if": "p1", "ip": "10.1.21.1/24", "ns_if": "t3if", "ns_name": "t3"}], "tenant_ns": [{"tenant_ns_if": "t3s1if", "tenant_ns_ip": "10.1.21.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "s1if", "tenant_sub_ip": "10.1.21.2/24"}], "vxlan": [{"dev": "s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.21.2", "remote_ip": "10.2.21.2", "remote_route": "10.2.21.0/24", "subnet_route": "10.1.21.0/24", "tenant_route_ip": "192.168.3.2", "v_name": "vxlan_t3s1"}]}, {"brif": "t3br1if2", "disk": "10G", "mem": 4, "name": "t3_VM2", "vcpu": 2, "vmif": "t3VM2if1"}]}
ok: [localhost] => (item=[{u'route': [{u'ip': u'10.1.22.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.1.22.1', u'bridge_name': u't3br2', u'dns': [{u'dnsif': u't3s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't3s2_dnsbrif'}], u'ns_name': u't3ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.22.2/24', u'tenant_ns_ip': u'10.1.22.1/24', u'tenant_ns_if': u't3s2if', u'tenant_sub_if': u's2if', u'tenant_ns_name': u't3'}], u'bridge_ip': u'2.2.2.1', u'vxlan': [{u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}, {u'mem': 3, u'name': u't3_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't3br2if1', u'vmif': u't3VM3if1'}]) => {"ansible_loop_var": "item", "changed": false, "item": [{"bridge_ip": "2.2.2.1", "bridge_name": "t3br2", "default_route_ip": "10.1.22.1", "dns": [{"brif": "t3s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t3s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t3ns2", "route": [{"if": "p1", "ip": "10.1.22.1/24", "ns_if": "t3if", "ns_name": "t3"}], "tenant_ns": [{"tenant_ns_if": "t3s2if", "tenant_ns_ip": "10.1.22.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "s2if", "tenant_sub_ip": "10.1.22.2/24"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, {"brif": "t3br2if1", "disk": "10G", "mem": 3, "name": "t3_VM3", "vcpu": 2, "vmif": "t3VM3if1"}]}

TASK [Attach VM interface] **********************************************************************************************************************************
failed: [localhost] (item=[{u'route': [{u'ip': u'10.1.21.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.1.21.1', u'bridge_name': u't3br1', u'dns': [{u'dnsif': u't3s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't3s1_dnsbrif'}], u'ns_name': u't3ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.21.2/24', u'tenant_ns_ip': u'10.1.21.1/24', u'tenant_ns_if': u't3s1if', u'tenant_sub_if': u's1if', u'tenant_ns_name': u't3'}], u'bridge_ip': u'1.1.1.1', u'vxlan': [{u'local_ip': u'10.1.21.2', u'dsport': 4789, u'dev': u's1if', u'tenant_route_ip': u'192.168.3.2', u'remote_route': u'10.2.21.0/24', u'subnet_route': u'10.1.21.0/24', u'v_name': u'vxlan_t3s1', u'id': 42, u'remote_ip': u'10.2.21.2'}]}, {u'mem': 2, u'name': u't3_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't3br1if1', u'vmif': u't3VM1if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "virsh domiflist \"t3_VM1\" | grep -w 't3VM1if1' ; if [ $? -ne 0 ] ; then virsh attach-interface \"t3_VM1\" direct \"t3VM1if1\" --live --persistent ; fi\n", "delta": "0:00:00.555163", "end": "2019-11-17 08:55:27.680446", "item": [{"bridge_ip": "1.1.1.1", "bridge_name": "t3br1", "default_route_ip": "10.1.21.1", "dns": [{"brif": "t3s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t3s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t3ns1", "route": [{"if": "p1", "ip": "10.1.21.1/24", "ns_if": "t3if", "ns_name": "t3"}], "tenant_ns": [{"tenant_ns_if": "t3s1if", "tenant_ns_ip": "10.1.21.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "s1if", "tenant_sub_ip": "10.1.21.2/24"}], "vxlan": [{"dev": "s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.21.2", "remote_ip": "10.2.21.2", "remote_route": "10.2.21.0/24", "subnet_route": "10.1.21.0/24", "tenant_route_ip": "192.168.3.2", "v_name": "vxlan_t3s1"}]}, {"brif": "t3br1if1", "disk": "10G", "mem": 2, "name": "t3_VM1", "vcpu": 4, "vmif": "t3VM1if1"}], "msg": "non-zero return code", "rc": 1, "start": "2019-11-17 08:55:27.125283", "stderr": "error: Failed to attach interface\nerror: Unable to get index for interface t3VM1if1: No such device", "stderr_lines": ["error: Failed to attach interface", "error: Unable to get index for interface t3VM1if1: No such device"], "stdout": "", "stdout_lines": []}
failed: [localhost] (item=[{u'route': [{u'ip': u'10.1.21.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.1.21.1', u'bridge_name': u't3br1', u'dns': [{u'dnsif': u't3s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't3s1_dnsbrif'}], u'ns_name': u't3ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.21.2/24', u'tenant_ns_ip': u'10.1.21.1/24', u'tenant_ns_if': u't3s1if', u'tenant_sub_if': u's1if', u'tenant_ns_name': u't3'}], u'bridge_ip': u'1.1.1.1', u'vxlan': [{u'local_ip': u'10.1.21.2', u'dsport': 4789, u'dev': u's1if', u'tenant_route_ip': u'192.168.3.2', u'remote_route': u'10.2.21.0/24', u'subnet_route': u'10.1.21.0/24', u'v_name': u'vxlan_t3s1', u'id': 42, u'remote_ip': u'10.2.21.2'}]}, {u'mem': 4, u'name': u't3_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't3br1if2', u'vmif': u't3VM2if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "virsh domiflist \"t3_VM2\" | grep -w 't3VM2if1' ; if [ $? -ne 0 ] ; then virsh attach-interface \"t3_VM2\" direct \"t3VM2if1\" --live --persistent ; fi\n", "delta": "0:00:00.056972", "end": "2019-11-17 08:55:27.867894", "item": [{"bridge_ip": "1.1.1.1", "bridge_name": "t3br1", "default_route_ip": "10.1.21.1", "dns": [{"brif": "t3s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t3s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t3ns1", "route": [{"if": "p1", "ip": "10.1.21.1/24", "ns_if": "t3if", "ns_name": "t3"}], "tenant_ns": [{"tenant_ns_if": "t3s1if", "tenant_ns_ip": "10.1.21.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "s1if", "tenant_sub_ip": "10.1.21.2/24"}], "vxlan": [{"dev": "s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.21.2", "remote_ip": "10.2.21.2", "remote_route": "10.2.21.0/24", "subnet_route": "10.1.21.0/24", "tenant_route_ip": "192.168.3.2", "v_name": "vxlan_t3s1"}]}, {"brif": "t3br1if2", "disk": "10G", "mem": 4, "name": "t3_VM2", "vcpu": 2, "vmif": "t3VM2if1"}], "msg": "non-zero return code", "rc": 1, "start": "2019-11-17 08:55:27.810922", "stderr": "error: Failed to attach interface\nerror: Unable to get index for interface t3VM2if1: No such device", "stderr_lines": ["error: Failed to attach interface", "error: Unable to get index for interface t3VM2if1: No such device"], "stdout": "", "stdout_lines": []}
failed: [localhost] (item=[{u'route': [{u'ip': u'10.1.22.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.1.22.1', u'bridge_name': u't3br2', u'dns': [{u'dnsif': u't3s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't3s2_dnsbrif'}], u'ns_name': u't3ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.22.2/24', u'tenant_ns_ip': u'10.1.22.1/24', u'tenant_ns_if': u't3s2if', u'tenant_sub_if': u's2if', u'tenant_ns_name': u't3'}], u'bridge_ip': u'2.2.2.1', u'vxlan': [{u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}, {u'mem': 3, u'name': u't3_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't3br2if1', u'vmif': u't3VM3if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "virsh domiflist \"t3_VM3\" | grep -w 't3VM3if1' ; if [ $? -ne 0 ] ; then virsh attach-interface \"t3_VM3\" direct \"t3VM3if1\" --live --persistent ; fi\n", "delta": "0:00:00.053389", "end": "2019-11-17 08:55:28.043447", "item": [{"bridge_ip": "2.2.2.1", "bridge_name": "t3br2", "default_route_ip": "10.1.22.1", "dns": [{"brif": "t3s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t3s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t3ns2", "route": [{"if": "p1", "ip": "10.1.22.1/24", "ns_if": "t3if", "ns_name": "t3"}], "tenant_ns": [{"tenant_ns_if": "t3s2if", "tenant_ns_ip": "10.1.22.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "s2if", "tenant_sub_ip": "10.1.22.2/24"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, {"brif": "t3br2if1", "disk": "10G", "mem": 3, "name": "t3_VM3", "vcpu": 2, "vmif": "t3VM3if1"}], "msg": "non-zero return code", "rc": 1, "start": "2019-11-17 08:55:27.990058", "stderr": "error: Failed to attach interface\nerror: Unable to get index for interface t3VM3if1: No such device", "stderr_lines": ["error: Failed to attach interface", "error: Unable to get index for interface t3VM3if1: No such device"], "stdout": "", "stdout_lines": []}

PLAY RECAP **************************************************************************************************************************************************
localhost                  : ok=6    changed=2    unreachable=0    failed=1    skipped=0    rescued=0    ignored=0   

Using /etc/ansible/ansible.cfg as config file

PLAY [worker] ***********************************************************************************************************************************************

TASK [Copy VM image] ****************************************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.21.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.2.21.1', u'bridge_name': u't3br1', u'dns': [{u'dnsif': u't3s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't3s1_dnsbrif'}], u'ns_name': u't3ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.21.2/24', u'tenant_ns_ip': u'10.2.21.1/24', u'tenant_ns_if': u't3s1if', u'tenant_sub_if': u's1if', u'tenant_ns_name': u't3'}], u'bridge_ip': u'1.1.1.1', u'vxlan': [{u'local_ip': u'10.2.21.2', u'dsport': 4789, u'dev': u's1if', u'tenant_route_ip': u'192.168.131.2', u'remote_route': u'10.1.21.0/24', u'subnet_route': u'10.2.21.0/24', u'v_name': u'vxlan_t3s1', u'id': 42, u'remote_ip': u'10.1.21.2'}]}, {u'mem': 2, u'name': u't3_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't3br1if1', u'vmif': u't3VM4if1'}]) => {"ansible_loop_var": "item", "changed": true, "checksum": "f8b2ffa2bf201c84196c582f2dec0d33a1eb4b42", "dest": "/var/lib/libvirt/images/t3_VM4.qcow2", "gid": 0, "group": "root", "item": [{"bridge_ip": "1.1.1.1", "bridge_name": "t3br1", "default_route_ip": "10.2.21.1", "dns": [{"brif": "t3s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t3s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "ns_name": "t3ns1", "route": [{"if": "p1", "ip": "10.2.21.1/24", "ns_if": "t3if", "ns_name": "t3"}], "tenant_ns": [{"tenant_ns_if": "t3s1if", "tenant_ns_ip": "10.2.21.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "s1if", "tenant_sub_ip": "10.2.21.2/24"}], "vxlan": [{"dev": "s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.21.2", "remote_ip": "10.1.21.2", "remote_route": "10.1.21.0/24", "subnet_route": "10.2.21.0/24", "tenant_route_ip": "192.168.131.2", "v_name": "vxlan_t3s1"}]}, {"brif": "t3br1if1", "disk": "10G", "mem": 2, "name": "t3_VM4", "vcpu": 4, "vmif": "t3VM4if1"}], "md5sum": "e6d5d524b68797ddd748ba1475985d34", "mode": "0644", "owner": "root", "size": 10739318784, "src": "/root/mainVM.qcow2", "state": "file", "uid": 0}

TASK [Get list of running VMs] ******************************************************************************************************************************
ok: [99.99.99.2] => {"changed": false, "cmd": ["virsh", "list", "--name"], "delta": "0:00:00.049744", "end": "2019-11-17 08:57:18.963693", "rc": 0, "start": "2019-11-17 08:57:18.913949", "stderr": "", "stderr_lines": [], "stdout": "Test\nVM2\nt2_VM4", "stdout_lines": ["Test", "VM2", "t2_VM4"]}

TASK [Define VM] ********************************************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.21.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.2.21.1', u'bridge_name': u't3br1', u'dns': [{u'dnsif': u't3s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't3s1_dnsbrif'}], u'ns_name': u't3ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.21.2/24', u'tenant_ns_ip': u'10.2.21.1/24', u'tenant_ns_if': u't3s1if', u'tenant_sub_if': u's1if', u'tenant_ns_name': u't3'}], u'bridge_ip': u'1.1.1.1', u'vxlan': [{u'local_ip': u'10.2.21.2', u'dsport': 4789, u'dev': u's1if', u'tenant_route_ip': u'192.168.131.2', u'remote_route': u'10.1.21.0/24', u'subnet_route': u'10.2.21.0/24', u'v_name': u'vxlan_t3s1', u'id': 42, u'remote_ip': u'10.1.21.2'}]}, {u'mem': 2, u'name': u't3_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't3br1if1', u'vmif': u't3VM4if1'}]) => {"ansible_loop_var": "item", "changed": true, "created": "t3_VM4", "item": [{"bridge_ip": "1.1.1.1", "bridge_name": "t3br1", "default_route_ip": "10.2.21.1", "dns": [{"brif": "t3s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t3s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "ns_name": "t3ns1", "route": [{"if": "p1", "ip": "10.2.21.1/24", "ns_if": "t3if", "ns_name": "t3"}], "tenant_ns": [{"tenant_ns_if": "t3s1if", "tenant_ns_ip": "10.2.21.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "s1if", "tenant_sub_ip": "10.2.21.2/24"}], "vxlan": [{"dev": "s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.21.2", "remote_ip": "10.1.21.2", "remote_route": "10.1.21.0/24", "subnet_route": "10.2.21.0/24", "tenant_route_ip": "192.168.131.2", "v_name": "vxlan_t3s1"}]}, {"brif": "t3br1if1", "disk": "10G", "mem": 2, "name": "t3_VM4", "vcpu": 4, "vmif": "t3VM4if1"}], "warnings": ["'xml' is given - ignoring 'name'"]}

TASK [Create VM] ********************************************************************************************************************************************
ok: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.21.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.2.21.1', u'bridge_name': u't3br1', u'dns': [{u'dnsif': u't3s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't3s1_dnsbrif'}], u'ns_name': u't3ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.21.2/24', u'tenant_ns_ip': u'10.2.21.1/24', u'tenant_ns_if': u't3s1if', u'tenant_sub_if': u's1if', u'tenant_ns_name': u't3'}], u'bridge_ip': u'1.1.1.1', u'vxlan': [{u'local_ip': u'10.2.21.2', u'dsport': 4789, u'dev': u's1if', u'tenant_route_ip': u'192.168.131.2', u'remote_route': u'10.1.21.0/24', u'subnet_route': u'10.2.21.0/24', u'v_name': u'vxlan_t3s1', u'id': 42, u'remote_ip': u'10.1.21.2'}]}, {u'mem': 2, u'name': u't3_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't3br1if1', u'vmif': u't3VM4if1'}]) => {"ansible_loop_var": "item", "changed": false, "create": 0, "item": [{"bridge_ip": "1.1.1.1", "bridge_name": "t3br1", "default_route_ip": "10.2.21.1", "dns": [{"brif": "t3s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t3s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "ns_name": "t3ns1", "route": [{"if": "p1", "ip": "10.2.21.1/24", "ns_if": "t3if", "ns_name": "t3"}], "tenant_ns": [{"tenant_ns_if": "t3s1if", "tenant_ns_ip": "10.2.21.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "s1if", "tenant_sub_ip": "10.2.21.2/24"}], "vxlan": [{"dev": "s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.21.2", "remote_ip": "10.1.21.2", "remote_route": "10.1.21.0/24", "subnet_route": "10.2.21.0/24", "tenant_route_ip": "192.168.131.2", "v_name": "vxlan_t3s1"}]}, {"brif": "t3br1if1", "disk": "10G", "mem": 2, "name": "t3_VM4", "vcpu": 4, "vmif": "t3VM4if1"}]}

TASK [Start VM] *********************************************************************************************************************************************
ok: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.21.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.2.21.1', u'bridge_name': u't3br1', u'dns': [{u'dnsif': u't3s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't3s1_dnsbrif'}], u'ns_name': u't3ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.21.2/24', u'tenant_ns_ip': u'10.2.21.1/24', u'tenant_ns_if': u't3s1if', u'tenant_sub_if': u's1if', u'tenant_ns_name': u't3'}], u'bridge_ip': u'1.1.1.1', u'vxlan': [{u'local_ip': u'10.2.21.2', u'dsport': 4789, u'dev': u's1if', u'tenant_route_ip': u'192.168.131.2', u'remote_route': u'10.1.21.0/24', u'subnet_route': u'10.2.21.0/24', u'v_name': u'vxlan_t3s1', u'id': 42, u'remote_ip': u'10.1.21.2'}]}, {u'mem': 2, u'name': u't3_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't3br1if1', u'vmif': u't3VM4if1'}]) => {"ansible_loop_var": "item", "changed": false, "item": [{"bridge_ip": "1.1.1.1", "bridge_name": "t3br1", "default_route_ip": "10.2.21.1", "dns": [{"brif": "t3s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t3s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "ns_name": "t3ns1", "route": [{"if": "p1", "ip": "10.2.21.1/24", "ns_if": "t3if", "ns_name": "t3"}], "tenant_ns": [{"tenant_ns_if": "t3s1if", "tenant_ns_ip": "10.2.21.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "s1if", "tenant_sub_ip": "10.2.21.2/24"}], "vxlan": [{"dev": "s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.21.2", "remote_ip": "10.1.21.2", "remote_route": "10.1.21.0/24", "subnet_route": "10.2.21.0/24", "tenant_route_ip": "192.168.131.2", "v_name": "vxlan_t3s1"}]}, {"brif": "t3br1if1", "disk": "10G", "mem": 2, "name": "t3_VM4", "vcpu": 4, "vmif": "t3VM4if1"}]}

TASK [Attach VM interface] **********************************************************************************************************************************
failed: [99.99.99.2] (item=[{u'route': [{u'ip': u'10.2.21.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.2.21.1', u'bridge_name': u't3br1', u'dns': [{u'dnsif': u't3s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't3s1_dnsbrif'}], u'ns_name': u't3ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.21.2/24', u'tenant_ns_ip': u'10.2.21.1/24', u'tenant_ns_if': u't3s1if', u'tenant_sub_if': u's1if', u'tenant_ns_name': u't3'}], u'bridge_ip': u'1.1.1.1', u'vxlan': [{u'local_ip': u'10.2.21.2', u'dsport': 4789, u'dev': u's1if', u'tenant_route_ip': u'192.168.131.2', u'remote_route': u'10.1.21.0/24', u'subnet_route': u'10.2.21.0/24', u'v_name': u'vxlan_t3s1', u'id': 42, u'remote_ip': u'10.1.21.2'}]}, {u'mem': 2, u'name': u't3_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't3br1if1', u'vmif': u't3VM4if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "virsh domiflist \"t3_VM4\" | grep -w 't3VM4if1' ; if [ $? -ne 0 ] ; then virsh attach-interface \"t3_VM4\" direct \"t3VM4if1\" --live --persistent ; fi\n", "delta": "0:00:00.059940", "end": "2019-11-17 08:57:30.667124", "item": [{"bridge_ip": "1.1.1.1", "bridge_name": "t3br1", "default_route_ip": "10.2.21.1", "dns": [{"brif": "t3s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t3s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "ns_name": "t3ns1", "route": [{"if": "p1", "ip": "10.2.21.1/24", "ns_if": "t3if", "ns_name": "t3"}], "tenant_ns": [{"tenant_ns_if": "t3s1if", "tenant_ns_ip": "10.2.21.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "s1if", "tenant_sub_ip": "10.2.21.2/24"}], "vxlan": [{"dev": "s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.21.2", "remote_ip": "10.1.21.2", "remote_route": "10.1.21.0/24", "subnet_route": "10.2.21.0/24", "tenant_route_ip": "192.168.131.2", "v_name": "vxlan_t3s1"}]}, {"brif": "t3br1if1", "disk": "10G", "mem": 2, "name": "t3_VM4", "vcpu": 4, "vmif": "t3VM4if1"}], "msg": "non-zero return code", "rc": 1, "start": "2019-11-17 08:57:30.607184", "stderr": "error: Failed to attach interface\nerror: Unable to get index for interface t3VM4if1: No such device", "stderr_lines": ["error: Failed to attach interface", "error: Unable to get index for interface t3VM4if1: No such device"], "stdout": "", "stdout_lines": []}

PLAY RECAP **************************************************************************************************************************************************
99.99.99.2                 : ok=5    changed=2    unreachable=0    failed=1    skipped=0    rescued=0    ignored=0   

INFO:root: 09:59:15.554162 {'C1': [{'subnet_addr': '1.1.1.0/24', 'VM': [{'name': 'VM1', 'disk': '10G', 'mem': 2, 'vcpu': 4}, {'name': 'VM2', 'disk': '10G', 'mem': 4, 'vcpu': 2}]}, {'subnet_addr': '2.2.2.0/24', 'VM': [{'name': 'VM3', 'disk': '10G', 'mem': 3, 'vcpu': 2}]}], 'C2': [{'subnet_addr': '1.1.1.0/24', 'VM': [{'name': 'VM4', 'disk': '10G', 'mem': 2, 'vcpu': 4}]}]}
INFO:root: 09:59:15.554891 Provided subnet in C1: 1.1.1.0/24 is valid
ERROR:root: 09:59:15.554956ERR: Multiple subnet in the C1 are same
Using /etc/ansible/ansible.cfg as config file

PLAY [main] *************************************************************************************************************************************************

TASK [Create Tenant Namespace] ******************************************************************************************************************************
changed: [localhost] => (item={u'default_route_ip': u'192.168.1.1', u'name': u't1', u'pns_ip': u'192.168.1.1/24', u'tenant_if': u't1if', u'tenant_ip': u'192.168.1.2/24', u'pns_if': u't1pns_if'}) => {"ansible_loop_var": "item", "changed": true, "cmd": ["ip", "netns", "add", "t1"], "delta": "0:00:00.052697", "end": "2019-11-17 09:59:16.948005", "item": {"default_route_ip": "192.168.1.1", "name": "t1", "pns_if": "t1pns_if", "pns_ip": "192.168.1.1/24", "tenant_if": "t1if", "tenant_ip": "192.168.1.2/24"}, "rc": 0, "start": "2019-11-17 09:59:16.895308", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Create Subnet Namespace] ******************************************************************************************************************************
changed: [localhost] => (item={u'route': [{u'ip': u'10.1.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.1.2/24', u'tenant_ns_ip': u'10.1.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_ns_name': u't1', u'tenant_sub_if': u't1s1if'}], u'bridge_ip': u'1.1.1.1', u'vms': [{u'mem': 2, u'name': u't1_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM1if1'}, {u'mem': 4, u'name': u't1_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br1if2', u'vmif': u't1VM2if1'}], u'vxlan': [{u'local_ip': u'10.1.1.2', u'tenant_route_ip': u'192.168.1.2', u'dsport': 4789, u'dev': u't1s1if', u'subnet_route': u'10.1.1.0/24', u'remote_route': u'10.2.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.2.1.2'}]}) => {"ansible_loop_var": "item", "changed": true, "cmd": ["ip", "netns", "add", "t1ns1"], "delta": "0:00:00.051571", "end": "2019-11-17 09:59:17.249671", "item": {"bridge_ip": "1.1.1.1", "bridge_name": "t1br1", "default_route_ip": "10.1.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.1.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.1.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.1.1.2/24"}], "vms": [{"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM1", "vcpu": 4, "vmif": "t1VM1if1"}, {"brif": "t1br1if2", "disk": "10G", "mem": 4, "name": "t1_VM2", "vcpu": 2, "vmif": "t1VM2if1"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.1.2", "remote_ip": "10.2.1.2", "remote_route": "10.2.1.0/24", "subnet_route": "10.1.1.0/24", "tenant_route_ip": "192.168.1.2", "v_name": "vxlan_t1s1"}]}, "rc": 0, "start": "2019-11-17 09:59:17.198100", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}
changed: [localhost] => (item={u'route': [{u'ip': u'10.1.2.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.2.1', u'bridge_name': u't1br2', u'dns': [{u'dnsif': u't1s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s2_dnsbrif'}], u'ns_name': u't1ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.2.2/24', u'tenant_ns_ip': u'10.1.2.1/24', u'tenant_ns_if': u't1ns2if', u'tenant_ns_name': u't1', u'tenant_sub_if': u't1s2if'}], u'bridge_ip': u'2.2.2.1', u'vms': [{u'mem': 3, u'name': u't1_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br2if1', u'vmif': u't1VM3if1'}], u'vxlan': [{u'local_ip': [], u'tenant_route_ip': [], u'dsport': [], u'dev': [], u'subnet_route': [], u'remote_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}) => {"ansible_loop_var": "item", "changed": true, "cmd": ["ip", "netns", "add", "t1ns2"], "delta": "0:00:00.054257", "end": "2019-11-17 09:59:17.535822", "item": {"bridge_ip": "2.2.2.1", "bridge_name": "t1br2", "default_route_ip": "10.1.2.1", "dns": [{"brif": "t1s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t1s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns2", "route": [{"if": "p1", "ip": "10.1.2.1/24", "ns_if": "t1if", "ns_name": "t1"}], "tenant_ns": [{"tenant_ns_if": "t1ns2if", "tenant_ns_ip": "10.1.2.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s2if", "tenant_sub_ip": "10.1.2.2/24"}], "vms": [{"brif": "t1br2if1", "disk": "10G", "mem": 3, "name": "t1_VM3", "vcpu": 2, "vmif": "t1VM3if1"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, "rc": 0, "start": "2019-11-17 09:59:17.481565", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Create Tenant VETH pairs] *****************************************************************************************************************************
changed: [localhost] => (item={u'default_route_ip': u'192.168.1.1', u'name': u't1', u'pns_ip': u'192.168.1.1/24', u'tenant_if': u't1if', u'tenant_ip': u'192.168.1.2/24', u'pns_if': u't1pns_if'}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip link show \"t1if\" ; if [ $? -ne 0 ] ; then ip link add \"t1if\" type veth peer name \"t1pns_if\" ; fi\n", "delta": "0:00:00.013368", "end": "2019-11-17 09:59:17.822796", "item": {"default_route_ip": "192.168.1.1", "name": "t1", "pns_if": "t1pns_if", "pns_ip": "192.168.1.1/24", "tenant_if": "t1if", "tenant_ip": "192.168.1.2/24"}, "rc": 0, "start": "2019-11-17 09:59:17.809428", "stderr": "Device \"t1if\" does not exist.", "stderr_lines": ["Device \"t1if\" does not exist."], "stdout": "", "stdout_lines": []}

TASK [Attach Tenant VETH Pairs] *****************************************************************************************************************************
changed: [localhost] => (item={u'default_route_ip': u'192.168.1.1', u'name': u't1', u'pns_ip': u'192.168.1.1/24', u'tenant_if': u't1if', u'tenant_ip': u'192.168.1.2/24', u'pns_if': u't1pns_if'}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec pns ip link show \"t1pns_if\" ; if [ $? -ne 0 ] ; then ip link set \"t1pns_if\" netns pns ; fi\nip netns exec \"t1\" ip link show \"t1if\" ; if [ $? -ne 0 ] ; then ip link set \"t1if\" netns \"t1\" ; fi\nip netns exec pns ip link set dev \"t1pns_if\" up\nip netns exec \"t1\" ip link set dev \"t1if\" up\n", "delta": "0:00:00.207136", "end": "2019-11-17 09:59:18.303572", "item": {"default_route_ip": "192.168.1.1", "name": "t1", "pns_if": "t1pns_if", "pns_ip": "192.168.1.1/24", "tenant_if": "t1if", "tenant_ip": "192.168.1.2/24"}, "rc": 0, "start": "2019-11-17 09:59:18.096436", "stderr": "Device \"t1pns_if\" does not exist.\nDevice \"t1if\" does not exist.", "stderr_lines": ["Device \"t1pns_if\" does not exist.", "Device \"t1if\" does not exist."], "stdout": "", "stdout_lines": []}

TASK [Add IP addresses to Tenant VETH Pairs] ****************************************************************************************************************
changed: [localhost] => (item={u'default_route_ip': u'192.168.1.1', u'name': u't1', u'pns_ip': u'192.168.1.1/24', u'tenant_if': u't1if', u'tenant_ip': u'192.168.1.2/24', u'pns_if': u't1pns_if'}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec pns ip addr show \"t1pns_if\" | awk 'FNR==3{ print $2 }' | grep -w '^192.168.1.1/24' ; if [ $? -ne 0 ] ; then ip netns exec pns ip addr add \"192.168.1.1/24\" dev \"t1pns_if\" ; fi\nip netns exec \"t1\" ip addr show \"t1if\" | awk 'FNR==3{ print $2 }' | grep -w '^192.168.1.2/24' ; if [ $? -ne 0 ] ; then ip netns exec \"t1\" ip addr add \"192.168.1.2/24\" dev \"t1if\" ; fi\n", "delta": "0:00:00.132982", "end": "2019-11-17 09:59:18.687454", "item": {"default_route_ip": "192.168.1.1", "name": "t1", "pns_if": "t1pns_if", "pns_ip": "192.168.1.1/24", "tenant_if": "t1if", "tenant_ip": "192.168.1.2/24"}, "rc": 0, "start": "2019-11-17 09:59:18.554472", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Create Namespace VETH Pairs] **************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'bridge_ip': u'1.1.1.1', u'vms': [{u'mem': 2, u'name': u't1_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM1if1'}, {u'mem': 4, u'name': u't1_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br1if2', u'vmif': u't1VM2if1'}], u'vxlan': [{u'local_ip': u'10.1.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.1.2', u'remote_route': u'10.2.1.0/24', u'subnet_route': u'10.1.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.2.1.2'}]}, {u'tenant_sub_ip': u'10.1.1.2/24', u'tenant_ns_ip': u'10.1.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip link show \"t1ns1if\" ; if [ $? -ne 0 ] ; then ip link add \"t1ns1if\" type veth peer name \"t1s1if\" ; fi\n", "delta": "0:00:00.008513", "end": "2019-11-17 09:59:18.937464", "item": [{"bridge_ip": "1.1.1.1", "bridge_name": "t1br1", "default_route_ip": "10.1.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.1.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "vms": [{"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM1", "vcpu": 4, "vmif": "t1VM1if1"}, {"brif": "t1br1if2", "disk": "10G", "mem": 4, "name": "t1_VM2", "vcpu": 2, "vmif": "t1VM2if1"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.1.2", "remote_ip": "10.2.1.2", "remote_route": "10.2.1.0/24", "subnet_route": "10.1.1.0/24", "tenant_route_ip": "192.168.1.2", "v_name": "vxlan_t1s1"}]}, {"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.1.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.1.1.2/24"}], "rc": 0, "start": "2019-11-17 09:59:18.928951", "stderr": "Device \"t1ns1if\" does not exist.", "stderr_lines": ["Device \"t1ns1if\" does not exist."], "stdout": "", "stdout_lines": []}
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.2.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.2.1', u'bridge_name': u't1br2', u'dns': [{u'dnsif': u't1s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s2_dnsbrif'}], u'ns_name': u't1ns2', u'bridge_ip': u'2.2.2.1', u'vms': [{u'mem': 3, u'name': u't1_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br2if1', u'vmif': u't1VM3if1'}], u'vxlan': [{u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}, {u'tenant_sub_ip': u'10.1.2.2/24', u'tenant_ns_ip': u'10.1.2.1/24', u'tenant_ns_if': u't1ns2if', u'tenant_sub_if': u't1s2if', u'tenant_ns_name': u't1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip link show \"t1ns2if\" ; if [ $? -ne 0 ] ; then ip link add \"t1ns2if\" type veth peer name \"t1s2if\" ; fi\n", "delta": "0:00:00.010696", "end": "2019-11-17 09:59:19.146376", "item": [{"bridge_ip": "2.2.2.1", "bridge_name": "t1br2", "default_route_ip": "10.1.2.1", "dns": [{"brif": "t1s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t1s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns2", "route": [{"if": "p1", "ip": "10.1.2.1/24", "ns_if": "t1if", "ns_name": "t1"}], "vms": [{"brif": "t1br2if1", "disk": "10G", "mem": 3, "name": "t1_VM3", "vcpu": 2, "vmif": "t1VM3if1"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, {"tenant_ns_if": "t1ns2if", "tenant_ns_ip": "10.1.2.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s2if", "tenant_sub_ip": "10.1.2.2/24"}], "rc": 0, "start": "2019-11-17 09:59:19.135680", "stderr": "Device \"t1ns2if\" does not exist.", "stderr_lines": ["Device \"t1ns2if\" does not exist."], "stdout": "", "stdout_lines": []}

TASK [Attach Namespace VETH Pairs] **************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'bridge_ip': u'1.1.1.1', u'vms': [{u'mem': 2, u'name': u't1_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM1if1'}, {u'mem': 4, u'name': u't1_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br1if2', u'vmif': u't1VM2if1'}], u'vxlan': [{u'local_ip': u'10.1.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.1.2', u'remote_route': u'10.2.1.0/24', u'subnet_route': u'10.1.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.2.1.2'}]}, {u'tenant_sub_ip': u'10.1.1.2/24', u'tenant_ns_ip': u'10.1.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t1\" ip link show \"t1ns1if\" ; if [ $? -ne 0 ] ; then ip link set \"t1ns1if\" netns \"t1\" ; fi\nip netns exec \"t1ns1\" ip link show \"t1s1if\" ; if [ $? -ne 0 ] ; then ip link set \"t1s1if\" netns \"t1ns1\" ; fi\n", "delta": "0:00:00.136332", "end": "2019-11-17 09:59:19.561622", "item": [{"bridge_ip": "1.1.1.1", "bridge_name": "t1br1", "default_route_ip": "10.1.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.1.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "vms": [{"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM1", "vcpu": 4, "vmif": "t1VM1if1"}, {"brif": "t1br1if2", "disk": "10G", "mem": 4, "name": "t1_VM2", "vcpu": 2, "vmif": "t1VM2if1"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.1.2", "remote_ip": "10.2.1.2", "remote_route": "10.2.1.0/24", "subnet_route": "10.1.1.0/24", "tenant_route_ip": "192.168.1.2", "v_name": "vxlan_t1s1"}]}, {"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.1.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.1.1.2/24"}], "rc": 0, "start": "2019-11-17 09:59:19.425290", "stderr": "Device \"t1ns1if\" does not exist.\nDevice \"t1s1if\" does not exist.", "stderr_lines": ["Device \"t1ns1if\" does not exist.", "Device \"t1s1if\" does not exist."], "stdout": "", "stdout_lines": []}
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.2.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.2.1', u'bridge_name': u't1br2', u'dns': [{u'dnsif': u't1s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s2_dnsbrif'}], u'ns_name': u't1ns2', u'bridge_ip': u'2.2.2.1', u'vms': [{u'mem': 3, u'name': u't1_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br2if1', u'vmif': u't1VM3if1'}], u'vxlan': [{u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}, {u'tenant_sub_ip': u'10.1.2.2/24', u'tenant_ns_ip': u'10.1.2.1/24', u'tenant_ns_if': u't1ns2if', u'tenant_sub_if': u't1s2if', u'tenant_ns_name': u't1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t1\" ip link show \"t1ns2if\" ; if [ $? -ne 0 ] ; then ip link set \"t1ns2if\" netns \"t1\" ; fi\nip netns exec \"t1ns2\" ip link show \"t1s2if\" ; if [ $? -ne 0 ] ; then ip link set \"t1s2if\" netns \"t1ns2\" ; fi\n", "delta": "0:00:00.142922", "end": "2019-11-17 09:59:19.908628", "item": [{"bridge_ip": "2.2.2.1", "bridge_name": "t1br2", "default_route_ip": "10.1.2.1", "dns": [{"brif": "t1s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t1s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns2", "route": [{"if": "p1", "ip": "10.1.2.1/24", "ns_if": "t1if", "ns_name": "t1"}], "vms": [{"brif": "t1br2if1", "disk": "10G", "mem": 3, "name": "t1_VM3", "vcpu": 2, "vmif": "t1VM3if1"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, {"tenant_ns_if": "t1ns2if", "tenant_ns_ip": "10.1.2.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s2if", "tenant_sub_ip": "10.1.2.2/24"}], "rc": 0, "start": "2019-11-17 09:59:19.765706", "stderr": "Device \"t1ns2if\" does not exist.\nDevice \"t1s2if\" does not exist.", "stderr_lines": ["Device \"t1ns2if\" does not exist.", "Device \"t1s2if\" does not exist."], "stdout": "", "stdout_lines": []}

TASK [Set Namespace VETH Pairs UP] **************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'bridge_ip': u'1.1.1.1', u'vms': [{u'mem': 2, u'name': u't1_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM1if1'}, {u'mem': 4, u'name': u't1_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br1if2', u'vmif': u't1VM2if1'}], u'vxlan': [{u'local_ip': u'10.1.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.1.2', u'remote_route': u'10.2.1.0/24', u'subnet_route': u'10.1.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.2.1.2'}]}, {u'tenant_sub_ip': u'10.1.1.2/24', u'tenant_ns_ip': u'10.1.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t1\" ip link set dev \"t1ns1if\" up\nip netns exec \"t1ns1\" ip link set dev \"t1s1if\" up\n", "delta": "0:00:00.068527", "end": "2019-11-17 09:59:20.243679", "item": [{"bridge_ip": "1.1.1.1", "bridge_name": "t1br1", "default_route_ip": "10.1.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.1.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "vms": [{"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM1", "vcpu": 4, "vmif": "t1VM1if1"}, {"brif": "t1br1if2", "disk": "10G", "mem": 4, "name": "t1_VM2", "vcpu": 2, "vmif": "t1VM2if1"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.1.2", "remote_ip": "10.2.1.2", "remote_route": "10.2.1.0/24", "subnet_route": "10.1.1.0/24", "tenant_route_ip": "192.168.1.2", "v_name": "vxlan_t1s1"}]}, {"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.1.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.1.1.2/24"}], "rc": 0, "start": "2019-11-17 09:59:20.175152", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.2.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.2.1', u'bridge_name': u't1br2', u'dns': [{u'dnsif': u't1s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s2_dnsbrif'}], u'ns_name': u't1ns2', u'bridge_ip': u'2.2.2.1', u'vms': [{u'mem': 3, u'name': u't1_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br2if1', u'vmif': u't1VM3if1'}], u'vxlan': [{u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}, {u'tenant_sub_ip': u'10.1.2.2/24', u'tenant_ns_ip': u'10.1.2.1/24', u'tenant_ns_if': u't1ns2if', u'tenant_sub_if': u't1s2if', u'tenant_ns_name': u't1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t1\" ip link set dev \"t1ns2if\" up\nip netns exec \"t1ns2\" ip link set dev \"t1s2if\" up\n", "delta": "0:00:00.068646", "end": "2019-11-17 09:59:20.531802", "item": [{"bridge_ip": "2.2.2.1", "bridge_name": "t1br2", "default_route_ip": "10.1.2.1", "dns": [{"brif": "t1s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t1s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns2", "route": [{"if": "p1", "ip": "10.1.2.1/24", "ns_if": "t1if", "ns_name": "t1"}], "vms": [{"brif": "t1br2if1", "disk": "10G", "mem": 3, "name": "t1_VM3", "vcpu": 2, "vmif": "t1VM3if1"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, {"tenant_ns_if": "t1ns2if", "tenant_ns_ip": "10.1.2.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s2if", "tenant_sub_ip": "10.1.2.2/24"}], "rc": 0, "start": "2019-11-17 09:59:20.463156", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Add IP addresses to Namespace VETH Pairs] *************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'bridge_ip': u'1.1.1.1', u'vms': [{u'mem': 2, u'name': u't1_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM1if1'}, {u'mem': 4, u'name': u't1_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br1if2', u'vmif': u't1VM2if1'}], u'vxlan': [{u'local_ip': u'10.1.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.1.2', u'remote_route': u'10.2.1.0/24', u'subnet_route': u'10.1.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.2.1.2'}]}, {u'tenant_sub_ip': u'10.1.1.2/24', u'tenant_ns_ip': u'10.1.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t1ns1\" ip addr show \"t1s1if\" | awk 'FNR==3{ print $2 }' | grep -w '^10.1.1.2/24' ; if [ $? -ne 0 ] ; then ip netns exec \"t1ns1\" ip addr add \"10.1.1.2/24\" dev \"t1s1if\" ; fi\n\nip netns exec \"t1\" ip addr show \"t1ns1if\" | awk 'FNR==3{ print $2 }' | grep -w '^10.1.1.1/24' ; if [ $? -ne 0 ] ; then ip netns exec \"t1\" ip addr add \"10.1.1.1/24\" dev \"t1ns1if\" ; fi\n", "delta": "0:00:00.157015", "end": "2019-11-17 09:59:20.955722", "item": [{"bridge_ip": "1.1.1.1", "bridge_name": "t1br1", "default_route_ip": "10.1.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.1.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "vms": [{"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM1", "vcpu": 4, "vmif": "t1VM1if1"}, {"brif": "t1br1if2", "disk": "10G", "mem": 4, "name": "t1_VM2", "vcpu": 2, "vmif": "t1VM2if1"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.1.2", "remote_ip": "10.2.1.2", "remote_route": "10.2.1.0/24", "subnet_route": "10.1.1.0/24", "tenant_route_ip": "192.168.1.2", "v_name": "vxlan_t1s1"}]}, {"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.1.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.1.1.2/24"}], "rc": 0, "start": "2019-11-17 09:59:20.798707", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.2.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.2.1', u'bridge_name': u't1br2', u'dns': [{u'dnsif': u't1s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s2_dnsbrif'}], u'ns_name': u't1ns2', u'bridge_ip': u'2.2.2.1', u'vms': [{u'mem': 3, u'name': u't1_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br2if1', u'vmif': u't1VM3if1'}], u'vxlan': [{u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}, {u'tenant_sub_ip': u'10.1.2.2/24', u'tenant_ns_ip': u'10.1.2.1/24', u'tenant_ns_if': u't1ns2if', u'tenant_sub_if': u't1s2if', u'tenant_ns_name': u't1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t1ns2\" ip addr show \"t1s2if\" | awk 'FNR==3{ print $2 }' | grep -w '^10.1.2.2/24' ; if [ $? -ne 0 ] ; then ip netns exec \"t1ns2\" ip addr add \"10.1.2.2/24\" dev \"t1s2if\" ; fi\n\nip netns exec \"t1\" ip addr show \"t1ns2if\" | awk 'FNR==3{ print $2 }' | grep -w '^10.1.2.1/24' ; if [ $? -ne 0 ] ; then ip netns exec \"t1\" ip addr add \"10.1.2.1/24\" dev \"t1ns2if\" ; fi\n", "delta": "0:00:00.143398", "end": "2019-11-17 09:59:21.291598", "item": [{"bridge_ip": "2.2.2.1", "bridge_name": "t1br2", "default_route_ip": "10.1.2.1", "dns": [{"brif": "t1s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t1s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns2", "route": [{"if": "p1", "ip": "10.1.2.1/24", "ns_if": "t1if", "ns_name": "t1"}], "vms": [{"brif": "t1br2if1", "disk": "10G", "mem": 3, "name": "t1_VM3", "vcpu": 2, "vmif": "t1VM3if1"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, {"tenant_ns_if": "t1ns2if", "tenant_ns_ip": "10.1.2.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s2if", "tenant_sub_ip": "10.1.2.2/24"}], "rc": 0, "start": "2019-11-17 09:59:21.148200", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Add IP Route to Tenant] *******************************************************************************************************************************
changed: [localhost] => (item={u'default_route_ip': u'192.168.1.1', u'name': u't1', u'pns_ip': u'192.168.1.1/24', u'tenant_if': u't1if', u'tenant_ip': u'192.168.1.2/24', u'pns_if': u't1pns_if'}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t1\" ip route show default | grep -w '[d]efault via 192.168.1.1' ; if [ $? -ne 0 ] ; then ip netns exec \"t1\" ip route add default via \"192.168.1.1\" ; fi\n", "delta": "0:00:00.077275", "end": "2019-11-17 09:59:21.611717", "item": {"default_route_ip": "192.168.1.1", "name": "t1", "pns_if": "t1pns_if", "pns_ip": "192.168.1.1/24", "tenant_if": "t1if", "tenant_ip": "192.168.1.2/24"}, "rc": 0, "start": "2019-11-17 09:59:21.534442", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Add IP Route to Tenant Subnet] ************************************************************************************************************************
changed: [localhost] => (item={u'route': [{u'ip': u'10.1.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.1.2/24', u'tenant_ns_ip': u'10.1.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_ns_name': u't1', u'tenant_sub_if': u't1s1if'}], u'bridge_ip': u'1.1.1.1', u'vms': [{u'mem': 2, u'name': u't1_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM1if1'}, {u'mem': 4, u'name': u't1_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br1if2', u'vmif': u't1VM2if1'}], u'vxlan': [{u'local_ip': u'10.1.1.2', u'tenant_route_ip': u'192.168.1.2', u'dsport': 4789, u'dev': u't1s1if', u'subnet_route': u'10.1.1.0/24', u'remote_route': u'10.2.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.2.1.2'}]}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t1ns1\" ip route show default | grep -w '[d]efault via 10.1.1.1' ; if [ $? -ne 0 ] ; then ip netns exec \"t1ns1\" ip route add default via \"10.1.1.1\" ; fi\n", "delta": "0:00:00.075762", "end": "2019-11-17 09:59:21.943801", "item": {"bridge_ip": "1.1.1.1", "bridge_name": "t1br1", "default_route_ip": "10.1.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.1.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.1.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.1.1.2/24"}], "vms": [{"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM1", "vcpu": 4, "vmif": "t1VM1if1"}, {"brif": "t1br1if2", "disk": "10G", "mem": 4, "name": "t1_VM2", "vcpu": 2, "vmif": "t1VM2if1"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.1.2", "remote_ip": "10.2.1.2", "remote_route": "10.2.1.0/24", "subnet_route": "10.1.1.0/24", "tenant_route_ip": "192.168.1.2", "v_name": "vxlan_t1s1"}]}, "rc": 0, "start": "2019-11-17 09:59:21.868039", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}
changed: [localhost] => (item={u'route': [{u'ip': u'10.1.2.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.2.1', u'bridge_name': u't1br2', u'dns': [{u'dnsif': u't1s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s2_dnsbrif'}], u'ns_name': u't1ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.2.2/24', u'tenant_ns_ip': u'10.1.2.1/24', u'tenant_ns_if': u't1ns2if', u'tenant_ns_name': u't1', u'tenant_sub_if': u't1s2if'}], u'bridge_ip': u'2.2.2.1', u'vms': [{u'mem': 3, u'name': u't1_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br2if1', u'vmif': u't1VM3if1'}], u'vxlan': [{u'local_ip': [], u'tenant_route_ip': [], u'dsport': [], u'dev': [], u'subnet_route': [], u'remote_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t1ns2\" ip route show default | grep -w '[d]efault via 10.1.2.1' ; if [ $? -ne 0 ] ; then ip netns exec \"t1ns2\" ip route add default via \"10.1.2.1\" ; fi\n", "delta": "0:00:00.078276", "end": "2019-11-17 09:59:22.243882", "item": {"bridge_ip": "2.2.2.1", "bridge_name": "t1br2", "default_route_ip": "10.1.2.1", "dns": [{"brif": "t1s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t1s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns2", "route": [{"if": "p1", "ip": "10.1.2.1/24", "ns_if": "t1if", "ns_name": "t1"}], "tenant_ns": [{"tenant_ns_if": "t1ns2if", "tenant_ns_ip": "10.1.2.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s2if", "tenant_sub_ip": "10.1.2.2/24"}], "vms": [{"brif": "t1br2if1", "disk": "10G", "mem": 3, "name": "t1_VM3", "vcpu": 2, "vmif": "t1VM3if1"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, "rc": 0, "start": "2019-11-17 09:59:22.165606", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Create bridge inside namespace] ***********************************************************************************************************************
changed: [localhost] => (item={u'route': [{u'ip': u'10.1.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.1.2/24', u'tenant_ns_ip': u'10.1.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_ns_name': u't1', u'tenant_sub_if': u't1s1if'}], u'bridge_ip': u'1.1.1.1', u'vms': [{u'mem': 2, u'name': u't1_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM1if1'}, {u'mem': 4, u'name': u't1_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br1if2', u'vmif': u't1VM2if1'}], u'vxlan': [{u'local_ip': u'10.1.1.2', u'tenant_route_ip': u'192.168.1.2', u'dsport': 4789, u'dev': u't1s1if', u'subnet_route': u'10.1.1.0/24', u'remote_route': u'10.2.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.2.1.2'}]}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t1ns1\" brctl show | grep -w '^t1br1'; if [ $? -ne 0 ] ; then ip netns exec \"t1ns1\" brctl addbr \"t1br1\" ; fi\nip netns exec \"t1ns1\" ip link set dev \"t1br1\" up\n", "delta": "0:00:00.098243", "end": "2019-11-17 09:59:22.611747", "item": {"bridge_ip": "1.1.1.1", "bridge_name": "t1br1", "default_route_ip": "10.1.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.1.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.1.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.1.1.2/24"}], "vms": [{"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM1", "vcpu": 4, "vmif": "t1VM1if1"}, {"brif": "t1br1if2", "disk": "10G", "mem": 4, "name": "t1_VM2", "vcpu": 2, "vmif": "t1VM2if1"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.1.2", "remote_ip": "10.2.1.2", "remote_route": "10.2.1.0/24", "subnet_route": "10.1.1.0/24", "tenant_route_ip": "192.168.1.2", "v_name": "vxlan_t1s1"}]}, "rc": 0, "start": "2019-11-17 09:59:22.513504", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}
changed: [localhost] => (item={u'route': [{u'ip': u'10.1.2.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.2.1', u'bridge_name': u't1br2', u'dns': [{u'dnsif': u't1s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s2_dnsbrif'}], u'ns_name': u't1ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.2.2/24', u'tenant_ns_ip': u'10.1.2.1/24', u'tenant_ns_if': u't1ns2if', u'tenant_ns_name': u't1', u'tenant_sub_if': u't1s2if'}], u'bridge_ip': u'2.2.2.1', u'vms': [{u'mem': 3, u'name': u't1_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br2if1', u'vmif': u't1VM3if1'}], u'vxlan': [{u'local_ip': [], u'tenant_route_ip': [], u'dsport': [], u'dev': [], u'subnet_route': [], u'remote_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t1ns2\" brctl show | grep -w '^t1br2'; if [ $? -ne 0 ] ; then ip netns exec \"t1ns2\" brctl addbr \"t1br2\" ; fi\nip netns exec \"t1ns2\" ip link set dev \"t1br2\" up\n", "delta": "0:00:00.102094", "end": "2019-11-17 09:59:22.915740", "item": {"bridge_ip": "2.2.2.1", "bridge_name": "t1br2", "default_route_ip": "10.1.2.1", "dns": [{"brif": "t1s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t1s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns2", "route": [{"if": "p1", "ip": "10.1.2.1/24", "ns_if": "t1if", "ns_name": "t1"}], "tenant_ns": [{"tenant_ns_if": "t1ns2if", "tenant_ns_ip": "10.1.2.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s2if", "tenant_sub_ip": "10.1.2.2/24"}], "vms": [{"brif": "t1br2if1", "disk": "10G", "mem": 3, "name": "t1_VM3", "vcpu": 2, "vmif": "t1VM3if1"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, "rc": 0, "start": "2019-11-17 09:59:22.813646", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Create DNS VETH Pair] *********************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.1.1', u'bridge_name': u't1br1', u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.1.2/24', u'tenant_ns_ip': u'10.1.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}], u'bridge_ip': u'1.1.1.1', u'vms': [{u'mem': 2, u'name': u't1_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM1if1'}, {u'mem': 4, u'name': u't1_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br1if2', u'vmif': u't1VM2if1'}], u'vxlan': [{u'local_ip': u'10.1.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.1.2', u'remote_route': u'10.2.1.0/24', u'subnet_route': u'10.1.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.2.1.2'}]}, {u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t1ns1\" ip link show \"t1s1_dnsbrif\" ; if [ $? -ne 0 ] ; then ip netns exec \"t1ns1\" ip link add \"t1s1_dnsbrif\" type veth peer name \"t1s1_dnsif\" ; fi\nip netns exec \"t1ns1\" ip link set dev \"t1s1_dnsbrif\" up\nip netns exec \"t1ns1\" ip link set dev \"t1s1_dnsif\" up\n", "delta": "0:00:00.120001", "end": "2019-11-17 09:59:23.303724", "item": [{"bridge_ip": "1.1.1.1", "bridge_name": "t1br1", "default_route_ip": "10.1.1.1", "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.1.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.1.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.1.1.2/24"}], "vms": [{"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM1", "vcpu": 4, "vmif": "t1VM1if1"}, {"brif": "t1br1if2", "disk": "10G", "mem": 4, "name": "t1_VM2", "vcpu": 2, "vmif": "t1VM2if1"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.1.2", "remote_ip": "10.2.1.2", "remote_route": "10.2.1.0/24", "subnet_route": "10.1.1.0/24", "tenant_route_ip": "192.168.1.2", "v_name": "vxlan_t1s1"}]}, {"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "rc": 0, "start": "2019-11-17 09:59:23.183723", "stderr": "Device \"t1s1_dnsbrif\" does not exist.", "stderr_lines": ["Device \"t1s1_dnsbrif\" does not exist."], "stdout": "", "stdout_lines": []}
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.2.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.2.1', u'bridge_name': u't1br2', u'ns_name': u't1ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.2.2/24', u'tenant_ns_ip': u'10.1.2.1/24', u'tenant_ns_if': u't1ns2if', u'tenant_sub_if': u't1s2if', u'tenant_ns_name': u't1'}], u'bridge_ip': u'2.2.2.1', u'vms': [{u'mem': 3, u'name': u't1_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br2if1', u'vmif': u't1VM3if1'}], u'vxlan': [{u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}, {u'dnsif': u't1s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s2_dnsbrif'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t1ns2\" ip link show \"t1s2_dnsbrif\" ; if [ $? -ne 0 ] ; then ip netns exec \"t1ns2\" ip link add \"t1s2_dnsbrif\" type veth peer name \"t1s2_dnsif\" ; fi\nip netns exec \"t1ns2\" ip link set dev \"t1s2_dnsbrif\" up\nip netns exec \"t1ns2\" ip link set dev \"t1s2_dnsif\" up\n", "delta": "0:00:00.137248", "end": "2019-11-17 09:59:23.647724", "item": [{"bridge_ip": "2.2.2.1", "bridge_name": "t1br2", "default_route_ip": "10.1.2.1", "ns_name": "t1ns2", "route": [{"if": "p1", "ip": "10.1.2.1/24", "ns_if": "t1if", "ns_name": "t1"}], "tenant_ns": [{"tenant_ns_if": "t1ns2if", "tenant_ns_ip": "10.1.2.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s2if", "tenant_sub_ip": "10.1.2.2/24"}], "vms": [{"brif": "t1br2if1", "disk": "10G", "mem": 3, "name": "t1_VM3", "vcpu": 2, "vmif": "t1VM3if1"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, {"brif": "t1s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t1s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "rc": 0, "start": "2019-11-17 09:59:23.510476", "stderr": "Device \"t1s2_dnsbrif\" does not exist.", "stderr_lines": ["Device \"t1s2_dnsbrif\" does not exist."], "stdout": "", "stdout_lines": []}

TASK [Attach DNS VETH Pair] *********************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.1.1', u'bridge_name': u't1br1', u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.1.2/24', u'tenant_ns_ip': u'10.1.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}], u'bridge_ip': u'1.1.1.1', u'vms': [{u'mem': 2, u'name': u't1_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM1if1'}, {u'mem': 4, u'name': u't1_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br1if2', u'vmif': u't1VM2if1'}], u'vxlan': [{u'local_ip': u'10.1.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.1.2', u'remote_route': u'10.2.1.0/24', u'subnet_route': u'10.1.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.2.1.2'}]}, {u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t1ns1\" brctl show \"t1br1\" | grep -w 't1s1_dnsbrif' ; if [ $? -ne 0 ] ; then ip netns exec \"t1ns1\" brctl addif \"t1br1\" \"t1s1_dnsbrif\" ; fi\n", "delta": "0:00:00.085382", "end": "2019-11-17 09:59:23.999676", "item": [{"bridge_ip": "1.1.1.1", "bridge_name": "t1br1", "default_route_ip": "10.1.1.1", "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.1.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.1.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.1.1.2/24"}], "vms": [{"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM1", "vcpu": 4, "vmif": "t1VM1if1"}, {"brif": "t1br1if2", "disk": "10G", "mem": 4, "name": "t1_VM2", "vcpu": 2, "vmif": "t1VM2if1"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.1.2", "remote_ip": "10.2.1.2", "remote_route": "10.2.1.0/24", "subnet_route": "10.1.1.0/24", "tenant_route_ip": "192.168.1.2", "v_name": "vxlan_t1s1"}]}, {"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "rc": 0, "start": "2019-11-17 09:59:23.914294", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.2.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.2.1', u'bridge_name': u't1br2', u'ns_name': u't1ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.2.2/24', u'tenant_ns_ip': u'10.1.2.1/24', u'tenant_ns_if': u't1ns2if', u'tenant_sub_if': u't1s2if', u'tenant_ns_name': u't1'}], u'bridge_ip': u'2.2.2.1', u'vms': [{u'mem': 3, u'name': u't1_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br2if1', u'vmif': u't1VM3if1'}], u'vxlan': [{u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}, {u'dnsif': u't1s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s2_dnsbrif'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t1ns2\" brctl show \"t1br2\" | grep -w 't1s2_dnsbrif' ; if [ $? -ne 0 ] ; then ip netns exec \"t1ns2\" brctl addif \"t1br2\" \"t1s2_dnsbrif\" ; fi\n", "delta": "0:00:00.070552", "end": "2019-11-17 09:59:24.263760", "item": [{"bridge_ip": "2.2.2.1", "bridge_name": "t1br2", "default_route_ip": "10.1.2.1", "ns_name": "t1ns2", "route": [{"if": "p1", "ip": "10.1.2.1/24", "ns_if": "t1if", "ns_name": "t1"}], "tenant_ns": [{"tenant_ns_if": "t1ns2if", "tenant_ns_ip": "10.1.2.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s2if", "tenant_sub_ip": "10.1.2.2/24"}], "vms": [{"brif": "t1br2if1", "disk": "10G", "mem": 3, "name": "t1_VM3", "vcpu": 2, "vmif": "t1VM3if1"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, {"brif": "t1s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t1s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "rc": 0, "start": "2019-11-17 09:59:24.193208", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Create VETH Pairs] ************************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.1.2/24', u'tenant_ns_ip': u'10.1.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}], u'bridge_ip': u'1.1.1.1', u'vxlan': [{u'local_ip': u'10.1.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.1.2', u'remote_route': u'10.2.1.0/24', u'subnet_route': u'10.1.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.2.1.2'}]}, {u'mem': 2, u'name': u't1_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM1if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip link show \"t1br1if1\" ; if [ $? -ne 0 ] ; then ip link add \"t1VM1if1\" type veth peer name \"t1br1if1\" ; fi\nip link set dev \"t1br1if1\" up\nip link set dev \"t1VM1if1\" up\n", "delta": "0:00:00.015480", "end": "2019-11-17 09:59:24.517415", "item": [{"bridge_ip": "1.1.1.1", "bridge_name": "t1br1", "default_route_ip": "10.1.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.1.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.1.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.1.1.2/24"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.1.2", "remote_ip": "10.2.1.2", "remote_route": "10.2.1.0/24", "subnet_route": "10.1.1.0/24", "tenant_route_ip": "192.168.1.2", "v_name": "vxlan_t1s1"}]}, {"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM1", "vcpu": 4, "vmif": "t1VM1if1"}], "rc": 0, "start": "2019-11-17 09:59:24.501935", "stderr": "Device \"t1br1if1\" does not exist.", "stderr_lines": ["Device \"t1br1if1\" does not exist."], "stdout": "", "stdout_lines": []}
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.1.2/24', u'tenant_ns_ip': u'10.1.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}], u'bridge_ip': u'1.1.1.1', u'vxlan': [{u'local_ip': u'10.1.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.1.2', u'remote_route': u'10.2.1.0/24', u'subnet_route': u'10.1.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.2.1.2'}]}, {u'mem': 4, u'name': u't1_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br1if2', u'vmif': u't1VM2if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip link show \"t1br1if2\" ; if [ $? -ne 0 ] ; then ip link add \"t1VM2if1\" type veth peer name \"t1br1if2\" ; fi\nip link set dev \"t1br1if2\" up\nip link set dev \"t1VM2if1\" up\n", "delta": "0:00:00.016814", "end": "2019-11-17 09:59:24.757236", "item": [{"bridge_ip": "1.1.1.1", "bridge_name": "t1br1", "default_route_ip": "10.1.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.1.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.1.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.1.1.2/24"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.1.2", "remote_ip": "10.2.1.2", "remote_route": "10.2.1.0/24", "subnet_route": "10.1.1.0/24", "tenant_route_ip": "192.168.1.2", "v_name": "vxlan_t1s1"}]}, {"brif": "t1br1if2", "disk": "10G", "mem": 4, "name": "t1_VM2", "vcpu": 2, "vmif": "t1VM2if1"}], "rc": 0, "start": "2019-11-17 09:59:24.740422", "stderr": "Device \"t1br1if2\" does not exist.", "stderr_lines": ["Device \"t1br1if2\" does not exist."], "stdout": "", "stdout_lines": []}
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.2.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.2.1', u'bridge_name': u't1br2', u'dns': [{u'dnsif': u't1s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s2_dnsbrif'}], u'ns_name': u't1ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.2.2/24', u'tenant_ns_ip': u'10.1.2.1/24', u'tenant_ns_if': u't1ns2if', u'tenant_sub_if': u't1s2if', u'tenant_ns_name': u't1'}], u'bridge_ip': u'2.2.2.1', u'vxlan': [{u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}, {u'mem': 3, u'name': u't1_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br2if1', u'vmif': u't1VM3if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip link show \"t1br2if1\" ; if [ $? -ne 0 ] ; then ip link add \"t1VM3if1\" type veth peer name \"t1br2if1\" ; fi\nip link set dev \"t1br2if1\" up\nip link set dev \"t1VM3if1\" up\n", "delta": "0:00:00.017659", "end": "2019-11-17 09:59:24.967457", "item": [{"bridge_ip": "2.2.2.1", "bridge_name": "t1br2", "default_route_ip": "10.1.2.1", "dns": [{"brif": "t1s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t1s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns2", "route": [{"if": "p1", "ip": "10.1.2.1/24", "ns_if": "t1if", "ns_name": "t1"}], "tenant_ns": [{"tenant_ns_if": "t1ns2if", "tenant_ns_ip": "10.1.2.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s2if", "tenant_sub_ip": "10.1.2.2/24"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, {"brif": "t1br2if1", "disk": "10G", "mem": 3, "name": "t1_VM3", "vcpu": 2, "vmif": "t1VM3if1"}], "rc": 0, "start": "2019-11-17 09:59:24.949798", "stderr": "Device \"t1br2if1\" does not exist.", "stderr_lines": ["Device \"t1br2if1\" does not exist."], "stdout": "", "stdout_lines": []}

TASK [Attach VETH Pairs] ************************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.1.2/24', u'tenant_ns_ip': u'10.1.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}], u'bridge_ip': u'1.1.1.1', u'vxlan': [{u'local_ip': u'10.1.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.1.2', u'remote_route': u'10.2.1.0/24', u'subnet_route': u'10.1.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.2.1.2'}]}, {u'mem': 2, u'name': u't1_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM1if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip link show \"t1br1if1\" ; if [ $? -eq 0 ] ; then ip link set \"t1br1if1\" netns \"t1ns1\" ; fi\nip netns exec \"t1ns1\" brctl show \"t1br1\" | grep -w 't1br1if1' ; if [ $? -ne 0 ] ; then ip netns exec \"t1ns1\" brctl addif \"t1br1\" \"t1br1if1\" ; fi\n", "delta": "0:00:00.104826", "end": "2019-11-17 09:59:25.351794", "item": [{"bridge_ip": "1.1.1.1", "bridge_name": "t1br1", "default_route_ip": "10.1.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.1.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.1.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.1.1.2/24"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.1.2", "remote_ip": "10.2.1.2", "remote_route": "10.2.1.0/24", "subnet_route": "10.1.1.0/24", "tenant_route_ip": "192.168.1.2", "v_name": "vxlan_t1s1"}]}, {"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM1", "vcpu": 4, "vmif": "t1VM1if1"}], "rc": 0, "start": "2019-11-17 09:59:25.246968", "stderr": "", "stderr_lines": [], "stdout": "48: t1br1if1@t1VM1if1: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP mode DEFAULT group default qlen 1000\n    link/ether 8e:b0:0d:c8:53:4f brd ff:ff:ff:ff:ff:ff", "stdout_lines": ["48: t1br1if1@t1VM1if1: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP mode DEFAULT group default qlen 1000", "    link/ether 8e:b0:0d:c8:53:4f brd ff:ff:ff:ff:ff:ff"]}
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.1.2/24', u'tenant_ns_ip': u'10.1.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}], u'bridge_ip': u'1.1.1.1', u'vxlan': [{u'local_ip': u'10.1.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.1.2', u'remote_route': u'10.2.1.0/24', u'subnet_route': u'10.1.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.2.1.2'}]}, {u'mem': 4, u'name': u't1_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br1if2', u'vmif': u't1VM2if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip link show \"t1br1if2\" ; if [ $? -eq 0 ] ; then ip link set \"t1br1if2\" netns \"t1ns1\" ; fi\nip netns exec \"t1ns1\" brctl show \"t1br1\" | grep -w 't1br1if2' ; if [ $? -ne 0 ] ; then ip netns exec \"t1ns1\" brctl addif \"t1br1\" \"t1br1if2\" ; fi\n", "delta": "0:00:00.095560", "end": "2019-11-17 09:59:25.659838", "item": [{"bridge_ip": "1.1.1.1", "bridge_name": "t1br1", "default_route_ip": "10.1.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.1.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.1.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.1.1.2/24"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.1.2", "remote_ip": "10.2.1.2", "remote_route": "10.2.1.0/24", "subnet_route": "10.1.1.0/24", "tenant_route_ip": "192.168.1.2", "v_name": "vxlan_t1s1"}]}, {"brif": "t1br1if2", "disk": "10G", "mem": 4, "name": "t1_VM2", "vcpu": 2, "vmif": "t1VM2if1"}], "rc": 0, "start": "2019-11-17 09:59:25.564278", "stderr": "", "stderr_lines": [], "stdout": "50: t1br1if2@t1VM2if1: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP mode DEFAULT group default qlen 1000\n    link/ether 82:6a:1f:a0:fc:44 brd ff:ff:ff:ff:ff:ff", "stdout_lines": ["50: t1br1if2@t1VM2if1: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP mode DEFAULT group default qlen 1000", "    link/ether 82:6a:1f:a0:fc:44 brd ff:ff:ff:ff:ff:ff"]}
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.2.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.2.1', u'bridge_name': u't1br2', u'dns': [{u'dnsif': u't1s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s2_dnsbrif'}], u'ns_name': u't1ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.2.2/24', u'tenant_ns_ip': u'10.1.2.1/24', u'tenant_ns_if': u't1ns2if', u'tenant_sub_if': u't1s2if', u'tenant_ns_name': u't1'}], u'bridge_ip': u'2.2.2.1', u'vxlan': [{u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}, {u'mem': 3, u'name': u't1_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br2if1', u'vmif': u't1VM3if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip link show \"t1br2if1\" ; if [ $? -eq 0 ] ; then ip link set \"t1br2if1\" netns \"t1ns2\" ; fi\nip netns exec \"t1ns2\" brctl show \"t1br2\" | grep -w 't1br2if1' ; if [ $? -ne 0 ] ; then ip netns exec \"t1ns2\" brctl addif \"t1br2\" \"t1br2if1\" ; fi\n", "delta": "0:00:00.097258", "end": "2019-11-17 09:59:25.971780", "item": [{"bridge_ip": "2.2.2.1", "bridge_name": "t1br2", "default_route_ip": "10.1.2.1", "dns": [{"brif": "t1s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t1s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns2", "route": [{"if": "p1", "ip": "10.1.2.1/24", "ns_if": "t1if", "ns_name": "t1"}], "tenant_ns": [{"tenant_ns_if": "t1ns2if", "tenant_ns_ip": "10.1.2.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s2if", "tenant_sub_ip": "10.1.2.2/24"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, {"brif": "t1br2if1", "disk": "10G", "mem": 3, "name": "t1_VM3", "vcpu": 2, "vmif": "t1VM3if1"}], "rc": 0, "start": "2019-11-17 09:59:25.874522", "stderr": "", "stderr_lines": [], "stdout": "52: t1br2if1@t1VM3if1: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP mode DEFAULT group default qlen 1000\n    link/ether e6:63:6a:70:19:f4 brd ff:ff:ff:ff:ff:ff", "stdout_lines": ["52: t1br2if1@t1VM3if1: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP mode DEFAULT group default qlen 1000", "    link/ether e6:63:6a:70:19:f4 brd ff:ff:ff:ff:ff:ff"]}

TASK [All interfaces and bridges UP] ************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.1.2/24', u'tenant_ns_ip': u'10.1.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}], u'bridge_ip': u'1.1.1.1', u'vxlan': [{u'local_ip': u'10.1.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.1.2', u'remote_route': u'10.2.1.0/24', u'subnet_route': u'10.1.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.2.1.2'}]}, {u'mem': 2, u'name': u't1_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM1if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t1ns1\" ip link set \"t1br1if1\" up\nip netns exec \"t1ns1\" ip link set dev \"t1br1\" up\n", "delta": "0:00:00.072031", "end": "2019-11-17 09:59:26.315886", "item": [{"bridge_ip": "1.1.1.1", "bridge_name": "t1br1", "default_route_ip": "10.1.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.1.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.1.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.1.1.2/24"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.1.2", "remote_ip": "10.2.1.2", "remote_route": "10.2.1.0/24", "subnet_route": "10.1.1.0/24", "tenant_route_ip": "192.168.1.2", "v_name": "vxlan_t1s1"}]}, {"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM1", "vcpu": 4, "vmif": "t1VM1if1"}], "rc": 0, "start": "2019-11-17 09:59:26.243855", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.1.2/24', u'tenant_ns_ip': u'10.1.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}], u'bridge_ip': u'1.1.1.1', u'vxlan': [{u'local_ip': u'10.1.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.1.2', u'remote_route': u'10.2.1.0/24', u'subnet_route': u'10.1.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.2.1.2'}]}, {u'mem': 4, u'name': u't1_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br1if2', u'vmif': u't1VM2if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t1ns1\" ip link set \"t1br1if2\" up\nip netns exec \"t1ns1\" ip link set dev \"t1br1\" up\n", "delta": "0:00:00.067414", "end": "2019-11-17 09:59:26.603673", "item": [{"bridge_ip": "1.1.1.1", "bridge_name": "t1br1", "default_route_ip": "10.1.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.1.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.1.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.1.1.2/24"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.1.2", "remote_ip": "10.2.1.2", "remote_route": "10.2.1.0/24", "subnet_route": "10.1.1.0/24", "tenant_route_ip": "192.168.1.2", "v_name": "vxlan_t1s1"}]}, {"brif": "t1br1if2", "disk": "10G", "mem": 4, "name": "t1_VM2", "vcpu": 2, "vmif": "t1VM2if1"}], "rc": 0, "start": "2019-11-17 09:59:26.536259", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.2.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.2.1', u'bridge_name': u't1br2', u'dns': [{u'dnsif': u't1s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s2_dnsbrif'}], u'ns_name': u't1ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.2.2/24', u'tenant_ns_ip': u'10.1.2.1/24', u'tenant_ns_if': u't1ns2if', u'tenant_sub_if': u't1s2if', u'tenant_ns_name': u't1'}], u'bridge_ip': u'2.2.2.1', u'vxlan': [{u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}, {u'mem': 3, u'name': u't1_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br2if1', u'vmif': u't1VM3if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t1ns2\" ip link set \"t1br2if1\" up\nip netns exec \"t1ns2\" ip link set dev \"t1br2\" up\n", "delta": "0:00:00.072929", "end": "2019-11-17 09:59:26.887751", "item": [{"bridge_ip": "2.2.2.1", "bridge_name": "t1br2", "default_route_ip": "10.1.2.1", "dns": [{"brif": "t1s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t1s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns2", "route": [{"if": "p1", "ip": "10.1.2.1/24", "ns_if": "t1if", "ns_name": "t1"}], "tenant_ns": [{"tenant_ns_if": "t1ns2if", "tenant_ns_ip": "10.1.2.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s2if", "tenant_sub_ip": "10.1.2.2/24"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, {"brif": "t1br2if1", "disk": "10G", "mem": 3, "name": "t1_VM3", "vcpu": 2, "vmif": "t1VM3if1"}], "rc": 0, "start": "2019-11-17 09:59:26.814822", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Add IP to DNS Interface] ******************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.1.1', u'bridge_name': u't1br1', u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.1.2/24', u'tenant_ns_ip': u'10.1.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}], u'bridge_ip': u'1.1.1.1', u'vms': [{u'mem': 2, u'name': u't1_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM1if1'}, {u'mem': 4, u'name': u't1_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br1if2', u'vmif': u't1VM2if1'}], u'vxlan': [{u'local_ip': u'10.1.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.1.2', u'remote_route': u'10.2.1.0/24', u'subnet_route': u'10.1.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.2.1.2'}]}, {u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t1ns1\" ip addr show \"t1s1_dnsif\" | awk 'FNR==3{ print $2 }' | grep -w '^1.1.1.1/24' ; if [ $? -ne 0 ] ; then ip netns exec \"t1ns1\" ip addr add \"1.1.1.1/24\" dev \"t1s1_dnsif\" ; fi\n", "delta": "0:00:00.082125", "end": "2019-11-17 09:59:27.239882", "item": [{"bridge_ip": "1.1.1.1", "bridge_name": "t1br1", "default_route_ip": "10.1.1.1", "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.1.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.1.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.1.1.2/24"}], "vms": [{"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM1", "vcpu": 4, "vmif": "t1VM1if1"}, {"brif": "t1br1if2", "disk": "10G", "mem": 4, "name": "t1_VM2", "vcpu": 2, "vmif": "t1VM2if1"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.1.2", "remote_ip": "10.2.1.2", "remote_route": "10.2.1.0/24", "subnet_route": "10.1.1.0/24", "tenant_route_ip": "192.168.1.2", "v_name": "vxlan_t1s1"}]}, {"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "rc": 0, "start": "2019-11-17 09:59:27.157757", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.2.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.2.1', u'bridge_name': u't1br2', u'ns_name': u't1ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.2.2/24', u'tenant_ns_ip': u'10.1.2.1/24', u'tenant_ns_if': u't1ns2if', u'tenant_sub_if': u't1s2if', u'tenant_ns_name': u't1'}], u'bridge_ip': u'2.2.2.1', u'vms': [{u'mem': 3, u'name': u't1_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br2if1', u'vmif': u't1VM3if1'}], u'vxlan': [{u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}, {u'dnsif': u't1s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s2_dnsbrif'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t1ns2\" ip addr show \"t1s2_dnsif\" | awk 'FNR==3{ print $2 }' | grep -w '^2.2.2.1/24' ; if [ $? -ne 0 ] ; then ip netns exec \"t1ns2\" ip addr add \"2.2.2.1/24\" dev \"t1s2_dnsif\" ; fi\n", "delta": "0:00:00.091838", "end": "2019-11-17 09:59:27.563507", "item": [{"bridge_ip": "2.2.2.1", "bridge_name": "t1br2", "default_route_ip": "10.1.2.1", "ns_name": "t1ns2", "route": [{"if": "p1", "ip": "10.1.2.1/24", "ns_if": "t1if", "ns_name": "t1"}], "tenant_ns": [{"tenant_ns_if": "t1ns2if", "tenant_ns_ip": "10.1.2.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s2if", "tenant_sub_ip": "10.1.2.2/24"}], "vms": [{"brif": "t1br2if1", "disk": "10G", "mem": 3, "name": "t1_VM3", "vcpu": 2, "vmif": "t1VM3if1"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, {"brif": "t1s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t1s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "rc": 0, "start": "2019-11-17 09:59:27.471669", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Install DHCP Server] **********************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.1.1', u'bridge_name': u't1br1', u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.1.2/24', u'tenant_ns_ip': u'10.1.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}], u'bridge_ip': u'1.1.1.1', u'vms': [{u'mem': 2, u'name': u't1_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM1if1'}, {u'mem': 4, u'name': u't1_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br1if2', u'vmif': u't1VM2if1'}], u'vxlan': [{u'local_ip': u'10.1.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.1.2', u'remote_route': u'10.2.1.0/24', u'subnet_route': u'10.1.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.2.1.2'}]}, {u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t1ns1\" ps aux | grep -w '[d]nsmasq --interface t1s1_dnsif --dhcp-range=1.1.1.5,1.1.1.126' ; if [ $? -ne 0 ] ; then ip netns exec \"t1ns1\" dnsmasq --interface \"t1s1_dnsif\" --dhcp-range=1.1.1.5,'1.1.1.126' ; fi\n", "delta": "0:00:00.085315", "end": "2019-11-17 09:59:27.909347", "item": [{"bridge_ip": "1.1.1.1", "bridge_name": "t1br1", "default_route_ip": "10.1.1.1", "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.1.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.1.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.1.1.2/24"}], "vms": [{"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM1", "vcpu": 4, "vmif": "t1VM1if1"}, {"brif": "t1br1if2", "disk": "10G", "mem": 4, "name": "t1_VM2", "vcpu": 2, "vmif": "t1VM2if1"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.1.2", "remote_ip": "10.2.1.2", "remote_route": "10.2.1.0/24", "subnet_route": "10.1.1.0/24", "tenant_route_ip": "192.168.1.2", "v_name": "vxlan_t1s1"}]}, {"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "rc": 0, "start": "2019-11-17 09:59:27.824032", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.2.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.2.1', u'bridge_name': u't1br2', u'ns_name': u't1ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.2.2/24', u'tenant_ns_ip': u'10.1.2.1/24', u'tenant_ns_if': u't1ns2if', u'tenant_sub_if': u't1s2if', u'tenant_ns_name': u't1'}], u'bridge_ip': u'2.2.2.1', u'vms': [{u'mem': 3, u'name': u't1_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br2if1', u'vmif': u't1VM3if1'}], u'vxlan': [{u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}, {u'dnsif': u't1s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s2_dnsbrif'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t1ns2\" ps aux | grep -w '[d]nsmasq --interface t1s2_dnsif --dhcp-range=2.2.2.5,2.2.2.254' ; if [ $? -ne 0 ] ; then ip netns exec \"t1ns2\" dnsmasq --interface \"t1s2_dnsif\" --dhcp-range=2.2.2.5,'2.2.2.254' ; fi\n", "delta": "0:00:00.069549", "end": "2019-11-17 09:59:28.180802", "item": [{"bridge_ip": "2.2.2.1", "bridge_name": "t1br2", "default_route_ip": "10.1.2.1", "ns_name": "t1ns2", "route": [{"if": "p1", "ip": "10.1.2.1/24", "ns_if": "t1if", "ns_name": "t1"}], "tenant_ns": [{"tenant_ns_if": "t1ns2if", "tenant_ns_ip": "10.1.2.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s2if", "tenant_sub_ip": "10.1.2.2/24"}], "vms": [{"brif": "t1br2if1", "disk": "10G", "mem": 3, "name": "t1_VM3", "vcpu": 2, "vmif": "t1VM3if1"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, {"brif": "t1s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t1s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "rc": 0, "start": "2019-11-17 09:59:28.111253", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Create VXLAN devices] *********************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.1.2/24', u'tenant_ns_ip': u'10.1.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}], u'bridge_ip': u'1.1.1.1', u'vms': [{u'mem': 2, u'name': u't1_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM1if1'}, {u'mem': 4, u'name': u't1_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br1if2', u'vmif': u't1VM2if1'}]}, {u'local_ip': u'10.1.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.1.2', u'remote_route': u'10.2.1.0/24', u'subnet_route': u'10.1.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.2.1.2'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t1ns1\" ip link show \"vxlan_t1s1\" ; if [ $? -ne 0 ] ; then ip netns exec \"t1ns1\" ip link add \"vxlan_t1s1\" type vxlan id \"42\" local \"10.1.1.2\" remote \"10.2.1.2\" dstport \"4789\" dev \"t1s1if\"; ip netns exec \"t1ns1\" ip link set dev \"vxlan_t1s1\" up ; fi\n", "delta": "0:00:00.159358", "end": "2019-11-17 09:59:28.651651", "item": [{"bridge_ip": "1.1.1.1", "bridge_name": "t1br1", "default_route_ip": "10.1.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.1.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.1.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.1.1.2/24"}], "vms": [{"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM1", "vcpu": 4, "vmif": "t1VM1if1"}, {"brif": "t1br1if2", "disk": "10G", "mem": 4, "name": "t1_VM2", "vcpu": 2, "vmif": "t1VM2if1"}]}, {"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.1.2", "remote_ip": "10.2.1.2", "remote_route": "10.2.1.0/24", "subnet_route": "10.1.1.0/24", "tenant_route_ip": "192.168.1.2", "v_name": "vxlan_t1s1"}], "rc": 0, "start": "2019-11-17 09:59:28.492293", "stderr": "Device \"vxlan_t1s1\" does not exist.", "stderr_lines": ["Device \"vxlan_t1s1\" does not exist."], "stdout": "", "stdout_lines": []}
skipping: [localhost] => (item=[{u'route': [{u'ip': u'10.1.2.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.2.1', u'bridge_name': u't1br2', u'dns': [{u'dnsif': u't1s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s2_dnsbrif'}], u'ns_name': u't1ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.2.2/24', u'tenant_ns_ip': u'10.1.2.1/24', u'tenant_ns_if': u't1ns2if', u'tenant_sub_if': u't1s2if', u'tenant_ns_name': u't1'}], u'bridge_ip': u'2.2.2.1', u'vms': [{u'mem': 3, u'name': u't1_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br2if1', u'vmif': u't1VM3if1'}]}, {u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}])  => {"ansible_loop_var": "item", "changed": false, "item": [{"bridge_ip": "2.2.2.1", "bridge_name": "t1br2", "default_route_ip": "10.1.2.1", "dns": [{"brif": "t1s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t1s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns2", "route": [{"if": "p1", "ip": "10.1.2.1/24", "ns_if": "t1if", "ns_name": "t1"}], "tenant_ns": [{"tenant_ns_if": "t1ns2if", "tenant_ns_ip": "10.1.2.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s2if", "tenant_sub_ip": "10.1.2.2/24"}], "vms": [{"brif": "t1br2if1", "disk": "10G", "mem": 3, "name": "t1_VM3", "vcpu": 2, "vmif": "t1VM3if1"}]}, {"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}], "skip_reason": "Conditional result was False"}

TASK [Attach VXLANs to bridge] ******************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.1.2/24', u'tenant_ns_ip': u'10.1.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}], u'bridge_ip': u'1.1.1.1', u'vms': [{u'mem': 2, u'name': u't1_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM1if1'}, {u'mem': 4, u'name': u't1_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br1if2', u'vmif': u't1VM2if1'}]}, {u'local_ip': u'10.1.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.1.2', u'remote_route': u'10.2.1.0/24', u'subnet_route': u'10.1.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.2.1.2'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t1ns1\" brctl show \"t1br1\" | grep -w 'vxlan_t1s1' ; if [ $? -ne 0 ] ; then ip netns exec \"t1ns1\" brctl addif \"t1br1\" \"vxlan_t1s1\" ; fi\n", "delta": "0:00:00.074799", "end": "2019-11-17 09:59:29.023773", "item": [{"bridge_ip": "1.1.1.1", "bridge_name": "t1br1", "default_route_ip": "10.1.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.1.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.1.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.1.1.2/24"}], "vms": [{"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM1", "vcpu": 4, "vmif": "t1VM1if1"}, {"brif": "t1br1if2", "disk": "10G", "mem": 4, "name": "t1_VM2", "vcpu": 2, "vmif": "t1VM2if1"}]}, {"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.1.2", "remote_ip": "10.2.1.2", "remote_route": "10.2.1.0/24", "subnet_route": "10.1.1.0/24", "tenant_route_ip": "192.168.1.2", "v_name": "vxlan_t1s1"}], "rc": 0, "start": "2019-11-17 09:59:28.948974", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}
skipping: [localhost] => (item=[{u'route': [{u'ip': u'10.1.2.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.2.1', u'bridge_name': u't1br2', u'dns': [{u'dnsif': u't1s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s2_dnsbrif'}], u'ns_name': u't1ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.2.2/24', u'tenant_ns_ip': u'10.1.2.1/24', u'tenant_ns_if': u't1ns2if', u'tenant_sub_if': u't1s2if', u'tenant_ns_name': u't1'}], u'bridge_ip': u'2.2.2.1', u'vms': [{u'mem': 3, u'name': u't1_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br2if1', u'vmif': u't1VM3if1'}]}, {u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}])  => {"ansible_loop_var": "item", "changed": false, "item": [{"bridge_ip": "2.2.2.1", "bridge_name": "t1br2", "default_route_ip": "10.1.2.1", "dns": [{"brif": "t1s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t1s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns2", "route": [{"if": "p1", "ip": "10.1.2.1/24", "ns_if": "t1if", "ns_name": "t1"}], "tenant_ns": [{"tenant_ns_if": "t1ns2if", "tenant_ns_ip": "10.1.2.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s2if", "tenant_sub_ip": "10.1.2.2/24"}], "vms": [{"brif": "t1br2if1", "disk": "10G", "mem": 3, "name": "t1_VM3", "vcpu": 2, "vmif": "t1VM3if1"}]}, {"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}], "skip_reason": "Conditional result was False"}

PLAY RECAP **************************************************************************************************************************************************
localhost                  : ok=21   changed=21   unreachable=0    failed=0    skipped=0    rescued=0    ignored=0   

Using /etc/ansible/ansible.cfg as config file

PLAY [worker] ***********************************************************************************************************************************************

TASK [Create Tenant Namespace] ******************************************************************************************************************************
changed: [99.99.99.2] => (item={u'default_route_ip': u'192.168.129.1', u'name': u't1', u'pns_ip': u'192.168.129.1/24', u'tenant_if': u't1if', u'tenant_ip': u'192.168.129.2/24', u'pns_if': u't1pns_if'}) => {"ansible_loop_var": "item", "changed": true, "cmd": ["ip", "netns", "add", "t1"], "delta": "0:00:00.060112", "end": "2019-11-17 09:59:31.086757", "item": {"default_route_ip": "192.168.129.1", "name": "t1", "pns_if": "t1pns_if", "pns_ip": "192.168.129.1/24", "tenant_if": "t1if", "tenant_ip": "192.168.129.2/24"}, "rc": 0, "start": "2019-11-17 09:59:31.026645", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Create Subnet Namespace] ******************************************************************************************************************************
changed: [99.99.99.2] => (item={u'route': [{u'ip': u'10.2.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.2.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.1.2/24', u'tenant_ns_ip': u'10.2.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_ns_name': u't1', u'tenant_sub_if': u't1s1if'}], u'bridge_ip': u'1.1.1.1', u'vms': [{u'mem': 2, u'name': u't1_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM4if1'}], u'vxlan': [{u'local_ip': u'10.2.1.2', u'tenant_route_ip': u'192.168.129.2', u'dsport': 4789, u'dev': u't1s1if', u'subnet_route': u'10.2.1.0/24', u'remote_route': u'10.1.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.1.1.2'}]}) => {"ansible_loop_var": "item", "changed": true, "cmd": ["ip", "netns", "add", "t1ns1"], "delta": "0:00:00.053006", "end": "2019-11-17 09:59:31.519293", "item": {"bridge_ip": "1.1.1.1", "bridge_name": "t1br1", "default_route_ip": "10.2.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.2.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.2.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.2.1.2/24"}], "vms": [{"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM4", "vcpu": 4, "vmif": "t1VM4if1"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.1.2", "remote_ip": "10.1.1.2", "remote_route": "10.1.1.0/24", "subnet_route": "10.2.1.0/24", "tenant_route_ip": "192.168.129.2", "v_name": "vxlan_t1s1"}]}, "rc": 0, "start": "2019-11-17 09:59:31.466287", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Create Tenant VETH pairs] *****************************************************************************************************************************
changed: [99.99.99.2] => (item={u'default_route_ip': u'192.168.129.1', u'name': u't1', u'pns_ip': u'192.168.129.1/24', u'tenant_if': u't1if', u'tenant_ip': u'192.168.129.2/24', u'pns_if': u't1pns_if'}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip link show \"t1if\" ; if [ $? -ne 0 ] ; then ip link add \"t1if\" type veth peer name \"t1pns_if\" ; fi\n", "delta": "0:00:00.010824", "end": "2019-11-17 09:59:31.895961", "item": {"default_route_ip": "192.168.129.1", "name": "t1", "pns_if": "t1pns_if", "pns_ip": "192.168.129.1/24", "tenant_if": "t1if", "tenant_ip": "192.168.129.2/24"}, "rc": 0, "start": "2019-11-17 09:59:31.885137", "stderr": "Device \"t1if\" does not exist.", "stderr_lines": ["Device \"t1if\" does not exist."], "stdout": "", "stdout_lines": []}

TASK [Attach Tenant VETH Pairs] *****************************************************************************************************************************
changed: [99.99.99.2] => (item={u'default_route_ip': u'192.168.129.1', u'name': u't1', u'pns_ip': u'192.168.129.1/24', u'tenant_if': u't1if', u'tenant_ip': u'192.168.129.2/24', u'pns_if': u't1pns_if'}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec pns ip link show \"t1pns_if\" ; if [ $? -ne 0 ] ; then ip link set \"t1pns_if\" netns pns ; fi\nip netns exec \"t1\" ip link show \"t1if\" ; if [ $? -ne 0 ] ; then ip link set \"t1if\" netns \"t1\" ; fi\nip netns exec pns ip link set dev \"t1pns_if\" up\nip netns exec \"t1\" ip link set dev \"t1if\" up\n", "delta": "0:00:00.186404", "end": "2019-11-17 09:59:32.444463", "item": {"default_route_ip": "192.168.129.1", "name": "t1", "pns_if": "t1pns_if", "pns_ip": "192.168.129.1/24", "tenant_if": "t1if", "tenant_ip": "192.168.129.2/24"}, "rc": 0, "start": "2019-11-17 09:59:32.258059", "stderr": "Device \"t1pns_if\" does not exist.\nDevice \"t1if\" does not exist.", "stderr_lines": ["Device \"t1pns_if\" does not exist.", "Device \"t1if\" does not exist."], "stdout": "", "stdout_lines": []}

TASK [Add IP addresses to Tenant VETH Pairs] ****************************************************************************************************************
changed: [99.99.99.2] => (item={u'default_route_ip': u'192.168.129.1', u'name': u't1', u'pns_ip': u'192.168.129.1/24', u'tenant_if': u't1if', u'tenant_ip': u'192.168.129.2/24', u'pns_if': u't1pns_if'}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec pns ip addr show \"t1pns_if\" | awk 'FNR==3{ print $2 }' | grep -w '^192.168.129.1/24' ; if [ $? -ne 0 ] ; then ip netns exec pns ip addr add \"192.168.129.1/24\" dev \"t1pns_if\" ; fi\nip netns exec \"t1\" ip addr show \"t1if\" | awk 'FNR==3{ print $2 }' | grep -w '^192.168.129.2/24' ; if [ $? -ne 0 ] ; then ip netns exec \"t1\" ip addr add \"192.168.129.2/24\" dev \"t1if\" ; fi\n", "delta": "0:00:00.163353", "end": "2019-11-17 09:59:32.984591", "item": {"default_route_ip": "192.168.129.1", "name": "t1", "pns_if": "t1pns_if", "pns_ip": "192.168.129.1/24", "tenant_if": "t1if", "tenant_ip": "192.168.129.2/24"}, "rc": 0, "start": "2019-11-17 09:59:32.821238", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Create Namespace VETH Pairs] **************************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.2.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'bridge_ip': u'1.1.1.1', u'vms': [{u'mem': 2, u'name': u't1_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM4if1'}], u'vxlan': [{u'local_ip': u'10.2.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.129.2', u'remote_route': u'10.1.1.0/24', u'subnet_route': u'10.2.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.1.1.2'}]}, {u'tenant_sub_ip': u'10.2.1.2/24', u'tenant_ns_ip': u'10.2.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip link show \"t1ns1if\" ; if [ $? -ne 0 ] ; then ip link add \"t1ns1if\" type veth peer name \"t1s1if\" ; fi\n", "delta": "0:00:00.009714", "end": "2019-11-17 09:59:33.372060", "item": [{"bridge_ip": "1.1.1.1", "bridge_name": "t1br1", "default_route_ip": "10.2.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.2.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "vms": [{"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM4", "vcpu": 4, "vmif": "t1VM4if1"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.1.2", "remote_ip": "10.1.1.2", "remote_route": "10.1.1.0/24", "subnet_route": "10.2.1.0/24", "tenant_route_ip": "192.168.129.2", "v_name": "vxlan_t1s1"}]}, {"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.2.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.2.1.2/24"}], "rc": 0, "start": "2019-11-17 09:59:33.362346", "stderr": "Device \"t1ns1if\" does not exist.", "stderr_lines": ["Device \"t1ns1if\" does not exist."], "stdout": "", "stdout_lines": []}

TASK [Attach Namespace VETH Pairs] **************************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.2.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'bridge_ip': u'1.1.1.1', u'vms': [{u'mem': 2, u'name': u't1_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM4if1'}], u'vxlan': [{u'local_ip': u'10.2.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.129.2', u'remote_route': u'10.1.1.0/24', u'subnet_route': u'10.2.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.1.1.2'}]}, {u'tenant_sub_ip': u'10.2.1.2/24', u'tenant_ns_ip': u'10.2.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t1\" ip link show \"t1ns1if\" ; if [ $? -ne 0 ] ; then ip link set \"t1ns1if\" netns \"t1\" ; fi\nip netns exec \"t1ns1\" ip link show \"t1s1if\" ; if [ $? -ne 0 ] ; then ip link set \"t1s1if\" netns \"t1ns1\" ; fi\n", "delta": "0:00:00.129934", "end": "2019-11-17 09:59:33.900390", "item": [{"bridge_ip": "1.1.1.1", "bridge_name": "t1br1", "default_route_ip": "10.2.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.2.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "vms": [{"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM4", "vcpu": 4, "vmif": "t1VM4if1"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.1.2", "remote_ip": "10.1.1.2", "remote_route": "10.1.1.0/24", "subnet_route": "10.2.1.0/24", "tenant_route_ip": "192.168.129.2", "v_name": "vxlan_t1s1"}]}, {"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.2.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.2.1.2/24"}], "rc": 0, "start": "2019-11-17 09:59:33.770456", "stderr": "Device \"t1ns1if\" does not exist.\nDevice \"t1s1if\" does not exist.", "stderr_lines": ["Device \"t1ns1if\" does not exist.", "Device \"t1s1if\" does not exist."], "stdout": "", "stdout_lines": []}

TASK [Set Namespace VETH Pairs UP] **************************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.2.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'bridge_ip': u'1.1.1.1', u'vms': [{u'mem': 2, u'name': u't1_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM4if1'}], u'vxlan': [{u'local_ip': u'10.2.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.129.2', u'remote_route': u'10.1.1.0/24', u'subnet_route': u'10.2.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.1.1.2'}]}, {u'tenant_sub_ip': u'10.2.1.2/24', u'tenant_ns_ip': u'10.2.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t1\" ip link set dev \"t1ns1if\" up\nip netns exec \"t1ns1\" ip link set dev \"t1s1if\" up\n", "delta": "0:00:00.087657", "end": "2019-11-17 09:59:34.348553", "item": [{"bridge_ip": "1.1.1.1", "bridge_name": "t1br1", "default_route_ip": "10.2.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.2.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "vms": [{"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM4", "vcpu": 4, "vmif": "t1VM4if1"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.1.2", "remote_ip": "10.1.1.2", "remote_route": "10.1.1.0/24", "subnet_route": "10.2.1.0/24", "tenant_route_ip": "192.168.129.2", "v_name": "vxlan_t1s1"}]}, {"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.2.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.2.1.2/24"}], "rc": 0, "start": "2019-11-17 09:59:34.260896", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Add IP addresses to Namespace VETH Pairs] *************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.2.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'bridge_ip': u'1.1.1.1', u'vms': [{u'mem': 2, u'name': u't1_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM4if1'}], u'vxlan': [{u'local_ip': u'10.2.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.129.2', u'remote_route': u'10.1.1.0/24', u'subnet_route': u'10.2.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.1.1.2'}]}, {u'tenant_sub_ip': u'10.2.1.2/24', u'tenant_ns_ip': u'10.2.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t1ns1\" ip addr show \"t1s1if\" | awk 'FNR==3{ print $2 }' | grep -w '^10.2.1.2/24' ; if [ $? -ne 0 ] ; then ip netns exec \"t1ns1\" ip addr add \"10.2.1.2/24\" dev \"t1s1if\" ; fi\n\nip netns exec \"t1\" ip addr show \"t1ns1if\" | awk 'FNR==3{ print $2 }' | grep -w '^10.2.1.1/24' ; if [ $? -ne 0 ] ; then ip netns exec \"t1\" ip addr add \"10.2.1.1/24\" dev \"t1ns1if\" ; fi\n", "delta": "0:00:00.155851", "end": "2019-11-17 09:59:34.900485", "item": [{"bridge_ip": "1.1.1.1", "bridge_name": "t1br1", "default_route_ip": "10.2.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.2.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "vms": [{"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM4", "vcpu": 4, "vmif": "t1VM4if1"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.1.2", "remote_ip": "10.1.1.2", "remote_route": "10.1.1.0/24", "subnet_route": "10.2.1.0/24", "tenant_route_ip": "192.168.129.2", "v_name": "vxlan_t1s1"}]}, {"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.2.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.2.1.2/24"}], "rc": 0, "start": "2019-11-17 09:59:34.744634", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Add IP Route to Tenant] *******************************************************************************************************************************
changed: [99.99.99.2] => (item={u'default_route_ip': u'192.168.129.1', u'name': u't1', u'pns_ip': u'192.168.129.1/24', u'tenant_if': u't1if', u'tenant_ip': u'192.168.129.2/24', u'pns_if': u't1pns_if'}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t1\" ip route show default | grep -w '[d]efault via 192.168.129.1' ; if [ $? -ne 0 ] ; then ip netns exec \"t1\" ip route add default via \"192.168.129.1\" ; fi\n", "delta": "0:00:00.075417", "end": "2019-11-17 09:59:35.372540", "item": {"default_route_ip": "192.168.129.1", "name": "t1", "pns_if": "t1pns_if", "pns_ip": "192.168.129.1/24", "tenant_if": "t1if", "tenant_ip": "192.168.129.2/24"}, "rc": 0, "start": "2019-11-17 09:59:35.297123", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Add IP Route to Tenant Subnet] ************************************************************************************************************************
changed: [99.99.99.2] => (item={u'route': [{u'ip': u'10.2.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.2.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.1.2/24', u'tenant_ns_ip': u'10.2.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_ns_name': u't1', u'tenant_sub_if': u't1s1if'}], u'bridge_ip': u'1.1.1.1', u'vms': [{u'mem': 2, u'name': u't1_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM4if1'}], u'vxlan': [{u'local_ip': u'10.2.1.2', u'tenant_route_ip': u'192.168.129.2', u'dsport': 4789, u'dev': u't1s1if', u'subnet_route': u'10.2.1.0/24', u'remote_route': u'10.1.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.1.1.2'}]}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t1ns1\" ip route show default | grep -w '[d]efault via 10.2.1.1' ; if [ $? -ne 0 ] ; then ip netns exec \"t1ns1\" ip route add default via \"10.2.1.1\" ; fi\n", "delta": "0:00:00.086262", "end": "2019-11-17 09:59:35.868705", "item": {"bridge_ip": "1.1.1.1", "bridge_name": "t1br1", "default_route_ip": "10.2.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.2.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.2.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.2.1.2/24"}], "vms": [{"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM4", "vcpu": 4, "vmif": "t1VM4if1"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.1.2", "remote_ip": "10.1.1.2", "remote_route": "10.1.1.0/24", "subnet_route": "10.2.1.0/24", "tenant_route_ip": "192.168.129.2", "v_name": "vxlan_t1s1"}]}, "rc": 0, "start": "2019-11-17 09:59:35.782443", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Create bridge inside namespace] ***********************************************************************************************************************
changed: [99.99.99.2] => (item={u'route': [{u'ip': u'10.2.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.2.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.1.2/24', u'tenant_ns_ip': u'10.2.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_ns_name': u't1', u'tenant_sub_if': u't1s1if'}], u'bridge_ip': u'1.1.1.1', u'vms': [{u'mem': 2, u'name': u't1_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM4if1'}], u'vxlan': [{u'local_ip': u'10.2.1.2', u'tenant_route_ip': u'192.168.129.2', u'dsport': 4789, u'dev': u't1s1if', u'subnet_route': u'10.2.1.0/24', u'remote_route': u'10.1.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.1.1.2'}]}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t1ns1\" brctl show | grep -w '^t1br1'; if [ $? -ne 0 ] ; then ip netns exec \"t1ns1\" brctl addbr \"t1br1\" ; fi\nip netns exec \"t1ns1\" ip link set dev \"t1br1\" up\n", "delta": "0:00:00.108257", "end": "2019-11-17 09:59:36.368532", "item": {"bridge_ip": "1.1.1.1", "bridge_name": "t1br1", "default_route_ip": "10.2.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.2.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.2.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.2.1.2/24"}], "vms": [{"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM4", "vcpu": 4, "vmif": "t1VM4if1"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.1.2", "remote_ip": "10.1.1.2", "remote_route": "10.1.1.0/24", "subnet_route": "10.2.1.0/24", "tenant_route_ip": "192.168.129.2", "v_name": "vxlan_t1s1"}]}, "rc": 0, "start": "2019-11-17 09:59:36.260275", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Create DNS VETH Pair] *********************************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.2.1.1', u'bridge_name': u't1br1', u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.1.2/24', u'tenant_ns_ip': u'10.2.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}], u'bridge_ip': u'1.1.1.1', u'vms': [{u'mem': 2, u'name': u't1_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM4if1'}], u'vxlan': [{u'local_ip': u'10.2.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.129.2', u'remote_route': u'10.1.1.0/24', u'subnet_route': u'10.2.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.1.1.2'}]}, {u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t1ns1\" ip link show \"t1s1_dnsbrif\" ; if [ $? -ne 0 ] ; then ip netns exec \"t1ns1\" ip link add \"t1s1_dnsbrif\" type veth peer name \"t1s1_dnsif\" ; fi\nip netns exec \"t1ns1\" ip link set dev \"t1s1_dnsbrif\" up\nip netns exec \"t1ns1\" ip link set dev \"t1s1_dnsif\" up\n", "delta": "0:00:00.165191", "end": "2019-11-17 09:59:36.904481", "item": [{"bridge_ip": "1.1.1.1", "bridge_name": "t1br1", "default_route_ip": "10.2.1.1", "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.2.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.2.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.2.1.2/24"}], "vms": [{"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM4", "vcpu": 4, "vmif": "t1VM4if1"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.1.2", "remote_ip": "10.1.1.2", "remote_route": "10.1.1.0/24", "subnet_route": "10.2.1.0/24", "tenant_route_ip": "192.168.129.2", "v_name": "vxlan_t1s1"}]}, {"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "rc": 0, "start": "2019-11-17 09:59:36.739290", "stderr": "Device \"t1s1_dnsbrif\" does not exist.", "stderr_lines": ["Device \"t1s1_dnsbrif\" does not exist."], "stdout": "", "stdout_lines": []}

TASK [Attach DNS VETH Pair] *********************************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.2.1.1', u'bridge_name': u't1br1', u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.1.2/24', u'tenant_ns_ip': u'10.2.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}], u'bridge_ip': u'1.1.1.1', u'vms': [{u'mem': 2, u'name': u't1_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM4if1'}], u'vxlan': [{u'local_ip': u'10.2.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.129.2', u'remote_route': u'10.1.1.0/24', u'subnet_route': u'10.2.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.1.1.2'}]}, {u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t1ns1\" brctl show \"t1br1\" | grep -w 't1s1_dnsbrif' ; if [ $? -ne 0 ] ; then ip netns exec \"t1ns1\" brctl addif \"t1br1\" \"t1s1_dnsbrif\" ; fi\n", "delta": "0:00:00.076876", "end": "2019-11-17 09:59:37.356608", "item": [{"bridge_ip": "1.1.1.1", "bridge_name": "t1br1", "default_route_ip": "10.2.1.1", "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.2.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.2.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.2.1.2/24"}], "vms": [{"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM4", "vcpu": 4, "vmif": "t1VM4if1"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.1.2", "remote_ip": "10.1.1.2", "remote_route": "10.1.1.0/24", "subnet_route": "10.2.1.0/24", "tenant_route_ip": "192.168.129.2", "v_name": "vxlan_t1s1"}]}, {"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "rc": 0, "start": "2019-11-17 09:59:37.279732", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Create VETH Pairs] ************************************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.2.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.1.2/24', u'tenant_ns_ip': u'10.2.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}], u'bridge_ip': u'1.1.1.1', u'vxlan': [{u'local_ip': u'10.2.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.129.2', u'remote_route': u'10.1.1.0/24', u'subnet_route': u'10.2.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.1.1.2'}]}, {u'mem': 2, u'name': u't1_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM4if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip link show \"t1br1if1\" ; if [ $? -ne 0 ] ; then ip link add \"t1VM4if1\" type veth peer name \"t1br1if1\" ; fi\nip link set dev \"t1br1if1\" up\nip link set dev \"t1VM4if1\" up\n", "delta": "0:00:00.014960", "end": "2019-11-17 09:59:37.765468", "item": [{"bridge_ip": "1.1.1.1", "bridge_name": "t1br1", "default_route_ip": "10.2.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.2.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.2.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.2.1.2/24"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.1.2", "remote_ip": "10.1.1.2", "remote_route": "10.1.1.0/24", "subnet_route": "10.2.1.0/24", "tenant_route_ip": "192.168.129.2", "v_name": "vxlan_t1s1"}]}, {"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM4", "vcpu": 4, "vmif": "t1VM4if1"}], "rc": 0, "start": "2019-11-17 09:59:37.750508", "stderr": "Device \"t1br1if1\" does not exist.", "stderr_lines": ["Device \"t1br1if1\" does not exist."], "stdout": "", "stdout_lines": []}

TASK [Attach VETH Pairs] ************************************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.2.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.1.2/24', u'tenant_ns_ip': u'10.2.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}], u'bridge_ip': u'1.1.1.1', u'vxlan': [{u'local_ip': u'10.2.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.129.2', u'remote_route': u'10.1.1.0/24', u'subnet_route': u'10.2.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.1.1.2'}]}, {u'mem': 2, u'name': u't1_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM4if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip link show \"t1br1if1\" ; if [ $? -eq 0 ] ; then ip link set \"t1br1if1\" netns \"t1ns1\" ; fi\nip netns exec \"t1ns1\" brctl show \"t1br1\" | grep -w 't1br1if1' ; if [ $? -ne 0 ] ; then ip netns exec \"t1ns1\" brctl addif \"t1br1\" \"t1br1if1\" ; fi\n", "delta": "0:00:00.122599", "end": "2019-11-17 09:59:38.300399", "item": [{"bridge_ip": "1.1.1.1", "bridge_name": "t1br1", "default_route_ip": "10.2.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.2.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.2.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.2.1.2/24"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.1.2", "remote_ip": "10.1.1.2", "remote_route": "10.1.1.0/24", "subnet_route": "10.2.1.0/24", "tenant_route_ip": "192.168.129.2", "v_name": "vxlan_t1s1"}]}, {"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM4", "vcpu": 4, "vmif": "t1VM4if1"}], "rc": 0, "start": "2019-11-17 09:59:38.177800", "stderr": "", "stderr_lines": [], "stdout": "24: t1br1if1@t1VM4if1: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP mode DEFAULT group default qlen 1000\n    link/ether 9a:81:10:a6:93:a7 brd ff:ff:ff:ff:ff:ff", "stdout_lines": ["24: t1br1if1@t1VM4if1: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP mode DEFAULT group default qlen 1000", "    link/ether 9a:81:10:a6:93:a7 brd ff:ff:ff:ff:ff:ff"]}

TASK [All interfaces and bridges UP] ************************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.2.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.1.2/24', u'tenant_ns_ip': u'10.2.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}], u'bridge_ip': u'1.1.1.1', u'vxlan': [{u'local_ip': u'10.2.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.129.2', u'remote_route': u'10.1.1.0/24', u'subnet_route': u'10.2.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.1.1.2'}]}, {u'mem': 2, u'name': u't1_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM4if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t1ns1\" ip link set \"t1br1if1\" up\nip netns exec \"t1ns1\" ip link set dev \"t1br1\" up\n", "delta": "0:00:00.074554", "end": "2019-11-17 09:59:38.760561", "item": [{"bridge_ip": "1.1.1.1", "bridge_name": "t1br1", "default_route_ip": "10.2.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.2.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.2.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.2.1.2/24"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.1.2", "remote_ip": "10.1.1.2", "remote_route": "10.1.1.0/24", "subnet_route": "10.2.1.0/24", "tenant_route_ip": "192.168.129.2", "v_name": "vxlan_t1s1"}]}, {"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM4", "vcpu": 4, "vmif": "t1VM4if1"}], "rc": 0, "start": "2019-11-17 09:59:38.686007", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Add IP to DNS Interface] ******************************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.2.1.1', u'bridge_name': u't1br1', u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.1.2/24', u'tenant_ns_ip': u'10.2.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}], u'bridge_ip': u'1.1.1.1', u'vms': [{u'mem': 2, u'name': u't1_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM4if1'}], u'vxlan': [{u'local_ip': u'10.2.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.129.2', u'remote_route': u'10.1.1.0/24', u'subnet_route': u'10.2.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.1.1.2'}]}, {u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t1ns1\" ip addr show \"t1s1_dnsif\" | awk 'FNR==3{ print $2}'| grep -w '^1.1.1.128/24' ; if [ $? -ne 0 ] ; then ip netns exec \"t1ns1\" ip addr add \"1.1.1.128/24\" dev \"t1s1_dnsif\" ; fi\n", "delta": "0:00:00.071791", "end": "2019-11-17 09:59:39.216565", "item": [{"bridge_ip": "1.1.1.1", "bridge_name": "t1br1", "default_route_ip": "10.2.1.1", "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.2.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.2.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.2.1.2/24"}], "vms": [{"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM4", "vcpu": 4, "vmif": "t1VM4if1"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.1.2", "remote_ip": "10.1.1.2", "remote_route": "10.1.1.0/24", "subnet_route": "10.2.1.0/24", "tenant_route_ip": "192.168.129.2", "v_name": "vxlan_t1s1"}]}, {"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "rc": 0, "start": "2019-11-17 09:59:39.144774", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Install DHCP Server] **********************************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.2.1.1', u'bridge_name': u't1br1', u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.1.2/24', u'tenant_ns_ip': u'10.2.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}], u'bridge_ip': u'1.1.1.1', u'vms': [{u'mem': 2, u'name': u't1_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM4if1'}], u'vxlan': [{u'local_ip': u'10.2.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.129.2', u'remote_route': u'10.1.1.0/24', u'subnet_route': u'10.2.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.1.1.2'}]}, {u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t1ns1\" ps aux | grep -w '[d]nsmasq --interface t1s1_dnsif --dhcp-range=1.1.1.133,1.1.1.254' ; if [ $? -ne 0 ] ; then ip netns exec \"t1ns1\" dnsmasq --interface \"t1s1_dnsif\" --dhcp-range=1.1.1.133,'1.1.1.254' ; fi\n", "delta": "0:00:00.064939", "end": "2019-11-17 09:59:39.653490", "item": [{"bridge_ip": "1.1.1.1", "bridge_name": "t1br1", "default_route_ip": "10.2.1.1", "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.2.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.2.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.2.1.2/24"}], "vms": [{"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM4", "vcpu": 4, "vmif": "t1VM4if1"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.1.2", "remote_ip": "10.1.1.2", "remote_route": "10.1.1.0/24", "subnet_route": "10.2.1.0/24", "tenant_route_ip": "192.168.129.2", "v_name": "vxlan_t1s1"}]}, {"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "rc": 0, "start": "2019-11-17 09:59:39.588551", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Create VXLAN devices] *********************************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.2.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.1.2/24', u'tenant_ns_ip': u'10.2.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}], u'bridge_ip': u'1.1.1.1', u'vms': [{u'mem': 2, u'name': u't1_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM4if1'}]}, {u'local_ip': u'10.2.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.129.2', u'remote_route': u'10.1.1.0/24', u'subnet_route': u'10.2.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.1.1.2'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t1ns1\" ip link show \"vxlan_t1s1\" ; if [ $? -ne 0 ] ; then ip netns exec \"t1ns1\" ip link add \"vxlan_t1s1\" type vxlan id \"42\" local \"10.2.1.2\" remote \"10.1.1.2\" dstport \"4789\" dev \"t1s1if\" ; ip netns exec \"t1ns1\" ip link set dev \"vxlan_t1s1\" up ; fi\n", "delta": "0:00:00.173950", "end": "2019-11-17 09:59:40.204582", "item": [{"bridge_ip": "1.1.1.1", "bridge_name": "t1br1", "default_route_ip": "10.2.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.2.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.2.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.2.1.2/24"}], "vms": [{"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM4", "vcpu": 4, "vmif": "t1VM4if1"}]}, {"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.1.2", "remote_ip": "10.1.1.2", "remote_route": "10.1.1.0/24", "subnet_route": "10.2.1.0/24", "tenant_route_ip": "192.168.129.2", "v_name": "vxlan_t1s1"}], "rc": 0, "start": "2019-11-17 09:59:40.030632", "stderr": "Device \"vxlan_t1s1\" does not exist.", "stderr_lines": ["Device \"vxlan_t1s1\" does not exist."], "stdout": "", "stdout_lines": []}

TASK [Attach VXLANs to bridge] ******************************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.2.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.1.2/24', u'tenant_ns_ip': u'10.2.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}], u'bridge_ip': u'1.1.1.1', u'vms': [{u'mem': 2, u'name': u't1_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM4if1'}]}, {u'local_ip': u'10.2.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.129.2', u'remote_route': u'10.1.1.0/24', u'subnet_route': u'10.2.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.1.1.2'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t1ns1\" brctl show \"t1br1\" | grep -w 'vxlan_t1s1' ; if [ $? -ne 0 ] ; then ip netns exec \"t1ns1\" brctl addif \"t1br1\" \"vxlan_t1s1\" ; fi\n", "delta": "0:00:00.074773", "end": "2019-11-17 09:59:40.660474", "item": [{"bridge_ip": "1.1.1.1", "bridge_name": "t1br1", "default_route_ip": "10.2.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.2.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.2.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.2.1.2/24"}], "vms": [{"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM4", "vcpu": 4, "vmif": "t1VM4if1"}]}, {"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.1.2", "remote_ip": "10.1.1.2", "remote_route": "10.1.1.0/24", "subnet_route": "10.2.1.0/24", "tenant_route_ip": "192.168.129.2", "v_name": "vxlan_t1s1"}], "rc": 0, "start": "2019-11-17 09:59:40.585701", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

PLAY RECAP **************************************************************************************************************************************************
99.99.99.2                 : ok=21   changed=21   unreachable=0    failed=0    skipped=0    rescued=0    ignored=0   

Using /etc/ansible/ansible.cfg as config file

PLAY [main] *************************************************************************************************************************************************

TASK [Add VXLAN routes in PNS] ******************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.1.2/24', u'tenant_ns_ip': u'10.1.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}], u'bridge_ip': u'1.1.1.1', u'vms': [{u'mem': 2, u'name': u't1_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM1if1'}, {u'mem': 4, u'name': u't1_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br1if2', u'vmif': u't1VM2if1'}]}, {u'local_ip': u'10.1.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.1.2', u'remote_route': u'10.2.1.0/24', u'subnet_route': u'10.1.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.2.1.2'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec pns ip route show \"10.1.1.0/24\" via \"192.168.1.2\" | grep -w '^10.1.1.0/24' ; if [ $? -ne 0 ] ; then ip netns exec pns ip route add \"10.1.1.0/24\" via \"192.168.1.2\" ; fi\n", "delta": "0:00:00.074136", "end": "2019-11-17 09:59:41.943736", "item": [{"bridge_ip": "1.1.1.1", "bridge_name": "t1br1", "default_route_ip": "10.1.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.1.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.1.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.1.1.2/24"}], "vms": [{"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM1", "vcpu": 4, "vmif": "t1VM1if1"}, {"brif": "t1br1if2", "disk": "10G", "mem": 4, "name": "t1_VM2", "vcpu": 2, "vmif": "t1VM2if1"}]}, {"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.1.2", "remote_ip": "10.2.1.2", "remote_route": "10.2.1.0/24", "subnet_route": "10.1.1.0/24", "tenant_route_ip": "192.168.1.2", "v_name": "vxlan_t1s1"}], "rc": 0, "start": "2019-11-17 09:59:41.869600", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}
skipping: [localhost] => (item=[{u'route': [{u'ip': u'10.1.2.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.2.1', u'bridge_name': u't1br2', u'dns': [{u'dnsif': u't1s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s2_dnsbrif'}], u'ns_name': u't1ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.2.2/24', u'tenant_ns_ip': u'10.1.2.1/24', u'tenant_ns_if': u't1ns2if', u'tenant_sub_if': u't1s2if', u'tenant_ns_name': u't1'}], u'bridge_ip': u'2.2.2.1', u'vms': [{u'mem': 3, u'name': u't1_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br2if1', u'vmif': u't1VM3if1'}]}, {u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}])  => {"ansible_loop_var": "item", "changed": false, "item": [{"bridge_ip": "2.2.2.1", "bridge_name": "t1br2", "default_route_ip": "10.1.2.1", "dns": [{"brif": "t1s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t1s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns2", "route": [{"if": "p1", "ip": "10.1.2.1/24", "ns_if": "t1if", "ns_name": "t1"}], "tenant_ns": [{"tenant_ns_if": "t1ns2if", "tenant_ns_ip": "10.1.2.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s2if", "tenant_sub_ip": "10.1.2.2/24"}], "vms": [{"brif": "t1br2if1", "disk": "10G", "mem": 3, "name": "t1_VM3", "vcpu": 2, "vmif": "t1VM3if1"}]}, {"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}], "skip_reason": "Conditional result was False"}

TASK [Get PNS ip address] ***********************************************************************************************************************************
ok: [localhost] => {"changed": false, "cmd": "ip netns exec pns ip addr show p1 | awk 'FNR==3{ print $2 }' | awk -F/ '{ print $1 }'\n", "delta": "0:00:00.046623", "end": "2019-11-17 09:59:42.260171", "rc": 0, "start": "2019-11-17 09:59:42.213548", "stderr": "", "stderr_lines": [], "stdout": "192.168.100.238", "stdout_lines": ["192.168.100.238"]}

TASK [Add VXLAN routes to host] *****************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.1.2/24', u'tenant_ns_ip': u'10.1.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}], u'bridge_ip': u'1.1.1.1', u'vms': [{u'mem': 2, u'name': u't1_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM1if1'}, {u'mem': 4, u'name': u't1_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br1if2', u'vmif': u't1VM2if1'}]}, {u'local_ip': u'10.1.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.1.2', u'remote_route': u'10.2.1.0/24', u'subnet_route': u'10.1.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.2.1.2'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip route show \"10.1.1.0/24\" via \"192.168.100.238\" | grep -w '^10.1.1.0/24' ; if [ $? -ne 0 ] ; then ip route add \"10.1.1.0/24\" via \"192.168.100.238\" ; fi\nip route show \"10.2.1.0/24\" via 99.99.99.2 | grep -w '^10.2.1.0/24'; if [ $? -ne 0 ] ; then ip route add \"10.2.1.0/24\" via 99.99.99.2 ; fi\n", "delta": "0:00:00.008178", "end": "2019-11-17 09:59:42.591486", "item": [{"bridge_ip": "1.1.1.1", "bridge_name": "t1br1", "default_route_ip": "10.1.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.1.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.1.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.1.1.2/24"}], "vms": [{"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM1", "vcpu": 4, "vmif": "t1VM1if1"}, {"brif": "t1br1if2", "disk": "10G", "mem": 4, "name": "t1_VM2", "vcpu": 2, "vmif": "t1VM2if1"}]}, {"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.1.2", "remote_ip": "10.2.1.2", "remote_route": "10.2.1.0/24", "subnet_route": "10.1.1.0/24", "tenant_route_ip": "192.168.1.2", "v_name": "vxlan_t1s1"}], "rc": 0, "start": "2019-11-17 09:59:42.583308", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}
skipping: [localhost] => (item=[{u'route': [{u'ip': u'10.1.2.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.2.1', u'bridge_name': u't1br2', u'dns': [{u'dnsif': u't1s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s2_dnsbrif'}], u'ns_name': u't1ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.2.2/24', u'tenant_ns_ip': u'10.1.2.1/24', u'tenant_ns_if': u't1ns2if', u'tenant_sub_if': u't1s2if', u'tenant_ns_name': u't1'}], u'bridge_ip': u'2.2.2.1', u'vms': [{u'mem': 3, u'name': u't1_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br2if1', u'vmif': u't1VM3if1'}]}, {u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}])  => {"ansible_loop_var": "item", "changed": false, "item": [{"bridge_ip": "2.2.2.1", "bridge_name": "t1br2", "default_route_ip": "10.1.2.1", "dns": [{"brif": "t1s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t1s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns2", "route": [{"if": "p1", "ip": "10.1.2.1/24", "ns_if": "t1if", "ns_name": "t1"}], "tenant_ns": [{"tenant_ns_if": "t1ns2if", "tenant_ns_ip": "10.1.2.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s2if", "tenant_sub_ip": "10.1.2.2/24"}], "vms": [{"brif": "t1br2if1", "disk": "10G", "mem": 3, "name": "t1_VM3", "vcpu": 2, "vmif": "t1VM3if1"}]}, {"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}], "skip_reason": "Conditional result was False"}

PLAY RECAP **************************************************************************************************************************************************
localhost                  : ok=3    changed=2    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0   

Using /etc/ansible/ansible.cfg as config file

PLAY [worker] ***********************************************************************************************************************************************

TASK [Add VXLAN routes in PNS] ******************************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.2.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.1.2/24', u'tenant_ns_ip': u'10.2.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}], u'bridge_ip': u'1.1.1.1', u'vms': [{u'mem': 2, u'name': u't1_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM4if1'}]}, {u'local_ip': u'10.2.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.129.2', u'remote_route': u'10.1.1.0/24', u'subnet_route': u'10.2.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.1.1.2'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec pns ip route show \"10.2.1.0/24\" via \"192.168.129.2\" | grep -w '^10.2.1.0/24' ; if [ $? -ne 0 ] ; then ip netns exec pns ip route add \"10.2.1.0/24\" via \"192.168.129.2\" ; fi\n", "delta": "0:00:00.083804", "end": "2019-11-17 09:59:43.844523", "item": [{"bridge_ip": "1.1.1.1", "bridge_name": "t1br1", "default_route_ip": "10.2.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.2.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.2.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.2.1.2/24"}], "vms": [{"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM4", "vcpu": 4, "vmif": "t1VM4if1"}]}, {"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.1.2", "remote_ip": "10.1.1.2", "remote_route": "10.1.1.0/24", "subnet_route": "10.2.1.0/24", "tenant_route_ip": "192.168.129.2", "v_name": "vxlan_t1s1"}], "rc": 0, "start": "2019-11-17 09:59:43.760719", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Get PNS ip address] ***********************************************************************************************************************************
ok: [99.99.99.2] => {"changed": false, "cmd": "ip netns exec pns ip addr show p1 | awk 'FNR==3{ print $2 }' | awk -F/ '{ print $1 }'\n", "delta": "0:00:00.049605", "end": "2019-11-17 09:59:44.284769", "rc": 0, "start": "2019-11-17 09:59:44.235164", "stderr": "", "stderr_lines": [], "stdout": "192.168.100.50", "stdout_lines": ["192.168.100.50"]}

TASK [Add VXLAN routes to host] *****************************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.2.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.1.2/24', u'tenant_ns_ip': u'10.2.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}], u'bridge_ip': u'1.1.1.1', u'vms': [{u'mem': 2, u'name': u't1_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM4if1'}]}, {u'local_ip': u'10.2.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.129.2', u'remote_route': u'10.1.1.0/24', u'subnet_route': u'10.2.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.1.1.2'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip route show \"10.2.1.0/24\" via \"192.168.100.50\" | grep -w '^10.2.1.0/24' ; if [ $? -ne 0 ] ; then ip route add \"10.2.1.0/24\" via \"192.168.100.50\" ; fi\nip route show \"10.1.1.0/24\" via 99.99.99.1 | grep -w '^10.1.1.0/24'; if [ $? -ne 0 ] ; then ip route add \"10.1.1.0/24\" via 99.99.99.1 ; fi\n", "delta": "0:00:00.009187", "end": "2019-11-17 09:59:44.724157", "item": [{"bridge_ip": "1.1.1.1", "bridge_name": "t1br1", "default_route_ip": "10.2.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.2.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.2.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.2.1.2/24"}], "vms": [{"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM4", "vcpu": 4, "vmif": "t1VM4if1"}]}, {"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.1.2", "remote_ip": "10.1.1.2", "remote_route": "10.1.1.0/24", "subnet_route": "10.2.1.0/24", "tenant_route_ip": "192.168.129.2", "v_name": "vxlan_t1s1"}], "rc": 0, "start": "2019-11-17 09:59:44.714970", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

PLAY RECAP **************************************************************************************************************************************************
99.99.99.2                 : ok=3    changed=2    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0   

Using /etc/ansible/ansible.cfg as config file

PLAY [main] *************************************************************************************************************************************************

TASK [Create VM templates (C1)] *****************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.1.2/24', u'tenant_ns_ip': u'10.1.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}], u'bridge_ip': u'1.1.1.1', u'vxlan': [{u'local_ip': u'10.1.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.1.2', u'remote_route': u'10.2.1.0/24', u'subnet_route': u'10.1.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.2.1.2'}]}, {u'mem': 2, u'name': u't1_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM1if1'}]) => {"ansible_loop_var": "item", "changed": true, "checksum": "350ba870bd31b7f6ee517845c14237910b5af0bf", "dest": "/root/Migration-as-a-Service/t1/VM_templates/t1_VM1.xml.j2", "gid": 0, "group": "root", "item": [{"bridge_ip": "1.1.1.1", "bridge_name": "t1br1", "default_route_ip": "10.1.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.1.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.1.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.1.1.2/24"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.1.2", "remote_ip": "10.2.1.2", "remote_route": "10.2.1.0/24", "subnet_route": "10.1.1.0/24", "tenant_route_ip": "192.168.1.2", "v_name": "vxlan_t1s1"}]}, {"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM1", "vcpu": 4, "vmif": "t1VM1if1"}], "md5sum": "fbfc2eb0c2569531f25eea92c26d3bee", "mode": "0644", "owner": "root", "size": 4091, "src": "/root/.ansible/tmp/ansible-tmp-1573984785.39-18768739550396/source", "state": "file", "uid": 0}
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.1.2/24', u'tenant_ns_ip': u'10.1.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}], u'bridge_ip': u'1.1.1.1', u'vxlan': [{u'local_ip': u'10.1.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.1.2', u'remote_route': u'10.2.1.0/24', u'subnet_route': u'10.1.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.2.1.2'}]}, {u'mem': 4, u'name': u't1_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br1if2', u'vmif': u't1VM2if1'}]) => {"ansible_loop_var": "item", "changed": true, "checksum": "350ba870bd31b7f6ee517845c14237910b5af0bf", "dest": "/root/Migration-as-a-Service/t1/VM_templates/t1_VM2.xml.j2", "gid": 0, "group": "root", "item": [{"bridge_ip": "1.1.1.1", "bridge_name": "t1br1", "default_route_ip": "10.1.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.1.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.1.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.1.1.2/24"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.1.2", "remote_ip": "10.2.1.2", "remote_route": "10.2.1.0/24", "subnet_route": "10.1.1.0/24", "tenant_route_ip": "192.168.1.2", "v_name": "vxlan_t1s1"}]}, {"brif": "t1br1if2", "disk": "10G", "mem": 4, "name": "t1_VM2", "vcpu": 2, "vmif": "t1VM2if1"}], "md5sum": "fbfc2eb0c2569531f25eea92c26d3bee", "mode": "0644", "owner": "root", "size": 4091, "src": "/root/.ansible/tmp/ansible-tmp-1573984785.96-3791910336882/source", "state": "file", "uid": 0}
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.2.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.2.1', u'bridge_name': u't1br2', u'dns': [{u'dnsif': u't1s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s2_dnsbrif'}], u'ns_name': u't1ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.2.2/24', u'tenant_ns_ip': u'10.1.2.1/24', u'tenant_ns_if': u't1ns2if', u'tenant_sub_if': u't1s2if', u'tenant_ns_name': u't1'}], u'bridge_ip': u'2.2.2.1', u'vxlan': [{u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}, {u'mem': 3, u'name': u't1_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br2if1', u'vmif': u't1VM3if1'}]) => {"ansible_loop_var": "item", "changed": true, "checksum": "350ba870bd31b7f6ee517845c14237910b5af0bf", "dest": "/root/Migration-as-a-Service/t1/VM_templates/t1_VM3.xml.j2", "gid": 0, "group": "root", "item": [{"bridge_ip": "2.2.2.1", "bridge_name": "t1br2", "default_route_ip": "10.1.2.1", "dns": [{"brif": "t1s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t1s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns2", "route": [{"if": "p1", "ip": "10.1.2.1/24", "ns_if": "t1if", "ns_name": "t1"}], "tenant_ns": [{"tenant_ns_if": "t1ns2if", "tenant_ns_ip": "10.1.2.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s2if", "tenant_sub_ip": "10.1.2.2/24"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, {"brif": "t1br2if1", "disk": "10G", "mem": 3, "name": "t1_VM3", "vcpu": 2, "vmif": "t1VM3if1"}], "md5sum": "fbfc2eb0c2569531f25eea92c26d3bee", "mode": "0644", "owner": "root", "size": 4091, "src": "/root/.ansible/tmp/ansible-tmp-1573984786.2-229671014448739/source", "state": "file", "uid": 0}

PLAY RECAP **************************************************************************************************************************************************
localhost                  : ok=1    changed=1    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0   

Using /etc/ansible/ansible.cfg as config file

PLAY [main] *************************************************************************************************************************************************

TASK [Create VM templates (C2)] *****************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.2.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.2.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.1.2/24', u'tenant_ns_ip': u'10.2.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}], u'bridge_ip': u'1.1.1.1', u'vxlan': [{u'local_ip': u'10.2.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.129.2', u'remote_route': u'10.1.1.0/24', u'subnet_route': u'10.2.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.1.1.2'}]}, {u'mem': 2, u'name': u't1_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM4if1'}]) => {"ansible_loop_var": "item", "changed": true, "checksum": "350ba870bd31b7f6ee517845c14237910b5af0bf", "dest": "/root/Migration-as-a-Service/t1/VM_templates/t1_VM4.xml.j2", "gid": 0, "group": "root", "item": [{"bridge_ip": "1.1.1.1", "bridge_name": "t1br1", "default_route_ip": "10.2.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.2.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.2.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.2.1.2/24"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.1.2", "remote_ip": "10.1.1.2", "remote_route": "10.1.1.0/24", "subnet_route": "10.2.1.0/24", "tenant_route_ip": "192.168.129.2", "v_name": "vxlan_t1s1"}]}, {"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM4", "vcpu": 4, "vmif": "t1VM4if1"}], "md5sum": "fbfc2eb0c2569531f25eea92c26d3bee", "mode": "0644", "owner": "root", "size": 4091, "src": "/root/.ansible/tmp/ansible-tmp-1573984786.99-78357944403168/source", "state": "file", "uid": 0}

PLAY RECAP **************************************************************************************************************************************************
localhost                  : ok=1    changed=1    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0   

Using /etc/ansible/ansible.cfg as config file

PLAY [main] *************************************************************************************************************************************************

TASK [Copy VM image] ****************************************************************************************************************************************
ok: [localhost] => (item=[{u'route': [{u'ip': u'10.1.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.1.2/24', u'tenant_ns_ip': u'10.1.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}], u'bridge_ip': u'1.1.1.1', u'vxlan': [{u'local_ip': u'10.1.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.1.2', u'remote_route': u'10.2.1.0/24', u'subnet_route': u'10.1.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.2.1.2'}]}, {u'mem': 2, u'name': u't1_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM1if1'}]) => {"ansible_loop_var": "item", "changed": false, "dest": "/var/lib/libvirt/images/t1_VM1.qcow2", "item": [{"bridge_ip": "1.1.1.1", "bridge_name": "t1br1", "default_route_ip": "10.1.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.1.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.1.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.1.1.2/24"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.1.2", "remote_ip": "10.2.1.2", "remote_route": "10.2.1.0/24", "subnet_route": "10.1.1.0/24", "tenant_route_ip": "192.168.1.2", "v_name": "vxlan_t1s1"}]}, {"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM1", "vcpu": 4, "vmif": "t1VM1if1"}], "src": "/root/mainVM.qcow2"}
ok: [localhost] => (item=[{u'route': [{u'ip': u'10.1.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.1.2/24', u'tenant_ns_ip': u'10.1.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}], u'bridge_ip': u'1.1.1.1', u'vxlan': [{u'local_ip': u'10.1.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.1.2', u'remote_route': u'10.2.1.0/24', u'subnet_route': u'10.1.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.2.1.2'}]}, {u'mem': 4, u'name': u't1_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br1if2', u'vmif': u't1VM2if1'}]) => {"ansible_loop_var": "item", "changed": false, "dest": "/var/lib/libvirt/images/t1_VM2.qcow2", "item": [{"bridge_ip": "1.1.1.1", "bridge_name": "t1br1", "default_route_ip": "10.1.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.1.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.1.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.1.1.2/24"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.1.2", "remote_ip": "10.2.1.2", "remote_route": "10.2.1.0/24", "subnet_route": "10.1.1.0/24", "tenant_route_ip": "192.168.1.2", "v_name": "vxlan_t1s1"}]}, {"brif": "t1br1if2", "disk": "10G", "mem": 4, "name": "t1_VM2", "vcpu": 2, "vmif": "t1VM2if1"}], "src": "/root/mainVM.qcow2"}
ok: [localhost] => (item=[{u'route': [{u'ip': u'10.1.2.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.2.1', u'bridge_name': u't1br2', u'dns': [{u'dnsif': u't1s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s2_dnsbrif'}], u'ns_name': u't1ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.2.2/24', u'tenant_ns_ip': u'10.1.2.1/24', u'tenant_ns_if': u't1ns2if', u'tenant_sub_if': u't1s2if', u'tenant_ns_name': u't1'}], u'bridge_ip': u'2.2.2.1', u'vxlan': [{u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}, {u'mem': 3, u'name': u't1_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br2if1', u'vmif': u't1VM3if1'}]) => {"ansible_loop_var": "item", "changed": false, "dest": "/var/lib/libvirt/images/t1_VM3.qcow2", "item": [{"bridge_ip": "2.2.2.1", "bridge_name": "t1br2", "default_route_ip": "10.1.2.1", "dns": [{"brif": "t1s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t1s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns2", "route": [{"if": "p1", "ip": "10.1.2.1/24", "ns_if": "t1if", "ns_name": "t1"}], "tenant_ns": [{"tenant_ns_if": "t1ns2if", "tenant_ns_ip": "10.1.2.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s2if", "tenant_sub_ip": "10.1.2.2/24"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, {"brif": "t1br2if1", "disk": "10G", "mem": 3, "name": "t1_VM3", "vcpu": 2, "vmif": "t1VM3if1"}], "src": "/root/mainVM.qcow2"}

TASK [Create VM templates (C1)] *****************************************************************************************************************************
ok: [localhost] => (item=[{u'route': [{u'ip': u'10.1.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.1.2/24', u'tenant_ns_ip': u'10.1.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}], u'bridge_ip': u'1.1.1.1', u'vxlan': [{u'local_ip': u'10.1.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.1.2', u'remote_route': u'10.2.1.0/24', u'subnet_route': u'10.1.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.2.1.2'}]}, {u'mem': 2, u'name': u't1_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM1if1'}]) => {"ansible_loop_var": "item", "changed": false, "checksum": "350ba870bd31b7f6ee517845c14237910b5af0bf", "dest": "/root/Migration-as-a-Service/t1/VM_templates/t1_VM1.xml.j2", "gid": 0, "group": "root", "item": [{"bridge_ip": "1.1.1.1", "bridge_name": "t1br1", "default_route_ip": "10.1.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.1.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.1.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.1.1.2/24"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.1.2", "remote_ip": "10.2.1.2", "remote_route": "10.2.1.0/24", "subnet_route": "10.1.1.0/24", "tenant_route_ip": "192.168.1.2", "v_name": "vxlan_t1s1"}]}, {"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM1", "vcpu": 4, "vmif": "t1VM1if1"}], "mode": "0644", "owner": "root", "path": "/root/Migration-as-a-Service/t1/VM_templates/t1_VM1.xml.j2", "size": 4091, "state": "file", "uid": 0}
ok: [localhost] => (item=[{u'route': [{u'ip': u'10.1.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.1.2/24', u'tenant_ns_ip': u'10.1.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}], u'bridge_ip': u'1.1.1.1', u'vxlan': [{u'local_ip': u'10.1.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.1.2', u'remote_route': u'10.2.1.0/24', u'subnet_route': u'10.1.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.2.1.2'}]}, {u'mem': 4, u'name': u't1_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br1if2', u'vmif': u't1VM2if1'}]) => {"ansible_loop_var": "item", "changed": false, "checksum": "350ba870bd31b7f6ee517845c14237910b5af0bf", "dest": "/root/Migration-as-a-Service/t1/VM_templates/t1_VM2.xml.j2", "gid": 0, "group": "root", "item": [{"bridge_ip": "1.1.1.1", "bridge_name": "t1br1", "default_route_ip": "10.1.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.1.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.1.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.1.1.2/24"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.1.2", "remote_ip": "10.2.1.2", "remote_route": "10.2.1.0/24", "subnet_route": "10.1.1.0/24", "tenant_route_ip": "192.168.1.2", "v_name": "vxlan_t1s1"}]}, {"brif": "t1br1if2", "disk": "10G", "mem": 4, "name": "t1_VM2", "vcpu": 2, "vmif": "t1VM2if1"}], "mode": "0644", "owner": "root", "path": "/root/Migration-as-a-Service/t1/VM_templates/t1_VM2.xml.j2", "size": 4091, "state": "file", "uid": 0}
ok: [localhost] => (item=[{u'route': [{u'ip': u'10.1.2.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.2.1', u'bridge_name': u't1br2', u'dns': [{u'dnsif': u't1s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s2_dnsbrif'}], u'ns_name': u't1ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.2.2/24', u'tenant_ns_ip': u'10.1.2.1/24', u'tenant_ns_if': u't1ns2if', u'tenant_sub_if': u't1s2if', u'tenant_ns_name': u't1'}], u'bridge_ip': u'2.2.2.1', u'vxlan': [{u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}, {u'mem': 3, u'name': u't1_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br2if1', u'vmif': u't1VM3if1'}]) => {"ansible_loop_var": "item", "changed": false, "checksum": "350ba870bd31b7f6ee517845c14237910b5af0bf", "dest": "/root/Migration-as-a-Service/t1/VM_templates/t1_VM3.xml.j2", "gid": 0, "group": "root", "item": [{"bridge_ip": "2.2.2.1", "bridge_name": "t1br2", "default_route_ip": "10.1.2.1", "dns": [{"brif": "t1s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t1s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns2", "route": [{"if": "p1", "ip": "10.1.2.1/24", "ns_if": "t1if", "ns_name": "t1"}], "tenant_ns": [{"tenant_ns_if": "t1ns2if", "tenant_ns_ip": "10.1.2.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s2if", "tenant_sub_ip": "10.1.2.2/24"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, {"brif": "t1br2if1", "disk": "10G", "mem": 3, "name": "t1_VM3", "vcpu": 2, "vmif": "t1VM3if1"}], "mode": "0644", "owner": "root", "path": "/root/Migration-as-a-Service/t1/VM_templates/t1_VM3.xml.j2", "size": 4091, "state": "file", "uid": 0}

TASK [Get list of running VMs] ******************************************************************************************************************************
ok: [localhost] => {"changed": false, "cmd": ["virsh", "list", "--name"], "delta": "0:00:00.020699", "end": "2019-11-17 09:59:50.234765", "rc": 0, "start": "2019-11-17 09:59:50.214066", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Define VM] ********************************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.1.2/24', u'tenant_ns_ip': u'10.1.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}], u'bridge_ip': u'1.1.1.1', u'vxlan': [{u'local_ip': u'10.1.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.1.2', u'remote_route': u'10.2.1.0/24', u'subnet_route': u'10.1.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.2.1.2'}]}, {u'mem': 2, u'name': u't1_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM1if1'}]) => {"ansible_loop_var": "item", "changed": true, "created": "t1_VM1", "item": [{"bridge_ip": "1.1.1.1", "bridge_name": "t1br1", "default_route_ip": "10.1.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.1.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.1.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.1.1.2/24"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.1.2", "remote_ip": "10.2.1.2", "remote_route": "10.2.1.0/24", "subnet_route": "10.1.1.0/24", "tenant_route_ip": "192.168.1.2", "v_name": "vxlan_t1s1"}]}, {"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM1", "vcpu": 4, "vmif": "t1VM1if1"}], "warnings": ["'xml' is given - ignoring 'name'"]}
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.1.2/24', u'tenant_ns_ip': u'10.1.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}], u'bridge_ip': u'1.1.1.1', u'vxlan': [{u'local_ip': u'10.1.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.1.2', u'remote_route': u'10.2.1.0/24', u'subnet_route': u'10.1.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.2.1.2'}]}, {u'mem': 4, u'name': u't1_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br1if2', u'vmif': u't1VM2if1'}]) => {"ansible_loop_var": "item", "changed": true, "created": "t1_VM2", "item": [{"bridge_ip": "1.1.1.1", "bridge_name": "t1br1", "default_route_ip": "10.1.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.1.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.1.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.1.1.2/24"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.1.2", "remote_ip": "10.2.1.2", "remote_route": "10.2.1.0/24", "subnet_route": "10.1.1.0/24", "tenant_route_ip": "192.168.1.2", "v_name": "vxlan_t1s1"}]}, {"brif": "t1br1if2", "disk": "10G", "mem": 4, "name": "t1_VM2", "vcpu": 2, "vmif": "t1VM2if1"}], "warnings": ["'xml' is given - ignoring 'name'"]}
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.2.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.2.1', u'bridge_name': u't1br2', u'dns': [{u'dnsif': u't1s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s2_dnsbrif'}], u'ns_name': u't1ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.2.2/24', u'tenant_ns_ip': u'10.1.2.1/24', u'tenant_ns_if': u't1ns2if', u'tenant_sub_if': u't1s2if', u'tenant_ns_name': u't1'}], u'bridge_ip': u'2.2.2.1', u'vxlan': [{u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}, {u'mem': 3, u'name': u't1_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br2if1', u'vmif': u't1VM3if1'}]) => {"ansible_loop_var": "item", "changed": true, "created": "t1_VM3", "item": [{"bridge_ip": "2.2.2.1", "bridge_name": "t1br2", "default_route_ip": "10.1.2.1", "dns": [{"brif": "t1s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t1s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns2", "route": [{"if": "p1", "ip": "10.1.2.1/24", "ns_if": "t1if", "ns_name": "t1"}], "tenant_ns": [{"tenant_ns_if": "t1ns2if", "tenant_ns_ip": "10.1.2.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s2if", "tenant_sub_ip": "10.1.2.2/24"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, {"brif": "t1br2if1", "disk": "10G", "mem": 3, "name": "t1_VM3", "vcpu": 2, "vmif": "t1VM3if1"}], "warnings": ["'xml' is given - ignoring 'name'"]}

TASK [Create VM] ********************************************************************************************************************************************
ok: [localhost] => (item=[{u'route': [{u'ip': u'10.1.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.1.2/24', u'tenant_ns_ip': u'10.1.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}], u'bridge_ip': u'1.1.1.1', u'vxlan': [{u'local_ip': u'10.1.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.1.2', u'remote_route': u'10.2.1.0/24', u'subnet_route': u'10.1.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.2.1.2'}]}, {u'mem': 2, u'name': u't1_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM1if1'}]) => {"ansible_loop_var": "item", "changed": false, "create": 0, "item": [{"bridge_ip": "1.1.1.1", "bridge_name": "t1br1", "default_route_ip": "10.1.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.1.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.1.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.1.1.2/24"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.1.2", "remote_ip": "10.2.1.2", "remote_route": "10.2.1.0/24", "subnet_route": "10.1.1.0/24", "tenant_route_ip": "192.168.1.2", "v_name": "vxlan_t1s1"}]}, {"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM1", "vcpu": 4, "vmif": "t1VM1if1"}]}
ok: [localhost] => (item=[{u'route': [{u'ip': u'10.1.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.1.2/24', u'tenant_ns_ip': u'10.1.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}], u'bridge_ip': u'1.1.1.1', u'vxlan': [{u'local_ip': u'10.1.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.1.2', u'remote_route': u'10.2.1.0/24', u'subnet_route': u'10.1.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.2.1.2'}]}, {u'mem': 4, u'name': u't1_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br1if2', u'vmif': u't1VM2if1'}]) => {"ansible_loop_var": "item", "changed": false, "create": 0, "item": [{"bridge_ip": "1.1.1.1", "bridge_name": "t1br1", "default_route_ip": "10.1.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.1.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.1.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.1.1.2/24"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.1.2", "remote_ip": "10.2.1.2", "remote_route": "10.2.1.0/24", "subnet_route": "10.1.1.0/24", "tenant_route_ip": "192.168.1.2", "v_name": "vxlan_t1s1"}]}, {"brif": "t1br1if2", "disk": "10G", "mem": 4, "name": "t1_VM2", "vcpu": 2, "vmif": "t1VM2if1"}]}
ok: [localhost] => (item=[{u'route': [{u'ip': u'10.1.2.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.2.1', u'bridge_name': u't1br2', u'dns': [{u'dnsif': u't1s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s2_dnsbrif'}], u'ns_name': u't1ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.2.2/24', u'tenant_ns_ip': u'10.1.2.1/24', u'tenant_ns_if': u't1ns2if', u'tenant_sub_if': u't1s2if', u'tenant_ns_name': u't1'}], u'bridge_ip': u'2.2.2.1', u'vxlan': [{u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}, {u'mem': 3, u'name': u't1_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br2if1', u'vmif': u't1VM3if1'}]) => {"ansible_loop_var": "item", "changed": false, "create": 0, "item": [{"bridge_ip": "2.2.2.1", "bridge_name": "t1br2", "default_route_ip": "10.1.2.1", "dns": [{"brif": "t1s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t1s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns2", "route": [{"if": "p1", "ip": "10.1.2.1/24", "ns_if": "t1if", "ns_name": "t1"}], "tenant_ns": [{"tenant_ns_if": "t1ns2if", "tenant_ns_ip": "10.1.2.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s2if", "tenant_sub_ip": "10.1.2.2/24"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, {"brif": "t1br2if1", "disk": "10G", "mem": 3, "name": "t1_VM3", "vcpu": 2, "vmif": "t1VM3if1"}]}

TASK [Start VM] *********************************************************************************************************************************************
ok: [localhost] => (item=[{u'route': [{u'ip': u'10.1.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.1.2/24', u'tenant_ns_ip': u'10.1.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}], u'bridge_ip': u'1.1.1.1', u'vxlan': [{u'local_ip': u'10.1.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.1.2', u'remote_route': u'10.2.1.0/24', u'subnet_route': u'10.1.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.2.1.2'}]}, {u'mem': 2, u'name': u't1_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM1if1'}]) => {"ansible_loop_var": "item", "changed": false, "item": [{"bridge_ip": "1.1.1.1", "bridge_name": "t1br1", "default_route_ip": "10.1.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.1.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.1.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.1.1.2/24"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.1.2", "remote_ip": "10.2.1.2", "remote_route": "10.2.1.0/24", "subnet_route": "10.1.1.0/24", "tenant_route_ip": "192.168.1.2", "v_name": "vxlan_t1s1"}]}, {"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM1", "vcpu": 4, "vmif": "t1VM1if1"}]}
ok: [localhost] => (item=[{u'route': [{u'ip': u'10.1.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.1.2/24', u'tenant_ns_ip': u'10.1.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}], u'bridge_ip': u'1.1.1.1', u'vxlan': [{u'local_ip': u'10.1.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.1.2', u'remote_route': u'10.2.1.0/24', u'subnet_route': u'10.1.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.2.1.2'}]}, {u'mem': 4, u'name': u't1_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br1if2', u'vmif': u't1VM2if1'}]) => {"ansible_loop_var": "item", "changed": false, "item": [{"bridge_ip": "1.1.1.1", "bridge_name": "t1br1", "default_route_ip": "10.1.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.1.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.1.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.1.1.2/24"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.1.2", "remote_ip": "10.2.1.2", "remote_route": "10.2.1.0/24", "subnet_route": "10.1.1.0/24", "tenant_route_ip": "192.168.1.2", "v_name": "vxlan_t1s1"}]}, {"brif": "t1br1if2", "disk": "10G", "mem": 4, "name": "t1_VM2", "vcpu": 2, "vmif": "t1VM2if1"}]}
ok: [localhost] => (item=[{u'route': [{u'ip': u'10.1.2.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.2.1', u'bridge_name': u't1br2', u'dns': [{u'dnsif': u't1s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s2_dnsbrif'}], u'ns_name': u't1ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.2.2/24', u'tenant_ns_ip': u'10.1.2.1/24', u'tenant_ns_if': u't1ns2if', u'tenant_sub_if': u't1s2if', u'tenant_ns_name': u't1'}], u'bridge_ip': u'2.2.2.1', u'vxlan': [{u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}, {u'mem': 3, u'name': u't1_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br2if1', u'vmif': u't1VM3if1'}]) => {"ansible_loop_var": "item", "changed": false, "item": [{"bridge_ip": "2.2.2.1", "bridge_name": "t1br2", "default_route_ip": "10.1.2.1", "dns": [{"brif": "t1s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t1s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns2", "route": [{"if": "p1", "ip": "10.1.2.1/24", "ns_if": "t1if", "ns_name": "t1"}], "tenant_ns": [{"tenant_ns_if": "t1ns2if", "tenant_ns_ip": "10.1.2.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s2if", "tenant_sub_ip": "10.1.2.2/24"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, {"brif": "t1br2if1", "disk": "10G", "mem": 3, "name": "t1_VM3", "vcpu": 2, "vmif": "t1VM3if1"}]}

TASK [Attach VM interface] **********************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.1.2/24', u'tenant_ns_ip': u'10.1.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}], u'bridge_ip': u'1.1.1.1', u'vxlan': [{u'local_ip': u'10.1.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.1.2', u'remote_route': u'10.2.1.0/24', u'subnet_route': u'10.1.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.2.1.2'}]}, {u'mem': 2, u'name': u't1_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM1if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "virsh domiflist \"t1_VM1\" | grep -w 't1VM1if1' ; if [ $? -ne 0 ] ; then virsh attach-interface \"t1_VM1\" direct \"t1VM1if1\" --live --persistent ; fi\n", "delta": "0:00:00.265341", "end": "2019-11-17 09:59:55.022795", "item": [{"bridge_ip": "1.1.1.1", "bridge_name": "t1br1", "default_route_ip": "10.1.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.1.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.1.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.1.1.2/24"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.1.2", "remote_ip": "10.2.1.2", "remote_route": "10.2.1.0/24", "subnet_route": "10.1.1.0/24", "tenant_route_ip": "192.168.1.2", "v_name": "vxlan_t1s1"}]}, {"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM1", "vcpu": 4, "vmif": "t1VM1if1"}], "rc": 0, "start": "2019-11-17 09:59:54.757454", "stderr": "", "stderr_lines": [], "stdout": "Interface attached successfully", "stdout_lines": ["Interface attached successfully"]}
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.1.2/24', u'tenant_ns_ip': u'10.1.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}], u'bridge_ip': u'1.1.1.1', u'vxlan': [{u'local_ip': u'10.1.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.1.2', u'remote_route': u'10.2.1.0/24', u'subnet_route': u'10.1.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.2.1.2'}]}, {u'mem': 4, u'name': u't1_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br1if2', u'vmif': u't1VM2if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "virsh domiflist \"t1_VM2\" | grep -w 't1VM2if1' ; if [ $? -ne 0 ] ; then virsh attach-interface \"t1_VM2\" direct \"t1VM2if1\" --live --persistent ; fi\n", "delta": "0:00:00.231350", "end": "2019-11-17 09:59:55.386706", "item": [{"bridge_ip": "1.1.1.1", "bridge_name": "t1br1", "default_route_ip": "10.1.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.1.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.1.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.1.1.2/24"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.1.2", "remote_ip": "10.2.1.2", "remote_route": "10.2.1.0/24", "subnet_route": "10.1.1.0/24", "tenant_route_ip": "192.168.1.2", "v_name": "vxlan_t1s1"}]}, {"brif": "t1br1if2", "disk": "10G", "mem": 4, "name": "t1_VM2", "vcpu": 2, "vmif": "t1VM2if1"}], "rc": 0, "start": "2019-11-17 09:59:55.155356", "stderr": "", "stderr_lines": [], "stdout": "Interface attached successfully", "stdout_lines": ["Interface attached successfully"]}
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.2.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.1.2.1', u'bridge_name': u't1br2', u'dns': [{u'dnsif': u't1s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't1s2_dnsbrif'}], u'ns_name': u't1ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.2.2/24', u'tenant_ns_ip': u'10.1.2.1/24', u'tenant_ns_if': u't1ns2if', u'tenant_sub_if': u't1s2if', u'tenant_ns_name': u't1'}], u'bridge_ip': u'2.2.2.1', u'vxlan': [{u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}, {u'mem': 3, u'name': u't1_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't1br2if1', u'vmif': u't1VM3if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "virsh domiflist \"t1_VM3\" | grep -w 't1VM3if1' ; if [ $? -ne 0 ] ; then virsh attach-interface \"t1_VM3\" direct \"t1VM3if1\" --live --persistent ; fi\n", "delta": "0:00:00.202696", "end": "2019-11-17 09:59:55.714299", "item": [{"bridge_ip": "2.2.2.1", "bridge_name": "t1br2", "default_route_ip": "10.1.2.1", "dns": [{"brif": "t1s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t1s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns2", "route": [{"if": "p1", "ip": "10.1.2.1/24", "ns_if": "t1if", "ns_name": "t1"}], "tenant_ns": [{"tenant_ns_if": "t1ns2if", "tenant_ns_ip": "10.1.2.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s2if", "tenant_sub_ip": "10.1.2.2/24"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, {"brif": "t1br2if1", "disk": "10G", "mem": 3, "name": "t1_VM3", "vcpu": 2, "vmif": "t1VM3if1"}], "rc": 0, "start": "2019-11-17 09:59:55.511603", "stderr": "", "stderr_lines": [], "stdout": "Interface attached successfully", "stdout_lines": ["Interface attached successfully"]}

PLAY RECAP **************************************************************************************************************************************************
localhost                  : ok=7    changed=2    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0   

Using /etc/ansible/ansible.cfg as config file

PLAY [worker] ***********************************************************************************************************************************************

TASK [Copy VM image] ****************************************************************************************************************************************
ok: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.2.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.1.2/24', u'tenant_ns_ip': u'10.2.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}], u'bridge_ip': u'1.1.1.1', u'vxlan': [{u'local_ip': u'10.2.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.129.2', u'remote_route': u'10.1.1.0/24', u'subnet_route': u'10.2.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.1.1.2'}]}, {u'mem': 2, u'name': u't1_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM4if1'}]) => {"ansible_loop_var": "item", "changed": false, "dest": "/var/lib/libvirt/images/t1_VM4.qcow2", "gid": 0, "group": "root", "item": [{"bridge_ip": "1.1.1.1", "bridge_name": "t1br1", "default_route_ip": "10.2.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.2.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.2.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.2.1.2/24"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.1.2", "remote_ip": "10.1.1.2", "remote_route": "10.1.1.0/24", "subnet_route": "10.2.1.0/24", "tenant_route_ip": "192.168.129.2", "v_name": "vxlan_t1s1"}]}, {"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM4", "vcpu": 4, "vmif": "t1VM4if1"}], "mode": "0644", "msg": "file already exists", "owner": "root", "size": 10739318784, "src": "/root/mainVM.qcow2", "state": "file", "uid": 0}

TASK [Get list of running VMs] ******************************************************************************************************************************
ok: [99.99.99.2] => {"changed": false, "cmd": ["virsh", "list", "--name"], "delta": "0:00:00.019243", "end": "2019-11-17 10:00:46.149007", "rc": 0, "start": "2019-11-17 10:00:46.129764", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Define VM] ********************************************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.2.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.1.2/24', u'tenant_ns_ip': u'10.2.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}], u'bridge_ip': u'1.1.1.1', u'vxlan': [{u'local_ip': u'10.2.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.129.2', u'remote_route': u'10.1.1.0/24', u'subnet_route': u'10.2.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.1.1.2'}]}, {u'mem': 2, u'name': u't1_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM4if1'}]) => {"ansible_loop_var": "item", "changed": true, "created": "t1_VM4", "item": [{"bridge_ip": "1.1.1.1", "bridge_name": "t1br1", "default_route_ip": "10.2.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.2.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.2.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.2.1.2/24"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.1.2", "remote_ip": "10.1.1.2", "remote_route": "10.1.1.0/24", "subnet_route": "10.2.1.0/24", "tenant_route_ip": "192.168.129.2", "v_name": "vxlan_t1s1"}]}, {"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM4", "vcpu": 4, "vmif": "t1VM4if1"}], "warnings": ["'xml' is given - ignoring 'name'"]}

TASK [Create VM] ********************************************************************************************************************************************
ok: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.2.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.1.2/24', u'tenant_ns_ip': u'10.2.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}], u'bridge_ip': u'1.1.1.1', u'vxlan': [{u'local_ip': u'10.2.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.129.2', u'remote_route': u'10.1.1.0/24', u'subnet_route': u'10.2.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.1.1.2'}]}, {u'mem': 2, u'name': u't1_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM4if1'}]) => {"ansible_loop_var": "item", "changed": false, "create": 0, "item": [{"bridge_ip": "1.1.1.1", "bridge_name": "t1br1", "default_route_ip": "10.2.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.2.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.2.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.2.1.2/24"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.1.2", "remote_ip": "10.1.1.2", "remote_route": "10.1.1.0/24", "subnet_route": "10.2.1.0/24", "tenant_route_ip": "192.168.129.2", "v_name": "vxlan_t1s1"}]}, {"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM4", "vcpu": 4, "vmif": "t1VM4if1"}]}

TASK [Start VM] *********************************************************************************************************************************************
ok: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.2.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.1.2/24', u'tenant_ns_ip': u'10.2.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}], u'bridge_ip': u'1.1.1.1', u'vxlan': [{u'local_ip': u'10.2.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.129.2', u'remote_route': u'10.1.1.0/24', u'subnet_route': u'10.2.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.1.1.2'}]}, {u'mem': 2, u'name': u't1_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM4if1'}]) => {"ansible_loop_var": "item", "changed": false, "item": [{"bridge_ip": "1.1.1.1", "bridge_name": "t1br1", "default_route_ip": "10.2.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.2.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.2.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.2.1.2/24"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.1.2", "remote_ip": "10.1.1.2", "remote_route": "10.1.1.0/24", "subnet_route": "10.2.1.0/24", "tenant_route_ip": "192.168.129.2", "v_name": "vxlan_t1s1"}]}, {"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM4", "vcpu": 4, "vmif": "t1VM4if1"}]}

TASK [Attach VM interface] **********************************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.1.1/24', u'ns_name': u't1', u'ns_if': u't1if', u'if': u'p1'}], u'default_route_ip': u'10.2.1.1', u'bridge_name': u't1br1', u'dns': [{u'dnsif': u't1s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't1s1_dnsbrif'}], u'ns_name': u't1ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.1.2/24', u'tenant_ns_ip': u'10.2.1.1/24', u'tenant_ns_if': u't1ns1if', u'tenant_sub_if': u't1s1if', u'tenant_ns_name': u't1'}], u'bridge_ip': u'1.1.1.1', u'vxlan': [{u'local_ip': u'10.2.1.2', u'dsport': 4789, u'dev': u't1s1if', u'tenant_route_ip': u'192.168.129.2', u'remote_route': u'10.1.1.0/24', u'subnet_route': u'10.2.1.0/24', u'v_name': u'vxlan_t1s1', u'id': 42, u'remote_ip': u'10.1.1.2'}]}, {u'mem': 2, u'name': u't1_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't1br1if1', u'vmif': u't1VM4if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "virsh domiflist \"t1_VM4\" | grep -w 't1VM4if1' ; if [ $? -ne 0 ] ; then virsh attach-interface \"t1_VM4\" direct \"t1VM4if1\" --live --persistent ; fi\n", "delta": "0:00:00.266006", "end": "2019-11-17 10:00:48.740773", "item": [{"bridge_ip": "1.1.1.1", "bridge_name": "t1br1", "default_route_ip": "10.2.1.1", "dns": [{"brif": "t1s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t1s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "ns_name": "t1ns1", "route": [{"if": "p1", "ip": "10.2.1.1/24", "ns_if": "t1if", "ns_name": "t1"}], "tenant_ns": [{"tenant_ns_if": "t1ns1if", "tenant_ns_ip": "10.2.1.1/24", "tenant_ns_name": "t1", "tenant_sub_if": "t1s1if", "tenant_sub_ip": "10.2.1.2/24"}], "vxlan": [{"dev": "t1s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.1.2", "remote_ip": "10.1.1.2", "remote_route": "10.1.1.0/24", "subnet_route": "10.2.1.0/24", "tenant_route_ip": "192.168.129.2", "v_name": "vxlan_t1s1"}]}, {"brif": "t1br1if1", "disk": "10G", "mem": 2, "name": "t1_VM4", "vcpu": 4, "vmif": "t1VM4if1"}], "rc": 0, "start": "2019-11-17 10:00:48.474767", "stderr": "", "stderr_lines": [], "stdout": "Interface attached successfully", "stdout_lines": ["Interface attached successfully"]}

PLAY RECAP **************************************************************************************************************************************************
99.99.99.2                 : ok=6    changed=2    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0   

INFO:root: 10:22:35.748679 Printing the yaml input file
INFO:root: 10:22:35.748736 Printing the yaml input file
INFO:root: 10:22:35.748886 {'C1': [{'subnet_addr': '1.1.1.0/24', 'VM': [{'name': 'VM1', 'disk': '10G', 'mem': 2, 'vcpu': 4}, {'name': 'VM2', 'disk': '10G', 'mem': 4, 'vcpu': 2}]}, {'subnet_addr': '2.2.2.0/24', 'VM': [{'name': 'VM3', 'disk': '10G', 'mem': 3, 'vcpu': 2}]}], 'C2': [{'subnet_addr': '1.1.1.0/24', 'VM': [{'name': 'VM4', 'disk': '10G', 'mem': 2, 'vcpu': 4}]}]}
INFO:root: 10:22:35.748942 {'C1': [{'subnet_addr': '1.1.1.0/24', 'VM': [{'name': 'VM1', 'disk': '10G', 'mem': 2, 'vcpu': 4}, {'name': 'VM2', 'disk': '10G', 'mem': 4, 'vcpu': 2}]}, {'subnet_addr': '2.2.2.0/24', 'VM': [{'name': 'VM3', 'disk': '10G', 'mem': 3, 'vcpu': 2}]}], 'C2': [{'subnet_addr': '1.1.1.0/24', 'VM': [{'name': 'VM4', 'disk': '10G', 'mem': 2, 'vcpu': 4}]}]}
INFO:root: 10:22:35.749127 Provided subnet in C1: 1.1.1.0/24 is valid
INFO:root: 10:22:35.749177 Provided subnet in C1: 1.1.1.0/24 is valid
Using /etc/ansible/ansible.cfg as config file
Using /etc/ansible/ansible.cfg as config file

PLAY [main] *************************************************************************************************************************************************

PLAY [main] *************************************************************************************************************************************************

TASK [Create Tenant Namespace] ******************************************************************************************************************************

TASK [Create Tenant Namespace] ******************************************************************************************************************************
ok: [localhost] => (item={u'default_route_ip': u'192.168.2.1', u'name': u't2', u'pns_ip': u'192.168.2.1/24', u'tenant_if': u't2if', u'tenant_ip': u'192.168.2.2/24', u'pns_if': u't2pns_if'}) => {"ansible_loop_var": "item", "changed": false, "cmd": ["ip", "netns", "add", "t2"], "item": {"default_route_ip": "192.168.2.1", "name": "t2", "pns_if": "t2pns_if", "pns_ip": "192.168.2.1/24", "tenant_if": "t2if", "tenant_ip": "192.168.2.2/24"}, "rc": 0, "stdout": "skipped, since /var/run/netns/t2 exists", "stdout_lines": ["skipped, since /var/run/netns/t2 exists"]}

TASK [Create Subnet Namespace] ******************************************************************************************************************************
changed: [localhost] => (item={u'default_route_ip': u'192.168.2.1', u'name': u't2', u'pns_ip': u'192.168.2.1/24', u'tenant_if': u't2if', u'tenant_ip': u'192.168.2.2/24', u'pns_if': u't2pns_if'}) => {"ansible_loop_var": "item", "changed": true, "cmd": ["ip", "netns", "add", "t2"], "delta": "0:00:00.067241", "end": "2019-11-17 10:22:37.100008", "item": {"default_route_ip": "192.168.2.1", "name": "t2", "pns_if": "t2pns_if", "pns_ip": "192.168.2.1/24", "tenant_if": "t2if", "tenant_ip": "192.168.2.2/24"}, "rc": 0, "start": "2019-11-17 10:22:37.032767", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Create Subnet Namespace] ******************************************************************************************************************************
ok: [localhost] => (item={u'route': [{u'ip': u'10.1.11.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.1.11.1', u'bridge_name': u't2br1', u'dns': [{u'dnsif': u't2s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't2s1_dnsbrif'}], u'ns_name': u't2ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.11.2/24', u'tenant_ns_ip': u'10.1.11.1/24', u'tenant_ns_if': u't2ns1if', u'tenant_ns_name': u't2', u'tenant_sub_if': u't2s1if'}], u'bridge_ip': u'1.1.1.1', u'vms': [{u'mem': 2, u'name': u't2_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't2br1if1', u'vmif': u't2VM1if1'}, {u'mem': 4, u'name': u't2_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't2br1if2', u'vmif': u't2VM2if1'}], u'vxlan': [{u'local_ip': u'10.1.11.2', u'tenant_route_ip': u'192.168.2.2', u'dsport': 4789, u'dev': u't2s1if', u'subnet_route': u'10.1.11.0/24', u'remote_route': u'10.2.11.0/24', u'v_name': u'vxlan_t2s1', u'id': 42, u'remote_ip': u'10.2.11.2'}]}) => {"ansible_loop_var": "item", "changed": false, "cmd": ["ip", "netns", "add", "t2ns1"], "item": {"bridge_ip": "1.1.1.1", "bridge_name": "t2br1", "default_route_ip": "10.1.11.1", "dns": [{"brif": "t2s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t2s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns1", "route": [{"if": "p1", "ip": "10.1.11.1/24", "ns_if": "t2if", "ns_name": "t2"}], "tenant_ns": [{"tenant_ns_if": "t2ns1if", "tenant_ns_ip": "10.1.11.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s1if", "tenant_sub_ip": "10.1.11.2/24"}], "vms": [{"brif": "t2br1if1", "disk": "10G", "mem": 2, "name": "t2_VM1", "vcpu": 4, "vmif": "t2VM1if1"}, {"brif": "t2br1if2", "disk": "10G", "mem": 4, "name": "t2_VM2", "vcpu": 2, "vmif": "t2VM2if1"}], "vxlan": [{"dev": "t2s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.11.2", "remote_ip": "10.2.11.2", "remote_route": "10.2.11.0/24", "subnet_route": "10.1.11.0/24", "tenant_route_ip": "192.168.2.2", "v_name": "vxlan_t2s1"}]}, "rc": 0, "stdout": "skipped, since /var/run/netns/t2ns1 exists", "stdout_lines": ["skipped, since /var/run/netns/t2ns1 exists"]}
changed: [localhost] => (item={u'route': [{u'ip': u'10.1.11.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.1.11.1', u'bridge_name': u't2br1', u'dns': [{u'dnsif': u't2s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't2s1_dnsbrif'}], u'ns_name': u't2ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.11.2/24', u'tenant_ns_ip': u'10.1.11.1/24', u'tenant_ns_if': u't2ns1if', u'tenant_ns_name': u't2', u'tenant_sub_if': u't2s1if'}], u'bridge_ip': u'1.1.1.1', u'vms': [{u'mem': 2, u'name': u't2_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't2br1if1', u'vmif': u't2VM1if1'}, {u'mem': 4, u'name': u't2_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't2br1if2', u'vmif': u't2VM2if1'}], u'vxlan': [{u'local_ip': u'10.1.11.2', u'tenant_route_ip': u'192.168.2.2', u'dsport': 4789, u'dev': u't2s1if', u'subnet_route': u'10.1.11.0/24', u'remote_route': u'10.2.11.0/24', u'v_name': u'vxlan_t2s1', u'id': 42, u'remote_ip': u'10.2.11.2'}]}) => {"ansible_loop_var": "item", "changed": true, "cmd": ["ip", "netns", "add", "t2ns1"], "delta": "0:00:00.061799", "end": "2019-11-17 10:22:37.357486", "item": {"bridge_ip": "1.1.1.1", "bridge_name": "t2br1", "default_route_ip": "10.1.11.1", "dns": [{"brif": "t2s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t2s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns1", "route": [{"if": "p1", "ip": "10.1.11.1/24", "ns_if": "t2if", "ns_name": "t2"}], "tenant_ns": [{"tenant_ns_if": "t2ns1if", "tenant_ns_ip": "10.1.11.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s1if", "tenant_sub_ip": "10.1.11.2/24"}], "vms": [{"brif": "t2br1if1", "disk": "10G", "mem": 2, "name": "t2_VM1", "vcpu": 4, "vmif": "t2VM1if1"}, {"brif": "t2br1if2", "disk": "10G", "mem": 4, "name": "t2_VM2", "vcpu": 2, "vmif": "t2VM2if1"}], "vxlan": [{"dev": "t2s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.11.2", "remote_ip": "10.2.11.2", "remote_route": "10.2.11.0/24", "subnet_route": "10.1.11.0/24", "tenant_route_ip": "192.168.2.2", "v_name": "vxlan_t2s1"}]}, "rc": 0, "start": "2019-11-17 10:22:37.295687", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}
ok: [localhost] => (item={u'route': [{u'ip': u'10.1.12.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.1.12.1', u'bridge_name': u't2br2', u'dns': [{u'dnsif': u't2s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't2s2_dnsbrif'}], u'ns_name': u't2ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.12.2/24', u'tenant_ns_ip': u'10.1.12.1/24', u'tenant_ns_if': u't2ns2if', u'tenant_ns_name': u't2', u'tenant_sub_if': u't2s2if'}], u'bridge_ip': u'2.2.2.1', u'vms': [{u'mem': 3, u'name': u't2_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't2br2if1', u'vmif': u't2VM3if1'}], u'vxlan': [{u'local_ip': [], u'tenant_route_ip': [], u'dsport': [], u'dev': [], u'subnet_route': [], u'remote_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}) => {"ansible_loop_var": "item", "changed": false, "cmd": ["ip", "netns", "add", "t2ns2"], "item": {"bridge_ip": "2.2.2.1", "bridge_name": "t2br2", "default_route_ip": "10.1.12.1", "dns": [{"brif": "t2s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t2s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns2", "route": [{"if": "p1", "ip": "10.1.12.1/24", "ns_if": "t2if", "ns_name": "t2"}], "tenant_ns": [{"tenant_ns_if": "t2ns2if", "tenant_ns_ip": "10.1.12.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s2if", "tenant_sub_ip": "10.1.12.2/24"}], "vms": [{"brif": "t2br2if1", "disk": "10G", "mem": 3, "name": "t2_VM3", "vcpu": 2, "vmif": "t2VM3if1"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, "rc": 0, "stdout": "skipped, since /var/run/netns/t2ns2 exists", "stdout_lines": ["skipped, since /var/run/netns/t2ns2 exists"]}

TASK [Create Tenant VETH pairs] *****************************************************************************************************************************
changed: [localhost] => (item={u'route': [{u'ip': u'10.1.12.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.1.12.1', u'bridge_name': u't2br2', u'dns': [{u'dnsif': u't2s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't2s2_dnsbrif'}], u'ns_name': u't2ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.12.2/24', u'tenant_ns_ip': u'10.1.12.1/24', u'tenant_ns_if': u't2ns2if', u'tenant_ns_name': u't2', u'tenant_sub_if': u't2s2if'}], u'bridge_ip': u'2.2.2.1', u'vms': [{u'mem': 3, u'name': u't2_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't2br2if1', u'vmif': u't2VM3if1'}], u'vxlan': [{u'local_ip': [], u'tenant_route_ip': [], u'dsport': [], u'dev': [], u'subnet_route': [], u'remote_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}) => {"ansible_loop_var": "item", "changed": true, "cmd": ["ip", "netns", "add", "t2ns2"], "delta": "0:00:00.060086", "end": "2019-11-17 10:22:37.613558", "item": {"bridge_ip": "2.2.2.1", "bridge_name": "t2br2", "default_route_ip": "10.1.12.1", "dns": [{"brif": "t2s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t2s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns2", "route": [{"if": "p1", "ip": "10.1.12.1/24", "ns_if": "t2if", "ns_name": "t2"}], "tenant_ns": [{"tenant_ns_if": "t2ns2if", "tenant_ns_ip": "10.1.12.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s2if", "tenant_sub_ip": "10.1.12.2/24"}], "vms": [{"brif": "t2br2if1", "disk": "10G", "mem": 3, "name": "t2_VM3", "vcpu": 2, "vmif": "t2VM3if1"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, "rc": 0, "start": "2019-11-17 10:22:37.553472", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Create Tenant VETH pairs] *****************************************************************************************************************************
changed: [localhost] => (item={u'default_route_ip': u'192.168.2.1', u'name': u't2', u'pns_ip': u'192.168.2.1/24', u'tenant_if': u't2if', u'tenant_ip': u'192.168.2.2/24', u'pns_if': u't2pns_if'}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip link show \"t2if\" ; if [ $? -ne 0 ] ; then ip link add \"t2if\" type veth peer name \"t2pns_if\" ; fi\n", "delta": "0:00:00.011673", "end": "2019-11-17 10:22:37.821375", "item": {"default_route_ip": "192.168.2.1", "name": "t2", "pns_if": "t2pns_if", "pns_ip": "192.168.2.1/24", "tenant_if": "t2if", "tenant_ip": "192.168.2.2/24"}, "rc": 0, "start": "2019-11-17 10:22:37.809702", "stderr": "Device \"t2if\" does not exist.", "stderr_lines": ["Device \"t2if\" does not exist."], "stdout": "", "stdout_lines": []}

TASK [Attach Tenant VETH Pairs] *****************************************************************************************************************************
changed: [localhost] => (item={u'default_route_ip': u'192.168.2.1', u'name': u't2', u'pns_ip': u'192.168.2.1/24', u'tenant_if': u't2if', u'tenant_ip': u'192.168.2.2/24', u'pns_if': u't2pns_if'}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip link show \"t2if\" ; if [ $? -ne 0 ] ; then ip link add \"t2if\" type veth peer name \"t2pns_if\" ; fi\n", "delta": "0:00:00.004234", "end": "2019-11-17 10:22:37.879584", "item": {"default_route_ip": "192.168.2.1", "name": "t2", "pns_if": "t2pns_if", "pns_ip": "192.168.2.1/24", "tenant_if": "t2if", "tenant_ip": "192.168.2.2/24"}, "rc": 0, "start": "2019-11-17 10:22:37.875350", "stderr": "", "stderr_lines": [], "stdout": "58: t2if@t2pns_if: <BROADCAST,MULTICAST> mtu 1500 qdisc noop state DOWN mode DEFAULT group default qlen 1000\n    link/ether 0e:3a:51:2b:a2:7f brd ff:ff:ff:ff:ff:ff", "stdout_lines": ["58: t2if@t2pns_if: <BROADCAST,MULTICAST> mtu 1500 qdisc noop state DOWN mode DEFAULT group default qlen 1000", "    link/ether 0e:3a:51:2b:a2:7f brd ff:ff:ff:ff:ff:ff"]}

TASK [Attach Tenant VETH Pairs] *****************************************************************************************************************************
changed: [localhost] => (item={u'default_route_ip': u'192.168.2.1', u'name': u't2', u'pns_ip': u'192.168.2.1/24', u'tenant_if': u't2if', u'tenant_ip': u'192.168.2.2/24', u'pns_if': u't2pns_if'}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec pns ip link show \"t2pns_if\" ; if [ $? -ne 0 ] ; then ip link set \"t2pns_if\" netns pns ; fi\nip netns exec \"t2\" ip link show \"t2if\" ; if [ $? -ne 0 ] ; then ip link set \"t2if\" netns \"t2\" ; fi\nip netns exec pns ip link set dev \"t2pns_if\" up\nip netns exec \"t2\" ip link set dev \"t2if\" up\n", "delta": "0:00:00.195145", "end": "2019-11-17 10:22:38.323739", "item": {"default_route_ip": "192.168.2.1", "name": "t2", "pns_if": "t2pns_if", "pns_ip": "192.168.2.1/24", "tenant_if": "t2if", "tenant_ip": "192.168.2.2/24"}, "rc": 0, "start": "2019-11-17 10:22:38.128594", "stderr": "Device \"t2pns_if\" does not exist.\nDevice \"t2if\" does not exist.", "stderr_lines": ["Device \"t2pns_if\" does not exist.", "Device \"t2if\" does not exist."], "stdout": "", "stdout_lines": []}

TASK [Add IP addresses to Tenant VETH Pairs] ****************************************************************************************************************
changed: [localhost] => (item={u'default_route_ip': u'192.168.2.1', u'name': u't2', u'pns_ip': u'192.168.2.1/24', u'tenant_if': u't2if', u'tenant_ip': u'192.168.2.2/24', u'pns_if': u't2pns_if'}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec pns ip link show \"t2pns_if\" ; if [ $? -ne 0 ] ; then ip link set \"t2pns_if\" netns pns ; fi\nip netns exec \"t2\" ip link show \"t2if\" ; if [ $? -ne 0 ] ; then ip link set \"t2if\" netns \"t2\" ; fi\nip netns exec pns ip link set dev \"t2pns_if\" up\nip netns exec \"t2\" ip link set dev \"t2if\" up\n", "delta": "0:00:00.179772", "end": "2019-11-17 10:22:38.331591", "item": {"default_route_ip": "192.168.2.1", "name": "t2", "pns_if": "t2pns_if", "pns_ip": "192.168.2.1/24", "tenant_if": "t2if", "tenant_ip": "192.168.2.2/24"}, "rc": 0, "start": "2019-11-17 10:22:38.151819", "stderr": "", "stderr_lines": [], "stdout": "57: t2pns_if@if58: <BROADCAST,MULTICAST> mtu 1500 qdisc noop state DOWN mode DEFAULT group default qlen 1000\n    link/ether 4e:a3:a9:de:99:a3 brd ff:ff:ff:ff:ff:ff link-netnsid 0\n58: t2if@if57: <BROADCAST,MULTICAST> mtu 1500 qdisc noop state DOWN mode DEFAULT group default qlen 1000\n    link/ether 0e:3a:51:2b:a2:7f brd ff:ff:ff:ff:ff:ff link-netnsid 0", "stdout_lines": ["57: t2pns_if@if58: <BROADCAST,MULTICAST> mtu 1500 qdisc noop state DOWN mode DEFAULT group default qlen 1000", "    link/ether 4e:a3:a9:de:99:a3 brd ff:ff:ff:ff:ff:ff link-netnsid 0", "58: t2if@if57: <BROADCAST,MULTICAST> mtu 1500 qdisc noop state DOWN mode DEFAULT group default qlen 1000", "    link/ether 0e:3a:51:2b:a2:7f brd ff:ff:ff:ff:ff:ff link-netnsid 0"]}

TASK [Add IP addresses to Tenant VETH Pairs] ****************************************************************************************************************
changed: [localhost] => (item={u'default_route_ip': u'192.168.2.1', u'name': u't2', u'pns_ip': u'192.168.2.1/24', u'tenant_if': u't2if', u'tenant_ip': u'192.168.2.2/24', u'pns_if': u't2pns_if'}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec pns ip addr show \"t2pns_if\" | awk 'FNR==3{ print $2 }' | grep -w '^192.168.2.1/24' ; if [ $? -ne 0 ] ; then ip netns exec pns ip addr add \"192.168.2.1/24\" dev \"t2pns_if\" ; fi\nip netns exec \"t2\" ip addr show \"t2if\" | awk 'FNR==3{ print $2 }' | grep -w '^192.168.2.2/24' ; if [ $? -ne 0 ] ; then ip netns exec \"t2\" ip addr add \"192.168.2.2/24\" dev \"t2if\" ; fi\n", "delta": "0:00:00.142997", "end": "2019-11-17 10:22:38.751671", "item": {"default_route_ip": "192.168.2.1", "name": "t2", "pns_if": "t2pns_if", "pns_ip": "192.168.2.1/24", "tenant_if": "t2if", "tenant_ip": "192.168.2.2/24"}, "rc": 0, "start": "2019-11-17 10:22:38.608674", "stderr": "RTNETLINK answers: File exists", "stderr_lines": ["RTNETLINK answers: File exists"], "stdout": "", "stdout_lines": []}

TASK [Create Namespace VETH Pairs] **************************************************************************************************************************
failed: [localhost] (item={u'default_route_ip': u'192.168.2.1', u'name': u't2', u'pns_ip': u'192.168.2.1/24', u'tenant_if': u't2if', u'tenant_ip': u'192.168.2.2/24', u'pns_if': u't2pns_if'}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec pns ip addr show \"t2pns_if\" | awk 'FNR==3{ print $2 }' | grep -w '^192.168.2.1/24' ; if [ $? -ne 0 ] ; then ip netns exec pns ip addr add \"192.168.2.1/24\" dev \"t2pns_if\" ; fi\nip netns exec \"t2\" ip addr show \"t2if\" | awk 'FNR==3{ print $2 }' | grep -w '^192.168.2.2/24' ; if [ $? -ne 0 ] ; then ip netns exec \"t2\" ip addr add \"192.168.2.2/24\" dev \"t2if\" ; fi\n", "delta": "0:00:00.147734", "end": "2019-11-17 10:22:38.759607", "item": {"default_route_ip": "192.168.2.1", "name": "t2", "pns_if": "t2pns_if", "pns_ip": "192.168.2.1/24", "tenant_if": "t2if", "tenant_ip": "192.168.2.2/24"}, "msg": "non-zero return code", "rc": 2, "start": "2019-11-17 10:22:38.611873", "stderr": "RTNETLINK answers: File exists", "stderr_lines": ["RTNETLINK answers: File exists"], "stdout": "", "stdout_lines": []}

PLAY RECAP **************************************************************************************************************************************************
localhost                  : ok=4    changed=4    unreachable=0    failed=1    skipped=0    rescued=0    ignored=0   

changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.11.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.1.11.1', u'bridge_name': u't2br1', u'dns': [{u'dnsif': u't2s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't2s1_dnsbrif'}], u'ns_name': u't2ns1', u'bridge_ip': u'1.1.1.1', u'vms': [{u'mem': 2, u'name': u't2_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't2br1if1', u'vmif': u't2VM1if1'}, {u'mem': 4, u'name': u't2_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't2br1if2', u'vmif': u't2VM2if1'}], u'vxlan': [{u'local_ip': u'10.1.11.2', u'dsport': 4789, u'dev': u't2s1if', u'tenant_route_ip': u'192.168.2.2', u'remote_route': u'10.2.11.0/24', u'subnet_route': u'10.1.11.0/24', u'v_name': u'vxlan_t2s1', u'id': 42, u'remote_ip': u'10.2.11.2'}]}, {u'tenant_sub_ip': u'10.1.11.2/24', u'tenant_ns_ip': u'10.1.11.1/24', u'tenant_ns_if': u't2ns1if', u'tenant_sub_if': u't2s1if', u'tenant_ns_name': u't2'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip link show \"t2ns1if\" ; if [ $? -ne 0 ] ; then ip link add \"t2ns1if\" type veth peer name \"t2s1if\" ; fi\n", "delta": "0:00:00.011086", "end": "2019-11-17 10:22:39.041178", "item": [{"bridge_ip": "1.1.1.1", "bridge_name": "t2br1", "default_route_ip": "10.1.11.1", "dns": [{"brif": "t2s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t2s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns1", "route": [{"if": "p1", "ip": "10.1.11.1/24", "ns_if": "t2if", "ns_name": "t2"}], "vms": [{"brif": "t2br1if1", "disk": "10G", "mem": 2, "name": "t2_VM1", "vcpu": 4, "vmif": "t2VM1if1"}, {"brif": "t2br1if2", "disk": "10G", "mem": 4, "name": "t2_VM2", "vcpu": 2, "vmif": "t2VM2if1"}], "vxlan": [{"dev": "t2s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.11.2", "remote_ip": "10.2.11.2", "remote_route": "10.2.11.0/24", "subnet_route": "10.1.11.0/24", "tenant_route_ip": "192.168.2.2", "v_name": "vxlan_t2s1"}]}, {"tenant_ns_if": "t2ns1if", "tenant_ns_ip": "10.1.11.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s1if", "tenant_sub_ip": "10.1.11.2/24"}], "rc": 0, "start": "2019-11-17 10:22:39.030092", "stderr": "Device \"t2ns1if\" does not exist.", "stderr_lines": ["Device \"t2ns1if\" does not exist."], "stdout": "", "stdout_lines": []}
Using /etc/ansible/ansible.cfg as config file
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.12.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.1.12.1', u'bridge_name': u't2br2', u'dns': [{u'dnsif': u't2s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't2s2_dnsbrif'}], u'ns_name': u't2ns2', u'bridge_ip': u'2.2.2.1', u'vms': [{u'mem': 3, u'name': u't2_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't2br2if1', u'vmif': u't2VM3if1'}], u'vxlan': [{u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}, {u'tenant_sub_ip': u'10.1.12.2/24', u'tenant_ns_ip': u'10.1.12.1/24', u'tenant_ns_if': u't2ns2if', u'tenant_sub_if': u't2s2if', u'tenant_ns_name': u't2'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip link show \"t2ns2if\" ; if [ $? -ne 0 ] ; then ip link add \"t2ns2if\" type veth peer name \"t2s2if\" ; fi\n", "delta": "0:00:00.010532", "end": "2019-11-17 10:22:39.285646", "item": [{"bridge_ip": "2.2.2.1", "bridge_name": "t2br2", "default_route_ip": "10.1.12.1", "dns": [{"brif": "t2s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t2s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns2", "route": [{"if": "p1", "ip": "10.1.12.1/24", "ns_if": "t2if", "ns_name": "t2"}], "vms": [{"brif": "t2br2if1", "disk": "10G", "mem": 3, "name": "t2_VM3", "vcpu": 2, "vmif": "t2VM3if1"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, {"tenant_ns_if": "t2ns2if", "tenant_ns_ip": "10.1.12.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s2if", "tenant_sub_ip": "10.1.12.2/24"}], "rc": 0, "start": "2019-11-17 10:22:39.275114", "stderr": "Device \"t2ns2if\" does not exist.", "stderr_lines": ["Device \"t2ns2if\" does not exist."], "stdout": "", "stdout_lines": []}

TASK [Attach Namespace VETH Pairs] **************************************************************************************************************************

PLAY [worker] ***********************************************************************************************************************************************

TASK [Create Tenant Namespace] ******************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.11.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.1.11.1', u'bridge_name': u't2br1', u'dns': [{u'dnsif': u't2s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't2s1_dnsbrif'}], u'ns_name': u't2ns1', u'bridge_ip': u'1.1.1.1', u'vms': [{u'mem': 2, u'name': u't2_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't2br1if1', u'vmif': u't2VM1if1'}, {u'mem': 4, u'name': u't2_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't2br1if2', u'vmif': u't2VM2if1'}], u'vxlan': [{u'local_ip': u'10.1.11.2', u'dsport': 4789, u'dev': u't2s1if', u'tenant_route_ip': u'192.168.2.2', u'remote_route': u'10.2.11.0/24', u'subnet_route': u'10.1.11.0/24', u'v_name': u'vxlan_t2s1', u'id': 42, u'remote_ip': u'10.2.11.2'}]}, {u'tenant_sub_ip': u'10.1.11.2/24', u'tenant_ns_ip': u'10.1.11.1/24', u'tenant_ns_if': u't2ns1if', u'tenant_sub_if': u't2s1if', u'tenant_ns_name': u't2'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t2\" ip link show \"t2ns1if\" ; if [ $? -ne 0 ] ; then ip link set \"t2ns1if\" netns \"t2\" ; fi\nip netns exec \"t2ns1\" ip link show \"t2s1if\" ; if [ $? -ne 0 ] ; then ip link set \"t2s1if\" netns \"t2ns1\" ; fi\n", "delta": "0:00:00.104102", "end": "2019-11-17 10:22:39.677586", "item": [{"bridge_ip": "1.1.1.1", "bridge_name": "t2br1", "default_route_ip": "10.1.11.1", "dns": [{"brif": "t2s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t2s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns1", "route": [{"if": "p1", "ip": "10.1.11.1/24", "ns_if": "t2if", "ns_name": "t2"}], "vms": [{"brif": "t2br1if1", "disk": "10G", "mem": 2, "name": "t2_VM1", "vcpu": 4, "vmif": "t2VM1if1"}, {"brif": "t2br1if2", "disk": "10G", "mem": 4, "name": "t2_VM2", "vcpu": 2, "vmif": "t2VM2if1"}], "vxlan": [{"dev": "t2s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.11.2", "remote_ip": "10.2.11.2", "remote_route": "10.2.11.0/24", "subnet_route": "10.1.11.0/24", "tenant_route_ip": "192.168.2.2", "v_name": "vxlan_t2s1"}]}, {"tenant_ns_if": "t2ns1if", "tenant_ns_ip": "10.1.11.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s1if", "tenant_sub_ip": "10.1.11.2/24"}], "rc": 0, "start": "2019-11-17 10:22:39.573484", "stderr": "Device \"t2ns1if\" does not exist.\nDevice \"t2s1if\" does not exist.", "stderr_lines": ["Device \"t2ns1if\" does not exist.", "Device \"t2s1if\" does not exist."], "stdout": "", "stdout_lines": []}
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.12.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.1.12.1', u'bridge_name': u't2br2', u'dns': [{u'dnsif': u't2s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't2s2_dnsbrif'}], u'ns_name': u't2ns2', u'bridge_ip': u'2.2.2.1', u'vms': [{u'mem': 3, u'name': u't2_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't2br2if1', u'vmif': u't2VM3if1'}], u'vxlan': [{u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}, {u'tenant_sub_ip': u'10.1.12.2/24', u'tenant_ns_ip': u'10.1.12.1/24', u'tenant_ns_if': u't2ns2if', u'tenant_sub_if': u't2s2if', u'tenant_ns_name': u't2'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t2\" ip link show \"t2ns2if\" ; if [ $? -ne 0 ] ; then ip link set \"t2ns2if\" netns \"t2\" ; fi\nip netns exec \"t2ns2\" ip link show \"t2s2if\" ; if [ $? -ne 0 ] ; then ip link set \"t2s2if\" netns \"t2ns2\" ; fi\n", "delta": "0:00:00.118939", "end": "2019-11-17 10:22:40.000094", "item": [{"bridge_ip": "2.2.2.1", "bridge_name": "t2br2", "default_route_ip": "10.1.12.1", "dns": [{"brif": "t2s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t2s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns2", "route": [{"if": "p1", "ip": "10.1.12.1/24", "ns_if": "t2if", "ns_name": "t2"}], "vms": [{"brif": "t2br2if1", "disk": "10G", "mem": 3, "name": "t2_VM3", "vcpu": 2, "vmif": "t2VM3if1"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, {"tenant_ns_if": "t2ns2if", "tenant_ns_ip": "10.1.12.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s2if", "tenant_sub_ip": "10.1.12.2/24"}], "rc": 0, "start": "2019-11-17 10:22:39.881155", "stderr": "Device \"t2ns2if\" does not exist.\nDevice \"t2s2if\" does not exist.", "stderr_lines": ["Device \"t2ns2if\" does not exist.", "Device \"t2s2if\" does not exist."], "stdout": "", "stdout_lines": []}

TASK [Set Namespace VETH Pairs UP] **************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.11.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.1.11.1', u'bridge_name': u't2br1', u'dns': [{u'dnsif': u't2s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't2s1_dnsbrif'}], u'ns_name': u't2ns1', u'bridge_ip': u'1.1.1.1', u'vms': [{u'mem': 2, u'name': u't2_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't2br1if1', u'vmif': u't2VM1if1'}, {u'mem': 4, u'name': u't2_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't2br1if2', u'vmif': u't2VM2if1'}], u'vxlan': [{u'local_ip': u'10.1.11.2', u'dsport': 4789, u'dev': u't2s1if', u'tenant_route_ip': u'192.168.2.2', u'remote_route': u'10.2.11.0/24', u'subnet_route': u'10.1.11.0/24', u'v_name': u'vxlan_t2s1', u'id': 42, u'remote_ip': u'10.2.11.2'}]}, {u'tenant_sub_ip': u'10.1.11.2/24', u'tenant_ns_ip': u'10.1.11.1/24', u'tenant_ns_if': u't2ns1if', u'tenant_sub_if': u't2s1if', u'tenant_ns_name': u't2'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t2\" ip link set dev \"t2ns1if\" up\nip netns exec \"t2ns1\" ip link set dev \"t2s1if\" up\n", "delta": "0:00:00.079513", "end": "2019-11-17 10:22:40.343582", "item": [{"bridge_ip": "1.1.1.1", "bridge_name": "t2br1", "default_route_ip": "10.1.11.1", "dns": [{"brif": "t2s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t2s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns1", "route": [{"if": "p1", "ip": "10.1.11.1/24", "ns_if": "t2if", "ns_name": "t2"}], "vms": [{"brif": "t2br1if1", "disk": "10G", "mem": 2, "name": "t2_VM1", "vcpu": 4, "vmif": "t2VM1if1"}, {"brif": "t2br1if2", "disk": "10G", "mem": 4, "name": "t2_VM2", "vcpu": 2, "vmif": "t2VM2if1"}], "vxlan": [{"dev": "t2s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.11.2", "remote_ip": "10.2.11.2", "remote_route": "10.2.11.0/24", "subnet_route": "10.1.11.0/24", "tenant_route_ip": "192.168.2.2", "v_name": "vxlan_t2s1"}]}, {"tenant_ns_if": "t2ns1if", "tenant_ns_ip": "10.1.11.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s1if", "tenant_sub_ip": "10.1.11.2/24"}], "rc": 0, "start": "2019-11-17 10:22:40.264069", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.12.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.1.12.1', u'bridge_name': u't2br2', u'dns': [{u'dnsif': u't2s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't2s2_dnsbrif'}], u'ns_name': u't2ns2', u'bridge_ip': u'2.2.2.1', u'vms': [{u'mem': 3, u'name': u't2_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't2br2if1', u'vmif': u't2VM3if1'}], u'vxlan': [{u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}, {u'tenant_sub_ip': u'10.1.12.2/24', u'tenant_ns_ip': u'10.1.12.1/24', u'tenant_ns_if': u't2ns2if', u'tenant_sub_if': u't2s2if', u'tenant_ns_name': u't2'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t2\" ip link set dev \"t2ns2if\" up\nip netns exec \"t2ns2\" ip link set dev \"t2s2if\" up\n", "delta": "0:00:00.086495", "end": "2019-11-17 10:22:40.619533", "item": [{"bridge_ip": "2.2.2.1", "bridge_name": "t2br2", "default_route_ip": "10.1.12.1", "dns": [{"brif": "t2s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t2s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns2", "route": [{"if": "p1", "ip": "10.1.12.1/24", "ns_if": "t2if", "ns_name": "t2"}], "vms": [{"brif": "t2br2if1", "disk": "10G", "mem": 3, "name": "t2_VM3", "vcpu": 2, "vmif": "t2VM3if1"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, {"tenant_ns_if": "t2ns2if", "tenant_ns_ip": "10.1.12.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s2if", "tenant_sub_ip": "10.1.12.2/24"}], "rc": 0, "start": "2019-11-17 10:22:40.533038", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Add IP addresses to Namespace VETH Pairs] *************************************************************************************************************
changed: [99.99.99.2] => (item={u'default_route_ip': u'192.168.130.1', u'name': u't2', u'pns_ip': u'192.168.130.1/24', u'tenant_if': u't2if', u'tenant_ip': u'192.168.130.2/24', u'pns_if': u't2pns_if'}) => {"ansible_loop_var": "item", "changed": true, "cmd": ["ip", "netns", "add", "t2"], "delta": "0:00:00.050483", "end": "2019-11-17 10:22:40.637039", "item": {"default_route_ip": "192.168.130.1", "name": "t2", "pns_if": "t2pns_if", "pns_ip": "192.168.130.1/24", "tenant_if": "t2if", "tenant_ip": "192.168.130.2/24"}, "rc": 0, "start": "2019-11-17 10:22:40.586556", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Create Subnet Namespace] ******************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.11.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.1.11.1', u'bridge_name': u't2br1', u'dns': [{u'dnsif': u't2s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't2s1_dnsbrif'}], u'ns_name': u't2ns1', u'bridge_ip': u'1.1.1.1', u'vms': [{u'mem': 2, u'name': u't2_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't2br1if1', u'vmif': u't2VM1if1'}, {u'mem': 4, u'name': u't2_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't2br1if2', u'vmif': u't2VM2if1'}], u'vxlan': [{u'local_ip': u'10.1.11.2', u'dsport': 4789, u'dev': u't2s1if', u'tenant_route_ip': u'192.168.2.2', u'remote_route': u'10.2.11.0/24', u'subnet_route': u'10.1.11.0/24', u'v_name': u'vxlan_t2s1', u'id': 42, u'remote_ip': u'10.2.11.2'}]}, {u'tenant_sub_ip': u'10.1.11.2/24', u'tenant_ns_ip': u'10.1.11.1/24', u'tenant_ns_if': u't2ns1if', u'tenant_sub_if': u't2s1if', u'tenant_ns_name': u't2'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t2ns1\" ip addr show \"t2s1if\" | awk 'FNR==3{ print $2 }' | grep -w '^10.1.11.2/24' ; if [ $? -ne 0 ] ; then ip netns exec \"t2ns1\" ip addr add \"10.1.11.2/24\" dev \"t2s1if\" ; fi\n\nip netns exec \"t2\" ip addr show \"t2ns1if\" | awk 'FNR==3{ print $2 }' | grep -w '^10.1.11.1/24' ; if [ $? -ne 0 ] ; then ip netns exec \"t2\" ip addr add \"10.1.11.1/24\" dev \"t2ns1if\" ; fi\n", "delta": "0:00:00.135640", "end": "2019-11-17 10:22:41.015769", "item": [{"bridge_ip": "1.1.1.1", "bridge_name": "t2br1", "default_route_ip": "10.1.11.1", "dns": [{"brif": "t2s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t2s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns1", "route": [{"if": "p1", "ip": "10.1.11.1/24", "ns_if": "t2if", "ns_name": "t2"}], "vms": [{"brif": "t2br1if1", "disk": "10G", "mem": 2, "name": "t2_VM1", "vcpu": 4, "vmif": "t2VM1if1"}, {"brif": "t2br1if2", "disk": "10G", "mem": 4, "name": "t2_VM2", "vcpu": 2, "vmif": "t2VM2if1"}], "vxlan": [{"dev": "t2s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.11.2", "remote_ip": "10.2.11.2", "remote_route": "10.2.11.0/24", "subnet_route": "10.1.11.0/24", "tenant_route_ip": "192.168.2.2", "v_name": "vxlan_t2s1"}]}, {"tenant_ns_if": "t2ns1if", "tenant_ns_ip": "10.1.11.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s1if", "tenant_sub_ip": "10.1.11.2/24"}], "rc": 0, "start": "2019-11-17 10:22:40.880129", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}
changed: [99.99.99.2] => (item={u'route': [{u'ip': u'10.2.11.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.2.11.1', u'bridge_name': u't2br1', u'dns': [{u'dnsif': u't2s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't2s1_dnsbrif'}], u'ns_name': u't2ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.11.2/24', u'tenant_ns_ip': u'10.2.11.1/24', u'tenant_ns_if': u't2ns1if', u'tenant_ns_name': u't2', u'tenant_sub_if': u't2s1if'}], u'bridge_ip': u'1.1.1.1', u'vms': [{u'mem': 2, u'name': u't2_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't2br1if1', u'vmif': u't2VM4if1'}], u'vxlan': [{u'local_ip': u'10.2.11.2', u'tenant_route_ip': u'192.168.130.2', u'dsport': 4789, u'dev': u't2s1if', u'subnet_route': u'10.2.11.0/24', u'remote_route': u'10.1.11.0/24', u'v_name': u'vxlan_t2s1', u'id': 42, u'remote_ip': u'10.1.11.2'}]}) => {"ansible_loop_var": "item", "changed": true, "cmd": ["ip", "netns", "add", "t2ns1"], "delta": "0:00:00.052018", "end": "2019-11-17 10:22:41.038801", "item": {"bridge_ip": "1.1.1.1", "bridge_name": "t2br1", "default_route_ip": "10.2.11.1", "dns": [{"brif": "t2s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t2s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns1", "route": [{"if": "p1", "ip": "10.2.11.1/24", "ns_if": "t2if", "ns_name": "t2"}], "tenant_ns": [{"tenant_ns_if": "t2ns1if", "tenant_ns_ip": "10.2.11.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s1if", "tenant_sub_ip": "10.2.11.2/24"}], "vms": [{"brif": "t2br1if1", "disk": "10G", "mem": 2, "name": "t2_VM4", "vcpu": 4, "vmif": "t2VM4if1"}], "vxlan": [{"dev": "t2s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.11.2", "remote_ip": "10.1.11.2", "remote_route": "10.1.11.0/24", "subnet_route": "10.2.11.0/24", "tenant_route_ip": "192.168.130.2", "v_name": "vxlan_t2s1"}]}, "rc": 0, "start": "2019-11-17 10:22:40.986783", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Create Tenant VETH pairs] *****************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.12.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.1.12.1', u'bridge_name': u't2br2', u'dns': [{u'dnsif': u't2s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't2s2_dnsbrif'}], u'ns_name': u't2ns2', u'bridge_ip': u'2.2.2.1', u'vms': [{u'mem': 3, u'name': u't2_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't2br2if1', u'vmif': u't2VM3if1'}], u'vxlan': [{u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}, {u'tenant_sub_ip': u'10.1.12.2/24', u'tenant_ns_ip': u'10.1.12.1/24', u'tenant_ns_if': u't2ns2if', u'tenant_sub_if': u't2s2if', u'tenant_ns_name': u't2'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t2ns2\" ip addr show \"t2s2if\" | awk 'FNR==3{ print $2 }' | grep -w '^10.1.12.2/24' ; if [ $? -ne 0 ] ; then ip netns exec \"t2ns2\" ip addr add \"10.1.12.2/24\" dev \"t2s2if\" ; fi\n\nip netns exec \"t2\" ip addr show \"t2ns2if\" | awk 'FNR==3{ print $2 }' | grep -w '^10.1.12.1/24' ; if [ $? -ne 0 ] ; then ip netns exec \"t2\" ip addr add \"10.1.12.1/24\" dev \"t2ns2if\" ; fi\n", "delta": "0:00:00.148034", "end": "2019-11-17 10:22:41.399724", "item": [{"bridge_ip": "2.2.2.1", "bridge_name": "t2br2", "default_route_ip": "10.1.12.1", "dns": [{"brif": "t2s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t2s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns2", "route": [{"if": "p1", "ip": "10.1.12.1/24", "ns_if": "t2if", "ns_name": "t2"}], "vms": [{"brif": "t2br2if1", "disk": "10G", "mem": 3, "name": "t2_VM3", "vcpu": 2, "vmif": "t2VM3if1"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, {"tenant_ns_if": "t2ns2if", "tenant_ns_ip": "10.1.12.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s2if", "tenant_sub_ip": "10.1.12.2/24"}], "rc": 0, "start": "2019-11-17 10:22:41.251690", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Add IP Route to Tenant] *******************************************************************************************************************************
changed: [99.99.99.2] => (item={u'default_route_ip': u'192.168.130.1', u'name': u't2', u'pns_ip': u'192.168.130.1/24', u'tenant_if': u't2if', u'tenant_ip': u'192.168.130.2/24', u'pns_if': u't2pns_if'}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip link show \"t2if\" ; if [ $? -ne 0 ] ; then ip link add \"t2if\" type veth peer name \"t2pns_if\" ; fi\n", "delta": "0:00:00.009686", "end": "2019-11-17 10:22:41.431909", "item": {"default_route_ip": "192.168.130.1", "name": "t2", "pns_if": "t2pns_if", "pns_ip": "192.168.130.1/24", "tenant_if": "t2if", "tenant_ip": "192.168.130.2/24"}, "rc": 0, "start": "2019-11-17 10:22:41.422223", "stderr": "Device \"t2if\" does not exist.", "stderr_lines": ["Device \"t2if\" does not exist."], "stdout": "", "stdout_lines": []}

TASK [Attach Tenant VETH Pairs] *****************************************************************************************************************************
changed: [localhost] => (item={u'default_route_ip': u'192.168.2.1', u'name': u't2', u'pns_ip': u'192.168.2.1/24', u'tenant_if': u't2if', u'tenant_ip': u'192.168.2.2/24', u'pns_if': u't2pns_if'}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t2\" ip route show default | grep -w '[d]efault via 192.168.2.1' ; if [ $? -ne 0 ] ; then ip netns exec \"t2\" ip route add default via \"192.168.2.1\" ; fi\n", "delta": "0:00:00.082942", "end": "2019-11-17 10:22:41.775771", "item": {"default_route_ip": "192.168.2.1", "name": "t2", "pns_if": "t2pns_if", "pns_ip": "192.168.2.1/24", "tenant_if": "t2if", "tenant_ip": "192.168.2.2/24"}, "rc": 0, "start": "2019-11-17 10:22:41.692829", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Add IP Route to Tenant Subnet] ************************************************************************************************************************
changed: [99.99.99.2] => (item={u'default_route_ip': u'192.168.130.1', u'name': u't2', u'pns_ip': u'192.168.130.1/24', u'tenant_if': u't2if', u'tenant_ip': u'192.168.130.2/24', u'pns_if': u't2pns_if'}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec pns ip link show \"t2pns_if\" ; if [ $? -ne 0 ] ; then ip link set \"t2pns_if\" netns pns ; fi\nip netns exec \"t2\" ip link show \"t2if\" ; if [ $? -ne 0 ] ; then ip link set \"t2if\" netns \"t2\" ; fi\nip netns exec pns ip link set dev \"t2pns_if\" up\nip netns exec \"t2\" ip link set dev \"t2if\" up\n", "delta": "0:00:00.187812", "end": "2019-11-17 10:22:41.988554", "item": {"default_route_ip": "192.168.130.1", "name": "t2", "pns_if": "t2pns_if", "pns_ip": "192.168.130.1/24", "tenant_if": "t2if", "tenant_ip": "192.168.130.2/24"}, "rc": 0, "start": "2019-11-17 10:22:41.800742", "stderr": "Device \"t2pns_if\" does not exist.\nDevice \"t2if\" does not exist.", "stderr_lines": ["Device \"t2pns_if\" does not exist.", "Device \"t2if\" does not exist."], "stdout": "", "stdout_lines": []}

TASK [Add IP addresses to Tenant VETH Pairs] ****************************************************************************************************************
changed: [localhost] => (item={u'route': [{u'ip': u'10.1.11.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.1.11.1', u'bridge_name': u't2br1', u'dns': [{u'dnsif': u't2s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't2s1_dnsbrif'}], u'ns_name': u't2ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.11.2/24', u'tenant_ns_ip': u'10.1.11.1/24', u'tenant_ns_if': u't2ns1if', u'tenant_ns_name': u't2', u'tenant_sub_if': u't2s1if'}], u'bridge_ip': u'1.1.1.1', u'vms': [{u'mem': 2, u'name': u't2_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't2br1if1', u'vmif': u't2VM1if1'}, {u'mem': 4, u'name': u't2_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't2br1if2', u'vmif': u't2VM2if1'}], u'vxlan': [{u'local_ip': u'10.1.11.2', u'tenant_route_ip': u'192.168.2.2', u'dsport': 4789, u'dev': u't2s1if', u'subnet_route': u'10.1.11.0/24', u'remote_route': u'10.2.11.0/24', u'v_name': u'vxlan_t2s1', u'id': 42, u'remote_ip': u'10.2.11.2'}]}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t2ns1\" ip route show default | grep -w '[d]efault via 10.1.11.1' ; if [ $? -ne 0 ] ; then ip netns exec \"t2ns1\" ip route add default via \"10.1.11.1\" ; fi\n", "delta": "0:00:00.072761", "end": "2019-11-17 10:22:42.135727", "item": {"bridge_ip": "1.1.1.1", "bridge_name": "t2br1", "default_route_ip": "10.1.11.1", "dns": [{"brif": "t2s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t2s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns1", "route": [{"if": "p1", "ip": "10.1.11.1/24", "ns_if": "t2if", "ns_name": "t2"}], "tenant_ns": [{"tenant_ns_if": "t2ns1if", "tenant_ns_ip": "10.1.11.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s1if", "tenant_sub_ip": "10.1.11.2/24"}], "vms": [{"brif": "t2br1if1", "disk": "10G", "mem": 2, "name": "t2_VM1", "vcpu": 4, "vmif": "t2VM1if1"}, {"brif": "t2br1if2", "disk": "10G", "mem": 4, "name": "t2_VM2", "vcpu": 2, "vmif": "t2VM2if1"}], "vxlan": [{"dev": "t2s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.11.2", "remote_ip": "10.2.11.2", "remote_route": "10.2.11.0/24", "subnet_route": "10.1.11.0/24", "tenant_route_ip": "192.168.2.2", "v_name": "vxlan_t2s1"}]}, "rc": 0, "start": "2019-11-17 10:22:42.062966", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}
changed: [localhost] => (item={u'route': [{u'ip': u'10.1.12.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.1.12.1', u'bridge_name': u't2br2', u'dns': [{u'dnsif': u't2s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't2s2_dnsbrif'}], u'ns_name': u't2ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.12.2/24', u'tenant_ns_ip': u'10.1.12.1/24', u'tenant_ns_if': u't2ns2if', u'tenant_ns_name': u't2', u'tenant_sub_if': u't2s2if'}], u'bridge_ip': u'2.2.2.1', u'vms': [{u'mem': 3, u'name': u't2_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't2br2if1', u'vmif': u't2VM3if1'}], u'vxlan': [{u'local_ip': [], u'tenant_route_ip': [], u'dsport': [], u'dev': [], u'subnet_route': [], u'remote_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t2ns2\" ip route show default | grep -w '[d]efault via 10.1.12.1' ; if [ $? -ne 0 ] ; then ip netns exec \"t2ns2\" ip route add default via \"10.1.12.1\" ; fi\n", "delta": "0:00:00.064443", "end": "2019-11-17 10:22:42.415711", "item": {"bridge_ip": "2.2.2.1", "bridge_name": "t2br2", "default_route_ip": "10.1.12.1", "dns": [{"brif": "t2s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t2s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns2", "route": [{"if": "p1", "ip": "10.1.12.1/24", "ns_if": "t2if", "ns_name": "t2"}], "tenant_ns": [{"tenant_ns_if": "t2ns2if", "tenant_ns_ip": "10.1.12.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s2if", "tenant_sub_ip": "10.1.12.2/24"}], "vms": [{"brif": "t2br2if1", "disk": "10G", "mem": 3, "name": "t2_VM3", "vcpu": 2, "vmif": "t2VM3if1"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, "rc": 0, "start": "2019-11-17 10:22:42.351268", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Create bridge inside namespace] ***********************************************************************************************************************
changed: [99.99.99.2] => (item={u'default_route_ip': u'192.168.130.1', u'name': u't2', u'pns_ip': u'192.168.130.1/24', u'tenant_if': u't2if', u'tenant_ip': u'192.168.130.2/24', u'pns_if': u't2pns_if'}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec pns ip addr show \"t2pns_if\" | awk 'FNR==3{ print $2 }' | grep -w '^192.168.130.1/24' ; if [ $? -ne 0 ] ; then ip netns exec pns ip addr add \"192.168.130.1/24\" dev \"t2pns_if\" ; fi\nip netns exec \"t2\" ip addr show \"t2if\" | awk 'FNR==3{ print $2 }' | grep -w '^192.168.130.2/24' ; if [ $? -ne 0 ] ; then ip netns exec \"t2\" ip addr add \"192.168.130.2/24\" dev \"t2if\" ; fi\n", "delta": "0:00:00.155949", "end": "2019-11-17 10:22:42.516383", "item": {"default_route_ip": "192.168.130.1", "name": "t2", "pns_if": "t2pns_if", "pns_ip": "192.168.130.1/24", "tenant_if": "t2if", "tenant_ip": "192.168.130.2/24"}, "rc": 0, "start": "2019-11-17 10:22:42.360434", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Create Namespace VETH Pairs] **************************************************************************************************************************
changed: [localhost] => (item={u'route': [{u'ip': u'10.1.11.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.1.11.1', u'bridge_name': u't2br1', u'dns': [{u'dnsif': u't2s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't2s1_dnsbrif'}], u'ns_name': u't2ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.11.2/24', u'tenant_ns_ip': u'10.1.11.1/24', u'tenant_ns_if': u't2ns1if', u'tenant_ns_name': u't2', u'tenant_sub_if': u't2s1if'}], u'bridge_ip': u'1.1.1.1', u'vms': [{u'mem': 2, u'name': u't2_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't2br1if1', u'vmif': u't2VM1if1'}, {u'mem': 4, u'name': u't2_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't2br1if2', u'vmif': u't2VM2if1'}], u'vxlan': [{u'local_ip': u'10.1.11.2', u'tenant_route_ip': u'192.168.2.2', u'dsport': 4789, u'dev': u't2s1if', u'subnet_route': u'10.1.11.0/24', u'remote_route': u'10.2.11.0/24', u'v_name': u'vxlan_t2s1', u'id': 42, u'remote_ip': u'10.2.11.2'}]}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t2ns1\" brctl show | grep -w '^t2br1'; if [ $? -ne 0 ] ; then ip netns exec \"t2ns1\" brctl addbr \"t2br1\" ; fi\nip netns exec \"t2ns1\" ip link set dev \"t2br1\" up\n", "delta": "0:00:00.118882", "end": "2019-11-17 10:22:42.819715", "item": {"bridge_ip": "1.1.1.1", "bridge_name": "t2br1", "default_route_ip": "10.1.11.1", "dns": [{"brif": "t2s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t2s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns1", "route": [{"if": "p1", "ip": "10.1.11.1/24", "ns_if": "t2if", "ns_name": "t2"}], "tenant_ns": [{"tenant_ns_if": "t2ns1if", "tenant_ns_ip": "10.1.11.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s1if", "tenant_sub_ip": "10.1.11.2/24"}], "vms": [{"brif": "t2br1if1", "disk": "10G", "mem": 2, "name": "t2_VM1", "vcpu": 4, "vmif": "t2VM1if1"}, {"brif": "t2br1if2", "disk": "10G", "mem": 4, "name": "t2_VM2", "vcpu": 2, "vmif": "t2VM2if1"}], "vxlan": [{"dev": "t2s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.11.2", "remote_ip": "10.2.11.2", "remote_route": "10.2.11.0/24", "subnet_route": "10.1.11.0/24", "tenant_route_ip": "192.168.2.2", "v_name": "vxlan_t2s1"}]}, "rc": 0, "start": "2019-11-17 10:22:42.700833", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.11.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.2.11.1', u'bridge_name': u't2br1', u'dns': [{u'dnsif': u't2s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't2s1_dnsbrif'}], u'ns_name': u't2ns1', u'bridge_ip': u'1.1.1.1', u'vms': [{u'mem': 2, u'name': u't2_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't2br1if1', u'vmif': u't2VM4if1'}], u'vxlan': [{u'local_ip': u'10.2.11.2', u'dsport': 4789, u'dev': u't2s1if', u'tenant_route_ip': u'192.168.130.2', u'remote_route': u'10.1.11.0/24', u'subnet_route': u'10.2.11.0/24', u'v_name': u'vxlan_t2s1', u'id': 42, u'remote_ip': u'10.1.11.2'}]}, {u'tenant_sub_ip': u'10.2.11.2/24', u'tenant_ns_ip': u'10.2.11.1/24', u'tenant_ns_if': u't2ns1if', u'tenant_sub_if': u't2s1if', u'tenant_ns_name': u't2'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip link show \"t2ns1if\" ; if [ $? -ne 0 ] ; then ip link add \"t2ns1if\" type veth peer name \"t2s1if\" ; fi\n", "delta": "0:00:00.010809", "end": "2019-11-17 10:22:42.908110", "item": [{"bridge_ip": "1.1.1.1", "bridge_name": "t2br1", "default_route_ip": "10.2.11.1", "dns": [{"brif": "t2s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t2s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns1", "route": [{"if": "p1", "ip": "10.2.11.1/24", "ns_if": "t2if", "ns_name": "t2"}], "vms": [{"brif": "t2br1if1", "disk": "10G", "mem": 2, "name": "t2_VM4", "vcpu": 4, "vmif": "t2VM4if1"}], "vxlan": [{"dev": "t2s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.11.2", "remote_ip": "10.1.11.2", "remote_route": "10.1.11.0/24", "subnet_route": "10.2.11.0/24", "tenant_route_ip": "192.168.130.2", "v_name": "vxlan_t2s1"}]}, {"tenant_ns_if": "t2ns1if", "tenant_ns_ip": "10.2.11.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s1if", "tenant_sub_ip": "10.2.11.2/24"}], "rc": 0, "start": "2019-11-17 10:22:42.897301", "stderr": "Device \"t2ns1if\" does not exist.", "stderr_lines": ["Device \"t2ns1if\" does not exist."], "stdout": "", "stdout_lines": []}

TASK [Attach Namespace VETH Pairs] **************************************************************************************************************************
changed: [localhost] => (item={u'route': [{u'ip': u'10.1.12.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.1.12.1', u'bridge_name': u't2br2', u'dns': [{u'dnsif': u't2s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't2s2_dnsbrif'}], u'ns_name': u't2ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.12.2/24', u'tenant_ns_ip': u'10.1.12.1/24', u'tenant_ns_if': u't2ns2if', u'tenant_ns_name': u't2', u'tenant_sub_if': u't2s2if'}], u'bridge_ip': u'2.2.2.1', u'vms': [{u'mem': 3, u'name': u't2_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't2br2if1', u'vmif': u't2VM3if1'}], u'vxlan': [{u'local_ip': [], u'tenant_route_ip': [], u'dsport': [], u'dev': [], u'subnet_route': [], u'remote_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t2ns2\" brctl show | grep -w '^t2br2'; if [ $? -ne 0 ] ; then ip netns exec \"t2ns2\" brctl addbr \"t2br2\" ; fi\nip netns exec \"t2ns2\" ip link set dev \"t2br2\" up\n", "delta": "0:00:00.128197", "end": "2019-11-17 10:22:43.143518", "item": {"bridge_ip": "2.2.2.1", "bridge_name": "t2br2", "default_route_ip": "10.1.12.1", "dns": [{"brif": "t2s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t2s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns2", "route": [{"if": "p1", "ip": "10.1.12.1/24", "ns_if": "t2if", "ns_name": "t2"}], "tenant_ns": [{"tenant_ns_if": "t2ns2if", "tenant_ns_ip": "10.1.12.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s2if", "tenant_sub_ip": "10.1.12.2/24"}], "vms": [{"brif": "t2br2if1", "disk": "10G", "mem": 3, "name": "t2_VM3", "vcpu": 2, "vmif": "t2VM3if1"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, "rc": 0, "start": "2019-11-17 10:22:43.015321", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Create DNS VETH Pair] *********************************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.11.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.2.11.1', u'bridge_name': u't2br1', u'dns': [{u'dnsif': u't2s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't2s1_dnsbrif'}], u'ns_name': u't2ns1', u'bridge_ip': u'1.1.1.1', u'vms': [{u'mem': 2, u'name': u't2_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't2br1if1', u'vmif': u't2VM4if1'}], u'vxlan': [{u'local_ip': u'10.2.11.2', u'dsport': 4789, u'dev': u't2s1if', u'tenant_route_ip': u'192.168.130.2', u'remote_route': u'10.1.11.0/24', u'subnet_route': u'10.2.11.0/24', u'v_name': u'vxlan_t2s1', u'id': 42, u'remote_ip': u'10.1.11.2'}]}, {u'tenant_sub_ip': u'10.2.11.2/24', u'tenant_ns_ip': u'10.2.11.1/24', u'tenant_ns_if': u't2ns1if', u'tenant_sub_if': u't2s1if', u'tenant_ns_name': u't2'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t2\" ip link show \"t2ns1if\" ; if [ $? -ne 0 ] ; then ip link set \"t2ns1if\" netns \"t2\" ; fi\nip netns exec \"t2ns1\" ip link show \"t2s1if\" ; if [ $? -ne 0 ] ; then ip link set \"t2s1if\" netns \"t2ns1\" ; fi\n", "delta": "0:00:00.134333", "end": "2019-11-17 10:22:43.407895", "item": [{"bridge_ip": "1.1.1.1", "bridge_name": "t2br1", "default_route_ip": "10.2.11.1", "dns": [{"brif": "t2s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t2s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns1", "route": [{"if": "p1", "ip": "10.2.11.1/24", "ns_if": "t2if", "ns_name": "t2"}], "vms": [{"brif": "t2br1if1", "disk": "10G", "mem": 2, "name": "t2_VM4", "vcpu": 4, "vmif": "t2VM4if1"}], "vxlan": [{"dev": "t2s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.11.2", "remote_ip": "10.1.11.2", "remote_route": "10.1.11.0/24", "subnet_route": "10.2.11.0/24", "tenant_route_ip": "192.168.130.2", "v_name": "vxlan_t2s1"}]}, {"tenant_ns_if": "t2ns1if", "tenant_ns_ip": "10.2.11.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s1if", "tenant_sub_ip": "10.2.11.2/24"}], "rc": 0, "start": "2019-11-17 10:22:43.273562", "stderr": "Device \"t2ns1if\" does not exist.\nDevice \"t2s1if\" does not exist.", "stderr_lines": ["Device \"t2ns1if\" does not exist.", "Device \"t2s1if\" does not exist."], "stdout": "", "stdout_lines": []}

TASK [Set Namespace VETH Pairs UP] **************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.11.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.1.11.1', u'bridge_name': u't2br1', u'ns_name': u't2ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.11.2/24', u'tenant_ns_ip': u'10.1.11.1/24', u'tenant_ns_if': u't2ns1if', u'tenant_sub_if': u't2s1if', u'tenant_ns_name': u't2'}], u'bridge_ip': u'1.1.1.1', u'vms': [{u'mem': 2, u'name': u't2_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't2br1if1', u'vmif': u't2VM1if1'}, {u'mem': 4, u'name': u't2_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't2br1if2', u'vmif': u't2VM2if1'}], u'vxlan': [{u'local_ip': u'10.1.11.2', u'dsport': 4789, u'dev': u't2s1if', u'tenant_route_ip': u'192.168.2.2', u'remote_route': u'10.2.11.0/24', u'subnet_route': u'10.1.11.0/24', u'v_name': u'vxlan_t2s1', u'id': 42, u'remote_ip': u'10.2.11.2'}]}, {u'dnsif': u't2s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't2s1_dnsbrif'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t2ns1\" ip link show \"t2s1_dnsbrif\" ; if [ $? -ne 0 ] ; then ip netns exec \"t2ns1\" ip link add \"t2s1_dnsbrif\" type veth peer name \"t2s1_dnsif\" ; fi\nip netns exec \"t2ns1\" ip link set dev \"t2s1_dnsbrif\" up\nip netns exec \"t2ns1\" ip link set dev \"t2s1_dnsif\" up\n", "delta": "0:00:00.169148", "end": "2019-11-17 10:22:43.583456", "item": [{"bridge_ip": "1.1.1.1", "bridge_name": "t2br1", "default_route_ip": "10.1.11.1", "ns_name": "t2ns1", "route": [{"if": "p1", "ip": "10.1.11.1/24", "ns_if": "t2if", "ns_name": "t2"}], "tenant_ns": [{"tenant_ns_if": "t2ns1if", "tenant_ns_ip": "10.1.11.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s1if", "tenant_sub_ip": "10.1.11.2/24"}], "vms": [{"brif": "t2br1if1", "disk": "10G", "mem": 2, "name": "t2_VM1", "vcpu": 4, "vmif": "t2VM1if1"}, {"brif": "t2br1if2", "disk": "10G", "mem": 4, "name": "t2_VM2", "vcpu": 2, "vmif": "t2VM2if1"}], "vxlan": [{"dev": "t2s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.11.2", "remote_ip": "10.2.11.2", "remote_route": "10.2.11.0/24", "subnet_route": "10.1.11.0/24", "tenant_route_ip": "192.168.2.2", "v_name": "vxlan_t2s1"}]}, {"brif": "t2s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t2s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "rc": 0, "start": "2019-11-17 10:22:43.414308", "stderr": "Device \"t2s1_dnsbrif\" does not exist.", "stderr_lines": ["Device \"t2s1_dnsbrif\" does not exist."], "stdout": "", "stdout_lines": []}
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.11.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.2.11.1', u'bridge_name': u't2br1', u'dns': [{u'dnsif': u't2s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't2s1_dnsbrif'}], u'ns_name': u't2ns1', u'bridge_ip': u'1.1.1.1', u'vms': [{u'mem': 2, u'name': u't2_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't2br1if1', u'vmif': u't2VM4if1'}], u'vxlan': [{u'local_ip': u'10.2.11.2', u'dsport': 4789, u'dev': u't2s1if', u'tenant_route_ip': u'192.168.130.2', u'remote_route': u'10.1.11.0/24', u'subnet_route': u'10.2.11.0/24', u'v_name': u'vxlan_t2s1', u'id': 42, u'remote_ip': u'10.1.11.2'}]}, {u'tenant_sub_ip': u'10.2.11.2/24', u'tenant_ns_ip': u'10.2.11.1/24', u'tenant_ns_if': u't2ns1if', u'tenant_sub_if': u't2s1if', u'tenant_ns_name': u't2'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t2\" ip link set dev \"t2ns1if\" up\nip netns exec \"t2ns1\" ip link set dev \"t2s1if\" up\n", "delta": "0:00:00.086966", "end": "2019-11-17 10:22:43.896385", "item": [{"bridge_ip": "1.1.1.1", "bridge_name": "t2br1", "default_route_ip": "10.2.11.1", "dns": [{"brif": "t2s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t2s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns1", "route": [{"if": "p1", "ip": "10.2.11.1/24", "ns_if": "t2if", "ns_name": "t2"}], "vms": [{"brif": "t2br1if1", "disk": "10G", "mem": 2, "name": "t2_VM4", "vcpu": 4, "vmif": "t2VM4if1"}], "vxlan": [{"dev": "t2s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.11.2", "remote_ip": "10.1.11.2", "remote_route": "10.1.11.0/24", "subnet_route": "10.2.11.0/24", "tenant_route_ip": "192.168.130.2", "v_name": "vxlan_t2s1"}]}, {"tenant_ns_if": "t2ns1if", "tenant_ns_ip": "10.2.11.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s1if", "tenant_sub_ip": "10.2.11.2/24"}], "rc": 0, "start": "2019-11-17 10:22:43.809419", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Add IP addresses to Namespace VETH Pairs] *************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.12.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.1.12.1', u'bridge_name': u't2br2', u'ns_name': u't2ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.12.2/24', u'tenant_ns_ip': u'10.1.12.1/24', u'tenant_ns_if': u't2ns2if', u'tenant_sub_if': u't2s2if', u'tenant_ns_name': u't2'}], u'bridge_ip': u'2.2.2.1', u'vms': [{u'mem': 3, u'name': u't2_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't2br2if1', u'vmif': u't2VM3if1'}], u'vxlan': [{u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}, {u'dnsif': u't2s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't2s2_dnsbrif'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t2ns2\" ip link show \"t2s2_dnsbrif\" ; if [ $? -ne 0 ] ; then ip netns exec \"t2ns2\" ip link add \"t2s2_dnsbrif\" type veth peer name \"t2s2_dnsif\" ; fi\nip netns exec \"t2ns2\" ip link set dev \"t2s2_dnsbrif\" up\nip netns exec \"t2ns2\" ip link set dev \"t2s2_dnsif\" up\n", "delta": "0:00:00.169547", "end": "2019-11-17 10:22:43.947666", "item": [{"bridge_ip": "2.2.2.1", "bridge_name": "t2br2", "default_route_ip": "10.1.12.1", "ns_name": "t2ns2", "route": [{"if": "p1", "ip": "10.1.12.1/24", "ns_if": "t2if", "ns_name": "t2"}], "tenant_ns": [{"tenant_ns_if": "t2ns2if", "tenant_ns_ip": "10.1.12.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s2if", "tenant_sub_ip": "10.1.12.2/24"}], "vms": [{"brif": "t2br2if1", "disk": "10G", "mem": 3, "name": "t2_VM3", "vcpu": 2, "vmif": "t2VM3if1"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, {"brif": "t2s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t2s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "rc": 0, "start": "2019-11-17 10:22:43.778119", "stderr": "Device \"t2s2_dnsbrif\" does not exist.", "stderr_lines": ["Device \"t2s2_dnsbrif\" does not exist."], "stdout": "", "stdout_lines": []}

TASK [Attach DNS VETH Pair] *********************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.11.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.1.11.1', u'bridge_name': u't2br1', u'ns_name': u't2ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.11.2/24', u'tenant_ns_ip': u'10.1.11.1/24', u'tenant_ns_if': u't2ns1if', u'tenant_sub_if': u't2s1if', u'tenant_ns_name': u't2'}], u'bridge_ip': u'1.1.1.1', u'vms': [{u'mem': 2, u'name': u't2_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't2br1if1', u'vmif': u't2VM1if1'}, {u'mem': 4, u'name': u't2_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't2br1if2', u'vmif': u't2VM2if1'}], u'vxlan': [{u'local_ip': u'10.1.11.2', u'dsport': 4789, u'dev': u't2s1if', u'tenant_route_ip': u'192.168.2.2', u'remote_route': u'10.2.11.0/24', u'subnet_route': u'10.1.11.0/24', u'v_name': u'vxlan_t2s1', u'id': 42, u'remote_ip': u'10.2.11.2'}]}, {u'dnsif': u't2s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't2s1_dnsbrif'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t2ns1\" brctl show \"t2br1\" | grep -w 't2s1_dnsbrif' ; if [ $? -ne 0 ] ; then ip netns exec \"t2ns1\" brctl addif \"t2br1\" \"t2s1_dnsbrif\" ; fi\n", "delta": "0:00:00.083047", "end": "2019-11-17 10:22:44.323763", "item": [{"bridge_ip": "1.1.1.1", "bridge_name": "t2br1", "default_route_ip": "10.1.11.1", "ns_name": "t2ns1", "route": [{"if": "p1", "ip": "10.1.11.1/24", "ns_if": "t2if", "ns_name": "t2"}], "tenant_ns": [{"tenant_ns_if": "t2ns1if", "tenant_ns_ip": "10.1.11.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s1if", "tenant_sub_ip": "10.1.11.2/24"}], "vms": [{"brif": "t2br1if1", "disk": "10G", "mem": 2, "name": "t2_VM1", "vcpu": 4, "vmif": "t2VM1if1"}, {"brif": "t2br1if2", "disk": "10G", "mem": 4, "name": "t2_VM2", "vcpu": 2, "vmif": "t2VM2if1"}], "vxlan": [{"dev": "t2s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.11.2", "remote_ip": "10.2.11.2", "remote_route": "10.2.11.0/24", "subnet_route": "10.1.11.0/24", "tenant_route_ip": "192.168.2.2", "v_name": "vxlan_t2s1"}]}, {"brif": "t2s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t2s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "rc": 0, "start": "2019-11-17 10:22:44.240716", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.11.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.2.11.1', u'bridge_name': u't2br1', u'dns': [{u'dnsif': u't2s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't2s1_dnsbrif'}], u'ns_name': u't2ns1', u'bridge_ip': u'1.1.1.1', u'vms': [{u'mem': 2, u'name': u't2_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't2br1if1', u'vmif': u't2VM4if1'}], u'vxlan': [{u'local_ip': u'10.2.11.2', u'dsport': 4789, u'dev': u't2s1if', u'tenant_route_ip': u'192.168.130.2', u'remote_route': u'10.1.11.0/24', u'subnet_route': u'10.2.11.0/24', u'v_name': u'vxlan_t2s1', u'id': 42, u'remote_ip': u'10.1.11.2'}]}, {u'tenant_sub_ip': u'10.2.11.2/24', u'tenant_ns_ip': u'10.2.11.1/24', u'tenant_ns_if': u't2ns1if', u'tenant_sub_if': u't2s1if', u'tenant_ns_name': u't2'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t2ns1\" ip addr show \"t2s1if\" | awk 'FNR==3{ print $2 }' | grep -w '^10.2.11.2/24' ; if [ $? -ne 0 ] ; then ip netns exec \"t2ns1\" ip addr add \"10.2.11.2/24\" dev \"t2s1if\" ; fi\n\nip netns exec \"t2\" ip addr show \"t2ns1if\" | awk 'FNR==3{ print $2 }' | grep -w '^10.2.11.1/24' ; if [ $? -ne 0 ] ; then ip netns exec \"t2\" ip addr add \"10.2.11.1/24\" dev \"t2ns1if\" ; fi\n", "delta": "0:00:00.151466", "end": "2019-11-17 10:22:44.424551", "item": [{"bridge_ip": "1.1.1.1", "bridge_name": "t2br1", "default_route_ip": "10.2.11.1", "dns": [{"brif": "t2s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t2s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns1", "route": [{"if": "p1", "ip": "10.2.11.1/24", "ns_if": "t2if", "ns_name": "t2"}], "vms": [{"brif": "t2br1if1", "disk": "10G", "mem": 2, "name": "t2_VM4", "vcpu": 4, "vmif": "t2VM4if1"}], "vxlan": [{"dev": "t2s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.11.2", "remote_ip": "10.1.11.2", "remote_route": "10.1.11.0/24", "subnet_route": "10.2.11.0/24", "tenant_route_ip": "192.168.130.2", "v_name": "vxlan_t2s1"}]}, {"tenant_ns_if": "t2ns1if", "tenant_ns_ip": "10.2.11.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s1if", "tenant_sub_ip": "10.2.11.2/24"}], "rc": 0, "start": "2019-11-17 10:22:44.273085", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Add IP Route to Tenant] *******************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.12.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.1.12.1', u'bridge_name': u't2br2', u'ns_name': u't2ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.12.2/24', u'tenant_ns_ip': u'10.1.12.1/24', u'tenant_ns_if': u't2ns2if', u'tenant_sub_if': u't2s2if', u'tenant_ns_name': u't2'}], u'bridge_ip': u'2.2.2.1', u'vms': [{u'mem': 3, u'name': u't2_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't2br2if1', u'vmif': u't2VM3if1'}], u'vxlan': [{u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}, {u'dnsif': u't2s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't2s2_dnsbrif'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t2ns2\" brctl show \"t2br2\" | grep -w 't2s2_dnsbrif' ; if [ $? -ne 0 ] ; then ip netns exec \"t2ns2\" brctl addif \"t2br2\" \"t2s2_dnsbrif\" ; fi\n", "delta": "0:00:00.087681", "end": "2019-11-17 10:22:44.623541", "item": [{"bridge_ip": "2.2.2.1", "bridge_name": "t2br2", "default_route_ip": "10.1.12.1", "ns_name": "t2ns2", "route": [{"if": "p1", "ip": "10.1.12.1/24", "ns_if": "t2if", "ns_name": "t2"}], "tenant_ns": [{"tenant_ns_if": "t2ns2if", "tenant_ns_ip": "10.1.12.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s2if", "tenant_sub_ip": "10.1.12.2/24"}], "vms": [{"brif": "t2br2if1", "disk": "10G", "mem": 3, "name": "t2_VM3", "vcpu": 2, "vmif": "t2VM3if1"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, {"brif": "t2s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t2s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "rc": 0, "start": "2019-11-17 10:22:44.535860", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Create VETH Pairs] ************************************************************************************************************************************
changed: [99.99.99.2] => (item={u'default_route_ip': u'192.168.130.1', u'name': u't2', u'pns_ip': u'192.168.130.1/24', u'tenant_if': u't2if', u'tenant_ip': u'192.168.130.2/24', u'pns_if': u't2pns_if'}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t2\" ip route show default | grep -w '[d]efault via 192.168.130.1' ; if [ $? -ne 0 ] ; then ip netns exec \"t2\" ip route add default via \"192.168.130.1\" ; fi\n", "delta": "0:00:00.084446", "end": "2019-11-17 10:22:44.892408", "item": {"default_route_ip": "192.168.130.1", "name": "t2", "pns_if": "t2pns_if", "pns_ip": "192.168.130.1/24", "tenant_if": "t2if", "tenant_ip": "192.168.130.2/24"}, "rc": 0, "start": "2019-11-17 10:22:44.807962", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Add IP Route to Tenant Subnet] ************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.11.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.1.11.1', u'bridge_name': u't2br1', u'dns': [{u'dnsif': u't2s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't2s1_dnsbrif'}], u'ns_name': u't2ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.11.2/24', u'tenant_ns_ip': u'10.1.11.1/24', u'tenant_ns_if': u't2ns1if', u'tenant_sub_if': u't2s1if', u'tenant_ns_name': u't2'}], u'bridge_ip': u'1.1.1.1', u'vxlan': [{u'local_ip': u'10.1.11.2', u'dsport': 4789, u'dev': u't2s1if', u'tenant_route_ip': u'192.168.2.2', u'remote_route': u'10.2.11.0/24', u'subnet_route': u'10.1.11.0/24', u'v_name': u'vxlan_t2s1', u'id': 42, u'remote_ip': u'10.2.11.2'}]}, {u'mem': 2, u'name': u't2_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't2br1if1', u'vmif': u't2VM1if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip link show \"t2br1if1\" ; if [ $? -ne 0 ] ; then ip link add \"t2VM1if1\" type veth peer name \"t2br1if1\" ; fi\nip link set dev \"t2br1if1\" up\nip link set dev \"t2VM1if1\" up\n", "delta": "0:00:00.020360", "end": "2019-11-17 10:22:44.934980", "item": [{"bridge_ip": "1.1.1.1", "bridge_name": "t2br1", "default_route_ip": "10.1.11.1", "dns": [{"brif": "t2s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t2s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns1", "route": [{"if": "p1", "ip": "10.1.11.1/24", "ns_if": "t2if", "ns_name": "t2"}], "tenant_ns": [{"tenant_ns_if": "t2ns1if", "tenant_ns_ip": "10.1.11.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s1if", "tenant_sub_ip": "10.1.11.2/24"}], "vxlan": [{"dev": "t2s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.11.2", "remote_ip": "10.2.11.2", "remote_route": "10.2.11.0/24", "subnet_route": "10.1.11.0/24", "tenant_route_ip": "192.168.2.2", "v_name": "vxlan_t2s1"}]}, {"brif": "t2br1if1", "disk": "10G", "mem": 2, "name": "t2_VM1", "vcpu": 4, "vmif": "t2VM1if1"}], "rc": 0, "start": "2019-11-17 10:22:44.914620", "stderr": "Device \"t2br1if1\" does not exist.", "stderr_lines": ["Device \"t2br1if1\" does not exist."], "stdout": "", "stdout_lines": []}
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.11.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.1.11.1', u'bridge_name': u't2br1', u'dns': [{u'dnsif': u't2s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't2s1_dnsbrif'}], u'ns_name': u't2ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.11.2/24', u'tenant_ns_ip': u'10.1.11.1/24', u'tenant_ns_if': u't2ns1if', u'tenant_sub_if': u't2s1if', u'tenant_ns_name': u't2'}], u'bridge_ip': u'1.1.1.1', u'vxlan': [{u'local_ip': u'10.1.11.2', u'dsport': 4789, u'dev': u't2s1if', u'tenant_route_ip': u'192.168.2.2', u'remote_route': u'10.2.11.0/24', u'subnet_route': u'10.1.11.0/24', u'v_name': u'vxlan_t2s1', u'id': 42, u'remote_ip': u'10.2.11.2'}]}, {u'mem': 4, u'name': u't2_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't2br1if2', u'vmif': u't2VM2if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip link show \"t2br1if2\" ; if [ $? -ne 0 ] ; then ip link add \"t2VM2if1\" type veth peer name \"t2br1if2\" ; fi\nip link set dev \"t2br1if2\" up\nip link set dev \"t2VM2if1\" up\n", "delta": "0:00:00.018309", "end": "2019-11-17 10:22:45.180020", "item": [{"bridge_ip": "1.1.1.1", "bridge_name": "t2br1", "default_route_ip": "10.1.11.1", "dns": [{"brif": "t2s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t2s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns1", "route": [{"if": "p1", "ip": "10.1.11.1/24", "ns_if": "t2if", "ns_name": "t2"}], "tenant_ns": [{"tenant_ns_if": "t2ns1if", "tenant_ns_ip": "10.1.11.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s1if", "tenant_sub_ip": "10.1.11.2/24"}], "vxlan": [{"dev": "t2s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.11.2", "remote_ip": "10.2.11.2", "remote_route": "10.2.11.0/24", "subnet_route": "10.1.11.0/24", "tenant_route_ip": "192.168.2.2", "v_name": "vxlan_t2s1"}]}, {"brif": "t2br1if2", "disk": "10G", "mem": 4, "name": "t2_VM2", "vcpu": 2, "vmif": "t2VM2if1"}], "rc": 0, "start": "2019-11-17 10:22:45.161711", "stderr": "Device \"t2br1if2\" does not exist.", "stderr_lines": ["Device \"t2br1if2\" does not exist."], "stdout": "", "stdout_lines": []}
changed: [99.99.99.2] => (item={u'route': [{u'ip': u'10.2.11.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.2.11.1', u'bridge_name': u't2br1', u'dns': [{u'dnsif': u't2s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't2s1_dnsbrif'}], u'ns_name': u't2ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.11.2/24', u'tenant_ns_ip': u'10.2.11.1/24', u'tenant_ns_if': u't2ns1if', u'tenant_ns_name': u't2', u'tenant_sub_if': u't2s1if'}], u'bridge_ip': u'1.1.1.1', u'vms': [{u'mem': 2, u'name': u't2_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't2br1if1', u'vmif': u't2VM4if1'}], u'vxlan': [{u'local_ip': u'10.2.11.2', u'tenant_route_ip': u'192.168.130.2', u'dsport': 4789, u'dev': u't2s1if', u'subnet_route': u'10.2.11.0/24', u'remote_route': u'10.1.11.0/24', u'v_name': u'vxlan_t2s1', u'id': 42, u'remote_ip': u'10.1.11.2'}]}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t2ns1\" ip route show default | grep -w '[d]efault via 10.2.11.1' ; if [ $? -ne 0 ] ; then ip netns exec \"t2ns1\" ip route add default via \"10.2.11.1\" ; fi\n", "delta": "0:00:00.081783", "end": "2019-11-17 10:22:45.368554", "item": {"bridge_ip": "1.1.1.1", "bridge_name": "t2br1", "default_route_ip": "10.2.11.1", "dns": [{"brif": "t2s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t2s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns1", "route": [{"if": "p1", "ip": "10.2.11.1/24", "ns_if": "t2if", "ns_name": "t2"}], "tenant_ns": [{"tenant_ns_if": "t2ns1if", "tenant_ns_ip": "10.2.11.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s1if", "tenant_sub_ip": "10.2.11.2/24"}], "vms": [{"brif": "t2br1if1", "disk": "10G", "mem": 2, "name": "t2_VM4", "vcpu": 4, "vmif": "t2VM4if1"}], "vxlan": [{"dev": "t2s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.11.2", "remote_ip": "10.1.11.2", "remote_route": "10.1.11.0/24", "subnet_route": "10.2.11.0/24", "tenant_route_ip": "192.168.130.2", "v_name": "vxlan_t2s1"}]}, "rc": 0, "start": "2019-11-17 10:22:45.286771", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Create bridge inside namespace] ***********************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.12.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.1.12.1', u'bridge_name': u't2br2', u'dns': [{u'dnsif': u't2s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't2s2_dnsbrif'}], u'ns_name': u't2ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.12.2/24', u'tenant_ns_ip': u'10.1.12.1/24', u'tenant_ns_if': u't2ns2if', u'tenant_sub_if': u't2s2if', u'tenant_ns_name': u't2'}], u'bridge_ip': u'2.2.2.1', u'vxlan': [{u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}, {u'mem': 3, u'name': u't2_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't2br2if1', u'vmif': u't2VM3if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip link show \"t2br2if1\" ; if [ $? -ne 0 ] ; then ip link add \"t2VM3if1\" type veth peer name \"t2br2if1\" ; fi\nip link set dev \"t2br2if1\" up\nip link set dev \"t2VM3if1\" up\n", "delta": "0:00:00.015816", "end": "2019-11-17 10:22:45.408648", "item": [{"bridge_ip": "2.2.2.1", "bridge_name": "t2br2", "default_route_ip": "10.1.12.1", "dns": [{"brif": "t2s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t2s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns2", "route": [{"if": "p1", "ip": "10.1.12.1/24", "ns_if": "t2if", "ns_name": "t2"}], "tenant_ns": [{"tenant_ns_if": "t2ns2if", "tenant_ns_ip": "10.1.12.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s2if", "tenant_sub_ip": "10.1.12.2/24"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, {"brif": "t2br2if1", "disk": "10G", "mem": 3, "name": "t2_VM3", "vcpu": 2, "vmif": "t2VM3if1"}], "rc": 0, "start": "2019-11-17 10:22:45.392832", "stderr": "Device \"t2br2if1\" does not exist.", "stderr_lines": ["Device \"t2br2if1\" does not exist."], "stdout": "", "stdout_lines": []}

TASK [Attach VETH Pairs] ************************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.11.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.1.11.1', u'bridge_name': u't2br1', u'dns': [{u'dnsif': u't2s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't2s1_dnsbrif'}], u'ns_name': u't2ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.11.2/24', u'tenant_ns_ip': u'10.1.11.1/24', u'tenant_ns_if': u't2ns1if', u'tenant_sub_if': u't2s1if', u'tenant_ns_name': u't2'}], u'bridge_ip': u'1.1.1.1', u'vxlan': [{u'local_ip': u'10.1.11.2', u'dsport': 4789, u'dev': u't2s1if', u'tenant_route_ip': u'192.168.2.2', u'remote_route': u'10.2.11.0/24', u'subnet_route': u'10.1.11.0/24', u'v_name': u'vxlan_t2s1', u'id': 42, u'remote_ip': u'10.2.11.2'}]}, {u'mem': 2, u'name': u't2_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't2br1if1', u'vmif': u't2VM1if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip link show \"t2br1if1\" ; if [ $? -eq 0 ] ; then ip link set \"t2br1if1\" netns \"t2ns1\" ; fi\nip netns exec \"t2ns1\" brctl show \"t2br1\" | grep -w 't2br1if1' ; if [ $? -ne 0 ] ; then ip netns exec \"t2ns1\" brctl addif \"t2br1\" \"t2br1if1\" ; fi\n", "delta": "0:00:00.107162", "end": "2019-11-17 10:22:45.799668", "item": [{"bridge_ip": "1.1.1.1", "bridge_name": "t2br1", "default_route_ip": "10.1.11.1", "dns": [{"brif": "t2s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t2s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns1", "route": [{"if": "p1", "ip": "10.1.11.1/24", "ns_if": "t2if", "ns_name": "t2"}], "tenant_ns": [{"tenant_ns_if": "t2ns1if", "tenant_ns_ip": "10.1.11.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s1if", "tenant_sub_ip": "10.1.11.2/24"}], "vxlan": [{"dev": "t2s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.11.2", "remote_ip": "10.2.11.2", "remote_route": "10.2.11.0/24", "subnet_route": "10.1.11.0/24", "tenant_route_ip": "192.168.2.2", "v_name": "vxlan_t2s1"}]}, {"brif": "t2br1if1", "disk": "10G", "mem": 2, "name": "t2_VM1", "vcpu": 4, "vmif": "t2VM1if1"}], "rc": 0, "start": "2019-11-17 10:22:45.692506", "stderr": "", "stderr_lines": [], "stdout": "63: t2br1if1@t2VM1if1: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP mode DEFAULT group default qlen 1000\n    link/ether fe:16:f7:5c:39:ea brd ff:ff:ff:ff:ff:ff", "stdout_lines": ["63: t2br1if1@t2VM1if1: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP mode DEFAULT group default qlen 1000", "    link/ether fe:16:f7:5c:39:ea brd ff:ff:ff:ff:ff:ff"]}
changed: [99.99.99.2] => (item={u'route': [{u'ip': u'10.2.11.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.2.11.1', u'bridge_name': u't2br1', u'dns': [{u'dnsif': u't2s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't2s1_dnsbrif'}], u'ns_name': u't2ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.11.2/24', u'tenant_ns_ip': u'10.2.11.1/24', u'tenant_ns_if': u't2ns1if', u'tenant_ns_name': u't2', u'tenant_sub_if': u't2s1if'}], u'bridge_ip': u'1.1.1.1', u'vms': [{u'mem': 2, u'name': u't2_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't2br1if1', u'vmif': u't2VM4if1'}], u'vxlan': [{u'local_ip': u'10.2.11.2', u'tenant_route_ip': u'192.168.130.2', u'dsport': 4789, u'dev': u't2s1if', u'subnet_route': u'10.2.11.0/24', u'remote_route': u'10.1.11.0/24', u'v_name': u'vxlan_t2s1', u'id': 42, u'remote_ip': u'10.1.11.2'}]}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t2ns1\" brctl show | grep -w '^t2br1'; if [ $? -ne 0 ] ; then ip netns exec \"t2ns1\" brctl addbr \"t2br1\" ; fi\nip netns exec \"t2ns1\" ip link set dev \"t2br1\" up\n", "delta": "0:00:00.131582", "end": "2019-11-17 10:22:45.888441", "item": {"bridge_ip": "1.1.1.1", "bridge_name": "t2br1", "default_route_ip": "10.2.11.1", "dns": [{"brif": "t2s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t2s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns1", "route": [{"if": "p1", "ip": "10.2.11.1/24", "ns_if": "t2if", "ns_name": "t2"}], "tenant_ns": [{"tenant_ns_if": "t2ns1if", "tenant_ns_ip": "10.2.11.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s1if", "tenant_sub_ip": "10.2.11.2/24"}], "vms": [{"brif": "t2br1if1", "disk": "10G", "mem": 2, "name": "t2_VM4", "vcpu": 4, "vmif": "t2VM4if1"}], "vxlan": [{"dev": "t2s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.11.2", "remote_ip": "10.1.11.2", "remote_route": "10.1.11.0/24", "subnet_route": "10.2.11.0/24", "tenant_route_ip": "192.168.130.2", "v_name": "vxlan_t2s1"}]}, "rc": 0, "start": "2019-11-17 10:22:45.756859", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Create DNS VETH Pair] *********************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.11.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.1.11.1', u'bridge_name': u't2br1', u'dns': [{u'dnsif': u't2s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't2s1_dnsbrif'}], u'ns_name': u't2ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.11.2/24', u'tenant_ns_ip': u'10.1.11.1/24', u'tenant_ns_if': u't2ns1if', u'tenant_sub_if': u't2s1if', u'tenant_ns_name': u't2'}], u'bridge_ip': u'1.1.1.1', u'vxlan': [{u'local_ip': u'10.1.11.2', u'dsport': 4789, u'dev': u't2s1if', u'tenant_route_ip': u'192.168.2.2', u'remote_route': u'10.2.11.0/24', u'subnet_route': u'10.1.11.0/24', u'v_name': u'vxlan_t2s1', u'id': 42, u'remote_ip': u'10.2.11.2'}]}, {u'mem': 4, u'name': u't2_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't2br1if2', u'vmif': u't2VM2if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip link show \"t2br1if2\" ; if [ $? -eq 0 ] ; then ip link set \"t2br1if2\" netns \"t2ns1\" ; fi\nip netns exec \"t2ns1\" brctl show \"t2br1\" | grep -w 't2br1if2' ; if [ $? -ne 0 ] ; then ip netns exec \"t2ns1\" brctl addif \"t2br1\" \"t2br1if2\" ; fi\n", "delta": "0:00:00.096264", "end": "2019-11-17 10:22:46.099549", "item": [{"bridge_ip": "1.1.1.1", "bridge_name": "t2br1", "default_route_ip": "10.1.11.1", "dns": [{"brif": "t2s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t2s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns1", "route": [{"if": "p1", "ip": "10.1.11.1/24", "ns_if": "t2if", "ns_name": "t2"}], "tenant_ns": [{"tenant_ns_if": "t2ns1if", "tenant_ns_ip": "10.1.11.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s1if", "tenant_sub_ip": "10.1.11.2/24"}], "vxlan": [{"dev": "t2s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.11.2", "remote_ip": "10.2.11.2", "remote_route": "10.2.11.0/24", "subnet_route": "10.1.11.0/24", "tenant_route_ip": "192.168.2.2", "v_name": "vxlan_t2s1"}]}, {"brif": "t2br1if2", "disk": "10G", "mem": 4, "name": "t2_VM2", "vcpu": 2, "vmif": "t2VM2if1"}], "rc": 0, "start": "2019-11-17 10:22:46.003285", "stderr": "", "stderr_lines": [], "stdout": "65: t2br1if2@t2VM2if1: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP mode DEFAULT group default qlen 1000\n    link/ether 26:a0:3c:c2:20:db brd ff:ff:ff:ff:ff:ff", "stdout_lines": ["65: t2br1if2@t2VM2if1: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP mode DEFAULT group default qlen 1000", "    link/ether 26:a0:3c:c2:20:db brd ff:ff:ff:ff:ff:ff"]}
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.12.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.1.12.1', u'bridge_name': u't2br2', u'dns': [{u'dnsif': u't2s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't2s2_dnsbrif'}], u'ns_name': u't2ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.12.2/24', u'tenant_ns_ip': u'10.1.12.1/24', u'tenant_ns_if': u't2ns2if', u'tenant_sub_if': u't2s2if', u'tenant_ns_name': u't2'}], u'bridge_ip': u'2.2.2.1', u'vxlan': [{u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}, {u'mem': 3, u'name': u't2_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't2br2if1', u'vmif': u't2VM3if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip link show \"t2br2if1\" ; if [ $? -eq 0 ] ; then ip link set \"t2br2if1\" netns \"t2ns2\" ; fi\nip netns exec \"t2ns2\" brctl show \"t2br2\" | grep -w 't2br2if1' ; if [ $? -ne 0 ] ; then ip netns exec \"t2ns2\" brctl addif \"t2br2\" \"t2br2if1\" ; fi\n", "delta": "0:00:00.111974", "end": "2019-11-17 10:22:46.399601", "item": [{"bridge_ip": "2.2.2.1", "bridge_name": "t2br2", "default_route_ip": "10.1.12.1", "dns": [{"brif": "t2s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t2s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns2", "route": [{"if": "p1", "ip": "10.1.12.1/24", "ns_if": "t2if", "ns_name": "t2"}], "tenant_ns": [{"tenant_ns_if": "t2ns2if", "tenant_ns_ip": "10.1.12.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s2if", "tenant_sub_ip": "10.1.12.2/24"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, {"brif": "t2br2if1", "disk": "10G", "mem": 3, "name": "t2_VM3", "vcpu": 2, "vmif": "t2VM3if1"}], "rc": 0, "start": "2019-11-17 10:22:46.287627", "stderr": "", "stderr_lines": [], "stdout": "67: t2br2if1@t2VM3if1: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP mode DEFAULT group default qlen 1000\n    link/ether 06:f1:24:ac:95:73 brd ff:ff:ff:ff:ff:ff", "stdout_lines": ["67: t2br2if1@t2VM3if1: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP mode DEFAULT group default qlen 1000", "    link/ether 06:f1:24:ac:95:73 brd ff:ff:ff:ff:ff:ff"]}

TASK [All interfaces and bridges UP] ************************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.11.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.2.11.1', u'bridge_name': u't2br1', u'ns_name': u't2ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.11.2/24', u'tenant_ns_ip': u'10.2.11.1/24', u'tenant_ns_if': u't2ns1if', u'tenant_sub_if': u't2s1if', u'tenant_ns_name': u't2'}], u'bridge_ip': u'1.1.1.1', u'vms': [{u'mem': 2, u'name': u't2_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't2br1if1', u'vmif': u't2VM4if1'}], u'vxlan': [{u'local_ip': u'10.2.11.2', u'dsport': 4789, u'dev': u't2s1if', u'tenant_route_ip': u'192.168.130.2', u'remote_route': u'10.1.11.0/24', u'subnet_route': u'10.2.11.0/24', u'v_name': u'vxlan_t2s1', u'id': 42, u'remote_ip': u'10.1.11.2'}]}, {u'dnsif': u't2s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't2s1_dnsbrif'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t2ns1\" ip link show \"t2s1_dnsbrif\" ; if [ $? -ne 0 ] ; then ip netns exec \"t2ns1\" ip link add \"t2s1_dnsbrif\" type veth peer name \"t2s1_dnsif\" ; fi\nip netns exec \"t2ns1\" ip link set dev \"t2s1_dnsbrif\" up\nip netns exec \"t2ns1\" ip link set dev \"t2s1_dnsif\" up\n", "delta": "0:00:00.162303", "end": "2019-11-17 10:22:46.408706", "item": [{"bridge_ip": "1.1.1.1", "bridge_name": "t2br1", "default_route_ip": "10.2.11.1", "ns_name": "t2ns1", "route": [{"if": "p1", "ip": "10.2.11.1/24", "ns_if": "t2if", "ns_name": "t2"}], "tenant_ns": [{"tenant_ns_if": "t2ns1if", "tenant_ns_ip": "10.2.11.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s1if", "tenant_sub_ip": "10.2.11.2/24"}], "vms": [{"brif": "t2br1if1", "disk": "10G", "mem": 2, "name": "t2_VM4", "vcpu": 4, "vmif": "t2VM4if1"}], "vxlan": [{"dev": "t2s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.11.2", "remote_ip": "10.1.11.2", "remote_route": "10.1.11.0/24", "subnet_route": "10.2.11.0/24", "tenant_route_ip": "192.168.130.2", "v_name": "vxlan_t2s1"}]}, {"brif": "t2s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t2s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "rc": 0, "start": "2019-11-17 10:22:46.246403", "stderr": "Device \"t2s1_dnsbrif\" does not exist.", "stderr_lines": ["Device \"t2s1_dnsbrif\" does not exist."], "stdout": "", "stdout_lines": []}

TASK [Attach DNS VETH Pair] *********************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.11.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.1.11.1', u'bridge_name': u't2br1', u'dns': [{u'dnsif': u't2s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't2s1_dnsbrif'}], u'ns_name': u't2ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.11.2/24', u'tenant_ns_ip': u'10.1.11.1/24', u'tenant_ns_if': u't2ns1if', u'tenant_sub_if': u't2s1if', u'tenant_ns_name': u't2'}], u'bridge_ip': u'1.1.1.1', u'vxlan': [{u'local_ip': u'10.1.11.2', u'dsport': 4789, u'dev': u't2s1if', u'tenant_route_ip': u'192.168.2.2', u'remote_route': u'10.2.11.0/24', u'subnet_route': u'10.1.11.0/24', u'v_name': u'vxlan_t2s1', u'id': 42, u'remote_ip': u'10.2.11.2'}]}, {u'mem': 2, u'name': u't2_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't2br1if1', u'vmif': u't2VM1if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t2ns1\" ip link set \"t2br1if1\" up\nip netns exec \"t2ns1\" ip link set dev \"t2br1\" up\n", "delta": "0:00:00.074333", "end": "2019-11-17 10:22:46.739593", "item": [{"bridge_ip": "1.1.1.1", "bridge_name": "t2br1", "default_route_ip": "10.1.11.1", "dns": [{"brif": "t2s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t2s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns1", "route": [{"if": "p1", "ip": "10.1.11.1/24", "ns_if": "t2if", "ns_name": "t2"}], "tenant_ns": [{"tenant_ns_if": "t2ns1if", "tenant_ns_ip": "10.1.11.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s1if", "tenant_sub_ip": "10.1.11.2/24"}], "vxlan": [{"dev": "t2s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.11.2", "remote_ip": "10.2.11.2", "remote_route": "10.2.11.0/24", "subnet_route": "10.1.11.0/24", "tenant_route_ip": "192.168.2.2", "v_name": "vxlan_t2s1"}]}, {"brif": "t2br1if1", "disk": "10G", "mem": 2, "name": "t2_VM1", "vcpu": 4, "vmif": "t2VM1if1"}], "rc": 0, "start": "2019-11-17 10:22:46.665260", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.11.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.2.11.1', u'bridge_name': u't2br1', u'ns_name': u't2ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.11.2/24', u'tenant_ns_ip': u'10.2.11.1/24', u'tenant_ns_if': u't2ns1if', u'tenant_sub_if': u't2s1if', u'tenant_ns_name': u't2'}], u'bridge_ip': u'1.1.1.1', u'vms': [{u'mem': 2, u'name': u't2_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't2br1if1', u'vmif': u't2VM4if1'}], u'vxlan': [{u'local_ip': u'10.2.11.2', u'dsport': 4789, u'dev': u't2s1if', u'tenant_route_ip': u'192.168.130.2', u'remote_route': u'10.1.11.0/24', u'subnet_route': u'10.2.11.0/24', u'v_name': u'vxlan_t2s1', u'id': 42, u'remote_ip': u'10.1.11.2'}]}, {u'dnsif': u't2s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't2s1_dnsbrif'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t2ns1\" brctl show \"t2br1\" | grep -w 't2s1_dnsbrif' ; if [ $? -ne 0 ] ; then ip netns exec \"t2ns1\" brctl addif \"t2br1\" \"t2s1_dnsbrif\" ; fi\n", "delta": "0:00:00.091906", "end": "2019-11-17 10:22:46.864626", "item": [{"bridge_ip": "1.1.1.1", "bridge_name": "t2br1", "default_route_ip": "10.2.11.1", "ns_name": "t2ns1", "route": [{"if": "p1", "ip": "10.2.11.1/24", "ns_if": "t2if", "ns_name": "t2"}], "tenant_ns": [{"tenant_ns_if": "t2ns1if", "tenant_ns_ip": "10.2.11.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s1if", "tenant_sub_ip": "10.2.11.2/24"}], "vms": [{"brif": "t2br1if1", "disk": "10G", "mem": 2, "name": "t2_VM4", "vcpu": 4, "vmif": "t2VM4if1"}], "vxlan": [{"dev": "t2s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.11.2", "remote_ip": "10.1.11.2", "remote_route": "10.1.11.0/24", "subnet_route": "10.2.11.0/24", "tenant_route_ip": "192.168.130.2", "v_name": "vxlan_t2s1"}]}, {"brif": "t2s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t2s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "rc": 0, "start": "2019-11-17 10:22:46.772720", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Create VETH Pairs] ************************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.11.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.1.11.1', u'bridge_name': u't2br1', u'dns': [{u'dnsif': u't2s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't2s1_dnsbrif'}], u'ns_name': u't2ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.11.2/24', u'tenant_ns_ip': u'10.1.11.1/24', u'tenant_ns_if': u't2ns1if', u'tenant_sub_if': u't2s1if', u'tenant_ns_name': u't2'}], u'bridge_ip': u'1.1.1.1', u'vxlan': [{u'local_ip': u'10.1.11.2', u'dsport': 4789, u'dev': u't2s1if', u'tenant_route_ip': u'192.168.2.2', u'remote_route': u'10.2.11.0/24', u'subnet_route': u'10.1.11.0/24', u'v_name': u'vxlan_t2s1', u'id': 42, u'remote_ip': u'10.2.11.2'}]}, {u'mem': 4, u'name': u't2_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't2br1if2', u'vmif': u't2VM2if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t2ns1\" ip link set \"t2br1if2\" up\nip netns exec \"t2ns1\" ip link set dev \"t2br1\" up\n", "delta": "0:00:00.073757", "end": "2019-11-17 10:22:47.011774", "item": [{"bridge_ip": "1.1.1.1", "bridge_name": "t2br1", "default_route_ip": "10.1.11.1", "dns": [{"brif": "t2s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t2s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns1", "route": [{"if": "p1", "ip": "10.1.11.1/24", "ns_if": "t2if", "ns_name": "t2"}], "tenant_ns": [{"tenant_ns_if": "t2ns1if", "tenant_ns_ip": "10.1.11.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s1if", "tenant_sub_ip": "10.1.11.2/24"}], "vxlan": [{"dev": "t2s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.11.2", "remote_ip": "10.2.11.2", "remote_route": "10.2.11.0/24", "subnet_route": "10.1.11.0/24", "tenant_route_ip": "192.168.2.2", "v_name": "vxlan_t2s1"}]}, {"brif": "t2br1if2", "disk": "10G", "mem": 4, "name": "t2_VM2", "vcpu": 2, "vmif": "t2VM2if1"}], "rc": 0, "start": "2019-11-17 10:22:46.938017", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.11.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.2.11.1', u'bridge_name': u't2br1', u'dns': [{u'dnsif': u't2s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't2s1_dnsbrif'}], u'ns_name': u't2ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.11.2/24', u'tenant_ns_ip': u'10.2.11.1/24', u'tenant_ns_if': u't2ns1if', u'tenant_sub_if': u't2s1if', u'tenant_ns_name': u't2'}], u'bridge_ip': u'1.1.1.1', u'vxlan': [{u'local_ip': u'10.2.11.2', u'dsport': 4789, u'dev': u't2s1if', u'tenant_route_ip': u'192.168.130.2', u'remote_route': u'10.1.11.0/24', u'subnet_route': u'10.2.11.0/24', u'v_name': u'vxlan_t2s1', u'id': 42, u'remote_ip': u'10.1.11.2'}]}, {u'mem': 2, u'name': u't2_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't2br1if1', u'vmif': u't2VM4if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip link show \"t2br1if1\" ; if [ $? -ne 0 ] ; then ip link add \"t2VM4if1\" type veth peer name \"t2br1if1\" ; fi\nip link set dev \"t2br1if1\" up\nip link set dev \"t2VM4if1\" up\n", "delta": "0:00:00.013882", "end": "2019-11-17 10:22:47.277748", "item": [{"bridge_ip": "1.1.1.1", "bridge_name": "t2br1", "default_route_ip": "10.2.11.1", "dns": [{"brif": "t2s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t2s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns1", "route": [{"if": "p1", "ip": "10.2.11.1/24", "ns_if": "t2if", "ns_name": "t2"}], "tenant_ns": [{"tenant_ns_if": "t2ns1if", "tenant_ns_ip": "10.2.11.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s1if", "tenant_sub_ip": "10.2.11.2/24"}], "vxlan": [{"dev": "t2s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.11.2", "remote_ip": "10.1.11.2", "remote_route": "10.1.11.0/24", "subnet_route": "10.2.11.0/24", "tenant_route_ip": "192.168.130.2", "v_name": "vxlan_t2s1"}]}, {"brif": "t2br1if1", "disk": "10G", "mem": 2, "name": "t2_VM4", "vcpu": 4, "vmif": "t2VM4if1"}], "rc": 0, "start": "2019-11-17 10:22:47.263866", "stderr": "Device \"t2br1if1\" does not exist.", "stderr_lines": ["Device \"t2br1if1\" does not exist."], "stdout": "", "stdout_lines": []}

TASK [Attach VETH Pairs] ************************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.12.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.1.12.1', u'bridge_name': u't2br2', u'dns': [{u'dnsif': u't2s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't2s2_dnsbrif'}], u'ns_name': u't2ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.12.2/24', u'tenant_ns_ip': u'10.1.12.1/24', u'tenant_ns_if': u't2ns2if', u'tenant_sub_if': u't2s2if', u'tenant_ns_name': u't2'}], u'bridge_ip': u'2.2.2.1', u'vxlan': [{u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}, {u'mem': 3, u'name': u't2_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't2br2if1', u'vmif': u't2VM3if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t2ns2\" ip link set \"t2br2if1\" up\nip netns exec \"t2ns2\" ip link set dev \"t2br2\" up\n", "delta": "0:00:00.069611", "end": "2019-11-17 10:22:47.299696", "item": [{"bridge_ip": "2.2.2.1", "bridge_name": "t2br2", "default_route_ip": "10.1.12.1", "dns": [{"brif": "t2s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t2s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns2", "route": [{"if": "p1", "ip": "10.1.12.1/24", "ns_if": "t2if", "ns_name": "t2"}], "tenant_ns": [{"tenant_ns_if": "t2ns2if", "tenant_ns_ip": "10.1.12.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s2if", "tenant_sub_ip": "10.1.12.2/24"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, {"brif": "t2br2if1", "disk": "10G", "mem": 3, "name": "t2_VM3", "vcpu": 2, "vmif": "t2VM3if1"}], "rc": 0, "start": "2019-11-17 10:22:47.230085", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Add IP to DNS Interface] ******************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.11.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.1.11.1', u'bridge_name': u't2br1', u'ns_name': u't2ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.11.2/24', u'tenant_ns_ip': u'10.1.11.1/24', u'tenant_ns_if': u't2ns1if', u'tenant_sub_if': u't2s1if', u'tenant_ns_name': u't2'}], u'bridge_ip': u'1.1.1.1', u'vms': [{u'mem': 2, u'name': u't2_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't2br1if1', u'vmif': u't2VM1if1'}, {u'mem': 4, u'name': u't2_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't2br1if2', u'vmif': u't2VM2if1'}], u'vxlan': [{u'local_ip': u'10.1.11.2', u'dsport': 4789, u'dev': u't2s1if', u'tenant_route_ip': u'192.168.2.2', u'remote_route': u'10.2.11.0/24', u'subnet_route': u'10.1.11.0/24', u'v_name': u'vxlan_t2s1', u'id': 42, u'remote_ip': u'10.2.11.2'}]}, {u'dnsif': u't2s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't2s1_dnsbrif'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t2ns1\" ip addr show \"t2s1_dnsif\" | awk 'FNR==3{ print $2 }' | grep -w '^1.1.1.1/24' ; if [ $? -ne 0 ] ; then ip netns exec \"t2ns1\" ip addr add \"1.1.1.1/24\" dev \"t2s1_dnsif\" ; fi\n", "delta": "0:00:00.075624", "end": "2019-11-17 10:22:47.683618", "item": [{"bridge_ip": "1.1.1.1", "bridge_name": "t2br1", "default_route_ip": "10.1.11.1", "ns_name": "t2ns1", "route": [{"if": "p1", "ip": "10.1.11.1/24", "ns_if": "t2if", "ns_name": "t2"}], "tenant_ns": [{"tenant_ns_if": "t2ns1if", "tenant_ns_ip": "10.1.11.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s1if", "tenant_sub_ip": "10.1.11.2/24"}], "vms": [{"brif": "t2br1if1", "disk": "10G", "mem": 2, "name": "t2_VM1", "vcpu": 4, "vmif": "t2VM1if1"}, {"brif": "t2br1if2", "disk": "10G", "mem": 4, "name": "t2_VM2", "vcpu": 2, "vmif": "t2VM2if1"}], "vxlan": [{"dev": "t2s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.11.2", "remote_ip": "10.2.11.2", "remote_route": "10.2.11.0/24", "subnet_route": "10.1.11.0/24", "tenant_route_ip": "192.168.2.2", "v_name": "vxlan_t2s1"}]}, {"brif": "t2s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t2s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "rc": 0, "start": "2019-11-17 10:22:47.607994", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.11.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.2.11.1', u'bridge_name': u't2br1', u'dns': [{u'dnsif': u't2s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't2s1_dnsbrif'}], u'ns_name': u't2ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.11.2/24', u'tenant_ns_ip': u'10.2.11.1/24', u'tenant_ns_if': u't2ns1if', u'tenant_sub_if': u't2s1if', u'tenant_ns_name': u't2'}], u'bridge_ip': u'1.1.1.1', u'vxlan': [{u'local_ip': u'10.2.11.2', u'dsport': 4789, u'dev': u't2s1if', u'tenant_route_ip': u'192.168.130.2', u'remote_route': u'10.1.11.0/24', u'subnet_route': u'10.2.11.0/24', u'v_name': u'vxlan_t2s1', u'id': 42, u'remote_ip': u'10.1.11.2'}]}, {u'mem': 2, u'name': u't2_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't2br1if1', u'vmif': u't2VM4if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip link show \"t2br1if1\" ; if [ $? -eq 0 ] ; then ip link set \"t2br1if1\" netns \"t2ns1\" ; fi\nip netns exec \"t2ns1\" brctl show \"t2br1\" | grep -w 't2br1if1' ; if [ $? -ne 0 ] ; then ip netns exec \"t2ns1\" brctl addif \"t2br1\" \"t2br1if1\" ; fi\n", "delta": "0:00:00.104880", "end": "2019-11-17 10:22:47.772353", "item": [{"bridge_ip": "1.1.1.1", "bridge_name": "t2br1", "default_route_ip": "10.2.11.1", "dns": [{"brif": "t2s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t2s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns1", "route": [{"if": "p1", "ip": "10.2.11.1/24", "ns_if": "t2if", "ns_name": "t2"}], "tenant_ns": [{"tenant_ns_if": "t2ns1if", "tenant_ns_ip": "10.2.11.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s1if", "tenant_sub_ip": "10.2.11.2/24"}], "vxlan": [{"dev": "t2s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.11.2", "remote_ip": "10.1.11.2", "remote_route": "10.1.11.0/24", "subnet_route": "10.2.11.0/24", "tenant_route_ip": "192.168.130.2", "v_name": "vxlan_t2s1"}]}, {"brif": "t2br1if1", "disk": "10G", "mem": 2, "name": "t2_VM4", "vcpu": 4, "vmif": "t2VM4if1"}], "rc": 0, "start": "2019-11-17 10:22:47.667473", "stderr": "", "stderr_lines": [], "stdout": "32: t2br1if1@t2VM4if1: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP mode DEFAULT group default qlen 1000\n    link/ether f6:0e:d9:19:34:98 brd ff:ff:ff:ff:ff:ff", "stdout_lines": ["32: t2br1if1@t2VM4if1: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP mode DEFAULT group default qlen 1000", "    link/ether f6:0e:d9:19:34:98 brd ff:ff:ff:ff:ff:ff"]}

TASK [All interfaces and bridges UP] ************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.12.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.1.12.1', u'bridge_name': u't2br2', u'ns_name': u't2ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.12.2/24', u'tenant_ns_ip': u'10.1.12.1/24', u'tenant_ns_if': u't2ns2if', u'tenant_sub_if': u't2s2if', u'tenant_ns_name': u't2'}], u'bridge_ip': u'2.2.2.1', u'vms': [{u'mem': 3, u'name': u't2_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't2br2if1', u'vmif': u't2VM3if1'}], u'vxlan': [{u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}, {u'dnsif': u't2s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't2s2_dnsbrif'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t2ns2\" ip addr show \"t2s2_dnsif\" | awk 'FNR==3{ print $2 }' | grep -w '^2.2.2.1/24' ; if [ $? -ne 0 ] ; then ip netns exec \"t2ns2\" ip addr add \"2.2.2.1/24\" dev \"t2s2_dnsif\" ; fi\n", "delta": "0:00:00.099533", "end": "2019-11-17 10:22:47.999632", "item": [{"bridge_ip": "2.2.2.1", "bridge_name": "t2br2", "default_route_ip": "10.1.12.1", "ns_name": "t2ns2", "route": [{"if": "p1", "ip": "10.1.12.1/24", "ns_if": "t2if", "ns_name": "t2"}], "tenant_ns": [{"tenant_ns_if": "t2ns2if", "tenant_ns_ip": "10.1.12.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s2if", "tenant_sub_ip": "10.1.12.2/24"}], "vms": [{"brif": "t2br2if1", "disk": "10G", "mem": 3, "name": "t2_VM3", "vcpu": 2, "vmif": "t2VM3if1"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, {"brif": "t2s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t2s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "rc": 0, "start": "2019-11-17 10:22:47.900099", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Install DHCP Server] **********************************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.11.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.2.11.1', u'bridge_name': u't2br1', u'dns': [{u'dnsif': u't2s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't2s1_dnsbrif'}], u'ns_name': u't2ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.11.2/24', u'tenant_ns_ip': u'10.2.11.1/24', u'tenant_ns_if': u't2ns1if', u'tenant_sub_if': u't2s1if', u'tenant_ns_name': u't2'}], u'bridge_ip': u'1.1.1.1', u'vxlan': [{u'local_ip': u'10.2.11.2', u'dsport': 4789, u'dev': u't2s1if', u'tenant_route_ip': u'192.168.130.2', u'remote_route': u'10.1.11.0/24', u'subnet_route': u'10.2.11.0/24', u'v_name': u'vxlan_t2s1', u'id': 42, u'remote_ip': u'10.1.11.2'}]}, {u'mem': 2, u'name': u't2_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't2br1if1', u'vmif': u't2VM4if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t2ns1\" ip link set \"t2br1if1\" up\nip netns exec \"t2ns1\" ip link set dev \"t2br1\" up\n", "delta": "0:00:00.068156", "end": "2019-11-17 10:22:48.216462", "item": [{"bridge_ip": "1.1.1.1", "bridge_name": "t2br1", "default_route_ip": "10.2.11.1", "dns": [{"brif": "t2s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t2s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns1", "route": [{"if": "p1", "ip": "10.2.11.1/24", "ns_if": "t2if", "ns_name": "t2"}], "tenant_ns": [{"tenant_ns_if": "t2ns1if", "tenant_ns_ip": "10.2.11.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s1if", "tenant_sub_ip": "10.2.11.2/24"}], "vxlan": [{"dev": "t2s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.11.2", "remote_ip": "10.1.11.2", "remote_route": "10.1.11.0/24", "subnet_route": "10.2.11.0/24", "tenant_route_ip": "192.168.130.2", "v_name": "vxlan_t2s1"}]}, {"brif": "t2br1if1", "disk": "10G", "mem": 2, "name": "t2_VM4", "vcpu": 4, "vmif": "t2VM4if1"}], "rc": 0, "start": "2019-11-17 10:22:48.148306", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Add IP to DNS Interface] ******************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.11.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.1.11.1', u'bridge_name': u't2br1', u'ns_name': u't2ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.11.2/24', u'tenant_ns_ip': u'10.1.11.1/24', u'tenant_ns_if': u't2ns1if', u'tenant_sub_if': u't2s1if', u'tenant_ns_name': u't2'}], u'bridge_ip': u'1.1.1.1', u'vms': [{u'mem': 2, u'name': u't2_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't2br1if1', u'vmif': u't2VM1if1'}, {u'mem': 4, u'name': u't2_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't2br1if2', u'vmif': u't2VM2if1'}], u'vxlan': [{u'local_ip': u'10.1.11.2', u'dsport': 4789, u'dev': u't2s1if', u'tenant_route_ip': u'192.168.2.2', u'remote_route': u'10.2.11.0/24', u'subnet_route': u'10.1.11.0/24', u'v_name': u'vxlan_t2s1', u'id': 42, u'remote_ip': u'10.2.11.2'}]}, {u'dnsif': u't2s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't2s1_dnsbrif'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t2ns1\" ps aux | grep -w '[d]nsmasq --interface t2s1_dnsif -z --dhcp-range=1.1.1.5,1.1.1.126' ; if [ $? -ne 0 ] ; then ip netns exec \"t2ns1\" dnsmasq --interface \"t2s1_dnsif\" -z --dhcp-range=1.1.1.5,'1.1.1.126' ; fi\n", "delta": "0:00:00.079518", "end": "2019-11-17 10:22:48.360323", "item": [{"bridge_ip": "1.1.1.1", "bridge_name": "t2br1", "default_route_ip": "10.1.11.1", "ns_name": "t2ns1", "route": [{"if": "p1", "ip": "10.1.11.1/24", "ns_if": "t2if", "ns_name": "t2"}], "tenant_ns": [{"tenant_ns_if": "t2ns1if", "tenant_ns_ip": "10.1.11.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s1if", "tenant_sub_ip": "10.1.11.2/24"}], "vms": [{"brif": "t2br1if1", "disk": "10G", "mem": 2, "name": "t2_VM1", "vcpu": 4, "vmif": "t2VM1if1"}, {"brif": "t2br1if2", "disk": "10G", "mem": 4, "name": "t2_VM2", "vcpu": 2, "vmif": "t2VM2if1"}], "vxlan": [{"dev": "t2s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.11.2", "remote_ip": "10.2.11.2", "remote_route": "10.2.11.0/24", "subnet_route": "10.1.11.0/24", "tenant_route_ip": "192.168.2.2", "v_name": "vxlan_t2s1"}]}, {"brif": "t2s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t2s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "rc": 0, "start": "2019-11-17 10:22:48.280805", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.12.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.1.12.1', u'bridge_name': u't2br2', u'ns_name': u't2ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.12.2/24', u'tenant_ns_ip': u'10.1.12.1/24', u'tenant_ns_if': u't2ns2if', u'tenant_sub_if': u't2s2if', u'tenant_ns_name': u't2'}], u'bridge_ip': u'2.2.2.1', u'vms': [{u'mem': 3, u'name': u't2_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't2br2if1', u'vmif': u't2VM3if1'}], u'vxlan': [{u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}, {u'dnsif': u't2s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't2s2_dnsbrif'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t2ns2\" ps aux | grep -w '[d]nsmasq --interface t2s2_dnsif -z --dhcp-range=2.2.2.5,2.2.2.254' ; if [ $? -ne 0 ] ; then ip netns exec \"t2ns2\" dnsmasq --interface \"t2s2_dnsif\" -z --dhcp-range=2.2.2.5,'2.2.2.254' ; fi\n", "delta": "0:00:00.083189", "end": "2019-11-17 10:22:48.676227", "item": [{"bridge_ip": "2.2.2.1", "bridge_name": "t2br2", "default_route_ip": "10.1.12.1", "ns_name": "t2ns2", "route": [{"if": "p1", "ip": "10.1.12.1/24", "ns_if": "t2if", "ns_name": "t2"}], "tenant_ns": [{"tenant_ns_if": "t2ns2if", "tenant_ns_ip": "10.1.12.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s2if", "tenant_sub_ip": "10.1.12.2/24"}], "vms": [{"brif": "t2br2if1", "disk": "10G", "mem": 3, "name": "t2_VM3", "vcpu": 2, "vmif": "t2VM3if1"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, {"brif": "t2s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t2s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "rc": 0, "start": "2019-11-17 10:22:48.593038", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Create VXLAN devices] *********************************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.11.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.2.11.1', u'bridge_name': u't2br1', u'ns_name': u't2ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.11.2/24', u'tenant_ns_ip': u'10.2.11.1/24', u'tenant_ns_if': u't2ns1if', u'tenant_sub_if': u't2s1if', u'tenant_ns_name': u't2'}], u'bridge_ip': u'1.1.1.1', u'vms': [{u'mem': 2, u'name': u't2_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't2br1if1', u'vmif': u't2VM4if1'}], u'vxlan': [{u'local_ip': u'10.2.11.2', u'dsport': 4789, u'dev': u't2s1if', u'tenant_route_ip': u'192.168.130.2', u'remote_route': u'10.1.11.0/24', u'subnet_route': u'10.2.11.0/24', u'v_name': u'vxlan_t2s1', u'id': 42, u'remote_ip': u'10.1.11.2'}]}, {u'dnsif': u't2s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't2s1_dnsbrif'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t2ns1\" ip addr show \"t2s1_dnsif\" | awk 'FNR==3{ print $2}'| grep -w '^1.1.1.128/24' ; if [ $? -ne 0 ] ; then ip netns exec \"t2ns1\" ip addr add \"1.1.1.128/24\" dev \"t2s1_dnsif\" ; fi\n", "delta": "0:00:00.084612", "end": "2019-11-17 10:22:48.712364", "item": [{"bridge_ip": "1.1.1.1", "bridge_name": "t2br1", "default_route_ip": "10.2.11.1", "ns_name": "t2ns1", "route": [{"if": "p1", "ip": "10.2.11.1/24", "ns_if": "t2if", "ns_name": "t2"}], "tenant_ns": [{"tenant_ns_if": "t2ns1if", "tenant_ns_ip": "10.2.11.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s1if", "tenant_sub_ip": "10.2.11.2/24"}], "vms": [{"brif": "t2br1if1", "disk": "10G", "mem": 2, "name": "t2_VM4", "vcpu": 4, "vmif": "t2VM4if1"}], "vxlan": [{"dev": "t2s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.11.2", "remote_ip": "10.1.11.2", "remote_route": "10.1.11.0/24", "subnet_route": "10.2.11.0/24", "tenant_route_ip": "192.168.130.2", "v_name": "vxlan_t2s1"}]}, {"brif": "t2s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t2s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "rc": 0, "start": "2019-11-17 10:22:48.627752", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Install DHCP Server] **********************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.11.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.1.11.1', u'bridge_name': u't2br1', u'dns': [{u'dnsif': u't2s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't2s1_dnsbrif'}], u'ns_name': u't2ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.11.2/24', u'tenant_ns_ip': u'10.1.11.1/24', u'tenant_ns_if': u't2ns1if', u'tenant_sub_if': u't2s1if', u'tenant_ns_name': u't2'}], u'bridge_ip': u'1.1.1.1', u'vms': [{u'mem': 2, u'name': u't2_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't2br1if1', u'vmif': u't2VM1if1'}, {u'mem': 4, u'name': u't2_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't2br1if2', u'vmif': u't2VM2if1'}]}, {u'local_ip': u'10.1.11.2', u'dsport': 4789, u'dev': u't2s1if', u'tenant_route_ip': u'192.168.2.2', u'remote_route': u'10.2.11.0/24', u'subnet_route': u'10.1.11.0/24', u'v_name': u'vxlan_t2s1', u'id': 42, u'remote_ip': u'10.2.11.2'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t2ns1\" ip link show \"vxlan_t2s1\" ; if [ $? -ne 0 ] ; then ip netns exec \"t2ns1\" ip link add \"vxlan_t2s1\" type vxlan id \"42\" local \"10.1.11.2\" remote \"10.2.11.2\" dstport \"4789\" dev \"t2s1if\"; ip netns exec \"t2ns1\" ip link set dev \"vxlan_t2s1\" up ; fi\n", "delta": "0:00:00.103447", "end": "2019-11-17 10:22:49.075790", "item": [{"bridge_ip": "1.1.1.1", "bridge_name": "t2br1", "default_route_ip": "10.1.11.1", "dns": [{"brif": "t2s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t2s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns1", "route": [{"if": "p1", "ip": "10.1.11.1/24", "ns_if": "t2if", "ns_name": "t2"}], "tenant_ns": [{"tenant_ns_if": "t2ns1if", "tenant_ns_ip": "10.1.11.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s1if", "tenant_sub_ip": "10.1.11.2/24"}], "vms": [{"brif": "t2br1if1", "disk": "10G", "mem": 2, "name": "t2_VM1", "vcpu": 4, "vmif": "t2VM1if1"}, {"brif": "t2br1if2", "disk": "10G", "mem": 4, "name": "t2_VM2", "vcpu": 2, "vmif": "t2VM2if1"}]}, {"dev": "t2s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.11.2", "remote_ip": "10.2.11.2", "remote_route": "10.2.11.0/24", "subnet_route": "10.1.11.0/24", "tenant_route_ip": "192.168.2.2", "v_name": "vxlan_t2s1"}], "rc": 0, "start": "2019-11-17 10:22:48.972343", "stderr": "Device \"vxlan_t2s1\" does not exist.", "stderr_lines": ["Device \"vxlan_t2s1\" does not exist."], "stdout": "", "stdout_lines": []}
skipping: [localhost] => (item=[{u'route': [{u'ip': u'10.1.12.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.1.12.1', u'bridge_name': u't2br2', u'dns': [{u'dnsif': u't2s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't2s2_dnsbrif'}], u'ns_name': u't2ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.12.2/24', u'tenant_ns_ip': u'10.1.12.1/24', u'tenant_ns_if': u't2ns2if', u'tenant_sub_if': u't2s2if', u'tenant_ns_name': u't2'}], u'bridge_ip': u'2.2.2.1', u'vms': [{u'mem': 3, u'name': u't2_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't2br2if1', u'vmif': u't2VM3if1'}]}, {u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}])  => {"ansible_loop_var": "item", "changed": false, "item": [{"bridge_ip": "2.2.2.1", "bridge_name": "t2br2", "default_route_ip": "10.1.12.1", "dns": [{"brif": "t2s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t2s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns2", "route": [{"if": "p1", "ip": "10.1.12.1/24", "ns_if": "t2if", "ns_name": "t2"}], "tenant_ns": [{"tenant_ns_if": "t2ns2if", "tenant_ns_ip": "10.1.12.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s2if", "tenant_sub_ip": "10.1.12.2/24"}], "vms": [{"brif": "t2br2if1", "disk": "10G", "mem": 3, "name": "t2_VM3", "vcpu": 2, "vmif": "t2VM3if1"}]}, {"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}], "skip_reason": "Conditional result was False"}

TASK [Attach VXLANs to bridge] ******************************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.11.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.2.11.1', u'bridge_name': u't2br1', u'ns_name': u't2ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.11.2/24', u'tenant_ns_ip': u'10.2.11.1/24', u'tenant_ns_if': u't2ns1if', u'tenant_sub_if': u't2s1if', u'tenant_ns_name': u't2'}], u'bridge_ip': u'1.1.1.1', u'vms': [{u'mem': 2, u'name': u't2_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't2br1if1', u'vmif': u't2VM4if1'}], u'vxlan': [{u'local_ip': u'10.2.11.2', u'dsport': 4789, u'dev': u't2s1if', u'tenant_route_ip': u'192.168.130.2', u'remote_route': u'10.1.11.0/24', u'subnet_route': u'10.2.11.0/24', u'v_name': u'vxlan_t2s1', u'id': 42, u'remote_ip': u'10.1.11.2'}]}, {u'dnsif': u't2s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't2s1_dnsbrif'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t2ns1\" ps aux | grep -w '[d]nsmasq --interface t2s1_dnsif -z --dhcp-range=1.1.1.133,1.1.1.254' ; if [ $? -ne 0 ] ; then ip netns exec \"t2ns1\" dnsmasq --interface \"t2s1_dnsif\" -z --dhcp-range=1.1.1.133,'1.1.1.254' ; fi\n", "delta": "0:00:00.075784", "end": "2019-11-17 10:22:49.164546", "item": [{"bridge_ip": "1.1.1.1", "bridge_name": "t2br1", "default_route_ip": "10.2.11.1", "ns_name": "t2ns1", "route": [{"if": "p1", "ip": "10.2.11.1/24", "ns_if": "t2if", "ns_name": "t2"}], "tenant_ns": [{"tenant_ns_if": "t2ns1if", "tenant_ns_ip": "10.2.11.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s1if", "tenant_sub_ip": "10.2.11.2/24"}], "vms": [{"brif": "t2br1if1", "disk": "10G", "mem": 2, "name": "t2_VM4", "vcpu": 4, "vmif": "t2VM4if1"}], "vxlan": [{"dev": "t2s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.11.2", "remote_ip": "10.1.11.2", "remote_route": "10.1.11.0/24", "subnet_route": "10.2.11.0/24", "tenant_route_ip": "192.168.130.2", "v_name": "vxlan_t2s1"}]}, {"brif": "t2s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t2s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "rc": 0, "start": "2019-11-17 10:22:49.088762", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Create VXLAN devices] *********************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.11.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.1.11.1', u'bridge_name': u't2br1', u'dns': [{u'dnsif': u't2s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't2s1_dnsbrif'}], u'ns_name': u't2ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.11.2/24', u'tenant_ns_ip': u'10.1.11.1/24', u'tenant_ns_if': u't2ns1if', u'tenant_sub_if': u't2s1if', u'tenant_ns_name': u't2'}], u'bridge_ip': u'1.1.1.1', u'vms': [{u'mem': 2, u'name': u't2_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't2br1if1', u'vmif': u't2VM1if1'}, {u'mem': 4, u'name': u't2_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't2br1if2', u'vmif': u't2VM2if1'}]}, {u'local_ip': u'10.1.11.2', u'dsport': 4789, u'dev': u't2s1if', u'tenant_route_ip': u'192.168.2.2', u'remote_route': u'10.2.11.0/24', u'subnet_route': u'10.1.11.0/24', u'v_name': u'vxlan_t2s1', u'id': 42, u'remote_ip': u'10.2.11.2'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t2ns1\" brctl show \"t2br1\" | grep -w 'vxlan_t2s1' ; if [ $? -ne 0 ] ; then ip netns exec \"t2ns1\" brctl addif \"t2br1\" \"vxlan_t2s1\" ; fi\n", "delta": "0:00:00.096883", "end": "2019-11-17 10:22:49.451625", "item": [{"bridge_ip": "1.1.1.1", "bridge_name": "t2br1", "default_route_ip": "10.1.11.1", "dns": [{"brif": "t2s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t2s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns1", "route": [{"if": "p1", "ip": "10.1.11.1/24", "ns_if": "t2if", "ns_name": "t2"}], "tenant_ns": [{"tenant_ns_if": "t2ns1if", "tenant_ns_ip": "10.1.11.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s1if", "tenant_sub_ip": "10.1.11.2/24"}], "vms": [{"brif": "t2br1if1", "disk": "10G", "mem": 2, "name": "t2_VM1", "vcpu": 4, "vmif": "t2VM1if1"}, {"brif": "t2br1if2", "disk": "10G", "mem": 4, "name": "t2_VM2", "vcpu": 2, "vmif": "t2VM2if1"}]}, {"dev": "t2s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.11.2", "remote_ip": "10.2.11.2", "remote_route": "10.2.11.0/24", "subnet_route": "10.1.11.0/24", "tenant_route_ip": "192.168.2.2", "v_name": "vxlan_t2s1"}], "rc": 0, "start": "2019-11-17 10:22:49.354742", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}
skipping: [localhost] => (item=[{u'route': [{u'ip': u'10.1.12.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.1.12.1', u'bridge_name': u't2br2', u'dns': [{u'dnsif': u't2s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't2s2_dnsbrif'}], u'ns_name': u't2ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.12.2/24', u'tenant_ns_ip': u'10.1.12.1/24', u'tenant_ns_if': u't2ns2if', u'tenant_sub_if': u't2s2if', u'tenant_ns_name': u't2'}], u'bridge_ip': u'2.2.2.1', u'vms': [{u'mem': 3, u'name': u't2_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't2br2if1', u'vmif': u't2VM3if1'}]}, {u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}])  => {"ansible_loop_var": "item", "changed": false, "item": [{"bridge_ip": "2.2.2.1", "bridge_name": "t2br2", "default_route_ip": "10.1.12.1", "dns": [{"brif": "t2s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t2s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns2", "route": [{"if": "p1", "ip": "10.1.12.1/24", "ns_if": "t2if", "ns_name": "t2"}], "tenant_ns": [{"tenant_ns_if": "t2ns2if", "tenant_ns_ip": "10.1.12.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s2if", "tenant_sub_ip": "10.1.12.2/24"}], "vms": [{"brif": "t2br2if1", "disk": "10G", "mem": 3, "name": "t2_VM3", "vcpu": 2, "vmif": "t2VM3if1"}]}, {"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}], "skip_reason": "Conditional result was False"}

PLAY RECAP **************************************************************************************************************************************************
localhost                  : ok=21   changed=20   unreachable=0    failed=0    skipped=0    rescued=0    ignored=0   

changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.11.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.2.11.1', u'bridge_name': u't2br1', u'dns': [{u'dnsif': u't2s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't2s1_dnsbrif'}], u'ns_name': u't2ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.11.2/24', u'tenant_ns_ip': u'10.2.11.1/24', u'tenant_ns_if': u't2ns1if', u'tenant_sub_if': u't2s1if', u'tenant_ns_name': u't2'}], u'bridge_ip': u'1.1.1.1', u'vms': [{u'mem': 2, u'name': u't2_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't2br1if1', u'vmif': u't2VM4if1'}]}, {u'local_ip': u'10.2.11.2', u'dsport': 4789, u'dev': u't2s1if', u'tenant_route_ip': u'192.168.130.2', u'remote_route': u'10.1.11.0/24', u'subnet_route': u'10.2.11.0/24', u'v_name': u'vxlan_t2s1', u'id': 42, u'remote_ip': u'10.1.11.2'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t2ns1\" ip link show \"vxlan_t2s1\" ; if [ $? -ne 0 ] ; then ip netns exec \"t2ns1\" ip link add \"vxlan_t2s1\" type vxlan id \"42\" local \"10.2.11.2\" remote \"10.1.11.2\" dstport \"4789\" dev \"t2s1if\" ; ip netns exec \"t2ns1\" ip link set dev \"vxlan_t2s1\" up ; fi\n", "delta": "0:00:00.104596", "end": "2019-11-17 10:22:49.644520", "item": [{"bridge_ip": "1.1.1.1", "bridge_name": "t2br1", "default_route_ip": "10.2.11.1", "dns": [{"brif": "t2s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t2s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns1", "route": [{"if": "p1", "ip": "10.2.11.1/24", "ns_if": "t2if", "ns_name": "t2"}], "tenant_ns": [{"tenant_ns_if": "t2ns1if", "tenant_ns_ip": "10.2.11.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s1if", "tenant_sub_ip": "10.2.11.2/24"}], "vms": [{"brif": "t2br1if1", "disk": "10G", "mem": 2, "name": "t2_VM4", "vcpu": 4, "vmif": "t2VM4if1"}]}, {"dev": "t2s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.11.2", "remote_ip": "10.1.11.2", "remote_route": "10.1.11.0/24", "subnet_route": "10.2.11.0/24", "tenant_route_ip": "192.168.130.2", "v_name": "vxlan_t2s1"}], "rc": 0, "start": "2019-11-17 10:22:49.539924", "stderr": "Device \"vxlan_t2s1\" does not exist.", "stderr_lines": ["Device \"vxlan_t2s1\" does not exist."], "stdout": "", "stdout_lines": []}

TASK [Attach VXLANs to bridge] ******************************************************************************************************************************
Using /etc/ansible/ansible.cfg as config file

PLAY [worker] ***********************************************************************************************************************************************

TASK [Create Tenant Namespace] ******************************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.11.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.2.11.1', u'bridge_name': u't2br1', u'dns': [{u'dnsif': u't2s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't2s1_dnsbrif'}], u'ns_name': u't2ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.11.2/24', u'tenant_ns_ip': u'10.2.11.1/24', u'tenant_ns_if': u't2ns1if', u'tenant_sub_if': u't2s1if', u'tenant_ns_name': u't2'}], u'bridge_ip': u'1.1.1.1', u'vms': [{u'mem': 2, u'name': u't2_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't2br1if1', u'vmif': u't2VM4if1'}]}, {u'local_ip': u'10.2.11.2', u'dsport': 4789, u'dev': u't2s1if', u'tenant_route_ip': u'192.168.130.2', u'remote_route': u'10.1.11.0/24', u'subnet_route': u'10.2.11.0/24', u'v_name': u'vxlan_t2s1', u'id': 42, u'remote_ip': u'10.1.11.2'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t2ns1\" brctl show \"t2br1\" | grep -w 'vxlan_t2s1' ; if [ $? -ne 0 ] ; then ip netns exec \"t2ns1\" brctl addif \"t2br1\" \"vxlan_t2s1\" ; fi\n", "delta": "0:00:00.078482", "end": "2019-11-17 10:22:50.100407", "item": [{"bridge_ip": "1.1.1.1", "bridge_name": "t2br1", "default_route_ip": "10.2.11.1", "dns": [{"brif": "t2s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t2s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns1", "route": [{"if": "p1", "ip": "10.2.11.1/24", "ns_if": "t2if", "ns_name": "t2"}], "tenant_ns": [{"tenant_ns_if": "t2ns1if", "tenant_ns_ip": "10.2.11.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s1if", "tenant_sub_ip": "10.2.11.2/24"}], "vms": [{"brif": "t2br1if1", "disk": "10G", "mem": 2, "name": "t2_VM4", "vcpu": 4, "vmif": "t2VM4if1"}]}, {"dev": "t2s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.11.2", "remote_ip": "10.1.11.2", "remote_route": "10.1.11.0/24", "subnet_route": "10.2.11.0/24", "tenant_route_ip": "192.168.130.2", "v_name": "vxlan_t2s1"}], "rc": 0, "start": "2019-11-17 10:22:50.021925", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

PLAY RECAP **************************************************************************************************************************************************
99.99.99.2                 : ok=21   changed=21   unreachable=0    failed=0    skipped=0    rescued=0    ignored=0   

Using /etc/ansible/ansible.cfg as config file
ok: [99.99.99.2] => (item={u'default_route_ip': u'192.168.130.1', u'name': u't2', u'pns_ip': u'192.168.130.1/24', u'tenant_if': u't2if', u'tenant_ip': u'192.168.130.2/24', u'pns_if': u't2pns_if'}) => {"ansible_loop_var": "item", "changed": false, "cmd": ["ip", "netns", "add", "t2"], "item": {"default_route_ip": "192.168.130.1", "name": "t2", "pns_if": "t2pns_if", "pns_ip": "192.168.130.1/24", "tenant_if": "t2if", "tenant_ip": "192.168.130.2/24"}, "rc": 0, "stdout": "skipped, since /var/run/netns/t2 exists", "stdout_lines": ["skipped, since /var/run/netns/t2 exists"]}

TASK [Create Subnet Namespace] ******************************************************************************************************************************

PLAY [main] *************************************************************************************************************************************************

TASK [Add VXLAN routes in PNS] ******************************************************************************************************************************
ok: [99.99.99.2] => (item={u'route': [{u'ip': u'10.2.11.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.2.11.1', u'bridge_name': u't2br1', u'dns': [{u'dnsif': u't2s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't2s1_dnsbrif'}], u'ns_name': u't2ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.11.2/24', u'tenant_ns_ip': u'10.2.11.1/24', u'tenant_ns_if': u't2ns1if', u'tenant_ns_name': u't2', u'tenant_sub_if': u't2s1if'}], u'bridge_ip': u'1.1.1.1', u'vms': [{u'mem': 2, u'name': u't2_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't2br1if1', u'vmif': u't2VM4if1'}], u'vxlan': [{u'local_ip': u'10.2.11.2', u'tenant_route_ip': u'192.168.130.2', u'dsport': 4789, u'dev': u't2s1if', u'subnet_route': u'10.2.11.0/24', u'remote_route': u'10.1.11.0/24', u'v_name': u'vxlan_t2s1', u'id': 42, u'remote_ip': u'10.1.11.2'}]}) => {"ansible_loop_var": "item", "changed": false, "cmd": ["ip", "netns", "add", "t2ns1"], "item": {"bridge_ip": "1.1.1.1", "bridge_name": "t2br1", "default_route_ip": "10.2.11.1", "dns": [{"brif": "t2s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t2s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns1", "route": [{"if": "p1", "ip": "10.2.11.1/24", "ns_if": "t2if", "ns_name": "t2"}], "tenant_ns": [{"tenant_ns_if": "t2ns1if", "tenant_ns_ip": "10.2.11.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s1if", "tenant_sub_ip": "10.2.11.2/24"}], "vms": [{"brif": "t2br1if1", "disk": "10G", "mem": 2, "name": "t2_VM4", "vcpu": 4, "vmif": "t2VM4if1"}], "vxlan": [{"dev": "t2s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.11.2", "remote_ip": "10.1.11.2", "remote_route": "10.1.11.0/24", "subnet_route": "10.2.11.0/24", "tenant_route_ip": "192.168.130.2", "v_name": "vxlan_t2s1"}]}, "rc": 0, "stdout": "skipped, since /var/run/netns/t2ns1 exists", "stdout_lines": ["skipped, since /var/run/netns/t2ns1 exists"]}

TASK [Create Tenant VETH pairs] *****************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.11.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.1.11.1', u'bridge_name': u't2br1', u'dns': [{u'dnsif': u't2s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't2s1_dnsbrif'}], u'ns_name': u't2ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.11.2/24', u'tenant_ns_ip': u'10.1.11.1/24', u'tenant_ns_if': u't2ns1if', u'tenant_sub_if': u't2s1if', u'tenant_ns_name': u't2'}], u'bridge_ip': u'1.1.1.1', u'vms': [{u'mem': 2, u'name': u't2_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't2br1if1', u'vmif': u't2VM1if1'}, {u'mem': 4, u'name': u't2_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't2br1if2', u'vmif': u't2VM2if1'}]}, {u'local_ip': u'10.1.11.2', u'dsport': 4789, u'dev': u't2s1if', u'tenant_route_ip': u'192.168.2.2', u'remote_route': u'10.2.11.0/24', u'subnet_route': u'10.1.11.0/24', u'v_name': u'vxlan_t2s1', u'id': 42, u'remote_ip': u'10.2.11.2'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec pns ip route show \"10.1.11.0/24\" via \"192.168.2.2\" | grep -w '^10.1.11.0/24' ; if [ $? -ne 0 ] ; then ip netns exec pns ip route add \"10.1.11.0/24\" via \"192.168.2.2\" ; fi\n", "delta": "0:00:00.108780", "end": "2019-11-17 10:22:51.351749", "item": [{"bridge_ip": "1.1.1.1", "bridge_name": "t2br1", "default_route_ip": "10.1.11.1", "dns": [{"brif": "t2s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t2s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns1", "route": [{"if": "p1", "ip": "10.1.11.1/24", "ns_if": "t2if", "ns_name": "t2"}], "tenant_ns": [{"tenant_ns_if": "t2ns1if", "tenant_ns_ip": "10.1.11.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s1if", "tenant_sub_ip": "10.1.11.2/24"}], "vms": [{"brif": "t2br1if1", "disk": "10G", "mem": 2, "name": "t2_VM1", "vcpu": 4, "vmif": "t2VM1if1"}, {"brif": "t2br1if2", "disk": "10G", "mem": 4, "name": "t2_VM2", "vcpu": 2, "vmif": "t2VM2if1"}]}, {"dev": "t2s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.11.2", "remote_ip": "10.2.11.2", "remote_route": "10.2.11.0/24", "subnet_route": "10.1.11.0/24", "tenant_route_ip": "192.168.2.2", "v_name": "vxlan_t2s1"}], "rc": 0, "start": "2019-11-17 10:22:51.242969", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}
skipping: [localhost] => (item=[{u'route': [{u'ip': u'10.1.12.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.1.12.1', u'bridge_name': u't2br2', u'dns': [{u'dnsif': u't2s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't2s2_dnsbrif'}], u'ns_name': u't2ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.12.2/24', u'tenant_ns_ip': u'10.1.12.1/24', u'tenant_ns_if': u't2ns2if', u'tenant_sub_if': u't2s2if', u'tenant_ns_name': u't2'}], u'bridge_ip': u'2.2.2.1', u'vms': [{u'mem': 3, u'name': u't2_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't2br2if1', u'vmif': u't2VM3if1'}]}, {u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}])  => {"ansible_loop_var": "item", "changed": false, "item": [{"bridge_ip": "2.2.2.1", "bridge_name": "t2br2", "default_route_ip": "10.1.12.1", "dns": [{"brif": "t2s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t2s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns2", "route": [{"if": "p1", "ip": "10.1.12.1/24", "ns_if": "t2if", "ns_name": "t2"}], "tenant_ns": [{"tenant_ns_if": "t2ns2if", "tenant_ns_ip": "10.1.12.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s2if", "tenant_sub_ip": "10.1.12.2/24"}], "vms": [{"brif": "t2br2if1", "disk": "10G", "mem": 3, "name": "t2_VM3", "vcpu": 2, "vmif": "t2VM3if1"}]}, {"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}], "skip_reason": "Conditional result was False"}

TASK [Get PNS ip address] ***********************************************************************************************************************************
changed: [99.99.99.2] => (item={u'default_route_ip': u'192.168.130.1', u'name': u't2', u'pns_ip': u'192.168.130.1/24', u'tenant_if': u't2if', u'tenant_ip': u'192.168.130.2/24', u'pns_if': u't2pns_if'}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip link show \"t2if\" ; if [ $? -ne 0 ] ; then ip link add \"t2if\" type veth peer name \"t2pns_if\" ; fi\n", "delta": "0:00:00.012261", "end": "2019-11-17 10:22:51.479095", "item": {"default_route_ip": "192.168.130.1", "name": "t2", "pns_if": "t2pns_if", "pns_ip": "192.168.130.1/24", "tenant_if": "t2if", "tenant_ip": "192.168.130.2/24"}, "rc": 0, "start": "2019-11-17 10:22:51.466834", "stderr": "Device \"t2if\" does not exist.", "stderr_lines": ["Device \"t2if\" does not exist."], "stdout": "", "stdout_lines": []}

TASK [Attach Tenant VETH Pairs] *****************************************************************************************************************************
ok: [localhost] => {"changed": false, "cmd": "ip netns exec pns ip addr show p1 | awk 'FNR==3{ print $2 }' | awk -F/ '{ print $1 }'\n", "delta": "0:00:00.051752", "end": "2019-11-17 10:22:51.691889", "rc": 0, "start": "2019-11-17 10:22:51.640137", "stderr": "", "stderr_lines": [], "stdout": "192.168.100.238", "stdout_lines": ["192.168.100.238"]}

TASK [Add VXLAN routes to host] *****************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.11.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.1.11.1', u'bridge_name': u't2br1', u'dns': [{u'dnsif': u't2s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't2s1_dnsbrif'}], u'ns_name': u't2ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.11.2/24', u'tenant_ns_ip': u'10.1.11.1/24', u'tenant_ns_if': u't2ns1if', u'tenant_sub_if': u't2s1if', u'tenant_ns_name': u't2'}], u'bridge_ip': u'1.1.1.1', u'vms': [{u'mem': 2, u'name': u't2_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't2br1if1', u'vmif': u't2VM1if1'}, {u'mem': 4, u'name': u't2_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't2br1if2', u'vmif': u't2VM2if1'}]}, {u'local_ip': u'10.1.11.2', u'dsport': 4789, u'dev': u't2s1if', u'tenant_route_ip': u'192.168.2.2', u'remote_route': u'10.2.11.0/24', u'subnet_route': u'10.1.11.0/24', u'v_name': u'vxlan_t2s1', u'id': 42, u'remote_ip': u'10.2.11.2'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip route show \"10.1.11.0/24\" via \"192.168.100.238\" | grep -w '^10.1.11.0/24' ; if [ $? -ne 0 ] ; then ip route add \"10.1.11.0/24\" via \"192.168.100.238\" ; fi\nip route show \"10.2.11.0/24\" via 99.99.99.2 | grep -w '^10.2.11.0/24'; if [ $? -ne 0 ] ; then ip route add \"10.2.11.0/24\" via 99.99.99.2 ; fi\n", "delta": "0:00:00.006916", "end": "2019-11-17 10:22:51.979905", "item": [{"bridge_ip": "1.1.1.1", "bridge_name": "t2br1", "default_route_ip": "10.1.11.1", "dns": [{"brif": "t2s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t2s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns1", "route": [{"if": "p1", "ip": "10.1.11.1/24", "ns_if": "t2if", "ns_name": "t2"}], "tenant_ns": [{"tenant_ns_if": "t2ns1if", "tenant_ns_ip": "10.1.11.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s1if", "tenant_sub_ip": "10.1.11.2/24"}], "vms": [{"brif": "t2br1if1", "disk": "10G", "mem": 2, "name": "t2_VM1", "vcpu": 4, "vmif": "t2VM1if1"}, {"brif": "t2br1if2", "disk": "10G", "mem": 4, "name": "t2_VM2", "vcpu": 2, "vmif": "t2VM2if1"}]}, {"dev": "t2s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.11.2", "remote_ip": "10.2.11.2", "remote_route": "10.2.11.0/24", "subnet_route": "10.1.11.0/24", "tenant_route_ip": "192.168.2.2", "v_name": "vxlan_t2s1"}], "rc": 0, "start": "2019-11-17 10:22:51.972989", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}
skipping: [localhost] => (item=[{u'route': [{u'ip': u'10.1.12.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.1.12.1', u'bridge_name': u't2br2', u'dns': [{u'dnsif': u't2s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't2s2_dnsbrif'}], u'ns_name': u't2ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.12.2/24', u'tenant_ns_ip': u'10.1.12.1/24', u'tenant_ns_if': u't2ns2if', u'tenant_sub_if': u't2s2if', u'tenant_ns_name': u't2'}], u'bridge_ip': u'2.2.2.1', u'vms': [{u'mem': 3, u'name': u't2_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't2br2if1', u'vmif': u't2VM3if1'}]}, {u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}])  => {"ansible_loop_var": "item", "changed": false, "item": [{"bridge_ip": "2.2.2.1", "bridge_name": "t2br2", "default_route_ip": "10.1.12.1", "dns": [{"brif": "t2s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t2s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns2", "route": [{"if": "p1", "ip": "10.1.12.1/24", "ns_if": "t2if", "ns_name": "t2"}], "tenant_ns": [{"tenant_ns_if": "t2ns2if", "tenant_ns_ip": "10.1.12.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s2if", "tenant_sub_ip": "10.1.12.2/24"}], "vms": [{"brif": "t2br2if1", "disk": "10G", "mem": 3, "name": "t2_VM3", "vcpu": 2, "vmif": "t2VM3if1"}]}, {"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}], "skip_reason": "Conditional result was False"}

PLAY RECAP **************************************************************************************************************************************************
localhost                  : ok=3    changed=2    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0   

changed: [99.99.99.2] => (item={u'default_route_ip': u'192.168.130.1', u'name': u't2', u'pns_ip': u'192.168.130.1/24', u'tenant_if': u't2if', u'tenant_ip': u'192.168.130.2/24', u'pns_if': u't2pns_if'}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec pns ip link show \"t2pns_if\" ; if [ $? -ne 0 ] ; then ip link set \"t2pns_if\" netns pns ; fi\nip netns exec \"t2\" ip link show \"t2if\" ; if [ $? -ne 0 ] ; then ip link set \"t2if\" netns \"t2\" ; fi\nip netns exec pns ip link set dev \"t2pns_if\" up\nip netns exec \"t2\" ip link set dev \"t2if\" up\n", "delta": "0:00:00.136540", "end": "2019-11-17 10:22:52.012464", "item": {"default_route_ip": "192.168.130.1", "name": "t2", "pns_if": "t2pns_if", "pns_ip": "192.168.130.1/24", "tenant_if": "t2if", "tenant_ip": "192.168.130.2/24"}, "rc": 0, "start": "2019-11-17 10:22:51.875924", "stderr": "", "stderr_lines": [], "stdout": "28: t2pns_if@if29: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP mode DEFAULT group default qlen 1000\n    link/ether 46:fe:05:eb:ba:00 brd ff:ff:ff:ff:ff:ff link-netnsid 2\n29: t2if@if28: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP mode DEFAULT group default qlen 1000\n    link/ether 56:83:77:92:79:c4 brd ff:ff:ff:ff:ff:ff link-netnsid 0", "stdout_lines": ["28: t2pns_if@if29: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP mode DEFAULT group default qlen 1000", "    link/ether 46:fe:05:eb:ba:00 brd ff:ff:ff:ff:ff:ff link-netnsid 2", "29: t2if@if28: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP mode DEFAULT group default qlen 1000", "    link/ether 56:83:77:92:79:c4 brd ff:ff:ff:ff:ff:ff link-netnsid 0"]}

TASK [Add IP addresses to Tenant VETH Pairs] ****************************************************************************************************************
Using /etc/ansible/ansible.cfg as config file
changed: [99.99.99.2] => (item={u'default_route_ip': u'192.168.130.1', u'name': u't2', u'pns_ip': u'192.168.130.1/24', u'tenant_if': u't2if', u'tenant_ip': u'192.168.130.2/24', u'pns_if': u't2pns_if'}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec pns ip addr show \"t2pns_if\" | awk 'FNR==3{ print $2 }' | grep -w '^192.168.130.1/24' ; if [ $? -ne 0 ] ; then ip netns exec pns ip addr add \"192.168.130.1/24\" dev \"t2pns_if\" ; fi\nip netns exec \"t2\" ip addr show \"t2if\" | awk 'FNR==3{ print $2 }' | grep -w '^192.168.130.2/24' ; if [ $? -ne 0 ] ; then ip netns exec \"t2\" ip addr add \"192.168.130.2/24\" dev \"t2if\" ; fi\n", "delta": "0:00:00.071621", "end": "2019-11-17 10:22:52.456669", "item": {"default_route_ip": "192.168.130.1", "name": "t2", "pns_if": "t2pns_if", "pns_ip": "192.168.130.1/24", "tenant_if": "t2if", "tenant_ip": "192.168.130.2/24"}, "rc": 0, "start": "2019-11-17 10:22:52.385048", "stderr": "", "stderr_lines": [], "stdout": "192.168.130.1/24\n192.168.130.2/24", "stdout_lines": ["192.168.130.1/24", "192.168.130.2/24"]}

TASK [Create Namespace VETH Pairs] **************************************************************************************************************************

PLAY [worker] ***********************************************************************************************************************************************

TASK [Add VXLAN routes in PNS] ******************************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.11.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.2.11.1', u'bridge_name': u't2br1', u'dns': [{u'dnsif': u't2s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't2s1_dnsbrif'}], u'ns_name': u't2ns1', u'bridge_ip': u'1.1.1.1', u'vms': [{u'mem': 2, u'name': u't2_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't2br1if1', u'vmif': u't2VM4if1'}], u'vxlan': [{u'local_ip': u'10.2.11.2', u'dsport': 4789, u'dev': u't2s1if', u'tenant_route_ip': u'192.168.130.2', u'remote_route': u'10.1.11.0/24', u'subnet_route': u'10.2.11.0/24', u'v_name': u'vxlan_t2s1', u'id': 42, u'remote_ip': u'10.1.11.2'}]}, {u'tenant_sub_ip': u'10.2.11.2/24', u'tenant_ns_ip': u'10.2.11.1/24', u'tenant_ns_if': u't2ns1if', u'tenant_sub_if': u't2s1if', u'tenant_ns_name': u't2'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip link show \"t2ns1if\" ; if [ $? -ne 0 ] ; then ip link add \"t2ns1if\" type veth peer name \"t2s1if\" ; fi\n", "delta": "0:00:00.013809", "end": "2019-11-17 10:22:52.890873", "item": [{"bridge_ip": "1.1.1.1", "bridge_name": "t2br1", "default_route_ip": "10.2.11.1", "dns": [{"brif": "t2s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t2s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns1", "route": [{"if": "p1", "ip": "10.2.11.1/24", "ns_if": "t2if", "ns_name": "t2"}], "vms": [{"brif": "t2br1if1", "disk": "10G", "mem": 2, "name": "t2_VM4", "vcpu": 4, "vmif": "t2VM4if1"}], "vxlan": [{"dev": "t2s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.11.2", "remote_ip": "10.1.11.2", "remote_route": "10.1.11.0/24", "subnet_route": "10.2.11.0/24", "tenant_route_ip": "192.168.130.2", "v_name": "vxlan_t2s1"}]}, {"tenant_ns_if": "t2ns1if", "tenant_ns_ip": "10.2.11.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s1if", "tenant_sub_ip": "10.2.11.2/24"}], "rc": 0, "start": "2019-11-17 10:22:52.877064", "stderr": "Device \"t2ns1if\" does not exist.", "stderr_lines": ["Device \"t2ns1if\" does not exist."], "stdout": "", "stdout_lines": []}

TASK [Attach Namespace VETH Pairs] **************************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.11.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.2.11.1', u'bridge_name': u't2br1', u'dns': [{u'dnsif': u't2s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't2s1_dnsbrif'}], u'ns_name': u't2ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.11.2/24', u'tenant_ns_ip': u'10.2.11.1/24', u'tenant_ns_if': u't2ns1if', u'tenant_sub_if': u't2s1if', u'tenant_ns_name': u't2'}], u'bridge_ip': u'1.1.1.1', u'vms': [{u'mem': 2, u'name': u't2_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't2br1if1', u'vmif': u't2VM4if1'}]}, {u'local_ip': u'10.2.11.2', u'dsport': 4789, u'dev': u't2s1if', u'tenant_route_ip': u'192.168.130.2', u'remote_route': u'10.1.11.0/24', u'subnet_route': u'10.2.11.0/24', u'v_name': u'vxlan_t2s1', u'id': 42, u'remote_ip': u'10.1.11.2'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec pns ip route show \"10.2.11.0/24\" via \"192.168.130.2\" | grep -w '^10.2.11.0/24' ; if [ $? -ne 0 ] ; then ip netns exec pns ip route add \"10.2.11.0/24\" via \"192.168.130.2\" ; fi\n", "delta": "0:00:00.072428", "end": "2019-11-17 10:22:53.176348", "item": [{"bridge_ip": "1.1.1.1", "bridge_name": "t2br1", "default_route_ip": "10.2.11.1", "dns": [{"brif": "t2s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t2s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns1", "route": [{"if": "p1", "ip": "10.2.11.1/24", "ns_if": "t2if", "ns_name": "t2"}], "tenant_ns": [{"tenant_ns_if": "t2ns1if", "tenant_ns_ip": "10.2.11.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s1if", "tenant_sub_ip": "10.2.11.2/24"}], "vms": [{"brif": "t2br1if1", "disk": "10G", "mem": 2, "name": "t2_VM4", "vcpu": 4, "vmif": "t2VM4if1"}]}, {"dev": "t2s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.11.2", "remote_ip": "10.1.11.2", "remote_route": "10.1.11.0/24", "subnet_route": "10.2.11.0/24", "tenant_route_ip": "192.168.130.2", "v_name": "vxlan_t2s1"}], "rc": 0, "start": "2019-11-17 10:22:53.103920", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Get PNS ip address] ***********************************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.11.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.2.11.1', u'bridge_name': u't2br1', u'dns': [{u'dnsif': u't2s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't2s1_dnsbrif'}], u'ns_name': u't2ns1', u'bridge_ip': u'1.1.1.1', u'vms': [{u'mem': 2, u'name': u't2_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't2br1if1', u'vmif': u't2VM4if1'}], u'vxlan': [{u'local_ip': u'10.2.11.2', u'dsport': 4789, u'dev': u't2s1if', u'tenant_route_ip': u'192.168.130.2', u'remote_route': u'10.1.11.0/24', u'subnet_route': u'10.2.11.0/24', u'v_name': u'vxlan_t2s1', u'id': 42, u'remote_ip': u'10.1.11.2'}]}, {u'tenant_sub_ip': u'10.2.11.2/24', u'tenant_ns_ip': u'10.2.11.1/24', u'tenant_ns_if': u't2ns1if', u'tenant_sub_if': u't2s1if', u'tenant_ns_name': u't2'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t2\" ip link show \"t2ns1if\" ; if [ $? -ne 0 ] ; then ip link set \"t2ns1if\" netns \"t2\" ; fi\nip netns exec \"t2ns1\" ip link show \"t2s1if\" ; if [ $? -ne 0 ] ; then ip link set \"t2s1if\" netns \"t2ns1\" ; fi\n", "delta": "0:00:00.078397", "end": "2019-11-17 10:22:53.376346", "item": [{"bridge_ip": "1.1.1.1", "bridge_name": "t2br1", "default_route_ip": "10.2.11.1", "dns": [{"brif": "t2s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t2s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns1", "route": [{"if": "p1", "ip": "10.2.11.1/24", "ns_if": "t2if", "ns_name": "t2"}], "vms": [{"brif": "t2br1if1", "disk": "10G", "mem": 2, "name": "t2_VM4", "vcpu": 4, "vmif": "t2VM4if1"}], "vxlan": [{"dev": "t2s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.11.2", "remote_ip": "10.1.11.2", "remote_route": "10.1.11.0/24", "subnet_route": "10.2.11.0/24", "tenant_route_ip": "192.168.130.2", "v_name": "vxlan_t2s1"}]}, {"tenant_ns_if": "t2ns1if", "tenant_ns_ip": "10.2.11.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s1if", "tenant_sub_ip": "10.2.11.2/24"}], "rc": 0, "start": "2019-11-17 10:22:53.297949", "stderr": "", "stderr_lines": [], "stdout": "31: t2ns1if@if30: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP mode DEFAULT group default qlen 1000\n    link/ether 0a:81:60:0f:ab:29 brd ff:ff:ff:ff:ff:ff link-netnsid 2\n30: t2s1if@if31: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP mode DEFAULT group default qlen 1000\n    link/ether 12:f8:44:97:20:88 brd ff:ff:ff:ff:ff:ff link-netnsid 0", "stdout_lines": ["31: t2ns1if@if30: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP mode DEFAULT group default qlen 1000", "    link/ether 0a:81:60:0f:ab:29 brd ff:ff:ff:ff:ff:ff link-netnsid 2", "30: t2s1if@if31: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP mode DEFAULT group default qlen 1000", "    link/ether 12:f8:44:97:20:88 brd ff:ff:ff:ff:ff:ff link-netnsid 0"]}

TASK [Set Namespace VETH Pairs UP] **************************************************************************************************************************
ok: [99.99.99.2] => {"changed": false, "cmd": "ip netns exec pns ip addr show p1 | awk 'FNR==3{ print $2 }' | awk -F/ '{ print $1 }'\n", "delta": "0:00:00.033960", "end": "2019-11-17 10:22:53.584675", "rc": 0, "start": "2019-11-17 10:22:53.550715", "stderr": "", "stderr_lines": [], "stdout": "192.168.100.50", "stdout_lines": ["192.168.100.50"]}

TASK [Add VXLAN routes to host] *****************************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.11.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.2.11.1', u'bridge_name': u't2br1', u'dns': [{u'dnsif': u't2s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't2s1_dnsbrif'}], u'ns_name': u't2ns1', u'bridge_ip': u'1.1.1.1', u'vms': [{u'mem': 2, u'name': u't2_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't2br1if1', u'vmif': u't2VM4if1'}], u'vxlan': [{u'local_ip': u'10.2.11.2', u'dsport': 4789, u'dev': u't2s1if', u'tenant_route_ip': u'192.168.130.2', u'remote_route': u'10.1.11.0/24', u'subnet_route': u'10.2.11.0/24', u'v_name': u'vxlan_t2s1', u'id': 42, u'remote_ip': u'10.1.11.2'}]}, {u'tenant_sub_ip': u'10.2.11.2/24', u'tenant_ns_ip': u'10.2.11.1/24', u'tenant_ns_if': u't2ns1if', u'tenant_sub_if': u't2s1if', u'tenant_ns_name': u't2'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t2\" ip link set dev \"t2ns1if\" up\nip netns exec \"t2ns1\" ip link set dev \"t2s1if\" up\n", "delta": "0:00:00.087044", "end": "2019-11-17 10:22:53.864244", "item": [{"bridge_ip": "1.1.1.1", "bridge_name": "t2br1", "default_route_ip": "10.2.11.1", "dns": [{"brif": "t2s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t2s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns1", "route": [{"if": "p1", "ip": "10.2.11.1/24", "ns_if": "t2if", "ns_name": "t2"}], "vms": [{"brif": "t2br1if1", "disk": "10G", "mem": 2, "name": "t2_VM4", "vcpu": 4, "vmif": "t2VM4if1"}], "vxlan": [{"dev": "t2s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.11.2", "remote_ip": "10.1.11.2", "remote_route": "10.1.11.0/24", "subnet_route": "10.2.11.0/24", "tenant_route_ip": "192.168.130.2", "v_name": "vxlan_t2s1"}]}, {"tenant_ns_if": "t2ns1if", "tenant_ns_ip": "10.2.11.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s1if", "tenant_sub_ip": "10.2.11.2/24"}], "rc": 0, "start": "2019-11-17 10:22:53.777200", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Add IP addresses to Namespace VETH Pairs] *************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.11.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.2.11.1', u'bridge_name': u't2br1', u'dns': [{u'dnsif': u't2s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't2s1_dnsbrif'}], u'ns_name': u't2ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.11.2/24', u'tenant_ns_ip': u'10.2.11.1/24', u'tenant_ns_if': u't2ns1if', u'tenant_sub_if': u't2s1if', u'tenant_ns_name': u't2'}], u'bridge_ip': u'1.1.1.1', u'vms': [{u'mem': 2, u'name': u't2_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't2br1if1', u'vmif': u't2VM4if1'}]}, {u'local_ip': u'10.2.11.2', u'dsport': 4789, u'dev': u't2s1if', u'tenant_route_ip': u'192.168.130.2', u'remote_route': u'10.1.11.0/24', u'subnet_route': u'10.2.11.0/24', u'v_name': u'vxlan_t2s1', u'id': 42, u'remote_ip': u'10.1.11.2'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip route show \"10.2.11.0/24\" via \"192.168.100.50\" | grep -w '^10.2.11.0/24' ; if [ $? -ne 0 ] ; then ip route add \"10.2.11.0/24\" via \"192.168.100.50\" ; fi\nip route show \"10.1.11.0/24\" via 99.99.99.1 | grep -w '^10.1.11.0/24'; if [ $? -ne 0 ] ; then ip route add \"10.1.11.0/24\" via 99.99.99.1 ; fi\n", "delta": "0:00:00.007924", "end": "2019-11-17 10:22:54.000005", "item": [{"bridge_ip": "1.1.1.1", "bridge_name": "t2br1", "default_route_ip": "10.2.11.1", "dns": [{"brif": "t2s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t2s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns1", "route": [{"if": "p1", "ip": "10.2.11.1/24", "ns_if": "t2if", "ns_name": "t2"}], "tenant_ns": [{"tenant_ns_if": "t2ns1if", "tenant_ns_ip": "10.2.11.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s1if", "tenant_sub_ip": "10.2.11.2/24"}], "vms": [{"brif": "t2br1if1", "disk": "10G", "mem": 2, "name": "t2_VM4", "vcpu": 4, "vmif": "t2VM4if1"}]}, {"dev": "t2s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.11.2", "remote_ip": "10.1.11.2", "remote_route": "10.1.11.0/24", "subnet_route": "10.2.11.0/24", "tenant_route_ip": "192.168.130.2", "v_name": "vxlan_t2s1"}], "rc": 0, "start": "2019-11-17 10:22:53.992081", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

PLAY RECAP **************************************************************************************************************************************************
99.99.99.2                 : ok=3    changed=2    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0   

changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.11.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.2.11.1', u'bridge_name': u't2br1', u'dns': [{u'dnsif': u't2s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't2s1_dnsbrif'}], u'ns_name': u't2ns1', u'bridge_ip': u'1.1.1.1', u'vms': [{u'mem': 2, u'name': u't2_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't2br1if1', u'vmif': u't2VM4if1'}], u'vxlan': [{u'local_ip': u'10.2.11.2', u'dsport': 4789, u'dev': u't2s1if', u'tenant_route_ip': u'192.168.130.2', u'remote_route': u'10.1.11.0/24', u'subnet_route': u'10.2.11.0/24', u'v_name': u'vxlan_t2s1', u'id': 42, u'remote_ip': u'10.1.11.2'}]}, {u'tenant_sub_ip': u'10.2.11.2/24', u'tenant_ns_ip': u'10.2.11.1/24', u'tenant_ns_if': u't2ns1if', u'tenant_sub_if': u't2s1if', u'tenant_ns_name': u't2'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t2ns1\" ip addr show \"t2s1if\" | awk 'FNR==3{ print $2 }' | grep -w '^10.2.11.2/24' ; if [ $? -ne 0 ] ; then ip netns exec \"t2ns1\" ip addr add \"10.2.11.2/24\" dev \"t2s1if\" ; fi\n\nip netns exec \"t2\" ip addr show \"t2ns1if\" | awk 'FNR==3{ print $2 }' | grep -w '^10.2.11.1/24' ; if [ $? -ne 0 ] ; then ip netns exec \"t2\" ip addr add \"10.2.11.1/24\" dev \"t2ns1if\" ; fi\n", "delta": "0:00:00.073210", "end": "2019-11-17 10:22:54.340673", "item": [{"bridge_ip": "1.1.1.1", "bridge_name": "t2br1", "default_route_ip": "10.2.11.1", "dns": [{"brif": "t2s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t2s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns1", "route": [{"if": "p1", "ip": "10.2.11.1/24", "ns_if": "t2if", "ns_name": "t2"}], "vms": [{"brif": "t2br1if1", "disk": "10G", "mem": 2, "name": "t2_VM4", "vcpu": 4, "vmif": "t2VM4if1"}], "vxlan": [{"dev": "t2s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.11.2", "remote_ip": "10.1.11.2", "remote_route": "10.1.11.0/24", "subnet_route": "10.2.11.0/24", "tenant_route_ip": "192.168.130.2", "v_name": "vxlan_t2s1"}]}, {"tenant_ns_if": "t2ns1if", "tenant_ns_ip": "10.2.11.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s1if", "tenant_sub_ip": "10.2.11.2/24"}], "rc": 0, "start": "2019-11-17 10:22:54.267463", "stderr": "", "stderr_lines": [], "stdout": "10.2.11.2/24\n10.2.11.1/24", "stdout_lines": ["10.2.11.2/24", "10.2.11.1/24"]}

TASK [Add IP Route to Tenant] *******************************************************************************************************************************
Using /etc/ansible/ansible.cfg as config file

PLAY [main] *************************************************************************************************************************************************

TASK [Create VM templates (C1)] *****************************************************************************************************************************
changed: [99.99.99.2] => (item={u'default_route_ip': u'192.168.130.1', u'name': u't2', u'pns_ip': u'192.168.130.1/24', u'tenant_if': u't2if', u'tenant_ip': u'192.168.130.2/24', u'pns_if': u't2pns_if'}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t2\" ip route show default | grep -w '[d]efault via 192.168.130.1' ; if [ $? -ne 0 ] ; then ip netns exec \"t2\" ip route add default via \"192.168.130.1\" ; fi\n", "delta": "0:00:00.036232", "end": "2019-11-17 10:22:54.748636", "item": {"default_route_ip": "192.168.130.1", "name": "t2", "pns_if": "t2pns_if", "pns_ip": "192.168.130.1/24", "tenant_if": "t2if", "tenant_ip": "192.168.130.2/24"}, "rc": 0, "start": "2019-11-17 10:22:54.712404", "stderr": "", "stderr_lines": [], "stdout": "default via 192.168.130.1 dev t2if ", "stdout_lines": ["default via 192.168.130.1 dev t2if "]}

TASK [Add IP Route to Tenant Subnet] ************************************************************************************************************************
changed: [99.99.99.2] => (item={u'route': [{u'ip': u'10.2.11.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.2.11.1', u'bridge_name': u't2br1', u'dns': [{u'dnsif': u't2s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't2s1_dnsbrif'}], u'ns_name': u't2ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.11.2/24', u'tenant_ns_ip': u'10.2.11.1/24', u'tenant_ns_if': u't2ns1if', u'tenant_ns_name': u't2', u'tenant_sub_if': u't2s1if'}], u'bridge_ip': u'1.1.1.1', u'vms': [{u'mem': 2, u'name': u't2_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't2br1if1', u'vmif': u't2VM4if1'}], u'vxlan': [{u'local_ip': u'10.2.11.2', u'tenant_route_ip': u'192.168.130.2', u'dsport': 4789, u'dev': u't2s1if', u'subnet_route': u'10.2.11.0/24', u'remote_route': u'10.1.11.0/24', u'v_name': u'vxlan_t2s1', u'id': 42, u'remote_ip': u'10.1.11.2'}]}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t2ns1\" ip route show default | grep -w '[d]efault via 10.2.11.1' ; if [ $? -ne 0 ] ; then ip netns exec \"t2ns1\" ip route add default via \"10.2.11.1\" ; fi\n", "delta": "0:00:00.032772", "end": "2019-11-17 10:22:55.148427", "item": {"bridge_ip": "1.1.1.1", "bridge_name": "t2br1", "default_route_ip": "10.2.11.1", "dns": [{"brif": "t2s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t2s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns1", "route": [{"if": "p1", "ip": "10.2.11.1/24", "ns_if": "t2if", "ns_name": "t2"}], "tenant_ns": [{"tenant_ns_if": "t2ns1if", "tenant_ns_ip": "10.2.11.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s1if", "tenant_sub_ip": "10.2.11.2/24"}], "vms": [{"brif": "t2br1if1", "disk": "10G", "mem": 2, "name": "t2_VM4", "vcpu": 4, "vmif": "t2VM4if1"}], "vxlan": [{"dev": "t2s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.11.2", "remote_ip": "10.1.11.2", "remote_route": "10.1.11.0/24", "subnet_route": "10.2.11.0/24", "tenant_route_ip": "192.168.130.2", "v_name": "vxlan_t2s1"}]}, "rc": 0, "start": "2019-11-17 10:22:55.115655", "stderr": "", "stderr_lines": [], "stdout": "default via 10.2.11.1 dev t2s1if ", "stdout_lines": ["default via 10.2.11.1 dev t2s1if "]}

TASK [Create bridge inside namespace] ***********************************************************************************************************************
ok: [localhost] => (item=[{u'route': [{u'ip': u'10.1.11.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.1.11.1', u'bridge_name': u't2br1', u'dns': [{u'dnsif': u't2s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't2s1_dnsbrif'}], u'ns_name': u't2ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.11.2/24', u'tenant_ns_ip': u'10.1.11.1/24', u'tenant_ns_if': u't2ns1if', u'tenant_sub_if': u't2s1if', u'tenant_ns_name': u't2'}], u'bridge_ip': u'1.1.1.1', u'vxlan': [{u'local_ip': u'10.1.11.2', u'dsport': 4789, u'dev': u't2s1if', u'tenant_route_ip': u'192.168.2.2', u'remote_route': u'10.2.11.0/24', u'subnet_route': u'10.1.11.0/24', u'v_name': u'vxlan_t2s1', u'id': 42, u'remote_ip': u'10.2.11.2'}]}, {u'mem': 2, u'name': u't2_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't2br1if1', u'vmif': u't2VM1if1'}]) => {"ansible_loop_var": "item", "changed": false, "checksum": "350ba870bd31b7f6ee517845c14237910b5af0bf", "dest": "/root/Migration-as-a-Service/t2/VM_templates/t2_VM1.xml.j2", "gid": 0, "group": "root", "item": [{"bridge_ip": "1.1.1.1", "bridge_name": "t2br1", "default_route_ip": "10.1.11.1", "dns": [{"brif": "t2s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t2s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns1", "route": [{"if": "p1", "ip": "10.1.11.1/24", "ns_if": "t2if", "ns_name": "t2"}], "tenant_ns": [{"tenant_ns_if": "t2ns1if", "tenant_ns_ip": "10.1.11.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s1if", "tenant_sub_ip": "10.1.11.2/24"}], "vxlan": [{"dev": "t2s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.11.2", "remote_ip": "10.2.11.2", "remote_route": "10.2.11.0/24", "subnet_route": "10.1.11.0/24", "tenant_route_ip": "192.168.2.2", "v_name": "vxlan_t2s1"}]}, {"brif": "t2br1if1", "disk": "10G", "mem": 2, "name": "t2_VM1", "vcpu": 4, "vmif": "t2VM1if1"}], "mode": "0644", "owner": "root", "path": "/root/Migration-as-a-Service/t2/VM_templates/t2_VM1.xml.j2", "size": 4091, "state": "file", "uid": 0}
ok: [localhost] => (item=[{u'route': [{u'ip': u'10.1.11.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.1.11.1', u'bridge_name': u't2br1', u'dns': [{u'dnsif': u't2s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't2s1_dnsbrif'}], u'ns_name': u't2ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.11.2/24', u'tenant_ns_ip': u'10.1.11.1/24', u'tenant_ns_if': u't2ns1if', u'tenant_sub_if': u't2s1if', u'tenant_ns_name': u't2'}], u'bridge_ip': u'1.1.1.1', u'vxlan': [{u'local_ip': u'10.1.11.2', u'dsport': 4789, u'dev': u't2s1if', u'tenant_route_ip': u'192.168.2.2', u'remote_route': u'10.2.11.0/24', u'subnet_route': u'10.1.11.0/24', u'v_name': u'vxlan_t2s1', u'id': 42, u'remote_ip': u'10.2.11.2'}]}, {u'mem': 4, u'name': u't2_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't2br1if2', u'vmif': u't2VM2if1'}]) => {"ansible_loop_var": "item", "changed": false, "checksum": "350ba870bd31b7f6ee517845c14237910b5af0bf", "dest": "/root/Migration-as-a-Service/t2/VM_templates/t2_VM2.xml.j2", "gid": 0, "group": "root", "item": [{"bridge_ip": "1.1.1.1", "bridge_name": "t2br1", "default_route_ip": "10.1.11.1", "dns": [{"brif": "t2s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t2s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns1", "route": [{"if": "p1", "ip": "10.1.11.1/24", "ns_if": "t2if", "ns_name": "t2"}], "tenant_ns": [{"tenant_ns_if": "t2ns1if", "tenant_ns_ip": "10.1.11.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s1if", "tenant_sub_ip": "10.1.11.2/24"}], "vxlan": [{"dev": "t2s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.11.2", "remote_ip": "10.2.11.2", "remote_route": "10.2.11.0/24", "subnet_route": "10.1.11.0/24", "tenant_route_ip": "192.168.2.2", "v_name": "vxlan_t2s1"}]}, {"brif": "t2br1if2", "disk": "10G", "mem": 4, "name": "t2_VM2", "vcpu": 2, "vmif": "t2VM2if1"}], "mode": "0644", "owner": "root", "path": "/root/Migration-as-a-Service/t2/VM_templates/t2_VM2.xml.j2", "size": 4091, "state": "file", "uid": 0}
changed: [99.99.99.2] => (item={u'route': [{u'ip': u'10.2.11.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.2.11.1', u'bridge_name': u't2br1', u'dns': [{u'dnsif': u't2s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't2s1_dnsbrif'}], u'ns_name': u't2ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.11.2/24', u'tenant_ns_ip': u'10.2.11.1/24', u'tenant_ns_if': u't2ns1if', u'tenant_ns_name': u't2', u'tenant_sub_if': u't2s1if'}], u'bridge_ip': u'1.1.1.1', u'vms': [{u'mem': 2, u'name': u't2_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't2br1if1', u'vmif': u't2VM4if1'}], u'vxlan': [{u'local_ip': u'10.2.11.2', u'tenant_route_ip': u'192.168.130.2', u'dsport': 4789, u'dev': u't2s1if', u'subnet_route': u'10.2.11.0/24', u'remote_route': u'10.1.11.0/24', u'v_name': u'vxlan_t2s1', u'id': 42, u'remote_ip': u'10.1.11.2'}]}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t2ns1\" brctl show | grep -w '^t2br1'; if [ $? -ne 0 ] ; then ip netns exec \"t2ns1\" brctl addbr \"t2br1\" ; fi\nip netns exec \"t2ns1\" ip link set dev \"t2br1\" up\n", "delta": "0:00:00.080337", "end": "2019-11-17 10:22:55.624463", "item": {"bridge_ip": "1.1.1.1", "bridge_name": "t2br1", "default_route_ip": "10.2.11.1", "dns": [{"brif": "t2s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t2s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns1", "route": [{"if": "p1", "ip": "10.2.11.1/24", "ns_if": "t2if", "ns_name": "t2"}], "tenant_ns": [{"tenant_ns_if": "t2ns1if", "tenant_ns_ip": "10.2.11.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s1if", "tenant_sub_ip": "10.2.11.2/24"}], "vms": [{"brif": "t2br1if1", "disk": "10G", "mem": 2, "name": "t2_VM4", "vcpu": 4, "vmif": "t2VM4if1"}], "vxlan": [{"dev": "t2s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.11.2", "remote_ip": "10.1.11.2", "remote_route": "10.1.11.0/24", "subnet_route": "10.2.11.0/24", "tenant_route_ip": "192.168.130.2", "v_name": "vxlan_t2s1"}]}, "rc": 0, "start": "2019-11-17 10:22:55.544126", "stderr": "", "stderr_lines": [], "stdout": "t2br1\t\t8000.76fc12e1f29f\tno\t\tt2br1if1", "stdout_lines": ["t2br1\t\t8000.76fc12e1f29f\tno\t\tt2br1if1"]}

TASK [Create DNS VETH Pair] *********************************************************************************************************************************
ok: [localhost] => (item=[{u'route': [{u'ip': u'10.1.12.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.1.12.1', u'bridge_name': u't2br2', u'dns': [{u'dnsif': u't2s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't2s2_dnsbrif'}], u'ns_name': u't2ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.12.2/24', u'tenant_ns_ip': u'10.1.12.1/24', u'tenant_ns_if': u't2ns2if', u'tenant_sub_if': u't2s2if', u'tenant_ns_name': u't2'}], u'bridge_ip': u'2.2.2.1', u'vxlan': [{u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}, {u'mem': 3, u'name': u't2_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't2br2if1', u'vmif': u't2VM3if1'}]) => {"ansible_loop_var": "item", "changed": false, "checksum": "350ba870bd31b7f6ee517845c14237910b5af0bf", "dest": "/root/Migration-as-a-Service/t2/VM_templates/t2_VM3.xml.j2", "gid": 0, "group": "root", "item": [{"bridge_ip": "2.2.2.1", "bridge_name": "t2br2", "default_route_ip": "10.1.12.1", "dns": [{"brif": "t2s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t2s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns2", "route": [{"if": "p1", "ip": "10.1.12.1/24", "ns_if": "t2if", "ns_name": "t2"}], "tenant_ns": [{"tenant_ns_if": "t2ns2if", "tenant_ns_ip": "10.1.12.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s2if", "tenant_sub_ip": "10.1.12.2/24"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, {"brif": "t2br2if1", "disk": "10G", "mem": 3, "name": "t2_VM3", "vcpu": 2, "vmif": "t2VM3if1"}], "mode": "0644", "owner": "root", "path": "/root/Migration-as-a-Service/t2/VM_templates/t2_VM3.xml.j2", "size": 4091, "state": "file", "uid": 0}

PLAY RECAP **************************************************************************************************************************************************
localhost                  : ok=1    changed=0    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0   

Using /etc/ansible/ansible.cfg as config file
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.11.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.2.11.1', u'bridge_name': u't2br1', u'ns_name': u't2ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.11.2/24', u'tenant_ns_ip': u'10.2.11.1/24', u'tenant_ns_if': u't2ns1if', u'tenant_sub_if': u't2s1if', u'tenant_ns_name': u't2'}], u'bridge_ip': u'1.1.1.1', u'vms': [{u'mem': 2, u'name': u't2_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't2br1if1', u'vmif': u't2VM4if1'}], u'vxlan': [{u'local_ip': u'10.2.11.2', u'dsport': 4789, u'dev': u't2s1if', u'tenant_route_ip': u'192.168.130.2', u'remote_route': u'10.1.11.0/24', u'subnet_route': u'10.2.11.0/24', u'v_name': u'vxlan_t2s1', u'id': 42, u'remote_ip': u'10.1.11.2'}]}, {u'dnsif': u't2s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't2s1_dnsbrif'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t2ns1\" ip link show \"t2s1_dnsbrif\" ; if [ $? -ne 0 ] ; then ip netns exec \"t2ns1\" ip link add \"t2s1_dnsbrif\" type veth peer name \"t2s1_dnsif\" ; fi\nip netns exec \"t2ns1\" ip link set dev \"t2s1_dnsbrif\" up\nip netns exec \"t2ns1\" ip link set dev \"t2s1_dnsif\" up\n", "delta": "0:00:00.110738", "end": "2019-11-17 10:22:56.108649", "item": [{"bridge_ip": "1.1.1.1", "bridge_name": "t2br1", "default_route_ip": "10.2.11.1", "ns_name": "t2ns1", "route": [{"if": "p1", "ip": "10.2.11.1/24", "ns_if": "t2if", "ns_name": "t2"}], "tenant_ns": [{"tenant_ns_if": "t2ns1if", "tenant_ns_ip": "10.2.11.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s1if", "tenant_sub_ip": "10.2.11.2/24"}], "vms": [{"brif": "t2br1if1", "disk": "10G", "mem": 2, "name": "t2_VM4", "vcpu": 4, "vmif": "t2VM4if1"}], "vxlan": [{"dev": "t2s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.11.2", "remote_ip": "10.1.11.2", "remote_route": "10.1.11.0/24", "subnet_route": "10.2.11.0/24", "tenant_route_ip": "192.168.130.2", "v_name": "vxlan_t2s1"}]}, {"brif": "t2s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t2s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "rc": 0, "start": "2019-11-17 10:22:55.997911", "stderr": "", "stderr_lines": [], "stdout": "4: t2s1_dnsbrif@t2s1_dnsif: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue master t2br1 state UP mode DEFAULT group default qlen 1000\n    link/ether 86:c8:40:fc:37:45 brd ff:ff:ff:ff:ff:ff", "stdout_lines": ["4: t2s1_dnsbrif@t2s1_dnsif: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue master t2br1 state UP mode DEFAULT group default qlen 1000", "    link/ether 86:c8:40:fc:37:45 brd ff:ff:ff:ff:ff:ff"]}

TASK [Attach DNS VETH Pair] *********************************************************************************************************************************

PLAY [main] *************************************************************************************************************************************************

TASK [Create VM templates (C2)] *****************************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.11.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.2.11.1', u'bridge_name': u't2br1', u'ns_name': u't2ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.11.2/24', u'tenant_ns_ip': u'10.2.11.1/24', u'tenant_ns_if': u't2ns1if', u'tenant_sub_if': u't2s1if', u'tenant_ns_name': u't2'}], u'bridge_ip': u'1.1.1.1', u'vms': [{u'mem': 2, u'name': u't2_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't2br1if1', u'vmif': u't2VM4if1'}], u'vxlan': [{u'local_ip': u'10.2.11.2', u'dsport': 4789, u'dev': u't2s1if', u'tenant_route_ip': u'192.168.130.2', u'remote_route': u'10.1.11.0/24', u'subnet_route': u'10.2.11.0/24', u'v_name': u'vxlan_t2s1', u'id': 42, u'remote_ip': u'10.1.11.2'}]}, {u'dnsif': u't2s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't2s1_dnsbrif'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t2ns1\" brctl show \"t2br1\" | grep -w 't2s1_dnsbrif' ; if [ $? -ne 0 ] ; then ip netns exec \"t2ns1\" brctl addif \"t2br1\" \"t2s1_dnsbrif\" ; fi\n", "delta": "0:00:00.034293", "end": "2019-11-17 10:22:56.512815", "item": [{"bridge_ip": "1.1.1.1", "bridge_name": "t2br1", "default_route_ip": "10.2.11.1", "ns_name": "t2ns1", "route": [{"if": "p1", "ip": "10.2.11.1/24", "ns_if": "t2if", "ns_name": "t2"}], "tenant_ns": [{"tenant_ns_if": "t2ns1if", "tenant_ns_ip": "10.2.11.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s1if", "tenant_sub_ip": "10.2.11.2/24"}], "vms": [{"brif": "t2br1if1", "disk": "10G", "mem": 2, "name": "t2_VM4", "vcpu": 4, "vmif": "t2VM4if1"}], "vxlan": [{"dev": "t2s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.11.2", "remote_ip": "10.1.11.2", "remote_route": "10.1.11.0/24", "subnet_route": "10.2.11.0/24", "tenant_route_ip": "192.168.130.2", "v_name": "vxlan_t2s1"}]}, {"brif": "t2s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t2s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "rc": 0, "start": "2019-11-17 10:22:56.478522", "stderr": "", "stderr_lines": [], "stdout": "\t\t\t\t\t\t\tt2s1_dnsbrif", "stdout_lines": ["\t\t\t\t\t\t\tt2s1_dnsbrif"]}

TASK [Create VETH Pairs] ************************************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.11.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.2.11.1', u'bridge_name': u't2br1', u'dns': [{u'dnsif': u't2s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't2s1_dnsbrif'}], u'ns_name': u't2ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.11.2/24', u'tenant_ns_ip': u'10.2.11.1/24', u'tenant_ns_if': u't2ns1if', u'tenant_sub_if': u't2s1if', u'tenant_ns_name': u't2'}], u'bridge_ip': u'1.1.1.1', u'vxlan': [{u'local_ip': u'10.2.11.2', u'dsport': 4789, u'dev': u't2s1if', u'tenant_route_ip': u'192.168.130.2', u'remote_route': u'10.1.11.0/24', u'subnet_route': u'10.2.11.0/24', u'v_name': u'vxlan_t2s1', u'id': 42, u'remote_ip': u'10.1.11.2'}]}, {u'mem': 2, u'name': u't2_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't2br1if1', u'vmif': u't2VM4if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip link show \"t2br1if1\" ; if [ $? -ne 0 ] ; then ip link add \"t2VM4if1\" type veth peer name \"t2br1if1\" ; fi\nip link set dev \"t2br1if1\" up\nip link set dev \"t2VM4if1\" up\n", "delta": "0:00:00.014382", "end": "2019-11-17 10:22:56.915174", "item": [{"bridge_ip": "1.1.1.1", "bridge_name": "t2br1", "default_route_ip": "10.2.11.1", "dns": [{"brif": "t2s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t2s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns1", "route": [{"if": "p1", "ip": "10.2.11.1/24", "ns_if": "t2if", "ns_name": "t2"}], "tenant_ns": [{"tenant_ns_if": "t2ns1if", "tenant_ns_ip": "10.2.11.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s1if", "tenant_sub_ip": "10.2.11.2/24"}], "vxlan": [{"dev": "t2s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.11.2", "remote_ip": "10.1.11.2", "remote_route": "10.1.11.0/24", "subnet_route": "10.2.11.0/24", "tenant_route_ip": "192.168.130.2", "v_name": "vxlan_t2s1"}]}, {"brif": "t2br1if1", "disk": "10G", "mem": 2, "name": "t2_VM4", "vcpu": 4, "vmif": "t2VM4if1"}], "rc": 0, "start": "2019-11-17 10:22:56.900792", "stderr": "Device \"t2br1if1\" does not exist.\nRTNETLINK answers: File exists\nCannot find device \"t2br1if1\"", "stderr_lines": ["Device \"t2br1if1\" does not exist.", "RTNETLINK answers: File exists", "Cannot find device \"t2br1if1\""], "stdout": "", "stdout_lines": []}

TASK [Attach VETH Pairs] ************************************************************************************************************************************
ok: [localhost] => (item=[{u'route': [{u'ip': u'10.2.11.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.2.11.1', u'bridge_name': u't2br1', u'dns': [{u'dnsif': u't2s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't2s1_dnsbrif'}], u'ns_name': u't2ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.11.2/24', u'tenant_ns_ip': u'10.2.11.1/24', u'tenant_ns_if': u't2ns1if', u'tenant_sub_if': u't2s1if', u'tenant_ns_name': u't2'}], u'bridge_ip': u'1.1.1.1', u'vxlan': [{u'local_ip': u'10.2.11.2', u'dsport': 4789, u'dev': u't2s1if', u'tenant_route_ip': u'192.168.130.2', u'remote_route': u'10.1.11.0/24', u'subnet_route': u'10.2.11.0/24', u'v_name': u'vxlan_t2s1', u'id': 42, u'remote_ip': u'10.1.11.2'}]}, {u'mem': 2, u'name': u't2_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't2br1if1', u'vmif': u't2VM4if1'}]) => {"ansible_loop_var": "item", "changed": false, "checksum": "350ba870bd31b7f6ee517845c14237910b5af0bf", "dest": "/root/Migration-as-a-Service/t2/VM_templates/t2_VM4.xml.j2", "gid": 0, "group": "root", "item": [{"bridge_ip": "1.1.1.1", "bridge_name": "t2br1", "default_route_ip": "10.2.11.1", "dns": [{"brif": "t2s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t2s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns1", "route": [{"if": "p1", "ip": "10.2.11.1/24", "ns_if": "t2if", "ns_name": "t2"}], "tenant_ns": [{"tenant_ns_if": "t2ns1if", "tenant_ns_ip": "10.2.11.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s1if", "tenant_sub_ip": "10.2.11.2/24"}], "vxlan": [{"dev": "t2s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.11.2", "remote_ip": "10.1.11.2", "remote_route": "10.1.11.0/24", "subnet_route": "10.2.11.0/24", "tenant_route_ip": "192.168.130.2", "v_name": "vxlan_t2s1"}]}, {"brif": "t2br1if1", "disk": "10G", "mem": 2, "name": "t2_VM4", "vcpu": 4, "vmif": "t2VM4if1"}], "mode": "0644", "owner": "root", "path": "/root/Migration-as-a-Service/t2/VM_templates/t2_VM4.xml.j2", "size": 4091, "state": "file", "uid": 0}

PLAY RECAP **************************************************************************************************************************************************
localhost                  : ok=1    changed=0    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0   

changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.11.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.2.11.1', u'bridge_name': u't2br1', u'dns': [{u'dnsif': u't2s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't2s1_dnsbrif'}], u'ns_name': u't2ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.11.2/24', u'tenant_ns_ip': u'10.2.11.1/24', u'tenant_ns_if': u't2ns1if', u'tenant_sub_if': u't2s1if', u'tenant_ns_name': u't2'}], u'bridge_ip': u'1.1.1.1', u'vxlan': [{u'local_ip': u'10.2.11.2', u'dsport': 4789, u'dev': u't2s1if', u'tenant_route_ip': u'192.168.130.2', u'remote_route': u'10.1.11.0/24', u'subnet_route': u'10.2.11.0/24', u'v_name': u'vxlan_t2s1', u'id': 42, u'remote_ip': u'10.1.11.2'}]}, {u'mem': 2, u'name': u't2_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't2br1if1', u'vmif': u't2VM4if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip link show \"t2br1if1\" ; if [ $? -eq 0 ] ; then ip link set \"t2br1if1\" netns \"t2ns1\" ; fi\nip netns exec \"t2ns1\" brctl show \"t2br1\" | grep -w 't2br1if1' ; if [ $? -ne 0 ] ; then ip netns exec \"t2ns1\" brctl addif \"t2br1\" \"t2br1if1\" ; fi\n", "delta": "0:00:00.042045", "end": "2019-11-17 10:22:57.360439", "item": [{"bridge_ip": "1.1.1.1", "bridge_name": "t2br1", "default_route_ip": "10.2.11.1", "dns": [{"brif": "t2s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t2s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns1", "route": [{"if": "p1", "ip": "10.2.11.1/24", "ns_if": "t2if", "ns_name": "t2"}], "tenant_ns": [{"tenant_ns_if": "t2ns1if", "tenant_ns_ip": "10.2.11.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s1if", "tenant_sub_ip": "10.2.11.2/24"}], "vxlan": [{"dev": "t2s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.11.2", "remote_ip": "10.1.11.2", "remote_route": "10.1.11.0/24", "subnet_route": "10.2.11.0/24", "tenant_route_ip": "192.168.130.2", "v_name": "vxlan_t2s1"}]}, {"brif": "t2br1if1", "disk": "10G", "mem": 2, "name": "t2_VM4", "vcpu": 4, "vmif": "t2VM4if1"}], "rc": 0, "start": "2019-11-17 10:22:57.318394", "stderr": "Device \"t2br1if1\" does not exist.", "stderr_lines": ["Device \"t2br1if1\" does not exist."], "stdout": "t2br1\t\t8000.76fc12e1f29f\tno\t\tt2br1if1", "stdout_lines": ["t2br1\t\t8000.76fc12e1f29f\tno\t\tt2br1if1"]}

TASK [All interfaces and bridges UP] ************************************************************************************************************************
Using /etc/ansible/ansible.cfg as config file

PLAY [main] *************************************************************************************************************************************************

TASK [Copy VM image] ****************************************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.11.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.2.11.1', u'bridge_name': u't2br1', u'dns': [{u'dnsif': u't2s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't2s1_dnsbrif'}], u'ns_name': u't2ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.11.2/24', u'tenant_ns_ip': u'10.2.11.1/24', u'tenant_ns_if': u't2ns1if', u'tenant_sub_if': u't2s1if', u'tenant_ns_name': u't2'}], u'bridge_ip': u'1.1.1.1', u'vxlan': [{u'local_ip': u'10.2.11.2', u'dsport': 4789, u'dev': u't2s1if', u'tenant_route_ip': u'192.168.130.2', u'remote_route': u'10.1.11.0/24', u'subnet_route': u'10.2.11.0/24', u'v_name': u'vxlan_t2s1', u'id': 42, u'remote_ip': u'10.1.11.2'}]}, {u'mem': 2, u'name': u't2_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't2br1if1', u'vmif': u't2VM4if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t2ns1\" ip link set \"t2br1if1\" up\nip netns exec \"t2ns1\" ip link set dev \"t2br1\" up\n", "delta": "0:00:00.071642", "end": "2019-11-17 10:22:57.824459", "item": [{"bridge_ip": "1.1.1.1", "bridge_name": "t2br1", "default_route_ip": "10.2.11.1", "dns": [{"brif": "t2s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t2s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns1", "route": [{"if": "p1", "ip": "10.2.11.1/24", "ns_if": "t2if", "ns_name": "t2"}], "tenant_ns": [{"tenant_ns_if": "t2ns1if", "tenant_ns_ip": "10.2.11.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s1if", "tenant_sub_ip": "10.2.11.2/24"}], "vxlan": [{"dev": "t2s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.11.2", "remote_ip": "10.1.11.2", "remote_route": "10.1.11.0/24", "subnet_route": "10.2.11.0/24", "tenant_route_ip": "192.168.130.2", "v_name": "vxlan_t2s1"}]}, {"brif": "t2br1if1", "disk": "10G", "mem": 2, "name": "t2_VM4", "vcpu": 4, "vmif": "t2VM4if1"}], "rc": 0, "start": "2019-11-17 10:22:57.752817", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Add IP to DNS Interface] ******************************************************************************************************************************
ok: [localhost] => (item=[{u'route': [{u'ip': u'10.1.11.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.1.11.1', u'bridge_name': u't2br1', u'dns': [{u'dnsif': u't2s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't2s1_dnsbrif'}], u'ns_name': u't2ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.11.2/24', u'tenant_ns_ip': u'10.1.11.1/24', u'tenant_ns_if': u't2ns1if', u'tenant_sub_if': u't2s1if', u'tenant_ns_name': u't2'}], u'bridge_ip': u'1.1.1.1', u'vxlan': [{u'local_ip': u'10.1.11.2', u'dsport': 4789, u'dev': u't2s1if', u'tenant_route_ip': u'192.168.2.2', u'remote_route': u'10.2.11.0/24', u'subnet_route': u'10.1.11.0/24', u'v_name': u'vxlan_t2s1', u'id': 42, u'remote_ip': u'10.2.11.2'}]}, {u'mem': 2, u'name': u't2_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't2br1if1', u'vmif': u't2VM1if1'}]) => {"ansible_loop_var": "item", "changed": false, "dest": "/var/lib/libvirt/images/t2_VM1.qcow2", "item": [{"bridge_ip": "1.1.1.1", "bridge_name": "t2br1", "default_route_ip": "10.1.11.1", "dns": [{"brif": "t2s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t2s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns1", "route": [{"if": "p1", "ip": "10.1.11.1/24", "ns_if": "t2if", "ns_name": "t2"}], "tenant_ns": [{"tenant_ns_if": "t2ns1if", "tenant_ns_ip": "10.1.11.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s1if", "tenant_sub_ip": "10.1.11.2/24"}], "vxlan": [{"dev": "t2s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.11.2", "remote_ip": "10.2.11.2", "remote_route": "10.2.11.0/24", "subnet_route": "10.1.11.0/24", "tenant_route_ip": "192.168.2.2", "v_name": "vxlan_t2s1"}]}, {"brif": "t2br1if1", "disk": "10G", "mem": 2, "name": "t2_VM1", "vcpu": 4, "vmif": "t2VM1if1"}], "src": "/root/mainVM.qcow2"}
ok: [localhost] => (item=[{u'route': [{u'ip': u'10.1.11.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.1.11.1', u'bridge_name': u't2br1', u'dns': [{u'dnsif': u't2s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't2s1_dnsbrif'}], u'ns_name': u't2ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.11.2/24', u'tenant_ns_ip': u'10.1.11.1/24', u'tenant_ns_if': u't2ns1if', u'tenant_sub_if': u't2s1if', u'tenant_ns_name': u't2'}], u'bridge_ip': u'1.1.1.1', u'vxlan': [{u'local_ip': u'10.1.11.2', u'dsport': 4789, u'dev': u't2s1if', u'tenant_route_ip': u'192.168.2.2', u'remote_route': u'10.2.11.0/24', u'subnet_route': u'10.1.11.0/24', u'v_name': u'vxlan_t2s1', u'id': 42, u'remote_ip': u'10.2.11.2'}]}, {u'mem': 4, u'name': u't2_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't2br1if2', u'vmif': u't2VM2if1'}]) => {"ansible_loop_var": "item", "changed": false, "dest": "/var/lib/libvirt/images/t2_VM2.qcow2", "item": [{"bridge_ip": "1.1.1.1", "bridge_name": "t2br1", "default_route_ip": "10.1.11.1", "dns": [{"brif": "t2s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t2s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns1", "route": [{"if": "p1", "ip": "10.1.11.1/24", "ns_if": "t2if", "ns_name": "t2"}], "tenant_ns": [{"tenant_ns_if": "t2ns1if", "tenant_ns_ip": "10.1.11.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s1if", "tenant_sub_ip": "10.1.11.2/24"}], "vxlan": [{"dev": "t2s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.11.2", "remote_ip": "10.2.11.2", "remote_route": "10.2.11.0/24", "subnet_route": "10.1.11.0/24", "tenant_route_ip": "192.168.2.2", "v_name": "vxlan_t2s1"}]}, {"brif": "t2br1if2", "disk": "10G", "mem": 4, "name": "t2_VM2", "vcpu": 2, "vmif": "t2VM2if1"}], "src": "/root/mainVM.qcow2"}
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.11.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.2.11.1', u'bridge_name': u't2br1', u'ns_name': u't2ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.11.2/24', u'tenant_ns_ip': u'10.2.11.1/24', u'tenant_ns_if': u't2ns1if', u'tenant_sub_if': u't2s1if', u'tenant_ns_name': u't2'}], u'bridge_ip': u'1.1.1.1', u'vms': [{u'mem': 2, u'name': u't2_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't2br1if1', u'vmif': u't2VM4if1'}], u'vxlan': [{u'local_ip': u'10.2.11.2', u'dsport': 4789, u'dev': u't2s1if', u'tenant_route_ip': u'192.168.130.2', u'remote_route': u'10.1.11.0/24', u'subnet_route': u'10.2.11.0/24', u'v_name': u'vxlan_t2s1', u'id': 42, u'remote_ip': u'10.1.11.2'}]}, {u'dnsif': u't2s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't2s1_dnsbrif'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t2ns1\" ip addr show \"t2s1_dnsif\" | awk 'FNR==3{ print $2}'| grep -w '^1.1.1.128/24' ; if [ $? -ne 0 ] ; then ip netns exec \"t2ns1\" ip addr add \"1.1.1.128/24\" dev \"t2s1_dnsif\" ; fi\n", "delta": "0:00:00.036357", "end": "2019-11-17 10:22:58.264828", "item": [{"bridge_ip": "1.1.1.1", "bridge_name": "t2br1", "default_route_ip": "10.2.11.1", "ns_name": "t2ns1", "route": [{"if": "p1", "ip": "10.2.11.1/24", "ns_if": "t2if", "ns_name": "t2"}], "tenant_ns": [{"tenant_ns_if": "t2ns1if", "tenant_ns_ip": "10.2.11.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s1if", "tenant_sub_ip": "10.2.11.2/24"}], "vms": [{"brif": "t2br1if1", "disk": "10G", "mem": 2, "name": "t2_VM4", "vcpu": 4, "vmif": "t2VM4if1"}], "vxlan": [{"dev": "t2s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.11.2", "remote_ip": "10.1.11.2", "remote_route": "10.1.11.0/24", "subnet_route": "10.2.11.0/24", "tenant_route_ip": "192.168.130.2", "v_name": "vxlan_t2s1"}]}, {"brif": "t2s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t2s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "rc": 0, "start": "2019-11-17 10:22:58.228471", "stderr": "", "stderr_lines": [], "stdout": "1.1.1.128/24", "stdout_lines": ["1.1.1.128/24"]}

TASK [Install DHCP Server] **********************************************************************************************************************************
ok: [localhost] => (item=[{u'route': [{u'ip': u'10.1.12.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.1.12.1', u'bridge_name': u't2br2', u'dns': [{u'dnsif': u't2s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't2s2_dnsbrif'}], u'ns_name': u't2ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.12.2/24', u'tenant_ns_ip': u'10.1.12.1/24', u'tenant_ns_if': u't2ns2if', u'tenant_sub_if': u't2s2if', u'tenant_ns_name': u't2'}], u'bridge_ip': u'2.2.2.1', u'vxlan': [{u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}, {u'mem': 3, u'name': u't2_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't2br2if1', u'vmif': u't2VM3if1'}]) => {"ansible_loop_var": "item", "changed": false, "dest": "/var/lib/libvirt/images/t2_VM3.qcow2", "item": [{"bridge_ip": "2.2.2.1", "bridge_name": "t2br2", "default_route_ip": "10.1.12.1", "dns": [{"brif": "t2s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t2s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns2", "route": [{"if": "p1", "ip": "10.1.12.1/24", "ns_if": "t2if", "ns_name": "t2"}], "tenant_ns": [{"tenant_ns_if": "t2ns2if", "tenant_ns_ip": "10.1.12.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s2if", "tenant_sub_ip": "10.1.12.2/24"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, {"brif": "t2br2if1", "disk": "10G", "mem": 3, "name": "t2_VM3", "vcpu": 2, "vmif": "t2VM3if1"}], "src": "/root/mainVM.qcow2"}

TASK [Create VM templates (C1)] *****************************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.11.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.2.11.1', u'bridge_name': u't2br1', u'ns_name': u't2ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.11.2/24', u'tenant_ns_ip': u'10.2.11.1/24', u'tenant_ns_if': u't2ns1if', u'tenant_sub_if': u't2s1if', u'tenant_ns_name': u't2'}], u'bridge_ip': u'1.1.1.1', u'vms': [{u'mem': 2, u'name': u't2_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't2br1if1', u'vmif': u't2VM4if1'}], u'vxlan': [{u'local_ip': u'10.2.11.2', u'dsport': 4789, u'dev': u't2s1if', u'tenant_route_ip': u'192.168.130.2', u'remote_route': u'10.1.11.0/24', u'subnet_route': u'10.2.11.0/24', u'v_name': u'vxlan_t2s1', u'id': 42, u'remote_ip': u'10.1.11.2'}]}, {u'dnsif': u't2s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't2s1_dnsbrif'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t2ns1\" ps aux | grep -w '[d]nsmasq --interface t2s1_dnsif -z --dhcp-range=1.1.1.133,1.1.1.254' ; if [ $? -ne 0 ] ; then ip netns exec \"t2ns1\" dnsmasq --interface \"t2s1_dnsif\" -z --dhcp-range=1.1.1.133,'1.1.1.254' ; fi\n", "delta": "0:00:00.050316", "end": "2019-11-17 10:22:58.716390", "item": [{"bridge_ip": "1.1.1.1", "bridge_name": "t2br1", "default_route_ip": "10.2.11.1", "ns_name": "t2ns1", "route": [{"if": "p1", "ip": "10.2.11.1/24", "ns_if": "t2if", "ns_name": "t2"}], "tenant_ns": [{"tenant_ns_if": "t2ns1if", "tenant_ns_ip": "10.2.11.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s1if", "tenant_sub_ip": "10.2.11.2/24"}], "vms": [{"brif": "t2br1if1", "disk": "10G", "mem": 2, "name": "t2_VM4", "vcpu": 4, "vmif": "t2VM4if1"}], "vxlan": [{"dev": "t2s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.11.2", "remote_ip": "10.1.11.2", "remote_route": "10.1.11.0/24", "subnet_route": "10.2.11.0/24", "tenant_route_ip": "192.168.130.2", "v_name": "vxlan_t2s1"}]}, {"brif": "t2s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t2s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "rc": 0, "start": "2019-11-17 10:22:58.666074", "stderr": "", "stderr_lines": [], "stdout": "nobody    6881  0.0  0.0  51580   384 ?        S    10:22   0:00 dnsmasq --interface t2s1_dnsif -z --dhcp-range=1.1.1.133,1.1.1.254", "stdout_lines": ["nobody    6881  0.0  0.0  51580   384 ?        S    10:22   0:00 dnsmasq --interface t2s1_dnsif -z --dhcp-range=1.1.1.133,1.1.1.254"]}

TASK [Create VXLAN devices] *********************************************************************************************************************************
ok: [localhost] => (item=[{u'route': [{u'ip': u'10.1.11.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.1.11.1', u'bridge_name': u't2br1', u'dns': [{u'dnsif': u't2s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't2s1_dnsbrif'}], u'ns_name': u't2ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.11.2/24', u'tenant_ns_ip': u'10.1.11.1/24', u'tenant_ns_if': u't2ns1if', u'tenant_sub_if': u't2s1if', u'tenant_ns_name': u't2'}], u'bridge_ip': u'1.1.1.1', u'vxlan': [{u'local_ip': u'10.1.11.2', u'dsport': 4789, u'dev': u't2s1if', u'tenant_route_ip': u'192.168.2.2', u'remote_route': u'10.2.11.0/24', u'subnet_route': u'10.1.11.0/24', u'v_name': u'vxlan_t2s1', u'id': 42, u'remote_ip': u'10.2.11.2'}]}, {u'mem': 2, u'name': u't2_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't2br1if1', u'vmif': u't2VM1if1'}]) => {"ansible_loop_var": "item", "changed": false, "checksum": "350ba870bd31b7f6ee517845c14237910b5af0bf", "dest": "/root/Migration-as-a-Service/t2/VM_templates/t2_VM1.xml.j2", "gid": 0, "group": "root", "item": [{"bridge_ip": "1.1.1.1", "bridge_name": "t2br1", "default_route_ip": "10.1.11.1", "dns": [{"brif": "t2s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t2s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns1", "route": [{"if": "p1", "ip": "10.1.11.1/24", "ns_if": "t2if", "ns_name": "t2"}], "tenant_ns": [{"tenant_ns_if": "t2ns1if", "tenant_ns_ip": "10.1.11.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s1if", "tenant_sub_ip": "10.1.11.2/24"}], "vxlan": [{"dev": "t2s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.11.2", "remote_ip": "10.2.11.2", "remote_route": "10.2.11.0/24", "subnet_route": "10.1.11.0/24", "tenant_route_ip": "192.168.2.2", "v_name": "vxlan_t2s1"}]}, {"brif": "t2br1if1", "disk": "10G", "mem": 2, "name": "t2_VM1", "vcpu": 4, "vmif": "t2VM1if1"}], "mode": "0644", "owner": "root", "path": "/root/Migration-as-a-Service/t2/VM_templates/t2_VM1.xml.j2", "size": 4091, "state": "file", "uid": 0}
ok: [localhost] => (item=[{u'route': [{u'ip': u'10.1.11.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.1.11.1', u'bridge_name': u't2br1', u'dns': [{u'dnsif': u't2s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't2s1_dnsbrif'}], u'ns_name': u't2ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.11.2/24', u'tenant_ns_ip': u'10.1.11.1/24', u'tenant_ns_if': u't2ns1if', u'tenant_sub_if': u't2s1if', u'tenant_ns_name': u't2'}], u'bridge_ip': u'1.1.1.1', u'vxlan': [{u'local_ip': u'10.1.11.2', u'dsport': 4789, u'dev': u't2s1if', u'tenant_route_ip': u'192.168.2.2', u'remote_route': u'10.2.11.0/24', u'subnet_route': u'10.1.11.0/24', u'v_name': u'vxlan_t2s1', u'id': 42, u'remote_ip': u'10.2.11.2'}]}, {u'mem': 4, u'name': u't2_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't2br1if2', u'vmif': u't2VM2if1'}]) => {"ansible_loop_var": "item", "changed": false, "checksum": "350ba870bd31b7f6ee517845c14237910b5af0bf", "dest": "/root/Migration-as-a-Service/t2/VM_templates/t2_VM2.xml.j2", "gid": 0, "group": "root", "item": [{"bridge_ip": "1.1.1.1", "bridge_name": "t2br1", "default_route_ip": "10.1.11.1", "dns": [{"brif": "t2s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t2s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns1", "route": [{"if": "p1", "ip": "10.1.11.1/24", "ns_if": "t2if", "ns_name": "t2"}], "tenant_ns": [{"tenant_ns_if": "t2ns1if", "tenant_ns_ip": "10.1.11.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s1if", "tenant_sub_ip": "10.1.11.2/24"}], "vxlan": [{"dev": "t2s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.11.2", "remote_ip": "10.2.11.2", "remote_route": "10.2.11.0/24", "subnet_route": "10.1.11.0/24", "tenant_route_ip": "192.168.2.2", "v_name": "vxlan_t2s1"}]}, {"brif": "t2br1if2", "disk": "10G", "mem": 4, "name": "t2_VM2", "vcpu": 2, "vmif": "t2VM2if1"}], "mode": "0644", "owner": "root", "path": "/root/Migration-as-a-Service/t2/VM_templates/t2_VM2.xml.j2", "size": 4091, "state": "file", "uid": 0}
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.11.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.2.11.1', u'bridge_name': u't2br1', u'dns': [{u'dnsif': u't2s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't2s1_dnsbrif'}], u'ns_name': u't2ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.11.2/24', u'tenant_ns_ip': u'10.2.11.1/24', u'tenant_ns_if': u't2ns1if', u'tenant_sub_if': u't2s1if', u'tenant_ns_name': u't2'}], u'bridge_ip': u'1.1.1.1', u'vms': [{u'mem': 2, u'name': u't2_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't2br1if1', u'vmif': u't2VM4if1'}]}, {u'local_ip': u'10.2.11.2', u'dsport': 4789, u'dev': u't2s1if', u'tenant_route_ip': u'192.168.130.2', u'remote_route': u'10.1.11.0/24', u'subnet_route': u'10.2.11.0/24', u'v_name': u'vxlan_t2s1', u'id': 42, u'remote_ip': u'10.1.11.2'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t2ns1\" ip link show \"vxlan_t2s1\" ; if [ $? -ne 0 ] ; then ip netns exec \"t2ns1\" ip link add \"vxlan_t2s1\" type vxlan id \"42\" local \"10.2.11.2\" remote \"10.1.11.2\" dstport \"4789\" dev \"t2s1if\" ; ip netns exec \"t2ns1\" ip link set dev \"vxlan_t2s1\" up ; fi\n", "delta": "0:00:00.042287", "end": "2019-11-17 10:22:59.172439", "item": [{"bridge_ip": "1.1.1.1", "bridge_name": "t2br1", "default_route_ip": "10.2.11.1", "dns": [{"brif": "t2s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t2s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns1", "route": [{"if": "p1", "ip": "10.2.11.1/24", "ns_if": "t2if", "ns_name": "t2"}], "tenant_ns": [{"tenant_ns_if": "t2ns1if", "tenant_ns_ip": "10.2.11.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s1if", "tenant_sub_ip": "10.2.11.2/24"}], "vms": [{"brif": "t2br1if1", "disk": "10G", "mem": 2, "name": "t2_VM4", "vcpu": 4, "vmif": "t2VM4if1"}]}, {"dev": "t2s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.11.2", "remote_ip": "10.1.11.2", "remote_route": "10.1.11.0/24", "subnet_route": "10.2.11.0/24", "tenant_route_ip": "192.168.130.2", "v_name": "vxlan_t2s1"}], "rc": 0, "start": "2019-11-17 10:22:59.130152", "stderr": "", "stderr_lines": [], "stdout": "5: vxlan_t2s1: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1450 qdisc noqueue master t2br1 state UNKNOWN mode DEFAULT group default qlen 1000\n    link/ether 76:fc:12:e1:f2:9f brd ff:ff:ff:ff:ff:ff", "stdout_lines": ["5: vxlan_t2s1: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1450 qdisc noqueue master t2br1 state UNKNOWN mode DEFAULT group default qlen 1000", "    link/ether 76:fc:12:e1:f2:9f brd ff:ff:ff:ff:ff:ff"]}

TASK [Attach VXLANs to bridge] ******************************************************************************************************************************
ok: [localhost] => (item=[{u'route': [{u'ip': u'10.1.12.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.1.12.1', u'bridge_name': u't2br2', u'dns': [{u'dnsif': u't2s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't2s2_dnsbrif'}], u'ns_name': u't2ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.12.2/24', u'tenant_ns_ip': u'10.1.12.1/24', u'tenant_ns_if': u't2ns2if', u'tenant_sub_if': u't2s2if', u'tenant_ns_name': u't2'}], u'bridge_ip': u'2.2.2.1', u'vxlan': [{u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}, {u'mem': 3, u'name': u't2_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't2br2if1', u'vmif': u't2VM3if1'}]) => {"ansible_loop_var": "item", "changed": false, "checksum": "350ba870bd31b7f6ee517845c14237910b5af0bf", "dest": "/root/Migration-as-a-Service/t2/VM_templates/t2_VM3.xml.j2", "gid": 0, "group": "root", "item": [{"bridge_ip": "2.2.2.1", "bridge_name": "t2br2", "default_route_ip": "10.1.12.1", "dns": [{"brif": "t2s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t2s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns2", "route": [{"if": "p1", "ip": "10.1.12.1/24", "ns_if": "t2if", "ns_name": "t2"}], "tenant_ns": [{"tenant_ns_if": "t2ns2if", "tenant_ns_ip": "10.1.12.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s2if", "tenant_sub_ip": "10.1.12.2/24"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, {"brif": "t2br2if1", "disk": "10G", "mem": 3, "name": "t2_VM3", "vcpu": 2, "vmif": "t2VM3if1"}], "mode": "0644", "owner": "root", "path": "/root/Migration-as-a-Service/t2/VM_templates/t2_VM3.xml.j2", "size": 4091, "state": "file", "uid": 0}

TASK [Get list of running VMs] ******************************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.11.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.2.11.1', u'bridge_name': u't2br1', u'dns': [{u'dnsif': u't2s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't2s1_dnsbrif'}], u'ns_name': u't2ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.11.2/24', u'tenant_ns_ip': u'10.2.11.1/24', u'tenant_ns_if': u't2ns1if', u'tenant_sub_if': u't2s1if', u'tenant_ns_name': u't2'}], u'bridge_ip': u'1.1.1.1', u'vms': [{u'mem': 2, u'name': u't2_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't2br1if1', u'vmif': u't2VM4if1'}]}, {u'local_ip': u'10.2.11.2', u'dsport': 4789, u'dev': u't2s1if', u'tenant_route_ip': u'192.168.130.2', u'remote_route': u'10.1.11.0/24', u'subnet_route': u'10.2.11.0/24', u'v_name': u'vxlan_t2s1', u'id': 42, u'remote_ip': u'10.1.11.2'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t2ns1\" brctl show \"t2br1\" | grep -w 'vxlan_t2s1' ; if [ $? -ne 0 ] ; then ip netns exec \"t2ns1\" brctl addif \"t2br1\" \"vxlan_t2s1\" ; fi\n", "delta": "0:00:00.038173", "end": "2019-11-17 10:22:59.632470", "item": [{"bridge_ip": "1.1.1.1", "bridge_name": "t2br1", "default_route_ip": "10.2.11.1", "dns": [{"brif": "t2s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t2s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns1", "route": [{"if": "p1", "ip": "10.2.11.1/24", "ns_if": "t2if", "ns_name": "t2"}], "tenant_ns": [{"tenant_ns_if": "t2ns1if", "tenant_ns_ip": "10.2.11.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s1if", "tenant_sub_ip": "10.2.11.2/24"}], "vms": [{"brif": "t2br1if1", "disk": "10G", "mem": 2, "name": "t2_VM4", "vcpu": 4, "vmif": "t2VM4if1"}]}, {"dev": "t2s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.11.2", "remote_ip": "10.1.11.2", "remote_route": "10.1.11.0/24", "subnet_route": "10.2.11.0/24", "tenant_route_ip": "192.168.130.2", "v_name": "vxlan_t2s1"}], "rc": 0, "start": "2019-11-17 10:22:59.594297", "stderr": "", "stderr_lines": [], "stdout": "\t\t\t\t\t\t\tvxlan_t2s1", "stdout_lines": ["\t\t\t\t\t\t\tvxlan_t2s1"]}

PLAY RECAP **************************************************************************************************************************************************
99.99.99.2                 : ok=21   changed=19   unreachable=0    failed=0    skipped=0    rescued=0    ignored=0   

ok: [localhost] => {"changed": false, "cmd": ["virsh", "list", "--name"], "delta": "0:00:00.021297", "end": "2019-11-17 10:22:59.781973", "rc": 0, "start": "2019-11-17 10:22:59.760676", "stderr": "", "stderr_lines": [], "stdout": "t1_VM1\nt1_VM2\nt1_VM3", "stdout_lines": ["t1_VM1", "t1_VM2", "t1_VM3"]}

TASK [Define VM] ********************************************************************************************************************************************
Using /etc/ansible/ansible.cfg as config file
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.11.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.1.11.1', u'bridge_name': u't2br1', u'dns': [{u'dnsif': u't2s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't2s1_dnsbrif'}], u'ns_name': u't2ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.11.2/24', u'tenant_ns_ip': u'10.1.11.1/24', u'tenant_ns_if': u't2ns1if', u'tenant_sub_if': u't2s1if', u'tenant_ns_name': u't2'}], u'bridge_ip': u'1.1.1.1', u'vxlan': [{u'local_ip': u'10.1.11.2', u'dsport': 4789, u'dev': u't2s1if', u'tenant_route_ip': u'192.168.2.2', u'remote_route': u'10.2.11.0/24', u'subnet_route': u'10.1.11.0/24', u'v_name': u'vxlan_t2s1', u'id': 42, u'remote_ip': u'10.2.11.2'}]}, {u'mem': 2, u'name': u't2_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't2br1if1', u'vmif': u't2VM1if1'}]) => {"ansible_loop_var": "item", "changed": true, "created": "t2_VM1", "item": [{"bridge_ip": "1.1.1.1", "bridge_name": "t2br1", "default_route_ip": "10.1.11.1", "dns": [{"brif": "t2s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t2s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns1", "route": [{"if": "p1", "ip": "10.1.11.1/24", "ns_if": "t2if", "ns_name": "t2"}], "tenant_ns": [{"tenant_ns_if": "t2ns1if", "tenant_ns_ip": "10.1.11.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s1if", "tenant_sub_ip": "10.1.11.2/24"}], "vxlan": [{"dev": "t2s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.11.2", "remote_ip": "10.2.11.2", "remote_route": "10.2.11.0/24", "subnet_route": "10.1.11.0/24", "tenant_route_ip": "192.168.2.2", "v_name": "vxlan_t2s1"}]}, {"brif": "t2br1if1", "disk": "10G", "mem": 2, "name": "t2_VM1", "vcpu": 4, "vmif": "t2VM1if1"}], "warnings": ["'xml' is given - ignoring 'name'"]}

PLAY [main] *************************************************************************************************************************************************

TASK [Add VXLAN routes in PNS] ******************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.11.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.1.11.1', u'bridge_name': u't2br1', u'dns': [{u'dnsif': u't2s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't2s1_dnsbrif'}], u'ns_name': u't2ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.11.2/24', u'tenant_ns_ip': u'10.1.11.1/24', u'tenant_ns_if': u't2ns1if', u'tenant_sub_if': u't2s1if', u'tenant_ns_name': u't2'}], u'bridge_ip': u'1.1.1.1', u'vxlan': [{u'local_ip': u'10.1.11.2', u'dsport': 4789, u'dev': u't2s1if', u'tenant_route_ip': u'192.168.2.2', u'remote_route': u'10.2.11.0/24', u'subnet_route': u'10.1.11.0/24', u'v_name': u'vxlan_t2s1', u'id': 42, u'remote_ip': u'10.2.11.2'}]}, {u'mem': 4, u'name': u't2_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't2br1if2', u'vmif': u't2VM2if1'}]) => {"ansible_loop_var": "item", "changed": true, "created": "t2_VM2", "item": [{"bridge_ip": "1.1.1.1", "bridge_name": "t2br1", "default_route_ip": "10.1.11.1", "dns": [{"brif": "t2s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t2s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns1", "route": [{"if": "p1", "ip": "10.1.11.1/24", "ns_if": "t2if", "ns_name": "t2"}], "tenant_ns": [{"tenant_ns_if": "t2ns1if", "tenant_ns_ip": "10.1.11.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s1if", "tenant_sub_ip": "10.1.11.2/24"}], "vxlan": [{"dev": "t2s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.11.2", "remote_ip": "10.2.11.2", "remote_route": "10.2.11.0/24", "subnet_route": "10.1.11.0/24", "tenant_route_ip": "192.168.2.2", "v_name": "vxlan_t2s1"}]}, {"brif": "t2br1if2", "disk": "10G", "mem": 4, "name": "t2_VM2", "vcpu": 2, "vmif": "t2VM2if1"}], "warnings": ["'xml' is given - ignoring 'name'"]}
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.12.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.1.12.1', u'bridge_name': u't2br2', u'dns': [{u'dnsif': u't2s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't2s2_dnsbrif'}], u'ns_name': u't2ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.12.2/24', u'tenant_ns_ip': u'10.1.12.1/24', u'tenant_ns_if': u't2ns2if', u'tenant_sub_if': u't2s2if', u'tenant_ns_name': u't2'}], u'bridge_ip': u'2.2.2.1', u'vxlan': [{u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}, {u'mem': 3, u'name': u't2_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't2br2if1', u'vmif': u't2VM3if1'}]) => {"ansible_loop_var": "item", "changed": true, "created": "t2_VM3", "item": [{"bridge_ip": "2.2.2.1", "bridge_name": "t2br2", "default_route_ip": "10.1.12.1", "dns": [{"brif": "t2s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t2s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns2", "route": [{"if": "p1", "ip": "10.1.12.1/24", "ns_if": "t2if", "ns_name": "t2"}], "tenant_ns": [{"tenant_ns_if": "t2ns2if", "tenant_ns_ip": "10.1.12.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s2if", "tenant_sub_ip": "10.1.12.2/24"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, {"brif": "t2br2if1", "disk": "10G", "mem": 3, "name": "t2_VM3", "vcpu": 2, "vmif": "t2VM3if1"}], "warnings": ["'xml' is given - ignoring 'name'"]}

TASK [Create VM] ********************************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.11.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.1.11.1', u'bridge_name': u't2br1', u'dns': [{u'dnsif': u't2s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't2s1_dnsbrif'}], u'ns_name': u't2ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.11.2/24', u'tenant_ns_ip': u'10.1.11.1/24', u'tenant_ns_if': u't2ns1if', u'tenant_sub_if': u't2s1if', u'tenant_ns_name': u't2'}], u'bridge_ip': u'1.1.1.1', u'vms': [{u'mem': 2, u'name': u't2_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't2br1if1', u'vmif': u't2VM1if1'}, {u'mem': 4, u'name': u't2_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't2br1if2', u'vmif': u't2VM2if1'}]}, {u'local_ip': u'10.1.11.2', u'dsport': 4789, u'dev': u't2s1if', u'tenant_route_ip': u'192.168.2.2', u'remote_route': u'10.2.11.0/24', u'subnet_route': u'10.1.11.0/24', u'v_name': u'vxlan_t2s1', u'id': 42, u'remote_ip': u'10.2.11.2'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec pns ip route show \"10.1.11.0/24\" via \"192.168.2.2\" | grep -w '^10.1.11.0/24' ; if [ $? -ne 0 ] ; then ip netns exec pns ip route add \"10.1.11.0/24\" via \"192.168.2.2\" ; fi\n", "delta": "0:00:00.035956", "end": "2019-11-17 10:23:00.831785", "item": [{"bridge_ip": "1.1.1.1", "bridge_name": "t2br1", "default_route_ip": "10.1.11.1", "dns": [{"brif": "t2s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t2s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns1", "route": [{"if": "p1", "ip": "10.1.11.1/24", "ns_if": "t2if", "ns_name": "t2"}], "tenant_ns": [{"tenant_ns_if": "t2ns1if", "tenant_ns_ip": "10.1.11.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s1if", "tenant_sub_ip": "10.1.11.2/24"}], "vms": [{"brif": "t2br1if1", "disk": "10G", "mem": 2, "name": "t2_VM1", "vcpu": 4, "vmif": "t2VM1if1"}, {"brif": "t2br1if2", "disk": "10G", "mem": 4, "name": "t2_VM2", "vcpu": 2, "vmif": "t2VM2if1"}]}, {"dev": "t2s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.11.2", "remote_ip": "10.2.11.2", "remote_route": "10.2.11.0/24", "subnet_route": "10.1.11.0/24", "tenant_route_ip": "192.168.2.2", "v_name": "vxlan_t2s1"}], "rc": 0, "start": "2019-11-17 10:23:00.795829", "stderr": "", "stderr_lines": [], "stdout": "10.1.11.0/24 dev t2pns_if ", "stdout_lines": ["10.1.11.0/24 dev t2pns_if "]}
skipping: [localhost] => (item=[{u'route': [{u'ip': u'10.1.12.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.1.12.1', u'bridge_name': u't2br2', u'dns': [{u'dnsif': u't2s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't2s2_dnsbrif'}], u'ns_name': u't2ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.12.2/24', u'tenant_ns_ip': u'10.1.12.1/24', u'tenant_ns_if': u't2ns2if', u'tenant_sub_if': u't2s2if', u'tenant_ns_name': u't2'}], u'bridge_ip': u'2.2.2.1', u'vms': [{u'mem': 3, u'name': u't2_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't2br2if1', u'vmif': u't2VM3if1'}]}, {u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}])  => {"ansible_loop_var": "item", "changed": false, "item": [{"bridge_ip": "2.2.2.1", "bridge_name": "t2br2", "default_route_ip": "10.1.12.1", "dns": [{"brif": "t2s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t2s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns2", "route": [{"if": "p1", "ip": "10.1.12.1/24", "ns_if": "t2if", "ns_name": "t2"}], "tenant_ns": [{"tenant_ns_if": "t2ns2if", "tenant_ns_ip": "10.1.12.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s2if", "tenant_sub_ip": "10.1.12.2/24"}], "vms": [{"brif": "t2br2if1", "disk": "10G", "mem": 3, "name": "t2_VM3", "vcpu": 2, "vmif": "t2VM3if1"}]}, {"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}], "skip_reason": "Conditional result was False"}

TASK [Get PNS ip address] ***********************************************************************************************************************************
ok: [localhost] => {"changed": false, "cmd": "ip netns exec pns ip addr show p1 | awk 'FNR==3{ print $2 }' | awk -F/ '{ print $1 }'\n", "delta": "0:00:00.048185", "end": "2019-11-17 10:23:01.143918", "rc": 0, "start": "2019-11-17 10:23:01.095733", "stderr": "", "stderr_lines": [], "stdout": "192.168.100.238", "stdout_lines": ["192.168.100.238"]}

TASK [Add VXLAN routes to host] *****************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.11.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.1.11.1', u'bridge_name': u't2br1', u'dns': [{u'dnsif': u't2s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't2s1_dnsbrif'}], u'ns_name': u't2ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.11.2/24', u'tenant_ns_ip': u'10.1.11.1/24', u'tenant_ns_if': u't2ns1if', u'tenant_sub_if': u't2s1if', u'tenant_ns_name': u't2'}], u'bridge_ip': u'1.1.1.1', u'vms': [{u'mem': 2, u'name': u't2_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't2br1if1', u'vmif': u't2VM1if1'}, {u'mem': 4, u'name': u't2_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't2br1if2', u'vmif': u't2VM2if1'}]}, {u'local_ip': u'10.1.11.2', u'dsport': 4789, u'dev': u't2s1if', u'tenant_route_ip': u'192.168.2.2', u'remote_route': u'10.2.11.0/24', u'subnet_route': u'10.1.11.0/24', u'v_name': u'vxlan_t2s1', u'id': 42, u'remote_ip': u'10.2.11.2'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip route show \"10.1.11.0/24\" via \"192.168.100.238\" | grep -w '^10.1.11.0/24' ; if [ $? -ne 0 ] ; then ip route add \"10.1.11.0/24\" via \"192.168.100.238\" ; fi\nip route show \"10.2.11.0/24\" via 99.99.99.2 | grep -w '^10.2.11.0/24'; if [ $? -ne 0 ] ; then ip route add \"10.2.11.0/24\" via 99.99.99.2 ; fi\n", "delta": "0:00:00.006495", "end": "2019-11-17 10:23:01.420484", "item": [{"bridge_ip": "1.1.1.1", "bridge_name": "t2br1", "default_route_ip": "10.1.11.1", "dns": [{"brif": "t2s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t2s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns1", "route": [{"if": "p1", "ip": "10.1.11.1/24", "ns_if": "t2if", "ns_name": "t2"}], "tenant_ns": [{"tenant_ns_if": "t2ns1if", "tenant_ns_ip": "10.1.11.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s1if", "tenant_sub_ip": "10.1.11.2/24"}], "vms": [{"brif": "t2br1if1", "disk": "10G", "mem": 2, "name": "t2_VM1", "vcpu": 4, "vmif": "t2VM1if1"}, {"brif": "t2br1if2", "disk": "10G", "mem": 4, "name": "t2_VM2", "vcpu": 2, "vmif": "t2VM2if1"}]}, {"dev": "t2s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.11.2", "remote_ip": "10.2.11.2", "remote_route": "10.2.11.0/24", "subnet_route": "10.1.11.0/24", "tenant_route_ip": "192.168.2.2", "v_name": "vxlan_t2s1"}], "rc": 0, "start": "2019-11-17 10:23:01.413989", "stderr": "", "stderr_lines": [], "stdout": "10.1.11.0/24 dev testBR \n10.2.11.0/24 dev ens4 ", "stdout_lines": ["10.1.11.0/24 dev testBR ", "10.2.11.0/24 dev ens4 "]}
skipping: [localhost] => (item=[{u'route': [{u'ip': u'10.1.12.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.1.12.1', u'bridge_name': u't2br2', u'dns': [{u'dnsif': u't2s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't2s2_dnsbrif'}], u'ns_name': u't2ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.12.2/24', u'tenant_ns_ip': u'10.1.12.1/24', u'tenant_ns_if': u't2ns2if', u'tenant_sub_if': u't2s2if', u'tenant_ns_name': u't2'}], u'bridge_ip': u'2.2.2.1', u'vms': [{u'mem': 3, u'name': u't2_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't2br2if1', u'vmif': u't2VM3if1'}]}, {u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}])  => {"ansible_loop_var": "item", "changed": false, "item": [{"bridge_ip": "2.2.2.1", "bridge_name": "t2br2", "default_route_ip": "10.1.12.1", "dns": [{"brif": "t2s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t2s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns2", "route": [{"if": "p1", "ip": "10.1.12.1/24", "ns_if": "t2if", "ns_name": "t2"}], "tenant_ns": [{"tenant_ns_if": "t2ns2if", "tenant_ns_ip": "10.1.12.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s2if", "tenant_sub_ip": "10.1.12.2/24"}], "vms": [{"brif": "t2br2if1", "disk": "10G", "mem": 3, "name": "t2_VM3", "vcpu": 2, "vmif": "t2VM3if1"}]}, {"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}], "skip_reason": "Conditional result was False"}

PLAY RECAP **************************************************************************************************************************************************
localhost                  : ok=3    changed=2    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0   

ok: [localhost] => (item=[{u'route': [{u'ip': u'10.1.11.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.1.11.1', u'bridge_name': u't2br1', u'dns': [{u'dnsif': u't2s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't2s1_dnsbrif'}], u'ns_name': u't2ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.11.2/24', u'tenant_ns_ip': u'10.1.11.1/24', u'tenant_ns_if': u't2ns1if', u'tenant_sub_if': u't2s1if', u'tenant_ns_name': u't2'}], u'bridge_ip': u'1.1.1.1', u'vxlan': [{u'local_ip': u'10.1.11.2', u'dsport': 4789, u'dev': u't2s1if', u'tenant_route_ip': u'192.168.2.2', u'remote_route': u'10.2.11.0/24', u'subnet_route': u'10.1.11.0/24', u'v_name': u'vxlan_t2s1', u'id': 42, u'remote_ip': u'10.2.11.2'}]}, {u'mem': 2, u'name': u't2_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't2br1if1', u'vmif': u't2VM1if1'}]) => {"ansible_loop_var": "item", "changed": false, "create": 0, "item": [{"bridge_ip": "1.1.1.1", "bridge_name": "t2br1", "default_route_ip": "10.1.11.1", "dns": [{"brif": "t2s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t2s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns1", "route": [{"if": "p1", "ip": "10.1.11.1/24", "ns_if": "t2if", "ns_name": "t2"}], "tenant_ns": [{"tenant_ns_if": "t2ns1if", "tenant_ns_ip": "10.1.11.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s1if", "tenant_sub_ip": "10.1.11.2/24"}], "vxlan": [{"dev": "t2s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.11.2", "remote_ip": "10.2.11.2", "remote_route": "10.2.11.0/24", "subnet_route": "10.1.11.0/24", "tenant_route_ip": "192.168.2.2", "v_name": "vxlan_t2s1"}]}, {"brif": "t2br1if1", "disk": "10G", "mem": 2, "name": "t2_VM1", "vcpu": 4, "vmif": "t2VM1if1"}]}
Using /etc/ansible/ansible.cfg as config file

PLAY [worker] ***********************************************************************************************************************************************

TASK [Add VXLAN routes in PNS] ******************************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.11.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.2.11.1', u'bridge_name': u't2br1', u'dns': [{u'dnsif': u't2s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't2s1_dnsbrif'}], u'ns_name': u't2ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.11.2/24', u'tenant_ns_ip': u'10.2.11.1/24', u'tenant_ns_if': u't2ns1if', u'tenant_sub_if': u't2s1if', u'tenant_ns_name': u't2'}], u'bridge_ip': u'1.1.1.1', u'vms': [{u'mem': 2, u'name': u't2_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't2br1if1', u'vmif': u't2VM4if1'}]}, {u'local_ip': u'10.2.11.2', u'dsport': 4789, u'dev': u't2s1if', u'tenant_route_ip': u'192.168.130.2', u'remote_route': u'10.1.11.0/24', u'subnet_route': u'10.2.11.0/24', u'v_name': u'vxlan_t2s1', u'id': 42, u'remote_ip': u'10.1.11.2'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec pns ip route show \"10.2.11.0/24\" via \"192.168.130.2\" | grep -w '^10.2.11.0/24' ; if [ $? -ne 0 ] ; then ip netns exec pns ip route add \"10.2.11.0/24\" via \"192.168.130.2\" ; fi\n", "delta": "0:00:00.041764", "end": "2019-11-17 10:23:02.696532", "item": [{"bridge_ip": "1.1.1.1", "bridge_name": "t2br1", "default_route_ip": "10.2.11.1", "dns": [{"brif": "t2s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t2s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns1", "route": [{"if": "p1", "ip": "10.2.11.1/24", "ns_if": "t2if", "ns_name": "t2"}], "tenant_ns": [{"tenant_ns_if": "t2ns1if", "tenant_ns_ip": "10.2.11.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s1if", "tenant_sub_ip": "10.2.11.2/24"}], "vms": [{"brif": "t2br1if1", "disk": "10G", "mem": 2, "name": "t2_VM4", "vcpu": 4, "vmif": "t2VM4if1"}]}, {"dev": "t2s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.11.2", "remote_ip": "10.1.11.2", "remote_route": "10.1.11.0/24", "subnet_route": "10.2.11.0/24", "tenant_route_ip": "192.168.130.2", "v_name": "vxlan_t2s1"}], "rc": 0, "start": "2019-11-17 10:23:02.654768", "stderr": "", "stderr_lines": [], "stdout": "10.2.11.0/24 dev t2pns_if ", "stdout_lines": ["10.2.11.0/24 dev t2pns_if "]}

TASK [Get PNS ip address] ***********************************************************************************************************************************
ok: [localhost] => (item=[{u'route': [{u'ip': u'10.1.11.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.1.11.1', u'bridge_name': u't2br1', u'dns': [{u'dnsif': u't2s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't2s1_dnsbrif'}], u'ns_name': u't2ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.11.2/24', u'tenant_ns_ip': u'10.1.11.1/24', u'tenant_ns_if': u't2ns1if', u'tenant_sub_if': u't2s1if', u'tenant_ns_name': u't2'}], u'bridge_ip': u'1.1.1.1', u'vxlan': [{u'local_ip': u'10.1.11.2', u'dsport': 4789, u'dev': u't2s1if', u'tenant_route_ip': u'192.168.2.2', u'remote_route': u'10.2.11.0/24', u'subnet_route': u'10.1.11.0/24', u'v_name': u'vxlan_t2s1', u'id': 42, u'remote_ip': u'10.2.11.2'}]}, {u'mem': 4, u'name': u't2_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't2br1if2', u'vmif': u't2VM2if1'}]) => {"ansible_loop_var": "item", "changed": false, "create": 0, "item": [{"bridge_ip": "1.1.1.1", "bridge_name": "t2br1", "default_route_ip": "10.1.11.1", "dns": [{"brif": "t2s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t2s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns1", "route": [{"if": "p1", "ip": "10.1.11.1/24", "ns_if": "t2if", "ns_name": "t2"}], "tenant_ns": [{"tenant_ns_if": "t2ns1if", "tenant_ns_ip": "10.1.11.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s1if", "tenant_sub_ip": "10.1.11.2/24"}], "vxlan": [{"dev": "t2s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.11.2", "remote_ip": "10.2.11.2", "remote_route": "10.2.11.0/24", "subnet_route": "10.1.11.0/24", "tenant_route_ip": "192.168.2.2", "v_name": "vxlan_t2s1"}]}, {"brif": "t2br1if2", "disk": "10G", "mem": 4, "name": "t2_VM2", "vcpu": 2, "vmif": "t2VM2if1"}]}
ok: [99.99.99.2] => {"changed": false, "cmd": "ip netns exec pns ip addr show p1 | awk 'FNR==3{ print $2 }' | awk -F/ '{ print $1 }'\n", "delta": "0:00:00.033736", "end": "2019-11-17 10:23:03.156822", "rc": 0, "start": "2019-11-17 10:23:03.123086", "stderr": "", "stderr_lines": [], "stdout": "192.168.100.50", "stdout_lines": ["192.168.100.50"]}

TASK [Add VXLAN routes to host] *****************************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.11.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.2.11.1', u'bridge_name': u't2br1', u'dns': [{u'dnsif': u't2s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't2s1_dnsbrif'}], u'ns_name': u't2ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.11.2/24', u'tenant_ns_ip': u'10.2.11.1/24', u'tenant_ns_if': u't2ns1if', u'tenant_sub_if': u't2s1if', u'tenant_ns_name': u't2'}], u'bridge_ip': u'1.1.1.1', u'vms': [{u'mem': 2, u'name': u't2_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't2br1if1', u'vmif': u't2VM4if1'}]}, {u'local_ip': u'10.2.11.2', u'dsport': 4789, u'dev': u't2s1if', u'tenant_route_ip': u'192.168.130.2', u'remote_route': u'10.1.11.0/24', u'subnet_route': u'10.2.11.0/24', u'v_name': u'vxlan_t2s1', u'id': 42, u'remote_ip': u'10.1.11.2'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip route show \"10.2.11.0/24\" via \"192.168.100.50\" | grep -w '^10.2.11.0/24' ; if [ $? -ne 0 ] ; then ip route add \"10.2.11.0/24\" via \"192.168.100.50\" ; fi\nip route show \"10.1.11.0/24\" via 99.99.99.1 | grep -w '^10.1.11.0/24'; if [ $? -ne 0 ] ; then ip route add \"10.1.11.0/24\" via 99.99.99.1 ; fi\n", "delta": "0:00:00.006107", "end": "2019-11-17 10:23:03.575033", "item": [{"bridge_ip": "1.1.1.1", "bridge_name": "t2br1", "default_route_ip": "10.2.11.1", "dns": [{"brif": "t2s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t2s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns1", "route": [{"if": "p1", "ip": "10.2.11.1/24", "ns_if": "t2if", "ns_name": "t2"}], "tenant_ns": [{"tenant_ns_if": "t2ns1if", "tenant_ns_ip": "10.2.11.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s1if", "tenant_sub_ip": "10.2.11.2/24"}], "vms": [{"brif": "t2br1if1", "disk": "10G", "mem": 2, "name": "t2_VM4", "vcpu": 4, "vmif": "t2VM4if1"}]}, {"dev": "t2s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.11.2", "remote_ip": "10.1.11.2", "remote_route": "10.1.11.0/24", "subnet_route": "10.2.11.0/24", "tenant_route_ip": "192.168.130.2", "v_name": "vxlan_t2s1"}], "rc": 0, "start": "2019-11-17 10:23:03.568926", "stderr": "", "stderr_lines": [], "stdout": "10.2.11.0/24 dev testBR \n10.1.11.0/24 dev ens4 ", "stdout_lines": ["10.2.11.0/24 dev testBR ", "10.1.11.0/24 dev ens4 "]}

PLAY RECAP **************************************************************************************************************************************************
99.99.99.2                 : ok=3    changed=2    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0   

ok: [localhost] => (item=[{u'route': [{u'ip': u'10.1.12.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.1.12.1', u'bridge_name': u't2br2', u'dns': [{u'dnsif': u't2s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't2s2_dnsbrif'}], u'ns_name': u't2ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.12.2/24', u'tenant_ns_ip': u'10.1.12.1/24', u'tenant_ns_if': u't2ns2if', u'tenant_sub_if': u't2s2if', u'tenant_ns_name': u't2'}], u'bridge_ip': u'2.2.2.1', u'vxlan': [{u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}, {u'mem': 3, u'name': u't2_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't2br2if1', u'vmif': u't2VM3if1'}]) => {"ansible_loop_var": "item", "changed": false, "create": 0, "item": [{"bridge_ip": "2.2.2.1", "bridge_name": "t2br2", "default_route_ip": "10.1.12.1", "dns": [{"brif": "t2s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t2s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns2", "route": [{"if": "p1", "ip": "10.1.12.1/24", "ns_if": "t2if", "ns_name": "t2"}], "tenant_ns": [{"tenant_ns_if": "t2ns2if", "tenant_ns_ip": "10.1.12.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s2if", "tenant_sub_ip": "10.1.12.2/24"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, {"brif": "t2br2if1", "disk": "10G", "mem": 3, "name": "t2_VM3", "vcpu": 2, "vmif": "t2VM3if1"}]}

TASK [Start VM] *********************************************************************************************************************************************
Using /etc/ansible/ansible.cfg as config file

PLAY [main] *************************************************************************************************************************************************

TASK [Create VM templates (C1)] *****************************************************************************************************************************
ok: [localhost] => (item=[{u'route': [{u'ip': u'10.1.11.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.1.11.1', u'bridge_name': u't2br1', u'dns': [{u'dnsif': u't2s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't2s1_dnsbrif'}], u'ns_name': u't2ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.11.2/24', u'tenant_ns_ip': u'10.1.11.1/24', u'tenant_ns_if': u't2ns1if', u'tenant_sub_if': u't2s1if', u'tenant_ns_name': u't2'}], u'bridge_ip': u'1.1.1.1', u'vxlan': [{u'local_ip': u'10.1.11.2', u'dsport': 4789, u'dev': u't2s1if', u'tenant_route_ip': u'192.168.2.2', u'remote_route': u'10.2.11.0/24', u'subnet_route': u'10.1.11.0/24', u'v_name': u'vxlan_t2s1', u'id': 42, u'remote_ip': u'10.2.11.2'}]}, {u'mem': 2, u'name': u't2_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't2br1if1', u'vmif': u't2VM1if1'}]) => {"ansible_loop_var": "item", "changed": false, "item": [{"bridge_ip": "1.1.1.1", "bridge_name": "t2br1", "default_route_ip": "10.1.11.1", "dns": [{"brif": "t2s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t2s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns1", "route": [{"if": "p1", "ip": "10.1.11.1/24", "ns_if": "t2if", "ns_name": "t2"}], "tenant_ns": [{"tenant_ns_if": "t2ns1if", "tenant_ns_ip": "10.1.11.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s1if", "tenant_sub_ip": "10.1.11.2/24"}], "vxlan": [{"dev": "t2s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.11.2", "remote_ip": "10.2.11.2", "remote_route": "10.2.11.0/24", "subnet_route": "10.1.11.0/24", "tenant_route_ip": "192.168.2.2", "v_name": "vxlan_t2s1"}]}, {"brif": "t2br1if1", "disk": "10G", "mem": 2, "name": "t2_VM1", "vcpu": 4, "vmif": "t2VM1if1"}]}
ok: [localhost] => (item=[{u'route': [{u'ip': u'10.1.11.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.1.11.1', u'bridge_name': u't2br1', u'dns': [{u'dnsif': u't2s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't2s1_dnsbrif'}], u'ns_name': u't2ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.11.2/24', u'tenant_ns_ip': u'10.1.11.1/24', u'tenant_ns_if': u't2ns1if', u'tenant_sub_if': u't2s1if', u'tenant_ns_name': u't2'}], u'bridge_ip': u'1.1.1.1', u'vxlan': [{u'local_ip': u'10.1.11.2', u'dsport': 4789, u'dev': u't2s1if', u'tenant_route_ip': u'192.168.2.2', u'remote_route': u'10.2.11.0/24', u'subnet_route': u'10.1.11.0/24', u'v_name': u'vxlan_t2s1', u'id': 42, u'remote_ip': u'10.2.11.2'}]}, {u'mem': 4, u'name': u't2_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't2br1if2', u'vmif': u't2VM2if1'}]) => {"ansible_loop_var": "item", "changed": false, "item": [{"bridge_ip": "1.1.1.1", "bridge_name": "t2br1", "default_route_ip": "10.1.11.1", "dns": [{"brif": "t2s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t2s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns1", "route": [{"if": "p1", "ip": "10.1.11.1/24", "ns_if": "t2if", "ns_name": "t2"}], "tenant_ns": [{"tenant_ns_if": "t2ns1if", "tenant_ns_ip": "10.1.11.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s1if", "tenant_sub_ip": "10.1.11.2/24"}], "vxlan": [{"dev": "t2s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.11.2", "remote_ip": "10.2.11.2", "remote_route": "10.2.11.0/24", "subnet_route": "10.1.11.0/24", "tenant_route_ip": "192.168.2.2", "v_name": "vxlan_t2s1"}]}, {"brif": "t2br1if2", "disk": "10G", "mem": 4, "name": "t2_VM2", "vcpu": 2, "vmif": "t2VM2if1"}]}
ok: [localhost] => (item=[{u'route': [{u'ip': u'10.1.12.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.1.12.1', u'bridge_name': u't2br2', u'dns': [{u'dnsif': u't2s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't2s2_dnsbrif'}], u'ns_name': u't2ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.12.2/24', u'tenant_ns_ip': u'10.1.12.1/24', u'tenant_ns_if': u't2ns2if', u'tenant_sub_if': u't2s2if', u'tenant_ns_name': u't2'}], u'bridge_ip': u'2.2.2.1', u'vxlan': [{u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}, {u'mem': 3, u'name': u't2_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't2br2if1', u'vmif': u't2VM3if1'}]) => {"ansible_loop_var": "item", "changed": false, "item": [{"bridge_ip": "2.2.2.1", "bridge_name": "t2br2", "default_route_ip": "10.1.12.1", "dns": [{"brif": "t2s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t2s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns2", "route": [{"if": "p1", "ip": "10.1.12.1/24", "ns_if": "t2if", "ns_name": "t2"}], "tenant_ns": [{"tenant_ns_if": "t2ns2if", "tenant_ns_ip": "10.1.12.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s2if", "tenant_sub_ip": "10.1.12.2/24"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, {"brif": "t2br2if1", "disk": "10G", "mem": 3, "name": "t2_VM3", "vcpu": 2, "vmif": "t2VM3if1"}]}

TASK [Attach VM interface] **********************************************************************************************************************************
ok: [localhost] => (item=[{u'route': [{u'ip': u'10.1.11.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.1.11.1', u'bridge_name': u't2br1', u'dns': [{u'dnsif': u't2s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't2s1_dnsbrif'}], u'ns_name': u't2ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.11.2/24', u'tenant_ns_ip': u'10.1.11.1/24', u'tenant_ns_if': u't2ns1if', u'tenant_sub_if': u't2s1if', u'tenant_ns_name': u't2'}], u'bridge_ip': u'1.1.1.1', u'vxlan': [{u'local_ip': u'10.1.11.2', u'dsport': 4789, u'dev': u't2s1if', u'tenant_route_ip': u'192.168.2.2', u'remote_route': u'10.2.11.0/24', u'subnet_route': u'10.1.11.0/24', u'v_name': u'vxlan_t2s1', u'id': 42, u'remote_ip': u'10.2.11.2'}]}, {u'mem': 2, u'name': u't2_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't2br1if1', u'vmif': u't2VM1if1'}]) => {"ansible_loop_var": "item", "changed": false, "checksum": "350ba870bd31b7f6ee517845c14237910b5af0bf", "dest": "/root/Migration-as-a-Service/t2/VM_templates/t2_VM1.xml.j2", "gid": 0, "group": "root", "item": [{"bridge_ip": "1.1.1.1", "bridge_name": "t2br1", "default_route_ip": "10.1.11.1", "dns": [{"brif": "t2s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t2s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns1", "route": [{"if": "p1", "ip": "10.1.11.1/24", "ns_if": "t2if", "ns_name": "t2"}], "tenant_ns": [{"tenant_ns_if": "t2ns1if", "tenant_ns_ip": "10.1.11.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s1if", "tenant_sub_ip": "10.1.11.2/24"}], "vxlan": [{"dev": "t2s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.11.2", "remote_ip": "10.2.11.2", "remote_route": "10.2.11.0/24", "subnet_route": "10.1.11.0/24", "tenant_route_ip": "192.168.2.2", "v_name": "vxlan_t2s1"}]}, {"brif": "t2br1if1", "disk": "10G", "mem": 2, "name": "t2_VM1", "vcpu": 4, "vmif": "t2VM1if1"}], "mode": "0644", "owner": "root", "path": "/root/Migration-as-a-Service/t2/VM_templates/t2_VM1.xml.j2", "size": 4091, "state": "file", "uid": 0}
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.11.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.1.11.1', u'bridge_name': u't2br1', u'dns': [{u'dnsif': u't2s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't2s1_dnsbrif'}], u'ns_name': u't2ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.11.2/24', u'tenant_ns_ip': u'10.1.11.1/24', u'tenant_ns_if': u't2ns1if', u'tenant_sub_if': u't2s1if', u'tenant_ns_name': u't2'}], u'bridge_ip': u'1.1.1.1', u'vxlan': [{u'local_ip': u'10.1.11.2', u'dsport': 4789, u'dev': u't2s1if', u'tenant_route_ip': u'192.168.2.2', u'remote_route': u'10.2.11.0/24', u'subnet_route': u'10.1.11.0/24', u'v_name': u'vxlan_t2s1', u'id': 42, u'remote_ip': u'10.2.11.2'}]}, {u'mem': 2, u'name': u't2_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't2br1if1', u'vmif': u't2VM1if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "virsh domiflist \"t2_VM1\" | grep -w 't2VM1if1' ; if [ $? -ne 0 ] ; then virsh attach-interface \"t2_VM1\" direct \"t2VM1if1\" --live --persistent ; fi\n", "delta": "0:00:00.303574", "end": "2019-11-17 10:23:05.580823", "item": [{"bridge_ip": "1.1.1.1", "bridge_name": "t2br1", "default_route_ip": "10.1.11.1", "dns": [{"brif": "t2s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t2s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns1", "route": [{"if": "p1", "ip": "10.1.11.1/24", "ns_if": "t2if", "ns_name": "t2"}], "tenant_ns": [{"tenant_ns_if": "t2ns1if", "tenant_ns_ip": "10.1.11.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s1if", "tenant_sub_ip": "10.1.11.2/24"}], "vxlan": [{"dev": "t2s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.11.2", "remote_ip": "10.2.11.2", "remote_route": "10.2.11.0/24", "subnet_route": "10.1.11.0/24", "tenant_route_ip": "192.168.2.2", "v_name": "vxlan_t2s1"}]}, {"brif": "t2br1if1", "disk": "10G", "mem": 2, "name": "t2_VM1", "vcpu": 4, "vmif": "t2VM1if1"}], "rc": 0, "start": "2019-11-17 10:23:05.277249", "stderr": "", "stderr_lines": [], "stdout": "Interface attached successfully", "stdout_lines": ["Interface attached successfully"]}
ok: [localhost] => (item=[{u'route': [{u'ip': u'10.1.11.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.1.11.1', u'bridge_name': u't2br1', u'dns': [{u'dnsif': u't2s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't2s1_dnsbrif'}], u'ns_name': u't2ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.11.2/24', u'tenant_ns_ip': u'10.1.11.1/24', u'tenant_ns_if': u't2ns1if', u'tenant_sub_if': u't2s1if', u'tenant_ns_name': u't2'}], u'bridge_ip': u'1.1.1.1', u'vxlan': [{u'local_ip': u'10.1.11.2', u'dsport': 4789, u'dev': u't2s1if', u'tenant_route_ip': u'192.168.2.2', u'remote_route': u'10.2.11.0/24', u'subnet_route': u'10.1.11.0/24', u'v_name': u'vxlan_t2s1', u'id': 42, u'remote_ip': u'10.2.11.2'}]}, {u'mem': 4, u'name': u't2_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't2br1if2', u'vmif': u't2VM2if1'}]) => {"ansible_loop_var": "item", "changed": false, "checksum": "350ba870bd31b7f6ee517845c14237910b5af0bf", "dest": "/root/Migration-as-a-Service/t2/VM_templates/t2_VM2.xml.j2", "gid": 0, "group": "root", "item": [{"bridge_ip": "1.1.1.1", "bridge_name": "t2br1", "default_route_ip": "10.1.11.1", "dns": [{"brif": "t2s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t2s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns1", "route": [{"if": "p1", "ip": "10.1.11.1/24", "ns_if": "t2if", "ns_name": "t2"}], "tenant_ns": [{"tenant_ns_if": "t2ns1if", "tenant_ns_ip": "10.1.11.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s1if", "tenant_sub_ip": "10.1.11.2/24"}], "vxlan": [{"dev": "t2s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.11.2", "remote_ip": "10.2.11.2", "remote_route": "10.2.11.0/24", "subnet_route": "10.1.11.0/24", "tenant_route_ip": "192.168.2.2", "v_name": "vxlan_t2s1"}]}, {"brif": "t2br1if2", "disk": "10G", "mem": 4, "name": "t2_VM2", "vcpu": 2, "vmif": "t2VM2if1"}], "mode": "0644", "owner": "root", "path": "/root/Migration-as-a-Service/t2/VM_templates/t2_VM2.xml.j2", "size": 4091, "state": "file", "uid": 0}
ok: [localhost] => (item=[{u'route': [{u'ip': u'10.1.12.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.1.12.1', u'bridge_name': u't2br2', u'dns': [{u'dnsif': u't2s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't2s2_dnsbrif'}], u'ns_name': u't2ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.12.2/24', u'tenant_ns_ip': u'10.1.12.1/24', u'tenant_ns_if': u't2ns2if', u'tenant_sub_if': u't2s2if', u'tenant_ns_name': u't2'}], u'bridge_ip': u'2.2.2.1', u'vxlan': [{u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}, {u'mem': 3, u'name': u't2_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't2br2if1', u'vmif': u't2VM3if1'}]) => {"ansible_loop_var": "item", "changed": false, "checksum": "350ba870bd31b7f6ee517845c14237910b5af0bf", "dest": "/root/Migration-as-a-Service/t2/VM_templates/t2_VM3.xml.j2", "gid": 0, "group": "root", "item": [{"bridge_ip": "2.2.2.1", "bridge_name": "t2br2", "default_route_ip": "10.1.12.1", "dns": [{"brif": "t2s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t2s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns2", "route": [{"if": "p1", "ip": "10.1.12.1/24", "ns_if": "t2if", "ns_name": "t2"}], "tenant_ns": [{"tenant_ns_if": "t2ns2if", "tenant_ns_ip": "10.1.12.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s2if", "tenant_sub_ip": "10.1.12.2/24"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, {"brif": "t2br2if1", "disk": "10G", "mem": 3, "name": "t2_VM3", "vcpu": 2, "vmif": "t2VM3if1"}], "mode": "0644", "owner": "root", "path": "/root/Migration-as-a-Service/t2/VM_templates/t2_VM3.xml.j2", "size": 4091, "state": "file", "uid": 0}

PLAY RECAP **************************************************************************************************************************************************
localhost                  : ok=1    changed=0    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0   

changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.11.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.1.11.1', u'bridge_name': u't2br1', u'dns': [{u'dnsif': u't2s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't2s1_dnsbrif'}], u'ns_name': u't2ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.11.2/24', u'tenant_ns_ip': u'10.1.11.1/24', u'tenant_ns_if': u't2ns1if', u'tenant_sub_if': u't2s1if', u'tenant_ns_name': u't2'}], u'bridge_ip': u'1.1.1.1', u'vxlan': [{u'local_ip': u'10.1.11.2', u'dsport': 4789, u'dev': u't2s1if', u'tenant_route_ip': u'192.168.2.2', u'remote_route': u'10.2.11.0/24', u'subnet_route': u'10.1.11.0/24', u'v_name': u'vxlan_t2s1', u'id': 42, u'remote_ip': u'10.2.11.2'}]}, {u'mem': 4, u'name': u't2_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't2br1if2', u'vmif': u't2VM2if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "virsh domiflist \"t2_VM2\" | grep -w 't2VM2if1' ; if [ $? -ne 0 ] ; then virsh attach-interface \"t2_VM2\" direct \"t2VM2if1\" --live --persistent ; fi\n", "delta": "0:00:00.408362", "end": "2019-11-17 10:23:06.191249", "item": [{"bridge_ip": "1.1.1.1", "bridge_name": "t2br1", "default_route_ip": "10.1.11.1", "dns": [{"brif": "t2s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t2s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns1", "route": [{"if": "p1", "ip": "10.1.11.1/24", "ns_if": "t2if", "ns_name": "t2"}], "tenant_ns": [{"tenant_ns_if": "t2ns1if", "tenant_ns_ip": "10.1.11.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s1if", "tenant_sub_ip": "10.1.11.2/24"}], "vxlan": [{"dev": "t2s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.11.2", "remote_ip": "10.2.11.2", "remote_route": "10.2.11.0/24", "subnet_route": "10.1.11.0/24", "tenant_route_ip": "192.168.2.2", "v_name": "vxlan_t2s1"}]}, {"brif": "t2br1if2", "disk": "10G", "mem": 4, "name": "t2_VM2", "vcpu": 2, "vmif": "t2VM2if1"}], "rc": 0, "start": "2019-11-17 10:23:05.782887", "stderr": "", "stderr_lines": [], "stdout": "Interface attached successfully", "stdout_lines": ["Interface attached successfully"]}
Using /etc/ansible/ansible.cfg as config file

PLAY [main] *************************************************************************************************************************************************

TASK [Create VM templates (C2)] *****************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.12.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.1.12.1', u'bridge_name': u't2br2', u'dns': [{u'dnsif': u't2s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't2s2_dnsbrif'}], u'ns_name': u't2ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.12.2/24', u'tenant_ns_ip': u'10.1.12.1/24', u'tenant_ns_if': u't2ns2if', u'tenant_sub_if': u't2s2if', u'tenant_ns_name': u't2'}], u'bridge_ip': u'2.2.2.1', u'vxlan': [{u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}, {u'mem': 3, u'name': u't2_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't2br2if1', u'vmif': u't2VM3if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "virsh domiflist \"t2_VM3\" | grep -w 't2VM3if1' ; if [ $? -ne 0 ] ; then virsh attach-interface \"t2_VM3\" direct \"t2VM3if1\" --live --persistent ; fi\n", "delta": "0:00:00.393433", "end": "2019-11-17 10:23:06.843904", "item": [{"bridge_ip": "2.2.2.1", "bridge_name": "t2br2", "default_route_ip": "10.1.12.1", "dns": [{"brif": "t2s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t2s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns2", "route": [{"if": "p1", "ip": "10.1.12.1/24", "ns_if": "t2if", "ns_name": "t2"}], "tenant_ns": [{"tenant_ns_if": "t2ns2if", "tenant_ns_ip": "10.1.12.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s2if", "tenant_sub_ip": "10.1.12.2/24"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, {"brif": "t2br2if1", "disk": "10G", "mem": 3, "name": "t2_VM3", "vcpu": 2, "vmif": "t2VM3if1"}], "rc": 0, "start": "2019-11-17 10:23:06.450471", "stderr": "", "stderr_lines": [], "stdout": "Interface attached successfully", "stdout_lines": ["Interface attached successfully"]}

PLAY RECAP **************************************************************************************************************************************************
localhost                  : ok=7    changed=2    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0   

Using /etc/ansible/ansible.cfg as config file

PLAY [worker] ***********************************************************************************************************************************************

TASK [Copy VM image] ****************************************************************************************************************************************
ok: [localhost] => (item=[{u'route': [{u'ip': u'10.2.11.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.2.11.1', u'bridge_name': u't2br1', u'dns': [{u'dnsif': u't2s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't2s1_dnsbrif'}], u'ns_name': u't2ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.11.2/24', u'tenant_ns_ip': u'10.2.11.1/24', u'tenant_ns_if': u't2ns1if', u'tenant_sub_if': u't2s1if', u'tenant_ns_name': u't2'}], u'bridge_ip': u'1.1.1.1', u'vxlan': [{u'local_ip': u'10.2.11.2', u'dsport': 4789, u'dev': u't2s1if', u'tenant_route_ip': u'192.168.130.2', u'remote_route': u'10.1.11.0/24', u'subnet_route': u'10.2.11.0/24', u'v_name': u'vxlan_t2s1', u'id': 42, u'remote_ip': u'10.1.11.2'}]}, {u'mem': 2, u'name': u't2_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't2br1if1', u'vmif': u't2VM4if1'}]) => {"ansible_loop_var": "item", "changed": false, "checksum": "350ba870bd31b7f6ee517845c14237910b5af0bf", "dest": "/root/Migration-as-a-Service/t2/VM_templates/t2_VM4.xml.j2", "gid": 0, "group": "root", "item": [{"bridge_ip": "1.1.1.1", "bridge_name": "t2br1", "default_route_ip": "10.2.11.1", "dns": [{"brif": "t2s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t2s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns1", "route": [{"if": "p1", "ip": "10.2.11.1/24", "ns_if": "t2if", "ns_name": "t2"}], "tenant_ns": [{"tenant_ns_if": "t2ns1if", "tenant_ns_ip": "10.2.11.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s1if", "tenant_sub_ip": "10.2.11.2/24"}], "vxlan": [{"dev": "t2s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.11.2", "remote_ip": "10.1.11.2", "remote_route": "10.1.11.0/24", "subnet_route": "10.2.11.0/24", "tenant_route_ip": "192.168.130.2", "v_name": "vxlan_t2s1"}]}, {"brif": "t2br1if1", "disk": "10G", "mem": 2, "name": "t2_VM4", "vcpu": 4, "vmif": "t2VM4if1"}], "mode": "0644", "owner": "root", "path": "/root/Migration-as-a-Service/t2/VM_templates/t2_VM4.xml.j2", "size": 4091, "state": "file", "uid": 0}

PLAY RECAP **************************************************************************************************************************************************
localhost                  : ok=1    changed=0    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0   

Using /etc/ansible/ansible.cfg as config file

PLAY [main] *************************************************************************************************************************************************

TASK [Copy VM image] ****************************************************************************************************************************************
ok: [localhost] => (item=[{u'route': [{u'ip': u'10.1.11.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.1.11.1', u'bridge_name': u't2br1', u'dns': [{u'dnsif': u't2s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't2s1_dnsbrif'}], u'ns_name': u't2ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.11.2/24', u'tenant_ns_ip': u'10.1.11.1/24', u'tenant_ns_if': u't2ns1if', u'tenant_sub_if': u't2s1if', u'tenant_ns_name': u't2'}], u'bridge_ip': u'1.1.1.1', u'vxlan': [{u'local_ip': u'10.1.11.2', u'dsport': 4789, u'dev': u't2s1if', u'tenant_route_ip': u'192.168.2.2', u'remote_route': u'10.2.11.0/24', u'subnet_route': u'10.1.11.0/24', u'v_name': u'vxlan_t2s1', u'id': 42, u'remote_ip': u'10.2.11.2'}]}, {u'mem': 2, u'name': u't2_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't2br1if1', u'vmif': u't2VM1if1'}]) => {"ansible_loop_var": "item", "changed": false, "dest": "/var/lib/libvirt/images/t2_VM1.qcow2", "item": [{"bridge_ip": "1.1.1.1", "bridge_name": "t2br1", "default_route_ip": "10.1.11.1", "dns": [{"brif": "t2s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t2s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns1", "route": [{"if": "p1", "ip": "10.1.11.1/24", "ns_if": "t2if", "ns_name": "t2"}], "tenant_ns": [{"tenant_ns_if": "t2ns1if", "tenant_ns_ip": "10.1.11.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s1if", "tenant_sub_ip": "10.1.11.2/24"}], "vxlan": [{"dev": "t2s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.11.2", "remote_ip": "10.2.11.2", "remote_route": "10.2.11.0/24", "subnet_route": "10.1.11.0/24", "tenant_route_ip": "192.168.2.2", "v_name": "vxlan_t2s1"}]}, {"brif": "t2br1if1", "disk": "10G", "mem": 2, "name": "t2_VM1", "vcpu": 4, "vmif": "t2VM1if1"}], "src": "/root/mainVM.qcow2"}
ok: [localhost] => (item=[{u'route': [{u'ip': u'10.1.11.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.1.11.1', u'bridge_name': u't2br1', u'dns': [{u'dnsif': u't2s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't2s1_dnsbrif'}], u'ns_name': u't2ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.11.2/24', u'tenant_ns_ip': u'10.1.11.1/24', u'tenant_ns_if': u't2ns1if', u'tenant_sub_if': u't2s1if', u'tenant_ns_name': u't2'}], u'bridge_ip': u'1.1.1.1', u'vxlan': [{u'local_ip': u'10.1.11.2', u'dsport': 4789, u'dev': u't2s1if', u'tenant_route_ip': u'192.168.2.2', u'remote_route': u'10.2.11.0/24', u'subnet_route': u'10.1.11.0/24', u'v_name': u'vxlan_t2s1', u'id': 42, u'remote_ip': u'10.2.11.2'}]}, {u'mem': 4, u'name': u't2_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't2br1if2', u'vmif': u't2VM2if1'}]) => {"ansible_loop_var": "item", "changed": false, "dest": "/var/lib/libvirt/images/t2_VM2.qcow2", "item": [{"bridge_ip": "1.1.1.1", "bridge_name": "t2br1", "default_route_ip": "10.1.11.1", "dns": [{"brif": "t2s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t2s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns1", "route": [{"if": "p1", "ip": "10.1.11.1/24", "ns_if": "t2if", "ns_name": "t2"}], "tenant_ns": [{"tenant_ns_if": "t2ns1if", "tenant_ns_ip": "10.1.11.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s1if", "tenant_sub_ip": "10.1.11.2/24"}], "vxlan": [{"dev": "t2s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.11.2", "remote_ip": "10.2.11.2", "remote_route": "10.2.11.0/24", "subnet_route": "10.1.11.0/24", "tenant_route_ip": "192.168.2.2", "v_name": "vxlan_t2s1"}]}, {"brif": "t2br1if2", "disk": "10G", "mem": 4, "name": "t2_VM2", "vcpu": 2, "vmif": "t2VM2if1"}], "src": "/root/mainVM.qcow2"}
ok: [localhost] => (item=[{u'route': [{u'ip': u'10.1.12.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.1.12.1', u'bridge_name': u't2br2', u'dns': [{u'dnsif': u't2s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't2s2_dnsbrif'}], u'ns_name': u't2ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.12.2/24', u'tenant_ns_ip': u'10.1.12.1/24', u'tenant_ns_if': u't2ns2if', u'tenant_sub_if': u't2s2if', u'tenant_ns_name': u't2'}], u'bridge_ip': u'2.2.2.1', u'vxlan': [{u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}, {u'mem': 3, u'name': u't2_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't2br2if1', u'vmif': u't2VM3if1'}]) => {"ansible_loop_var": "item", "changed": false, "dest": "/var/lib/libvirt/images/t2_VM3.qcow2", "item": [{"bridge_ip": "2.2.2.1", "bridge_name": "t2br2", "default_route_ip": "10.1.12.1", "dns": [{"brif": "t2s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t2s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns2", "route": [{"if": "p1", "ip": "10.1.12.1/24", "ns_if": "t2if", "ns_name": "t2"}], "tenant_ns": [{"tenant_ns_if": "t2ns2if", "tenant_ns_ip": "10.1.12.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s2if", "tenant_sub_ip": "10.1.12.2/24"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, {"brif": "t2br2if1", "disk": "10G", "mem": 3, "name": "t2_VM3", "vcpu": 2, "vmif": "t2VM3if1"}], "src": "/root/mainVM.qcow2"}

TASK [Create VM templates (C1)] *****************************************************************************************************************************
ok: [localhost] => (item=[{u'route': [{u'ip': u'10.1.11.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.1.11.1', u'bridge_name': u't2br1', u'dns': [{u'dnsif': u't2s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't2s1_dnsbrif'}], u'ns_name': u't2ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.11.2/24', u'tenant_ns_ip': u'10.1.11.1/24', u'tenant_ns_if': u't2ns1if', u'tenant_sub_if': u't2s1if', u'tenant_ns_name': u't2'}], u'bridge_ip': u'1.1.1.1', u'vxlan': [{u'local_ip': u'10.1.11.2', u'dsport': 4789, u'dev': u't2s1if', u'tenant_route_ip': u'192.168.2.2', u'remote_route': u'10.2.11.0/24', u'subnet_route': u'10.1.11.0/24', u'v_name': u'vxlan_t2s1', u'id': 42, u'remote_ip': u'10.2.11.2'}]}, {u'mem': 2, u'name': u't2_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't2br1if1', u'vmif': u't2VM1if1'}]) => {"ansible_loop_var": "item", "changed": false, "checksum": "350ba870bd31b7f6ee517845c14237910b5af0bf", "dest": "/root/Migration-as-a-Service/t2/VM_templates/t2_VM1.xml.j2", "gid": 0, "group": "root", "item": [{"bridge_ip": "1.1.1.1", "bridge_name": "t2br1", "default_route_ip": "10.1.11.1", "dns": [{"brif": "t2s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t2s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns1", "route": [{"if": "p1", "ip": "10.1.11.1/24", "ns_if": "t2if", "ns_name": "t2"}], "tenant_ns": [{"tenant_ns_if": "t2ns1if", "tenant_ns_ip": "10.1.11.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s1if", "tenant_sub_ip": "10.1.11.2/24"}], "vxlan": [{"dev": "t2s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.11.2", "remote_ip": "10.2.11.2", "remote_route": "10.2.11.0/24", "subnet_route": "10.1.11.0/24", "tenant_route_ip": "192.168.2.2", "v_name": "vxlan_t2s1"}]}, {"brif": "t2br1if1", "disk": "10G", "mem": 2, "name": "t2_VM1", "vcpu": 4, "vmif": "t2VM1if1"}], "mode": "0644", "owner": "root", "path": "/root/Migration-as-a-Service/t2/VM_templates/t2_VM1.xml.j2", "size": 4091, "state": "file", "uid": 0}
ok: [localhost] => (item=[{u'route': [{u'ip': u'10.1.11.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.1.11.1', u'bridge_name': u't2br1', u'dns': [{u'dnsif': u't2s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't2s1_dnsbrif'}], u'ns_name': u't2ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.11.2/24', u'tenant_ns_ip': u'10.1.11.1/24', u'tenant_ns_if': u't2ns1if', u'tenant_sub_if': u't2s1if', u'tenant_ns_name': u't2'}], u'bridge_ip': u'1.1.1.1', u'vxlan': [{u'local_ip': u'10.1.11.2', u'dsport': 4789, u'dev': u't2s1if', u'tenant_route_ip': u'192.168.2.2', u'remote_route': u'10.2.11.0/24', u'subnet_route': u'10.1.11.0/24', u'v_name': u'vxlan_t2s1', u'id': 42, u'remote_ip': u'10.2.11.2'}]}, {u'mem': 4, u'name': u't2_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't2br1if2', u'vmif': u't2VM2if1'}]) => {"ansible_loop_var": "item", "changed": false, "checksum": "350ba870bd31b7f6ee517845c14237910b5af0bf", "dest": "/root/Migration-as-a-Service/t2/VM_templates/t2_VM2.xml.j2", "gid": 0, "group": "root", "item": [{"bridge_ip": "1.1.1.1", "bridge_name": "t2br1", "default_route_ip": "10.1.11.1", "dns": [{"brif": "t2s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t2s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns1", "route": [{"if": "p1", "ip": "10.1.11.1/24", "ns_if": "t2if", "ns_name": "t2"}], "tenant_ns": [{"tenant_ns_if": "t2ns1if", "tenant_ns_ip": "10.1.11.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s1if", "tenant_sub_ip": "10.1.11.2/24"}], "vxlan": [{"dev": "t2s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.11.2", "remote_ip": "10.2.11.2", "remote_route": "10.2.11.0/24", "subnet_route": "10.1.11.0/24", "tenant_route_ip": "192.168.2.2", "v_name": "vxlan_t2s1"}]}, {"brif": "t2br1if2", "disk": "10G", "mem": 4, "name": "t2_VM2", "vcpu": 2, "vmif": "t2VM2if1"}], "mode": "0644", "owner": "root", "path": "/root/Migration-as-a-Service/t2/VM_templates/t2_VM2.xml.j2", "size": 4091, "state": "file", "uid": 0}
ok: [localhost] => (item=[{u'route': [{u'ip': u'10.1.12.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.1.12.1', u'bridge_name': u't2br2', u'dns': [{u'dnsif': u't2s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't2s2_dnsbrif'}], u'ns_name': u't2ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.12.2/24', u'tenant_ns_ip': u'10.1.12.1/24', u'tenant_ns_if': u't2ns2if', u'tenant_sub_if': u't2s2if', u'tenant_ns_name': u't2'}], u'bridge_ip': u'2.2.2.1', u'vxlan': [{u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}, {u'mem': 3, u'name': u't2_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't2br2if1', u'vmif': u't2VM3if1'}]) => {"ansible_loop_var": "item", "changed": false, "checksum": "350ba870bd31b7f6ee517845c14237910b5af0bf", "dest": "/root/Migration-as-a-Service/t2/VM_templates/t2_VM3.xml.j2", "gid": 0, "group": "root", "item": [{"bridge_ip": "2.2.2.1", "bridge_name": "t2br2", "default_route_ip": "10.1.12.1", "dns": [{"brif": "t2s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t2s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns2", "route": [{"if": "p1", "ip": "10.1.12.1/24", "ns_if": "t2if", "ns_name": "t2"}], "tenant_ns": [{"tenant_ns_if": "t2ns2if", "tenant_ns_ip": "10.1.12.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s2if", "tenant_sub_ip": "10.1.12.2/24"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, {"brif": "t2br2if1", "disk": "10G", "mem": 3, "name": "t2_VM3", "vcpu": 2, "vmif": "t2VM3if1"}], "mode": "0644", "owner": "root", "path": "/root/Migration-as-a-Service/t2/VM_templates/t2_VM3.xml.j2", "size": 4091, "state": "file", "uid": 0}

TASK [Get list of running VMs] ******************************************************************************************************************************
ok: [localhost] => {"changed": false, "cmd": ["virsh", "list", "--name"], "delta": "0:00:00.017316", "end": "2019-11-17 10:23:10.515363", "rc": 0, "start": "2019-11-17 10:23:10.498047", "stderr": "", "stderr_lines": [], "stdout": "t1_VM1\nt1_VM2\nt1_VM3\nt2_VM1\nt2_VM2\nt2_VM3", "stdout_lines": ["t1_VM1", "t1_VM2", "t1_VM3", "t2_VM1", "t2_VM2", "t2_VM3"]}

TASK [Define VM] ********************************************************************************************************************************************
skipping: [localhost] => (item=[{u'route': [{u'ip': u'10.1.11.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.1.11.1', u'bridge_name': u't2br1', u'dns': [{u'dnsif': u't2s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't2s1_dnsbrif'}], u'ns_name': u't2ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.11.2/24', u'tenant_ns_ip': u'10.1.11.1/24', u'tenant_ns_if': u't2ns1if', u'tenant_sub_if': u't2s1if', u'tenant_ns_name': u't2'}], u'bridge_ip': u'1.1.1.1', u'vxlan': [{u'local_ip': u'10.1.11.2', u'dsport': 4789, u'dev': u't2s1if', u'tenant_route_ip': u'192.168.2.2', u'remote_route': u'10.2.11.0/24', u'subnet_route': u'10.1.11.0/24', u'v_name': u'vxlan_t2s1', u'id': 42, u'remote_ip': u'10.2.11.2'}]}, {u'mem': 2, u'name': u't2_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't2br1if1', u'vmif': u't2VM1if1'}])  => {"ansible_loop_var": "item", "changed": false, "item": [{"bridge_ip": "1.1.1.1", "bridge_name": "t2br1", "default_route_ip": "10.1.11.1", "dns": [{"brif": "t2s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t2s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns1", "route": [{"if": "p1", "ip": "10.1.11.1/24", "ns_if": "t2if", "ns_name": "t2"}], "tenant_ns": [{"tenant_ns_if": "t2ns1if", "tenant_ns_ip": "10.1.11.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s1if", "tenant_sub_ip": "10.1.11.2/24"}], "vxlan": [{"dev": "t2s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.11.2", "remote_ip": "10.2.11.2", "remote_route": "10.2.11.0/24", "subnet_route": "10.1.11.0/24", "tenant_route_ip": "192.168.2.2", "v_name": "vxlan_t2s1"}]}, {"brif": "t2br1if1", "disk": "10G", "mem": 2, "name": "t2_VM1", "vcpu": 4, "vmif": "t2VM1if1"}], "skip_reason": "Conditional result was False"}
skipping: [localhost] => (item=[{u'route': [{u'ip': u'10.1.11.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.1.11.1', u'bridge_name': u't2br1', u'dns': [{u'dnsif': u't2s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't2s1_dnsbrif'}], u'ns_name': u't2ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.11.2/24', u'tenant_ns_ip': u'10.1.11.1/24', u'tenant_ns_if': u't2ns1if', u'tenant_sub_if': u't2s1if', u'tenant_ns_name': u't2'}], u'bridge_ip': u'1.1.1.1', u'vxlan': [{u'local_ip': u'10.1.11.2', u'dsport': 4789, u'dev': u't2s1if', u'tenant_route_ip': u'192.168.2.2', u'remote_route': u'10.2.11.0/24', u'subnet_route': u'10.1.11.0/24', u'v_name': u'vxlan_t2s1', u'id': 42, u'remote_ip': u'10.2.11.2'}]}, {u'mem': 4, u'name': u't2_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't2br1if2', u'vmif': u't2VM2if1'}])  => {"ansible_loop_var": "item", "changed": false, "item": [{"bridge_ip": "1.1.1.1", "bridge_name": "t2br1", "default_route_ip": "10.1.11.1", "dns": [{"brif": "t2s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t2s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns1", "route": [{"if": "p1", "ip": "10.1.11.1/24", "ns_if": "t2if", "ns_name": "t2"}], "tenant_ns": [{"tenant_ns_if": "t2ns1if", "tenant_ns_ip": "10.1.11.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s1if", "tenant_sub_ip": "10.1.11.2/24"}], "vxlan": [{"dev": "t2s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.11.2", "remote_ip": "10.2.11.2", "remote_route": "10.2.11.0/24", "subnet_route": "10.1.11.0/24", "tenant_route_ip": "192.168.2.2", "v_name": "vxlan_t2s1"}]}, {"brif": "t2br1if2", "disk": "10G", "mem": 4, "name": "t2_VM2", "vcpu": 2, "vmif": "t2VM2if1"}], "skip_reason": "Conditional result was False"}
skipping: [localhost] => (item=[{u'route': [{u'ip': u'10.1.12.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.1.12.1', u'bridge_name': u't2br2', u'dns': [{u'dnsif': u't2s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't2s2_dnsbrif'}], u'ns_name': u't2ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.12.2/24', u'tenant_ns_ip': u'10.1.12.1/24', u'tenant_ns_if': u't2ns2if', u'tenant_sub_if': u't2s2if', u'tenant_ns_name': u't2'}], u'bridge_ip': u'2.2.2.1', u'vxlan': [{u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}, {u'mem': 3, u'name': u't2_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't2br2if1', u'vmif': u't2VM3if1'}])  => {"ansible_loop_var": "item", "changed": false, "item": [{"bridge_ip": "2.2.2.1", "bridge_name": "t2br2", "default_route_ip": "10.1.12.1", "dns": [{"brif": "t2s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t2s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns2", "route": [{"if": "p1", "ip": "10.1.12.1/24", "ns_if": "t2if", "ns_name": "t2"}], "tenant_ns": [{"tenant_ns_if": "t2ns2if", "tenant_ns_ip": "10.1.12.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s2if", "tenant_sub_ip": "10.1.12.2/24"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, {"brif": "t2br2if1", "disk": "10G", "mem": 3, "name": "t2_VM3", "vcpu": 2, "vmif": "t2VM3if1"}], "skip_reason": "Conditional result was False"}

TASK [Create VM] ********************************************************************************************************************************************
skipping: [localhost] => (item=[{u'route': [{u'ip': u'10.1.11.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.1.11.1', u'bridge_name': u't2br1', u'dns': [{u'dnsif': u't2s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't2s1_dnsbrif'}], u'ns_name': u't2ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.11.2/24', u'tenant_ns_ip': u'10.1.11.1/24', u'tenant_ns_if': u't2ns1if', u'tenant_sub_if': u't2s1if', u'tenant_ns_name': u't2'}], u'bridge_ip': u'1.1.1.1', u'vxlan': [{u'local_ip': u'10.1.11.2', u'dsport': 4789, u'dev': u't2s1if', u'tenant_route_ip': u'192.168.2.2', u'remote_route': u'10.2.11.0/24', u'subnet_route': u'10.1.11.0/24', u'v_name': u'vxlan_t2s1', u'id': 42, u'remote_ip': u'10.2.11.2'}]}, {u'mem': 2, u'name': u't2_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't2br1if1', u'vmif': u't2VM1if1'}])  => {"ansible_loop_var": "item", "changed": false, "item": [{"bridge_ip": "1.1.1.1", "bridge_name": "t2br1", "default_route_ip": "10.1.11.1", "dns": [{"brif": "t2s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t2s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns1", "route": [{"if": "p1", "ip": "10.1.11.1/24", "ns_if": "t2if", "ns_name": "t2"}], "tenant_ns": [{"tenant_ns_if": "t2ns1if", "tenant_ns_ip": "10.1.11.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s1if", "tenant_sub_ip": "10.1.11.2/24"}], "vxlan": [{"dev": "t2s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.11.2", "remote_ip": "10.2.11.2", "remote_route": "10.2.11.0/24", "subnet_route": "10.1.11.0/24", "tenant_route_ip": "192.168.2.2", "v_name": "vxlan_t2s1"}]}, {"brif": "t2br1if1", "disk": "10G", "mem": 2, "name": "t2_VM1", "vcpu": 4, "vmif": "t2VM1if1"}], "skip_reason": "Conditional result was False"}
skipping: [localhost] => (item=[{u'route': [{u'ip': u'10.1.11.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.1.11.1', u'bridge_name': u't2br1', u'dns': [{u'dnsif': u't2s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't2s1_dnsbrif'}], u'ns_name': u't2ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.11.2/24', u'tenant_ns_ip': u'10.1.11.1/24', u'tenant_ns_if': u't2ns1if', u'tenant_sub_if': u't2s1if', u'tenant_ns_name': u't2'}], u'bridge_ip': u'1.1.1.1', u'vxlan': [{u'local_ip': u'10.1.11.2', u'dsport': 4789, u'dev': u't2s1if', u'tenant_route_ip': u'192.168.2.2', u'remote_route': u'10.2.11.0/24', u'subnet_route': u'10.1.11.0/24', u'v_name': u'vxlan_t2s1', u'id': 42, u'remote_ip': u'10.2.11.2'}]}, {u'mem': 4, u'name': u't2_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't2br1if2', u'vmif': u't2VM2if1'}])  => {"ansible_loop_var": "item", "changed": false, "item": [{"bridge_ip": "1.1.1.1", "bridge_name": "t2br1", "default_route_ip": "10.1.11.1", "dns": [{"brif": "t2s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t2s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns1", "route": [{"if": "p1", "ip": "10.1.11.1/24", "ns_if": "t2if", "ns_name": "t2"}], "tenant_ns": [{"tenant_ns_if": "t2ns1if", "tenant_ns_ip": "10.1.11.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s1if", "tenant_sub_ip": "10.1.11.2/24"}], "vxlan": [{"dev": "t2s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.11.2", "remote_ip": "10.2.11.2", "remote_route": "10.2.11.0/24", "subnet_route": "10.1.11.0/24", "tenant_route_ip": "192.168.2.2", "v_name": "vxlan_t2s1"}]}, {"brif": "t2br1if2", "disk": "10G", "mem": 4, "name": "t2_VM2", "vcpu": 2, "vmif": "t2VM2if1"}], "skip_reason": "Conditional result was False"}
skipping: [localhost] => (item=[{u'route': [{u'ip': u'10.1.12.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.1.12.1', u'bridge_name': u't2br2', u'dns': [{u'dnsif': u't2s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't2s2_dnsbrif'}], u'ns_name': u't2ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.12.2/24', u'tenant_ns_ip': u'10.1.12.1/24', u'tenant_ns_if': u't2ns2if', u'tenant_sub_if': u't2s2if', u'tenant_ns_name': u't2'}], u'bridge_ip': u'2.2.2.1', u'vxlan': [{u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}, {u'mem': 3, u'name': u't2_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't2br2if1', u'vmif': u't2VM3if1'}])  => {"ansible_loop_var": "item", "changed": false, "item": [{"bridge_ip": "2.2.2.1", "bridge_name": "t2br2", "default_route_ip": "10.1.12.1", "dns": [{"brif": "t2s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t2s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns2", "route": [{"if": "p1", "ip": "10.1.12.1/24", "ns_if": "t2if", "ns_name": "t2"}], "tenant_ns": [{"tenant_ns_if": "t2ns2if", "tenant_ns_ip": "10.1.12.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s2if", "tenant_sub_ip": "10.1.12.2/24"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, {"brif": "t2br2if1", "disk": "10G", "mem": 3, "name": "t2_VM3", "vcpu": 2, "vmif": "t2VM3if1"}], "skip_reason": "Conditional result was False"}

TASK [Start VM] *********************************************************************************************************************************************
skipping: [localhost] => (item=[{u'route': [{u'ip': u'10.1.11.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.1.11.1', u'bridge_name': u't2br1', u'dns': [{u'dnsif': u't2s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't2s1_dnsbrif'}], u'ns_name': u't2ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.11.2/24', u'tenant_ns_ip': u'10.1.11.1/24', u'tenant_ns_if': u't2ns1if', u'tenant_sub_if': u't2s1if', u'tenant_ns_name': u't2'}], u'bridge_ip': u'1.1.1.1', u'vxlan': [{u'local_ip': u'10.1.11.2', u'dsport': 4789, u'dev': u't2s1if', u'tenant_route_ip': u'192.168.2.2', u'remote_route': u'10.2.11.0/24', u'subnet_route': u'10.1.11.0/24', u'v_name': u'vxlan_t2s1', u'id': 42, u'remote_ip': u'10.2.11.2'}]}, {u'mem': 2, u'name': u't2_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't2br1if1', u'vmif': u't2VM1if1'}])  => {"ansible_loop_var": "item", "changed": false, "item": [{"bridge_ip": "1.1.1.1", "bridge_name": "t2br1", "default_route_ip": "10.1.11.1", "dns": [{"brif": "t2s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t2s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns1", "route": [{"if": "p1", "ip": "10.1.11.1/24", "ns_if": "t2if", "ns_name": "t2"}], "tenant_ns": [{"tenant_ns_if": "t2ns1if", "tenant_ns_ip": "10.1.11.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s1if", "tenant_sub_ip": "10.1.11.2/24"}], "vxlan": [{"dev": "t2s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.11.2", "remote_ip": "10.2.11.2", "remote_route": "10.2.11.0/24", "subnet_route": "10.1.11.0/24", "tenant_route_ip": "192.168.2.2", "v_name": "vxlan_t2s1"}]}, {"brif": "t2br1if1", "disk": "10G", "mem": 2, "name": "t2_VM1", "vcpu": 4, "vmif": "t2VM1if1"}], "skip_reason": "Conditional result was False"}
skipping: [localhost] => (item=[{u'route': [{u'ip': u'10.1.11.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.1.11.1', u'bridge_name': u't2br1', u'dns': [{u'dnsif': u't2s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't2s1_dnsbrif'}], u'ns_name': u't2ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.11.2/24', u'tenant_ns_ip': u'10.1.11.1/24', u'tenant_ns_if': u't2ns1if', u'tenant_sub_if': u't2s1if', u'tenant_ns_name': u't2'}], u'bridge_ip': u'1.1.1.1', u'vxlan': [{u'local_ip': u'10.1.11.2', u'dsport': 4789, u'dev': u't2s1if', u'tenant_route_ip': u'192.168.2.2', u'remote_route': u'10.2.11.0/24', u'subnet_route': u'10.1.11.0/24', u'v_name': u'vxlan_t2s1', u'id': 42, u'remote_ip': u'10.2.11.2'}]}, {u'mem': 4, u'name': u't2_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't2br1if2', u'vmif': u't2VM2if1'}])  => {"ansible_loop_var": "item", "changed": false, "item": [{"bridge_ip": "1.1.1.1", "bridge_name": "t2br1", "default_route_ip": "10.1.11.1", "dns": [{"brif": "t2s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t2s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns1", "route": [{"if": "p1", "ip": "10.1.11.1/24", "ns_if": "t2if", "ns_name": "t2"}], "tenant_ns": [{"tenant_ns_if": "t2ns1if", "tenant_ns_ip": "10.1.11.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s1if", "tenant_sub_ip": "10.1.11.2/24"}], "vxlan": [{"dev": "t2s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.11.2", "remote_ip": "10.2.11.2", "remote_route": "10.2.11.0/24", "subnet_route": "10.1.11.0/24", "tenant_route_ip": "192.168.2.2", "v_name": "vxlan_t2s1"}]}, {"brif": "t2br1if2", "disk": "10G", "mem": 4, "name": "t2_VM2", "vcpu": 2, "vmif": "t2VM2if1"}], "skip_reason": "Conditional result was False"}
skipping: [localhost] => (item=[{u'route': [{u'ip': u'10.1.12.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.1.12.1', u'bridge_name': u't2br2', u'dns': [{u'dnsif': u't2s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't2s2_dnsbrif'}], u'ns_name': u't2ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.12.2/24', u'tenant_ns_ip': u'10.1.12.1/24', u'tenant_ns_if': u't2ns2if', u'tenant_sub_if': u't2s2if', u'tenant_ns_name': u't2'}], u'bridge_ip': u'2.2.2.1', u'vxlan': [{u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}, {u'mem': 3, u'name': u't2_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't2br2if1', u'vmif': u't2VM3if1'}])  => {"ansible_loop_var": "item", "changed": false, "item": [{"bridge_ip": "2.2.2.1", "bridge_name": "t2br2", "default_route_ip": "10.1.12.1", "dns": [{"brif": "t2s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t2s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns2", "route": [{"if": "p1", "ip": "10.1.12.1/24", "ns_if": "t2if", "ns_name": "t2"}], "tenant_ns": [{"tenant_ns_if": "t2ns2if", "tenant_ns_ip": "10.1.12.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s2if", "tenant_sub_ip": "10.1.12.2/24"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, {"brif": "t2br2if1", "disk": "10G", "mem": 3, "name": "t2_VM3", "vcpu": 2, "vmif": "t2VM3if1"}], "skip_reason": "Conditional result was False"}

TASK [Attach VM interface] **********************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.11.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.1.11.1', u'bridge_name': u't2br1', u'dns': [{u'dnsif': u't2s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't2s1_dnsbrif'}], u'ns_name': u't2ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.11.2/24', u'tenant_ns_ip': u'10.1.11.1/24', u'tenant_ns_if': u't2ns1if', u'tenant_sub_if': u't2s1if', u'tenant_ns_name': u't2'}], u'bridge_ip': u'1.1.1.1', u'vxlan': [{u'local_ip': u'10.1.11.2', u'dsport': 4789, u'dev': u't2s1if', u'tenant_route_ip': u'192.168.2.2', u'remote_route': u'10.2.11.0/24', u'subnet_route': u'10.1.11.0/24', u'v_name': u'vxlan_t2s1', u'id': 42, u'remote_ip': u'10.2.11.2'}]}, {u'mem': 2, u'name': u't2_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't2br1if1', u'vmif': u't2VM1if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "virsh domiflist \"t2_VM1\" | grep -w 't2VM1if1' ; if [ $? -ne 0 ] ; then virsh attach-interface \"t2_VM1\" direct \"t2VM1if1\" --live --persistent ; fi\n", "delta": "0:00:00.023213", "end": "2019-11-17 10:23:10.828884", "item": [{"bridge_ip": "1.1.1.1", "bridge_name": "t2br1", "default_route_ip": "10.1.11.1", "dns": [{"brif": "t2s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t2s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns1", "route": [{"if": "p1", "ip": "10.1.11.1/24", "ns_if": "t2if", "ns_name": "t2"}], "tenant_ns": [{"tenant_ns_if": "t2ns1if", "tenant_ns_ip": "10.1.11.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s1if", "tenant_sub_ip": "10.1.11.2/24"}], "vxlan": [{"dev": "t2s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.11.2", "remote_ip": "10.2.11.2", "remote_route": "10.2.11.0/24", "subnet_route": "10.1.11.0/24", "tenant_route_ip": "192.168.2.2", "v_name": "vxlan_t2s1"}]}, {"brif": "t2br1if1", "disk": "10G", "mem": 2, "name": "t2_VM1", "vcpu": 4, "vmif": "t2VM1if1"}], "rc": 0, "start": "2019-11-17 10:23:10.805671", "stderr": "", "stderr_lines": [], "stdout": "macvtap3   direct     t2VM1if1   rtl8139     52:54:00:dd:5b:45", "stdout_lines": ["macvtap3   direct     t2VM1if1   rtl8139     52:54:00:dd:5b:45"]}
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.11.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.1.11.1', u'bridge_name': u't2br1', u'dns': [{u'dnsif': u't2s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't2s1_dnsbrif'}], u'ns_name': u't2ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.11.2/24', u'tenant_ns_ip': u'10.1.11.1/24', u'tenant_ns_if': u't2ns1if', u'tenant_sub_if': u't2s1if', u'tenant_ns_name': u't2'}], u'bridge_ip': u'1.1.1.1', u'vxlan': [{u'local_ip': u'10.1.11.2', u'dsport': 4789, u'dev': u't2s1if', u'tenant_route_ip': u'192.168.2.2', u'remote_route': u'10.2.11.0/24', u'subnet_route': u'10.1.11.0/24', u'v_name': u'vxlan_t2s1', u'id': 42, u'remote_ip': u'10.2.11.2'}]}, {u'mem': 4, u'name': u't2_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't2br1if2', u'vmif': u't2VM2if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "virsh domiflist \"t2_VM2\" | grep -w 't2VM2if1' ; if [ $? -ne 0 ] ; then virsh attach-interface \"t2_VM2\" direct \"t2VM2if1\" --live --persistent ; fi\n", "delta": "0:00:00.027712", "end": "2019-11-17 10:23:11.005001", "item": [{"bridge_ip": "1.1.1.1", "bridge_name": "t2br1", "default_route_ip": "10.1.11.1", "dns": [{"brif": "t2s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t2s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns1", "route": [{"if": "p1", "ip": "10.1.11.1/24", "ns_if": "t2if", "ns_name": "t2"}], "tenant_ns": [{"tenant_ns_if": "t2ns1if", "tenant_ns_ip": "10.1.11.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s1if", "tenant_sub_ip": "10.1.11.2/24"}], "vxlan": [{"dev": "t2s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.11.2", "remote_ip": "10.2.11.2", "remote_route": "10.2.11.0/24", "subnet_route": "10.1.11.0/24", "tenant_route_ip": "192.168.2.2", "v_name": "vxlan_t2s1"}]}, {"brif": "t2br1if2", "disk": "10G", "mem": 4, "name": "t2_VM2", "vcpu": 2, "vmif": "t2VM2if1"}], "rc": 0, "start": "2019-11-17 10:23:10.977289", "stderr": "", "stderr_lines": [], "stdout": "macvtap4   direct     t2VM2if1   rtl8139     52:54:00:d7:21:b5", "stdout_lines": ["macvtap4   direct     t2VM2if1   rtl8139     52:54:00:d7:21:b5"]}
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.12.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.1.12.1', u'bridge_name': u't2br2', u'dns': [{u'dnsif': u't2s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't2s2_dnsbrif'}], u'ns_name': u't2ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.12.2/24', u'tenant_ns_ip': u'10.1.12.1/24', u'tenant_ns_if': u't2ns2if', u'tenant_sub_if': u't2s2if', u'tenant_ns_name': u't2'}], u'bridge_ip': u'2.2.2.1', u'vxlan': [{u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}, {u'mem': 3, u'name': u't2_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't2br2if1', u'vmif': u't2VM3if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "virsh domiflist \"t2_VM3\" | grep -w 't2VM3if1' ; if [ $? -ne 0 ] ; then virsh attach-interface \"t2_VM3\" direct \"t2VM3if1\" --live --persistent ; fi\n", "delta": "0:00:00.023405", "end": "2019-11-17 10:23:11.216468", "item": [{"bridge_ip": "2.2.2.1", "bridge_name": "t2br2", "default_route_ip": "10.1.12.1", "dns": [{"brif": "t2s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t2s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns2", "route": [{"if": "p1", "ip": "10.1.12.1/24", "ns_if": "t2if", "ns_name": "t2"}], "tenant_ns": [{"tenant_ns_if": "t2ns2if", "tenant_ns_ip": "10.1.12.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s2if", "tenant_sub_ip": "10.1.12.2/24"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, {"brif": "t2br2if1", "disk": "10G", "mem": 3, "name": "t2_VM3", "vcpu": 2, "vmif": "t2VM3if1"}], "rc": 0, "start": "2019-11-17 10:23:11.193063", "stderr": "", "stderr_lines": [], "stdout": "macvtap5   direct     t2VM3if1   rtl8139     52:54:00:3b:23:70", "stdout_lines": ["macvtap5   direct     t2VM3if1   rtl8139     52:54:00:3b:23:70"]}

PLAY RECAP **************************************************************************************************************************************************
localhost                  : ok=4    changed=1    unreachable=0    failed=0    skipped=3    rescued=0    ignored=0   

Using /etc/ansible/ansible.cfg as config file

PLAY [worker] ***********************************************************************************************************************************************

TASK [Copy VM image] ****************************************************************************************************************************************
ok: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.11.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.2.11.1', u'bridge_name': u't2br1', u'dns': [{u'dnsif': u't2s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't2s1_dnsbrif'}], u'ns_name': u't2ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.11.2/24', u'tenant_ns_ip': u'10.2.11.1/24', u'tenant_ns_if': u't2ns1if', u'tenant_sub_if': u't2s1if', u'tenant_ns_name': u't2'}], u'bridge_ip': u'1.1.1.1', u'vxlan': [{u'local_ip': u'10.2.11.2', u'dsport': 4789, u'dev': u't2s1if', u'tenant_route_ip': u'192.168.130.2', u'remote_route': u'10.1.11.0/24', u'subnet_route': u'10.2.11.0/24', u'v_name': u'vxlan_t2s1', u'id': 42, u'remote_ip': u'10.1.11.2'}]}, {u'mem': 2, u'name': u't2_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't2br1if1', u'vmif': u't2VM4if1'}]) => {"ansible_loop_var": "item", "changed": false, "dest": "/var/lib/libvirt/images/t2_VM4.qcow2", "gid": 0, "group": "root", "item": [{"bridge_ip": "1.1.1.1", "bridge_name": "t2br1", "default_route_ip": "10.2.11.1", "dns": [{"brif": "t2s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t2s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns1", "route": [{"if": "p1", "ip": "10.2.11.1/24", "ns_if": "t2if", "ns_name": "t2"}], "tenant_ns": [{"tenant_ns_if": "t2ns1if", "tenant_ns_ip": "10.2.11.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s1if", "tenant_sub_ip": "10.2.11.2/24"}], "vxlan": [{"dev": "t2s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.11.2", "remote_ip": "10.1.11.2", "remote_route": "10.1.11.0/24", "subnet_route": "10.2.11.0/24", "tenant_route_ip": "192.168.130.2", "v_name": "vxlan_t2s1"}]}, {"brif": "t2br1if1", "disk": "10G", "mem": 2, "name": "t2_VM4", "vcpu": 4, "vmif": "t2VM4if1"}], "mode": "0644", "msg": "file already exists", "owner": "root", "size": 10739318784, "src": "/root/mainVM.qcow2", "state": "file", "uid": 0}

TASK [Get list of running VMs] ******************************************************************************************************************************
ok: [99.99.99.2] => {"changed": false, "cmd": ["virsh", "list", "--name"], "delta": "0:00:00.025225", "end": "2019-11-17 10:23:54.890181", "rc": 0, "start": "2019-11-17 10:23:54.864956", "stderr": "", "stderr_lines": [], "stdout": "t1_VM4", "stdout_lines": ["t1_VM4"]}

TASK [Define VM] ********************************************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.11.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.2.11.1', u'bridge_name': u't2br1', u'dns': [{u'dnsif': u't2s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't2s1_dnsbrif'}], u'ns_name': u't2ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.11.2/24', u'tenant_ns_ip': u'10.2.11.1/24', u'tenant_ns_if': u't2ns1if', u'tenant_sub_if': u't2s1if', u'tenant_ns_name': u't2'}], u'bridge_ip': u'1.1.1.1', u'vxlan': [{u'local_ip': u'10.2.11.2', u'dsport': 4789, u'dev': u't2s1if', u'tenant_route_ip': u'192.168.130.2', u'remote_route': u'10.1.11.0/24', u'subnet_route': u'10.2.11.0/24', u'v_name': u'vxlan_t2s1', u'id': 42, u'remote_ip': u'10.1.11.2'}]}, {u'mem': 2, u'name': u't2_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't2br1if1', u'vmif': u't2VM4if1'}]) => {"ansible_loop_var": "item", "changed": true, "created": "t2_VM4", "item": [{"bridge_ip": "1.1.1.1", "bridge_name": "t2br1", "default_route_ip": "10.2.11.1", "dns": [{"brif": "t2s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t2s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns1", "route": [{"if": "p1", "ip": "10.2.11.1/24", "ns_if": "t2if", "ns_name": "t2"}], "tenant_ns": [{"tenant_ns_if": "t2ns1if", "tenant_ns_ip": "10.2.11.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s1if", "tenant_sub_ip": "10.2.11.2/24"}], "vxlan": [{"dev": "t2s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.11.2", "remote_ip": "10.1.11.2", "remote_route": "10.1.11.0/24", "subnet_route": "10.2.11.0/24", "tenant_route_ip": "192.168.130.2", "v_name": "vxlan_t2s1"}]}, {"brif": "t2br1if1", "disk": "10G", "mem": 2, "name": "t2_VM4", "vcpu": 4, "vmif": "t2VM4if1"}], "warnings": ["'xml' is given - ignoring 'name'"]}

TASK [Create VM] ********************************************************************************************************************************************
ok: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.11.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.2.11.1', u'bridge_name': u't2br1', u'dns': [{u'dnsif': u't2s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't2s1_dnsbrif'}], u'ns_name': u't2ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.11.2/24', u'tenant_ns_ip': u'10.2.11.1/24', u'tenant_ns_if': u't2ns1if', u'tenant_sub_if': u't2s1if', u'tenant_ns_name': u't2'}], u'bridge_ip': u'1.1.1.1', u'vxlan': [{u'local_ip': u'10.2.11.2', u'dsport': 4789, u'dev': u't2s1if', u'tenant_route_ip': u'192.168.130.2', u'remote_route': u'10.1.11.0/24', u'subnet_route': u'10.2.11.0/24', u'v_name': u'vxlan_t2s1', u'id': 42, u'remote_ip': u'10.1.11.2'}]}, {u'mem': 2, u'name': u't2_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't2br1if1', u'vmif': u't2VM4if1'}]) => {"ansible_loop_var": "item", "changed": false, "create": 0, "item": [{"bridge_ip": "1.1.1.1", "bridge_name": "t2br1", "default_route_ip": "10.2.11.1", "dns": [{"brif": "t2s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t2s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns1", "route": [{"if": "p1", "ip": "10.2.11.1/24", "ns_if": "t2if", "ns_name": "t2"}], "tenant_ns": [{"tenant_ns_if": "t2ns1if", "tenant_ns_ip": "10.2.11.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s1if", "tenant_sub_ip": "10.2.11.2/24"}], "vxlan": [{"dev": "t2s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.11.2", "remote_ip": "10.1.11.2", "remote_route": "10.1.11.0/24", "subnet_route": "10.2.11.0/24", "tenant_route_ip": "192.168.130.2", "v_name": "vxlan_t2s1"}]}, {"brif": "t2br1if1", "disk": "10G", "mem": 2, "name": "t2_VM4", "vcpu": 4, "vmif": "t2VM4if1"}]}

TASK [Start VM] *********************************************************************************************************************************************
ok: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.11.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.2.11.1', u'bridge_name': u't2br1', u'dns': [{u'dnsif': u't2s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't2s1_dnsbrif'}], u'ns_name': u't2ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.11.2/24', u'tenant_ns_ip': u'10.2.11.1/24', u'tenant_ns_if': u't2ns1if', u'tenant_sub_if': u't2s1if', u'tenant_ns_name': u't2'}], u'bridge_ip': u'1.1.1.1', u'vxlan': [{u'local_ip': u'10.2.11.2', u'dsport': 4789, u'dev': u't2s1if', u'tenant_route_ip': u'192.168.130.2', u'remote_route': u'10.1.11.0/24', u'subnet_route': u'10.2.11.0/24', u'v_name': u'vxlan_t2s1', u'id': 42, u'remote_ip': u'10.1.11.2'}]}, {u'mem': 2, u'name': u't2_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't2br1if1', u'vmif': u't2VM4if1'}]) => {"ansible_loop_var": "item", "changed": false, "item": [{"bridge_ip": "1.1.1.1", "bridge_name": "t2br1", "default_route_ip": "10.2.11.1", "dns": [{"brif": "t2s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t2s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns1", "route": [{"if": "p1", "ip": "10.2.11.1/24", "ns_if": "t2if", "ns_name": "t2"}], "tenant_ns": [{"tenant_ns_if": "t2ns1if", "tenant_ns_ip": "10.2.11.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s1if", "tenant_sub_ip": "10.2.11.2/24"}], "vxlan": [{"dev": "t2s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.11.2", "remote_ip": "10.1.11.2", "remote_route": "10.1.11.0/24", "subnet_route": "10.2.11.0/24", "tenant_route_ip": "192.168.130.2", "v_name": "vxlan_t2s1"}]}, {"brif": "t2br1if1", "disk": "10G", "mem": 2, "name": "t2_VM4", "vcpu": 4, "vmif": "t2VM4if1"}]}

TASK [Attach VM interface] **********************************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.11.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.2.11.1', u'bridge_name': u't2br1', u'dns': [{u'dnsif': u't2s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't2s1_dnsbrif'}], u'ns_name': u't2ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.11.2/24', u'tenant_ns_ip': u'10.2.11.1/24', u'tenant_ns_if': u't2ns1if', u'tenant_sub_if': u't2s1if', u'tenant_ns_name': u't2'}], u'bridge_ip': u'1.1.1.1', u'vxlan': [{u'local_ip': u'10.2.11.2', u'dsport': 4789, u'dev': u't2s1if', u'tenant_route_ip': u'192.168.130.2', u'remote_route': u'10.1.11.0/24', u'subnet_route': u'10.2.11.0/24', u'v_name': u'vxlan_t2s1', u'id': 42, u'remote_ip': u'10.1.11.2'}]}, {u'mem': 2, u'name': u't2_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't2br1if1', u'vmif': u't2VM4if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "virsh domiflist \"t2_VM4\" | grep -w 't2VM4if1' ; if [ $? -ne 0 ] ; then virsh attach-interface \"t2_VM4\" direct \"t2VM4if1\" --live --persistent ; fi\n", "delta": "0:00:00.237527", "end": "2019-11-17 10:23:57.273200", "item": [{"bridge_ip": "1.1.1.1", "bridge_name": "t2br1", "default_route_ip": "10.2.11.1", "dns": [{"brif": "t2s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t2s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns1", "route": [{"if": "p1", "ip": "10.2.11.1/24", "ns_if": "t2if", "ns_name": "t2"}], "tenant_ns": [{"tenant_ns_if": "t2ns1if", "tenant_ns_ip": "10.2.11.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s1if", "tenant_sub_ip": "10.2.11.2/24"}], "vxlan": [{"dev": "t2s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.11.2", "remote_ip": "10.1.11.2", "remote_route": "10.1.11.0/24", "subnet_route": "10.2.11.0/24", "tenant_route_ip": "192.168.130.2", "v_name": "vxlan_t2s1"}]}, {"brif": "t2br1if1", "disk": "10G", "mem": 2, "name": "t2_VM4", "vcpu": 4, "vmif": "t2VM4if1"}], "rc": 0, "start": "2019-11-17 10:23:57.035673", "stderr": "", "stderr_lines": [], "stdout": "Interface attached successfully", "stdout_lines": ["Interface attached successfully"]}

PLAY RECAP **************************************************************************************************************************************************
99.99.99.2                 : ok=6    changed=2    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0   

INFO:root: 10:24:18.081500 Printing the yaml input file
INFO:root: 10:24:18.081585 Printing the yaml input file
INFO:root: 10:24:18.081697 {'C1': [{'subnet_addr': '1.1.1.0/24', 'VM': [{'name': 'VM1', 'disk': '10G', 'mem': 2, 'vcpu': 4}, {'name': 'VM2', 'disk': '10G', 'mem': 4, 'vcpu': 2}]}, {'subnet_addr': '2.2.2.0/24', 'VM': [{'name': 'VM3', 'disk': '10G', 'mem': 3, 'vcpu': 2}]}], 'C2': [{'subnet_addr': '1.1.1.0/24', 'VM': [{'name': 'VM4', 'disk': '10G', 'mem': 2, 'vcpu': 4}]}]}
INFO:root: 10:24:18.081737 {'C1': [{'subnet_addr': '1.1.1.0/24', 'VM': [{'name': 'VM1', 'disk': '10G', 'mem': 2, 'vcpu': 4}, {'name': 'VM2', 'disk': '10G', 'mem': 4, 'vcpu': 2}]}, {'subnet_addr': '2.2.2.0/24', 'VM': [{'name': 'VM3', 'disk': '10G', 'mem': 3, 'vcpu': 2}]}], 'C2': [{'subnet_addr': '1.1.1.0/24', 'VM': [{'name': 'VM4', 'disk': '10G', 'mem': 2, 'vcpu': 4}]}]}
INFO:root: 10:24:18.081821 Provided subnet in C1: 1.1.1.0/24 is valid
ERROR:root: 10:24:18.081907Multiple subnet in the C1 are same
INFO:root: 10:24:18.082040 Provided subnet in C1: 1.1.1.0/24 is valid
ERROR:root: 10:24:18.082203Multiple subnet in the C1 are same
Using /etc/ansible/ansible.cfg as config file
Using /etc/ansible/ansible.cfg as config file

PLAY [main] *************************************************************************************************************************************************

PLAY [main] *************************************************************************************************************************************************

TASK [Create Tenant Namespace] ******************************************************************************************************************************

TASK [Create Tenant Namespace] ******************************************************************************************************************************
failed: [localhost] (item={u'default_route_ip': u'192.168.3.1', u'name': u't3', u'pns_ip': u'192.168.3.1/24', u'tenant_if': u't3if', u'tenant_ip': u'192.168.3.2/24', u'pns_if': u't3pns_if'}) => {"ansible_loop_var": "item", "changed": true, "cmd": ["ip", "netns", "add", "t3"], "delta": "0:00:00.002817", "end": "2019-11-17 10:24:19.290168", "item": {"default_route_ip": "192.168.3.1", "name": "t3", "pns_if": "t3pns_if", "pns_ip": "192.168.3.1/24", "tenant_if": "t3if", "tenant_ip": "192.168.3.2/24"}, "msg": "non-zero return code", "rc": 1, "start": "2019-11-17 10:24:19.287351", "stderr": "Cannot create namespace file \"/var/run/netns/t3\": File exists", "stderr_lines": ["Cannot create namespace file \"/var/run/netns/t3\": File exists"], "stdout": "", "stdout_lines": []}

PLAY RECAP **************************************************************************************************************************************************
localhost                  : ok=0    changed=0    unreachable=0    failed=1    skipped=0    rescued=0    ignored=0   

changed: [localhost] => (item={u'default_route_ip': u'192.168.3.1', u'name': u't3', u'pns_ip': u'192.168.3.1/24', u'tenant_if': u't3if', u'tenant_ip': u'192.168.3.2/24', u'pns_if': u't3pns_if'}) => {"ansible_loop_var": "item", "changed": true, "cmd": ["ip", "netns", "add", "t3"], "delta": "0:00:00.063015", "end": "2019-11-17 10:24:19.349364", "item": {"default_route_ip": "192.168.3.1", "name": "t3", "pns_if": "t3pns_if", "pns_ip": "192.168.3.1/24", "tenant_if": "t3if", "tenant_ip": "192.168.3.2/24"}, "rc": 0, "start": "2019-11-17 10:24:19.286349", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Create Subnet Namespace] ******************************************************************************************************************************
Using /etc/ansible/ansible.cfg as config file
changed: [localhost] => (item={u'route': [{u'ip': u'10.1.21.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.1.21.1', u'bridge_name': u't3br1', u'dns': [{u'dnsif': u't3s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't3s1_dnsbrif'}], u'ns_name': u't3ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.21.2/24', u'tenant_ns_ip': u'10.1.21.1/24', u'tenant_ns_if': u't3ns1if', u'tenant_ns_name': u't3', u'tenant_sub_if': u't3s1if'}], u'bridge_ip': u'1.1.1.1', u'vms': [{u'mem': 2, u'name': u't3_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't3br1if1', u'vmif': u't3VM1if1'}, {u'mem': 4, u'name': u't3_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't3br1if2', u'vmif': u't3VM2if1'}], u'vxlan': [{u'local_ip': u'10.1.21.2', u'tenant_route_ip': u'192.168.3.2', u'dsport': 4789, u'dev': u't3s1if', u'subnet_route': u'10.1.21.0/24', u'remote_route': u'10.2.21.0/24', u'v_name': u'vxlan_t3s1', u'id': 42, u'remote_ip': u'10.2.21.2'}]}) => {"ansible_loop_var": "item", "changed": true, "cmd": ["ip", "netns", "add", "t3ns1"], "delta": "0:00:00.065793", "end": "2019-11-17 10:24:19.687976", "item": {"bridge_ip": "1.1.1.1", "bridge_name": "t3br1", "default_route_ip": "10.1.21.1", "dns": [{"brif": "t3s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t3s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t3ns1", "route": [{"if": "p1", "ip": "10.1.21.1/24", "ns_if": "t3if", "ns_name": "t3"}], "tenant_ns": [{"tenant_ns_if": "t3ns1if", "tenant_ns_ip": "10.1.21.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s1if", "tenant_sub_ip": "10.1.21.2/24"}], "vms": [{"brif": "t3br1if1", "disk": "10G", "mem": 2, "name": "t3_VM1", "vcpu": 4, "vmif": "t3VM1if1"}, {"brif": "t3br1if2", "disk": "10G", "mem": 4, "name": "t3_VM2", "vcpu": 2, "vmif": "t3VM2if1"}], "vxlan": [{"dev": "t3s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.21.2", "remote_ip": "10.2.21.2", "remote_route": "10.2.21.0/24", "subnet_route": "10.1.21.0/24", "tenant_route_ip": "192.168.3.2", "v_name": "vxlan_t3s1"}]}, "rc": 0, "start": "2019-11-17 10:24:19.622183", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

PLAY [worker] ***********************************************************************************************************************************************

TASK [Create Tenant Namespace] ******************************************************************************************************************************
changed: [localhost] => (item={u'route': [{u'ip': u'10.1.22.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.1.22.1', u'bridge_name': u't3br2', u'dns': [{u'dnsif': u't3s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't3s2_dnsbrif'}], u'ns_name': u't3ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.22.2/24', u'tenant_ns_ip': u'10.1.22.1/24', u'tenant_ns_if': u't3ns2if', u'tenant_ns_name': u't3', u'tenant_sub_if': u't3s2if'}], u'bridge_ip': u'2.2.2.1', u'vms': [{u'mem': 3, u'name': u't3_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't3br2if1', u'vmif': u't3VM3if1'}], u'vxlan': [{u'local_ip': [], u'tenant_route_ip': [], u'dsport': [], u'dev': [], u'subnet_route': [], u'remote_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}) => {"ansible_loop_var": "item", "changed": true, "cmd": ["ip", "netns", "add", "t3ns2"], "delta": "0:00:00.071077", "end": "2019-11-17 10:24:19.955949", "item": {"bridge_ip": "2.2.2.1", "bridge_name": "t3br2", "default_route_ip": "10.1.22.1", "dns": [{"brif": "t3s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t3s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t3ns2", "route": [{"if": "p1", "ip": "10.1.22.1/24", "ns_if": "t3if", "ns_name": "t3"}], "tenant_ns": [{"tenant_ns_if": "t3ns2if", "tenant_ns_ip": "10.1.22.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s2if", "tenant_sub_ip": "10.1.22.2/24"}], "vms": [{"brif": "t3br2if1", "disk": "10G", "mem": 3, "name": "t3_VM3", "vcpu": 2, "vmif": "t3VM3if1"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, "rc": 0, "start": "2019-11-17 10:24:19.884872", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Create Tenant VETH pairs] *****************************************************************************************************************************
changed: [localhost] => (item={u'default_route_ip': u'192.168.3.1', u'name': u't3', u'pns_ip': u'192.168.3.1/24', u'tenant_if': u't3if', u'tenant_ip': u'192.168.3.2/24', u'pns_if': u't3pns_if'}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip link show \"t3if\" ; if [ $? -ne 0 ] ; then ip link add \"t3if\" type veth peer name \"t3pns_if\" ; fi\n", "delta": "0:00:00.017015", "end": "2019-11-17 10:24:20.275038", "item": {"default_route_ip": "192.168.3.1", "name": "t3", "pns_if": "t3pns_if", "pns_ip": "192.168.3.1/24", "tenant_if": "t3if", "tenant_ip": "192.168.3.2/24"}, "rc": 0, "start": "2019-11-17 10:24:20.258023", "stderr": "Device \"t3if\" does not exist.", "stderr_lines": ["Device \"t3if\" does not exist."], "stdout": "", "stdout_lines": []}

TASK [Attach Tenant VETH Pairs] *****************************************************************************************************************************
changed: [99.99.99.2] => (item={u'default_route_ip': u'192.168.131.1', u'name': u't3', u'pns_ip': u'192.168.131.1/24', u'tenant_if': u't3if', u'tenant_ip': u'192.168.131.2/24', u'pns_if': u't3pns_if'}) => {"ansible_loop_var": "item", "changed": true, "cmd": ["ip", "netns", "add", "t3"], "delta": "0:00:00.060687", "end": "2019-11-17 10:24:20.530854", "item": {"default_route_ip": "192.168.131.1", "name": "t3", "pns_if": "t3pns_if", "pns_ip": "192.168.131.1/24", "tenant_if": "t3if", "tenant_ip": "192.168.131.2/24"}, "rc": 0, "start": "2019-11-17 10:24:20.470167", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Create Subnet Namespace] ******************************************************************************************************************************
changed: [localhost] => (item={u'default_route_ip': u'192.168.3.1', u'name': u't3', u'pns_ip': u'192.168.3.1/24', u'tenant_if': u't3if', u'tenant_ip': u'192.168.3.2/24', u'pns_if': u't3pns_if'}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec pns ip link show \"t3pns_if\" ; if [ $? -ne 0 ] ; then ip link set \"t3pns_if\" netns pns ; fi\nip netns exec \"t3\" ip link show \"t3if\" ; if [ $? -ne 0 ] ; then ip link set \"t3if\" netns \"t3\" ; fi\nip netns exec pns ip link set dev \"t3pns_if\" up\nip netns exec \"t3\" ip link set dev \"t3if\" up\n", "delta": "0:00:00.190167", "end": "2019-11-17 10:24:20.771542", "item": {"default_route_ip": "192.168.3.1", "name": "t3", "pns_if": "t3pns_if", "pns_ip": "192.168.3.1/24", "tenant_if": "t3if", "tenant_ip": "192.168.3.2/24"}, "rc": 0, "start": "2019-11-17 10:24:20.581375", "stderr": "Device \"t3pns_if\" does not exist.\nDevice \"t3if\" does not exist.", "stderr_lines": ["Device \"t3pns_if\" does not exist.", "Device \"t3if\" does not exist."], "stdout": "", "stdout_lines": []}

TASK [Add IP addresses to Tenant VETH Pairs] ****************************************************************************************************************
changed: [99.99.99.2] => (item={u'route': [{u'ip': u'10.2.21.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.2.21.1', u'bridge_name': u't3br1', u'dns': [{u'dnsif': u't3s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't3s1_dnsbrif'}], u'ns_name': u't3ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.21.2/24', u'tenant_ns_ip': u'10.2.21.1/24', u'tenant_ns_if': u't3ns1if', u'tenant_ns_name': u't3', u'tenant_sub_if': u't3s1if'}], u'bridge_ip': u'1.1.1.1', u'vms': [{u'mem': 2, u'name': u't3_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't3br1if1', u'vmif': u't3VM4if1'}], u'vxlan': [{u'local_ip': u'10.2.21.2', u'tenant_route_ip': u'192.168.131.2', u'dsport': 4789, u'dev': u't3s1if', u'subnet_route': u'10.2.21.0/24', u'remote_route': u'10.1.21.0/24', u'v_name': u'vxlan_t3s1', u'id': 42, u'remote_ip': u'10.1.21.2'}]}) => {"ansible_loop_var": "item", "changed": true, "cmd": ["ip", "netns", "add", "t3ns1"], "delta": "0:00:00.073088", "end": "2019-11-17 10:24:20.993932", "item": {"bridge_ip": "1.1.1.1", "bridge_name": "t3br1", "default_route_ip": "10.2.21.1", "dns": [{"brif": "t3s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t3s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "ns_name": "t3ns1", "route": [{"if": "p1", "ip": "10.2.21.1/24", "ns_if": "t3if", "ns_name": "t3"}], "tenant_ns": [{"tenant_ns_if": "t3ns1if", "tenant_ns_ip": "10.2.21.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s1if", "tenant_sub_ip": "10.2.21.2/24"}], "vms": [{"brif": "t3br1if1", "disk": "10G", "mem": 2, "name": "t3_VM4", "vcpu": 4, "vmif": "t3VM4if1"}], "vxlan": [{"dev": "t3s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.21.2", "remote_ip": "10.1.21.2", "remote_route": "10.1.21.0/24", "subnet_route": "10.2.21.0/24", "tenant_route_ip": "192.168.131.2", "v_name": "vxlan_t3s1"}]}, "rc": 0, "start": "2019-11-17 10:24:20.920844", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Create Tenant VETH pairs] *****************************************************************************************************************************
changed: [localhost] => (item={u'default_route_ip': u'192.168.3.1', u'name': u't3', u'pns_ip': u'192.168.3.1/24', u'tenant_if': u't3if', u'tenant_ip': u'192.168.3.2/24', u'pns_if': u't3pns_if'}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec pns ip addr show \"t3pns_if\" | awk 'FNR==3{ print $2 }' | grep -w '^192.168.3.1/24' ; if [ $? -ne 0 ] ; then ip netns exec pns ip addr add \"192.168.3.1/24\" dev \"t3pns_if\" ; fi\nip netns exec \"t3\" ip addr show \"t3if\" | awk 'FNR==3{ print $2 }' | grep -w '^192.168.3.2/24' ; if [ $? -ne 0 ] ; then ip netns exec \"t3\" ip addr add \"192.168.3.2/24\" dev \"t3if\" ; fi\n", "delta": "0:00:00.194925", "end": "2019-11-17 10:24:21.243678", "item": {"default_route_ip": "192.168.3.1", "name": "t3", "pns_if": "t3pns_if", "pns_ip": "192.168.3.1/24", "tenant_if": "t3if", "tenant_ip": "192.168.3.2/24"}, "rc": 0, "start": "2019-11-17 10:24:21.048753", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Create Namespace VETH Pairs] **************************************************************************************************************************
changed: [99.99.99.2] => (item={u'default_route_ip': u'192.168.131.1', u'name': u't3', u'pns_ip': u'192.168.131.1/24', u'tenant_if': u't3if', u'tenant_ip': u'192.168.131.2/24', u'pns_if': u't3pns_if'}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip link show \"t3if\" ; if [ $? -ne 0 ] ; then ip link add \"t3if\" type veth peer name \"t3pns_if\" ; fi\n", "delta": "0:00:00.016167", "end": "2019-11-17 10:24:21.399210", "item": {"default_route_ip": "192.168.131.1", "name": "t3", "pns_if": "t3pns_if", "pns_ip": "192.168.131.1/24", "tenant_if": "t3if", "tenant_ip": "192.168.131.2/24"}, "rc": 0, "start": "2019-11-17 10:24:21.383043", "stderr": "Device \"t3if\" does not exist.", "stderr_lines": ["Device \"t3if\" does not exist."], "stdout": "", "stdout_lines": []}

TASK [Attach Tenant VETH Pairs] *****************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.21.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.1.21.1', u'bridge_name': u't3br1', u'dns': [{u'dnsif': u't3s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't3s1_dnsbrif'}], u'ns_name': u't3ns1', u'bridge_ip': u'1.1.1.1', u'vms': [{u'mem': 2, u'name': u't3_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't3br1if1', u'vmif': u't3VM1if1'}, {u'mem': 4, u'name': u't3_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't3br1if2', u'vmif': u't3VM2if1'}], u'vxlan': [{u'local_ip': u'10.1.21.2', u'dsport': 4789, u'dev': u't3s1if', u'tenant_route_ip': u'192.168.3.2', u'remote_route': u'10.2.21.0/24', u'subnet_route': u'10.1.21.0/24', u'v_name': u'vxlan_t3s1', u'id': 42, u'remote_ip': u'10.2.21.2'}]}, {u'tenant_sub_ip': u'10.1.21.2/24', u'tenant_ns_ip': u'10.1.21.1/24', u'tenant_ns_if': u't3ns1if', u'tenant_sub_if': u't3s1if', u'tenant_ns_name': u't3'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip link show \"t3ns1if\" ; if [ $? -ne 0 ] ; then ip link add \"t3ns1if\" type veth peer name \"t3s1if\" ; fi\n", "delta": "0:00:00.011690", "end": "2019-11-17 10:24:21.546241", "item": [{"bridge_ip": "1.1.1.1", "bridge_name": "t3br1", "default_route_ip": "10.1.21.1", "dns": [{"brif": "t3s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t3s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t3ns1", "route": [{"if": "p1", "ip": "10.1.21.1/24", "ns_if": "t3if", "ns_name": "t3"}], "vms": [{"brif": "t3br1if1", "disk": "10G", "mem": 2, "name": "t3_VM1", "vcpu": 4, "vmif": "t3VM1if1"}, {"brif": "t3br1if2", "disk": "10G", "mem": 4, "name": "t3_VM2", "vcpu": 2, "vmif": "t3VM2if1"}], "vxlan": [{"dev": "t3s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.21.2", "remote_ip": "10.2.21.2", "remote_route": "10.2.21.0/24", "subnet_route": "10.1.21.0/24", "tenant_route_ip": "192.168.3.2", "v_name": "vxlan_t3s1"}]}, {"tenant_ns_if": "t3ns1if", "tenant_ns_ip": "10.1.21.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s1if", "tenant_sub_ip": "10.1.21.2/24"}], "rc": 0, "start": "2019-11-17 10:24:21.534551", "stderr": "Device \"t3ns1if\" does not exist.", "stderr_lines": ["Device \"t3ns1if\" does not exist."], "stdout": "", "stdout_lines": []}
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.22.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.1.22.1', u'bridge_name': u't3br2', u'dns': [{u'dnsif': u't3s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't3s2_dnsbrif'}], u'ns_name': u't3ns2', u'bridge_ip': u'2.2.2.1', u'vms': [{u'mem': 3, u'name': u't3_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't3br2if1', u'vmif': u't3VM3if1'}], u'vxlan': [{u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}, {u'tenant_sub_ip': u'10.1.22.2/24', u'tenant_ns_ip': u'10.1.22.1/24', u'tenant_ns_if': u't3ns2if', u'tenant_sub_if': u't3s2if', u'tenant_ns_name': u't3'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip link show \"t3ns2if\" ; if [ $? -ne 0 ] ; then ip link add \"t3ns2if\" type veth peer name \"t3s2if\" ; fi\n", "delta": "0:00:00.010966", "end": "2019-11-17 10:24:21.796228", "item": [{"bridge_ip": "2.2.2.1", "bridge_name": "t3br2", "default_route_ip": "10.1.22.1", "dns": [{"brif": "t3s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t3s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t3ns2", "route": [{"if": "p1", "ip": "10.1.22.1/24", "ns_if": "t3if", "ns_name": "t3"}], "vms": [{"brif": "t3br2if1", "disk": "10G", "mem": 3, "name": "t3_VM3", "vcpu": 2, "vmif": "t3VM3if1"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, {"tenant_ns_if": "t3ns2if", "tenant_ns_ip": "10.1.22.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s2if", "tenant_sub_ip": "10.1.22.2/24"}], "rc": 0, "start": "2019-11-17 10:24:21.785262", "stderr": "Device \"t3ns2if\" does not exist.", "stderr_lines": ["Device \"t3ns2if\" does not exist."], "stdout": "", "stdout_lines": []}

TASK [Attach Namespace VETH Pairs] **************************************************************************************************************************
changed: [99.99.99.2] => (item={u'default_route_ip': u'192.168.131.1', u'name': u't3', u'pns_ip': u'192.168.131.1/24', u'tenant_if': u't3if', u'tenant_ip': u'192.168.131.2/24', u'pns_if': u't3pns_if'}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec pns ip link show \"t3pns_if\" ; if [ $? -ne 0 ] ; then ip link set \"t3pns_if\" netns pns ; fi\nip netns exec \"t3\" ip link show \"t3if\" ; if [ $? -ne 0 ] ; then ip link set \"t3if\" netns \"t3\" ; fi\nip netns exec pns ip link set dev \"t3pns_if\" up\nip netns exec \"t3\" ip link set dev \"t3if\" up\n", "delta": "0:00:00.200395", "end": "2019-11-17 10:24:22.008320", "item": {"default_route_ip": "192.168.131.1", "name": "t3", "pns_if": "t3pns_if", "pns_ip": "192.168.131.1/24", "tenant_if": "t3if", "tenant_ip": "192.168.131.2/24"}, "rc": 0, "start": "2019-11-17 10:24:21.807925", "stderr": "Device \"t3pns_if\" does not exist.\nDevice \"t3if\" does not exist.", "stderr_lines": ["Device \"t3pns_if\" does not exist.", "Device \"t3if\" does not exist."], "stdout": "", "stdout_lines": []}

TASK [Add IP addresses to Tenant VETH Pairs] ****************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.21.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.1.21.1', u'bridge_name': u't3br1', u'dns': [{u'dnsif': u't3s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't3s1_dnsbrif'}], u'ns_name': u't3ns1', u'bridge_ip': u'1.1.1.1', u'vms': [{u'mem': 2, u'name': u't3_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't3br1if1', u'vmif': u't3VM1if1'}, {u'mem': 4, u'name': u't3_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't3br1if2', u'vmif': u't3VM2if1'}], u'vxlan': [{u'local_ip': u'10.1.21.2', u'dsport': 4789, u'dev': u't3s1if', u'tenant_route_ip': u'192.168.3.2', u'remote_route': u'10.2.21.0/24', u'subnet_route': u'10.1.21.0/24', u'v_name': u'vxlan_t3s1', u'id': 42, u'remote_ip': u'10.2.21.2'}]}, {u'tenant_sub_ip': u'10.1.21.2/24', u'tenant_ns_ip': u'10.1.21.1/24', u'tenant_ns_if': u't3ns1if', u'tenant_sub_if': u't3s1if', u'tenant_ns_name': u't3'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t3\" ip link show \"t3ns1if\" ; if [ $? -ne 0 ] ; then ip link set \"t3ns1if\" netns \"t3\" ; fi\nip netns exec \"t3ns1\" ip link show \"t3s1if\" ; if [ $? -ne 0 ] ; then ip link set \"t3s1if\" netns \"t3ns1\" ; fi\n", "delta": "0:00:00.127497", "end": "2019-11-17 10:24:22.216581", "item": [{"bridge_ip": "1.1.1.1", "bridge_name": "t3br1", "default_route_ip": "10.1.21.1", "dns": [{"brif": "t3s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t3s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t3ns1", "route": [{"if": "p1", "ip": "10.1.21.1/24", "ns_if": "t3if", "ns_name": "t3"}], "vms": [{"brif": "t3br1if1", "disk": "10G", "mem": 2, "name": "t3_VM1", "vcpu": 4, "vmif": "t3VM1if1"}, {"brif": "t3br1if2", "disk": "10G", "mem": 4, "name": "t3_VM2", "vcpu": 2, "vmif": "t3VM2if1"}], "vxlan": [{"dev": "t3s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.21.2", "remote_ip": "10.2.21.2", "remote_route": "10.2.21.0/24", "subnet_route": "10.1.21.0/24", "tenant_route_ip": "192.168.3.2", "v_name": "vxlan_t3s1"}]}, {"tenant_ns_if": "t3ns1if", "tenant_ns_ip": "10.1.21.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s1if", "tenant_sub_ip": "10.1.21.2/24"}], "rc": 0, "start": "2019-11-17 10:24:22.089084", "stderr": "Device \"t3ns1if\" does not exist.\nDevice \"t3s1if\" does not exist.", "stderr_lines": ["Device \"t3ns1if\" does not exist.", "Device \"t3s1if\" does not exist."], "stdout": "", "stdout_lines": []}
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.22.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.1.22.1', u'bridge_name': u't3br2', u'dns': [{u'dnsif': u't3s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't3s2_dnsbrif'}], u'ns_name': u't3ns2', u'bridge_ip': u'2.2.2.1', u'vms': [{u'mem': 3, u'name': u't3_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't3br2if1', u'vmif': u't3VM3if1'}], u'vxlan': [{u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}, {u'tenant_sub_ip': u'10.1.22.2/24', u'tenant_ns_ip': u'10.1.22.1/24', u'tenant_ns_if': u't3ns2if', u'tenant_sub_if': u't3s2if', u'tenant_ns_name': u't3'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t3\" ip link show \"t3ns2if\" ; if [ $? -ne 0 ] ; then ip link set \"t3ns2if\" netns \"t3\" ; fi\nip netns exec \"t3ns2\" ip link show \"t3s2if\" ; if [ $? -ne 0 ] ; then ip link set \"t3s2if\" netns \"t3ns2\" ; fi\n", "delta": "0:00:00.121832", "end": "2019-11-17 10:24:22.534755", "item": [{"bridge_ip": "2.2.2.1", "bridge_name": "t3br2", "default_route_ip": "10.1.22.1", "dns": [{"brif": "t3s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t3s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t3ns2", "route": [{"if": "p1", "ip": "10.1.22.1/24", "ns_if": "t3if", "ns_name": "t3"}], "vms": [{"brif": "t3br2if1", "disk": "10G", "mem": 3, "name": "t3_VM3", "vcpu": 2, "vmif": "t3VM3if1"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, {"tenant_ns_if": "t3ns2if", "tenant_ns_ip": "10.1.22.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s2if", "tenant_sub_ip": "10.1.22.2/24"}], "rc": 0, "start": "2019-11-17 10:24:22.412923", "stderr": "Device \"t3ns2if\" does not exist.\nDevice \"t3s2if\" does not exist.", "stderr_lines": ["Device \"t3ns2if\" does not exist.", "Device \"t3s2if\" does not exist."], "stdout": "", "stdout_lines": []}

TASK [Set Namespace VETH Pairs UP] **************************************************************************************************************************
changed: [99.99.99.2] => (item={u'default_route_ip': u'192.168.131.1', u'name': u't3', u'pns_ip': u'192.168.131.1/24', u'tenant_if': u't3if', u'tenant_ip': u'192.168.131.2/24', u'pns_if': u't3pns_if'}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec pns ip addr show \"t3pns_if\" | awk 'FNR==3{ print $2 }' | grep -w '^192.168.131.1/24' ; if [ $? -ne 0 ] ; then ip netns exec pns ip addr add \"192.168.131.1/24\" dev \"t3pns_if\" ; fi\nip netns exec \"t3\" ip addr show \"t3if\" | awk 'FNR==3{ print $2 }' | grep -w '^192.168.131.2/24' ; if [ $? -ne 0 ] ; then ip netns exec \"t3\" ip addr add \"192.168.131.2/24\" dev \"t3if\" ; fi\n", "delta": "0:00:00.146859", "end": "2019-11-17 10:24:22.536563", "item": {"default_route_ip": "192.168.131.1", "name": "t3", "pns_if": "t3pns_if", "pns_ip": "192.168.131.1/24", "tenant_if": "t3if", "tenant_ip": "192.168.131.2/24"}, "rc": 0, "start": "2019-11-17 10:24:22.389704", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Create Namespace VETH Pairs] **************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.21.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.1.21.1', u'bridge_name': u't3br1', u'dns': [{u'dnsif': u't3s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't3s1_dnsbrif'}], u'ns_name': u't3ns1', u'bridge_ip': u'1.1.1.1', u'vms': [{u'mem': 2, u'name': u't3_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't3br1if1', u'vmif': u't3VM1if1'}, {u'mem': 4, u'name': u't3_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't3br1if2', u'vmif': u't3VM2if1'}], u'vxlan': [{u'local_ip': u'10.1.21.2', u'dsport': 4789, u'dev': u't3s1if', u'tenant_route_ip': u'192.168.3.2', u'remote_route': u'10.2.21.0/24', u'subnet_route': u'10.1.21.0/24', u'v_name': u'vxlan_t3s1', u'id': 42, u'remote_ip': u'10.2.21.2'}]}, {u'tenant_sub_ip': u'10.1.21.2/24', u'tenant_ns_ip': u'10.1.21.1/24', u'tenant_ns_if': u't3ns1if', u'tenant_sub_if': u't3s1if', u'tenant_ns_name': u't3'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t3\" ip link set dev \"t3ns1if\" up\nip netns exec \"t3ns1\" ip link set dev \"t3s1if\" up\n", "delta": "0:00:00.076457", "end": "2019-11-17 10:24:22.871666", "item": [{"bridge_ip": "1.1.1.1", "bridge_name": "t3br1", "default_route_ip": "10.1.21.1", "dns": [{"brif": "t3s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t3s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t3ns1", "route": [{"if": "p1", "ip": "10.1.21.1/24", "ns_if": "t3if", "ns_name": "t3"}], "vms": [{"brif": "t3br1if1", "disk": "10G", "mem": 2, "name": "t3_VM1", "vcpu": 4, "vmif": "t3VM1if1"}, {"brif": "t3br1if2", "disk": "10G", "mem": 4, "name": "t3_VM2", "vcpu": 2, "vmif": "t3VM2if1"}], "vxlan": [{"dev": "t3s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.21.2", "remote_ip": "10.2.21.2", "remote_route": "10.2.21.0/24", "subnet_route": "10.1.21.0/24", "tenant_route_ip": "192.168.3.2", "v_name": "vxlan_t3s1"}]}, {"tenant_ns_if": "t3ns1if", "tenant_ns_ip": "10.1.21.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s1if", "tenant_sub_ip": "10.1.21.2/24"}], "rc": 0, "start": "2019-11-17 10:24:22.795209", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.21.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.2.21.1', u'bridge_name': u't3br1', u'dns': [{u'dnsif': u't3s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't3s1_dnsbrif'}], u'ns_name': u't3ns1', u'bridge_ip': u'1.1.1.1', u'vms': [{u'mem': 2, u'name': u't3_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't3br1if1', u'vmif': u't3VM4if1'}], u'vxlan': [{u'local_ip': u'10.2.21.2', u'dsport': 4789, u'dev': u't3s1if', u'tenant_route_ip': u'192.168.131.2', u'remote_route': u'10.1.21.0/24', u'subnet_route': u'10.2.21.0/24', u'v_name': u'vxlan_t3s1', u'id': 42, u'remote_ip': u'10.1.21.2'}]}, {u'tenant_sub_ip': u'10.2.21.2/24', u'tenant_ns_ip': u'10.2.21.1/24', u'tenant_ns_if': u't3ns1if', u'tenant_sub_if': u't3s1if', u'tenant_ns_name': u't3'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip link show \"t3ns1if\" ; if [ $? -ne 0 ] ; then ip link add \"t3ns1if\" type veth peer name \"t3s1if\" ; fi\n", "delta": "0:00:00.011210", "end": "2019-11-17 10:24:22.943512", "item": [{"bridge_ip": "1.1.1.1", "bridge_name": "t3br1", "default_route_ip": "10.2.21.1", "dns": [{"brif": "t3s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t3s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "ns_name": "t3ns1", "route": [{"if": "p1", "ip": "10.2.21.1/24", "ns_if": "t3if", "ns_name": "t3"}], "vms": [{"brif": "t3br1if1", "disk": "10G", "mem": 2, "name": "t3_VM4", "vcpu": 4, "vmif": "t3VM4if1"}], "vxlan": [{"dev": "t3s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.21.2", "remote_ip": "10.1.21.2", "remote_route": "10.1.21.0/24", "subnet_route": "10.2.21.0/24", "tenant_route_ip": "192.168.131.2", "v_name": "vxlan_t3s1"}]}, {"tenant_ns_if": "t3ns1if", "tenant_ns_ip": "10.2.21.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s1if", "tenant_sub_ip": "10.2.21.2/24"}], "rc": 0, "start": "2019-11-17 10:24:22.932302", "stderr": "Device \"t3ns1if\" does not exist.", "stderr_lines": ["Device \"t3ns1if\" does not exist."], "stdout": "", "stdout_lines": []}

TASK [Attach Namespace VETH Pairs] **************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.22.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.1.22.1', u'bridge_name': u't3br2', u'dns': [{u'dnsif': u't3s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't3s2_dnsbrif'}], u'ns_name': u't3ns2', u'bridge_ip': u'2.2.2.1', u'vms': [{u'mem': 3, u'name': u't3_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't3br2if1', u'vmif': u't3VM3if1'}], u'vxlan': [{u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}, {u'tenant_sub_ip': u'10.1.22.2/24', u'tenant_ns_ip': u'10.1.22.1/24', u'tenant_ns_if': u't3ns2if', u'tenant_sub_if': u't3s2if', u'tenant_ns_name': u't3'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t3\" ip link set dev \"t3ns2if\" up\nip netns exec \"t3ns2\" ip link set dev \"t3s2if\" up\n", "delta": "0:00:00.090513", "end": "2019-11-17 10:24:23.175549", "item": [{"bridge_ip": "2.2.2.1", "bridge_name": "t3br2", "default_route_ip": "10.1.22.1", "dns": [{"brif": "t3s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t3s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t3ns2", "route": [{"if": "p1", "ip": "10.1.22.1/24", "ns_if": "t3if", "ns_name": "t3"}], "vms": [{"brif": "t3br2if1", "disk": "10G", "mem": 3, "name": "t3_VM3", "vcpu": 2, "vmif": "t3VM3if1"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, {"tenant_ns_if": "t3ns2if", "tenant_ns_ip": "10.1.22.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s2if", "tenant_sub_ip": "10.1.22.2/24"}], "rc": 0, "start": "2019-11-17 10:24:23.085036", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Add IP addresses to Namespace VETH Pairs] *************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.21.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.2.21.1', u'bridge_name': u't3br1', u'dns': [{u'dnsif': u't3s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't3s1_dnsbrif'}], u'ns_name': u't3ns1', u'bridge_ip': u'1.1.1.1', u'vms': [{u'mem': 2, u'name': u't3_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't3br1if1', u'vmif': u't3VM4if1'}], u'vxlan': [{u'local_ip': u'10.2.21.2', u'dsport': 4789, u'dev': u't3s1if', u'tenant_route_ip': u'192.168.131.2', u'remote_route': u'10.1.21.0/24', u'subnet_route': u'10.2.21.0/24', u'v_name': u'vxlan_t3s1', u'id': 42, u'remote_ip': u'10.1.21.2'}]}, {u'tenant_sub_ip': u'10.2.21.2/24', u'tenant_ns_ip': u'10.2.21.1/24', u'tenant_ns_if': u't3ns1if', u'tenant_sub_if': u't3s1if', u'tenant_ns_name': u't3'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t3\" ip link show \"t3ns1if\" ; if [ $? -ne 0 ] ; then ip link set \"t3ns1if\" netns \"t3\" ; fi\nip netns exec \"t3ns1\" ip link show \"t3s1if\" ; if [ $? -ne 0 ] ; then ip link set \"t3s1if\" netns \"t3ns1\" ; fi\n", "delta": "0:00:00.144527", "end": "2019-11-17 10:24:23.488175", "item": [{"bridge_ip": "1.1.1.1", "bridge_name": "t3br1", "default_route_ip": "10.2.21.1", "dns": [{"brif": "t3s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t3s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "ns_name": "t3ns1", "route": [{"if": "p1", "ip": "10.2.21.1/24", "ns_if": "t3if", "ns_name": "t3"}], "vms": [{"brif": "t3br1if1", "disk": "10G", "mem": 2, "name": "t3_VM4", "vcpu": 4, "vmif": "t3VM4if1"}], "vxlan": [{"dev": "t3s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.21.2", "remote_ip": "10.1.21.2", "remote_route": "10.1.21.0/24", "subnet_route": "10.2.21.0/24", "tenant_route_ip": "192.168.131.2", "v_name": "vxlan_t3s1"}]}, {"tenant_ns_if": "t3ns1if", "tenant_ns_ip": "10.2.21.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s1if", "tenant_sub_ip": "10.2.21.2/24"}], "rc": 0, "start": "2019-11-17 10:24:23.343648", "stderr": "Device \"t3ns1if\" does not exist.\nDevice \"t3s1if\" does not exist.", "stderr_lines": ["Device \"t3ns1if\" does not exist.", "Device \"t3s1if\" does not exist."], "stdout": "", "stdout_lines": []}

TASK [Set Namespace VETH Pairs UP] **************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.21.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.1.21.1', u'bridge_name': u't3br1', u'dns': [{u'dnsif': u't3s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't3s1_dnsbrif'}], u'ns_name': u't3ns1', u'bridge_ip': u'1.1.1.1', u'vms': [{u'mem': 2, u'name': u't3_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't3br1if1', u'vmif': u't3VM1if1'}, {u'mem': 4, u'name': u't3_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't3br1if2', u'vmif': u't3VM2if1'}], u'vxlan': [{u'local_ip': u'10.1.21.2', u'dsport': 4789, u'dev': u't3s1if', u'tenant_route_ip': u'192.168.3.2', u'remote_route': u'10.2.21.0/24', u'subnet_route': u'10.1.21.0/24', u'v_name': u'vxlan_t3s1', u'id': 42, u'remote_ip': u'10.2.21.2'}]}, {u'tenant_sub_ip': u'10.1.21.2/24', u'tenant_ns_ip': u'10.1.21.1/24', u'tenant_ns_if': u't3ns1if', u'tenant_sub_if': u't3s1if', u'tenant_ns_name': u't3'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t3ns1\" ip addr show \"t3s1if\" | awk 'FNR==3{ print $2 }' | grep -w '^10.1.21.2/24' ; if [ $? -ne 0 ] ; then ip netns exec \"t3ns1\" ip addr add \"10.1.21.2/24\" dev \"t3s1if\" ; fi\n\nip netns exec \"t3\" ip addr show \"t3ns1if\" | awk 'FNR==3{ print $2 }' | grep -w '^10.1.21.1/24' ; if [ $? -ne 0 ] ; then ip netns exec \"t3\" ip addr add \"10.1.21.1/24\" dev \"t3ns1if\" ; fi\n", "delta": "0:00:00.160461", "end": "2019-11-17 10:24:23.623729", "item": [{"bridge_ip": "1.1.1.1", "bridge_name": "t3br1", "default_route_ip": "10.1.21.1", "dns": [{"brif": "t3s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t3s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t3ns1", "route": [{"if": "p1", "ip": "10.1.21.1/24", "ns_if": "t3if", "ns_name": "t3"}], "vms": [{"brif": "t3br1if1", "disk": "10G", "mem": 2, "name": "t3_VM1", "vcpu": 4, "vmif": "t3VM1if1"}, {"brif": "t3br1if2", "disk": "10G", "mem": 4, "name": "t3_VM2", "vcpu": 2, "vmif": "t3VM2if1"}], "vxlan": [{"dev": "t3s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.21.2", "remote_ip": "10.2.21.2", "remote_route": "10.2.21.0/24", "subnet_route": "10.1.21.0/24", "tenant_route_ip": "192.168.3.2", "v_name": "vxlan_t3s1"}]}, {"tenant_ns_if": "t3ns1if", "tenant_ns_ip": "10.1.21.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s1if", "tenant_sub_ip": "10.1.21.2/24"}], "rc": 0, "start": "2019-11-17 10:24:23.463268", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.21.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.2.21.1', u'bridge_name': u't3br1', u'dns': [{u'dnsif': u't3s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't3s1_dnsbrif'}], u'ns_name': u't3ns1', u'bridge_ip': u'1.1.1.1', u'vms': [{u'mem': 2, u'name': u't3_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't3br1if1', u'vmif': u't3VM4if1'}], u'vxlan': [{u'local_ip': u'10.2.21.2', u'dsport': 4789, u'dev': u't3s1if', u'tenant_route_ip': u'192.168.131.2', u'remote_route': u'10.1.21.0/24', u'subnet_route': u'10.2.21.0/24', u'v_name': u'vxlan_t3s1', u'id': 42, u'remote_ip': u'10.1.21.2'}]}, {u'tenant_sub_ip': u'10.2.21.2/24', u'tenant_ns_ip': u'10.2.21.1/24', u'tenant_ns_if': u't3ns1if', u'tenant_sub_if': u't3s1if', u'tenant_ns_name': u't3'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t3\" ip link set dev \"t3ns1if\" up\nip netns exec \"t3ns1\" ip link set dev \"t3s1if\" up\n", "delta": "0:00:00.075773", "end": "2019-11-17 10:24:23.964359", "item": [{"bridge_ip": "1.1.1.1", "bridge_name": "t3br1", "default_route_ip": "10.2.21.1", "dns": [{"brif": "t3s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t3s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "ns_name": "t3ns1", "route": [{"if": "p1", "ip": "10.2.21.1/24", "ns_if": "t3if", "ns_name": "t3"}], "vms": [{"brif": "t3br1if1", "disk": "10G", "mem": 2, "name": "t3_VM4", "vcpu": 4, "vmif": "t3VM4if1"}], "vxlan": [{"dev": "t3s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.21.2", "remote_ip": "10.1.21.2", "remote_route": "10.1.21.0/24", "subnet_route": "10.2.21.0/24", "tenant_route_ip": "192.168.131.2", "v_name": "vxlan_t3s1"}]}, {"tenant_ns_if": "t3ns1if", "tenant_ns_ip": "10.2.21.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s1if", "tenant_sub_ip": "10.2.21.2/24"}], "rc": 0, "start": "2019-11-17 10:24:23.888586", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Add IP addresses to Namespace VETH Pairs] *************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.22.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.1.22.1', u'bridge_name': u't3br2', u'dns': [{u'dnsif': u't3s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't3s2_dnsbrif'}], u'ns_name': u't3ns2', u'bridge_ip': u'2.2.2.1', u'vms': [{u'mem': 3, u'name': u't3_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't3br2if1', u'vmif': u't3VM3if1'}], u'vxlan': [{u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}, {u'tenant_sub_ip': u'10.1.22.2/24', u'tenant_ns_ip': u'10.1.22.1/24', u'tenant_ns_if': u't3ns2if', u'tenant_sub_if': u't3s2if', u'tenant_ns_name': u't3'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t3ns2\" ip addr show \"t3s2if\" | awk 'FNR==3{ print $2 }' | grep -w '^10.1.22.2/24' ; if [ $? -ne 0 ] ; then ip netns exec \"t3ns2\" ip addr add \"10.1.22.2/24\" dev \"t3s2if\" ; fi\n\nip netns exec \"t3\" ip addr show \"t3ns2if\" | awk 'FNR==3{ print $2 }' | grep -w '^10.1.22.1/24' ; if [ $? -ne 0 ] ; then ip netns exec \"t3\" ip addr add \"10.1.22.1/24\" dev \"t3ns2if\" ; fi\n", "delta": "0:00:00.169588", "end": "2019-11-17 10:24:24.019700", "item": [{"bridge_ip": "2.2.2.1", "bridge_name": "t3br2", "default_route_ip": "10.1.22.1", "dns": [{"brif": "t3s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t3s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t3ns2", "route": [{"if": "p1", "ip": "10.1.22.1/24", "ns_if": "t3if", "ns_name": "t3"}], "vms": [{"brif": "t3br2if1", "disk": "10G", "mem": 3, "name": "t3_VM3", "vcpu": 2, "vmif": "t3VM3if1"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, {"tenant_ns_if": "t3ns2if", "tenant_ns_ip": "10.1.22.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s2if", "tenant_sub_ip": "10.1.22.2/24"}], "rc": 0, "start": "2019-11-17 10:24:23.850112", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Add IP Route to Tenant] *******************************************************************************************************************************
changed: [localhost] => (item={u'default_route_ip': u'192.168.3.1', u'name': u't3', u'pns_ip': u'192.168.3.1/24', u'tenant_if': u't3if', u'tenant_ip': u'192.168.3.2/24', u'pns_if': u't3pns_if'}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t3\" ip route show default | grep -w '[d]efault via 192.168.3.1' ; if [ $? -ne 0 ] ; then ip netns exec \"t3\" ip route add default via \"192.168.3.1\" ; fi\n", "delta": "0:00:00.067119", "end": "2019-11-17 10:24:24.403723", "item": {"default_route_ip": "192.168.3.1", "name": "t3", "pns_if": "t3pns_if", "pns_ip": "192.168.3.1/24", "tenant_if": "t3if", "tenant_ip": "192.168.3.2/24"}, "rc": 0, "start": "2019-11-17 10:24:24.336604", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Add IP Route to Tenant Subnet] ************************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.21.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.2.21.1', u'bridge_name': u't3br1', u'dns': [{u'dnsif': u't3s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't3s1_dnsbrif'}], u'ns_name': u't3ns1', u'bridge_ip': u'1.1.1.1', u'vms': [{u'mem': 2, u'name': u't3_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't3br1if1', u'vmif': u't3VM4if1'}], u'vxlan': [{u'local_ip': u'10.2.21.2', u'dsport': 4789, u'dev': u't3s1if', u'tenant_route_ip': u'192.168.131.2', u'remote_route': u'10.1.21.0/24', u'subnet_route': u'10.2.21.0/24', u'v_name': u'vxlan_t3s1', u'id': 42, u'remote_ip': u'10.1.21.2'}]}, {u'tenant_sub_ip': u'10.2.21.2/24', u'tenant_ns_ip': u'10.2.21.1/24', u'tenant_ns_if': u't3ns1if', u'tenant_sub_if': u't3s1if', u'tenant_ns_name': u't3'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t3ns1\" ip addr show \"t3s1if\" | awk 'FNR==3{ print $2 }' | grep -w '^10.2.21.2/24' ; if [ $? -ne 0 ] ; then ip netns exec \"t3ns1\" ip addr add \"10.2.21.2/24\" dev \"t3s1if\" ; fi\n\nip netns exec \"t3\" ip addr show \"t3ns1if\" | awk 'FNR==3{ print $2 }' | grep -w '^10.2.21.1/24' ; if [ $? -ne 0 ] ; then ip netns exec \"t3\" ip addr add \"10.2.21.1/24\" dev \"t3ns1if\" ; fi\n", "delta": "0:00:00.164878", "end": "2019-11-17 10:24:24.552448", "item": [{"bridge_ip": "1.1.1.1", "bridge_name": "t3br1", "default_route_ip": "10.2.21.1", "dns": [{"brif": "t3s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t3s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "ns_name": "t3ns1", "route": [{"if": "p1", "ip": "10.2.21.1/24", "ns_if": "t3if", "ns_name": "t3"}], "vms": [{"brif": "t3br1if1", "disk": "10G", "mem": 2, "name": "t3_VM4", "vcpu": 4, "vmif": "t3VM4if1"}], "vxlan": [{"dev": "t3s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.21.2", "remote_ip": "10.1.21.2", "remote_route": "10.1.21.0/24", "subnet_route": "10.2.21.0/24", "tenant_route_ip": "192.168.131.2", "v_name": "vxlan_t3s1"}]}, {"tenant_ns_if": "t3ns1if", "tenant_ns_ip": "10.2.21.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s1if", "tenant_sub_ip": "10.2.21.2/24"}], "rc": 0, "start": "2019-11-17 10:24:24.387570", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Add IP Route to Tenant] *******************************************************************************************************************************
changed: [localhost] => (item={u'route': [{u'ip': u'10.1.21.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.1.21.1', u'bridge_name': u't3br1', u'dns': [{u'dnsif': u't3s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't3s1_dnsbrif'}], u'ns_name': u't3ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.21.2/24', u'tenant_ns_ip': u'10.1.21.1/24', u'tenant_ns_if': u't3ns1if', u'tenant_ns_name': u't3', u'tenant_sub_if': u't3s1if'}], u'bridge_ip': u'1.1.1.1', u'vms': [{u'mem': 2, u'name': u't3_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't3br1if1', u'vmif': u't3VM1if1'}, {u'mem': 4, u'name': u't3_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't3br1if2', u'vmif': u't3VM2if1'}], u'vxlan': [{u'local_ip': u'10.1.21.2', u'tenant_route_ip': u'192.168.3.2', u'dsport': 4789, u'dev': u't3s1if', u'subnet_route': u'10.1.21.0/24', u'remote_route': u'10.2.21.0/24', u'v_name': u'vxlan_t3s1', u'id': 42, u'remote_ip': u'10.2.21.2'}]}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t3ns1\" ip route show default | grep -w '[d]efault via 10.1.21.1' ; if [ $? -ne 0 ] ; then ip netns exec \"t3ns1\" ip route add default via \"10.1.21.1\" ; fi\n", "delta": "0:00:00.098679", "end": "2019-11-17 10:24:24.799582", "item": {"bridge_ip": "1.1.1.1", "bridge_name": "t3br1", "default_route_ip": "10.1.21.1", "dns": [{"brif": "t3s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t3s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t3ns1", "route": [{"if": "p1", "ip": "10.1.21.1/24", "ns_if": "t3if", "ns_name": "t3"}], "tenant_ns": [{"tenant_ns_if": "t3ns1if", "tenant_ns_ip": "10.1.21.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s1if", "tenant_sub_ip": "10.1.21.2/24"}], "vms": [{"brif": "t3br1if1", "disk": "10G", "mem": 2, "name": "t3_VM1", "vcpu": 4, "vmif": "t3VM1if1"}, {"brif": "t3br1if2", "disk": "10G", "mem": 4, "name": "t3_VM2", "vcpu": 2, "vmif": "t3VM2if1"}], "vxlan": [{"dev": "t3s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.21.2", "remote_ip": "10.2.21.2", "remote_route": "10.2.21.0/24", "subnet_route": "10.1.21.0/24", "tenant_route_ip": "192.168.3.2", "v_name": "vxlan_t3s1"}]}, "rc": 0, "start": "2019-11-17 10:24:24.700903", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}
changed: [localhost] => (item={u'route': [{u'ip': u'10.1.22.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.1.22.1', u'bridge_name': u't3br2', u'dns': [{u'dnsif': u't3s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't3s2_dnsbrif'}], u'ns_name': u't3ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.22.2/24', u'tenant_ns_ip': u'10.1.22.1/24', u'tenant_ns_if': u't3ns2if', u'tenant_ns_name': u't3', u'tenant_sub_if': u't3s2if'}], u'bridge_ip': u'2.2.2.1', u'vms': [{u'mem': 3, u'name': u't3_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't3br2if1', u'vmif': u't3VM3if1'}], u'vxlan': [{u'local_ip': [], u'tenant_route_ip': [], u'dsport': [], u'dev': [], u'subnet_route': [], u'remote_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t3ns2\" ip route show default | grep -w '[d]efault via 10.1.22.1' ; if [ $? -ne 0 ] ; then ip netns exec \"t3ns2\" ip route add default via \"10.1.22.1\" ; fi\n", "delta": "0:00:00.082965", "end": "2019-11-17 10:24:25.111723", "item": {"bridge_ip": "2.2.2.1", "bridge_name": "t3br2", "default_route_ip": "10.1.22.1", "dns": [{"brif": "t3s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t3s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t3ns2", "route": [{"if": "p1", "ip": "10.1.22.1/24", "ns_if": "t3if", "ns_name": "t3"}], "tenant_ns": [{"tenant_ns_if": "t3ns2if", "tenant_ns_ip": "10.1.22.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s2if", "tenant_sub_ip": "10.1.22.2/24"}], "vms": [{"brif": "t3br2if1", "disk": "10G", "mem": 3, "name": "t3_VM3", "vcpu": 2, "vmif": "t3VM3if1"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, "rc": 0, "start": "2019-11-17 10:24:25.028758", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Create bridge inside namespace] ***********************************************************************************************************************
changed: [99.99.99.2] => (item={u'default_route_ip': u'192.168.131.1', u'name': u't3', u'pns_ip': u'192.168.131.1/24', u'tenant_if': u't3if', u'tenant_ip': u'192.168.131.2/24', u'pns_if': u't3pns_if'}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t3\" ip route show default | grep -w '[d]efault via 192.168.131.1' ; if [ $? -ne 0 ] ; then ip netns exec \"t3\" ip route add default via \"192.168.131.1\" ; fi\n", "delta": "0:00:00.097030", "end": "2019-11-17 10:24:25.164379", "item": {"default_route_ip": "192.168.131.1", "name": "t3", "pns_if": "t3pns_if", "pns_ip": "192.168.131.1/24", "tenant_if": "t3if", "tenant_ip": "192.168.131.2/24"}, "rc": 0, "start": "2019-11-17 10:24:25.067349", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Add IP Route to Tenant Subnet] ************************************************************************************************************************
changed: [localhost] => (item={u'route': [{u'ip': u'10.1.21.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.1.21.1', u'bridge_name': u't3br1', u'dns': [{u'dnsif': u't3s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't3s1_dnsbrif'}], u'ns_name': u't3ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.21.2/24', u'tenant_ns_ip': u'10.1.21.1/24', u'tenant_ns_if': u't3ns1if', u'tenant_ns_name': u't3', u'tenant_sub_if': u't3s1if'}], u'bridge_ip': u'1.1.1.1', u'vms': [{u'mem': 2, u'name': u't3_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't3br1if1', u'vmif': u't3VM1if1'}, {u'mem': 4, u'name': u't3_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't3br1if2', u'vmif': u't3VM2if1'}], u'vxlan': [{u'local_ip': u'10.1.21.2', u'tenant_route_ip': u'192.168.3.2', u'dsport': 4789, u'dev': u't3s1if', u'subnet_route': u'10.1.21.0/24', u'remote_route': u'10.2.21.0/24', u'v_name': u'vxlan_t3s1', u'id': 42, u'remote_ip': u'10.2.21.2'}]}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t3ns1\" brctl show | grep -w '^t3br1'; if [ $? -ne 0 ] ; then ip netns exec \"t3ns1\" brctl addbr \"t3br1\" ; fi\nip netns exec \"t3ns1\" ip link set dev \"t3br1\" up\n", "delta": "0:00:00.112143", "end": "2019-11-17 10:24:25.483569", "item": {"bridge_ip": "1.1.1.1", "bridge_name": "t3br1", "default_route_ip": "10.1.21.1", "dns": [{"brif": "t3s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t3s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t3ns1", "route": [{"if": "p1", "ip": "10.1.21.1/24", "ns_if": "t3if", "ns_name": "t3"}], "tenant_ns": [{"tenant_ns_if": "t3ns1if", "tenant_ns_ip": "10.1.21.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s1if", "tenant_sub_ip": "10.1.21.2/24"}], "vms": [{"brif": "t3br1if1", "disk": "10G", "mem": 2, "name": "t3_VM1", "vcpu": 4, "vmif": "t3VM1if1"}, {"brif": "t3br1if2", "disk": "10G", "mem": 4, "name": "t3_VM2", "vcpu": 2, "vmif": "t3VM2if1"}], "vxlan": [{"dev": "t3s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.21.2", "remote_ip": "10.2.21.2", "remote_route": "10.2.21.0/24", "subnet_route": "10.1.21.0/24", "tenant_route_ip": "192.168.3.2", "v_name": "vxlan_t3s1"}]}, "rc": 0, "start": "2019-11-17 10:24:25.371426", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}
changed: [99.99.99.2] => (item={u'route': [{u'ip': u'10.2.21.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.2.21.1', u'bridge_name': u't3br1', u'dns': [{u'dnsif': u't3s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't3s1_dnsbrif'}], u'ns_name': u't3ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.21.2/24', u'tenant_ns_ip': u'10.2.21.1/24', u'tenant_ns_if': u't3ns1if', u'tenant_ns_name': u't3', u'tenant_sub_if': u't3s1if'}], u'bridge_ip': u'1.1.1.1', u'vms': [{u'mem': 2, u'name': u't3_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't3br1if1', u'vmif': u't3VM4if1'}], u'vxlan': [{u'local_ip': u'10.2.21.2', u'tenant_route_ip': u'192.168.131.2', u'dsport': 4789, u'dev': u't3s1if', u'subnet_route': u'10.2.21.0/24', u'remote_route': u'10.1.21.0/24', u'v_name': u'vxlan_t3s1', u'id': 42, u'remote_ip': u'10.1.21.2'}]}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t3ns1\" ip route show default | grep -w '[d]efault via 10.2.21.1' ; if [ $? -ne 0 ] ; then ip netns exec \"t3ns1\" ip route add default via \"10.2.21.1\" ; fi\n", "delta": "0:00:00.084440", "end": "2019-11-17 10:24:25.644282", "item": {"bridge_ip": "1.1.1.1", "bridge_name": "t3br1", "default_route_ip": "10.2.21.1", "dns": [{"brif": "t3s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t3s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "ns_name": "t3ns1", "route": [{"if": "p1", "ip": "10.2.21.1/24", "ns_if": "t3if", "ns_name": "t3"}], "tenant_ns": [{"tenant_ns_if": "t3ns1if", "tenant_ns_ip": "10.2.21.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s1if", "tenant_sub_ip": "10.2.21.2/24"}], "vms": [{"brif": "t3br1if1", "disk": "10G", "mem": 2, "name": "t3_VM4", "vcpu": 4, "vmif": "t3VM4if1"}], "vxlan": [{"dev": "t3s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.21.2", "remote_ip": "10.1.21.2", "remote_route": "10.1.21.0/24", "subnet_route": "10.2.21.0/24", "tenant_route_ip": "192.168.131.2", "v_name": "vxlan_t3s1"}]}, "rc": 0, "start": "2019-11-17 10:24:25.559842", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Create bridge inside namespace] ***********************************************************************************************************************
changed: [localhost] => (item={u'route': [{u'ip': u'10.1.22.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.1.22.1', u'bridge_name': u't3br2', u'dns': [{u'dnsif': u't3s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't3s2_dnsbrif'}], u'ns_name': u't3ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.22.2/24', u'tenant_ns_ip': u'10.1.22.1/24', u'tenant_ns_if': u't3ns2if', u'tenant_ns_name': u't3', u'tenant_sub_if': u't3s2if'}], u'bridge_ip': u'2.2.2.1', u'vms': [{u'mem': 3, u'name': u't3_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't3br2if1', u'vmif': u't3VM3if1'}], u'vxlan': [{u'local_ip': [], u'tenant_route_ip': [], u'dsport': [], u'dev': [], u'subnet_route': [], u'remote_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t3ns2\" brctl show | grep -w '^t3br2'; if [ $? -ne 0 ] ; then ip netns exec \"t3ns2\" brctl addbr \"t3br2\" ; fi\nip netns exec \"t3ns2\" ip link set dev \"t3br2\" up\n", "delta": "0:00:00.113468", "end": "2019-11-17 10:24:25.787581", "item": {"bridge_ip": "2.2.2.1", "bridge_name": "t3br2", "default_route_ip": "10.1.22.1", "dns": [{"brif": "t3s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t3s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t3ns2", "route": [{"if": "p1", "ip": "10.1.22.1/24", "ns_if": "t3if", "ns_name": "t3"}], "tenant_ns": [{"tenant_ns_if": "t3ns2if", "tenant_ns_ip": "10.1.22.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s2if", "tenant_sub_ip": "10.1.22.2/24"}], "vms": [{"brif": "t3br2if1", "disk": "10G", "mem": 3, "name": "t3_VM3", "vcpu": 2, "vmif": "t3VM3if1"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, "rc": 0, "start": "2019-11-17 10:24:25.674113", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Create DNS VETH Pair] *********************************************************************************************************************************
changed: [99.99.99.2] => (item={u'route': [{u'ip': u'10.2.21.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.2.21.1', u'bridge_name': u't3br1', u'dns': [{u'dnsif': u't3s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't3s1_dnsbrif'}], u'ns_name': u't3ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.21.2/24', u'tenant_ns_ip': u'10.2.21.1/24', u'tenant_ns_if': u't3ns1if', u'tenant_ns_name': u't3', u'tenant_sub_if': u't3s1if'}], u'bridge_ip': u'1.1.1.1', u'vms': [{u'mem': 2, u'name': u't3_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't3br1if1', u'vmif': u't3VM4if1'}], u'vxlan': [{u'local_ip': u'10.2.21.2', u'tenant_route_ip': u'192.168.131.2', u'dsport': 4789, u'dev': u't3s1if', u'subnet_route': u'10.2.21.0/24', u'remote_route': u'10.1.21.0/24', u'v_name': u'vxlan_t3s1', u'id': 42, u'remote_ip': u'10.1.21.2'}]}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t3ns1\" brctl show | grep -w '^t3br1'; if [ $? -ne 0 ] ; then ip netns exec \"t3ns1\" brctl addbr \"t3br1\" ; fi\nip netns exec \"t3ns1\" ip link set dev \"t3br1\" up\n", "delta": "0:00:00.107576", "end": "2019-11-17 10:24:26.132374", "item": {"bridge_ip": "1.1.1.1", "bridge_name": "t3br1", "default_route_ip": "10.2.21.1", "dns": [{"brif": "t3s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t3s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "ns_name": "t3ns1", "route": [{"if": "p1", "ip": "10.2.21.1/24", "ns_if": "t3if", "ns_name": "t3"}], "tenant_ns": [{"tenant_ns_if": "t3ns1if", "tenant_ns_ip": "10.2.21.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s1if", "tenant_sub_ip": "10.2.21.2/24"}], "vms": [{"brif": "t3br1if1", "disk": "10G", "mem": 2, "name": "t3_VM4", "vcpu": 4, "vmif": "t3VM4if1"}], "vxlan": [{"dev": "t3s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.21.2", "remote_ip": "10.1.21.2", "remote_route": "10.1.21.0/24", "subnet_route": "10.2.21.0/24", "tenant_route_ip": "192.168.131.2", "v_name": "vxlan_t3s1"}]}, "rc": 0, "start": "2019-11-17 10:24:26.024798", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Create DNS VETH Pair] *********************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.21.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.1.21.1', u'bridge_name': u't3br1', u'ns_name': u't3ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.21.2/24', u'tenant_ns_ip': u'10.1.21.1/24', u'tenant_ns_if': u't3ns1if', u'tenant_sub_if': u't3s1if', u'tenant_ns_name': u't3'}], u'bridge_ip': u'1.1.1.1', u'vms': [{u'mem': 2, u'name': u't3_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't3br1if1', u'vmif': u't3VM1if1'}, {u'mem': 4, u'name': u't3_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't3br1if2', u'vmif': u't3VM2if1'}], u'vxlan': [{u'local_ip': u'10.1.21.2', u'dsport': 4789, u'dev': u't3s1if', u'tenant_route_ip': u'192.168.3.2', u'remote_route': u'10.2.21.0/24', u'subnet_route': u'10.1.21.0/24', u'v_name': u'vxlan_t3s1', u'id': 42, u'remote_ip': u'10.2.21.2'}]}, {u'dnsif': u't3s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't3s1_dnsbrif'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t3ns1\" ip link show \"t3s1_dnsbrif\" ; if [ $? -ne 0 ] ; then ip netns exec \"t3ns1\" ip link add \"t3s1_dnsbrif\" type veth peer name \"t3s1_dnsif\" ; fi\nip netns exec \"t3ns1\" ip link set dev \"t3s1_dnsbrif\" up\nip netns exec \"t3ns1\" ip link set dev \"t3s1_dnsif\" up\n", "delta": "0:00:00.136799", "end": "2019-11-17 10:24:26.183602", "item": [{"bridge_ip": "1.1.1.1", "bridge_name": "t3br1", "default_route_ip": "10.1.21.1", "ns_name": "t3ns1", "route": [{"if": "p1", "ip": "10.1.21.1/24", "ns_if": "t3if", "ns_name": "t3"}], "tenant_ns": [{"tenant_ns_if": "t3ns1if", "tenant_ns_ip": "10.1.21.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s1if", "tenant_sub_ip": "10.1.21.2/24"}], "vms": [{"brif": "t3br1if1", "disk": "10G", "mem": 2, "name": "t3_VM1", "vcpu": 4, "vmif": "t3VM1if1"}, {"brif": "t3br1if2", "disk": "10G", "mem": 4, "name": "t3_VM2", "vcpu": 2, "vmif": "t3VM2if1"}], "vxlan": [{"dev": "t3s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.21.2", "remote_ip": "10.2.21.2", "remote_route": "10.2.21.0/24", "subnet_route": "10.1.21.0/24", "tenant_route_ip": "192.168.3.2", "v_name": "vxlan_t3s1"}]}, {"brif": "t3s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t3s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "rc": 0, "start": "2019-11-17 10:24:26.046803", "stderr": "Device \"t3s1_dnsbrif\" does not exist.", "stderr_lines": ["Device \"t3s1_dnsbrif\" does not exist."], "stdout": "", "stdout_lines": []}
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.22.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.1.22.1', u'bridge_name': u't3br2', u'ns_name': u't3ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.22.2/24', u'tenant_ns_ip': u'10.1.22.1/24', u'tenant_ns_if': u't3ns2if', u'tenant_sub_if': u't3s2if', u'tenant_ns_name': u't3'}], u'bridge_ip': u'2.2.2.1', u'vms': [{u'mem': 3, u'name': u't3_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't3br2if1', u'vmif': u't3VM3if1'}], u'vxlan': [{u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}, {u'dnsif': u't3s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't3s2_dnsbrif'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t3ns2\" ip link show \"t3s2_dnsbrif\" ; if [ $? -ne 0 ] ; then ip netns exec \"t3ns2\" ip link add \"t3s2_dnsbrif\" type veth peer name \"t3s2_dnsif\" ; fi\nip netns exec \"t3ns2\" ip link set dev \"t3s2_dnsbrif\" up\nip netns exec \"t3ns2\" ip link set dev \"t3s2_dnsif\" up\n", "delta": "0:00:00.145289", "end": "2019-11-17 10:24:26.559739", "item": [{"bridge_ip": "2.2.2.1", "bridge_name": "t3br2", "default_route_ip": "10.1.22.1", "ns_name": "t3ns2", "route": [{"if": "p1", "ip": "10.1.22.1/24", "ns_if": "t3if", "ns_name": "t3"}], "tenant_ns": [{"tenant_ns_if": "t3ns2if", "tenant_ns_ip": "10.1.22.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s2if", "tenant_sub_ip": "10.1.22.2/24"}], "vms": [{"brif": "t3br2if1", "disk": "10G", "mem": 3, "name": "t3_VM3", "vcpu": 2, "vmif": "t3VM3if1"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, {"brif": "t3s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t3s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "rc": 0, "start": "2019-11-17 10:24:26.414450", "stderr": "Device \"t3s2_dnsbrif\" does not exist.", "stderr_lines": ["Device \"t3s2_dnsbrif\" does not exist."], "stdout": "", "stdout_lines": []}

TASK [Attach DNS VETH Pair] *********************************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.21.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.2.21.1', u'bridge_name': u't3br1', u'ns_name': u't3ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.21.2/24', u'tenant_ns_ip': u'10.2.21.1/24', u'tenant_ns_if': u't3ns1if', u'tenant_sub_if': u't3s1if', u'tenant_ns_name': u't3'}], u'bridge_ip': u'1.1.1.1', u'vms': [{u'mem': 2, u'name': u't3_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't3br1if1', u'vmif': u't3VM4if1'}], u'vxlan': [{u'local_ip': u'10.2.21.2', u'dsport': 4789, u'dev': u't3s1if', u'tenant_route_ip': u'192.168.131.2', u'remote_route': u'10.1.21.0/24', u'subnet_route': u'10.2.21.0/24', u'v_name': u'vxlan_t3s1', u'id': 42, u'remote_ip': u'10.1.21.2'}]}, {u'dnsif': u't3s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't3s1_dnsbrif'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t3ns1\" ip link show \"t3s1_dnsbrif\" ; if [ $? -ne 0 ] ; then ip netns exec \"t3ns1\" ip link add \"t3s1_dnsbrif\" type veth peer name \"t3s1_dnsif\" ; fi\nip netns exec \"t3ns1\" ip link set dev \"t3s1_dnsbrif\" up\nip netns exec \"t3ns1\" ip link set dev \"t3s1_dnsif\" up\n", "delta": "0:00:00.173272", "end": "2019-11-17 10:24:26.732452", "item": [{"bridge_ip": "1.1.1.1", "bridge_name": "t3br1", "default_route_ip": "10.2.21.1", "ns_name": "t3ns1", "route": [{"if": "p1", "ip": "10.2.21.1/24", "ns_if": "t3if", "ns_name": "t3"}], "tenant_ns": [{"tenant_ns_if": "t3ns1if", "tenant_ns_ip": "10.2.21.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s1if", "tenant_sub_ip": "10.2.21.2/24"}], "vms": [{"brif": "t3br1if1", "disk": "10G", "mem": 2, "name": "t3_VM4", "vcpu": 4, "vmif": "t3VM4if1"}], "vxlan": [{"dev": "t3s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.21.2", "remote_ip": "10.1.21.2", "remote_route": "10.1.21.0/24", "subnet_route": "10.2.21.0/24", "tenant_route_ip": "192.168.131.2", "v_name": "vxlan_t3s1"}]}, {"brif": "t3s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t3s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "rc": 0, "start": "2019-11-17 10:24:26.559180", "stderr": "Device \"t3s1_dnsbrif\" does not exist.", "stderr_lines": ["Device \"t3s1_dnsbrif\" does not exist."], "stdout": "", "stdout_lines": []}

TASK [Attach DNS VETH Pair] *********************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.21.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.1.21.1', u'bridge_name': u't3br1', u'ns_name': u't3ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.21.2/24', u'tenant_ns_ip': u'10.1.21.1/24', u'tenant_ns_if': u't3ns1if', u'tenant_sub_if': u't3s1if', u'tenant_ns_name': u't3'}], u'bridge_ip': u'1.1.1.1', u'vms': [{u'mem': 2, u'name': u't3_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't3br1if1', u'vmif': u't3VM1if1'}, {u'mem': 4, u'name': u't3_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't3br1if2', u'vmif': u't3VM2if1'}], u'vxlan': [{u'local_ip': u'10.1.21.2', u'dsport': 4789, u'dev': u't3s1if', u'tenant_route_ip': u'192.168.3.2', u'remote_route': u'10.2.21.0/24', u'subnet_route': u'10.1.21.0/24', u'v_name': u'vxlan_t3s1', u'id': 42, u'remote_ip': u'10.2.21.2'}]}, {u'dnsif': u't3s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't3s1_dnsbrif'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t3ns1\" brctl show \"t3br1\" | grep -w 't3s1_dnsbrif' ; if [ $? -ne 0 ] ; then ip netns exec \"t3ns1\" brctl addif \"t3br1\" \"t3s1_dnsbrif\" ; fi\n", "delta": "0:00:00.078510", "end": "2019-11-17 10:24:26.935554", "item": [{"bridge_ip": "1.1.1.1", "bridge_name": "t3br1", "default_route_ip": "10.1.21.1", "ns_name": "t3ns1", "route": [{"if": "p1", "ip": "10.1.21.1/24", "ns_if": "t3if", "ns_name": "t3"}], "tenant_ns": [{"tenant_ns_if": "t3ns1if", "tenant_ns_ip": "10.1.21.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s1if", "tenant_sub_ip": "10.1.21.2/24"}], "vms": [{"brif": "t3br1if1", "disk": "10G", "mem": 2, "name": "t3_VM1", "vcpu": 4, "vmif": "t3VM1if1"}, {"brif": "t3br1if2", "disk": "10G", "mem": 4, "name": "t3_VM2", "vcpu": 2, "vmif": "t3VM2if1"}], "vxlan": [{"dev": "t3s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.21.2", "remote_ip": "10.2.21.2", "remote_route": "10.2.21.0/24", "subnet_route": "10.1.21.0/24", "tenant_route_ip": "192.168.3.2", "v_name": "vxlan_t3s1"}]}, {"brif": "t3s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t3s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "rc": 0, "start": "2019-11-17 10:24:26.857044", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.22.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.1.22.1', u'bridge_name': u't3br2', u'ns_name': u't3ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.22.2/24', u'tenant_ns_ip': u'10.1.22.1/24', u'tenant_ns_if': u't3ns2if', u'tenant_sub_if': u't3s2if', u'tenant_ns_name': u't3'}], u'bridge_ip': u'2.2.2.1', u'vms': [{u'mem': 3, u'name': u't3_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't3br2if1', u'vmif': u't3VM3if1'}], u'vxlan': [{u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}, {u'dnsif': u't3s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't3s2_dnsbrif'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t3ns2\" brctl show \"t3br2\" | grep -w 't3s2_dnsbrif' ; if [ $? -ne 0 ] ; then ip netns exec \"t3ns2\" brctl addif \"t3br2\" \"t3s2_dnsbrif\" ; fi\n", "delta": "0:00:00.075551", "end": "2019-11-17 10:24:27.231924", "item": [{"bridge_ip": "2.2.2.1", "bridge_name": "t3br2", "default_route_ip": "10.1.22.1", "ns_name": "t3ns2", "route": [{"if": "p1", "ip": "10.1.22.1/24", "ns_if": "t3if", "ns_name": "t3"}], "tenant_ns": [{"tenant_ns_if": "t3ns2if", "tenant_ns_ip": "10.1.22.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s2if", "tenant_sub_ip": "10.1.22.2/24"}], "vms": [{"brif": "t3br2if1", "disk": "10G", "mem": 3, "name": "t3_VM3", "vcpu": 2, "vmif": "t3VM3if1"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, {"brif": "t3s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t3s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "rc": 0, "start": "2019-11-17 10:24:27.156373", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Create VETH Pairs] ************************************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.21.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.2.21.1', u'bridge_name': u't3br1', u'ns_name': u't3ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.21.2/24', u'tenant_ns_ip': u'10.2.21.1/24', u'tenant_ns_if': u't3ns1if', u'tenant_sub_if': u't3s1if', u'tenant_ns_name': u't3'}], u'bridge_ip': u'1.1.1.1', u'vms': [{u'mem': 2, u'name': u't3_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't3br1if1', u'vmif': u't3VM4if1'}], u'vxlan': [{u'local_ip': u'10.2.21.2', u'dsport': 4789, u'dev': u't3s1if', u'tenant_route_ip': u'192.168.131.2', u'remote_route': u'10.1.21.0/24', u'subnet_route': u'10.2.21.0/24', u'v_name': u'vxlan_t3s1', u'id': 42, u'remote_ip': u'10.1.21.2'}]}, {u'dnsif': u't3s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't3s1_dnsbrif'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t3ns1\" brctl show \"t3br1\" | grep -w 't3s1_dnsbrif' ; if [ $? -ne 0 ] ; then ip netns exec \"t3ns1\" brctl addif \"t3br1\" \"t3s1_dnsbrif\" ; fi\n", "delta": "0:00:00.109647", "end": "2019-11-17 10:24:27.268502", "item": [{"bridge_ip": "1.1.1.1", "bridge_name": "t3br1", "default_route_ip": "10.2.21.1", "ns_name": "t3ns1", "route": [{"if": "p1", "ip": "10.2.21.1/24", "ns_if": "t3if", "ns_name": "t3"}], "tenant_ns": [{"tenant_ns_if": "t3ns1if", "tenant_ns_ip": "10.2.21.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s1if", "tenant_sub_ip": "10.2.21.2/24"}], "vms": [{"brif": "t3br1if1", "disk": "10G", "mem": 2, "name": "t3_VM4", "vcpu": 4, "vmif": "t3VM4if1"}], "vxlan": [{"dev": "t3s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.21.2", "remote_ip": "10.1.21.2", "remote_route": "10.1.21.0/24", "subnet_route": "10.2.21.0/24", "tenant_route_ip": "192.168.131.2", "v_name": "vxlan_t3s1"}]}, {"brif": "t3s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t3s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "rc": 0, "start": "2019-11-17 10:24:27.158855", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Create VETH Pairs] ************************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.21.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.1.21.1', u'bridge_name': u't3br1', u'dns': [{u'dnsif': u't3s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't3s1_dnsbrif'}], u'ns_name': u't3ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.21.2/24', u'tenant_ns_ip': u'10.1.21.1/24', u'tenant_ns_if': u't3ns1if', u'tenant_sub_if': u't3s1if', u'tenant_ns_name': u't3'}], u'bridge_ip': u'1.1.1.1', u'vxlan': [{u'local_ip': u'10.1.21.2', u'dsport': 4789, u'dev': u't3s1if', u'tenant_route_ip': u'192.168.3.2', u'remote_route': u'10.2.21.0/24', u'subnet_route': u'10.1.21.0/24', u'v_name': u'vxlan_t3s1', u'id': 42, u'remote_ip': u'10.2.21.2'}]}, {u'mem': 2, u'name': u't3_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't3br1if1', u'vmif': u't3VM1if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip link show \"t3br1if1\" ; if [ $? -ne 0 ] ; then ip link add \"t3VM1if1\" type veth peer name \"t3br1if1\" ; fi\nip link set dev \"t3br1if1\" up\nip link set dev \"t3VM1if1\" up\n", "delta": "0:00:00.019258", "end": "2019-11-17 10:24:27.546955", "item": [{"bridge_ip": "1.1.1.1", "bridge_name": "t3br1", "default_route_ip": "10.1.21.1", "dns": [{"brif": "t3s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t3s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t3ns1", "route": [{"if": "p1", "ip": "10.1.21.1/24", "ns_if": "t3if", "ns_name": "t3"}], "tenant_ns": [{"tenant_ns_if": "t3ns1if", "tenant_ns_ip": "10.1.21.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s1if", "tenant_sub_ip": "10.1.21.2/24"}], "vxlan": [{"dev": "t3s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.21.2", "remote_ip": "10.2.21.2", "remote_route": "10.2.21.0/24", "subnet_route": "10.1.21.0/24", "tenant_route_ip": "192.168.3.2", "v_name": "vxlan_t3s1"}]}, {"brif": "t3br1if1", "disk": "10G", "mem": 2, "name": "t3_VM1", "vcpu": 4, "vmif": "t3VM1if1"}], "rc": 0, "start": "2019-11-17 10:24:27.527697", "stderr": "Device \"t3br1if1\" does not exist.", "stderr_lines": ["Device \"t3br1if1\" does not exist."], "stdout": "", "stdout_lines": []}
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.21.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.2.21.1', u'bridge_name': u't3br1', u'dns': [{u'dnsif': u't3s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't3s1_dnsbrif'}], u'ns_name': u't3ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.21.2/24', u'tenant_ns_ip': u'10.2.21.1/24', u'tenant_ns_if': u't3ns1if', u'tenant_sub_if': u't3s1if', u'tenant_ns_name': u't3'}], u'bridge_ip': u'1.1.1.1', u'vxlan': [{u'local_ip': u'10.2.21.2', u'dsport': 4789, u'dev': u't3s1if', u'tenant_route_ip': u'192.168.131.2', u'remote_route': u'10.1.21.0/24', u'subnet_route': u'10.2.21.0/24', u'v_name': u'vxlan_t3s1', u'id': 42, u'remote_ip': u'10.1.21.2'}]}, {u'mem': 2, u'name': u't3_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't3br1if1', u'vmif': u't3VM4if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip link show \"t3br1if1\" ; if [ $? -ne 0 ] ; then ip link add \"t3VM4if1\" type veth peer name \"t3br1if1\" ; fi\nip link set dev \"t3br1if1\" up\nip link set dev \"t3VM4if1\" up\n", "delta": "0:00:00.031900", "end": "2019-11-17 10:24:27.731821", "item": [{"bridge_ip": "1.1.1.1", "bridge_name": "t3br1", "default_route_ip": "10.2.21.1", "dns": [{"brif": "t3s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t3s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "ns_name": "t3ns1", "route": [{"if": "p1", "ip": "10.2.21.1/24", "ns_if": "t3if", "ns_name": "t3"}], "tenant_ns": [{"tenant_ns_if": "t3ns1if", "tenant_ns_ip": "10.2.21.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s1if", "tenant_sub_ip": "10.2.21.2/24"}], "vxlan": [{"dev": "t3s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.21.2", "remote_ip": "10.1.21.2", "remote_route": "10.1.21.0/24", "subnet_route": "10.2.21.0/24", "tenant_route_ip": "192.168.131.2", "v_name": "vxlan_t3s1"}]}, {"brif": "t3br1if1", "disk": "10G", "mem": 2, "name": "t3_VM4", "vcpu": 4, "vmif": "t3VM4if1"}], "rc": 0, "start": "2019-11-17 10:24:27.699921", "stderr": "Device \"t3br1if1\" does not exist.", "stderr_lines": ["Device \"t3br1if1\" does not exist."], "stdout": "", "stdout_lines": []}

TASK [Attach VETH Pairs] ************************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.21.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.1.21.1', u'bridge_name': u't3br1', u'dns': [{u'dnsif': u't3s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't3s1_dnsbrif'}], u'ns_name': u't3ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.21.2/24', u'tenant_ns_ip': u'10.1.21.1/24', u'tenant_ns_if': u't3ns1if', u'tenant_sub_if': u't3s1if', u'tenant_ns_name': u't3'}], u'bridge_ip': u'1.1.1.1', u'vxlan': [{u'local_ip': u'10.1.21.2', u'dsport': 4789, u'dev': u't3s1if', u'tenant_route_ip': u'192.168.3.2', u'remote_route': u'10.2.21.0/24', u'subnet_route': u'10.1.21.0/24', u'v_name': u'vxlan_t3s1', u'id': 42, u'remote_ip': u'10.2.21.2'}]}, {u'mem': 4, u'name': u't3_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't3br1if2', u'vmif': u't3VM2if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip link show \"t3br1if2\" ; if [ $? -ne 0 ] ; then ip link add \"t3VM2if1\" type veth peer name \"t3br1if2\" ; fi\nip link set dev \"t3br1if2\" up\nip link set dev \"t3VM2if1\" up\n", "delta": "0:00:00.016805", "end": "2019-11-17 10:24:27.797692", "item": [{"bridge_ip": "1.1.1.1", "bridge_name": "t3br1", "default_route_ip": "10.1.21.1", "dns": [{"brif": "t3s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t3s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t3ns1", "route": [{"if": "p1", "ip": "10.1.21.1/24", "ns_if": "t3if", "ns_name": "t3"}], "tenant_ns": [{"tenant_ns_if": "t3ns1if", "tenant_ns_ip": "10.1.21.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s1if", "tenant_sub_ip": "10.1.21.2/24"}], "vxlan": [{"dev": "t3s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.21.2", "remote_ip": "10.2.21.2", "remote_route": "10.2.21.0/24", "subnet_route": "10.1.21.0/24", "tenant_route_ip": "192.168.3.2", "v_name": "vxlan_t3s1"}]}, {"brif": "t3br1if2", "disk": "10G", "mem": 4, "name": "t3_VM2", "vcpu": 2, "vmif": "t3VM2if1"}], "rc": 0, "start": "2019-11-17 10:24:27.780887", "stderr": "Device \"t3br1if2\" does not exist.", "stderr_lines": ["Device \"t3br1if2\" does not exist."], "stdout": "", "stdout_lines": []}
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.22.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.1.22.1', u'bridge_name': u't3br2', u'dns': [{u'dnsif': u't3s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't3s2_dnsbrif'}], u'ns_name': u't3ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.22.2/24', u'tenant_ns_ip': u'10.1.22.1/24', u'tenant_ns_if': u't3ns2if', u'tenant_sub_if': u't3s2if', u'tenant_ns_name': u't3'}], u'bridge_ip': u'2.2.2.1', u'vxlan': [{u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}, {u'mem': 3, u'name': u't3_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't3br2if1', u'vmif': u't3VM3if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip link show \"t3br2if1\" ; if [ $? -ne 0 ] ; then ip link add \"t3VM3if1\" type veth peer name \"t3br2if1\" ; fi\nip link set dev \"t3br2if1\" up\nip link set dev \"t3VM3if1\" up\n", "delta": "0:00:00.015458", "end": "2019-11-17 10:24:28.066147", "item": [{"bridge_ip": "2.2.2.1", "bridge_name": "t3br2", "default_route_ip": "10.1.22.1", "dns": [{"brif": "t3s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t3s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t3ns2", "route": [{"if": "p1", "ip": "10.1.22.1/24", "ns_if": "t3if", "ns_name": "t3"}], "tenant_ns": [{"tenant_ns_if": "t3ns2if", "tenant_ns_ip": "10.1.22.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s2if", "tenant_sub_ip": "10.1.22.2/24"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, {"brif": "t3br2if1", "disk": "10G", "mem": 3, "name": "t3_VM3", "vcpu": 2, "vmif": "t3VM3if1"}], "rc": 0, "start": "2019-11-17 10:24:28.050689", "stderr": "Device \"t3br2if1\" does not exist.", "stderr_lines": ["Device \"t3br2if1\" does not exist."], "stdout": "", "stdout_lines": []}

TASK [Attach VETH Pairs] ************************************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.21.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.2.21.1', u'bridge_name': u't3br1', u'dns': [{u'dnsif': u't3s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't3s1_dnsbrif'}], u'ns_name': u't3ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.21.2/24', u'tenant_ns_ip': u'10.2.21.1/24', u'tenant_ns_if': u't3ns1if', u'tenant_sub_if': u't3s1if', u'tenant_ns_name': u't3'}], u'bridge_ip': u'1.1.1.1', u'vxlan': [{u'local_ip': u'10.2.21.2', u'dsport': 4789, u'dev': u't3s1if', u'tenant_route_ip': u'192.168.131.2', u'remote_route': u'10.1.21.0/24', u'subnet_route': u'10.2.21.0/24', u'v_name': u'vxlan_t3s1', u'id': 42, u'remote_ip': u'10.1.21.2'}]}, {u'mem': 2, u'name': u't3_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't3br1if1', u'vmif': u't3VM4if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip link show \"t3br1if1\" ; if [ $? -eq 0 ] ; then ip link set \"t3br1if1\" netns \"t3ns1\" ; fi\nip netns exec \"t3ns1\" brctl show \"t3br1\" | grep -w 't3br1if1' ; if [ $? -ne 0 ] ; then ip netns exec \"t3ns1\" brctl addif \"t3br1\" \"t3br1if1\" ; fi\n", "delta": "0:00:00.103622", "end": "2019-11-17 10:24:28.292439", "item": [{"bridge_ip": "1.1.1.1", "bridge_name": "t3br1", "default_route_ip": "10.2.21.1", "dns": [{"brif": "t3s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t3s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "ns_name": "t3ns1", "route": [{"if": "p1", "ip": "10.2.21.1/24", "ns_if": "t3if", "ns_name": "t3"}], "tenant_ns": [{"tenant_ns_if": "t3ns1if", "tenant_ns_ip": "10.2.21.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s1if", "tenant_sub_ip": "10.2.21.2/24"}], "vxlan": [{"dev": "t3s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.21.2", "remote_ip": "10.1.21.2", "remote_route": "10.1.21.0/24", "subnet_route": "10.2.21.0/24", "tenant_route_ip": "192.168.131.2", "v_name": "vxlan_t3s1"}]}, {"brif": "t3br1if1", "disk": "10G", "mem": 2, "name": "t3_VM4", "vcpu": 4, "vmif": "t3VM4if1"}], "rc": 0, "start": "2019-11-17 10:24:28.188817", "stderr": "", "stderr_lines": [], "stdout": "43: t3br1if1@t3VM4if1: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP mode DEFAULT group default qlen 1000\n    link/ether 6e:a2:f3:41:10:04 brd ff:ff:ff:ff:ff:ff", "stdout_lines": ["43: t3br1if1@t3VM4if1: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP mode DEFAULT group default qlen 1000", "    link/ether 6e:a2:f3:41:10:04 brd ff:ff:ff:ff:ff:ff"]}

TASK [All interfaces and bridges UP] ************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.21.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.1.21.1', u'bridge_name': u't3br1', u'dns': [{u'dnsif': u't3s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't3s1_dnsbrif'}], u'ns_name': u't3ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.21.2/24', u'tenant_ns_ip': u'10.1.21.1/24', u'tenant_ns_if': u't3ns1if', u'tenant_sub_if': u't3s1if', u'tenant_ns_name': u't3'}], u'bridge_ip': u'1.1.1.1', u'vxlan': [{u'local_ip': u'10.1.21.2', u'dsport': 4789, u'dev': u't3s1if', u'tenant_route_ip': u'192.168.3.2', u'remote_route': u'10.2.21.0/24', u'subnet_route': u'10.1.21.0/24', u'v_name': u'vxlan_t3s1', u'id': 42, u'remote_ip': u'10.2.21.2'}]}, {u'mem': 2, u'name': u't3_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't3br1if1', u'vmif': u't3VM1if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip link show \"t3br1if1\" ; if [ $? -eq 0 ] ; then ip link set \"t3br1if1\" netns \"t3ns1\" ; fi\nip netns exec \"t3ns1\" brctl show \"t3br1\" | grep -w 't3br1if1' ; if [ $? -ne 0 ] ; then ip netns exec \"t3ns1\" brctl addif \"t3br1\" \"t3br1if1\" ; fi\n", "delta": "0:00:00.090728", "end": "2019-11-17 10:24:28.423519", "item": [{"bridge_ip": "1.1.1.1", "bridge_name": "t3br1", "default_route_ip": "10.1.21.1", "dns": [{"brif": "t3s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t3s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t3ns1", "route": [{"if": "p1", "ip": "10.1.21.1/24", "ns_if": "t3if", "ns_name": "t3"}], "tenant_ns": [{"tenant_ns_if": "t3ns1if", "tenant_ns_ip": "10.1.21.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s1if", "tenant_sub_ip": "10.1.21.2/24"}], "vxlan": [{"dev": "t3s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.21.2", "remote_ip": "10.2.21.2", "remote_route": "10.2.21.0/24", "subnet_route": "10.1.21.0/24", "tenant_route_ip": "192.168.3.2", "v_name": "vxlan_t3s1"}]}, {"brif": "t3br1if1", "disk": "10G", "mem": 2, "name": "t3_VM1", "vcpu": 4, "vmif": "t3VM1if1"}], "rc": 0, "start": "2019-11-17 10:24:28.332791", "stderr": "", "stderr_lines": [], "stdout": "78: t3br1if1@t3VM1if1: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP mode DEFAULT group default qlen 1000\n    link/ether fa:0a:1f:db:b4:85 brd ff:ff:ff:ff:ff:ff", "stdout_lines": ["78: t3br1if1@t3VM1if1: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP mode DEFAULT group default qlen 1000", "    link/ether fa:0a:1f:db:b4:85 brd ff:ff:ff:ff:ff:ff"]}
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.21.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.1.21.1', u'bridge_name': u't3br1', u'dns': [{u'dnsif': u't3s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't3s1_dnsbrif'}], u'ns_name': u't3ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.21.2/24', u'tenant_ns_ip': u'10.1.21.1/24', u'tenant_ns_if': u't3ns1if', u'tenant_sub_if': u't3s1if', u'tenant_ns_name': u't3'}], u'bridge_ip': u'1.1.1.1', u'vxlan': [{u'local_ip': u'10.1.21.2', u'dsport': 4789, u'dev': u't3s1if', u'tenant_route_ip': u'192.168.3.2', u'remote_route': u'10.2.21.0/24', u'subnet_route': u'10.1.21.0/24', u'v_name': u'vxlan_t3s1', u'id': 42, u'remote_ip': u'10.2.21.2'}]}, {u'mem': 4, u'name': u't3_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't3br1if2', u'vmif': u't3VM2if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip link show \"t3br1if2\" ; if [ $? -eq 0 ] ; then ip link set \"t3br1if2\" netns \"t3ns1\" ; fi\nip netns exec \"t3ns1\" brctl show \"t3br1\" | grep -w 't3br1if2' ; if [ $? -ne 0 ] ; then ip netns exec \"t3ns1\" brctl addif \"t3br1\" \"t3br1if2\" ; fi\n", "delta": "0:00:00.114254", "end": "2019-11-17 10:24:28.727772", "item": [{"bridge_ip": "1.1.1.1", "bridge_name": "t3br1", "default_route_ip": "10.1.21.1", "dns": [{"brif": "t3s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t3s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t3ns1", "route": [{"if": "p1", "ip": "10.1.21.1/24", "ns_if": "t3if", "ns_name": "t3"}], "tenant_ns": [{"tenant_ns_if": "t3ns1if", "tenant_ns_ip": "10.1.21.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s1if", "tenant_sub_ip": "10.1.21.2/24"}], "vxlan": [{"dev": "t3s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.21.2", "remote_ip": "10.2.21.2", "remote_route": "10.2.21.0/24", "subnet_route": "10.1.21.0/24", "tenant_route_ip": "192.168.3.2", "v_name": "vxlan_t3s1"}]}, {"brif": "t3br1if2", "disk": "10G", "mem": 4, "name": "t3_VM2", "vcpu": 2, "vmif": "t3VM2if1"}], "rc": 0, "start": "2019-11-17 10:24:28.613518", "stderr": "", "stderr_lines": [], "stdout": "80: t3br1if2@t3VM2if1: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP mode DEFAULT group default qlen 1000\n    link/ether 4e:e9:a2:e6:60:b7 brd ff:ff:ff:ff:ff:ff", "stdout_lines": ["80: t3br1if2@t3VM2if1: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP mode DEFAULT group default qlen 1000", "    link/ether 4e:e9:a2:e6:60:b7 brd ff:ff:ff:ff:ff:ff"]}
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.21.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.2.21.1', u'bridge_name': u't3br1', u'dns': [{u'dnsif': u't3s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't3s1_dnsbrif'}], u'ns_name': u't3ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.21.2/24', u'tenant_ns_ip': u'10.2.21.1/24', u'tenant_ns_if': u't3ns1if', u'tenant_sub_if': u't3s1if', u'tenant_ns_name': u't3'}], u'bridge_ip': u'1.1.1.1', u'vxlan': [{u'local_ip': u'10.2.21.2', u'dsport': 4789, u'dev': u't3s1if', u'tenant_route_ip': u'192.168.131.2', u'remote_route': u'10.1.21.0/24', u'subnet_route': u'10.2.21.0/24', u'v_name': u'vxlan_t3s1', u'id': 42, u'remote_ip': u'10.1.21.2'}]}, {u'mem': 2, u'name': u't3_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't3br1if1', u'vmif': u't3VM4if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t3ns1\" ip link set \"t3br1if1\" up\nip netns exec \"t3ns1\" ip link set dev \"t3br1\" up\n", "delta": "0:00:00.094626", "end": "2019-11-17 10:24:28.796342", "item": [{"bridge_ip": "1.1.1.1", "bridge_name": "t3br1", "default_route_ip": "10.2.21.1", "dns": [{"brif": "t3s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t3s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "ns_name": "t3ns1", "route": [{"if": "p1", "ip": "10.2.21.1/24", "ns_if": "t3if", "ns_name": "t3"}], "tenant_ns": [{"tenant_ns_if": "t3ns1if", "tenant_ns_ip": "10.2.21.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s1if", "tenant_sub_ip": "10.2.21.2/24"}], "vxlan": [{"dev": "t3s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.21.2", "remote_ip": "10.1.21.2", "remote_route": "10.1.21.0/24", "subnet_route": "10.2.21.0/24", "tenant_route_ip": "192.168.131.2", "v_name": "vxlan_t3s1"}]}, {"brif": "t3br1if1", "disk": "10G", "mem": 2, "name": "t3_VM4", "vcpu": 4, "vmif": "t3VM4if1"}], "rc": 0, "start": "2019-11-17 10:24:28.701716", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Add IP to DNS Interface] ******************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.22.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.1.22.1', u'bridge_name': u't3br2', u'dns': [{u'dnsif': u't3s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't3s2_dnsbrif'}], u'ns_name': u't3ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.22.2/24', u'tenant_ns_ip': u'10.1.22.1/24', u'tenant_ns_if': u't3ns2if', u'tenant_sub_if': u't3s2if', u'tenant_ns_name': u't3'}], u'bridge_ip': u'2.2.2.1', u'vxlan': [{u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}, {u'mem': 3, u'name': u't3_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't3br2if1', u'vmif': u't3VM3if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip link show \"t3br2if1\" ; if [ $? -eq 0 ] ; then ip link set \"t3br2if1\" netns \"t3ns2\" ; fi\nip netns exec \"t3ns2\" brctl show \"t3br2\" | grep -w 't3br2if1' ; if [ $? -ne 0 ] ; then ip netns exec \"t3ns2\" brctl addif \"t3br2\" \"t3br2if1\" ; fi\n", "delta": "0:00:00.118441", "end": "2019-11-17 10:24:29.043503", "item": [{"bridge_ip": "2.2.2.1", "bridge_name": "t3br2", "default_route_ip": "10.1.22.1", "dns": [{"brif": "t3s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t3s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t3ns2", "route": [{"if": "p1", "ip": "10.1.22.1/24", "ns_if": "t3if", "ns_name": "t3"}], "tenant_ns": [{"tenant_ns_if": "t3ns2if", "tenant_ns_ip": "10.1.22.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s2if", "tenant_sub_ip": "10.1.22.2/24"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, {"brif": "t3br2if1", "disk": "10G", "mem": 3, "name": "t3_VM3", "vcpu": 2, "vmif": "t3VM3if1"}], "rc": 0, "start": "2019-11-17 10:24:28.925062", "stderr": "", "stderr_lines": [], "stdout": "82: t3br2if1@t3VM3if1: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP mode DEFAULT group default qlen 1000\n    link/ether 32:ee:31:38:f0:42 brd ff:ff:ff:ff:ff:ff", "stdout_lines": ["82: t3br2if1@t3VM3if1: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP mode DEFAULT group default qlen 1000", "    link/ether 32:ee:31:38:f0:42 brd ff:ff:ff:ff:ff:ff"]}

TASK [All interfaces and bridges UP] ************************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.21.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.2.21.1', u'bridge_name': u't3br1', u'ns_name': u't3ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.21.2/24', u'tenant_ns_ip': u'10.2.21.1/24', u'tenant_ns_if': u't3ns1if', u'tenant_sub_if': u't3s1if', u'tenant_ns_name': u't3'}], u'bridge_ip': u'1.1.1.1', u'vms': [{u'mem': 2, u'name': u't3_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't3br1if1', u'vmif': u't3VM4if1'}], u'vxlan': [{u'local_ip': u'10.2.21.2', u'dsport': 4789, u'dev': u't3s1if', u'tenant_route_ip': u'192.168.131.2', u'remote_route': u'10.1.21.0/24', u'subnet_route': u'10.2.21.0/24', u'v_name': u'vxlan_t3s1', u'id': 42, u'remote_ip': u'10.1.21.2'}]}, {u'dnsif': u't3s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't3s1_dnsbrif'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t3ns1\" ip addr show \"t3s1_dnsif\" | awk 'FNR==3{ print $2}'| grep -w '^1.1.1.128/24' ; if [ $? -ne 0 ] ; then ip netns exec \"t3ns1\" ip addr add \"1.1.1.128/24\" dev \"t3s1_dnsif\" ; fi\n", "delta": "0:00:00.074208", "end": "2019-11-17 10:24:29.252419", "item": [{"bridge_ip": "1.1.1.1", "bridge_name": "t3br1", "default_route_ip": "10.2.21.1", "ns_name": "t3ns1", "route": [{"if": "p1", "ip": "10.2.21.1/24", "ns_if": "t3if", "ns_name": "t3"}], "tenant_ns": [{"tenant_ns_if": "t3ns1if", "tenant_ns_ip": "10.2.21.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s1if", "tenant_sub_ip": "10.2.21.2/24"}], "vms": [{"brif": "t3br1if1", "disk": "10G", "mem": 2, "name": "t3_VM4", "vcpu": 4, "vmif": "t3VM4if1"}], "vxlan": [{"dev": "t3s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.21.2", "remote_ip": "10.1.21.2", "remote_route": "10.1.21.0/24", "subnet_route": "10.2.21.0/24", "tenant_route_ip": "192.168.131.2", "v_name": "vxlan_t3s1"}]}, {"brif": "t3s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t3s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "rc": 0, "start": "2019-11-17 10:24:29.178211", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Install DHCP Server] **********************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.21.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.1.21.1', u'bridge_name': u't3br1', u'dns': [{u'dnsif': u't3s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't3s1_dnsbrif'}], u'ns_name': u't3ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.21.2/24', u'tenant_ns_ip': u'10.1.21.1/24', u'tenant_ns_if': u't3ns1if', u'tenant_sub_if': u't3s1if', u'tenant_ns_name': u't3'}], u'bridge_ip': u'1.1.1.1', u'vxlan': [{u'local_ip': u'10.1.21.2', u'dsport': 4789, u'dev': u't3s1if', u'tenant_route_ip': u'192.168.3.2', u'remote_route': u'10.2.21.0/24', u'subnet_route': u'10.1.21.0/24', u'v_name': u'vxlan_t3s1', u'id': 42, u'remote_ip': u'10.2.21.2'}]}, {u'mem': 2, u'name': u't3_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't3br1if1', u'vmif': u't3VM1if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t3ns1\" ip link set \"t3br1if1\" up\nip netns exec \"t3ns1\" ip link set dev \"t3br1\" up\n", "delta": "0:00:00.111129", "end": "2019-11-17 10:24:29.443717", "item": [{"bridge_ip": "1.1.1.1", "bridge_name": "t3br1", "default_route_ip": "10.1.21.1", "dns": [{"brif": "t3s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t3s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t3ns1", "route": [{"if": "p1", "ip": "10.1.21.1/24", "ns_if": "t3if", "ns_name": "t3"}], "tenant_ns": [{"tenant_ns_if": "t3ns1if", "tenant_ns_ip": "10.1.21.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s1if", "tenant_sub_ip": "10.1.21.2/24"}], "vxlan": [{"dev": "t3s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.21.2", "remote_ip": "10.2.21.2", "remote_route": "10.2.21.0/24", "subnet_route": "10.1.21.0/24", "tenant_route_ip": "192.168.3.2", "v_name": "vxlan_t3s1"}]}, {"brif": "t3br1if1", "disk": "10G", "mem": 2, "name": "t3_VM1", "vcpu": 4, "vmif": "t3VM1if1"}], "rc": 0, "start": "2019-11-17 10:24:29.332588", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.21.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.1.21.1', u'bridge_name': u't3br1', u'dns': [{u'dnsif': u't3s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't3s1_dnsbrif'}], u'ns_name': u't3ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.21.2/24', u'tenant_ns_ip': u'10.1.21.1/24', u'tenant_ns_if': u't3ns1if', u'tenant_sub_if': u't3s1if', u'tenant_ns_name': u't3'}], u'bridge_ip': u'1.1.1.1', u'vxlan': [{u'local_ip': u'10.1.21.2', u'dsport': 4789, u'dev': u't3s1if', u'tenant_route_ip': u'192.168.3.2', u'remote_route': u'10.2.21.0/24', u'subnet_route': u'10.1.21.0/24', u'v_name': u'vxlan_t3s1', u'id': 42, u'remote_ip': u'10.2.21.2'}]}, {u'mem': 4, u'name': u't3_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't3br1if2', u'vmif': u't3VM2if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t3ns1\" ip link set \"t3br1if2\" up\nip netns exec \"t3ns1\" ip link set dev \"t3br1\" up\n", "delta": "0:00:00.073683", "end": "2019-11-17 10:24:29.747716", "item": [{"bridge_ip": "1.1.1.1", "bridge_name": "t3br1", "default_route_ip": "10.1.21.1", "dns": [{"brif": "t3s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t3s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t3ns1", "route": [{"if": "p1", "ip": "10.1.21.1/24", "ns_if": "t3if", "ns_name": "t3"}], "tenant_ns": [{"tenant_ns_if": "t3ns1if", "tenant_ns_ip": "10.1.21.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s1if", "tenant_sub_ip": "10.1.21.2/24"}], "vxlan": [{"dev": "t3s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.21.2", "remote_ip": "10.2.21.2", "remote_route": "10.2.21.0/24", "subnet_route": "10.1.21.0/24", "tenant_route_ip": "192.168.3.2", "v_name": "vxlan_t3s1"}]}, {"brif": "t3br1if2", "disk": "10G", "mem": 4, "name": "t3_VM2", "vcpu": 2, "vmif": "t3VM2if1"}], "rc": 0, "start": "2019-11-17 10:24:29.674033", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.21.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.2.21.1', u'bridge_name': u't3br1', u'ns_name': u't3ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.21.2/24', u'tenant_ns_ip': u'10.2.21.1/24', u'tenant_ns_if': u't3ns1if', u'tenant_sub_if': u't3s1if', u'tenant_ns_name': u't3'}], u'bridge_ip': u'1.1.1.1', u'vms': [{u'mem': 2, u'name': u't3_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't3br1if1', u'vmif': u't3VM4if1'}], u'vxlan': [{u'local_ip': u'10.2.21.2', u'dsport': 4789, u'dev': u't3s1if', u'tenant_route_ip': u'192.168.131.2', u'remote_route': u'10.1.21.0/24', u'subnet_route': u'10.2.21.0/24', u'v_name': u'vxlan_t3s1', u'id': 42, u'remote_ip': u'10.1.21.2'}]}, {u'dnsif': u't3s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't3s1_dnsbrif'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t3ns1\" ps aux | grep -w '[d]nsmasq --interface t3s1_dnsif -z --dhcp-range=1.1.1.133,1.1.1.254' ; if [ $? -ne 0 ] ; then ip netns exec \"t3ns1\" dnsmasq --interface \"t3s1_dnsif\" -z --dhcp-range=1.1.1.133,'1.1.1.254' ; fi\n", "delta": "0:00:00.076017", "end": "2019-11-17 10:24:29.754218", "item": [{"bridge_ip": "1.1.1.1", "bridge_name": "t3br1", "default_route_ip": "10.2.21.1", "ns_name": "t3ns1", "route": [{"if": "p1", "ip": "10.2.21.1/24", "ns_if": "t3if", "ns_name": "t3"}], "tenant_ns": [{"tenant_ns_if": "t3ns1if", "tenant_ns_ip": "10.2.21.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s1if", "tenant_sub_ip": "10.2.21.2/24"}], "vms": [{"brif": "t3br1if1", "disk": "10G", "mem": 2, "name": "t3_VM4", "vcpu": 4, "vmif": "t3VM4if1"}], "vxlan": [{"dev": "t3s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.21.2", "remote_ip": "10.1.21.2", "remote_route": "10.1.21.0/24", "subnet_route": "10.2.21.0/24", "tenant_route_ip": "192.168.131.2", "v_name": "vxlan_t3s1"}]}, {"brif": "t3s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t3s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "rc": 0, "start": "2019-11-17 10:24:29.678201", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Create VXLAN devices] *********************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.22.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.1.22.1', u'bridge_name': u't3br2', u'dns': [{u'dnsif': u't3s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't3s2_dnsbrif'}], u'ns_name': u't3ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.22.2/24', u'tenant_ns_ip': u'10.1.22.1/24', u'tenant_ns_if': u't3ns2if', u'tenant_sub_if': u't3s2if', u'tenant_ns_name': u't3'}], u'bridge_ip': u'2.2.2.1', u'vxlan': [{u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}, {u'mem': 3, u'name': u't3_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't3br2if1', u'vmif': u't3VM3if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t3ns2\" ip link set \"t3br2if1\" up\nip netns exec \"t3ns2\" ip link set dev \"t3br2\" up\n", "delta": "0:00:00.069328", "end": "2019-11-17 10:24:30.043718", "item": [{"bridge_ip": "2.2.2.1", "bridge_name": "t3br2", "default_route_ip": "10.1.22.1", "dns": [{"brif": "t3s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t3s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t3ns2", "route": [{"if": "p1", "ip": "10.1.22.1/24", "ns_if": "t3if", "ns_name": "t3"}], "tenant_ns": [{"tenant_ns_if": "t3ns2if", "tenant_ns_ip": "10.1.22.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s2if", "tenant_sub_ip": "10.1.22.2/24"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, {"brif": "t3br2if1", "disk": "10G", "mem": 3, "name": "t3_VM3", "vcpu": 2, "vmif": "t3VM3if1"}], "rc": 0, "start": "2019-11-17 10:24:29.974390", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Add IP to DNS Interface] ******************************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.21.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.2.21.1', u'bridge_name': u't3br1', u'dns': [{u'dnsif': u't3s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't3s1_dnsbrif'}], u'ns_name': u't3ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.21.2/24', u'tenant_ns_ip': u'10.2.21.1/24', u'tenant_ns_if': u't3ns1if', u'tenant_sub_if': u't3s1if', u'tenant_ns_name': u't3'}], u'bridge_ip': u'1.1.1.1', u'vms': [{u'mem': 2, u'name': u't3_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't3br1if1', u'vmif': u't3VM4if1'}]}, {u'local_ip': u'10.2.21.2', u'dsport': 4789, u'dev': u't3s1if', u'tenant_route_ip': u'192.168.131.2', u'remote_route': u'10.1.21.0/24', u'subnet_route': u'10.2.21.0/24', u'v_name': u'vxlan_t3s1', u'id': 42, u'remote_ip': u'10.1.21.2'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t3ns1\" ip link show \"vxlan_t3s1\" ; if [ $? -ne 0 ] ; then ip netns exec \"t3ns1\" ip link add \"vxlan_t3s1\" type vxlan id \"42\" local \"10.2.21.2\" remote \"10.1.21.2\" dstport \"4789\" dev \"t3s1if\" ; ip netns exec \"t3ns1\" ip link set dev \"vxlan_t3s1\" up ; fi\n", "delta": "0:00:00.143883", "end": "2019-11-17 10:24:30.320304", "item": [{"bridge_ip": "1.1.1.1", "bridge_name": "t3br1", "default_route_ip": "10.2.21.1", "dns": [{"brif": "t3s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t3s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "ns_name": "t3ns1", "route": [{"if": "p1", "ip": "10.2.21.1/24", "ns_if": "t3if", "ns_name": "t3"}], "tenant_ns": [{"tenant_ns_if": "t3ns1if", "tenant_ns_ip": "10.2.21.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s1if", "tenant_sub_ip": "10.2.21.2/24"}], "vms": [{"brif": "t3br1if1", "disk": "10G", "mem": 2, "name": "t3_VM4", "vcpu": 4, "vmif": "t3VM4if1"}]}, {"dev": "t3s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.21.2", "remote_ip": "10.1.21.2", "remote_route": "10.1.21.0/24", "subnet_route": "10.2.21.0/24", "tenant_route_ip": "192.168.131.2", "v_name": "vxlan_t3s1"}], "rc": 0, "start": "2019-11-17 10:24:30.176421", "stderr": "Device \"vxlan_t3s1\" does not exist.", "stderr_lines": ["Device \"vxlan_t3s1\" does not exist."], "stdout": "", "stdout_lines": []}

TASK [Attach VXLANs to bridge] ******************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.21.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.1.21.1', u'bridge_name': u't3br1', u'ns_name': u't3ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.21.2/24', u'tenant_ns_ip': u'10.1.21.1/24', u'tenant_ns_if': u't3ns1if', u'tenant_sub_if': u't3s1if', u'tenant_ns_name': u't3'}], u'bridge_ip': u'1.1.1.1', u'vms': [{u'mem': 2, u'name': u't3_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't3br1if1', u'vmif': u't3VM1if1'}, {u'mem': 4, u'name': u't3_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't3br1if2', u'vmif': u't3VM2if1'}], u'vxlan': [{u'local_ip': u'10.1.21.2', u'dsport': 4789, u'dev': u't3s1if', u'tenant_route_ip': u'192.168.3.2', u'remote_route': u'10.2.21.0/24', u'subnet_route': u'10.1.21.0/24', u'v_name': u'vxlan_t3s1', u'id': 42, u'remote_ip': u'10.2.21.2'}]}, {u'dnsif': u't3s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't3s1_dnsbrif'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t3ns1\" ip addr show \"t3s1_dnsif\" | awk 'FNR==3{ print $2 }' | grep -w '^1.1.1.1/24' ; if [ $? -ne 0 ] ; then ip netns exec \"t3ns1\" ip addr add \"1.1.1.1/24\" dev \"t3s1_dnsif\" ; fi\n", "delta": "0:00:00.070347", "end": "2019-11-17 10:24:30.399726", "item": [{"bridge_ip": "1.1.1.1", "bridge_name": "t3br1", "default_route_ip": "10.1.21.1", "ns_name": "t3ns1", "route": [{"if": "p1", "ip": "10.1.21.1/24", "ns_if": "t3if", "ns_name": "t3"}], "tenant_ns": [{"tenant_ns_if": "t3ns1if", "tenant_ns_ip": "10.1.21.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s1if", "tenant_sub_ip": "10.1.21.2/24"}], "vms": [{"brif": "t3br1if1", "disk": "10G", "mem": 2, "name": "t3_VM1", "vcpu": 4, "vmif": "t3VM1if1"}, {"brif": "t3br1if2", "disk": "10G", "mem": 4, "name": "t3_VM2", "vcpu": 2, "vmif": "t3VM2if1"}], "vxlan": [{"dev": "t3s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.21.2", "remote_ip": "10.2.21.2", "remote_route": "10.2.21.0/24", "subnet_route": "10.1.21.0/24", "tenant_route_ip": "192.168.3.2", "v_name": "vxlan_t3s1"}]}, {"brif": "t3s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t3s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "rc": 0, "start": "2019-11-17 10:24:30.329379", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.22.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.1.22.1', u'bridge_name': u't3br2', u'ns_name': u't3ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.22.2/24', u'tenant_ns_ip': u'10.1.22.1/24', u'tenant_ns_if': u't3ns2if', u'tenant_sub_if': u't3s2if', u'tenant_ns_name': u't3'}], u'bridge_ip': u'2.2.2.1', u'vms': [{u'mem': 3, u'name': u't3_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't3br2if1', u'vmif': u't3VM3if1'}], u'vxlan': [{u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}, {u'dnsif': u't3s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't3s2_dnsbrif'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t3ns2\" ip addr show \"t3s2_dnsif\" | awk 'FNR==3{ print $2 }' | grep -w '^2.2.2.1/24' ; if [ $? -ne 0 ] ; then ip netns exec \"t3ns2\" ip addr add \"2.2.2.1/24\" dev \"t3s2_dnsif\" ; fi\n", "delta": "0:00:00.066503", "end": "2019-11-17 10:24:30.695725", "item": [{"bridge_ip": "2.2.2.1", "bridge_name": "t3br2", "default_route_ip": "10.1.22.1", "ns_name": "t3ns2", "route": [{"if": "p1", "ip": "10.1.22.1/24", "ns_if": "t3if", "ns_name": "t3"}], "tenant_ns": [{"tenant_ns_if": "t3ns2if", "tenant_ns_ip": "10.1.22.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s2if", "tenant_sub_ip": "10.1.22.2/24"}], "vms": [{"brif": "t3br2if1", "disk": "10G", "mem": 3, "name": "t3_VM3", "vcpu": 2, "vmif": "t3VM3if1"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, {"brif": "t3s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t3s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "rc": 0, "start": "2019-11-17 10:24:30.629222", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Install DHCP Server] **********************************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.21.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.2.21.1', u'bridge_name': u't3br1', u'dns': [{u'dnsif': u't3s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't3s1_dnsbrif'}], u'ns_name': u't3ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.21.2/24', u'tenant_ns_ip': u'10.2.21.1/24', u'tenant_ns_if': u't3ns1if', u'tenant_sub_if': u't3s1if', u'tenant_ns_name': u't3'}], u'bridge_ip': u'1.1.1.1', u'vms': [{u'mem': 2, u'name': u't3_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't3br1if1', u'vmif': u't3VM4if1'}]}, {u'local_ip': u'10.2.21.2', u'dsport': 4789, u'dev': u't3s1if', u'tenant_route_ip': u'192.168.131.2', u'remote_route': u'10.1.21.0/24', u'subnet_route': u'10.2.21.0/24', u'v_name': u'vxlan_t3s1', u'id': 42, u'remote_ip': u'10.1.21.2'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t3ns1\" brctl show \"t3br1\" | grep -w 'vxlan_t3s1' ; if [ $? -ne 0 ] ; then ip netns exec \"t3ns1\" brctl addif \"t3br1\" \"vxlan_t3s1\" ; fi\n", "delta": "0:00:00.090904", "end": "2019-11-17 10:24:30.852331", "item": [{"bridge_ip": "1.1.1.1", "bridge_name": "t3br1", "default_route_ip": "10.2.21.1", "dns": [{"brif": "t3s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t3s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "ns_name": "t3ns1", "route": [{"if": "p1", "ip": "10.2.21.1/24", "ns_if": "t3if", "ns_name": "t3"}], "tenant_ns": [{"tenant_ns_if": "t3ns1if", "tenant_ns_ip": "10.2.21.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s1if", "tenant_sub_ip": "10.2.21.2/24"}], "vms": [{"brif": "t3br1if1", "disk": "10G", "mem": 2, "name": "t3_VM4", "vcpu": 4, "vmif": "t3VM4if1"}]}, {"dev": "t3s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.21.2", "remote_ip": "10.1.21.2", "remote_route": "10.1.21.0/24", "subnet_route": "10.2.21.0/24", "tenant_route_ip": "192.168.131.2", "v_name": "vxlan_t3s1"}], "rc": 0, "start": "2019-11-17 10:24:30.761427", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

PLAY RECAP **************************************************************************************************************************************************
99.99.99.2                 : ok=21   changed=21   unreachable=0    failed=0    skipped=0    rescued=0    ignored=0   

changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.21.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.1.21.1', u'bridge_name': u't3br1', u'ns_name': u't3ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.21.2/24', u'tenant_ns_ip': u'10.1.21.1/24', u'tenant_ns_if': u't3ns1if', u'tenant_sub_if': u't3s1if', u'tenant_ns_name': u't3'}], u'bridge_ip': u'1.1.1.1', u'vms': [{u'mem': 2, u'name': u't3_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't3br1if1', u'vmif': u't3VM1if1'}, {u'mem': 4, u'name': u't3_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't3br1if2', u'vmif': u't3VM2if1'}], u'vxlan': [{u'local_ip': u'10.1.21.2', u'dsport': 4789, u'dev': u't3s1if', u'tenant_route_ip': u'192.168.3.2', u'remote_route': u'10.2.21.0/24', u'subnet_route': u'10.1.21.0/24', u'v_name': u'vxlan_t3s1', u'id': 42, u'remote_ip': u'10.2.21.2'}]}, {u'dnsif': u't3s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't3s1_dnsbrif'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t3ns1\" ps aux | grep -w '[d]nsmasq --interface t3s1_dnsif -z --dhcp-range=1.1.1.5,1.1.1.126' ; if [ $? -ne 0 ] ; then ip netns exec \"t3ns1\" dnsmasq --interface \"t3s1_dnsif\" -z --dhcp-range=1.1.1.5,'1.1.1.126' ; fi\n", "delta": "0:00:00.083079", "end": "2019-11-17 10:24:31.077397", "item": [{"bridge_ip": "1.1.1.1", "bridge_name": "t3br1", "default_route_ip": "10.1.21.1", "ns_name": "t3ns1", "route": [{"if": "p1", "ip": "10.1.21.1/24", "ns_if": "t3if", "ns_name": "t3"}], "tenant_ns": [{"tenant_ns_if": "t3ns1if", "tenant_ns_ip": "10.1.21.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s1if", "tenant_sub_ip": "10.1.21.2/24"}], "vms": [{"brif": "t3br1if1", "disk": "10G", "mem": 2, "name": "t3_VM1", "vcpu": 4, "vmif": "t3VM1if1"}, {"brif": "t3br1if2", "disk": "10G", "mem": 4, "name": "t3_VM2", "vcpu": 2, "vmif": "t3VM2if1"}], "vxlan": [{"dev": "t3s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.21.2", "remote_ip": "10.2.21.2", "remote_route": "10.2.21.0/24", "subnet_route": "10.1.21.0/24", "tenant_route_ip": "192.168.3.2", "v_name": "vxlan_t3s1"}]}, {"brif": "t3s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t3s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "rc": 0, "start": "2019-11-17 10:24:30.994318", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}
Using /etc/ansible/ansible.cfg as config file
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.22.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.1.22.1', u'bridge_name': u't3br2', u'ns_name': u't3ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.22.2/24', u'tenant_ns_ip': u'10.1.22.1/24', u'tenant_ns_if': u't3ns2if', u'tenant_sub_if': u't3s2if', u'tenant_ns_name': u't3'}], u'bridge_ip': u'2.2.2.1', u'vms': [{u'mem': 3, u'name': u't3_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't3br2if1', u'vmif': u't3VM3if1'}], u'vxlan': [{u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}, {u'dnsif': u't3s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't3s2_dnsbrif'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t3ns2\" ps aux | grep -w '[d]nsmasq --interface t3s2_dnsif -z --dhcp-range=2.2.2.5,2.2.2.254' ; if [ $? -ne 0 ] ; then ip netns exec \"t3ns2\" dnsmasq --interface \"t3s2_dnsif\" -z --dhcp-range=2.2.2.5,'2.2.2.254' ; fi\n", "delta": "0:00:00.077809", "end": "2019-11-17 10:24:31.365271", "item": [{"bridge_ip": "2.2.2.1", "bridge_name": "t3br2", "default_route_ip": "10.1.22.1", "ns_name": "t3ns2", "route": [{"if": "p1", "ip": "10.1.22.1/24", "ns_if": "t3if", "ns_name": "t3"}], "tenant_ns": [{"tenant_ns_if": "t3ns2if", "tenant_ns_ip": "10.1.22.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s2if", "tenant_sub_ip": "10.1.22.2/24"}], "vms": [{"brif": "t3br2if1", "disk": "10G", "mem": 3, "name": "t3_VM3", "vcpu": 2, "vmif": "t3VM3if1"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, {"brif": "t3s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t3s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "rc": 0, "start": "2019-11-17 10:24:31.287462", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Create VXLAN devices] *********************************************************************************************************************************

PLAY [main] *************************************************************************************************************************************************

TASK [Add VXLAN routes in PNS] ******************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.21.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.1.21.1', u'bridge_name': u't3br1', u'dns': [{u'dnsif': u't3s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't3s1_dnsbrif'}], u'ns_name': u't3ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.21.2/24', u'tenant_ns_ip': u'10.1.21.1/24', u'tenant_ns_if': u't3ns1if', u'tenant_sub_if': u't3s1if', u'tenant_ns_name': u't3'}], u'bridge_ip': u'1.1.1.1', u'vms': [{u'mem': 2, u'name': u't3_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't3br1if1', u'vmif': u't3VM1if1'}, {u'mem': 4, u'name': u't3_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't3br1if2', u'vmif': u't3VM2if1'}]}, {u'local_ip': u'10.1.21.2', u'dsport': 4789, u'dev': u't3s1if', u'tenant_route_ip': u'192.168.3.2', u'remote_route': u'10.2.21.0/24', u'subnet_route': u'10.1.21.0/24', u'v_name': u'vxlan_t3s1', u'id': 42, u'remote_ip': u'10.2.21.2'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t3ns1\" ip link show \"vxlan_t3s1\" ; if [ $? -ne 0 ] ; then ip netns exec \"t3ns1\" ip link add \"vxlan_t3s1\" type vxlan id \"42\" local \"10.1.21.2\" remote \"10.2.21.2\" dstport \"4789\" dev \"t3s1if\"; ip netns exec \"t3ns1\" ip link set dev \"vxlan_t3s1\" up ; fi\n", "delta": "0:00:00.121238", "end": "2019-11-17 10:24:31.751560", "item": [{"bridge_ip": "1.1.1.1", "bridge_name": "t3br1", "default_route_ip": "10.1.21.1", "dns": [{"brif": "t3s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t3s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t3ns1", "route": [{"if": "p1", "ip": "10.1.21.1/24", "ns_if": "t3if", "ns_name": "t3"}], "tenant_ns": [{"tenant_ns_if": "t3ns1if", "tenant_ns_ip": "10.1.21.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s1if", "tenant_sub_ip": "10.1.21.2/24"}], "vms": [{"brif": "t3br1if1", "disk": "10G", "mem": 2, "name": "t3_VM1", "vcpu": 4, "vmif": "t3VM1if1"}, {"brif": "t3br1if2", "disk": "10G", "mem": 4, "name": "t3_VM2", "vcpu": 2, "vmif": "t3VM2if1"}]}, {"dev": "t3s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.21.2", "remote_ip": "10.2.21.2", "remote_route": "10.2.21.0/24", "subnet_route": "10.1.21.0/24", "tenant_route_ip": "192.168.3.2", "v_name": "vxlan_t3s1"}], "rc": 0, "start": "2019-11-17 10:24:31.630322", "stderr": "Device \"vxlan_t3s1\" does not exist.", "stderr_lines": ["Device \"vxlan_t3s1\" does not exist."], "stdout": "", "stdout_lines": []}
skipping: [localhost] => (item=[{u'route': [{u'ip': u'10.1.22.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.1.22.1', u'bridge_name': u't3br2', u'dns': [{u'dnsif': u't3s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't3s2_dnsbrif'}], u'ns_name': u't3ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.22.2/24', u'tenant_ns_ip': u'10.1.22.1/24', u'tenant_ns_if': u't3ns2if', u'tenant_sub_if': u't3s2if', u'tenant_ns_name': u't3'}], u'bridge_ip': u'2.2.2.1', u'vms': [{u'mem': 3, u'name': u't3_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't3br2if1', u'vmif': u't3VM3if1'}]}, {u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}])  => {"ansible_loop_var": "item", "changed": false, "item": [{"bridge_ip": "2.2.2.1", "bridge_name": "t3br2", "default_route_ip": "10.1.22.1", "dns": [{"brif": "t3s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t3s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t3ns2", "route": [{"if": "p1", "ip": "10.1.22.1/24", "ns_if": "t3if", "ns_name": "t3"}], "tenant_ns": [{"tenant_ns_if": "t3ns2if", "tenant_ns_ip": "10.1.22.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s2if", "tenant_sub_ip": "10.1.22.2/24"}], "vms": [{"brif": "t3br2if1", "disk": "10G", "mem": 3, "name": "t3_VM3", "vcpu": 2, "vmif": "t3VM3if1"}]}, {"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}], "skip_reason": "Conditional result was False"}

TASK [Attach VXLANs to bridge] ******************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.21.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.1.21.1', u'bridge_name': u't3br1', u'dns': [{u'dnsif': u't3s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't3s1_dnsbrif'}], u'ns_name': u't3ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.21.2/24', u'tenant_ns_ip': u'10.1.21.1/24', u'tenant_ns_if': u't3ns1if', u'tenant_sub_if': u't3s1if', u'tenant_ns_name': u't3'}], u'bridge_ip': u'1.1.1.1', u'vms': [{u'mem': 2, u'name': u't3_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't3br1if1', u'vmif': u't3VM1if1'}, {u'mem': 4, u'name': u't3_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't3br1if2', u'vmif': u't3VM2if1'}]}, {u'local_ip': u'10.1.21.2', u'dsport': 4789, u'dev': u't3s1if', u'tenant_route_ip': u'192.168.3.2', u'remote_route': u'10.2.21.0/24', u'subnet_route': u'10.1.21.0/24', u'v_name': u'vxlan_t3s1', u'id': 42, u'remote_ip': u'10.2.21.2'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec pns ip route show \"10.1.21.0/24\" via \"192.168.3.2\" | grep -w '^10.1.21.0/24' ; if [ $? -ne 0 ] ; then ip netns exec pns ip route add \"10.1.21.0/24\" via \"192.168.3.2\" ; fi\n", "delta": "0:00:00.081507", "end": "2019-11-17 10:24:32.043507", "item": [{"bridge_ip": "1.1.1.1", "bridge_name": "t3br1", "default_route_ip": "10.1.21.1", "dns": [{"brif": "t3s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t3s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t3ns1", "route": [{"if": "p1", "ip": "10.1.21.1/24", "ns_if": "t3if", "ns_name": "t3"}], "tenant_ns": [{"tenant_ns_if": "t3ns1if", "tenant_ns_ip": "10.1.21.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s1if", "tenant_sub_ip": "10.1.21.2/24"}], "vms": [{"brif": "t3br1if1", "disk": "10G", "mem": 2, "name": "t3_VM1", "vcpu": 4, "vmif": "t3VM1if1"}, {"brif": "t3br1if2", "disk": "10G", "mem": 4, "name": "t3_VM2", "vcpu": 2, "vmif": "t3VM2if1"}]}, {"dev": "t3s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.21.2", "remote_ip": "10.2.21.2", "remote_route": "10.2.21.0/24", "subnet_route": "10.1.21.0/24", "tenant_route_ip": "192.168.3.2", "v_name": "vxlan_t3s1"}], "rc": 0, "start": "2019-11-17 10:24:31.962000", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}
skipping: [localhost] => (item=[{u'route': [{u'ip': u'10.1.22.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.1.22.1', u'bridge_name': u't3br2', u'dns': [{u'dnsif': u't3s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't3s2_dnsbrif'}], u'ns_name': u't3ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.22.2/24', u'tenant_ns_ip': u'10.1.22.1/24', u'tenant_ns_if': u't3ns2if', u'tenant_sub_if': u't3s2if', u'tenant_ns_name': u't3'}], u'bridge_ip': u'2.2.2.1', u'vms': [{u'mem': 3, u'name': u't3_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't3br2if1', u'vmif': u't3VM3if1'}]}, {u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}])  => {"ansible_loop_var": "item", "changed": false, "item": [{"bridge_ip": "2.2.2.1", "bridge_name": "t3br2", "default_route_ip": "10.1.22.1", "dns": [{"brif": "t3s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t3s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t3ns2", "route": [{"if": "p1", "ip": "10.1.22.1/24", "ns_if": "t3if", "ns_name": "t3"}], "tenant_ns": [{"tenant_ns_if": "t3ns2if", "tenant_ns_ip": "10.1.22.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s2if", "tenant_sub_ip": "10.1.22.2/24"}], "vms": [{"brif": "t3br2if1", "disk": "10G", "mem": 3, "name": "t3_VM3", "vcpu": 2, "vmif": "t3VM3if1"}]}, {"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}], "skip_reason": "Conditional result was False"}

TASK [Get PNS ip address] ***********************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.21.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.1.21.1', u'bridge_name': u't3br1', u'dns': [{u'dnsif': u't3s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't3s1_dnsbrif'}], u'ns_name': u't3ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.21.2/24', u'tenant_ns_ip': u'10.1.21.1/24', u'tenant_ns_if': u't3ns1if', u'tenant_sub_if': u't3s1if', u'tenant_ns_name': u't3'}], u'bridge_ip': u'1.1.1.1', u'vms': [{u'mem': 2, u'name': u't3_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't3br1if1', u'vmif': u't3VM1if1'}, {u'mem': 4, u'name': u't3_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't3br1if2', u'vmif': u't3VM2if1'}]}, {u'local_ip': u'10.1.21.2', u'dsport': 4789, u'dev': u't3s1if', u'tenant_route_ip': u'192.168.3.2', u'remote_route': u'10.2.21.0/24', u'subnet_route': u'10.1.21.0/24', u'v_name': u'vxlan_t3s1', u'id': 42, u'remote_ip': u'10.2.21.2'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t3ns1\" brctl show \"t3br1\" | grep -w 'vxlan_t3s1' ; if [ $? -ne 0 ] ; then ip netns exec \"t3ns1\" brctl addif \"t3br1\" \"vxlan_t3s1\" ; fi\n", "delta": "0:00:00.069937", "end": "2019-11-17 10:24:32.103553", "item": [{"bridge_ip": "1.1.1.1", "bridge_name": "t3br1", "default_route_ip": "10.1.21.1", "dns": [{"brif": "t3s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t3s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t3ns1", "route": [{"if": "p1", "ip": "10.1.21.1/24", "ns_if": "t3if", "ns_name": "t3"}], "tenant_ns": [{"tenant_ns_if": "t3ns1if", "tenant_ns_ip": "10.1.21.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s1if", "tenant_sub_ip": "10.1.21.2/24"}], "vms": [{"brif": "t3br1if1", "disk": "10G", "mem": 2, "name": "t3_VM1", "vcpu": 4, "vmif": "t3VM1if1"}, {"brif": "t3br1if2", "disk": "10G", "mem": 4, "name": "t3_VM2", "vcpu": 2, "vmif": "t3VM2if1"}]}, {"dev": "t3s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.21.2", "remote_ip": "10.2.21.2", "remote_route": "10.2.21.0/24", "subnet_route": "10.1.21.0/24", "tenant_route_ip": "192.168.3.2", "v_name": "vxlan_t3s1"}], "rc": 0, "start": "2019-11-17 10:24:32.033616", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}
skipping: [localhost] => (item=[{u'route': [{u'ip': u'10.1.22.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.1.22.1', u'bridge_name': u't3br2', u'dns': [{u'dnsif': u't3s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't3s2_dnsbrif'}], u'ns_name': u't3ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.22.2/24', u'tenant_ns_ip': u'10.1.22.1/24', u'tenant_ns_if': u't3ns2if', u'tenant_sub_if': u't3s2if', u'tenant_ns_name': u't3'}], u'bridge_ip': u'2.2.2.1', u'vms': [{u'mem': 3, u'name': u't3_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't3br2if1', u'vmif': u't3VM3if1'}]}, {u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}])  => {"ansible_loop_var": "item", "changed": false, "item": [{"bridge_ip": "2.2.2.1", "bridge_name": "t3br2", "default_route_ip": "10.1.22.1", "dns": [{"brif": "t3s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t3s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t3ns2", "route": [{"if": "p1", "ip": "10.1.22.1/24", "ns_if": "t3if", "ns_name": "t3"}], "tenant_ns": [{"tenant_ns_if": "t3ns2if", "tenant_ns_ip": "10.1.22.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s2if", "tenant_sub_ip": "10.1.22.2/24"}], "vms": [{"brif": "t3br2if1", "disk": "10G", "mem": 3, "name": "t3_VM3", "vcpu": 2, "vmif": "t3VM3if1"}]}, {"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}], "skip_reason": "Conditional result was False"}

PLAY RECAP **************************************************************************************************************************************************
localhost                  : ok=21   changed=21   unreachable=0    failed=0    skipped=0    rescued=0    ignored=0   

ok: [localhost] => {"changed": false, "cmd": "ip netns exec pns ip addr show p1 | awk 'FNR==3{ print $2 }' | awk -F/ '{ print $1 }'\n", "delta": "0:00:00.034404", "end": "2019-11-17 10:24:32.368151", "rc": 0, "start": "2019-11-17 10:24:32.333747", "stderr": "", "stderr_lines": [], "stdout": "192.168.100.238", "stdout_lines": ["192.168.100.238"]}

TASK [Add VXLAN routes to host] *****************************************************************************************************************************
Using /etc/ansible/ansible.cfg as config file
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.21.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.1.21.1', u'bridge_name': u't3br1', u'dns': [{u'dnsif': u't3s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't3s1_dnsbrif'}], u'ns_name': u't3ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.21.2/24', u'tenant_ns_ip': u'10.1.21.1/24', u'tenant_ns_if': u't3ns1if', u'tenant_sub_if': u't3s1if', u'tenant_ns_name': u't3'}], u'bridge_ip': u'1.1.1.1', u'vms': [{u'mem': 2, u'name': u't3_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't3br1if1', u'vmif': u't3VM1if1'}, {u'mem': 4, u'name': u't3_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't3br1if2', u'vmif': u't3VM2if1'}]}, {u'local_ip': u'10.1.21.2', u'dsport': 4789, u'dev': u't3s1if', u'tenant_route_ip': u'192.168.3.2', u'remote_route': u'10.2.21.0/24', u'subnet_route': u'10.1.21.0/24', u'v_name': u'vxlan_t3s1', u'id': 42, u'remote_ip': u'10.2.21.2'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip route show \"10.1.21.0/24\" via \"192.168.100.238\" | grep -w '^10.1.21.0/24' ; if [ $? -ne 0 ] ; then ip route add \"10.1.21.0/24\" via \"192.168.100.238\" ; fi\nip route show \"10.2.21.0/24\" via 99.99.99.2 | grep -w '^10.2.21.0/24'; if [ $? -ne 0 ] ; then ip route add \"10.2.21.0/24\" via 99.99.99.2 ; fi\n", "delta": "0:00:00.009429", "end": "2019-11-17 10:24:32.692606", "item": [{"bridge_ip": "1.1.1.1", "bridge_name": "t3br1", "default_route_ip": "10.1.21.1", "dns": [{"brif": "t3s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t3s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t3ns1", "route": [{"if": "p1", "ip": "10.1.21.1/24", "ns_if": "t3if", "ns_name": "t3"}], "tenant_ns": [{"tenant_ns_if": "t3ns1if", "tenant_ns_ip": "10.1.21.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s1if", "tenant_sub_ip": "10.1.21.2/24"}], "vms": [{"brif": "t3br1if1", "disk": "10G", "mem": 2, "name": "t3_VM1", "vcpu": 4, "vmif": "t3VM1if1"}, {"brif": "t3br1if2", "disk": "10G", "mem": 4, "name": "t3_VM2", "vcpu": 2, "vmif": "t3VM2if1"}]}, {"dev": "t3s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.21.2", "remote_ip": "10.2.21.2", "remote_route": "10.2.21.0/24", "subnet_route": "10.1.21.0/24", "tenant_route_ip": "192.168.3.2", "v_name": "vxlan_t3s1"}], "rc": 0, "start": "2019-11-17 10:24:32.683177", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}
skipping: [localhost] => (item=[{u'route': [{u'ip': u'10.1.22.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.1.22.1', u'bridge_name': u't3br2', u'dns': [{u'dnsif': u't3s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't3s2_dnsbrif'}], u'ns_name': u't3ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.22.2/24', u'tenant_ns_ip': u'10.1.22.1/24', u'tenant_ns_if': u't3ns2if', u'tenant_sub_if': u't3s2if', u'tenant_ns_name': u't3'}], u'bridge_ip': u'2.2.2.1', u'vms': [{u'mem': 3, u'name': u't3_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't3br2if1', u'vmif': u't3VM3if1'}]}, {u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}])  => {"ansible_loop_var": "item", "changed": false, "item": [{"bridge_ip": "2.2.2.1", "bridge_name": "t3br2", "default_route_ip": "10.1.22.1", "dns": [{"brif": "t3s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t3s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t3ns2", "route": [{"if": "p1", "ip": "10.1.22.1/24", "ns_if": "t3if", "ns_name": "t3"}], "tenant_ns": [{"tenant_ns_if": "t3ns2if", "tenant_ns_ip": "10.1.22.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s2if", "tenant_sub_ip": "10.1.22.2/24"}], "vms": [{"brif": "t3br2if1", "disk": "10G", "mem": 3, "name": "t3_VM3", "vcpu": 2, "vmif": "t3VM3if1"}]}, {"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}], "skip_reason": "Conditional result was False"}

PLAY RECAP **************************************************************************************************************************************************
localhost                  : ok=3    changed=2    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0   


PLAY [worker] ***********************************************************************************************************************************************

TASK [Create Tenant Namespace] ******************************************************************************************************************************
Using /etc/ansible/ansible.cfg as config file
ok: [99.99.99.2] => (item={u'default_route_ip': u'192.168.131.1', u'name': u't3', u'pns_ip': u'192.168.131.1/24', u'tenant_if': u't3if', u'tenant_ip': u'192.168.131.2/24', u'pns_if': u't3pns_if'}) => {"ansible_loop_var": "item", "changed": false, "cmd": ["ip", "netns", "add", "t3"], "item": {"default_route_ip": "192.168.131.1", "name": "t3", "pns_if": "t3pns_if", "pns_ip": "192.168.131.1/24", "tenant_if": "t3if", "tenant_ip": "192.168.131.2/24"}, "rc": 0, "stdout": "skipped, since /var/run/netns/t3 exists", "stdout_lines": ["skipped, since /var/run/netns/t3 exists"]}

PLAY [worker] ***********************************************************************************************************************************************

TASK [Create Subnet Namespace] ******************************************************************************************************************************

TASK [Add VXLAN routes in PNS] ******************************************************************************************************************************
ok: [99.99.99.2] => (item={u'route': [{u'ip': u'10.2.21.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.2.21.1', u'bridge_name': u't3br1', u'dns': [{u'dnsif': u't3s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't3s1_dnsbrif'}], u'ns_name': u't3ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.21.2/24', u'tenant_ns_ip': u'10.2.21.1/24', u'tenant_ns_if': u't3ns1if', u'tenant_ns_name': u't3', u'tenant_sub_if': u't3s1if'}], u'bridge_ip': u'1.1.1.1', u'vms': [{u'mem': 2, u'name': u't3_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't3br1if1', u'vmif': u't3VM4if1'}], u'vxlan': [{u'local_ip': u'10.2.21.2', u'tenant_route_ip': u'192.168.131.2', u'dsport': 4789, u'dev': u't3s1if', u'subnet_route': u'10.2.21.0/24', u'remote_route': u'10.1.21.0/24', u'v_name': u'vxlan_t3s1', u'id': 42, u'remote_ip': u'10.1.21.2'}]}) => {"ansible_loop_var": "item", "changed": false, "cmd": ["ip", "netns", "add", "t3ns1"], "item": {"bridge_ip": "1.1.1.1", "bridge_name": "t3br1", "default_route_ip": "10.2.21.1", "dns": [{"brif": "t3s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t3s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "ns_name": "t3ns1", "route": [{"if": "p1", "ip": "10.2.21.1/24", "ns_if": "t3if", "ns_name": "t3"}], "tenant_ns": [{"tenant_ns_if": "t3ns1if", "tenant_ns_ip": "10.2.21.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s1if", "tenant_sub_ip": "10.2.21.2/24"}], "vms": [{"brif": "t3br1if1", "disk": "10G", "mem": 2, "name": "t3_VM4", "vcpu": 4, "vmif": "t3VM4if1"}], "vxlan": [{"dev": "t3s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.21.2", "remote_ip": "10.1.21.2", "remote_route": "10.1.21.0/24", "subnet_route": "10.2.21.0/24", "tenant_route_ip": "192.168.131.2", "v_name": "vxlan_t3s1"}]}, "rc": 0, "stdout": "skipped, since /var/run/netns/t3ns1 exists", "stdout_lines": ["skipped, since /var/run/netns/t3ns1 exists"]}

TASK [Create Tenant VETH pairs] *****************************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.21.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.2.21.1', u'bridge_name': u't3br1', u'dns': [{u'dnsif': u't3s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't3s1_dnsbrif'}], u'ns_name': u't3ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.21.2/24', u'tenant_ns_ip': u'10.2.21.1/24', u'tenant_ns_if': u't3ns1if', u'tenant_sub_if': u't3s1if', u'tenant_ns_name': u't3'}], u'bridge_ip': u'1.1.1.1', u'vms': [{u'mem': 2, u'name': u't3_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't3br1if1', u'vmif': u't3VM4if1'}]}, {u'local_ip': u'10.2.21.2', u'dsport': 4789, u'dev': u't3s1if', u'tenant_route_ip': u'192.168.131.2', u'remote_route': u'10.1.21.0/24', u'subnet_route': u'10.2.21.0/24', u'v_name': u'vxlan_t3s1', u'id': 42, u'remote_ip': u'10.1.21.2'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec pns ip route show \"10.2.21.0/24\" via \"192.168.131.2\" | grep -w '^10.2.21.0/24' ; if [ $? -ne 0 ] ; then ip netns exec pns ip route add \"10.2.21.0/24\" via \"192.168.131.2\" ; fi\n", "delta": "0:00:00.086973", "end": "2019-11-17 10:24:34.024369", "item": [{"bridge_ip": "1.1.1.1", "bridge_name": "t3br1", "default_route_ip": "10.2.21.1", "dns": [{"brif": "t3s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t3s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "ns_name": "t3ns1", "route": [{"if": "p1", "ip": "10.2.21.1/24", "ns_if": "t3if", "ns_name": "t3"}], "tenant_ns": [{"tenant_ns_if": "t3ns1if", "tenant_ns_ip": "10.2.21.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s1if", "tenant_sub_ip": "10.2.21.2/24"}], "vms": [{"brif": "t3br1if1", "disk": "10G", "mem": 2, "name": "t3_VM4", "vcpu": 4, "vmif": "t3VM4if1"}]}, {"dev": "t3s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.21.2", "remote_ip": "10.1.21.2", "remote_route": "10.1.21.0/24", "subnet_route": "10.2.21.0/24", "tenant_route_ip": "192.168.131.2", "v_name": "vxlan_t3s1"}], "rc": 0, "start": "2019-11-17 10:24:33.937396", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Get PNS ip address] ***********************************************************************************************************************************
changed: [99.99.99.2] => (item={u'default_route_ip': u'192.168.131.1', u'name': u't3', u'pns_ip': u'192.168.131.1/24', u'tenant_if': u't3if', u'tenant_ip': u'192.168.131.2/24', u'pns_if': u't3pns_if'}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip link show \"t3if\" ; if [ $? -ne 0 ] ; then ip link add \"t3if\" type veth peer name \"t3pns_if\" ; fi\n", "delta": "0:00:00.011204", "end": "2019-11-17 10:24:34.149677", "item": {"default_route_ip": "192.168.131.1", "name": "t3", "pns_if": "t3pns_if", "pns_ip": "192.168.131.1/24", "tenant_if": "t3if", "tenant_ip": "192.168.131.2/24"}, "rc": 0, "start": "2019-11-17 10:24:34.138473", "stderr": "Device \"t3if\" does not exist.", "stderr_lines": ["Device \"t3if\" does not exist."], "stdout": "", "stdout_lines": []}

TASK [Attach Tenant VETH Pairs] *****************************************************************************************************************************
ok: [99.99.99.2] => {"changed": false, "cmd": "ip netns exec pns ip addr show p1 | awk 'FNR==3{ print $2 }' | awk -F/ '{ print $1 }'\n", "delta": "0:00:00.055406", "end": "2019-11-17 10:24:34.480736", "rc": 0, "start": "2019-11-17 10:24:34.425330", "stderr": "", "stderr_lines": [], "stdout": "192.168.100.50", "stdout_lines": ["192.168.100.50"]}

TASK [Add VXLAN routes to host] *****************************************************************************************************************************
changed: [99.99.99.2] => (item={u'default_route_ip': u'192.168.131.1', u'name': u't3', u'pns_ip': u'192.168.131.1/24', u'tenant_if': u't3if', u'tenant_ip': u'192.168.131.2/24', u'pns_if': u't3pns_if'}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec pns ip link show \"t3pns_if\" ; if [ $? -ne 0 ] ; then ip link set \"t3pns_if\" netns pns ; fi\nip netns exec \"t3\" ip link show \"t3if\" ; if [ $? -ne 0 ] ; then ip link set \"t3if\" netns \"t3\" ; fi\nip netns exec pns ip link set dev \"t3pns_if\" up\nip netns exec \"t3\" ip link set dev \"t3if\" up\n", "delta": "0:00:00.162804", "end": "2019-11-17 10:24:34.716321", "item": {"default_route_ip": "192.168.131.1", "name": "t3", "pns_if": "t3pns_if", "pns_ip": "192.168.131.1/24", "tenant_if": "t3if", "tenant_ip": "192.168.131.2/24"}, "rc": 0, "start": "2019-11-17 10:24:34.553517", "stderr": "", "stderr_lines": [], "stdout": "39: t3pns_if@if40: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP mode DEFAULT group default qlen 1000\n    link/ether 5a:b3:ce:30:c8:43 brd ff:ff:ff:ff:ff:ff link-netnsid 3\n40: t3if@if39: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP mode DEFAULT group default qlen 1000\n    link/ether fa:c6:04:a2:f5:eb brd ff:ff:ff:ff:ff:ff link-netnsid 0", "stdout_lines": ["39: t3pns_if@if40: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP mode DEFAULT group default qlen 1000", "    link/ether 5a:b3:ce:30:c8:43 brd ff:ff:ff:ff:ff:ff link-netnsid 3", "40: t3if@if39: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP mode DEFAULT group default qlen 1000", "    link/ether fa:c6:04:a2:f5:eb brd ff:ff:ff:ff:ff:ff link-netnsid 0"]}

TASK [Add IP addresses to Tenant VETH Pairs] ****************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.21.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.2.21.1', u'bridge_name': u't3br1', u'dns': [{u'dnsif': u't3s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't3s1_dnsbrif'}], u'ns_name': u't3ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.21.2/24', u'tenant_ns_ip': u'10.2.21.1/24', u'tenant_ns_if': u't3ns1if', u'tenant_sub_if': u't3s1if', u'tenant_ns_name': u't3'}], u'bridge_ip': u'1.1.1.1', u'vms': [{u'mem': 2, u'name': u't3_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't3br1if1', u'vmif': u't3VM4if1'}]}, {u'local_ip': u'10.2.21.2', u'dsport': 4789, u'dev': u't3s1if', u'tenant_route_ip': u'192.168.131.2', u'remote_route': u'10.1.21.0/24', u'subnet_route': u'10.2.21.0/24', u'v_name': u'vxlan_t3s1', u'id': 42, u'remote_ip': u'10.1.21.2'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip route show \"10.2.21.0/24\" via \"192.168.100.50\" | grep -w '^10.2.21.0/24' ; if [ $? -ne 0 ] ; then ip route add \"10.2.21.0/24\" via \"192.168.100.50\" ; fi\nip route show \"10.1.21.0/24\" via 99.99.99.1 | grep -w '^10.1.21.0/24'; if [ $? -ne 0 ] ; then ip route add \"10.1.21.0/24\" via 99.99.99.1 ; fi\n", "delta": "0:00:00.012271", "end": "2019-11-17 10:24:34.907693", "item": [{"bridge_ip": "1.1.1.1", "bridge_name": "t3br1", "default_route_ip": "10.2.21.1", "dns": [{"brif": "t3s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t3s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "ns_name": "t3ns1", "route": [{"if": "p1", "ip": "10.2.21.1/24", "ns_if": "t3if", "ns_name": "t3"}], "tenant_ns": [{"tenant_ns_if": "t3ns1if", "tenant_ns_ip": "10.2.21.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s1if", "tenant_sub_ip": "10.2.21.2/24"}], "vms": [{"brif": "t3br1if1", "disk": "10G", "mem": 2, "name": "t3_VM4", "vcpu": 4, "vmif": "t3VM4if1"}]}, {"dev": "t3s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.21.2", "remote_ip": "10.1.21.2", "remote_route": "10.1.21.0/24", "subnet_route": "10.2.21.0/24", "tenant_route_ip": "192.168.131.2", "v_name": "vxlan_t3s1"}], "rc": 0, "start": "2019-11-17 10:24:34.895422", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

PLAY RECAP **************************************************************************************************************************************************
99.99.99.2                 : ok=3    changed=2    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0   

changed: [99.99.99.2] => (item={u'default_route_ip': u'192.168.131.1', u'name': u't3', u'pns_ip': u'192.168.131.1/24', u'tenant_if': u't3if', u'tenant_ip': u'192.168.131.2/24', u'pns_if': u't3pns_if'}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec pns ip addr show \"t3pns_if\" | awk 'FNR==3{ print $2 }' | grep -w '^192.168.131.1/24' ; if [ $? -ne 0 ] ; then ip netns exec pns ip addr add \"192.168.131.1/24\" dev \"t3pns_if\" ; fi\nip netns exec \"t3\" ip addr show \"t3if\" | awk 'FNR==3{ print $2 }' | grep -w '^192.168.131.2/24' ; if [ $? -ne 0 ] ; then ip netns exec \"t3\" ip addr add \"192.168.131.2/24\" dev \"t3if\" ; fi\n", "delta": "0:00:00.075884", "end": "2019-11-17 10:24:35.164689", "item": {"default_route_ip": "192.168.131.1", "name": "t3", "pns_if": "t3pns_if", "pns_ip": "192.168.131.1/24", "tenant_if": "t3if", "tenant_ip": "192.168.131.2/24"}, "rc": 0, "start": "2019-11-17 10:24:35.088805", "stderr": "", "stderr_lines": [], "stdout": "192.168.131.1/24\n192.168.131.2/24", "stdout_lines": ["192.168.131.1/24", "192.168.131.2/24"]}

TASK [Create Namespace VETH Pairs] **************************************************************************************************************************
Using /etc/ansible/ansible.cfg as config file

PLAY [main] *************************************************************************************************************************************************

TASK [Create VM templates (C1)] *****************************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.21.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.2.21.1', u'bridge_name': u't3br1', u'dns': [{u'dnsif': u't3s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't3s1_dnsbrif'}], u'ns_name': u't3ns1', u'bridge_ip': u'1.1.1.1', u'vms': [{u'mem': 2, u'name': u't3_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't3br1if1', u'vmif': u't3VM4if1'}], u'vxlan': [{u'local_ip': u'10.2.21.2', u'dsport': 4789, u'dev': u't3s1if', u'tenant_route_ip': u'192.168.131.2', u'remote_route': u'10.1.21.0/24', u'subnet_route': u'10.2.21.0/24', u'v_name': u'vxlan_t3s1', u'id': 42, u'remote_ip': u'10.1.21.2'}]}, {u'tenant_sub_ip': u'10.2.21.2/24', u'tenant_ns_ip': u'10.2.21.1/24', u'tenant_ns_if': u't3ns1if', u'tenant_sub_if': u't3s1if', u'tenant_ns_name': u't3'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip link show \"t3ns1if\" ; if [ $? -ne 0 ] ; then ip link add \"t3ns1if\" type veth peer name \"t3s1if\" ; fi\n", "delta": "0:00:00.017616", "end": "2019-11-17 10:24:35.565469", "item": [{"bridge_ip": "1.1.1.1", "bridge_name": "t3br1", "default_route_ip": "10.2.21.1", "dns": [{"brif": "t3s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t3s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "ns_name": "t3ns1", "route": [{"if": "p1", "ip": "10.2.21.1/24", "ns_if": "t3if", "ns_name": "t3"}], "vms": [{"brif": "t3br1if1", "disk": "10G", "mem": 2, "name": "t3_VM4", "vcpu": 4, "vmif": "t3VM4if1"}], "vxlan": [{"dev": "t3s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.21.2", "remote_ip": "10.1.21.2", "remote_route": "10.1.21.0/24", "subnet_route": "10.2.21.0/24", "tenant_route_ip": "192.168.131.2", "v_name": "vxlan_t3s1"}]}, {"tenant_ns_if": "t3ns1if", "tenant_ns_ip": "10.2.21.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s1if", "tenant_sub_ip": "10.2.21.2/24"}], "rc": 0, "start": "2019-11-17 10:24:35.547853", "stderr": "Device \"t3ns1if\" does not exist.", "stderr_lines": ["Device \"t3ns1if\" does not exist."], "stdout": "", "stdout_lines": []}

TASK [Attach Namespace VETH Pairs] **************************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.21.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.2.21.1', u'bridge_name': u't3br1', u'dns': [{u'dnsif': u't3s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't3s1_dnsbrif'}], u'ns_name': u't3ns1', u'bridge_ip': u'1.1.1.1', u'vms': [{u'mem': 2, u'name': u't3_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't3br1if1', u'vmif': u't3VM4if1'}], u'vxlan': [{u'local_ip': u'10.2.21.2', u'dsport': 4789, u'dev': u't3s1if', u'tenant_route_ip': u'192.168.131.2', u'remote_route': u'10.1.21.0/24', u'subnet_route': u'10.2.21.0/24', u'v_name': u'vxlan_t3s1', u'id': 42, u'remote_ip': u'10.1.21.2'}]}, {u'tenant_sub_ip': u'10.2.21.2/24', u'tenant_ns_ip': u'10.2.21.1/24', u'tenant_ns_if': u't3ns1if', u'tenant_sub_if': u't3s1if', u'tenant_ns_name': u't3'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t3\" ip link show \"t3ns1if\" ; if [ $? -ne 0 ] ; then ip link set \"t3ns1if\" netns \"t3\" ; fi\nip netns exec \"t3ns1\" ip link show \"t3s1if\" ; if [ $? -ne 0 ] ; then ip link set \"t3s1if\" netns \"t3ns1\" ; fi\n", "delta": "0:00:00.073977", "end": "2019-11-17 10:24:36.052361", "item": [{"bridge_ip": "1.1.1.1", "bridge_name": "t3br1", "default_route_ip": "10.2.21.1", "dns": [{"brif": "t3s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t3s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "ns_name": "t3ns1", "route": [{"if": "p1", "ip": "10.2.21.1/24", "ns_if": "t3if", "ns_name": "t3"}], "vms": [{"brif": "t3br1if1", "disk": "10G", "mem": 2, "name": "t3_VM4", "vcpu": 4, "vmif": "t3VM4if1"}], "vxlan": [{"dev": "t3s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.21.2", "remote_ip": "10.1.21.2", "remote_route": "10.1.21.0/24", "subnet_route": "10.2.21.0/24", "tenant_route_ip": "192.168.131.2", "v_name": "vxlan_t3s1"}]}, {"tenant_ns_if": "t3ns1if", "tenant_ns_ip": "10.2.21.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s1if", "tenant_sub_ip": "10.2.21.2/24"}], "rc": 0, "start": "2019-11-17 10:24:35.978384", "stderr": "", "stderr_lines": [], "stdout": "42: t3ns1if@if41: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP mode DEFAULT group default qlen 1000\n    link/ether 4a:f8:5c:b8:80:b0 brd ff:ff:ff:ff:ff:ff link-netnsid 2\n41: t3s1if@if42: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP mode DEFAULT group default qlen 1000\n    link/ether 66:c2:d3:61:a2:eb brd ff:ff:ff:ff:ff:ff link-netnsid 0", "stdout_lines": ["42: t3ns1if@if41: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP mode DEFAULT group default qlen 1000", "    link/ether 4a:f8:5c:b8:80:b0 brd ff:ff:ff:ff:ff:ff link-netnsid 2", "41: t3s1if@if42: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP mode DEFAULT group default qlen 1000", "    link/ether 66:c2:d3:61:a2:eb brd ff:ff:ff:ff:ff:ff link-netnsid 0"]}

TASK [Set Namespace VETH Pairs UP] **************************************************************************************************************************
ok: [localhost] => (item=[{u'route': [{u'ip': u'10.1.21.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.1.21.1', u'bridge_name': u't3br1', u'dns': [{u'dnsif': u't3s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't3s1_dnsbrif'}], u'ns_name': u't3ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.21.2/24', u'tenant_ns_ip': u'10.1.21.1/24', u'tenant_ns_if': u't3ns1if', u'tenant_sub_if': u't3s1if', u'tenant_ns_name': u't3'}], u'bridge_ip': u'1.1.1.1', u'vxlan': [{u'local_ip': u'10.1.21.2', u'dsport': 4789, u'dev': u't3s1if', u'tenant_route_ip': u'192.168.3.2', u'remote_route': u'10.2.21.0/24', u'subnet_route': u'10.1.21.0/24', u'v_name': u'vxlan_t3s1', u'id': 42, u'remote_ip': u'10.2.21.2'}]}, {u'mem': 2, u'name': u't3_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't3br1if1', u'vmif': u't3VM1if1'}]) => {"ansible_loop_var": "item", "changed": false, "checksum": "350ba870bd31b7f6ee517845c14237910b5af0bf", "dest": "/root/Migration-as-a-Service/t3/VM_templates/t3_VM1.xml.j2", "gid": 0, "group": "root", "item": [{"bridge_ip": "1.1.1.1", "bridge_name": "t3br1", "default_route_ip": "10.1.21.1", "dns": [{"brif": "t3s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t3s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t3ns1", "route": [{"if": "p1", "ip": "10.1.21.1/24", "ns_if": "t3if", "ns_name": "t3"}], "tenant_ns": [{"tenant_ns_if": "t3ns1if", "tenant_ns_ip": "10.1.21.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s1if", "tenant_sub_ip": "10.1.21.2/24"}], "vxlan": [{"dev": "t3s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.21.2", "remote_ip": "10.2.21.2", "remote_route": "10.2.21.0/24", "subnet_route": "10.1.21.0/24", "tenant_route_ip": "192.168.3.2", "v_name": "vxlan_t3s1"}]}, {"brif": "t3br1if1", "disk": "10G", "mem": 2, "name": "t3_VM1", "vcpu": 4, "vmif": "t3VM1if1"}], "mode": "0644", "owner": "root", "path": "/root/Migration-as-a-Service/t3/VM_templates/t3_VM1.xml.j2", "size": 4091, "state": "file", "uid": 0}
ok: [localhost] => (item=[{u'route': [{u'ip': u'10.1.21.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.1.21.1', u'bridge_name': u't3br1', u'dns': [{u'dnsif': u't3s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't3s1_dnsbrif'}], u'ns_name': u't3ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.21.2/24', u'tenant_ns_ip': u'10.1.21.1/24', u'tenant_ns_if': u't3ns1if', u'tenant_sub_if': u't3s1if', u'tenant_ns_name': u't3'}], u'bridge_ip': u'1.1.1.1', u'vxlan': [{u'local_ip': u'10.1.21.2', u'dsport': 4789, u'dev': u't3s1if', u'tenant_route_ip': u'192.168.3.2', u'remote_route': u'10.2.21.0/24', u'subnet_route': u'10.1.21.0/24', u'v_name': u'vxlan_t3s1', u'id': 42, u'remote_ip': u'10.2.21.2'}]}, {u'mem': 4, u'name': u't3_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't3br1if2', u'vmif': u't3VM2if1'}]) => {"ansible_loop_var": "item", "changed": false, "checksum": "350ba870bd31b7f6ee517845c14237910b5af0bf", "dest": "/root/Migration-as-a-Service/t3/VM_templates/t3_VM2.xml.j2", "gid": 0, "group": "root", "item": [{"bridge_ip": "1.1.1.1", "bridge_name": "t3br1", "default_route_ip": "10.1.21.1", "dns": [{"brif": "t3s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t3s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t3ns1", "route": [{"if": "p1", "ip": "10.1.21.1/24", "ns_if": "t3if", "ns_name": "t3"}], "tenant_ns": [{"tenant_ns_if": "t3ns1if", "tenant_ns_ip": "10.1.21.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s1if", "tenant_sub_ip": "10.1.21.2/24"}], "vxlan": [{"dev": "t3s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.21.2", "remote_ip": "10.2.21.2", "remote_route": "10.2.21.0/24", "subnet_route": "10.1.21.0/24", "tenant_route_ip": "192.168.3.2", "v_name": "vxlan_t3s1"}]}, {"brif": "t3br1if2", "disk": "10G", "mem": 4, "name": "t3_VM2", "vcpu": 2, "vmif": "t3VM2if1"}], "mode": "0644", "owner": "root", "path": "/root/Migration-as-a-Service/t3/VM_templates/t3_VM2.xml.j2", "size": 4091, "state": "file", "uid": 0}
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.21.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.2.21.1', u'bridge_name': u't3br1', u'dns': [{u'dnsif': u't3s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't3s1_dnsbrif'}], u'ns_name': u't3ns1', u'bridge_ip': u'1.1.1.1', u'vms': [{u'mem': 2, u'name': u't3_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't3br1if1', u'vmif': u't3VM4if1'}], u'vxlan': [{u'local_ip': u'10.2.21.2', u'dsport': 4789, u'dev': u't3s1if', u'tenant_route_ip': u'192.168.131.2', u'remote_route': u'10.1.21.0/24', u'subnet_route': u'10.2.21.0/24', u'v_name': u'vxlan_t3s1', u'id': 42, u'remote_ip': u'10.1.21.2'}]}, {u'tenant_sub_ip': u'10.2.21.2/24', u'tenant_ns_ip': u'10.2.21.1/24', u'tenant_ns_if': u't3ns1if', u'tenant_sub_if': u't3s1if', u'tenant_ns_name': u't3'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t3\" ip link set dev \"t3ns1if\" up\nip netns exec \"t3ns1\" ip link set dev \"t3s1if\" up\n", "delta": "0:00:00.083617", "end": "2019-11-17 10:24:36.548323", "item": [{"bridge_ip": "1.1.1.1", "bridge_name": "t3br1", "default_route_ip": "10.2.21.1", "dns": [{"brif": "t3s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t3s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "ns_name": "t3ns1", "route": [{"if": "p1", "ip": "10.2.21.1/24", "ns_if": "t3if", "ns_name": "t3"}], "vms": [{"brif": "t3br1if1", "disk": "10G", "mem": 2, "name": "t3_VM4", "vcpu": 4, "vmif": "t3VM4if1"}], "vxlan": [{"dev": "t3s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.21.2", "remote_ip": "10.1.21.2", "remote_route": "10.1.21.0/24", "subnet_route": "10.2.21.0/24", "tenant_route_ip": "192.168.131.2", "v_name": "vxlan_t3s1"}]}, {"tenant_ns_if": "t3ns1if", "tenant_ns_ip": "10.2.21.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s1if", "tenant_sub_ip": "10.2.21.2/24"}], "rc": 0, "start": "2019-11-17 10:24:36.464706", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Add IP addresses to Namespace VETH Pairs] *************************************************************************************************************
ok: [localhost] => (item=[{u'route': [{u'ip': u'10.1.22.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.1.22.1', u'bridge_name': u't3br2', u'dns': [{u'dnsif': u't3s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't3s2_dnsbrif'}], u'ns_name': u't3ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.22.2/24', u'tenant_ns_ip': u'10.1.22.1/24', u'tenant_ns_if': u't3ns2if', u'tenant_sub_if': u't3s2if', u'tenant_ns_name': u't3'}], u'bridge_ip': u'2.2.2.1', u'vxlan': [{u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}, {u'mem': 3, u'name': u't3_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't3br2if1', u'vmif': u't3VM3if1'}]) => {"ansible_loop_var": "item", "changed": false, "checksum": "350ba870bd31b7f6ee517845c14237910b5af0bf", "dest": "/root/Migration-as-a-Service/t3/VM_templates/t3_VM3.xml.j2", "gid": 0, "group": "root", "item": [{"bridge_ip": "2.2.2.1", "bridge_name": "t3br2", "default_route_ip": "10.1.22.1", "dns": [{"brif": "t3s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t3s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t3ns2", "route": [{"if": "p1", "ip": "10.1.22.1/24", "ns_if": "t3if", "ns_name": "t3"}], "tenant_ns": [{"tenant_ns_if": "t3ns2if", "tenant_ns_ip": "10.1.22.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s2if", "tenant_sub_ip": "10.1.22.2/24"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, {"brif": "t3br2if1", "disk": "10G", "mem": 3, "name": "t3_VM3", "vcpu": 2, "vmif": "t3VM3if1"}], "mode": "0644", "owner": "root", "path": "/root/Migration-as-a-Service/t3/VM_templates/t3_VM3.xml.j2", "size": 4091, "state": "file", "uid": 0}

PLAY RECAP **************************************************************************************************************************************************
localhost                  : ok=1    changed=0    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0   

changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.21.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.2.21.1', u'bridge_name': u't3br1', u'dns': [{u'dnsif': u't3s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't3s1_dnsbrif'}], u'ns_name': u't3ns1', u'bridge_ip': u'1.1.1.1', u'vms': [{u'mem': 2, u'name': u't3_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't3br1if1', u'vmif': u't3VM4if1'}], u'vxlan': [{u'local_ip': u'10.2.21.2', u'dsport': 4789, u'dev': u't3s1if', u'tenant_route_ip': u'192.168.131.2', u'remote_route': u'10.1.21.0/24', u'subnet_route': u'10.2.21.0/24', u'v_name': u'vxlan_t3s1', u'id': 42, u'remote_ip': u'10.1.21.2'}]}, {u'tenant_sub_ip': u'10.2.21.2/24', u'tenant_ns_ip': u'10.2.21.1/24', u'tenant_ns_if': u't3ns1if', u'tenant_sub_if': u't3s1if', u'tenant_ns_name': u't3'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t3ns1\" ip addr show \"t3s1if\" | awk 'FNR==3{ print $2 }' | grep -w '^10.2.21.2/24' ; if [ $? -ne 0 ] ; then ip netns exec \"t3ns1\" ip addr add \"10.2.21.2/24\" dev \"t3s1if\" ; fi\n\nip netns exec \"t3\" ip addr show \"t3ns1if\" | awk 'FNR==3{ print $2 }' | grep -w '^10.2.21.1/24' ; if [ $? -ne 0 ] ; then ip netns exec \"t3\" ip addr add \"10.2.21.1/24\" dev \"t3ns1if\" ; fi\n", "delta": "0:00:00.077301", "end": "2019-11-17 10:24:37.066189", "item": [{"bridge_ip": "1.1.1.1", "bridge_name": "t3br1", "default_route_ip": "10.2.21.1", "dns": [{"brif": "t3s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t3s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "ns_name": "t3ns1", "route": [{"if": "p1", "ip": "10.2.21.1/24", "ns_if": "t3if", "ns_name": "t3"}], "vms": [{"brif": "t3br1if1", "disk": "10G", "mem": 2, "name": "t3_VM4", "vcpu": 4, "vmif": "t3VM4if1"}], "vxlan": [{"dev": "t3s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.21.2", "remote_ip": "10.1.21.2", "remote_route": "10.1.21.0/24", "subnet_route": "10.2.21.0/24", "tenant_route_ip": "192.168.131.2", "v_name": "vxlan_t3s1"}]}, {"tenant_ns_if": "t3ns1if", "tenant_ns_ip": "10.2.21.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s1if", "tenant_sub_ip": "10.2.21.2/24"}], "rc": 0, "start": "2019-11-17 10:24:36.988888", "stderr": "", "stderr_lines": [], "stdout": "10.2.21.2/24\n10.2.21.1/24", "stdout_lines": ["10.2.21.2/24", "10.2.21.1/24"]}

TASK [Add IP Route to Tenant] *******************************************************************************************************************************
Using /etc/ansible/ansible.cfg as config file

PLAY [main] *************************************************************************************************************************************************

TASK [Create VM templates (C2)] *****************************************************************************************************************************
changed: [99.99.99.2] => (item={u'default_route_ip': u'192.168.131.1', u'name': u't3', u'pns_ip': u'192.168.131.1/24', u'tenant_if': u't3if', u'tenant_ip': u'192.168.131.2/24', u'pns_if': u't3pns_if'}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t3\" ip route show default | grep -w '[d]efault via 192.168.131.1' ; if [ $? -ne 0 ] ; then ip netns exec \"t3\" ip route add default via \"192.168.131.1\" ; fi\n", "delta": "0:00:00.033429", "end": "2019-11-17 10:24:37.468396", "item": {"default_route_ip": "192.168.131.1", "name": "t3", "pns_if": "t3pns_if", "pns_ip": "192.168.131.1/24", "tenant_if": "t3if", "tenant_ip": "192.168.131.2/24"}, "rc": 0, "start": "2019-11-17 10:24:37.434967", "stderr": "", "stderr_lines": [], "stdout": "default via 192.168.131.1 dev t3if ", "stdout_lines": ["default via 192.168.131.1 dev t3if "]}

TASK [Add IP Route to Tenant Subnet] ************************************************************************************************************************
changed: [99.99.99.2] => (item={u'route': [{u'ip': u'10.2.21.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.2.21.1', u'bridge_name': u't3br1', u'dns': [{u'dnsif': u't3s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't3s1_dnsbrif'}], u'ns_name': u't3ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.21.2/24', u'tenant_ns_ip': u'10.2.21.1/24', u'tenant_ns_if': u't3ns1if', u'tenant_ns_name': u't3', u'tenant_sub_if': u't3s1if'}], u'bridge_ip': u'1.1.1.1', u'vms': [{u'mem': 2, u'name': u't3_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't3br1if1', u'vmif': u't3VM4if1'}], u'vxlan': [{u'local_ip': u'10.2.21.2', u'tenant_route_ip': u'192.168.131.2', u'dsport': 4789, u'dev': u't3s1if', u'subnet_route': u'10.2.21.0/24', u'remote_route': u'10.1.21.0/24', u'v_name': u'vxlan_t3s1', u'id': 42, u'remote_ip': u'10.1.21.2'}]}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t3ns1\" ip route show default | grep -w '[d]efault via 10.2.21.1' ; if [ $? -ne 0 ] ; then ip netns exec \"t3ns1\" ip route add default via \"10.2.21.1\" ; fi\n", "delta": "0:00:00.045316", "end": "2019-11-17 10:24:37.880485", "item": {"bridge_ip": "1.1.1.1", "bridge_name": "t3br1", "default_route_ip": "10.2.21.1", "dns": [{"brif": "t3s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t3s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "ns_name": "t3ns1", "route": [{"if": "p1", "ip": "10.2.21.1/24", "ns_if": "t3if", "ns_name": "t3"}], "tenant_ns": [{"tenant_ns_if": "t3ns1if", "tenant_ns_ip": "10.2.21.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s1if", "tenant_sub_ip": "10.2.21.2/24"}], "vms": [{"brif": "t3br1if1", "disk": "10G", "mem": 2, "name": "t3_VM4", "vcpu": 4, "vmif": "t3VM4if1"}], "vxlan": [{"dev": "t3s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.21.2", "remote_ip": "10.1.21.2", "remote_route": "10.1.21.0/24", "subnet_route": "10.2.21.0/24", "tenant_route_ip": "192.168.131.2", "v_name": "vxlan_t3s1"}]}, "rc": 0, "start": "2019-11-17 10:24:37.835169", "stderr": "", "stderr_lines": [], "stdout": "default via 10.2.21.1 dev t3s1if ", "stdout_lines": ["default via 10.2.21.1 dev t3s1if "]}

TASK [Create bridge inside namespace] ***********************************************************************************************************************
ok: [localhost] => (item=[{u'route': [{u'ip': u'10.2.21.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.2.21.1', u'bridge_name': u't3br1', u'dns': [{u'dnsif': u't3s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't3s1_dnsbrif'}], u'ns_name': u't3ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.21.2/24', u'tenant_ns_ip': u'10.2.21.1/24', u'tenant_ns_if': u't3ns1if', u'tenant_sub_if': u't3s1if', u'tenant_ns_name': u't3'}], u'bridge_ip': u'1.1.1.1', u'vxlan': [{u'local_ip': u'10.2.21.2', u'dsport': 4789, u'dev': u't3s1if', u'tenant_route_ip': u'192.168.131.2', u'remote_route': u'10.1.21.0/24', u'subnet_route': u'10.2.21.0/24', u'v_name': u'vxlan_t3s1', u'id': 42, u'remote_ip': u'10.1.21.2'}]}, {u'mem': 2, u'name': u't3_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't3br1if1', u'vmif': u't3VM4if1'}]) => {"ansible_loop_var": "item", "changed": false, "checksum": "350ba870bd31b7f6ee517845c14237910b5af0bf", "dest": "/root/Migration-as-a-Service/t3/VM_templates/t3_VM4.xml.j2", "gid": 0, "group": "root", "item": [{"bridge_ip": "1.1.1.1", "bridge_name": "t3br1", "default_route_ip": "10.2.21.1", "dns": [{"brif": "t3s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t3s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "ns_name": "t3ns1", "route": [{"if": "p1", "ip": "10.2.21.1/24", "ns_if": "t3if", "ns_name": "t3"}], "tenant_ns": [{"tenant_ns_if": "t3ns1if", "tenant_ns_ip": "10.2.21.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s1if", "tenant_sub_ip": "10.2.21.2/24"}], "vxlan": [{"dev": "t3s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.21.2", "remote_ip": "10.1.21.2", "remote_route": "10.1.21.0/24", "subnet_route": "10.2.21.0/24", "tenant_route_ip": "192.168.131.2", "v_name": "vxlan_t3s1"}]}, {"brif": "t3br1if1", "disk": "10G", "mem": 2, "name": "t3_VM4", "vcpu": 4, "vmif": "t3VM4if1"}], "mode": "0644", "owner": "root", "path": "/root/Migration-as-a-Service/t3/VM_templates/t3_VM4.xml.j2", "size": 4091, "state": "file", "uid": 0}

PLAY RECAP **************************************************************************************************************************************************
localhost                  : ok=1    changed=0    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0   

Using /etc/ansible/ansible.cfg as config file
changed: [99.99.99.2] => (item={u'route': [{u'ip': u'10.2.21.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.2.21.1', u'bridge_name': u't3br1', u'dns': [{u'dnsif': u't3s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't3s1_dnsbrif'}], u'ns_name': u't3ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.21.2/24', u'tenant_ns_ip': u'10.2.21.1/24', u'tenant_ns_if': u't3ns1if', u'tenant_ns_name': u't3', u'tenant_sub_if': u't3s1if'}], u'bridge_ip': u'1.1.1.1', u'vms': [{u'mem': 2, u'name': u't3_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't3br1if1', u'vmif': u't3VM4if1'}], u'vxlan': [{u'local_ip': u'10.2.21.2', u'tenant_route_ip': u'192.168.131.2', u'dsport': 4789, u'dev': u't3s1if', u'subnet_route': u'10.2.21.0/24', u'remote_route': u'10.1.21.0/24', u'v_name': u'vxlan_t3s1', u'id': 42, u'remote_ip': u'10.1.21.2'}]}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t3ns1\" brctl show | grep -w '^t3br1'; if [ $? -ne 0 ] ; then ip netns exec \"t3ns1\" brctl addbr \"t3br1\" ; fi\nip netns exec \"t3ns1\" ip link set dev \"t3br1\" up\n", "delta": "0:00:00.072971", "end": "2019-11-17 10:24:38.352374", "item": {"bridge_ip": "1.1.1.1", "bridge_name": "t3br1", "default_route_ip": "10.2.21.1", "dns": [{"brif": "t3s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t3s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "ns_name": "t3ns1", "route": [{"if": "p1", "ip": "10.2.21.1/24", "ns_if": "t3if", "ns_name": "t3"}], "tenant_ns": [{"tenant_ns_if": "t3ns1if", "tenant_ns_ip": "10.2.21.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s1if", "tenant_sub_ip": "10.2.21.2/24"}], "vms": [{"brif": "t3br1if1", "disk": "10G", "mem": 2, "name": "t3_VM4", "vcpu": 4, "vmif": "t3VM4if1"}], "vxlan": [{"dev": "t3s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.21.2", "remote_ip": "10.1.21.2", "remote_route": "10.1.21.0/24", "subnet_route": "10.2.21.0/24", "tenant_route_ip": "192.168.131.2", "v_name": "vxlan_t3s1"}]}, "rc": 0, "start": "2019-11-17 10:24:38.279403", "stderr": "", "stderr_lines": [], "stdout": "t3br1\t\t8000.6ea2f3411004\tno\t\tt3br1if1", "stdout_lines": ["t3br1\t\t8000.6ea2f3411004\tno\t\tt3br1if1"]}

TASK [Create DNS VETH Pair] *********************************************************************************************************************************

PLAY [main] *************************************************************************************************************************************************

TASK [Copy VM image] ****************************************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.21.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.2.21.1', u'bridge_name': u't3br1', u'ns_name': u't3ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.21.2/24', u'tenant_ns_ip': u'10.2.21.1/24', u'tenant_ns_if': u't3ns1if', u'tenant_sub_if': u't3s1if', u'tenant_ns_name': u't3'}], u'bridge_ip': u'1.1.1.1', u'vms': [{u'mem': 2, u'name': u't3_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't3br1if1', u'vmif': u't3VM4if1'}], u'vxlan': [{u'local_ip': u'10.2.21.2', u'dsport': 4789, u'dev': u't3s1if', u'tenant_route_ip': u'192.168.131.2', u'remote_route': u'10.1.21.0/24', u'subnet_route': u'10.2.21.0/24', u'v_name': u'vxlan_t3s1', u'id': 42, u'remote_ip': u'10.1.21.2'}]}, {u'dnsif': u't3s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't3s1_dnsbrif'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t3ns1\" ip link show \"t3s1_dnsbrif\" ; if [ $? -ne 0 ] ; then ip netns exec \"t3ns1\" ip link add \"t3s1_dnsbrif\" type veth peer name \"t3s1_dnsif\" ; fi\nip netns exec \"t3ns1\" ip link set dev \"t3s1_dnsbrif\" up\nip netns exec \"t3ns1\" ip link set dev \"t3s1_dnsif\" up\n", "delta": "0:00:00.116403", "end": "2019-11-17 10:24:38.868492", "item": [{"bridge_ip": "1.1.1.1", "bridge_name": "t3br1", "default_route_ip": "10.2.21.1", "ns_name": "t3ns1", "route": [{"if": "p1", "ip": "10.2.21.1/24", "ns_if": "t3if", "ns_name": "t3"}], "tenant_ns": [{"tenant_ns_if": "t3ns1if", "tenant_ns_ip": "10.2.21.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s1if", "tenant_sub_ip": "10.2.21.2/24"}], "vms": [{"brif": "t3br1if1", "disk": "10G", "mem": 2, "name": "t3_VM4", "vcpu": 4, "vmif": "t3VM4if1"}], "vxlan": [{"dev": "t3s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.21.2", "remote_ip": "10.1.21.2", "remote_route": "10.1.21.0/24", "subnet_route": "10.2.21.0/24", "tenant_route_ip": "192.168.131.2", "v_name": "vxlan_t3s1"}]}, {"brif": "t3s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t3s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "rc": 0, "start": "2019-11-17 10:24:38.752089", "stderr": "", "stderr_lines": [], "stdout": "4: t3s1_dnsbrif@t3s1_dnsif: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue master t3br1 state UP mode DEFAULT group default qlen 1000\n    link/ether de:32:48:ca:2e:9d brd ff:ff:ff:ff:ff:ff", "stdout_lines": ["4: t3s1_dnsbrif@t3s1_dnsif: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue master t3br1 state UP mode DEFAULT group default qlen 1000", "    link/ether de:32:48:ca:2e:9d brd ff:ff:ff:ff:ff:ff"]}

TASK [Attach DNS VETH Pair] *********************************************************************************************************************************
ok: [localhost] => (item=[{u'route': [{u'ip': u'10.1.21.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.1.21.1', u'bridge_name': u't3br1', u'dns': [{u'dnsif': u't3s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't3s1_dnsbrif'}], u'ns_name': u't3ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.21.2/24', u'tenant_ns_ip': u'10.1.21.1/24', u'tenant_ns_if': u't3ns1if', u'tenant_sub_if': u't3s1if', u'tenant_ns_name': u't3'}], u'bridge_ip': u'1.1.1.1', u'vxlan': [{u'local_ip': u'10.1.21.2', u'dsport': 4789, u'dev': u't3s1if', u'tenant_route_ip': u'192.168.3.2', u'remote_route': u'10.2.21.0/24', u'subnet_route': u'10.1.21.0/24', u'v_name': u'vxlan_t3s1', u'id': 42, u'remote_ip': u'10.2.21.2'}]}, {u'mem': 2, u'name': u't3_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't3br1if1', u'vmif': u't3VM1if1'}]) => {"ansible_loop_var": "item", "changed": false, "dest": "/var/lib/libvirt/images/t3_VM1.qcow2", "item": [{"bridge_ip": "1.1.1.1", "bridge_name": "t3br1", "default_route_ip": "10.1.21.1", "dns": [{"brif": "t3s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t3s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t3ns1", "route": [{"if": "p1", "ip": "10.1.21.1/24", "ns_if": "t3if", "ns_name": "t3"}], "tenant_ns": [{"tenant_ns_if": "t3ns1if", "tenant_ns_ip": "10.1.21.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s1if", "tenant_sub_ip": "10.1.21.2/24"}], "vxlan": [{"dev": "t3s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.21.2", "remote_ip": "10.2.21.2", "remote_route": "10.2.21.0/24", "subnet_route": "10.1.21.0/24", "tenant_route_ip": "192.168.3.2", "v_name": "vxlan_t3s1"}]}, {"brif": "t3br1if1", "disk": "10G", "mem": 2, "name": "t3_VM1", "vcpu": 4, "vmif": "t3VM1if1"}], "src": "/root/mainVM.qcow2"}
ok: [localhost] => (item=[{u'route': [{u'ip': u'10.1.21.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.1.21.1', u'bridge_name': u't3br1', u'dns': [{u'dnsif': u't3s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't3s1_dnsbrif'}], u'ns_name': u't3ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.21.2/24', u'tenant_ns_ip': u'10.1.21.1/24', u'tenant_ns_if': u't3ns1if', u'tenant_sub_if': u't3s1if', u'tenant_ns_name': u't3'}], u'bridge_ip': u'1.1.1.1', u'vxlan': [{u'local_ip': u'10.1.21.2', u'dsport': 4789, u'dev': u't3s1if', u'tenant_route_ip': u'192.168.3.2', u'remote_route': u'10.2.21.0/24', u'subnet_route': u'10.1.21.0/24', u'v_name': u'vxlan_t3s1', u'id': 42, u'remote_ip': u'10.2.21.2'}]}, {u'mem': 4, u'name': u't3_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't3br1if2', u'vmif': u't3VM2if1'}]) => {"ansible_loop_var": "item", "changed": false, "dest": "/var/lib/libvirt/images/t3_VM2.qcow2", "item": [{"bridge_ip": "1.1.1.1", "bridge_name": "t3br1", "default_route_ip": "10.1.21.1", "dns": [{"brif": "t3s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t3s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t3ns1", "route": [{"if": "p1", "ip": "10.1.21.1/24", "ns_if": "t3if", "ns_name": "t3"}], "tenant_ns": [{"tenant_ns_if": "t3ns1if", "tenant_ns_ip": "10.1.21.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s1if", "tenant_sub_ip": "10.1.21.2/24"}], "vxlan": [{"dev": "t3s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.21.2", "remote_ip": "10.2.21.2", "remote_route": "10.2.21.0/24", "subnet_route": "10.1.21.0/24", "tenant_route_ip": "192.168.3.2", "v_name": "vxlan_t3s1"}]}, {"brif": "t3br1if2", "disk": "10G", "mem": 4, "name": "t3_VM2", "vcpu": 2, "vmif": "t3VM2if1"}], "src": "/root/mainVM.qcow2"}
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.21.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.2.21.1', u'bridge_name': u't3br1', u'ns_name': u't3ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.21.2/24', u'tenant_ns_ip': u'10.2.21.1/24', u'tenant_ns_if': u't3ns1if', u'tenant_sub_if': u't3s1if', u'tenant_ns_name': u't3'}], u'bridge_ip': u'1.1.1.1', u'vms': [{u'mem': 2, u'name': u't3_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't3br1if1', u'vmif': u't3VM4if1'}], u'vxlan': [{u'local_ip': u'10.2.21.2', u'dsport': 4789, u'dev': u't3s1if', u'tenant_route_ip': u'192.168.131.2', u'remote_route': u'10.1.21.0/24', u'subnet_route': u'10.2.21.0/24', u'v_name': u'vxlan_t3s1', u'id': 42, u'remote_ip': u'10.1.21.2'}]}, {u'dnsif': u't3s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't3s1_dnsbrif'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t3ns1\" brctl show \"t3br1\" | grep -w 't3s1_dnsbrif' ; if [ $? -ne 0 ] ; then ip netns exec \"t3ns1\" brctl addif \"t3br1\" \"t3s1_dnsbrif\" ; fi\n", "delta": "0:00:00.034971", "end": "2019-11-17 10:24:39.300439", "item": [{"bridge_ip": "1.1.1.1", "bridge_name": "t3br1", "default_route_ip": "10.2.21.1", "ns_name": "t3ns1", "route": [{"if": "p1", "ip": "10.2.21.1/24", "ns_if": "t3if", "ns_name": "t3"}], "tenant_ns": [{"tenant_ns_if": "t3ns1if", "tenant_ns_ip": "10.2.21.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s1if", "tenant_sub_ip": "10.2.21.2/24"}], "vms": [{"brif": "t3br1if1", "disk": "10G", "mem": 2, "name": "t3_VM4", "vcpu": 4, "vmif": "t3VM4if1"}], "vxlan": [{"dev": "t3s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.21.2", "remote_ip": "10.1.21.2", "remote_route": "10.1.21.0/24", "subnet_route": "10.2.21.0/24", "tenant_route_ip": "192.168.131.2", "v_name": "vxlan_t3s1"}]}, {"brif": "t3s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t3s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "rc": 0, "start": "2019-11-17 10:24:39.265468", "stderr": "", "stderr_lines": [], "stdout": "\t\t\t\t\t\t\tt3s1_dnsbrif", "stdout_lines": ["\t\t\t\t\t\t\tt3s1_dnsbrif"]}

TASK [Create VETH Pairs] ************************************************************************************************************************************
ok: [localhost] => (item=[{u'route': [{u'ip': u'10.1.22.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.1.22.1', u'bridge_name': u't3br2', u'dns': [{u'dnsif': u't3s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't3s2_dnsbrif'}], u'ns_name': u't3ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.22.2/24', u'tenant_ns_ip': u'10.1.22.1/24', u'tenant_ns_if': u't3ns2if', u'tenant_sub_if': u't3s2if', u'tenant_ns_name': u't3'}], u'bridge_ip': u'2.2.2.1', u'vxlan': [{u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}, {u'mem': 3, u'name': u't3_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't3br2if1', u'vmif': u't3VM3if1'}]) => {"ansible_loop_var": "item", "changed": false, "dest": "/var/lib/libvirt/images/t3_VM3.qcow2", "item": [{"bridge_ip": "2.2.2.1", "bridge_name": "t3br2", "default_route_ip": "10.1.22.1", "dns": [{"brif": "t3s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t3s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t3ns2", "route": [{"if": "p1", "ip": "10.1.22.1/24", "ns_if": "t3if", "ns_name": "t3"}], "tenant_ns": [{"tenant_ns_if": "t3ns2if", "tenant_ns_ip": "10.1.22.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s2if", "tenant_sub_ip": "10.1.22.2/24"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, {"brif": "t3br2if1", "disk": "10G", "mem": 3, "name": "t3_VM3", "vcpu": 2, "vmif": "t3VM3if1"}], "src": "/root/mainVM.qcow2"}

TASK [Create VM templates (C1)] *****************************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.21.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.2.21.1', u'bridge_name': u't3br1', u'dns': [{u'dnsif': u't3s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't3s1_dnsbrif'}], u'ns_name': u't3ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.21.2/24', u'tenant_ns_ip': u'10.2.21.1/24', u'tenant_ns_if': u't3ns1if', u'tenant_sub_if': u't3s1if', u'tenant_ns_name': u't3'}], u'bridge_ip': u'1.1.1.1', u'vxlan': [{u'local_ip': u'10.2.21.2', u'dsport': 4789, u'dev': u't3s1if', u'tenant_route_ip': u'192.168.131.2', u'remote_route': u'10.1.21.0/24', u'subnet_route': u'10.2.21.0/24', u'v_name': u'vxlan_t3s1', u'id': 42, u'remote_ip': u'10.1.21.2'}]}, {u'mem': 2, u'name': u't3_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't3br1if1', u'vmif': u't3VM4if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip link show \"t3br1if1\" ; if [ $? -ne 0 ] ; then ip link add \"t3VM4if1\" type veth peer name \"t3br1if1\" ; fi\nip link set dev \"t3br1if1\" up\nip link set dev \"t3VM4if1\" up\n", "delta": "0:00:00.011838", "end": "2019-11-17 10:24:39.706518", "item": [{"bridge_ip": "1.1.1.1", "bridge_name": "t3br1", "default_route_ip": "10.2.21.1", "dns": [{"brif": "t3s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t3s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "ns_name": "t3ns1", "route": [{"if": "p1", "ip": "10.2.21.1/24", "ns_if": "t3if", "ns_name": "t3"}], "tenant_ns": [{"tenant_ns_if": "t3ns1if", "tenant_ns_ip": "10.2.21.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s1if", "tenant_sub_ip": "10.2.21.2/24"}], "vxlan": [{"dev": "t3s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.21.2", "remote_ip": "10.1.21.2", "remote_route": "10.1.21.0/24", "subnet_route": "10.2.21.0/24", "tenant_route_ip": "192.168.131.2", "v_name": "vxlan_t3s1"}]}, {"brif": "t3br1if1", "disk": "10G", "mem": 2, "name": "t3_VM4", "vcpu": 4, "vmif": "t3VM4if1"}], "rc": 0, "start": "2019-11-17 10:24:39.694680", "stderr": "Device \"t3br1if1\" does not exist.\nRTNETLINK answers: File exists\nCannot find device \"t3br1if1\"", "stderr_lines": ["Device \"t3br1if1\" does not exist.", "RTNETLINK answers: File exists", "Cannot find device \"t3br1if1\""], "stdout": "", "stdout_lines": []}

TASK [Attach VETH Pairs] ************************************************************************************************************************************
ok: [localhost] => (item=[{u'route': [{u'ip': u'10.1.21.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.1.21.1', u'bridge_name': u't3br1', u'dns': [{u'dnsif': u't3s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't3s1_dnsbrif'}], u'ns_name': u't3ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.21.2/24', u'tenant_ns_ip': u'10.1.21.1/24', u'tenant_ns_if': u't3ns1if', u'tenant_sub_if': u't3s1if', u'tenant_ns_name': u't3'}], u'bridge_ip': u'1.1.1.1', u'vxlan': [{u'local_ip': u'10.1.21.2', u'dsport': 4789, u'dev': u't3s1if', u'tenant_route_ip': u'192.168.3.2', u'remote_route': u'10.2.21.0/24', u'subnet_route': u'10.1.21.0/24', u'v_name': u'vxlan_t3s1', u'id': 42, u'remote_ip': u'10.2.21.2'}]}, {u'mem': 2, u'name': u't3_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't3br1if1', u'vmif': u't3VM1if1'}]) => {"ansible_loop_var": "item", "changed": false, "checksum": "350ba870bd31b7f6ee517845c14237910b5af0bf", "dest": "/root/Migration-as-a-Service/t3/VM_templates/t3_VM1.xml.j2", "gid": 0, "group": "root", "item": [{"bridge_ip": "1.1.1.1", "bridge_name": "t3br1", "default_route_ip": "10.1.21.1", "dns": [{"brif": "t3s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t3s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t3ns1", "route": [{"if": "p1", "ip": "10.1.21.1/24", "ns_if": "t3if", "ns_name": "t3"}], "tenant_ns": [{"tenant_ns_if": "t3ns1if", "tenant_ns_ip": "10.1.21.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s1if", "tenant_sub_ip": "10.1.21.2/24"}], "vxlan": [{"dev": "t3s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.21.2", "remote_ip": "10.2.21.2", "remote_route": "10.2.21.0/24", "subnet_route": "10.1.21.0/24", "tenant_route_ip": "192.168.3.2", "v_name": "vxlan_t3s1"}]}, {"brif": "t3br1if1", "disk": "10G", "mem": 2, "name": "t3_VM1", "vcpu": 4, "vmif": "t3VM1if1"}], "mode": "0644", "owner": "root", "path": "/root/Migration-as-a-Service/t3/VM_templates/t3_VM1.xml.j2", "size": 4091, "state": "file", "uid": 0}
ok: [localhost] => (item=[{u'route': [{u'ip': u'10.1.21.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.1.21.1', u'bridge_name': u't3br1', u'dns': [{u'dnsif': u't3s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't3s1_dnsbrif'}], u'ns_name': u't3ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.21.2/24', u'tenant_ns_ip': u'10.1.21.1/24', u'tenant_ns_if': u't3ns1if', u'tenant_sub_if': u't3s1if', u'tenant_ns_name': u't3'}], u'bridge_ip': u'1.1.1.1', u'vxlan': [{u'local_ip': u'10.1.21.2', u'dsport': 4789, u'dev': u't3s1if', u'tenant_route_ip': u'192.168.3.2', u'remote_route': u'10.2.21.0/24', u'subnet_route': u'10.1.21.0/24', u'v_name': u'vxlan_t3s1', u'id': 42, u'remote_ip': u'10.2.21.2'}]}, {u'mem': 4, u'name': u't3_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't3br1if2', u'vmif': u't3VM2if1'}]) => {"ansible_loop_var": "item", "changed": false, "checksum": "350ba870bd31b7f6ee517845c14237910b5af0bf", "dest": "/root/Migration-as-a-Service/t3/VM_templates/t3_VM2.xml.j2", "gid": 0, "group": "root", "item": [{"bridge_ip": "1.1.1.1", "bridge_name": "t3br1", "default_route_ip": "10.1.21.1", "dns": [{"brif": "t3s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t3s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t3ns1", "route": [{"if": "p1", "ip": "10.1.21.1/24", "ns_if": "t3if", "ns_name": "t3"}], "tenant_ns": [{"tenant_ns_if": "t3ns1if", "tenant_ns_ip": "10.1.21.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s1if", "tenant_sub_ip": "10.1.21.2/24"}], "vxlan": [{"dev": "t3s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.21.2", "remote_ip": "10.2.21.2", "remote_route": "10.2.21.0/24", "subnet_route": "10.1.21.0/24", "tenant_route_ip": "192.168.3.2", "v_name": "vxlan_t3s1"}]}, {"brif": "t3br1if2", "disk": "10G", "mem": 4, "name": "t3_VM2", "vcpu": 2, "vmif": "t3VM2if1"}], "mode": "0644", "owner": "root", "path": "/root/Migration-as-a-Service/t3/VM_templates/t3_VM2.xml.j2", "size": 4091, "state": "file", "uid": 0}
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.21.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.2.21.1', u'bridge_name': u't3br1', u'dns': [{u'dnsif': u't3s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't3s1_dnsbrif'}], u'ns_name': u't3ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.21.2/24', u'tenant_ns_ip': u'10.2.21.1/24', u'tenant_ns_if': u't3ns1if', u'tenant_sub_if': u't3s1if', u'tenant_ns_name': u't3'}], u'bridge_ip': u'1.1.1.1', u'vxlan': [{u'local_ip': u'10.2.21.2', u'dsport': 4789, u'dev': u't3s1if', u'tenant_route_ip': u'192.168.131.2', u'remote_route': u'10.1.21.0/24', u'subnet_route': u'10.2.21.0/24', u'v_name': u'vxlan_t3s1', u'id': 42, u'remote_ip': u'10.1.21.2'}]}, {u'mem': 2, u'name': u't3_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't3br1if1', u'vmif': u't3VM4if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip link show \"t3br1if1\" ; if [ $? -eq 0 ] ; then ip link set \"t3br1if1\" netns \"t3ns1\" ; fi\nip netns exec \"t3ns1\" brctl show \"t3br1\" | grep -w 't3br1if1' ; if [ $? -ne 0 ] ; then ip netns exec \"t3ns1\" brctl addif \"t3br1\" \"t3br1if1\" ; fi\n", "delta": "0:00:00.050930", "end": "2019-11-17 10:24:40.144452", "item": [{"bridge_ip": "1.1.1.1", "bridge_name": "t3br1", "default_route_ip": "10.2.21.1", "dns": [{"brif": "t3s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t3s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "ns_name": "t3ns1", "route": [{"if": "p1", "ip": "10.2.21.1/24", "ns_if": "t3if", "ns_name": "t3"}], "tenant_ns": [{"tenant_ns_if": "t3ns1if", "tenant_ns_ip": "10.2.21.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s1if", "tenant_sub_ip": "10.2.21.2/24"}], "vxlan": [{"dev": "t3s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.21.2", "remote_ip": "10.1.21.2", "remote_route": "10.1.21.0/24", "subnet_route": "10.2.21.0/24", "tenant_route_ip": "192.168.131.2", "v_name": "vxlan_t3s1"}]}, {"brif": "t3br1if1", "disk": "10G", "mem": 2, "name": "t3_VM4", "vcpu": 4, "vmif": "t3VM4if1"}], "rc": 0, "start": "2019-11-17 10:24:40.093522", "stderr": "Device \"t3br1if1\" does not exist.", "stderr_lines": ["Device \"t3br1if1\" does not exist."], "stdout": "t3br1\t\t8000.6ea2f3411004\tno\t\tt3br1if1", "stdout_lines": ["t3br1\t\t8000.6ea2f3411004\tno\t\tt3br1if1"]}

TASK [All interfaces and bridges UP] ************************************************************************************************************************
ok: [localhost] => (item=[{u'route': [{u'ip': u'10.1.22.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.1.22.1', u'bridge_name': u't3br2', u'dns': [{u'dnsif': u't3s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't3s2_dnsbrif'}], u'ns_name': u't3ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.22.2/24', u'tenant_ns_ip': u'10.1.22.1/24', u'tenant_ns_if': u't3ns2if', u'tenant_sub_if': u't3s2if', u'tenant_ns_name': u't3'}], u'bridge_ip': u'2.2.2.1', u'vxlan': [{u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}, {u'mem': 3, u'name': u't3_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't3br2if1', u'vmif': u't3VM3if1'}]) => {"ansible_loop_var": "item", "changed": false, "checksum": "350ba870bd31b7f6ee517845c14237910b5af0bf", "dest": "/root/Migration-as-a-Service/t3/VM_templates/t3_VM3.xml.j2", "gid": 0, "group": "root", "item": [{"bridge_ip": "2.2.2.1", "bridge_name": "t3br2", "default_route_ip": "10.1.22.1", "dns": [{"brif": "t3s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t3s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t3ns2", "route": [{"if": "p1", "ip": "10.1.22.1/24", "ns_if": "t3if", "ns_name": "t3"}], "tenant_ns": [{"tenant_ns_if": "t3ns2if", "tenant_ns_ip": "10.1.22.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s2if", "tenant_sub_ip": "10.1.22.2/24"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, {"brif": "t3br2if1", "disk": "10G", "mem": 3, "name": "t3_VM3", "vcpu": 2, "vmif": "t3VM3if1"}], "mode": "0644", "owner": "root", "path": "/root/Migration-as-a-Service/t3/VM_templates/t3_VM3.xml.j2", "size": 4091, "state": "file", "uid": 0}

TASK [Get list of running VMs] ******************************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.21.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.2.21.1', u'bridge_name': u't3br1', u'dns': [{u'dnsif': u't3s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't3s1_dnsbrif'}], u'ns_name': u't3ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.21.2/24', u'tenant_ns_ip': u'10.2.21.1/24', u'tenant_ns_if': u't3ns1if', u'tenant_sub_if': u't3s1if', u'tenant_ns_name': u't3'}], u'bridge_ip': u'1.1.1.1', u'vxlan': [{u'local_ip': u'10.2.21.2', u'dsport': 4789, u'dev': u't3s1if', u'tenant_route_ip': u'192.168.131.2', u'remote_route': u'10.1.21.0/24', u'subnet_route': u'10.2.21.0/24', u'v_name': u'vxlan_t3s1', u'id': 42, u'remote_ip': u'10.1.21.2'}]}, {u'mem': 2, u'name': u't3_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't3br1if1', u'vmif': u't3VM4if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t3ns1\" ip link set \"t3br1if1\" up\nip netns exec \"t3ns1\" ip link set dev \"t3br1\" up\n", "delta": "0:00:00.089766", "end": "2019-11-17 10:24:40.600519", "item": [{"bridge_ip": "1.1.1.1", "bridge_name": "t3br1", "default_route_ip": "10.2.21.1", "dns": [{"brif": "t3s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t3s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "ns_name": "t3ns1", "route": [{"if": "p1", "ip": "10.2.21.1/24", "ns_if": "t3if", "ns_name": "t3"}], "tenant_ns": [{"tenant_ns_if": "t3ns1if", "tenant_ns_ip": "10.2.21.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s1if", "tenant_sub_ip": "10.2.21.2/24"}], "vxlan": [{"dev": "t3s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.21.2", "remote_ip": "10.1.21.2", "remote_route": "10.1.21.0/24", "subnet_route": "10.2.21.0/24", "tenant_route_ip": "192.168.131.2", "v_name": "vxlan_t3s1"}]}, {"brif": "t3br1if1", "disk": "10G", "mem": 2, "name": "t3_VM4", "vcpu": 4, "vmif": "t3VM4if1"}], "rc": 0, "start": "2019-11-17 10:24:40.510753", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Add IP to DNS Interface] ******************************************************************************************************************************
ok: [localhost] => {"changed": false, "cmd": ["virsh", "list", "--name"], "delta": "0:00:00.019693", "end": "2019-11-17 10:24:40.741045", "rc": 0, "start": "2019-11-17 10:24:40.721352", "stderr": "", "stderr_lines": [], "stdout": "t1_VM1\nt1_VM2\nt1_VM3\nt2_VM1\nt2_VM2\nt2_VM3", "stdout_lines": ["t1_VM1", "t1_VM2", "t1_VM3", "t2_VM1", "t2_VM2", "t2_VM3"]}

TASK [Define VM] ********************************************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.21.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.2.21.1', u'bridge_name': u't3br1', u'ns_name': u't3ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.21.2/24', u'tenant_ns_ip': u'10.2.21.1/24', u'tenant_ns_if': u't3ns1if', u'tenant_sub_if': u't3s1if', u'tenant_ns_name': u't3'}], u'bridge_ip': u'1.1.1.1', u'vms': [{u'mem': 2, u'name': u't3_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't3br1if1', u'vmif': u't3VM4if1'}], u'vxlan': [{u'local_ip': u'10.2.21.2', u'dsport': 4789, u'dev': u't3s1if', u'tenant_route_ip': u'192.168.131.2', u'remote_route': u'10.1.21.0/24', u'subnet_route': u'10.2.21.0/24', u'v_name': u'vxlan_t3s1', u'id': 42, u'remote_ip': u'10.1.21.2'}]}, {u'dnsif': u't3s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't3s1_dnsbrif'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t3ns1\" ip addr show \"t3s1_dnsif\" | awk 'FNR==3{ print $2}'| grep -w '^1.1.1.128/24' ; if [ $? -ne 0 ] ; then ip netns exec \"t3ns1\" ip addr add \"1.1.1.128/24\" dev \"t3s1_dnsif\" ; fi\n", "delta": "0:00:00.040433", "end": "2019-11-17 10:24:41.032873", "item": [{"bridge_ip": "1.1.1.1", "bridge_name": "t3br1", "default_route_ip": "10.2.21.1", "ns_name": "t3ns1", "route": [{"if": "p1", "ip": "10.2.21.1/24", "ns_if": "t3if", "ns_name": "t3"}], "tenant_ns": [{"tenant_ns_if": "t3ns1if", "tenant_ns_ip": "10.2.21.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s1if", "tenant_sub_ip": "10.2.21.2/24"}], "vms": [{"brif": "t3br1if1", "disk": "10G", "mem": 2, "name": "t3_VM4", "vcpu": 4, "vmif": "t3VM4if1"}], "vxlan": [{"dev": "t3s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.21.2", "remote_ip": "10.1.21.2", "remote_route": "10.1.21.0/24", "subnet_route": "10.2.21.0/24", "tenant_route_ip": "192.168.131.2", "v_name": "vxlan_t3s1"}]}, {"brif": "t3s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t3s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "rc": 0, "start": "2019-11-17 10:24:40.992440", "stderr": "", "stderr_lines": [], "stdout": "1.1.1.128/24", "stdout_lines": ["1.1.1.128/24"]}

TASK [Install DHCP Server] **********************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.21.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.1.21.1', u'bridge_name': u't3br1', u'dns': [{u'dnsif': u't3s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't3s1_dnsbrif'}], u'ns_name': u't3ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.21.2/24', u'tenant_ns_ip': u'10.1.21.1/24', u'tenant_ns_if': u't3ns1if', u'tenant_sub_if': u't3s1if', u'tenant_ns_name': u't3'}], u'bridge_ip': u'1.1.1.1', u'vxlan': [{u'local_ip': u'10.1.21.2', u'dsport': 4789, u'dev': u't3s1if', u'tenant_route_ip': u'192.168.3.2', u'remote_route': u'10.2.21.0/24', u'subnet_route': u'10.1.21.0/24', u'v_name': u'vxlan_t3s1', u'id': 42, u'remote_ip': u'10.2.21.2'}]}, {u'mem': 2, u'name': u't3_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't3br1if1', u'vmif': u't3VM1if1'}]) => {"ansible_loop_var": "item", "changed": true, "created": "t3_VM1", "item": [{"bridge_ip": "1.1.1.1", "bridge_name": "t3br1", "default_route_ip": "10.1.21.1", "dns": [{"brif": "t3s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t3s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t3ns1", "route": [{"if": "p1", "ip": "10.1.21.1/24", "ns_if": "t3if", "ns_name": "t3"}], "tenant_ns": [{"tenant_ns_if": "t3ns1if", "tenant_ns_ip": "10.1.21.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s1if", "tenant_sub_ip": "10.1.21.2/24"}], "vxlan": [{"dev": "t3s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.21.2", "remote_ip": "10.2.21.2", "remote_route": "10.2.21.0/24", "subnet_route": "10.1.21.0/24", "tenant_route_ip": "192.168.3.2", "v_name": "vxlan_t3s1"}]}, {"brif": "t3br1if1", "disk": "10G", "mem": 2, "name": "t3_VM1", "vcpu": 4, "vmif": "t3VM1if1"}], "warnings": ["'xml' is given - ignoring 'name'"]}
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.21.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.1.21.1', u'bridge_name': u't3br1', u'dns': [{u'dnsif': u't3s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't3s1_dnsbrif'}], u'ns_name': u't3ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.21.2/24', u'tenant_ns_ip': u'10.1.21.1/24', u'tenant_ns_if': u't3ns1if', u'tenant_sub_if': u't3s1if', u'tenant_ns_name': u't3'}], u'bridge_ip': u'1.1.1.1', u'vxlan': [{u'local_ip': u'10.1.21.2', u'dsport': 4789, u'dev': u't3s1if', u'tenant_route_ip': u'192.168.3.2', u'remote_route': u'10.2.21.0/24', u'subnet_route': u'10.1.21.0/24', u'v_name': u'vxlan_t3s1', u'id': 42, u'remote_ip': u'10.2.21.2'}]}, {u'mem': 4, u'name': u't3_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't3br1if2', u'vmif': u't3VM2if1'}]) => {"ansible_loop_var": "item", "changed": true, "created": "t3_VM2", "item": [{"bridge_ip": "1.1.1.1", "bridge_name": "t3br1", "default_route_ip": "10.1.21.1", "dns": [{"brif": "t3s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t3s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t3ns1", "route": [{"if": "p1", "ip": "10.1.21.1/24", "ns_if": "t3if", "ns_name": "t3"}], "tenant_ns": [{"tenant_ns_if": "t3ns1if", "tenant_ns_ip": "10.1.21.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s1if", "tenant_sub_ip": "10.1.21.2/24"}], "vxlan": [{"dev": "t3s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.21.2", "remote_ip": "10.2.21.2", "remote_route": "10.2.21.0/24", "subnet_route": "10.1.21.0/24", "tenant_route_ip": "192.168.3.2", "v_name": "vxlan_t3s1"}]}, {"brif": "t3br1if2", "disk": "10G", "mem": 4, "name": "t3_VM2", "vcpu": 2, "vmif": "t3VM2if1"}], "warnings": ["'xml' is given - ignoring 'name'"]}
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.21.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.2.21.1', u'bridge_name': u't3br1', u'ns_name': u't3ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.21.2/24', u'tenant_ns_ip': u'10.2.21.1/24', u'tenant_ns_if': u't3ns1if', u'tenant_sub_if': u't3s1if', u'tenant_ns_name': u't3'}], u'bridge_ip': u'1.1.1.1', u'vms': [{u'mem': 2, u'name': u't3_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't3br1if1', u'vmif': u't3VM4if1'}], u'vxlan': [{u'local_ip': u'10.2.21.2', u'dsport': 4789, u'dev': u't3s1if', u'tenant_route_ip': u'192.168.131.2', u'remote_route': u'10.1.21.0/24', u'subnet_route': u'10.2.21.0/24', u'v_name': u'vxlan_t3s1', u'id': 42, u'remote_ip': u'10.1.21.2'}]}, {u'dnsif': u't3s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't3s1_dnsbrif'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t3ns1\" ps aux | grep -w '[d]nsmasq --interface t3s1_dnsif -z --dhcp-range=1.1.1.133,1.1.1.254' ; if [ $? -ne 0 ] ; then ip netns exec \"t3ns1\" dnsmasq --interface \"t3s1_dnsif\" -z --dhcp-range=1.1.1.133,'1.1.1.254' ; fi\n", "delta": "0:00:00.060781", "end": "2019-11-17 10:24:41.492929", "item": [{"bridge_ip": "1.1.1.1", "bridge_name": "t3br1", "default_route_ip": "10.2.21.1", "ns_name": "t3ns1", "route": [{"if": "p1", "ip": "10.2.21.1/24", "ns_if": "t3if", "ns_name": "t3"}], "tenant_ns": [{"tenant_ns_if": "t3ns1if", "tenant_ns_ip": "10.2.21.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s1if", "tenant_sub_ip": "10.2.21.2/24"}], "vms": [{"brif": "t3br1if1", "disk": "10G", "mem": 2, "name": "t3_VM4", "vcpu": 4, "vmif": "t3VM4if1"}], "vxlan": [{"dev": "t3s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.21.2", "remote_ip": "10.1.21.2", "remote_route": "10.1.21.0/24", "subnet_route": "10.2.21.0/24", "tenant_route_ip": "192.168.131.2", "v_name": "vxlan_t3s1"}]}, {"brif": "t3s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t3s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "rc": 0, "start": "2019-11-17 10:24:41.432148", "stderr": "", "stderr_lines": [], "stdout": "nobody    8900  0.0  0.0  51580   388 ?        S    10:24   0:00 dnsmasq --interface t3s1_dnsif -z --dhcp-range=1.1.1.133,1.1.1.254", "stdout_lines": ["nobody    8900  0.0  0.0  51580   388 ?        S    10:24   0:00 dnsmasq --interface t3s1_dnsif -z --dhcp-range=1.1.1.133,1.1.1.254"]}

TASK [Create VXLAN devices] *********************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.22.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.1.22.1', u'bridge_name': u't3br2', u'dns': [{u'dnsif': u't3s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't3s2_dnsbrif'}], u'ns_name': u't3ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.22.2/24', u'tenant_ns_ip': u'10.1.22.1/24', u'tenant_ns_if': u't3ns2if', u'tenant_sub_if': u't3s2if', u'tenant_ns_name': u't3'}], u'bridge_ip': u'2.2.2.1', u'vxlan': [{u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}, {u'mem': 3, u'name': u't3_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't3br2if1', u'vmif': u't3VM3if1'}]) => {"ansible_loop_var": "item", "changed": true, "created": "t3_VM3", "item": [{"bridge_ip": "2.2.2.1", "bridge_name": "t3br2", "default_route_ip": "10.1.22.1", "dns": [{"brif": "t3s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t3s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t3ns2", "route": [{"if": "p1", "ip": "10.1.22.1/24", "ns_if": "t3if", "ns_name": "t3"}], "tenant_ns": [{"tenant_ns_if": "t3ns2if", "tenant_ns_ip": "10.1.22.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s2if", "tenant_sub_ip": "10.1.22.2/24"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, {"brif": "t3br2if1", "disk": "10G", "mem": 3, "name": "t3_VM3", "vcpu": 2, "vmif": "t3VM3if1"}], "warnings": ["'xml' is given - ignoring 'name'"]}

TASK [Create VM] ********************************************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.21.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.2.21.1', u'bridge_name': u't3br1', u'dns': [{u'dnsif': u't3s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't3s1_dnsbrif'}], u'ns_name': u't3ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.21.2/24', u'tenant_ns_ip': u'10.2.21.1/24', u'tenant_ns_if': u't3ns1if', u'tenant_sub_if': u't3s1if', u'tenant_ns_name': u't3'}], u'bridge_ip': u'1.1.1.1', u'vms': [{u'mem': 2, u'name': u't3_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't3br1if1', u'vmif': u't3VM4if1'}]}, {u'local_ip': u'10.2.21.2', u'dsport': 4789, u'dev': u't3s1if', u'tenant_route_ip': u'192.168.131.2', u'remote_route': u'10.1.21.0/24', u'subnet_route': u'10.2.21.0/24', u'v_name': u'vxlan_t3s1', u'id': 42, u'remote_ip': u'10.1.21.2'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t3ns1\" ip link show \"vxlan_t3s1\" ; if [ $? -ne 0 ] ; then ip netns exec \"t3ns1\" ip link add \"vxlan_t3s1\" type vxlan id \"42\" local \"10.2.21.2\" remote \"10.1.21.2\" dstport \"4789\" dev \"t3s1if\" ; ip netns exec \"t3ns1\" ip link set dev \"vxlan_t3s1\" up ; fi\n", "delta": "0:00:00.037180", "end": "2019-11-17 10:24:41.960718", "item": [{"bridge_ip": "1.1.1.1", "bridge_name": "t3br1", "default_route_ip": "10.2.21.1", "dns": [{"brif": "t3s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t3s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "ns_name": "t3ns1", "route": [{"if": "p1", "ip": "10.2.21.1/24", "ns_if": "t3if", "ns_name": "t3"}], "tenant_ns": [{"tenant_ns_if": "t3ns1if", "tenant_ns_ip": "10.2.21.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s1if", "tenant_sub_ip": "10.2.21.2/24"}], "vms": [{"brif": "t3br1if1", "disk": "10G", "mem": 2, "name": "t3_VM4", "vcpu": 4, "vmif": "t3VM4if1"}]}, {"dev": "t3s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.21.2", "remote_ip": "10.1.21.2", "remote_route": "10.1.21.0/24", "subnet_route": "10.2.21.0/24", "tenant_route_ip": "192.168.131.2", "v_name": "vxlan_t3s1"}], "rc": 0, "start": "2019-11-17 10:24:41.923538", "stderr": "", "stderr_lines": [], "stdout": "5: vxlan_t3s1: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1450 qdisc noqueue master t3br1 state UNKNOWN mode DEFAULT group default qlen 1000\n    link/ether c2:45:ef:bd:f6:fc brd ff:ff:ff:ff:ff:ff", "stdout_lines": ["5: vxlan_t3s1: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1450 qdisc noqueue master t3br1 state UNKNOWN mode DEFAULT group default qlen 1000", "    link/ether c2:45:ef:bd:f6:fc brd ff:ff:ff:ff:ff:ff"]}

TASK [Attach VXLANs to bridge] ******************************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.21.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.2.21.1', u'bridge_name': u't3br1', u'dns': [{u'dnsif': u't3s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't3s1_dnsbrif'}], u'ns_name': u't3ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.21.2/24', u'tenant_ns_ip': u'10.2.21.1/24', u'tenant_ns_if': u't3ns1if', u'tenant_sub_if': u't3s1if', u'tenant_ns_name': u't3'}], u'bridge_ip': u'1.1.1.1', u'vms': [{u'mem': 2, u'name': u't3_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't3br1if1', u'vmif': u't3VM4if1'}]}, {u'local_ip': u'10.2.21.2', u'dsport': 4789, u'dev': u't3s1if', u'tenant_route_ip': u'192.168.131.2', u'remote_route': u'10.1.21.0/24', u'subnet_route': u'10.2.21.0/24', u'v_name': u'vxlan_t3s1', u'id': 42, u'remote_ip': u'10.1.21.2'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t3ns1\" brctl show \"t3br1\" | grep -w 'vxlan_t3s1' ; if [ $? -ne 0 ] ; then ip netns exec \"t3ns1\" brctl addif \"t3br1\" \"vxlan_t3s1\" ; fi\n", "delta": "0:00:00.035532", "end": "2019-11-17 10:24:42.396466", "item": [{"bridge_ip": "1.1.1.1", "bridge_name": "t3br1", "default_route_ip": "10.2.21.1", "dns": [{"brif": "t3s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t3s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "ns_name": "t3ns1", "route": [{"if": "p1", "ip": "10.2.21.1/24", "ns_if": "t3if", "ns_name": "t3"}], "tenant_ns": [{"tenant_ns_if": "t3ns1if", "tenant_ns_ip": "10.2.21.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s1if", "tenant_sub_ip": "10.2.21.2/24"}], "vms": [{"brif": "t3br1if1", "disk": "10G", "mem": 2, "name": "t3_VM4", "vcpu": 4, "vmif": "t3VM4if1"}]}, {"dev": "t3s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.21.2", "remote_ip": "10.1.21.2", "remote_route": "10.1.21.0/24", "subnet_route": "10.2.21.0/24", "tenant_route_ip": "192.168.131.2", "v_name": "vxlan_t3s1"}], "rc": 0, "start": "2019-11-17 10:24:42.360934", "stderr": "", "stderr_lines": [], "stdout": "\t\t\t\t\t\t\tvxlan_t3s1", "stdout_lines": ["\t\t\t\t\t\t\tvxlan_t3s1"]}

PLAY RECAP **************************************************************************************************************************************************
99.99.99.2                 : ok=21   changed=19   unreachable=0    failed=0    skipped=0    rescued=0    ignored=0   

ok: [localhost] => (item=[{u'route': [{u'ip': u'10.1.21.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.1.21.1', u'bridge_name': u't3br1', u'dns': [{u'dnsif': u't3s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't3s1_dnsbrif'}], u'ns_name': u't3ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.21.2/24', u'tenant_ns_ip': u'10.1.21.1/24', u'tenant_ns_if': u't3ns1if', u'tenant_sub_if': u't3s1if', u'tenant_ns_name': u't3'}], u'bridge_ip': u'1.1.1.1', u'vxlan': [{u'local_ip': u'10.1.21.2', u'dsport': 4789, u'dev': u't3s1if', u'tenant_route_ip': u'192.168.3.2', u'remote_route': u'10.2.21.0/24', u'subnet_route': u'10.1.21.0/24', u'v_name': u'vxlan_t3s1', u'id': 42, u'remote_ip': u'10.2.21.2'}]}, {u'mem': 2, u'name': u't3_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't3br1if1', u'vmif': u't3VM1if1'}]) => {"ansible_loop_var": "item", "changed": false, "create": 0, "item": [{"bridge_ip": "1.1.1.1", "bridge_name": "t3br1", "default_route_ip": "10.1.21.1", "dns": [{"brif": "t3s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t3s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t3ns1", "route": [{"if": "p1", "ip": "10.1.21.1/24", "ns_if": "t3if", "ns_name": "t3"}], "tenant_ns": [{"tenant_ns_if": "t3ns1if", "tenant_ns_ip": "10.1.21.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s1if", "tenant_sub_ip": "10.1.21.2/24"}], "vxlan": [{"dev": "t3s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.21.2", "remote_ip": "10.2.21.2", "remote_route": "10.2.21.0/24", "subnet_route": "10.1.21.0/24", "tenant_route_ip": "192.168.3.2", "v_name": "vxlan_t3s1"}]}, {"brif": "t3br1if1", "disk": "10G", "mem": 2, "name": "t3_VM1", "vcpu": 4, "vmif": "t3VM1if1"}]}
Using /etc/ansible/ansible.cfg as config file

PLAY [main] *************************************************************************************************************************************************

TASK [Add VXLAN routes in PNS] ******************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.21.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.1.21.1', u'bridge_name': u't3br1', u'dns': [{u'dnsif': u't3s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't3s1_dnsbrif'}], u'ns_name': u't3ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.21.2/24', u'tenant_ns_ip': u'10.1.21.1/24', u'tenant_ns_if': u't3ns1if', u'tenant_sub_if': u't3s1if', u'tenant_ns_name': u't3'}], u'bridge_ip': u'1.1.1.1', u'vms': [{u'mem': 2, u'name': u't3_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't3br1if1', u'vmif': u't3VM1if1'}, {u'mem': 4, u'name': u't3_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't3br1if2', u'vmif': u't3VM2if1'}]}, {u'local_ip': u'10.1.21.2', u'dsport': 4789, u'dev': u't3s1if', u'tenant_route_ip': u'192.168.3.2', u'remote_route': u'10.2.21.0/24', u'subnet_route': u'10.1.21.0/24', u'v_name': u'vxlan_t3s1', u'id': 42, u'remote_ip': u'10.2.21.2'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec pns ip route show \"10.1.21.0/24\" via \"192.168.3.2\" | grep -w '^10.1.21.0/24' ; if [ $? -ne 0 ] ; then ip netns exec pns ip route add \"10.1.21.0/24\" via \"192.168.3.2\" ; fi\n", "delta": "0:00:00.050355", "end": "2019-11-17 10:24:43.771874", "item": [{"bridge_ip": "1.1.1.1", "bridge_name": "t3br1", "default_route_ip": "10.1.21.1", "dns": [{"brif": "t3s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t3s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t3ns1", "route": [{"if": "p1", "ip": "10.1.21.1/24", "ns_if": "t3if", "ns_name": "t3"}], "tenant_ns": [{"tenant_ns_if": "t3ns1if", "tenant_ns_ip": "10.1.21.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s1if", "tenant_sub_ip": "10.1.21.2/24"}], "vms": [{"brif": "t3br1if1", "disk": "10G", "mem": 2, "name": "t3_VM1", "vcpu": 4, "vmif": "t3VM1if1"}, {"brif": "t3br1if2", "disk": "10G", "mem": 4, "name": "t3_VM2", "vcpu": 2, "vmif": "t3VM2if1"}]}, {"dev": "t3s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.21.2", "remote_ip": "10.2.21.2", "remote_route": "10.2.21.0/24", "subnet_route": "10.1.21.0/24", "tenant_route_ip": "192.168.3.2", "v_name": "vxlan_t3s1"}], "rc": 0, "start": "2019-11-17 10:24:43.721519", "stderr": "", "stderr_lines": [], "stdout": "10.1.21.0/24 dev t3pns_if ", "stdout_lines": ["10.1.21.0/24 dev t3pns_if "]}
skipping: [localhost] => (item=[{u'route': [{u'ip': u'10.1.22.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.1.22.1', u'bridge_name': u't3br2', u'dns': [{u'dnsif': u't3s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't3s2_dnsbrif'}], u'ns_name': u't3ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.22.2/24', u'tenant_ns_ip': u'10.1.22.1/24', u'tenant_ns_if': u't3ns2if', u'tenant_sub_if': u't3s2if', u'tenant_ns_name': u't3'}], u'bridge_ip': u'2.2.2.1', u'vms': [{u'mem': 3, u'name': u't3_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't3br2if1', u'vmif': u't3VM3if1'}]}, {u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}])  => {"ansible_loop_var": "item", "changed": false, "item": [{"bridge_ip": "2.2.2.1", "bridge_name": "t3br2", "default_route_ip": "10.1.22.1", "dns": [{"brif": "t3s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t3s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t3ns2", "route": [{"if": "p1", "ip": "10.1.22.1/24", "ns_if": "t3if", "ns_name": "t3"}], "tenant_ns": [{"tenant_ns_if": "t3ns2if", "tenant_ns_ip": "10.1.22.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s2if", "tenant_sub_ip": "10.1.22.2/24"}], "vms": [{"brif": "t3br2if1", "disk": "10G", "mem": 3, "name": "t3_VM3", "vcpu": 2, "vmif": "t3VM3if1"}]}, {"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}], "skip_reason": "Conditional result was False"}

TASK [Get PNS ip address] ***********************************************************************************************************************************
ok: [localhost] => (item=[{u'route': [{u'ip': u'10.1.21.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.1.21.1', u'bridge_name': u't3br1', u'dns': [{u'dnsif': u't3s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't3s1_dnsbrif'}], u'ns_name': u't3ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.21.2/24', u'tenant_ns_ip': u'10.1.21.1/24', u'tenant_ns_if': u't3ns1if', u'tenant_sub_if': u't3s1if', u'tenant_ns_name': u't3'}], u'bridge_ip': u'1.1.1.1', u'vxlan': [{u'local_ip': u'10.1.21.2', u'dsport': 4789, u'dev': u't3s1if', u'tenant_route_ip': u'192.168.3.2', u'remote_route': u'10.2.21.0/24', u'subnet_route': u'10.1.21.0/24', u'v_name': u'vxlan_t3s1', u'id': 42, u'remote_ip': u'10.2.21.2'}]}, {u'mem': 4, u'name': u't3_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't3br1if2', u'vmif': u't3VM2if1'}]) => {"ansible_loop_var": "item", "changed": false, "create": 0, "item": [{"bridge_ip": "1.1.1.1", "bridge_name": "t3br1", "default_route_ip": "10.1.21.1", "dns": [{"brif": "t3s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t3s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t3ns1", "route": [{"if": "p1", "ip": "10.1.21.1/24", "ns_if": "t3if", "ns_name": "t3"}], "tenant_ns": [{"tenant_ns_if": "t3ns1if", "tenant_ns_ip": "10.1.21.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s1if", "tenant_sub_ip": "10.1.21.2/24"}], "vxlan": [{"dev": "t3s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.21.2", "remote_ip": "10.2.21.2", "remote_route": "10.2.21.0/24", "subnet_route": "10.1.21.0/24", "tenant_route_ip": "192.168.3.2", "v_name": "vxlan_t3s1"}]}, {"brif": "t3br1if2", "disk": "10G", "mem": 4, "name": "t3_VM2", "vcpu": 2, "vmif": "t3VM2if1"}]}
ok: [localhost] => {"changed": false, "cmd": "ip netns exec pns ip addr show p1 | awk 'FNR==3{ print $2 }' | awk -F/ '{ print $1 }'\n", "delta": "0:00:00.041770", "end": "2019-11-17 10:24:44.155901", "rc": 0, "start": "2019-11-17 10:24:44.114131", "stderr": "", "stderr_lines": [], "stdout": "192.168.100.238", "stdout_lines": ["192.168.100.238"]}

TASK [Add VXLAN routes to host] *****************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.21.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.1.21.1', u'bridge_name': u't3br1', u'dns': [{u'dnsif': u't3s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't3s1_dnsbrif'}], u'ns_name': u't3ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.21.2/24', u'tenant_ns_ip': u'10.1.21.1/24', u'tenant_ns_if': u't3ns1if', u'tenant_sub_if': u't3s1if', u'tenant_ns_name': u't3'}], u'bridge_ip': u'1.1.1.1', u'vms': [{u'mem': 2, u'name': u't3_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't3br1if1', u'vmif': u't3VM1if1'}, {u'mem': 4, u'name': u't3_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't3br1if2', u'vmif': u't3VM2if1'}]}, {u'local_ip': u'10.1.21.2', u'dsport': 4789, u'dev': u't3s1if', u'tenant_route_ip': u'192.168.3.2', u'remote_route': u'10.2.21.0/24', u'subnet_route': u'10.1.21.0/24', u'v_name': u'vxlan_t3s1', u'id': 42, u'remote_ip': u'10.2.21.2'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip route show \"10.1.21.0/24\" via \"192.168.100.238\" | grep -w '^10.1.21.0/24' ; if [ $? -ne 0 ] ; then ip route add \"10.1.21.0/24\" via \"192.168.100.238\" ; fi\nip route show \"10.2.21.0/24\" via 99.99.99.2 | grep -w '^10.2.21.0/24'; if [ $? -ne 0 ] ; then ip route add \"10.2.21.0/24\" via 99.99.99.2 ; fi\n", "delta": "0:00:00.007159", "end": "2019-11-17 10:24:44.490862", "item": [{"bridge_ip": "1.1.1.1", "bridge_name": "t3br1", "default_route_ip": "10.1.21.1", "dns": [{"brif": "t3s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t3s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t3ns1", "route": [{"if": "p1", "ip": "10.1.21.1/24", "ns_if": "t3if", "ns_name": "t3"}], "tenant_ns": [{"tenant_ns_if": "t3ns1if", "tenant_ns_ip": "10.1.21.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s1if", "tenant_sub_ip": "10.1.21.2/24"}], "vms": [{"brif": "t3br1if1", "disk": "10G", "mem": 2, "name": "t3_VM1", "vcpu": 4, "vmif": "t3VM1if1"}, {"brif": "t3br1if2", "disk": "10G", "mem": 4, "name": "t3_VM2", "vcpu": 2, "vmif": "t3VM2if1"}]}, {"dev": "t3s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.21.2", "remote_ip": "10.2.21.2", "remote_route": "10.2.21.0/24", "subnet_route": "10.1.21.0/24", "tenant_route_ip": "192.168.3.2", "v_name": "vxlan_t3s1"}], "rc": 0, "start": "2019-11-17 10:24:44.483703", "stderr": "", "stderr_lines": [], "stdout": "10.1.21.0/24 dev testBR \n10.2.21.0/24 dev ens4 ", "stdout_lines": ["10.1.21.0/24 dev testBR ", "10.2.21.0/24 dev ens4 "]}
skipping: [localhost] => (item=[{u'route': [{u'ip': u'10.1.22.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.1.22.1', u'bridge_name': u't3br2', u'dns': [{u'dnsif': u't3s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't3s2_dnsbrif'}], u'ns_name': u't3ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.22.2/24', u'tenant_ns_ip': u'10.1.22.1/24', u'tenant_ns_if': u't3ns2if', u'tenant_sub_if': u't3s2if', u'tenant_ns_name': u't3'}], u'bridge_ip': u'2.2.2.1', u'vms': [{u'mem': 3, u'name': u't3_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't3br2if1', u'vmif': u't3VM3if1'}]}, {u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}])  => {"ansible_loop_var": "item", "changed": false, "item": [{"bridge_ip": "2.2.2.1", "bridge_name": "t3br2", "default_route_ip": "10.1.22.1", "dns": [{"brif": "t3s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t3s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t3ns2", "route": [{"if": "p1", "ip": "10.1.22.1/24", "ns_if": "t3if", "ns_name": "t3"}], "tenant_ns": [{"tenant_ns_if": "t3ns2if", "tenant_ns_ip": "10.1.22.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s2if", "tenant_sub_ip": "10.1.22.2/24"}], "vms": [{"brif": "t3br2if1", "disk": "10G", "mem": 3, "name": "t3_VM3", "vcpu": 2, "vmif": "t3VM3if1"}]}, {"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}], "skip_reason": "Conditional result was False"}

PLAY RECAP **************************************************************************************************************************************************
localhost                  : ok=3    changed=2    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0   

Using /etc/ansible/ansible.cfg as config file
ok: [localhost] => (item=[{u'route': [{u'ip': u'10.1.22.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.1.22.1', u'bridge_name': u't3br2', u'dns': [{u'dnsif': u't3s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't3s2_dnsbrif'}], u'ns_name': u't3ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.22.2/24', u'tenant_ns_ip': u'10.1.22.1/24', u'tenant_ns_if': u't3ns2if', u'tenant_sub_if': u't3s2if', u'tenant_ns_name': u't3'}], u'bridge_ip': u'2.2.2.1', u'vxlan': [{u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}, {u'mem': 3, u'name': u't3_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't3br2if1', u'vmif': u't3VM3if1'}]) => {"ansible_loop_var": "item", "changed": false, "create": 0, "item": [{"bridge_ip": "2.2.2.1", "bridge_name": "t3br2", "default_route_ip": "10.1.22.1", "dns": [{"brif": "t3s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t3s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t3ns2", "route": [{"if": "p1", "ip": "10.1.22.1/24", "ns_if": "t3if", "ns_name": "t3"}], "tenant_ns": [{"tenant_ns_if": "t3ns2if", "tenant_ns_ip": "10.1.22.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s2if", "tenant_sub_ip": "10.1.22.2/24"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, {"brif": "t3br2if1", "disk": "10G", "mem": 3, "name": "t3_VM3", "vcpu": 2, "vmif": "t3VM3if1"}]}

TASK [Start VM] *********************************************************************************************************************************************

PLAY [worker] ***********************************************************************************************************************************************

TASK [Add VXLAN routes in PNS] ******************************************************************************************************************************
ok: [localhost] => (item=[{u'route': [{u'ip': u'10.1.21.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.1.21.1', u'bridge_name': u't3br1', u'dns': [{u'dnsif': u't3s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't3s1_dnsbrif'}], u'ns_name': u't3ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.21.2/24', u'tenant_ns_ip': u'10.1.21.1/24', u'tenant_ns_if': u't3ns1if', u'tenant_sub_if': u't3s1if', u'tenant_ns_name': u't3'}], u'bridge_ip': u'1.1.1.1', u'vxlan': [{u'local_ip': u'10.1.21.2', u'dsport': 4789, u'dev': u't3s1if', u'tenant_route_ip': u'192.168.3.2', u'remote_route': u'10.2.21.0/24', u'subnet_route': u'10.1.21.0/24', u'v_name': u'vxlan_t3s1', u'id': 42, u'remote_ip': u'10.2.21.2'}]}, {u'mem': 2, u'name': u't3_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't3br1if1', u'vmif': u't3VM1if1'}]) => {"ansible_loop_var": "item", "changed": false, "item": [{"bridge_ip": "1.1.1.1", "bridge_name": "t3br1", "default_route_ip": "10.1.21.1", "dns": [{"brif": "t3s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t3s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t3ns1", "route": [{"if": "p1", "ip": "10.1.21.1/24", "ns_if": "t3if", "ns_name": "t3"}], "tenant_ns": [{"tenant_ns_if": "t3ns1if", "tenant_ns_ip": "10.1.21.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s1if", "tenant_sub_ip": "10.1.21.2/24"}], "vxlan": [{"dev": "t3s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.21.2", "remote_ip": "10.2.21.2", "remote_route": "10.2.21.0/24", "subnet_route": "10.1.21.0/24", "tenant_route_ip": "192.168.3.2", "v_name": "vxlan_t3s1"}]}, {"brif": "t3br1if1", "disk": "10G", "mem": 2, "name": "t3_VM1", "vcpu": 4, "vmif": "t3VM1if1"}]}
ok: [localhost] => (item=[{u'route': [{u'ip': u'10.1.21.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.1.21.1', u'bridge_name': u't3br1', u'dns': [{u'dnsif': u't3s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't3s1_dnsbrif'}], u'ns_name': u't3ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.21.2/24', u'tenant_ns_ip': u'10.1.21.1/24', u'tenant_ns_if': u't3ns1if', u'tenant_sub_if': u't3s1if', u'tenant_ns_name': u't3'}], u'bridge_ip': u'1.1.1.1', u'vxlan': [{u'local_ip': u'10.1.21.2', u'dsport': 4789, u'dev': u't3s1if', u'tenant_route_ip': u'192.168.3.2', u'remote_route': u'10.2.21.0/24', u'subnet_route': u'10.1.21.0/24', u'v_name': u'vxlan_t3s1', u'id': 42, u'remote_ip': u'10.2.21.2'}]}, {u'mem': 4, u'name': u't3_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't3br1if2', u'vmif': u't3VM2if1'}]) => {"ansible_loop_var": "item", "changed": false, "item": [{"bridge_ip": "1.1.1.1", "bridge_name": "t3br1", "default_route_ip": "10.1.21.1", "dns": [{"brif": "t3s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t3s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t3ns1", "route": [{"if": "p1", "ip": "10.1.21.1/24", "ns_if": "t3if", "ns_name": "t3"}], "tenant_ns": [{"tenant_ns_if": "t3ns1if", "tenant_ns_ip": "10.1.21.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s1if", "tenant_sub_ip": "10.1.21.2/24"}], "vxlan": [{"dev": "t3s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.21.2", "remote_ip": "10.2.21.2", "remote_route": "10.2.21.0/24", "subnet_route": "10.1.21.0/24", "tenant_route_ip": "192.168.3.2", "v_name": "vxlan_t3s1"}]}, {"brif": "t3br1if2", "disk": "10G", "mem": 4, "name": "t3_VM2", "vcpu": 2, "vmif": "t3VM2if1"}]}
ok: [localhost] => (item=[{u'route': [{u'ip': u'10.1.22.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.1.22.1', u'bridge_name': u't3br2', u'dns': [{u'dnsif': u't3s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't3s2_dnsbrif'}], u'ns_name': u't3ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.22.2/24', u'tenant_ns_ip': u'10.1.22.1/24', u'tenant_ns_if': u't3ns2if', u'tenant_sub_if': u't3s2if', u'tenant_ns_name': u't3'}], u'bridge_ip': u'2.2.2.1', u'vxlan': [{u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}, {u'mem': 3, u'name': u't3_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't3br2if1', u'vmif': u't3VM3if1'}]) => {"ansible_loop_var": "item", "changed": false, "item": [{"bridge_ip": "2.2.2.1", "bridge_name": "t3br2", "default_route_ip": "10.1.22.1", "dns": [{"brif": "t3s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t3s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t3ns2", "route": [{"if": "p1", "ip": "10.1.22.1/24", "ns_if": "t3if", "ns_name": "t3"}], "tenant_ns": [{"tenant_ns_if": "t3ns2if", "tenant_ns_ip": "10.1.22.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s2if", "tenant_sub_ip": "10.1.22.2/24"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, {"brif": "t3br2if1", "disk": "10G", "mem": 3, "name": "t3_VM3", "vcpu": 2, "vmif": "t3VM3if1"}]}

TASK [Attach VM interface] **********************************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.21.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.2.21.1', u'bridge_name': u't3br1', u'dns': [{u'dnsif': u't3s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't3s1_dnsbrif'}], u'ns_name': u't3ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.21.2/24', u'tenant_ns_ip': u'10.2.21.1/24', u'tenant_ns_if': u't3ns1if', u'tenant_sub_if': u't3s1if', u'tenant_ns_name': u't3'}], u'bridge_ip': u'1.1.1.1', u'vms': [{u'mem': 2, u'name': u't3_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't3br1if1', u'vmif': u't3VM4if1'}]}, {u'local_ip': u'10.2.21.2', u'dsport': 4789, u'dev': u't3s1if', u'tenant_route_ip': u'192.168.131.2', u'remote_route': u'10.1.21.0/24', u'subnet_route': u'10.2.21.0/24', u'v_name': u'vxlan_t3s1', u'id': 42, u'remote_ip': u'10.1.21.2'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec pns ip route show \"10.2.21.0/24\" via \"192.168.131.2\" | grep -w '^10.2.21.0/24' ; if [ $? -ne 0 ] ; then ip netns exec pns ip route add \"10.2.21.0/24\" via \"192.168.131.2\" ; fi\n", "delta": "0:00:00.034129", "end": "2019-11-17 10:24:46.076351", "item": [{"bridge_ip": "1.1.1.1", "bridge_name": "t3br1", "default_route_ip": "10.2.21.1", "dns": [{"brif": "t3s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t3s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "ns_name": "t3ns1", "route": [{"if": "p1", "ip": "10.2.21.1/24", "ns_if": "t3if", "ns_name": "t3"}], "tenant_ns": [{"tenant_ns_if": "t3ns1if", "tenant_ns_ip": "10.2.21.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s1if", "tenant_sub_ip": "10.2.21.2/24"}], "vms": [{"brif": "t3br1if1", "disk": "10G", "mem": 2, "name": "t3_VM4", "vcpu": 4, "vmif": "t3VM4if1"}]}, {"dev": "t3s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.21.2", "remote_ip": "10.1.21.2", "remote_route": "10.1.21.0/24", "subnet_route": "10.2.21.0/24", "tenant_route_ip": "192.168.131.2", "v_name": "vxlan_t3s1"}], "rc": 0, "start": "2019-11-17 10:24:46.042222", "stderr": "", "stderr_lines": [], "stdout": "10.2.21.0/24 dev t3pns_if ", "stdout_lines": ["10.2.21.0/24 dev t3pns_if "]}

TASK [Get PNS ip address] ***********************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.21.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.1.21.1', u'bridge_name': u't3br1', u'dns': [{u'dnsif': u't3s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't3s1_dnsbrif'}], u'ns_name': u't3ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.21.2/24', u'tenant_ns_ip': u'10.1.21.1/24', u'tenant_ns_if': u't3ns1if', u'tenant_sub_if': u't3s1if', u'tenant_ns_name': u't3'}], u'bridge_ip': u'1.1.1.1', u'vxlan': [{u'local_ip': u'10.1.21.2', u'dsport': 4789, u'dev': u't3s1if', u'tenant_route_ip': u'192.168.3.2', u'remote_route': u'10.2.21.0/24', u'subnet_route': u'10.1.21.0/24', u'v_name': u'vxlan_t3s1', u'id': 42, u'remote_ip': u'10.2.21.2'}]}, {u'mem': 2, u'name': u't3_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't3br1if1', u'vmif': u't3VM1if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "virsh domiflist \"t3_VM1\" | grep -w 't3VM1if1' ; if [ $? -ne 0 ] ; then virsh attach-interface \"t3_VM1\" direct \"t3VM1if1\" --live --persistent ; fi\n", "delta": "0:00:00.307953", "end": "2019-11-17 10:24:46.367836", "item": [{"bridge_ip": "1.1.1.1", "bridge_name": "t3br1", "default_route_ip": "10.1.21.1", "dns": [{"brif": "t3s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t3s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t3ns1", "route": [{"if": "p1", "ip": "10.1.21.1/24", "ns_if": "t3if", "ns_name": "t3"}], "tenant_ns": [{"tenant_ns_if": "t3ns1if", "tenant_ns_ip": "10.1.21.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s1if", "tenant_sub_ip": "10.1.21.2/24"}], "vxlan": [{"dev": "t3s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.21.2", "remote_ip": "10.2.21.2", "remote_route": "10.2.21.0/24", "subnet_route": "10.1.21.0/24", "tenant_route_ip": "192.168.3.2", "v_name": "vxlan_t3s1"}]}, {"brif": "t3br1if1", "disk": "10G", "mem": 2, "name": "t3_VM1", "vcpu": 4, "vmif": "t3VM1if1"}], "rc": 0, "start": "2019-11-17 10:24:46.059883", "stderr": "", "stderr_lines": [], "stdout": "Interface attached successfully", "stdout_lines": ["Interface attached successfully"]}
ok: [99.99.99.2] => {"changed": false, "cmd": "ip netns exec pns ip addr show p1 | awk 'FNR==3{ print $2 }' | awk -F/ '{ print $1 }'\n", "delta": "0:00:00.041300", "end": "2019-11-17 10:24:46.604711", "rc": 0, "start": "2019-11-17 10:24:46.563411", "stderr": "", "stderr_lines": [], "stdout": "192.168.100.50", "stdout_lines": ["192.168.100.50"]}

TASK [Add VXLAN routes to host] *****************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.21.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.1.21.1', u'bridge_name': u't3br1', u'dns': [{u'dnsif': u't3s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't3s1_dnsbrif'}], u'ns_name': u't3ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.21.2/24', u'tenant_ns_ip': u'10.1.21.1/24', u'tenant_ns_if': u't3ns1if', u'tenant_sub_if': u't3s1if', u'tenant_ns_name': u't3'}], u'bridge_ip': u'1.1.1.1', u'vxlan': [{u'local_ip': u'10.1.21.2', u'dsport': 4789, u'dev': u't3s1if', u'tenant_route_ip': u'192.168.3.2', u'remote_route': u'10.2.21.0/24', u'subnet_route': u'10.1.21.0/24', u'v_name': u'vxlan_t3s1', u'id': 42, u'remote_ip': u'10.2.21.2'}]}, {u'mem': 4, u'name': u't3_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't3br1if2', u'vmif': u't3VM2if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "virsh domiflist \"t3_VM2\" | grep -w 't3VM2if1' ; if [ $? -ne 0 ] ; then virsh attach-interface \"t3_VM2\" direct \"t3VM2if1\" --live --persistent ; fi\n", "delta": "0:00:00.262807", "end": "2019-11-17 10:24:46.781093", "item": [{"bridge_ip": "1.1.1.1", "bridge_name": "t3br1", "default_route_ip": "10.1.21.1", "dns": [{"brif": "t3s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t3s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t3ns1", "route": [{"if": "p1", "ip": "10.1.21.1/24", "ns_if": "t3if", "ns_name": "t3"}], "tenant_ns": [{"tenant_ns_if": "t3ns1if", "tenant_ns_ip": "10.1.21.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s1if", "tenant_sub_ip": "10.1.21.2/24"}], "vxlan": [{"dev": "t3s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.21.2", "remote_ip": "10.2.21.2", "remote_route": "10.2.21.0/24", "subnet_route": "10.1.21.0/24", "tenant_route_ip": "192.168.3.2", "v_name": "vxlan_t3s1"}]}, {"brif": "t3br1if2", "disk": "10G", "mem": 4, "name": "t3_VM2", "vcpu": 2, "vmif": "t3VM2if1"}], "rc": 0, "start": "2019-11-17 10:24:46.518286", "stderr": "", "stderr_lines": [], "stdout": "Interface attached successfully", "stdout_lines": ["Interface attached successfully"]}
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.21.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.2.21.1', u'bridge_name': u't3br1', u'dns': [{u'dnsif': u't3s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't3s1_dnsbrif'}], u'ns_name': u't3ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.21.2/24', u'tenant_ns_ip': u'10.2.21.1/24', u'tenant_ns_if': u't3ns1if', u'tenant_sub_if': u't3s1if', u'tenant_ns_name': u't3'}], u'bridge_ip': u'1.1.1.1', u'vms': [{u'mem': 2, u'name': u't3_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't3br1if1', u'vmif': u't3VM4if1'}]}, {u'local_ip': u'10.2.21.2', u'dsport': 4789, u'dev': u't3s1if', u'tenant_route_ip': u'192.168.131.2', u'remote_route': u'10.1.21.0/24', u'subnet_route': u'10.2.21.0/24', u'v_name': u'vxlan_t3s1', u'id': 42, u'remote_ip': u'10.1.21.2'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip route show \"10.2.21.0/24\" via \"192.168.100.50\" | grep -w '^10.2.21.0/24' ; if [ $? -ne 0 ] ; then ip route add \"10.2.21.0/24\" via \"192.168.100.50\" ; fi\nip route show \"10.1.21.0/24\" via 99.99.99.1 | grep -w '^10.1.21.0/24'; if [ $? -ne 0 ] ; then ip route add \"10.1.21.0/24\" via 99.99.99.1 ; fi\n", "delta": "0:00:00.005817", "end": "2019-11-17 10:24:47.139113", "item": [{"bridge_ip": "1.1.1.1", "bridge_name": "t3br1", "default_route_ip": "10.2.21.1", "dns": [{"brif": "t3s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t3s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "ns_name": "t3ns1", "route": [{"if": "p1", "ip": "10.2.21.1/24", "ns_if": "t3if", "ns_name": "t3"}], "tenant_ns": [{"tenant_ns_if": "t3ns1if", "tenant_ns_ip": "10.2.21.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s1if", "tenant_sub_ip": "10.2.21.2/24"}], "vms": [{"brif": "t3br1if1", "disk": "10G", "mem": 2, "name": "t3_VM4", "vcpu": 4, "vmif": "t3VM4if1"}]}, {"dev": "t3s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.21.2", "remote_ip": "10.1.21.2", "remote_route": "10.1.21.0/24", "subnet_route": "10.2.21.0/24", "tenant_route_ip": "192.168.131.2", "v_name": "vxlan_t3s1"}], "rc": 0, "start": "2019-11-17 10:24:47.133296", "stderr": "", "stderr_lines": [], "stdout": "10.2.21.0/24 dev testBR \n10.1.21.0/24 dev ens4 ", "stdout_lines": ["10.2.21.0/24 dev testBR ", "10.1.21.0/24 dev ens4 "]}

PLAY RECAP **************************************************************************************************************************************************
99.99.99.2                 : ok=3    changed=2    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0   

changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.22.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.1.22.1', u'bridge_name': u't3br2', u'dns': [{u'dnsif': u't3s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't3s2_dnsbrif'}], u'ns_name': u't3ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.22.2/24', u'tenant_ns_ip': u'10.1.22.1/24', u'tenant_ns_if': u't3ns2if', u'tenant_sub_if': u't3s2if', u'tenant_ns_name': u't3'}], u'bridge_ip': u'2.2.2.1', u'vxlan': [{u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}, {u'mem': 3, u'name': u't3_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't3br2if1', u'vmif': u't3VM3if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "virsh domiflist \"t3_VM3\" | grep -w 't3VM3if1' ; if [ $? -ne 0 ] ; then virsh attach-interface \"t3_VM3\" direct \"t3VM3if1\" --live --persistent ; fi\n", "delta": "0:00:00.245608", "end": "2019-11-17 10:24:47.248470", "item": [{"bridge_ip": "2.2.2.1", "bridge_name": "t3br2", "default_route_ip": "10.1.22.1", "dns": [{"brif": "t3s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t3s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t3ns2", "route": [{"if": "p1", "ip": "10.1.22.1/24", "ns_if": "t3if", "ns_name": "t3"}], "tenant_ns": [{"tenant_ns_if": "t3ns2if", "tenant_ns_ip": "10.1.22.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s2if", "tenant_sub_ip": "10.1.22.2/24"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, {"brif": "t3br2if1", "disk": "10G", "mem": 3, "name": "t3_VM3", "vcpu": 2, "vmif": "t3VM3if1"}], "rc": 0, "start": "2019-11-17 10:24:47.002862", "stderr": "", "stderr_lines": [], "stdout": "Interface attached successfully", "stdout_lines": ["Interface attached successfully"]}

PLAY RECAP **************************************************************************************************************************************************
localhost                  : ok=7    changed=2    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0   

Using /etc/ansible/ansible.cfg as config file
Using /etc/ansible/ansible.cfg as config file

PLAY [main] *************************************************************************************************************************************************

TASK [Create VM templates (C1)] *****************************************************************************************************************************

PLAY [worker] ***********************************************************************************************************************************************

TASK [Copy VM image] ****************************************************************************************************************************************
ok: [localhost] => (item=[{u'route': [{u'ip': u'10.1.21.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.1.21.1', u'bridge_name': u't3br1', u'dns': [{u'dnsif': u't3s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't3s1_dnsbrif'}], u'ns_name': u't3ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.21.2/24', u'tenant_ns_ip': u'10.1.21.1/24', u'tenant_ns_if': u't3ns1if', u'tenant_sub_if': u't3s1if', u'tenant_ns_name': u't3'}], u'bridge_ip': u'1.1.1.1', u'vxlan': [{u'local_ip': u'10.1.21.2', u'dsport': 4789, u'dev': u't3s1if', u'tenant_route_ip': u'192.168.3.2', u'remote_route': u'10.2.21.0/24', u'subnet_route': u'10.1.21.0/24', u'v_name': u'vxlan_t3s1', u'id': 42, u'remote_ip': u'10.2.21.2'}]}, {u'mem': 2, u'name': u't3_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't3br1if1', u'vmif': u't3VM1if1'}]) => {"ansible_loop_var": "item", "changed": false, "checksum": "350ba870bd31b7f6ee517845c14237910b5af0bf", "dest": "/root/Migration-as-a-Service/t3/VM_templates/t3_VM1.xml.j2", "gid": 0, "group": "root", "item": [{"bridge_ip": "1.1.1.1", "bridge_name": "t3br1", "default_route_ip": "10.1.21.1", "dns": [{"brif": "t3s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t3s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t3ns1", "route": [{"if": "p1", "ip": "10.1.21.1/24", "ns_if": "t3if", "ns_name": "t3"}], "tenant_ns": [{"tenant_ns_if": "t3ns1if", "tenant_ns_ip": "10.1.21.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s1if", "tenant_sub_ip": "10.1.21.2/24"}], "vxlan": [{"dev": "t3s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.21.2", "remote_ip": "10.2.21.2", "remote_route": "10.2.21.0/24", "subnet_route": "10.1.21.0/24", "tenant_route_ip": "192.168.3.2", "v_name": "vxlan_t3s1"}]}, {"brif": "t3br1if1", "disk": "10G", "mem": 2, "name": "t3_VM1", "vcpu": 4, "vmif": "t3VM1if1"}], "mode": "0644", "owner": "root", "path": "/root/Migration-as-a-Service/t3/VM_templates/t3_VM1.xml.j2", "size": 4091, "state": "file", "uid": 0}
ok: [localhost] => (item=[{u'route': [{u'ip': u'10.1.21.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.1.21.1', u'bridge_name': u't3br1', u'dns': [{u'dnsif': u't3s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't3s1_dnsbrif'}], u'ns_name': u't3ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.21.2/24', u'tenant_ns_ip': u'10.1.21.1/24', u'tenant_ns_if': u't3ns1if', u'tenant_sub_if': u't3s1if', u'tenant_ns_name': u't3'}], u'bridge_ip': u'1.1.1.1', u'vxlan': [{u'local_ip': u'10.1.21.2', u'dsport': 4789, u'dev': u't3s1if', u'tenant_route_ip': u'192.168.3.2', u'remote_route': u'10.2.21.0/24', u'subnet_route': u'10.1.21.0/24', u'v_name': u'vxlan_t3s1', u'id': 42, u'remote_ip': u'10.2.21.2'}]}, {u'mem': 4, u'name': u't3_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't3br1if2', u'vmif': u't3VM2if1'}]) => {"ansible_loop_var": "item", "changed": false, "checksum": "350ba870bd31b7f6ee517845c14237910b5af0bf", "dest": "/root/Migration-as-a-Service/t3/VM_templates/t3_VM2.xml.j2", "gid": 0, "group": "root", "item": [{"bridge_ip": "1.1.1.1", "bridge_name": "t3br1", "default_route_ip": "10.1.21.1", "dns": [{"brif": "t3s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t3s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t3ns1", "route": [{"if": "p1", "ip": "10.1.21.1/24", "ns_if": "t3if", "ns_name": "t3"}], "tenant_ns": [{"tenant_ns_if": "t3ns1if", "tenant_ns_ip": "10.1.21.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s1if", "tenant_sub_ip": "10.1.21.2/24"}], "vxlan": [{"dev": "t3s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.21.2", "remote_ip": "10.2.21.2", "remote_route": "10.2.21.0/24", "subnet_route": "10.1.21.0/24", "tenant_route_ip": "192.168.3.2", "v_name": "vxlan_t3s1"}]}, {"brif": "t3br1if2", "disk": "10G", "mem": 4, "name": "t3_VM2", "vcpu": 2, "vmif": "t3VM2if1"}], "mode": "0644", "owner": "root", "path": "/root/Migration-as-a-Service/t3/VM_templates/t3_VM2.xml.j2", "size": 4091, "state": "file", "uid": 0}
ok: [localhost] => (item=[{u'route': [{u'ip': u'10.1.22.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.1.22.1', u'bridge_name': u't3br2', u'dns': [{u'dnsif': u't3s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't3s2_dnsbrif'}], u'ns_name': u't3ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.22.2/24', u'tenant_ns_ip': u'10.1.22.1/24', u'tenant_ns_if': u't3ns2if', u'tenant_sub_if': u't3s2if', u'tenant_ns_name': u't3'}], u'bridge_ip': u'2.2.2.1', u'vxlan': [{u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}, {u'mem': 3, u'name': u't3_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't3br2if1', u'vmif': u't3VM3if1'}]) => {"ansible_loop_var": "item", "changed": false, "checksum": "350ba870bd31b7f6ee517845c14237910b5af0bf", "dest": "/root/Migration-as-a-Service/t3/VM_templates/t3_VM3.xml.j2", "gid": 0, "group": "root", "item": [{"bridge_ip": "2.2.2.1", "bridge_name": "t3br2", "default_route_ip": "10.1.22.1", "dns": [{"brif": "t3s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t3s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t3ns2", "route": [{"if": "p1", "ip": "10.1.22.1/24", "ns_if": "t3if", "ns_name": "t3"}], "tenant_ns": [{"tenant_ns_if": "t3ns2if", "tenant_ns_ip": "10.1.22.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s2if", "tenant_sub_ip": "10.1.22.2/24"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, {"brif": "t3br2if1", "disk": "10G", "mem": 3, "name": "t3_VM3", "vcpu": 2, "vmif": "t3VM3if1"}], "mode": "0644", "owner": "root", "path": "/root/Migration-as-a-Service/t3/VM_templates/t3_VM3.xml.j2", "size": 4091, "state": "file", "uid": 0}

PLAY RECAP **************************************************************************************************************************************************
localhost                  : ok=1    changed=0    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0   

Using /etc/ansible/ansible.cfg as config file

PLAY [main] *************************************************************************************************************************************************

TASK [Create VM templates (C2)] *****************************************************************************************************************************
ok: [localhost] => (item=[{u'route': [{u'ip': u'10.2.21.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.2.21.1', u'bridge_name': u't3br1', u'dns': [{u'dnsif': u't3s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't3s1_dnsbrif'}], u'ns_name': u't3ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.21.2/24', u'tenant_ns_ip': u'10.2.21.1/24', u'tenant_ns_if': u't3ns1if', u'tenant_sub_if': u't3s1if', u'tenant_ns_name': u't3'}], u'bridge_ip': u'1.1.1.1', u'vxlan': [{u'local_ip': u'10.2.21.2', u'dsport': 4789, u'dev': u't3s1if', u'tenant_route_ip': u'192.168.131.2', u'remote_route': u'10.1.21.0/24', u'subnet_route': u'10.2.21.0/24', u'v_name': u'vxlan_t3s1', u'id': 42, u'remote_ip': u'10.1.21.2'}]}, {u'mem': 2, u'name': u't3_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't3br1if1', u'vmif': u't3VM4if1'}]) => {"ansible_loop_var": "item", "changed": false, "checksum": "350ba870bd31b7f6ee517845c14237910b5af0bf", "dest": "/root/Migration-as-a-Service/t3/VM_templates/t3_VM4.xml.j2", "gid": 0, "group": "root", "item": [{"bridge_ip": "1.1.1.1", "bridge_name": "t3br1", "default_route_ip": "10.2.21.1", "dns": [{"brif": "t3s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t3s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "ns_name": "t3ns1", "route": [{"if": "p1", "ip": "10.2.21.1/24", "ns_if": "t3if", "ns_name": "t3"}], "tenant_ns": [{"tenant_ns_if": "t3ns1if", "tenant_ns_ip": "10.2.21.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s1if", "tenant_sub_ip": "10.2.21.2/24"}], "vxlan": [{"dev": "t3s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.21.2", "remote_ip": "10.1.21.2", "remote_route": "10.1.21.0/24", "subnet_route": "10.2.21.0/24", "tenant_route_ip": "192.168.131.2", "v_name": "vxlan_t3s1"}]}, {"brif": "t3br1if1", "disk": "10G", "mem": 2, "name": "t3_VM4", "vcpu": 4, "vmif": "t3VM4if1"}], "mode": "0644", "owner": "root", "path": "/root/Migration-as-a-Service/t3/VM_templates/t3_VM4.xml.j2", "size": 4091, "state": "file", "uid": 0}

PLAY RECAP **************************************************************************************************************************************************
localhost                  : ok=1    changed=0    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0   

Using /etc/ansible/ansible.cfg as config file

PLAY [main] *************************************************************************************************************************************************

TASK [Copy VM image] ****************************************************************************************************************************************
ok: [localhost] => (item=[{u'route': [{u'ip': u'10.1.21.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.1.21.1', u'bridge_name': u't3br1', u'dns': [{u'dnsif': u't3s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't3s1_dnsbrif'}], u'ns_name': u't3ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.21.2/24', u'tenant_ns_ip': u'10.1.21.1/24', u'tenant_ns_if': u't3ns1if', u'tenant_sub_if': u't3s1if', u'tenant_ns_name': u't3'}], u'bridge_ip': u'1.1.1.1', u'vxlan': [{u'local_ip': u'10.1.21.2', u'dsport': 4789, u'dev': u't3s1if', u'tenant_route_ip': u'192.168.3.2', u'remote_route': u'10.2.21.0/24', u'subnet_route': u'10.1.21.0/24', u'v_name': u'vxlan_t3s1', u'id': 42, u'remote_ip': u'10.2.21.2'}]}, {u'mem': 2, u'name': u't3_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't3br1if1', u'vmif': u't3VM1if1'}]) => {"ansible_loop_var": "item", "changed": false, "dest": "/var/lib/libvirt/images/t3_VM1.qcow2", "item": [{"bridge_ip": "1.1.1.1", "bridge_name": "t3br1", "default_route_ip": "10.1.21.1", "dns": [{"brif": "t3s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t3s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t3ns1", "route": [{"if": "p1", "ip": "10.1.21.1/24", "ns_if": "t3if", "ns_name": "t3"}], "tenant_ns": [{"tenant_ns_if": "t3ns1if", "tenant_ns_ip": "10.1.21.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s1if", "tenant_sub_ip": "10.1.21.2/24"}], "vxlan": [{"dev": "t3s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.21.2", "remote_ip": "10.2.21.2", "remote_route": "10.2.21.0/24", "subnet_route": "10.1.21.0/24", "tenant_route_ip": "192.168.3.2", "v_name": "vxlan_t3s1"}]}, {"brif": "t3br1if1", "disk": "10G", "mem": 2, "name": "t3_VM1", "vcpu": 4, "vmif": "t3VM1if1"}], "src": "/root/mainVM.qcow2"}
ok: [localhost] => (item=[{u'route': [{u'ip': u'10.1.21.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.1.21.1', u'bridge_name': u't3br1', u'dns': [{u'dnsif': u't3s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't3s1_dnsbrif'}], u'ns_name': u't3ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.21.2/24', u'tenant_ns_ip': u'10.1.21.1/24', u'tenant_ns_if': u't3ns1if', u'tenant_sub_if': u't3s1if', u'tenant_ns_name': u't3'}], u'bridge_ip': u'1.1.1.1', u'vxlan': [{u'local_ip': u'10.1.21.2', u'dsport': 4789, u'dev': u't3s1if', u'tenant_route_ip': u'192.168.3.2', u'remote_route': u'10.2.21.0/24', u'subnet_route': u'10.1.21.0/24', u'v_name': u'vxlan_t3s1', u'id': 42, u'remote_ip': u'10.2.21.2'}]}, {u'mem': 4, u'name': u't3_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't3br1if2', u'vmif': u't3VM2if1'}]) => {"ansible_loop_var": "item", "changed": false, "dest": "/var/lib/libvirt/images/t3_VM2.qcow2", "item": [{"bridge_ip": "1.1.1.1", "bridge_name": "t3br1", "default_route_ip": "10.1.21.1", "dns": [{"brif": "t3s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t3s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t3ns1", "route": [{"if": "p1", "ip": "10.1.21.1/24", "ns_if": "t3if", "ns_name": "t3"}], "tenant_ns": [{"tenant_ns_if": "t3ns1if", "tenant_ns_ip": "10.1.21.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s1if", "tenant_sub_ip": "10.1.21.2/24"}], "vxlan": [{"dev": "t3s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.21.2", "remote_ip": "10.2.21.2", "remote_route": "10.2.21.0/24", "subnet_route": "10.1.21.0/24", "tenant_route_ip": "192.168.3.2", "v_name": "vxlan_t3s1"}]}, {"brif": "t3br1if2", "disk": "10G", "mem": 4, "name": "t3_VM2", "vcpu": 2, "vmif": "t3VM2if1"}], "src": "/root/mainVM.qcow2"}
ok: [localhost] => (item=[{u'route': [{u'ip': u'10.1.22.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.1.22.1', u'bridge_name': u't3br2', u'dns': [{u'dnsif': u't3s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't3s2_dnsbrif'}], u'ns_name': u't3ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.22.2/24', u'tenant_ns_ip': u'10.1.22.1/24', u'tenant_ns_if': u't3ns2if', u'tenant_sub_if': u't3s2if', u'tenant_ns_name': u't3'}], u'bridge_ip': u'2.2.2.1', u'vxlan': [{u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}, {u'mem': 3, u'name': u't3_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't3br2if1', u'vmif': u't3VM3if1'}]) => {"ansible_loop_var": "item", "changed": false, "dest": "/var/lib/libvirt/images/t3_VM3.qcow2", "item": [{"bridge_ip": "2.2.2.1", "bridge_name": "t3br2", "default_route_ip": "10.1.22.1", "dns": [{"brif": "t3s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t3s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t3ns2", "route": [{"if": "p1", "ip": "10.1.22.1/24", "ns_if": "t3if", "ns_name": "t3"}], "tenant_ns": [{"tenant_ns_if": "t3ns2if", "tenant_ns_ip": "10.1.22.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s2if", "tenant_sub_ip": "10.1.22.2/24"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, {"brif": "t3br2if1", "disk": "10G", "mem": 3, "name": "t3_VM3", "vcpu": 2, "vmif": "t3VM3if1"}], "src": "/root/mainVM.qcow2"}

TASK [Create VM templates (C1)] *****************************************************************************************************************************
ok: [localhost] => (item=[{u'route': [{u'ip': u'10.1.21.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.1.21.1', u'bridge_name': u't3br1', u'dns': [{u'dnsif': u't3s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't3s1_dnsbrif'}], u'ns_name': u't3ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.21.2/24', u'tenant_ns_ip': u'10.1.21.1/24', u'tenant_ns_if': u't3ns1if', u'tenant_sub_if': u't3s1if', u'tenant_ns_name': u't3'}], u'bridge_ip': u'1.1.1.1', u'vxlan': [{u'local_ip': u'10.1.21.2', u'dsport': 4789, u'dev': u't3s1if', u'tenant_route_ip': u'192.168.3.2', u'remote_route': u'10.2.21.0/24', u'subnet_route': u'10.1.21.0/24', u'v_name': u'vxlan_t3s1', u'id': 42, u'remote_ip': u'10.2.21.2'}]}, {u'mem': 2, u'name': u't3_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't3br1if1', u'vmif': u't3VM1if1'}]) => {"ansible_loop_var": "item", "changed": false, "checksum": "350ba870bd31b7f6ee517845c14237910b5af0bf", "dest": "/root/Migration-as-a-Service/t3/VM_templates/t3_VM1.xml.j2", "gid": 0, "group": "root", "item": [{"bridge_ip": "1.1.1.1", "bridge_name": "t3br1", "default_route_ip": "10.1.21.1", "dns": [{"brif": "t3s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t3s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t3ns1", "route": [{"if": "p1", "ip": "10.1.21.1/24", "ns_if": "t3if", "ns_name": "t3"}], "tenant_ns": [{"tenant_ns_if": "t3ns1if", "tenant_ns_ip": "10.1.21.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s1if", "tenant_sub_ip": "10.1.21.2/24"}], "vxlan": [{"dev": "t3s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.21.2", "remote_ip": "10.2.21.2", "remote_route": "10.2.21.0/24", "subnet_route": "10.1.21.0/24", "tenant_route_ip": "192.168.3.2", "v_name": "vxlan_t3s1"}]}, {"brif": "t3br1if1", "disk": "10G", "mem": 2, "name": "t3_VM1", "vcpu": 4, "vmif": "t3VM1if1"}], "mode": "0644", "owner": "root", "path": "/root/Migration-as-a-Service/t3/VM_templates/t3_VM1.xml.j2", "size": 4091, "state": "file", "uid": 0}
ok: [localhost] => (item=[{u'route': [{u'ip': u'10.1.21.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.1.21.1', u'bridge_name': u't3br1', u'dns': [{u'dnsif': u't3s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't3s1_dnsbrif'}], u'ns_name': u't3ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.21.2/24', u'tenant_ns_ip': u'10.1.21.1/24', u'tenant_ns_if': u't3ns1if', u'tenant_sub_if': u't3s1if', u'tenant_ns_name': u't3'}], u'bridge_ip': u'1.1.1.1', u'vxlan': [{u'local_ip': u'10.1.21.2', u'dsport': 4789, u'dev': u't3s1if', u'tenant_route_ip': u'192.168.3.2', u'remote_route': u'10.2.21.0/24', u'subnet_route': u'10.1.21.0/24', u'v_name': u'vxlan_t3s1', u'id': 42, u'remote_ip': u'10.2.21.2'}]}, {u'mem': 4, u'name': u't3_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't3br1if2', u'vmif': u't3VM2if1'}]) => {"ansible_loop_var": "item", "changed": false, "checksum": "350ba870bd31b7f6ee517845c14237910b5af0bf", "dest": "/root/Migration-as-a-Service/t3/VM_templates/t3_VM2.xml.j2", "gid": 0, "group": "root", "item": [{"bridge_ip": "1.1.1.1", "bridge_name": "t3br1", "default_route_ip": "10.1.21.1", "dns": [{"brif": "t3s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t3s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t3ns1", "route": [{"if": "p1", "ip": "10.1.21.1/24", "ns_if": "t3if", "ns_name": "t3"}], "tenant_ns": [{"tenant_ns_if": "t3ns1if", "tenant_ns_ip": "10.1.21.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s1if", "tenant_sub_ip": "10.1.21.2/24"}], "vxlan": [{"dev": "t3s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.21.2", "remote_ip": "10.2.21.2", "remote_route": "10.2.21.0/24", "subnet_route": "10.1.21.0/24", "tenant_route_ip": "192.168.3.2", "v_name": "vxlan_t3s1"}]}, {"brif": "t3br1if2", "disk": "10G", "mem": 4, "name": "t3_VM2", "vcpu": 2, "vmif": "t3VM2if1"}], "mode": "0644", "owner": "root", "path": "/root/Migration-as-a-Service/t3/VM_templates/t3_VM2.xml.j2", "size": 4091, "state": "file", "uid": 0}
ok: [localhost] => (item=[{u'route': [{u'ip': u'10.1.22.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.1.22.1', u'bridge_name': u't3br2', u'dns': [{u'dnsif': u't3s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't3s2_dnsbrif'}], u'ns_name': u't3ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.22.2/24', u'tenant_ns_ip': u'10.1.22.1/24', u'tenant_ns_if': u't3ns2if', u'tenant_sub_if': u't3s2if', u'tenant_ns_name': u't3'}], u'bridge_ip': u'2.2.2.1', u'vxlan': [{u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}, {u'mem': 3, u'name': u't3_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't3br2if1', u'vmif': u't3VM3if1'}]) => {"ansible_loop_var": "item", "changed": false, "checksum": "350ba870bd31b7f6ee517845c14237910b5af0bf", "dest": "/root/Migration-as-a-Service/t3/VM_templates/t3_VM3.xml.j2", "gid": 0, "group": "root", "item": [{"bridge_ip": "2.2.2.1", "bridge_name": "t3br2", "default_route_ip": "10.1.22.1", "dns": [{"brif": "t3s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t3s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t3ns2", "route": [{"if": "p1", "ip": "10.1.22.1/24", "ns_if": "t3if", "ns_name": "t3"}], "tenant_ns": [{"tenant_ns_if": "t3ns2if", "tenant_ns_ip": "10.1.22.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s2if", "tenant_sub_ip": "10.1.22.2/24"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, {"brif": "t3br2if1", "disk": "10G", "mem": 3, "name": "t3_VM3", "vcpu": 2, "vmif": "t3VM3if1"}], "mode": "0644", "owner": "root", "path": "/root/Migration-as-a-Service/t3/VM_templates/t3_VM3.xml.j2", "size": 4091, "state": "file", "uid": 0}

TASK [Get list of running VMs] ******************************************************************************************************************************
ok: [localhost] => {"changed": false, "cmd": ["virsh", "list", "--name"], "delta": "0:00:00.019820", "end": "2019-11-17 10:24:53.646685", "rc": 0, "start": "2019-11-17 10:24:53.626865", "stderr": "", "stderr_lines": [], "stdout": "t1_VM1\nt1_VM2\nt1_VM3\nt2_VM1\nt2_VM2\nt2_VM3\nt3_VM1\nt3_VM2\nt3_VM3", "stdout_lines": ["t1_VM1", "t1_VM2", "t1_VM3", "t2_VM1", "t2_VM2", "t2_VM3", "t3_VM1", "t3_VM2", "t3_VM3"]}

TASK [Define VM] ********************************************************************************************************************************************
skipping: [localhost] => (item=[{u'route': [{u'ip': u'10.1.21.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.1.21.1', u'bridge_name': u't3br1', u'dns': [{u'dnsif': u't3s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't3s1_dnsbrif'}], u'ns_name': u't3ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.21.2/24', u'tenant_ns_ip': u'10.1.21.1/24', u'tenant_ns_if': u't3ns1if', u'tenant_sub_if': u't3s1if', u'tenant_ns_name': u't3'}], u'bridge_ip': u'1.1.1.1', u'vxlan': [{u'local_ip': u'10.1.21.2', u'dsport': 4789, u'dev': u't3s1if', u'tenant_route_ip': u'192.168.3.2', u'remote_route': u'10.2.21.0/24', u'subnet_route': u'10.1.21.0/24', u'v_name': u'vxlan_t3s1', u'id': 42, u'remote_ip': u'10.2.21.2'}]}, {u'mem': 2, u'name': u't3_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't3br1if1', u'vmif': u't3VM1if1'}])  => {"ansible_loop_var": "item", "changed": false, "item": [{"bridge_ip": "1.1.1.1", "bridge_name": "t3br1", "default_route_ip": "10.1.21.1", "dns": [{"brif": "t3s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t3s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t3ns1", "route": [{"if": "p1", "ip": "10.1.21.1/24", "ns_if": "t3if", "ns_name": "t3"}], "tenant_ns": [{"tenant_ns_if": "t3ns1if", "tenant_ns_ip": "10.1.21.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s1if", "tenant_sub_ip": "10.1.21.2/24"}], "vxlan": [{"dev": "t3s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.21.2", "remote_ip": "10.2.21.2", "remote_route": "10.2.21.0/24", "subnet_route": "10.1.21.0/24", "tenant_route_ip": "192.168.3.2", "v_name": "vxlan_t3s1"}]}, {"brif": "t3br1if1", "disk": "10G", "mem": 2, "name": "t3_VM1", "vcpu": 4, "vmif": "t3VM1if1"}], "skip_reason": "Conditional result was False"}
skipping: [localhost] => (item=[{u'route': [{u'ip': u'10.1.21.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.1.21.1', u'bridge_name': u't3br1', u'dns': [{u'dnsif': u't3s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't3s1_dnsbrif'}], u'ns_name': u't3ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.21.2/24', u'tenant_ns_ip': u'10.1.21.1/24', u'tenant_ns_if': u't3ns1if', u'tenant_sub_if': u't3s1if', u'tenant_ns_name': u't3'}], u'bridge_ip': u'1.1.1.1', u'vxlan': [{u'local_ip': u'10.1.21.2', u'dsport': 4789, u'dev': u't3s1if', u'tenant_route_ip': u'192.168.3.2', u'remote_route': u'10.2.21.0/24', u'subnet_route': u'10.1.21.0/24', u'v_name': u'vxlan_t3s1', u'id': 42, u'remote_ip': u'10.2.21.2'}]}, {u'mem': 4, u'name': u't3_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't3br1if2', u'vmif': u't3VM2if1'}])  => {"ansible_loop_var": "item", "changed": false, "item": [{"bridge_ip": "1.1.1.1", "bridge_name": "t3br1", "default_route_ip": "10.1.21.1", "dns": [{"brif": "t3s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t3s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t3ns1", "route": [{"if": "p1", "ip": "10.1.21.1/24", "ns_if": "t3if", "ns_name": "t3"}], "tenant_ns": [{"tenant_ns_if": "t3ns1if", "tenant_ns_ip": "10.1.21.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s1if", "tenant_sub_ip": "10.1.21.2/24"}], "vxlan": [{"dev": "t3s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.21.2", "remote_ip": "10.2.21.2", "remote_route": "10.2.21.0/24", "subnet_route": "10.1.21.0/24", "tenant_route_ip": "192.168.3.2", "v_name": "vxlan_t3s1"}]}, {"brif": "t3br1if2", "disk": "10G", "mem": 4, "name": "t3_VM2", "vcpu": 2, "vmif": "t3VM2if1"}], "skip_reason": "Conditional result was False"}
skipping: [localhost] => (item=[{u'route': [{u'ip': u'10.1.22.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.1.22.1', u'bridge_name': u't3br2', u'dns': [{u'dnsif': u't3s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't3s2_dnsbrif'}], u'ns_name': u't3ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.22.2/24', u'tenant_ns_ip': u'10.1.22.1/24', u'tenant_ns_if': u't3ns2if', u'tenant_sub_if': u't3s2if', u'tenant_ns_name': u't3'}], u'bridge_ip': u'2.2.2.1', u'vxlan': [{u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}, {u'mem': 3, u'name': u't3_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't3br2if1', u'vmif': u't3VM3if1'}])  => {"ansible_loop_var": "item", "changed": false, "item": [{"bridge_ip": "2.2.2.1", "bridge_name": "t3br2", "default_route_ip": "10.1.22.1", "dns": [{"brif": "t3s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t3s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t3ns2", "route": [{"if": "p1", "ip": "10.1.22.1/24", "ns_if": "t3if", "ns_name": "t3"}], "tenant_ns": [{"tenant_ns_if": "t3ns2if", "tenant_ns_ip": "10.1.22.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s2if", "tenant_sub_ip": "10.1.22.2/24"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, {"brif": "t3br2if1", "disk": "10G", "mem": 3, "name": "t3_VM3", "vcpu": 2, "vmif": "t3VM3if1"}], "skip_reason": "Conditional result was False"}

TASK [Create VM] ********************************************************************************************************************************************
skipping: [localhost] => (item=[{u'route': [{u'ip': u'10.1.21.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.1.21.1', u'bridge_name': u't3br1', u'dns': [{u'dnsif': u't3s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't3s1_dnsbrif'}], u'ns_name': u't3ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.21.2/24', u'tenant_ns_ip': u'10.1.21.1/24', u'tenant_ns_if': u't3ns1if', u'tenant_sub_if': u't3s1if', u'tenant_ns_name': u't3'}], u'bridge_ip': u'1.1.1.1', u'vxlan': [{u'local_ip': u'10.1.21.2', u'dsport': 4789, u'dev': u't3s1if', u'tenant_route_ip': u'192.168.3.2', u'remote_route': u'10.2.21.0/24', u'subnet_route': u'10.1.21.0/24', u'v_name': u'vxlan_t3s1', u'id': 42, u'remote_ip': u'10.2.21.2'}]}, {u'mem': 2, u'name': u't3_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't3br1if1', u'vmif': u't3VM1if1'}])  => {"ansible_loop_var": "item", "changed": false, "item": [{"bridge_ip": "1.1.1.1", "bridge_name": "t3br1", "default_route_ip": "10.1.21.1", "dns": [{"brif": "t3s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t3s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t3ns1", "route": [{"if": "p1", "ip": "10.1.21.1/24", "ns_if": "t3if", "ns_name": "t3"}], "tenant_ns": [{"tenant_ns_if": "t3ns1if", "tenant_ns_ip": "10.1.21.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s1if", "tenant_sub_ip": "10.1.21.2/24"}], "vxlan": [{"dev": "t3s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.21.2", "remote_ip": "10.2.21.2", "remote_route": "10.2.21.0/24", "subnet_route": "10.1.21.0/24", "tenant_route_ip": "192.168.3.2", "v_name": "vxlan_t3s1"}]}, {"brif": "t3br1if1", "disk": "10G", "mem": 2, "name": "t3_VM1", "vcpu": 4, "vmif": "t3VM1if1"}], "skip_reason": "Conditional result was False"}
skipping: [localhost] => (item=[{u'route': [{u'ip': u'10.1.21.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.1.21.1', u'bridge_name': u't3br1', u'dns': [{u'dnsif': u't3s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't3s1_dnsbrif'}], u'ns_name': u't3ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.21.2/24', u'tenant_ns_ip': u'10.1.21.1/24', u'tenant_ns_if': u't3ns1if', u'tenant_sub_if': u't3s1if', u'tenant_ns_name': u't3'}], u'bridge_ip': u'1.1.1.1', u'vxlan': [{u'local_ip': u'10.1.21.2', u'dsport': 4789, u'dev': u't3s1if', u'tenant_route_ip': u'192.168.3.2', u'remote_route': u'10.2.21.0/24', u'subnet_route': u'10.1.21.0/24', u'v_name': u'vxlan_t3s1', u'id': 42, u'remote_ip': u'10.2.21.2'}]}, {u'mem': 4, u'name': u't3_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't3br1if2', u'vmif': u't3VM2if1'}])  => {"ansible_loop_var": "item", "changed": false, "item": [{"bridge_ip": "1.1.1.1", "bridge_name": "t3br1", "default_route_ip": "10.1.21.1", "dns": [{"brif": "t3s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t3s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t3ns1", "route": [{"if": "p1", "ip": "10.1.21.1/24", "ns_if": "t3if", "ns_name": "t3"}], "tenant_ns": [{"tenant_ns_if": "t3ns1if", "tenant_ns_ip": "10.1.21.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s1if", "tenant_sub_ip": "10.1.21.2/24"}], "vxlan": [{"dev": "t3s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.21.2", "remote_ip": "10.2.21.2", "remote_route": "10.2.21.0/24", "subnet_route": "10.1.21.0/24", "tenant_route_ip": "192.168.3.2", "v_name": "vxlan_t3s1"}]}, {"brif": "t3br1if2", "disk": "10G", "mem": 4, "name": "t3_VM2", "vcpu": 2, "vmif": "t3VM2if1"}], "skip_reason": "Conditional result was False"}
skipping: [localhost] => (item=[{u'route': [{u'ip': u'10.1.22.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.1.22.1', u'bridge_name': u't3br2', u'dns': [{u'dnsif': u't3s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't3s2_dnsbrif'}], u'ns_name': u't3ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.22.2/24', u'tenant_ns_ip': u'10.1.22.1/24', u'tenant_ns_if': u't3ns2if', u'tenant_sub_if': u't3s2if', u'tenant_ns_name': u't3'}], u'bridge_ip': u'2.2.2.1', u'vxlan': [{u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}, {u'mem': 3, u'name': u't3_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't3br2if1', u'vmif': u't3VM3if1'}])  => {"ansible_loop_var": "item", "changed": false, "item": [{"bridge_ip": "2.2.2.1", "bridge_name": "t3br2", "default_route_ip": "10.1.22.1", "dns": [{"brif": "t3s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t3s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t3ns2", "route": [{"if": "p1", "ip": "10.1.22.1/24", "ns_if": "t3if", "ns_name": "t3"}], "tenant_ns": [{"tenant_ns_if": "t3ns2if", "tenant_ns_ip": "10.1.22.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s2if", "tenant_sub_ip": "10.1.22.2/24"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, {"brif": "t3br2if1", "disk": "10G", "mem": 3, "name": "t3_VM3", "vcpu": 2, "vmif": "t3VM3if1"}], "skip_reason": "Conditional result was False"}

TASK [Start VM] *********************************************************************************************************************************************
skipping: [localhost] => (item=[{u'route': [{u'ip': u'10.1.21.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.1.21.1', u'bridge_name': u't3br1', u'dns': [{u'dnsif': u't3s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't3s1_dnsbrif'}], u'ns_name': u't3ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.21.2/24', u'tenant_ns_ip': u'10.1.21.1/24', u'tenant_ns_if': u't3ns1if', u'tenant_sub_if': u't3s1if', u'tenant_ns_name': u't3'}], u'bridge_ip': u'1.1.1.1', u'vxlan': [{u'local_ip': u'10.1.21.2', u'dsport': 4789, u'dev': u't3s1if', u'tenant_route_ip': u'192.168.3.2', u'remote_route': u'10.2.21.0/24', u'subnet_route': u'10.1.21.0/24', u'v_name': u'vxlan_t3s1', u'id': 42, u'remote_ip': u'10.2.21.2'}]}, {u'mem': 2, u'name': u't3_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't3br1if1', u'vmif': u't3VM1if1'}])  => {"ansible_loop_var": "item", "changed": false, "item": [{"bridge_ip": "1.1.1.1", "bridge_name": "t3br1", "default_route_ip": "10.1.21.1", "dns": [{"brif": "t3s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t3s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t3ns1", "route": [{"if": "p1", "ip": "10.1.21.1/24", "ns_if": "t3if", "ns_name": "t3"}], "tenant_ns": [{"tenant_ns_if": "t3ns1if", "tenant_ns_ip": "10.1.21.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s1if", "tenant_sub_ip": "10.1.21.2/24"}], "vxlan": [{"dev": "t3s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.21.2", "remote_ip": "10.2.21.2", "remote_route": "10.2.21.0/24", "subnet_route": "10.1.21.0/24", "tenant_route_ip": "192.168.3.2", "v_name": "vxlan_t3s1"}]}, {"brif": "t3br1if1", "disk": "10G", "mem": 2, "name": "t3_VM1", "vcpu": 4, "vmif": "t3VM1if1"}], "skip_reason": "Conditional result was False"}
skipping: [localhost] => (item=[{u'route': [{u'ip': u'10.1.21.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.1.21.1', u'bridge_name': u't3br1', u'dns': [{u'dnsif': u't3s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't3s1_dnsbrif'}], u'ns_name': u't3ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.21.2/24', u'tenant_ns_ip': u'10.1.21.1/24', u'tenant_ns_if': u't3ns1if', u'tenant_sub_if': u't3s1if', u'tenant_ns_name': u't3'}], u'bridge_ip': u'1.1.1.1', u'vxlan': [{u'local_ip': u'10.1.21.2', u'dsport': 4789, u'dev': u't3s1if', u'tenant_route_ip': u'192.168.3.2', u'remote_route': u'10.2.21.0/24', u'subnet_route': u'10.1.21.0/24', u'v_name': u'vxlan_t3s1', u'id': 42, u'remote_ip': u'10.2.21.2'}]}, {u'mem': 4, u'name': u't3_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't3br1if2', u'vmif': u't3VM2if1'}])  => {"ansible_loop_var": "item", "changed": false, "item": [{"bridge_ip": "1.1.1.1", "bridge_name": "t3br1", "default_route_ip": "10.1.21.1", "dns": [{"brif": "t3s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t3s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t3ns1", "route": [{"if": "p1", "ip": "10.1.21.1/24", "ns_if": "t3if", "ns_name": "t3"}], "tenant_ns": [{"tenant_ns_if": "t3ns1if", "tenant_ns_ip": "10.1.21.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s1if", "tenant_sub_ip": "10.1.21.2/24"}], "vxlan": [{"dev": "t3s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.21.2", "remote_ip": "10.2.21.2", "remote_route": "10.2.21.0/24", "subnet_route": "10.1.21.0/24", "tenant_route_ip": "192.168.3.2", "v_name": "vxlan_t3s1"}]}, {"brif": "t3br1if2", "disk": "10G", "mem": 4, "name": "t3_VM2", "vcpu": 2, "vmif": "t3VM2if1"}], "skip_reason": "Conditional result was False"}
skipping: [localhost] => (item=[{u'route': [{u'ip': u'10.1.22.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.1.22.1', u'bridge_name': u't3br2', u'dns': [{u'dnsif': u't3s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't3s2_dnsbrif'}], u'ns_name': u't3ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.22.2/24', u'tenant_ns_ip': u'10.1.22.1/24', u'tenant_ns_if': u't3ns2if', u'tenant_sub_if': u't3s2if', u'tenant_ns_name': u't3'}], u'bridge_ip': u'2.2.2.1', u'vxlan': [{u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}, {u'mem': 3, u'name': u't3_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't3br2if1', u'vmif': u't3VM3if1'}])  => {"ansible_loop_var": "item", "changed": false, "item": [{"bridge_ip": "2.2.2.1", "bridge_name": "t3br2", "default_route_ip": "10.1.22.1", "dns": [{"brif": "t3s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t3s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t3ns2", "route": [{"if": "p1", "ip": "10.1.22.1/24", "ns_if": "t3if", "ns_name": "t3"}], "tenant_ns": [{"tenant_ns_if": "t3ns2if", "tenant_ns_ip": "10.1.22.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s2if", "tenant_sub_ip": "10.1.22.2/24"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, {"brif": "t3br2if1", "disk": "10G", "mem": 3, "name": "t3_VM3", "vcpu": 2, "vmif": "t3VM3if1"}], "skip_reason": "Conditional result was False"}

TASK [Attach VM interface] **********************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.21.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.1.21.1', u'bridge_name': u't3br1', u'dns': [{u'dnsif': u't3s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't3s1_dnsbrif'}], u'ns_name': u't3ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.21.2/24', u'tenant_ns_ip': u'10.1.21.1/24', u'tenant_ns_if': u't3ns1if', u'tenant_sub_if': u't3s1if', u'tenant_ns_name': u't3'}], u'bridge_ip': u'1.1.1.1', u'vxlan': [{u'local_ip': u'10.1.21.2', u'dsport': 4789, u'dev': u't3s1if', u'tenant_route_ip': u'192.168.3.2', u'remote_route': u'10.2.21.0/24', u'subnet_route': u'10.1.21.0/24', u'v_name': u'vxlan_t3s1', u'id': 42, u'remote_ip': u'10.2.21.2'}]}, {u'mem': 2, u'name': u't3_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't3br1if1', u'vmif': u't3VM1if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "virsh domiflist \"t3_VM1\" | grep -w 't3VM1if1' ; if [ $? -ne 0 ] ; then virsh attach-interface \"t3_VM1\" direct \"t3VM1if1\" --live --persistent ; fi\n", "delta": "0:00:00.020797", "end": "2019-11-17 10:24:54.035213", "item": [{"bridge_ip": "1.1.1.1", "bridge_name": "t3br1", "default_route_ip": "10.1.21.1", "dns": [{"brif": "t3s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t3s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t3ns1", "route": [{"if": "p1", "ip": "10.1.21.1/24", "ns_if": "t3if", "ns_name": "t3"}], "tenant_ns": [{"tenant_ns_if": "t3ns1if", "tenant_ns_ip": "10.1.21.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s1if", "tenant_sub_ip": "10.1.21.2/24"}], "vxlan": [{"dev": "t3s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.21.2", "remote_ip": "10.2.21.2", "remote_route": "10.2.21.0/24", "subnet_route": "10.1.21.0/24", "tenant_route_ip": "192.168.3.2", "v_name": "vxlan_t3s1"}]}, {"brif": "t3br1if1", "disk": "10G", "mem": 2, "name": "t3_VM1", "vcpu": 4, "vmif": "t3VM1if1"}], "rc": 0, "start": "2019-11-17 10:24:54.014416", "stderr": "", "stderr_lines": [], "stdout": "macvtap6   direct     t3VM1if1   rtl8139     52:54:00:92:ce:f1", "stdout_lines": ["macvtap6   direct     t3VM1if1   rtl8139     52:54:00:92:ce:f1"]}
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.21.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.1.21.1', u'bridge_name': u't3br1', u'dns': [{u'dnsif': u't3s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't3s1_dnsbrif'}], u'ns_name': u't3ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.21.2/24', u'tenant_ns_ip': u'10.1.21.1/24', u'tenant_ns_if': u't3ns1if', u'tenant_sub_if': u't3s1if', u'tenant_ns_name': u't3'}], u'bridge_ip': u'1.1.1.1', u'vxlan': [{u'local_ip': u'10.1.21.2', u'dsport': 4789, u'dev': u't3s1if', u'tenant_route_ip': u'192.168.3.2', u'remote_route': u'10.2.21.0/24', u'subnet_route': u'10.1.21.0/24', u'v_name': u'vxlan_t3s1', u'id': 42, u'remote_ip': u'10.2.21.2'}]}, {u'mem': 4, u'name': u't3_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't3br1if2', u'vmif': u't3VM2if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "virsh domiflist \"t3_VM2\" | grep -w 't3VM2if1' ; if [ $? -ne 0 ] ; then virsh attach-interface \"t3_VM2\" direct \"t3VM2if1\" --live --persistent ; fi\n", "delta": "0:00:00.019896", "end": "2019-11-17 10:24:54.225407", "item": [{"bridge_ip": "1.1.1.1", "bridge_name": "t3br1", "default_route_ip": "10.1.21.1", "dns": [{"brif": "t3s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t3s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t3ns1", "route": [{"if": "p1", "ip": "10.1.21.1/24", "ns_if": "t3if", "ns_name": "t3"}], "tenant_ns": [{"tenant_ns_if": "t3ns1if", "tenant_ns_ip": "10.1.21.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s1if", "tenant_sub_ip": "10.1.21.2/24"}], "vxlan": [{"dev": "t3s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.21.2", "remote_ip": "10.2.21.2", "remote_route": "10.2.21.0/24", "subnet_route": "10.1.21.0/24", "tenant_route_ip": "192.168.3.2", "v_name": "vxlan_t3s1"}]}, {"brif": "t3br1if2", "disk": "10G", "mem": 4, "name": "t3_VM2", "vcpu": 2, "vmif": "t3VM2if1"}], "rc": 0, "start": "2019-11-17 10:24:54.205511", "stderr": "", "stderr_lines": [], "stdout": "macvtap7   direct     t3VM2if1   rtl8139     52:54:00:9e:b2:45", "stdout_lines": ["macvtap7   direct     t3VM2if1   rtl8139     52:54:00:9e:b2:45"]}
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.22.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.1.22.1', u'bridge_name': u't3br2', u'dns': [{u'dnsif': u't3s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't3s2_dnsbrif'}], u'ns_name': u't3ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.22.2/24', u'tenant_ns_ip': u'10.1.22.1/24', u'tenant_ns_if': u't3ns2if', u'tenant_sub_if': u't3s2if', u'tenant_ns_name': u't3'}], u'bridge_ip': u'2.2.2.1', u'vxlan': [{u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}, {u'mem': 3, u'name': u't3_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't3br2if1', u'vmif': u't3VM3if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "virsh domiflist \"t3_VM3\" | grep -w 't3VM3if1' ; if [ $? -ne 0 ] ; then virsh attach-interface \"t3_VM3\" direct \"t3VM3if1\" --live --persistent ; fi\n", "delta": "0:00:00.026006", "end": "2019-11-17 10:24:54.417402", "item": [{"bridge_ip": "2.2.2.1", "bridge_name": "t3br2", "default_route_ip": "10.1.22.1", "dns": [{"brif": "t3s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t3s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t3ns2", "route": [{"if": "p1", "ip": "10.1.22.1/24", "ns_if": "t3if", "ns_name": "t3"}], "tenant_ns": [{"tenant_ns_if": "t3ns2if", "tenant_ns_ip": "10.1.22.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s2if", "tenant_sub_ip": "10.1.22.2/24"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, {"brif": "t3br2if1", "disk": "10G", "mem": 3, "name": "t3_VM3", "vcpu": 2, "vmif": "t3VM3if1"}], "rc": 0, "start": "2019-11-17 10:24:54.391396", "stderr": "", "stderr_lines": [], "stdout": "macvtap8   direct     t3VM3if1   rtl8139     52:54:00:48:7c:1a", "stdout_lines": ["macvtap8   direct     t3VM3if1   rtl8139     52:54:00:48:7c:1a"]}

PLAY RECAP **************************************************************************************************************************************************
localhost                  : ok=4    changed=1    unreachable=0    failed=0    skipped=3    rescued=0    ignored=0   

Using /etc/ansible/ansible.cfg as config file

PLAY [worker] ***********************************************************************************************************************************************

TASK [Copy VM image] ****************************************************************************************************************************************
ok: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.21.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.2.21.1', u'bridge_name': u't3br1', u'dns': [{u'dnsif': u't3s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't3s1_dnsbrif'}], u'ns_name': u't3ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.21.2/24', u'tenant_ns_ip': u'10.2.21.1/24', u'tenant_ns_if': u't3ns1if', u'tenant_sub_if': u't3s1if', u'tenant_ns_name': u't3'}], u'bridge_ip': u'1.1.1.1', u'vxlan': [{u'local_ip': u'10.2.21.2', u'dsport': 4789, u'dev': u't3s1if', u'tenant_route_ip': u'192.168.131.2', u'remote_route': u'10.1.21.0/24', u'subnet_route': u'10.2.21.0/24', u'v_name': u'vxlan_t3s1', u'id': 42, u'remote_ip': u'10.1.21.2'}]}, {u'mem': 2, u'name': u't3_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't3br1if1', u'vmif': u't3VM4if1'}]) => {"ansible_loop_var": "item", "changed": false, "dest": "/var/lib/libvirt/images/t3_VM4.qcow2", "gid": 0, "group": "root", "item": [{"bridge_ip": "1.1.1.1", "bridge_name": "t3br1", "default_route_ip": "10.2.21.1", "dns": [{"brif": "t3s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t3s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "ns_name": "t3ns1", "route": [{"if": "p1", "ip": "10.2.21.1/24", "ns_if": "t3if", "ns_name": "t3"}], "tenant_ns": [{"tenant_ns_if": "t3ns1if", "tenant_ns_ip": "10.2.21.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s1if", "tenant_sub_ip": "10.2.21.2/24"}], "vxlan": [{"dev": "t3s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.21.2", "remote_ip": "10.1.21.2", "remote_route": "10.1.21.0/24", "subnet_route": "10.2.21.0/24", "tenant_route_ip": "192.168.131.2", "v_name": "vxlan_t3s1"}]}, {"brif": "t3br1if1", "disk": "10G", "mem": 2, "name": "t3_VM4", "vcpu": 4, "vmif": "t3VM4if1"}], "mode": "0644", "msg": "file already exists", "owner": "root", "size": 10739318784, "src": "/root/mainVM.qcow2", "state": "file", "uid": 0}

TASK [Get list of running VMs] ******************************************************************************************************************************
ok: [99.99.99.2] => {"changed": false, "cmd": ["virsh", "list", "--name"], "delta": "0:00:00.017239", "end": "2019-11-17 10:25:27.827625", "rc": 0, "start": "2019-11-17 10:25:27.810386", "stderr": "", "stderr_lines": [], "stdout": "t1_VM4\nt2_VM4", "stdout_lines": ["t1_VM4", "t2_VM4"]}

TASK [Define VM] ********************************************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.21.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.2.21.1', u'bridge_name': u't3br1', u'dns': [{u'dnsif': u't3s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't3s1_dnsbrif'}], u'ns_name': u't3ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.21.2/24', u'tenant_ns_ip': u'10.2.21.1/24', u'tenant_ns_if': u't3ns1if', u'tenant_sub_if': u't3s1if', u'tenant_ns_name': u't3'}], u'bridge_ip': u'1.1.1.1', u'vxlan': [{u'local_ip': u'10.2.21.2', u'dsport': 4789, u'dev': u't3s1if', u'tenant_route_ip': u'192.168.131.2', u'remote_route': u'10.1.21.0/24', u'subnet_route': u'10.2.21.0/24', u'v_name': u'vxlan_t3s1', u'id': 42, u'remote_ip': u'10.1.21.2'}]}, {u'mem': 2, u'name': u't3_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't3br1if1', u'vmif': u't3VM4if1'}]) => {"ansible_loop_var": "item", "changed": true, "created": "t3_VM4", "item": [{"bridge_ip": "1.1.1.1", "bridge_name": "t3br1", "default_route_ip": "10.2.21.1", "dns": [{"brif": "t3s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t3s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "ns_name": "t3ns1", "route": [{"if": "p1", "ip": "10.2.21.1/24", "ns_if": "t3if", "ns_name": "t3"}], "tenant_ns": [{"tenant_ns_if": "t3ns1if", "tenant_ns_ip": "10.2.21.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s1if", "tenant_sub_ip": "10.2.21.2/24"}], "vxlan": [{"dev": "t3s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.21.2", "remote_ip": "10.1.21.2", "remote_route": "10.1.21.0/24", "subnet_route": "10.2.21.0/24", "tenant_route_ip": "192.168.131.2", "v_name": "vxlan_t3s1"}]}, {"brif": "t3br1if1", "disk": "10G", "mem": 2, "name": "t3_VM4", "vcpu": 4, "vmif": "t3VM4if1"}], "warnings": ["'xml' is given - ignoring 'name'"]}

TASK [Create VM] ********************************************************************************************************************************************
ok: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.21.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.2.21.1', u'bridge_name': u't3br1', u'dns': [{u'dnsif': u't3s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't3s1_dnsbrif'}], u'ns_name': u't3ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.21.2/24', u'tenant_ns_ip': u'10.2.21.1/24', u'tenant_ns_if': u't3ns1if', u'tenant_sub_if': u't3s1if', u'tenant_ns_name': u't3'}], u'bridge_ip': u'1.1.1.1', u'vxlan': [{u'local_ip': u'10.2.21.2', u'dsport': 4789, u'dev': u't3s1if', u'tenant_route_ip': u'192.168.131.2', u'remote_route': u'10.1.21.0/24', u'subnet_route': u'10.2.21.0/24', u'v_name': u'vxlan_t3s1', u'id': 42, u'remote_ip': u'10.1.21.2'}]}, {u'mem': 2, u'name': u't3_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't3br1if1', u'vmif': u't3VM4if1'}]) => {"ansible_loop_var": "item", "changed": false, "create": 0, "item": [{"bridge_ip": "1.1.1.1", "bridge_name": "t3br1", "default_route_ip": "10.2.21.1", "dns": [{"brif": "t3s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t3s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "ns_name": "t3ns1", "route": [{"if": "p1", "ip": "10.2.21.1/24", "ns_if": "t3if", "ns_name": "t3"}], "tenant_ns": [{"tenant_ns_if": "t3ns1if", "tenant_ns_ip": "10.2.21.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s1if", "tenant_sub_ip": "10.2.21.2/24"}], "vxlan": [{"dev": "t3s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.21.2", "remote_ip": "10.1.21.2", "remote_route": "10.1.21.0/24", "subnet_route": "10.2.21.0/24", "tenant_route_ip": "192.168.131.2", "v_name": "vxlan_t3s1"}]}, {"brif": "t3br1if1", "disk": "10G", "mem": 2, "name": "t3_VM4", "vcpu": 4, "vmif": "t3VM4if1"}]}

TASK [Start VM] *********************************************************************************************************************************************
ok: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.21.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.2.21.1', u'bridge_name': u't3br1', u'dns': [{u'dnsif': u't3s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't3s1_dnsbrif'}], u'ns_name': u't3ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.21.2/24', u'tenant_ns_ip': u'10.2.21.1/24', u'tenant_ns_if': u't3ns1if', u'tenant_sub_if': u't3s1if', u'tenant_ns_name': u't3'}], u'bridge_ip': u'1.1.1.1', u'vxlan': [{u'local_ip': u'10.2.21.2', u'dsport': 4789, u'dev': u't3s1if', u'tenant_route_ip': u'192.168.131.2', u'remote_route': u'10.1.21.0/24', u'subnet_route': u'10.2.21.0/24', u'v_name': u'vxlan_t3s1', u'id': 42, u'remote_ip': u'10.1.21.2'}]}, {u'mem': 2, u'name': u't3_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't3br1if1', u'vmif': u't3VM4if1'}]) => {"ansible_loop_var": "item", "changed": false, "item": [{"bridge_ip": "1.1.1.1", "bridge_name": "t3br1", "default_route_ip": "10.2.21.1", "dns": [{"brif": "t3s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t3s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "ns_name": "t3ns1", "route": [{"if": "p1", "ip": "10.2.21.1/24", "ns_if": "t3if", "ns_name": "t3"}], "tenant_ns": [{"tenant_ns_if": "t3ns1if", "tenant_ns_ip": "10.2.21.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s1if", "tenant_sub_ip": "10.2.21.2/24"}], "vxlan": [{"dev": "t3s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.21.2", "remote_ip": "10.1.21.2", "remote_route": "10.1.21.0/24", "subnet_route": "10.2.21.0/24", "tenant_route_ip": "192.168.131.2", "v_name": "vxlan_t3s1"}]}, {"brif": "t3br1if1", "disk": "10G", "mem": 2, "name": "t3_VM4", "vcpu": 4, "vmif": "t3VM4if1"}]}

TASK [Attach VM interface] **********************************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.21.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.2.21.1', u'bridge_name': u't3br1', u'dns': [{u'dnsif': u't3s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't3s1_dnsbrif'}], u'ns_name': u't3ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.21.2/24', u'tenant_ns_ip': u'10.2.21.1/24', u'tenant_ns_if': u't3ns1if', u'tenant_sub_if': u't3s1if', u'tenant_ns_name': u't3'}], u'bridge_ip': u'1.1.1.1', u'vxlan': [{u'local_ip': u'10.2.21.2', u'dsport': 4789, u'dev': u't3s1if', u'tenant_route_ip': u'192.168.131.2', u'remote_route': u'10.1.21.0/24', u'subnet_route': u'10.2.21.0/24', u'v_name': u'vxlan_t3s1', u'id': 42, u'remote_ip': u'10.1.21.2'}]}, {u'mem': 2, u'name': u't3_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't3br1if1', u'vmif': u't3VM4if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "virsh domiflist \"t3_VM4\" | grep -w 't3VM4if1' ; if [ $? -ne 0 ] ; then virsh attach-interface \"t3_VM4\" direct \"t3VM4if1\" --live --persistent ; fi\n", "delta": "0:00:00.270196", "end": "2019-11-17 10:25:30.434201", "item": [{"bridge_ip": "1.1.1.1", "bridge_name": "t3br1", "default_route_ip": "10.2.21.1", "dns": [{"brif": "t3s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t3s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "ns_name": "t3ns1", "route": [{"if": "p1", "ip": "10.2.21.1/24", "ns_if": "t3if", "ns_name": "t3"}], "tenant_ns": [{"tenant_ns_if": "t3ns1if", "tenant_ns_ip": "10.2.21.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s1if", "tenant_sub_ip": "10.2.21.2/24"}], "vxlan": [{"dev": "t3s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.21.2", "remote_ip": "10.1.21.2", "remote_route": "10.1.21.0/24", "subnet_route": "10.2.21.0/24", "tenant_route_ip": "192.168.131.2", "v_name": "vxlan_t3s1"}]}, {"brif": "t3br1if1", "disk": "10G", "mem": 2, "name": "t3_VM4", "vcpu": 4, "vmif": "t3VM4if1"}], "rc": 0, "start": "2019-11-17 10:25:30.164005", "stderr": "", "stderr_lines": [], "stdout": "Interface attached successfully", "stdout_lines": ["Interface attached successfully"]}

PLAY RECAP **************************************************************************************************************************************************
99.99.99.2                 : ok=6    changed=2    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0   

ok: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.21.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.2.21.1', u'bridge_name': u't3br1', u'dns': [{u'dnsif': u't3s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't3s1_dnsbrif'}], u'ns_name': u't3ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.21.2/24', u'tenant_ns_ip': u'10.2.21.1/24', u'tenant_ns_if': u't3ns1if', u'tenant_sub_if': u't3s1if', u'tenant_ns_name': u't3'}], u'bridge_ip': u'1.1.1.1', u'vxlan': [{u'local_ip': u'10.2.21.2', u'dsport': 4789, u'dev': u't3s1if', u'tenant_route_ip': u'192.168.131.2', u'remote_route': u'10.1.21.0/24', u'subnet_route': u'10.2.21.0/24', u'v_name': u'vxlan_t3s1', u'id': 42, u'remote_ip': u'10.1.21.2'}]}, {u'mem': 2, u'name': u't3_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't3br1if1', u'vmif': u't3VM4if1'}]) => {"ansible_loop_var": "item", "changed": false, "dest": "/var/lib/libvirt/images/t3_VM4.qcow2", "gid": 113, "group": "kvm", "item": [{"bridge_ip": "1.1.1.1", "bridge_name": "t3br1", "default_route_ip": "10.2.21.1", "dns": [{"brif": "t3s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t3s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "ns_name": "t3ns1", "route": [{"if": "p1", "ip": "10.2.21.1/24", "ns_if": "t3if", "ns_name": "t3"}], "tenant_ns": [{"tenant_ns_if": "t3ns1if", "tenant_ns_ip": "10.2.21.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s1if", "tenant_sub_ip": "10.2.21.2/24"}], "vxlan": [{"dev": "t3s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.21.2", "remote_ip": "10.1.21.2", "remote_route": "10.1.21.0/24", "subnet_route": "10.2.21.0/24", "tenant_route_ip": "192.168.131.2", "v_name": "vxlan_t3s1"}]}, {"brif": "t3br1if1", "disk": "10G", "mem": 2, "name": "t3_VM4", "vcpu": 4, "vmif": "t3VM4if1"}], "mode": "0644", "msg": "file already exists", "owner": "libvirt-qemu", "size": 10739318784, "src": "/root/mainVM.qcow2", "state": "file", "uid": 64055}

TASK [Get list of running VMs] ******************************************************************************************************************************
ok: [99.99.99.2] => {"changed": false, "cmd": ["virsh", "list", "--name"], "delta": "0:00:00.017142", "end": "2019-11-17 10:25:35.547705", "rc": 0, "start": "2019-11-17 10:25:35.530563", "stderr": "", "stderr_lines": [], "stdout": "t1_VM4\nt2_VM4\nt3_VM4", "stdout_lines": ["t1_VM4", "t2_VM4", "t3_VM4"]}

TASK [Define VM] ********************************************************************************************************************************************
skipping: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.21.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.2.21.1', u'bridge_name': u't3br1', u'dns': [{u'dnsif': u't3s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't3s1_dnsbrif'}], u'ns_name': u't3ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.21.2/24', u'tenant_ns_ip': u'10.2.21.1/24', u'tenant_ns_if': u't3ns1if', u'tenant_sub_if': u't3s1if', u'tenant_ns_name': u't3'}], u'bridge_ip': u'1.1.1.1', u'vxlan': [{u'local_ip': u'10.2.21.2', u'dsport': 4789, u'dev': u't3s1if', u'tenant_route_ip': u'192.168.131.2', u'remote_route': u'10.1.21.0/24', u'subnet_route': u'10.2.21.0/24', u'v_name': u'vxlan_t3s1', u'id': 42, u'remote_ip': u'10.1.21.2'}]}, {u'mem': 2, u'name': u't3_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't3br1if1', u'vmif': u't3VM4if1'}])  => {"ansible_loop_var": "item", "changed": false, "item": [{"bridge_ip": "1.1.1.1", "bridge_name": "t3br1", "default_route_ip": "10.2.21.1", "dns": [{"brif": "t3s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t3s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "ns_name": "t3ns1", "route": [{"if": "p1", "ip": "10.2.21.1/24", "ns_if": "t3if", "ns_name": "t3"}], "tenant_ns": [{"tenant_ns_if": "t3ns1if", "tenant_ns_ip": "10.2.21.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s1if", "tenant_sub_ip": "10.2.21.2/24"}], "vxlan": [{"dev": "t3s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.21.2", "remote_ip": "10.1.21.2", "remote_route": "10.1.21.0/24", "subnet_route": "10.2.21.0/24", "tenant_route_ip": "192.168.131.2", "v_name": "vxlan_t3s1"}]}, {"brif": "t3br1if1", "disk": "10G", "mem": 2, "name": "t3_VM4", "vcpu": 4, "vmif": "t3VM4if1"}], "skip_reason": "Conditional result was False"}

TASK [Create VM] ********************************************************************************************************************************************
skipping: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.21.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.2.21.1', u'bridge_name': u't3br1', u'dns': [{u'dnsif': u't3s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't3s1_dnsbrif'}], u'ns_name': u't3ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.21.2/24', u'tenant_ns_ip': u'10.2.21.1/24', u'tenant_ns_if': u't3ns1if', u'tenant_sub_if': u't3s1if', u'tenant_ns_name': u't3'}], u'bridge_ip': u'1.1.1.1', u'vxlan': [{u'local_ip': u'10.2.21.2', u'dsport': 4789, u'dev': u't3s1if', u'tenant_route_ip': u'192.168.131.2', u'remote_route': u'10.1.21.0/24', u'subnet_route': u'10.2.21.0/24', u'v_name': u'vxlan_t3s1', u'id': 42, u'remote_ip': u'10.1.21.2'}]}, {u'mem': 2, u'name': u't3_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't3br1if1', u'vmif': u't3VM4if1'}])  => {"ansible_loop_var": "item", "changed": false, "item": [{"bridge_ip": "1.1.1.1", "bridge_name": "t3br1", "default_route_ip": "10.2.21.1", "dns": [{"brif": "t3s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t3s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "ns_name": "t3ns1", "route": [{"if": "p1", "ip": "10.2.21.1/24", "ns_if": "t3if", "ns_name": "t3"}], "tenant_ns": [{"tenant_ns_if": "t3ns1if", "tenant_ns_ip": "10.2.21.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s1if", "tenant_sub_ip": "10.2.21.2/24"}], "vxlan": [{"dev": "t3s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.21.2", "remote_ip": "10.1.21.2", "remote_route": "10.1.21.0/24", "subnet_route": "10.2.21.0/24", "tenant_route_ip": "192.168.131.2", "v_name": "vxlan_t3s1"}]}, {"brif": "t3br1if1", "disk": "10G", "mem": 2, "name": "t3_VM4", "vcpu": 4, "vmif": "t3VM4if1"}], "skip_reason": "Conditional result was False"}

TASK [Start VM] *********************************************************************************************************************************************
skipping: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.21.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.2.21.1', u'bridge_name': u't3br1', u'dns': [{u'dnsif': u't3s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't3s1_dnsbrif'}], u'ns_name': u't3ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.21.2/24', u'tenant_ns_ip': u'10.2.21.1/24', u'tenant_ns_if': u't3ns1if', u'tenant_sub_if': u't3s1if', u'tenant_ns_name': u't3'}], u'bridge_ip': u'1.1.1.1', u'vxlan': [{u'local_ip': u'10.2.21.2', u'dsport': 4789, u'dev': u't3s1if', u'tenant_route_ip': u'192.168.131.2', u'remote_route': u'10.1.21.0/24', u'subnet_route': u'10.2.21.0/24', u'v_name': u'vxlan_t3s1', u'id': 42, u'remote_ip': u'10.1.21.2'}]}, {u'mem': 2, u'name': u't3_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't3br1if1', u'vmif': u't3VM4if1'}])  => {"ansible_loop_var": "item", "changed": false, "item": [{"bridge_ip": "1.1.1.1", "bridge_name": "t3br1", "default_route_ip": "10.2.21.1", "dns": [{"brif": "t3s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t3s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "ns_name": "t3ns1", "route": [{"if": "p1", "ip": "10.2.21.1/24", "ns_if": "t3if", "ns_name": "t3"}], "tenant_ns": [{"tenant_ns_if": "t3ns1if", "tenant_ns_ip": "10.2.21.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s1if", "tenant_sub_ip": "10.2.21.2/24"}], "vxlan": [{"dev": "t3s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.21.2", "remote_ip": "10.1.21.2", "remote_route": "10.1.21.0/24", "subnet_route": "10.2.21.0/24", "tenant_route_ip": "192.168.131.2", "v_name": "vxlan_t3s1"}]}, {"brif": "t3br1if1", "disk": "10G", "mem": 2, "name": "t3_VM4", "vcpu": 4, "vmif": "t3VM4if1"}], "skip_reason": "Conditional result was False"}

TASK [Attach VM interface] **********************************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.21.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.2.21.1', u'bridge_name': u't3br1', u'dns': [{u'dnsif': u't3s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't3s1_dnsbrif'}], u'ns_name': u't3ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.21.2/24', u'tenant_ns_ip': u'10.2.21.1/24', u'tenant_ns_if': u't3ns1if', u'tenant_sub_if': u't3s1if', u'tenant_ns_name': u't3'}], u'bridge_ip': u'1.1.1.1', u'vxlan': [{u'local_ip': u'10.2.21.2', u'dsport': 4789, u'dev': u't3s1if', u'tenant_route_ip': u'192.168.131.2', u'remote_route': u'10.1.21.0/24', u'subnet_route': u'10.2.21.0/24', u'v_name': u'vxlan_t3s1', u'id': 42, u'remote_ip': u'10.1.21.2'}]}, {u'mem': 2, u'name': u't3_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't3br1if1', u'vmif': u't3VM4if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "virsh domiflist \"t3_VM4\" | grep -w 't3VM4if1' ; if [ $? -ne 0 ] ; then virsh attach-interface \"t3_VM4\" direct \"t3VM4if1\" --live --persistent ; fi\n", "delta": "0:00:00.020113", "end": "2019-11-17 10:25:35.939307", "item": [{"bridge_ip": "1.1.1.1", "bridge_name": "t3br1", "default_route_ip": "10.2.21.1", "dns": [{"brif": "t3s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t3s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "ns_name": "t3ns1", "route": [{"if": "p1", "ip": "10.2.21.1/24", "ns_if": "t3if", "ns_name": "t3"}], "tenant_ns": [{"tenant_ns_if": "t3ns1if", "tenant_ns_ip": "10.2.21.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s1if", "tenant_sub_ip": "10.2.21.2/24"}], "vxlan": [{"dev": "t3s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.21.2", "remote_ip": "10.1.21.2", "remote_route": "10.1.21.0/24", "subnet_route": "10.2.21.0/24", "tenant_route_ip": "192.168.131.2", "v_name": "vxlan_t3s1"}]}, {"brif": "t3br1if1", "disk": "10G", "mem": 2, "name": "t3_VM4", "vcpu": 4, "vmif": "t3VM4if1"}], "rc": 0, "start": "2019-11-17 10:25:35.919194", "stderr": "", "stderr_lines": [], "stdout": "macvtap2   direct     t3VM4if1   rtl8139     52:54:00:cf:6c:38", "stdout_lines": ["macvtap2   direct     t3VM4if1   rtl8139     52:54:00:cf:6c:38"]}

PLAY RECAP **************************************************************************************************************************************************
99.99.99.2                 : ok=3    changed=1    unreachable=0    failed=0    skipped=3    rescued=0    ignored=0   

INFO:root: 10:28:36.894349 Unable to open user input yaml file
Using /etc/ansible/ansible.cfg as config file
Using /etc/ansible/ansible.cfg as config file
Using /etc/ansible/ansible.cfg as config file
Using /etc/ansible/ansible.cfg as config file
Using /etc/ansible/ansible.cfg as config file
Using /etc/ansible/ansible.cfg as config file
Using /etc/ansible/ansible.cfg as config file
Using /etc/ansible/ansible.cfg as config file
Using /etc/ansible/ansible.cfg as config file
Using /etc/ansible/ansible.cfg as config file
Using /etc/ansible/ansible.cfg as config file
Using /etc/ansible/ansible.cfg as config file
Using /etc/ansible/ansible.cfg as config file
Using /etc/ansible/ansible.cfg as config file
Using /etc/ansible/ansible.cfg as config file
Using /etc/ansible/ansible.cfg as config file
INFO:root: 10:28:47.316328 Unable to open user input yaml file
Using /etc/ansible/ansible.cfg as config file
Using /etc/ansible/ansible.cfg as config file
Using /etc/ansible/ansible.cfg as config file
Using /etc/ansible/ansible.cfg as config file
Using /etc/ansible/ansible.cfg as config file
Using /etc/ansible/ansible.cfg as config file
Using /etc/ansible/ansible.cfg as config file
Using /etc/ansible/ansible.cfg as config file
Using /etc/ansible/ansible.cfg as config file
Using /etc/ansible/ansible.cfg as config file
Using /etc/ansible/ansible.cfg as config file
Using /etc/ansible/ansible.cfg as config file
Using /etc/ansible/ansible.cfg as config file
Using /etc/ansible/ansible.cfg as config file
Using /etc/ansible/ansible.cfg as config file
Using /etc/ansible/ansible.cfg as config file
INFO:root: 10:28:58.639368 Printing the yaml input file
INFO:root: 10:28:58.639533 {'C1': [{'subnet_addr': '1.1.1.0/24', 'VM': [{'name': 'VM1', 'disk': '10G', 'mem': 2, 'vcpu': 4}, {'name': 'VM2', 'disk': '10G', 'mem': 4, 'vcpu': 2}]}, {'subnet_addr': '2.2.2.0/24', 'VM': [{'name': 'VM3', 'disk': '10G', 'mem': 3, 'vcpu': 2}]}], 'C2': [{'subnet_addr': '1.1.1.0/24', 'VM': [{'name': 'VM4', 'disk': '10G', 'mem': 2, 'vcpu': 4}, {'name': 'VM5', 'disk': '10G', 'mem': 2, 'vcpu': 4}]}]}
INFO:root: 10:28:58.639646 Provided subnet in C1: 1.1.1.0/24 is valid
ERROR:root: 10:28:58.639684Multiple subnet in the C1 are same
Using /etc/ansible/ansible.cfg as config file

PLAY [main] *************************************************************************************************************************************************

TASK [Create Tenant Namespace] ******************************************************************************************************************************
ok: [localhost] => (item={u'default_route_ip': u'192.168.3.1', u'name': u't3', u'pns_ip': u'192.168.3.1/24', u'tenant_if': u't3if', u'tenant_ip': u'192.168.3.2/24', u'pns_if': u't3pns_if'}) => {"ansible_loop_var": "item", "changed": false, "cmd": ["ip", "netns", "add", "t3"], "item": {"default_route_ip": "192.168.3.1", "name": "t3", "pns_if": "t3pns_if", "pns_ip": "192.168.3.1/24", "tenant_if": "t3if", "tenant_ip": "192.168.3.2/24"}, "rc": 0, "stdout": "skipped, since /var/run/netns/t3 exists", "stdout_lines": ["skipped, since /var/run/netns/t3 exists"]}

TASK [Create Subnet Namespace] ******************************************************************************************************************************
ok: [localhost] => (item={u'route': [{u'ip': u'10.1.21.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.1.21.1', u'bridge_name': u't3br1', u'dns': [{u'dnsif': u't3s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't3s1_dnsbrif'}], u'ns_name': u't3ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.21.2/24', u'tenant_ns_ip': u'10.1.21.1/24', u'tenant_ns_if': u't3ns1if', u'tenant_ns_name': u't3', u'tenant_sub_if': u't3s1if'}], u'bridge_ip': u'1.1.1.1', u'vms': [{u'mem': 2, u'name': u't3_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't3br1if1', u'vmif': u't3VM1if1'}, {u'mem': 4, u'name': u't3_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't3br1if2', u'vmif': u't3VM2if1'}], u'vxlan': [{u'local_ip': u'10.1.21.2', u'tenant_route_ip': u'192.168.3.2', u'dsport': 4789, u'dev': u't3s1if', u'subnet_route': u'10.1.21.0/24', u'remote_route': u'10.2.21.0/24', u'v_name': u'vxlan_t3s1', u'id': 42, u'remote_ip': u'10.2.21.2'}]}) => {"ansible_loop_var": "item", "changed": false, "cmd": ["ip", "netns", "add", "t3ns1"], "item": {"bridge_ip": "1.1.1.1", "bridge_name": "t3br1", "default_route_ip": "10.1.21.1", "dns": [{"brif": "t3s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t3s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t3ns1", "route": [{"if": "p1", "ip": "10.1.21.1/24", "ns_if": "t3if", "ns_name": "t3"}], "tenant_ns": [{"tenant_ns_if": "t3ns1if", "tenant_ns_ip": "10.1.21.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s1if", "tenant_sub_ip": "10.1.21.2/24"}], "vms": [{"brif": "t3br1if1", "disk": "10G", "mem": 2, "name": "t3_VM1", "vcpu": 4, "vmif": "t3VM1if1"}, {"brif": "t3br1if2", "disk": "10G", "mem": 4, "name": "t3_VM2", "vcpu": 2, "vmif": "t3VM2if1"}], "vxlan": [{"dev": "t3s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.21.2", "remote_ip": "10.2.21.2", "remote_route": "10.2.21.0/24", "subnet_route": "10.1.21.0/24", "tenant_route_ip": "192.168.3.2", "v_name": "vxlan_t3s1"}]}, "rc": 0, "stdout": "skipped, since /var/run/netns/t3ns1 exists", "stdout_lines": ["skipped, since /var/run/netns/t3ns1 exists"]}
ok: [localhost] => (item={u'route': [{u'ip': u'10.1.22.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.1.22.1', u'bridge_name': u't3br2', u'dns': [{u'dnsif': u't3s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't3s2_dnsbrif'}], u'ns_name': u't3ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.22.2/24', u'tenant_ns_ip': u'10.1.22.1/24', u'tenant_ns_if': u't3ns2if', u'tenant_ns_name': u't3', u'tenant_sub_if': u't3s2if'}], u'bridge_ip': u'2.2.2.1', u'vms': [{u'mem': 3, u'name': u't3_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't3br2if1', u'vmif': u't3VM3if1'}], u'vxlan': [{u'local_ip': [], u'tenant_route_ip': [], u'dsport': [], u'dev': [], u'subnet_route': [], u'remote_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}) => {"ansible_loop_var": "item", "changed": false, "cmd": ["ip", "netns", "add", "t3ns2"], "item": {"bridge_ip": "2.2.2.1", "bridge_name": "t3br2", "default_route_ip": "10.1.22.1", "dns": [{"brif": "t3s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t3s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t3ns2", "route": [{"if": "p1", "ip": "10.1.22.1/24", "ns_if": "t3if", "ns_name": "t3"}], "tenant_ns": [{"tenant_ns_if": "t3ns2if", "tenant_ns_ip": "10.1.22.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s2if", "tenant_sub_ip": "10.1.22.2/24"}], "vms": [{"brif": "t3br2if1", "disk": "10G", "mem": 3, "name": "t3_VM3", "vcpu": 2, "vmif": "t3VM3if1"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, "rc": 0, "stdout": "skipped, since /var/run/netns/t3ns2 exists", "stdout_lines": ["skipped, since /var/run/netns/t3ns2 exists"]}

TASK [Create Tenant VETH pairs] *****************************************************************************************************************************
changed: [localhost] => (item={u'default_route_ip': u'192.168.3.1', u'name': u't3', u'pns_ip': u'192.168.3.1/24', u'tenant_if': u't3if', u'tenant_ip': u'192.168.3.2/24', u'pns_if': u't3pns_if'}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip link show \"t3if\" ; if [ $? -ne 0 ] ; then ip link add \"t3if\" type veth peer name \"t3pns_if\" ; fi\n", "delta": "0:00:00.011100", "end": "2019-11-17 10:29:00.500380", "item": {"default_route_ip": "192.168.3.1", "name": "t3", "pns_if": "t3pns_if", "pns_ip": "192.168.3.1/24", "tenant_if": "t3if", "tenant_ip": "192.168.3.2/24"}, "rc": 0, "start": "2019-11-17 10:29:00.489280", "stderr": "Device \"t3if\" does not exist.", "stderr_lines": ["Device \"t3if\" does not exist."], "stdout": "", "stdout_lines": []}

TASK [Attach Tenant VETH Pairs] *****************************************************************************************************************************
changed: [localhost] => (item={u'default_route_ip': u'192.168.3.1', u'name': u't3', u'pns_ip': u'192.168.3.1/24', u'tenant_if': u't3if', u'tenant_ip': u'192.168.3.2/24', u'pns_if': u't3pns_if'}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec pns ip link show \"t3pns_if\" ; if [ $? -ne 0 ] ; then ip link set \"t3pns_if\" netns pns ; fi\nip netns exec \"t3\" ip link show \"t3if\" ; if [ $? -ne 0 ] ; then ip link set \"t3if\" netns \"t3\" ; fi\nip netns exec pns ip link set dev \"t3pns_if\" up\nip netns exec \"t3\" ip link set dev \"t3if\" up\n", "delta": "0:00:00.150070", "end": "2019-11-17 10:29:00.931690", "item": {"default_route_ip": "192.168.3.1", "name": "t3", "pns_if": "t3pns_if", "pns_ip": "192.168.3.1/24", "tenant_if": "t3if", "tenant_ip": "192.168.3.2/24"}, "rc": 0, "start": "2019-11-17 10:29:00.781620", "stderr": "", "stderr_lines": [], "stdout": "72: t3pns_if@if73: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP mode DEFAULT group default qlen 1000\n    link/ether 06:4a:f1:28:9b:b0 brd ff:ff:ff:ff:ff:ff link-netnsid 3\n73: t3if@if72: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP mode DEFAULT group default qlen 1000\n    link/ether 8a:e5:80:30:d5:6d brd ff:ff:ff:ff:ff:ff link-netnsid 0", "stdout_lines": ["72: t3pns_if@if73: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP mode DEFAULT group default qlen 1000", "    link/ether 06:4a:f1:28:9b:b0 brd ff:ff:ff:ff:ff:ff link-netnsid 3", "73: t3if@if72: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP mode DEFAULT group default qlen 1000", "    link/ether 8a:e5:80:30:d5:6d brd ff:ff:ff:ff:ff:ff link-netnsid 0"]}

TASK [Add IP addresses to Tenant VETH Pairs] ****************************************************************************************************************
changed: [localhost] => (item={u'default_route_ip': u'192.168.3.1', u'name': u't3', u'pns_ip': u'192.168.3.1/24', u'tenant_if': u't3if', u'tenant_ip': u'192.168.3.2/24', u'pns_if': u't3pns_if'}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec pns ip addr show \"t3pns_if\" | awk 'FNR==3{ print $2 }' | grep -w '^192.168.3.1/24' ; if [ $? -ne 0 ] ; then ip netns exec pns ip addr add \"192.168.3.1/24\" dev \"t3pns_if\" ; fi\nip netns exec \"t3\" ip addr show \"t3if\" | awk 'FNR==3{ print $2 }' | grep -w '^192.168.3.2/24' ; if [ $? -ne 0 ] ; then ip netns exec \"t3\" ip addr add \"192.168.3.2/24\" dev \"t3if\" ; fi\n", "delta": "0:00:00.076337", "end": "2019-11-17 10:29:01.304003", "item": {"default_route_ip": "192.168.3.1", "name": "t3", "pns_if": "t3pns_if", "pns_ip": "192.168.3.1/24", "tenant_if": "t3if", "tenant_ip": "192.168.3.2/24"}, "rc": 0, "start": "2019-11-17 10:29:01.227666", "stderr": "", "stderr_lines": [], "stdout": "192.168.3.1/24\n192.168.3.2/24", "stdout_lines": ["192.168.3.1/24", "192.168.3.2/24"]}

TASK [Create Namespace VETH Pairs] **************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.21.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.1.21.1', u'bridge_name': u't3br1', u'dns': [{u'dnsif': u't3s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't3s1_dnsbrif'}], u'ns_name': u't3ns1', u'bridge_ip': u'1.1.1.1', u'vms': [{u'mem': 2, u'name': u't3_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't3br1if1', u'vmif': u't3VM1if1'}, {u'mem': 4, u'name': u't3_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't3br1if2', u'vmif': u't3VM2if1'}], u'vxlan': [{u'local_ip': u'10.1.21.2', u'dsport': 4789, u'dev': u't3s1if', u'tenant_route_ip': u'192.168.3.2', u'remote_route': u'10.2.21.0/24', u'subnet_route': u'10.1.21.0/24', u'v_name': u'vxlan_t3s1', u'id': 42, u'remote_ip': u'10.2.21.2'}]}, {u'tenant_sub_ip': u'10.1.21.2/24', u'tenant_ns_ip': u'10.1.21.1/24', u'tenant_ns_if': u't3ns1if', u'tenant_sub_if': u't3s1if', u'tenant_ns_name': u't3'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip link show \"t3ns1if\" ; if [ $? -ne 0 ] ; then ip link add \"t3ns1if\" type veth peer name \"t3s1if\" ; fi\n", "delta": "0:00:00.016057", "end": "2019-11-17 10:29:01.615568", "item": [{"bridge_ip": "1.1.1.1", "bridge_name": "t3br1", "default_route_ip": "10.1.21.1", "dns": [{"brif": "t3s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t3s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t3ns1", "route": [{"if": "p1", "ip": "10.1.21.1/24", "ns_if": "t3if", "ns_name": "t3"}], "vms": [{"brif": "t3br1if1", "disk": "10G", "mem": 2, "name": "t3_VM1", "vcpu": 4, "vmif": "t3VM1if1"}, {"brif": "t3br1if2", "disk": "10G", "mem": 4, "name": "t3_VM2", "vcpu": 2, "vmif": "t3VM2if1"}], "vxlan": [{"dev": "t3s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.21.2", "remote_ip": "10.2.21.2", "remote_route": "10.2.21.0/24", "subnet_route": "10.1.21.0/24", "tenant_route_ip": "192.168.3.2", "v_name": "vxlan_t3s1"}]}, {"tenant_ns_if": "t3ns1if", "tenant_ns_ip": "10.1.21.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s1if", "tenant_sub_ip": "10.1.21.2/24"}], "rc": 0, "start": "2019-11-17 10:29:01.599511", "stderr": "Device \"t3ns1if\" does not exist.", "stderr_lines": ["Device \"t3ns1if\" does not exist."], "stdout": "", "stdout_lines": []}
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.22.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.1.22.1', u'bridge_name': u't3br2', u'dns': [{u'dnsif': u't3s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't3s2_dnsbrif'}], u'ns_name': u't3ns2', u'bridge_ip': u'2.2.2.1', u'vms': [{u'mem': 3, u'name': u't3_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't3br2if1', u'vmif': u't3VM3if1'}], u'vxlan': [{u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}, {u'tenant_sub_ip': u'10.1.22.2/24', u'tenant_ns_ip': u'10.1.22.1/24', u'tenant_ns_if': u't3ns2if', u'tenant_sub_if': u't3s2if', u'tenant_ns_name': u't3'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip link show \"t3ns2if\" ; if [ $? -ne 0 ] ; then ip link add \"t3ns2if\" type veth peer name \"t3s2if\" ; fi\n", "delta": "0:00:00.012716", "end": "2019-11-17 10:29:01.857883", "item": [{"bridge_ip": "2.2.2.1", "bridge_name": "t3br2", "default_route_ip": "10.1.22.1", "dns": [{"brif": "t3s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t3s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t3ns2", "route": [{"if": "p1", "ip": "10.1.22.1/24", "ns_if": "t3if", "ns_name": "t3"}], "vms": [{"brif": "t3br2if1", "disk": "10G", "mem": 3, "name": "t3_VM3", "vcpu": 2, "vmif": "t3VM3if1"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, {"tenant_ns_if": "t3ns2if", "tenant_ns_ip": "10.1.22.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s2if", "tenant_sub_ip": "10.1.22.2/24"}], "rc": 0, "start": "2019-11-17 10:29:01.845167", "stderr": "Device \"t3ns2if\" does not exist.", "stderr_lines": ["Device \"t3ns2if\" does not exist."], "stdout": "", "stdout_lines": []}

TASK [Attach Namespace VETH Pairs] **************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.21.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.1.21.1', u'bridge_name': u't3br1', u'dns': [{u'dnsif': u't3s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't3s1_dnsbrif'}], u'ns_name': u't3ns1', u'bridge_ip': u'1.1.1.1', u'vms': [{u'mem': 2, u'name': u't3_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't3br1if1', u'vmif': u't3VM1if1'}, {u'mem': 4, u'name': u't3_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't3br1if2', u'vmif': u't3VM2if1'}], u'vxlan': [{u'local_ip': u'10.1.21.2', u'dsport': 4789, u'dev': u't3s1if', u'tenant_route_ip': u'192.168.3.2', u'remote_route': u'10.2.21.0/24', u'subnet_route': u'10.1.21.0/24', u'v_name': u'vxlan_t3s1', u'id': 42, u'remote_ip': u'10.2.21.2'}]}, {u'tenant_sub_ip': u'10.1.21.2/24', u'tenant_ns_ip': u'10.1.21.1/24', u'tenant_ns_if': u't3ns1if', u'tenant_sub_if': u't3s1if', u'tenant_ns_name': u't3'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t3\" ip link show \"t3ns1if\" ; if [ $? -ne 0 ] ; then ip link set \"t3ns1if\" netns \"t3\" ; fi\nip netns exec \"t3ns1\" ip link show \"t3s1if\" ; if [ $? -ne 0 ] ; then ip link set \"t3s1if\" netns \"t3ns1\" ; fi\n", "delta": "0:00:00.082811", "end": "2019-11-17 10:29:02.211552", "item": [{"bridge_ip": "1.1.1.1", "bridge_name": "t3br1", "default_route_ip": "10.1.21.1", "dns": [{"brif": "t3s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t3s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t3ns1", "route": [{"if": "p1", "ip": "10.1.21.1/24", "ns_if": "t3if", "ns_name": "t3"}], "vms": [{"brif": "t3br1if1", "disk": "10G", "mem": 2, "name": "t3_VM1", "vcpu": 4, "vmif": "t3VM1if1"}, {"brif": "t3br1if2", "disk": "10G", "mem": 4, "name": "t3_VM2", "vcpu": 2, "vmif": "t3VM2if1"}], "vxlan": [{"dev": "t3s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.21.2", "remote_ip": "10.2.21.2", "remote_route": "10.2.21.0/24", "subnet_route": "10.1.21.0/24", "tenant_route_ip": "192.168.3.2", "v_name": "vxlan_t3s1"}]}, {"tenant_ns_if": "t3ns1if", "tenant_ns_ip": "10.1.21.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s1if", "tenant_sub_ip": "10.1.21.2/24"}], "rc": 0, "start": "2019-11-17 10:29:02.128741", "stderr": "", "stderr_lines": [], "stdout": "75: t3ns1if@if74: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP mode DEFAULT group default qlen 1000\n    link/ether 8e:ee:8e:d4:11:ea brd ff:ff:ff:ff:ff:ff link-netnsid 2\n74: t3s1if@if75: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP mode DEFAULT group default qlen 1000\n    link/ether 6a:c8:67:6e:da:7a brd ff:ff:ff:ff:ff:ff link-netnsid 0", "stdout_lines": ["75: t3ns1if@if74: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP mode DEFAULT group default qlen 1000", "    link/ether 8e:ee:8e:d4:11:ea brd ff:ff:ff:ff:ff:ff link-netnsid 2", "74: t3s1if@if75: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP mode DEFAULT group default qlen 1000", "    link/ether 6a:c8:67:6e:da:7a brd ff:ff:ff:ff:ff:ff link-netnsid 0"]}
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.22.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.1.22.1', u'bridge_name': u't3br2', u'dns': [{u'dnsif': u't3s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't3s2_dnsbrif'}], u'ns_name': u't3ns2', u'bridge_ip': u'2.2.2.1', u'vms': [{u'mem': 3, u'name': u't3_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't3br2if1', u'vmif': u't3VM3if1'}], u'vxlan': [{u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}, {u'tenant_sub_ip': u'10.1.22.2/24', u'tenant_ns_ip': u'10.1.22.1/24', u'tenant_ns_if': u't3ns2if', u'tenant_sub_if': u't3s2if', u'tenant_ns_name': u't3'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t3\" ip link show \"t3ns2if\" ; if [ $? -ne 0 ] ; then ip link set \"t3ns2if\" netns \"t3\" ; fi\nip netns exec \"t3ns2\" ip link show \"t3s2if\" ; if [ $? -ne 0 ] ; then ip link set \"t3s2if\" netns \"t3ns2\" ; fi\n", "delta": "0:00:00.072480", "end": "2019-11-17 10:29:02.487738", "item": [{"bridge_ip": "2.2.2.1", "bridge_name": "t3br2", "default_route_ip": "10.1.22.1", "dns": [{"brif": "t3s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t3s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t3ns2", "route": [{"if": "p1", "ip": "10.1.22.1/24", "ns_if": "t3if", "ns_name": "t3"}], "vms": [{"brif": "t3br2if1", "disk": "10G", "mem": 3, "name": "t3_VM3", "vcpu": 2, "vmif": "t3VM3if1"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, {"tenant_ns_if": "t3ns2if", "tenant_ns_ip": "10.1.22.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s2if", "tenant_sub_ip": "10.1.22.2/24"}], "rc": 0, "start": "2019-11-17 10:29:02.415258", "stderr": "", "stderr_lines": [], "stdout": "77: t3ns2if@if76: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP mode DEFAULT group default qlen 1000\n    link/ether 6e:56:8a:9b:30:96 brd ff:ff:ff:ff:ff:ff link-netnsid 3\n76: t3s2if@if77: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP mode DEFAULT group default qlen 1000\n    link/ether 46:53:d1:fa:8c:e5 brd ff:ff:ff:ff:ff:ff link-netnsid 0", "stdout_lines": ["77: t3ns2if@if76: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP mode DEFAULT group default qlen 1000", "    link/ether 6e:56:8a:9b:30:96 brd ff:ff:ff:ff:ff:ff link-netnsid 3", "76: t3s2if@if77: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP mode DEFAULT group default qlen 1000", "    link/ether 46:53:d1:fa:8c:e5 brd ff:ff:ff:ff:ff:ff link-netnsid 0"]}

TASK [Set Namespace VETH Pairs UP] **************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.21.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.1.21.1', u'bridge_name': u't3br1', u'dns': [{u'dnsif': u't3s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't3s1_dnsbrif'}], u'ns_name': u't3ns1', u'bridge_ip': u'1.1.1.1', u'vms': [{u'mem': 2, u'name': u't3_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't3br1if1', u'vmif': u't3VM1if1'}, {u'mem': 4, u'name': u't3_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't3br1if2', u'vmif': u't3VM2if1'}], u'vxlan': [{u'local_ip': u'10.1.21.2', u'dsport': 4789, u'dev': u't3s1if', u'tenant_route_ip': u'192.168.3.2', u'remote_route': u'10.2.21.0/24', u'subnet_route': u'10.1.21.0/24', u'v_name': u'vxlan_t3s1', u'id': 42, u'remote_ip': u'10.2.21.2'}]}, {u'tenant_sub_ip': u'10.1.21.2/24', u'tenant_ns_ip': u'10.1.21.1/24', u'tenant_ns_if': u't3ns1if', u'tenant_sub_if': u't3s1if', u'tenant_ns_name': u't3'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t3\" ip link set dev \"t3ns1if\" up\nip netns exec \"t3ns1\" ip link set dev \"t3s1if\" up\n", "delta": "0:00:00.068760", "end": "2019-11-17 10:29:02.811557", "item": [{"bridge_ip": "1.1.1.1", "bridge_name": "t3br1", "default_route_ip": "10.1.21.1", "dns": [{"brif": "t3s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t3s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t3ns1", "route": [{"if": "p1", "ip": "10.1.21.1/24", "ns_if": "t3if", "ns_name": "t3"}], "vms": [{"brif": "t3br1if1", "disk": "10G", "mem": 2, "name": "t3_VM1", "vcpu": 4, "vmif": "t3VM1if1"}, {"brif": "t3br1if2", "disk": "10G", "mem": 4, "name": "t3_VM2", "vcpu": 2, "vmif": "t3VM2if1"}], "vxlan": [{"dev": "t3s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.21.2", "remote_ip": "10.2.21.2", "remote_route": "10.2.21.0/24", "subnet_route": "10.1.21.0/24", "tenant_route_ip": "192.168.3.2", "v_name": "vxlan_t3s1"}]}, {"tenant_ns_if": "t3ns1if", "tenant_ns_ip": "10.1.21.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s1if", "tenant_sub_ip": "10.1.21.2/24"}], "rc": 0, "start": "2019-11-17 10:29:02.742797", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.22.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.1.22.1', u'bridge_name': u't3br2', u'dns': [{u'dnsif': u't3s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't3s2_dnsbrif'}], u'ns_name': u't3ns2', u'bridge_ip': u'2.2.2.1', u'vms': [{u'mem': 3, u'name': u't3_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't3br2if1', u'vmif': u't3VM3if1'}], u'vxlan': [{u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}, {u'tenant_sub_ip': u'10.1.22.2/24', u'tenant_ns_ip': u'10.1.22.1/24', u'tenant_ns_if': u't3ns2if', u'tenant_sub_if': u't3s2if', u'tenant_ns_name': u't3'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t3\" ip link set dev \"t3ns2if\" up\nip netns exec \"t3ns2\" ip link set dev \"t3s2if\" up\n", "delta": "0:00:00.074463", "end": "2019-11-17 10:29:03.091758", "item": [{"bridge_ip": "2.2.2.1", "bridge_name": "t3br2", "default_route_ip": "10.1.22.1", "dns": [{"brif": "t3s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t3s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t3ns2", "route": [{"if": "p1", "ip": "10.1.22.1/24", "ns_if": "t3if", "ns_name": "t3"}], "vms": [{"brif": "t3br2if1", "disk": "10G", "mem": 3, "name": "t3_VM3", "vcpu": 2, "vmif": "t3VM3if1"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, {"tenant_ns_if": "t3ns2if", "tenant_ns_ip": "10.1.22.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s2if", "tenant_sub_ip": "10.1.22.2/24"}], "rc": 0, "start": "2019-11-17 10:29:03.017295", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Add IP addresses to Namespace VETH Pairs] *************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.21.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.1.21.1', u'bridge_name': u't3br1', u'dns': [{u'dnsif': u't3s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't3s1_dnsbrif'}], u'ns_name': u't3ns1', u'bridge_ip': u'1.1.1.1', u'vms': [{u'mem': 2, u'name': u't3_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't3br1if1', u'vmif': u't3VM1if1'}, {u'mem': 4, u'name': u't3_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't3br1if2', u'vmif': u't3VM2if1'}], u'vxlan': [{u'local_ip': u'10.1.21.2', u'dsport': 4789, u'dev': u't3s1if', u'tenant_route_ip': u'192.168.3.2', u'remote_route': u'10.2.21.0/24', u'subnet_route': u'10.1.21.0/24', u'v_name': u'vxlan_t3s1', u'id': 42, u'remote_ip': u'10.2.21.2'}]}, {u'tenant_sub_ip': u'10.1.21.2/24', u'tenant_ns_ip': u'10.1.21.1/24', u'tenant_ns_if': u't3ns1if', u'tenant_sub_if': u't3s1if', u'tenant_ns_name': u't3'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t3ns1\" ip addr show \"t3s1if\" | awk 'FNR==3{ print $2 }' | grep -w '^10.1.21.2/24' ; if [ $? -ne 0 ] ; then ip netns exec \"t3ns1\" ip addr add \"10.1.21.2/24\" dev \"t3s1if\" ; fi\n\nip netns exec \"t3\" ip addr show \"t3ns1if\" | awk 'FNR==3{ print $2 }' | grep -w '^10.1.21.1/24' ; if [ $? -ne 0 ] ; then ip netns exec \"t3\" ip addr add \"10.1.21.1/24\" dev \"t3ns1if\" ; fi\n", "delta": "0:00:00.075120", "end": "2019-11-17 10:29:03.459964", "item": [{"bridge_ip": "1.1.1.1", "bridge_name": "t3br1", "default_route_ip": "10.1.21.1", "dns": [{"brif": "t3s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t3s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t3ns1", "route": [{"if": "p1", "ip": "10.1.21.1/24", "ns_if": "t3if", "ns_name": "t3"}], "vms": [{"brif": "t3br1if1", "disk": "10G", "mem": 2, "name": "t3_VM1", "vcpu": 4, "vmif": "t3VM1if1"}, {"brif": "t3br1if2", "disk": "10G", "mem": 4, "name": "t3_VM2", "vcpu": 2, "vmif": "t3VM2if1"}], "vxlan": [{"dev": "t3s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.21.2", "remote_ip": "10.2.21.2", "remote_route": "10.2.21.0/24", "subnet_route": "10.1.21.0/24", "tenant_route_ip": "192.168.3.2", "v_name": "vxlan_t3s1"}]}, {"tenant_ns_if": "t3ns1if", "tenant_ns_ip": "10.1.21.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s1if", "tenant_sub_ip": "10.1.21.2/24"}], "rc": 0, "start": "2019-11-17 10:29:03.384844", "stderr": "", "stderr_lines": [], "stdout": "10.1.21.2/24\n10.1.21.1/24", "stdout_lines": ["10.1.21.2/24", "10.1.21.1/24"]}
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.22.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.1.22.1', u'bridge_name': u't3br2', u'dns': [{u'dnsif': u't3s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't3s2_dnsbrif'}], u'ns_name': u't3ns2', u'bridge_ip': u'2.2.2.1', u'vms': [{u'mem': 3, u'name': u't3_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't3br2if1', u'vmif': u't3VM3if1'}], u'vxlan': [{u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}, {u'tenant_sub_ip': u'10.1.22.2/24', u'tenant_ns_ip': u'10.1.22.1/24', u'tenant_ns_if': u't3ns2if', u'tenant_sub_if': u't3s2if', u'tenant_ns_name': u't3'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t3ns2\" ip addr show \"t3s2if\" | awk 'FNR==3{ print $2 }' | grep -w '^10.1.22.2/24' ; if [ $? -ne 0 ] ; then ip netns exec \"t3ns2\" ip addr add \"10.1.22.2/24\" dev \"t3s2if\" ; fi\n\nip netns exec \"t3\" ip addr show \"t3ns2if\" | awk 'FNR==3{ print $2 }' | grep -w '^10.1.22.1/24' ; if [ $? -ne 0 ] ; then ip netns exec \"t3\" ip addr add \"10.1.22.1/24\" dev \"t3ns2if\" ; fi\n", "delta": "0:00:00.072383", "end": "2019-11-17 10:29:03.756120", "item": [{"bridge_ip": "2.2.2.1", "bridge_name": "t3br2", "default_route_ip": "10.1.22.1", "dns": [{"brif": "t3s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t3s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t3ns2", "route": [{"if": "p1", "ip": "10.1.22.1/24", "ns_if": "t3if", "ns_name": "t3"}], "vms": [{"brif": "t3br2if1", "disk": "10G", "mem": 3, "name": "t3_VM3", "vcpu": 2, "vmif": "t3VM3if1"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, {"tenant_ns_if": "t3ns2if", "tenant_ns_ip": "10.1.22.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s2if", "tenant_sub_ip": "10.1.22.2/24"}], "rc": 0, "start": "2019-11-17 10:29:03.683737", "stderr": "", "stderr_lines": [], "stdout": "10.1.22.2/24\n10.1.22.1/24", "stdout_lines": ["10.1.22.2/24", "10.1.22.1/24"]}

TASK [Add IP Route to Tenant] *******************************************************************************************************************************
changed: [localhost] => (item={u'default_route_ip': u'192.168.3.1', u'name': u't3', u'pns_ip': u'192.168.3.1/24', u'tenant_if': u't3if', u'tenant_ip': u'192.168.3.2/24', u'pns_if': u't3pns_if'}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t3\" ip route show default | grep -w '[d]efault via 192.168.3.1' ; if [ $? -ne 0 ] ; then ip netns exec \"t3\" ip route add default via \"192.168.3.1\" ; fi\n", "delta": "0:00:00.037741", "end": "2019-11-17 10:29:04.084038", "item": {"default_route_ip": "192.168.3.1", "name": "t3", "pns_if": "t3pns_if", "pns_ip": "192.168.3.1/24", "tenant_if": "t3if", "tenant_ip": "192.168.3.2/24"}, "rc": 0, "start": "2019-11-17 10:29:04.046297", "stderr": "", "stderr_lines": [], "stdout": "default via 192.168.3.1 dev t3if ", "stdout_lines": ["default via 192.168.3.1 dev t3if "]}

TASK [Add IP Route to Tenant Subnet] ************************************************************************************************************************
changed: [localhost] => (item={u'route': [{u'ip': u'10.1.21.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.1.21.1', u'bridge_name': u't3br1', u'dns': [{u'dnsif': u't3s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't3s1_dnsbrif'}], u'ns_name': u't3ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.21.2/24', u'tenant_ns_ip': u'10.1.21.1/24', u'tenant_ns_if': u't3ns1if', u'tenant_ns_name': u't3', u'tenant_sub_if': u't3s1if'}], u'bridge_ip': u'1.1.1.1', u'vms': [{u'mem': 2, u'name': u't3_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't3br1if1', u'vmif': u't3VM1if1'}, {u'mem': 4, u'name': u't3_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't3br1if2', u'vmif': u't3VM2if1'}], u'vxlan': [{u'local_ip': u'10.1.21.2', u'tenant_route_ip': u'192.168.3.2', u'dsport': 4789, u'dev': u't3s1if', u'subnet_route': u'10.1.21.0/24', u'remote_route': u'10.2.21.0/24', u'v_name': u'vxlan_t3s1', u'id': 42, u'remote_ip': u'10.2.21.2'}]}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t3ns1\" ip route show default | grep -w '[d]efault via 10.1.21.1' ; if [ $? -ne 0 ] ; then ip netns exec \"t3ns1\" ip route add default via \"10.1.21.1\" ; fi\n", "delta": "0:00:00.042621", "end": "2019-11-17 10:29:04.419673", "item": {"bridge_ip": "1.1.1.1", "bridge_name": "t3br1", "default_route_ip": "10.1.21.1", "dns": [{"brif": "t3s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t3s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t3ns1", "route": [{"if": "p1", "ip": "10.1.21.1/24", "ns_if": "t3if", "ns_name": "t3"}], "tenant_ns": [{"tenant_ns_if": "t3ns1if", "tenant_ns_ip": "10.1.21.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s1if", "tenant_sub_ip": "10.1.21.2/24"}], "vms": [{"brif": "t3br1if1", "disk": "10G", "mem": 2, "name": "t3_VM1", "vcpu": 4, "vmif": "t3VM1if1"}, {"brif": "t3br1if2", "disk": "10G", "mem": 4, "name": "t3_VM2", "vcpu": 2, "vmif": "t3VM2if1"}], "vxlan": [{"dev": "t3s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.21.2", "remote_ip": "10.2.21.2", "remote_route": "10.2.21.0/24", "subnet_route": "10.1.21.0/24", "tenant_route_ip": "192.168.3.2", "v_name": "vxlan_t3s1"}]}, "rc": 0, "start": "2019-11-17 10:29:04.377052", "stderr": "", "stderr_lines": [], "stdout": "default via 10.1.21.1 dev t3s1if ", "stdout_lines": ["default via 10.1.21.1 dev t3s1if "]}
changed: [localhost] => (item={u'route': [{u'ip': u'10.1.22.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.1.22.1', u'bridge_name': u't3br2', u'dns': [{u'dnsif': u't3s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't3s2_dnsbrif'}], u'ns_name': u't3ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.22.2/24', u'tenant_ns_ip': u'10.1.22.1/24', u'tenant_ns_if': u't3ns2if', u'tenant_ns_name': u't3', u'tenant_sub_if': u't3s2if'}], u'bridge_ip': u'2.2.2.1', u'vms': [{u'mem': 3, u'name': u't3_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't3br2if1', u'vmif': u't3VM3if1'}], u'vxlan': [{u'local_ip': [], u'tenant_route_ip': [], u'dsport': [], u'dev': [], u'subnet_route': [], u'remote_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t3ns2\" ip route show default | grep -w '[d]efault via 10.1.22.1' ; if [ $? -ne 0 ] ; then ip netns exec \"t3ns2\" ip route add default via \"10.1.22.1\" ; fi\n", "delta": "0:00:00.041271", "end": "2019-11-17 10:29:04.679777", "item": {"bridge_ip": "2.2.2.1", "bridge_name": "t3br2", "default_route_ip": "10.1.22.1", "dns": [{"brif": "t3s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t3s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t3ns2", "route": [{"if": "p1", "ip": "10.1.22.1/24", "ns_if": "t3if", "ns_name": "t3"}], "tenant_ns": [{"tenant_ns_if": "t3ns2if", "tenant_ns_ip": "10.1.22.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s2if", "tenant_sub_ip": "10.1.22.2/24"}], "vms": [{"brif": "t3br2if1", "disk": "10G", "mem": 3, "name": "t3_VM3", "vcpu": 2, "vmif": "t3VM3if1"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, "rc": 0, "start": "2019-11-17 10:29:04.638506", "stderr": "", "stderr_lines": [], "stdout": "default via 10.1.22.1 dev t3s2if ", "stdout_lines": ["default via 10.1.22.1 dev t3s2if "]}

TASK [Create bridge inside namespace] ***********************************************************************************************************************
changed: [localhost] => (item={u'route': [{u'ip': u'10.1.21.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.1.21.1', u'bridge_name': u't3br1', u'dns': [{u'dnsif': u't3s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't3s1_dnsbrif'}], u'ns_name': u't3ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.21.2/24', u'tenant_ns_ip': u'10.1.21.1/24', u'tenant_ns_if': u't3ns1if', u'tenant_ns_name': u't3', u'tenant_sub_if': u't3s1if'}], u'bridge_ip': u'1.1.1.1', u'vms': [{u'mem': 2, u'name': u't3_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't3br1if1', u'vmif': u't3VM1if1'}, {u'mem': 4, u'name': u't3_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't3br1if2', u'vmif': u't3VM2if1'}], u'vxlan': [{u'local_ip': u'10.1.21.2', u'tenant_route_ip': u'192.168.3.2', u'dsport': 4789, u'dev': u't3s1if', u'subnet_route': u'10.1.21.0/24', u'remote_route': u'10.2.21.0/24', u'v_name': u'vxlan_t3s1', u'id': 42, u'remote_ip': u'10.2.21.2'}]}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t3ns1\" brctl show | grep -w '^t3br1'; if [ $? -ne 0 ] ; then ip netns exec \"t3ns1\" brctl addbr \"t3br1\" ; fi\nip netns exec \"t3ns1\" ip link set dev \"t3br1\" up\n", "delta": "0:00:00.069615", "end": "2019-11-17 10:29:05.027487", "item": {"bridge_ip": "1.1.1.1", "bridge_name": "t3br1", "default_route_ip": "10.1.21.1", "dns": [{"brif": "t3s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t3s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t3ns1", "route": [{"if": "p1", "ip": "10.1.21.1/24", "ns_if": "t3if", "ns_name": "t3"}], "tenant_ns": [{"tenant_ns_if": "t3ns1if", "tenant_ns_ip": "10.1.21.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s1if", "tenant_sub_ip": "10.1.21.2/24"}], "vms": [{"brif": "t3br1if1", "disk": "10G", "mem": 2, "name": "t3_VM1", "vcpu": 4, "vmif": "t3VM1if1"}, {"brif": "t3br1if2", "disk": "10G", "mem": 4, "name": "t3_VM2", "vcpu": 2, "vmif": "t3VM2if1"}], "vxlan": [{"dev": "t3s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.21.2", "remote_ip": "10.2.21.2", "remote_route": "10.2.21.0/24", "subnet_route": "10.1.21.0/24", "tenant_route_ip": "192.168.3.2", "v_name": "vxlan_t3s1"}]}, "rc": 0, "start": "2019-11-17 10:29:04.957872", "stderr": "", "stderr_lines": [], "stdout": "t3br1\t\t8000.06278ed78072\tno\t\tt3br1if1", "stdout_lines": ["t3br1\t\t8000.06278ed78072\tno\t\tt3br1if1"]}
changed: [localhost] => (item={u'route': [{u'ip': u'10.1.22.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.1.22.1', u'bridge_name': u't3br2', u'dns': [{u'dnsif': u't3s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't3s2_dnsbrif'}], u'ns_name': u't3ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.22.2/24', u'tenant_ns_ip': u'10.1.22.1/24', u'tenant_ns_if': u't3ns2if', u'tenant_ns_name': u't3', u'tenant_sub_if': u't3s2if'}], u'bridge_ip': u'2.2.2.1', u'vms': [{u'mem': 3, u'name': u't3_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't3br2if1', u'vmif': u't3VM3if1'}], u'vxlan': [{u'local_ip': [], u'tenant_route_ip': [], u'dsport': [], u'dev': [], u'subnet_route': [], u'remote_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t3ns2\" brctl show | grep -w '^t3br2'; if [ $? -ne 0 ] ; then ip netns exec \"t3ns2\" brctl addbr \"t3br2\" ; fi\nip netns exec \"t3ns2\" ip link set dev \"t3br2\" up\n", "delta": "0:00:00.073883", "end": "2019-11-17 10:29:05.295613", "item": {"bridge_ip": "2.2.2.1", "bridge_name": "t3br2", "default_route_ip": "10.1.22.1", "dns": [{"brif": "t3s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t3s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t3ns2", "route": [{"if": "p1", "ip": "10.1.22.1/24", "ns_if": "t3if", "ns_name": "t3"}], "tenant_ns": [{"tenant_ns_if": "t3ns2if", "tenant_ns_ip": "10.1.22.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s2if", "tenant_sub_ip": "10.1.22.2/24"}], "vms": [{"brif": "t3br2if1", "disk": "10G", "mem": 3, "name": "t3_VM3", "vcpu": 2, "vmif": "t3VM3if1"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, "rc": 0, "start": "2019-11-17 10:29:05.221730", "stderr": "", "stderr_lines": [], "stdout": "t3br2\t\t8000.32ee3138f042\tno\t\tt3br2if1", "stdout_lines": ["t3br2\t\t8000.32ee3138f042\tno\t\tt3br2if1"]}

TASK [Create DNS VETH Pair] *********************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.21.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.1.21.1', u'bridge_name': u't3br1', u'ns_name': u't3ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.21.2/24', u'tenant_ns_ip': u'10.1.21.1/24', u'tenant_ns_if': u't3ns1if', u'tenant_sub_if': u't3s1if', u'tenant_ns_name': u't3'}], u'bridge_ip': u'1.1.1.1', u'vms': [{u'mem': 2, u'name': u't3_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't3br1if1', u'vmif': u't3VM1if1'}, {u'mem': 4, u'name': u't3_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't3br1if2', u'vmif': u't3VM2if1'}], u'vxlan': [{u'local_ip': u'10.1.21.2', u'dsport': 4789, u'dev': u't3s1if', u'tenant_route_ip': u'192.168.3.2', u'remote_route': u'10.2.21.0/24', u'subnet_route': u'10.1.21.0/24', u'v_name': u'vxlan_t3s1', u'id': 42, u'remote_ip': u'10.2.21.2'}]}, {u'dnsif': u't3s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't3s1_dnsbrif'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t3ns1\" ip link show \"t3s1_dnsbrif\" ; if [ $? -ne 0 ] ; then ip netns exec \"t3ns1\" ip link add \"t3s1_dnsbrif\" type veth peer name \"t3s1_dnsif\" ; fi\nip netns exec \"t3ns1\" ip link set dev \"t3s1_dnsbrif\" up\nip netns exec \"t3ns1\" ip link set dev \"t3s1_dnsif\" up\n", "delta": "0:00:00.114440", "end": "2019-11-17 10:29:05.667559", "item": [{"bridge_ip": "1.1.1.1", "bridge_name": "t3br1", "default_route_ip": "10.1.21.1", "ns_name": "t3ns1", "route": [{"if": "p1", "ip": "10.1.21.1/24", "ns_if": "t3if", "ns_name": "t3"}], "tenant_ns": [{"tenant_ns_if": "t3ns1if", "tenant_ns_ip": "10.1.21.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s1if", "tenant_sub_ip": "10.1.21.2/24"}], "vms": [{"brif": "t3br1if1", "disk": "10G", "mem": 2, "name": "t3_VM1", "vcpu": 4, "vmif": "t3VM1if1"}, {"brif": "t3br1if2", "disk": "10G", "mem": 4, "name": "t3_VM2", "vcpu": 2, "vmif": "t3VM2if1"}], "vxlan": [{"dev": "t3s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.21.2", "remote_ip": "10.2.21.2", "remote_route": "10.2.21.0/24", "subnet_route": "10.1.21.0/24", "tenant_route_ip": "192.168.3.2", "v_name": "vxlan_t3s1"}]}, {"brif": "t3s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t3s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "rc": 0, "start": "2019-11-17 10:29:05.553119", "stderr": "", "stderr_lines": [], "stdout": "4: t3s1_dnsbrif@t3s1_dnsif: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue master t3br1 state UP mode DEFAULT group default qlen 1000\n    link/ether 06:27:8e:d7:80:72 brd ff:ff:ff:ff:ff:ff", "stdout_lines": ["4: t3s1_dnsbrif@t3s1_dnsif: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue master t3br1 state UP mode DEFAULT group default qlen 1000", "    link/ether 06:27:8e:d7:80:72 brd ff:ff:ff:ff:ff:ff"]}
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.22.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.1.22.1', u'bridge_name': u't3br2', u'ns_name': u't3ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.22.2/24', u'tenant_ns_ip': u'10.1.22.1/24', u'tenant_ns_if': u't3ns2if', u'tenant_sub_if': u't3s2if', u'tenant_ns_name': u't3'}], u'bridge_ip': u'2.2.2.1', u'vms': [{u'mem': 3, u'name': u't3_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't3br2if1', u'vmif': u't3VM3if1'}], u'vxlan': [{u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}, {u'dnsif': u't3s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't3s2_dnsbrif'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t3ns2\" ip link show \"t3s2_dnsbrif\" ; if [ $? -ne 0 ] ; then ip netns exec \"t3ns2\" ip link add \"t3s2_dnsbrif\" type veth peer name \"t3s2_dnsif\" ; fi\nip netns exec \"t3ns2\" ip link set dev \"t3s2_dnsbrif\" up\nip netns exec \"t3ns2\" ip link set dev \"t3s2_dnsif\" up\n", "delta": "0:00:00.100855", "end": "2019-11-17 10:29:05.963534", "item": [{"bridge_ip": "2.2.2.1", "bridge_name": "t3br2", "default_route_ip": "10.1.22.1", "ns_name": "t3ns2", "route": [{"if": "p1", "ip": "10.1.22.1/24", "ns_if": "t3if", "ns_name": "t3"}], "tenant_ns": [{"tenant_ns_if": "t3ns2if", "tenant_ns_ip": "10.1.22.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s2if", "tenant_sub_ip": "10.1.22.2/24"}], "vms": [{"brif": "t3br2if1", "disk": "10G", "mem": 3, "name": "t3_VM3", "vcpu": 2, "vmif": "t3VM3if1"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, {"brif": "t3s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t3s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "rc": 0, "start": "2019-11-17 10:29:05.862679", "stderr": "", "stderr_lines": [], "stdout": "4: t3s2_dnsbrif@t3s2_dnsif: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue master t3br2 state UP mode DEFAULT group default qlen 1000\n    link/ether ce:25:d3:dc:4b:05 brd ff:ff:ff:ff:ff:ff", "stdout_lines": ["4: t3s2_dnsbrif@t3s2_dnsif: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue master t3br2 state UP mode DEFAULT group default qlen 1000", "    link/ether ce:25:d3:dc:4b:05 brd ff:ff:ff:ff:ff:ff"]}

TASK [Attach DNS VETH Pair] *********************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.21.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.1.21.1', u'bridge_name': u't3br1', u'ns_name': u't3ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.21.2/24', u'tenant_ns_ip': u'10.1.21.1/24', u'tenant_ns_if': u't3ns1if', u'tenant_sub_if': u't3s1if', u'tenant_ns_name': u't3'}], u'bridge_ip': u'1.1.1.1', u'vms': [{u'mem': 2, u'name': u't3_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't3br1if1', u'vmif': u't3VM1if1'}, {u'mem': 4, u'name': u't3_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't3br1if2', u'vmif': u't3VM2if1'}], u'vxlan': [{u'local_ip': u'10.1.21.2', u'dsport': 4789, u'dev': u't3s1if', u'tenant_route_ip': u'192.168.3.2', u'remote_route': u'10.2.21.0/24', u'subnet_route': u'10.1.21.0/24', u'v_name': u'vxlan_t3s1', u'id': 42, u'remote_ip': u'10.2.21.2'}]}, {u'dnsif': u't3s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't3s1_dnsbrif'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t3ns1\" brctl show \"t3br1\" | grep -w 't3s1_dnsbrif' ; if [ $? -ne 0 ] ; then ip netns exec \"t3ns1\" brctl addif \"t3br1\" \"t3s1_dnsbrif\" ; fi\n", "delta": "0:00:00.044458", "end": "2019-11-17 10:29:06.323759", "item": [{"bridge_ip": "1.1.1.1", "bridge_name": "t3br1", "default_route_ip": "10.1.21.1", "ns_name": "t3ns1", "route": [{"if": "p1", "ip": "10.1.21.1/24", "ns_if": "t3if", "ns_name": "t3"}], "tenant_ns": [{"tenant_ns_if": "t3ns1if", "tenant_ns_ip": "10.1.21.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s1if", "tenant_sub_ip": "10.1.21.2/24"}], "vms": [{"brif": "t3br1if1", "disk": "10G", "mem": 2, "name": "t3_VM1", "vcpu": 4, "vmif": "t3VM1if1"}, {"brif": "t3br1if2", "disk": "10G", "mem": 4, "name": "t3_VM2", "vcpu": 2, "vmif": "t3VM2if1"}], "vxlan": [{"dev": "t3s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.21.2", "remote_ip": "10.2.21.2", "remote_route": "10.2.21.0/24", "subnet_route": "10.1.21.0/24", "tenant_route_ip": "192.168.3.2", "v_name": "vxlan_t3s1"}]}, {"brif": "t3s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t3s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "rc": 0, "start": "2019-11-17 10:29:06.279301", "stderr": "", "stderr_lines": [], "stdout": "\t\t\t\t\t\t\tt3s1_dnsbrif", "stdout_lines": ["\t\t\t\t\t\t\tt3s1_dnsbrif"]}
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.22.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.1.22.1', u'bridge_name': u't3br2', u'ns_name': u't3ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.22.2/24', u'tenant_ns_ip': u'10.1.22.1/24', u'tenant_ns_if': u't3ns2if', u'tenant_sub_if': u't3s2if', u'tenant_ns_name': u't3'}], u'bridge_ip': u'2.2.2.1', u'vms': [{u'mem': 3, u'name': u't3_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't3br2if1', u'vmif': u't3VM3if1'}], u'vxlan': [{u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}, {u'dnsif': u't3s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't3s2_dnsbrif'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t3ns2\" brctl show \"t3br2\" | grep -w 't3s2_dnsbrif' ; if [ $? -ne 0 ] ; then ip netns exec \"t3ns2\" brctl addif \"t3br2\" \"t3s2_dnsbrif\" ; fi\n", "delta": "0:00:00.036343", "end": "2019-11-17 10:29:06.583715", "item": [{"bridge_ip": "2.2.2.1", "bridge_name": "t3br2", "default_route_ip": "10.1.22.1", "ns_name": "t3ns2", "route": [{"if": "p1", "ip": "10.1.22.1/24", "ns_if": "t3if", "ns_name": "t3"}], "tenant_ns": [{"tenant_ns_if": "t3ns2if", "tenant_ns_ip": "10.1.22.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s2if", "tenant_sub_ip": "10.1.22.2/24"}], "vms": [{"brif": "t3br2if1", "disk": "10G", "mem": 3, "name": "t3_VM3", "vcpu": 2, "vmif": "t3VM3if1"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, {"brif": "t3s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t3s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "rc": 0, "start": "2019-11-17 10:29:06.547372", "stderr": "", "stderr_lines": [], "stdout": "\t\t\t\t\t\t\tt3s2_dnsbrif", "stdout_lines": ["\t\t\t\t\t\t\tt3s2_dnsbrif"]}

TASK [Create VETH Pairs] ************************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.21.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.1.21.1', u'bridge_name': u't3br1', u'dns': [{u'dnsif': u't3s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't3s1_dnsbrif'}], u'ns_name': u't3ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.21.2/24', u'tenant_ns_ip': u'10.1.21.1/24', u'tenant_ns_if': u't3ns1if', u'tenant_sub_if': u't3s1if', u'tenant_ns_name': u't3'}], u'bridge_ip': u'1.1.1.1', u'vxlan': [{u'local_ip': u'10.1.21.2', u'dsport': 4789, u'dev': u't3s1if', u'tenant_route_ip': u'192.168.3.2', u'remote_route': u'10.2.21.0/24', u'subnet_route': u'10.1.21.0/24', u'v_name': u'vxlan_t3s1', u'id': 42, u'remote_ip': u'10.2.21.2'}]}, {u'mem': 2, u'name': u't3_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't3br1if1', u'vmif': u't3VM1if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip link show \"t3br1if1\" ; if [ $? -ne 0 ] ; then ip link add \"t3VM1if1\" type veth peer name \"t3br1if1\" ; fi\nip link set dev \"t3br1if1\" up\nip link set dev \"t3VM1if1\" up\n", "delta": "0:00:00.012847", "end": "2019-11-17 10:29:06.882145", "item": [{"bridge_ip": "1.1.1.1", "bridge_name": "t3br1", "default_route_ip": "10.1.21.1", "dns": [{"brif": "t3s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t3s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t3ns1", "route": [{"if": "p1", "ip": "10.1.21.1/24", "ns_if": "t3if", "ns_name": "t3"}], "tenant_ns": [{"tenant_ns_if": "t3ns1if", "tenant_ns_ip": "10.1.21.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s1if", "tenant_sub_ip": "10.1.21.2/24"}], "vxlan": [{"dev": "t3s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.21.2", "remote_ip": "10.2.21.2", "remote_route": "10.2.21.0/24", "subnet_route": "10.1.21.0/24", "tenant_route_ip": "192.168.3.2", "v_name": "vxlan_t3s1"}]}, {"brif": "t3br1if1", "disk": "10G", "mem": 2, "name": "t3_VM1", "vcpu": 4, "vmif": "t3VM1if1"}], "rc": 0, "start": "2019-11-17 10:29:06.869298", "stderr": "Device \"t3br1if1\" does not exist.\nRTNETLINK answers: File exists\nCannot find device \"t3br1if1\"", "stderr_lines": ["Device \"t3br1if1\" does not exist.", "RTNETLINK answers: File exists", "Cannot find device \"t3br1if1\""], "stdout": "", "stdout_lines": []}
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.21.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.1.21.1', u'bridge_name': u't3br1', u'dns': [{u'dnsif': u't3s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't3s1_dnsbrif'}], u'ns_name': u't3ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.21.2/24', u'tenant_ns_ip': u'10.1.21.1/24', u'tenant_ns_if': u't3ns1if', u'tenant_sub_if': u't3s1if', u'tenant_ns_name': u't3'}], u'bridge_ip': u'1.1.1.1', u'vxlan': [{u'local_ip': u'10.1.21.2', u'dsport': 4789, u'dev': u't3s1if', u'tenant_route_ip': u'192.168.3.2', u'remote_route': u'10.2.21.0/24', u'subnet_route': u'10.1.21.0/24', u'v_name': u'vxlan_t3s1', u'id': 42, u'remote_ip': u'10.2.21.2'}]}, {u'mem': 4, u'name': u't3_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't3br1if2', u'vmif': u't3VM2if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip link show \"t3br1if2\" ; if [ $? -ne 0 ] ; then ip link add \"t3VM2if1\" type veth peer name \"t3br1if2\" ; fi\nip link set dev \"t3br1if2\" up\nip link set dev \"t3VM2if1\" up\n", "delta": "0:00:00.012828", "end": "2019-11-17 10:29:07.111719", "item": [{"bridge_ip": "1.1.1.1", "bridge_name": "t3br1", "default_route_ip": "10.1.21.1", "dns": [{"brif": "t3s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t3s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t3ns1", "route": [{"if": "p1", "ip": "10.1.21.1/24", "ns_if": "t3if", "ns_name": "t3"}], "tenant_ns": [{"tenant_ns_if": "t3ns1if", "tenant_ns_ip": "10.1.21.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s1if", "tenant_sub_ip": "10.1.21.2/24"}], "vxlan": [{"dev": "t3s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.21.2", "remote_ip": "10.2.21.2", "remote_route": "10.2.21.0/24", "subnet_route": "10.1.21.0/24", "tenant_route_ip": "192.168.3.2", "v_name": "vxlan_t3s1"}]}, {"brif": "t3br1if2", "disk": "10G", "mem": 4, "name": "t3_VM2", "vcpu": 2, "vmif": "t3VM2if1"}], "rc": 0, "start": "2019-11-17 10:29:07.098891", "stderr": "Device \"t3br1if2\" does not exist.\nRTNETLINK answers: File exists\nCannot find device \"t3br1if2\"", "stderr_lines": ["Device \"t3br1if2\" does not exist.", "RTNETLINK answers: File exists", "Cannot find device \"t3br1if2\""], "stdout": "", "stdout_lines": []}
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.22.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.1.22.1', u'bridge_name': u't3br2', u'dns': [{u'dnsif': u't3s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't3s2_dnsbrif'}], u'ns_name': u't3ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.22.2/24', u'tenant_ns_ip': u'10.1.22.1/24', u'tenant_ns_if': u't3ns2if', u'tenant_sub_if': u't3s2if', u'tenant_ns_name': u't3'}], u'bridge_ip': u'2.2.2.1', u'vxlan': [{u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}, {u'mem': 3, u'name': u't3_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't3br2if1', u'vmif': u't3VM3if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip link show \"t3br2if1\" ; if [ $? -ne 0 ] ; then ip link add \"t3VM3if1\" type veth peer name \"t3br2if1\" ; fi\nip link set dev \"t3br2if1\" up\nip link set dev \"t3VM3if1\" up\n", "delta": "0:00:00.013028", "end": "2019-11-17 10:29:07.348024", "item": [{"bridge_ip": "2.2.2.1", "bridge_name": "t3br2", "default_route_ip": "10.1.22.1", "dns": [{"brif": "t3s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t3s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t3ns2", "route": [{"if": "p1", "ip": "10.1.22.1/24", "ns_if": "t3if", "ns_name": "t3"}], "tenant_ns": [{"tenant_ns_if": "t3ns2if", "tenant_ns_ip": "10.1.22.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s2if", "tenant_sub_ip": "10.1.22.2/24"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, {"brif": "t3br2if1", "disk": "10G", "mem": 3, "name": "t3_VM3", "vcpu": 2, "vmif": "t3VM3if1"}], "rc": 0, "start": "2019-11-17 10:29:07.334996", "stderr": "Device \"t3br2if1\" does not exist.\nRTNETLINK answers: File exists\nCannot find device \"t3br2if1\"", "stderr_lines": ["Device \"t3br2if1\" does not exist.", "RTNETLINK answers: File exists", "Cannot find device \"t3br2if1\""], "stdout": "", "stdout_lines": []}

TASK [Attach VETH Pairs] ************************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.21.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.1.21.1', u'bridge_name': u't3br1', u'dns': [{u'dnsif': u't3s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't3s1_dnsbrif'}], u'ns_name': u't3ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.21.2/24', u'tenant_ns_ip': u'10.1.21.1/24', u'tenant_ns_if': u't3ns1if', u'tenant_sub_if': u't3s1if', u'tenant_ns_name': u't3'}], u'bridge_ip': u'1.1.1.1', u'vxlan': [{u'local_ip': u'10.1.21.2', u'dsport': 4789, u'dev': u't3s1if', u'tenant_route_ip': u'192.168.3.2', u'remote_route': u'10.2.21.0/24', u'subnet_route': u'10.1.21.0/24', u'v_name': u'vxlan_t3s1', u'id': 42, u'remote_ip': u'10.2.21.2'}]}, {u'mem': 2, u'name': u't3_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't3br1if1', u'vmif': u't3VM1if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip link show \"t3br1if1\" ; if [ $? -eq 0 ] ; then ip link set \"t3br1if1\" netns \"t3ns1\" ; fi\nip netns exec \"t3ns1\" brctl show \"t3br1\" | grep -w 't3br1if1' ; if [ $? -ne 0 ] ; then ip netns exec \"t3ns1\" brctl addif \"t3br1\" \"t3br1if1\" ; fi\n", "delta": "0:00:00.050789", "end": "2019-11-17 10:29:07.687785", "item": [{"bridge_ip": "1.1.1.1", "bridge_name": "t3br1", "default_route_ip": "10.1.21.1", "dns": [{"brif": "t3s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t3s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t3ns1", "route": [{"if": "p1", "ip": "10.1.21.1/24", "ns_if": "t3if", "ns_name": "t3"}], "tenant_ns": [{"tenant_ns_if": "t3ns1if", "tenant_ns_ip": "10.1.21.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s1if", "tenant_sub_ip": "10.1.21.2/24"}], "vxlan": [{"dev": "t3s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.21.2", "remote_ip": "10.2.21.2", "remote_route": "10.2.21.0/24", "subnet_route": "10.1.21.0/24", "tenant_route_ip": "192.168.3.2", "v_name": "vxlan_t3s1"}]}, {"brif": "t3br1if1", "disk": "10G", "mem": 2, "name": "t3_VM1", "vcpu": 4, "vmif": "t3VM1if1"}], "rc": 0, "start": "2019-11-17 10:29:07.636996", "stderr": "Device \"t3br1if1\" does not exist.", "stderr_lines": ["Device \"t3br1if1\" does not exist."], "stdout": "t3br1\t\t8000.06278ed78072\tno\t\tt3br1if1", "stdout_lines": ["t3br1\t\t8000.06278ed78072\tno\t\tt3br1if1"]}
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.21.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.1.21.1', u'bridge_name': u't3br1', u'dns': [{u'dnsif': u't3s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't3s1_dnsbrif'}], u'ns_name': u't3ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.21.2/24', u'tenant_ns_ip': u'10.1.21.1/24', u'tenant_ns_if': u't3ns1if', u'tenant_sub_if': u't3s1if', u'tenant_ns_name': u't3'}], u'bridge_ip': u'1.1.1.1', u'vxlan': [{u'local_ip': u'10.1.21.2', u'dsport': 4789, u'dev': u't3s1if', u'tenant_route_ip': u'192.168.3.2', u'remote_route': u'10.2.21.0/24', u'subnet_route': u'10.1.21.0/24', u'v_name': u'vxlan_t3s1', u'id': 42, u'remote_ip': u'10.2.21.2'}]}, {u'mem': 4, u'name': u't3_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't3br1if2', u'vmif': u't3VM2if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip link show \"t3br1if2\" ; if [ $? -eq 0 ] ; then ip link set \"t3br1if2\" netns \"t3ns1\" ; fi\nip netns exec \"t3ns1\" brctl show \"t3br1\" | grep -w 't3br1if2' ; if [ $? -ne 0 ] ; then ip netns exec \"t3ns1\" brctl addif \"t3br1\" \"t3br1if2\" ; fi\n", "delta": "0:00:00.039064", "end": "2019-11-17 10:29:07.947709", "item": [{"bridge_ip": "1.1.1.1", "bridge_name": "t3br1", "default_route_ip": "10.1.21.1", "dns": [{"brif": "t3s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t3s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t3ns1", "route": [{"if": "p1", "ip": "10.1.21.1/24", "ns_if": "t3if", "ns_name": "t3"}], "tenant_ns": [{"tenant_ns_if": "t3ns1if", "tenant_ns_ip": "10.1.21.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s1if", "tenant_sub_ip": "10.1.21.2/24"}], "vxlan": [{"dev": "t3s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.21.2", "remote_ip": "10.2.21.2", "remote_route": "10.2.21.0/24", "subnet_route": "10.1.21.0/24", "tenant_route_ip": "192.168.3.2", "v_name": "vxlan_t3s1"}]}, {"brif": "t3br1if2", "disk": "10G", "mem": 4, "name": "t3_VM2", "vcpu": 2, "vmif": "t3VM2if1"}], "rc": 0, "start": "2019-11-17 10:29:07.908645", "stderr": "Device \"t3br1if2\" does not exist.", "stderr_lines": ["Device \"t3br1if2\" does not exist."], "stdout": "\t\t\t\t\t\t\tt3br1if2", "stdout_lines": ["\t\t\t\t\t\t\tt3br1if2"]}
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.22.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.1.22.1', u'bridge_name': u't3br2', u'dns': [{u'dnsif': u't3s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't3s2_dnsbrif'}], u'ns_name': u't3ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.22.2/24', u'tenant_ns_ip': u'10.1.22.1/24', u'tenant_ns_if': u't3ns2if', u'tenant_sub_if': u't3s2if', u'tenant_ns_name': u't3'}], u'bridge_ip': u'2.2.2.1', u'vxlan': [{u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}, {u'mem': 3, u'name': u't3_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't3br2if1', u'vmif': u't3VM3if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip link show \"t3br2if1\" ; if [ $? -eq 0 ] ; then ip link set \"t3br2if1\" netns \"t3ns2\" ; fi\nip netns exec \"t3ns2\" brctl show \"t3br2\" | grep -w 't3br2if1' ; if [ $? -ne 0 ] ; then ip netns exec \"t3ns2\" brctl addif \"t3br2\" \"t3br2if1\" ; fi\n", "delta": "0:00:00.042990", "end": "2019-11-17 10:29:08.183503", "item": [{"bridge_ip": "2.2.2.1", "bridge_name": "t3br2", "default_route_ip": "10.1.22.1", "dns": [{"brif": "t3s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t3s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t3ns2", "route": [{"if": "p1", "ip": "10.1.22.1/24", "ns_if": "t3if", "ns_name": "t3"}], "tenant_ns": [{"tenant_ns_if": "t3ns2if", "tenant_ns_ip": "10.1.22.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s2if", "tenant_sub_ip": "10.1.22.2/24"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, {"brif": "t3br2if1", "disk": "10G", "mem": 3, "name": "t3_VM3", "vcpu": 2, "vmif": "t3VM3if1"}], "rc": 0, "start": "2019-11-17 10:29:08.140513", "stderr": "Device \"t3br2if1\" does not exist.", "stderr_lines": ["Device \"t3br2if1\" does not exist."], "stdout": "t3br2\t\t8000.32ee3138f042\tno\t\tt3br2if1", "stdout_lines": ["t3br2\t\t8000.32ee3138f042\tno\t\tt3br2if1"]}

TASK [All interfaces and bridges UP] ************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.21.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.1.21.1', u'bridge_name': u't3br1', u'dns': [{u'dnsif': u't3s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't3s1_dnsbrif'}], u'ns_name': u't3ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.21.2/24', u'tenant_ns_ip': u'10.1.21.1/24', u'tenant_ns_if': u't3ns1if', u'tenant_sub_if': u't3s1if', u'tenant_ns_name': u't3'}], u'bridge_ip': u'1.1.1.1', u'vxlan': [{u'local_ip': u'10.1.21.2', u'dsport': 4789, u'dev': u't3s1if', u'tenant_route_ip': u'192.168.3.2', u'remote_route': u'10.2.21.0/24', u'subnet_route': u'10.1.21.0/24', u'v_name': u'vxlan_t3s1', u'id': 42, u'remote_ip': u'10.2.21.2'}]}, {u'mem': 2, u'name': u't3_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't3br1if1', u'vmif': u't3VM1if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t3ns1\" ip link set \"t3br1if1\" up\nip netns exec \"t3ns1\" ip link set dev \"t3br1\" up\n", "delta": "0:00:00.070884", "end": "2019-11-17 10:29:08.515709", "item": [{"bridge_ip": "1.1.1.1", "bridge_name": "t3br1", "default_route_ip": "10.1.21.1", "dns": [{"brif": "t3s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t3s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t3ns1", "route": [{"if": "p1", "ip": "10.1.21.1/24", "ns_if": "t3if", "ns_name": "t3"}], "tenant_ns": [{"tenant_ns_if": "t3ns1if", "tenant_ns_ip": "10.1.21.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s1if", "tenant_sub_ip": "10.1.21.2/24"}], "vxlan": [{"dev": "t3s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.21.2", "remote_ip": "10.2.21.2", "remote_route": "10.2.21.0/24", "subnet_route": "10.1.21.0/24", "tenant_route_ip": "192.168.3.2", "v_name": "vxlan_t3s1"}]}, {"brif": "t3br1if1", "disk": "10G", "mem": 2, "name": "t3_VM1", "vcpu": 4, "vmif": "t3VM1if1"}], "rc": 0, "start": "2019-11-17 10:29:08.444825", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.21.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.1.21.1', u'bridge_name': u't3br1', u'dns': [{u'dnsif': u't3s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't3s1_dnsbrif'}], u'ns_name': u't3ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.21.2/24', u'tenant_ns_ip': u'10.1.21.1/24', u'tenant_ns_if': u't3ns1if', u'tenant_sub_if': u't3s1if', u'tenant_ns_name': u't3'}], u'bridge_ip': u'1.1.1.1', u'vxlan': [{u'local_ip': u'10.1.21.2', u'dsport': 4789, u'dev': u't3s1if', u'tenant_route_ip': u'192.168.3.2', u'remote_route': u'10.2.21.0/24', u'subnet_route': u'10.1.21.0/24', u'v_name': u'vxlan_t3s1', u'id': 42, u'remote_ip': u'10.2.21.2'}]}, {u'mem': 4, u'name': u't3_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't3br1if2', u'vmif': u't3VM2if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t3ns1\" ip link set \"t3br1if2\" up\nip netns exec \"t3ns1\" ip link set dev \"t3br1\" up\n", "delta": "0:00:00.080540", "end": "2019-11-17 10:29:08.795747", "item": [{"bridge_ip": "1.1.1.1", "bridge_name": "t3br1", "default_route_ip": "10.1.21.1", "dns": [{"brif": "t3s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t3s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t3ns1", "route": [{"if": "p1", "ip": "10.1.21.1/24", "ns_if": "t3if", "ns_name": "t3"}], "tenant_ns": [{"tenant_ns_if": "t3ns1if", "tenant_ns_ip": "10.1.21.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s1if", "tenant_sub_ip": "10.1.21.2/24"}], "vxlan": [{"dev": "t3s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.21.2", "remote_ip": "10.2.21.2", "remote_route": "10.2.21.0/24", "subnet_route": "10.1.21.0/24", "tenant_route_ip": "192.168.3.2", "v_name": "vxlan_t3s1"}]}, {"brif": "t3br1if2", "disk": "10G", "mem": 4, "name": "t3_VM2", "vcpu": 2, "vmif": "t3VM2if1"}], "rc": 0, "start": "2019-11-17 10:29:08.715207", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.22.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.1.22.1', u'bridge_name': u't3br2', u'dns': [{u'dnsif': u't3s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't3s2_dnsbrif'}], u'ns_name': u't3ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.22.2/24', u'tenant_ns_ip': u'10.1.22.1/24', u'tenant_ns_if': u't3ns2if', u'tenant_sub_if': u't3s2if', u'tenant_ns_name': u't3'}], u'bridge_ip': u'2.2.2.1', u'vxlan': [{u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}, {u'mem': 3, u'name': u't3_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't3br2if1', u'vmif': u't3VM3if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t3ns2\" ip link set \"t3br2if1\" up\nip netns exec \"t3ns2\" ip link set dev \"t3br2\" up\n", "delta": "0:00:00.070698", "end": "2019-11-17 10:29:09.067575", "item": [{"bridge_ip": "2.2.2.1", "bridge_name": "t3br2", "default_route_ip": "10.1.22.1", "dns": [{"brif": "t3s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t3s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t3ns2", "route": [{"if": "p1", "ip": "10.1.22.1/24", "ns_if": "t3if", "ns_name": "t3"}], "tenant_ns": [{"tenant_ns_if": "t3ns2if", "tenant_ns_ip": "10.1.22.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s2if", "tenant_sub_ip": "10.1.22.2/24"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, {"brif": "t3br2if1", "disk": "10G", "mem": 3, "name": "t3_VM3", "vcpu": 2, "vmif": "t3VM3if1"}], "rc": 0, "start": "2019-11-17 10:29:08.996877", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Add IP to DNS Interface] ******************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.21.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.1.21.1', u'bridge_name': u't3br1', u'ns_name': u't3ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.21.2/24', u'tenant_ns_ip': u'10.1.21.1/24', u'tenant_ns_if': u't3ns1if', u'tenant_sub_if': u't3s1if', u'tenant_ns_name': u't3'}], u'bridge_ip': u'1.1.1.1', u'vms': [{u'mem': 2, u'name': u't3_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't3br1if1', u'vmif': u't3VM1if1'}, {u'mem': 4, u'name': u't3_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't3br1if2', u'vmif': u't3VM2if1'}], u'vxlan': [{u'local_ip': u'10.1.21.2', u'dsport': 4789, u'dev': u't3s1if', u'tenant_route_ip': u'192.168.3.2', u'remote_route': u'10.2.21.0/24', u'subnet_route': u'10.1.21.0/24', u'v_name': u'vxlan_t3s1', u'id': 42, u'remote_ip': u'10.2.21.2'}]}, {u'dnsif': u't3s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't3s1_dnsbrif'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t3ns1\" ip addr show \"t3s1_dnsif\" | awk 'FNR==3{ print $2 }' | grep -w '^1.1.1.1/24' ; if [ $? -ne 0 ] ; then ip netns exec \"t3ns1\" ip addr add \"1.1.1.1/24\" dev \"t3s1_dnsif\" ; fi\n", "delta": "0:00:00.044873", "end": "2019-11-17 10:29:09.404479", "item": [{"bridge_ip": "1.1.1.1", "bridge_name": "t3br1", "default_route_ip": "10.1.21.1", "ns_name": "t3ns1", "route": [{"if": "p1", "ip": "10.1.21.1/24", "ns_if": "t3if", "ns_name": "t3"}], "tenant_ns": [{"tenant_ns_if": "t3ns1if", "tenant_ns_ip": "10.1.21.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s1if", "tenant_sub_ip": "10.1.21.2/24"}], "vms": [{"brif": "t3br1if1", "disk": "10G", "mem": 2, "name": "t3_VM1", "vcpu": 4, "vmif": "t3VM1if1"}, {"brif": "t3br1if2", "disk": "10G", "mem": 4, "name": "t3_VM2", "vcpu": 2, "vmif": "t3VM2if1"}], "vxlan": [{"dev": "t3s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.21.2", "remote_ip": "10.2.21.2", "remote_route": "10.2.21.0/24", "subnet_route": "10.1.21.0/24", "tenant_route_ip": "192.168.3.2", "v_name": "vxlan_t3s1"}]}, {"brif": "t3s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t3s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "rc": 0, "start": "2019-11-17 10:29:09.359606", "stderr": "", "stderr_lines": [], "stdout": "1.1.1.1/24", "stdout_lines": ["1.1.1.1/24"]}
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.22.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.1.22.1', u'bridge_name': u't3br2', u'ns_name': u't3ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.22.2/24', u'tenant_ns_ip': u'10.1.22.1/24', u'tenant_ns_if': u't3ns2if', u'tenant_sub_if': u't3s2if', u'tenant_ns_name': u't3'}], u'bridge_ip': u'2.2.2.1', u'vms': [{u'mem': 3, u'name': u't3_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't3br2if1', u'vmif': u't3VM3if1'}], u'vxlan': [{u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}, {u'dnsif': u't3s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't3s2_dnsbrif'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t3ns2\" ip addr show \"t3s2_dnsif\" | awk 'FNR==3{ print $2 }' | grep -w '^2.2.2.1/24' ; if [ $? -ne 0 ] ; then ip netns exec \"t3ns2\" ip addr add \"2.2.2.1/24\" dev \"t3s2_dnsif\" ; fi\n", "delta": "0:00:00.041750", "end": "2019-11-17 10:29:09.679967", "item": [{"bridge_ip": "2.2.2.1", "bridge_name": "t3br2", "default_route_ip": "10.1.22.1", "ns_name": "t3ns2", "route": [{"if": "p1", "ip": "10.1.22.1/24", "ns_if": "t3if", "ns_name": "t3"}], "tenant_ns": [{"tenant_ns_if": "t3ns2if", "tenant_ns_ip": "10.1.22.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s2if", "tenant_sub_ip": "10.1.22.2/24"}], "vms": [{"brif": "t3br2if1", "disk": "10G", "mem": 3, "name": "t3_VM3", "vcpu": 2, "vmif": "t3VM3if1"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, {"brif": "t3s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t3s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "rc": 0, "start": "2019-11-17 10:29:09.638217", "stderr": "", "stderr_lines": [], "stdout": "2.2.2.1/24", "stdout_lines": ["2.2.2.1/24"]}

TASK [Install DHCP Server] **********************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.21.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.1.21.1', u'bridge_name': u't3br1', u'ns_name': u't3ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.21.2/24', u'tenant_ns_ip': u'10.1.21.1/24', u'tenant_ns_if': u't3ns1if', u'tenant_sub_if': u't3s1if', u'tenant_ns_name': u't3'}], u'bridge_ip': u'1.1.1.1', u'vms': [{u'mem': 2, u'name': u't3_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't3br1if1', u'vmif': u't3VM1if1'}, {u'mem': 4, u'name': u't3_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't3br1if2', u'vmif': u't3VM2if1'}], u'vxlan': [{u'local_ip': u'10.1.21.2', u'dsport': 4789, u'dev': u't3s1if', u'tenant_route_ip': u'192.168.3.2', u'remote_route': u'10.2.21.0/24', u'subnet_route': u'10.1.21.0/24', u'v_name': u'vxlan_t3s1', u'id': 42, u'remote_ip': u'10.2.21.2'}]}, {u'dnsif': u't3s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't3s1_dnsbrif'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t3ns1\" ps aux | grep -w '[d]nsmasq --interface t3s1_dnsif -z --dhcp-range=1.1.1.5,1.1.1.126' ; if [ $? -ne 0 ] ; then ip netns exec \"t3ns1\" dnsmasq --interface \"t3s1_dnsif\" -z --dhcp-range=1.1.1.5,'1.1.1.126' ; fi\n", "delta": "0:00:00.057523", "end": "2019-11-17 10:29:10.027821", "item": [{"bridge_ip": "1.1.1.1", "bridge_name": "t3br1", "default_route_ip": "10.1.21.1", "ns_name": "t3ns1", "route": [{"if": "p1", "ip": "10.1.21.1/24", "ns_if": "t3if", "ns_name": "t3"}], "tenant_ns": [{"tenant_ns_if": "t3ns1if", "tenant_ns_ip": "10.1.21.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s1if", "tenant_sub_ip": "10.1.21.2/24"}], "vms": [{"brif": "t3br1if1", "disk": "10G", "mem": 2, "name": "t3_VM1", "vcpu": 4, "vmif": "t3VM1if1"}, {"brif": "t3br1if2", "disk": "10G", "mem": 4, "name": "t3_VM2", "vcpu": 2, "vmif": "t3VM2if1"}], "vxlan": [{"dev": "t3s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.21.2", "remote_ip": "10.2.21.2", "remote_route": "10.2.21.0/24", "subnet_route": "10.1.21.0/24", "tenant_route_ip": "192.168.3.2", "v_name": "vxlan_t3s1"}]}, {"brif": "t3s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t3s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "rc": 0, "start": "2019-11-17 10:29:09.970298", "stderr": "", "stderr_lines": [], "stdout": "nobody   13873  0.0  0.0  51580  2772 ?        S    10:24   0:00 dnsmasq --interface t3s1_dnsif -z --dhcp-range=1.1.1.5,1.1.1.126", "stdout_lines": ["nobody   13873  0.0  0.0  51580  2772 ?        S    10:24   0:00 dnsmasq --interface t3s1_dnsif -z --dhcp-range=1.1.1.5,1.1.1.126"]}
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.22.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.1.22.1', u'bridge_name': u't3br2', u'ns_name': u't3ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.22.2/24', u'tenant_ns_ip': u'10.1.22.1/24', u'tenant_ns_if': u't3ns2if', u'tenant_sub_if': u't3s2if', u'tenant_ns_name': u't3'}], u'bridge_ip': u'2.2.2.1', u'vms': [{u'mem': 3, u'name': u't3_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't3br2if1', u'vmif': u't3VM3if1'}], u'vxlan': [{u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}, {u'dnsif': u't3s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't3s2_dnsbrif'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t3ns2\" ps aux | grep -w '[d]nsmasq --interface t3s2_dnsif -z --dhcp-range=2.2.2.5,2.2.2.254' ; if [ $? -ne 0 ] ; then ip netns exec \"t3ns2\" dnsmasq --interface \"t3s2_dnsif\" -z --dhcp-range=2.2.2.5,'2.2.2.254' ; fi\n", "delta": "0:00:00.053177", "end": "2019-11-17 10:29:10.331825", "item": [{"bridge_ip": "2.2.2.1", "bridge_name": "t3br2", "default_route_ip": "10.1.22.1", "ns_name": "t3ns2", "route": [{"if": "p1", "ip": "10.1.22.1/24", "ns_if": "t3if", "ns_name": "t3"}], "tenant_ns": [{"tenant_ns_if": "t3ns2if", "tenant_ns_ip": "10.1.22.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s2if", "tenant_sub_ip": "10.1.22.2/24"}], "vms": [{"brif": "t3br2if1", "disk": "10G", "mem": 3, "name": "t3_VM3", "vcpu": 2, "vmif": "t3VM3if1"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, {"brif": "t3s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t3s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "rc": 0, "start": "2019-11-17 10:29:10.278648", "stderr": "", "stderr_lines": [], "stdout": "nobody   13906  0.0  0.0  51580  2848 ?        S    10:24   0:00 dnsmasq --interface t3s2_dnsif -z --dhcp-range=2.2.2.5,2.2.2.254", "stdout_lines": ["nobody   13906  0.0  0.0  51580  2848 ?        S    10:24   0:00 dnsmasq --interface t3s2_dnsif -z --dhcp-range=2.2.2.5,2.2.2.254"]}

TASK [Create VXLAN devices] *********************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.21.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.1.21.1', u'bridge_name': u't3br1', u'dns': [{u'dnsif': u't3s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't3s1_dnsbrif'}], u'ns_name': u't3ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.21.2/24', u'tenant_ns_ip': u'10.1.21.1/24', u'tenant_ns_if': u't3ns1if', u'tenant_sub_if': u't3s1if', u'tenant_ns_name': u't3'}], u'bridge_ip': u'1.1.1.1', u'vms': [{u'mem': 2, u'name': u't3_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't3br1if1', u'vmif': u't3VM1if1'}, {u'mem': 4, u'name': u't3_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't3br1if2', u'vmif': u't3VM2if1'}]}, {u'local_ip': u'10.1.21.2', u'dsport': 4789, u'dev': u't3s1if', u'tenant_route_ip': u'192.168.3.2', u'remote_route': u'10.2.21.0/24', u'subnet_route': u'10.1.21.0/24', u'v_name': u'vxlan_t3s1', u'id': 42, u'remote_ip': u'10.2.21.2'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t3ns1\" ip link show \"vxlan_t3s1\" ; if [ $? -ne 0 ] ; then ip netns exec \"t3ns1\" ip link add \"vxlan_t3s1\" type vxlan id \"42\" local \"10.1.21.2\" remote \"10.2.21.2\" dstport \"4789\" dev \"t3s1if\"; ip netns exec \"t3ns1\" ip link set dev \"vxlan_t3s1\" up ; fi\n", "delta": "0:00:00.037579", "end": "2019-11-17 10:29:10.675785", "item": [{"bridge_ip": "1.1.1.1", "bridge_name": "t3br1", "default_route_ip": "10.1.21.1", "dns": [{"brif": "t3s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t3s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t3ns1", "route": [{"if": "p1", "ip": "10.1.21.1/24", "ns_if": "t3if", "ns_name": "t3"}], "tenant_ns": [{"tenant_ns_if": "t3ns1if", "tenant_ns_ip": "10.1.21.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s1if", "tenant_sub_ip": "10.1.21.2/24"}], "vms": [{"brif": "t3br1if1", "disk": "10G", "mem": 2, "name": "t3_VM1", "vcpu": 4, "vmif": "t3VM1if1"}, {"brif": "t3br1if2", "disk": "10G", "mem": 4, "name": "t3_VM2", "vcpu": 2, "vmif": "t3VM2if1"}]}, {"dev": "t3s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.21.2", "remote_ip": "10.2.21.2", "remote_route": "10.2.21.0/24", "subnet_route": "10.1.21.0/24", "tenant_route_ip": "192.168.3.2", "v_name": "vxlan_t3s1"}], "rc": 0, "start": "2019-11-17 10:29:10.638206", "stderr": "", "stderr_lines": [], "stdout": "5: vxlan_t3s1: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1450 qdisc noqueue master t3br1 state UNKNOWN mode DEFAULT group default qlen 1000\n    link/ether b2:75:12:27:f2:02 brd ff:ff:ff:ff:ff:ff", "stdout_lines": ["5: vxlan_t3s1: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1450 qdisc noqueue master t3br1 state UNKNOWN mode DEFAULT group default qlen 1000", "    link/ether b2:75:12:27:f2:02 brd ff:ff:ff:ff:ff:ff"]}
skipping: [localhost] => (item=[{u'route': [{u'ip': u'10.1.22.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.1.22.1', u'bridge_name': u't3br2', u'dns': [{u'dnsif': u't3s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't3s2_dnsbrif'}], u'ns_name': u't3ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.22.2/24', u'tenant_ns_ip': u'10.1.22.1/24', u'tenant_ns_if': u't3ns2if', u'tenant_sub_if': u't3s2if', u'tenant_ns_name': u't3'}], u'bridge_ip': u'2.2.2.1', u'vms': [{u'mem': 3, u'name': u't3_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't3br2if1', u'vmif': u't3VM3if1'}]}, {u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}])  => {"ansible_loop_var": "item", "changed": false, "item": [{"bridge_ip": "2.2.2.1", "bridge_name": "t3br2", "default_route_ip": "10.1.22.1", "dns": [{"brif": "t3s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t3s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t3ns2", "route": [{"if": "p1", "ip": "10.1.22.1/24", "ns_if": "t3if", "ns_name": "t3"}], "tenant_ns": [{"tenant_ns_if": "t3ns2if", "tenant_ns_ip": "10.1.22.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s2if", "tenant_sub_ip": "10.1.22.2/24"}], "vms": [{"brif": "t3br2if1", "disk": "10G", "mem": 3, "name": "t3_VM3", "vcpu": 2, "vmif": "t3VM3if1"}]}, {"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}], "skip_reason": "Conditional result was False"}

TASK [Attach VXLANs to bridge] ******************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.21.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.1.21.1', u'bridge_name': u't3br1', u'dns': [{u'dnsif': u't3s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't3s1_dnsbrif'}], u'ns_name': u't3ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.21.2/24', u'tenant_ns_ip': u'10.1.21.1/24', u'tenant_ns_if': u't3ns1if', u'tenant_sub_if': u't3s1if', u'tenant_ns_name': u't3'}], u'bridge_ip': u'1.1.1.1', u'vms': [{u'mem': 2, u'name': u't3_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't3br1if1', u'vmif': u't3VM1if1'}, {u'mem': 4, u'name': u't3_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't3br1if2', u'vmif': u't3VM2if1'}]}, {u'local_ip': u'10.1.21.2', u'dsport': 4789, u'dev': u't3s1if', u'tenant_route_ip': u'192.168.3.2', u'remote_route': u'10.2.21.0/24', u'subnet_route': u'10.1.21.0/24', u'v_name': u'vxlan_t3s1', u'id': 42, u'remote_ip': u'10.2.21.2'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t3ns1\" brctl show \"t3br1\" | grep -w 'vxlan_t3s1' ; if [ $? -ne 0 ] ; then ip netns exec \"t3ns1\" brctl addif \"t3br1\" \"vxlan_t3s1\" ; fi\n", "delta": "0:00:00.039324", "end": "2019-11-17 10:29:11.019625", "item": [{"bridge_ip": "1.1.1.1", "bridge_name": "t3br1", "default_route_ip": "10.1.21.1", "dns": [{"brif": "t3s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t3s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t3ns1", "route": [{"if": "p1", "ip": "10.1.21.1/24", "ns_if": "t3if", "ns_name": "t3"}], "tenant_ns": [{"tenant_ns_if": "t3ns1if", "tenant_ns_ip": "10.1.21.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s1if", "tenant_sub_ip": "10.1.21.2/24"}], "vms": [{"brif": "t3br1if1", "disk": "10G", "mem": 2, "name": "t3_VM1", "vcpu": 4, "vmif": "t3VM1if1"}, {"brif": "t3br1if2", "disk": "10G", "mem": 4, "name": "t3_VM2", "vcpu": 2, "vmif": "t3VM2if1"}]}, {"dev": "t3s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.21.2", "remote_ip": "10.2.21.2", "remote_route": "10.2.21.0/24", "subnet_route": "10.1.21.0/24", "tenant_route_ip": "192.168.3.2", "v_name": "vxlan_t3s1"}], "rc": 0, "start": "2019-11-17 10:29:10.980301", "stderr": "", "stderr_lines": [], "stdout": "\t\t\t\t\t\t\tvxlan_t3s1", "stdout_lines": ["\t\t\t\t\t\t\tvxlan_t3s1"]}
skipping: [localhost] => (item=[{u'route': [{u'ip': u'10.1.22.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.1.22.1', u'bridge_name': u't3br2', u'dns': [{u'dnsif': u't3s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't3s2_dnsbrif'}], u'ns_name': u't3ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.22.2/24', u'tenant_ns_ip': u'10.1.22.1/24', u'tenant_ns_if': u't3ns2if', u'tenant_sub_if': u't3s2if', u'tenant_ns_name': u't3'}], u'bridge_ip': u'2.2.2.1', u'vms': [{u'mem': 3, u'name': u't3_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't3br2if1', u'vmif': u't3VM3if1'}]}, {u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}])  => {"ansible_loop_var": "item", "changed": false, "item": [{"bridge_ip": "2.2.2.1", "bridge_name": "t3br2", "default_route_ip": "10.1.22.1", "dns": [{"brif": "t3s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t3s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t3ns2", "route": [{"if": "p1", "ip": "10.1.22.1/24", "ns_if": "t3if", "ns_name": "t3"}], "tenant_ns": [{"tenant_ns_if": "t3ns2if", "tenant_ns_ip": "10.1.22.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s2if", "tenant_sub_ip": "10.1.22.2/24"}], "vms": [{"brif": "t3br2if1", "disk": "10G", "mem": 3, "name": "t3_VM3", "vcpu": 2, "vmif": "t3VM3if1"}]}, {"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}], "skip_reason": "Conditional result was False"}

PLAY RECAP **************************************************************************************************************************************************
localhost                  : ok=21   changed=19   unreachable=0    failed=0    skipped=0    rescued=0    ignored=0   

Using /etc/ansible/ansible.cfg as config file

PLAY [worker] ***********************************************************************************************************************************************

TASK [Create Tenant Namespace] ******************************************************************************************************************************
ok: [99.99.99.2] => (item={u'default_route_ip': u'192.168.131.1', u'name': u't3', u'pns_ip': u'192.168.131.1/24', u'tenant_if': u't3if', u'tenant_ip': u'192.168.131.2/24', u'pns_if': u't3pns_if'}) => {"ansible_loop_var": "item", "changed": false, "cmd": ["ip", "netns", "add", "t3"], "item": {"default_route_ip": "192.168.131.1", "name": "t3", "pns_if": "t3pns_if", "pns_ip": "192.168.131.1/24", "tenant_if": "t3if", "tenant_ip": "192.168.131.2/24"}, "rc": 0, "stdout": "skipped, since /var/run/netns/t3 exists", "stdout_lines": ["skipped, since /var/run/netns/t3 exists"]}

TASK [Create Subnet Namespace] ******************************************************************************************************************************
ok: [99.99.99.2] => (item={u'route': [{u'ip': u'10.2.21.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.2.21.1', u'bridge_name': u't3br1', u'dns': [{u'dnsif': u't3s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't3s1_dnsbrif'}], u'ns_name': u't3ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.21.2/24', u'tenant_ns_ip': u'10.2.21.1/24', u'tenant_ns_if': u't3ns1if', u'tenant_ns_name': u't3', u'tenant_sub_if': u't3s1if'}], u'bridge_ip': u'1.1.1.1', u'vms': [{u'mem': 2, u'name': u't3_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't3br1if1', u'vmif': u't3VM4if1'}, {u'mem': 2, u'name': u't3_VM5', u'vcpu': 4, u'disk': u'10G', u'brif': u't3br1if2', u'vmif': u't3VM5if1'}], u'vxlan': [{u'local_ip': u'10.2.21.2', u'tenant_route_ip': u'192.168.131.2', u'dsport': 4789, u'dev': u't3s1if', u'subnet_route': u'10.2.21.0/24', u'remote_route': u'10.1.21.0/24', u'v_name': u'vxlan_t3s1', u'id': 42, u'remote_ip': u'10.1.21.2'}]}) => {"ansible_loop_var": "item", "changed": false, "cmd": ["ip", "netns", "add", "t3ns1"], "item": {"bridge_ip": "1.1.1.1", "bridge_name": "t3br1", "default_route_ip": "10.2.21.1", "dns": [{"brif": "t3s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t3s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "ns_name": "t3ns1", "route": [{"if": "p1", "ip": "10.2.21.1/24", "ns_if": "t3if", "ns_name": "t3"}], "tenant_ns": [{"tenant_ns_if": "t3ns1if", "tenant_ns_ip": "10.2.21.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s1if", "tenant_sub_ip": "10.2.21.2/24"}], "vms": [{"brif": "t3br1if1", "disk": "10G", "mem": 2, "name": "t3_VM4", "vcpu": 4, "vmif": "t3VM4if1"}, {"brif": "t3br1if2", "disk": "10G", "mem": 2, "name": "t3_VM5", "vcpu": 4, "vmif": "t3VM5if1"}], "vxlan": [{"dev": "t3s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.21.2", "remote_ip": "10.1.21.2", "remote_route": "10.1.21.0/24", "subnet_route": "10.2.21.0/24", "tenant_route_ip": "192.168.131.2", "v_name": "vxlan_t3s1"}]}, "rc": 0, "stdout": "skipped, since /var/run/netns/t3ns1 exists", "stdout_lines": ["skipped, since /var/run/netns/t3ns1 exists"]}

TASK [Create Tenant VETH pairs] *****************************************************************************************************************************
changed: [99.99.99.2] => (item={u'default_route_ip': u'192.168.131.1', u'name': u't3', u'pns_ip': u'192.168.131.1/24', u'tenant_if': u't3if', u'tenant_ip': u'192.168.131.2/24', u'pns_if': u't3pns_if'}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip link show \"t3if\" ; if [ $? -ne 0 ] ; then ip link add \"t3if\" type veth peer name \"t3pns_if\" ; fi\n", "delta": "0:00:00.004459", "end": "2019-11-17 10:29:13.582072", "item": {"default_route_ip": "192.168.131.1", "name": "t3", "pns_if": "t3pns_if", "pns_ip": "192.168.131.1/24", "tenant_if": "t3if", "tenant_ip": "192.168.131.2/24"}, "rc": 0, "start": "2019-11-17 10:29:13.577613", "stderr": "", "stderr_lines": [], "stdout": "46: t3if@t3pns_if: <BROADCAST,MULTICAST> mtu 1500 qdisc noop state DOWN mode DEFAULT group default qlen 1000\n    link/ether 56:fe:28:a6:5e:8a brd ff:ff:ff:ff:ff:ff", "stdout_lines": ["46: t3if@t3pns_if: <BROADCAST,MULTICAST> mtu 1500 qdisc noop state DOWN mode DEFAULT group default qlen 1000", "    link/ether 56:fe:28:a6:5e:8a brd ff:ff:ff:ff:ff:ff"]}

TASK [Attach Tenant VETH Pairs] *****************************************************************************************************************************
changed: [99.99.99.2] => (item={u'default_route_ip': u'192.168.131.1', u'name': u't3', u'pns_ip': u'192.168.131.1/24', u'tenant_if': u't3if', u'tenant_ip': u'192.168.131.2/24', u'pns_if': u't3pns_if'}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec pns ip link show \"t3pns_if\" ; if [ $? -ne 0 ] ; then ip link set \"t3pns_if\" netns pns ; fi\nip netns exec \"t3\" ip link show \"t3if\" ; if [ $? -ne 0 ] ; then ip link set \"t3if\" netns \"t3\" ; fi\nip netns exec pns ip link set dev \"t3pns_if\" up\nip netns exec \"t3\" ip link set dev \"t3if\" up\n", "delta": "0:00:00.164401", "end": "2019-11-17 10:29:14.120693", "item": {"default_route_ip": "192.168.131.1", "name": "t3", "pns_if": "t3pns_if", "pns_ip": "192.168.131.1/24", "tenant_if": "t3if", "tenant_ip": "192.168.131.2/24"}, "rc": 0, "start": "2019-11-17 10:29:13.956292", "stderr": "", "stderr_lines": [], "stdout": "39: t3pns_if@if40: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP mode DEFAULT group default qlen 1000\n    link/ether 5a:b3:ce:30:c8:43 brd ff:ff:ff:ff:ff:ff link-netnsid 3\n40: t3if@if39: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP mode DEFAULT group default qlen 1000\n    link/ether fa:c6:04:a2:f5:eb brd ff:ff:ff:ff:ff:ff link-netnsid 0", "stdout_lines": ["39: t3pns_if@if40: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP mode DEFAULT group default qlen 1000", "    link/ether 5a:b3:ce:30:c8:43 brd ff:ff:ff:ff:ff:ff link-netnsid 3", "40: t3if@if39: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP mode DEFAULT group default qlen 1000", "    link/ether fa:c6:04:a2:f5:eb brd ff:ff:ff:ff:ff:ff link-netnsid 0"]}

TASK [Add IP addresses to Tenant VETH Pairs] ****************************************************************************************************************
changed: [99.99.99.2] => (item={u'default_route_ip': u'192.168.131.1', u'name': u't3', u'pns_ip': u'192.168.131.1/24', u'tenant_if': u't3if', u'tenant_ip': u'192.168.131.2/24', u'pns_if': u't3pns_if'}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec pns ip addr show \"t3pns_if\" | awk 'FNR==3{ print $2 }' | grep -w '^192.168.131.1/24' ; if [ $? -ne 0 ] ; then ip netns exec pns ip addr add \"192.168.131.1/24\" dev \"t3pns_if\" ; fi\nip netns exec \"t3\" ip addr show \"t3if\" | awk 'FNR==3{ print $2 }' | grep -w '^192.168.131.2/24' ; if [ $? -ne 0 ] ; then ip netns exec \"t3\" ip addr add \"192.168.131.2/24\" dev \"t3if\" ; fi\n", "delta": "0:00:00.070709", "end": "2019-11-17 10:29:14.556788", "item": {"default_route_ip": "192.168.131.1", "name": "t3", "pns_if": "t3pns_if", "pns_ip": "192.168.131.1/24", "tenant_if": "t3if", "tenant_ip": "192.168.131.2/24"}, "rc": 0, "start": "2019-11-17 10:29:14.486079", "stderr": "", "stderr_lines": [], "stdout": "192.168.131.1/24\n192.168.131.2/24", "stdout_lines": ["192.168.131.1/24", "192.168.131.2/24"]}

TASK [Create Namespace VETH Pairs] **************************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.21.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.2.21.1', u'bridge_name': u't3br1', u'dns': [{u'dnsif': u't3s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't3s1_dnsbrif'}], u'ns_name': u't3ns1', u'bridge_ip': u'1.1.1.1', u'vms': [{u'mem': 2, u'name': u't3_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't3br1if1', u'vmif': u't3VM4if1'}, {u'mem': 2, u'name': u't3_VM5', u'vcpu': 4, u'disk': u'10G', u'brif': u't3br1if2', u'vmif': u't3VM5if1'}], u'vxlan': [{u'local_ip': u'10.2.21.2', u'dsport': 4789, u'dev': u't3s1if', u'tenant_route_ip': u'192.168.131.2', u'remote_route': u'10.1.21.0/24', u'subnet_route': u'10.2.21.0/24', u'v_name': u'vxlan_t3s1', u'id': 42, u'remote_ip': u'10.1.21.2'}]}, {u'tenant_sub_ip': u'10.2.21.2/24', u'tenant_ns_ip': u'10.2.21.1/24', u'tenant_ns_if': u't3ns1if', u'tenant_sub_if': u't3s1if', u'tenant_ns_name': u't3'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip link show \"t3ns1if\" ; if [ $? -ne 0 ] ; then ip link add \"t3ns1if\" type veth peer name \"t3s1if\" ; fi\n", "delta": "0:00:00.004291", "end": "2019-11-17 10:29:14.926354", "item": [{"bridge_ip": "1.1.1.1", "bridge_name": "t3br1", "default_route_ip": "10.2.21.1", "dns": [{"brif": "t3s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t3s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "ns_name": "t3ns1", "route": [{"if": "p1", "ip": "10.2.21.1/24", "ns_if": "t3if", "ns_name": "t3"}], "vms": [{"brif": "t3br1if1", "disk": "10G", "mem": 2, "name": "t3_VM4", "vcpu": 4, "vmif": "t3VM4if1"}, {"brif": "t3br1if2", "disk": "10G", "mem": 2, "name": "t3_VM5", "vcpu": 4, "vmif": "t3VM5if1"}], "vxlan": [{"dev": "t3s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.21.2", "remote_ip": "10.1.21.2", "remote_route": "10.1.21.0/24", "subnet_route": "10.2.21.0/24", "tenant_route_ip": "192.168.131.2", "v_name": "vxlan_t3s1"}]}, {"tenant_ns_if": "t3ns1if", "tenant_ns_ip": "10.2.21.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s1if", "tenant_sub_ip": "10.2.21.2/24"}], "rc": 0, "start": "2019-11-17 10:29:14.922063", "stderr": "", "stderr_lines": [], "stdout": "48: t3ns1if@t3s1if: <BROADCAST,MULTICAST> mtu 1500 qdisc noop state DOWN mode DEFAULT group default qlen 1000\n    link/ether 36:e8:d3:1e:c2:db brd ff:ff:ff:ff:ff:ff", "stdout_lines": ["48: t3ns1if@t3s1if: <BROADCAST,MULTICAST> mtu 1500 qdisc noop state DOWN mode DEFAULT group default qlen 1000", "    link/ether 36:e8:d3:1e:c2:db brd ff:ff:ff:ff:ff:ff"]}

TASK [Attach Namespace VETH Pairs] **************************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.21.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.2.21.1', u'bridge_name': u't3br1', u'dns': [{u'dnsif': u't3s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't3s1_dnsbrif'}], u'ns_name': u't3ns1', u'bridge_ip': u'1.1.1.1', u'vms': [{u'mem': 2, u'name': u't3_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't3br1if1', u'vmif': u't3VM4if1'}, {u'mem': 2, u'name': u't3_VM5', u'vcpu': 4, u'disk': u'10G', u'brif': u't3br1if2', u'vmif': u't3VM5if1'}], u'vxlan': [{u'local_ip': u'10.2.21.2', u'dsport': 4789, u'dev': u't3s1if', u'tenant_route_ip': u'192.168.131.2', u'remote_route': u'10.1.21.0/24', u'subnet_route': u'10.2.21.0/24', u'v_name': u'vxlan_t3s1', u'id': 42, u'remote_ip': u'10.1.21.2'}]}, {u'tenant_sub_ip': u'10.2.21.2/24', u'tenant_ns_ip': u'10.2.21.1/24', u'tenant_ns_if': u't3ns1if', u'tenant_sub_if': u't3s1if', u'tenant_ns_name': u't3'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t3\" ip link show \"t3ns1if\" ; if [ $? -ne 0 ] ; then ip link set \"t3ns1if\" netns \"t3\" ; fi\nip netns exec \"t3ns1\" ip link show \"t3s1if\" ; if [ $? -ne 0 ] ; then ip link set \"t3s1if\" netns \"t3ns1\" ; fi\n", "delta": "0:00:00.073278", "end": "2019-11-17 10:29:15.372550", "item": [{"bridge_ip": "1.1.1.1", "bridge_name": "t3br1", "default_route_ip": "10.2.21.1", "dns": [{"brif": "t3s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t3s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "ns_name": "t3ns1", "route": [{"if": "p1", "ip": "10.2.21.1/24", "ns_if": "t3if", "ns_name": "t3"}], "vms": [{"brif": "t3br1if1", "disk": "10G", "mem": 2, "name": "t3_VM4", "vcpu": 4, "vmif": "t3VM4if1"}, {"brif": "t3br1if2", "disk": "10G", "mem": 2, "name": "t3_VM5", "vcpu": 4, "vmif": "t3VM5if1"}], "vxlan": [{"dev": "t3s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.21.2", "remote_ip": "10.1.21.2", "remote_route": "10.1.21.0/24", "subnet_route": "10.2.21.0/24", "tenant_route_ip": "192.168.131.2", "v_name": "vxlan_t3s1"}]}, {"tenant_ns_if": "t3ns1if", "tenant_ns_ip": "10.2.21.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s1if", "tenant_sub_ip": "10.2.21.2/24"}], "rc": 0, "start": "2019-11-17 10:29:15.299272", "stderr": "", "stderr_lines": [], "stdout": "42: t3ns1if@if41: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP mode DEFAULT group default qlen 1000\n    link/ether 4a:f8:5c:b8:80:b0 brd ff:ff:ff:ff:ff:ff link-netnsid 2\n41: t3s1if@if42: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP mode DEFAULT group default qlen 1000\n    link/ether 66:c2:d3:61:a2:eb brd ff:ff:ff:ff:ff:ff link-netnsid 0", "stdout_lines": ["42: t3ns1if@if41: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP mode DEFAULT group default qlen 1000", "    link/ether 4a:f8:5c:b8:80:b0 brd ff:ff:ff:ff:ff:ff link-netnsid 2", "41: t3s1if@if42: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP mode DEFAULT group default qlen 1000", "    link/ether 66:c2:d3:61:a2:eb brd ff:ff:ff:ff:ff:ff link-netnsid 0"]}

TASK [Set Namespace VETH Pairs UP] **************************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.21.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.2.21.1', u'bridge_name': u't3br1', u'dns': [{u'dnsif': u't3s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't3s1_dnsbrif'}], u'ns_name': u't3ns1', u'bridge_ip': u'1.1.1.1', u'vms': [{u'mem': 2, u'name': u't3_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't3br1if1', u'vmif': u't3VM4if1'}, {u'mem': 2, u'name': u't3_VM5', u'vcpu': 4, u'disk': u'10G', u'brif': u't3br1if2', u'vmif': u't3VM5if1'}], u'vxlan': [{u'local_ip': u'10.2.21.2', u'dsport': 4789, u'dev': u't3s1if', u'tenant_route_ip': u'192.168.131.2', u'remote_route': u'10.1.21.0/24', u'subnet_route': u'10.2.21.0/24', u'v_name': u'vxlan_t3s1', u'id': 42, u'remote_ip': u'10.1.21.2'}]}, {u'tenant_sub_ip': u'10.2.21.2/24', u'tenant_ns_ip': u'10.2.21.1/24', u'tenant_ns_if': u't3ns1if', u'tenant_sub_if': u't3s1if', u'tenant_ns_name': u't3'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t3\" ip link set dev \"t3ns1if\" up\nip netns exec \"t3ns1\" ip link set dev \"t3s1if\" up\n", "delta": "0:00:00.079619", "end": "2019-11-17 10:29:15.828510", "item": [{"bridge_ip": "1.1.1.1", "bridge_name": "t3br1", "default_route_ip": "10.2.21.1", "dns": [{"brif": "t3s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t3s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "ns_name": "t3ns1", "route": [{"if": "p1", "ip": "10.2.21.1/24", "ns_if": "t3if", "ns_name": "t3"}], "vms": [{"brif": "t3br1if1", "disk": "10G", "mem": 2, "name": "t3_VM4", "vcpu": 4, "vmif": "t3VM4if1"}, {"brif": "t3br1if2", "disk": "10G", "mem": 2, "name": "t3_VM5", "vcpu": 4, "vmif": "t3VM5if1"}], "vxlan": [{"dev": "t3s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.21.2", "remote_ip": "10.1.21.2", "remote_route": "10.1.21.0/24", "subnet_route": "10.2.21.0/24", "tenant_route_ip": "192.168.131.2", "v_name": "vxlan_t3s1"}]}, {"tenant_ns_if": "t3ns1if", "tenant_ns_ip": "10.2.21.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s1if", "tenant_sub_ip": "10.2.21.2/24"}], "rc": 0, "start": "2019-11-17 10:29:15.748891", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Add IP addresses to Namespace VETH Pairs] *************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.21.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.2.21.1', u'bridge_name': u't3br1', u'dns': [{u'dnsif': u't3s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't3s1_dnsbrif'}], u'ns_name': u't3ns1', u'bridge_ip': u'1.1.1.1', u'vms': [{u'mem': 2, u'name': u't3_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't3br1if1', u'vmif': u't3VM4if1'}, {u'mem': 2, u'name': u't3_VM5', u'vcpu': 4, u'disk': u'10G', u'brif': u't3br1if2', u'vmif': u't3VM5if1'}], u'vxlan': [{u'local_ip': u'10.2.21.2', u'dsport': 4789, u'dev': u't3s1if', u'tenant_route_ip': u'192.168.131.2', u'remote_route': u'10.1.21.0/24', u'subnet_route': u'10.2.21.0/24', u'v_name': u'vxlan_t3s1', u'id': 42, u'remote_ip': u'10.1.21.2'}]}, {u'tenant_sub_ip': u'10.2.21.2/24', u'tenant_ns_ip': u'10.2.21.1/24', u'tenant_ns_if': u't3ns1if', u'tenant_sub_if': u't3s1if', u'tenant_ns_name': u't3'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t3ns1\" ip addr show \"t3s1if\" | awk 'FNR==3{ print $2 }' | grep -w '^10.2.21.2/24' ; if [ $? -ne 0 ] ; then ip netns exec \"t3ns1\" ip addr add \"10.2.21.2/24\" dev \"t3s1if\" ; fi\n\nip netns exec \"t3\" ip addr show \"t3ns1if\" | awk 'FNR==3{ print $2 }' | grep -w '^10.2.21.1/24' ; if [ $? -ne 0 ] ; then ip netns exec \"t3\" ip addr add \"10.2.21.1/24\" dev \"t3ns1if\" ; fi\n", "delta": "0:00:00.074846", "end": "2019-11-17 10:29:16.296726", "item": [{"bridge_ip": "1.1.1.1", "bridge_name": "t3br1", "default_route_ip": "10.2.21.1", "dns": [{"brif": "t3s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t3s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "ns_name": "t3ns1", "route": [{"if": "p1", "ip": "10.2.21.1/24", "ns_if": "t3if", "ns_name": "t3"}], "vms": [{"brif": "t3br1if1", "disk": "10G", "mem": 2, "name": "t3_VM4", "vcpu": 4, "vmif": "t3VM4if1"}, {"brif": "t3br1if2", "disk": "10G", "mem": 2, "name": "t3_VM5", "vcpu": 4, "vmif": "t3VM5if1"}], "vxlan": [{"dev": "t3s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.21.2", "remote_ip": "10.1.21.2", "remote_route": "10.1.21.0/24", "subnet_route": "10.2.21.0/24", "tenant_route_ip": "192.168.131.2", "v_name": "vxlan_t3s1"}]}, {"tenant_ns_if": "t3ns1if", "tenant_ns_ip": "10.2.21.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s1if", "tenant_sub_ip": "10.2.21.2/24"}], "rc": 0, "start": "2019-11-17 10:29:16.221880", "stderr": "", "stderr_lines": [], "stdout": "10.2.21.2/24\n10.2.21.1/24", "stdout_lines": ["10.2.21.2/24", "10.2.21.1/24"]}

TASK [Add IP Route to Tenant] *******************************************************************************************************************************
changed: [99.99.99.2] => (item={u'default_route_ip': u'192.168.131.1', u'name': u't3', u'pns_ip': u'192.168.131.1/24', u'tenant_if': u't3if', u'tenant_ip': u'192.168.131.2/24', u'pns_if': u't3pns_if'}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t3\" ip route show default | grep -w '[d]efault via 192.168.131.1' ; if [ $? -ne 0 ] ; then ip netns exec \"t3\" ip route add default via \"192.168.131.1\" ; fi\n", "delta": "0:00:00.036990", "end": "2019-11-17 10:29:16.724804", "item": {"default_route_ip": "192.168.131.1", "name": "t3", "pns_if": "t3pns_if", "pns_ip": "192.168.131.1/24", "tenant_if": "t3if", "tenant_ip": "192.168.131.2/24"}, "rc": 0, "start": "2019-11-17 10:29:16.687814", "stderr": "", "stderr_lines": [], "stdout": "default via 192.168.131.1 dev t3if ", "stdout_lines": ["default via 192.168.131.1 dev t3if "]}

TASK [Add IP Route to Tenant Subnet] ************************************************************************************************************************
changed: [99.99.99.2] => (item={u'route': [{u'ip': u'10.2.21.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.2.21.1', u'bridge_name': u't3br1', u'dns': [{u'dnsif': u't3s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't3s1_dnsbrif'}], u'ns_name': u't3ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.21.2/24', u'tenant_ns_ip': u'10.2.21.1/24', u'tenant_ns_if': u't3ns1if', u'tenant_ns_name': u't3', u'tenant_sub_if': u't3s1if'}], u'bridge_ip': u'1.1.1.1', u'vms': [{u'mem': 2, u'name': u't3_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't3br1if1', u'vmif': u't3VM4if1'}, {u'mem': 2, u'name': u't3_VM5', u'vcpu': 4, u'disk': u'10G', u'brif': u't3br1if2', u'vmif': u't3VM5if1'}], u'vxlan': [{u'local_ip': u'10.2.21.2', u'tenant_route_ip': u'192.168.131.2', u'dsport': 4789, u'dev': u't3s1if', u'subnet_route': u'10.2.21.0/24', u'remote_route': u'10.1.21.0/24', u'v_name': u'vxlan_t3s1', u'id': 42, u'remote_ip': u'10.1.21.2'}]}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t3ns1\" ip route show default | grep -w '[d]efault via 10.2.21.1' ; if [ $? -ne 0 ] ; then ip netns exec \"t3ns1\" ip route add default via \"10.2.21.1\" ; fi\n", "delta": "0:00:00.039784", "end": "2019-11-17 10:29:17.152767", "item": {"bridge_ip": "1.1.1.1", "bridge_name": "t3br1", "default_route_ip": "10.2.21.1", "dns": [{"brif": "t3s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t3s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "ns_name": "t3ns1", "route": [{"if": "p1", "ip": "10.2.21.1/24", "ns_if": "t3if", "ns_name": "t3"}], "tenant_ns": [{"tenant_ns_if": "t3ns1if", "tenant_ns_ip": "10.2.21.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s1if", "tenant_sub_ip": "10.2.21.2/24"}], "vms": [{"brif": "t3br1if1", "disk": "10G", "mem": 2, "name": "t3_VM4", "vcpu": 4, "vmif": "t3VM4if1"}, {"brif": "t3br1if2", "disk": "10G", "mem": 2, "name": "t3_VM5", "vcpu": 4, "vmif": "t3VM5if1"}], "vxlan": [{"dev": "t3s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.21.2", "remote_ip": "10.1.21.2", "remote_route": "10.1.21.0/24", "subnet_route": "10.2.21.0/24", "tenant_route_ip": "192.168.131.2", "v_name": "vxlan_t3s1"}]}, "rc": 0, "start": "2019-11-17 10:29:17.112983", "stderr": "", "stderr_lines": [], "stdout": "default via 10.2.21.1 dev t3s1if ", "stdout_lines": ["default via 10.2.21.1 dev t3s1if "]}

TASK [Create bridge inside namespace] ***********************************************************************************************************************
changed: [99.99.99.2] => (item={u'route': [{u'ip': u'10.2.21.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.2.21.1', u'bridge_name': u't3br1', u'dns': [{u'dnsif': u't3s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't3s1_dnsbrif'}], u'ns_name': u't3ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.21.2/24', u'tenant_ns_ip': u'10.2.21.1/24', u'tenant_ns_if': u't3ns1if', u'tenant_ns_name': u't3', u'tenant_sub_if': u't3s1if'}], u'bridge_ip': u'1.1.1.1', u'vms': [{u'mem': 2, u'name': u't3_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't3br1if1', u'vmif': u't3VM4if1'}, {u'mem': 2, u'name': u't3_VM5', u'vcpu': 4, u'disk': u'10G', u'brif': u't3br1if2', u'vmif': u't3VM5if1'}], u'vxlan': [{u'local_ip': u'10.2.21.2', u'tenant_route_ip': u'192.168.131.2', u'dsport': 4789, u'dev': u't3s1if', u'subnet_route': u'10.2.21.0/24', u'remote_route': u'10.1.21.0/24', u'v_name': u'vxlan_t3s1', u'id': 42, u'remote_ip': u'10.1.21.2'}]}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t3ns1\" brctl show | grep -w '^t3br1'; if [ $? -ne 0 ] ; then ip netns exec \"t3ns1\" brctl addbr \"t3br1\" ; fi\nip netns exec \"t3ns1\" ip link set dev \"t3br1\" up\n", "delta": "0:00:00.069429", "end": "2019-11-17 10:29:17.592421", "item": {"bridge_ip": "1.1.1.1", "bridge_name": "t3br1", "default_route_ip": "10.2.21.1", "dns": [{"brif": "t3s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t3s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "ns_name": "t3ns1", "route": [{"if": "p1", "ip": "10.2.21.1/24", "ns_if": "t3if", "ns_name": "t3"}], "tenant_ns": [{"tenant_ns_if": "t3ns1if", "tenant_ns_ip": "10.2.21.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s1if", "tenant_sub_ip": "10.2.21.2/24"}], "vms": [{"brif": "t3br1if1", "disk": "10G", "mem": 2, "name": "t3_VM4", "vcpu": 4, "vmif": "t3VM4if1"}, {"brif": "t3br1if2", "disk": "10G", "mem": 2, "name": "t3_VM5", "vcpu": 4, "vmif": "t3VM5if1"}], "vxlan": [{"dev": "t3s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.21.2", "remote_ip": "10.1.21.2", "remote_route": "10.1.21.0/24", "subnet_route": "10.2.21.0/24", "tenant_route_ip": "192.168.131.2", "v_name": "vxlan_t3s1"}]}, "rc": 0, "start": "2019-11-17 10:29:17.522992", "stderr": "", "stderr_lines": [], "stdout": "t3br1\t\t8000.6ea2f3411004\tno\t\tt3br1if1", "stdout_lines": ["t3br1\t\t8000.6ea2f3411004\tno\t\tt3br1if1"]}

TASK [Create DNS VETH Pair] *********************************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.21.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.2.21.1', u'bridge_name': u't3br1', u'ns_name': u't3ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.21.2/24', u'tenant_ns_ip': u'10.2.21.1/24', u'tenant_ns_if': u't3ns1if', u'tenant_sub_if': u't3s1if', u'tenant_ns_name': u't3'}], u'bridge_ip': u'1.1.1.1', u'vms': [{u'mem': 2, u'name': u't3_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't3br1if1', u'vmif': u't3VM4if1'}, {u'mem': 2, u'name': u't3_VM5', u'vcpu': 4, u'disk': u'10G', u'brif': u't3br1if2', u'vmif': u't3VM5if1'}], u'vxlan': [{u'local_ip': u'10.2.21.2', u'dsport': 4789, u'dev': u't3s1if', u'tenant_route_ip': u'192.168.131.2', u'remote_route': u'10.1.21.0/24', u'subnet_route': u'10.2.21.0/24', u'v_name': u'vxlan_t3s1', u'id': 42, u'remote_ip': u'10.1.21.2'}]}, {u'dnsif': u't3s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't3s1_dnsbrif'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t3ns1\" ip link show \"t3s1_dnsbrif\" ; if [ $? -ne 0 ] ; then ip netns exec \"t3ns1\" ip link add \"t3s1_dnsbrif\" type veth peer name \"t3s1_dnsif\" ; fi\nip netns exec \"t3ns1\" ip link set dev \"t3s1_dnsbrif\" up\nip netns exec \"t3ns1\" ip link set dev \"t3s1_dnsif\" up\n", "delta": "0:00:00.110048", "end": "2019-11-17 10:29:18.064405", "item": [{"bridge_ip": "1.1.1.1", "bridge_name": "t3br1", "default_route_ip": "10.2.21.1", "ns_name": "t3ns1", "route": [{"if": "p1", "ip": "10.2.21.1/24", "ns_if": "t3if", "ns_name": "t3"}], "tenant_ns": [{"tenant_ns_if": "t3ns1if", "tenant_ns_ip": "10.2.21.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s1if", "tenant_sub_ip": "10.2.21.2/24"}], "vms": [{"brif": "t3br1if1", "disk": "10G", "mem": 2, "name": "t3_VM4", "vcpu": 4, "vmif": "t3VM4if1"}, {"brif": "t3br1if2", "disk": "10G", "mem": 2, "name": "t3_VM5", "vcpu": 4, "vmif": "t3VM5if1"}], "vxlan": [{"dev": "t3s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.21.2", "remote_ip": "10.1.21.2", "remote_route": "10.1.21.0/24", "subnet_route": "10.2.21.0/24", "tenant_route_ip": "192.168.131.2", "v_name": "vxlan_t3s1"}]}, {"brif": "t3s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t3s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "rc": 0, "start": "2019-11-17 10:29:17.954357", "stderr": "", "stderr_lines": [], "stdout": "4: t3s1_dnsbrif@t3s1_dnsif: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue master t3br1 state UP mode DEFAULT group default qlen 1000\n    link/ether de:32:48:ca:2e:9d brd ff:ff:ff:ff:ff:ff", "stdout_lines": ["4: t3s1_dnsbrif@t3s1_dnsif: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue master t3br1 state UP mode DEFAULT group default qlen 1000", "    link/ether de:32:48:ca:2e:9d brd ff:ff:ff:ff:ff:ff"]}

TASK [Attach DNS VETH Pair] *********************************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.21.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.2.21.1', u'bridge_name': u't3br1', u'ns_name': u't3ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.21.2/24', u'tenant_ns_ip': u'10.2.21.1/24', u'tenant_ns_if': u't3ns1if', u'tenant_sub_if': u't3s1if', u'tenant_ns_name': u't3'}], u'bridge_ip': u'1.1.1.1', u'vms': [{u'mem': 2, u'name': u't3_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't3br1if1', u'vmif': u't3VM4if1'}, {u'mem': 2, u'name': u't3_VM5', u'vcpu': 4, u'disk': u'10G', u'brif': u't3br1if2', u'vmif': u't3VM5if1'}], u'vxlan': [{u'local_ip': u'10.2.21.2', u'dsport': 4789, u'dev': u't3s1if', u'tenant_route_ip': u'192.168.131.2', u'remote_route': u'10.1.21.0/24', u'subnet_route': u'10.2.21.0/24', u'v_name': u'vxlan_t3s1', u'id': 42, u'remote_ip': u'10.1.21.2'}]}, {u'dnsif': u't3s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't3s1_dnsbrif'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t3ns1\" brctl show \"t3br1\" | grep -w 't3s1_dnsbrif' ; if [ $? -ne 0 ] ; then ip netns exec \"t3ns1\" brctl addif \"t3br1\" \"t3s1_dnsbrif\" ; fi\n", "delta": "0:00:00.035827", "end": "2019-11-17 10:29:18.492520", "item": [{"bridge_ip": "1.1.1.1", "bridge_name": "t3br1", "default_route_ip": "10.2.21.1", "ns_name": "t3ns1", "route": [{"if": "p1", "ip": "10.2.21.1/24", "ns_if": "t3if", "ns_name": "t3"}], "tenant_ns": [{"tenant_ns_if": "t3ns1if", "tenant_ns_ip": "10.2.21.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s1if", "tenant_sub_ip": "10.2.21.2/24"}], "vms": [{"brif": "t3br1if1", "disk": "10G", "mem": 2, "name": "t3_VM4", "vcpu": 4, "vmif": "t3VM4if1"}, {"brif": "t3br1if2", "disk": "10G", "mem": 2, "name": "t3_VM5", "vcpu": 4, "vmif": "t3VM5if1"}], "vxlan": [{"dev": "t3s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.21.2", "remote_ip": "10.1.21.2", "remote_route": "10.1.21.0/24", "subnet_route": "10.2.21.0/24", "tenant_route_ip": "192.168.131.2", "v_name": "vxlan_t3s1"}]}, {"brif": "t3s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t3s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "rc": 0, "start": "2019-11-17 10:29:18.456693", "stderr": "", "stderr_lines": [], "stdout": "\t\t\t\t\t\t\tt3s1_dnsbrif", "stdout_lines": ["\t\t\t\t\t\t\tt3s1_dnsbrif"]}

TASK [Create VETH Pairs] ************************************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.21.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.2.21.1', u'bridge_name': u't3br1', u'dns': [{u'dnsif': u't3s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't3s1_dnsbrif'}], u'ns_name': u't3ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.21.2/24', u'tenant_ns_ip': u'10.2.21.1/24', u'tenant_ns_if': u't3ns1if', u'tenant_sub_if': u't3s1if', u'tenant_ns_name': u't3'}], u'bridge_ip': u'1.1.1.1', u'vxlan': [{u'local_ip': u'10.2.21.2', u'dsport': 4789, u'dev': u't3s1if', u'tenant_route_ip': u'192.168.131.2', u'remote_route': u'10.1.21.0/24', u'subnet_route': u'10.2.21.0/24', u'v_name': u'vxlan_t3s1', u'id': 42, u'remote_ip': u'10.1.21.2'}]}, {u'mem': 2, u'name': u't3_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't3br1if1', u'vmif': u't3VM4if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip link show \"t3br1if1\" ; if [ $? -ne 0 ] ; then ip link add \"t3VM4if1\" type veth peer name \"t3br1if1\" ; fi\nip link set dev \"t3br1if1\" up\nip link set dev \"t3VM4if1\" up\n", "delta": "0:00:00.012985", "end": "2019-11-17 10:29:18.898577", "item": [{"bridge_ip": "1.1.1.1", "bridge_name": "t3br1", "default_route_ip": "10.2.21.1", "dns": [{"brif": "t3s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t3s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "ns_name": "t3ns1", "route": [{"if": "p1", "ip": "10.2.21.1/24", "ns_if": "t3if", "ns_name": "t3"}], "tenant_ns": [{"tenant_ns_if": "t3ns1if", "tenant_ns_ip": "10.2.21.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s1if", "tenant_sub_ip": "10.2.21.2/24"}], "vxlan": [{"dev": "t3s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.21.2", "remote_ip": "10.1.21.2", "remote_route": "10.1.21.0/24", "subnet_route": "10.2.21.0/24", "tenant_route_ip": "192.168.131.2", "v_name": "vxlan_t3s1"}]}, {"brif": "t3br1if1", "disk": "10G", "mem": 2, "name": "t3_VM4", "vcpu": 4, "vmif": "t3VM4if1"}], "rc": 0, "start": "2019-11-17 10:29:18.885592", "stderr": "Device \"t3br1if1\" does not exist.\nRTNETLINK answers: File exists\nCannot find device \"t3br1if1\"", "stderr_lines": ["Device \"t3br1if1\" does not exist.", "RTNETLINK answers: File exists", "Cannot find device \"t3br1if1\""], "stdout": "", "stdout_lines": []}
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.21.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.2.21.1', u'bridge_name': u't3br1', u'dns': [{u'dnsif': u't3s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't3s1_dnsbrif'}], u'ns_name': u't3ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.21.2/24', u'tenant_ns_ip': u'10.2.21.1/24', u'tenant_ns_if': u't3ns1if', u'tenant_sub_if': u't3s1if', u'tenant_ns_name': u't3'}], u'bridge_ip': u'1.1.1.1', u'vxlan': [{u'local_ip': u'10.2.21.2', u'dsport': 4789, u'dev': u't3s1if', u'tenant_route_ip': u'192.168.131.2', u'remote_route': u'10.1.21.0/24', u'subnet_route': u'10.2.21.0/24', u'v_name': u'vxlan_t3s1', u'id': 42, u'remote_ip': u'10.1.21.2'}]}, {u'mem': 2, u'name': u't3_VM5', u'vcpu': 4, u'disk': u'10G', u'brif': u't3br1if2', u'vmif': u't3VM5if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip link show \"t3br1if2\" ; if [ $? -ne 0 ] ; then ip link add \"t3VM5if1\" type veth peer name \"t3br1if2\" ; fi\nip link set dev \"t3br1if2\" up\nip link set dev \"t3VM5if1\" up\n", "delta": "0:00:00.019352", "end": "2019-11-17 10:29:19.241207", "item": [{"bridge_ip": "1.1.1.1", "bridge_name": "t3br1", "default_route_ip": "10.2.21.1", "dns": [{"brif": "t3s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t3s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "ns_name": "t3ns1", "route": [{"if": "p1", "ip": "10.2.21.1/24", "ns_if": "t3if", "ns_name": "t3"}], "tenant_ns": [{"tenant_ns_if": "t3ns1if", "tenant_ns_ip": "10.2.21.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s1if", "tenant_sub_ip": "10.2.21.2/24"}], "vxlan": [{"dev": "t3s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.21.2", "remote_ip": "10.1.21.2", "remote_route": "10.1.21.0/24", "subnet_route": "10.2.21.0/24", "tenant_route_ip": "192.168.131.2", "v_name": "vxlan_t3s1"}]}, {"brif": "t3br1if2", "disk": "10G", "mem": 2, "name": "t3_VM5", "vcpu": 4, "vmif": "t3VM5if1"}], "rc": 0, "start": "2019-11-17 10:29:19.221855", "stderr": "Device \"t3br1if2\" does not exist.", "stderr_lines": ["Device \"t3br1if2\" does not exist."], "stdout": "", "stdout_lines": []}

TASK [Attach VETH Pairs] ************************************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.21.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.2.21.1', u'bridge_name': u't3br1', u'dns': [{u'dnsif': u't3s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't3s1_dnsbrif'}], u'ns_name': u't3ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.21.2/24', u'tenant_ns_ip': u'10.2.21.1/24', u'tenant_ns_if': u't3ns1if', u'tenant_sub_if': u't3s1if', u'tenant_ns_name': u't3'}], u'bridge_ip': u'1.1.1.1', u'vxlan': [{u'local_ip': u'10.2.21.2', u'dsport': 4789, u'dev': u't3s1if', u'tenant_route_ip': u'192.168.131.2', u'remote_route': u'10.1.21.0/24', u'subnet_route': u'10.2.21.0/24', u'v_name': u'vxlan_t3s1', u'id': 42, u'remote_ip': u'10.1.21.2'}]}, {u'mem': 2, u'name': u't3_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't3br1if1', u'vmif': u't3VM4if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip link show \"t3br1if1\" ; if [ $? -eq 0 ] ; then ip link set \"t3br1if1\" netns \"t3ns1\" ; fi\nip netns exec \"t3ns1\" brctl show \"t3br1\" | grep -w 't3br1if1' ; if [ $? -ne 0 ] ; then ip netns exec \"t3ns1\" brctl addif \"t3br1\" \"t3br1if1\" ; fi\n", "delta": "0:00:00.047675", "end": "2019-11-17 10:29:19.692425", "item": [{"bridge_ip": "1.1.1.1", "bridge_name": "t3br1", "default_route_ip": "10.2.21.1", "dns": [{"brif": "t3s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t3s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "ns_name": "t3ns1", "route": [{"if": "p1", "ip": "10.2.21.1/24", "ns_if": "t3if", "ns_name": "t3"}], "tenant_ns": [{"tenant_ns_if": "t3ns1if", "tenant_ns_ip": "10.2.21.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s1if", "tenant_sub_ip": "10.2.21.2/24"}], "vxlan": [{"dev": "t3s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.21.2", "remote_ip": "10.1.21.2", "remote_route": "10.1.21.0/24", "subnet_route": "10.2.21.0/24", "tenant_route_ip": "192.168.131.2", "v_name": "vxlan_t3s1"}]}, {"brif": "t3br1if1", "disk": "10G", "mem": 2, "name": "t3_VM4", "vcpu": 4, "vmif": "t3VM4if1"}], "rc": 0, "start": "2019-11-17 10:29:19.644750", "stderr": "Device \"t3br1if1\" does not exist.", "stderr_lines": ["Device \"t3br1if1\" does not exist."], "stdout": "t3br1\t\t8000.6ea2f3411004\tno\t\tt3br1if1", "stdout_lines": ["t3br1\t\t8000.6ea2f3411004\tno\t\tt3br1if1"]}
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.21.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.2.21.1', u'bridge_name': u't3br1', u'dns': [{u'dnsif': u't3s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't3s1_dnsbrif'}], u'ns_name': u't3ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.21.2/24', u'tenant_ns_ip': u'10.2.21.1/24', u'tenant_ns_if': u't3ns1if', u'tenant_sub_if': u't3s1if', u'tenant_ns_name': u't3'}], u'bridge_ip': u'1.1.1.1', u'vxlan': [{u'local_ip': u'10.2.21.2', u'dsport': 4789, u'dev': u't3s1if', u'tenant_route_ip': u'192.168.131.2', u'remote_route': u'10.1.21.0/24', u'subnet_route': u'10.2.21.0/24', u'v_name': u'vxlan_t3s1', u'id': 42, u'remote_ip': u'10.1.21.2'}]}, {u'mem': 2, u'name': u't3_VM5', u'vcpu': 4, u'disk': u'10G', u'brif': u't3br1if2', u'vmif': u't3VM5if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip link show \"t3br1if2\" ; if [ $? -eq 0 ] ; then ip link set \"t3br1if2\" netns \"t3ns1\" ; fi\nip netns exec \"t3ns1\" brctl show \"t3br1\" | grep -w 't3br1if2' ; if [ $? -ne 0 ] ; then ip netns exec \"t3ns1\" brctl addif \"t3br1\" \"t3br1if2\" ; fi\n", "delta": "0:00:00.135509", "end": "2019-11-17 10:29:20.136284", "item": [{"bridge_ip": "1.1.1.1", "bridge_name": "t3br1", "default_route_ip": "10.2.21.1", "dns": [{"brif": "t3s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t3s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "ns_name": "t3ns1", "route": [{"if": "p1", "ip": "10.2.21.1/24", "ns_if": "t3if", "ns_name": "t3"}], "tenant_ns": [{"tenant_ns_if": "t3ns1if", "tenant_ns_ip": "10.2.21.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s1if", "tenant_sub_ip": "10.2.21.2/24"}], "vxlan": [{"dev": "t3s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.21.2", "remote_ip": "10.1.21.2", "remote_route": "10.1.21.0/24", "subnet_route": "10.2.21.0/24", "tenant_route_ip": "192.168.131.2", "v_name": "vxlan_t3s1"}]}, {"brif": "t3br1if2", "disk": "10G", "mem": 2, "name": "t3_VM5", "vcpu": 4, "vmif": "t3VM5if1"}], "rc": 0, "start": "2019-11-17 10:29:20.000775", "stderr": "", "stderr_lines": [], "stdout": "50: t3br1if2@t3VM5if1: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP mode DEFAULT group default qlen 1000\n    link/ether ca:68:8c:b3:98:70 brd ff:ff:ff:ff:ff:ff", "stdout_lines": ["50: t3br1if2@t3VM5if1: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP mode DEFAULT group default qlen 1000", "    link/ether ca:68:8c:b3:98:70 brd ff:ff:ff:ff:ff:ff"]}

TASK [All interfaces and bridges UP] ************************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.21.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.2.21.1', u'bridge_name': u't3br1', u'dns': [{u'dnsif': u't3s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't3s1_dnsbrif'}], u'ns_name': u't3ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.21.2/24', u'tenant_ns_ip': u'10.2.21.1/24', u'tenant_ns_if': u't3ns1if', u'tenant_sub_if': u't3s1if', u'tenant_ns_name': u't3'}], u'bridge_ip': u'1.1.1.1', u'vxlan': [{u'local_ip': u'10.2.21.2', u'dsport': 4789, u'dev': u't3s1if', u'tenant_route_ip': u'192.168.131.2', u'remote_route': u'10.1.21.0/24', u'subnet_route': u'10.2.21.0/24', u'v_name': u'vxlan_t3s1', u'id': 42, u'remote_ip': u'10.1.21.2'}]}, {u'mem': 2, u'name': u't3_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't3br1if1', u'vmif': u't3VM4if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t3ns1\" ip link set \"t3br1if1\" up\nip netns exec \"t3ns1\" ip link set dev \"t3br1\" up\n", "delta": "0:00:00.083689", "end": "2019-11-17 10:29:20.592528", "item": [{"bridge_ip": "1.1.1.1", "bridge_name": "t3br1", "default_route_ip": "10.2.21.1", "dns": [{"brif": "t3s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t3s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "ns_name": "t3ns1", "route": [{"if": "p1", "ip": "10.2.21.1/24", "ns_if": "t3if", "ns_name": "t3"}], "tenant_ns": [{"tenant_ns_if": "t3ns1if", "tenant_ns_ip": "10.2.21.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s1if", "tenant_sub_ip": "10.2.21.2/24"}], "vxlan": [{"dev": "t3s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.21.2", "remote_ip": "10.1.21.2", "remote_route": "10.1.21.0/24", "subnet_route": "10.2.21.0/24", "tenant_route_ip": "192.168.131.2", "v_name": "vxlan_t3s1"}]}, {"brif": "t3br1if1", "disk": "10G", "mem": 2, "name": "t3_VM4", "vcpu": 4, "vmif": "t3VM4if1"}], "rc": 0, "start": "2019-11-17 10:29:20.508839", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.21.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.2.21.1', u'bridge_name': u't3br1', u'dns': [{u'dnsif': u't3s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't3s1_dnsbrif'}], u'ns_name': u't3ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.21.2/24', u'tenant_ns_ip': u'10.2.21.1/24', u'tenant_ns_if': u't3ns1if', u'tenant_sub_if': u't3s1if', u'tenant_ns_name': u't3'}], u'bridge_ip': u'1.1.1.1', u'vxlan': [{u'local_ip': u'10.2.21.2', u'dsport': 4789, u'dev': u't3s1if', u'tenant_route_ip': u'192.168.131.2', u'remote_route': u'10.1.21.0/24', u'subnet_route': u'10.2.21.0/24', u'v_name': u'vxlan_t3s1', u'id': 42, u'remote_ip': u'10.1.21.2'}]}, {u'mem': 2, u'name': u't3_VM5', u'vcpu': 4, u'disk': u'10G', u'brif': u't3br1if2', u'vmif': u't3VM5if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t3ns1\" ip link set \"t3br1if2\" up\nip netns exec \"t3ns1\" ip link set dev \"t3br1\" up\n", "delta": "0:00:00.079372", "end": "2019-11-17 10:29:20.992483", "item": [{"bridge_ip": "1.1.1.1", "bridge_name": "t3br1", "default_route_ip": "10.2.21.1", "dns": [{"brif": "t3s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t3s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "ns_name": "t3ns1", "route": [{"if": "p1", "ip": "10.2.21.1/24", "ns_if": "t3if", "ns_name": "t3"}], "tenant_ns": [{"tenant_ns_if": "t3ns1if", "tenant_ns_ip": "10.2.21.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s1if", "tenant_sub_ip": "10.2.21.2/24"}], "vxlan": [{"dev": "t3s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.21.2", "remote_ip": "10.1.21.2", "remote_route": "10.1.21.0/24", "subnet_route": "10.2.21.0/24", "tenant_route_ip": "192.168.131.2", "v_name": "vxlan_t3s1"}]}, {"brif": "t3br1if2", "disk": "10G", "mem": 2, "name": "t3_VM5", "vcpu": 4, "vmif": "t3VM5if1"}], "rc": 0, "start": "2019-11-17 10:29:20.913111", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Add IP to DNS Interface] ******************************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.21.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.2.21.1', u'bridge_name': u't3br1', u'ns_name': u't3ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.21.2/24', u'tenant_ns_ip': u'10.2.21.1/24', u'tenant_ns_if': u't3ns1if', u'tenant_sub_if': u't3s1if', u'tenant_ns_name': u't3'}], u'bridge_ip': u'1.1.1.1', u'vms': [{u'mem': 2, u'name': u't3_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't3br1if1', u'vmif': u't3VM4if1'}, {u'mem': 2, u'name': u't3_VM5', u'vcpu': 4, u'disk': u'10G', u'brif': u't3br1if2', u'vmif': u't3VM5if1'}], u'vxlan': [{u'local_ip': u'10.2.21.2', u'dsport': 4789, u'dev': u't3s1if', u'tenant_route_ip': u'192.168.131.2', u'remote_route': u'10.1.21.0/24', u'subnet_route': u'10.2.21.0/24', u'v_name': u'vxlan_t3s1', u'id': 42, u'remote_ip': u'10.1.21.2'}]}, {u'dnsif': u't3s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't3s1_dnsbrif'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t3ns1\" ip addr show \"t3s1_dnsif\" | awk 'FNR==3{ print $2}'| grep -w '^1.1.1.128/24' ; if [ $? -ne 0 ] ; then ip netns exec \"t3ns1\" ip addr add \"1.1.1.128/24\" dev \"t3s1_dnsif\" ; fi\n", "delta": "0:00:00.054707", "end": "2019-11-17 10:29:21.456926", "item": [{"bridge_ip": "1.1.1.1", "bridge_name": "t3br1", "default_route_ip": "10.2.21.1", "ns_name": "t3ns1", "route": [{"if": "p1", "ip": "10.2.21.1/24", "ns_if": "t3if", "ns_name": "t3"}], "tenant_ns": [{"tenant_ns_if": "t3ns1if", "tenant_ns_ip": "10.2.21.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s1if", "tenant_sub_ip": "10.2.21.2/24"}], "vms": [{"brif": "t3br1if1", "disk": "10G", "mem": 2, "name": "t3_VM4", "vcpu": 4, "vmif": "t3VM4if1"}, {"brif": "t3br1if2", "disk": "10G", "mem": 2, "name": "t3_VM5", "vcpu": 4, "vmif": "t3VM5if1"}], "vxlan": [{"dev": "t3s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.21.2", "remote_ip": "10.1.21.2", "remote_route": "10.1.21.0/24", "subnet_route": "10.2.21.0/24", "tenant_route_ip": "192.168.131.2", "v_name": "vxlan_t3s1"}]}, {"brif": "t3s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t3s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "rc": 0, "start": "2019-11-17 10:29:21.402219", "stderr": "", "stderr_lines": [], "stdout": "1.1.1.128/24", "stdout_lines": ["1.1.1.128/24"]}

TASK [Install DHCP Server] **********************************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.21.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.2.21.1', u'bridge_name': u't3br1', u'ns_name': u't3ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.21.2/24', u'tenant_ns_ip': u'10.2.21.1/24', u'tenant_ns_if': u't3ns1if', u'tenant_sub_if': u't3s1if', u'tenant_ns_name': u't3'}], u'bridge_ip': u'1.1.1.1', u'vms': [{u'mem': 2, u'name': u't3_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't3br1if1', u'vmif': u't3VM4if1'}, {u'mem': 2, u'name': u't3_VM5', u'vcpu': 4, u'disk': u'10G', u'brif': u't3br1if2', u'vmif': u't3VM5if1'}], u'vxlan': [{u'local_ip': u'10.2.21.2', u'dsport': 4789, u'dev': u't3s1if', u'tenant_route_ip': u'192.168.131.2', u'remote_route': u'10.1.21.0/24', u'subnet_route': u'10.2.21.0/24', u'v_name': u'vxlan_t3s1', u'id': 42, u'remote_ip': u'10.1.21.2'}]}, {u'dnsif': u't3s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't3s1_dnsbrif'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t3ns1\" ps aux | grep -w '[d]nsmasq --interface t3s1_dnsif -z --dhcp-range=1.1.1.133,1.1.1.254' ; if [ $? -ne 0 ] ; then ip netns exec \"t3ns1\" dnsmasq --interface \"t3s1_dnsif\" -z --dhcp-range=1.1.1.133,'1.1.1.254' ; fi\n", "delta": "0:00:00.044732", "end": "2019-11-17 10:29:21.900409", "item": [{"bridge_ip": "1.1.1.1", "bridge_name": "t3br1", "default_route_ip": "10.2.21.1", "ns_name": "t3ns1", "route": [{"if": "p1", "ip": "10.2.21.1/24", "ns_if": "t3if", "ns_name": "t3"}], "tenant_ns": [{"tenant_ns_if": "t3ns1if", "tenant_ns_ip": "10.2.21.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s1if", "tenant_sub_ip": "10.2.21.2/24"}], "vms": [{"brif": "t3br1if1", "disk": "10G", "mem": 2, "name": "t3_VM4", "vcpu": 4, "vmif": "t3VM4if1"}, {"brif": "t3br1if2", "disk": "10G", "mem": 2, "name": "t3_VM5", "vcpu": 4, "vmif": "t3VM5if1"}], "vxlan": [{"dev": "t3s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.21.2", "remote_ip": "10.1.21.2", "remote_route": "10.1.21.0/24", "subnet_route": "10.2.21.0/24", "tenant_route_ip": "192.168.131.2", "v_name": "vxlan_t3s1"}]}, {"brif": "t3s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t3s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "rc": 0, "start": "2019-11-17 10:29:21.855677", "stderr": "", "stderr_lines": [], "stdout": "nobody    8900  0.0  0.0  51580  2788 ?        S    10:24   0:00 dnsmasq --interface t3s1_dnsif -z --dhcp-range=1.1.1.133,1.1.1.254", "stdout_lines": ["nobody    8900  0.0  0.0  51580  2788 ?        S    10:24   0:00 dnsmasq --interface t3s1_dnsif -z --dhcp-range=1.1.1.133,1.1.1.254"]}

TASK [Create VXLAN devices] *********************************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.21.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.2.21.1', u'bridge_name': u't3br1', u'dns': [{u'dnsif': u't3s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't3s1_dnsbrif'}], u'ns_name': u't3ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.21.2/24', u'tenant_ns_ip': u'10.2.21.1/24', u'tenant_ns_if': u't3ns1if', u'tenant_sub_if': u't3s1if', u'tenant_ns_name': u't3'}], u'bridge_ip': u'1.1.1.1', u'vms': [{u'mem': 2, u'name': u't3_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't3br1if1', u'vmif': u't3VM4if1'}, {u'mem': 2, u'name': u't3_VM5', u'vcpu': 4, u'disk': u'10G', u'brif': u't3br1if2', u'vmif': u't3VM5if1'}]}, {u'local_ip': u'10.2.21.2', u'dsport': 4789, u'dev': u't3s1if', u'tenant_route_ip': u'192.168.131.2', u'remote_route': u'10.1.21.0/24', u'subnet_route': u'10.2.21.0/24', u'v_name': u'vxlan_t3s1', u'id': 42, u'remote_ip': u'10.1.21.2'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t3ns1\" ip link show \"vxlan_t3s1\" ; if [ $? -ne 0 ] ; then ip netns exec \"t3ns1\" ip link add \"vxlan_t3s1\" type vxlan id \"42\" local \"10.2.21.2\" remote \"10.1.21.2\" dstport \"4789\" dev \"t3s1if\" ; ip netns exec \"t3ns1\" ip link set dev \"vxlan_t3s1\" up ; fi\n", "delta": "0:00:00.040302", "end": "2019-11-17 10:29:22.328493", "item": [{"bridge_ip": "1.1.1.1", "bridge_name": "t3br1", "default_route_ip": "10.2.21.1", "dns": [{"brif": "t3s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t3s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "ns_name": "t3ns1", "route": [{"if": "p1", "ip": "10.2.21.1/24", "ns_if": "t3if", "ns_name": "t3"}], "tenant_ns": [{"tenant_ns_if": "t3ns1if", "tenant_ns_ip": "10.2.21.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s1if", "tenant_sub_ip": "10.2.21.2/24"}], "vms": [{"brif": "t3br1if1", "disk": "10G", "mem": 2, "name": "t3_VM4", "vcpu": 4, "vmif": "t3VM4if1"}, {"brif": "t3br1if2", "disk": "10G", "mem": 2, "name": "t3_VM5", "vcpu": 4, "vmif": "t3VM5if1"}]}, {"dev": "t3s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.21.2", "remote_ip": "10.1.21.2", "remote_route": "10.1.21.0/24", "subnet_route": "10.2.21.0/24", "tenant_route_ip": "192.168.131.2", "v_name": "vxlan_t3s1"}], "rc": 0, "start": "2019-11-17 10:29:22.288191", "stderr": "", "stderr_lines": [], "stdout": "5: vxlan_t3s1: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1450 qdisc noqueue master t3br1 state UNKNOWN mode DEFAULT group default qlen 1000\n    link/ether c2:45:ef:bd:f6:fc brd ff:ff:ff:ff:ff:ff", "stdout_lines": ["5: vxlan_t3s1: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1450 qdisc noqueue master t3br1 state UNKNOWN mode DEFAULT group default qlen 1000", "    link/ether c2:45:ef:bd:f6:fc brd ff:ff:ff:ff:ff:ff"]}

TASK [Attach VXLANs to bridge] ******************************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.21.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.2.21.1', u'bridge_name': u't3br1', u'dns': [{u'dnsif': u't3s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't3s1_dnsbrif'}], u'ns_name': u't3ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.21.2/24', u'tenant_ns_ip': u'10.2.21.1/24', u'tenant_ns_if': u't3ns1if', u'tenant_sub_if': u't3s1if', u'tenant_ns_name': u't3'}], u'bridge_ip': u'1.1.1.1', u'vms': [{u'mem': 2, u'name': u't3_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't3br1if1', u'vmif': u't3VM4if1'}, {u'mem': 2, u'name': u't3_VM5', u'vcpu': 4, u'disk': u'10G', u'brif': u't3br1if2', u'vmif': u't3VM5if1'}]}, {u'local_ip': u'10.2.21.2', u'dsport': 4789, u'dev': u't3s1if', u'tenant_route_ip': u'192.168.131.2', u'remote_route': u'10.1.21.0/24', u'subnet_route': u'10.2.21.0/24', u'v_name': u'vxlan_t3s1', u'id': 42, u'remote_ip': u'10.1.21.2'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t3ns1\" brctl show \"t3br1\" | grep -w 'vxlan_t3s1' ; if [ $? -ne 0 ] ; then ip netns exec \"t3ns1\" brctl addif \"t3br1\" \"vxlan_t3s1\" ; fi\n", "delta": "0:00:00.044813", "end": "2019-11-17 10:29:22.800529", "item": [{"bridge_ip": "1.1.1.1", "bridge_name": "t3br1", "default_route_ip": "10.2.21.1", "dns": [{"brif": "t3s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t3s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "ns_name": "t3ns1", "route": [{"if": "p1", "ip": "10.2.21.1/24", "ns_if": "t3if", "ns_name": "t3"}], "tenant_ns": [{"tenant_ns_if": "t3ns1if", "tenant_ns_ip": "10.2.21.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s1if", "tenant_sub_ip": "10.2.21.2/24"}], "vms": [{"brif": "t3br1if1", "disk": "10G", "mem": 2, "name": "t3_VM4", "vcpu": 4, "vmif": "t3VM4if1"}, {"brif": "t3br1if2", "disk": "10G", "mem": 2, "name": "t3_VM5", "vcpu": 4, "vmif": "t3VM5if1"}]}, {"dev": "t3s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.21.2", "remote_ip": "10.1.21.2", "remote_route": "10.1.21.0/24", "subnet_route": "10.2.21.0/24", "tenant_route_ip": "192.168.131.2", "v_name": "vxlan_t3s1"}], "rc": 0, "start": "2019-11-17 10:29:22.755716", "stderr": "", "stderr_lines": [], "stdout": "\t\t\t\t\t\t\tvxlan_t3s1", "stdout_lines": ["\t\t\t\t\t\t\tvxlan_t3s1"]}

PLAY RECAP **************************************************************************************************************************************************
99.99.99.2                 : ok=21   changed=19   unreachable=0    failed=0    skipped=0    rescued=0    ignored=0   

Using /etc/ansible/ansible.cfg as config file

PLAY [main] *************************************************************************************************************************************************

TASK [Add VXLAN routes in PNS] ******************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.21.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.1.21.1', u'bridge_name': u't3br1', u'dns': [{u'dnsif': u't3s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't3s1_dnsbrif'}], u'ns_name': u't3ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.21.2/24', u'tenant_ns_ip': u'10.1.21.1/24', u'tenant_ns_if': u't3ns1if', u'tenant_sub_if': u't3s1if', u'tenant_ns_name': u't3'}], u'bridge_ip': u'1.1.1.1', u'vms': [{u'mem': 2, u'name': u't3_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't3br1if1', u'vmif': u't3VM1if1'}, {u'mem': 4, u'name': u't3_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't3br1if2', u'vmif': u't3VM2if1'}]}, {u'local_ip': u'10.1.21.2', u'dsport': 4789, u'dev': u't3s1if', u'tenant_route_ip': u'192.168.3.2', u'remote_route': u'10.2.21.0/24', u'subnet_route': u'10.1.21.0/24', u'v_name': u'vxlan_t3s1', u'id': 42, u'remote_ip': u'10.2.21.2'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec pns ip route show \"10.1.21.0/24\" via \"192.168.3.2\" | grep -w '^10.1.21.0/24' ; if [ $? -ne 0 ] ; then ip netns exec pns ip route add \"10.1.21.0/24\" via \"192.168.3.2\" ; fi\n", "delta": "0:00:00.039231", "end": "2019-11-17 10:29:23.903633", "item": [{"bridge_ip": "1.1.1.1", "bridge_name": "t3br1", "default_route_ip": "10.1.21.1", "dns": [{"brif": "t3s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t3s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t3ns1", "route": [{"if": "p1", "ip": "10.1.21.1/24", "ns_if": "t3if", "ns_name": "t3"}], "tenant_ns": [{"tenant_ns_if": "t3ns1if", "tenant_ns_ip": "10.1.21.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s1if", "tenant_sub_ip": "10.1.21.2/24"}], "vms": [{"brif": "t3br1if1", "disk": "10G", "mem": 2, "name": "t3_VM1", "vcpu": 4, "vmif": "t3VM1if1"}, {"brif": "t3br1if2", "disk": "10G", "mem": 4, "name": "t3_VM2", "vcpu": 2, "vmif": "t3VM2if1"}]}, {"dev": "t3s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.21.2", "remote_ip": "10.2.21.2", "remote_route": "10.2.21.0/24", "subnet_route": "10.1.21.0/24", "tenant_route_ip": "192.168.3.2", "v_name": "vxlan_t3s1"}], "rc": 0, "start": "2019-11-17 10:29:23.864402", "stderr": "", "stderr_lines": [], "stdout": "10.1.21.0/24 dev t3pns_if ", "stdout_lines": ["10.1.21.0/24 dev t3pns_if "]}
skipping: [localhost] => (item=[{u'route': [{u'ip': u'10.1.22.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.1.22.1', u'bridge_name': u't3br2', u'dns': [{u'dnsif': u't3s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't3s2_dnsbrif'}], u'ns_name': u't3ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.22.2/24', u'tenant_ns_ip': u'10.1.22.1/24', u'tenant_ns_if': u't3ns2if', u'tenant_sub_if': u't3s2if', u'tenant_ns_name': u't3'}], u'bridge_ip': u'2.2.2.1', u'vms': [{u'mem': 3, u'name': u't3_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't3br2if1', u'vmif': u't3VM3if1'}]}, {u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}])  => {"ansible_loop_var": "item", "changed": false, "item": [{"bridge_ip": "2.2.2.1", "bridge_name": "t3br2", "default_route_ip": "10.1.22.1", "dns": [{"brif": "t3s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t3s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t3ns2", "route": [{"if": "p1", "ip": "10.1.22.1/24", "ns_if": "t3if", "ns_name": "t3"}], "tenant_ns": [{"tenant_ns_if": "t3ns2if", "tenant_ns_ip": "10.1.22.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s2if", "tenant_sub_ip": "10.1.22.2/24"}], "vms": [{"brif": "t3br2if1", "disk": "10G", "mem": 3, "name": "t3_VM3", "vcpu": 2, "vmif": "t3VM3if1"}]}, {"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}], "skip_reason": "Conditional result was False"}

TASK [Get PNS ip address] ***********************************************************************************************************************************
ok: [localhost] => {"changed": false, "cmd": "ip netns exec pns ip addr show p1 | awk 'FNR==3{ print $2 }' | awk -F/ '{ print $1 }'\n", "delta": "0:00:00.054495", "end": "2019-11-17 10:29:24.240097", "rc": 0, "start": "2019-11-17 10:29:24.185602", "stderr": "", "stderr_lines": [], "stdout": "192.168.100.238", "stdout_lines": ["192.168.100.238"]}

TASK [Add VXLAN routes to host] *****************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.21.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.1.21.1', u'bridge_name': u't3br1', u'dns': [{u'dnsif': u't3s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't3s1_dnsbrif'}], u'ns_name': u't3ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.21.2/24', u'tenant_ns_ip': u'10.1.21.1/24', u'tenant_ns_if': u't3ns1if', u'tenant_sub_if': u't3s1if', u'tenant_ns_name': u't3'}], u'bridge_ip': u'1.1.1.1', u'vms': [{u'mem': 2, u'name': u't3_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't3br1if1', u'vmif': u't3VM1if1'}, {u'mem': 4, u'name': u't3_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't3br1if2', u'vmif': u't3VM2if1'}]}, {u'local_ip': u'10.1.21.2', u'dsport': 4789, u'dev': u't3s1if', u'tenant_route_ip': u'192.168.3.2', u'remote_route': u'10.2.21.0/24', u'subnet_route': u'10.1.21.0/24', u'v_name': u'vxlan_t3s1', u'id': 42, u'remote_ip': u'10.2.21.2'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip route show \"10.1.21.0/24\" via \"192.168.100.238\" | grep -w '^10.1.21.0/24' ; if [ $? -ne 0 ] ; then ip route add \"10.1.21.0/24\" via \"192.168.100.238\" ; fi\nip route show \"10.2.21.0/24\" via 99.99.99.2 | grep -w '^10.2.21.0/24'; if [ $? -ne 0 ] ; then ip route add \"10.2.21.0/24\" via 99.99.99.2 ; fi\n", "delta": "0:00:00.005555", "end": "2019-11-17 10:29:24.552345", "item": [{"bridge_ip": "1.1.1.1", "bridge_name": "t3br1", "default_route_ip": "10.1.21.1", "dns": [{"brif": "t3s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t3s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t3ns1", "route": [{"if": "p1", "ip": "10.1.21.1/24", "ns_if": "t3if", "ns_name": "t3"}], "tenant_ns": [{"tenant_ns_if": "t3ns1if", "tenant_ns_ip": "10.1.21.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s1if", "tenant_sub_ip": "10.1.21.2/24"}], "vms": [{"brif": "t3br1if1", "disk": "10G", "mem": 2, "name": "t3_VM1", "vcpu": 4, "vmif": "t3VM1if1"}, {"brif": "t3br1if2", "disk": "10G", "mem": 4, "name": "t3_VM2", "vcpu": 2, "vmif": "t3VM2if1"}]}, {"dev": "t3s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.21.2", "remote_ip": "10.2.21.2", "remote_route": "10.2.21.0/24", "subnet_route": "10.1.21.0/24", "tenant_route_ip": "192.168.3.2", "v_name": "vxlan_t3s1"}], "rc": 0, "start": "2019-11-17 10:29:24.546790", "stderr": "", "stderr_lines": [], "stdout": "10.1.21.0/24 dev testBR \n10.2.21.0/24 dev ens4 ", "stdout_lines": ["10.1.21.0/24 dev testBR ", "10.2.21.0/24 dev ens4 "]}
skipping: [localhost] => (item=[{u'route': [{u'ip': u'10.1.22.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.1.22.1', u'bridge_name': u't3br2', u'dns': [{u'dnsif': u't3s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't3s2_dnsbrif'}], u'ns_name': u't3ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.22.2/24', u'tenant_ns_ip': u'10.1.22.1/24', u'tenant_ns_if': u't3ns2if', u'tenant_sub_if': u't3s2if', u'tenant_ns_name': u't3'}], u'bridge_ip': u'2.2.2.1', u'vms': [{u'mem': 3, u'name': u't3_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't3br2if1', u'vmif': u't3VM3if1'}]}, {u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}])  => {"ansible_loop_var": "item", "changed": false, "item": [{"bridge_ip": "2.2.2.1", "bridge_name": "t3br2", "default_route_ip": "10.1.22.1", "dns": [{"brif": "t3s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t3s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t3ns2", "route": [{"if": "p1", "ip": "10.1.22.1/24", "ns_if": "t3if", "ns_name": "t3"}], "tenant_ns": [{"tenant_ns_if": "t3ns2if", "tenant_ns_ip": "10.1.22.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s2if", "tenant_sub_ip": "10.1.22.2/24"}], "vms": [{"brif": "t3br2if1", "disk": "10G", "mem": 3, "name": "t3_VM3", "vcpu": 2, "vmif": "t3VM3if1"}]}, {"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}], "skip_reason": "Conditional result was False"}

PLAY RECAP **************************************************************************************************************************************************
localhost                  : ok=3    changed=2    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0   

Using /etc/ansible/ansible.cfg as config file

PLAY [worker] ***********************************************************************************************************************************************

TASK [Add VXLAN routes in PNS] ******************************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.21.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.2.21.1', u'bridge_name': u't3br1', u'dns': [{u'dnsif': u't3s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't3s1_dnsbrif'}], u'ns_name': u't3ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.21.2/24', u'tenant_ns_ip': u'10.2.21.1/24', u'tenant_ns_if': u't3ns1if', u'tenant_sub_if': u't3s1if', u'tenant_ns_name': u't3'}], u'bridge_ip': u'1.1.1.1', u'vms': [{u'mem': 2, u'name': u't3_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't3br1if1', u'vmif': u't3VM4if1'}, {u'mem': 2, u'name': u't3_VM5', u'vcpu': 4, u'disk': u'10G', u'brif': u't3br1if2', u'vmif': u't3VM5if1'}]}, {u'local_ip': u'10.2.21.2', u'dsport': 4789, u'dev': u't3s1if', u'tenant_route_ip': u'192.168.131.2', u'remote_route': u'10.1.21.0/24', u'subnet_route': u'10.2.21.0/24', u'v_name': u'vxlan_t3s1', u'id': 42, u'remote_ip': u'10.1.21.2'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec pns ip route show \"10.2.21.0/24\" via \"192.168.131.2\" | grep -w '^10.2.21.0/24' ; if [ $? -ne 0 ] ; then ip netns exec pns ip route add \"10.2.21.0/24\" via \"192.168.131.2\" ; fi\n", "delta": "0:00:00.032432", "end": "2019-11-17 10:29:25.840551", "item": [{"bridge_ip": "1.1.1.1", "bridge_name": "t3br1", "default_route_ip": "10.2.21.1", "dns": [{"brif": "t3s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t3s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "ns_name": "t3ns1", "route": [{"if": "p1", "ip": "10.2.21.1/24", "ns_if": "t3if", "ns_name": "t3"}], "tenant_ns": [{"tenant_ns_if": "t3ns1if", "tenant_ns_ip": "10.2.21.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s1if", "tenant_sub_ip": "10.2.21.2/24"}], "vms": [{"brif": "t3br1if1", "disk": "10G", "mem": 2, "name": "t3_VM4", "vcpu": 4, "vmif": "t3VM4if1"}, {"brif": "t3br1if2", "disk": "10G", "mem": 2, "name": "t3_VM5", "vcpu": 4, "vmif": "t3VM5if1"}]}, {"dev": "t3s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.21.2", "remote_ip": "10.1.21.2", "remote_route": "10.1.21.0/24", "subnet_route": "10.2.21.0/24", "tenant_route_ip": "192.168.131.2", "v_name": "vxlan_t3s1"}], "rc": 0, "start": "2019-11-17 10:29:25.808119", "stderr": "", "stderr_lines": [], "stdout": "10.2.21.0/24 dev t3pns_if ", "stdout_lines": ["10.2.21.0/24 dev t3pns_if "]}

TASK [Get PNS ip address] ***********************************************************************************************************************************
ok: [99.99.99.2] => {"changed": false, "cmd": "ip netns exec pns ip addr show p1 | awk 'FNR==3{ print $2 }' | awk -F/ '{ print $1 }'\n", "delta": "0:00:00.045347", "end": "2019-11-17 10:29:26.297504", "rc": 0, "start": "2019-11-17 10:29:26.252157", "stderr": "", "stderr_lines": [], "stdout": "192.168.100.50", "stdout_lines": ["192.168.100.50"]}

TASK [Add VXLAN routes to host] *****************************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.21.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.2.21.1', u'bridge_name': u't3br1', u'dns': [{u'dnsif': u't3s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't3s1_dnsbrif'}], u'ns_name': u't3ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.21.2/24', u'tenant_ns_ip': u'10.2.21.1/24', u'tenant_ns_if': u't3ns1if', u'tenant_sub_if': u't3s1if', u'tenant_ns_name': u't3'}], u'bridge_ip': u'1.1.1.1', u'vms': [{u'mem': 2, u'name': u't3_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't3br1if1', u'vmif': u't3VM4if1'}, {u'mem': 2, u'name': u't3_VM5', u'vcpu': 4, u'disk': u'10G', u'brif': u't3br1if2', u'vmif': u't3VM5if1'}]}, {u'local_ip': u'10.2.21.2', u'dsport': 4789, u'dev': u't3s1if', u'tenant_route_ip': u'192.168.131.2', u'remote_route': u'10.1.21.0/24', u'subnet_route': u'10.2.21.0/24', u'v_name': u'vxlan_t3s1', u'id': 42, u'remote_ip': u'10.1.21.2'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip route show \"10.2.21.0/24\" via \"192.168.100.50\" | grep -w '^10.2.21.0/24' ; if [ $? -ne 0 ] ; then ip route add \"10.2.21.0/24\" via \"192.168.100.50\" ; fi\nip route show \"10.1.21.0/24\" via 99.99.99.1 | grep -w '^10.1.21.0/24'; if [ $? -ne 0 ] ; then ip route add \"10.1.21.0/24\" via 99.99.99.1 ; fi\n", "delta": "0:00:00.005789", "end": "2019-11-17 10:29:26.681963", "item": [{"bridge_ip": "1.1.1.1", "bridge_name": "t3br1", "default_route_ip": "10.2.21.1", "dns": [{"brif": "t3s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t3s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "ns_name": "t3ns1", "route": [{"if": "p1", "ip": "10.2.21.1/24", "ns_if": "t3if", "ns_name": "t3"}], "tenant_ns": [{"tenant_ns_if": "t3ns1if", "tenant_ns_ip": "10.2.21.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s1if", "tenant_sub_ip": "10.2.21.2/24"}], "vms": [{"brif": "t3br1if1", "disk": "10G", "mem": 2, "name": "t3_VM4", "vcpu": 4, "vmif": "t3VM4if1"}, {"brif": "t3br1if2", "disk": "10G", "mem": 2, "name": "t3_VM5", "vcpu": 4, "vmif": "t3VM5if1"}]}, {"dev": "t3s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.21.2", "remote_ip": "10.1.21.2", "remote_route": "10.1.21.0/24", "subnet_route": "10.2.21.0/24", "tenant_route_ip": "192.168.131.2", "v_name": "vxlan_t3s1"}], "rc": 0, "start": "2019-11-17 10:29:26.676174", "stderr": "", "stderr_lines": [], "stdout": "10.2.21.0/24 dev testBR \n10.1.21.0/24 dev ens4 ", "stdout_lines": ["10.2.21.0/24 dev testBR ", "10.1.21.0/24 dev ens4 "]}

PLAY RECAP **************************************************************************************************************************************************
99.99.99.2                 : ok=3    changed=2    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0   

Using /etc/ansible/ansible.cfg as config file

PLAY [main] *************************************************************************************************************************************************

TASK [Create VM templates (C1)] *****************************************************************************************************************************
ok: [localhost] => (item=[{u'route': [{u'ip': u'10.1.21.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.1.21.1', u'bridge_name': u't3br1', u'dns': [{u'dnsif': u't3s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't3s1_dnsbrif'}], u'ns_name': u't3ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.21.2/24', u'tenant_ns_ip': u'10.1.21.1/24', u'tenant_ns_if': u't3ns1if', u'tenant_sub_if': u't3s1if', u'tenant_ns_name': u't3'}], u'bridge_ip': u'1.1.1.1', u'vxlan': [{u'local_ip': u'10.1.21.2', u'dsport': 4789, u'dev': u't3s1if', u'tenant_route_ip': u'192.168.3.2', u'remote_route': u'10.2.21.0/24', u'subnet_route': u'10.1.21.0/24', u'v_name': u'vxlan_t3s1', u'id': 42, u'remote_ip': u'10.2.21.2'}]}, {u'mem': 2, u'name': u't3_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't3br1if1', u'vmif': u't3VM1if1'}]) => {"ansible_loop_var": "item", "changed": false, "checksum": "350ba870bd31b7f6ee517845c14237910b5af0bf", "dest": "/root/Migration-as-a-Service/t3/VM_templates/t3_VM1.xml.j2", "gid": 0, "group": "root", "item": [{"bridge_ip": "1.1.1.1", "bridge_name": "t3br1", "default_route_ip": "10.1.21.1", "dns": [{"brif": "t3s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t3s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t3ns1", "route": [{"if": "p1", "ip": "10.1.21.1/24", "ns_if": "t3if", "ns_name": "t3"}], "tenant_ns": [{"tenant_ns_if": "t3ns1if", "tenant_ns_ip": "10.1.21.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s1if", "tenant_sub_ip": "10.1.21.2/24"}], "vxlan": [{"dev": "t3s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.21.2", "remote_ip": "10.2.21.2", "remote_route": "10.2.21.0/24", "subnet_route": "10.1.21.0/24", "tenant_route_ip": "192.168.3.2", "v_name": "vxlan_t3s1"}]}, {"brif": "t3br1if1", "disk": "10G", "mem": 2, "name": "t3_VM1", "vcpu": 4, "vmif": "t3VM1if1"}], "mode": "0644", "owner": "root", "path": "/root/Migration-as-a-Service/t3/VM_templates/t3_VM1.xml.j2", "size": 4091, "state": "file", "uid": 0}
ok: [localhost] => (item=[{u'route': [{u'ip': u'10.1.21.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.1.21.1', u'bridge_name': u't3br1', u'dns': [{u'dnsif': u't3s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't3s1_dnsbrif'}], u'ns_name': u't3ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.21.2/24', u'tenant_ns_ip': u'10.1.21.1/24', u'tenant_ns_if': u't3ns1if', u'tenant_sub_if': u't3s1if', u'tenant_ns_name': u't3'}], u'bridge_ip': u'1.1.1.1', u'vxlan': [{u'local_ip': u'10.1.21.2', u'dsport': 4789, u'dev': u't3s1if', u'tenant_route_ip': u'192.168.3.2', u'remote_route': u'10.2.21.0/24', u'subnet_route': u'10.1.21.0/24', u'v_name': u'vxlan_t3s1', u'id': 42, u'remote_ip': u'10.2.21.2'}]}, {u'mem': 4, u'name': u't3_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't3br1if2', u'vmif': u't3VM2if1'}]) => {"ansible_loop_var": "item", "changed": false, "checksum": "350ba870bd31b7f6ee517845c14237910b5af0bf", "dest": "/root/Migration-as-a-Service/t3/VM_templates/t3_VM2.xml.j2", "gid": 0, "group": "root", "item": [{"bridge_ip": "1.1.1.1", "bridge_name": "t3br1", "default_route_ip": "10.1.21.1", "dns": [{"brif": "t3s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t3s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t3ns1", "route": [{"if": "p1", "ip": "10.1.21.1/24", "ns_if": "t3if", "ns_name": "t3"}], "tenant_ns": [{"tenant_ns_if": "t3ns1if", "tenant_ns_ip": "10.1.21.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s1if", "tenant_sub_ip": "10.1.21.2/24"}], "vxlan": [{"dev": "t3s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.21.2", "remote_ip": "10.2.21.2", "remote_route": "10.2.21.0/24", "subnet_route": "10.1.21.0/24", "tenant_route_ip": "192.168.3.2", "v_name": "vxlan_t3s1"}]}, {"brif": "t3br1if2", "disk": "10G", "mem": 4, "name": "t3_VM2", "vcpu": 2, "vmif": "t3VM2if1"}], "mode": "0644", "owner": "root", "path": "/root/Migration-as-a-Service/t3/VM_templates/t3_VM2.xml.j2", "size": 4091, "state": "file", "uid": 0}
ok: [localhost] => (item=[{u'route': [{u'ip': u'10.1.22.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.1.22.1', u'bridge_name': u't3br2', u'dns': [{u'dnsif': u't3s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't3s2_dnsbrif'}], u'ns_name': u't3ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.22.2/24', u'tenant_ns_ip': u'10.1.22.1/24', u'tenant_ns_if': u't3ns2if', u'tenant_sub_if': u't3s2if', u'tenant_ns_name': u't3'}], u'bridge_ip': u'2.2.2.1', u'vxlan': [{u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}, {u'mem': 3, u'name': u't3_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't3br2if1', u'vmif': u't3VM3if1'}]) => {"ansible_loop_var": "item", "changed": false, "checksum": "350ba870bd31b7f6ee517845c14237910b5af0bf", "dest": "/root/Migration-as-a-Service/t3/VM_templates/t3_VM3.xml.j2", "gid": 0, "group": "root", "item": [{"bridge_ip": "2.2.2.1", "bridge_name": "t3br2", "default_route_ip": "10.1.22.1", "dns": [{"brif": "t3s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t3s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t3ns2", "route": [{"if": "p1", "ip": "10.1.22.1/24", "ns_if": "t3if", "ns_name": "t3"}], "tenant_ns": [{"tenant_ns_if": "t3ns2if", "tenant_ns_ip": "10.1.22.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s2if", "tenant_sub_ip": "10.1.22.2/24"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, {"brif": "t3br2if1", "disk": "10G", "mem": 3, "name": "t3_VM3", "vcpu": 2, "vmif": "t3VM3if1"}], "mode": "0644", "owner": "root", "path": "/root/Migration-as-a-Service/t3/VM_templates/t3_VM3.xml.j2", "size": 4091, "state": "file", "uid": 0}

PLAY RECAP **************************************************************************************************************************************************
localhost                  : ok=1    changed=0    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0   

Using /etc/ansible/ansible.cfg as config file

PLAY [main] *************************************************************************************************************************************************

TASK [Create VM templates (C2)] *****************************************************************************************************************************
ok: [localhost] => (item=[{u'route': [{u'ip': u'10.2.21.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.2.21.1', u'bridge_name': u't3br1', u'dns': [{u'dnsif': u't3s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't3s1_dnsbrif'}], u'ns_name': u't3ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.21.2/24', u'tenant_ns_ip': u'10.2.21.1/24', u'tenant_ns_if': u't3ns1if', u'tenant_sub_if': u't3s1if', u'tenant_ns_name': u't3'}], u'bridge_ip': u'1.1.1.1', u'vxlan': [{u'local_ip': u'10.2.21.2', u'dsport': 4789, u'dev': u't3s1if', u'tenant_route_ip': u'192.168.131.2', u'remote_route': u'10.1.21.0/24', u'subnet_route': u'10.2.21.0/24', u'v_name': u'vxlan_t3s1', u'id': 42, u'remote_ip': u'10.1.21.2'}]}, {u'mem': 2, u'name': u't3_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't3br1if1', u'vmif': u't3VM4if1'}]) => {"ansible_loop_var": "item", "changed": false, "checksum": "350ba870bd31b7f6ee517845c14237910b5af0bf", "dest": "/root/Migration-as-a-Service/t3/VM_templates/t3_VM4.xml.j2", "gid": 0, "group": "root", "item": [{"bridge_ip": "1.1.1.1", "bridge_name": "t3br1", "default_route_ip": "10.2.21.1", "dns": [{"brif": "t3s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t3s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "ns_name": "t3ns1", "route": [{"if": "p1", "ip": "10.2.21.1/24", "ns_if": "t3if", "ns_name": "t3"}], "tenant_ns": [{"tenant_ns_if": "t3ns1if", "tenant_ns_ip": "10.2.21.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s1if", "tenant_sub_ip": "10.2.21.2/24"}], "vxlan": [{"dev": "t3s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.21.2", "remote_ip": "10.1.21.2", "remote_route": "10.1.21.0/24", "subnet_route": "10.2.21.0/24", "tenant_route_ip": "192.168.131.2", "v_name": "vxlan_t3s1"}]}, {"brif": "t3br1if1", "disk": "10G", "mem": 2, "name": "t3_VM4", "vcpu": 4, "vmif": "t3VM4if1"}], "mode": "0644", "owner": "root", "path": "/root/Migration-as-a-Service/t3/VM_templates/t3_VM4.xml.j2", "size": 4091, "state": "file", "uid": 0}
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.2.21.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.2.21.1', u'bridge_name': u't3br1', u'dns': [{u'dnsif': u't3s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't3s1_dnsbrif'}], u'ns_name': u't3ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.21.2/24', u'tenant_ns_ip': u'10.2.21.1/24', u'tenant_ns_if': u't3ns1if', u'tenant_sub_if': u't3s1if', u'tenant_ns_name': u't3'}], u'bridge_ip': u'1.1.1.1', u'vxlan': [{u'local_ip': u'10.2.21.2', u'dsport': 4789, u'dev': u't3s1if', u'tenant_route_ip': u'192.168.131.2', u'remote_route': u'10.1.21.0/24', u'subnet_route': u'10.2.21.0/24', u'v_name': u'vxlan_t3s1', u'id': 42, u'remote_ip': u'10.1.21.2'}]}, {u'mem': 2, u'name': u't3_VM5', u'vcpu': 4, u'disk': u'10G', u'brif': u't3br1if2', u'vmif': u't3VM5if1'}]) => {"ansible_loop_var": "item", "changed": true, "checksum": "350ba870bd31b7f6ee517845c14237910b5af0bf", "dest": "/root/Migration-as-a-Service/t3/VM_templates/t3_VM5.xml.j2", "gid": 0, "group": "root", "item": [{"bridge_ip": "1.1.1.1", "bridge_name": "t3br1", "default_route_ip": "10.2.21.1", "dns": [{"brif": "t3s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t3s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "ns_name": "t3ns1", "route": [{"if": "p1", "ip": "10.2.21.1/24", "ns_if": "t3if", "ns_name": "t3"}], "tenant_ns": [{"tenant_ns_if": "t3ns1if", "tenant_ns_ip": "10.2.21.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s1if", "tenant_sub_ip": "10.2.21.2/24"}], "vxlan": [{"dev": "t3s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.21.2", "remote_ip": "10.1.21.2", "remote_route": "10.1.21.0/24", "subnet_route": "10.2.21.0/24", "tenant_route_ip": "192.168.131.2", "v_name": "vxlan_t3s1"}]}, {"brif": "t3br1if2", "disk": "10G", "mem": 2, "name": "t3_VM5", "vcpu": 4, "vmif": "t3VM5if1"}], "md5sum": "fbfc2eb0c2569531f25eea92c26d3bee", "mode": "0644", "owner": "root", "size": 4091, "src": "/root/.ansible/tmp/ansible-tmp-1573986569.72-269812910104514/source", "state": "file", "uid": 0}

PLAY RECAP **************************************************************************************************************************************************
localhost                  : ok=1    changed=1    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0   

Using /etc/ansible/ansible.cfg as config file

PLAY [main] *************************************************************************************************************************************************

TASK [Copy VM image] ****************************************************************************************************************************************
ok: [localhost] => (item=[{u'route': [{u'ip': u'10.1.21.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.1.21.1', u'bridge_name': u't3br1', u'dns': [{u'dnsif': u't3s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't3s1_dnsbrif'}], u'ns_name': u't3ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.21.2/24', u'tenant_ns_ip': u'10.1.21.1/24', u'tenant_ns_if': u't3ns1if', u'tenant_sub_if': u't3s1if', u'tenant_ns_name': u't3'}], u'bridge_ip': u'1.1.1.1', u'vxlan': [{u'local_ip': u'10.1.21.2', u'dsport': 4789, u'dev': u't3s1if', u'tenant_route_ip': u'192.168.3.2', u'remote_route': u'10.2.21.0/24', u'subnet_route': u'10.1.21.0/24', u'v_name': u'vxlan_t3s1', u'id': 42, u'remote_ip': u'10.2.21.2'}]}, {u'mem': 2, u'name': u't3_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't3br1if1', u'vmif': u't3VM1if1'}]) => {"ansible_loop_var": "item", "changed": false, "dest": "/var/lib/libvirt/images/t3_VM1.qcow2", "item": [{"bridge_ip": "1.1.1.1", "bridge_name": "t3br1", "default_route_ip": "10.1.21.1", "dns": [{"brif": "t3s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t3s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t3ns1", "route": [{"if": "p1", "ip": "10.1.21.1/24", "ns_if": "t3if", "ns_name": "t3"}], "tenant_ns": [{"tenant_ns_if": "t3ns1if", "tenant_ns_ip": "10.1.21.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s1if", "tenant_sub_ip": "10.1.21.2/24"}], "vxlan": [{"dev": "t3s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.21.2", "remote_ip": "10.2.21.2", "remote_route": "10.2.21.0/24", "subnet_route": "10.1.21.0/24", "tenant_route_ip": "192.168.3.2", "v_name": "vxlan_t3s1"}]}, {"brif": "t3br1if1", "disk": "10G", "mem": 2, "name": "t3_VM1", "vcpu": 4, "vmif": "t3VM1if1"}], "src": "/root/mainVM.qcow2"}
ok: [localhost] => (item=[{u'route': [{u'ip': u'10.1.21.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.1.21.1', u'bridge_name': u't3br1', u'dns': [{u'dnsif': u't3s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't3s1_dnsbrif'}], u'ns_name': u't3ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.21.2/24', u'tenant_ns_ip': u'10.1.21.1/24', u'tenant_ns_if': u't3ns1if', u'tenant_sub_if': u't3s1if', u'tenant_ns_name': u't3'}], u'bridge_ip': u'1.1.1.1', u'vxlan': [{u'local_ip': u'10.1.21.2', u'dsport': 4789, u'dev': u't3s1if', u'tenant_route_ip': u'192.168.3.2', u'remote_route': u'10.2.21.0/24', u'subnet_route': u'10.1.21.0/24', u'v_name': u'vxlan_t3s1', u'id': 42, u'remote_ip': u'10.2.21.2'}]}, {u'mem': 4, u'name': u't3_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't3br1if2', u'vmif': u't3VM2if1'}]) => {"ansible_loop_var": "item", "changed": false, "dest": "/var/lib/libvirt/images/t3_VM2.qcow2", "item": [{"bridge_ip": "1.1.1.1", "bridge_name": "t3br1", "default_route_ip": "10.1.21.1", "dns": [{"brif": "t3s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t3s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t3ns1", "route": [{"if": "p1", "ip": "10.1.21.1/24", "ns_if": "t3if", "ns_name": "t3"}], "tenant_ns": [{"tenant_ns_if": "t3ns1if", "tenant_ns_ip": "10.1.21.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s1if", "tenant_sub_ip": "10.1.21.2/24"}], "vxlan": [{"dev": "t3s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.21.2", "remote_ip": "10.2.21.2", "remote_route": "10.2.21.0/24", "subnet_route": "10.1.21.0/24", "tenant_route_ip": "192.168.3.2", "v_name": "vxlan_t3s1"}]}, {"brif": "t3br1if2", "disk": "10G", "mem": 4, "name": "t3_VM2", "vcpu": 2, "vmif": "t3VM2if1"}], "src": "/root/mainVM.qcow2"}
ok: [localhost] => (item=[{u'route': [{u'ip': u'10.1.22.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.1.22.1', u'bridge_name': u't3br2', u'dns': [{u'dnsif': u't3s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't3s2_dnsbrif'}], u'ns_name': u't3ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.22.2/24', u'tenant_ns_ip': u'10.1.22.1/24', u'tenant_ns_if': u't3ns2if', u'tenant_sub_if': u't3s2if', u'tenant_ns_name': u't3'}], u'bridge_ip': u'2.2.2.1', u'vxlan': [{u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}, {u'mem': 3, u'name': u't3_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't3br2if1', u'vmif': u't3VM3if1'}]) => {"ansible_loop_var": "item", "changed": false, "dest": "/var/lib/libvirt/images/t3_VM3.qcow2", "item": [{"bridge_ip": "2.2.2.1", "bridge_name": "t3br2", "default_route_ip": "10.1.22.1", "dns": [{"brif": "t3s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t3s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t3ns2", "route": [{"if": "p1", "ip": "10.1.22.1/24", "ns_if": "t3if", "ns_name": "t3"}], "tenant_ns": [{"tenant_ns_if": "t3ns2if", "tenant_ns_ip": "10.1.22.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s2if", "tenant_sub_ip": "10.1.22.2/24"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, {"brif": "t3br2if1", "disk": "10G", "mem": 3, "name": "t3_VM3", "vcpu": 2, "vmif": "t3VM3if1"}], "src": "/root/mainVM.qcow2"}

TASK [Create VM templates (C1)] *****************************************************************************************************************************
ok: [localhost] => (item=[{u'route': [{u'ip': u'10.1.21.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.1.21.1', u'bridge_name': u't3br1', u'dns': [{u'dnsif': u't3s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't3s1_dnsbrif'}], u'ns_name': u't3ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.21.2/24', u'tenant_ns_ip': u'10.1.21.1/24', u'tenant_ns_if': u't3ns1if', u'tenant_sub_if': u't3s1if', u'tenant_ns_name': u't3'}], u'bridge_ip': u'1.1.1.1', u'vxlan': [{u'local_ip': u'10.1.21.2', u'dsport': 4789, u'dev': u't3s1if', u'tenant_route_ip': u'192.168.3.2', u'remote_route': u'10.2.21.0/24', u'subnet_route': u'10.1.21.0/24', u'v_name': u'vxlan_t3s1', u'id': 42, u'remote_ip': u'10.2.21.2'}]}, {u'mem': 2, u'name': u't3_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't3br1if1', u'vmif': u't3VM1if1'}]) => {"ansible_loop_var": "item", "changed": false, "checksum": "350ba870bd31b7f6ee517845c14237910b5af0bf", "dest": "/root/Migration-as-a-Service/t3/VM_templates/t3_VM1.xml.j2", "gid": 0, "group": "root", "item": [{"bridge_ip": "1.1.1.1", "bridge_name": "t3br1", "default_route_ip": "10.1.21.1", "dns": [{"brif": "t3s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t3s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t3ns1", "route": [{"if": "p1", "ip": "10.1.21.1/24", "ns_if": "t3if", "ns_name": "t3"}], "tenant_ns": [{"tenant_ns_if": "t3ns1if", "tenant_ns_ip": "10.1.21.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s1if", "tenant_sub_ip": "10.1.21.2/24"}], "vxlan": [{"dev": "t3s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.21.2", "remote_ip": "10.2.21.2", "remote_route": "10.2.21.0/24", "subnet_route": "10.1.21.0/24", "tenant_route_ip": "192.168.3.2", "v_name": "vxlan_t3s1"}]}, {"brif": "t3br1if1", "disk": "10G", "mem": 2, "name": "t3_VM1", "vcpu": 4, "vmif": "t3VM1if1"}], "mode": "0644", "owner": "root", "path": "/root/Migration-as-a-Service/t3/VM_templates/t3_VM1.xml.j2", "size": 4091, "state": "file", "uid": 0}
ok: [localhost] => (item=[{u'route': [{u'ip': u'10.1.21.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.1.21.1', u'bridge_name': u't3br1', u'dns': [{u'dnsif': u't3s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't3s1_dnsbrif'}], u'ns_name': u't3ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.21.2/24', u'tenant_ns_ip': u'10.1.21.1/24', u'tenant_ns_if': u't3ns1if', u'tenant_sub_if': u't3s1if', u'tenant_ns_name': u't3'}], u'bridge_ip': u'1.1.1.1', u'vxlan': [{u'local_ip': u'10.1.21.2', u'dsport': 4789, u'dev': u't3s1if', u'tenant_route_ip': u'192.168.3.2', u'remote_route': u'10.2.21.0/24', u'subnet_route': u'10.1.21.0/24', u'v_name': u'vxlan_t3s1', u'id': 42, u'remote_ip': u'10.2.21.2'}]}, {u'mem': 4, u'name': u't3_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't3br1if2', u'vmif': u't3VM2if1'}]) => {"ansible_loop_var": "item", "changed": false, "checksum": "350ba870bd31b7f6ee517845c14237910b5af0bf", "dest": "/root/Migration-as-a-Service/t3/VM_templates/t3_VM2.xml.j2", "gid": 0, "group": "root", "item": [{"bridge_ip": "1.1.1.1", "bridge_name": "t3br1", "default_route_ip": "10.1.21.1", "dns": [{"brif": "t3s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t3s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t3ns1", "route": [{"if": "p1", "ip": "10.1.21.1/24", "ns_if": "t3if", "ns_name": "t3"}], "tenant_ns": [{"tenant_ns_if": "t3ns1if", "tenant_ns_ip": "10.1.21.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s1if", "tenant_sub_ip": "10.1.21.2/24"}], "vxlan": [{"dev": "t3s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.21.2", "remote_ip": "10.2.21.2", "remote_route": "10.2.21.0/24", "subnet_route": "10.1.21.0/24", "tenant_route_ip": "192.168.3.2", "v_name": "vxlan_t3s1"}]}, {"brif": "t3br1if2", "disk": "10G", "mem": 4, "name": "t3_VM2", "vcpu": 2, "vmif": "t3VM2if1"}], "mode": "0644", "owner": "root", "path": "/root/Migration-as-a-Service/t3/VM_templates/t3_VM2.xml.j2", "size": 4091, "state": "file", "uid": 0}
ok: [localhost] => (item=[{u'route': [{u'ip': u'10.1.22.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.1.22.1', u'bridge_name': u't3br2', u'dns': [{u'dnsif': u't3s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't3s2_dnsbrif'}], u'ns_name': u't3ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.22.2/24', u'tenant_ns_ip': u'10.1.22.1/24', u'tenant_ns_if': u't3ns2if', u'tenant_sub_if': u't3s2if', u'tenant_ns_name': u't3'}], u'bridge_ip': u'2.2.2.1', u'vxlan': [{u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}, {u'mem': 3, u'name': u't3_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't3br2if1', u'vmif': u't3VM3if1'}]) => {"ansible_loop_var": "item", "changed": false, "checksum": "350ba870bd31b7f6ee517845c14237910b5af0bf", "dest": "/root/Migration-as-a-Service/t3/VM_templates/t3_VM3.xml.j2", "gid": 0, "group": "root", "item": [{"bridge_ip": "2.2.2.1", "bridge_name": "t3br2", "default_route_ip": "10.1.22.1", "dns": [{"brif": "t3s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t3s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t3ns2", "route": [{"if": "p1", "ip": "10.1.22.1/24", "ns_if": "t3if", "ns_name": "t3"}], "tenant_ns": [{"tenant_ns_if": "t3ns2if", "tenant_ns_ip": "10.1.22.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s2if", "tenant_sub_ip": "10.1.22.2/24"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, {"brif": "t3br2if1", "disk": "10G", "mem": 3, "name": "t3_VM3", "vcpu": 2, "vmif": "t3VM3if1"}], "mode": "0644", "owner": "root", "path": "/root/Migration-as-a-Service/t3/VM_templates/t3_VM3.xml.j2", "size": 4091, "state": "file", "uid": 0}

TASK [Get list of running VMs] ******************************************************************************************************************************
ok: [localhost] => {"changed": false, "cmd": ["virsh", "list", "--name"], "delta": "0:00:00.018107", "end": "2019-11-17 10:29:32.807264", "rc": 0, "start": "2019-11-17 10:29:32.789157", "stderr": "", "stderr_lines": [], "stdout": "t1_VM1\nt1_VM2\nt1_VM3\nt2_VM1\nt2_VM2\nt2_VM3\nt3_VM1\nt3_VM2\nt3_VM3", "stdout_lines": ["t1_VM1", "t1_VM2", "t1_VM3", "t2_VM1", "t2_VM2", "t2_VM3", "t3_VM1", "t3_VM2", "t3_VM3"]}

TASK [Define VM] ********************************************************************************************************************************************
skipping: [localhost] => (item=[{u'route': [{u'ip': u'10.1.21.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.1.21.1', u'bridge_name': u't3br1', u'dns': [{u'dnsif': u't3s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't3s1_dnsbrif'}], u'ns_name': u't3ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.21.2/24', u'tenant_ns_ip': u'10.1.21.1/24', u'tenant_ns_if': u't3ns1if', u'tenant_sub_if': u't3s1if', u'tenant_ns_name': u't3'}], u'bridge_ip': u'1.1.1.1', u'vxlan': [{u'local_ip': u'10.1.21.2', u'dsport': 4789, u'dev': u't3s1if', u'tenant_route_ip': u'192.168.3.2', u'remote_route': u'10.2.21.0/24', u'subnet_route': u'10.1.21.0/24', u'v_name': u'vxlan_t3s1', u'id': 42, u'remote_ip': u'10.2.21.2'}]}, {u'mem': 2, u'name': u't3_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't3br1if1', u'vmif': u't3VM1if1'}])  => {"ansible_loop_var": "item", "changed": false, "item": [{"bridge_ip": "1.1.1.1", "bridge_name": "t3br1", "default_route_ip": "10.1.21.1", "dns": [{"brif": "t3s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t3s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t3ns1", "route": [{"if": "p1", "ip": "10.1.21.1/24", "ns_if": "t3if", "ns_name": "t3"}], "tenant_ns": [{"tenant_ns_if": "t3ns1if", "tenant_ns_ip": "10.1.21.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s1if", "tenant_sub_ip": "10.1.21.2/24"}], "vxlan": [{"dev": "t3s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.21.2", "remote_ip": "10.2.21.2", "remote_route": "10.2.21.0/24", "subnet_route": "10.1.21.0/24", "tenant_route_ip": "192.168.3.2", "v_name": "vxlan_t3s1"}]}, {"brif": "t3br1if1", "disk": "10G", "mem": 2, "name": "t3_VM1", "vcpu": 4, "vmif": "t3VM1if1"}], "skip_reason": "Conditional result was False"}
skipping: [localhost] => (item=[{u'route': [{u'ip': u'10.1.21.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.1.21.1', u'bridge_name': u't3br1', u'dns': [{u'dnsif': u't3s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't3s1_dnsbrif'}], u'ns_name': u't3ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.21.2/24', u'tenant_ns_ip': u'10.1.21.1/24', u'tenant_ns_if': u't3ns1if', u'tenant_sub_if': u't3s1if', u'tenant_ns_name': u't3'}], u'bridge_ip': u'1.1.1.1', u'vxlan': [{u'local_ip': u'10.1.21.2', u'dsport': 4789, u'dev': u't3s1if', u'tenant_route_ip': u'192.168.3.2', u'remote_route': u'10.2.21.0/24', u'subnet_route': u'10.1.21.0/24', u'v_name': u'vxlan_t3s1', u'id': 42, u'remote_ip': u'10.2.21.2'}]}, {u'mem': 4, u'name': u't3_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't3br1if2', u'vmif': u't3VM2if1'}])  => {"ansible_loop_var": "item", "changed": false, "item": [{"bridge_ip": "1.1.1.1", "bridge_name": "t3br1", "default_route_ip": "10.1.21.1", "dns": [{"brif": "t3s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t3s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t3ns1", "route": [{"if": "p1", "ip": "10.1.21.1/24", "ns_if": "t3if", "ns_name": "t3"}], "tenant_ns": [{"tenant_ns_if": "t3ns1if", "tenant_ns_ip": "10.1.21.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s1if", "tenant_sub_ip": "10.1.21.2/24"}], "vxlan": [{"dev": "t3s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.21.2", "remote_ip": "10.2.21.2", "remote_route": "10.2.21.0/24", "subnet_route": "10.1.21.0/24", "tenant_route_ip": "192.168.3.2", "v_name": "vxlan_t3s1"}]}, {"brif": "t3br1if2", "disk": "10G", "mem": 4, "name": "t3_VM2", "vcpu": 2, "vmif": "t3VM2if1"}], "skip_reason": "Conditional result was False"}
skipping: [localhost] => (item=[{u'route': [{u'ip': u'10.1.22.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.1.22.1', u'bridge_name': u't3br2', u'dns': [{u'dnsif': u't3s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't3s2_dnsbrif'}], u'ns_name': u't3ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.22.2/24', u'tenant_ns_ip': u'10.1.22.1/24', u'tenant_ns_if': u't3ns2if', u'tenant_sub_if': u't3s2if', u'tenant_ns_name': u't3'}], u'bridge_ip': u'2.2.2.1', u'vxlan': [{u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}, {u'mem': 3, u'name': u't3_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't3br2if1', u'vmif': u't3VM3if1'}])  => {"ansible_loop_var": "item", "changed": false, "item": [{"bridge_ip": "2.2.2.1", "bridge_name": "t3br2", "default_route_ip": "10.1.22.1", "dns": [{"brif": "t3s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t3s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t3ns2", "route": [{"if": "p1", "ip": "10.1.22.1/24", "ns_if": "t3if", "ns_name": "t3"}], "tenant_ns": [{"tenant_ns_if": "t3ns2if", "tenant_ns_ip": "10.1.22.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s2if", "tenant_sub_ip": "10.1.22.2/24"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, {"brif": "t3br2if1", "disk": "10G", "mem": 3, "name": "t3_VM3", "vcpu": 2, "vmif": "t3VM3if1"}], "skip_reason": "Conditional result was False"}

TASK [Create VM] ********************************************************************************************************************************************
skipping: [localhost] => (item=[{u'route': [{u'ip': u'10.1.21.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.1.21.1', u'bridge_name': u't3br1', u'dns': [{u'dnsif': u't3s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't3s1_dnsbrif'}], u'ns_name': u't3ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.21.2/24', u'tenant_ns_ip': u'10.1.21.1/24', u'tenant_ns_if': u't3ns1if', u'tenant_sub_if': u't3s1if', u'tenant_ns_name': u't3'}], u'bridge_ip': u'1.1.1.1', u'vxlan': [{u'local_ip': u'10.1.21.2', u'dsport': 4789, u'dev': u't3s1if', u'tenant_route_ip': u'192.168.3.2', u'remote_route': u'10.2.21.0/24', u'subnet_route': u'10.1.21.0/24', u'v_name': u'vxlan_t3s1', u'id': 42, u'remote_ip': u'10.2.21.2'}]}, {u'mem': 2, u'name': u't3_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't3br1if1', u'vmif': u't3VM1if1'}])  => {"ansible_loop_var": "item", "changed": false, "item": [{"bridge_ip": "1.1.1.1", "bridge_name": "t3br1", "default_route_ip": "10.1.21.1", "dns": [{"brif": "t3s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t3s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t3ns1", "route": [{"if": "p1", "ip": "10.1.21.1/24", "ns_if": "t3if", "ns_name": "t3"}], "tenant_ns": [{"tenant_ns_if": "t3ns1if", "tenant_ns_ip": "10.1.21.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s1if", "tenant_sub_ip": "10.1.21.2/24"}], "vxlan": [{"dev": "t3s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.21.2", "remote_ip": "10.2.21.2", "remote_route": "10.2.21.0/24", "subnet_route": "10.1.21.0/24", "tenant_route_ip": "192.168.3.2", "v_name": "vxlan_t3s1"}]}, {"brif": "t3br1if1", "disk": "10G", "mem": 2, "name": "t3_VM1", "vcpu": 4, "vmif": "t3VM1if1"}], "skip_reason": "Conditional result was False"}
skipping: [localhost] => (item=[{u'route': [{u'ip': u'10.1.21.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.1.21.1', u'bridge_name': u't3br1', u'dns': [{u'dnsif': u't3s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't3s1_dnsbrif'}], u'ns_name': u't3ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.21.2/24', u'tenant_ns_ip': u'10.1.21.1/24', u'tenant_ns_if': u't3ns1if', u'tenant_sub_if': u't3s1if', u'tenant_ns_name': u't3'}], u'bridge_ip': u'1.1.1.1', u'vxlan': [{u'local_ip': u'10.1.21.2', u'dsport': 4789, u'dev': u't3s1if', u'tenant_route_ip': u'192.168.3.2', u'remote_route': u'10.2.21.0/24', u'subnet_route': u'10.1.21.0/24', u'v_name': u'vxlan_t3s1', u'id': 42, u'remote_ip': u'10.2.21.2'}]}, {u'mem': 4, u'name': u't3_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't3br1if2', u'vmif': u't3VM2if1'}])  => {"ansible_loop_var": "item", "changed": false, "item": [{"bridge_ip": "1.1.1.1", "bridge_name": "t3br1", "default_route_ip": "10.1.21.1", "dns": [{"brif": "t3s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t3s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t3ns1", "route": [{"if": "p1", "ip": "10.1.21.1/24", "ns_if": "t3if", "ns_name": "t3"}], "tenant_ns": [{"tenant_ns_if": "t3ns1if", "tenant_ns_ip": "10.1.21.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s1if", "tenant_sub_ip": "10.1.21.2/24"}], "vxlan": [{"dev": "t3s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.21.2", "remote_ip": "10.2.21.2", "remote_route": "10.2.21.0/24", "subnet_route": "10.1.21.0/24", "tenant_route_ip": "192.168.3.2", "v_name": "vxlan_t3s1"}]}, {"brif": "t3br1if2", "disk": "10G", "mem": 4, "name": "t3_VM2", "vcpu": 2, "vmif": "t3VM2if1"}], "skip_reason": "Conditional result was False"}
skipping: [localhost] => (item=[{u'route': [{u'ip': u'10.1.22.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.1.22.1', u'bridge_name': u't3br2', u'dns': [{u'dnsif': u't3s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't3s2_dnsbrif'}], u'ns_name': u't3ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.22.2/24', u'tenant_ns_ip': u'10.1.22.1/24', u'tenant_ns_if': u't3ns2if', u'tenant_sub_if': u't3s2if', u'tenant_ns_name': u't3'}], u'bridge_ip': u'2.2.2.1', u'vxlan': [{u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}, {u'mem': 3, u'name': u't3_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't3br2if1', u'vmif': u't3VM3if1'}])  => {"ansible_loop_var": "item", "changed": false, "item": [{"bridge_ip": "2.2.2.1", "bridge_name": "t3br2", "default_route_ip": "10.1.22.1", "dns": [{"brif": "t3s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t3s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t3ns2", "route": [{"if": "p1", "ip": "10.1.22.1/24", "ns_if": "t3if", "ns_name": "t3"}], "tenant_ns": [{"tenant_ns_if": "t3ns2if", "tenant_ns_ip": "10.1.22.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s2if", "tenant_sub_ip": "10.1.22.2/24"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, {"brif": "t3br2if1", "disk": "10G", "mem": 3, "name": "t3_VM3", "vcpu": 2, "vmif": "t3VM3if1"}], "skip_reason": "Conditional result was False"}

TASK [Start VM] *********************************************************************************************************************************************
skipping: [localhost] => (item=[{u'route': [{u'ip': u'10.1.21.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.1.21.1', u'bridge_name': u't3br1', u'dns': [{u'dnsif': u't3s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't3s1_dnsbrif'}], u'ns_name': u't3ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.21.2/24', u'tenant_ns_ip': u'10.1.21.1/24', u'tenant_ns_if': u't3ns1if', u'tenant_sub_if': u't3s1if', u'tenant_ns_name': u't3'}], u'bridge_ip': u'1.1.1.1', u'vxlan': [{u'local_ip': u'10.1.21.2', u'dsport': 4789, u'dev': u't3s1if', u'tenant_route_ip': u'192.168.3.2', u'remote_route': u'10.2.21.0/24', u'subnet_route': u'10.1.21.0/24', u'v_name': u'vxlan_t3s1', u'id': 42, u'remote_ip': u'10.2.21.2'}]}, {u'mem': 2, u'name': u't3_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't3br1if1', u'vmif': u't3VM1if1'}])  => {"ansible_loop_var": "item", "changed": false, "item": [{"bridge_ip": "1.1.1.1", "bridge_name": "t3br1", "default_route_ip": "10.1.21.1", "dns": [{"brif": "t3s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t3s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t3ns1", "route": [{"if": "p1", "ip": "10.1.21.1/24", "ns_if": "t3if", "ns_name": "t3"}], "tenant_ns": [{"tenant_ns_if": "t3ns1if", "tenant_ns_ip": "10.1.21.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s1if", "tenant_sub_ip": "10.1.21.2/24"}], "vxlan": [{"dev": "t3s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.21.2", "remote_ip": "10.2.21.2", "remote_route": "10.2.21.0/24", "subnet_route": "10.1.21.0/24", "tenant_route_ip": "192.168.3.2", "v_name": "vxlan_t3s1"}]}, {"brif": "t3br1if1", "disk": "10G", "mem": 2, "name": "t3_VM1", "vcpu": 4, "vmif": "t3VM1if1"}], "skip_reason": "Conditional result was False"}
skipping: [localhost] => (item=[{u'route': [{u'ip': u'10.1.21.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.1.21.1', u'bridge_name': u't3br1', u'dns': [{u'dnsif': u't3s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't3s1_dnsbrif'}], u'ns_name': u't3ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.21.2/24', u'tenant_ns_ip': u'10.1.21.1/24', u'tenant_ns_if': u't3ns1if', u'tenant_sub_if': u't3s1if', u'tenant_ns_name': u't3'}], u'bridge_ip': u'1.1.1.1', u'vxlan': [{u'local_ip': u'10.1.21.2', u'dsport': 4789, u'dev': u't3s1if', u'tenant_route_ip': u'192.168.3.2', u'remote_route': u'10.2.21.0/24', u'subnet_route': u'10.1.21.0/24', u'v_name': u'vxlan_t3s1', u'id': 42, u'remote_ip': u'10.2.21.2'}]}, {u'mem': 4, u'name': u't3_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't3br1if2', u'vmif': u't3VM2if1'}])  => {"ansible_loop_var": "item", "changed": false, "item": [{"bridge_ip": "1.1.1.1", "bridge_name": "t3br1", "default_route_ip": "10.1.21.1", "dns": [{"brif": "t3s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t3s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t3ns1", "route": [{"if": "p1", "ip": "10.1.21.1/24", "ns_if": "t3if", "ns_name": "t3"}], "tenant_ns": [{"tenant_ns_if": "t3ns1if", "tenant_ns_ip": "10.1.21.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s1if", "tenant_sub_ip": "10.1.21.2/24"}], "vxlan": [{"dev": "t3s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.21.2", "remote_ip": "10.2.21.2", "remote_route": "10.2.21.0/24", "subnet_route": "10.1.21.0/24", "tenant_route_ip": "192.168.3.2", "v_name": "vxlan_t3s1"}]}, {"brif": "t3br1if2", "disk": "10G", "mem": 4, "name": "t3_VM2", "vcpu": 2, "vmif": "t3VM2if1"}], "skip_reason": "Conditional result was False"}
skipping: [localhost] => (item=[{u'route': [{u'ip': u'10.1.22.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.1.22.1', u'bridge_name': u't3br2', u'dns': [{u'dnsif': u't3s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't3s2_dnsbrif'}], u'ns_name': u't3ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.22.2/24', u'tenant_ns_ip': u'10.1.22.1/24', u'tenant_ns_if': u't3ns2if', u'tenant_sub_if': u't3s2if', u'tenant_ns_name': u't3'}], u'bridge_ip': u'2.2.2.1', u'vxlan': [{u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}, {u'mem': 3, u'name': u't3_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't3br2if1', u'vmif': u't3VM3if1'}])  => {"ansible_loop_var": "item", "changed": false, "item": [{"bridge_ip": "2.2.2.1", "bridge_name": "t3br2", "default_route_ip": "10.1.22.1", "dns": [{"brif": "t3s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t3s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t3ns2", "route": [{"if": "p1", "ip": "10.1.22.1/24", "ns_if": "t3if", "ns_name": "t3"}], "tenant_ns": [{"tenant_ns_if": "t3ns2if", "tenant_ns_ip": "10.1.22.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s2if", "tenant_sub_ip": "10.1.22.2/24"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, {"brif": "t3br2if1", "disk": "10G", "mem": 3, "name": "t3_VM3", "vcpu": 2, "vmif": "t3VM3if1"}], "skip_reason": "Conditional result was False"}

TASK [Attach VM interface] **********************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.21.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.1.21.1', u'bridge_name': u't3br1', u'dns': [{u'dnsif': u't3s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't3s1_dnsbrif'}], u'ns_name': u't3ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.21.2/24', u'tenant_ns_ip': u'10.1.21.1/24', u'tenant_ns_if': u't3ns1if', u'tenant_sub_if': u't3s1if', u'tenant_ns_name': u't3'}], u'bridge_ip': u'1.1.1.1', u'vxlan': [{u'local_ip': u'10.1.21.2', u'dsport': 4789, u'dev': u't3s1if', u'tenant_route_ip': u'192.168.3.2', u'remote_route': u'10.2.21.0/24', u'subnet_route': u'10.1.21.0/24', u'v_name': u'vxlan_t3s1', u'id': 42, u'remote_ip': u'10.2.21.2'}]}, {u'mem': 2, u'name': u't3_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't3br1if1', u'vmif': u't3VM1if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "virsh domiflist \"t3_VM1\" | grep -w 't3VM1if1' ; if [ $? -ne 0 ] ; then virsh attach-interface \"t3_VM1\" direct \"t3VM1if1\" --live --persistent ; fi\n", "delta": "0:00:00.019503", "end": "2019-11-17 10:29:33.140509", "item": [{"bridge_ip": "1.1.1.1", "bridge_name": "t3br1", "default_route_ip": "10.1.21.1", "dns": [{"brif": "t3s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t3s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t3ns1", "route": [{"if": "p1", "ip": "10.1.21.1/24", "ns_if": "t3if", "ns_name": "t3"}], "tenant_ns": [{"tenant_ns_if": "t3ns1if", "tenant_ns_ip": "10.1.21.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s1if", "tenant_sub_ip": "10.1.21.2/24"}], "vxlan": [{"dev": "t3s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.21.2", "remote_ip": "10.2.21.2", "remote_route": "10.2.21.0/24", "subnet_route": "10.1.21.0/24", "tenant_route_ip": "192.168.3.2", "v_name": "vxlan_t3s1"}]}, {"brif": "t3br1if1", "disk": "10G", "mem": 2, "name": "t3_VM1", "vcpu": 4, "vmif": "t3VM1if1"}], "rc": 0, "start": "2019-11-17 10:29:33.121006", "stderr": "", "stderr_lines": [], "stdout": "macvtap6   direct     t3VM1if1   rtl8139     52:54:00:92:ce:f1", "stdout_lines": ["macvtap6   direct     t3VM1if1   rtl8139     52:54:00:92:ce:f1"]}
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.21.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.1.21.1', u'bridge_name': u't3br1', u'dns': [{u'dnsif': u't3s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't3s1_dnsbrif'}], u'ns_name': u't3ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.21.2/24', u'tenant_ns_ip': u'10.1.21.1/24', u'tenant_ns_if': u't3ns1if', u'tenant_sub_if': u't3s1if', u'tenant_ns_name': u't3'}], u'bridge_ip': u'1.1.1.1', u'vxlan': [{u'local_ip': u'10.1.21.2', u'dsport': 4789, u'dev': u't3s1if', u'tenant_route_ip': u'192.168.3.2', u'remote_route': u'10.2.21.0/24', u'subnet_route': u'10.1.21.0/24', u'v_name': u'vxlan_t3s1', u'id': 42, u'remote_ip': u'10.2.21.2'}]}, {u'mem': 4, u'name': u't3_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't3br1if2', u'vmif': u't3VM2if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "virsh domiflist \"t3_VM2\" | grep -w 't3VM2if1' ; if [ $? -ne 0 ] ; then virsh attach-interface \"t3_VM2\" direct \"t3VM2if1\" --live --persistent ; fi\n", "delta": "0:00:00.021608", "end": "2019-11-17 10:29:33.302396", "item": [{"bridge_ip": "1.1.1.1", "bridge_name": "t3br1", "default_route_ip": "10.1.21.1", "dns": [{"brif": "t3s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t3s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t3ns1", "route": [{"if": "p1", "ip": "10.1.21.1/24", "ns_if": "t3if", "ns_name": "t3"}], "tenant_ns": [{"tenant_ns_if": "t3ns1if", "tenant_ns_ip": "10.1.21.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s1if", "tenant_sub_ip": "10.1.21.2/24"}], "vxlan": [{"dev": "t3s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.21.2", "remote_ip": "10.2.21.2", "remote_route": "10.2.21.0/24", "subnet_route": "10.1.21.0/24", "tenant_route_ip": "192.168.3.2", "v_name": "vxlan_t3s1"}]}, {"brif": "t3br1if2", "disk": "10G", "mem": 4, "name": "t3_VM2", "vcpu": 2, "vmif": "t3VM2if1"}], "rc": 0, "start": "2019-11-17 10:29:33.280788", "stderr": "", "stderr_lines": [], "stdout": "macvtap7   direct     t3VM2if1   rtl8139     52:54:00:9e:b2:45", "stdout_lines": ["macvtap7   direct     t3VM2if1   rtl8139     52:54:00:9e:b2:45"]}
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.22.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.1.22.1', u'bridge_name': u't3br2', u'dns': [{u'dnsif': u't3s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't3s2_dnsbrif'}], u'ns_name': u't3ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.22.2/24', u'tenant_ns_ip': u'10.1.22.1/24', u'tenant_ns_if': u't3ns2if', u'tenant_sub_if': u't3s2if', u'tenant_ns_name': u't3'}], u'bridge_ip': u'2.2.2.1', u'vxlan': [{u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}, {u'mem': 3, u'name': u't3_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't3br2if1', u'vmif': u't3VM3if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "virsh domiflist \"t3_VM3\" | grep -w 't3VM3if1' ; if [ $? -ne 0 ] ; then virsh attach-interface \"t3_VM3\" direct \"t3VM3if1\" --live --persistent ; fi\n", "delta": "0:00:00.020213", "end": "2019-11-17 10:29:33.470063", "item": [{"bridge_ip": "2.2.2.1", "bridge_name": "t3br2", "default_route_ip": "10.1.22.1", "dns": [{"brif": "t3s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t3s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t3ns2", "route": [{"if": "p1", "ip": "10.1.22.1/24", "ns_if": "t3if", "ns_name": "t3"}], "tenant_ns": [{"tenant_ns_if": "t3ns2if", "tenant_ns_ip": "10.1.22.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s2if", "tenant_sub_ip": "10.1.22.2/24"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, {"brif": "t3br2if1", "disk": "10G", "mem": 3, "name": "t3_VM3", "vcpu": 2, "vmif": "t3VM3if1"}], "rc": 0, "start": "2019-11-17 10:29:33.449850", "stderr": "", "stderr_lines": [], "stdout": "macvtap8   direct     t3VM3if1   rtl8139     52:54:00:48:7c:1a", "stdout_lines": ["macvtap8   direct     t3VM3if1   rtl8139     52:54:00:48:7c:1a"]}

PLAY RECAP **************************************************************************************************************************************************
localhost                  : ok=4    changed=1    unreachable=0    failed=0    skipped=3    rescued=0    ignored=0   

Using /etc/ansible/ansible.cfg as config file

PLAY [worker] ***********************************************************************************************************************************************

TASK [Copy VM image] ****************************************************************************************************************************************
ok: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.21.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.2.21.1', u'bridge_name': u't3br1', u'dns': [{u'dnsif': u't3s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't3s1_dnsbrif'}], u'ns_name': u't3ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.21.2/24', u'tenant_ns_ip': u'10.2.21.1/24', u'tenant_ns_if': u't3ns1if', u'tenant_sub_if': u't3s1if', u'tenant_ns_name': u't3'}], u'bridge_ip': u'1.1.1.1', u'vxlan': [{u'local_ip': u'10.2.21.2', u'dsport': 4789, u'dev': u't3s1if', u'tenant_route_ip': u'192.168.131.2', u'remote_route': u'10.1.21.0/24', u'subnet_route': u'10.2.21.0/24', u'v_name': u'vxlan_t3s1', u'id': 42, u'remote_ip': u'10.1.21.2'}]}, {u'mem': 2, u'name': u't3_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't3br1if1', u'vmif': u't3VM4if1'}]) => {"ansible_loop_var": "item", "changed": false, "dest": "/var/lib/libvirt/images/t3_VM4.qcow2", "gid": 113, "group": "kvm", "item": [{"bridge_ip": "1.1.1.1", "bridge_name": "t3br1", "default_route_ip": "10.2.21.1", "dns": [{"brif": "t3s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t3s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "ns_name": "t3ns1", "route": [{"if": "p1", "ip": "10.2.21.1/24", "ns_if": "t3if", "ns_name": "t3"}], "tenant_ns": [{"tenant_ns_if": "t3ns1if", "tenant_ns_ip": "10.2.21.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s1if", "tenant_sub_ip": "10.2.21.2/24"}], "vxlan": [{"dev": "t3s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.21.2", "remote_ip": "10.1.21.2", "remote_route": "10.1.21.0/24", "subnet_route": "10.2.21.0/24", "tenant_route_ip": "192.168.131.2", "v_name": "vxlan_t3s1"}]}, {"brif": "t3br1if1", "disk": "10G", "mem": 2, "name": "t3_VM4", "vcpu": 4, "vmif": "t3VM4if1"}], "mode": "0644", "msg": "file already exists", "owner": "libvirt-qemu", "size": 10739318784, "src": "/root/mainVM.qcow2", "state": "file", "uid": 64055}
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.21.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.2.21.1', u'bridge_name': u't3br1', u'dns': [{u'dnsif': u't3s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't3s1_dnsbrif'}], u'ns_name': u't3ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.21.2/24', u'tenant_ns_ip': u'10.2.21.1/24', u'tenant_ns_if': u't3ns1if', u'tenant_sub_if': u't3s1if', u'tenant_ns_name': u't3'}], u'bridge_ip': u'1.1.1.1', u'vxlan': [{u'local_ip': u'10.2.21.2', u'dsport': 4789, u'dev': u't3s1if', u'tenant_route_ip': u'192.168.131.2', u'remote_route': u'10.1.21.0/24', u'subnet_route': u'10.2.21.0/24', u'v_name': u'vxlan_t3s1', u'id': 42, u'remote_ip': u'10.1.21.2'}]}, {u'mem': 2, u'name': u't3_VM5', u'vcpu': 4, u'disk': u'10G', u'brif': u't3br1if2', u'vmif': u't3VM5if1'}]) => {"ansible_loop_var": "item", "changed": true, "checksum": "f8b2ffa2bf201c84196c582f2dec0d33a1eb4b42", "dest": "/var/lib/libvirt/images/t3_VM5.qcow2", "gid": 0, "group": "root", "item": [{"bridge_ip": "1.1.1.1", "bridge_name": "t3br1", "default_route_ip": "10.2.21.1", "dns": [{"brif": "t3s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t3s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "ns_name": "t3ns1", "route": [{"if": "p1", "ip": "10.2.21.1/24", "ns_if": "t3if", "ns_name": "t3"}], "tenant_ns": [{"tenant_ns_if": "t3ns1if", "tenant_ns_ip": "10.2.21.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s1if", "tenant_sub_ip": "10.2.21.2/24"}], "vxlan": [{"dev": "t3s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.21.2", "remote_ip": "10.1.21.2", "remote_route": "10.1.21.0/24", "subnet_route": "10.2.21.0/24", "tenant_route_ip": "192.168.131.2", "v_name": "vxlan_t3s1"}]}, {"brif": "t3br1if2", "disk": "10G", "mem": 2, "name": "t3_VM5", "vcpu": 4, "vmif": "t3VM5if1"}], "md5sum": "e6d5d524b68797ddd748ba1475985d34", "mode": "0644", "owner": "root", "size": 10739318784, "src": "/root/mainVM.qcow2", "state": "file", "uid": 0}

TASK [Get list of running VMs] ******************************************************************************************************************************
ok: [99.99.99.2] => {"changed": false, "cmd": ["virsh", "list", "--name"], "delta": "0:00:00.019751", "end": "2019-11-17 10:31:53.457081", "rc": 0, "start": "2019-11-17 10:31:53.437330", "stderr": "", "stderr_lines": [], "stdout": "t1_VM4\nt2_VM4\nt3_VM4", "stdout_lines": ["t1_VM4", "t2_VM4", "t3_VM4"]}

TASK [Define VM] ********************************************************************************************************************************************
skipping: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.21.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.2.21.1', u'bridge_name': u't3br1', u'dns': [{u'dnsif': u't3s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't3s1_dnsbrif'}], u'ns_name': u't3ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.21.2/24', u'tenant_ns_ip': u'10.2.21.1/24', u'tenant_ns_if': u't3ns1if', u'tenant_sub_if': u't3s1if', u'tenant_ns_name': u't3'}], u'bridge_ip': u'1.1.1.1', u'vxlan': [{u'local_ip': u'10.2.21.2', u'dsport': 4789, u'dev': u't3s1if', u'tenant_route_ip': u'192.168.131.2', u'remote_route': u'10.1.21.0/24', u'subnet_route': u'10.2.21.0/24', u'v_name': u'vxlan_t3s1', u'id': 42, u'remote_ip': u'10.1.21.2'}]}, {u'mem': 2, u'name': u't3_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't3br1if1', u'vmif': u't3VM4if1'}])  => {"ansible_loop_var": "item", "changed": false, "item": [{"bridge_ip": "1.1.1.1", "bridge_name": "t3br1", "default_route_ip": "10.2.21.1", "dns": [{"brif": "t3s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t3s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "ns_name": "t3ns1", "route": [{"if": "p1", "ip": "10.2.21.1/24", "ns_if": "t3if", "ns_name": "t3"}], "tenant_ns": [{"tenant_ns_if": "t3ns1if", "tenant_ns_ip": "10.2.21.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s1if", "tenant_sub_ip": "10.2.21.2/24"}], "vxlan": [{"dev": "t3s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.21.2", "remote_ip": "10.1.21.2", "remote_route": "10.1.21.0/24", "subnet_route": "10.2.21.0/24", "tenant_route_ip": "192.168.131.2", "v_name": "vxlan_t3s1"}]}, {"brif": "t3br1if1", "disk": "10G", "mem": 2, "name": "t3_VM4", "vcpu": 4, "vmif": "t3VM4if1"}], "skip_reason": "Conditional result was False"}
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.21.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.2.21.1', u'bridge_name': u't3br1', u'dns': [{u'dnsif': u't3s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't3s1_dnsbrif'}], u'ns_name': u't3ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.21.2/24', u'tenant_ns_ip': u'10.2.21.1/24', u'tenant_ns_if': u't3ns1if', u'tenant_sub_if': u't3s1if', u'tenant_ns_name': u't3'}], u'bridge_ip': u'1.1.1.1', u'vxlan': [{u'local_ip': u'10.2.21.2', u'dsport': 4789, u'dev': u't3s1if', u'tenant_route_ip': u'192.168.131.2', u'remote_route': u'10.1.21.0/24', u'subnet_route': u'10.2.21.0/24', u'v_name': u'vxlan_t3s1', u'id': 42, u'remote_ip': u'10.1.21.2'}]}, {u'mem': 2, u'name': u't3_VM5', u'vcpu': 4, u'disk': u'10G', u'brif': u't3br1if2', u'vmif': u't3VM5if1'}]) => {"ansible_loop_var": "item", "changed": true, "created": "t3_VM5", "item": [{"bridge_ip": "1.1.1.1", "bridge_name": "t3br1", "default_route_ip": "10.2.21.1", "dns": [{"brif": "t3s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t3s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "ns_name": "t3ns1", "route": [{"if": "p1", "ip": "10.2.21.1/24", "ns_if": "t3if", "ns_name": "t3"}], "tenant_ns": [{"tenant_ns_if": "t3ns1if", "tenant_ns_ip": "10.2.21.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s1if", "tenant_sub_ip": "10.2.21.2/24"}], "vxlan": [{"dev": "t3s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.21.2", "remote_ip": "10.1.21.2", "remote_route": "10.1.21.0/24", "subnet_route": "10.2.21.0/24", "tenant_route_ip": "192.168.131.2", "v_name": "vxlan_t3s1"}]}, {"brif": "t3br1if2", "disk": "10G", "mem": 2, "name": "t3_VM5", "vcpu": 4, "vmif": "t3VM5if1"}], "warnings": ["'xml' is given - ignoring 'name'"]}

TASK [Create VM] ********************************************************************************************************************************************
skipping: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.21.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.2.21.1', u'bridge_name': u't3br1', u'dns': [{u'dnsif': u't3s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't3s1_dnsbrif'}], u'ns_name': u't3ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.21.2/24', u'tenant_ns_ip': u'10.2.21.1/24', u'tenant_ns_if': u't3ns1if', u'tenant_sub_if': u't3s1if', u'tenant_ns_name': u't3'}], u'bridge_ip': u'1.1.1.1', u'vxlan': [{u'local_ip': u'10.2.21.2', u'dsport': 4789, u'dev': u't3s1if', u'tenant_route_ip': u'192.168.131.2', u'remote_route': u'10.1.21.0/24', u'subnet_route': u'10.2.21.0/24', u'v_name': u'vxlan_t3s1', u'id': 42, u'remote_ip': u'10.1.21.2'}]}, {u'mem': 2, u'name': u't3_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't3br1if1', u'vmif': u't3VM4if1'}])  => {"ansible_loop_var": "item", "changed": false, "item": [{"bridge_ip": "1.1.1.1", "bridge_name": "t3br1", "default_route_ip": "10.2.21.1", "dns": [{"brif": "t3s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t3s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "ns_name": "t3ns1", "route": [{"if": "p1", "ip": "10.2.21.1/24", "ns_if": "t3if", "ns_name": "t3"}], "tenant_ns": [{"tenant_ns_if": "t3ns1if", "tenant_ns_ip": "10.2.21.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s1if", "tenant_sub_ip": "10.2.21.2/24"}], "vxlan": [{"dev": "t3s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.21.2", "remote_ip": "10.1.21.2", "remote_route": "10.1.21.0/24", "subnet_route": "10.2.21.0/24", "tenant_route_ip": "192.168.131.2", "v_name": "vxlan_t3s1"}]}, {"brif": "t3br1if1", "disk": "10G", "mem": 2, "name": "t3_VM4", "vcpu": 4, "vmif": "t3VM4if1"}], "skip_reason": "Conditional result was False"}
ok: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.21.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.2.21.1', u'bridge_name': u't3br1', u'dns': [{u'dnsif': u't3s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't3s1_dnsbrif'}], u'ns_name': u't3ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.21.2/24', u'tenant_ns_ip': u'10.2.21.1/24', u'tenant_ns_if': u't3ns1if', u'tenant_sub_if': u't3s1if', u'tenant_ns_name': u't3'}], u'bridge_ip': u'1.1.1.1', u'vxlan': [{u'local_ip': u'10.2.21.2', u'dsport': 4789, u'dev': u't3s1if', u'tenant_route_ip': u'192.168.131.2', u'remote_route': u'10.1.21.0/24', u'subnet_route': u'10.2.21.0/24', u'v_name': u'vxlan_t3s1', u'id': 42, u'remote_ip': u'10.1.21.2'}]}, {u'mem': 2, u'name': u't3_VM5', u'vcpu': 4, u'disk': u'10G', u'brif': u't3br1if2', u'vmif': u't3VM5if1'}]) => {"ansible_loop_var": "item", "changed": false, "create": 0, "item": [{"bridge_ip": "1.1.1.1", "bridge_name": "t3br1", "default_route_ip": "10.2.21.1", "dns": [{"brif": "t3s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t3s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "ns_name": "t3ns1", "route": [{"if": "p1", "ip": "10.2.21.1/24", "ns_if": "t3if", "ns_name": "t3"}], "tenant_ns": [{"tenant_ns_if": "t3ns1if", "tenant_ns_ip": "10.2.21.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s1if", "tenant_sub_ip": "10.2.21.2/24"}], "vxlan": [{"dev": "t3s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.21.2", "remote_ip": "10.1.21.2", "remote_route": "10.1.21.0/24", "subnet_route": "10.2.21.0/24", "tenant_route_ip": "192.168.131.2", "v_name": "vxlan_t3s1"}]}, {"brif": "t3br1if2", "disk": "10G", "mem": 2, "name": "t3_VM5", "vcpu": 4, "vmif": "t3VM5if1"}]}

TASK [Start VM] *********************************************************************************************************************************************
skipping: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.21.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.2.21.1', u'bridge_name': u't3br1', u'dns': [{u'dnsif': u't3s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't3s1_dnsbrif'}], u'ns_name': u't3ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.21.2/24', u'tenant_ns_ip': u'10.2.21.1/24', u'tenant_ns_if': u't3ns1if', u'tenant_sub_if': u't3s1if', u'tenant_ns_name': u't3'}], u'bridge_ip': u'1.1.1.1', u'vxlan': [{u'local_ip': u'10.2.21.2', u'dsport': 4789, u'dev': u't3s1if', u'tenant_route_ip': u'192.168.131.2', u'remote_route': u'10.1.21.0/24', u'subnet_route': u'10.2.21.0/24', u'v_name': u'vxlan_t3s1', u'id': 42, u'remote_ip': u'10.1.21.2'}]}, {u'mem': 2, u'name': u't3_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't3br1if1', u'vmif': u't3VM4if1'}])  => {"ansible_loop_var": "item", "changed": false, "item": [{"bridge_ip": "1.1.1.1", "bridge_name": "t3br1", "default_route_ip": "10.2.21.1", "dns": [{"brif": "t3s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t3s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "ns_name": "t3ns1", "route": [{"if": "p1", "ip": "10.2.21.1/24", "ns_if": "t3if", "ns_name": "t3"}], "tenant_ns": [{"tenant_ns_if": "t3ns1if", "tenant_ns_ip": "10.2.21.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s1if", "tenant_sub_ip": "10.2.21.2/24"}], "vxlan": [{"dev": "t3s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.21.2", "remote_ip": "10.1.21.2", "remote_route": "10.1.21.0/24", "subnet_route": "10.2.21.0/24", "tenant_route_ip": "192.168.131.2", "v_name": "vxlan_t3s1"}]}, {"brif": "t3br1if1", "disk": "10G", "mem": 2, "name": "t3_VM4", "vcpu": 4, "vmif": "t3VM4if1"}], "skip_reason": "Conditional result was False"}
ok: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.21.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.2.21.1', u'bridge_name': u't3br1', u'dns': [{u'dnsif': u't3s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't3s1_dnsbrif'}], u'ns_name': u't3ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.21.2/24', u'tenant_ns_ip': u'10.2.21.1/24', u'tenant_ns_if': u't3ns1if', u'tenant_sub_if': u't3s1if', u'tenant_ns_name': u't3'}], u'bridge_ip': u'1.1.1.1', u'vxlan': [{u'local_ip': u'10.2.21.2', u'dsport': 4789, u'dev': u't3s1if', u'tenant_route_ip': u'192.168.131.2', u'remote_route': u'10.1.21.0/24', u'subnet_route': u'10.2.21.0/24', u'v_name': u'vxlan_t3s1', u'id': 42, u'remote_ip': u'10.1.21.2'}]}, {u'mem': 2, u'name': u't3_VM5', u'vcpu': 4, u'disk': u'10G', u'brif': u't3br1if2', u'vmif': u't3VM5if1'}]) => {"ansible_loop_var": "item", "changed": false, "item": [{"bridge_ip": "1.1.1.1", "bridge_name": "t3br1", "default_route_ip": "10.2.21.1", "dns": [{"brif": "t3s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t3s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "ns_name": "t3ns1", "route": [{"if": "p1", "ip": "10.2.21.1/24", "ns_if": "t3if", "ns_name": "t3"}], "tenant_ns": [{"tenant_ns_if": "t3ns1if", "tenant_ns_ip": "10.2.21.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s1if", "tenant_sub_ip": "10.2.21.2/24"}], "vxlan": [{"dev": "t3s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.21.2", "remote_ip": "10.1.21.2", "remote_route": "10.1.21.0/24", "subnet_route": "10.2.21.0/24", "tenant_route_ip": "192.168.131.2", "v_name": "vxlan_t3s1"}]}, {"brif": "t3br1if2", "disk": "10G", "mem": 2, "name": "t3_VM5", "vcpu": 4, "vmif": "t3VM5if1"}]}

TASK [Attach VM interface] **********************************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.21.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.2.21.1', u'bridge_name': u't3br1', u'dns': [{u'dnsif': u't3s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't3s1_dnsbrif'}], u'ns_name': u't3ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.21.2/24', u'tenant_ns_ip': u'10.2.21.1/24', u'tenant_ns_if': u't3ns1if', u'tenant_sub_if': u't3s1if', u'tenant_ns_name': u't3'}], u'bridge_ip': u'1.1.1.1', u'vxlan': [{u'local_ip': u'10.2.21.2', u'dsport': 4789, u'dev': u't3s1if', u'tenant_route_ip': u'192.168.131.2', u'remote_route': u'10.1.21.0/24', u'subnet_route': u'10.2.21.0/24', u'v_name': u'vxlan_t3s1', u'id': 42, u'remote_ip': u'10.1.21.2'}]}, {u'mem': 2, u'name': u't3_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't3br1if1', u'vmif': u't3VM4if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "virsh domiflist \"t3_VM4\" | grep -w 't3VM4if1' ; if [ $? -ne 0 ] ; then virsh attach-interface \"t3_VM4\" direct \"t3VM4if1\" --live --persistent ; fi\n", "delta": "0:00:00.019663", "end": "2019-11-17 10:32:02.761106", "item": [{"bridge_ip": "1.1.1.1", "bridge_name": "t3br1", "default_route_ip": "10.2.21.1", "dns": [{"brif": "t3s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t3s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "ns_name": "t3ns1", "route": [{"if": "p1", "ip": "10.2.21.1/24", "ns_if": "t3if", "ns_name": "t3"}], "tenant_ns": [{"tenant_ns_if": "t3ns1if", "tenant_ns_ip": "10.2.21.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s1if", "tenant_sub_ip": "10.2.21.2/24"}], "vxlan": [{"dev": "t3s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.21.2", "remote_ip": "10.1.21.2", "remote_route": "10.1.21.0/24", "subnet_route": "10.2.21.0/24", "tenant_route_ip": "192.168.131.2", "v_name": "vxlan_t3s1"}]}, {"brif": "t3br1if1", "disk": "10G", "mem": 2, "name": "t3_VM4", "vcpu": 4, "vmif": "t3VM4if1"}], "rc": 0, "start": "2019-11-17 10:32:02.741443", "stderr": "", "stderr_lines": [], "stdout": "macvtap2   direct     t3VM4if1   rtl8139     52:54:00:cf:6c:38", "stdout_lines": ["macvtap2   direct     t3VM4if1   rtl8139     52:54:00:cf:6c:38"]}
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.21.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.2.21.1', u'bridge_name': u't3br1', u'dns': [{u'dnsif': u't3s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't3s1_dnsbrif'}], u'ns_name': u't3ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.21.2/24', u'tenant_ns_ip': u'10.2.21.1/24', u'tenant_ns_if': u't3ns1if', u'tenant_sub_if': u't3s1if', u'tenant_ns_name': u't3'}], u'bridge_ip': u'1.1.1.1', u'vxlan': [{u'local_ip': u'10.2.21.2', u'dsport': 4789, u'dev': u't3s1if', u'tenant_route_ip': u'192.168.131.2', u'remote_route': u'10.1.21.0/24', u'subnet_route': u'10.2.21.0/24', u'v_name': u'vxlan_t3s1', u'id': 42, u'remote_ip': u'10.1.21.2'}]}, {u'mem': 2, u'name': u't3_VM5', u'vcpu': 4, u'disk': u'10G', u'brif': u't3br1if2', u'vmif': u't3VM5if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "virsh domiflist \"t3_VM5\" | grep -w 't3VM5if1' ; if [ $? -ne 0 ] ; then virsh attach-interface \"t3_VM5\" direct \"t3VM5if1\" --live --persistent ; fi\n", "delta": "0:00:00.244040", "end": "2019-11-17 10:32:03.249695", "item": [{"bridge_ip": "1.1.1.1", "bridge_name": "t3br1", "default_route_ip": "10.2.21.1", "dns": [{"brif": "t3s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t3s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "ns_name": "t3ns1", "route": [{"if": "p1", "ip": "10.2.21.1/24", "ns_if": "t3if", "ns_name": "t3"}], "tenant_ns": [{"tenant_ns_if": "t3ns1if", "tenant_ns_ip": "10.2.21.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s1if", "tenant_sub_ip": "10.2.21.2/24"}], "vxlan": [{"dev": "t3s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.21.2", "remote_ip": "10.1.21.2", "remote_route": "10.1.21.0/24", "subnet_route": "10.2.21.0/24", "tenant_route_ip": "192.168.131.2", "v_name": "vxlan_t3s1"}]}, {"brif": "t3br1if2", "disk": "10G", "mem": 2, "name": "t3_VM5", "vcpu": 4, "vmif": "t3VM5if1"}], "rc": 0, "start": "2019-11-17 10:32:03.005655", "stderr": "", "stderr_lines": [], "stdout": "Interface attached successfully", "stdout_lines": ["Interface attached successfully"]}

PLAY RECAP **************************************************************************************************************************************************
99.99.99.2                 : ok=6    changed=3    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0   

INFO:root: 10:32:48.780512 Unable to open user input yaml file
Using /etc/ansible/ansible.cfg as config file
Using /etc/ansible/ansible.cfg as config file
Using /etc/ansible/ansible.cfg as config file
Using /etc/ansible/ansible.cfg as config file
Using /etc/ansible/ansible.cfg as config file
Using /etc/ansible/ansible.cfg as config file
Using /etc/ansible/ansible.cfg as config file
Using /etc/ansible/ansible.cfg as config file
Using /etc/ansible/ansible.cfg as config file
Using /etc/ansible/ansible.cfg as config file
Using /etc/ansible/ansible.cfg as config file
Using /etc/ansible/ansible.cfg as config file
Using /etc/ansible/ansible.cfg as config file
Using /etc/ansible/ansible.cfg as config file
Using /etc/ansible/ansible.cfg as config file
Using /etc/ansible/ansible.cfg as config file
INFO:root: 10:32:59.095143 Unable to open user input yaml file
Using /etc/ansible/ansible.cfg as config file
Using /etc/ansible/ansible.cfg as config file
Using /etc/ansible/ansible.cfg as config file
Using /etc/ansible/ansible.cfg as config file
Using /etc/ansible/ansible.cfg as config file
Using /etc/ansible/ansible.cfg as config file
Using /etc/ansible/ansible.cfg as config file
Using /etc/ansible/ansible.cfg as config file
Using /etc/ansible/ansible.cfg as config file
Using /etc/ansible/ansible.cfg as config file
Using /etc/ansible/ansible.cfg as config file
Using /etc/ansible/ansible.cfg as config file
Using /etc/ansible/ansible.cfg as config file
Using /etc/ansible/ansible.cfg as config file
Using /etc/ansible/ansible.cfg as config file
Using /etc/ansible/ansible.cfg as config file
INFO:root: 10:34:58.051171 Printing the yaml input file
INFO:root: 10:34:58.051319 {'C1': [{'subnet_addr': '1.1.1.0/24', 'VM': [{'name': 'VM1', 'disk': '10G', 'mem': 2, 'vcpu': 4}, {'name': 'VM2', 'disk': '10G', 'mem': 4, 'vcpu': 2}]}, {'subnet_addr': '2.2.2.0/24', 'VM': [{'name': 'VM3', 'disk': '10G', 'mem': 3, 'vcpu': 2}]}], 'C2': [{'subnet_addr': '1.1.1.0/24', 'VM': [{'name': 'VM4', 'disk': '10G', 'mem': 2, 'vcpu': 4}, {'name': 'VM5', 'disk': '10G', 'mem': 2, 'vcpu': 4}]}, {'subnet_addr': '2.2.2.0/24', 'VM': [{'name': 'VM6', 'disk': '10G', 'mem': 2, 'vcpu': 4}]}]}
INFO:root: 10:34:58.051452 Provided subnet in C1: 1.1.1.0/24 is valid
ERROR:root: 10:34:58.051488Multiple subnet in the C1 are same
Using /etc/ansible/ansible.cfg as config file

PLAY [main] *************************************************************************************************************************************************

TASK [Create Tenant Namespace] ******************************************************************************************************************************
ok: [localhost] => (item={u'default_route_ip': u'192.168.3.1', u'name': u't3', u'pns_ip': u'192.168.3.1/24', u'tenant_if': u't3if', u'tenant_ip': u'192.168.3.2/24', u'pns_if': u't3pns_if'}) => {"ansible_loop_var": "item", "changed": false, "cmd": ["ip", "netns", "add", "t3"], "item": {"default_route_ip": "192.168.3.1", "name": "t3", "pns_if": "t3pns_if", "pns_ip": "192.168.3.1/24", "tenant_if": "t3if", "tenant_ip": "192.168.3.2/24"}, "rc": 0, "stdout": "skipped, since /var/run/netns/t3 exists", "stdout_lines": ["skipped, since /var/run/netns/t3 exists"]}

TASK [Create Subnet Namespace] ******************************************************************************************************************************
ok: [localhost] => (item={u'route': [{u'ip': u'10.1.21.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.1.21.1', u'bridge_name': u't3br1', u'dns': [{u'dnsif': u't3s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't3s1_dnsbrif'}], u'ns_name': u't3ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.21.2/24', u'tenant_ns_ip': u'10.1.21.1/24', u'tenant_ns_if': u't3ns1if', u'tenant_ns_name': u't3', u'tenant_sub_if': u't3s1if'}], u'bridge_ip': u'1.1.1.1', u'vms': [{u'mem': 2, u'name': u't3_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't3br1if1', u'vmif': u't3VM1if1'}, {u'mem': 4, u'name': u't3_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't3br1if2', u'vmif': u't3VM2if1'}], u'vxlan': [{u'local_ip': u'10.1.21.2', u'tenant_route_ip': u'192.168.3.2', u'dsport': 4789, u'dev': u't3s1if', u'subnet_route': u'10.1.21.0/24', u'remote_route': u'10.2.21.0/24', u'v_name': u'vxlan_t3s1', u'id': 42, u'remote_ip': u'10.2.21.2'}]}) => {"ansible_loop_var": "item", "changed": false, "cmd": ["ip", "netns", "add", "t3ns1"], "item": {"bridge_ip": "1.1.1.1", "bridge_name": "t3br1", "default_route_ip": "10.1.21.1", "dns": [{"brif": "t3s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t3s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t3ns1", "route": [{"if": "p1", "ip": "10.1.21.1/24", "ns_if": "t3if", "ns_name": "t3"}], "tenant_ns": [{"tenant_ns_if": "t3ns1if", "tenant_ns_ip": "10.1.21.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s1if", "tenant_sub_ip": "10.1.21.2/24"}], "vms": [{"brif": "t3br1if1", "disk": "10G", "mem": 2, "name": "t3_VM1", "vcpu": 4, "vmif": "t3VM1if1"}, {"brif": "t3br1if2", "disk": "10G", "mem": 4, "name": "t3_VM2", "vcpu": 2, "vmif": "t3VM2if1"}], "vxlan": [{"dev": "t3s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.21.2", "remote_ip": "10.2.21.2", "remote_route": "10.2.21.0/24", "subnet_route": "10.1.21.0/24", "tenant_route_ip": "192.168.3.2", "v_name": "vxlan_t3s1"}]}, "rc": 0, "stdout": "skipped, since /var/run/netns/t3ns1 exists", "stdout_lines": ["skipped, since /var/run/netns/t3ns1 exists"]}
ok: [localhost] => (item={u'route': [{u'ip': u'10.1.22.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.1.22.1', u'bridge_name': u't3br2', u'dns': [{u'dnsif': u't3s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.126', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't3s2_dnsbrif'}], u'ns_name': u't3ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.22.2/24', u'tenant_ns_ip': u'10.1.22.1/24', u'tenant_ns_if': u't3ns2if', u'tenant_ns_name': u't3', u'tenant_sub_if': u't3s2if'}], u'bridge_ip': u'2.2.2.1', u'vms': [{u'mem': 3, u'name': u't3_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't3br2if1', u'vmif': u't3VM3if1'}], u'vxlan': [{u'local_ip': u'10.1.22.2', u'tenant_route_ip': u'192.168.3.2', u'dsport': 4789, u'dev': u't3s2if', u'subnet_route': u'10.1.22.0/24', u'remote_route': u'10.2.22.0/24', u'v_name': u'vxlan_t3s2', u'id': 42, u'remote_ip': u'10.2.22.2'}]}) => {"ansible_loop_var": "item", "changed": false, "cmd": ["ip", "netns", "add", "t3ns2"], "item": {"bridge_ip": "2.2.2.1", "bridge_name": "t3br2", "default_route_ip": "10.1.22.1", "dns": [{"brif": "t3s2_dnsbrif", "dhcp_end": "2.2.2.126", "dhcp_start": "2.2.2.5", "dnsif": "t3s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t3ns2", "route": [{"if": "p1", "ip": "10.1.22.1/24", "ns_if": "t3if", "ns_name": "t3"}], "tenant_ns": [{"tenant_ns_if": "t3ns2if", "tenant_ns_ip": "10.1.22.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s2if", "tenant_sub_ip": "10.1.22.2/24"}], "vms": [{"brif": "t3br2if1", "disk": "10G", "mem": 3, "name": "t3_VM3", "vcpu": 2, "vmif": "t3VM3if1"}], "vxlan": [{"dev": "t3s2if", "dsport": 4789, "id": 42, "local_ip": "10.1.22.2", "remote_ip": "10.2.22.2", "remote_route": "10.2.22.0/24", "subnet_route": "10.1.22.0/24", "tenant_route_ip": "192.168.3.2", "v_name": "vxlan_t3s2"}]}, "rc": 0, "stdout": "skipped, since /var/run/netns/t3ns2 exists", "stdout_lines": ["skipped, since /var/run/netns/t3ns2 exists"]}

TASK [Create Tenant VETH pairs] *****************************************************************************************************************************
changed: [localhost] => (item={u'default_route_ip': u'192.168.3.1', u'name': u't3', u'pns_ip': u'192.168.3.1/24', u'tenant_if': u't3if', u'tenant_ip': u'192.168.3.2/24', u'pns_if': u't3pns_if'}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip link show \"t3if\" ; if [ $? -ne 0 ] ; then ip link add \"t3if\" type veth peer name \"t3pns_if\" ; fi\n", "delta": "0:00:00.004063", "end": "2019-11-17 10:35:00.042770", "item": {"default_route_ip": "192.168.3.1", "name": "t3", "pns_if": "t3pns_if", "pns_ip": "192.168.3.1/24", "tenant_if": "t3if", "tenant_ip": "192.168.3.2/24"}, "rc": 0, "start": "2019-11-17 10:35:00.038707", "stderr": "", "stderr_lines": [], "stdout": "88: t3if@t3pns_if: <BROADCAST,MULTICAST> mtu 1500 qdisc noop state DOWN mode DEFAULT group default qlen 1000\n    link/ether d6:be:f7:a4:ef:d3 brd ff:ff:ff:ff:ff:ff", "stdout_lines": ["88: t3if@t3pns_if: <BROADCAST,MULTICAST> mtu 1500 qdisc noop state DOWN mode DEFAULT group default qlen 1000", "    link/ether d6:be:f7:a4:ef:d3 brd ff:ff:ff:ff:ff:ff"]}

TASK [Attach Tenant VETH Pairs] *****************************************************************************************************************************
changed: [localhost] => (item={u'default_route_ip': u'192.168.3.1', u'name': u't3', u'pns_ip': u'192.168.3.1/24', u'tenant_if': u't3if', u'tenant_ip': u'192.168.3.2/24', u'pns_if': u't3pns_if'}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec pns ip link show \"t3pns_if\" ; if [ $? -ne 0 ] ; then ip link set \"t3pns_if\" netns pns ; fi\nip netns exec \"t3\" ip link show \"t3if\" ; if [ $? -ne 0 ] ; then ip link set \"t3if\" netns \"t3\" ; fi\nip netns exec pns ip link set dev \"t3pns_if\" up\nip netns exec \"t3\" ip link set dev \"t3if\" up\n", "delta": "0:00:00.135310", "end": "2019-11-17 10:35:00.419650", "item": {"default_route_ip": "192.168.3.1", "name": "t3", "pns_if": "t3pns_if", "pns_ip": "192.168.3.1/24", "tenant_if": "t3if", "tenant_ip": "192.168.3.2/24"}, "rc": 0, "start": "2019-11-17 10:35:00.284340", "stderr": "", "stderr_lines": [], "stdout": "72: t3pns_if@if73: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP mode DEFAULT group default qlen 1000\n    link/ether 06:4a:f1:28:9b:b0 brd ff:ff:ff:ff:ff:ff link-netnsid 3\n73: t3if@if72: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP mode DEFAULT group default qlen 1000\n    link/ether 8a:e5:80:30:d5:6d brd ff:ff:ff:ff:ff:ff link-netnsid 0", "stdout_lines": ["72: t3pns_if@if73: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP mode DEFAULT group default qlen 1000", "    link/ether 06:4a:f1:28:9b:b0 brd ff:ff:ff:ff:ff:ff link-netnsid 3", "73: t3if@if72: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP mode DEFAULT group default qlen 1000", "    link/ether 8a:e5:80:30:d5:6d brd ff:ff:ff:ff:ff:ff link-netnsid 0"]}

TASK [Add IP addresses to Tenant VETH Pairs] ****************************************************************************************************************
changed: [localhost] => (item={u'default_route_ip': u'192.168.3.1', u'name': u't3', u'pns_ip': u'192.168.3.1/24', u'tenant_if': u't3if', u'tenant_ip': u'192.168.3.2/24', u'pns_if': u't3pns_if'}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec pns ip addr show \"t3pns_if\" | awk 'FNR==3{ print $2 }' | grep -w '^192.168.3.1/24' ; if [ $? -ne 0 ] ; then ip netns exec pns ip addr add \"192.168.3.1/24\" dev \"t3pns_if\" ; fi\nip netns exec \"t3\" ip addr show \"t3if\" | awk 'FNR==3{ print $2 }' | grep -w '^192.168.3.2/24' ; if [ $? -ne 0 ] ; then ip netns exec \"t3\" ip addr add \"192.168.3.2/24\" dev \"t3if\" ; fi\n", "delta": "0:00:00.071687", "end": "2019-11-17 10:35:00.755922", "item": {"default_route_ip": "192.168.3.1", "name": "t3", "pns_if": "t3pns_if", "pns_ip": "192.168.3.1/24", "tenant_if": "t3if", "tenant_ip": "192.168.3.2/24"}, "rc": 0, "start": "2019-11-17 10:35:00.684235", "stderr": "", "stderr_lines": [], "stdout": "192.168.3.1/24\n192.168.3.2/24", "stdout_lines": ["192.168.3.1/24", "192.168.3.2/24"]}

TASK [Create Namespace VETH Pairs] **************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.21.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.1.21.1', u'bridge_name': u't3br1', u'dns': [{u'dnsif': u't3s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't3s1_dnsbrif'}], u'ns_name': u't3ns1', u'bridge_ip': u'1.1.1.1', u'vms': [{u'mem': 2, u'name': u't3_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't3br1if1', u'vmif': u't3VM1if1'}, {u'mem': 4, u'name': u't3_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't3br1if2', u'vmif': u't3VM2if1'}], u'vxlan': [{u'local_ip': u'10.1.21.2', u'dsport': 4789, u'dev': u't3s1if', u'tenant_route_ip': u'192.168.3.2', u'remote_route': u'10.2.21.0/24', u'subnet_route': u'10.1.21.0/24', u'v_name': u'vxlan_t3s1', u'id': 42, u'remote_ip': u'10.2.21.2'}]}, {u'tenant_sub_ip': u'10.1.21.2/24', u'tenant_ns_ip': u'10.1.21.1/24', u'tenant_ns_if': u't3ns1if', u'tenant_sub_if': u't3s1if', u'tenant_ns_name': u't3'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip link show \"t3ns1if\" ; if [ $? -ne 0 ] ; then ip link add \"t3ns1if\" type veth peer name \"t3s1if\" ; fi\n", "delta": "0:00:00.004487", "end": "2019-11-17 10:35:01.048093", "item": [{"bridge_ip": "1.1.1.1", "bridge_name": "t3br1", "default_route_ip": "10.1.21.1", "dns": [{"brif": "t3s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t3s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t3ns1", "route": [{"if": "p1", "ip": "10.1.21.1/24", "ns_if": "t3if", "ns_name": "t3"}], "vms": [{"brif": "t3br1if1", "disk": "10G", "mem": 2, "name": "t3_VM1", "vcpu": 4, "vmif": "t3VM1if1"}, {"brif": "t3br1if2", "disk": "10G", "mem": 4, "name": "t3_VM2", "vcpu": 2, "vmif": "t3VM2if1"}], "vxlan": [{"dev": "t3s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.21.2", "remote_ip": "10.2.21.2", "remote_route": "10.2.21.0/24", "subnet_route": "10.1.21.0/24", "tenant_route_ip": "192.168.3.2", "v_name": "vxlan_t3s1"}]}, {"tenant_ns_if": "t3ns1if", "tenant_ns_ip": "10.1.21.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s1if", "tenant_sub_ip": "10.1.21.2/24"}], "rc": 0, "start": "2019-11-17 10:35:01.043606", "stderr": "", "stderr_lines": [], "stdout": "90: t3ns1if@t3s1if: <BROADCAST,MULTICAST> mtu 1500 qdisc noop state DOWN mode DEFAULT group default qlen 1000\n    link/ether 76:73:39:8a:1d:d0 brd ff:ff:ff:ff:ff:ff", "stdout_lines": ["90: t3ns1if@t3s1if: <BROADCAST,MULTICAST> mtu 1500 qdisc noop state DOWN mode DEFAULT group default qlen 1000", "    link/ether 76:73:39:8a:1d:d0 brd ff:ff:ff:ff:ff:ff"]}
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.22.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.1.22.1', u'bridge_name': u't3br2', u'dns': [{u'dnsif': u't3s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.126', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't3s2_dnsbrif'}], u'ns_name': u't3ns2', u'bridge_ip': u'2.2.2.1', u'vms': [{u'mem': 3, u'name': u't3_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't3br2if1', u'vmif': u't3VM3if1'}], u'vxlan': [{u'local_ip': u'10.1.22.2', u'dsport': 4789, u'dev': u't3s2if', u'tenant_route_ip': u'192.168.3.2', u'remote_route': u'10.2.22.0/24', u'subnet_route': u'10.1.22.0/24', u'v_name': u'vxlan_t3s2', u'id': 42, u'remote_ip': u'10.2.22.2'}]}, {u'tenant_sub_ip': u'10.1.22.2/24', u'tenant_ns_ip': u'10.1.22.1/24', u'tenant_ns_if': u't3ns2if', u'tenant_sub_if': u't3s2if', u'tenant_ns_name': u't3'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip link show \"t3ns2if\" ; if [ $? -ne 0 ] ; then ip link add \"t3ns2if\" type veth peer name \"t3s2if\" ; fi\n", "delta": "0:00:00.004576", "end": "2019-11-17 10:35:01.286545", "item": [{"bridge_ip": "2.2.2.1", "bridge_name": "t3br2", "default_route_ip": "10.1.22.1", "dns": [{"brif": "t3s2_dnsbrif", "dhcp_end": "2.2.2.126", "dhcp_start": "2.2.2.5", "dnsif": "t3s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t3ns2", "route": [{"if": "p1", "ip": "10.1.22.1/24", "ns_if": "t3if", "ns_name": "t3"}], "vms": [{"brif": "t3br2if1", "disk": "10G", "mem": 3, "name": "t3_VM3", "vcpu": 2, "vmif": "t3VM3if1"}], "vxlan": [{"dev": "t3s2if", "dsport": 4789, "id": 42, "local_ip": "10.1.22.2", "remote_ip": "10.2.22.2", "remote_route": "10.2.22.0/24", "subnet_route": "10.1.22.0/24", "tenant_route_ip": "192.168.3.2", "v_name": "vxlan_t3s2"}]}, {"tenant_ns_if": "t3ns2if", "tenant_ns_ip": "10.1.22.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s2if", "tenant_sub_ip": "10.1.22.2/24"}], "rc": 0, "start": "2019-11-17 10:35:01.281969", "stderr": "", "stderr_lines": [], "stdout": "92: t3ns2if@t3s2if: <BROADCAST,MULTICAST> mtu 1500 qdisc noop state DOWN mode DEFAULT group default qlen 1000\n    link/ether ce:63:27:c8:7a:3a brd ff:ff:ff:ff:ff:ff", "stdout_lines": ["92: t3ns2if@t3s2if: <BROADCAST,MULTICAST> mtu 1500 qdisc noop state DOWN mode DEFAULT group default qlen 1000", "    link/ether ce:63:27:c8:7a:3a brd ff:ff:ff:ff:ff:ff"]}

TASK [Attach Namespace VETH Pairs] **************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.21.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.1.21.1', u'bridge_name': u't3br1', u'dns': [{u'dnsif': u't3s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't3s1_dnsbrif'}], u'ns_name': u't3ns1', u'bridge_ip': u'1.1.1.1', u'vms': [{u'mem': 2, u'name': u't3_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't3br1if1', u'vmif': u't3VM1if1'}, {u'mem': 4, u'name': u't3_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't3br1if2', u'vmif': u't3VM2if1'}], u'vxlan': [{u'local_ip': u'10.1.21.2', u'dsport': 4789, u'dev': u't3s1if', u'tenant_route_ip': u'192.168.3.2', u'remote_route': u'10.2.21.0/24', u'subnet_route': u'10.1.21.0/24', u'v_name': u'vxlan_t3s1', u'id': 42, u'remote_ip': u'10.2.21.2'}]}, {u'tenant_sub_ip': u'10.1.21.2/24', u'tenant_ns_ip': u'10.1.21.1/24', u'tenant_ns_if': u't3ns1if', u'tenant_sub_if': u't3s1if', u'tenant_ns_name': u't3'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t3\" ip link show \"t3ns1if\" ; if [ $? -ne 0 ] ; then ip link set \"t3ns1if\" netns \"t3\" ; fi\nip netns exec \"t3ns1\" ip link show \"t3s1if\" ; if [ $? -ne 0 ] ; then ip link set \"t3s1if\" netns \"t3ns1\" ; fi\n", "delta": "0:00:00.065979", "end": "2019-11-17 10:35:01.639730", "item": [{"bridge_ip": "1.1.1.1", "bridge_name": "t3br1", "default_route_ip": "10.1.21.1", "dns": [{"brif": "t3s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t3s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t3ns1", "route": [{"if": "p1", "ip": "10.1.21.1/24", "ns_if": "t3if", "ns_name": "t3"}], "vms": [{"brif": "t3br1if1", "disk": "10G", "mem": 2, "name": "t3_VM1", "vcpu": 4, "vmif": "t3VM1if1"}, {"brif": "t3br1if2", "disk": "10G", "mem": 4, "name": "t3_VM2", "vcpu": 2, "vmif": "t3VM2if1"}], "vxlan": [{"dev": "t3s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.21.2", "remote_ip": "10.2.21.2", "remote_route": "10.2.21.0/24", "subnet_route": "10.1.21.0/24", "tenant_route_ip": "192.168.3.2", "v_name": "vxlan_t3s1"}]}, {"tenant_ns_if": "t3ns1if", "tenant_ns_ip": "10.1.21.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s1if", "tenant_sub_ip": "10.1.21.2/24"}], "rc": 0, "start": "2019-11-17 10:35:01.573751", "stderr": "", "stderr_lines": [], "stdout": "75: t3ns1if@if74: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP mode DEFAULT group default qlen 1000\n    link/ether 8e:ee:8e:d4:11:ea brd ff:ff:ff:ff:ff:ff link-netnsid 2\n74: t3s1if@if75: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP mode DEFAULT group default qlen 1000\n    link/ether 6a:c8:67:6e:da:7a brd ff:ff:ff:ff:ff:ff link-netnsid 0", "stdout_lines": ["75: t3ns1if@if74: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP mode DEFAULT group default qlen 1000", "    link/ether 8e:ee:8e:d4:11:ea brd ff:ff:ff:ff:ff:ff link-netnsid 2", "74: t3s1if@if75: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP mode DEFAULT group default qlen 1000", "    link/ether 6a:c8:67:6e:da:7a brd ff:ff:ff:ff:ff:ff link-netnsid 0"]}
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.22.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.1.22.1', u'bridge_name': u't3br2', u'dns': [{u'dnsif': u't3s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.126', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't3s2_dnsbrif'}], u'ns_name': u't3ns2', u'bridge_ip': u'2.2.2.1', u'vms': [{u'mem': 3, u'name': u't3_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't3br2if1', u'vmif': u't3VM3if1'}], u'vxlan': [{u'local_ip': u'10.1.22.2', u'dsport': 4789, u'dev': u't3s2if', u'tenant_route_ip': u'192.168.3.2', u'remote_route': u'10.2.22.0/24', u'subnet_route': u'10.1.22.0/24', u'v_name': u'vxlan_t3s2', u'id': 42, u'remote_ip': u'10.2.22.2'}]}, {u'tenant_sub_ip': u'10.1.22.2/24', u'tenant_ns_ip': u'10.1.22.1/24', u'tenant_ns_if': u't3ns2if', u'tenant_sub_if': u't3s2if', u'tenant_ns_name': u't3'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t3\" ip link show \"t3ns2if\" ; if [ $? -ne 0 ] ; then ip link set \"t3ns2if\" netns \"t3\" ; fi\nip netns exec \"t3ns2\" ip link show \"t3s2if\" ; if [ $? -ne 0 ] ; then ip link set \"t3s2if\" netns \"t3ns2\" ; fi\n", "delta": "0:00:00.076939", "end": "2019-11-17 10:35:01.951886", "item": [{"bridge_ip": "2.2.2.1", "bridge_name": "t3br2", "default_route_ip": "10.1.22.1", "dns": [{"brif": "t3s2_dnsbrif", "dhcp_end": "2.2.2.126", "dhcp_start": "2.2.2.5", "dnsif": "t3s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t3ns2", "route": [{"if": "p1", "ip": "10.1.22.1/24", "ns_if": "t3if", "ns_name": "t3"}], "vms": [{"brif": "t3br2if1", "disk": "10G", "mem": 3, "name": "t3_VM3", "vcpu": 2, "vmif": "t3VM3if1"}], "vxlan": [{"dev": "t3s2if", "dsport": 4789, "id": 42, "local_ip": "10.1.22.2", "remote_ip": "10.2.22.2", "remote_route": "10.2.22.0/24", "subnet_route": "10.1.22.0/24", "tenant_route_ip": "192.168.3.2", "v_name": "vxlan_t3s2"}]}, {"tenant_ns_if": "t3ns2if", "tenant_ns_ip": "10.1.22.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s2if", "tenant_sub_ip": "10.1.22.2/24"}], "rc": 0, "start": "2019-11-17 10:35:01.874947", "stderr": "", "stderr_lines": [], "stdout": "77: t3ns2if@if76: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP mode DEFAULT group default qlen 1000\n    link/ether 6e:56:8a:9b:30:96 brd ff:ff:ff:ff:ff:ff link-netnsid 3\n76: t3s2if@if77: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP mode DEFAULT group default qlen 1000\n    link/ether 46:53:d1:fa:8c:e5 brd ff:ff:ff:ff:ff:ff link-netnsid 0", "stdout_lines": ["77: t3ns2if@if76: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP mode DEFAULT group default qlen 1000", "    link/ether 6e:56:8a:9b:30:96 brd ff:ff:ff:ff:ff:ff link-netnsid 3", "76: t3s2if@if77: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP mode DEFAULT group default qlen 1000", "    link/ether 46:53:d1:fa:8c:e5 brd ff:ff:ff:ff:ff:ff link-netnsid 0"]}

TASK [Set Namespace VETH Pairs UP] **************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.21.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.1.21.1', u'bridge_name': u't3br1', u'dns': [{u'dnsif': u't3s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't3s1_dnsbrif'}], u'ns_name': u't3ns1', u'bridge_ip': u'1.1.1.1', u'vms': [{u'mem': 2, u'name': u't3_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't3br1if1', u'vmif': u't3VM1if1'}, {u'mem': 4, u'name': u't3_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't3br1if2', u'vmif': u't3VM2if1'}], u'vxlan': [{u'local_ip': u'10.1.21.2', u'dsport': 4789, u'dev': u't3s1if', u'tenant_route_ip': u'192.168.3.2', u'remote_route': u'10.2.21.0/24', u'subnet_route': u'10.1.21.0/24', u'v_name': u'vxlan_t3s1', u'id': 42, u'remote_ip': u'10.2.21.2'}]}, {u'tenant_sub_ip': u'10.1.21.2/24', u'tenant_ns_ip': u'10.1.21.1/24', u'tenant_ns_if': u't3ns1if', u'tenant_sub_if': u't3s1if', u'tenant_ns_name': u't3'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t3\" ip link set dev \"t3ns1if\" up\nip netns exec \"t3ns1\" ip link set dev \"t3s1if\" up\n", "delta": "0:00:00.073283", "end": "2019-11-17 10:35:02.315774", "item": [{"bridge_ip": "1.1.1.1", "bridge_name": "t3br1", "default_route_ip": "10.1.21.1", "dns": [{"brif": "t3s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t3s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t3ns1", "route": [{"if": "p1", "ip": "10.1.21.1/24", "ns_if": "t3if", "ns_name": "t3"}], "vms": [{"brif": "t3br1if1", "disk": "10G", "mem": 2, "name": "t3_VM1", "vcpu": 4, "vmif": "t3VM1if1"}, {"brif": "t3br1if2", "disk": "10G", "mem": 4, "name": "t3_VM2", "vcpu": 2, "vmif": "t3VM2if1"}], "vxlan": [{"dev": "t3s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.21.2", "remote_ip": "10.2.21.2", "remote_route": "10.2.21.0/24", "subnet_route": "10.1.21.0/24", "tenant_route_ip": "192.168.3.2", "v_name": "vxlan_t3s1"}]}, {"tenant_ns_if": "t3ns1if", "tenant_ns_ip": "10.1.21.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s1if", "tenant_sub_ip": "10.1.21.2/24"}], "rc": 0, "start": "2019-11-17 10:35:02.242491", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.22.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.1.22.1', u'bridge_name': u't3br2', u'dns': [{u'dnsif': u't3s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.126', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't3s2_dnsbrif'}], u'ns_name': u't3ns2', u'bridge_ip': u'2.2.2.1', u'vms': [{u'mem': 3, u'name': u't3_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't3br2if1', u'vmif': u't3VM3if1'}], u'vxlan': [{u'local_ip': u'10.1.22.2', u'dsport': 4789, u'dev': u't3s2if', u'tenant_route_ip': u'192.168.3.2', u'remote_route': u'10.2.22.0/24', u'subnet_route': u'10.1.22.0/24', u'v_name': u'vxlan_t3s2', u'id': 42, u'remote_ip': u'10.2.22.2'}]}, {u'tenant_sub_ip': u'10.1.22.2/24', u'tenant_ns_ip': u'10.1.22.1/24', u'tenant_ns_if': u't3ns2if', u'tenant_sub_if': u't3s2if', u'tenant_ns_name': u't3'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t3\" ip link set dev \"t3ns2if\" up\nip netns exec \"t3ns2\" ip link set dev \"t3s2if\" up\n", "delta": "0:00:00.114679", "end": "2019-11-17 10:35:02.651907", "item": [{"bridge_ip": "2.2.2.1", "bridge_name": "t3br2", "default_route_ip": "10.1.22.1", "dns": [{"brif": "t3s2_dnsbrif", "dhcp_end": "2.2.2.126", "dhcp_start": "2.2.2.5", "dnsif": "t3s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t3ns2", "route": [{"if": "p1", "ip": "10.1.22.1/24", "ns_if": "t3if", "ns_name": "t3"}], "vms": [{"brif": "t3br2if1", "disk": "10G", "mem": 3, "name": "t3_VM3", "vcpu": 2, "vmif": "t3VM3if1"}], "vxlan": [{"dev": "t3s2if", "dsport": 4789, "id": 42, "local_ip": "10.1.22.2", "remote_ip": "10.2.22.2", "remote_route": "10.2.22.0/24", "subnet_route": "10.1.22.0/24", "tenant_route_ip": "192.168.3.2", "v_name": "vxlan_t3s2"}]}, {"tenant_ns_if": "t3ns2if", "tenant_ns_ip": "10.1.22.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s2if", "tenant_sub_ip": "10.1.22.2/24"}], "rc": 0, "start": "2019-11-17 10:35:02.537228", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Add IP addresses to Namespace VETH Pairs] *************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.21.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.1.21.1', u'bridge_name': u't3br1', u'dns': [{u'dnsif': u't3s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't3s1_dnsbrif'}], u'ns_name': u't3ns1', u'bridge_ip': u'1.1.1.1', u'vms': [{u'mem': 2, u'name': u't3_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't3br1if1', u'vmif': u't3VM1if1'}, {u'mem': 4, u'name': u't3_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't3br1if2', u'vmif': u't3VM2if1'}], u'vxlan': [{u'local_ip': u'10.1.21.2', u'dsport': 4789, u'dev': u't3s1if', u'tenant_route_ip': u'192.168.3.2', u'remote_route': u'10.2.21.0/24', u'subnet_route': u'10.1.21.0/24', u'v_name': u'vxlan_t3s1', u'id': 42, u'remote_ip': u'10.2.21.2'}]}, {u'tenant_sub_ip': u'10.1.21.2/24', u'tenant_ns_ip': u'10.1.21.1/24', u'tenant_ns_if': u't3ns1if', u'tenant_sub_if': u't3s1if', u'tenant_ns_name': u't3'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t3ns1\" ip addr show \"t3s1if\" | awk 'FNR==3{ print $2 }' | grep -w '^10.1.21.2/24' ; if [ $? -ne 0 ] ; then ip netns exec \"t3ns1\" ip addr add \"10.1.21.2/24\" dev \"t3s1if\" ; fi\n\nip netns exec \"t3\" ip addr show \"t3ns1if\" | awk 'FNR==3{ print $2 }' | grep -w '^10.1.21.1/24' ; if [ $? -ne 0 ] ; then ip netns exec \"t3\" ip addr add \"10.1.21.1/24\" dev \"t3ns1if\" ; fi\n", "delta": "0:00:00.065698", "end": "2019-11-17 10:35:03.008015", "item": [{"bridge_ip": "1.1.1.1", "bridge_name": "t3br1", "default_route_ip": "10.1.21.1", "dns": [{"brif": "t3s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t3s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t3ns1", "route": [{"if": "p1", "ip": "10.1.21.1/24", "ns_if": "t3if", "ns_name": "t3"}], "vms": [{"brif": "t3br1if1", "disk": "10G", "mem": 2, "name": "t3_VM1", "vcpu": 4, "vmif": "t3VM1if1"}, {"brif": "t3br1if2", "disk": "10G", "mem": 4, "name": "t3_VM2", "vcpu": 2, "vmif": "t3VM2if1"}], "vxlan": [{"dev": "t3s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.21.2", "remote_ip": "10.2.21.2", "remote_route": "10.2.21.0/24", "subnet_route": "10.1.21.0/24", "tenant_route_ip": "192.168.3.2", "v_name": "vxlan_t3s1"}]}, {"tenant_ns_if": "t3ns1if", "tenant_ns_ip": "10.1.21.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s1if", "tenant_sub_ip": "10.1.21.2/24"}], "rc": 0, "start": "2019-11-17 10:35:02.942317", "stderr": "", "stderr_lines": [], "stdout": "10.1.21.2/24\n10.1.21.1/24", "stdout_lines": ["10.1.21.2/24", "10.1.21.1/24"]}
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.22.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.1.22.1', u'bridge_name': u't3br2', u'dns': [{u'dnsif': u't3s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.126', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't3s2_dnsbrif'}], u'ns_name': u't3ns2', u'bridge_ip': u'2.2.2.1', u'vms': [{u'mem': 3, u'name': u't3_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't3br2if1', u'vmif': u't3VM3if1'}], u'vxlan': [{u'local_ip': u'10.1.22.2', u'dsport': 4789, u'dev': u't3s2if', u'tenant_route_ip': u'192.168.3.2', u'remote_route': u'10.2.22.0/24', u'subnet_route': u'10.1.22.0/24', u'v_name': u'vxlan_t3s2', u'id': 42, u'remote_ip': u'10.2.22.2'}]}, {u'tenant_sub_ip': u'10.1.22.2/24', u'tenant_ns_ip': u'10.1.22.1/24', u'tenant_ns_if': u't3ns2if', u'tenant_sub_if': u't3s2if', u'tenant_ns_name': u't3'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t3ns2\" ip addr show \"t3s2if\" | awk 'FNR==3{ print $2 }' | grep -w '^10.1.22.2/24' ; if [ $? -ne 0 ] ; then ip netns exec \"t3ns2\" ip addr add \"10.1.22.2/24\" dev \"t3s2if\" ; fi\n\nip netns exec \"t3\" ip addr show \"t3ns2if\" | awk 'FNR==3{ print $2 }' | grep -w '^10.1.22.1/24' ; if [ $? -ne 0 ] ; then ip netns exec \"t3\" ip addr add \"10.1.22.1/24\" dev \"t3ns2if\" ; fi\n", "delta": "0:00:00.068681", "end": "2019-11-17 10:35:03.287949", "item": [{"bridge_ip": "2.2.2.1", "bridge_name": "t3br2", "default_route_ip": "10.1.22.1", "dns": [{"brif": "t3s2_dnsbrif", "dhcp_end": "2.2.2.126", "dhcp_start": "2.2.2.5", "dnsif": "t3s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t3ns2", "route": [{"if": "p1", "ip": "10.1.22.1/24", "ns_if": "t3if", "ns_name": "t3"}], "vms": [{"brif": "t3br2if1", "disk": "10G", "mem": 3, "name": "t3_VM3", "vcpu": 2, "vmif": "t3VM3if1"}], "vxlan": [{"dev": "t3s2if", "dsport": 4789, "id": 42, "local_ip": "10.1.22.2", "remote_ip": "10.2.22.2", "remote_route": "10.2.22.0/24", "subnet_route": "10.1.22.0/24", "tenant_route_ip": "192.168.3.2", "v_name": "vxlan_t3s2"}]}, {"tenant_ns_if": "t3ns2if", "tenant_ns_ip": "10.1.22.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s2if", "tenant_sub_ip": "10.1.22.2/24"}], "rc": 0, "start": "2019-11-17 10:35:03.219268", "stderr": "", "stderr_lines": [], "stdout": "10.1.22.2/24\n10.1.22.1/24", "stdout_lines": ["10.1.22.2/24", "10.1.22.1/24"]}

TASK [Add IP Route to Tenant] *******************************************************************************************************************************
changed: [localhost] => (item={u'default_route_ip': u'192.168.3.1', u'name': u't3', u'pns_ip': u'192.168.3.1/24', u'tenant_if': u't3if', u'tenant_ip': u'192.168.3.2/24', u'pns_if': u't3pns_if'}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t3\" ip route show default | grep -w '[d]efault via 192.168.3.1' ; if [ $? -ne 0 ] ; then ip netns exec \"t3\" ip route add default via \"192.168.3.1\" ; fi\n", "delta": "0:00:00.033945", "end": "2019-11-17 10:35:03.611897", "item": {"default_route_ip": "192.168.3.1", "name": "t3", "pns_if": "t3pns_if", "pns_ip": "192.168.3.1/24", "tenant_if": "t3if", "tenant_ip": "192.168.3.2/24"}, "rc": 0, "start": "2019-11-17 10:35:03.577952", "stderr": "", "stderr_lines": [], "stdout": "default via 192.168.3.1 dev t3if ", "stdout_lines": ["default via 192.168.3.1 dev t3if "]}

TASK [Add IP Route to Tenant Subnet] ************************************************************************************************************************
changed: [localhost] => (item={u'route': [{u'ip': u'10.1.21.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.1.21.1', u'bridge_name': u't3br1', u'dns': [{u'dnsif': u't3s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't3s1_dnsbrif'}], u'ns_name': u't3ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.21.2/24', u'tenant_ns_ip': u'10.1.21.1/24', u'tenant_ns_if': u't3ns1if', u'tenant_ns_name': u't3', u'tenant_sub_if': u't3s1if'}], u'bridge_ip': u'1.1.1.1', u'vms': [{u'mem': 2, u'name': u't3_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't3br1if1', u'vmif': u't3VM1if1'}, {u'mem': 4, u'name': u't3_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't3br1if2', u'vmif': u't3VM2if1'}], u'vxlan': [{u'local_ip': u'10.1.21.2', u'tenant_route_ip': u'192.168.3.2', u'dsport': 4789, u'dev': u't3s1if', u'subnet_route': u'10.1.21.0/24', u'remote_route': u'10.2.21.0/24', u'v_name': u'vxlan_t3s1', u'id': 42, u'remote_ip': u'10.2.21.2'}]}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t3ns1\" ip route show default | grep -w '[d]efault via 10.1.21.1' ; if [ $? -ne 0 ] ; then ip netns exec \"t3ns1\" ip route add default via \"10.1.21.1\" ; fi\n", "delta": "0:00:00.037558", "end": "2019-11-17 10:35:03.915842", "item": {"bridge_ip": "1.1.1.1", "bridge_name": "t3br1", "default_route_ip": "10.1.21.1", "dns": [{"brif": "t3s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t3s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t3ns1", "route": [{"if": "p1", "ip": "10.1.21.1/24", "ns_if": "t3if", "ns_name": "t3"}], "tenant_ns": [{"tenant_ns_if": "t3ns1if", "tenant_ns_ip": "10.1.21.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s1if", "tenant_sub_ip": "10.1.21.2/24"}], "vms": [{"brif": "t3br1if1", "disk": "10G", "mem": 2, "name": "t3_VM1", "vcpu": 4, "vmif": "t3VM1if1"}, {"brif": "t3br1if2", "disk": "10G", "mem": 4, "name": "t3_VM2", "vcpu": 2, "vmif": "t3VM2if1"}], "vxlan": [{"dev": "t3s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.21.2", "remote_ip": "10.2.21.2", "remote_route": "10.2.21.0/24", "subnet_route": "10.1.21.0/24", "tenant_route_ip": "192.168.3.2", "v_name": "vxlan_t3s1"}]}, "rc": 0, "start": "2019-11-17 10:35:03.878284", "stderr": "", "stderr_lines": [], "stdout": "default via 10.1.21.1 dev t3s1if ", "stdout_lines": ["default via 10.1.21.1 dev t3s1if "]}
changed: [localhost] => (item={u'route': [{u'ip': u'10.1.22.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.1.22.1', u'bridge_name': u't3br2', u'dns': [{u'dnsif': u't3s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.126', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't3s2_dnsbrif'}], u'ns_name': u't3ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.22.2/24', u'tenant_ns_ip': u'10.1.22.1/24', u'tenant_ns_if': u't3ns2if', u'tenant_ns_name': u't3', u'tenant_sub_if': u't3s2if'}], u'bridge_ip': u'2.2.2.1', u'vms': [{u'mem': 3, u'name': u't3_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't3br2if1', u'vmif': u't3VM3if1'}], u'vxlan': [{u'local_ip': u'10.1.22.2', u'tenant_route_ip': u'192.168.3.2', u'dsport': 4789, u'dev': u't3s2if', u'subnet_route': u'10.1.22.0/24', u'remote_route': u'10.2.22.0/24', u'v_name': u'vxlan_t3s2', u'id': 42, u'remote_ip': u'10.2.22.2'}]}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t3ns2\" ip route show default | grep -w '[d]efault via 10.1.22.1' ; if [ $? -ne 0 ] ; then ip netns exec \"t3ns2\" ip route add default via \"10.1.22.1\" ; fi\n", "delta": "0:00:00.039607", "end": "2019-11-17 10:35:04.180031", "item": {"bridge_ip": "2.2.2.1", "bridge_name": "t3br2", "default_route_ip": "10.1.22.1", "dns": [{"brif": "t3s2_dnsbrif", "dhcp_end": "2.2.2.126", "dhcp_start": "2.2.2.5", "dnsif": "t3s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t3ns2", "route": [{"if": "p1", "ip": "10.1.22.1/24", "ns_if": "t3if", "ns_name": "t3"}], "tenant_ns": [{"tenant_ns_if": "t3ns2if", "tenant_ns_ip": "10.1.22.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s2if", "tenant_sub_ip": "10.1.22.2/24"}], "vms": [{"brif": "t3br2if1", "disk": "10G", "mem": 3, "name": "t3_VM3", "vcpu": 2, "vmif": "t3VM3if1"}], "vxlan": [{"dev": "t3s2if", "dsport": 4789, "id": 42, "local_ip": "10.1.22.2", "remote_ip": "10.2.22.2", "remote_route": "10.2.22.0/24", "subnet_route": "10.1.22.0/24", "tenant_route_ip": "192.168.3.2", "v_name": "vxlan_t3s2"}]}, "rc": 0, "start": "2019-11-17 10:35:04.140424", "stderr": "", "stderr_lines": [], "stdout": "default via 10.1.22.1 dev t3s2if ", "stdout_lines": ["default via 10.1.22.1 dev t3s2if "]}

TASK [Create bridge inside namespace] ***********************************************************************************************************************
changed: [localhost] => (item={u'route': [{u'ip': u'10.1.21.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.1.21.1', u'bridge_name': u't3br1', u'dns': [{u'dnsif': u't3s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't3s1_dnsbrif'}], u'ns_name': u't3ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.21.2/24', u'tenant_ns_ip': u'10.1.21.1/24', u'tenant_ns_if': u't3ns1if', u'tenant_ns_name': u't3', u'tenant_sub_if': u't3s1if'}], u'bridge_ip': u'1.1.1.1', u'vms': [{u'mem': 2, u'name': u't3_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't3br1if1', u'vmif': u't3VM1if1'}, {u'mem': 4, u'name': u't3_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't3br1if2', u'vmif': u't3VM2if1'}], u'vxlan': [{u'local_ip': u'10.1.21.2', u'tenant_route_ip': u'192.168.3.2', u'dsport': 4789, u'dev': u't3s1if', u'subnet_route': u'10.1.21.0/24', u'remote_route': u'10.2.21.0/24', u'v_name': u'vxlan_t3s1', u'id': 42, u'remote_ip': u'10.2.21.2'}]}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t3ns1\" brctl show | grep -w '^t3br1'; if [ $? -ne 0 ] ; then ip netns exec \"t3ns1\" brctl addbr \"t3br1\" ; fi\nip netns exec \"t3ns1\" ip link set dev \"t3br1\" up\n", "delta": "0:00:00.077742", "end": "2019-11-17 10:35:04.555693", "item": {"bridge_ip": "1.1.1.1", "bridge_name": "t3br1", "default_route_ip": "10.1.21.1", "dns": [{"brif": "t3s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t3s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t3ns1", "route": [{"if": "p1", "ip": "10.1.21.1/24", "ns_if": "t3if", "ns_name": "t3"}], "tenant_ns": [{"tenant_ns_if": "t3ns1if", "tenant_ns_ip": "10.1.21.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s1if", "tenant_sub_ip": "10.1.21.2/24"}], "vms": [{"brif": "t3br1if1", "disk": "10G", "mem": 2, "name": "t3_VM1", "vcpu": 4, "vmif": "t3VM1if1"}, {"brif": "t3br1if2", "disk": "10G", "mem": 4, "name": "t3_VM2", "vcpu": 2, "vmif": "t3VM2if1"}], "vxlan": [{"dev": "t3s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.21.2", "remote_ip": "10.2.21.2", "remote_route": "10.2.21.0/24", "subnet_route": "10.1.21.0/24", "tenant_route_ip": "192.168.3.2", "v_name": "vxlan_t3s1"}]}, "rc": 0, "start": "2019-11-17 10:35:04.477951", "stderr": "", "stderr_lines": [], "stdout": "t3br1\t\t8000.06278ed78072\tno\t\tt3br1if1", "stdout_lines": ["t3br1\t\t8000.06278ed78072\tno\t\tt3br1if1"]}
changed: [localhost] => (item={u'route': [{u'ip': u'10.1.22.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.1.22.1', u'bridge_name': u't3br2', u'dns': [{u'dnsif': u't3s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.126', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't3s2_dnsbrif'}], u'ns_name': u't3ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.22.2/24', u'tenant_ns_ip': u'10.1.22.1/24', u'tenant_ns_if': u't3ns2if', u'tenant_ns_name': u't3', u'tenant_sub_if': u't3s2if'}], u'bridge_ip': u'2.2.2.1', u'vms': [{u'mem': 3, u'name': u't3_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't3br2if1', u'vmif': u't3VM3if1'}], u'vxlan': [{u'local_ip': u'10.1.22.2', u'tenant_route_ip': u'192.168.3.2', u'dsport': 4789, u'dev': u't3s2if', u'subnet_route': u'10.1.22.0/24', u'remote_route': u'10.2.22.0/24', u'v_name': u'vxlan_t3s2', u'id': 42, u'remote_ip': u'10.2.22.2'}]}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t3ns2\" brctl show | grep -w '^t3br2'; if [ $? -ne 0 ] ; then ip netns exec \"t3ns2\" brctl addbr \"t3br2\" ; fi\nip netns exec \"t3ns2\" ip link set dev \"t3br2\" up\n", "delta": "0:00:00.073721", "end": "2019-11-17 10:35:04.871895", "item": {"bridge_ip": "2.2.2.1", "bridge_name": "t3br2", "default_route_ip": "10.1.22.1", "dns": [{"brif": "t3s2_dnsbrif", "dhcp_end": "2.2.2.126", "dhcp_start": "2.2.2.5", "dnsif": "t3s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t3ns2", "route": [{"if": "p1", "ip": "10.1.22.1/24", "ns_if": "t3if", "ns_name": "t3"}], "tenant_ns": [{"tenant_ns_if": "t3ns2if", "tenant_ns_ip": "10.1.22.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s2if", "tenant_sub_ip": "10.1.22.2/24"}], "vms": [{"brif": "t3br2if1", "disk": "10G", "mem": 3, "name": "t3_VM3", "vcpu": 2, "vmif": "t3VM3if1"}], "vxlan": [{"dev": "t3s2if", "dsport": 4789, "id": 42, "local_ip": "10.1.22.2", "remote_ip": "10.2.22.2", "remote_route": "10.2.22.0/24", "subnet_route": "10.1.22.0/24", "tenant_route_ip": "192.168.3.2", "v_name": "vxlan_t3s2"}]}, "rc": 0, "start": "2019-11-17 10:35:04.798174", "stderr": "", "stderr_lines": [], "stdout": "t3br2\t\t8000.32ee3138f042\tno\t\tt3br2if1", "stdout_lines": ["t3br2\t\t8000.32ee3138f042\tno\t\tt3br2if1"]}

TASK [Create DNS VETH Pair] *********************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.21.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.1.21.1', u'bridge_name': u't3br1', u'ns_name': u't3ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.21.2/24', u'tenant_ns_ip': u'10.1.21.1/24', u'tenant_ns_if': u't3ns1if', u'tenant_sub_if': u't3s1if', u'tenant_ns_name': u't3'}], u'bridge_ip': u'1.1.1.1', u'vms': [{u'mem': 2, u'name': u't3_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't3br1if1', u'vmif': u't3VM1if1'}, {u'mem': 4, u'name': u't3_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't3br1if2', u'vmif': u't3VM2if1'}], u'vxlan': [{u'local_ip': u'10.1.21.2', u'dsport': 4789, u'dev': u't3s1if', u'tenant_route_ip': u'192.168.3.2', u'remote_route': u'10.2.21.0/24', u'subnet_route': u'10.1.21.0/24', u'v_name': u'vxlan_t3s1', u'id': 42, u'remote_ip': u'10.2.21.2'}]}, {u'dnsif': u't3s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't3s1_dnsbrif'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t3ns1\" ip link show \"t3s1_dnsbrif\" ; if [ $? -ne 0 ] ; then ip netns exec \"t3ns1\" ip link add \"t3s1_dnsbrif\" type veth peer name \"t3s1_dnsif\" ; fi\nip netns exec \"t3ns1\" ip link set dev \"t3s1_dnsbrif\" up\nip netns exec \"t3ns1\" ip link set dev \"t3s1_dnsif\" up\n", "delta": "0:00:00.118194", "end": "2019-11-17 10:35:05.315837", "item": [{"bridge_ip": "1.1.1.1", "bridge_name": "t3br1", "default_route_ip": "10.1.21.1", "ns_name": "t3ns1", "route": [{"if": "p1", "ip": "10.1.21.1/24", "ns_if": "t3if", "ns_name": "t3"}], "tenant_ns": [{"tenant_ns_if": "t3ns1if", "tenant_ns_ip": "10.1.21.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s1if", "tenant_sub_ip": "10.1.21.2/24"}], "vms": [{"brif": "t3br1if1", "disk": "10G", "mem": 2, "name": "t3_VM1", "vcpu": 4, "vmif": "t3VM1if1"}, {"brif": "t3br1if2", "disk": "10G", "mem": 4, "name": "t3_VM2", "vcpu": 2, "vmif": "t3VM2if1"}], "vxlan": [{"dev": "t3s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.21.2", "remote_ip": "10.2.21.2", "remote_route": "10.2.21.0/24", "subnet_route": "10.1.21.0/24", "tenant_route_ip": "192.168.3.2", "v_name": "vxlan_t3s1"}]}, {"brif": "t3s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t3s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "rc": 0, "start": "2019-11-17 10:35:05.197643", "stderr": "", "stderr_lines": [], "stdout": "4: t3s1_dnsbrif@t3s1_dnsif: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue master t3br1 state UP mode DEFAULT group default qlen 1000\n    link/ether 06:27:8e:d7:80:72 brd ff:ff:ff:ff:ff:ff", "stdout_lines": ["4: t3s1_dnsbrif@t3s1_dnsif: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue master t3br1 state UP mode DEFAULT group default qlen 1000", "    link/ether 06:27:8e:d7:80:72 brd ff:ff:ff:ff:ff:ff"]}
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.22.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.1.22.1', u'bridge_name': u't3br2', u'ns_name': u't3ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.22.2/24', u'tenant_ns_ip': u'10.1.22.1/24', u'tenant_ns_if': u't3ns2if', u'tenant_sub_if': u't3s2if', u'tenant_ns_name': u't3'}], u'bridge_ip': u'2.2.2.1', u'vms': [{u'mem': 3, u'name': u't3_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't3br2if1', u'vmif': u't3VM3if1'}], u'vxlan': [{u'local_ip': u'10.1.22.2', u'dsport': 4789, u'dev': u't3s2if', u'tenant_route_ip': u'192.168.3.2', u'remote_route': u'10.2.22.0/24', u'subnet_route': u'10.1.22.0/24', u'v_name': u'vxlan_t3s2', u'id': 42, u'remote_ip': u'10.2.22.2'}]}, {u'dnsif': u't3s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.126', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't3s2_dnsbrif'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t3ns2\" ip link show \"t3s2_dnsbrif\" ; if [ $? -ne 0 ] ; then ip netns exec \"t3ns2\" ip link add \"t3s2_dnsbrif\" type veth peer name \"t3s2_dnsif\" ; fi\nip netns exec \"t3ns2\" ip link set dev \"t3s2_dnsbrif\" up\nip netns exec \"t3ns2\" ip link set dev \"t3s2_dnsif\" up\n", "delta": "0:00:00.121750", "end": "2019-11-17 10:35:05.663878", "item": [{"bridge_ip": "2.2.2.1", "bridge_name": "t3br2", "default_route_ip": "10.1.22.1", "ns_name": "t3ns2", "route": [{"if": "p1", "ip": "10.1.22.1/24", "ns_if": "t3if", "ns_name": "t3"}], "tenant_ns": [{"tenant_ns_if": "t3ns2if", "tenant_ns_ip": "10.1.22.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s2if", "tenant_sub_ip": "10.1.22.2/24"}], "vms": [{"brif": "t3br2if1", "disk": "10G", "mem": 3, "name": "t3_VM3", "vcpu": 2, "vmif": "t3VM3if1"}], "vxlan": [{"dev": "t3s2if", "dsport": 4789, "id": 42, "local_ip": "10.1.22.2", "remote_ip": "10.2.22.2", "remote_route": "10.2.22.0/24", "subnet_route": "10.1.22.0/24", "tenant_route_ip": "192.168.3.2", "v_name": "vxlan_t3s2"}]}, {"brif": "t3s2_dnsbrif", "dhcp_end": "2.2.2.126", "dhcp_start": "2.2.2.5", "dnsif": "t3s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "rc": 0, "start": "2019-11-17 10:35:05.542128", "stderr": "", "stderr_lines": [], "stdout": "4: t3s2_dnsbrif@t3s2_dnsif: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue master t3br2 state UP mode DEFAULT group default qlen 1000\n    link/ether ce:25:d3:dc:4b:05 brd ff:ff:ff:ff:ff:ff", "stdout_lines": ["4: t3s2_dnsbrif@t3s2_dnsif: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue master t3br2 state UP mode DEFAULT group default qlen 1000", "    link/ether ce:25:d3:dc:4b:05 brd ff:ff:ff:ff:ff:ff"]}

TASK [Attach DNS VETH Pair] *********************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.21.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.1.21.1', u'bridge_name': u't3br1', u'ns_name': u't3ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.21.2/24', u'tenant_ns_ip': u'10.1.21.1/24', u'tenant_ns_if': u't3ns1if', u'tenant_sub_if': u't3s1if', u'tenant_ns_name': u't3'}], u'bridge_ip': u'1.1.1.1', u'vms': [{u'mem': 2, u'name': u't3_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't3br1if1', u'vmif': u't3VM1if1'}, {u'mem': 4, u'name': u't3_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't3br1if2', u'vmif': u't3VM2if1'}], u'vxlan': [{u'local_ip': u'10.1.21.2', u'dsport': 4789, u'dev': u't3s1if', u'tenant_route_ip': u'192.168.3.2', u'remote_route': u'10.2.21.0/24', u'subnet_route': u'10.1.21.0/24', u'v_name': u'vxlan_t3s1', u'id': 42, u'remote_ip': u'10.2.21.2'}]}, {u'dnsif': u't3s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't3s1_dnsbrif'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t3ns1\" brctl show \"t3br1\" | grep -w 't3s1_dnsbrif' ; if [ $? -ne 0 ] ; then ip netns exec \"t3ns1\" brctl addif \"t3br1\" \"t3s1_dnsbrif\" ; fi\n", "delta": "0:00:00.034840", "end": "2019-11-17 10:35:05.975857", "item": [{"bridge_ip": "1.1.1.1", "bridge_name": "t3br1", "default_route_ip": "10.1.21.1", "ns_name": "t3ns1", "route": [{"if": "p1", "ip": "10.1.21.1/24", "ns_if": "t3if", "ns_name": "t3"}], "tenant_ns": [{"tenant_ns_if": "t3ns1if", "tenant_ns_ip": "10.1.21.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s1if", "tenant_sub_ip": "10.1.21.2/24"}], "vms": [{"brif": "t3br1if1", "disk": "10G", "mem": 2, "name": "t3_VM1", "vcpu": 4, "vmif": "t3VM1if1"}, {"brif": "t3br1if2", "disk": "10G", "mem": 4, "name": "t3_VM2", "vcpu": 2, "vmif": "t3VM2if1"}], "vxlan": [{"dev": "t3s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.21.2", "remote_ip": "10.2.21.2", "remote_route": "10.2.21.0/24", "subnet_route": "10.1.21.0/24", "tenant_route_ip": "192.168.3.2", "v_name": "vxlan_t3s1"}]}, {"brif": "t3s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t3s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "rc": 0, "start": "2019-11-17 10:35:05.941017", "stderr": "", "stderr_lines": [], "stdout": "\t\t\t\t\t\t\tt3s1_dnsbrif", "stdout_lines": ["\t\t\t\t\t\t\tt3s1_dnsbrif"]}
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.22.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.1.22.1', u'bridge_name': u't3br2', u'ns_name': u't3ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.22.2/24', u'tenant_ns_ip': u'10.1.22.1/24', u'tenant_ns_if': u't3ns2if', u'tenant_sub_if': u't3s2if', u'tenant_ns_name': u't3'}], u'bridge_ip': u'2.2.2.1', u'vms': [{u'mem': 3, u'name': u't3_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't3br2if1', u'vmif': u't3VM3if1'}], u'vxlan': [{u'local_ip': u'10.1.22.2', u'dsport': 4789, u'dev': u't3s2if', u'tenant_route_ip': u'192.168.3.2', u'remote_route': u'10.2.22.0/24', u'subnet_route': u'10.1.22.0/24', u'v_name': u'vxlan_t3s2', u'id': 42, u'remote_ip': u'10.2.22.2'}]}, {u'dnsif': u't3s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.126', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't3s2_dnsbrif'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t3ns2\" brctl show \"t3br2\" | grep -w 't3s2_dnsbrif' ; if [ $? -ne 0 ] ; then ip netns exec \"t3ns2\" brctl addif \"t3br2\" \"t3s2_dnsbrif\" ; fi\n", "delta": "0:00:00.035877", "end": "2019-11-17 10:35:06.199681", "item": [{"bridge_ip": "2.2.2.1", "bridge_name": "t3br2", "default_route_ip": "10.1.22.1", "ns_name": "t3ns2", "route": [{"if": "p1", "ip": "10.1.22.1/24", "ns_if": "t3if", "ns_name": "t3"}], "tenant_ns": [{"tenant_ns_if": "t3ns2if", "tenant_ns_ip": "10.1.22.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s2if", "tenant_sub_ip": "10.1.22.2/24"}], "vms": [{"brif": "t3br2if1", "disk": "10G", "mem": 3, "name": "t3_VM3", "vcpu": 2, "vmif": "t3VM3if1"}], "vxlan": [{"dev": "t3s2if", "dsport": 4789, "id": 42, "local_ip": "10.1.22.2", "remote_ip": "10.2.22.2", "remote_route": "10.2.22.0/24", "subnet_route": "10.1.22.0/24", "tenant_route_ip": "192.168.3.2", "v_name": "vxlan_t3s2"}]}, {"brif": "t3s2_dnsbrif", "dhcp_end": "2.2.2.126", "dhcp_start": "2.2.2.5", "dnsif": "t3s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "rc": 0, "start": "2019-11-17 10:35:06.163804", "stderr": "", "stderr_lines": [], "stdout": "\t\t\t\t\t\t\tt3s2_dnsbrif", "stdout_lines": ["\t\t\t\t\t\t\tt3s2_dnsbrif"]}

TASK [Create VETH Pairs] ************************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.21.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.1.21.1', u'bridge_name': u't3br1', u'dns': [{u'dnsif': u't3s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't3s1_dnsbrif'}], u'ns_name': u't3ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.21.2/24', u'tenant_ns_ip': u'10.1.21.1/24', u'tenant_ns_if': u't3ns1if', u'tenant_sub_if': u't3s1if', u'tenant_ns_name': u't3'}], u'bridge_ip': u'1.1.1.1', u'vxlan': [{u'local_ip': u'10.1.21.2', u'dsport': 4789, u'dev': u't3s1if', u'tenant_route_ip': u'192.168.3.2', u'remote_route': u'10.2.21.0/24', u'subnet_route': u'10.1.21.0/24', u'v_name': u'vxlan_t3s1', u'id': 42, u'remote_ip': u'10.2.21.2'}]}, {u'mem': 2, u'name': u't3_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't3br1if1', u'vmif': u't3VM1if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip link show \"t3br1if1\" ; if [ $? -ne 0 ] ; then ip link add \"t3VM1if1\" type veth peer name \"t3br1if1\" ; fi\nip link set dev \"t3br1if1\" up\nip link set dev \"t3VM1if1\" up\n", "delta": "0:00:00.011820", "end": "2019-11-17 10:35:06.469206", "item": [{"bridge_ip": "1.1.1.1", "bridge_name": "t3br1", "default_route_ip": "10.1.21.1", "dns": [{"brif": "t3s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t3s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t3ns1", "route": [{"if": "p1", "ip": "10.1.21.1/24", "ns_if": "t3if", "ns_name": "t3"}], "tenant_ns": [{"tenant_ns_if": "t3ns1if", "tenant_ns_ip": "10.1.21.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s1if", "tenant_sub_ip": "10.1.21.2/24"}], "vxlan": [{"dev": "t3s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.21.2", "remote_ip": "10.2.21.2", "remote_route": "10.2.21.0/24", "subnet_route": "10.1.21.0/24", "tenant_route_ip": "192.168.3.2", "v_name": "vxlan_t3s1"}]}, {"brif": "t3br1if1", "disk": "10G", "mem": 2, "name": "t3_VM1", "vcpu": 4, "vmif": "t3VM1if1"}], "rc": 0, "start": "2019-11-17 10:35:06.457386", "stderr": "Device \"t3br1if1\" does not exist.\nRTNETLINK answers: File exists\nCannot find device \"t3br1if1\"", "stderr_lines": ["Device \"t3br1if1\" does not exist.", "RTNETLINK answers: File exists", "Cannot find device \"t3br1if1\""], "stdout": "", "stdout_lines": []}
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.21.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.1.21.1', u'bridge_name': u't3br1', u'dns': [{u'dnsif': u't3s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't3s1_dnsbrif'}], u'ns_name': u't3ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.21.2/24', u'tenant_ns_ip': u'10.1.21.1/24', u'tenant_ns_if': u't3ns1if', u'tenant_sub_if': u't3s1if', u'tenant_ns_name': u't3'}], u'bridge_ip': u'1.1.1.1', u'vxlan': [{u'local_ip': u'10.1.21.2', u'dsport': 4789, u'dev': u't3s1if', u'tenant_route_ip': u'192.168.3.2', u'remote_route': u'10.2.21.0/24', u'subnet_route': u'10.1.21.0/24', u'v_name': u'vxlan_t3s1', u'id': 42, u'remote_ip': u'10.2.21.2'}]}, {u'mem': 4, u'name': u't3_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't3br1if2', u'vmif': u't3VM2if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip link show \"t3br1if2\" ; if [ $? -ne 0 ] ; then ip link add \"t3VM2if1\" type veth peer name \"t3br1if2\" ; fi\nip link set dev \"t3br1if2\" up\nip link set dev \"t3VM2if1\" up\n", "delta": "0:00:00.011708", "end": "2019-11-17 10:35:06.669188", "item": [{"bridge_ip": "1.1.1.1", "bridge_name": "t3br1", "default_route_ip": "10.1.21.1", "dns": [{"brif": "t3s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t3s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t3ns1", "route": [{"if": "p1", "ip": "10.1.21.1/24", "ns_if": "t3if", "ns_name": "t3"}], "tenant_ns": [{"tenant_ns_if": "t3ns1if", "tenant_ns_ip": "10.1.21.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s1if", "tenant_sub_ip": "10.1.21.2/24"}], "vxlan": [{"dev": "t3s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.21.2", "remote_ip": "10.2.21.2", "remote_route": "10.2.21.0/24", "subnet_route": "10.1.21.0/24", "tenant_route_ip": "192.168.3.2", "v_name": "vxlan_t3s1"}]}, {"brif": "t3br1if2", "disk": "10G", "mem": 4, "name": "t3_VM2", "vcpu": 2, "vmif": "t3VM2if1"}], "rc": 0, "start": "2019-11-17 10:35:06.657480", "stderr": "Device \"t3br1if2\" does not exist.\nRTNETLINK answers: File exists\nCannot find device \"t3br1if2\"", "stderr_lines": ["Device \"t3br1if2\" does not exist.", "RTNETLINK answers: File exists", "Cannot find device \"t3br1if2\""], "stdout": "", "stdout_lines": []}
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.22.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.1.22.1', u'bridge_name': u't3br2', u'dns': [{u'dnsif': u't3s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.126', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't3s2_dnsbrif'}], u'ns_name': u't3ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.22.2/24', u'tenant_ns_ip': u'10.1.22.1/24', u'tenant_ns_if': u't3ns2if', u'tenant_sub_if': u't3s2if', u'tenant_ns_name': u't3'}], u'bridge_ip': u'2.2.2.1', u'vxlan': [{u'local_ip': u'10.1.22.2', u'dsport': 4789, u'dev': u't3s2if', u'tenant_route_ip': u'192.168.3.2', u'remote_route': u'10.2.22.0/24', u'subnet_route': u'10.1.22.0/24', u'v_name': u'vxlan_t3s2', u'id': 42, u'remote_ip': u'10.2.22.2'}]}, {u'mem': 3, u'name': u't3_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't3br2if1', u'vmif': u't3VM3if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip link show \"t3br2if1\" ; if [ $? -ne 0 ] ; then ip link add \"t3VM3if1\" type veth peer name \"t3br2if1\" ; fi\nip link set dev \"t3br2if1\" up\nip link set dev \"t3VM3if1\" up\n", "delta": "0:00:00.012322", "end": "2019-11-17 10:35:06.869603", "item": [{"bridge_ip": "2.2.2.1", "bridge_name": "t3br2", "default_route_ip": "10.1.22.1", "dns": [{"brif": "t3s2_dnsbrif", "dhcp_end": "2.2.2.126", "dhcp_start": "2.2.2.5", "dnsif": "t3s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t3ns2", "route": [{"if": "p1", "ip": "10.1.22.1/24", "ns_if": "t3if", "ns_name": "t3"}], "tenant_ns": [{"tenant_ns_if": "t3ns2if", "tenant_ns_ip": "10.1.22.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s2if", "tenant_sub_ip": "10.1.22.2/24"}], "vxlan": [{"dev": "t3s2if", "dsport": 4789, "id": 42, "local_ip": "10.1.22.2", "remote_ip": "10.2.22.2", "remote_route": "10.2.22.0/24", "subnet_route": "10.1.22.0/24", "tenant_route_ip": "192.168.3.2", "v_name": "vxlan_t3s2"}]}, {"brif": "t3br2if1", "disk": "10G", "mem": 3, "name": "t3_VM3", "vcpu": 2, "vmif": "t3VM3if1"}], "rc": 0, "start": "2019-11-17 10:35:06.857281", "stderr": "Device \"t3br2if1\" does not exist.\nRTNETLINK answers: File exists\nCannot find device \"t3br2if1\"", "stderr_lines": ["Device \"t3br2if1\" does not exist.", "RTNETLINK answers: File exists", "Cannot find device \"t3br2if1\""], "stdout": "", "stdout_lines": []}

TASK [Attach VETH Pairs] ************************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.21.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.1.21.1', u'bridge_name': u't3br1', u'dns': [{u'dnsif': u't3s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't3s1_dnsbrif'}], u'ns_name': u't3ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.21.2/24', u'tenant_ns_ip': u'10.1.21.1/24', u'tenant_ns_if': u't3ns1if', u'tenant_sub_if': u't3s1if', u'tenant_ns_name': u't3'}], u'bridge_ip': u'1.1.1.1', u'vxlan': [{u'local_ip': u'10.1.21.2', u'dsport': 4789, u'dev': u't3s1if', u'tenant_route_ip': u'192.168.3.2', u'remote_route': u'10.2.21.0/24', u'subnet_route': u'10.1.21.0/24', u'v_name': u'vxlan_t3s1', u'id': 42, u'remote_ip': u'10.2.21.2'}]}, {u'mem': 2, u'name': u't3_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't3br1if1', u'vmif': u't3VM1if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip link show \"t3br1if1\" ; if [ $? -eq 0 ] ; then ip link set \"t3br1if1\" netns \"t3ns1\" ; fi\nip netns exec \"t3ns1\" brctl show \"t3br1\" | grep -w 't3br1if1' ; if [ $? -ne 0 ] ; then ip netns exec \"t3ns1\" brctl addif \"t3br1\" \"t3br1if1\" ; fi\n", "delta": "0:00:00.042730", "end": "2019-11-17 10:35:07.207787", "item": [{"bridge_ip": "1.1.1.1", "bridge_name": "t3br1", "default_route_ip": "10.1.21.1", "dns": [{"brif": "t3s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t3s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t3ns1", "route": [{"if": "p1", "ip": "10.1.21.1/24", "ns_if": "t3if", "ns_name": "t3"}], "tenant_ns": [{"tenant_ns_if": "t3ns1if", "tenant_ns_ip": "10.1.21.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s1if", "tenant_sub_ip": "10.1.21.2/24"}], "vxlan": [{"dev": "t3s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.21.2", "remote_ip": "10.2.21.2", "remote_route": "10.2.21.0/24", "subnet_route": "10.1.21.0/24", "tenant_route_ip": "192.168.3.2", "v_name": "vxlan_t3s1"}]}, {"brif": "t3br1if1", "disk": "10G", "mem": 2, "name": "t3_VM1", "vcpu": 4, "vmif": "t3VM1if1"}], "rc": 0, "start": "2019-11-17 10:35:07.165057", "stderr": "Device \"t3br1if1\" does not exist.", "stderr_lines": ["Device \"t3br1if1\" does not exist."], "stdout": "t3br1\t\t8000.06278ed78072\tno\t\tt3br1if1", "stdout_lines": ["t3br1\t\t8000.06278ed78072\tno\t\tt3br1if1"]}
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.21.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.1.21.1', u'bridge_name': u't3br1', u'dns': [{u'dnsif': u't3s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't3s1_dnsbrif'}], u'ns_name': u't3ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.21.2/24', u'tenant_ns_ip': u'10.1.21.1/24', u'tenant_ns_if': u't3ns1if', u'tenant_sub_if': u't3s1if', u'tenant_ns_name': u't3'}], u'bridge_ip': u'1.1.1.1', u'vxlan': [{u'local_ip': u'10.1.21.2', u'dsport': 4789, u'dev': u't3s1if', u'tenant_route_ip': u'192.168.3.2', u'remote_route': u'10.2.21.0/24', u'subnet_route': u'10.1.21.0/24', u'v_name': u'vxlan_t3s1', u'id': 42, u'remote_ip': u'10.2.21.2'}]}, {u'mem': 4, u'name': u't3_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't3br1if2', u'vmif': u't3VM2if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip link show \"t3br1if2\" ; if [ $? -eq 0 ] ; then ip link set \"t3br1if2\" netns \"t3ns1\" ; fi\nip netns exec \"t3ns1\" brctl show \"t3br1\" | grep -w 't3br1if2' ; if [ $? -ne 0 ] ; then ip netns exec \"t3ns1\" brctl addif \"t3br1\" \"t3br1if2\" ; fi\n", "delta": "0:00:00.037605", "end": "2019-11-17 10:35:07.471850", "item": [{"bridge_ip": "1.1.1.1", "bridge_name": "t3br1", "default_route_ip": "10.1.21.1", "dns": [{"brif": "t3s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t3s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t3ns1", "route": [{"if": "p1", "ip": "10.1.21.1/24", "ns_if": "t3if", "ns_name": "t3"}], "tenant_ns": [{"tenant_ns_if": "t3ns1if", "tenant_ns_ip": "10.1.21.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s1if", "tenant_sub_ip": "10.1.21.2/24"}], "vxlan": [{"dev": "t3s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.21.2", "remote_ip": "10.2.21.2", "remote_route": "10.2.21.0/24", "subnet_route": "10.1.21.0/24", "tenant_route_ip": "192.168.3.2", "v_name": "vxlan_t3s1"}]}, {"brif": "t3br1if2", "disk": "10G", "mem": 4, "name": "t3_VM2", "vcpu": 2, "vmif": "t3VM2if1"}], "rc": 0, "start": "2019-11-17 10:35:07.434245", "stderr": "Device \"t3br1if2\" does not exist.", "stderr_lines": ["Device \"t3br1if2\" does not exist."], "stdout": "\t\t\t\t\t\t\tt3br1if2", "stdout_lines": ["\t\t\t\t\t\t\tt3br1if2"]}
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.22.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.1.22.1', u'bridge_name': u't3br2', u'dns': [{u'dnsif': u't3s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.126', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't3s2_dnsbrif'}], u'ns_name': u't3ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.22.2/24', u'tenant_ns_ip': u'10.1.22.1/24', u'tenant_ns_if': u't3ns2if', u'tenant_sub_if': u't3s2if', u'tenant_ns_name': u't3'}], u'bridge_ip': u'2.2.2.1', u'vxlan': [{u'local_ip': u'10.1.22.2', u'dsport': 4789, u'dev': u't3s2if', u'tenant_route_ip': u'192.168.3.2', u'remote_route': u'10.2.22.0/24', u'subnet_route': u'10.1.22.0/24', u'v_name': u'vxlan_t3s2', u'id': 42, u'remote_ip': u'10.2.22.2'}]}, {u'mem': 3, u'name': u't3_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't3br2if1', u'vmif': u't3VM3if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip link show \"t3br2if1\" ; if [ $? -eq 0 ] ; then ip link set \"t3br2if1\" netns \"t3ns2\" ; fi\nip netns exec \"t3ns2\" brctl show \"t3br2\" | grep -w 't3br2if1' ; if [ $? -ne 0 ] ; then ip netns exec \"t3ns2\" brctl addif \"t3br2\" \"t3br2if1\" ; fi\n", "delta": "0:00:00.052910", "end": "2019-11-17 10:35:07.743746", "item": [{"bridge_ip": "2.2.2.1", "bridge_name": "t3br2", "default_route_ip": "10.1.22.1", "dns": [{"brif": "t3s2_dnsbrif", "dhcp_end": "2.2.2.126", "dhcp_start": "2.2.2.5", "dnsif": "t3s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t3ns2", "route": [{"if": "p1", "ip": "10.1.22.1/24", "ns_if": "t3if", "ns_name": "t3"}], "tenant_ns": [{"tenant_ns_if": "t3ns2if", "tenant_ns_ip": "10.1.22.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s2if", "tenant_sub_ip": "10.1.22.2/24"}], "vxlan": [{"dev": "t3s2if", "dsport": 4789, "id": 42, "local_ip": "10.1.22.2", "remote_ip": "10.2.22.2", "remote_route": "10.2.22.0/24", "subnet_route": "10.1.22.0/24", "tenant_route_ip": "192.168.3.2", "v_name": "vxlan_t3s2"}]}, {"brif": "t3br2if1", "disk": "10G", "mem": 3, "name": "t3_VM3", "vcpu": 2, "vmif": "t3VM3if1"}], "rc": 0, "start": "2019-11-17 10:35:07.690836", "stderr": "Device \"t3br2if1\" does not exist.", "stderr_lines": ["Device \"t3br2if1\" does not exist."], "stdout": "t3br2\t\t8000.32ee3138f042\tno\t\tt3br2if1", "stdout_lines": ["t3br2\t\t8000.32ee3138f042\tno\t\tt3br2if1"]}

TASK [All interfaces and bridges UP] ************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.21.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.1.21.1', u'bridge_name': u't3br1', u'dns': [{u'dnsif': u't3s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't3s1_dnsbrif'}], u'ns_name': u't3ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.21.2/24', u'tenant_ns_ip': u'10.1.21.1/24', u'tenant_ns_if': u't3ns1if', u'tenant_sub_if': u't3s1if', u'tenant_ns_name': u't3'}], u'bridge_ip': u'1.1.1.1', u'vxlan': [{u'local_ip': u'10.1.21.2', u'dsport': 4789, u'dev': u't3s1if', u'tenant_route_ip': u'192.168.3.2', u'remote_route': u'10.2.21.0/24', u'subnet_route': u'10.1.21.0/24', u'v_name': u'vxlan_t3s1', u'id': 42, u'remote_ip': u'10.2.21.2'}]}, {u'mem': 2, u'name': u't3_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't3br1if1', u'vmif': u't3VM1if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t3ns1\" ip link set \"t3br1if1\" up\nip netns exec \"t3ns1\" ip link set dev \"t3br1\" up\n", "delta": "0:00:00.078724", "end": "2019-11-17 10:35:08.119720", "item": [{"bridge_ip": "1.1.1.1", "bridge_name": "t3br1", "default_route_ip": "10.1.21.1", "dns": [{"brif": "t3s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t3s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t3ns1", "route": [{"if": "p1", "ip": "10.1.21.1/24", "ns_if": "t3if", "ns_name": "t3"}], "tenant_ns": [{"tenant_ns_if": "t3ns1if", "tenant_ns_ip": "10.1.21.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s1if", "tenant_sub_ip": "10.1.21.2/24"}], "vxlan": [{"dev": "t3s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.21.2", "remote_ip": "10.2.21.2", "remote_route": "10.2.21.0/24", "subnet_route": "10.1.21.0/24", "tenant_route_ip": "192.168.3.2", "v_name": "vxlan_t3s1"}]}, {"brif": "t3br1if1", "disk": "10G", "mem": 2, "name": "t3_VM1", "vcpu": 4, "vmif": "t3VM1if1"}], "rc": 0, "start": "2019-11-17 10:35:08.040996", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.21.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.1.21.1', u'bridge_name': u't3br1', u'dns': [{u'dnsif': u't3s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't3s1_dnsbrif'}], u'ns_name': u't3ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.21.2/24', u'tenant_ns_ip': u'10.1.21.1/24', u'tenant_ns_if': u't3ns1if', u'tenant_sub_if': u't3s1if', u'tenant_ns_name': u't3'}], u'bridge_ip': u'1.1.1.1', u'vxlan': [{u'local_ip': u'10.1.21.2', u'dsport': 4789, u'dev': u't3s1if', u'tenant_route_ip': u'192.168.3.2', u'remote_route': u'10.2.21.0/24', u'subnet_route': u'10.1.21.0/24', u'v_name': u'vxlan_t3s1', u'id': 42, u'remote_ip': u'10.2.21.2'}]}, {u'mem': 4, u'name': u't3_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't3br1if2', u'vmif': u't3VM2if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t3ns1\" ip link set \"t3br1if2\" up\nip netns exec \"t3ns1\" ip link set dev \"t3br1\" up\n", "delta": "0:00:00.066501", "end": "2019-11-17 10:35:08.407728", "item": [{"bridge_ip": "1.1.1.1", "bridge_name": "t3br1", "default_route_ip": "10.1.21.1", "dns": [{"brif": "t3s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t3s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t3ns1", "route": [{"if": "p1", "ip": "10.1.21.1/24", "ns_if": "t3if", "ns_name": "t3"}], "tenant_ns": [{"tenant_ns_if": "t3ns1if", "tenant_ns_ip": "10.1.21.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s1if", "tenant_sub_ip": "10.1.21.2/24"}], "vxlan": [{"dev": "t3s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.21.2", "remote_ip": "10.2.21.2", "remote_route": "10.2.21.0/24", "subnet_route": "10.1.21.0/24", "tenant_route_ip": "192.168.3.2", "v_name": "vxlan_t3s1"}]}, {"brif": "t3br1if2", "disk": "10G", "mem": 4, "name": "t3_VM2", "vcpu": 2, "vmif": "t3VM2if1"}], "rc": 0, "start": "2019-11-17 10:35:08.341227", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.22.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.1.22.1', u'bridge_name': u't3br2', u'dns': [{u'dnsif': u't3s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.126', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't3s2_dnsbrif'}], u'ns_name': u't3ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.22.2/24', u'tenant_ns_ip': u'10.1.22.1/24', u'tenant_ns_if': u't3ns2if', u'tenant_sub_if': u't3s2if', u'tenant_ns_name': u't3'}], u'bridge_ip': u'2.2.2.1', u'vxlan': [{u'local_ip': u'10.1.22.2', u'dsport': 4789, u'dev': u't3s2if', u'tenant_route_ip': u'192.168.3.2', u'remote_route': u'10.2.22.0/24', u'subnet_route': u'10.1.22.0/24', u'v_name': u'vxlan_t3s2', u'id': 42, u'remote_ip': u'10.2.22.2'}]}, {u'mem': 3, u'name': u't3_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't3br2if1', u'vmif': u't3VM3if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t3ns2\" ip link set \"t3br2if1\" up\nip netns exec \"t3ns2\" ip link set dev \"t3br2\" up\n", "delta": "0:00:00.076178", "end": "2019-11-17 10:35:08.699691", "item": [{"bridge_ip": "2.2.2.1", "bridge_name": "t3br2", "default_route_ip": "10.1.22.1", "dns": [{"brif": "t3s2_dnsbrif", "dhcp_end": "2.2.2.126", "dhcp_start": "2.2.2.5", "dnsif": "t3s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t3ns2", "route": [{"if": "p1", "ip": "10.1.22.1/24", "ns_if": "t3if", "ns_name": "t3"}], "tenant_ns": [{"tenant_ns_if": "t3ns2if", "tenant_ns_ip": "10.1.22.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s2if", "tenant_sub_ip": "10.1.22.2/24"}], "vxlan": [{"dev": "t3s2if", "dsport": 4789, "id": 42, "local_ip": "10.1.22.2", "remote_ip": "10.2.22.2", "remote_route": "10.2.22.0/24", "subnet_route": "10.1.22.0/24", "tenant_route_ip": "192.168.3.2", "v_name": "vxlan_t3s2"}]}, {"brif": "t3br2if1", "disk": "10G", "mem": 3, "name": "t3_VM3", "vcpu": 2, "vmif": "t3VM3if1"}], "rc": 0, "start": "2019-11-17 10:35:08.623513", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Add IP to DNS Interface] ******************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.21.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.1.21.1', u'bridge_name': u't3br1', u'ns_name': u't3ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.21.2/24', u'tenant_ns_ip': u'10.1.21.1/24', u'tenant_ns_if': u't3ns1if', u'tenant_sub_if': u't3s1if', u'tenant_ns_name': u't3'}], u'bridge_ip': u'1.1.1.1', u'vms': [{u'mem': 2, u'name': u't3_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't3br1if1', u'vmif': u't3VM1if1'}, {u'mem': 4, u'name': u't3_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't3br1if2', u'vmif': u't3VM2if1'}], u'vxlan': [{u'local_ip': u'10.1.21.2', u'dsport': 4789, u'dev': u't3s1if', u'tenant_route_ip': u'192.168.3.2', u'remote_route': u'10.2.21.0/24', u'subnet_route': u'10.1.21.0/24', u'v_name': u'vxlan_t3s1', u'id': 42, u'remote_ip': u'10.2.21.2'}]}, {u'dnsif': u't3s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't3s1_dnsbrif'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t3ns1\" ip addr show \"t3s1_dnsif\" | awk 'FNR==3{ print $2 }' | grep -w '^1.1.1.1/24' ; if [ $? -ne 0 ] ; then ip netns exec \"t3ns1\" ip addr add \"1.1.1.1/24\" dev \"t3s1_dnsif\" ; fi\n", "delta": "0:00:00.036561", "end": "2019-11-17 10:35:09.011974", "item": [{"bridge_ip": "1.1.1.1", "bridge_name": "t3br1", "default_route_ip": "10.1.21.1", "ns_name": "t3ns1", "route": [{"if": "p1", "ip": "10.1.21.1/24", "ns_if": "t3if", "ns_name": "t3"}], "tenant_ns": [{"tenant_ns_if": "t3ns1if", "tenant_ns_ip": "10.1.21.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s1if", "tenant_sub_ip": "10.1.21.2/24"}], "vms": [{"brif": "t3br1if1", "disk": "10G", "mem": 2, "name": "t3_VM1", "vcpu": 4, "vmif": "t3VM1if1"}, {"brif": "t3br1if2", "disk": "10G", "mem": 4, "name": "t3_VM2", "vcpu": 2, "vmif": "t3VM2if1"}], "vxlan": [{"dev": "t3s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.21.2", "remote_ip": "10.2.21.2", "remote_route": "10.2.21.0/24", "subnet_route": "10.1.21.0/24", "tenant_route_ip": "192.168.3.2", "v_name": "vxlan_t3s1"}]}, {"brif": "t3s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t3s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "rc": 0, "start": "2019-11-17 10:35:08.975413", "stderr": "", "stderr_lines": [], "stdout": "1.1.1.1/24", "stdout_lines": ["1.1.1.1/24"]}
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.22.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.1.22.1', u'bridge_name': u't3br2', u'ns_name': u't3ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.22.2/24', u'tenant_ns_ip': u'10.1.22.1/24', u'tenant_ns_if': u't3ns2if', u'tenant_sub_if': u't3s2if', u'tenant_ns_name': u't3'}], u'bridge_ip': u'2.2.2.1', u'vms': [{u'mem': 3, u'name': u't3_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't3br2if1', u'vmif': u't3VM3if1'}], u'vxlan': [{u'local_ip': u'10.1.22.2', u'dsport': 4789, u'dev': u't3s2if', u'tenant_route_ip': u'192.168.3.2', u'remote_route': u'10.2.22.0/24', u'subnet_route': u'10.1.22.0/24', u'v_name': u'vxlan_t3s2', u'id': 42, u'remote_ip': u'10.2.22.2'}]}, {u'dnsif': u't3s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.126', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't3s2_dnsbrif'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t3ns2\" ip addr show \"t3s2_dnsif\" | awk 'FNR==3{ print $2 }' | grep -w '^2.2.2.1/24' ; if [ $? -ne 0 ] ; then ip netns exec \"t3ns2\" ip addr add \"2.2.2.1/24\" dev \"t3s2_dnsif\" ; fi\n", "delta": "0:00:00.037228", "end": "2019-11-17 10:35:09.239866", "item": [{"bridge_ip": "2.2.2.1", "bridge_name": "t3br2", "default_route_ip": "10.1.22.1", "ns_name": "t3ns2", "route": [{"if": "p1", "ip": "10.1.22.1/24", "ns_if": "t3if", "ns_name": "t3"}], "tenant_ns": [{"tenant_ns_if": "t3ns2if", "tenant_ns_ip": "10.1.22.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s2if", "tenant_sub_ip": "10.1.22.2/24"}], "vms": [{"brif": "t3br2if1", "disk": "10G", "mem": 3, "name": "t3_VM3", "vcpu": 2, "vmif": "t3VM3if1"}], "vxlan": [{"dev": "t3s2if", "dsport": 4789, "id": 42, "local_ip": "10.1.22.2", "remote_ip": "10.2.22.2", "remote_route": "10.2.22.0/24", "subnet_route": "10.1.22.0/24", "tenant_route_ip": "192.168.3.2", "v_name": "vxlan_t3s2"}]}, {"brif": "t3s2_dnsbrif", "dhcp_end": "2.2.2.126", "dhcp_start": "2.2.2.5", "dnsif": "t3s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "rc": 0, "start": "2019-11-17 10:35:09.202638", "stderr": "", "stderr_lines": [], "stdout": "2.2.2.1/24", "stdout_lines": ["2.2.2.1/24"]}

TASK [Install DHCP Server] **********************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.21.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.1.21.1', u'bridge_name': u't3br1', u'ns_name': u't3ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.21.2/24', u'tenant_ns_ip': u'10.1.21.1/24', u'tenant_ns_if': u't3ns1if', u'tenant_sub_if': u't3s1if', u'tenant_ns_name': u't3'}], u'bridge_ip': u'1.1.1.1', u'vms': [{u'mem': 2, u'name': u't3_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't3br1if1', u'vmif': u't3VM1if1'}, {u'mem': 4, u'name': u't3_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't3br1if2', u'vmif': u't3VM2if1'}], u'vxlan': [{u'local_ip': u'10.1.21.2', u'dsport': 4789, u'dev': u't3s1if', u'tenant_route_ip': u'192.168.3.2', u'remote_route': u'10.2.21.0/24', u'subnet_route': u'10.1.21.0/24', u'v_name': u'vxlan_t3s1', u'id': 42, u'remote_ip': u'10.2.21.2'}]}, {u'dnsif': u't3s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't3s1_dnsbrif'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t3ns1\" ps aux | grep -w '[d]nsmasq --interface t3s1_dnsif -z --dhcp-range=1.1.1.5,1.1.1.126' ; if [ $? -ne 0 ] ; then ip netns exec \"t3ns1\" dnsmasq --interface \"t3s1_dnsif\" -z --dhcp-range=1.1.1.5,'1.1.1.126' ; fi\n", "delta": "0:00:00.048931", "end": "2019-11-17 10:35:09.535631", "item": [{"bridge_ip": "1.1.1.1", "bridge_name": "t3br1", "default_route_ip": "10.1.21.1", "ns_name": "t3ns1", "route": [{"if": "p1", "ip": "10.1.21.1/24", "ns_if": "t3if", "ns_name": "t3"}], "tenant_ns": [{"tenant_ns_if": "t3ns1if", "tenant_ns_ip": "10.1.21.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s1if", "tenant_sub_ip": "10.1.21.2/24"}], "vms": [{"brif": "t3br1if1", "disk": "10G", "mem": 2, "name": "t3_VM1", "vcpu": 4, "vmif": "t3VM1if1"}, {"brif": "t3br1if2", "disk": "10G", "mem": 4, "name": "t3_VM2", "vcpu": 2, "vmif": "t3VM2if1"}], "vxlan": [{"dev": "t3s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.21.2", "remote_ip": "10.2.21.2", "remote_route": "10.2.21.0/24", "subnet_route": "10.1.21.0/24", "tenant_route_ip": "192.168.3.2", "v_name": "vxlan_t3s1"}]}, {"brif": "t3s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t3s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "rc": 0, "start": "2019-11-17 10:35:09.486700", "stderr": "", "stderr_lines": [], "stdout": "nobody   13873  0.0  0.0  51580  2772 ?        S    10:24   0:00 dnsmasq --interface t3s1_dnsif -z --dhcp-range=1.1.1.5,1.1.1.126", "stdout_lines": ["nobody   13873  0.0  0.0  51580  2772 ?        S    10:24   0:00 dnsmasq --interface t3s1_dnsif -z --dhcp-range=1.1.1.5,1.1.1.126"]}
failed: [localhost] (item=[{u'route': [{u'ip': u'10.1.22.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.1.22.1', u'bridge_name': u't3br2', u'ns_name': u't3ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.22.2/24', u'tenant_ns_ip': u'10.1.22.1/24', u'tenant_ns_if': u't3ns2if', u'tenant_sub_if': u't3s2if', u'tenant_ns_name': u't3'}], u'bridge_ip': u'2.2.2.1', u'vms': [{u'mem': 3, u'name': u't3_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't3br2if1', u'vmif': u't3VM3if1'}], u'vxlan': [{u'local_ip': u'10.1.22.2', u'dsport': 4789, u'dev': u't3s2if', u'tenant_route_ip': u'192.168.3.2', u'remote_route': u'10.2.22.0/24', u'subnet_route': u'10.1.22.0/24', u'v_name': u'vxlan_t3s2', u'id': 42, u'remote_ip': u'10.2.22.2'}]}, {u'dnsif': u't3s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.126', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't3s2_dnsbrif'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t3ns2\" ps aux | grep -w '[d]nsmasq --interface t3s2_dnsif -z --dhcp-range=2.2.2.5,2.2.2.126' ; if [ $? -ne 0 ] ; then ip netns exec \"t3ns2\" dnsmasq --interface \"t3s2_dnsif\" -z --dhcp-range=2.2.2.5,'2.2.2.126' ; fi\n", "delta": "0:00:00.099465", "end": "2019-11-17 10:35:09.827581", "item": [{"bridge_ip": "2.2.2.1", "bridge_name": "t3br2", "default_route_ip": "10.1.22.1", "ns_name": "t3ns2", "route": [{"if": "p1", "ip": "10.1.22.1/24", "ns_if": "t3if", "ns_name": "t3"}], "tenant_ns": [{"tenant_ns_if": "t3ns2if", "tenant_ns_ip": "10.1.22.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s2if", "tenant_sub_ip": "10.1.22.2/24"}], "vms": [{"brif": "t3br2if1", "disk": "10G", "mem": 3, "name": "t3_VM3", "vcpu": 2, "vmif": "t3VM3if1"}], "vxlan": [{"dev": "t3s2if", "dsport": 4789, "id": 42, "local_ip": "10.1.22.2", "remote_ip": "10.2.22.2", "remote_route": "10.2.22.0/24", "subnet_route": "10.1.22.0/24", "tenant_route_ip": "192.168.3.2", "v_name": "vxlan_t3s2"}]}, {"brif": "t3s2_dnsbrif", "dhcp_end": "2.2.2.126", "dhcp_start": "2.2.2.5", "dnsif": "t3s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "msg": "non-zero return code", "rc": 2, "start": "2019-11-17 10:35:09.728116", "stderr": "\ndnsmasq: failed to create listening socket for 2.2.2.1: Address already in use", "stderr_lines": ["", "dnsmasq: failed to create listening socket for 2.2.2.1: Address already in use"], "stdout": "", "stdout_lines": []}

PLAY RECAP **************************************************************************************************************************************************
localhost                  : ok=18   changed=16   unreachable=0    failed=1    skipped=0    rescued=0    ignored=0   

Using /etc/ansible/ansible.cfg as config file

PLAY [worker] ***********************************************************************************************************************************************

TASK [Create Tenant Namespace] ******************************************************************************************************************************
ok: [99.99.99.2] => (item={u'default_route_ip': u'192.168.131.1', u'name': u't3', u'pns_ip': u'192.168.131.1/24', u'tenant_if': u't3if', u'tenant_ip': u'192.168.131.2/24', u'pns_if': u't3pns_if'}) => {"ansible_loop_var": "item", "changed": false, "cmd": ["ip", "netns", "add", "t3"], "item": {"default_route_ip": "192.168.131.1", "name": "t3", "pns_if": "t3pns_if", "pns_ip": "192.168.131.1/24", "tenant_if": "t3if", "tenant_ip": "192.168.131.2/24"}, "rc": 0, "stdout": "skipped, since /var/run/netns/t3 exists", "stdout_lines": ["skipped, since /var/run/netns/t3 exists"]}

TASK [Create Subnet Namespace] ******************************************************************************************************************************
ok: [99.99.99.2] => (item={u'route': [{u'ip': u'10.2.21.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.2.21.1', u'bridge_name': u't3br1', u'dns': [{u'dnsif': u't3s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't3s1_dnsbrif'}], u'ns_name': u't3ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.21.2/24', u'tenant_ns_ip': u'10.2.21.1/24', u'tenant_ns_if': u't3ns1if', u'tenant_ns_name': u't3', u'tenant_sub_if': u't3s1if'}], u'bridge_ip': u'1.1.1.1', u'vms': [{u'mem': 2, u'name': u't3_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't3br1if1', u'vmif': u't3VM4if1'}, {u'mem': 2, u'name': u't3_VM5', u'vcpu': 4, u'disk': u'10G', u'brif': u't3br1if2', u'vmif': u't3VM5if1'}], u'vxlan': [{u'local_ip': u'10.2.21.2', u'tenant_route_ip': u'192.168.131.2', u'dsport': 4789, u'dev': u't3s1if', u'subnet_route': u'10.2.21.0/24', u'remote_route': u'10.1.21.0/24', u'v_name': u'vxlan_t3s1', u'id': 42, u'remote_ip': u'10.1.21.2'}]}) => {"ansible_loop_var": "item", "changed": false, "cmd": ["ip", "netns", "add", "t3ns1"], "item": {"bridge_ip": "1.1.1.1", "bridge_name": "t3br1", "default_route_ip": "10.2.21.1", "dns": [{"brif": "t3s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t3s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "ns_name": "t3ns1", "route": [{"if": "p1", "ip": "10.2.21.1/24", "ns_if": "t3if", "ns_name": "t3"}], "tenant_ns": [{"tenant_ns_if": "t3ns1if", "tenant_ns_ip": "10.2.21.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s1if", "tenant_sub_ip": "10.2.21.2/24"}], "vms": [{"brif": "t3br1if1", "disk": "10G", "mem": 2, "name": "t3_VM4", "vcpu": 4, "vmif": "t3VM4if1"}, {"brif": "t3br1if2", "disk": "10G", "mem": 2, "name": "t3_VM5", "vcpu": 4, "vmif": "t3VM5if1"}], "vxlan": [{"dev": "t3s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.21.2", "remote_ip": "10.1.21.2", "remote_route": "10.1.21.0/24", "subnet_route": "10.2.21.0/24", "tenant_route_ip": "192.168.131.2", "v_name": "vxlan_t3s1"}]}, "rc": 0, "stdout": "skipped, since /var/run/netns/t3ns1 exists", "stdout_lines": ["skipped, since /var/run/netns/t3ns1 exists"]}
changed: [99.99.99.2] => (item={u'route': [{u'ip': u'10.2.22.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.2.22.1', u'bridge_name': u't3br2', u'dns': [{u'dnsif': u't3s2_dnsif', u'dhcp_start': u'2.2.2.133', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.128/24', u'net_mask': u'255.255.255.0', u'brif': u't3s2_dnsbrif'}], u'ns_name': u't3ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.22.2/24', u'tenant_ns_ip': u'10.2.22.1/24', u'tenant_ns_if': u't3ns2if', u'tenant_ns_name': u't3', u'tenant_sub_if': u't3s2if'}], u'bridge_ip': u'2.2.2.1', u'vms': [{u'mem': 2, u'name': u't3_VM6', u'vcpu': 4, u'disk': u'10G', u'brif': u't3br2if1', u'vmif': u't3VM6if1'}], u'vxlan': [{u'local_ip': u'10.2.22.2', u'tenant_route_ip': u'192.168.131.2', u'dsport': 4789, u'dev': u't3s2if', u'subnet_route': u'10.2.22.0/24', u'remote_route': u'10.1.22.0/24', u'v_name': u'vxlan_t3s2', u'id': 42, u'remote_ip': u'10.1.22.2'}]}) => {"ansible_loop_var": "item", "changed": true, "cmd": ["ip", "netns", "add", "t3ns2"], "delta": "0:00:00.056437", "end": "2019-11-17 10:35:12.549082", "item": {"bridge_ip": "2.2.2.1", "bridge_name": "t3br2", "default_route_ip": "10.2.22.1", "dns": [{"brif": "t3s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.133", "dnsif": "t3s2_dnsif", "dnsif_ip": "2.2.2.128/24", "net_mask": "255.255.255.0"}], "ns_name": "t3ns2", "route": [{"if": "p1", "ip": "10.2.22.1/24", "ns_if": "t3if", "ns_name": "t3"}], "tenant_ns": [{"tenant_ns_if": "t3ns2if", "tenant_ns_ip": "10.2.22.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s2if", "tenant_sub_ip": "10.2.22.2/24"}], "vms": [{"brif": "t3br2if1", "disk": "10G", "mem": 2, "name": "t3_VM6", "vcpu": 4, "vmif": "t3VM6if1"}], "vxlan": [{"dev": "t3s2if", "dsport": 4789, "id": 42, "local_ip": "10.2.22.2", "remote_ip": "10.1.22.2", "remote_route": "10.1.22.0/24", "subnet_route": "10.2.22.0/24", "tenant_route_ip": "192.168.131.2", "v_name": "vxlan_t3s2"}]}, "rc": 0, "start": "2019-11-17 10:35:12.492645", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Create Tenant VETH pairs] *****************************************************************************************************************************
changed: [99.99.99.2] => (item={u'default_route_ip': u'192.168.131.1', u'name': u't3', u'pns_ip': u'192.168.131.1/24', u'tenant_if': u't3if', u'tenant_ip': u'192.168.131.2/24', u'pns_if': u't3pns_if'}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip link show \"t3if\" ; if [ $? -ne 0 ] ; then ip link add \"t3if\" type veth peer name \"t3pns_if\" ; fi\n", "delta": "0:00:00.005117", "end": "2019-11-17 10:35:12.921641", "item": {"default_route_ip": "192.168.131.1", "name": "t3", "pns_if": "t3pns_if", "pns_ip": "192.168.131.1/24", "tenant_if": "t3if", "tenant_ip": "192.168.131.2/24"}, "rc": 0, "start": "2019-11-17 10:35:12.916524", "stderr": "", "stderr_lines": [], "stdout": "46: t3if@t3pns_if: <BROADCAST,MULTICAST> mtu 1500 qdisc noop state DOWN mode DEFAULT group default qlen 1000\n    link/ether 56:fe:28:a6:5e:8a brd ff:ff:ff:ff:ff:ff", "stdout_lines": ["46: t3if@t3pns_if: <BROADCAST,MULTICAST> mtu 1500 qdisc noop state DOWN mode DEFAULT group default qlen 1000", "    link/ether 56:fe:28:a6:5e:8a brd ff:ff:ff:ff:ff:ff"]}

TASK [Attach Tenant VETH Pairs] *****************************************************************************************************************************
changed: [99.99.99.2] => (item={u'default_route_ip': u'192.168.131.1', u'name': u't3', u'pns_ip': u'192.168.131.1/24', u'tenant_if': u't3if', u'tenant_ip': u'192.168.131.2/24', u'pns_if': u't3pns_if'}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec pns ip link show \"t3pns_if\" ; if [ $? -ne 0 ] ; then ip link set \"t3pns_if\" netns pns ; fi\nip netns exec \"t3\" ip link show \"t3if\" ; if [ $? -ne 0 ] ; then ip link set \"t3if\" netns \"t3\" ; fi\nip netns exec pns ip link set dev \"t3pns_if\" up\nip netns exec \"t3\" ip link set dev \"t3if\" up\n", "delta": "0:00:00.160640", "end": "2019-11-17 10:35:13.472368", "item": {"default_route_ip": "192.168.131.1", "name": "t3", "pns_if": "t3pns_if", "pns_ip": "192.168.131.1/24", "tenant_if": "t3if", "tenant_ip": "192.168.131.2/24"}, "rc": 0, "start": "2019-11-17 10:35:13.311728", "stderr": "", "stderr_lines": [], "stdout": "39: t3pns_if@if40: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP mode DEFAULT group default qlen 1000\n    link/ether 5a:b3:ce:30:c8:43 brd ff:ff:ff:ff:ff:ff link-netnsid 3\n40: t3if@if39: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP mode DEFAULT group default qlen 1000\n    link/ether fa:c6:04:a2:f5:eb brd ff:ff:ff:ff:ff:ff link-netnsid 0", "stdout_lines": ["39: t3pns_if@if40: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP mode DEFAULT group default qlen 1000", "    link/ether 5a:b3:ce:30:c8:43 brd ff:ff:ff:ff:ff:ff link-netnsid 3", "40: t3if@if39: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP mode DEFAULT group default qlen 1000", "    link/ether fa:c6:04:a2:f5:eb brd ff:ff:ff:ff:ff:ff link-netnsid 0"]}

TASK [Add IP addresses to Tenant VETH Pairs] ****************************************************************************************************************
changed: [99.99.99.2] => (item={u'default_route_ip': u'192.168.131.1', u'name': u't3', u'pns_ip': u'192.168.131.1/24', u'tenant_if': u't3if', u'tenant_ip': u'192.168.131.2/24', u'pns_if': u't3pns_if'}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec pns ip addr show \"t3pns_if\" | awk 'FNR==3{ print $2 }' | grep -w '^192.168.131.1/24' ; if [ $? -ne 0 ] ; then ip netns exec pns ip addr add \"192.168.131.1/24\" dev \"t3pns_if\" ; fi\nip netns exec \"t3\" ip addr show \"t3if\" | awk 'FNR==3{ print $2 }' | grep -w '^192.168.131.2/24' ; if [ $? -ne 0 ] ; then ip netns exec \"t3\" ip addr add \"192.168.131.2/24\" dev \"t3if\" ; fi\n", "delta": "0:00:00.073937", "end": "2019-11-17 10:35:13.940701", "item": {"default_route_ip": "192.168.131.1", "name": "t3", "pns_if": "t3pns_if", "pns_ip": "192.168.131.1/24", "tenant_if": "t3if", "tenant_ip": "192.168.131.2/24"}, "rc": 0, "start": "2019-11-17 10:35:13.866764", "stderr": "", "stderr_lines": [], "stdout": "192.168.131.1/24\n192.168.131.2/24", "stdout_lines": ["192.168.131.1/24", "192.168.131.2/24"]}

TASK [Create Namespace VETH Pairs] **************************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.21.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.2.21.1', u'bridge_name': u't3br1', u'dns': [{u'dnsif': u't3s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't3s1_dnsbrif'}], u'ns_name': u't3ns1', u'bridge_ip': u'1.1.1.1', u'vms': [{u'mem': 2, u'name': u't3_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't3br1if1', u'vmif': u't3VM4if1'}, {u'mem': 2, u'name': u't3_VM5', u'vcpu': 4, u'disk': u'10G', u'brif': u't3br1if2', u'vmif': u't3VM5if1'}], u'vxlan': [{u'local_ip': u'10.2.21.2', u'dsport': 4789, u'dev': u't3s1if', u'tenant_route_ip': u'192.168.131.2', u'remote_route': u'10.1.21.0/24', u'subnet_route': u'10.2.21.0/24', u'v_name': u'vxlan_t3s1', u'id': 42, u'remote_ip': u'10.1.21.2'}]}, {u'tenant_sub_ip': u'10.2.21.2/24', u'tenant_ns_ip': u'10.2.21.1/24', u'tenant_ns_if': u't3ns1if', u'tenant_sub_if': u't3s1if', u'tenant_ns_name': u't3'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip link show \"t3ns1if\" ; if [ $? -ne 0 ] ; then ip link add \"t3ns1if\" type veth peer name \"t3s1if\" ; fi\n", "delta": "0:00:00.004475", "end": "2019-11-17 10:35:14.347827", "item": [{"bridge_ip": "1.1.1.1", "bridge_name": "t3br1", "default_route_ip": "10.2.21.1", "dns": [{"brif": "t3s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t3s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "ns_name": "t3ns1", "route": [{"if": "p1", "ip": "10.2.21.1/24", "ns_if": "t3if", "ns_name": "t3"}], "vms": [{"brif": "t3br1if1", "disk": "10G", "mem": 2, "name": "t3_VM4", "vcpu": 4, "vmif": "t3VM4if1"}, {"brif": "t3br1if2", "disk": "10G", "mem": 2, "name": "t3_VM5", "vcpu": 4, "vmif": "t3VM5if1"}], "vxlan": [{"dev": "t3s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.21.2", "remote_ip": "10.1.21.2", "remote_route": "10.1.21.0/24", "subnet_route": "10.2.21.0/24", "tenant_route_ip": "192.168.131.2", "v_name": "vxlan_t3s1"}]}, {"tenant_ns_if": "t3ns1if", "tenant_ns_ip": "10.2.21.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s1if", "tenant_sub_ip": "10.2.21.2/24"}], "rc": 0, "start": "2019-11-17 10:35:14.343352", "stderr": "", "stderr_lines": [], "stdout": "48: t3ns1if@t3s1if: <BROADCAST,MULTICAST> mtu 1500 qdisc noop state DOWN mode DEFAULT group default qlen 1000\n    link/ether 36:e8:d3:1e:c2:db brd ff:ff:ff:ff:ff:ff", "stdout_lines": ["48: t3ns1if@t3s1if: <BROADCAST,MULTICAST> mtu 1500 qdisc noop state DOWN mode DEFAULT group default qlen 1000", "    link/ether 36:e8:d3:1e:c2:db brd ff:ff:ff:ff:ff:ff"]}
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.22.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.2.22.1', u'bridge_name': u't3br2', u'dns': [{u'dnsif': u't3s2_dnsif', u'dhcp_start': u'2.2.2.133', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.128/24', u'net_mask': u'255.255.255.0', u'brif': u't3s2_dnsbrif'}], u'ns_name': u't3ns2', u'bridge_ip': u'2.2.2.1', u'vms': [{u'mem': 2, u'name': u't3_VM6', u'vcpu': 4, u'disk': u'10G', u'brif': u't3br2if1', u'vmif': u't3VM6if1'}], u'vxlan': [{u'local_ip': u'10.2.22.2', u'dsport': 4789, u'dev': u't3s2if', u'tenant_route_ip': u'192.168.131.2', u'remote_route': u'10.1.22.0/24', u'subnet_route': u'10.2.22.0/24', u'v_name': u'vxlan_t3s2', u'id': 42, u'remote_ip': u'10.1.22.2'}]}, {u'tenant_sub_ip': u'10.2.22.2/24', u'tenant_ns_ip': u'10.2.22.1/24', u'tenant_ns_if': u't3ns2if', u'tenant_sub_if': u't3s2if', u'tenant_ns_name': u't3'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip link show \"t3ns2if\" ; if [ $? -ne 0 ] ; then ip link add \"t3ns2if\" type veth peer name \"t3s2if\" ; fi\n", "delta": "0:00:00.011281", "end": "2019-11-17 10:35:14.677094", "item": [{"bridge_ip": "2.2.2.1", "bridge_name": "t3br2", "default_route_ip": "10.2.22.1", "dns": [{"brif": "t3s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.133", "dnsif": "t3s2_dnsif", "dnsif_ip": "2.2.2.128/24", "net_mask": "255.255.255.0"}], "ns_name": "t3ns2", "route": [{"if": "p1", "ip": "10.2.22.1/24", "ns_if": "t3if", "ns_name": "t3"}], "vms": [{"brif": "t3br2if1", "disk": "10G", "mem": 2, "name": "t3_VM6", "vcpu": 4, "vmif": "t3VM6if1"}], "vxlan": [{"dev": "t3s2if", "dsport": 4789, "id": 42, "local_ip": "10.2.22.2", "remote_ip": "10.1.22.2", "remote_route": "10.1.22.0/24", "subnet_route": "10.2.22.0/24", "tenant_route_ip": "192.168.131.2", "v_name": "vxlan_t3s2"}]}, {"tenant_ns_if": "t3ns2if", "tenant_ns_ip": "10.2.22.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s2if", "tenant_sub_ip": "10.2.22.2/24"}], "rc": 0, "start": "2019-11-17 10:35:14.665813", "stderr": "Device \"t3ns2if\" does not exist.", "stderr_lines": ["Device \"t3ns2if\" does not exist."], "stdout": "", "stdout_lines": []}

TASK [Attach Namespace VETH Pairs] **************************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.21.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.2.21.1', u'bridge_name': u't3br1', u'dns': [{u'dnsif': u't3s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't3s1_dnsbrif'}], u'ns_name': u't3ns1', u'bridge_ip': u'1.1.1.1', u'vms': [{u'mem': 2, u'name': u't3_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't3br1if1', u'vmif': u't3VM4if1'}, {u'mem': 2, u'name': u't3_VM5', u'vcpu': 4, u'disk': u'10G', u'brif': u't3br1if2', u'vmif': u't3VM5if1'}], u'vxlan': [{u'local_ip': u'10.2.21.2', u'dsport': 4789, u'dev': u't3s1if', u'tenant_route_ip': u'192.168.131.2', u'remote_route': u'10.1.21.0/24', u'subnet_route': u'10.2.21.0/24', u'v_name': u'vxlan_t3s1', u'id': 42, u'remote_ip': u'10.1.21.2'}]}, {u'tenant_sub_ip': u'10.2.21.2/24', u'tenant_ns_ip': u'10.2.21.1/24', u'tenant_ns_if': u't3ns1if', u'tenant_sub_if': u't3s1if', u'tenant_ns_name': u't3'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t3\" ip link show \"t3ns1if\" ; if [ $? -ne 0 ] ; then ip link set \"t3ns1if\" netns \"t3\" ; fi\nip netns exec \"t3ns1\" ip link show \"t3s1if\" ; if [ $? -ne 0 ] ; then ip link set \"t3s1if\" netns \"t3ns1\" ; fi\n", "delta": "0:00:00.072175", "end": "2019-11-17 10:35:15.144431", "item": [{"bridge_ip": "1.1.1.1", "bridge_name": "t3br1", "default_route_ip": "10.2.21.1", "dns": [{"brif": "t3s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t3s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "ns_name": "t3ns1", "route": [{"if": "p1", "ip": "10.2.21.1/24", "ns_if": "t3if", "ns_name": "t3"}], "vms": [{"brif": "t3br1if1", "disk": "10G", "mem": 2, "name": "t3_VM4", "vcpu": 4, "vmif": "t3VM4if1"}, {"brif": "t3br1if2", "disk": "10G", "mem": 2, "name": "t3_VM5", "vcpu": 4, "vmif": "t3VM5if1"}], "vxlan": [{"dev": "t3s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.21.2", "remote_ip": "10.1.21.2", "remote_route": "10.1.21.0/24", "subnet_route": "10.2.21.0/24", "tenant_route_ip": "192.168.131.2", "v_name": "vxlan_t3s1"}]}, {"tenant_ns_if": "t3ns1if", "tenant_ns_ip": "10.2.21.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s1if", "tenant_sub_ip": "10.2.21.2/24"}], "rc": 0, "start": "2019-11-17 10:35:15.072256", "stderr": "", "stderr_lines": [], "stdout": "42: t3ns1if@if41: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP mode DEFAULT group default qlen 1000\n    link/ether 4a:f8:5c:b8:80:b0 brd ff:ff:ff:ff:ff:ff link-netnsid 2\n41: t3s1if@if42: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP mode DEFAULT group default qlen 1000\n    link/ether 66:c2:d3:61:a2:eb brd ff:ff:ff:ff:ff:ff link-netnsid 0", "stdout_lines": ["42: t3ns1if@if41: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP mode DEFAULT group default qlen 1000", "    link/ether 4a:f8:5c:b8:80:b0 brd ff:ff:ff:ff:ff:ff link-netnsid 2", "41: t3s1if@if42: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP mode DEFAULT group default qlen 1000", "    link/ether 66:c2:d3:61:a2:eb brd ff:ff:ff:ff:ff:ff link-netnsid 0"]}
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.22.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.2.22.1', u'bridge_name': u't3br2', u'dns': [{u'dnsif': u't3s2_dnsif', u'dhcp_start': u'2.2.2.133', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.128/24', u'net_mask': u'255.255.255.0', u'brif': u't3s2_dnsbrif'}], u'ns_name': u't3ns2', u'bridge_ip': u'2.2.2.1', u'vms': [{u'mem': 2, u'name': u't3_VM6', u'vcpu': 4, u'disk': u'10G', u'brif': u't3br2if1', u'vmif': u't3VM6if1'}], u'vxlan': [{u'local_ip': u'10.2.22.2', u'dsport': 4789, u'dev': u't3s2if', u'tenant_route_ip': u'192.168.131.2', u'remote_route': u'10.1.22.0/24', u'subnet_route': u'10.2.22.0/24', u'v_name': u'vxlan_t3s2', u'id': 42, u'remote_ip': u'10.1.22.2'}]}, {u'tenant_sub_ip': u'10.2.22.2/24', u'tenant_ns_ip': u'10.2.22.1/24', u'tenant_ns_if': u't3ns2if', u'tenant_sub_if': u't3s2if', u'tenant_ns_name': u't3'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t3\" ip link show \"t3ns2if\" ; if [ $? -ne 0 ] ; then ip link set \"t3ns2if\" netns \"t3\" ; fi\nip netns exec \"t3ns2\" ip link show \"t3s2if\" ; if [ $? -ne 0 ] ; then ip link set \"t3s2if\" netns \"t3ns2\" ; fi\n", "delta": "0:00:00.122149", "end": "2019-11-17 10:35:15.571454", "item": [{"bridge_ip": "2.2.2.1", "bridge_name": "t3br2", "default_route_ip": "10.2.22.1", "dns": [{"brif": "t3s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.133", "dnsif": "t3s2_dnsif", "dnsif_ip": "2.2.2.128/24", "net_mask": "255.255.255.0"}], "ns_name": "t3ns2", "route": [{"if": "p1", "ip": "10.2.22.1/24", "ns_if": "t3if", "ns_name": "t3"}], "vms": [{"brif": "t3br2if1", "disk": "10G", "mem": 2, "name": "t3_VM6", "vcpu": 4, "vmif": "t3VM6if1"}], "vxlan": [{"dev": "t3s2if", "dsport": 4789, "id": 42, "local_ip": "10.2.22.2", "remote_ip": "10.1.22.2", "remote_route": "10.1.22.0/24", "subnet_route": "10.2.22.0/24", "tenant_route_ip": "192.168.131.2", "v_name": "vxlan_t3s2"}]}, {"tenant_ns_if": "t3ns2if", "tenant_ns_ip": "10.2.22.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s2if", "tenant_sub_ip": "10.2.22.2/24"}], "rc": 0, "start": "2019-11-17 10:35:15.449305", "stderr": "Device \"t3ns2if\" does not exist.\nDevice \"t3s2if\" does not exist.", "stderr_lines": ["Device \"t3ns2if\" does not exist.", "Device \"t3s2if\" does not exist."], "stdout": "", "stdout_lines": []}

TASK [Set Namespace VETH Pairs UP] **************************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.21.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.2.21.1', u'bridge_name': u't3br1', u'dns': [{u'dnsif': u't3s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't3s1_dnsbrif'}], u'ns_name': u't3ns1', u'bridge_ip': u'1.1.1.1', u'vms': [{u'mem': 2, u'name': u't3_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't3br1if1', u'vmif': u't3VM4if1'}, {u'mem': 2, u'name': u't3_VM5', u'vcpu': 4, u'disk': u'10G', u'brif': u't3br1if2', u'vmif': u't3VM5if1'}], u'vxlan': [{u'local_ip': u'10.2.21.2', u'dsport': 4789, u'dev': u't3s1if', u'tenant_route_ip': u'192.168.131.2', u'remote_route': u'10.1.21.0/24', u'subnet_route': u'10.2.21.0/24', u'v_name': u'vxlan_t3s1', u'id': 42, u'remote_ip': u'10.1.21.2'}]}, {u'tenant_sub_ip': u'10.2.21.2/24', u'tenant_ns_ip': u'10.2.21.1/24', u'tenant_ns_if': u't3ns1if', u'tenant_sub_if': u't3s1if', u'tenant_ns_name': u't3'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t3\" ip link set dev \"t3ns1if\" up\nip netns exec \"t3ns1\" ip link set dev \"t3s1if\" up\n", "delta": "0:00:00.083398", "end": "2019-11-17 10:35:16.036549", "item": [{"bridge_ip": "1.1.1.1", "bridge_name": "t3br1", "default_route_ip": "10.2.21.1", "dns": [{"brif": "t3s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t3s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "ns_name": "t3ns1", "route": [{"if": "p1", "ip": "10.2.21.1/24", "ns_if": "t3if", "ns_name": "t3"}], "vms": [{"brif": "t3br1if1", "disk": "10G", "mem": 2, "name": "t3_VM4", "vcpu": 4, "vmif": "t3VM4if1"}, {"brif": "t3br1if2", "disk": "10G", "mem": 2, "name": "t3_VM5", "vcpu": 4, "vmif": "t3VM5if1"}], "vxlan": [{"dev": "t3s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.21.2", "remote_ip": "10.1.21.2", "remote_route": "10.1.21.0/24", "subnet_route": "10.2.21.0/24", "tenant_route_ip": "192.168.131.2", "v_name": "vxlan_t3s1"}]}, {"tenant_ns_if": "t3ns1if", "tenant_ns_ip": "10.2.21.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s1if", "tenant_sub_ip": "10.2.21.2/24"}], "rc": 0, "start": "2019-11-17 10:35:15.953151", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.22.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.2.22.1', u'bridge_name': u't3br2', u'dns': [{u'dnsif': u't3s2_dnsif', u'dhcp_start': u'2.2.2.133', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.128/24', u'net_mask': u'255.255.255.0', u'brif': u't3s2_dnsbrif'}], u'ns_name': u't3ns2', u'bridge_ip': u'2.2.2.1', u'vms': [{u'mem': 2, u'name': u't3_VM6', u'vcpu': 4, u'disk': u'10G', u'brif': u't3br2if1', u'vmif': u't3VM6if1'}], u'vxlan': [{u'local_ip': u'10.2.22.2', u'dsport': 4789, u'dev': u't3s2if', u'tenant_route_ip': u'192.168.131.2', u'remote_route': u'10.1.22.0/24', u'subnet_route': u'10.2.22.0/24', u'v_name': u'vxlan_t3s2', u'id': 42, u'remote_ip': u'10.1.22.2'}]}, {u'tenant_sub_ip': u'10.2.22.2/24', u'tenant_ns_ip': u'10.2.22.1/24', u'tenant_ns_if': u't3ns2if', u'tenant_sub_if': u't3s2if', u'tenant_ns_name': u't3'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t3\" ip link set dev \"t3ns2if\" up\nip netns exec \"t3ns2\" ip link set dev \"t3s2if\" up\n", "delta": "0:00:00.073988", "end": "2019-11-17 10:35:16.440971", "item": [{"bridge_ip": "2.2.2.1", "bridge_name": "t3br2", "default_route_ip": "10.2.22.1", "dns": [{"brif": "t3s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.133", "dnsif": "t3s2_dnsif", "dnsif_ip": "2.2.2.128/24", "net_mask": "255.255.255.0"}], "ns_name": "t3ns2", "route": [{"if": "p1", "ip": "10.2.22.1/24", "ns_if": "t3if", "ns_name": "t3"}], "vms": [{"brif": "t3br2if1", "disk": "10G", "mem": 2, "name": "t3_VM6", "vcpu": 4, "vmif": "t3VM6if1"}], "vxlan": [{"dev": "t3s2if", "dsport": 4789, "id": 42, "local_ip": "10.2.22.2", "remote_ip": "10.1.22.2", "remote_route": "10.1.22.0/24", "subnet_route": "10.2.22.0/24", "tenant_route_ip": "192.168.131.2", "v_name": "vxlan_t3s2"}]}, {"tenant_ns_if": "t3ns2if", "tenant_ns_ip": "10.2.22.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s2if", "tenant_sub_ip": "10.2.22.2/24"}], "rc": 0, "start": "2019-11-17 10:35:16.366983", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Add IP addresses to Namespace VETH Pairs] *************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.21.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.2.21.1', u'bridge_name': u't3br1', u'dns': [{u'dnsif': u't3s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't3s1_dnsbrif'}], u'ns_name': u't3ns1', u'bridge_ip': u'1.1.1.1', u'vms': [{u'mem': 2, u'name': u't3_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't3br1if1', u'vmif': u't3VM4if1'}, {u'mem': 2, u'name': u't3_VM5', u'vcpu': 4, u'disk': u'10G', u'brif': u't3br1if2', u'vmif': u't3VM5if1'}], u'vxlan': [{u'local_ip': u'10.2.21.2', u'dsport': 4789, u'dev': u't3s1if', u'tenant_route_ip': u'192.168.131.2', u'remote_route': u'10.1.21.0/24', u'subnet_route': u'10.2.21.0/24', u'v_name': u'vxlan_t3s1', u'id': 42, u'remote_ip': u'10.1.21.2'}]}, {u'tenant_sub_ip': u'10.2.21.2/24', u'tenant_ns_ip': u'10.2.21.1/24', u'tenant_ns_if': u't3ns1if', u'tenant_sub_if': u't3s1if', u'tenant_ns_name': u't3'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t3ns1\" ip addr show \"t3s1if\" | awk 'FNR==3{ print $2 }' | grep -w '^10.2.21.2/24' ; if [ $? -ne 0 ] ; then ip netns exec \"t3ns1\" ip addr add \"10.2.21.2/24\" dev \"t3s1if\" ; fi\n\nip netns exec \"t3\" ip addr show \"t3ns1if\" | awk 'FNR==3{ print $2 }' | grep -w '^10.2.21.1/24' ; if [ $? -ne 0 ] ; then ip netns exec \"t3\" ip addr add \"10.2.21.1/24\" dev \"t3ns1if\" ; fi\n", "delta": "0:00:00.080285", "end": "2019-11-17 10:35:16.912607", "item": [{"bridge_ip": "1.1.1.1", "bridge_name": "t3br1", "default_route_ip": "10.2.21.1", "dns": [{"brif": "t3s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t3s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "ns_name": "t3ns1", "route": [{"if": "p1", "ip": "10.2.21.1/24", "ns_if": "t3if", "ns_name": "t3"}], "vms": [{"brif": "t3br1if1", "disk": "10G", "mem": 2, "name": "t3_VM4", "vcpu": 4, "vmif": "t3VM4if1"}, {"brif": "t3br1if2", "disk": "10G", "mem": 2, "name": "t3_VM5", "vcpu": 4, "vmif": "t3VM5if1"}], "vxlan": [{"dev": "t3s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.21.2", "remote_ip": "10.1.21.2", "remote_route": "10.1.21.0/24", "subnet_route": "10.2.21.0/24", "tenant_route_ip": "192.168.131.2", "v_name": "vxlan_t3s1"}]}, {"tenant_ns_if": "t3ns1if", "tenant_ns_ip": "10.2.21.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s1if", "tenant_sub_ip": "10.2.21.2/24"}], "rc": 0, "start": "2019-11-17 10:35:16.832322", "stderr": "", "stderr_lines": [], "stdout": "10.2.21.2/24\n10.2.21.1/24", "stdout_lines": ["10.2.21.2/24", "10.2.21.1/24"]}
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.22.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.2.22.1', u'bridge_name': u't3br2', u'dns': [{u'dnsif': u't3s2_dnsif', u'dhcp_start': u'2.2.2.133', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.128/24', u'net_mask': u'255.255.255.0', u'brif': u't3s2_dnsbrif'}], u'ns_name': u't3ns2', u'bridge_ip': u'2.2.2.1', u'vms': [{u'mem': 2, u'name': u't3_VM6', u'vcpu': 4, u'disk': u'10G', u'brif': u't3br2if1', u'vmif': u't3VM6if1'}], u'vxlan': [{u'local_ip': u'10.2.22.2', u'dsport': 4789, u'dev': u't3s2if', u'tenant_route_ip': u'192.168.131.2', u'remote_route': u'10.1.22.0/24', u'subnet_route': u'10.2.22.0/24', u'v_name': u'vxlan_t3s2', u'id': 42, u'remote_ip': u'10.1.22.2'}]}, {u'tenant_sub_ip': u'10.2.22.2/24', u'tenant_ns_ip': u'10.2.22.1/24', u'tenant_ns_if': u't3ns2if', u'tenant_sub_if': u't3s2if', u'tenant_ns_name': u't3'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t3ns2\" ip addr show \"t3s2if\" | awk 'FNR==3{ print $2 }' | grep -w '^10.2.22.2/24' ; if [ $? -ne 0 ] ; then ip netns exec \"t3ns2\" ip addr add \"10.2.22.2/24\" dev \"t3s2if\" ; fi\n\nip netns exec \"t3\" ip addr show \"t3ns2if\" | awk 'FNR==3{ print $2 }' | grep -w '^10.2.22.1/24' ; if [ $? -ne 0 ] ; then ip netns exec \"t3\" ip addr add \"10.2.22.1/24\" dev \"t3ns2if\" ; fi\n", "delta": "0:00:00.154048", "end": "2019-11-17 10:35:17.396355", "item": [{"bridge_ip": "2.2.2.1", "bridge_name": "t3br2", "default_route_ip": "10.2.22.1", "dns": [{"brif": "t3s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.133", "dnsif": "t3s2_dnsif", "dnsif_ip": "2.2.2.128/24", "net_mask": "255.255.255.0"}], "ns_name": "t3ns2", "route": [{"if": "p1", "ip": "10.2.22.1/24", "ns_if": "t3if", "ns_name": "t3"}], "vms": [{"brif": "t3br2if1", "disk": "10G", "mem": 2, "name": "t3_VM6", "vcpu": 4, "vmif": "t3VM6if1"}], "vxlan": [{"dev": "t3s2if", "dsport": 4789, "id": 42, "local_ip": "10.2.22.2", "remote_ip": "10.1.22.2", "remote_route": "10.1.22.0/24", "subnet_route": "10.2.22.0/24", "tenant_route_ip": "192.168.131.2", "v_name": "vxlan_t3s2"}]}, {"tenant_ns_if": "t3ns2if", "tenant_ns_ip": "10.2.22.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s2if", "tenant_sub_ip": "10.2.22.2/24"}], "rc": 0, "start": "2019-11-17 10:35:17.242307", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Add IP Route to Tenant] *******************************************************************************************************************************
changed: [99.99.99.2] => (item={u'default_route_ip': u'192.168.131.1', u'name': u't3', u'pns_ip': u'192.168.131.1/24', u'tenant_if': u't3if', u'tenant_ip': u'192.168.131.2/24', u'pns_if': u't3pns_if'}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t3\" ip route show default | grep -w '[d]efault via 192.168.131.1' ; if [ $? -ne 0 ] ; then ip netns exec \"t3\" ip route add default via \"192.168.131.1\" ; fi\n", "delta": "0:00:00.033286", "end": "2019-11-17 10:35:17.820448", "item": {"default_route_ip": "192.168.131.1", "name": "t3", "pns_if": "t3pns_if", "pns_ip": "192.168.131.1/24", "tenant_if": "t3if", "tenant_ip": "192.168.131.2/24"}, "rc": 0, "start": "2019-11-17 10:35:17.787162", "stderr": "", "stderr_lines": [], "stdout": "default via 192.168.131.1 dev t3if ", "stdout_lines": ["default via 192.168.131.1 dev t3if "]}

TASK [Add IP Route to Tenant Subnet] ************************************************************************************************************************
changed: [99.99.99.2] => (item={u'route': [{u'ip': u'10.2.21.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.2.21.1', u'bridge_name': u't3br1', u'dns': [{u'dnsif': u't3s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't3s1_dnsbrif'}], u'ns_name': u't3ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.21.2/24', u'tenant_ns_ip': u'10.2.21.1/24', u'tenant_ns_if': u't3ns1if', u'tenant_ns_name': u't3', u'tenant_sub_if': u't3s1if'}], u'bridge_ip': u'1.1.1.1', u'vms': [{u'mem': 2, u'name': u't3_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't3br1if1', u'vmif': u't3VM4if1'}, {u'mem': 2, u'name': u't3_VM5', u'vcpu': 4, u'disk': u'10G', u'brif': u't3br1if2', u'vmif': u't3VM5if1'}], u'vxlan': [{u'local_ip': u'10.2.21.2', u'tenant_route_ip': u'192.168.131.2', u'dsport': 4789, u'dev': u't3s1if', u'subnet_route': u'10.2.21.0/24', u'remote_route': u'10.1.21.0/24', u'v_name': u'vxlan_t3s1', u'id': 42, u'remote_ip': u'10.1.21.2'}]}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t3ns1\" ip route show default | grep -w '[d]efault via 10.2.21.1' ; if [ $? -ne 0 ] ; then ip netns exec \"t3ns1\" ip route add default via \"10.2.21.1\" ; fi\n", "delta": "0:00:00.034019", "end": "2019-11-17 10:35:18.228477", "item": {"bridge_ip": "1.1.1.1", "bridge_name": "t3br1", "default_route_ip": "10.2.21.1", "dns": [{"brif": "t3s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t3s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "ns_name": "t3ns1", "route": [{"if": "p1", "ip": "10.2.21.1/24", "ns_if": "t3if", "ns_name": "t3"}], "tenant_ns": [{"tenant_ns_if": "t3ns1if", "tenant_ns_ip": "10.2.21.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s1if", "tenant_sub_ip": "10.2.21.2/24"}], "vms": [{"brif": "t3br1if1", "disk": "10G", "mem": 2, "name": "t3_VM4", "vcpu": 4, "vmif": "t3VM4if1"}, {"brif": "t3br1if2", "disk": "10G", "mem": 2, "name": "t3_VM5", "vcpu": 4, "vmif": "t3VM5if1"}], "vxlan": [{"dev": "t3s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.21.2", "remote_ip": "10.1.21.2", "remote_route": "10.1.21.0/24", "subnet_route": "10.2.21.0/24", "tenant_route_ip": "192.168.131.2", "v_name": "vxlan_t3s1"}]}, "rc": 0, "start": "2019-11-17 10:35:18.194458", "stderr": "", "stderr_lines": [], "stdout": "default via 10.2.21.1 dev t3s1if ", "stdout_lines": ["default via 10.2.21.1 dev t3s1if "]}
changed: [99.99.99.2] => (item={u'route': [{u'ip': u'10.2.22.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.2.22.1', u'bridge_name': u't3br2', u'dns': [{u'dnsif': u't3s2_dnsif', u'dhcp_start': u'2.2.2.133', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.128/24', u'net_mask': u'255.255.255.0', u'brif': u't3s2_dnsbrif'}], u'ns_name': u't3ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.22.2/24', u'tenant_ns_ip': u'10.2.22.1/24', u'tenant_ns_if': u't3ns2if', u'tenant_ns_name': u't3', u'tenant_sub_if': u't3s2if'}], u'bridge_ip': u'2.2.2.1', u'vms': [{u'mem': 2, u'name': u't3_VM6', u'vcpu': 4, u'disk': u'10G', u'brif': u't3br2if1', u'vmif': u't3VM6if1'}], u'vxlan': [{u'local_ip': u'10.2.22.2', u'tenant_route_ip': u'192.168.131.2', u'dsport': 4789, u'dev': u't3s2if', u'subnet_route': u'10.2.22.0/24', u'remote_route': u'10.1.22.0/24', u'v_name': u'vxlan_t3s2', u'id': 42, u'remote_ip': u'10.1.22.2'}]}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t3ns2\" ip route show default | grep -w '[d]efault via 10.2.22.1' ; if [ $? -ne 0 ] ; then ip netns exec \"t3ns2\" ip route add default via \"10.2.22.1\" ; fi\n", "delta": "0:00:00.098551", "end": "2019-11-17 10:35:18.632355", "item": {"bridge_ip": "2.2.2.1", "bridge_name": "t3br2", "default_route_ip": "10.2.22.1", "dns": [{"brif": "t3s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.133", "dnsif": "t3s2_dnsif", "dnsif_ip": "2.2.2.128/24", "net_mask": "255.255.255.0"}], "ns_name": "t3ns2", "route": [{"if": "p1", "ip": "10.2.22.1/24", "ns_if": "t3if", "ns_name": "t3"}], "tenant_ns": [{"tenant_ns_if": "t3ns2if", "tenant_ns_ip": "10.2.22.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s2if", "tenant_sub_ip": "10.2.22.2/24"}], "vms": [{"brif": "t3br2if1", "disk": "10G", "mem": 2, "name": "t3_VM6", "vcpu": 4, "vmif": "t3VM6if1"}], "vxlan": [{"dev": "t3s2if", "dsport": 4789, "id": 42, "local_ip": "10.2.22.2", "remote_ip": "10.1.22.2", "remote_route": "10.1.22.0/24", "subnet_route": "10.2.22.0/24", "tenant_route_ip": "192.168.131.2", "v_name": "vxlan_t3s2"}]}, "rc": 0, "start": "2019-11-17 10:35:18.533804", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Create bridge inside namespace] ***********************************************************************************************************************
changed: [99.99.99.2] => (item={u'route': [{u'ip': u'10.2.21.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.2.21.1', u'bridge_name': u't3br1', u'dns': [{u'dnsif': u't3s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't3s1_dnsbrif'}], u'ns_name': u't3ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.21.2/24', u'tenant_ns_ip': u'10.2.21.1/24', u'tenant_ns_if': u't3ns1if', u'tenant_ns_name': u't3', u'tenant_sub_if': u't3s1if'}], u'bridge_ip': u'1.1.1.1', u'vms': [{u'mem': 2, u'name': u't3_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't3br1if1', u'vmif': u't3VM4if1'}, {u'mem': 2, u'name': u't3_VM5', u'vcpu': 4, u'disk': u'10G', u'brif': u't3br1if2', u'vmif': u't3VM5if1'}], u'vxlan': [{u'local_ip': u'10.2.21.2', u'tenant_route_ip': u'192.168.131.2', u'dsport': 4789, u'dev': u't3s1if', u'subnet_route': u'10.2.21.0/24', u'remote_route': u'10.1.21.0/24', u'v_name': u'vxlan_t3s1', u'id': 42, u'remote_ip': u'10.1.21.2'}]}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t3ns1\" brctl show | grep -w '^t3br1'; if [ $? -ne 0 ] ; then ip netns exec \"t3ns1\" brctl addbr \"t3br1\" ; fi\nip netns exec \"t3ns1\" ip link set dev \"t3br1\" up\n", "delta": "0:00:00.074056", "end": "2019-11-17 10:35:19.084645", "item": {"bridge_ip": "1.1.1.1", "bridge_name": "t3br1", "default_route_ip": "10.2.21.1", "dns": [{"brif": "t3s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t3s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "ns_name": "t3ns1", "route": [{"if": "p1", "ip": "10.2.21.1/24", "ns_if": "t3if", "ns_name": "t3"}], "tenant_ns": [{"tenant_ns_if": "t3ns1if", "tenant_ns_ip": "10.2.21.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s1if", "tenant_sub_ip": "10.2.21.2/24"}], "vms": [{"brif": "t3br1if1", "disk": "10G", "mem": 2, "name": "t3_VM4", "vcpu": 4, "vmif": "t3VM4if1"}, {"brif": "t3br1if2", "disk": "10G", "mem": 2, "name": "t3_VM5", "vcpu": 4, "vmif": "t3VM5if1"}], "vxlan": [{"dev": "t3s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.21.2", "remote_ip": "10.1.21.2", "remote_route": "10.1.21.0/24", "subnet_route": "10.2.21.0/24", "tenant_route_ip": "192.168.131.2", "v_name": "vxlan_t3s1"}]}, "rc": 0, "start": "2019-11-17 10:35:19.010589", "stderr": "", "stderr_lines": [], "stdout": "t3br1\t\t8000.6ea2f3411004\tno\t\tt3br1if1", "stdout_lines": ["t3br1\t\t8000.6ea2f3411004\tno\t\tt3br1if1"]}
changed: [99.99.99.2] => (item={u'route': [{u'ip': u'10.2.22.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.2.22.1', u'bridge_name': u't3br2', u'dns': [{u'dnsif': u't3s2_dnsif', u'dhcp_start': u'2.2.2.133', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.128/24', u'net_mask': u'255.255.255.0', u'brif': u't3s2_dnsbrif'}], u'ns_name': u't3ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.22.2/24', u'tenant_ns_ip': u'10.2.22.1/24', u'tenant_ns_if': u't3ns2if', u'tenant_ns_name': u't3', u'tenant_sub_if': u't3s2if'}], u'bridge_ip': u'2.2.2.1', u'vms': [{u'mem': 2, u'name': u't3_VM6', u'vcpu': 4, u'disk': u'10G', u'brif': u't3br2if1', u'vmif': u't3VM6if1'}], u'vxlan': [{u'local_ip': u'10.2.22.2', u'tenant_route_ip': u'192.168.131.2', u'dsport': 4789, u'dev': u't3s2if', u'subnet_route': u'10.2.22.0/24', u'remote_route': u'10.1.22.0/24', u'v_name': u'vxlan_t3s2', u'id': 42, u'remote_ip': u'10.1.22.2'}]}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t3ns2\" brctl show | grep -w '^t3br2'; if [ $? -ne 0 ] ; then ip netns exec \"t3ns2\" brctl addbr \"t3br2\" ; fi\nip netns exec \"t3ns2\" ip link set dev \"t3br2\" up\n", "delta": "0:00:00.104360", "end": "2019-11-17 10:35:19.524343", "item": {"bridge_ip": "2.2.2.1", "bridge_name": "t3br2", "default_route_ip": "10.2.22.1", "dns": [{"brif": "t3s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.133", "dnsif": "t3s2_dnsif", "dnsif_ip": "2.2.2.128/24", "net_mask": "255.255.255.0"}], "ns_name": "t3ns2", "route": [{"if": "p1", "ip": "10.2.22.1/24", "ns_if": "t3if", "ns_name": "t3"}], "tenant_ns": [{"tenant_ns_if": "t3ns2if", "tenant_ns_ip": "10.2.22.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s2if", "tenant_sub_ip": "10.2.22.2/24"}], "vms": [{"brif": "t3br2if1", "disk": "10G", "mem": 2, "name": "t3_VM6", "vcpu": 4, "vmif": "t3VM6if1"}], "vxlan": [{"dev": "t3s2if", "dsport": 4789, "id": 42, "local_ip": "10.2.22.2", "remote_ip": "10.1.22.2", "remote_route": "10.1.22.0/24", "subnet_route": "10.2.22.0/24", "tenant_route_ip": "192.168.131.2", "v_name": "vxlan_t3s2"}]}, "rc": 0, "start": "2019-11-17 10:35:19.419983", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Create DNS VETH Pair] *********************************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.21.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.2.21.1', u'bridge_name': u't3br1', u'ns_name': u't3ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.21.2/24', u'tenant_ns_ip': u'10.2.21.1/24', u'tenant_ns_if': u't3ns1if', u'tenant_sub_if': u't3s1if', u'tenant_ns_name': u't3'}], u'bridge_ip': u'1.1.1.1', u'vms': [{u'mem': 2, u'name': u't3_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't3br1if1', u'vmif': u't3VM4if1'}, {u'mem': 2, u'name': u't3_VM5', u'vcpu': 4, u'disk': u'10G', u'brif': u't3br1if2', u'vmif': u't3VM5if1'}], u'vxlan': [{u'local_ip': u'10.2.21.2', u'dsport': 4789, u'dev': u't3s1if', u'tenant_route_ip': u'192.168.131.2', u'remote_route': u'10.1.21.0/24', u'subnet_route': u'10.2.21.0/24', u'v_name': u'vxlan_t3s1', u'id': 42, u'remote_ip': u'10.1.21.2'}]}, {u'dnsif': u't3s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't3s1_dnsbrif'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t3ns1\" ip link show \"t3s1_dnsbrif\" ; if [ $? -ne 0 ] ; then ip netns exec \"t3ns1\" ip link add \"t3s1_dnsbrif\" type veth peer name \"t3s1_dnsif\" ; fi\nip netns exec \"t3ns1\" ip link set dev \"t3s1_dnsbrif\" up\nip netns exec \"t3ns1\" ip link set dev \"t3s1_dnsif\" up\n", "delta": "0:00:00.122148", "end": "2019-11-17 10:35:20.072416", "item": [{"bridge_ip": "1.1.1.1", "bridge_name": "t3br1", "default_route_ip": "10.2.21.1", "ns_name": "t3ns1", "route": [{"if": "p1", "ip": "10.2.21.1/24", "ns_if": "t3if", "ns_name": "t3"}], "tenant_ns": [{"tenant_ns_if": "t3ns1if", "tenant_ns_ip": "10.2.21.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s1if", "tenant_sub_ip": "10.2.21.2/24"}], "vms": [{"brif": "t3br1if1", "disk": "10G", "mem": 2, "name": "t3_VM4", "vcpu": 4, "vmif": "t3VM4if1"}, {"brif": "t3br1if2", "disk": "10G", "mem": 2, "name": "t3_VM5", "vcpu": 4, "vmif": "t3VM5if1"}], "vxlan": [{"dev": "t3s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.21.2", "remote_ip": "10.1.21.2", "remote_route": "10.1.21.0/24", "subnet_route": "10.2.21.0/24", "tenant_route_ip": "192.168.131.2", "v_name": "vxlan_t3s1"}]}, {"brif": "t3s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t3s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "rc": 0, "start": "2019-11-17 10:35:19.950268", "stderr": "", "stderr_lines": [], "stdout": "4: t3s1_dnsbrif@t3s1_dnsif: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue master t3br1 state UP mode DEFAULT group default qlen 1000\n    link/ether de:32:48:ca:2e:9d brd ff:ff:ff:ff:ff:ff", "stdout_lines": ["4: t3s1_dnsbrif@t3s1_dnsif: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue master t3br1 state UP mode DEFAULT group default qlen 1000", "    link/ether de:32:48:ca:2e:9d brd ff:ff:ff:ff:ff:ff"]}
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.22.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.2.22.1', u'bridge_name': u't3br2', u'ns_name': u't3ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.22.2/24', u'tenant_ns_ip': u'10.2.22.1/24', u'tenant_ns_if': u't3ns2if', u'tenant_sub_if': u't3s2if', u'tenant_ns_name': u't3'}], u'bridge_ip': u'2.2.2.1', u'vms': [{u'mem': 2, u'name': u't3_VM6', u'vcpu': 4, u'disk': u'10G', u'brif': u't3br2if1', u'vmif': u't3VM6if1'}], u'vxlan': [{u'local_ip': u'10.2.22.2', u'dsport': 4789, u'dev': u't3s2if', u'tenant_route_ip': u'192.168.131.2', u'remote_route': u'10.1.22.0/24', u'subnet_route': u'10.2.22.0/24', u'v_name': u'vxlan_t3s2', u'id': 42, u'remote_ip': u'10.1.22.2'}]}, {u'dnsif': u't3s2_dnsif', u'dhcp_start': u'2.2.2.133', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.128/24', u'net_mask': u'255.255.255.0', u'brif': u't3s2_dnsbrif'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t3ns2\" ip link show \"t3s2_dnsbrif\" ; if [ $? -ne 0 ] ; then ip netns exec \"t3ns2\" ip link add \"t3s2_dnsbrif\" type veth peer name \"t3s2_dnsif\" ; fi\nip netns exec \"t3ns2\" ip link set dev \"t3s2_dnsbrif\" up\nip netns exec \"t3ns2\" ip link set dev \"t3s2_dnsif\" up\n", "delta": "0:00:00.134030", "end": "2019-11-17 10:35:20.520378", "item": [{"bridge_ip": "2.2.2.1", "bridge_name": "t3br2", "default_route_ip": "10.2.22.1", "ns_name": "t3ns2", "route": [{"if": "p1", "ip": "10.2.22.1/24", "ns_if": "t3if", "ns_name": "t3"}], "tenant_ns": [{"tenant_ns_if": "t3ns2if", "tenant_ns_ip": "10.2.22.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s2if", "tenant_sub_ip": "10.2.22.2/24"}], "vms": [{"brif": "t3br2if1", "disk": "10G", "mem": 2, "name": "t3_VM6", "vcpu": 4, "vmif": "t3VM6if1"}], "vxlan": [{"dev": "t3s2if", "dsport": 4789, "id": 42, "local_ip": "10.2.22.2", "remote_ip": "10.1.22.2", "remote_route": "10.1.22.0/24", "subnet_route": "10.2.22.0/24", "tenant_route_ip": "192.168.131.2", "v_name": "vxlan_t3s2"}]}, {"brif": "t3s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.133", "dnsif": "t3s2_dnsif", "dnsif_ip": "2.2.2.128/24", "net_mask": "255.255.255.0"}], "rc": 0, "start": "2019-11-17 10:35:20.386348", "stderr": "Device \"t3s2_dnsbrif\" does not exist.", "stderr_lines": ["Device \"t3s2_dnsbrif\" does not exist."], "stdout": "", "stdout_lines": []}

TASK [Attach DNS VETH Pair] *********************************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.21.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.2.21.1', u'bridge_name': u't3br1', u'ns_name': u't3ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.21.2/24', u'tenant_ns_ip': u'10.2.21.1/24', u'tenant_ns_if': u't3ns1if', u'tenant_sub_if': u't3s1if', u'tenant_ns_name': u't3'}], u'bridge_ip': u'1.1.1.1', u'vms': [{u'mem': 2, u'name': u't3_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't3br1if1', u'vmif': u't3VM4if1'}, {u'mem': 2, u'name': u't3_VM5', u'vcpu': 4, u'disk': u'10G', u'brif': u't3br1if2', u'vmif': u't3VM5if1'}], u'vxlan': [{u'local_ip': u'10.2.21.2', u'dsport': 4789, u'dev': u't3s1if', u'tenant_route_ip': u'192.168.131.2', u'remote_route': u'10.1.21.0/24', u'subnet_route': u'10.2.21.0/24', u'v_name': u'vxlan_t3s1', u'id': 42, u'remote_ip': u'10.1.21.2'}]}, {u'dnsif': u't3s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't3s1_dnsbrif'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t3ns1\" brctl show \"t3br1\" | grep -w 't3s1_dnsbrif' ; if [ $? -ne 0 ] ; then ip netns exec \"t3ns1\" brctl addif \"t3br1\" \"t3s1_dnsbrif\" ; fi\n", "delta": "0:00:00.041823", "end": "2019-11-17 10:35:20.961024", "item": [{"bridge_ip": "1.1.1.1", "bridge_name": "t3br1", "default_route_ip": "10.2.21.1", "ns_name": "t3ns1", "route": [{"if": "p1", "ip": "10.2.21.1/24", "ns_if": "t3if", "ns_name": "t3"}], "tenant_ns": [{"tenant_ns_if": "t3ns1if", "tenant_ns_ip": "10.2.21.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s1if", "tenant_sub_ip": "10.2.21.2/24"}], "vms": [{"brif": "t3br1if1", "disk": "10G", "mem": 2, "name": "t3_VM4", "vcpu": 4, "vmif": "t3VM4if1"}, {"brif": "t3br1if2", "disk": "10G", "mem": 2, "name": "t3_VM5", "vcpu": 4, "vmif": "t3VM5if1"}], "vxlan": [{"dev": "t3s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.21.2", "remote_ip": "10.1.21.2", "remote_route": "10.1.21.0/24", "subnet_route": "10.2.21.0/24", "tenant_route_ip": "192.168.131.2", "v_name": "vxlan_t3s1"}]}, {"brif": "t3s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t3s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "rc": 0, "start": "2019-11-17 10:35:20.919201", "stderr": "", "stderr_lines": [], "stdout": "\t\t\t\t\t\t\tt3s1_dnsbrif", "stdout_lines": ["\t\t\t\t\t\t\tt3s1_dnsbrif"]}
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.22.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.2.22.1', u'bridge_name': u't3br2', u'ns_name': u't3ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.22.2/24', u'tenant_ns_ip': u'10.2.22.1/24', u'tenant_ns_if': u't3ns2if', u'tenant_sub_if': u't3s2if', u'tenant_ns_name': u't3'}], u'bridge_ip': u'2.2.2.1', u'vms': [{u'mem': 2, u'name': u't3_VM6', u'vcpu': 4, u'disk': u'10G', u'brif': u't3br2if1', u'vmif': u't3VM6if1'}], u'vxlan': [{u'local_ip': u'10.2.22.2', u'dsport': 4789, u'dev': u't3s2if', u'tenant_route_ip': u'192.168.131.2', u'remote_route': u'10.1.22.0/24', u'subnet_route': u'10.2.22.0/24', u'v_name': u'vxlan_t3s2', u'id': 42, u'remote_ip': u'10.1.22.2'}]}, {u'dnsif': u't3s2_dnsif', u'dhcp_start': u'2.2.2.133', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.128/24', u'net_mask': u'255.255.255.0', u'brif': u't3s2_dnsbrif'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t3ns2\" brctl show \"t3br2\" | grep -w 't3s2_dnsbrif' ; if [ $? -ne 0 ] ; then ip netns exec \"t3ns2\" brctl addif \"t3br2\" \"t3s2_dnsbrif\" ; fi\n", "delta": "0:00:00.086372", "end": "2019-11-17 10:35:21.368571", "item": [{"bridge_ip": "2.2.2.1", "bridge_name": "t3br2", "default_route_ip": "10.2.22.1", "ns_name": "t3ns2", "route": [{"if": "p1", "ip": "10.2.22.1/24", "ns_if": "t3if", "ns_name": "t3"}], "tenant_ns": [{"tenant_ns_if": "t3ns2if", "tenant_ns_ip": "10.2.22.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s2if", "tenant_sub_ip": "10.2.22.2/24"}], "vms": [{"brif": "t3br2if1", "disk": "10G", "mem": 2, "name": "t3_VM6", "vcpu": 4, "vmif": "t3VM6if1"}], "vxlan": [{"dev": "t3s2if", "dsport": 4789, "id": 42, "local_ip": "10.2.22.2", "remote_ip": "10.1.22.2", "remote_route": "10.1.22.0/24", "subnet_route": "10.2.22.0/24", "tenant_route_ip": "192.168.131.2", "v_name": "vxlan_t3s2"}]}, {"brif": "t3s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.133", "dnsif": "t3s2_dnsif", "dnsif_ip": "2.2.2.128/24", "net_mask": "255.255.255.0"}], "rc": 0, "start": "2019-11-17 10:35:21.282199", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Create VETH Pairs] ************************************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.21.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.2.21.1', u'bridge_name': u't3br1', u'dns': [{u'dnsif': u't3s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't3s1_dnsbrif'}], u'ns_name': u't3ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.21.2/24', u'tenant_ns_ip': u'10.2.21.1/24', u'tenant_ns_if': u't3ns1if', u'tenant_sub_if': u't3s1if', u'tenant_ns_name': u't3'}], u'bridge_ip': u'1.1.1.1', u'vxlan': [{u'local_ip': u'10.2.21.2', u'dsport': 4789, u'dev': u't3s1if', u'tenant_route_ip': u'192.168.131.2', u'remote_route': u'10.1.21.0/24', u'subnet_route': u'10.2.21.0/24', u'v_name': u'vxlan_t3s1', u'id': 42, u'remote_ip': u'10.1.21.2'}]}, {u'mem': 2, u'name': u't3_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't3br1if1', u'vmif': u't3VM4if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip link show \"t3br1if1\" ; if [ $? -ne 0 ] ; then ip link add \"t3VM4if1\" type veth peer name \"t3br1if1\" ; fi\nip link set dev \"t3br1if1\" up\nip link set dev \"t3VM4if1\" up\n", "delta": "0:00:00.012657", "end": "2019-11-17 10:35:21.750223", "item": [{"bridge_ip": "1.1.1.1", "bridge_name": "t3br1", "default_route_ip": "10.2.21.1", "dns": [{"brif": "t3s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t3s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "ns_name": "t3ns1", "route": [{"if": "p1", "ip": "10.2.21.1/24", "ns_if": "t3if", "ns_name": "t3"}], "tenant_ns": [{"tenant_ns_if": "t3ns1if", "tenant_ns_ip": "10.2.21.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s1if", "tenant_sub_ip": "10.2.21.2/24"}], "vxlan": [{"dev": "t3s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.21.2", "remote_ip": "10.1.21.2", "remote_route": "10.1.21.0/24", "subnet_route": "10.2.21.0/24", "tenant_route_ip": "192.168.131.2", "v_name": "vxlan_t3s1"}]}, {"brif": "t3br1if1", "disk": "10G", "mem": 2, "name": "t3_VM4", "vcpu": 4, "vmif": "t3VM4if1"}], "rc": 0, "start": "2019-11-17 10:35:21.737566", "stderr": "Device \"t3br1if1\" does not exist.\nRTNETLINK answers: File exists\nCannot find device \"t3br1if1\"", "stderr_lines": ["Device \"t3br1if1\" does not exist.", "RTNETLINK answers: File exists", "Cannot find device \"t3br1if1\""], "stdout": "", "stdout_lines": []}
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.21.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.2.21.1', u'bridge_name': u't3br1', u'dns': [{u'dnsif': u't3s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't3s1_dnsbrif'}], u'ns_name': u't3ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.21.2/24', u'tenant_ns_ip': u'10.2.21.1/24', u'tenant_ns_if': u't3ns1if', u'tenant_sub_if': u't3s1if', u'tenant_ns_name': u't3'}], u'bridge_ip': u'1.1.1.1', u'vxlan': [{u'local_ip': u'10.2.21.2', u'dsport': 4789, u'dev': u't3s1if', u'tenant_route_ip': u'192.168.131.2', u'remote_route': u'10.1.21.0/24', u'subnet_route': u'10.2.21.0/24', u'v_name': u'vxlan_t3s1', u'id': 42, u'remote_ip': u'10.1.21.2'}]}, {u'mem': 2, u'name': u't3_VM5', u'vcpu': 4, u'disk': u'10G', u'brif': u't3br1if2', u'vmif': u't3VM5if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip link show \"t3br1if2\" ; if [ $? -ne 0 ] ; then ip link add \"t3VM5if1\" type veth peer name \"t3br1if2\" ; fi\nip link set dev \"t3br1if2\" up\nip link set dev \"t3VM5if1\" up\n", "delta": "0:00:00.011549", "end": "2019-11-17 10:35:22.069683", "item": [{"bridge_ip": "1.1.1.1", "bridge_name": "t3br1", "default_route_ip": "10.2.21.1", "dns": [{"brif": "t3s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t3s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "ns_name": "t3ns1", "route": [{"if": "p1", "ip": "10.2.21.1/24", "ns_if": "t3if", "ns_name": "t3"}], "tenant_ns": [{"tenant_ns_if": "t3ns1if", "tenant_ns_ip": "10.2.21.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s1if", "tenant_sub_ip": "10.2.21.2/24"}], "vxlan": [{"dev": "t3s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.21.2", "remote_ip": "10.1.21.2", "remote_route": "10.1.21.0/24", "subnet_route": "10.2.21.0/24", "tenant_route_ip": "192.168.131.2", "v_name": "vxlan_t3s1"}]}, {"brif": "t3br1if2", "disk": "10G", "mem": 2, "name": "t3_VM5", "vcpu": 4, "vmif": "t3VM5if1"}], "rc": 0, "start": "2019-11-17 10:35:22.058134", "stderr": "Device \"t3br1if2\" does not exist.\nRTNETLINK answers: File exists\nCannot find device \"t3br1if2\"", "stderr_lines": ["Device \"t3br1if2\" does not exist.", "RTNETLINK answers: File exists", "Cannot find device \"t3br1if2\""], "stdout": "", "stdout_lines": []}
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.22.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.2.22.1', u'bridge_name': u't3br2', u'dns': [{u'dnsif': u't3s2_dnsif', u'dhcp_start': u'2.2.2.133', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.128/24', u'net_mask': u'255.255.255.0', u'brif': u't3s2_dnsbrif'}], u'ns_name': u't3ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.22.2/24', u'tenant_ns_ip': u'10.2.22.1/24', u'tenant_ns_if': u't3ns2if', u'tenant_sub_if': u't3s2if', u'tenant_ns_name': u't3'}], u'bridge_ip': u'2.2.2.1', u'vxlan': [{u'local_ip': u'10.2.22.2', u'dsport': 4789, u'dev': u't3s2if', u'tenant_route_ip': u'192.168.131.2', u'remote_route': u'10.1.22.0/24', u'subnet_route': u'10.2.22.0/24', u'v_name': u'vxlan_t3s2', u'id': 42, u'remote_ip': u'10.1.22.2'}]}, {u'mem': 2, u'name': u't3_VM6', u'vcpu': 4, u'disk': u'10G', u'brif': u't3br2if1', u'vmif': u't3VM6if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip link show \"t3br2if1\" ; if [ $? -ne 0 ] ; then ip link add \"t3VM6if1\" type veth peer name \"t3br2if1\" ; fi\nip link set dev \"t3br2if1\" up\nip link set dev \"t3VM6if1\" up\n", "delta": "0:00:00.016980", "end": "2019-11-17 10:35:22.398386", "item": [{"bridge_ip": "2.2.2.1", "bridge_name": "t3br2", "default_route_ip": "10.2.22.1", "dns": [{"brif": "t3s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.133", "dnsif": "t3s2_dnsif", "dnsif_ip": "2.2.2.128/24", "net_mask": "255.255.255.0"}], "ns_name": "t3ns2", "route": [{"if": "p1", "ip": "10.2.22.1/24", "ns_if": "t3if", "ns_name": "t3"}], "tenant_ns": [{"tenant_ns_if": "t3ns2if", "tenant_ns_ip": "10.2.22.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s2if", "tenant_sub_ip": "10.2.22.2/24"}], "vxlan": [{"dev": "t3s2if", "dsport": 4789, "id": 42, "local_ip": "10.2.22.2", "remote_ip": "10.1.22.2", "remote_route": "10.1.22.0/24", "subnet_route": "10.2.22.0/24", "tenant_route_ip": "192.168.131.2", "v_name": "vxlan_t3s2"}]}, {"brif": "t3br2if1", "disk": "10G", "mem": 2, "name": "t3_VM6", "vcpu": 4, "vmif": "t3VM6if1"}], "rc": 0, "start": "2019-11-17 10:35:22.381406", "stderr": "Device \"t3br2if1\" does not exist.", "stderr_lines": ["Device \"t3br2if1\" does not exist."], "stdout": "", "stdout_lines": []}

TASK [Attach VETH Pairs] ************************************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.21.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.2.21.1', u'bridge_name': u't3br1', u'dns': [{u'dnsif': u't3s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't3s1_dnsbrif'}], u'ns_name': u't3ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.21.2/24', u'tenant_ns_ip': u'10.2.21.1/24', u'tenant_ns_if': u't3ns1if', u'tenant_sub_if': u't3s1if', u'tenant_ns_name': u't3'}], u'bridge_ip': u'1.1.1.1', u'vxlan': [{u'local_ip': u'10.2.21.2', u'dsport': 4789, u'dev': u't3s1if', u'tenant_route_ip': u'192.168.131.2', u'remote_route': u'10.1.21.0/24', u'subnet_route': u'10.2.21.0/24', u'v_name': u'vxlan_t3s1', u'id': 42, u'remote_ip': u'10.1.21.2'}]}, {u'mem': 2, u'name': u't3_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't3br1if1', u'vmif': u't3VM4if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip link show \"t3br1if1\" ; if [ $? -eq 0 ] ; then ip link set \"t3br1if1\" netns \"t3ns1\" ; fi\nip netns exec \"t3ns1\" brctl show \"t3br1\" | grep -w 't3br1if1' ; if [ $? -ne 0 ] ; then ip netns exec \"t3ns1\" brctl addif \"t3br1\" \"t3br1if1\" ; fi\n", "delta": "0:00:00.044820", "end": "2019-11-17 10:35:22.832400", "item": [{"bridge_ip": "1.1.1.1", "bridge_name": "t3br1", "default_route_ip": "10.2.21.1", "dns": [{"brif": "t3s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t3s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "ns_name": "t3ns1", "route": [{"if": "p1", "ip": "10.2.21.1/24", "ns_if": "t3if", "ns_name": "t3"}], "tenant_ns": [{"tenant_ns_if": "t3ns1if", "tenant_ns_ip": "10.2.21.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s1if", "tenant_sub_ip": "10.2.21.2/24"}], "vxlan": [{"dev": "t3s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.21.2", "remote_ip": "10.1.21.2", "remote_route": "10.1.21.0/24", "subnet_route": "10.2.21.0/24", "tenant_route_ip": "192.168.131.2", "v_name": "vxlan_t3s1"}]}, {"brif": "t3br1if1", "disk": "10G", "mem": 2, "name": "t3_VM4", "vcpu": 4, "vmif": "t3VM4if1"}], "rc": 0, "start": "2019-11-17 10:35:22.787580", "stderr": "Device \"t3br1if1\" does not exist.", "stderr_lines": ["Device \"t3br1if1\" does not exist."], "stdout": "t3br1\t\t8000.6ea2f3411004\tno\t\tt3br1if1", "stdout_lines": ["t3br1\t\t8000.6ea2f3411004\tno\t\tt3br1if1"]}
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.21.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.2.21.1', u'bridge_name': u't3br1', u'dns': [{u'dnsif': u't3s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't3s1_dnsbrif'}], u'ns_name': u't3ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.21.2/24', u'tenant_ns_ip': u'10.2.21.1/24', u'tenant_ns_if': u't3ns1if', u'tenant_sub_if': u't3s1if', u'tenant_ns_name': u't3'}], u'bridge_ip': u'1.1.1.1', u'vxlan': [{u'local_ip': u'10.2.21.2', u'dsport': 4789, u'dev': u't3s1if', u'tenant_route_ip': u'192.168.131.2', u'remote_route': u'10.1.21.0/24', u'subnet_route': u'10.2.21.0/24', u'v_name': u'vxlan_t3s1', u'id': 42, u'remote_ip': u'10.1.21.2'}]}, {u'mem': 2, u'name': u't3_VM5', u'vcpu': 4, u'disk': u'10G', u'brif': u't3br1if2', u'vmif': u't3VM5if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip link show \"t3br1if2\" ; if [ $? -eq 0 ] ; then ip link set \"t3br1if2\" netns \"t3ns1\" ; fi\nip netns exec \"t3ns1\" brctl show \"t3br1\" | grep -w 't3br1if2' ; if [ $? -ne 0 ] ; then ip netns exec \"t3ns1\" brctl addif \"t3br1\" \"t3br1if2\" ; fi\n", "delta": "0:00:00.037226", "end": "2019-11-17 10:35:23.184390", "item": [{"bridge_ip": "1.1.1.1", "bridge_name": "t3br1", "default_route_ip": "10.2.21.1", "dns": [{"brif": "t3s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t3s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "ns_name": "t3ns1", "route": [{"if": "p1", "ip": "10.2.21.1/24", "ns_if": "t3if", "ns_name": "t3"}], "tenant_ns": [{"tenant_ns_if": "t3ns1if", "tenant_ns_ip": "10.2.21.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s1if", "tenant_sub_ip": "10.2.21.2/24"}], "vxlan": [{"dev": "t3s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.21.2", "remote_ip": "10.1.21.2", "remote_route": "10.1.21.0/24", "subnet_route": "10.2.21.0/24", "tenant_route_ip": "192.168.131.2", "v_name": "vxlan_t3s1"}]}, {"brif": "t3br1if2", "disk": "10G", "mem": 2, "name": "t3_VM5", "vcpu": 4, "vmif": "t3VM5if1"}], "rc": 0, "start": "2019-11-17 10:35:23.147164", "stderr": "Device \"t3br1if2\" does not exist.", "stderr_lines": ["Device \"t3br1if2\" does not exist."], "stdout": "\t\t\t\t\t\t\tt3br1if2", "stdout_lines": ["\t\t\t\t\t\t\tt3br1if2"]}
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.22.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.2.22.1', u'bridge_name': u't3br2', u'dns': [{u'dnsif': u't3s2_dnsif', u'dhcp_start': u'2.2.2.133', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.128/24', u'net_mask': u'255.255.255.0', u'brif': u't3s2_dnsbrif'}], u'ns_name': u't3ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.22.2/24', u'tenant_ns_ip': u'10.2.22.1/24', u'tenant_ns_if': u't3ns2if', u'tenant_sub_if': u't3s2if', u'tenant_ns_name': u't3'}], u'bridge_ip': u'2.2.2.1', u'vxlan': [{u'local_ip': u'10.2.22.2', u'dsport': 4789, u'dev': u't3s2if', u'tenant_route_ip': u'192.168.131.2', u'remote_route': u'10.1.22.0/24', u'subnet_route': u'10.2.22.0/24', u'v_name': u'vxlan_t3s2', u'id': 42, u'remote_ip': u'10.1.22.2'}]}, {u'mem': 2, u'name': u't3_VM6', u'vcpu': 4, u'disk': u'10G', u'brif': u't3br2if1', u'vmif': u't3VM6if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip link show \"t3br2if1\" ; if [ $? -eq 0 ] ; then ip link set \"t3br2if1\" netns \"t3ns2\" ; fi\nip netns exec \"t3ns2\" brctl show \"t3br2\" | grep -w 't3br2if1' ; if [ $? -ne 0 ] ; then ip netns exec \"t3ns2\" brctl addif \"t3br2\" \"t3br2if1\" ; fi\n", "delta": "0:00:00.121032", "end": "2019-11-17 10:35:23.632341", "item": [{"bridge_ip": "2.2.2.1", "bridge_name": "t3br2", "default_route_ip": "10.2.22.1", "dns": [{"brif": "t3s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.133", "dnsif": "t3s2_dnsif", "dnsif_ip": "2.2.2.128/24", "net_mask": "255.255.255.0"}], "ns_name": "t3ns2", "route": [{"if": "p1", "ip": "10.2.22.1/24", "ns_if": "t3if", "ns_name": "t3"}], "tenant_ns": [{"tenant_ns_if": "t3ns2if", "tenant_ns_ip": "10.2.22.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s2if", "tenant_sub_ip": "10.2.22.2/24"}], "vxlan": [{"dev": "t3s2if", "dsport": 4789, "id": 42, "local_ip": "10.2.22.2", "remote_ip": "10.1.22.2", "remote_route": "10.1.22.0/24", "subnet_route": "10.2.22.0/24", "tenant_route_ip": "192.168.131.2", "v_name": "vxlan_t3s2"}]}, {"brif": "t3br2if1", "disk": "10G", "mem": 2, "name": "t3_VM6", "vcpu": 4, "vmif": "t3VM6if1"}], "rc": 0, "start": "2019-11-17 10:35:23.511309", "stderr": "", "stderr_lines": [], "stdout": "55: t3br2if1@t3VM6if1: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP mode DEFAULT group default qlen 1000\n    link/ether da:a1:58:18:ff:20 brd ff:ff:ff:ff:ff:ff", "stdout_lines": ["55: t3br2if1@t3VM6if1: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP mode DEFAULT group default qlen 1000", "    link/ether da:a1:58:18:ff:20 brd ff:ff:ff:ff:ff:ff"]}

TASK [All interfaces and bridges UP] ************************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.21.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.2.21.1', u'bridge_name': u't3br1', u'dns': [{u'dnsif': u't3s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't3s1_dnsbrif'}], u'ns_name': u't3ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.21.2/24', u'tenant_ns_ip': u'10.2.21.1/24', u'tenant_ns_if': u't3ns1if', u'tenant_sub_if': u't3s1if', u'tenant_ns_name': u't3'}], u'bridge_ip': u'1.1.1.1', u'vxlan': [{u'local_ip': u'10.2.21.2', u'dsport': 4789, u'dev': u't3s1if', u'tenant_route_ip': u'192.168.131.2', u'remote_route': u'10.1.21.0/24', u'subnet_route': u'10.2.21.0/24', u'v_name': u'vxlan_t3s1', u'id': 42, u'remote_ip': u'10.1.21.2'}]}, {u'mem': 2, u'name': u't3_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't3br1if1', u'vmif': u't3VM4if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t3ns1\" ip link set \"t3br1if1\" up\nip netns exec \"t3ns1\" ip link set dev \"t3br1\" up\n", "delta": "0:00:00.061845", "end": "2019-11-17 10:35:24.084358", "item": [{"bridge_ip": "1.1.1.1", "bridge_name": "t3br1", "default_route_ip": "10.2.21.1", "dns": [{"brif": "t3s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t3s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "ns_name": "t3ns1", "route": [{"if": "p1", "ip": "10.2.21.1/24", "ns_if": "t3if", "ns_name": "t3"}], "tenant_ns": [{"tenant_ns_if": "t3ns1if", "tenant_ns_ip": "10.2.21.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s1if", "tenant_sub_ip": "10.2.21.2/24"}], "vxlan": [{"dev": "t3s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.21.2", "remote_ip": "10.1.21.2", "remote_route": "10.1.21.0/24", "subnet_route": "10.2.21.0/24", "tenant_route_ip": "192.168.131.2", "v_name": "vxlan_t3s1"}]}, {"brif": "t3br1if1", "disk": "10G", "mem": 2, "name": "t3_VM4", "vcpu": 4, "vmif": "t3VM4if1"}], "rc": 0, "start": "2019-11-17 10:35:24.022513", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.21.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.2.21.1', u'bridge_name': u't3br1', u'dns': [{u'dnsif': u't3s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't3s1_dnsbrif'}], u'ns_name': u't3ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.21.2/24', u'tenant_ns_ip': u'10.2.21.1/24', u'tenant_ns_if': u't3ns1if', u'tenant_sub_if': u't3s1if', u'tenant_ns_name': u't3'}], u'bridge_ip': u'1.1.1.1', u'vxlan': [{u'local_ip': u'10.2.21.2', u'dsport': 4789, u'dev': u't3s1if', u'tenant_route_ip': u'192.168.131.2', u'remote_route': u'10.1.21.0/24', u'subnet_route': u'10.2.21.0/24', u'v_name': u'vxlan_t3s1', u'id': 42, u'remote_ip': u'10.1.21.2'}]}, {u'mem': 2, u'name': u't3_VM5', u'vcpu': 4, u'disk': u'10G', u'brif': u't3br1if2', u'vmif': u't3VM5if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t3ns1\" ip link set \"t3br1if2\" up\nip netns exec \"t3ns1\" ip link set dev \"t3br1\" up\n", "delta": "0:00:00.072031", "end": "2019-11-17 10:35:24.452541", "item": [{"bridge_ip": "1.1.1.1", "bridge_name": "t3br1", "default_route_ip": "10.2.21.1", "dns": [{"brif": "t3s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t3s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "ns_name": "t3ns1", "route": [{"if": "p1", "ip": "10.2.21.1/24", "ns_if": "t3if", "ns_name": "t3"}], "tenant_ns": [{"tenant_ns_if": "t3ns1if", "tenant_ns_ip": "10.2.21.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s1if", "tenant_sub_ip": "10.2.21.2/24"}], "vxlan": [{"dev": "t3s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.21.2", "remote_ip": "10.1.21.2", "remote_route": "10.1.21.0/24", "subnet_route": "10.2.21.0/24", "tenant_route_ip": "192.168.131.2", "v_name": "vxlan_t3s1"}]}, {"brif": "t3br1if2", "disk": "10G", "mem": 2, "name": "t3_VM5", "vcpu": 4, "vmif": "t3VM5if1"}], "rc": 0, "start": "2019-11-17 10:35:24.380510", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.22.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.2.22.1', u'bridge_name': u't3br2', u'dns': [{u'dnsif': u't3s2_dnsif', u'dhcp_start': u'2.2.2.133', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.128/24', u'net_mask': u'255.255.255.0', u'brif': u't3s2_dnsbrif'}], u'ns_name': u't3ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.22.2/24', u'tenant_ns_ip': u'10.2.22.1/24', u'tenant_ns_if': u't3ns2if', u'tenant_sub_if': u't3s2if', u'tenant_ns_name': u't3'}], u'bridge_ip': u'2.2.2.1', u'vxlan': [{u'local_ip': u'10.2.22.2', u'dsport': 4789, u'dev': u't3s2if', u'tenant_route_ip': u'192.168.131.2', u'remote_route': u'10.1.22.0/24', u'subnet_route': u'10.2.22.0/24', u'v_name': u'vxlan_t3s2', u'id': 42, u'remote_ip': u'10.1.22.2'}]}, {u'mem': 2, u'name': u't3_VM6', u'vcpu': 4, u'disk': u'10G', u'brif': u't3br2if1', u'vmif': u't3VM6if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t3ns2\" ip link set \"t3br2if1\" up\nip netns exec \"t3ns2\" ip link set dev \"t3br2\" up\n", "delta": "0:00:00.093046", "end": "2019-11-17 10:35:24.848390", "item": [{"bridge_ip": "2.2.2.1", "bridge_name": "t3br2", "default_route_ip": "10.2.22.1", "dns": [{"brif": "t3s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.133", "dnsif": "t3s2_dnsif", "dnsif_ip": "2.2.2.128/24", "net_mask": "255.255.255.0"}], "ns_name": "t3ns2", "route": [{"if": "p1", "ip": "10.2.22.1/24", "ns_if": "t3if", "ns_name": "t3"}], "tenant_ns": [{"tenant_ns_if": "t3ns2if", "tenant_ns_ip": "10.2.22.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s2if", "tenant_sub_ip": "10.2.22.2/24"}], "vxlan": [{"dev": "t3s2if", "dsport": 4789, "id": 42, "local_ip": "10.2.22.2", "remote_ip": "10.1.22.2", "remote_route": "10.1.22.0/24", "subnet_route": "10.2.22.0/24", "tenant_route_ip": "192.168.131.2", "v_name": "vxlan_t3s2"}]}, {"brif": "t3br2if1", "disk": "10G", "mem": 2, "name": "t3_VM6", "vcpu": 4, "vmif": "t3VM6if1"}], "rc": 0, "start": "2019-11-17 10:35:24.755344", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Add IP to DNS Interface] ******************************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.21.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.2.21.1', u'bridge_name': u't3br1', u'ns_name': u't3ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.21.2/24', u'tenant_ns_ip': u'10.2.21.1/24', u'tenant_ns_if': u't3ns1if', u'tenant_sub_if': u't3s1if', u'tenant_ns_name': u't3'}], u'bridge_ip': u'1.1.1.1', u'vms': [{u'mem': 2, u'name': u't3_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't3br1if1', u'vmif': u't3VM4if1'}, {u'mem': 2, u'name': u't3_VM5', u'vcpu': 4, u'disk': u'10G', u'brif': u't3br1if2', u'vmif': u't3VM5if1'}], u'vxlan': [{u'local_ip': u'10.2.21.2', u'dsport': 4789, u'dev': u't3s1if', u'tenant_route_ip': u'192.168.131.2', u'remote_route': u'10.1.21.0/24', u'subnet_route': u'10.2.21.0/24', u'v_name': u'vxlan_t3s1', u'id': 42, u'remote_ip': u'10.1.21.2'}]}, {u'dnsif': u't3s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't3s1_dnsbrif'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t3ns1\" ip addr show \"t3s1_dnsif\" | awk 'FNR==3{ print $2}'| grep -w '^1.1.1.128/24' ; if [ $? -ne 0 ] ; then ip netns exec \"t3ns1\" ip addr add \"1.1.1.128/24\" dev \"t3s1_dnsif\" ; fi\n", "delta": "0:00:00.035053", "end": "2019-11-17 10:35:25.273008", "item": [{"bridge_ip": "1.1.1.1", "bridge_name": "t3br1", "default_route_ip": "10.2.21.1", "ns_name": "t3ns1", "route": [{"if": "p1", "ip": "10.2.21.1/24", "ns_if": "t3if", "ns_name": "t3"}], "tenant_ns": [{"tenant_ns_if": "t3ns1if", "tenant_ns_ip": "10.2.21.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s1if", "tenant_sub_ip": "10.2.21.2/24"}], "vms": [{"brif": "t3br1if1", "disk": "10G", "mem": 2, "name": "t3_VM4", "vcpu": 4, "vmif": "t3VM4if1"}, {"brif": "t3br1if2", "disk": "10G", "mem": 2, "name": "t3_VM5", "vcpu": 4, "vmif": "t3VM5if1"}], "vxlan": [{"dev": "t3s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.21.2", "remote_ip": "10.1.21.2", "remote_route": "10.1.21.0/24", "subnet_route": "10.2.21.0/24", "tenant_route_ip": "192.168.131.2", "v_name": "vxlan_t3s1"}]}, {"brif": "t3s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t3s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "rc": 0, "start": "2019-11-17 10:35:25.237955", "stderr": "", "stderr_lines": [], "stdout": "1.1.1.128/24", "stdout_lines": ["1.1.1.128/24"]}
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.22.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.2.22.1', u'bridge_name': u't3br2', u'ns_name': u't3ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.22.2/24', u'tenant_ns_ip': u'10.2.22.1/24', u'tenant_ns_if': u't3ns2if', u'tenant_sub_if': u't3s2if', u'tenant_ns_name': u't3'}], u'bridge_ip': u'2.2.2.1', u'vms': [{u'mem': 2, u'name': u't3_VM6', u'vcpu': 4, u'disk': u'10G', u'brif': u't3br2if1', u'vmif': u't3VM6if1'}], u'vxlan': [{u'local_ip': u'10.2.22.2', u'dsport': 4789, u'dev': u't3s2if', u'tenant_route_ip': u'192.168.131.2', u'remote_route': u'10.1.22.0/24', u'subnet_route': u'10.2.22.0/24', u'v_name': u'vxlan_t3s2', u'id': 42, u'remote_ip': u'10.1.22.2'}]}, {u'dnsif': u't3s2_dnsif', u'dhcp_start': u'2.2.2.133', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.128/24', u'net_mask': u'255.255.255.0', u'brif': u't3s2_dnsbrif'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t3ns2\" ip addr show \"t3s2_dnsif\" | awk 'FNR==3{ print $2}'| grep -w '^2.2.2.128/24' ; if [ $? -ne 0 ] ; then ip netns exec \"t3ns2\" ip addr add \"2.2.2.128/24\" dev \"t3s2_dnsif\" ; fi\n", "delta": "0:00:00.086749", "end": "2019-11-17 10:35:25.684560", "item": [{"bridge_ip": "2.2.2.1", "bridge_name": "t3br2", "default_route_ip": "10.2.22.1", "ns_name": "t3ns2", "route": [{"if": "p1", "ip": "10.2.22.1/24", "ns_if": "t3if", "ns_name": "t3"}], "tenant_ns": [{"tenant_ns_if": "t3ns2if", "tenant_ns_ip": "10.2.22.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s2if", "tenant_sub_ip": "10.2.22.2/24"}], "vms": [{"brif": "t3br2if1", "disk": "10G", "mem": 2, "name": "t3_VM6", "vcpu": 4, "vmif": "t3VM6if1"}], "vxlan": [{"dev": "t3s2if", "dsport": 4789, "id": 42, "local_ip": "10.2.22.2", "remote_ip": "10.1.22.2", "remote_route": "10.1.22.0/24", "subnet_route": "10.2.22.0/24", "tenant_route_ip": "192.168.131.2", "v_name": "vxlan_t3s2"}]}, {"brif": "t3s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.133", "dnsif": "t3s2_dnsif", "dnsif_ip": "2.2.2.128/24", "net_mask": "255.255.255.0"}], "rc": 0, "start": "2019-11-17 10:35:25.597811", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Install DHCP Server] **********************************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.21.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.2.21.1', u'bridge_name': u't3br1', u'ns_name': u't3ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.21.2/24', u'tenant_ns_ip': u'10.2.21.1/24', u'tenant_ns_if': u't3ns1if', u'tenant_sub_if': u't3s1if', u'tenant_ns_name': u't3'}], u'bridge_ip': u'1.1.1.1', u'vms': [{u'mem': 2, u'name': u't3_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't3br1if1', u'vmif': u't3VM4if1'}, {u'mem': 2, u'name': u't3_VM5', u'vcpu': 4, u'disk': u'10G', u'brif': u't3br1if2', u'vmif': u't3VM5if1'}], u'vxlan': [{u'local_ip': u'10.2.21.2', u'dsport': 4789, u'dev': u't3s1if', u'tenant_route_ip': u'192.168.131.2', u'remote_route': u'10.1.21.0/24', u'subnet_route': u'10.2.21.0/24', u'v_name': u'vxlan_t3s1', u'id': 42, u'remote_ip': u'10.1.21.2'}]}, {u'dnsif': u't3s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't3s1_dnsbrif'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t3ns1\" ps aux | grep -w '[d]nsmasq --interface t3s1_dnsif -z --dhcp-range=1.1.1.133,1.1.1.254' ; if [ $? -ne 0 ] ; then ip netns exec \"t3ns1\" dnsmasq --interface \"t3s1_dnsif\" -z --dhcp-range=1.1.1.133,'1.1.1.254' ; fi\n", "delta": "0:00:00.056403", "end": "2019-11-17 10:35:26.144461", "item": [{"bridge_ip": "1.1.1.1", "bridge_name": "t3br1", "default_route_ip": "10.2.21.1", "ns_name": "t3ns1", "route": [{"if": "p1", "ip": "10.2.21.1/24", "ns_if": "t3if", "ns_name": "t3"}], "tenant_ns": [{"tenant_ns_if": "t3ns1if", "tenant_ns_ip": "10.2.21.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s1if", "tenant_sub_ip": "10.2.21.2/24"}], "vms": [{"brif": "t3br1if1", "disk": "10G", "mem": 2, "name": "t3_VM4", "vcpu": 4, "vmif": "t3VM4if1"}, {"brif": "t3br1if2", "disk": "10G", "mem": 2, "name": "t3_VM5", "vcpu": 4, "vmif": "t3VM5if1"}], "vxlan": [{"dev": "t3s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.21.2", "remote_ip": "10.1.21.2", "remote_route": "10.1.21.0/24", "subnet_route": "10.2.21.0/24", "tenant_route_ip": "192.168.131.2", "v_name": "vxlan_t3s1"}]}, {"brif": "t3s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t3s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "rc": 0, "start": "2019-11-17 10:35:26.088058", "stderr": "", "stderr_lines": [], "stdout": "nobody    8900  0.0  0.0  51580  2724 ?        S    10:24   0:00 dnsmasq --interface t3s1_dnsif -z --dhcp-range=1.1.1.133,1.1.1.254", "stdout_lines": ["nobody    8900  0.0  0.0  51580  2724 ?        S    10:24   0:00 dnsmasq --interface t3s1_dnsif -z --dhcp-range=1.1.1.133,1.1.1.254"]}
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.22.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.2.22.1', u'bridge_name': u't3br2', u'ns_name': u't3ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.22.2/24', u'tenant_ns_ip': u'10.2.22.1/24', u'tenant_ns_if': u't3ns2if', u'tenant_sub_if': u't3s2if', u'tenant_ns_name': u't3'}], u'bridge_ip': u'2.2.2.1', u'vms': [{u'mem': 2, u'name': u't3_VM6', u'vcpu': 4, u'disk': u'10G', u'brif': u't3br2if1', u'vmif': u't3VM6if1'}], u'vxlan': [{u'local_ip': u'10.2.22.2', u'dsport': 4789, u'dev': u't3s2if', u'tenant_route_ip': u'192.168.131.2', u'remote_route': u'10.1.22.0/24', u'subnet_route': u'10.2.22.0/24', u'v_name': u'vxlan_t3s2', u'id': 42, u'remote_ip': u'10.1.22.2'}]}, {u'dnsif': u't3s2_dnsif', u'dhcp_start': u'2.2.2.133', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.128/24', u'net_mask': u'255.255.255.0', u'brif': u't3s2_dnsbrif'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t3ns2\" ps aux | grep -w '[d]nsmasq --interface t3s2_dnsif -z --dhcp-range=2.2.2.133,2.2.2.254' ; if [ $? -ne 0 ] ; then ip netns exec \"t3ns2\" dnsmasq --interface \"t3s2_dnsif\" -z --dhcp-range=2.2.2.133,'2.2.2.254' ; fi\n", "delta": "0:00:00.085664", "end": "2019-11-17 10:35:26.569343", "item": [{"bridge_ip": "2.2.2.1", "bridge_name": "t3br2", "default_route_ip": "10.2.22.1", "ns_name": "t3ns2", "route": [{"if": "p1", "ip": "10.2.22.1/24", "ns_if": "t3if", "ns_name": "t3"}], "tenant_ns": [{"tenant_ns_if": "t3ns2if", "tenant_ns_ip": "10.2.22.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s2if", "tenant_sub_ip": "10.2.22.2/24"}], "vms": [{"brif": "t3br2if1", "disk": "10G", "mem": 2, "name": "t3_VM6", "vcpu": 4, "vmif": "t3VM6if1"}], "vxlan": [{"dev": "t3s2if", "dsport": 4789, "id": 42, "local_ip": "10.2.22.2", "remote_ip": "10.1.22.2", "remote_route": "10.1.22.0/24", "subnet_route": "10.2.22.0/24", "tenant_route_ip": "192.168.131.2", "v_name": "vxlan_t3s2"}]}, {"brif": "t3s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.133", "dnsif": "t3s2_dnsif", "dnsif_ip": "2.2.2.128/24", "net_mask": "255.255.255.0"}], "rc": 0, "start": "2019-11-17 10:35:26.483679", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Create VXLAN devices] *********************************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.21.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.2.21.1', u'bridge_name': u't3br1', u'dns': [{u'dnsif': u't3s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't3s1_dnsbrif'}], u'ns_name': u't3ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.21.2/24', u'tenant_ns_ip': u'10.2.21.1/24', u'tenant_ns_if': u't3ns1if', u'tenant_sub_if': u't3s1if', u'tenant_ns_name': u't3'}], u'bridge_ip': u'1.1.1.1', u'vms': [{u'mem': 2, u'name': u't3_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't3br1if1', u'vmif': u't3VM4if1'}, {u'mem': 2, u'name': u't3_VM5', u'vcpu': 4, u'disk': u'10G', u'brif': u't3br1if2', u'vmif': u't3VM5if1'}]}, {u'local_ip': u'10.2.21.2', u'dsport': 4789, u'dev': u't3s1if', u'tenant_route_ip': u'192.168.131.2', u'remote_route': u'10.1.21.0/24', u'subnet_route': u'10.2.21.0/24', u'v_name': u'vxlan_t3s1', u'id': 42, u'remote_ip': u'10.1.21.2'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t3ns1\" ip link show \"vxlan_t3s1\" ; if [ $? -ne 0 ] ; then ip netns exec \"t3ns1\" ip link add \"vxlan_t3s1\" type vxlan id \"42\" local \"10.2.21.2\" remote \"10.1.21.2\" dstport \"4789\" dev \"t3s1if\" ; ip netns exec \"t3ns1\" ip link set dev \"vxlan_t3s1\" up ; fi\n", "delta": "0:00:00.034139", "end": "2019-11-17 10:35:27.056484", "item": [{"bridge_ip": "1.1.1.1", "bridge_name": "t3br1", "default_route_ip": "10.2.21.1", "dns": [{"brif": "t3s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t3s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "ns_name": "t3ns1", "route": [{"if": "p1", "ip": "10.2.21.1/24", "ns_if": "t3if", "ns_name": "t3"}], "tenant_ns": [{"tenant_ns_if": "t3ns1if", "tenant_ns_ip": "10.2.21.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s1if", "tenant_sub_ip": "10.2.21.2/24"}], "vms": [{"brif": "t3br1if1", "disk": "10G", "mem": 2, "name": "t3_VM4", "vcpu": 4, "vmif": "t3VM4if1"}, {"brif": "t3br1if2", "disk": "10G", "mem": 2, "name": "t3_VM5", "vcpu": 4, "vmif": "t3VM5if1"}]}, {"dev": "t3s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.21.2", "remote_ip": "10.1.21.2", "remote_route": "10.1.21.0/24", "subnet_route": "10.2.21.0/24", "tenant_route_ip": "192.168.131.2", "v_name": "vxlan_t3s1"}], "rc": 0, "start": "2019-11-17 10:35:27.022345", "stderr": "", "stderr_lines": [], "stdout": "5: vxlan_t3s1: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1450 qdisc noqueue master t3br1 state UNKNOWN mode DEFAULT group default qlen 1000\n    link/ether c2:45:ef:bd:f6:fc brd ff:ff:ff:ff:ff:ff", "stdout_lines": ["5: vxlan_t3s1: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1450 qdisc noqueue master t3br1 state UNKNOWN mode DEFAULT group default qlen 1000", "    link/ether c2:45:ef:bd:f6:fc brd ff:ff:ff:ff:ff:ff"]}
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.22.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.2.22.1', u'bridge_name': u't3br2', u'dns': [{u'dnsif': u't3s2_dnsif', u'dhcp_start': u'2.2.2.133', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.128/24', u'net_mask': u'255.255.255.0', u'brif': u't3s2_dnsbrif'}], u'ns_name': u't3ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.22.2/24', u'tenant_ns_ip': u'10.2.22.1/24', u'tenant_ns_if': u't3ns2if', u'tenant_sub_if': u't3s2if', u'tenant_ns_name': u't3'}], u'bridge_ip': u'2.2.2.1', u'vms': [{u'mem': 2, u'name': u't3_VM6', u'vcpu': 4, u'disk': u'10G', u'brif': u't3br2if1', u'vmif': u't3VM6if1'}]}, {u'local_ip': u'10.2.22.2', u'dsport': 4789, u'dev': u't3s2if', u'tenant_route_ip': u'192.168.131.2', u'remote_route': u'10.1.22.0/24', u'subnet_route': u'10.2.22.0/24', u'v_name': u'vxlan_t3s2', u'id': 42, u'remote_ip': u'10.1.22.2'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t3ns2\" ip link show \"vxlan_t3s2\" ; if [ $? -ne 0 ] ; then ip netns exec \"t3ns2\" ip link add \"vxlan_t3s2\" type vxlan id \"42\" local \"10.2.22.2\" remote \"10.1.22.2\" dstport \"4789\" dev \"t3s2if\" ; ip netns exec \"t3ns2\" ip link set dev \"vxlan_t3s2\" up ; fi\n", "delta": "0:00:00.118007", "end": "2019-11-17 10:35:27.516453", "item": [{"bridge_ip": "2.2.2.1", "bridge_name": "t3br2", "default_route_ip": "10.2.22.1", "dns": [{"brif": "t3s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.133", "dnsif": "t3s2_dnsif", "dnsif_ip": "2.2.2.128/24", "net_mask": "255.255.255.0"}], "ns_name": "t3ns2", "route": [{"if": "p1", "ip": "10.2.22.1/24", "ns_if": "t3if", "ns_name": "t3"}], "tenant_ns": [{"tenant_ns_if": "t3ns2if", "tenant_ns_ip": "10.2.22.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s2if", "tenant_sub_ip": "10.2.22.2/24"}], "vms": [{"brif": "t3br2if1", "disk": "10G", "mem": 2, "name": "t3_VM6", "vcpu": 4, "vmif": "t3VM6if1"}]}, {"dev": "t3s2if", "dsport": 4789, "id": 42, "local_ip": "10.2.22.2", "remote_ip": "10.1.22.2", "remote_route": "10.1.22.0/24", "subnet_route": "10.2.22.0/24", "tenant_route_ip": "192.168.131.2", "v_name": "vxlan_t3s2"}], "rc": 0, "start": "2019-11-17 10:35:27.398446", "stderr": "Device \"vxlan_t3s2\" does not exist.", "stderr_lines": ["Device \"vxlan_t3s2\" does not exist."], "stdout": "", "stdout_lines": []}

TASK [Attach VXLANs to bridge] ******************************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.21.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.2.21.1', u'bridge_name': u't3br1', u'dns': [{u'dnsif': u't3s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't3s1_dnsbrif'}], u'ns_name': u't3ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.21.2/24', u'tenant_ns_ip': u'10.2.21.1/24', u'tenant_ns_if': u't3ns1if', u'tenant_sub_if': u't3s1if', u'tenant_ns_name': u't3'}], u'bridge_ip': u'1.1.1.1', u'vms': [{u'mem': 2, u'name': u't3_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't3br1if1', u'vmif': u't3VM4if1'}, {u'mem': 2, u'name': u't3_VM5', u'vcpu': 4, u'disk': u'10G', u'brif': u't3br1if2', u'vmif': u't3VM5if1'}]}, {u'local_ip': u'10.2.21.2', u'dsport': 4789, u'dev': u't3s1if', u'tenant_route_ip': u'192.168.131.2', u'remote_route': u'10.1.21.0/24', u'subnet_route': u'10.2.21.0/24', u'v_name': u'vxlan_t3s1', u'id': 42, u'remote_ip': u'10.1.21.2'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t3ns1\" brctl show \"t3br1\" | grep -w 'vxlan_t3s1' ; if [ $? -ne 0 ] ; then ip netns exec \"t3ns1\" brctl addif \"t3br1\" \"vxlan_t3s1\" ; fi\n", "delta": "0:00:00.042615", "end": "2019-11-17 10:35:27.976547", "item": [{"bridge_ip": "1.1.1.1", "bridge_name": "t3br1", "default_route_ip": "10.2.21.1", "dns": [{"brif": "t3s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t3s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "ns_name": "t3ns1", "route": [{"if": "p1", "ip": "10.2.21.1/24", "ns_if": "t3if", "ns_name": "t3"}], "tenant_ns": [{"tenant_ns_if": "t3ns1if", "tenant_ns_ip": "10.2.21.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s1if", "tenant_sub_ip": "10.2.21.2/24"}], "vms": [{"brif": "t3br1if1", "disk": "10G", "mem": 2, "name": "t3_VM4", "vcpu": 4, "vmif": "t3VM4if1"}, {"brif": "t3br1if2", "disk": "10G", "mem": 2, "name": "t3_VM5", "vcpu": 4, "vmif": "t3VM5if1"}]}, {"dev": "t3s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.21.2", "remote_ip": "10.1.21.2", "remote_route": "10.1.21.0/24", "subnet_route": "10.2.21.0/24", "tenant_route_ip": "192.168.131.2", "v_name": "vxlan_t3s1"}], "rc": 0, "start": "2019-11-17 10:35:27.933932", "stderr": "", "stderr_lines": [], "stdout": "\t\t\t\t\t\t\tvxlan_t3s1", "stdout_lines": ["\t\t\t\t\t\t\tvxlan_t3s1"]}
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.22.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.2.22.1', u'bridge_name': u't3br2', u'dns': [{u'dnsif': u't3s2_dnsif', u'dhcp_start': u'2.2.2.133', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.128/24', u'net_mask': u'255.255.255.0', u'brif': u't3s2_dnsbrif'}], u'ns_name': u't3ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.22.2/24', u'tenant_ns_ip': u'10.2.22.1/24', u'tenant_ns_if': u't3ns2if', u'tenant_sub_if': u't3s2if', u'tenant_ns_name': u't3'}], u'bridge_ip': u'2.2.2.1', u'vms': [{u'mem': 2, u'name': u't3_VM6', u'vcpu': 4, u'disk': u'10G', u'brif': u't3br2if1', u'vmif': u't3VM6if1'}]}, {u'local_ip': u'10.2.22.2', u'dsport': 4789, u'dev': u't3s2if', u'tenant_route_ip': u'192.168.131.2', u'remote_route': u'10.1.22.0/24', u'subnet_route': u'10.2.22.0/24', u'v_name': u'vxlan_t3s2', u'id': 42, u'remote_ip': u'10.1.22.2'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t3ns2\" brctl show \"t3br2\" | grep -w 'vxlan_t3s2' ; if [ $? -ne 0 ] ; then ip netns exec \"t3ns2\" brctl addif \"t3br2\" \"vxlan_t3s2\" ; fi\n", "delta": "0:00:00.098397", "end": "2019-11-17 10:35:28.412723", "item": [{"bridge_ip": "2.2.2.1", "bridge_name": "t3br2", "default_route_ip": "10.2.22.1", "dns": [{"brif": "t3s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.133", "dnsif": "t3s2_dnsif", "dnsif_ip": "2.2.2.128/24", "net_mask": "255.255.255.0"}], "ns_name": "t3ns2", "route": [{"if": "p1", "ip": "10.2.22.1/24", "ns_if": "t3if", "ns_name": "t3"}], "tenant_ns": [{"tenant_ns_if": "t3ns2if", "tenant_ns_ip": "10.2.22.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s2if", "tenant_sub_ip": "10.2.22.2/24"}], "vms": [{"brif": "t3br2if1", "disk": "10G", "mem": 2, "name": "t3_VM6", "vcpu": 4, "vmif": "t3VM6if1"}]}, {"dev": "t3s2if", "dsport": 4789, "id": 42, "local_ip": "10.2.22.2", "remote_ip": "10.1.22.2", "remote_route": "10.1.22.0/24", "subnet_route": "10.2.22.0/24", "tenant_route_ip": "192.168.131.2", "v_name": "vxlan_t3s2"}], "rc": 0, "start": "2019-11-17 10:35:28.314326", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

PLAY RECAP **************************************************************************************************************************************************
99.99.99.2                 : ok=21   changed=20   unreachable=0    failed=0    skipped=0    rescued=0    ignored=0   

Using /etc/ansible/ansible.cfg as config file

PLAY [main] *************************************************************************************************************************************************

TASK [Add VXLAN routes in PNS] ******************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.21.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.1.21.1', u'bridge_name': u't3br1', u'dns': [{u'dnsif': u't3s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't3s1_dnsbrif'}], u'ns_name': u't3ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.21.2/24', u'tenant_ns_ip': u'10.1.21.1/24', u'tenant_ns_if': u't3ns1if', u'tenant_sub_if': u't3s1if', u'tenant_ns_name': u't3'}], u'bridge_ip': u'1.1.1.1', u'vms': [{u'mem': 2, u'name': u't3_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't3br1if1', u'vmif': u't3VM1if1'}, {u'mem': 4, u'name': u't3_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't3br1if2', u'vmif': u't3VM2if1'}]}, {u'local_ip': u'10.1.21.2', u'dsport': 4789, u'dev': u't3s1if', u'tenant_route_ip': u'192.168.3.2', u'remote_route': u'10.2.21.0/24', u'subnet_route': u'10.1.21.0/24', u'v_name': u'vxlan_t3s1', u'id': 42, u'remote_ip': u'10.2.21.2'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec pns ip route show \"10.1.21.0/24\" via \"192.168.3.2\" | grep -w '^10.1.21.0/24' ; if [ $? -ne 0 ] ; then ip netns exec pns ip route add \"10.1.21.0/24\" via \"192.168.3.2\" ; fi\n", "delta": "0:00:00.047548", "end": "2019-11-17 10:35:29.620038", "item": [{"bridge_ip": "1.1.1.1", "bridge_name": "t3br1", "default_route_ip": "10.1.21.1", "dns": [{"brif": "t3s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t3s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t3ns1", "route": [{"if": "p1", "ip": "10.1.21.1/24", "ns_if": "t3if", "ns_name": "t3"}], "tenant_ns": [{"tenant_ns_if": "t3ns1if", "tenant_ns_ip": "10.1.21.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s1if", "tenant_sub_ip": "10.1.21.2/24"}], "vms": [{"brif": "t3br1if1", "disk": "10G", "mem": 2, "name": "t3_VM1", "vcpu": 4, "vmif": "t3VM1if1"}, {"brif": "t3br1if2", "disk": "10G", "mem": 4, "name": "t3_VM2", "vcpu": 2, "vmif": "t3VM2if1"}]}, {"dev": "t3s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.21.2", "remote_ip": "10.2.21.2", "remote_route": "10.2.21.0/24", "subnet_route": "10.1.21.0/24", "tenant_route_ip": "192.168.3.2", "v_name": "vxlan_t3s1"}], "rc": 0, "start": "2019-11-17 10:35:29.572490", "stderr": "", "stderr_lines": [], "stdout": "10.1.21.0/24 dev t3pns_if ", "stdout_lines": ["10.1.21.0/24 dev t3pns_if "]}
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.22.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.1.22.1', u'bridge_name': u't3br2', u'dns': [{u'dnsif': u't3s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.126', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't3s2_dnsbrif'}], u'ns_name': u't3ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.22.2/24', u'tenant_ns_ip': u'10.1.22.1/24', u'tenant_ns_if': u't3ns2if', u'tenant_sub_if': u't3s2if', u'tenant_ns_name': u't3'}], u'bridge_ip': u'2.2.2.1', u'vms': [{u'mem': 3, u'name': u't3_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't3br2if1', u'vmif': u't3VM3if1'}]}, {u'local_ip': u'10.1.22.2', u'dsport': 4789, u'dev': u't3s2if', u'tenant_route_ip': u'192.168.3.2', u'remote_route': u'10.2.22.0/24', u'subnet_route': u'10.1.22.0/24', u'v_name': u'vxlan_t3s2', u'id': 42, u'remote_ip': u'10.2.22.2'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec pns ip route show \"10.1.22.0/24\" via \"192.168.3.2\" | grep -w '^10.1.22.0/24' ; if [ $? -ne 0 ] ; then ip netns exec pns ip route add \"10.1.22.0/24\" via \"192.168.3.2\" ; fi\n", "delta": "0:00:00.068772", "end": "2019-11-17 10:35:29.935686", "item": [{"bridge_ip": "2.2.2.1", "bridge_name": "t3br2", "default_route_ip": "10.1.22.1", "dns": [{"brif": "t3s2_dnsbrif", "dhcp_end": "2.2.2.126", "dhcp_start": "2.2.2.5", "dnsif": "t3s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t3ns2", "route": [{"if": "p1", "ip": "10.1.22.1/24", "ns_if": "t3if", "ns_name": "t3"}], "tenant_ns": [{"tenant_ns_if": "t3ns2if", "tenant_ns_ip": "10.1.22.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s2if", "tenant_sub_ip": "10.1.22.2/24"}], "vms": [{"brif": "t3br2if1", "disk": "10G", "mem": 3, "name": "t3_VM3", "vcpu": 2, "vmif": "t3VM3if1"}]}, {"dev": "t3s2if", "dsport": 4789, "id": 42, "local_ip": "10.1.22.2", "remote_ip": "10.2.22.2", "remote_route": "10.2.22.0/24", "subnet_route": "10.1.22.0/24", "tenant_route_ip": "192.168.3.2", "v_name": "vxlan_t3s2"}], "rc": 0, "start": "2019-11-17 10:35:29.866914", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Get PNS ip address] ***********************************************************************************************************************************
ok: [localhost] => {"changed": false, "cmd": "ip netns exec pns ip addr show p1 | awk 'FNR==3{ print $2 }' | awk -F/ '{ print $1 }'\n", "delta": "0:00:00.032864", "end": "2019-11-17 10:35:30.215782", "rc": 0, "start": "2019-11-17 10:35:30.182918", "stderr": "", "stderr_lines": [], "stdout": "192.168.100.238", "stdout_lines": ["192.168.100.238"]}

TASK [Add VXLAN routes to host] *****************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.21.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.1.21.1', u'bridge_name': u't3br1', u'dns': [{u'dnsif': u't3s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't3s1_dnsbrif'}], u'ns_name': u't3ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.21.2/24', u'tenant_ns_ip': u'10.1.21.1/24', u'tenant_ns_if': u't3ns1if', u'tenant_sub_if': u't3s1if', u'tenant_ns_name': u't3'}], u'bridge_ip': u'1.1.1.1', u'vms': [{u'mem': 2, u'name': u't3_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't3br1if1', u'vmif': u't3VM1if1'}, {u'mem': 4, u'name': u't3_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't3br1if2', u'vmif': u't3VM2if1'}]}, {u'local_ip': u'10.1.21.2', u'dsport': 4789, u'dev': u't3s1if', u'tenant_route_ip': u'192.168.3.2', u'remote_route': u'10.2.21.0/24', u'subnet_route': u'10.1.21.0/24', u'v_name': u'vxlan_t3s1', u'id': 42, u'remote_ip': u'10.2.21.2'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip route show \"10.1.21.0/24\" via \"192.168.100.238\" | grep -w '^10.1.21.0/24' ; if [ $? -ne 0 ] ; then ip route add \"10.1.21.0/24\" via \"192.168.100.238\" ; fi\nip route show \"10.2.21.0/24\" via 99.99.99.2 | grep -w '^10.2.21.0/24'; if [ $? -ne 0 ] ; then ip route add \"10.2.21.0/24\" via 99.99.99.2 ; fi\n", "delta": "0:00:00.005104", "end": "2019-11-17 10:35:30.492295", "item": [{"bridge_ip": "1.1.1.1", "bridge_name": "t3br1", "default_route_ip": "10.1.21.1", "dns": [{"brif": "t3s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t3s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t3ns1", "route": [{"if": "p1", "ip": "10.1.21.1/24", "ns_if": "t3if", "ns_name": "t3"}], "tenant_ns": [{"tenant_ns_if": "t3ns1if", "tenant_ns_ip": "10.1.21.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s1if", "tenant_sub_ip": "10.1.21.2/24"}], "vms": [{"brif": "t3br1if1", "disk": "10G", "mem": 2, "name": "t3_VM1", "vcpu": 4, "vmif": "t3VM1if1"}, {"brif": "t3br1if2", "disk": "10G", "mem": 4, "name": "t3_VM2", "vcpu": 2, "vmif": "t3VM2if1"}]}, {"dev": "t3s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.21.2", "remote_ip": "10.2.21.2", "remote_route": "10.2.21.0/24", "subnet_route": "10.1.21.0/24", "tenant_route_ip": "192.168.3.2", "v_name": "vxlan_t3s1"}], "rc": 0, "start": "2019-11-17 10:35:30.487191", "stderr": "", "stderr_lines": [], "stdout": "10.1.21.0/24 dev testBR \n10.2.21.0/24 dev ens4 ", "stdout_lines": ["10.1.21.0/24 dev testBR ", "10.2.21.0/24 dev ens4 "]}
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.22.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.1.22.1', u'bridge_name': u't3br2', u'dns': [{u'dnsif': u't3s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.126', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't3s2_dnsbrif'}], u'ns_name': u't3ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.22.2/24', u'tenant_ns_ip': u'10.1.22.1/24', u'tenant_ns_if': u't3ns2if', u'tenant_sub_if': u't3s2if', u'tenant_ns_name': u't3'}], u'bridge_ip': u'2.2.2.1', u'vms': [{u'mem': 3, u'name': u't3_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't3br2if1', u'vmif': u't3VM3if1'}]}, {u'local_ip': u'10.1.22.2', u'dsport': 4789, u'dev': u't3s2if', u'tenant_route_ip': u'192.168.3.2', u'remote_route': u'10.2.22.0/24', u'subnet_route': u'10.1.22.0/24', u'v_name': u'vxlan_t3s2', u'id': 42, u'remote_ip': u'10.2.22.2'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip route show \"10.1.22.0/24\" via \"192.168.100.238\" | grep -w '^10.1.22.0/24' ; if [ $? -ne 0 ] ; then ip route add \"10.1.22.0/24\" via \"192.168.100.238\" ; fi\nip route show \"10.2.22.0/24\" via 99.99.99.2 | grep -w '^10.2.22.0/24'; if [ $? -ne 0 ] ; then ip route add \"10.2.22.0/24\" via 99.99.99.2 ; fi\n", "delta": "0:00:00.009562", "end": "2019-11-17 10:35:30.706259", "item": [{"bridge_ip": "2.2.2.1", "bridge_name": "t3br2", "default_route_ip": "10.1.22.1", "dns": [{"brif": "t3s2_dnsbrif", "dhcp_end": "2.2.2.126", "dhcp_start": "2.2.2.5", "dnsif": "t3s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t3ns2", "route": [{"if": "p1", "ip": "10.1.22.1/24", "ns_if": "t3if", "ns_name": "t3"}], "tenant_ns": [{"tenant_ns_if": "t3ns2if", "tenant_ns_ip": "10.1.22.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s2if", "tenant_sub_ip": "10.1.22.2/24"}], "vms": [{"brif": "t3br2if1", "disk": "10G", "mem": 3, "name": "t3_VM3", "vcpu": 2, "vmif": "t3VM3if1"}]}, {"dev": "t3s2if", "dsport": 4789, "id": 42, "local_ip": "10.1.22.2", "remote_ip": "10.2.22.2", "remote_route": "10.2.22.0/24", "subnet_route": "10.1.22.0/24", "tenant_route_ip": "192.168.3.2", "v_name": "vxlan_t3s2"}], "rc": 0, "start": "2019-11-17 10:35:30.696697", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

PLAY RECAP **************************************************************************************************************************************************
localhost                  : ok=3    changed=2    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0   

Using /etc/ansible/ansible.cfg as config file

PLAY [worker] ***********************************************************************************************************************************************

TASK [Add VXLAN routes in PNS] ******************************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.21.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.2.21.1', u'bridge_name': u't3br1', u'dns': [{u'dnsif': u't3s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't3s1_dnsbrif'}], u'ns_name': u't3ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.21.2/24', u'tenant_ns_ip': u'10.2.21.1/24', u'tenant_ns_if': u't3ns1if', u'tenant_sub_if': u't3s1if', u'tenant_ns_name': u't3'}], u'bridge_ip': u'1.1.1.1', u'vms': [{u'mem': 2, u'name': u't3_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't3br1if1', u'vmif': u't3VM4if1'}, {u'mem': 2, u'name': u't3_VM5', u'vcpu': 4, u'disk': u'10G', u'brif': u't3br1if2', u'vmif': u't3VM5if1'}]}, {u'local_ip': u'10.2.21.2', u'dsport': 4789, u'dev': u't3s1if', u'tenant_route_ip': u'192.168.131.2', u'remote_route': u'10.1.21.0/24', u'subnet_route': u'10.2.21.0/24', u'v_name': u'vxlan_t3s1', u'id': 42, u'remote_ip': u'10.1.21.2'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec pns ip route show \"10.2.21.0/24\" via \"192.168.131.2\" | grep -w '^10.2.21.0/24' ; if [ $? -ne 0 ] ; then ip netns exec pns ip route add \"10.2.21.0/24\" via \"192.168.131.2\" ; fi\n", "delta": "0:00:00.038221", "end": "2019-11-17 10:35:31.904536", "item": [{"bridge_ip": "1.1.1.1", "bridge_name": "t3br1", "default_route_ip": "10.2.21.1", "dns": [{"brif": "t3s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t3s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "ns_name": "t3ns1", "route": [{"if": "p1", "ip": "10.2.21.1/24", "ns_if": "t3if", "ns_name": "t3"}], "tenant_ns": [{"tenant_ns_if": "t3ns1if", "tenant_ns_ip": "10.2.21.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s1if", "tenant_sub_ip": "10.2.21.2/24"}], "vms": [{"brif": "t3br1if1", "disk": "10G", "mem": 2, "name": "t3_VM4", "vcpu": 4, "vmif": "t3VM4if1"}, {"brif": "t3br1if2", "disk": "10G", "mem": 2, "name": "t3_VM5", "vcpu": 4, "vmif": "t3VM5if1"}]}, {"dev": "t3s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.21.2", "remote_ip": "10.1.21.2", "remote_route": "10.1.21.0/24", "subnet_route": "10.2.21.0/24", "tenant_route_ip": "192.168.131.2", "v_name": "vxlan_t3s1"}], "rc": 0, "start": "2019-11-17 10:35:31.866315", "stderr": "", "stderr_lines": [], "stdout": "10.2.21.0/24 dev t3pns_if ", "stdout_lines": ["10.2.21.0/24 dev t3pns_if "]}
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.22.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.2.22.1', u'bridge_name': u't3br2', u'dns': [{u'dnsif': u't3s2_dnsif', u'dhcp_start': u'2.2.2.133', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.128/24', u'net_mask': u'255.255.255.0', u'brif': u't3s2_dnsbrif'}], u'ns_name': u't3ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.22.2/24', u'tenant_ns_ip': u'10.2.22.1/24', u'tenant_ns_if': u't3ns2if', u'tenant_sub_if': u't3s2if', u'tenant_ns_name': u't3'}], u'bridge_ip': u'2.2.2.1', u'vms': [{u'mem': 2, u'name': u't3_VM6', u'vcpu': 4, u'disk': u'10G', u'brif': u't3br2if1', u'vmif': u't3VM6if1'}]}, {u'local_ip': u'10.2.22.2', u'dsport': 4789, u'dev': u't3s2if', u'tenant_route_ip': u'192.168.131.2', u'remote_route': u'10.1.22.0/24', u'subnet_route': u'10.2.22.0/24', u'v_name': u'vxlan_t3s2', u'id': 42, u'remote_ip': u'10.1.22.2'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec pns ip route show \"10.2.22.0/24\" via \"192.168.131.2\" | grep -w '^10.2.22.0/24' ; if [ $? -ne 0 ] ; then ip netns exec pns ip route add \"10.2.22.0/24\" via \"192.168.131.2\" ; fi\n", "delta": "0:00:00.080402", "end": "2019-11-17 10:35:32.320492", "item": [{"bridge_ip": "2.2.2.1", "bridge_name": "t3br2", "default_route_ip": "10.2.22.1", "dns": [{"brif": "t3s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.133", "dnsif": "t3s2_dnsif", "dnsif_ip": "2.2.2.128/24", "net_mask": "255.255.255.0"}], "ns_name": "t3ns2", "route": [{"if": "p1", "ip": "10.2.22.1/24", "ns_if": "t3if", "ns_name": "t3"}], "tenant_ns": [{"tenant_ns_if": "t3ns2if", "tenant_ns_ip": "10.2.22.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s2if", "tenant_sub_ip": "10.2.22.2/24"}], "vms": [{"brif": "t3br2if1", "disk": "10G", "mem": 2, "name": "t3_VM6", "vcpu": 4, "vmif": "t3VM6if1"}]}, {"dev": "t3s2if", "dsport": 4789, "id": 42, "local_ip": "10.2.22.2", "remote_ip": "10.1.22.2", "remote_route": "10.1.22.0/24", "subnet_route": "10.2.22.0/24", "tenant_route_ip": "192.168.131.2", "v_name": "vxlan_t3s2"}], "rc": 0, "start": "2019-11-17 10:35:32.240090", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Get PNS ip address] ***********************************************************************************************************************************
ok: [99.99.99.2] => {"changed": false, "cmd": "ip netns exec pns ip addr show p1 | awk 'FNR==3{ print $2 }' | awk -F/ '{ print $1 }'\n", "delta": "0:00:00.037133", "end": "2019-11-17 10:35:32.728649", "rc": 0, "start": "2019-11-17 10:35:32.691516", "stderr": "", "stderr_lines": [], "stdout": "192.168.100.50", "stdout_lines": ["192.168.100.50"]}

TASK [Add VXLAN routes to host] *****************************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.21.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.2.21.1', u'bridge_name': u't3br1', u'dns': [{u'dnsif': u't3s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't3s1_dnsbrif'}], u'ns_name': u't3ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.21.2/24', u'tenant_ns_ip': u'10.2.21.1/24', u'tenant_ns_if': u't3ns1if', u'tenant_sub_if': u't3s1if', u'tenant_ns_name': u't3'}], u'bridge_ip': u'1.1.1.1', u'vms': [{u'mem': 2, u'name': u't3_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't3br1if1', u'vmif': u't3VM4if1'}, {u'mem': 2, u'name': u't3_VM5', u'vcpu': 4, u'disk': u'10G', u'brif': u't3br1if2', u'vmif': u't3VM5if1'}]}, {u'local_ip': u'10.2.21.2', u'dsport': 4789, u'dev': u't3s1if', u'tenant_route_ip': u'192.168.131.2', u'remote_route': u'10.1.21.0/24', u'subnet_route': u'10.2.21.0/24', u'v_name': u'vxlan_t3s1', u'id': 42, u'remote_ip': u'10.1.21.2'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip route show \"10.2.21.0/24\" via \"192.168.100.50\" | grep -w '^10.2.21.0/24' ; if [ $? -ne 0 ] ; then ip route add \"10.2.21.0/24\" via \"192.168.100.50\" ; fi\nip route show \"10.1.21.0/24\" via 99.99.99.1 | grep -w '^10.1.21.0/24'; if [ $? -ne 0 ] ; then ip route add \"10.1.21.0/24\" via 99.99.99.1 ; fi\n", "delta": "0:00:00.006371", "end": "2019-11-17 10:35:33.144238", "item": [{"bridge_ip": "1.1.1.1", "bridge_name": "t3br1", "default_route_ip": "10.2.21.1", "dns": [{"brif": "t3s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t3s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "ns_name": "t3ns1", "route": [{"if": "p1", "ip": "10.2.21.1/24", "ns_if": "t3if", "ns_name": "t3"}], "tenant_ns": [{"tenant_ns_if": "t3ns1if", "tenant_ns_ip": "10.2.21.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s1if", "tenant_sub_ip": "10.2.21.2/24"}], "vms": [{"brif": "t3br1if1", "disk": "10G", "mem": 2, "name": "t3_VM4", "vcpu": 4, "vmif": "t3VM4if1"}, {"brif": "t3br1if2", "disk": "10G", "mem": 2, "name": "t3_VM5", "vcpu": 4, "vmif": "t3VM5if1"}]}, {"dev": "t3s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.21.2", "remote_ip": "10.1.21.2", "remote_route": "10.1.21.0/24", "subnet_route": "10.2.21.0/24", "tenant_route_ip": "192.168.131.2", "v_name": "vxlan_t3s1"}], "rc": 0, "start": "2019-11-17 10:35:33.137867", "stderr": "", "stderr_lines": [], "stdout": "10.2.21.0/24 dev testBR \n10.1.21.0/24 dev ens4 ", "stdout_lines": ["10.2.21.0/24 dev testBR ", "10.1.21.0/24 dev ens4 "]}
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.22.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.2.22.1', u'bridge_name': u't3br2', u'dns': [{u'dnsif': u't3s2_dnsif', u'dhcp_start': u'2.2.2.133', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.128/24', u'net_mask': u'255.255.255.0', u'brif': u't3s2_dnsbrif'}], u'ns_name': u't3ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.22.2/24', u'tenant_ns_ip': u'10.2.22.1/24', u'tenant_ns_if': u't3ns2if', u'tenant_sub_if': u't3s2if', u'tenant_ns_name': u't3'}], u'bridge_ip': u'2.2.2.1', u'vms': [{u'mem': 2, u'name': u't3_VM6', u'vcpu': 4, u'disk': u'10G', u'brif': u't3br2if1', u'vmif': u't3VM6if1'}]}, {u'local_ip': u'10.2.22.2', u'dsport': 4789, u'dev': u't3s2if', u'tenant_route_ip': u'192.168.131.2', u'remote_route': u'10.1.22.0/24', u'subnet_route': u'10.2.22.0/24', u'v_name': u'vxlan_t3s2', u'id': 42, u'remote_ip': u'10.1.22.2'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip route show \"10.2.22.0/24\" via \"192.168.100.50\" | grep -w '^10.2.22.0/24' ; if [ $? -ne 0 ] ; then ip route add \"10.2.22.0/24\" via \"192.168.100.50\" ; fi\nip route show \"10.1.22.0/24\" via 99.99.99.1 | grep -w '^10.1.22.0/24'; if [ $? -ne 0 ] ; then ip route add \"10.1.22.0/24\" via 99.99.99.1 ; fi\n", "delta": "0:00:00.007754", "end": "2019-11-17 10:35:33.483031", "item": [{"bridge_ip": "2.2.2.1", "bridge_name": "t3br2", "default_route_ip": "10.2.22.1", "dns": [{"brif": "t3s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.133", "dnsif": "t3s2_dnsif", "dnsif_ip": "2.2.2.128/24", "net_mask": "255.255.255.0"}], "ns_name": "t3ns2", "route": [{"if": "p1", "ip": "10.2.22.1/24", "ns_if": "t3if", "ns_name": "t3"}], "tenant_ns": [{"tenant_ns_if": "t3ns2if", "tenant_ns_ip": "10.2.22.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s2if", "tenant_sub_ip": "10.2.22.2/24"}], "vms": [{"brif": "t3br2if1", "disk": "10G", "mem": 2, "name": "t3_VM6", "vcpu": 4, "vmif": "t3VM6if1"}]}, {"dev": "t3s2if", "dsport": 4789, "id": 42, "local_ip": "10.2.22.2", "remote_ip": "10.1.22.2", "remote_route": "10.1.22.0/24", "subnet_route": "10.2.22.0/24", "tenant_route_ip": "192.168.131.2", "v_name": "vxlan_t3s2"}], "rc": 0, "start": "2019-11-17 10:35:33.475277", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

PLAY RECAP **************************************************************************************************************************************************
99.99.99.2                 : ok=3    changed=2    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0   

Using /etc/ansible/ansible.cfg as config file

PLAY [main] *************************************************************************************************************************************************

TASK [Create VM templates (C1)] *****************************************************************************************************************************
ok: [localhost] => (item=[{u'route': [{u'ip': u'10.1.21.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.1.21.1', u'bridge_name': u't3br1', u'dns': [{u'dnsif': u't3s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't3s1_dnsbrif'}], u'ns_name': u't3ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.21.2/24', u'tenant_ns_ip': u'10.1.21.1/24', u'tenant_ns_if': u't3ns1if', u'tenant_sub_if': u't3s1if', u'tenant_ns_name': u't3'}], u'bridge_ip': u'1.1.1.1', u'vxlan': [{u'local_ip': u'10.1.21.2', u'dsport': 4789, u'dev': u't3s1if', u'tenant_route_ip': u'192.168.3.2', u'remote_route': u'10.2.21.0/24', u'subnet_route': u'10.1.21.0/24', u'v_name': u'vxlan_t3s1', u'id': 42, u'remote_ip': u'10.2.21.2'}]}, {u'mem': 2, u'name': u't3_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't3br1if1', u'vmif': u't3VM1if1'}]) => {"ansible_loop_var": "item", "changed": false, "checksum": "350ba870bd31b7f6ee517845c14237910b5af0bf", "dest": "/root/Migration-as-a-Service/t3/VM_templates/t3_VM1.xml.j2", "gid": 0, "group": "root", "item": [{"bridge_ip": "1.1.1.1", "bridge_name": "t3br1", "default_route_ip": "10.1.21.1", "dns": [{"brif": "t3s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t3s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t3ns1", "route": [{"if": "p1", "ip": "10.1.21.1/24", "ns_if": "t3if", "ns_name": "t3"}], "tenant_ns": [{"tenant_ns_if": "t3ns1if", "tenant_ns_ip": "10.1.21.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s1if", "tenant_sub_ip": "10.1.21.2/24"}], "vxlan": [{"dev": "t3s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.21.2", "remote_ip": "10.2.21.2", "remote_route": "10.2.21.0/24", "subnet_route": "10.1.21.0/24", "tenant_route_ip": "192.168.3.2", "v_name": "vxlan_t3s1"}]}, {"brif": "t3br1if1", "disk": "10G", "mem": 2, "name": "t3_VM1", "vcpu": 4, "vmif": "t3VM1if1"}], "mode": "0644", "owner": "root", "path": "/root/Migration-as-a-Service/t3/VM_templates/t3_VM1.xml.j2", "size": 4091, "state": "file", "uid": 0}
ok: [localhost] => (item=[{u'route': [{u'ip': u'10.1.21.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.1.21.1', u'bridge_name': u't3br1', u'dns': [{u'dnsif': u't3s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't3s1_dnsbrif'}], u'ns_name': u't3ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.21.2/24', u'tenant_ns_ip': u'10.1.21.1/24', u'tenant_ns_if': u't3ns1if', u'tenant_sub_if': u't3s1if', u'tenant_ns_name': u't3'}], u'bridge_ip': u'1.1.1.1', u'vxlan': [{u'local_ip': u'10.1.21.2', u'dsport': 4789, u'dev': u't3s1if', u'tenant_route_ip': u'192.168.3.2', u'remote_route': u'10.2.21.0/24', u'subnet_route': u'10.1.21.0/24', u'v_name': u'vxlan_t3s1', u'id': 42, u'remote_ip': u'10.2.21.2'}]}, {u'mem': 4, u'name': u't3_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't3br1if2', u'vmif': u't3VM2if1'}]) => {"ansible_loop_var": "item", "changed": false, "checksum": "350ba870bd31b7f6ee517845c14237910b5af0bf", "dest": "/root/Migration-as-a-Service/t3/VM_templates/t3_VM2.xml.j2", "gid": 0, "group": "root", "item": [{"bridge_ip": "1.1.1.1", "bridge_name": "t3br1", "default_route_ip": "10.1.21.1", "dns": [{"brif": "t3s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t3s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t3ns1", "route": [{"if": "p1", "ip": "10.1.21.1/24", "ns_if": "t3if", "ns_name": "t3"}], "tenant_ns": [{"tenant_ns_if": "t3ns1if", "tenant_ns_ip": "10.1.21.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s1if", "tenant_sub_ip": "10.1.21.2/24"}], "vxlan": [{"dev": "t3s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.21.2", "remote_ip": "10.2.21.2", "remote_route": "10.2.21.0/24", "subnet_route": "10.1.21.0/24", "tenant_route_ip": "192.168.3.2", "v_name": "vxlan_t3s1"}]}, {"brif": "t3br1if2", "disk": "10G", "mem": 4, "name": "t3_VM2", "vcpu": 2, "vmif": "t3VM2if1"}], "mode": "0644", "owner": "root", "path": "/root/Migration-as-a-Service/t3/VM_templates/t3_VM2.xml.j2", "size": 4091, "state": "file", "uid": 0}
ok: [localhost] => (item=[{u'route': [{u'ip': u'10.1.22.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.1.22.1', u'bridge_name': u't3br2', u'dns': [{u'dnsif': u't3s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.126', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't3s2_dnsbrif'}], u'ns_name': u't3ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.22.2/24', u'tenant_ns_ip': u'10.1.22.1/24', u'tenant_ns_if': u't3ns2if', u'tenant_sub_if': u't3s2if', u'tenant_ns_name': u't3'}], u'bridge_ip': u'2.2.2.1', u'vxlan': [{u'local_ip': u'10.1.22.2', u'dsport': 4789, u'dev': u't3s2if', u'tenant_route_ip': u'192.168.3.2', u'remote_route': u'10.2.22.0/24', u'subnet_route': u'10.1.22.0/24', u'v_name': u'vxlan_t3s2', u'id': 42, u'remote_ip': u'10.2.22.2'}]}, {u'mem': 3, u'name': u't3_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't3br2if1', u'vmif': u't3VM3if1'}]) => {"ansible_loop_var": "item", "changed": false, "checksum": "350ba870bd31b7f6ee517845c14237910b5af0bf", "dest": "/root/Migration-as-a-Service/t3/VM_templates/t3_VM3.xml.j2", "gid": 0, "group": "root", "item": [{"bridge_ip": "2.2.2.1", "bridge_name": "t3br2", "default_route_ip": "10.1.22.1", "dns": [{"brif": "t3s2_dnsbrif", "dhcp_end": "2.2.2.126", "dhcp_start": "2.2.2.5", "dnsif": "t3s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t3ns2", "route": [{"if": "p1", "ip": "10.1.22.1/24", "ns_if": "t3if", "ns_name": "t3"}], "tenant_ns": [{"tenant_ns_if": "t3ns2if", "tenant_ns_ip": "10.1.22.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s2if", "tenant_sub_ip": "10.1.22.2/24"}], "vxlan": [{"dev": "t3s2if", "dsport": 4789, "id": 42, "local_ip": "10.1.22.2", "remote_ip": "10.2.22.2", "remote_route": "10.2.22.0/24", "subnet_route": "10.1.22.0/24", "tenant_route_ip": "192.168.3.2", "v_name": "vxlan_t3s2"}]}, {"brif": "t3br2if1", "disk": "10G", "mem": 3, "name": "t3_VM3", "vcpu": 2, "vmif": "t3VM3if1"}], "mode": "0644", "owner": "root", "path": "/root/Migration-as-a-Service/t3/VM_templates/t3_VM3.xml.j2", "size": 4091, "state": "file", "uid": 0}

PLAY RECAP **************************************************************************************************************************************************
localhost                  : ok=1    changed=0    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0   

Using /etc/ansible/ansible.cfg as config file

PLAY [main] *************************************************************************************************************************************************

TASK [Create VM templates (C2)] *****************************************************************************************************************************
ok: [localhost] => (item=[{u'route': [{u'ip': u'10.2.21.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.2.21.1', u'bridge_name': u't3br1', u'dns': [{u'dnsif': u't3s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't3s1_dnsbrif'}], u'ns_name': u't3ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.21.2/24', u'tenant_ns_ip': u'10.2.21.1/24', u'tenant_ns_if': u't3ns1if', u'tenant_sub_if': u't3s1if', u'tenant_ns_name': u't3'}], u'bridge_ip': u'1.1.1.1', u'vxlan': [{u'local_ip': u'10.2.21.2', u'dsport': 4789, u'dev': u't3s1if', u'tenant_route_ip': u'192.168.131.2', u'remote_route': u'10.1.21.0/24', u'subnet_route': u'10.2.21.0/24', u'v_name': u'vxlan_t3s1', u'id': 42, u'remote_ip': u'10.1.21.2'}]}, {u'mem': 2, u'name': u't3_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't3br1if1', u'vmif': u't3VM4if1'}]) => {"ansible_loop_var": "item", "changed": false, "checksum": "350ba870bd31b7f6ee517845c14237910b5af0bf", "dest": "/root/Migration-as-a-Service/t3/VM_templates/t3_VM4.xml.j2", "gid": 0, "group": "root", "item": [{"bridge_ip": "1.1.1.1", "bridge_name": "t3br1", "default_route_ip": "10.2.21.1", "dns": [{"brif": "t3s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t3s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "ns_name": "t3ns1", "route": [{"if": "p1", "ip": "10.2.21.1/24", "ns_if": "t3if", "ns_name": "t3"}], "tenant_ns": [{"tenant_ns_if": "t3ns1if", "tenant_ns_ip": "10.2.21.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s1if", "tenant_sub_ip": "10.2.21.2/24"}], "vxlan": [{"dev": "t3s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.21.2", "remote_ip": "10.1.21.2", "remote_route": "10.1.21.0/24", "subnet_route": "10.2.21.0/24", "tenant_route_ip": "192.168.131.2", "v_name": "vxlan_t3s1"}]}, {"brif": "t3br1if1", "disk": "10G", "mem": 2, "name": "t3_VM4", "vcpu": 4, "vmif": "t3VM4if1"}], "mode": "0644", "owner": "root", "path": "/root/Migration-as-a-Service/t3/VM_templates/t3_VM4.xml.j2", "size": 4091, "state": "file", "uid": 0}
ok: [localhost] => (item=[{u'route': [{u'ip': u'10.2.21.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.2.21.1', u'bridge_name': u't3br1', u'dns': [{u'dnsif': u't3s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't3s1_dnsbrif'}], u'ns_name': u't3ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.21.2/24', u'tenant_ns_ip': u'10.2.21.1/24', u'tenant_ns_if': u't3ns1if', u'tenant_sub_if': u't3s1if', u'tenant_ns_name': u't3'}], u'bridge_ip': u'1.1.1.1', u'vxlan': [{u'local_ip': u'10.2.21.2', u'dsport': 4789, u'dev': u't3s1if', u'tenant_route_ip': u'192.168.131.2', u'remote_route': u'10.1.21.0/24', u'subnet_route': u'10.2.21.0/24', u'v_name': u'vxlan_t3s1', u'id': 42, u'remote_ip': u'10.1.21.2'}]}, {u'mem': 2, u'name': u't3_VM5', u'vcpu': 4, u'disk': u'10G', u'brif': u't3br1if2', u'vmif': u't3VM5if1'}]) => {"ansible_loop_var": "item", "changed": false, "checksum": "350ba870bd31b7f6ee517845c14237910b5af0bf", "dest": "/root/Migration-as-a-Service/t3/VM_templates/t3_VM5.xml.j2", "gid": 0, "group": "root", "item": [{"bridge_ip": "1.1.1.1", "bridge_name": "t3br1", "default_route_ip": "10.2.21.1", "dns": [{"brif": "t3s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t3s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "ns_name": "t3ns1", "route": [{"if": "p1", "ip": "10.2.21.1/24", "ns_if": "t3if", "ns_name": "t3"}], "tenant_ns": [{"tenant_ns_if": "t3ns1if", "tenant_ns_ip": "10.2.21.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s1if", "tenant_sub_ip": "10.2.21.2/24"}], "vxlan": [{"dev": "t3s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.21.2", "remote_ip": "10.1.21.2", "remote_route": "10.1.21.0/24", "subnet_route": "10.2.21.0/24", "tenant_route_ip": "192.168.131.2", "v_name": "vxlan_t3s1"}]}, {"brif": "t3br1if2", "disk": "10G", "mem": 2, "name": "t3_VM5", "vcpu": 4, "vmif": "t3VM5if1"}], "mode": "0644", "owner": "root", "path": "/root/Migration-as-a-Service/t3/VM_templates/t3_VM5.xml.j2", "size": 4091, "state": "file", "uid": 0}
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.2.22.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.2.22.1', u'bridge_name': u't3br2', u'dns': [{u'dnsif': u't3s2_dnsif', u'dhcp_start': u'2.2.2.133', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.128/24', u'net_mask': u'255.255.255.0', u'brif': u't3s2_dnsbrif'}], u'ns_name': u't3ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.22.2/24', u'tenant_ns_ip': u'10.2.22.1/24', u'tenant_ns_if': u't3ns2if', u'tenant_sub_if': u't3s2if', u'tenant_ns_name': u't3'}], u'bridge_ip': u'2.2.2.1', u'vxlan': [{u'local_ip': u'10.2.22.2', u'dsport': 4789, u'dev': u't3s2if', u'tenant_route_ip': u'192.168.131.2', u'remote_route': u'10.1.22.0/24', u'subnet_route': u'10.2.22.0/24', u'v_name': u'vxlan_t3s2', u'id': 42, u'remote_ip': u'10.1.22.2'}]}, {u'mem': 2, u'name': u't3_VM6', u'vcpu': 4, u'disk': u'10G', u'brif': u't3br2if1', u'vmif': u't3VM6if1'}]) => {"ansible_loop_var": "item", "changed": true, "checksum": "350ba870bd31b7f6ee517845c14237910b5af0bf", "dest": "/root/Migration-as-a-Service/t3/VM_templates/t3_VM6.xml.j2", "gid": 0, "group": "root", "item": [{"bridge_ip": "2.2.2.1", "bridge_name": "t3br2", "default_route_ip": "10.2.22.1", "dns": [{"brif": "t3s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.133", "dnsif": "t3s2_dnsif", "dnsif_ip": "2.2.2.128/24", "net_mask": "255.255.255.0"}], "ns_name": "t3ns2", "route": [{"if": "p1", "ip": "10.2.22.1/24", "ns_if": "t3if", "ns_name": "t3"}], "tenant_ns": [{"tenant_ns_if": "t3ns2if", "tenant_ns_ip": "10.2.22.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s2if", "tenant_sub_ip": "10.2.22.2/24"}], "vxlan": [{"dev": "t3s2if", "dsport": 4789, "id": 42, "local_ip": "10.2.22.2", "remote_ip": "10.1.22.2", "remote_route": "10.1.22.0/24", "subnet_route": "10.2.22.0/24", "tenant_route_ip": "192.168.131.2", "v_name": "vxlan_t3s2"}]}, {"brif": "t3br2if1", "disk": "10G", "mem": 2, "name": "t3_VM6", "vcpu": 4, "vmif": "t3VM6if1"}], "md5sum": "fbfc2eb0c2569531f25eea92c26d3bee", "mode": "0644", "owner": "root", "size": 4091, "src": "/root/.ansible/tmp/ansible-tmp-1573986936.69-264394370216259/source", "state": "file", "uid": 0}

PLAY RECAP **************************************************************************************************************************************************
localhost                  : ok=1    changed=1    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0   

Using /etc/ansible/ansible.cfg as config file

PLAY [main] *************************************************************************************************************************************************

TASK [Copy VM image] ****************************************************************************************************************************************
ok: [localhost] => (item=[{u'route': [{u'ip': u'10.1.21.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.1.21.1', u'bridge_name': u't3br1', u'dns': [{u'dnsif': u't3s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't3s1_dnsbrif'}], u'ns_name': u't3ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.21.2/24', u'tenant_ns_ip': u'10.1.21.1/24', u'tenant_ns_if': u't3ns1if', u'tenant_sub_if': u't3s1if', u'tenant_ns_name': u't3'}], u'bridge_ip': u'1.1.1.1', u'vxlan': [{u'local_ip': u'10.1.21.2', u'dsport': 4789, u'dev': u't3s1if', u'tenant_route_ip': u'192.168.3.2', u'remote_route': u'10.2.21.0/24', u'subnet_route': u'10.1.21.0/24', u'v_name': u'vxlan_t3s1', u'id': 42, u'remote_ip': u'10.2.21.2'}]}, {u'mem': 2, u'name': u't3_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't3br1if1', u'vmif': u't3VM1if1'}]) => {"ansible_loop_var": "item", "changed": false, "dest": "/var/lib/libvirt/images/t3_VM1.qcow2", "item": [{"bridge_ip": "1.1.1.1", "bridge_name": "t3br1", "default_route_ip": "10.1.21.1", "dns": [{"brif": "t3s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t3s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t3ns1", "route": [{"if": "p1", "ip": "10.1.21.1/24", "ns_if": "t3if", "ns_name": "t3"}], "tenant_ns": [{"tenant_ns_if": "t3ns1if", "tenant_ns_ip": "10.1.21.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s1if", "tenant_sub_ip": "10.1.21.2/24"}], "vxlan": [{"dev": "t3s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.21.2", "remote_ip": "10.2.21.2", "remote_route": "10.2.21.0/24", "subnet_route": "10.1.21.0/24", "tenant_route_ip": "192.168.3.2", "v_name": "vxlan_t3s1"}]}, {"brif": "t3br1if1", "disk": "10G", "mem": 2, "name": "t3_VM1", "vcpu": 4, "vmif": "t3VM1if1"}], "src": "/root/mainVM.qcow2"}
ok: [localhost] => (item=[{u'route': [{u'ip': u'10.1.21.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.1.21.1', u'bridge_name': u't3br1', u'dns': [{u'dnsif': u't3s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't3s1_dnsbrif'}], u'ns_name': u't3ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.21.2/24', u'tenant_ns_ip': u'10.1.21.1/24', u'tenant_ns_if': u't3ns1if', u'tenant_sub_if': u't3s1if', u'tenant_ns_name': u't3'}], u'bridge_ip': u'1.1.1.1', u'vxlan': [{u'local_ip': u'10.1.21.2', u'dsport': 4789, u'dev': u't3s1if', u'tenant_route_ip': u'192.168.3.2', u'remote_route': u'10.2.21.0/24', u'subnet_route': u'10.1.21.0/24', u'v_name': u'vxlan_t3s1', u'id': 42, u'remote_ip': u'10.2.21.2'}]}, {u'mem': 4, u'name': u't3_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't3br1if2', u'vmif': u't3VM2if1'}]) => {"ansible_loop_var": "item", "changed": false, "dest": "/var/lib/libvirt/images/t3_VM2.qcow2", "item": [{"bridge_ip": "1.1.1.1", "bridge_name": "t3br1", "default_route_ip": "10.1.21.1", "dns": [{"brif": "t3s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t3s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t3ns1", "route": [{"if": "p1", "ip": "10.1.21.1/24", "ns_if": "t3if", "ns_name": "t3"}], "tenant_ns": [{"tenant_ns_if": "t3ns1if", "tenant_ns_ip": "10.1.21.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s1if", "tenant_sub_ip": "10.1.21.2/24"}], "vxlan": [{"dev": "t3s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.21.2", "remote_ip": "10.2.21.2", "remote_route": "10.2.21.0/24", "subnet_route": "10.1.21.0/24", "tenant_route_ip": "192.168.3.2", "v_name": "vxlan_t3s1"}]}, {"brif": "t3br1if2", "disk": "10G", "mem": 4, "name": "t3_VM2", "vcpu": 2, "vmif": "t3VM2if1"}], "src": "/root/mainVM.qcow2"}
ok: [localhost] => (item=[{u'route': [{u'ip': u'10.1.22.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.1.22.1', u'bridge_name': u't3br2', u'dns': [{u'dnsif': u't3s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.126', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't3s2_dnsbrif'}], u'ns_name': u't3ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.22.2/24', u'tenant_ns_ip': u'10.1.22.1/24', u'tenant_ns_if': u't3ns2if', u'tenant_sub_if': u't3s2if', u'tenant_ns_name': u't3'}], u'bridge_ip': u'2.2.2.1', u'vxlan': [{u'local_ip': u'10.1.22.2', u'dsport': 4789, u'dev': u't3s2if', u'tenant_route_ip': u'192.168.3.2', u'remote_route': u'10.2.22.0/24', u'subnet_route': u'10.1.22.0/24', u'v_name': u'vxlan_t3s2', u'id': 42, u'remote_ip': u'10.2.22.2'}]}, {u'mem': 3, u'name': u't3_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't3br2if1', u'vmif': u't3VM3if1'}]) => {"ansible_loop_var": "item", "changed": false, "dest": "/var/lib/libvirt/images/t3_VM3.qcow2", "item": [{"bridge_ip": "2.2.2.1", "bridge_name": "t3br2", "default_route_ip": "10.1.22.1", "dns": [{"brif": "t3s2_dnsbrif", "dhcp_end": "2.2.2.126", "dhcp_start": "2.2.2.5", "dnsif": "t3s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t3ns2", "route": [{"if": "p1", "ip": "10.1.22.1/24", "ns_if": "t3if", "ns_name": "t3"}], "tenant_ns": [{"tenant_ns_if": "t3ns2if", "tenant_ns_ip": "10.1.22.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s2if", "tenant_sub_ip": "10.1.22.2/24"}], "vxlan": [{"dev": "t3s2if", "dsport": 4789, "id": 42, "local_ip": "10.1.22.2", "remote_ip": "10.2.22.2", "remote_route": "10.2.22.0/24", "subnet_route": "10.1.22.0/24", "tenant_route_ip": "192.168.3.2", "v_name": "vxlan_t3s2"}]}, {"brif": "t3br2if1", "disk": "10G", "mem": 3, "name": "t3_VM3", "vcpu": 2, "vmif": "t3VM3if1"}], "src": "/root/mainVM.qcow2"}

TASK [Create VM templates (C1)] *****************************************************************************************************************************
ok: [localhost] => (item=[{u'route': [{u'ip': u'10.1.21.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.1.21.1', u'bridge_name': u't3br1', u'dns': [{u'dnsif': u't3s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't3s1_dnsbrif'}], u'ns_name': u't3ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.21.2/24', u'tenant_ns_ip': u'10.1.21.1/24', u'tenant_ns_if': u't3ns1if', u'tenant_sub_if': u't3s1if', u'tenant_ns_name': u't3'}], u'bridge_ip': u'1.1.1.1', u'vxlan': [{u'local_ip': u'10.1.21.2', u'dsport': 4789, u'dev': u't3s1if', u'tenant_route_ip': u'192.168.3.2', u'remote_route': u'10.2.21.0/24', u'subnet_route': u'10.1.21.0/24', u'v_name': u'vxlan_t3s1', u'id': 42, u'remote_ip': u'10.2.21.2'}]}, {u'mem': 2, u'name': u't3_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't3br1if1', u'vmif': u't3VM1if1'}]) => {"ansible_loop_var": "item", "changed": false, "checksum": "350ba870bd31b7f6ee517845c14237910b5af0bf", "dest": "/root/Migration-as-a-Service/t3/VM_templates/t3_VM1.xml.j2", "gid": 0, "group": "root", "item": [{"bridge_ip": "1.1.1.1", "bridge_name": "t3br1", "default_route_ip": "10.1.21.1", "dns": [{"brif": "t3s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t3s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t3ns1", "route": [{"if": "p1", "ip": "10.1.21.1/24", "ns_if": "t3if", "ns_name": "t3"}], "tenant_ns": [{"tenant_ns_if": "t3ns1if", "tenant_ns_ip": "10.1.21.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s1if", "tenant_sub_ip": "10.1.21.2/24"}], "vxlan": [{"dev": "t3s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.21.2", "remote_ip": "10.2.21.2", "remote_route": "10.2.21.0/24", "subnet_route": "10.1.21.0/24", "tenant_route_ip": "192.168.3.2", "v_name": "vxlan_t3s1"}]}, {"brif": "t3br1if1", "disk": "10G", "mem": 2, "name": "t3_VM1", "vcpu": 4, "vmif": "t3VM1if1"}], "mode": "0644", "owner": "root", "path": "/root/Migration-as-a-Service/t3/VM_templates/t3_VM1.xml.j2", "size": 4091, "state": "file", "uid": 0}
ok: [localhost] => (item=[{u'route': [{u'ip': u'10.1.21.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.1.21.1', u'bridge_name': u't3br1', u'dns': [{u'dnsif': u't3s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't3s1_dnsbrif'}], u'ns_name': u't3ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.21.2/24', u'tenant_ns_ip': u'10.1.21.1/24', u'tenant_ns_if': u't3ns1if', u'tenant_sub_if': u't3s1if', u'tenant_ns_name': u't3'}], u'bridge_ip': u'1.1.1.1', u'vxlan': [{u'local_ip': u'10.1.21.2', u'dsport': 4789, u'dev': u't3s1if', u'tenant_route_ip': u'192.168.3.2', u'remote_route': u'10.2.21.0/24', u'subnet_route': u'10.1.21.0/24', u'v_name': u'vxlan_t3s1', u'id': 42, u'remote_ip': u'10.2.21.2'}]}, {u'mem': 4, u'name': u't3_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't3br1if2', u'vmif': u't3VM2if1'}]) => {"ansible_loop_var": "item", "changed": false, "checksum": "350ba870bd31b7f6ee517845c14237910b5af0bf", "dest": "/root/Migration-as-a-Service/t3/VM_templates/t3_VM2.xml.j2", "gid": 0, "group": "root", "item": [{"bridge_ip": "1.1.1.1", "bridge_name": "t3br1", "default_route_ip": "10.1.21.1", "dns": [{"brif": "t3s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t3s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t3ns1", "route": [{"if": "p1", "ip": "10.1.21.1/24", "ns_if": "t3if", "ns_name": "t3"}], "tenant_ns": [{"tenant_ns_if": "t3ns1if", "tenant_ns_ip": "10.1.21.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s1if", "tenant_sub_ip": "10.1.21.2/24"}], "vxlan": [{"dev": "t3s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.21.2", "remote_ip": "10.2.21.2", "remote_route": "10.2.21.0/24", "subnet_route": "10.1.21.0/24", "tenant_route_ip": "192.168.3.2", "v_name": "vxlan_t3s1"}]}, {"brif": "t3br1if2", "disk": "10G", "mem": 4, "name": "t3_VM2", "vcpu": 2, "vmif": "t3VM2if1"}], "mode": "0644", "owner": "root", "path": "/root/Migration-as-a-Service/t3/VM_templates/t3_VM2.xml.j2", "size": 4091, "state": "file", "uid": 0}
ok: [localhost] => (item=[{u'route': [{u'ip': u'10.1.22.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.1.22.1', u'bridge_name': u't3br2', u'dns': [{u'dnsif': u't3s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.126', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't3s2_dnsbrif'}], u'ns_name': u't3ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.22.2/24', u'tenant_ns_ip': u'10.1.22.1/24', u'tenant_ns_if': u't3ns2if', u'tenant_sub_if': u't3s2if', u'tenant_ns_name': u't3'}], u'bridge_ip': u'2.2.2.1', u'vxlan': [{u'local_ip': u'10.1.22.2', u'dsport': 4789, u'dev': u't3s2if', u'tenant_route_ip': u'192.168.3.2', u'remote_route': u'10.2.22.0/24', u'subnet_route': u'10.1.22.0/24', u'v_name': u'vxlan_t3s2', u'id': 42, u'remote_ip': u'10.2.22.2'}]}, {u'mem': 3, u'name': u't3_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't3br2if1', u'vmif': u't3VM3if1'}]) => {"ansible_loop_var": "item", "changed": false, "checksum": "350ba870bd31b7f6ee517845c14237910b5af0bf", "dest": "/root/Migration-as-a-Service/t3/VM_templates/t3_VM3.xml.j2", "gid": 0, "group": "root", "item": [{"bridge_ip": "2.2.2.1", "bridge_name": "t3br2", "default_route_ip": "10.1.22.1", "dns": [{"brif": "t3s2_dnsbrif", "dhcp_end": "2.2.2.126", "dhcp_start": "2.2.2.5", "dnsif": "t3s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t3ns2", "route": [{"if": "p1", "ip": "10.1.22.1/24", "ns_if": "t3if", "ns_name": "t3"}], "tenant_ns": [{"tenant_ns_if": "t3ns2if", "tenant_ns_ip": "10.1.22.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s2if", "tenant_sub_ip": "10.1.22.2/24"}], "vxlan": [{"dev": "t3s2if", "dsport": 4789, "id": 42, "local_ip": "10.1.22.2", "remote_ip": "10.2.22.2", "remote_route": "10.2.22.0/24", "subnet_route": "10.1.22.0/24", "tenant_route_ip": "192.168.3.2", "v_name": "vxlan_t3s2"}]}, {"brif": "t3br2if1", "disk": "10G", "mem": 3, "name": "t3_VM3", "vcpu": 2, "vmif": "t3VM3if1"}], "mode": "0644", "owner": "root", "path": "/root/Migration-as-a-Service/t3/VM_templates/t3_VM3.xml.j2", "size": 4091, "state": "file", "uid": 0}

TASK [Get list of running VMs] ******************************************************************************************************************************
ok: [localhost] => {"changed": false, "cmd": ["virsh", "list", "--name"], "delta": "0:00:00.017476", "end": "2019-11-17 10:35:39.632818", "rc": 0, "start": "2019-11-17 10:35:39.615342", "stderr": "", "stderr_lines": [], "stdout": "t1_VM1\nt1_VM2\nt1_VM3\nt2_VM1\nt2_VM2\nt2_VM3\nt3_VM1\nt3_VM2\nt3_VM3", "stdout_lines": ["t1_VM1", "t1_VM2", "t1_VM3", "t2_VM1", "t2_VM2", "t2_VM3", "t3_VM1", "t3_VM2", "t3_VM3"]}

TASK [Define VM] ********************************************************************************************************************************************
skipping: [localhost] => (item=[{u'route': [{u'ip': u'10.1.21.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.1.21.1', u'bridge_name': u't3br1', u'dns': [{u'dnsif': u't3s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't3s1_dnsbrif'}], u'ns_name': u't3ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.21.2/24', u'tenant_ns_ip': u'10.1.21.1/24', u'tenant_ns_if': u't3ns1if', u'tenant_sub_if': u't3s1if', u'tenant_ns_name': u't3'}], u'bridge_ip': u'1.1.1.1', u'vxlan': [{u'local_ip': u'10.1.21.2', u'dsport': 4789, u'dev': u't3s1if', u'tenant_route_ip': u'192.168.3.2', u'remote_route': u'10.2.21.0/24', u'subnet_route': u'10.1.21.0/24', u'v_name': u'vxlan_t3s1', u'id': 42, u'remote_ip': u'10.2.21.2'}]}, {u'mem': 2, u'name': u't3_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't3br1if1', u'vmif': u't3VM1if1'}])  => {"ansible_loop_var": "item", "changed": false, "item": [{"bridge_ip": "1.1.1.1", "bridge_name": "t3br1", "default_route_ip": "10.1.21.1", "dns": [{"brif": "t3s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t3s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t3ns1", "route": [{"if": "p1", "ip": "10.1.21.1/24", "ns_if": "t3if", "ns_name": "t3"}], "tenant_ns": [{"tenant_ns_if": "t3ns1if", "tenant_ns_ip": "10.1.21.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s1if", "tenant_sub_ip": "10.1.21.2/24"}], "vxlan": [{"dev": "t3s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.21.2", "remote_ip": "10.2.21.2", "remote_route": "10.2.21.0/24", "subnet_route": "10.1.21.0/24", "tenant_route_ip": "192.168.3.2", "v_name": "vxlan_t3s1"}]}, {"brif": "t3br1if1", "disk": "10G", "mem": 2, "name": "t3_VM1", "vcpu": 4, "vmif": "t3VM1if1"}], "skip_reason": "Conditional result was False"}
skipping: [localhost] => (item=[{u'route': [{u'ip': u'10.1.21.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.1.21.1', u'bridge_name': u't3br1', u'dns': [{u'dnsif': u't3s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't3s1_dnsbrif'}], u'ns_name': u't3ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.21.2/24', u'tenant_ns_ip': u'10.1.21.1/24', u'tenant_ns_if': u't3ns1if', u'tenant_sub_if': u't3s1if', u'tenant_ns_name': u't3'}], u'bridge_ip': u'1.1.1.1', u'vxlan': [{u'local_ip': u'10.1.21.2', u'dsport': 4789, u'dev': u't3s1if', u'tenant_route_ip': u'192.168.3.2', u'remote_route': u'10.2.21.0/24', u'subnet_route': u'10.1.21.0/24', u'v_name': u'vxlan_t3s1', u'id': 42, u'remote_ip': u'10.2.21.2'}]}, {u'mem': 4, u'name': u't3_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't3br1if2', u'vmif': u't3VM2if1'}])  => {"ansible_loop_var": "item", "changed": false, "item": [{"bridge_ip": "1.1.1.1", "bridge_name": "t3br1", "default_route_ip": "10.1.21.1", "dns": [{"brif": "t3s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t3s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t3ns1", "route": [{"if": "p1", "ip": "10.1.21.1/24", "ns_if": "t3if", "ns_name": "t3"}], "tenant_ns": [{"tenant_ns_if": "t3ns1if", "tenant_ns_ip": "10.1.21.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s1if", "tenant_sub_ip": "10.1.21.2/24"}], "vxlan": [{"dev": "t3s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.21.2", "remote_ip": "10.2.21.2", "remote_route": "10.2.21.0/24", "subnet_route": "10.1.21.0/24", "tenant_route_ip": "192.168.3.2", "v_name": "vxlan_t3s1"}]}, {"brif": "t3br1if2", "disk": "10G", "mem": 4, "name": "t3_VM2", "vcpu": 2, "vmif": "t3VM2if1"}], "skip_reason": "Conditional result was False"}
skipping: [localhost] => (item=[{u'route': [{u'ip': u'10.1.22.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.1.22.1', u'bridge_name': u't3br2', u'dns': [{u'dnsif': u't3s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.126', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't3s2_dnsbrif'}], u'ns_name': u't3ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.22.2/24', u'tenant_ns_ip': u'10.1.22.1/24', u'tenant_ns_if': u't3ns2if', u'tenant_sub_if': u't3s2if', u'tenant_ns_name': u't3'}], u'bridge_ip': u'2.2.2.1', u'vxlan': [{u'local_ip': u'10.1.22.2', u'dsport': 4789, u'dev': u't3s2if', u'tenant_route_ip': u'192.168.3.2', u'remote_route': u'10.2.22.0/24', u'subnet_route': u'10.1.22.0/24', u'v_name': u'vxlan_t3s2', u'id': 42, u'remote_ip': u'10.2.22.2'}]}, {u'mem': 3, u'name': u't3_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't3br2if1', u'vmif': u't3VM3if1'}])  => {"ansible_loop_var": "item", "changed": false, "item": [{"bridge_ip": "2.2.2.1", "bridge_name": "t3br2", "default_route_ip": "10.1.22.1", "dns": [{"brif": "t3s2_dnsbrif", "dhcp_end": "2.2.2.126", "dhcp_start": "2.2.2.5", "dnsif": "t3s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t3ns2", "route": [{"if": "p1", "ip": "10.1.22.1/24", "ns_if": "t3if", "ns_name": "t3"}], "tenant_ns": [{"tenant_ns_if": "t3ns2if", "tenant_ns_ip": "10.1.22.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s2if", "tenant_sub_ip": "10.1.22.2/24"}], "vxlan": [{"dev": "t3s2if", "dsport": 4789, "id": 42, "local_ip": "10.1.22.2", "remote_ip": "10.2.22.2", "remote_route": "10.2.22.0/24", "subnet_route": "10.1.22.0/24", "tenant_route_ip": "192.168.3.2", "v_name": "vxlan_t3s2"}]}, {"brif": "t3br2if1", "disk": "10G", "mem": 3, "name": "t3_VM3", "vcpu": 2, "vmif": "t3VM3if1"}], "skip_reason": "Conditional result was False"}

TASK [Create VM] ********************************************************************************************************************************************
skipping: [localhost] => (item=[{u'route': [{u'ip': u'10.1.21.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.1.21.1', u'bridge_name': u't3br1', u'dns': [{u'dnsif': u't3s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't3s1_dnsbrif'}], u'ns_name': u't3ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.21.2/24', u'tenant_ns_ip': u'10.1.21.1/24', u'tenant_ns_if': u't3ns1if', u'tenant_sub_if': u't3s1if', u'tenant_ns_name': u't3'}], u'bridge_ip': u'1.1.1.1', u'vxlan': [{u'local_ip': u'10.1.21.2', u'dsport': 4789, u'dev': u't3s1if', u'tenant_route_ip': u'192.168.3.2', u'remote_route': u'10.2.21.0/24', u'subnet_route': u'10.1.21.0/24', u'v_name': u'vxlan_t3s1', u'id': 42, u'remote_ip': u'10.2.21.2'}]}, {u'mem': 2, u'name': u't3_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't3br1if1', u'vmif': u't3VM1if1'}])  => {"ansible_loop_var": "item", "changed": false, "item": [{"bridge_ip": "1.1.1.1", "bridge_name": "t3br1", "default_route_ip": "10.1.21.1", "dns": [{"brif": "t3s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t3s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t3ns1", "route": [{"if": "p1", "ip": "10.1.21.1/24", "ns_if": "t3if", "ns_name": "t3"}], "tenant_ns": [{"tenant_ns_if": "t3ns1if", "tenant_ns_ip": "10.1.21.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s1if", "tenant_sub_ip": "10.1.21.2/24"}], "vxlan": [{"dev": "t3s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.21.2", "remote_ip": "10.2.21.2", "remote_route": "10.2.21.0/24", "subnet_route": "10.1.21.0/24", "tenant_route_ip": "192.168.3.2", "v_name": "vxlan_t3s1"}]}, {"brif": "t3br1if1", "disk": "10G", "mem": 2, "name": "t3_VM1", "vcpu": 4, "vmif": "t3VM1if1"}], "skip_reason": "Conditional result was False"}
skipping: [localhost] => (item=[{u'route': [{u'ip': u'10.1.21.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.1.21.1', u'bridge_name': u't3br1', u'dns': [{u'dnsif': u't3s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't3s1_dnsbrif'}], u'ns_name': u't3ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.21.2/24', u'tenant_ns_ip': u'10.1.21.1/24', u'tenant_ns_if': u't3ns1if', u'tenant_sub_if': u't3s1if', u'tenant_ns_name': u't3'}], u'bridge_ip': u'1.1.1.1', u'vxlan': [{u'local_ip': u'10.1.21.2', u'dsport': 4789, u'dev': u't3s1if', u'tenant_route_ip': u'192.168.3.2', u'remote_route': u'10.2.21.0/24', u'subnet_route': u'10.1.21.0/24', u'v_name': u'vxlan_t3s1', u'id': 42, u'remote_ip': u'10.2.21.2'}]}, {u'mem': 4, u'name': u't3_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't3br1if2', u'vmif': u't3VM2if1'}])  => {"ansible_loop_var": "item", "changed": false, "item": [{"bridge_ip": "1.1.1.1", "bridge_name": "t3br1", "default_route_ip": "10.1.21.1", "dns": [{"brif": "t3s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t3s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t3ns1", "route": [{"if": "p1", "ip": "10.1.21.1/24", "ns_if": "t3if", "ns_name": "t3"}], "tenant_ns": [{"tenant_ns_if": "t3ns1if", "tenant_ns_ip": "10.1.21.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s1if", "tenant_sub_ip": "10.1.21.2/24"}], "vxlan": [{"dev": "t3s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.21.2", "remote_ip": "10.2.21.2", "remote_route": "10.2.21.0/24", "subnet_route": "10.1.21.0/24", "tenant_route_ip": "192.168.3.2", "v_name": "vxlan_t3s1"}]}, {"brif": "t3br1if2", "disk": "10G", "mem": 4, "name": "t3_VM2", "vcpu": 2, "vmif": "t3VM2if1"}], "skip_reason": "Conditional result was False"}
skipping: [localhost] => (item=[{u'route': [{u'ip': u'10.1.22.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.1.22.1', u'bridge_name': u't3br2', u'dns': [{u'dnsif': u't3s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.126', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't3s2_dnsbrif'}], u'ns_name': u't3ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.22.2/24', u'tenant_ns_ip': u'10.1.22.1/24', u'tenant_ns_if': u't3ns2if', u'tenant_sub_if': u't3s2if', u'tenant_ns_name': u't3'}], u'bridge_ip': u'2.2.2.1', u'vxlan': [{u'local_ip': u'10.1.22.2', u'dsport': 4789, u'dev': u't3s2if', u'tenant_route_ip': u'192.168.3.2', u'remote_route': u'10.2.22.0/24', u'subnet_route': u'10.1.22.0/24', u'v_name': u'vxlan_t3s2', u'id': 42, u'remote_ip': u'10.2.22.2'}]}, {u'mem': 3, u'name': u't3_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't3br2if1', u'vmif': u't3VM3if1'}])  => {"ansible_loop_var": "item", "changed": false, "item": [{"bridge_ip": "2.2.2.1", "bridge_name": "t3br2", "default_route_ip": "10.1.22.1", "dns": [{"brif": "t3s2_dnsbrif", "dhcp_end": "2.2.2.126", "dhcp_start": "2.2.2.5", "dnsif": "t3s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t3ns2", "route": [{"if": "p1", "ip": "10.1.22.1/24", "ns_if": "t3if", "ns_name": "t3"}], "tenant_ns": [{"tenant_ns_if": "t3ns2if", "tenant_ns_ip": "10.1.22.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s2if", "tenant_sub_ip": "10.1.22.2/24"}], "vxlan": [{"dev": "t3s2if", "dsport": 4789, "id": 42, "local_ip": "10.1.22.2", "remote_ip": "10.2.22.2", "remote_route": "10.2.22.0/24", "subnet_route": "10.1.22.0/24", "tenant_route_ip": "192.168.3.2", "v_name": "vxlan_t3s2"}]}, {"brif": "t3br2if1", "disk": "10G", "mem": 3, "name": "t3_VM3", "vcpu": 2, "vmif": "t3VM3if1"}], "skip_reason": "Conditional result was False"}

TASK [Start VM] *********************************************************************************************************************************************
skipping: [localhost] => (item=[{u'route': [{u'ip': u'10.1.21.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.1.21.1', u'bridge_name': u't3br1', u'dns': [{u'dnsif': u't3s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't3s1_dnsbrif'}], u'ns_name': u't3ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.21.2/24', u'tenant_ns_ip': u'10.1.21.1/24', u'tenant_ns_if': u't3ns1if', u'tenant_sub_if': u't3s1if', u'tenant_ns_name': u't3'}], u'bridge_ip': u'1.1.1.1', u'vxlan': [{u'local_ip': u'10.1.21.2', u'dsport': 4789, u'dev': u't3s1if', u'tenant_route_ip': u'192.168.3.2', u'remote_route': u'10.2.21.0/24', u'subnet_route': u'10.1.21.0/24', u'v_name': u'vxlan_t3s1', u'id': 42, u'remote_ip': u'10.2.21.2'}]}, {u'mem': 2, u'name': u't3_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't3br1if1', u'vmif': u't3VM1if1'}])  => {"ansible_loop_var": "item", "changed": false, "item": [{"bridge_ip": "1.1.1.1", "bridge_name": "t3br1", "default_route_ip": "10.1.21.1", "dns": [{"brif": "t3s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t3s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t3ns1", "route": [{"if": "p1", "ip": "10.1.21.1/24", "ns_if": "t3if", "ns_name": "t3"}], "tenant_ns": [{"tenant_ns_if": "t3ns1if", "tenant_ns_ip": "10.1.21.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s1if", "tenant_sub_ip": "10.1.21.2/24"}], "vxlan": [{"dev": "t3s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.21.2", "remote_ip": "10.2.21.2", "remote_route": "10.2.21.0/24", "subnet_route": "10.1.21.0/24", "tenant_route_ip": "192.168.3.2", "v_name": "vxlan_t3s1"}]}, {"brif": "t3br1if1", "disk": "10G", "mem": 2, "name": "t3_VM1", "vcpu": 4, "vmif": "t3VM1if1"}], "skip_reason": "Conditional result was False"}
skipping: [localhost] => (item=[{u'route': [{u'ip': u'10.1.21.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.1.21.1', u'bridge_name': u't3br1', u'dns': [{u'dnsif': u't3s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't3s1_dnsbrif'}], u'ns_name': u't3ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.21.2/24', u'tenant_ns_ip': u'10.1.21.1/24', u'tenant_ns_if': u't3ns1if', u'tenant_sub_if': u't3s1if', u'tenant_ns_name': u't3'}], u'bridge_ip': u'1.1.1.1', u'vxlan': [{u'local_ip': u'10.1.21.2', u'dsport': 4789, u'dev': u't3s1if', u'tenant_route_ip': u'192.168.3.2', u'remote_route': u'10.2.21.0/24', u'subnet_route': u'10.1.21.0/24', u'v_name': u'vxlan_t3s1', u'id': 42, u'remote_ip': u'10.2.21.2'}]}, {u'mem': 4, u'name': u't3_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't3br1if2', u'vmif': u't3VM2if1'}])  => {"ansible_loop_var": "item", "changed": false, "item": [{"bridge_ip": "1.1.1.1", "bridge_name": "t3br1", "default_route_ip": "10.1.21.1", "dns": [{"brif": "t3s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t3s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t3ns1", "route": [{"if": "p1", "ip": "10.1.21.1/24", "ns_if": "t3if", "ns_name": "t3"}], "tenant_ns": [{"tenant_ns_if": "t3ns1if", "tenant_ns_ip": "10.1.21.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s1if", "tenant_sub_ip": "10.1.21.2/24"}], "vxlan": [{"dev": "t3s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.21.2", "remote_ip": "10.2.21.2", "remote_route": "10.2.21.0/24", "subnet_route": "10.1.21.0/24", "tenant_route_ip": "192.168.3.2", "v_name": "vxlan_t3s1"}]}, {"brif": "t3br1if2", "disk": "10G", "mem": 4, "name": "t3_VM2", "vcpu": 2, "vmif": "t3VM2if1"}], "skip_reason": "Conditional result was False"}
skipping: [localhost] => (item=[{u'route': [{u'ip': u'10.1.22.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.1.22.1', u'bridge_name': u't3br2', u'dns': [{u'dnsif': u't3s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.126', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't3s2_dnsbrif'}], u'ns_name': u't3ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.22.2/24', u'tenant_ns_ip': u'10.1.22.1/24', u'tenant_ns_if': u't3ns2if', u'tenant_sub_if': u't3s2if', u'tenant_ns_name': u't3'}], u'bridge_ip': u'2.2.2.1', u'vxlan': [{u'local_ip': u'10.1.22.2', u'dsport': 4789, u'dev': u't3s2if', u'tenant_route_ip': u'192.168.3.2', u'remote_route': u'10.2.22.0/24', u'subnet_route': u'10.1.22.0/24', u'v_name': u'vxlan_t3s2', u'id': 42, u'remote_ip': u'10.2.22.2'}]}, {u'mem': 3, u'name': u't3_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't3br2if1', u'vmif': u't3VM3if1'}])  => {"ansible_loop_var": "item", "changed": false, "item": [{"bridge_ip": "2.2.2.1", "bridge_name": "t3br2", "default_route_ip": "10.1.22.1", "dns": [{"brif": "t3s2_dnsbrif", "dhcp_end": "2.2.2.126", "dhcp_start": "2.2.2.5", "dnsif": "t3s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t3ns2", "route": [{"if": "p1", "ip": "10.1.22.1/24", "ns_if": "t3if", "ns_name": "t3"}], "tenant_ns": [{"tenant_ns_if": "t3ns2if", "tenant_ns_ip": "10.1.22.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s2if", "tenant_sub_ip": "10.1.22.2/24"}], "vxlan": [{"dev": "t3s2if", "dsport": 4789, "id": 42, "local_ip": "10.1.22.2", "remote_ip": "10.2.22.2", "remote_route": "10.2.22.0/24", "subnet_route": "10.1.22.0/24", "tenant_route_ip": "192.168.3.2", "v_name": "vxlan_t3s2"}]}, {"brif": "t3br2if1", "disk": "10G", "mem": 3, "name": "t3_VM3", "vcpu": 2, "vmif": "t3VM3if1"}], "skip_reason": "Conditional result was False"}

TASK [Attach VM interface] **********************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.21.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.1.21.1', u'bridge_name': u't3br1', u'dns': [{u'dnsif': u't3s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't3s1_dnsbrif'}], u'ns_name': u't3ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.21.2/24', u'tenant_ns_ip': u'10.1.21.1/24', u'tenant_ns_if': u't3ns1if', u'tenant_sub_if': u't3s1if', u'tenant_ns_name': u't3'}], u'bridge_ip': u'1.1.1.1', u'vxlan': [{u'local_ip': u'10.1.21.2', u'dsport': 4789, u'dev': u't3s1if', u'tenant_route_ip': u'192.168.3.2', u'remote_route': u'10.2.21.0/24', u'subnet_route': u'10.1.21.0/24', u'v_name': u'vxlan_t3s1', u'id': 42, u'remote_ip': u'10.2.21.2'}]}, {u'mem': 2, u'name': u't3_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't3br1if1', u'vmif': u't3VM1if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "virsh domiflist \"t3_VM1\" | grep -w 't3VM1if1' ; if [ $? -ne 0 ] ; then virsh attach-interface \"t3_VM1\" direct \"t3VM1if1\" --live --persistent ; fi\n", "delta": "0:00:00.018790", "end": "2019-11-17 10:35:39.929436", "item": [{"bridge_ip": "1.1.1.1", "bridge_name": "t3br1", "default_route_ip": "10.1.21.1", "dns": [{"brif": "t3s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t3s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t3ns1", "route": [{"if": "p1", "ip": "10.1.21.1/24", "ns_if": "t3if", "ns_name": "t3"}], "tenant_ns": [{"tenant_ns_if": "t3ns1if", "tenant_ns_ip": "10.1.21.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s1if", "tenant_sub_ip": "10.1.21.2/24"}], "vxlan": [{"dev": "t3s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.21.2", "remote_ip": "10.2.21.2", "remote_route": "10.2.21.0/24", "subnet_route": "10.1.21.0/24", "tenant_route_ip": "192.168.3.2", "v_name": "vxlan_t3s1"}]}, {"brif": "t3br1if1", "disk": "10G", "mem": 2, "name": "t3_VM1", "vcpu": 4, "vmif": "t3VM1if1"}], "rc": 0, "start": "2019-11-17 10:35:39.910646", "stderr": "", "stderr_lines": [], "stdout": "macvtap6   direct     t3VM1if1   rtl8139     52:54:00:92:ce:f1", "stdout_lines": ["macvtap6   direct     t3VM1if1   rtl8139     52:54:00:92:ce:f1"]}
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.21.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.1.21.1', u'bridge_name': u't3br1', u'dns': [{u'dnsif': u't3s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't3s1_dnsbrif'}], u'ns_name': u't3ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.21.2/24', u'tenant_ns_ip': u'10.1.21.1/24', u'tenant_ns_if': u't3ns1if', u'tenant_sub_if': u't3s1if', u'tenant_ns_name': u't3'}], u'bridge_ip': u'1.1.1.1', u'vxlan': [{u'local_ip': u'10.1.21.2', u'dsport': 4789, u'dev': u't3s1if', u'tenant_route_ip': u'192.168.3.2', u'remote_route': u'10.2.21.0/24', u'subnet_route': u'10.1.21.0/24', u'v_name': u'vxlan_t3s1', u'id': 42, u'remote_ip': u'10.2.21.2'}]}, {u'mem': 4, u'name': u't3_VM2', u'vcpu': 2, u'disk': u'10G', u'brif': u't3br1if2', u'vmif': u't3VM2if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "virsh domiflist \"t3_VM2\" | grep -w 't3VM2if1' ; if [ $? -ne 0 ] ; then virsh attach-interface \"t3_VM2\" direct \"t3VM2if1\" --live --persistent ; fi\n", "delta": "0:00:00.019270", "end": "2019-11-17 10:35:40.074094", "item": [{"bridge_ip": "1.1.1.1", "bridge_name": "t3br1", "default_route_ip": "10.1.21.1", "dns": [{"brif": "t3s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t3s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t3ns1", "route": [{"if": "p1", "ip": "10.1.21.1/24", "ns_if": "t3if", "ns_name": "t3"}], "tenant_ns": [{"tenant_ns_if": "t3ns1if", "tenant_ns_ip": "10.1.21.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s1if", "tenant_sub_ip": "10.1.21.2/24"}], "vxlan": [{"dev": "t3s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.21.2", "remote_ip": "10.2.21.2", "remote_route": "10.2.21.0/24", "subnet_route": "10.1.21.0/24", "tenant_route_ip": "192.168.3.2", "v_name": "vxlan_t3s1"}]}, {"brif": "t3br1if2", "disk": "10G", "mem": 4, "name": "t3_VM2", "vcpu": 2, "vmif": "t3VM2if1"}], "rc": 0, "start": "2019-11-17 10:35:40.054824", "stderr": "", "stderr_lines": [], "stdout": "macvtap7   direct     t3VM2if1   rtl8139     52:54:00:9e:b2:45", "stdout_lines": ["macvtap7   direct     t3VM2if1   rtl8139     52:54:00:9e:b2:45"]}
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.22.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.1.22.1', u'bridge_name': u't3br2', u'dns': [{u'dnsif': u't3s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.126', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't3s2_dnsbrif'}], u'ns_name': u't3ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.22.2/24', u'tenant_ns_ip': u'10.1.22.1/24', u'tenant_ns_if': u't3ns2if', u'tenant_sub_if': u't3s2if', u'tenant_ns_name': u't3'}], u'bridge_ip': u'2.2.2.1', u'vxlan': [{u'local_ip': u'10.1.22.2', u'dsport': 4789, u'dev': u't3s2if', u'tenant_route_ip': u'192.168.3.2', u'remote_route': u'10.2.22.0/24', u'subnet_route': u'10.1.22.0/24', u'v_name': u'vxlan_t3s2', u'id': 42, u'remote_ip': u'10.2.22.2'}]}, {u'mem': 3, u'name': u't3_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't3br2if1', u'vmif': u't3VM3if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "virsh domiflist \"t3_VM3\" | grep -w 't3VM3if1' ; if [ $? -ne 0 ] ; then virsh attach-interface \"t3_VM3\" direct \"t3VM3if1\" --live --persistent ; fi\n", "delta": "0:00:00.019083", "end": "2019-11-17 10:35:40.232755", "item": [{"bridge_ip": "2.2.2.1", "bridge_name": "t3br2", "default_route_ip": "10.1.22.1", "dns": [{"brif": "t3s2_dnsbrif", "dhcp_end": "2.2.2.126", "dhcp_start": "2.2.2.5", "dnsif": "t3s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t3ns2", "route": [{"if": "p1", "ip": "10.1.22.1/24", "ns_if": "t3if", "ns_name": "t3"}], "tenant_ns": [{"tenant_ns_if": "t3ns2if", "tenant_ns_ip": "10.1.22.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s2if", "tenant_sub_ip": "10.1.22.2/24"}], "vxlan": [{"dev": "t3s2if", "dsport": 4789, "id": 42, "local_ip": "10.1.22.2", "remote_ip": "10.2.22.2", "remote_route": "10.2.22.0/24", "subnet_route": "10.1.22.0/24", "tenant_route_ip": "192.168.3.2", "v_name": "vxlan_t3s2"}]}, {"brif": "t3br2if1", "disk": "10G", "mem": 3, "name": "t3_VM3", "vcpu": 2, "vmif": "t3VM3if1"}], "rc": 0, "start": "2019-11-17 10:35:40.213672", "stderr": "", "stderr_lines": [], "stdout": "macvtap8   direct     t3VM3if1   rtl8139     52:54:00:48:7c:1a", "stdout_lines": ["macvtap8   direct     t3VM3if1   rtl8139     52:54:00:48:7c:1a"]}

PLAY RECAP **************************************************************************************************************************************************
localhost                  : ok=4    changed=1    unreachable=0    failed=0    skipped=3    rescued=0    ignored=0   

Using /etc/ansible/ansible.cfg as config file

PLAY [worker] ***********************************************************************************************************************************************

TASK [Copy VM image] ****************************************************************************************************************************************
ok: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.21.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.2.21.1', u'bridge_name': u't3br1', u'dns': [{u'dnsif': u't3s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't3s1_dnsbrif'}], u'ns_name': u't3ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.21.2/24', u'tenant_ns_ip': u'10.2.21.1/24', u'tenant_ns_if': u't3ns1if', u'tenant_sub_if': u't3s1if', u'tenant_ns_name': u't3'}], u'bridge_ip': u'1.1.1.1', u'vxlan': [{u'local_ip': u'10.2.21.2', u'dsport': 4789, u'dev': u't3s1if', u'tenant_route_ip': u'192.168.131.2', u'remote_route': u'10.1.21.0/24', u'subnet_route': u'10.2.21.0/24', u'v_name': u'vxlan_t3s1', u'id': 42, u'remote_ip': u'10.1.21.2'}]}, {u'mem': 2, u'name': u't3_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't3br1if1', u'vmif': u't3VM4if1'}]) => {"ansible_loop_var": "item", "changed": false, "dest": "/var/lib/libvirt/images/t3_VM4.qcow2", "gid": 113, "group": "kvm", "item": [{"bridge_ip": "1.1.1.1", "bridge_name": "t3br1", "default_route_ip": "10.2.21.1", "dns": [{"brif": "t3s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t3s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "ns_name": "t3ns1", "route": [{"if": "p1", "ip": "10.2.21.1/24", "ns_if": "t3if", "ns_name": "t3"}], "tenant_ns": [{"tenant_ns_if": "t3ns1if", "tenant_ns_ip": "10.2.21.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s1if", "tenant_sub_ip": "10.2.21.2/24"}], "vxlan": [{"dev": "t3s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.21.2", "remote_ip": "10.1.21.2", "remote_route": "10.1.21.0/24", "subnet_route": "10.2.21.0/24", "tenant_route_ip": "192.168.131.2", "v_name": "vxlan_t3s1"}]}, {"brif": "t3br1if1", "disk": "10G", "mem": 2, "name": "t3_VM4", "vcpu": 4, "vmif": "t3VM4if1"}], "mode": "0644", "msg": "file already exists", "owner": "libvirt-qemu", "size": 10739318784, "src": "/root/mainVM.qcow2", "state": "file", "uid": 64055}
ok: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.21.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.2.21.1', u'bridge_name': u't3br1', u'dns': [{u'dnsif': u't3s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't3s1_dnsbrif'}], u'ns_name': u't3ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.21.2/24', u'tenant_ns_ip': u'10.2.21.1/24', u'tenant_ns_if': u't3ns1if', u'tenant_sub_if': u't3s1if', u'tenant_ns_name': u't3'}], u'bridge_ip': u'1.1.1.1', u'vxlan': [{u'local_ip': u'10.2.21.2', u'dsport': 4789, u'dev': u't3s1if', u'tenant_route_ip': u'192.168.131.2', u'remote_route': u'10.1.21.0/24', u'subnet_route': u'10.2.21.0/24', u'v_name': u'vxlan_t3s1', u'id': 42, u'remote_ip': u'10.1.21.2'}]}, {u'mem': 2, u'name': u't3_VM5', u'vcpu': 4, u'disk': u'10G', u'brif': u't3br1if2', u'vmif': u't3VM5if1'}]) => {"ansible_loop_var": "item", "changed": false, "dest": "/var/lib/libvirt/images/t3_VM5.qcow2", "gid": 113, "group": "kvm", "item": [{"bridge_ip": "1.1.1.1", "bridge_name": "t3br1", "default_route_ip": "10.2.21.1", "dns": [{"brif": "t3s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t3s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "ns_name": "t3ns1", "route": [{"if": "p1", "ip": "10.2.21.1/24", "ns_if": "t3if", "ns_name": "t3"}], "tenant_ns": [{"tenant_ns_if": "t3ns1if", "tenant_ns_ip": "10.2.21.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s1if", "tenant_sub_ip": "10.2.21.2/24"}], "vxlan": [{"dev": "t3s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.21.2", "remote_ip": "10.1.21.2", "remote_route": "10.1.21.0/24", "subnet_route": "10.2.21.0/24", "tenant_route_ip": "192.168.131.2", "v_name": "vxlan_t3s1"}]}, {"brif": "t3br1if2", "disk": "10G", "mem": 2, "name": "t3_VM5", "vcpu": 4, "vmif": "t3VM5if1"}], "mode": "0644", "msg": "file already exists", "owner": "libvirt-qemu", "size": 10739318784, "src": "/root/mainVM.qcow2", "state": "file", "uid": 64055}
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.22.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.2.22.1', u'bridge_name': u't3br2', u'dns': [{u'dnsif': u't3s2_dnsif', u'dhcp_start': u'2.2.2.133', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.128/24', u'net_mask': u'255.255.255.0', u'brif': u't3s2_dnsbrif'}], u'ns_name': u't3ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.22.2/24', u'tenant_ns_ip': u'10.2.22.1/24', u'tenant_ns_if': u't3ns2if', u'tenant_sub_if': u't3s2if', u'tenant_ns_name': u't3'}], u'bridge_ip': u'2.2.2.1', u'vxlan': [{u'local_ip': u'10.2.22.2', u'dsport': 4789, u'dev': u't3s2if', u'tenant_route_ip': u'192.168.131.2', u'remote_route': u'10.1.22.0/24', u'subnet_route': u'10.2.22.0/24', u'v_name': u'vxlan_t3s2', u'id': 42, u'remote_ip': u'10.1.22.2'}]}, {u'mem': 2, u'name': u't3_VM6', u'vcpu': 4, u'disk': u'10G', u'brif': u't3br2if1', u'vmif': u't3VM6if1'}]) => {"ansible_loop_var": "item", "changed": true, "checksum": "f8b2ffa2bf201c84196c582f2dec0d33a1eb4b42", "dest": "/var/lib/libvirt/images/t3_VM6.qcow2", "gid": 0, "group": "root", "item": [{"bridge_ip": "2.2.2.1", "bridge_name": "t3br2", "default_route_ip": "10.2.22.1", "dns": [{"brif": "t3s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.133", "dnsif": "t3s2_dnsif", "dnsif_ip": "2.2.2.128/24", "net_mask": "255.255.255.0"}], "ns_name": "t3ns2", "route": [{"if": "p1", "ip": "10.2.22.1/24", "ns_if": "t3if", "ns_name": "t3"}], "tenant_ns": [{"tenant_ns_if": "t3ns2if", "tenant_ns_ip": "10.2.22.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s2if", "tenant_sub_ip": "10.2.22.2/24"}], "vxlan": [{"dev": "t3s2if", "dsport": 4789, "id": 42, "local_ip": "10.2.22.2", "remote_ip": "10.1.22.2", "remote_route": "10.1.22.0/24", "subnet_route": "10.2.22.0/24", "tenant_route_ip": "192.168.131.2", "v_name": "vxlan_t3s2"}]}, {"brif": "t3br2if1", "disk": "10G", "mem": 2, "name": "t3_VM6", "vcpu": 4, "vmif": "t3VM6if1"}], "md5sum": "e6d5d524b68797ddd748ba1475985d34", "mode": "0644", "owner": "root", "size": 10739318784, "src": "/root/mainVM.qcow2", "state": "file", "uid": 0}

TASK [Get list of running VMs] ******************************************************************************************************************************
ok: [99.99.99.2] => {"changed": false, "cmd": ["virsh", "list", "--name"], "delta": "0:00:00.872491", "end": "2019-11-17 10:38:14.293777", "rc": 0, "start": "2019-11-17 10:38:13.421286", "stderr": "", "stderr_lines": [], "stdout": "t1_VM4\nt2_VM4\nt3_VM4\nt3_VM5", "stdout_lines": ["t1_VM4", "t2_VM4", "t3_VM4", "t3_VM5"]}

TASK [Define VM] ********************************************************************************************************************************************
skipping: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.21.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.2.21.1', u'bridge_name': u't3br1', u'dns': [{u'dnsif': u't3s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't3s1_dnsbrif'}], u'ns_name': u't3ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.21.2/24', u'tenant_ns_ip': u'10.2.21.1/24', u'tenant_ns_if': u't3ns1if', u'tenant_sub_if': u't3s1if', u'tenant_ns_name': u't3'}], u'bridge_ip': u'1.1.1.1', u'vxlan': [{u'local_ip': u'10.2.21.2', u'dsport': 4789, u'dev': u't3s1if', u'tenant_route_ip': u'192.168.131.2', u'remote_route': u'10.1.21.0/24', u'subnet_route': u'10.2.21.0/24', u'v_name': u'vxlan_t3s1', u'id': 42, u'remote_ip': u'10.1.21.2'}]}, {u'mem': 2, u'name': u't3_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't3br1if1', u'vmif': u't3VM4if1'}])  => {"ansible_loop_var": "item", "changed": false, "item": [{"bridge_ip": "1.1.1.1", "bridge_name": "t3br1", "default_route_ip": "10.2.21.1", "dns": [{"brif": "t3s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t3s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "ns_name": "t3ns1", "route": [{"if": "p1", "ip": "10.2.21.1/24", "ns_if": "t3if", "ns_name": "t3"}], "tenant_ns": [{"tenant_ns_if": "t3ns1if", "tenant_ns_ip": "10.2.21.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s1if", "tenant_sub_ip": "10.2.21.2/24"}], "vxlan": [{"dev": "t3s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.21.2", "remote_ip": "10.1.21.2", "remote_route": "10.1.21.0/24", "subnet_route": "10.2.21.0/24", "tenant_route_ip": "192.168.131.2", "v_name": "vxlan_t3s1"}]}, {"brif": "t3br1if1", "disk": "10G", "mem": 2, "name": "t3_VM4", "vcpu": 4, "vmif": "t3VM4if1"}], "skip_reason": "Conditional result was False"}
skipping: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.21.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.2.21.1', u'bridge_name': u't3br1', u'dns': [{u'dnsif': u't3s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't3s1_dnsbrif'}], u'ns_name': u't3ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.21.2/24', u'tenant_ns_ip': u'10.2.21.1/24', u'tenant_ns_if': u't3ns1if', u'tenant_sub_if': u't3s1if', u'tenant_ns_name': u't3'}], u'bridge_ip': u'1.1.1.1', u'vxlan': [{u'local_ip': u'10.2.21.2', u'dsport': 4789, u'dev': u't3s1if', u'tenant_route_ip': u'192.168.131.2', u'remote_route': u'10.1.21.0/24', u'subnet_route': u'10.2.21.0/24', u'v_name': u'vxlan_t3s1', u'id': 42, u'remote_ip': u'10.1.21.2'}]}, {u'mem': 2, u'name': u't3_VM5', u'vcpu': 4, u'disk': u'10G', u'brif': u't3br1if2', u'vmif': u't3VM5if1'}])  => {"ansible_loop_var": "item", "changed": false, "item": [{"bridge_ip": "1.1.1.1", "bridge_name": "t3br1", "default_route_ip": "10.2.21.1", "dns": [{"brif": "t3s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t3s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "ns_name": "t3ns1", "route": [{"if": "p1", "ip": "10.2.21.1/24", "ns_if": "t3if", "ns_name": "t3"}], "tenant_ns": [{"tenant_ns_if": "t3ns1if", "tenant_ns_ip": "10.2.21.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s1if", "tenant_sub_ip": "10.2.21.2/24"}], "vxlan": [{"dev": "t3s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.21.2", "remote_ip": "10.1.21.2", "remote_route": "10.1.21.0/24", "subnet_route": "10.2.21.0/24", "tenant_route_ip": "192.168.131.2", "v_name": "vxlan_t3s1"}]}, {"brif": "t3br1if2", "disk": "10G", "mem": 2, "name": "t3_VM5", "vcpu": 4, "vmif": "t3VM5if1"}], "skip_reason": "Conditional result was False"}
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.22.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.2.22.1', u'bridge_name': u't3br2', u'dns': [{u'dnsif': u't3s2_dnsif', u'dhcp_start': u'2.2.2.133', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.128/24', u'net_mask': u'255.255.255.0', u'brif': u't3s2_dnsbrif'}], u'ns_name': u't3ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.22.2/24', u'tenant_ns_ip': u'10.2.22.1/24', u'tenant_ns_if': u't3ns2if', u'tenant_sub_if': u't3s2if', u'tenant_ns_name': u't3'}], u'bridge_ip': u'2.2.2.1', u'vxlan': [{u'local_ip': u'10.2.22.2', u'dsport': 4789, u'dev': u't3s2if', u'tenant_route_ip': u'192.168.131.2', u'remote_route': u'10.1.22.0/24', u'subnet_route': u'10.2.22.0/24', u'v_name': u'vxlan_t3s2', u'id': 42, u'remote_ip': u'10.1.22.2'}]}, {u'mem': 2, u'name': u't3_VM6', u'vcpu': 4, u'disk': u'10G', u'brif': u't3br2if1', u'vmif': u't3VM6if1'}]) => {"ansible_loop_var": "item", "changed": true, "created": "t3_VM6", "item": [{"bridge_ip": "2.2.2.1", "bridge_name": "t3br2", "default_route_ip": "10.2.22.1", "dns": [{"brif": "t3s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.133", "dnsif": "t3s2_dnsif", "dnsif_ip": "2.2.2.128/24", "net_mask": "255.255.255.0"}], "ns_name": "t3ns2", "route": [{"if": "p1", "ip": "10.2.22.1/24", "ns_if": "t3if", "ns_name": "t3"}], "tenant_ns": [{"tenant_ns_if": "t3ns2if", "tenant_ns_ip": "10.2.22.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s2if", "tenant_sub_ip": "10.2.22.2/24"}], "vxlan": [{"dev": "t3s2if", "dsport": 4789, "id": 42, "local_ip": "10.2.22.2", "remote_ip": "10.1.22.2", "remote_route": "10.1.22.0/24", "subnet_route": "10.2.22.0/24", "tenant_route_ip": "192.168.131.2", "v_name": "vxlan_t3s2"}]}, {"brif": "t3br2if1", "disk": "10G", "mem": 2, "name": "t3_VM6", "vcpu": 4, "vmif": "t3VM6if1"}], "warnings": ["'xml' is given - ignoring 'name'"]}

TASK [Create VM] ********************************************************************************************************************************************
skipping: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.21.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.2.21.1', u'bridge_name': u't3br1', u'dns': [{u'dnsif': u't3s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't3s1_dnsbrif'}], u'ns_name': u't3ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.21.2/24', u'tenant_ns_ip': u'10.2.21.1/24', u'tenant_ns_if': u't3ns1if', u'tenant_sub_if': u't3s1if', u'tenant_ns_name': u't3'}], u'bridge_ip': u'1.1.1.1', u'vxlan': [{u'local_ip': u'10.2.21.2', u'dsport': 4789, u'dev': u't3s1if', u'tenant_route_ip': u'192.168.131.2', u'remote_route': u'10.1.21.0/24', u'subnet_route': u'10.2.21.0/24', u'v_name': u'vxlan_t3s1', u'id': 42, u'remote_ip': u'10.1.21.2'}]}, {u'mem': 2, u'name': u't3_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't3br1if1', u'vmif': u't3VM4if1'}])  => {"ansible_loop_var": "item", "changed": false, "item": [{"bridge_ip": "1.1.1.1", "bridge_name": "t3br1", "default_route_ip": "10.2.21.1", "dns": [{"brif": "t3s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t3s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "ns_name": "t3ns1", "route": [{"if": "p1", "ip": "10.2.21.1/24", "ns_if": "t3if", "ns_name": "t3"}], "tenant_ns": [{"tenant_ns_if": "t3ns1if", "tenant_ns_ip": "10.2.21.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s1if", "tenant_sub_ip": "10.2.21.2/24"}], "vxlan": [{"dev": "t3s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.21.2", "remote_ip": "10.1.21.2", "remote_route": "10.1.21.0/24", "subnet_route": "10.2.21.0/24", "tenant_route_ip": "192.168.131.2", "v_name": "vxlan_t3s1"}]}, {"brif": "t3br1if1", "disk": "10G", "mem": 2, "name": "t3_VM4", "vcpu": 4, "vmif": "t3VM4if1"}], "skip_reason": "Conditional result was False"}
skipping: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.21.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.2.21.1', u'bridge_name': u't3br1', u'dns': [{u'dnsif': u't3s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't3s1_dnsbrif'}], u'ns_name': u't3ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.21.2/24', u'tenant_ns_ip': u'10.2.21.1/24', u'tenant_ns_if': u't3ns1if', u'tenant_sub_if': u't3s1if', u'tenant_ns_name': u't3'}], u'bridge_ip': u'1.1.1.1', u'vxlan': [{u'local_ip': u'10.2.21.2', u'dsport': 4789, u'dev': u't3s1if', u'tenant_route_ip': u'192.168.131.2', u'remote_route': u'10.1.21.0/24', u'subnet_route': u'10.2.21.0/24', u'v_name': u'vxlan_t3s1', u'id': 42, u'remote_ip': u'10.1.21.2'}]}, {u'mem': 2, u'name': u't3_VM5', u'vcpu': 4, u'disk': u'10G', u'brif': u't3br1if2', u'vmif': u't3VM5if1'}])  => {"ansible_loop_var": "item", "changed": false, "item": [{"bridge_ip": "1.1.1.1", "bridge_name": "t3br1", "default_route_ip": "10.2.21.1", "dns": [{"brif": "t3s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t3s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "ns_name": "t3ns1", "route": [{"if": "p1", "ip": "10.2.21.1/24", "ns_if": "t3if", "ns_name": "t3"}], "tenant_ns": [{"tenant_ns_if": "t3ns1if", "tenant_ns_ip": "10.2.21.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s1if", "tenant_sub_ip": "10.2.21.2/24"}], "vxlan": [{"dev": "t3s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.21.2", "remote_ip": "10.1.21.2", "remote_route": "10.1.21.0/24", "subnet_route": "10.2.21.0/24", "tenant_route_ip": "192.168.131.2", "v_name": "vxlan_t3s1"}]}, {"brif": "t3br1if2", "disk": "10G", "mem": 2, "name": "t3_VM5", "vcpu": 4, "vmif": "t3VM5if1"}], "skip_reason": "Conditional result was False"}
ok: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.22.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.2.22.1', u'bridge_name': u't3br2', u'dns': [{u'dnsif': u't3s2_dnsif', u'dhcp_start': u'2.2.2.133', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.128/24', u'net_mask': u'255.255.255.0', u'brif': u't3s2_dnsbrif'}], u'ns_name': u't3ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.22.2/24', u'tenant_ns_ip': u'10.2.22.1/24', u'tenant_ns_if': u't3ns2if', u'tenant_sub_if': u't3s2if', u'tenant_ns_name': u't3'}], u'bridge_ip': u'2.2.2.1', u'vxlan': [{u'local_ip': u'10.2.22.2', u'dsport': 4789, u'dev': u't3s2if', u'tenant_route_ip': u'192.168.131.2', u'remote_route': u'10.1.22.0/24', u'subnet_route': u'10.2.22.0/24', u'v_name': u'vxlan_t3s2', u'id': 42, u'remote_ip': u'10.1.22.2'}]}, {u'mem': 2, u'name': u't3_VM6', u'vcpu': 4, u'disk': u'10G', u'brif': u't3br2if1', u'vmif': u't3VM6if1'}]) => {"ansible_loop_var": "item", "changed": false, "create": 0, "item": [{"bridge_ip": "2.2.2.1", "bridge_name": "t3br2", "default_route_ip": "10.2.22.1", "dns": [{"brif": "t3s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.133", "dnsif": "t3s2_dnsif", "dnsif_ip": "2.2.2.128/24", "net_mask": "255.255.255.0"}], "ns_name": "t3ns2", "route": [{"if": "p1", "ip": "10.2.22.1/24", "ns_if": "t3if", "ns_name": "t3"}], "tenant_ns": [{"tenant_ns_if": "t3ns2if", "tenant_ns_ip": "10.2.22.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s2if", "tenant_sub_ip": "10.2.22.2/24"}], "vxlan": [{"dev": "t3s2if", "dsport": 4789, "id": 42, "local_ip": "10.2.22.2", "remote_ip": "10.1.22.2", "remote_route": "10.1.22.0/24", "subnet_route": "10.2.22.0/24", "tenant_route_ip": "192.168.131.2", "v_name": "vxlan_t3s2"}]}, {"brif": "t3br2if1", "disk": "10G", "mem": 2, "name": "t3_VM6", "vcpu": 4, "vmif": "t3VM6if1"}]}

TASK [Start VM] *********************************************************************************************************************************************
skipping: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.21.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.2.21.1', u'bridge_name': u't3br1', u'dns': [{u'dnsif': u't3s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't3s1_dnsbrif'}], u'ns_name': u't3ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.21.2/24', u'tenant_ns_ip': u'10.2.21.1/24', u'tenant_ns_if': u't3ns1if', u'tenant_sub_if': u't3s1if', u'tenant_ns_name': u't3'}], u'bridge_ip': u'1.1.1.1', u'vxlan': [{u'local_ip': u'10.2.21.2', u'dsport': 4789, u'dev': u't3s1if', u'tenant_route_ip': u'192.168.131.2', u'remote_route': u'10.1.21.0/24', u'subnet_route': u'10.2.21.0/24', u'v_name': u'vxlan_t3s1', u'id': 42, u'remote_ip': u'10.1.21.2'}]}, {u'mem': 2, u'name': u't3_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't3br1if1', u'vmif': u't3VM4if1'}])  => {"ansible_loop_var": "item", "changed": false, "item": [{"bridge_ip": "1.1.1.1", "bridge_name": "t3br1", "default_route_ip": "10.2.21.1", "dns": [{"brif": "t3s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t3s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "ns_name": "t3ns1", "route": [{"if": "p1", "ip": "10.2.21.1/24", "ns_if": "t3if", "ns_name": "t3"}], "tenant_ns": [{"tenant_ns_if": "t3ns1if", "tenant_ns_ip": "10.2.21.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s1if", "tenant_sub_ip": "10.2.21.2/24"}], "vxlan": [{"dev": "t3s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.21.2", "remote_ip": "10.1.21.2", "remote_route": "10.1.21.0/24", "subnet_route": "10.2.21.0/24", "tenant_route_ip": "192.168.131.2", "v_name": "vxlan_t3s1"}]}, {"brif": "t3br1if1", "disk": "10G", "mem": 2, "name": "t3_VM4", "vcpu": 4, "vmif": "t3VM4if1"}], "skip_reason": "Conditional result was False"}
skipping: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.21.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.2.21.1', u'bridge_name': u't3br1', u'dns': [{u'dnsif': u't3s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't3s1_dnsbrif'}], u'ns_name': u't3ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.21.2/24', u'tenant_ns_ip': u'10.2.21.1/24', u'tenant_ns_if': u't3ns1if', u'tenant_sub_if': u't3s1if', u'tenant_ns_name': u't3'}], u'bridge_ip': u'1.1.1.1', u'vxlan': [{u'local_ip': u'10.2.21.2', u'dsport': 4789, u'dev': u't3s1if', u'tenant_route_ip': u'192.168.131.2', u'remote_route': u'10.1.21.0/24', u'subnet_route': u'10.2.21.0/24', u'v_name': u'vxlan_t3s1', u'id': 42, u'remote_ip': u'10.1.21.2'}]}, {u'mem': 2, u'name': u't3_VM5', u'vcpu': 4, u'disk': u'10G', u'brif': u't3br1if2', u'vmif': u't3VM5if1'}])  => {"ansible_loop_var": "item", "changed": false, "item": [{"bridge_ip": "1.1.1.1", "bridge_name": "t3br1", "default_route_ip": "10.2.21.1", "dns": [{"brif": "t3s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t3s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "ns_name": "t3ns1", "route": [{"if": "p1", "ip": "10.2.21.1/24", "ns_if": "t3if", "ns_name": "t3"}], "tenant_ns": [{"tenant_ns_if": "t3ns1if", "tenant_ns_ip": "10.2.21.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s1if", "tenant_sub_ip": "10.2.21.2/24"}], "vxlan": [{"dev": "t3s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.21.2", "remote_ip": "10.1.21.2", "remote_route": "10.1.21.0/24", "subnet_route": "10.2.21.0/24", "tenant_route_ip": "192.168.131.2", "v_name": "vxlan_t3s1"}]}, {"brif": "t3br1if2", "disk": "10G", "mem": 2, "name": "t3_VM5", "vcpu": 4, "vmif": "t3VM5if1"}], "skip_reason": "Conditional result was False"}
ok: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.22.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.2.22.1', u'bridge_name': u't3br2', u'dns': [{u'dnsif': u't3s2_dnsif', u'dhcp_start': u'2.2.2.133', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.128/24', u'net_mask': u'255.255.255.0', u'brif': u't3s2_dnsbrif'}], u'ns_name': u't3ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.22.2/24', u'tenant_ns_ip': u'10.2.22.1/24', u'tenant_ns_if': u't3ns2if', u'tenant_sub_if': u't3s2if', u'tenant_ns_name': u't3'}], u'bridge_ip': u'2.2.2.1', u'vxlan': [{u'local_ip': u'10.2.22.2', u'dsport': 4789, u'dev': u't3s2if', u'tenant_route_ip': u'192.168.131.2', u'remote_route': u'10.1.22.0/24', u'subnet_route': u'10.2.22.0/24', u'v_name': u'vxlan_t3s2', u'id': 42, u'remote_ip': u'10.1.22.2'}]}, {u'mem': 2, u'name': u't3_VM6', u'vcpu': 4, u'disk': u'10G', u'brif': u't3br2if1', u'vmif': u't3VM6if1'}]) => {"ansible_loop_var": "item", "changed": false, "item": [{"bridge_ip": "2.2.2.1", "bridge_name": "t3br2", "default_route_ip": "10.2.22.1", "dns": [{"brif": "t3s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.133", "dnsif": "t3s2_dnsif", "dnsif_ip": "2.2.2.128/24", "net_mask": "255.255.255.0"}], "ns_name": "t3ns2", "route": [{"if": "p1", "ip": "10.2.22.1/24", "ns_if": "t3if", "ns_name": "t3"}], "tenant_ns": [{"tenant_ns_if": "t3ns2if", "tenant_ns_ip": "10.2.22.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s2if", "tenant_sub_ip": "10.2.22.2/24"}], "vxlan": [{"dev": "t3s2if", "dsport": 4789, "id": 42, "local_ip": "10.2.22.2", "remote_ip": "10.1.22.2", "remote_route": "10.1.22.0/24", "subnet_route": "10.2.22.0/24", "tenant_route_ip": "192.168.131.2", "v_name": "vxlan_t3s2"}]}, {"brif": "t3br2if1", "disk": "10G", "mem": 2, "name": "t3_VM6", "vcpu": 4, "vmif": "t3VM6if1"}]}

TASK [Attach VM interface] **********************************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.21.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.2.21.1', u'bridge_name': u't3br1', u'dns': [{u'dnsif': u't3s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't3s1_dnsbrif'}], u'ns_name': u't3ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.21.2/24', u'tenant_ns_ip': u'10.2.21.1/24', u'tenant_ns_if': u't3ns1if', u'tenant_sub_if': u't3s1if', u'tenant_ns_name': u't3'}], u'bridge_ip': u'1.1.1.1', u'vxlan': [{u'local_ip': u'10.2.21.2', u'dsport': 4789, u'dev': u't3s1if', u'tenant_route_ip': u'192.168.131.2', u'remote_route': u'10.1.21.0/24', u'subnet_route': u'10.2.21.0/24', u'v_name': u'vxlan_t3s1', u'id': 42, u'remote_ip': u'10.1.21.2'}]}, {u'mem': 2, u'name': u't3_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't3br1if1', u'vmif': u't3VM4if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "virsh domiflist \"t3_VM4\" | grep -w 't3VM4if1' ; if [ $? -ne 0 ] ; then virsh attach-interface \"t3_VM4\" direct \"t3VM4if1\" --live --persistent ; fi\n", "delta": "0:00:00.022126", "end": "2019-11-17 10:38:47.327189", "item": [{"bridge_ip": "1.1.1.1", "bridge_name": "t3br1", "default_route_ip": "10.2.21.1", "dns": [{"brif": "t3s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t3s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "ns_name": "t3ns1", "route": [{"if": "p1", "ip": "10.2.21.1/24", "ns_if": "t3if", "ns_name": "t3"}], "tenant_ns": [{"tenant_ns_if": "t3ns1if", "tenant_ns_ip": "10.2.21.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s1if", "tenant_sub_ip": "10.2.21.2/24"}], "vxlan": [{"dev": "t3s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.21.2", "remote_ip": "10.1.21.2", "remote_route": "10.1.21.0/24", "subnet_route": "10.2.21.0/24", "tenant_route_ip": "192.168.131.2", "v_name": "vxlan_t3s1"}]}, {"brif": "t3br1if1", "disk": "10G", "mem": 2, "name": "t3_VM4", "vcpu": 4, "vmif": "t3VM4if1"}], "rc": 0, "start": "2019-11-17 10:38:47.305063", "stderr": "", "stderr_lines": [], "stdout": "macvtap2   direct     t3VM4if1   rtl8139     52:54:00:cf:6c:38", "stdout_lines": ["macvtap2   direct     t3VM4if1   rtl8139     52:54:00:cf:6c:38"]}
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.21.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.2.21.1', u'bridge_name': u't3br1', u'dns': [{u'dnsif': u't3s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't3s1_dnsbrif'}], u'ns_name': u't3ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.21.2/24', u'tenant_ns_ip': u'10.2.21.1/24', u'tenant_ns_if': u't3ns1if', u'tenant_sub_if': u't3s1if', u'tenant_ns_name': u't3'}], u'bridge_ip': u'1.1.1.1', u'vxlan': [{u'local_ip': u'10.2.21.2', u'dsport': 4789, u'dev': u't3s1if', u'tenant_route_ip': u'192.168.131.2', u'remote_route': u'10.1.21.0/24', u'subnet_route': u'10.2.21.0/24', u'v_name': u'vxlan_t3s1', u'id': 42, u'remote_ip': u'10.1.21.2'}]}, {u'mem': 2, u'name': u't3_VM5', u'vcpu': 4, u'disk': u'10G', u'brif': u't3br1if2', u'vmif': u't3VM5if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "virsh domiflist \"t3_VM5\" | grep -w 't3VM5if1' ; if [ $? -ne 0 ] ; then virsh attach-interface \"t3_VM5\" direct \"t3VM5if1\" --live --persistent ; fi\n", "delta": "0:00:00.024388", "end": "2019-11-17 10:38:47.601444", "item": [{"bridge_ip": "1.1.1.1", "bridge_name": "t3br1", "default_route_ip": "10.2.21.1", "dns": [{"brif": "t3s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t3s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "ns_name": "t3ns1", "route": [{"if": "p1", "ip": "10.2.21.1/24", "ns_if": "t3if", "ns_name": "t3"}], "tenant_ns": [{"tenant_ns_if": "t3ns1if", "tenant_ns_ip": "10.2.21.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s1if", "tenant_sub_ip": "10.2.21.2/24"}], "vxlan": [{"dev": "t3s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.21.2", "remote_ip": "10.1.21.2", "remote_route": "10.1.21.0/24", "subnet_route": "10.2.21.0/24", "tenant_route_ip": "192.168.131.2", "v_name": "vxlan_t3s1"}]}, {"brif": "t3br1if2", "disk": "10G", "mem": 2, "name": "t3_VM5", "vcpu": 4, "vmif": "t3VM5if1"}], "rc": 0, "start": "2019-11-17 10:38:47.577056", "stderr": "", "stderr_lines": [], "stdout": "macvtap3   direct     t3VM5if1   rtl8139     52:54:00:44:8d:11", "stdout_lines": ["macvtap3   direct     t3VM5if1   rtl8139     52:54:00:44:8d:11"]}
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.22.1/24', u'ns_name': u't3', u'ns_if': u't3if', u'if': u'p1'}], u'default_route_ip': u'10.2.22.1', u'bridge_name': u't3br2', u'dns': [{u'dnsif': u't3s2_dnsif', u'dhcp_start': u'2.2.2.133', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.128/24', u'net_mask': u'255.255.255.0', u'brif': u't3s2_dnsbrif'}], u'ns_name': u't3ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.22.2/24', u'tenant_ns_ip': u'10.2.22.1/24', u'tenant_ns_if': u't3ns2if', u'tenant_sub_if': u't3s2if', u'tenant_ns_name': u't3'}], u'bridge_ip': u'2.2.2.1', u'vxlan': [{u'local_ip': u'10.2.22.2', u'dsport': 4789, u'dev': u't3s2if', u'tenant_route_ip': u'192.168.131.2', u'remote_route': u'10.1.22.0/24', u'subnet_route': u'10.2.22.0/24', u'v_name': u'vxlan_t3s2', u'id': 42, u'remote_ip': u'10.1.22.2'}]}, {u'mem': 2, u'name': u't3_VM6', u'vcpu': 4, u'disk': u'10G', u'brif': u't3br2if1', u'vmif': u't3VM6if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "virsh domiflist \"t3_VM6\" | grep -w 't3VM6if1' ; if [ $? -ne 0 ] ; then virsh attach-interface \"t3_VM6\" direct \"t3VM6if1\" --live --persistent ; fi\n", "delta": "0:00:00.245091", "end": "2019-11-17 10:38:48.096262", "item": [{"bridge_ip": "2.2.2.1", "bridge_name": "t3br2", "default_route_ip": "10.2.22.1", "dns": [{"brif": "t3s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.133", "dnsif": "t3s2_dnsif", "dnsif_ip": "2.2.2.128/24", "net_mask": "255.255.255.0"}], "ns_name": "t3ns2", "route": [{"if": "p1", "ip": "10.2.22.1/24", "ns_if": "t3if", "ns_name": "t3"}], "tenant_ns": [{"tenant_ns_if": "t3ns2if", "tenant_ns_ip": "10.2.22.1/24", "tenant_ns_name": "t3", "tenant_sub_if": "t3s2if", "tenant_sub_ip": "10.2.22.2/24"}], "vxlan": [{"dev": "t3s2if", "dsport": 4789, "id": 42, "local_ip": "10.2.22.2", "remote_ip": "10.1.22.2", "remote_route": "10.1.22.0/24", "subnet_route": "10.2.22.0/24", "tenant_route_ip": "192.168.131.2", "v_name": "vxlan_t3s2"}]}, {"brif": "t3br2if1", "disk": "10G", "mem": 2, "name": "t3_VM6", "vcpu": 4, "vmif": "t3VM6if1"}], "rc": 0, "start": "2019-11-17 10:38:47.851171", "stderr": "", "stderr_lines": [], "stdout": "Interface attached successfully", "stdout_lines": ["Interface attached successfully"]}

PLAY RECAP **************************************************************************************************************************************************
99.99.99.2                 : ok=6    changed=3    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0   

INFO:root: 10:39:23.960942 Unable to open user input yaml file
Using /etc/ansible/ansible.cfg as config file
Using /etc/ansible/ansible.cfg as config file
Using /etc/ansible/ansible.cfg as config file
Using /etc/ansible/ansible.cfg as config file
Using /etc/ansible/ansible.cfg as config file
Using /etc/ansible/ansible.cfg as config file
Using /etc/ansible/ansible.cfg as config file
Using /etc/ansible/ansible.cfg as config file
Using /etc/ansible/ansible.cfg as config file
Using /etc/ansible/ansible.cfg as config file
Using /etc/ansible/ansible.cfg as config file
Using /etc/ansible/ansible.cfg as config file
Using /etc/ansible/ansible.cfg as config file
Using /etc/ansible/ansible.cfg as config file
Using /etc/ansible/ansible.cfg as config file
Using /etc/ansible/ansible.cfg as config file
INFO:root: 10:39:34.393221 Unable to open user input yaml file
Using /etc/ansible/ansible.cfg as config file
Using /etc/ansible/ansible.cfg as config file
Using /etc/ansible/ansible.cfg as config file
Using /etc/ansible/ansible.cfg as config file
Using /etc/ansible/ansible.cfg as config file
Using /etc/ansible/ansible.cfg as config file
Using /etc/ansible/ansible.cfg as config file
Using /etc/ansible/ansible.cfg as config file
INFO:root: 10:51:07.289519 Printing the yaml input file
INFO:root: 10:51:07.289710 {'C1': [{'subnet_addr': '1.1.1.0/24', 'VM': [{'name': 'VM1', 'disk': '10G', 'mem': 2, 'vcpu': 4}]}, {'subnet_addr': '2.2.2.0/24', 'VM': [{'name': 'VM3', 'disk': '10G', 'mem': 3, 'vcpu': 2}]}], 'C2': [{'subnet_addr': '1.1.1.0/24', 'VM': [{'name': 'VM4', 'disk': '10G', 'mem': 2, 'vcpu': 4}]}]}
INFO:root: 10:51:07.289820 Provided subnet in C1: 1.1.1.0/24 is valid
ERROR:root: 10:51:07.289859Multiple subnet in the C1 are same
Using /etc/ansible/ansible.cfg as config file

PLAY [main] *************************************************************************************************************************************************

TASK [Create Tenant Namespace] ******************************************************************************************************************************
ok: [localhost] => (item={u'default_route_ip': u'192.168.2.1', u'name': u't2', u'pns_ip': u'192.168.2.1/24', u'tenant_if': u't2if', u'tenant_ip': u'192.168.2.2/24', u'pns_if': u't2pns_if'}) => {"ansible_loop_var": "item", "changed": false, "cmd": ["ip", "netns", "add", "t2"], "item": {"default_route_ip": "192.168.2.1", "name": "t2", "pns_if": "t2pns_if", "pns_ip": "192.168.2.1/24", "tenant_if": "t2if", "tenant_ip": "192.168.2.2/24"}, "rc": 0, "stdout": "skipped, since /var/run/netns/t2 exists", "stdout_lines": ["skipped, since /var/run/netns/t2 exists"]}

TASK [Create Subnet Namespace] ******************************************************************************************************************************
ok: [localhost] => (item={u'route': [{u'ip': u'10.1.11.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.1.11.1', u'bridge_name': u't2br1', u'dns': [{u'dnsif': u't2s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't2s1_dnsbrif'}], u'ns_name': u't2ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.11.2/24', u'tenant_ns_ip': u'10.1.11.1/24', u'tenant_ns_if': u't2ns1if', u'tenant_ns_name': u't2', u'tenant_sub_if': u't2s1if'}], u'bridge_ip': u'1.1.1.1', u'vms': [{u'mem': 2, u'name': u't2_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't2br1if1', u'vmif': u't2VM1if1'}], u'vxlan': [{u'local_ip': u'10.1.11.2', u'tenant_route_ip': u'192.168.2.2', u'dsport': 4789, u'dev': u't2s1if', u'subnet_route': u'10.1.11.0/24', u'remote_route': u'10.2.11.0/24', u'v_name': u'vxlan_t2s1', u'id': 42, u'remote_ip': u'10.2.11.2'}]}) => {"ansible_loop_var": "item", "changed": false, "cmd": ["ip", "netns", "add", "t2ns1"], "item": {"bridge_ip": "1.1.1.1", "bridge_name": "t2br1", "default_route_ip": "10.1.11.1", "dns": [{"brif": "t2s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t2s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns1", "route": [{"if": "p1", "ip": "10.1.11.1/24", "ns_if": "t2if", "ns_name": "t2"}], "tenant_ns": [{"tenant_ns_if": "t2ns1if", "tenant_ns_ip": "10.1.11.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s1if", "tenant_sub_ip": "10.1.11.2/24"}], "vms": [{"brif": "t2br1if1", "disk": "10G", "mem": 2, "name": "t2_VM1", "vcpu": 4, "vmif": "t2VM1if1"}], "vxlan": [{"dev": "t2s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.11.2", "remote_ip": "10.2.11.2", "remote_route": "10.2.11.0/24", "subnet_route": "10.1.11.0/24", "tenant_route_ip": "192.168.2.2", "v_name": "vxlan_t2s1"}]}, "rc": 0, "stdout": "skipped, since /var/run/netns/t2ns1 exists", "stdout_lines": ["skipped, since /var/run/netns/t2ns1 exists"]}
ok: [localhost] => (item={u'route': [{u'ip': u'10.1.12.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.1.12.1', u'bridge_name': u't2br2', u'dns': [{u'dnsif': u't2s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't2s2_dnsbrif'}], u'ns_name': u't2ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.12.2/24', u'tenant_ns_ip': u'10.1.12.1/24', u'tenant_ns_if': u't2ns2if', u'tenant_ns_name': u't2', u'tenant_sub_if': u't2s2if'}], u'bridge_ip': u'2.2.2.1', u'vms': [{u'mem': 3, u'name': u't2_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't2br2if1', u'vmif': u't2VM3if1'}], u'vxlan': [{u'local_ip': [], u'tenant_route_ip': [], u'dsport': [], u'dev': [], u'subnet_route': [], u'remote_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}) => {"ansible_loop_var": "item", "changed": false, "cmd": ["ip", "netns", "add", "t2ns2"], "item": {"bridge_ip": "2.2.2.1", "bridge_name": "t2br2", "default_route_ip": "10.1.12.1", "dns": [{"brif": "t2s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t2s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns2", "route": [{"if": "p1", "ip": "10.1.12.1/24", "ns_if": "t2if", "ns_name": "t2"}], "tenant_ns": [{"tenant_ns_if": "t2ns2if", "tenant_ns_ip": "10.1.12.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s2if", "tenant_sub_ip": "10.1.12.2/24"}], "vms": [{"brif": "t2br2if1", "disk": "10G", "mem": 3, "name": "t2_VM3", "vcpu": 2, "vmif": "t2VM3if1"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, "rc": 0, "stdout": "skipped, since /var/run/netns/t2ns2 exists", "stdout_lines": ["skipped, since /var/run/netns/t2ns2 exists"]}

TASK [Create Tenant VETH pairs] *****************************************************************************************************************************
changed: [localhost] => (item={u'default_route_ip': u'192.168.2.1', u'name': u't2', u'pns_ip': u'192.168.2.1/24', u'tenant_if': u't2if', u'tenant_ip': u'192.168.2.2/24', u'pns_if': u't2pns_if'}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip link show \"t2if\" ; if [ $? -ne 0 ] ; then ip link add \"t2if\" type veth peer name \"t2pns_if\" ; fi\n", "delta": "0:00:00.011867", "end": "2019-11-17 10:51:09.170549", "item": {"default_route_ip": "192.168.2.1", "name": "t2", "pns_if": "t2pns_if", "pns_ip": "192.168.2.1/24", "tenant_if": "t2if", "tenant_ip": "192.168.2.2/24"}, "rc": 0, "start": "2019-11-17 10:51:09.158682", "stderr": "Device \"t2if\" does not exist.", "stderr_lines": ["Device \"t2if\" does not exist."], "stdout": "", "stdout_lines": []}

TASK [Attach Tenant VETH Pairs] *****************************************************************************************************************************
changed: [localhost] => (item={u'default_route_ip': u'192.168.2.1', u'name': u't2', u'pns_ip': u'192.168.2.1/24', u'tenant_if': u't2if', u'tenant_ip': u'192.168.2.2/24', u'pns_if': u't2pns_if'}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec pns ip link show \"t2pns_if\" ; if [ $? -ne 0 ] ; then ip link set \"t2pns_if\" netns pns ; fi\nip netns exec \"t2\" ip link show \"t2if\" ; if [ $? -ne 0 ] ; then ip link set \"t2if\" netns \"t2\" ; fi\nip netns exec pns ip link set dev \"t2pns_if\" up\nip netns exec \"t2\" ip link set dev \"t2if\" up\n", "delta": "0:00:00.138703", "end": "2019-11-17 10:51:09.564192", "item": {"default_route_ip": "192.168.2.1", "name": "t2", "pns_if": "t2pns_if", "pns_ip": "192.168.2.1/24", "tenant_if": "t2if", "tenant_ip": "192.168.2.2/24"}, "rc": 0, "start": "2019-11-17 10:51:09.425489", "stderr": "", "stderr_lines": [], "stdout": "57: t2pns_if@if58: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP mode DEFAULT group default qlen 1000\n    link/ether 4e:a3:a9:de:99:a3 brd ff:ff:ff:ff:ff:ff link-netnsid 2\n58: t2if@if57: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP mode DEFAULT group default qlen 1000\n    link/ether 0e:3a:51:2b:a2:7f brd ff:ff:ff:ff:ff:ff link-netnsid 0", "stdout_lines": ["57: t2pns_if@if58: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP mode DEFAULT group default qlen 1000", "    link/ether 4e:a3:a9:de:99:a3 brd ff:ff:ff:ff:ff:ff link-netnsid 2", "58: t2if@if57: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP mode DEFAULT group default qlen 1000", "    link/ether 0e:3a:51:2b:a2:7f brd ff:ff:ff:ff:ff:ff link-netnsid 0"]}

TASK [Add IP addresses to Tenant VETH Pairs] ****************************************************************************************************************
changed: [localhost] => (item={u'default_route_ip': u'192.168.2.1', u'name': u't2', u'pns_ip': u'192.168.2.1/24', u'tenant_if': u't2if', u'tenant_ip': u'192.168.2.2/24', u'pns_if': u't2pns_if'}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec pns ip addr show \"t2pns_if\" | awk 'FNR==3{ print $2 }' | grep -w '^192.168.2.1/24' ; if [ $? -ne 0 ] ; then ip netns exec pns ip addr add \"192.168.2.1/24\" dev \"t2pns_if\" ; fi\nip netns exec \"t2\" ip addr show \"t2if\" | awk 'FNR==3{ print $2 }' | grep -w '^192.168.2.2/24' ; if [ $? -ne 0 ] ; then ip netns exec \"t2\" ip addr add \"192.168.2.2/24\" dev \"t2if\" ; fi\n", "delta": "0:00:00.073516", "end": "2019-11-17 10:51:09.912056", "item": {"default_route_ip": "192.168.2.1", "name": "t2", "pns_if": "t2pns_if", "pns_ip": "192.168.2.1/24", "tenant_if": "t2if", "tenant_ip": "192.168.2.2/24"}, "rc": 0, "start": "2019-11-17 10:51:09.838540", "stderr": "", "stderr_lines": [], "stdout": "192.168.2.1/24\n192.168.2.2/24", "stdout_lines": ["192.168.2.1/24", "192.168.2.2/24"]}

TASK [Create Namespace VETH Pairs] **************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.11.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.1.11.1', u'bridge_name': u't2br1', u'dns': [{u'dnsif': u't2s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't2s1_dnsbrif'}], u'ns_name': u't2ns1', u'bridge_ip': u'1.1.1.1', u'vms': [{u'mem': 2, u'name': u't2_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't2br1if1', u'vmif': u't2VM1if1'}], u'vxlan': [{u'local_ip': u'10.1.11.2', u'dsport': 4789, u'dev': u't2s1if', u'tenant_route_ip': u'192.168.2.2', u'remote_route': u'10.2.11.0/24', u'subnet_route': u'10.1.11.0/24', u'v_name': u'vxlan_t2s1', u'id': 42, u'remote_ip': u'10.2.11.2'}]}, {u'tenant_sub_ip': u'10.1.11.2/24', u'tenant_ns_ip': u'10.1.11.1/24', u'tenant_ns_if': u't2ns1if', u'tenant_sub_if': u't2s1if', u'tenant_ns_name': u't2'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip link show \"t2ns1if\" ; if [ $? -ne 0 ] ; then ip link add \"t2ns1if\" type veth peer name \"t2s1if\" ; fi\n", "delta": "0:00:00.010387", "end": "2019-11-17 10:51:10.215164", "item": [{"bridge_ip": "1.1.1.1", "bridge_name": "t2br1", "default_route_ip": "10.1.11.1", "dns": [{"brif": "t2s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t2s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns1", "route": [{"if": "p1", "ip": "10.1.11.1/24", "ns_if": "t2if", "ns_name": "t2"}], "vms": [{"brif": "t2br1if1", "disk": "10G", "mem": 2, "name": "t2_VM1", "vcpu": 4, "vmif": "t2VM1if1"}], "vxlan": [{"dev": "t2s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.11.2", "remote_ip": "10.2.11.2", "remote_route": "10.2.11.0/24", "subnet_route": "10.1.11.0/24", "tenant_route_ip": "192.168.2.2", "v_name": "vxlan_t2s1"}]}, {"tenant_ns_if": "t2ns1if", "tenant_ns_ip": "10.1.11.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s1if", "tenant_sub_ip": "10.1.11.2/24"}], "rc": 0, "start": "2019-11-17 10:51:10.204777", "stderr": "Device \"t2ns1if\" does not exist.", "stderr_lines": ["Device \"t2ns1if\" does not exist."], "stdout": "", "stdout_lines": []}
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.12.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.1.12.1', u'bridge_name': u't2br2', u'dns': [{u'dnsif': u't2s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't2s2_dnsbrif'}], u'ns_name': u't2ns2', u'bridge_ip': u'2.2.2.1', u'vms': [{u'mem': 3, u'name': u't2_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't2br2if1', u'vmif': u't2VM3if1'}], u'vxlan': [{u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}, {u'tenant_sub_ip': u'10.1.12.2/24', u'tenant_ns_ip': u'10.1.12.1/24', u'tenant_ns_if': u't2ns2if', u'tenant_sub_if': u't2s2if', u'tenant_ns_name': u't2'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip link show \"t2ns2if\" ; if [ $? -ne 0 ] ; then ip link add \"t2ns2if\" type veth peer name \"t2s2if\" ; fi\n", "delta": "0:00:00.010903", "end": "2019-11-17 10:51:10.455181", "item": [{"bridge_ip": "2.2.2.1", "bridge_name": "t2br2", "default_route_ip": "10.1.12.1", "dns": [{"brif": "t2s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t2s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns2", "route": [{"if": "p1", "ip": "10.1.12.1/24", "ns_if": "t2if", "ns_name": "t2"}], "vms": [{"brif": "t2br2if1", "disk": "10G", "mem": 3, "name": "t2_VM3", "vcpu": 2, "vmif": "t2VM3if1"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, {"tenant_ns_if": "t2ns2if", "tenant_ns_ip": "10.1.12.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s2if", "tenant_sub_ip": "10.1.12.2/24"}], "rc": 0, "start": "2019-11-17 10:51:10.444278", "stderr": "Device \"t2ns2if\" does not exist.", "stderr_lines": ["Device \"t2ns2if\" does not exist."], "stdout": "", "stdout_lines": []}

TASK [Attach Namespace VETH Pairs] **************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.11.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.1.11.1', u'bridge_name': u't2br1', u'dns': [{u'dnsif': u't2s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't2s1_dnsbrif'}], u'ns_name': u't2ns1', u'bridge_ip': u'1.1.1.1', u'vms': [{u'mem': 2, u'name': u't2_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't2br1if1', u'vmif': u't2VM1if1'}], u'vxlan': [{u'local_ip': u'10.1.11.2', u'dsport': 4789, u'dev': u't2s1if', u'tenant_route_ip': u'192.168.2.2', u'remote_route': u'10.2.11.0/24', u'subnet_route': u'10.1.11.0/24', u'v_name': u'vxlan_t2s1', u'id': 42, u'remote_ip': u'10.2.11.2'}]}, {u'tenant_sub_ip': u'10.1.11.2/24', u'tenant_ns_ip': u'10.1.11.1/24', u'tenant_ns_if': u't2ns1if', u'tenant_sub_if': u't2s1if', u'tenant_ns_name': u't2'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t2\" ip link show \"t2ns1if\" ; if [ $? -ne 0 ] ; then ip link set \"t2ns1if\" netns \"t2\" ; fi\nip netns exec \"t2ns1\" ip link show \"t2s1if\" ; if [ $? -ne 0 ] ; then ip link set \"t2s1if\" netns \"t2ns1\" ; fi\n", "delta": "0:00:00.067781", "end": "2019-11-17 10:51:10.807771", "item": [{"bridge_ip": "1.1.1.1", "bridge_name": "t2br1", "default_route_ip": "10.1.11.1", "dns": [{"brif": "t2s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t2s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns1", "route": [{"if": "p1", "ip": "10.1.11.1/24", "ns_if": "t2if", "ns_name": "t2"}], "vms": [{"brif": "t2br1if1", "disk": "10G", "mem": 2, "name": "t2_VM1", "vcpu": 4, "vmif": "t2VM1if1"}], "vxlan": [{"dev": "t2s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.11.2", "remote_ip": "10.2.11.2", "remote_route": "10.2.11.0/24", "subnet_route": "10.1.11.0/24", "tenant_route_ip": "192.168.2.2", "v_name": "vxlan_t2s1"}]}, {"tenant_ns_if": "t2ns1if", "tenant_ns_ip": "10.1.11.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s1if", "tenant_sub_ip": "10.1.11.2/24"}], "rc": 0, "start": "2019-11-17 10:51:10.739990", "stderr": "", "stderr_lines": [], "stdout": "60: t2ns1if@if59: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP mode DEFAULT group default qlen 1000\n    link/ether 96:80:de:74:5d:02 brd ff:ff:ff:ff:ff:ff link-netnsid 2\n59: t2s1if@if60: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP mode DEFAULT group default qlen 1000\n    link/ether d2:bb:68:42:40:26 brd ff:ff:ff:ff:ff:ff link-netnsid 0", "stdout_lines": ["60: t2ns1if@if59: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP mode DEFAULT group default qlen 1000", "    link/ether 96:80:de:74:5d:02 brd ff:ff:ff:ff:ff:ff link-netnsid 2", "59: t2s1if@if60: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP mode DEFAULT group default qlen 1000", "    link/ether d2:bb:68:42:40:26 brd ff:ff:ff:ff:ff:ff link-netnsid 0"]}
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.12.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.1.12.1', u'bridge_name': u't2br2', u'dns': [{u'dnsif': u't2s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't2s2_dnsbrif'}], u'ns_name': u't2ns2', u'bridge_ip': u'2.2.2.1', u'vms': [{u'mem': 3, u'name': u't2_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't2br2if1', u'vmif': u't2VM3if1'}], u'vxlan': [{u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}, {u'tenant_sub_ip': u'10.1.12.2/24', u'tenant_ns_ip': u'10.1.12.1/24', u'tenant_ns_if': u't2ns2if', u'tenant_sub_if': u't2s2if', u'tenant_ns_name': u't2'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t2\" ip link show \"t2ns2if\" ; if [ $? -ne 0 ] ; then ip link set \"t2ns2if\" netns \"t2\" ; fi\nip netns exec \"t2ns2\" ip link show \"t2s2if\" ; if [ $? -ne 0 ] ; then ip link set \"t2s2if\" netns \"t2ns2\" ; fi\n", "delta": "0:00:00.073004", "end": "2019-11-17 10:51:11.103707", "item": [{"bridge_ip": "2.2.2.1", "bridge_name": "t2br2", "default_route_ip": "10.1.12.1", "dns": [{"brif": "t2s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t2s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns2", "route": [{"if": "p1", "ip": "10.1.12.1/24", "ns_if": "t2if", "ns_name": "t2"}], "vms": [{"brif": "t2br2if1", "disk": "10G", "mem": 3, "name": "t2_VM3", "vcpu": 2, "vmif": "t2VM3if1"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, {"tenant_ns_if": "t2ns2if", "tenant_ns_ip": "10.1.12.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s2if", "tenant_sub_ip": "10.1.12.2/24"}], "rc": 0, "start": "2019-11-17 10:51:11.030703", "stderr": "", "stderr_lines": [], "stdout": "62: t2ns2if@if61: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP mode DEFAULT group default qlen 1000\n    link/ether 0a:d7:47:f5:d4:8f brd ff:ff:ff:ff:ff:ff link-netnsid 3\n61: t2s2if@if62: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP mode DEFAULT group default qlen 1000\n    link/ether 92:8f:8b:42:a1:42 brd ff:ff:ff:ff:ff:ff link-netnsid 0", "stdout_lines": ["62: t2ns2if@if61: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP mode DEFAULT group default qlen 1000", "    link/ether 0a:d7:47:f5:d4:8f brd ff:ff:ff:ff:ff:ff link-netnsid 3", "61: t2s2if@if62: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP mode DEFAULT group default qlen 1000", "    link/ether 92:8f:8b:42:a1:42 brd ff:ff:ff:ff:ff:ff link-netnsid 0"]}

TASK [Set Namespace VETH Pairs UP] **************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.11.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.1.11.1', u'bridge_name': u't2br1', u'dns': [{u'dnsif': u't2s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't2s1_dnsbrif'}], u'ns_name': u't2ns1', u'bridge_ip': u'1.1.1.1', u'vms': [{u'mem': 2, u'name': u't2_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't2br1if1', u'vmif': u't2VM1if1'}], u'vxlan': [{u'local_ip': u'10.1.11.2', u'dsport': 4789, u'dev': u't2s1if', u'tenant_route_ip': u'192.168.2.2', u'remote_route': u'10.2.11.0/24', u'subnet_route': u'10.1.11.0/24', u'v_name': u'vxlan_t2s1', u'id': 42, u'remote_ip': u'10.2.11.2'}]}, {u'tenant_sub_ip': u'10.1.11.2/24', u'tenant_ns_ip': u'10.1.11.1/24', u'tenant_ns_if': u't2ns1if', u'tenant_sub_if': u't2s1if', u'tenant_ns_name': u't2'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t2\" ip link set dev \"t2ns1if\" up\nip netns exec \"t2ns1\" ip link set dev \"t2s1if\" up\n", "delta": "0:00:00.094637", "end": "2019-11-17 10:51:11.487698", "item": [{"bridge_ip": "1.1.1.1", "bridge_name": "t2br1", "default_route_ip": "10.1.11.1", "dns": [{"brif": "t2s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t2s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns1", "route": [{"if": "p1", "ip": "10.1.11.1/24", "ns_if": "t2if", "ns_name": "t2"}], "vms": [{"brif": "t2br1if1", "disk": "10G", "mem": 2, "name": "t2_VM1", "vcpu": 4, "vmif": "t2VM1if1"}], "vxlan": [{"dev": "t2s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.11.2", "remote_ip": "10.2.11.2", "remote_route": "10.2.11.0/24", "subnet_route": "10.1.11.0/24", "tenant_route_ip": "192.168.2.2", "v_name": "vxlan_t2s1"}]}, {"tenant_ns_if": "t2ns1if", "tenant_ns_ip": "10.1.11.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s1if", "tenant_sub_ip": "10.1.11.2/24"}], "rc": 0, "start": "2019-11-17 10:51:11.393061", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.12.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.1.12.1', u'bridge_name': u't2br2', u'dns': [{u'dnsif': u't2s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't2s2_dnsbrif'}], u'ns_name': u't2ns2', u'bridge_ip': u'2.2.2.1', u'vms': [{u'mem': 3, u'name': u't2_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't2br2if1', u'vmif': u't2VM3if1'}], u'vxlan': [{u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}, {u'tenant_sub_ip': u'10.1.12.2/24', u'tenant_ns_ip': u'10.1.12.1/24', u'tenant_ns_if': u't2ns2if', u'tenant_sub_if': u't2s2if', u'tenant_ns_name': u't2'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t2\" ip link set dev \"t2ns2if\" up\nip netns exec \"t2ns2\" ip link set dev \"t2s2if\" up\n", "delta": "0:00:00.078126", "end": "2019-11-17 10:51:11.755665", "item": [{"bridge_ip": "2.2.2.1", "bridge_name": "t2br2", "default_route_ip": "10.1.12.1", "dns": [{"brif": "t2s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t2s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns2", "route": [{"if": "p1", "ip": "10.1.12.1/24", "ns_if": "t2if", "ns_name": "t2"}], "vms": [{"brif": "t2br2if1", "disk": "10G", "mem": 3, "name": "t2_VM3", "vcpu": 2, "vmif": "t2VM3if1"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, {"tenant_ns_if": "t2ns2if", "tenant_ns_ip": "10.1.12.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s2if", "tenant_sub_ip": "10.1.12.2/24"}], "rc": 0, "start": "2019-11-17 10:51:11.677539", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Add IP addresses to Namespace VETH Pairs] *************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.11.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.1.11.1', u'bridge_name': u't2br1', u'dns': [{u'dnsif': u't2s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't2s1_dnsbrif'}], u'ns_name': u't2ns1', u'bridge_ip': u'1.1.1.1', u'vms': [{u'mem': 2, u'name': u't2_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't2br1if1', u'vmif': u't2VM1if1'}], u'vxlan': [{u'local_ip': u'10.1.11.2', u'dsport': 4789, u'dev': u't2s1if', u'tenant_route_ip': u'192.168.2.2', u'remote_route': u'10.2.11.0/24', u'subnet_route': u'10.1.11.0/24', u'v_name': u'vxlan_t2s1', u'id': 42, u'remote_ip': u'10.2.11.2'}]}, {u'tenant_sub_ip': u'10.1.11.2/24', u'tenant_ns_ip': u'10.1.11.1/24', u'tenant_ns_if': u't2ns1if', u'tenant_sub_if': u't2s1if', u'tenant_ns_name': u't2'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t2ns1\" ip addr show \"t2s1if\" | awk 'FNR==3{ print $2 }' | grep -w '^10.1.11.2/24' ; if [ $? -ne 0 ] ; then ip netns exec \"t2ns1\" ip addr add \"10.1.11.2/24\" dev \"t2s1if\" ; fi\n\nip netns exec \"t2\" ip addr show \"t2ns1if\" | awk 'FNR==3{ print $2 }' | grep -w '^10.1.11.1/24' ; if [ $? -ne 0 ] ; then ip netns exec \"t2\" ip addr add \"10.1.11.1/24\" dev \"t2ns1if\" ; fi\n", "delta": "0:00:00.076296", "end": "2019-11-17 10:51:12.088049", "item": [{"bridge_ip": "1.1.1.1", "bridge_name": "t2br1", "default_route_ip": "10.1.11.1", "dns": [{"brif": "t2s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t2s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns1", "route": [{"if": "p1", "ip": "10.1.11.1/24", "ns_if": "t2if", "ns_name": "t2"}], "vms": [{"brif": "t2br1if1", "disk": "10G", "mem": 2, "name": "t2_VM1", "vcpu": 4, "vmif": "t2VM1if1"}], "vxlan": [{"dev": "t2s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.11.2", "remote_ip": "10.2.11.2", "remote_route": "10.2.11.0/24", "subnet_route": "10.1.11.0/24", "tenant_route_ip": "192.168.2.2", "v_name": "vxlan_t2s1"}]}, {"tenant_ns_if": "t2ns1if", "tenant_ns_ip": "10.1.11.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s1if", "tenant_sub_ip": "10.1.11.2/24"}], "rc": 0, "start": "2019-11-17 10:51:12.011753", "stderr": "", "stderr_lines": [], "stdout": "10.1.11.2/24\n10.1.11.1/24", "stdout_lines": ["10.1.11.2/24", "10.1.11.1/24"]}
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.12.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.1.12.1', u'bridge_name': u't2br2', u'dns': [{u'dnsif': u't2s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't2s2_dnsbrif'}], u'ns_name': u't2ns2', u'bridge_ip': u'2.2.2.1', u'vms': [{u'mem': 3, u'name': u't2_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't2br2if1', u'vmif': u't2VM3if1'}], u'vxlan': [{u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}, {u'tenant_sub_ip': u'10.1.12.2/24', u'tenant_ns_ip': u'10.1.12.1/24', u'tenant_ns_if': u't2ns2if', u'tenant_sub_if': u't2s2if', u'tenant_ns_name': u't2'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t2ns2\" ip addr show \"t2s2if\" | awk 'FNR==3{ print $2 }' | grep -w '^10.1.12.2/24' ; if [ $? -ne 0 ] ; then ip netns exec \"t2ns2\" ip addr add \"10.1.12.2/24\" dev \"t2s2if\" ; fi\n\nip netns exec \"t2\" ip addr show \"t2ns2if\" | awk 'FNR==3{ print $2 }' | grep -w '^10.1.12.1/24' ; if [ $? -ne 0 ] ; then ip netns exec \"t2\" ip addr add \"10.1.12.1/24\" dev \"t2ns2if\" ; fi\n", "delta": "0:00:00.075955", "end": "2019-11-17 10:51:12.359794", "item": [{"bridge_ip": "2.2.2.1", "bridge_name": "t2br2", "default_route_ip": "10.1.12.1", "dns": [{"brif": "t2s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t2s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns2", "route": [{"if": "p1", "ip": "10.1.12.1/24", "ns_if": "t2if", "ns_name": "t2"}], "vms": [{"brif": "t2br2if1", "disk": "10G", "mem": 3, "name": "t2_VM3", "vcpu": 2, "vmif": "t2VM3if1"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, {"tenant_ns_if": "t2ns2if", "tenant_ns_ip": "10.1.12.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s2if", "tenant_sub_ip": "10.1.12.2/24"}], "rc": 0, "start": "2019-11-17 10:51:12.283839", "stderr": "", "stderr_lines": [], "stdout": "10.1.12.2/24\n10.1.12.1/24", "stdout_lines": ["10.1.12.2/24", "10.1.12.1/24"]}

TASK [Add IP Route to Tenant] *******************************************************************************************************************************
changed: [localhost] => (item={u'default_route_ip': u'192.168.2.1', u'name': u't2', u'pns_ip': u'192.168.2.1/24', u'tenant_if': u't2if', u'tenant_ip': u'192.168.2.2/24', u'pns_if': u't2pns_if'}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t2\" ip route show default | grep -w '[d]efault via 192.168.2.1' ; if [ $? -ne 0 ] ; then ip netns exec \"t2\" ip route add default via \"192.168.2.1\" ; fi\n", "delta": "0:00:00.030726", "end": "2019-11-17 10:51:12.639800", "item": {"default_route_ip": "192.168.2.1", "name": "t2", "pns_if": "t2pns_if", "pns_ip": "192.168.2.1/24", "tenant_if": "t2if", "tenant_ip": "192.168.2.2/24"}, "rc": 0, "start": "2019-11-17 10:51:12.609074", "stderr": "", "stderr_lines": [], "stdout": "default via 192.168.2.1 dev t2if ", "stdout_lines": ["default via 192.168.2.1 dev t2if "]}

TASK [Add IP Route to Tenant Subnet] ************************************************************************************************************************
changed: [localhost] => (item={u'route': [{u'ip': u'10.1.11.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.1.11.1', u'bridge_name': u't2br1', u'dns': [{u'dnsif': u't2s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't2s1_dnsbrif'}], u'ns_name': u't2ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.11.2/24', u'tenant_ns_ip': u'10.1.11.1/24', u'tenant_ns_if': u't2ns1if', u'tenant_ns_name': u't2', u'tenant_sub_if': u't2s1if'}], u'bridge_ip': u'1.1.1.1', u'vms': [{u'mem': 2, u'name': u't2_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't2br1if1', u'vmif': u't2VM1if1'}], u'vxlan': [{u'local_ip': u'10.1.11.2', u'tenant_route_ip': u'192.168.2.2', u'dsport': 4789, u'dev': u't2s1if', u'subnet_route': u'10.1.11.0/24', u'remote_route': u'10.2.11.0/24', u'v_name': u'vxlan_t2s1', u'id': 42, u'remote_ip': u'10.2.11.2'}]}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t2ns1\" ip route show default | grep -w '[d]efault via 10.1.11.1' ; if [ $? -ne 0 ] ; then ip netns exec \"t2ns1\" ip route add default via \"10.1.11.1\" ; fi\n", "delta": "0:00:00.038678", "end": "2019-11-17 10:51:12.964042", "item": {"bridge_ip": "1.1.1.1", "bridge_name": "t2br1", "default_route_ip": "10.1.11.1", "dns": [{"brif": "t2s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t2s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns1", "route": [{"if": "p1", "ip": "10.1.11.1/24", "ns_if": "t2if", "ns_name": "t2"}], "tenant_ns": [{"tenant_ns_if": "t2ns1if", "tenant_ns_ip": "10.1.11.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s1if", "tenant_sub_ip": "10.1.11.2/24"}], "vms": [{"brif": "t2br1if1", "disk": "10G", "mem": 2, "name": "t2_VM1", "vcpu": 4, "vmif": "t2VM1if1"}], "vxlan": [{"dev": "t2s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.11.2", "remote_ip": "10.2.11.2", "remote_route": "10.2.11.0/24", "subnet_route": "10.1.11.0/24", "tenant_route_ip": "192.168.2.2", "v_name": "vxlan_t2s1"}]}, "rc": 0, "start": "2019-11-17 10:51:12.925364", "stderr": "", "stderr_lines": [], "stdout": "default via 10.1.11.1 dev t2s1if ", "stdout_lines": ["default via 10.1.11.1 dev t2s1if "]}
changed: [localhost] => (item={u'route': [{u'ip': u'10.1.12.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.1.12.1', u'bridge_name': u't2br2', u'dns': [{u'dnsif': u't2s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't2s2_dnsbrif'}], u'ns_name': u't2ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.12.2/24', u'tenant_ns_ip': u'10.1.12.1/24', u'tenant_ns_if': u't2ns2if', u'tenant_ns_name': u't2', u'tenant_sub_if': u't2s2if'}], u'bridge_ip': u'2.2.2.1', u'vms': [{u'mem': 3, u'name': u't2_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't2br2if1', u'vmif': u't2VM3if1'}], u'vxlan': [{u'local_ip': [], u'tenant_route_ip': [], u'dsport': [], u'dev': [], u'subnet_route': [], u'remote_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t2ns2\" ip route show default | grep -w '[d]efault via 10.1.12.1' ; if [ $? -ne 0 ] ; then ip netns exec \"t2ns2\" ip route add default via \"10.1.12.1\" ; fi\n", "delta": "0:00:00.030322", "end": "2019-11-17 10:51:13.211823", "item": {"bridge_ip": "2.2.2.1", "bridge_name": "t2br2", "default_route_ip": "10.1.12.1", "dns": [{"brif": "t2s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t2s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns2", "route": [{"if": "p1", "ip": "10.1.12.1/24", "ns_if": "t2if", "ns_name": "t2"}], "tenant_ns": [{"tenant_ns_if": "t2ns2if", "tenant_ns_ip": "10.1.12.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s2if", "tenant_sub_ip": "10.1.12.2/24"}], "vms": [{"brif": "t2br2if1", "disk": "10G", "mem": 3, "name": "t2_VM3", "vcpu": 2, "vmif": "t2VM3if1"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, "rc": 0, "start": "2019-11-17 10:51:13.181501", "stderr": "", "stderr_lines": [], "stdout": "default via 10.1.12.1 dev t2s2if ", "stdout_lines": ["default via 10.1.12.1 dev t2s2if "]}

TASK [Create bridge inside namespace] ***********************************************************************************************************************
changed: [localhost] => (item={u'route': [{u'ip': u'10.1.11.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.1.11.1', u'bridge_name': u't2br1', u'dns': [{u'dnsif': u't2s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't2s1_dnsbrif'}], u'ns_name': u't2ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.11.2/24', u'tenant_ns_ip': u'10.1.11.1/24', u'tenant_ns_if': u't2ns1if', u'tenant_ns_name': u't2', u'tenant_sub_if': u't2s1if'}], u'bridge_ip': u'1.1.1.1', u'vms': [{u'mem': 2, u'name': u't2_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't2br1if1', u'vmif': u't2VM1if1'}], u'vxlan': [{u'local_ip': u'10.1.11.2', u'tenant_route_ip': u'192.168.2.2', u'dsport': 4789, u'dev': u't2s1if', u'subnet_route': u'10.1.11.0/24', u'remote_route': u'10.2.11.0/24', u'v_name': u'vxlan_t2s1', u'id': 42, u'remote_ip': u'10.2.11.2'}]}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t2ns1\" brctl show | grep -w '^t2br1'; if [ $? -ne 0 ] ; then ip netns exec \"t2ns1\" brctl addbr \"t2br1\" ; fi\nip netns exec \"t2ns1\" ip link set dev \"t2br1\" up\n", "delta": "0:00:00.072122", "end": "2019-11-17 10:51:13.571754", "item": {"bridge_ip": "1.1.1.1", "bridge_name": "t2br1", "default_route_ip": "10.1.11.1", "dns": [{"brif": "t2s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t2s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns1", "route": [{"if": "p1", "ip": "10.1.11.1/24", "ns_if": "t2if", "ns_name": "t2"}], "tenant_ns": [{"tenant_ns_if": "t2ns1if", "tenant_ns_ip": "10.1.11.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s1if", "tenant_sub_ip": "10.1.11.2/24"}], "vms": [{"brif": "t2br1if1", "disk": "10G", "mem": 2, "name": "t2_VM1", "vcpu": 4, "vmif": "t2VM1if1"}], "vxlan": [{"dev": "t2s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.11.2", "remote_ip": "10.2.11.2", "remote_route": "10.2.11.0/24", "subnet_route": "10.1.11.0/24", "tenant_route_ip": "192.168.2.2", "v_name": "vxlan_t2s1"}]}, "rc": 0, "start": "2019-11-17 10:51:13.499632", "stderr": "", "stderr_lines": [], "stdout": "t2br1\t\t8000.26a03cc220db\tno\t\tt2br1if1", "stdout_lines": ["t2br1\t\t8000.26a03cc220db\tno\t\tt2br1if1"]}
changed: [localhost] => (item={u'route': [{u'ip': u'10.1.12.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.1.12.1', u'bridge_name': u't2br2', u'dns': [{u'dnsif': u't2s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't2s2_dnsbrif'}], u'ns_name': u't2ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.12.2/24', u'tenant_ns_ip': u'10.1.12.1/24', u'tenant_ns_if': u't2ns2if', u'tenant_ns_name': u't2', u'tenant_sub_if': u't2s2if'}], u'bridge_ip': u'2.2.2.1', u'vms': [{u'mem': 3, u'name': u't2_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't2br2if1', u'vmif': u't2VM3if1'}], u'vxlan': [{u'local_ip': [], u'tenant_route_ip': [], u'dsport': [], u'dev': [], u'subnet_route': [], u'remote_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t2ns2\" brctl show | grep -w '^t2br2'; if [ $? -ne 0 ] ; then ip netns exec \"t2ns2\" brctl addbr \"t2br2\" ; fi\nip netns exec \"t2ns2\" ip link set dev \"t2br2\" up\n", "delta": "0:00:00.078325", "end": "2019-11-17 10:51:13.867663", "item": {"bridge_ip": "2.2.2.1", "bridge_name": "t2br2", "default_route_ip": "10.1.12.1", "dns": [{"brif": "t2s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t2s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns2", "route": [{"if": "p1", "ip": "10.1.12.1/24", "ns_if": "t2if", "ns_name": "t2"}], "tenant_ns": [{"tenant_ns_if": "t2ns2if", "tenant_ns_ip": "10.1.12.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s2if", "tenant_sub_ip": "10.1.12.2/24"}], "vms": [{"brif": "t2br2if1", "disk": "10G", "mem": 3, "name": "t2_VM3", "vcpu": 2, "vmif": "t2VM3if1"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, "rc": 0, "start": "2019-11-17 10:51:13.789338", "stderr": "", "stderr_lines": [], "stdout": "t2br2\t\t8000.06f124ac9573\tno\t\tt2br2if1", "stdout_lines": ["t2br2\t\t8000.06f124ac9573\tno\t\tt2br2if1"]}

TASK [Create DNS VETH Pair] *********************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.11.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.1.11.1', u'bridge_name': u't2br1', u'ns_name': u't2ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.11.2/24', u'tenant_ns_ip': u'10.1.11.1/24', u'tenant_ns_if': u't2ns1if', u'tenant_sub_if': u't2s1if', u'tenant_ns_name': u't2'}], u'bridge_ip': u'1.1.1.1', u'vms': [{u'mem': 2, u'name': u't2_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't2br1if1', u'vmif': u't2VM1if1'}], u'vxlan': [{u'local_ip': u'10.1.11.2', u'dsport': 4789, u'dev': u't2s1if', u'tenant_route_ip': u'192.168.2.2', u'remote_route': u'10.2.11.0/24', u'subnet_route': u'10.1.11.0/24', u'v_name': u'vxlan_t2s1', u'id': 42, u'remote_ip': u'10.2.11.2'}]}, {u'dnsif': u't2s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't2s1_dnsbrif'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t2ns1\" ip link show \"t2s1_dnsbrif\" ; if [ $? -ne 0 ] ; then ip netns exec \"t2ns1\" ip link add \"t2s1_dnsbrif\" type veth peer name \"t2s1_dnsif\" ; fi\nip netns exec \"t2ns1\" ip link set dev \"t2s1_dnsbrif\" up\nip netns exec \"t2ns1\" ip link set dev \"t2s1_dnsif\" up\n", "delta": "0:00:00.124015", "end": "2019-11-17 10:51:14.283763", "item": [{"bridge_ip": "1.1.1.1", "bridge_name": "t2br1", "default_route_ip": "10.1.11.1", "ns_name": "t2ns1", "route": [{"if": "p1", "ip": "10.1.11.1/24", "ns_if": "t2if", "ns_name": "t2"}], "tenant_ns": [{"tenant_ns_if": "t2ns1if", "tenant_ns_ip": "10.1.11.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s1if", "tenant_sub_ip": "10.1.11.2/24"}], "vms": [{"brif": "t2br1if1", "disk": "10G", "mem": 2, "name": "t2_VM1", "vcpu": 4, "vmif": "t2VM1if1"}], "vxlan": [{"dev": "t2s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.11.2", "remote_ip": "10.2.11.2", "remote_route": "10.2.11.0/24", "subnet_route": "10.1.11.0/24", "tenant_route_ip": "192.168.2.2", "v_name": "vxlan_t2s1"}]}, {"brif": "t2s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t2s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "rc": 0, "start": "2019-11-17 10:51:14.159748", "stderr": "", "stderr_lines": [], "stdout": "4: t2s1_dnsbrif@t2s1_dnsif: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue master t2br1 state UP mode DEFAULT group default qlen 1000\n    link/ether 82:6d:02:6a:c9:40 brd ff:ff:ff:ff:ff:ff", "stdout_lines": ["4: t2s1_dnsbrif@t2s1_dnsif: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue master t2br1 state UP mode DEFAULT group default qlen 1000", "    link/ether 82:6d:02:6a:c9:40 brd ff:ff:ff:ff:ff:ff"]}
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.12.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.1.12.1', u'bridge_name': u't2br2', u'ns_name': u't2ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.12.2/24', u'tenant_ns_ip': u'10.1.12.1/24', u'tenant_ns_if': u't2ns2if', u'tenant_sub_if': u't2s2if', u'tenant_ns_name': u't2'}], u'bridge_ip': u'2.2.2.1', u'vms': [{u'mem': 3, u'name': u't2_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't2br2if1', u'vmif': u't2VM3if1'}], u'vxlan': [{u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}, {u'dnsif': u't2s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't2s2_dnsbrif'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t2ns2\" ip link show \"t2s2_dnsbrif\" ; if [ $? -ne 0 ] ; then ip netns exec \"t2ns2\" ip link add \"t2s2_dnsbrif\" type veth peer name \"t2s2_dnsif\" ; fi\nip netns exec \"t2ns2\" ip link set dev \"t2s2_dnsbrif\" up\nip netns exec \"t2ns2\" ip link set dev \"t2s2_dnsif\" up\n", "delta": "0:00:00.106972", "end": "2019-11-17 10:51:14.611491", "item": [{"bridge_ip": "2.2.2.1", "bridge_name": "t2br2", "default_route_ip": "10.1.12.1", "ns_name": "t2ns2", "route": [{"if": "p1", "ip": "10.1.12.1/24", "ns_if": "t2if", "ns_name": "t2"}], "tenant_ns": [{"tenant_ns_if": "t2ns2if", "tenant_ns_ip": "10.1.12.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s2if", "tenant_sub_ip": "10.1.12.2/24"}], "vms": [{"brif": "t2br2if1", "disk": "10G", "mem": 3, "name": "t2_VM3", "vcpu": 2, "vmif": "t2VM3if1"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, {"brif": "t2s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t2s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "rc": 0, "start": "2019-11-17 10:51:14.504519", "stderr": "", "stderr_lines": [], "stdout": "4: t2s2_dnsbrif@t2s2_dnsif: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue master t2br2 state UP mode DEFAULT group default qlen 1000\n    link/ether 36:2c:8b:61:98:d5 brd ff:ff:ff:ff:ff:ff", "stdout_lines": ["4: t2s2_dnsbrif@t2s2_dnsif: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue master t2br2 state UP mode DEFAULT group default qlen 1000", "    link/ether 36:2c:8b:61:98:d5 brd ff:ff:ff:ff:ff:ff"]}

TASK [Attach DNS VETH Pair] *********************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.11.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.1.11.1', u'bridge_name': u't2br1', u'ns_name': u't2ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.11.2/24', u'tenant_ns_ip': u'10.1.11.1/24', u'tenant_ns_if': u't2ns1if', u'tenant_sub_if': u't2s1if', u'tenant_ns_name': u't2'}], u'bridge_ip': u'1.1.1.1', u'vms': [{u'mem': 2, u'name': u't2_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't2br1if1', u'vmif': u't2VM1if1'}], u'vxlan': [{u'local_ip': u'10.1.11.2', u'dsport': 4789, u'dev': u't2s1if', u'tenant_route_ip': u'192.168.2.2', u'remote_route': u'10.2.11.0/24', u'subnet_route': u'10.1.11.0/24', u'v_name': u'vxlan_t2s1', u'id': 42, u'remote_ip': u'10.2.11.2'}]}, {u'dnsif': u't2s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't2s1_dnsbrif'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t2ns1\" brctl show \"t2br1\" | grep -w 't2s1_dnsbrif' ; if [ $? -ne 0 ] ; then ip netns exec \"t2ns1\" brctl addif \"t2br1\" \"t2s1_dnsbrif\" ; fi\n", "delta": "0:00:00.035202", "end": "2019-11-17 10:51:14.895620", "item": [{"bridge_ip": "1.1.1.1", "bridge_name": "t2br1", "default_route_ip": "10.1.11.1", "ns_name": "t2ns1", "route": [{"if": "p1", "ip": "10.1.11.1/24", "ns_if": "t2if", "ns_name": "t2"}], "tenant_ns": [{"tenant_ns_if": "t2ns1if", "tenant_ns_ip": "10.1.11.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s1if", "tenant_sub_ip": "10.1.11.2/24"}], "vms": [{"brif": "t2br1if1", "disk": "10G", "mem": 2, "name": "t2_VM1", "vcpu": 4, "vmif": "t2VM1if1"}], "vxlan": [{"dev": "t2s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.11.2", "remote_ip": "10.2.11.2", "remote_route": "10.2.11.0/24", "subnet_route": "10.1.11.0/24", "tenant_route_ip": "192.168.2.2", "v_name": "vxlan_t2s1"}]}, {"brif": "t2s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t2s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "rc": 0, "start": "2019-11-17 10:51:14.860418", "stderr": "", "stderr_lines": [], "stdout": "\t\t\t\t\t\t\tt2s1_dnsbrif", "stdout_lines": ["\t\t\t\t\t\t\tt2s1_dnsbrif"]}
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.12.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.1.12.1', u'bridge_name': u't2br2', u'ns_name': u't2ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.12.2/24', u'tenant_ns_ip': u'10.1.12.1/24', u'tenant_ns_if': u't2ns2if', u'tenant_sub_if': u't2s2if', u'tenant_ns_name': u't2'}], u'bridge_ip': u'2.2.2.1', u'vms': [{u'mem': 3, u'name': u't2_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't2br2if1', u'vmif': u't2VM3if1'}], u'vxlan': [{u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}, {u'dnsif': u't2s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't2s2_dnsbrif'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t2ns2\" brctl show \"t2br2\" | grep -w 't2s2_dnsbrif' ; if [ $? -ne 0 ] ; then ip netns exec \"t2ns2\" brctl addif \"t2br2\" \"t2s2_dnsbrif\" ; fi\n", "delta": "0:00:00.040240", "end": "2019-11-17 10:51:15.123608", "item": [{"bridge_ip": "2.2.2.1", "bridge_name": "t2br2", "default_route_ip": "10.1.12.1", "ns_name": "t2ns2", "route": [{"if": "p1", "ip": "10.1.12.1/24", "ns_if": "t2if", "ns_name": "t2"}], "tenant_ns": [{"tenant_ns_if": "t2ns2if", "tenant_ns_ip": "10.1.12.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s2if", "tenant_sub_ip": "10.1.12.2/24"}], "vms": [{"brif": "t2br2if1", "disk": "10G", "mem": 3, "name": "t2_VM3", "vcpu": 2, "vmif": "t2VM3if1"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, {"brif": "t2s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t2s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "rc": 0, "start": "2019-11-17 10:51:15.083368", "stderr": "", "stderr_lines": [], "stdout": "\t\t\t\t\t\t\tt2s2_dnsbrif", "stdout_lines": ["\t\t\t\t\t\t\tt2s2_dnsbrif"]}

TASK [Create VETH Pairs] ************************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.11.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.1.11.1', u'bridge_name': u't2br1', u'dns': [{u'dnsif': u't2s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't2s1_dnsbrif'}], u'ns_name': u't2ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.11.2/24', u'tenant_ns_ip': u'10.1.11.1/24', u'tenant_ns_if': u't2ns1if', u'tenant_sub_if': u't2s1if', u'tenant_ns_name': u't2'}], u'bridge_ip': u'1.1.1.1', u'vxlan': [{u'local_ip': u'10.1.11.2', u'dsport': 4789, u'dev': u't2s1if', u'tenant_route_ip': u'192.168.2.2', u'remote_route': u'10.2.11.0/24', u'subnet_route': u'10.1.11.0/24', u'v_name': u'vxlan_t2s1', u'id': 42, u'remote_ip': u'10.2.11.2'}]}, {u'mem': 2, u'name': u't2_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't2br1if1', u'vmif': u't2VM1if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip link show \"t2br1if1\" ; if [ $? -ne 0 ] ; then ip link add \"t2VM1if1\" type veth peer name \"t2br1if1\" ; fi\nip link set dev \"t2br1if1\" up\nip link set dev \"t2VM1if1\" up\n", "delta": "0:00:00.013066", "end": "2019-11-17 10:51:15.392465", "item": [{"bridge_ip": "1.1.1.1", "bridge_name": "t2br1", "default_route_ip": "10.1.11.1", "dns": [{"brif": "t2s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t2s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns1", "route": [{"if": "p1", "ip": "10.1.11.1/24", "ns_if": "t2if", "ns_name": "t2"}], "tenant_ns": [{"tenant_ns_if": "t2ns1if", "tenant_ns_ip": "10.1.11.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s1if", "tenant_sub_ip": "10.1.11.2/24"}], "vxlan": [{"dev": "t2s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.11.2", "remote_ip": "10.2.11.2", "remote_route": "10.2.11.0/24", "subnet_route": "10.1.11.0/24", "tenant_route_ip": "192.168.2.2", "v_name": "vxlan_t2s1"}]}, {"brif": "t2br1if1", "disk": "10G", "mem": 2, "name": "t2_VM1", "vcpu": 4, "vmif": "t2VM1if1"}], "rc": 0, "start": "2019-11-17 10:51:15.379399", "stderr": "Device \"t2br1if1\" does not exist.\nRTNETLINK answers: File exists\nCannot find device \"t2br1if1\"", "stderr_lines": ["Device \"t2br1if1\" does not exist.", "RTNETLINK answers: File exists", "Cannot find device \"t2br1if1\""], "stdout": "", "stdout_lines": []}
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.12.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.1.12.1', u'bridge_name': u't2br2', u'dns': [{u'dnsif': u't2s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't2s2_dnsbrif'}], u'ns_name': u't2ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.12.2/24', u'tenant_ns_ip': u'10.1.12.1/24', u'tenant_ns_if': u't2ns2if', u'tenant_sub_if': u't2s2if', u'tenant_ns_name': u't2'}], u'bridge_ip': u'2.2.2.1', u'vxlan': [{u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}, {u'mem': 3, u'name': u't2_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't2br2if1', u'vmif': u't2VM3if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip link show \"t2br2if1\" ; if [ $? -ne 0 ] ; then ip link add \"t2VM3if1\" type veth peer name \"t2br2if1\" ; fi\nip link set dev \"t2br2if1\" up\nip link set dev \"t2VM3if1\" up\n", "delta": "0:00:00.013376", "end": "2019-11-17 10:51:15.608577", "item": [{"bridge_ip": "2.2.2.1", "bridge_name": "t2br2", "default_route_ip": "10.1.12.1", "dns": [{"brif": "t2s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t2s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns2", "route": [{"if": "p1", "ip": "10.1.12.1/24", "ns_if": "t2if", "ns_name": "t2"}], "tenant_ns": [{"tenant_ns_if": "t2ns2if", "tenant_ns_ip": "10.1.12.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s2if", "tenant_sub_ip": "10.1.12.2/24"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, {"brif": "t2br2if1", "disk": "10G", "mem": 3, "name": "t2_VM3", "vcpu": 2, "vmif": "t2VM3if1"}], "rc": 0, "start": "2019-11-17 10:51:15.595201", "stderr": "Device \"t2br2if1\" does not exist.\nRTNETLINK answers: File exists\nCannot find device \"t2br2if1\"", "stderr_lines": ["Device \"t2br2if1\" does not exist.", "RTNETLINK answers: File exists", "Cannot find device \"t2br2if1\""], "stdout": "", "stdout_lines": []}

TASK [Attach VETH Pairs] ************************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.11.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.1.11.1', u'bridge_name': u't2br1', u'dns': [{u'dnsif': u't2s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't2s1_dnsbrif'}], u'ns_name': u't2ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.11.2/24', u'tenant_ns_ip': u'10.1.11.1/24', u'tenant_ns_if': u't2ns1if', u'tenant_sub_if': u't2s1if', u'tenant_ns_name': u't2'}], u'bridge_ip': u'1.1.1.1', u'vxlan': [{u'local_ip': u'10.1.11.2', u'dsport': 4789, u'dev': u't2s1if', u'tenant_route_ip': u'192.168.2.2', u'remote_route': u'10.2.11.0/24', u'subnet_route': u'10.1.11.0/24', u'v_name': u'vxlan_t2s1', u'id': 42, u'remote_ip': u'10.2.11.2'}]}, {u'mem': 2, u'name': u't2_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't2br1if1', u'vmif': u't2VM1if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip link show \"t2br1if1\" ; if [ $? -eq 0 ] ; then ip link set \"t2br1if1\" netns \"t2ns1\" ; fi\nip netns exec \"t2ns1\" brctl show \"t2br1\" | grep -w 't2br1if1' ; if [ $? -ne 0 ] ; then ip netns exec \"t2ns1\" brctl addif \"t2br1\" \"t2br1if1\" ; fi\n", "delta": "0:00:00.038564", "end": "2019-11-17 10:51:15.951796", "item": [{"bridge_ip": "1.1.1.1", "bridge_name": "t2br1", "default_route_ip": "10.1.11.1", "dns": [{"brif": "t2s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t2s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns1", "route": [{"if": "p1", "ip": "10.1.11.1/24", "ns_if": "t2if", "ns_name": "t2"}], "tenant_ns": [{"tenant_ns_if": "t2ns1if", "tenant_ns_ip": "10.1.11.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s1if", "tenant_sub_ip": "10.1.11.2/24"}], "vxlan": [{"dev": "t2s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.11.2", "remote_ip": "10.2.11.2", "remote_route": "10.2.11.0/24", "subnet_route": "10.1.11.0/24", "tenant_route_ip": "192.168.2.2", "v_name": "vxlan_t2s1"}]}, {"brif": "t2br1if1", "disk": "10G", "mem": 2, "name": "t2_VM1", "vcpu": 4, "vmif": "t2VM1if1"}], "rc": 0, "start": "2019-11-17 10:51:15.913232", "stderr": "Device \"t2br1if1\" does not exist.", "stderr_lines": ["Device \"t2br1if1\" does not exist."], "stdout": "t2br1\t\t8000.26a03cc220db\tno\t\tt2br1if1", "stdout_lines": ["t2br1\t\t8000.26a03cc220db\tno\t\tt2br1if1"]}
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.12.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.1.12.1', u'bridge_name': u't2br2', u'dns': [{u'dnsif': u't2s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't2s2_dnsbrif'}], u'ns_name': u't2ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.12.2/24', u'tenant_ns_ip': u'10.1.12.1/24', u'tenant_ns_if': u't2ns2if', u'tenant_sub_if': u't2s2if', u'tenant_ns_name': u't2'}], u'bridge_ip': u'2.2.2.1', u'vxlan': [{u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}, {u'mem': 3, u'name': u't2_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't2br2if1', u'vmif': u't2VM3if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip link show \"t2br2if1\" ; if [ $? -eq 0 ] ; then ip link set \"t2br2if1\" netns \"t2ns2\" ; fi\nip netns exec \"t2ns2\" brctl show \"t2br2\" | grep -w 't2br2if1' ; if [ $? -ne 0 ] ; then ip netns exec \"t2ns2\" brctl addif \"t2br2\" \"t2br2if1\" ; fi\n", "delta": "0:00:00.046526", "end": "2019-11-17 10:51:16.215880", "item": [{"bridge_ip": "2.2.2.1", "bridge_name": "t2br2", "default_route_ip": "10.1.12.1", "dns": [{"brif": "t2s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t2s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns2", "route": [{"if": "p1", "ip": "10.1.12.1/24", "ns_if": "t2if", "ns_name": "t2"}], "tenant_ns": [{"tenant_ns_if": "t2ns2if", "tenant_ns_ip": "10.1.12.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s2if", "tenant_sub_ip": "10.1.12.2/24"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, {"brif": "t2br2if1", "disk": "10G", "mem": 3, "name": "t2_VM3", "vcpu": 2, "vmif": "t2VM3if1"}], "rc": 0, "start": "2019-11-17 10:51:16.169354", "stderr": "Device \"t2br2if1\" does not exist.", "stderr_lines": ["Device \"t2br2if1\" does not exist."], "stdout": "t2br2\t\t8000.06f124ac9573\tno\t\tt2br2if1", "stdout_lines": ["t2br2\t\t8000.06f124ac9573\tno\t\tt2br2if1"]}

TASK [All interfaces and bridges UP] ************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.11.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.1.11.1', u'bridge_name': u't2br1', u'dns': [{u'dnsif': u't2s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't2s1_dnsbrif'}], u'ns_name': u't2ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.11.2/24', u'tenant_ns_ip': u'10.1.11.1/24', u'tenant_ns_if': u't2ns1if', u'tenant_sub_if': u't2s1if', u'tenant_ns_name': u't2'}], u'bridge_ip': u'1.1.1.1', u'vxlan': [{u'local_ip': u'10.1.11.2', u'dsport': 4789, u'dev': u't2s1if', u'tenant_route_ip': u'192.168.2.2', u'remote_route': u'10.2.11.0/24', u'subnet_route': u'10.1.11.0/24', u'v_name': u'vxlan_t2s1', u'id': 42, u'remote_ip': u'10.2.11.2'}]}, {u'mem': 2, u'name': u't2_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't2br1if1', u'vmif': u't2VM1if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t2ns1\" ip link set \"t2br1if1\" up\nip netns exec \"t2ns1\" ip link set dev \"t2br1\" up\n", "delta": "0:00:00.073576", "end": "2019-11-17 10:51:16.567766", "item": [{"bridge_ip": "1.1.1.1", "bridge_name": "t2br1", "default_route_ip": "10.1.11.1", "dns": [{"brif": "t2s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t2s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns1", "route": [{"if": "p1", "ip": "10.1.11.1/24", "ns_if": "t2if", "ns_name": "t2"}], "tenant_ns": [{"tenant_ns_if": "t2ns1if", "tenant_ns_ip": "10.1.11.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s1if", "tenant_sub_ip": "10.1.11.2/24"}], "vxlan": [{"dev": "t2s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.11.2", "remote_ip": "10.2.11.2", "remote_route": "10.2.11.0/24", "subnet_route": "10.1.11.0/24", "tenant_route_ip": "192.168.2.2", "v_name": "vxlan_t2s1"}]}, {"brif": "t2br1if1", "disk": "10G", "mem": 2, "name": "t2_VM1", "vcpu": 4, "vmif": "t2VM1if1"}], "rc": 0, "start": "2019-11-17 10:51:16.494190", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.12.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.1.12.1', u'bridge_name': u't2br2', u'dns': [{u'dnsif': u't2s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't2s2_dnsbrif'}], u'ns_name': u't2ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.12.2/24', u'tenant_ns_ip': u'10.1.12.1/24', u'tenant_ns_if': u't2ns2if', u'tenant_sub_if': u't2s2if', u'tenant_ns_name': u't2'}], u'bridge_ip': u'2.2.2.1', u'vxlan': [{u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}, {u'mem': 3, u'name': u't2_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't2br2if1', u'vmif': u't2VM3if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t2ns2\" ip link set \"t2br2if1\" up\nip netns exec \"t2ns2\" ip link set dev \"t2br2\" up\n", "delta": "0:00:00.078798", "end": "2019-11-17 10:51:16.867776", "item": [{"bridge_ip": "2.2.2.1", "bridge_name": "t2br2", "default_route_ip": "10.1.12.1", "dns": [{"brif": "t2s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t2s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns2", "route": [{"if": "p1", "ip": "10.1.12.1/24", "ns_if": "t2if", "ns_name": "t2"}], "tenant_ns": [{"tenant_ns_if": "t2ns2if", "tenant_ns_ip": "10.1.12.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s2if", "tenant_sub_ip": "10.1.12.2/24"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, {"brif": "t2br2if1", "disk": "10G", "mem": 3, "name": "t2_VM3", "vcpu": 2, "vmif": "t2VM3if1"}], "rc": 0, "start": "2019-11-17 10:51:16.788978", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Add IP to DNS Interface] ******************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.11.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.1.11.1', u'bridge_name': u't2br1', u'ns_name': u't2ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.11.2/24', u'tenant_ns_ip': u'10.1.11.1/24', u'tenant_ns_if': u't2ns1if', u'tenant_sub_if': u't2s1if', u'tenant_ns_name': u't2'}], u'bridge_ip': u'1.1.1.1', u'vms': [{u'mem': 2, u'name': u't2_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't2br1if1', u'vmif': u't2VM1if1'}], u'vxlan': [{u'local_ip': u'10.1.11.2', u'dsport': 4789, u'dev': u't2s1if', u'tenant_route_ip': u'192.168.2.2', u'remote_route': u'10.2.11.0/24', u'subnet_route': u'10.1.11.0/24', u'v_name': u'vxlan_t2s1', u'id': 42, u'remote_ip': u'10.2.11.2'}]}, {u'dnsif': u't2s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't2s1_dnsbrif'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t2ns1\" ip addr show \"t2s1_dnsif\" | awk 'FNR==3{ print $2 }' | grep -w '^1.1.1.1/24' ; if [ $? -ne 0 ] ; then ip netns exec \"t2ns1\" ip addr add \"1.1.1.1/24\" dev \"t2s1_dnsif\" ; fi\n", "delta": "0:00:00.036800", "end": "2019-11-17 10:51:17.184032", "item": [{"bridge_ip": "1.1.1.1", "bridge_name": "t2br1", "default_route_ip": "10.1.11.1", "ns_name": "t2ns1", "route": [{"if": "p1", "ip": "10.1.11.1/24", "ns_if": "t2if", "ns_name": "t2"}], "tenant_ns": [{"tenant_ns_if": "t2ns1if", "tenant_ns_ip": "10.1.11.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s1if", "tenant_sub_ip": "10.1.11.2/24"}], "vms": [{"brif": "t2br1if1", "disk": "10G", "mem": 2, "name": "t2_VM1", "vcpu": 4, "vmif": "t2VM1if1"}], "vxlan": [{"dev": "t2s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.11.2", "remote_ip": "10.2.11.2", "remote_route": "10.2.11.0/24", "subnet_route": "10.1.11.0/24", "tenant_route_ip": "192.168.2.2", "v_name": "vxlan_t2s1"}]}, {"brif": "t2s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t2s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "rc": 0, "start": "2019-11-17 10:51:17.147232", "stderr": "", "stderr_lines": [], "stdout": "1.1.1.1/24", "stdout_lines": ["1.1.1.1/24"]}
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.12.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.1.12.1', u'bridge_name': u't2br2', u'ns_name': u't2ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.12.2/24', u'tenant_ns_ip': u'10.1.12.1/24', u'tenant_ns_if': u't2ns2if', u'tenant_sub_if': u't2s2if', u'tenant_ns_name': u't2'}], u'bridge_ip': u'2.2.2.1', u'vms': [{u'mem': 3, u'name': u't2_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't2br2if1', u'vmif': u't2VM3if1'}], u'vxlan': [{u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}, {u'dnsif': u't2s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't2s2_dnsbrif'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t2ns2\" ip addr show \"t2s2_dnsif\" | awk 'FNR==3{ print $2 }' | grep -w '^2.2.2.1/24' ; if [ $? -ne 0 ] ; then ip netns exec \"t2ns2\" ip addr add \"2.2.2.1/24\" dev \"t2s2_dnsif\" ; fi\n", "delta": "0:00:00.037197", "end": "2019-11-17 10:51:17.436058", "item": [{"bridge_ip": "2.2.2.1", "bridge_name": "t2br2", "default_route_ip": "10.1.12.1", "ns_name": "t2ns2", "route": [{"if": "p1", "ip": "10.1.12.1/24", "ns_if": "t2if", "ns_name": "t2"}], "tenant_ns": [{"tenant_ns_if": "t2ns2if", "tenant_ns_ip": "10.1.12.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s2if", "tenant_sub_ip": "10.1.12.2/24"}], "vms": [{"brif": "t2br2if1", "disk": "10G", "mem": 3, "name": "t2_VM3", "vcpu": 2, "vmif": "t2VM3if1"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, {"brif": "t2s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t2s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "rc": 0, "start": "2019-11-17 10:51:17.398861", "stderr": "", "stderr_lines": [], "stdout": "2.2.2.1/24", "stdout_lines": ["2.2.2.1/24"]}

TASK [Install DHCP Server] **********************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.11.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.1.11.1', u'bridge_name': u't2br1', u'ns_name': u't2ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.11.2/24', u'tenant_ns_ip': u'10.1.11.1/24', u'tenant_ns_if': u't2ns1if', u'tenant_sub_if': u't2s1if', u'tenant_ns_name': u't2'}], u'bridge_ip': u'1.1.1.1', u'vms': [{u'mem': 2, u'name': u't2_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't2br1if1', u'vmif': u't2VM1if1'}], u'vxlan': [{u'local_ip': u'10.1.11.2', u'dsport': 4789, u'dev': u't2s1if', u'tenant_route_ip': u'192.168.2.2', u'remote_route': u'10.2.11.0/24', u'subnet_route': u'10.1.11.0/24', u'v_name': u'vxlan_t2s1', u'id': 42, u'remote_ip': u'10.2.11.2'}]}, {u'dnsif': u't2s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't2s1_dnsbrif'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t2ns1\" ps aux | grep -w '[d]nsmasq --interface t2s1_dnsif -z --dhcp-range=1.1.1.5,1.1.1.126' ; if [ $? -ne 0 ] ; then ip netns exec \"t2ns1\" dnsmasq --interface \"t2s1_dnsif\" -z --dhcp-range=1.1.1.5,'1.1.1.126' ; fi\n", "delta": "0:00:00.049243", "end": "2019-11-17 10:51:17.751524", "item": [{"bridge_ip": "1.1.1.1", "bridge_name": "t2br1", "default_route_ip": "10.1.11.1", "ns_name": "t2ns1", "route": [{"if": "p1", "ip": "10.1.11.1/24", "ns_if": "t2if", "ns_name": "t2"}], "tenant_ns": [{"tenant_ns_if": "t2ns1if", "tenant_ns_ip": "10.1.11.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s1if", "tenant_sub_ip": "10.1.11.2/24"}], "vms": [{"brif": "t2br1if1", "disk": "10G", "mem": 2, "name": "t2_VM1", "vcpu": 4, "vmif": "t2VM1if1"}], "vxlan": [{"dev": "t2s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.11.2", "remote_ip": "10.2.11.2", "remote_route": "10.2.11.0/24", "subnet_route": "10.1.11.0/24", "tenant_route_ip": "192.168.2.2", "v_name": "vxlan_t2s1"}]}, {"brif": "t2s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t2s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "rc": 0, "start": "2019-11-17 10:51:17.702281", "stderr": "", "stderr_lines": [], "stdout": "nobody    9765  0.0  0.0  51580  2768 ?        S    10:22   0:00 dnsmasq --interface t2s1_dnsif -z --dhcp-range=1.1.1.5,1.1.1.126", "stdout_lines": ["nobody    9765  0.0  0.0  51580  2768 ?        S    10:22   0:00 dnsmasq --interface t2s1_dnsif -z --dhcp-range=1.1.1.5,1.1.1.126"]}
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.12.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.1.12.1', u'bridge_name': u't2br2', u'ns_name': u't2ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.12.2/24', u'tenant_ns_ip': u'10.1.12.1/24', u'tenant_ns_if': u't2ns2if', u'tenant_sub_if': u't2s2if', u'tenant_ns_name': u't2'}], u'bridge_ip': u'2.2.2.1', u'vms': [{u'mem': 3, u'name': u't2_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't2br2if1', u'vmif': u't2VM3if1'}], u'vxlan': [{u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}, {u'dnsif': u't2s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't2s2_dnsbrif'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t2ns2\" ps aux | grep -w '[d]nsmasq --interface t2s2_dnsif -z --dhcp-range=2.2.2.5,2.2.2.254' ; if [ $? -ne 0 ] ; then ip netns exec \"t2ns2\" dnsmasq --interface \"t2s2_dnsif\" -z --dhcp-range=2.2.2.5,'2.2.2.254' ; fi\n", "delta": "0:00:00.054600", "end": "2019-11-17 10:51:17.999581", "item": [{"bridge_ip": "2.2.2.1", "bridge_name": "t2br2", "default_route_ip": "10.1.12.1", "ns_name": "t2ns2", "route": [{"if": "p1", "ip": "10.1.12.1/24", "ns_if": "t2if", "ns_name": "t2"}], "tenant_ns": [{"tenant_ns_if": "t2ns2if", "tenant_ns_ip": "10.1.12.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s2if", "tenant_sub_ip": "10.1.12.2/24"}], "vms": [{"brif": "t2br2if1", "disk": "10G", "mem": 3, "name": "t2_VM3", "vcpu": 2, "vmif": "t2VM3if1"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, {"brif": "t2s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t2s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "rc": 0, "start": "2019-11-17 10:51:17.944981", "stderr": "", "stderr_lines": [], "stdout": "nobody    9803  0.0  0.0  51580  2804 ?        S    10:22   0:00 dnsmasq --interface t2s2_dnsif -z --dhcp-range=2.2.2.5,2.2.2.254", "stdout_lines": ["nobody    9803  0.0  0.0  51580  2804 ?        S    10:22   0:00 dnsmasq --interface t2s2_dnsif -z --dhcp-range=2.2.2.5,2.2.2.254"]}

TASK [Create VXLAN devices] *********************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.11.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.1.11.1', u'bridge_name': u't2br1', u'dns': [{u'dnsif': u't2s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't2s1_dnsbrif'}], u'ns_name': u't2ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.11.2/24', u'tenant_ns_ip': u'10.1.11.1/24', u'tenant_ns_if': u't2ns1if', u'tenant_sub_if': u't2s1if', u'tenant_ns_name': u't2'}], u'bridge_ip': u'1.1.1.1', u'vms': [{u'mem': 2, u'name': u't2_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't2br1if1', u'vmif': u't2VM1if1'}]}, {u'local_ip': u'10.1.11.2', u'dsport': 4789, u'dev': u't2s1if', u'tenant_route_ip': u'192.168.2.2', u'remote_route': u'10.2.11.0/24', u'subnet_route': u'10.1.11.0/24', u'v_name': u'vxlan_t2s1', u'id': 42, u'remote_ip': u'10.2.11.2'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t2ns1\" ip link show \"vxlan_t2s1\" ; if [ $? -ne 0 ] ; then ip netns exec \"t2ns1\" ip link add \"vxlan_t2s1\" type vxlan id \"42\" local \"10.1.11.2\" remote \"10.2.11.2\" dstport \"4789\" dev \"t2s1if\"; ip netns exec \"t2ns1\" ip link set dev \"vxlan_t2s1\" up ; fi\n", "delta": "0:00:00.052727", "end": "2019-11-17 10:51:18.311492", "item": [{"bridge_ip": "1.1.1.1", "bridge_name": "t2br1", "default_route_ip": "10.1.11.1", "dns": [{"brif": "t2s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t2s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns1", "route": [{"if": "p1", "ip": "10.1.11.1/24", "ns_if": "t2if", "ns_name": "t2"}], "tenant_ns": [{"tenant_ns_if": "t2ns1if", "tenant_ns_ip": "10.1.11.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s1if", "tenant_sub_ip": "10.1.11.2/24"}], "vms": [{"brif": "t2br1if1", "disk": "10G", "mem": 2, "name": "t2_VM1", "vcpu": 4, "vmif": "t2VM1if1"}]}, {"dev": "t2s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.11.2", "remote_ip": "10.2.11.2", "remote_route": "10.2.11.0/24", "subnet_route": "10.1.11.0/24", "tenant_route_ip": "192.168.2.2", "v_name": "vxlan_t2s1"}], "rc": 0, "start": "2019-11-17 10:51:18.258765", "stderr": "", "stderr_lines": [], "stdout": "5: vxlan_t2s1: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1450 qdisc noqueue master t2br1 state UNKNOWN mode DEFAULT group default qlen 1000\n    link/ether 5e:ec:89:30:d6:96 brd ff:ff:ff:ff:ff:ff", "stdout_lines": ["5: vxlan_t2s1: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1450 qdisc noqueue master t2br1 state UNKNOWN mode DEFAULT group default qlen 1000", "    link/ether 5e:ec:89:30:d6:96 brd ff:ff:ff:ff:ff:ff"]}
skipping: [localhost] => (item=[{u'route': [{u'ip': u'10.1.12.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.1.12.1', u'bridge_name': u't2br2', u'dns': [{u'dnsif': u't2s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't2s2_dnsbrif'}], u'ns_name': u't2ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.12.2/24', u'tenant_ns_ip': u'10.1.12.1/24', u'tenant_ns_if': u't2ns2if', u'tenant_sub_if': u't2s2if', u'tenant_ns_name': u't2'}], u'bridge_ip': u'2.2.2.1', u'vms': [{u'mem': 3, u'name': u't2_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't2br2if1', u'vmif': u't2VM3if1'}]}, {u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}])  => {"ansible_loop_var": "item", "changed": false, "item": [{"bridge_ip": "2.2.2.1", "bridge_name": "t2br2", "default_route_ip": "10.1.12.1", "dns": [{"brif": "t2s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t2s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns2", "route": [{"if": "p1", "ip": "10.1.12.1/24", "ns_if": "t2if", "ns_name": "t2"}], "tenant_ns": [{"tenant_ns_if": "t2ns2if", "tenant_ns_ip": "10.1.12.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s2if", "tenant_sub_ip": "10.1.12.2/24"}], "vms": [{"brif": "t2br2if1", "disk": "10G", "mem": 3, "name": "t2_VM3", "vcpu": 2, "vmif": "t2VM3if1"}]}, {"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}], "skip_reason": "Conditional result was False"}

TASK [Attach VXLANs to bridge] ******************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.11.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.1.11.1', u'bridge_name': u't2br1', u'dns': [{u'dnsif': u't2s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't2s1_dnsbrif'}], u'ns_name': u't2ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.11.2/24', u'tenant_ns_ip': u'10.1.11.1/24', u'tenant_ns_if': u't2ns1if', u'tenant_sub_if': u't2s1if', u'tenant_ns_name': u't2'}], u'bridge_ip': u'1.1.1.1', u'vms': [{u'mem': 2, u'name': u't2_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't2br1if1', u'vmif': u't2VM1if1'}]}, {u'local_ip': u'10.1.11.2', u'dsport': 4789, u'dev': u't2s1if', u'tenant_route_ip': u'192.168.2.2', u'remote_route': u'10.2.11.0/24', u'subnet_route': u'10.1.11.0/24', u'v_name': u'vxlan_t2s1', u'id': 42, u'remote_ip': u'10.2.11.2'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t2ns1\" brctl show \"t2br1\" | grep -w 'vxlan_t2s1' ; if [ $? -ne 0 ] ; then ip netns exec \"t2ns1\" brctl addif \"t2br1\" \"vxlan_t2s1\" ; fi\n", "delta": "0:00:00.045717", "end": "2019-11-17 10:51:18.651791", "item": [{"bridge_ip": "1.1.1.1", "bridge_name": "t2br1", "default_route_ip": "10.1.11.1", "dns": [{"brif": "t2s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t2s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns1", "route": [{"if": "p1", "ip": "10.1.11.1/24", "ns_if": "t2if", "ns_name": "t2"}], "tenant_ns": [{"tenant_ns_if": "t2ns1if", "tenant_ns_ip": "10.1.11.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s1if", "tenant_sub_ip": "10.1.11.2/24"}], "vms": [{"brif": "t2br1if1", "disk": "10G", "mem": 2, "name": "t2_VM1", "vcpu": 4, "vmif": "t2VM1if1"}]}, {"dev": "t2s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.11.2", "remote_ip": "10.2.11.2", "remote_route": "10.2.11.0/24", "subnet_route": "10.1.11.0/24", "tenant_route_ip": "192.168.2.2", "v_name": "vxlan_t2s1"}], "rc": 0, "start": "2019-11-17 10:51:18.606074", "stderr": "", "stderr_lines": [], "stdout": "\t\t\t\t\t\t\tvxlan_t2s1", "stdout_lines": ["\t\t\t\t\t\t\tvxlan_t2s1"]}
skipping: [localhost] => (item=[{u'route': [{u'ip': u'10.1.12.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.1.12.1', u'bridge_name': u't2br2', u'dns': [{u'dnsif': u't2s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't2s2_dnsbrif'}], u'ns_name': u't2ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.12.2/24', u'tenant_ns_ip': u'10.1.12.1/24', u'tenant_ns_if': u't2ns2if', u'tenant_sub_if': u't2s2if', u'tenant_ns_name': u't2'}], u'bridge_ip': u'2.2.2.1', u'vms': [{u'mem': 3, u'name': u't2_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't2br2if1', u'vmif': u't2VM3if1'}]}, {u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}])  => {"ansible_loop_var": "item", "changed": false, "item": [{"bridge_ip": "2.2.2.1", "bridge_name": "t2br2", "default_route_ip": "10.1.12.1", "dns": [{"brif": "t2s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t2s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns2", "route": [{"if": "p1", "ip": "10.1.12.1/24", "ns_if": "t2if", "ns_name": "t2"}], "tenant_ns": [{"tenant_ns_if": "t2ns2if", "tenant_ns_ip": "10.1.12.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s2if", "tenant_sub_ip": "10.1.12.2/24"}], "vms": [{"brif": "t2br2if1", "disk": "10G", "mem": 3, "name": "t2_VM3", "vcpu": 2, "vmif": "t2VM3if1"}]}, {"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}], "skip_reason": "Conditional result was False"}

PLAY RECAP **************************************************************************************************************************************************
localhost                  : ok=21   changed=19   unreachable=0    failed=0    skipped=0    rescued=0    ignored=0   

Using /etc/ansible/ansible.cfg as config file

PLAY [worker] ***********************************************************************************************************************************************

TASK [Create Tenant Namespace] ******************************************************************************************************************************
ok: [99.99.99.2] => (item={u'default_route_ip': u'192.168.130.1', u'name': u't2', u'pns_ip': u'192.168.130.1/24', u'tenant_if': u't2if', u'tenant_ip': u'192.168.130.2/24', u'pns_if': u't2pns_if'}) => {"ansible_loop_var": "item", "changed": false, "cmd": ["ip", "netns", "add", "t2"], "item": {"default_route_ip": "192.168.130.1", "name": "t2", "pns_if": "t2pns_if", "pns_ip": "192.168.130.1/24", "tenant_if": "t2if", "tenant_ip": "192.168.130.2/24"}, "rc": 0, "stdout": "skipped, since /var/run/netns/t2 exists", "stdout_lines": ["skipped, since /var/run/netns/t2 exists"]}

TASK [Create Subnet Namespace] ******************************************************************************************************************************
ok: [99.99.99.2] => (item={u'route': [{u'ip': u'10.2.11.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.2.11.1', u'bridge_name': u't2br1', u'dns': [{u'dnsif': u't2s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't2s1_dnsbrif'}], u'ns_name': u't2ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.11.2/24', u'tenant_ns_ip': u'10.2.11.1/24', u'tenant_ns_if': u't2ns1if', u'tenant_ns_name': u't2', u'tenant_sub_if': u't2s1if'}], u'bridge_ip': u'1.1.1.1', u'vms': [{u'mem': 2, u'name': u't2_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't2br1if1', u'vmif': u't2VM4if1'}], u'vxlan': [{u'local_ip': u'10.2.11.2', u'tenant_route_ip': u'192.168.130.2', u'dsport': 4789, u'dev': u't2s1if', u'subnet_route': u'10.2.11.0/24', u'remote_route': u'10.1.11.0/24', u'v_name': u'vxlan_t2s1', u'id': 42, u'remote_ip': u'10.1.11.2'}]}) => {"ansible_loop_var": "item", "changed": false, "cmd": ["ip", "netns", "add", "t2ns1"], "item": {"bridge_ip": "1.1.1.1", "bridge_name": "t2br1", "default_route_ip": "10.2.11.1", "dns": [{"brif": "t2s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t2s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns1", "route": [{"if": "p1", "ip": "10.2.11.1/24", "ns_if": "t2if", "ns_name": "t2"}], "tenant_ns": [{"tenant_ns_if": "t2ns1if", "tenant_ns_ip": "10.2.11.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s1if", "tenant_sub_ip": "10.2.11.2/24"}], "vms": [{"brif": "t2br1if1", "disk": "10G", "mem": 2, "name": "t2_VM4", "vcpu": 4, "vmif": "t2VM4if1"}], "vxlan": [{"dev": "t2s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.11.2", "remote_ip": "10.1.11.2", "remote_route": "10.1.11.0/24", "subnet_route": "10.2.11.0/24", "tenant_route_ip": "192.168.130.2", "v_name": "vxlan_t2s1"}]}, "rc": 0, "stdout": "skipped, since /var/run/netns/t2ns1 exists", "stdout_lines": ["skipped, since /var/run/netns/t2ns1 exists"]}

TASK [Create Tenant VETH pairs] *****************************************************************************************************************************
changed: [99.99.99.2] => (item={u'default_route_ip': u'192.168.130.1', u'name': u't2', u'pns_ip': u'192.168.130.1/24', u'tenant_if': u't2if', u'tenant_ip': u'192.168.130.2/24', u'pns_if': u't2pns_if'}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip link show \"t2if\" ; if [ $? -ne 0 ] ; then ip link add \"t2if\" type veth peer name \"t2pns_if\" ; fi\n", "delta": "0:00:00.004579", "end": "2019-11-17 10:51:21.385377", "item": {"default_route_ip": "192.168.130.1", "name": "t2", "pns_if": "t2pns_if", "pns_ip": "192.168.130.1/24", "tenant_if": "t2if", "tenant_ip": "192.168.130.2/24"}, "rc": 0, "start": "2019-11-17 10:51:21.380798", "stderr": "", "stderr_lines": [], "stdout": "35: t2if@t2pns_if: <BROADCAST,MULTICAST> mtu 1500 qdisc noop state DOWN mode DEFAULT group default qlen 1000\n    link/ether 3e:aa:60:16:d0:d2 brd ff:ff:ff:ff:ff:ff", "stdout_lines": ["35: t2if@t2pns_if: <BROADCAST,MULTICAST> mtu 1500 qdisc noop state DOWN mode DEFAULT group default qlen 1000", "    link/ether 3e:aa:60:16:d0:d2 brd ff:ff:ff:ff:ff:ff"]}

TASK [Attach Tenant VETH Pairs] *****************************************************************************************************************************
changed: [99.99.99.2] => (item={u'default_route_ip': u'192.168.130.1', u'name': u't2', u'pns_ip': u'192.168.130.1/24', u'tenant_if': u't2if', u'tenant_ip': u'192.168.130.2/24', u'pns_if': u't2pns_if'}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec pns ip link show \"t2pns_if\" ; if [ $? -ne 0 ] ; then ip link set \"t2pns_if\" netns pns ; fi\nip netns exec \"t2\" ip link show \"t2if\" ; if [ $? -ne 0 ] ; then ip link set \"t2if\" netns \"t2\" ; fi\nip netns exec pns ip link set dev \"t2pns_if\" up\nip netns exec \"t2\" ip link set dev \"t2if\" up\n", "delta": "0:00:00.132513", "end": "2019-11-17 10:51:21.900589", "item": {"default_route_ip": "192.168.130.1", "name": "t2", "pns_if": "t2pns_if", "pns_ip": "192.168.130.1/24", "tenant_if": "t2if", "tenant_ip": "192.168.130.2/24"}, "rc": 0, "start": "2019-11-17 10:51:21.768076", "stderr": "", "stderr_lines": [], "stdout": "28: t2pns_if@if29: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP mode DEFAULT group default qlen 1000\n    link/ether 46:fe:05:eb:ba:00 brd ff:ff:ff:ff:ff:ff link-netnsid 2\n29: t2if@if28: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP mode DEFAULT group default qlen 1000\n    link/ether 56:83:77:92:79:c4 brd ff:ff:ff:ff:ff:ff link-netnsid 0", "stdout_lines": ["28: t2pns_if@if29: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP mode DEFAULT group default qlen 1000", "    link/ether 46:fe:05:eb:ba:00 brd ff:ff:ff:ff:ff:ff link-netnsid 2", "29: t2if@if28: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP mode DEFAULT group default qlen 1000", "    link/ether 56:83:77:92:79:c4 brd ff:ff:ff:ff:ff:ff link-netnsid 0"]}

TASK [Add IP addresses to Tenant VETH Pairs] ****************************************************************************************************************
changed: [99.99.99.2] => (item={u'default_route_ip': u'192.168.130.1', u'name': u't2', u'pns_ip': u'192.168.130.1/24', u'tenant_if': u't2if', u'tenant_ip': u'192.168.130.2/24', u'pns_if': u't2pns_if'}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec pns ip addr show \"t2pns_if\" | awk 'FNR==3{ print $2 }' | grep -w '^192.168.130.1/24' ; if [ $? -ne 0 ] ; then ip netns exec pns ip addr add \"192.168.130.1/24\" dev \"t2pns_if\" ; fi\nip netns exec \"t2\" ip addr show \"t2if\" | awk 'FNR==3{ print $2 }' | grep -w '^192.168.130.2/24' ; if [ $? -ne 0 ] ; then ip netns exec \"t2\" ip addr add \"192.168.130.2/24\" dev \"t2if\" ; fi\n", "delta": "0:00:00.079757", "end": "2019-11-17 10:51:22.372848", "item": {"default_route_ip": "192.168.130.1", "name": "t2", "pns_if": "t2pns_if", "pns_ip": "192.168.130.1/24", "tenant_if": "t2if", "tenant_ip": "192.168.130.2/24"}, "rc": 0, "start": "2019-11-17 10:51:22.293091", "stderr": "", "stderr_lines": [], "stdout": "192.168.130.1/24\n192.168.130.2/24", "stdout_lines": ["192.168.130.1/24", "192.168.130.2/24"]}

TASK [Create Namespace VETH Pairs] **************************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.11.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.2.11.1', u'bridge_name': u't2br1', u'dns': [{u'dnsif': u't2s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't2s1_dnsbrif'}], u'ns_name': u't2ns1', u'bridge_ip': u'1.1.1.1', u'vms': [{u'mem': 2, u'name': u't2_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't2br1if1', u'vmif': u't2VM4if1'}], u'vxlan': [{u'local_ip': u'10.2.11.2', u'dsport': 4789, u'dev': u't2s1if', u'tenant_route_ip': u'192.168.130.2', u'remote_route': u'10.1.11.0/24', u'subnet_route': u'10.2.11.0/24', u'v_name': u'vxlan_t2s1', u'id': 42, u'remote_ip': u'10.1.11.2'}]}, {u'tenant_sub_ip': u'10.2.11.2/24', u'tenant_ns_ip': u'10.2.11.1/24', u'tenant_ns_if': u't2ns1if', u'tenant_sub_if': u't2s1if', u'tenant_ns_name': u't2'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip link show \"t2ns1if\" ; if [ $? -ne 0 ] ; then ip link add \"t2ns1if\" type veth peer name \"t2s1if\" ; fi\n", "delta": "0:00:00.004412", "end": "2019-11-17 10:51:22.771046", "item": [{"bridge_ip": "1.1.1.1", "bridge_name": "t2br1", "default_route_ip": "10.2.11.1", "dns": [{"brif": "t2s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t2s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns1", "route": [{"if": "p1", "ip": "10.2.11.1/24", "ns_if": "t2if", "ns_name": "t2"}], "vms": [{"brif": "t2br1if1", "disk": "10G", "mem": 2, "name": "t2_VM4", "vcpu": 4, "vmif": "t2VM4if1"}], "vxlan": [{"dev": "t2s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.11.2", "remote_ip": "10.1.11.2", "remote_route": "10.1.11.0/24", "subnet_route": "10.2.11.0/24", "tenant_route_ip": "192.168.130.2", "v_name": "vxlan_t2s1"}]}, {"tenant_ns_if": "t2ns1if", "tenant_ns_ip": "10.2.11.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s1if", "tenant_sub_ip": "10.2.11.2/24"}], "rc": 0, "start": "2019-11-17 10:51:22.766634", "stderr": "", "stderr_lines": [], "stdout": "37: t2ns1if@t2s1if: <BROADCAST,MULTICAST> mtu 1500 qdisc noop state DOWN mode DEFAULT group default qlen 1000\n    link/ether e2:3d:23:10:84:69 brd ff:ff:ff:ff:ff:ff", "stdout_lines": ["37: t2ns1if@t2s1if: <BROADCAST,MULTICAST> mtu 1500 qdisc noop state DOWN mode DEFAULT group default qlen 1000", "    link/ether e2:3d:23:10:84:69 brd ff:ff:ff:ff:ff:ff"]}

TASK [Attach Namespace VETH Pairs] **************************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.11.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.2.11.1', u'bridge_name': u't2br1', u'dns': [{u'dnsif': u't2s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't2s1_dnsbrif'}], u'ns_name': u't2ns1', u'bridge_ip': u'1.1.1.1', u'vms': [{u'mem': 2, u'name': u't2_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't2br1if1', u'vmif': u't2VM4if1'}], u'vxlan': [{u'local_ip': u'10.2.11.2', u'dsport': 4789, u'dev': u't2s1if', u'tenant_route_ip': u'192.168.130.2', u'remote_route': u'10.1.11.0/24', u'subnet_route': u'10.2.11.0/24', u'v_name': u'vxlan_t2s1', u'id': 42, u'remote_ip': u'10.1.11.2'}]}, {u'tenant_sub_ip': u'10.2.11.2/24', u'tenant_ns_ip': u'10.2.11.1/24', u'tenant_ns_if': u't2ns1if', u'tenant_sub_if': u't2s1if', u'tenant_ns_name': u't2'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t2\" ip link show \"t2ns1if\" ; if [ $? -ne 0 ] ; then ip link set \"t2ns1if\" netns \"t2\" ; fi\nip netns exec \"t2ns1\" ip link show \"t2s1if\" ; if [ $? -ne 0 ] ; then ip link set \"t2s1if\" netns \"t2ns1\" ; fi\n", "delta": "0:00:00.073669", "end": "2019-11-17 10:51:23.232362", "item": [{"bridge_ip": "1.1.1.1", "bridge_name": "t2br1", "default_route_ip": "10.2.11.1", "dns": [{"brif": "t2s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t2s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns1", "route": [{"if": "p1", "ip": "10.2.11.1/24", "ns_if": "t2if", "ns_name": "t2"}], "vms": [{"brif": "t2br1if1", "disk": "10G", "mem": 2, "name": "t2_VM4", "vcpu": 4, "vmif": "t2VM4if1"}], "vxlan": [{"dev": "t2s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.11.2", "remote_ip": "10.1.11.2", "remote_route": "10.1.11.0/24", "subnet_route": "10.2.11.0/24", "tenant_route_ip": "192.168.130.2", "v_name": "vxlan_t2s1"}]}, {"tenant_ns_if": "t2ns1if", "tenant_ns_ip": "10.2.11.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s1if", "tenant_sub_ip": "10.2.11.2/24"}], "rc": 0, "start": "2019-11-17 10:51:23.158693", "stderr": "", "stderr_lines": [], "stdout": "31: t2ns1if@if30: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP mode DEFAULT group default qlen 1000\n    link/ether 0a:81:60:0f:ab:29 brd ff:ff:ff:ff:ff:ff link-netnsid 2\n30: t2s1if@if31: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP mode DEFAULT group default qlen 1000\n    link/ether 12:f8:44:97:20:88 brd ff:ff:ff:ff:ff:ff link-netnsid 0", "stdout_lines": ["31: t2ns1if@if30: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP mode DEFAULT group default qlen 1000", "    link/ether 0a:81:60:0f:ab:29 brd ff:ff:ff:ff:ff:ff link-netnsid 2", "30: t2s1if@if31: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP mode DEFAULT group default qlen 1000", "    link/ether 12:f8:44:97:20:88 brd ff:ff:ff:ff:ff:ff link-netnsid 0"]}

TASK [Set Namespace VETH Pairs UP] **************************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.11.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.2.11.1', u'bridge_name': u't2br1', u'dns': [{u'dnsif': u't2s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't2s1_dnsbrif'}], u'ns_name': u't2ns1', u'bridge_ip': u'1.1.1.1', u'vms': [{u'mem': 2, u'name': u't2_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't2br1if1', u'vmif': u't2VM4if1'}], u'vxlan': [{u'local_ip': u'10.2.11.2', u'dsport': 4789, u'dev': u't2s1if', u'tenant_route_ip': u'192.168.130.2', u'remote_route': u'10.1.11.0/24', u'subnet_route': u'10.2.11.0/24', u'v_name': u'vxlan_t2s1', u'id': 42, u'remote_ip': u'10.1.11.2'}]}, {u'tenant_sub_ip': u'10.2.11.2/24', u'tenant_ns_ip': u'10.2.11.1/24', u'tenant_ns_if': u't2ns1if', u'tenant_sub_if': u't2s1if', u'tenant_ns_name': u't2'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t2\" ip link set dev \"t2ns1if\" up\nip netns exec \"t2ns1\" ip link set dev \"t2s1if\" up\n", "delta": "0:00:00.082141", "end": "2019-11-17 10:51:23.704437", "item": [{"bridge_ip": "1.1.1.1", "bridge_name": "t2br1", "default_route_ip": "10.2.11.1", "dns": [{"brif": "t2s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t2s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns1", "route": [{"if": "p1", "ip": "10.2.11.1/24", "ns_if": "t2if", "ns_name": "t2"}], "vms": [{"brif": "t2br1if1", "disk": "10G", "mem": 2, "name": "t2_VM4", "vcpu": 4, "vmif": "t2VM4if1"}], "vxlan": [{"dev": "t2s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.11.2", "remote_ip": "10.1.11.2", "remote_route": "10.1.11.0/24", "subnet_route": "10.2.11.0/24", "tenant_route_ip": "192.168.130.2", "v_name": "vxlan_t2s1"}]}, {"tenant_ns_if": "t2ns1if", "tenant_ns_ip": "10.2.11.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s1if", "tenant_sub_ip": "10.2.11.2/24"}], "rc": 0, "start": "2019-11-17 10:51:23.622296", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Add IP addresses to Namespace VETH Pairs] *************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.11.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.2.11.1', u'bridge_name': u't2br1', u'dns': [{u'dnsif': u't2s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't2s1_dnsbrif'}], u'ns_name': u't2ns1', u'bridge_ip': u'1.1.1.1', u'vms': [{u'mem': 2, u'name': u't2_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't2br1if1', u'vmif': u't2VM4if1'}], u'vxlan': [{u'local_ip': u'10.2.11.2', u'dsport': 4789, u'dev': u't2s1if', u'tenant_route_ip': u'192.168.130.2', u'remote_route': u'10.1.11.0/24', u'subnet_route': u'10.2.11.0/24', u'v_name': u'vxlan_t2s1', u'id': 42, u'remote_ip': u'10.1.11.2'}]}, {u'tenant_sub_ip': u'10.2.11.2/24', u'tenant_ns_ip': u'10.2.11.1/24', u'tenant_ns_if': u't2ns1if', u'tenant_sub_if': u't2s1if', u'tenant_ns_name': u't2'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t2ns1\" ip addr show \"t2s1if\" | awk 'FNR==3{ print $2 }' | grep -w '^10.2.11.2/24' ; if [ $? -ne 0 ] ; then ip netns exec \"t2ns1\" ip addr add \"10.2.11.2/24\" dev \"t2s1if\" ; fi\n\nip netns exec \"t2\" ip addr show \"t2ns1if\" | awk 'FNR==3{ print $2 }' | grep -w '^10.2.11.1/24' ; if [ $? -ne 0 ] ; then ip netns exec \"t2\" ip addr add \"10.2.11.1/24\" dev \"t2ns1if\" ; fi\n", "delta": "0:00:00.073856", "end": "2019-11-17 10:51:24.152599", "item": [{"bridge_ip": "1.1.1.1", "bridge_name": "t2br1", "default_route_ip": "10.2.11.1", "dns": [{"brif": "t2s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t2s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns1", "route": [{"if": "p1", "ip": "10.2.11.1/24", "ns_if": "t2if", "ns_name": "t2"}], "vms": [{"brif": "t2br1if1", "disk": "10G", "mem": 2, "name": "t2_VM4", "vcpu": 4, "vmif": "t2VM4if1"}], "vxlan": [{"dev": "t2s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.11.2", "remote_ip": "10.1.11.2", "remote_route": "10.1.11.0/24", "subnet_route": "10.2.11.0/24", "tenant_route_ip": "192.168.130.2", "v_name": "vxlan_t2s1"}]}, {"tenant_ns_if": "t2ns1if", "tenant_ns_ip": "10.2.11.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s1if", "tenant_sub_ip": "10.2.11.2/24"}], "rc": 0, "start": "2019-11-17 10:51:24.078743", "stderr": "", "stderr_lines": [], "stdout": "10.2.11.2/24\n10.2.11.1/24", "stdout_lines": ["10.2.11.2/24", "10.2.11.1/24"]}

TASK [Add IP Route to Tenant] *******************************************************************************************************************************
changed: [99.99.99.2] => (item={u'default_route_ip': u'192.168.130.1', u'name': u't2', u'pns_ip': u'192.168.130.1/24', u'tenant_if': u't2if', u'tenant_ip': u'192.168.130.2/24', u'pns_if': u't2pns_if'}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t2\" ip route show default | grep -w '[d]efault via 192.168.130.1' ; if [ $? -ne 0 ] ; then ip netns exec \"t2\" ip route add default via \"192.168.130.1\" ; fi\n", "delta": "0:00:00.035556", "end": "2019-11-17 10:51:24.576701", "item": {"default_route_ip": "192.168.130.1", "name": "t2", "pns_if": "t2pns_if", "pns_ip": "192.168.130.1/24", "tenant_if": "t2if", "tenant_ip": "192.168.130.2/24"}, "rc": 0, "start": "2019-11-17 10:51:24.541145", "stderr": "", "stderr_lines": [], "stdout": "default via 192.168.130.1 dev t2if ", "stdout_lines": ["default via 192.168.130.1 dev t2if "]}

TASK [Add IP Route to Tenant Subnet] ************************************************************************************************************************
changed: [99.99.99.2] => (item={u'route': [{u'ip': u'10.2.11.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.2.11.1', u'bridge_name': u't2br1', u'dns': [{u'dnsif': u't2s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't2s1_dnsbrif'}], u'ns_name': u't2ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.11.2/24', u'tenant_ns_ip': u'10.2.11.1/24', u'tenant_ns_if': u't2ns1if', u'tenant_ns_name': u't2', u'tenant_sub_if': u't2s1if'}], u'bridge_ip': u'1.1.1.1', u'vms': [{u'mem': 2, u'name': u't2_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't2br1if1', u'vmif': u't2VM4if1'}], u'vxlan': [{u'local_ip': u'10.2.11.2', u'tenant_route_ip': u'192.168.130.2', u'dsport': 4789, u'dev': u't2s1if', u'subnet_route': u'10.2.11.0/24', u'remote_route': u'10.1.11.0/24', u'v_name': u'vxlan_t2s1', u'id': 42, u'remote_ip': u'10.1.11.2'}]}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t2ns1\" ip route show default | grep -w '[d]efault via 10.2.11.1' ; if [ $? -ne 0 ] ; then ip netns exec \"t2ns1\" ip route add default via \"10.2.11.1\" ; fi\n", "delta": "0:00:00.036166", "end": "2019-11-17 10:51:25.000586", "item": {"bridge_ip": "1.1.1.1", "bridge_name": "t2br1", "default_route_ip": "10.2.11.1", "dns": [{"brif": "t2s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t2s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns1", "route": [{"if": "p1", "ip": "10.2.11.1/24", "ns_if": "t2if", "ns_name": "t2"}], "tenant_ns": [{"tenant_ns_if": "t2ns1if", "tenant_ns_ip": "10.2.11.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s1if", "tenant_sub_ip": "10.2.11.2/24"}], "vms": [{"brif": "t2br1if1", "disk": "10G", "mem": 2, "name": "t2_VM4", "vcpu": 4, "vmif": "t2VM4if1"}], "vxlan": [{"dev": "t2s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.11.2", "remote_ip": "10.1.11.2", "remote_route": "10.1.11.0/24", "subnet_route": "10.2.11.0/24", "tenant_route_ip": "192.168.130.2", "v_name": "vxlan_t2s1"}]}, "rc": 0, "start": "2019-11-17 10:51:24.964420", "stderr": "", "stderr_lines": [], "stdout": "default via 10.2.11.1 dev t2s1if ", "stdout_lines": ["default via 10.2.11.1 dev t2s1if "]}

TASK [Create bridge inside namespace] ***********************************************************************************************************************
changed: [99.99.99.2] => (item={u'route': [{u'ip': u'10.2.11.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.2.11.1', u'bridge_name': u't2br1', u'dns': [{u'dnsif': u't2s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't2s1_dnsbrif'}], u'ns_name': u't2ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.11.2/24', u'tenant_ns_ip': u'10.2.11.1/24', u'tenant_ns_if': u't2ns1if', u'tenant_ns_name': u't2', u'tenant_sub_if': u't2s1if'}], u'bridge_ip': u'1.1.1.1', u'vms': [{u'mem': 2, u'name': u't2_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't2br1if1', u'vmif': u't2VM4if1'}], u'vxlan': [{u'local_ip': u'10.2.11.2', u'tenant_route_ip': u'192.168.130.2', u'dsport': 4789, u'dev': u't2s1if', u'subnet_route': u'10.2.11.0/24', u'remote_route': u'10.1.11.0/24', u'v_name': u'vxlan_t2s1', u'id': 42, u'remote_ip': u'10.1.11.2'}]}) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t2ns1\" brctl show | grep -w '^t2br1'; if [ $? -ne 0 ] ; then ip netns exec \"t2ns1\" brctl addbr \"t2br1\" ; fi\nip netns exec \"t2ns1\" ip link set dev \"t2br1\" up\n", "delta": "0:00:00.069720", "end": "2019-11-17 10:51:25.508486", "item": {"bridge_ip": "1.1.1.1", "bridge_name": "t2br1", "default_route_ip": "10.2.11.1", "dns": [{"brif": "t2s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t2s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns1", "route": [{"if": "p1", "ip": "10.2.11.1/24", "ns_if": "t2if", "ns_name": "t2"}], "tenant_ns": [{"tenant_ns_if": "t2ns1if", "tenant_ns_ip": "10.2.11.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s1if", "tenant_sub_ip": "10.2.11.2/24"}], "vms": [{"brif": "t2br1if1", "disk": "10G", "mem": 2, "name": "t2_VM4", "vcpu": 4, "vmif": "t2VM4if1"}], "vxlan": [{"dev": "t2s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.11.2", "remote_ip": "10.1.11.2", "remote_route": "10.1.11.0/24", "subnet_route": "10.2.11.0/24", "tenant_route_ip": "192.168.130.2", "v_name": "vxlan_t2s1"}]}, "rc": 0, "start": "2019-11-17 10:51:25.438766", "stderr": "", "stderr_lines": [], "stdout": "t2br1\t\t8000.76fc12e1f29f\tno\t\tt2br1if1", "stdout_lines": ["t2br1\t\t8000.76fc12e1f29f\tno\t\tt2br1if1"]}

TASK [Create DNS VETH Pair] *********************************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.11.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.2.11.1', u'bridge_name': u't2br1', u'ns_name': u't2ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.11.2/24', u'tenant_ns_ip': u'10.2.11.1/24', u'tenant_ns_if': u't2ns1if', u'tenant_sub_if': u't2s1if', u'tenant_ns_name': u't2'}], u'bridge_ip': u'1.1.1.1', u'vms': [{u'mem': 2, u'name': u't2_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't2br1if1', u'vmif': u't2VM4if1'}], u'vxlan': [{u'local_ip': u'10.2.11.2', u'dsport': 4789, u'dev': u't2s1if', u'tenant_route_ip': u'192.168.130.2', u'remote_route': u'10.1.11.0/24', u'subnet_route': u'10.2.11.0/24', u'v_name': u'vxlan_t2s1', u'id': 42, u'remote_ip': u'10.1.11.2'}]}, {u'dnsif': u't2s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't2s1_dnsbrif'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t2ns1\" ip link show \"t2s1_dnsbrif\" ; if [ $? -ne 0 ] ; then ip netns exec \"t2ns1\" ip link add \"t2s1_dnsbrif\" type veth peer name \"t2s1_dnsif\" ; fi\nip netns exec \"t2ns1\" ip link set dev \"t2s1_dnsbrif\" up\nip netns exec \"t2ns1\" ip link set dev \"t2s1_dnsif\" up\n", "delta": "0:00:00.112893", "end": "2019-11-17 10:51:26.024414", "item": [{"bridge_ip": "1.1.1.1", "bridge_name": "t2br1", "default_route_ip": "10.2.11.1", "ns_name": "t2ns1", "route": [{"if": "p1", "ip": "10.2.11.1/24", "ns_if": "t2if", "ns_name": "t2"}], "tenant_ns": [{"tenant_ns_if": "t2ns1if", "tenant_ns_ip": "10.2.11.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s1if", "tenant_sub_ip": "10.2.11.2/24"}], "vms": [{"brif": "t2br1if1", "disk": "10G", "mem": 2, "name": "t2_VM4", "vcpu": 4, "vmif": "t2VM4if1"}], "vxlan": [{"dev": "t2s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.11.2", "remote_ip": "10.1.11.2", "remote_route": "10.1.11.0/24", "subnet_route": "10.2.11.0/24", "tenant_route_ip": "192.168.130.2", "v_name": "vxlan_t2s1"}]}, {"brif": "t2s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t2s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "rc": 0, "start": "2019-11-17 10:51:25.911521", "stderr": "", "stderr_lines": [], "stdout": "4: t2s1_dnsbrif@t2s1_dnsif: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue master t2br1 state UP mode DEFAULT group default qlen 1000\n    link/ether 86:c8:40:fc:37:45 brd ff:ff:ff:ff:ff:ff", "stdout_lines": ["4: t2s1_dnsbrif@t2s1_dnsif: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue master t2br1 state UP mode DEFAULT group default qlen 1000", "    link/ether 86:c8:40:fc:37:45 brd ff:ff:ff:ff:ff:ff"]}

TASK [Attach DNS VETH Pair] *********************************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.11.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.2.11.1', u'bridge_name': u't2br1', u'ns_name': u't2ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.11.2/24', u'tenant_ns_ip': u'10.2.11.1/24', u'tenant_ns_if': u't2ns1if', u'tenant_sub_if': u't2s1if', u'tenant_ns_name': u't2'}], u'bridge_ip': u'1.1.1.1', u'vms': [{u'mem': 2, u'name': u't2_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't2br1if1', u'vmif': u't2VM4if1'}], u'vxlan': [{u'local_ip': u'10.2.11.2', u'dsport': 4789, u'dev': u't2s1if', u'tenant_route_ip': u'192.168.130.2', u'remote_route': u'10.1.11.0/24', u'subnet_route': u'10.2.11.0/24', u'v_name': u'vxlan_t2s1', u'id': 42, u'remote_ip': u'10.1.11.2'}]}, {u'dnsif': u't2s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't2s1_dnsbrif'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t2ns1\" brctl show \"t2br1\" | grep -w 't2s1_dnsbrif' ; if [ $? -ne 0 ] ; then ip netns exec \"t2ns1\" brctl addif \"t2br1\" \"t2s1_dnsbrif\" ; fi\n", "delta": "0:00:00.036461", "end": "2019-11-17 10:51:26.468514", "item": [{"bridge_ip": "1.1.1.1", "bridge_name": "t2br1", "default_route_ip": "10.2.11.1", "ns_name": "t2ns1", "route": [{"if": "p1", "ip": "10.2.11.1/24", "ns_if": "t2if", "ns_name": "t2"}], "tenant_ns": [{"tenant_ns_if": "t2ns1if", "tenant_ns_ip": "10.2.11.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s1if", "tenant_sub_ip": "10.2.11.2/24"}], "vms": [{"brif": "t2br1if1", "disk": "10G", "mem": 2, "name": "t2_VM4", "vcpu": 4, "vmif": "t2VM4if1"}], "vxlan": [{"dev": "t2s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.11.2", "remote_ip": "10.1.11.2", "remote_route": "10.1.11.0/24", "subnet_route": "10.2.11.0/24", "tenant_route_ip": "192.168.130.2", "v_name": "vxlan_t2s1"}]}, {"brif": "t2s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t2s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "rc": 0, "start": "2019-11-17 10:51:26.432053", "stderr": "", "stderr_lines": [], "stdout": "\t\t\t\t\t\t\tt2s1_dnsbrif", "stdout_lines": ["\t\t\t\t\t\t\tt2s1_dnsbrif"]}

TASK [Create VETH Pairs] ************************************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.11.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.2.11.1', u'bridge_name': u't2br1', u'dns': [{u'dnsif': u't2s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't2s1_dnsbrif'}], u'ns_name': u't2ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.11.2/24', u'tenant_ns_ip': u'10.2.11.1/24', u'tenant_ns_if': u't2ns1if', u'tenant_sub_if': u't2s1if', u'tenant_ns_name': u't2'}], u'bridge_ip': u'1.1.1.1', u'vxlan': [{u'local_ip': u'10.2.11.2', u'dsport': 4789, u'dev': u't2s1if', u'tenant_route_ip': u'192.168.130.2', u'remote_route': u'10.1.11.0/24', u'subnet_route': u'10.2.11.0/24', u'v_name': u'vxlan_t2s1', u'id': 42, u'remote_ip': u'10.1.11.2'}]}, {u'mem': 2, u'name': u't2_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't2br1if1', u'vmif': u't2VM4if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip link show \"t2br1if1\" ; if [ $? -ne 0 ] ; then ip link add \"t2VM4if1\" type veth peer name \"t2br1if1\" ; fi\nip link set dev \"t2br1if1\" up\nip link set dev \"t2VM4if1\" up\n", "delta": "0:00:00.013429", "end": "2019-11-17 10:51:26.859219", "item": [{"bridge_ip": "1.1.1.1", "bridge_name": "t2br1", "default_route_ip": "10.2.11.1", "dns": [{"brif": "t2s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t2s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns1", "route": [{"if": "p1", "ip": "10.2.11.1/24", "ns_if": "t2if", "ns_name": "t2"}], "tenant_ns": [{"tenant_ns_if": "t2ns1if", "tenant_ns_ip": "10.2.11.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s1if", "tenant_sub_ip": "10.2.11.2/24"}], "vxlan": [{"dev": "t2s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.11.2", "remote_ip": "10.1.11.2", "remote_route": "10.1.11.0/24", "subnet_route": "10.2.11.0/24", "tenant_route_ip": "192.168.130.2", "v_name": "vxlan_t2s1"}]}, {"brif": "t2br1if1", "disk": "10G", "mem": 2, "name": "t2_VM4", "vcpu": 4, "vmif": "t2VM4if1"}], "rc": 0, "start": "2019-11-17 10:51:26.845790", "stderr": "Device \"t2br1if1\" does not exist.\nRTNETLINK answers: File exists\nCannot find device \"t2br1if1\"", "stderr_lines": ["Device \"t2br1if1\" does not exist.", "RTNETLINK answers: File exists", "Cannot find device \"t2br1if1\""], "stdout": "", "stdout_lines": []}

TASK [Attach VETH Pairs] ************************************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.11.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.2.11.1', u'bridge_name': u't2br1', u'dns': [{u'dnsif': u't2s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't2s1_dnsbrif'}], u'ns_name': u't2ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.11.2/24', u'tenant_ns_ip': u'10.2.11.1/24', u'tenant_ns_if': u't2ns1if', u'tenant_sub_if': u't2s1if', u'tenant_ns_name': u't2'}], u'bridge_ip': u'1.1.1.1', u'vxlan': [{u'local_ip': u'10.2.11.2', u'dsport': 4789, u'dev': u't2s1if', u'tenant_route_ip': u'192.168.130.2', u'remote_route': u'10.1.11.0/24', u'subnet_route': u'10.2.11.0/24', u'v_name': u'vxlan_t2s1', u'id': 42, u'remote_ip': u'10.1.11.2'}]}, {u'mem': 2, u'name': u't2_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't2br1if1', u'vmif': u't2VM4if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip link show \"t2br1if1\" ; if [ $? -eq 0 ] ; then ip link set \"t2br1if1\" netns \"t2ns1\" ; fi\nip netns exec \"t2ns1\" brctl show \"t2br1\" | grep -w 't2br1if1' ; if [ $? -ne 0 ] ; then ip netns exec \"t2ns1\" brctl addif \"t2br1\" \"t2br1if1\" ; fi\n", "delta": "0:00:00.037694", "end": "2019-11-17 10:51:27.260555", "item": [{"bridge_ip": "1.1.1.1", "bridge_name": "t2br1", "default_route_ip": "10.2.11.1", "dns": [{"brif": "t2s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t2s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns1", "route": [{"if": "p1", "ip": "10.2.11.1/24", "ns_if": "t2if", "ns_name": "t2"}], "tenant_ns": [{"tenant_ns_if": "t2ns1if", "tenant_ns_ip": "10.2.11.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s1if", "tenant_sub_ip": "10.2.11.2/24"}], "vxlan": [{"dev": "t2s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.11.2", "remote_ip": "10.1.11.2", "remote_route": "10.1.11.0/24", "subnet_route": "10.2.11.0/24", "tenant_route_ip": "192.168.130.2", "v_name": "vxlan_t2s1"}]}, {"brif": "t2br1if1", "disk": "10G", "mem": 2, "name": "t2_VM4", "vcpu": 4, "vmif": "t2VM4if1"}], "rc": 0, "start": "2019-11-17 10:51:27.222861", "stderr": "Device \"t2br1if1\" does not exist.", "stderr_lines": ["Device \"t2br1if1\" does not exist."], "stdout": "t2br1\t\t8000.76fc12e1f29f\tno\t\tt2br1if1", "stdout_lines": ["t2br1\t\t8000.76fc12e1f29f\tno\t\tt2br1if1"]}

TASK [All interfaces and bridges UP] ************************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.11.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.2.11.1', u'bridge_name': u't2br1', u'dns': [{u'dnsif': u't2s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't2s1_dnsbrif'}], u'ns_name': u't2ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.11.2/24', u'tenant_ns_ip': u'10.2.11.1/24', u'tenant_ns_if': u't2ns1if', u'tenant_sub_if': u't2s1if', u'tenant_ns_name': u't2'}], u'bridge_ip': u'1.1.1.1', u'vxlan': [{u'local_ip': u'10.2.11.2', u'dsport': 4789, u'dev': u't2s1if', u'tenant_route_ip': u'192.168.130.2', u'remote_route': u'10.1.11.0/24', u'subnet_route': u'10.2.11.0/24', u'v_name': u'vxlan_t2s1', u'id': 42, u'remote_ip': u'10.1.11.2'}]}, {u'mem': 2, u'name': u't2_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't2br1if1', u'vmif': u't2VM4if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t2ns1\" ip link set \"t2br1if1\" up\nip netns exec \"t2ns1\" ip link set dev \"t2br1\" up\n", "delta": "0:00:00.073107", "end": "2019-11-17 10:51:27.696456", "item": [{"bridge_ip": "1.1.1.1", "bridge_name": "t2br1", "default_route_ip": "10.2.11.1", "dns": [{"brif": "t2s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t2s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns1", "route": [{"if": "p1", "ip": "10.2.11.1/24", "ns_if": "t2if", "ns_name": "t2"}], "tenant_ns": [{"tenant_ns_if": "t2ns1if", "tenant_ns_ip": "10.2.11.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s1if", "tenant_sub_ip": "10.2.11.2/24"}], "vxlan": [{"dev": "t2s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.11.2", "remote_ip": "10.1.11.2", "remote_route": "10.1.11.0/24", "subnet_route": "10.2.11.0/24", "tenant_route_ip": "192.168.130.2", "v_name": "vxlan_t2s1"}]}, {"brif": "t2br1if1", "disk": "10G", "mem": 2, "name": "t2_VM4", "vcpu": 4, "vmif": "t2VM4if1"}], "rc": 0, "start": "2019-11-17 10:51:27.623349", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Add IP to DNS Interface] ******************************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.11.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.2.11.1', u'bridge_name': u't2br1', u'ns_name': u't2ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.11.2/24', u'tenant_ns_ip': u'10.2.11.1/24', u'tenant_ns_if': u't2ns1if', u'tenant_sub_if': u't2s1if', u'tenant_ns_name': u't2'}], u'bridge_ip': u'1.1.1.1', u'vms': [{u'mem': 2, u'name': u't2_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't2br1if1', u'vmif': u't2VM4if1'}], u'vxlan': [{u'local_ip': u'10.2.11.2', u'dsport': 4789, u'dev': u't2s1if', u'tenant_route_ip': u'192.168.130.2', u'remote_route': u'10.1.11.0/24', u'subnet_route': u'10.2.11.0/24', u'v_name': u'vxlan_t2s1', u'id': 42, u'remote_ip': u'10.1.11.2'}]}, {u'dnsif': u't2s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't2s1_dnsbrif'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t2ns1\" ip addr show \"t2s1_dnsif\" | awk 'FNR==3{ print $2}'| grep -w '^1.1.1.128/24' ; if [ $? -ne 0 ] ; then ip netns exec \"t2ns1\" ip addr add \"1.1.1.128/24\" dev \"t2s1_dnsif\" ; fi\n", "delta": "0:00:00.034960", "end": "2019-11-17 10:51:28.132687", "item": [{"bridge_ip": "1.1.1.1", "bridge_name": "t2br1", "default_route_ip": "10.2.11.1", "ns_name": "t2ns1", "route": [{"if": "p1", "ip": "10.2.11.1/24", "ns_if": "t2if", "ns_name": "t2"}], "tenant_ns": [{"tenant_ns_if": "t2ns1if", "tenant_ns_ip": "10.2.11.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s1if", "tenant_sub_ip": "10.2.11.2/24"}], "vms": [{"brif": "t2br1if1", "disk": "10G", "mem": 2, "name": "t2_VM4", "vcpu": 4, "vmif": "t2VM4if1"}], "vxlan": [{"dev": "t2s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.11.2", "remote_ip": "10.1.11.2", "remote_route": "10.1.11.0/24", "subnet_route": "10.2.11.0/24", "tenant_route_ip": "192.168.130.2", "v_name": "vxlan_t2s1"}]}, {"brif": "t2s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t2s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "rc": 0, "start": "2019-11-17 10:51:28.097727", "stderr": "", "stderr_lines": [], "stdout": "1.1.1.128/24", "stdout_lines": ["1.1.1.128/24"]}

TASK [Install DHCP Server] **********************************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.11.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.2.11.1', u'bridge_name': u't2br1', u'ns_name': u't2ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.11.2/24', u'tenant_ns_ip': u'10.2.11.1/24', u'tenant_ns_if': u't2ns1if', u'tenant_sub_if': u't2s1if', u'tenant_ns_name': u't2'}], u'bridge_ip': u'1.1.1.1', u'vms': [{u'mem': 2, u'name': u't2_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't2br1if1', u'vmif': u't2VM4if1'}], u'vxlan': [{u'local_ip': u'10.2.11.2', u'dsport': 4789, u'dev': u't2s1if', u'tenant_route_ip': u'192.168.130.2', u'remote_route': u'10.1.11.0/24', u'subnet_route': u'10.2.11.0/24', u'v_name': u'vxlan_t2s1', u'id': 42, u'remote_ip': u'10.1.11.2'}]}, {u'dnsif': u't2s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't2s1_dnsbrif'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t2ns1\" ps aux | grep -w '[d]nsmasq --interface t2s1_dnsif -z --dhcp-range=1.1.1.133,1.1.1.254' ; if [ $? -ne 0 ] ; then ip netns exec \"t2ns1\" dnsmasq --interface \"t2s1_dnsif\" -z --dhcp-range=1.1.1.133,'1.1.1.254' ; fi\n", "delta": "0:00:00.067673", "end": "2019-11-17 10:51:28.576589", "item": [{"bridge_ip": "1.1.1.1", "bridge_name": "t2br1", "default_route_ip": "10.2.11.1", "ns_name": "t2ns1", "route": [{"if": "p1", "ip": "10.2.11.1/24", "ns_if": "t2if", "ns_name": "t2"}], "tenant_ns": [{"tenant_ns_if": "t2ns1if", "tenant_ns_ip": "10.2.11.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s1if", "tenant_sub_ip": "10.2.11.2/24"}], "vms": [{"brif": "t2br1if1", "disk": "10G", "mem": 2, "name": "t2_VM4", "vcpu": 4, "vmif": "t2VM4if1"}], "vxlan": [{"dev": "t2s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.11.2", "remote_ip": "10.1.11.2", "remote_route": "10.1.11.0/24", "subnet_route": "10.2.11.0/24", "tenant_route_ip": "192.168.130.2", "v_name": "vxlan_t2s1"}]}, {"brif": "t2s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t2s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "rc": 0, "start": "2019-11-17 10:51:28.508916", "stderr": "", "stderr_lines": [], "stdout": "nobody    6881  0.0  0.0  51580  2644 ?        S    10:22   0:00 dnsmasq --interface t2s1_dnsif -z --dhcp-range=1.1.1.133,1.1.1.254", "stdout_lines": ["nobody    6881  0.0  0.0  51580  2644 ?        S    10:22   0:00 dnsmasq --interface t2s1_dnsif -z --dhcp-range=1.1.1.133,1.1.1.254"]}

TASK [Create VXLAN devices] *********************************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.11.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.2.11.1', u'bridge_name': u't2br1', u'dns': [{u'dnsif': u't2s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't2s1_dnsbrif'}], u'ns_name': u't2ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.11.2/24', u'tenant_ns_ip': u'10.2.11.1/24', u'tenant_ns_if': u't2ns1if', u'tenant_sub_if': u't2s1if', u'tenant_ns_name': u't2'}], u'bridge_ip': u'1.1.1.1', u'vms': [{u'mem': 2, u'name': u't2_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't2br1if1', u'vmif': u't2VM4if1'}]}, {u'local_ip': u'10.2.11.2', u'dsport': 4789, u'dev': u't2s1if', u'tenant_route_ip': u'192.168.130.2', u'remote_route': u'10.1.11.0/24', u'subnet_route': u'10.2.11.0/24', u'v_name': u'vxlan_t2s1', u'id': 42, u'remote_ip': u'10.1.11.2'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t2ns1\" ip link show \"vxlan_t2s1\" ; if [ $? -ne 0 ] ; then ip netns exec \"t2ns1\" ip link add \"vxlan_t2s1\" type vxlan id \"42\" local \"10.2.11.2\" remote \"10.1.11.2\" dstport \"4789\" dev \"t2s1if\" ; ip netns exec \"t2ns1\" ip link set dev \"vxlan_t2s1\" up ; fi\n", "delta": "0:00:00.035467", "end": "2019-11-17 10:51:29.016561", "item": [{"bridge_ip": "1.1.1.1", "bridge_name": "t2br1", "default_route_ip": "10.2.11.1", "dns": [{"brif": "t2s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t2s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns1", "route": [{"if": "p1", "ip": "10.2.11.1/24", "ns_if": "t2if", "ns_name": "t2"}], "tenant_ns": [{"tenant_ns_if": "t2ns1if", "tenant_ns_ip": "10.2.11.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s1if", "tenant_sub_ip": "10.2.11.2/24"}], "vms": [{"brif": "t2br1if1", "disk": "10G", "mem": 2, "name": "t2_VM4", "vcpu": 4, "vmif": "t2VM4if1"}]}, {"dev": "t2s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.11.2", "remote_ip": "10.1.11.2", "remote_route": "10.1.11.0/24", "subnet_route": "10.2.11.0/24", "tenant_route_ip": "192.168.130.2", "v_name": "vxlan_t2s1"}], "rc": 0, "start": "2019-11-17 10:51:28.981094", "stderr": "", "stderr_lines": [], "stdout": "5: vxlan_t2s1: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1450 qdisc noqueue master t2br1 state UNKNOWN mode DEFAULT group default qlen 1000\n    link/ether 76:fc:12:e1:f2:9f brd ff:ff:ff:ff:ff:ff", "stdout_lines": ["5: vxlan_t2s1: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1450 qdisc noqueue master t2br1 state UNKNOWN mode DEFAULT group default qlen 1000", "    link/ether 76:fc:12:e1:f2:9f brd ff:ff:ff:ff:ff:ff"]}

TASK [Attach VXLANs to bridge] ******************************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.11.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.2.11.1', u'bridge_name': u't2br1', u'dns': [{u'dnsif': u't2s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't2s1_dnsbrif'}], u'ns_name': u't2ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.11.2/24', u'tenant_ns_ip': u'10.2.11.1/24', u'tenant_ns_if': u't2ns1if', u'tenant_sub_if': u't2s1if', u'tenant_ns_name': u't2'}], u'bridge_ip': u'1.1.1.1', u'vms': [{u'mem': 2, u'name': u't2_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't2br1if1', u'vmif': u't2VM4if1'}]}, {u'local_ip': u'10.2.11.2', u'dsport': 4789, u'dev': u't2s1if', u'tenant_route_ip': u'192.168.130.2', u'remote_route': u'10.1.11.0/24', u'subnet_route': u'10.2.11.0/24', u'v_name': u'vxlan_t2s1', u'id': 42, u'remote_ip': u'10.1.11.2'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec \"t2ns1\" brctl show \"t2br1\" | grep -w 'vxlan_t2s1' ; if [ $? -ne 0 ] ; then ip netns exec \"t2ns1\" brctl addif \"t2br1\" \"vxlan_t2s1\" ; fi\n", "delta": "0:00:00.035412", "end": "2019-11-17 10:51:29.464601", "item": [{"bridge_ip": "1.1.1.1", "bridge_name": "t2br1", "default_route_ip": "10.2.11.1", "dns": [{"brif": "t2s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t2s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns1", "route": [{"if": "p1", "ip": "10.2.11.1/24", "ns_if": "t2if", "ns_name": "t2"}], "tenant_ns": [{"tenant_ns_if": "t2ns1if", "tenant_ns_ip": "10.2.11.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s1if", "tenant_sub_ip": "10.2.11.2/24"}], "vms": [{"brif": "t2br1if1", "disk": "10G", "mem": 2, "name": "t2_VM4", "vcpu": 4, "vmif": "t2VM4if1"}]}, {"dev": "t2s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.11.2", "remote_ip": "10.1.11.2", "remote_route": "10.1.11.0/24", "subnet_route": "10.2.11.0/24", "tenant_route_ip": "192.168.130.2", "v_name": "vxlan_t2s1"}], "rc": 0, "start": "2019-11-17 10:51:29.429189", "stderr": "", "stderr_lines": [], "stdout": "\t\t\t\t\t\t\tvxlan_t2s1", "stdout_lines": ["\t\t\t\t\t\t\tvxlan_t2s1"]}

PLAY RECAP **************************************************************************************************************************************************
99.99.99.2                 : ok=21   changed=19   unreachable=0    failed=0    skipped=0    rescued=0    ignored=0   

Using /etc/ansible/ansible.cfg as config file

PLAY [main] *************************************************************************************************************************************************

TASK [Add VXLAN routes in PNS] ******************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.11.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.1.11.1', u'bridge_name': u't2br1', u'dns': [{u'dnsif': u't2s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't2s1_dnsbrif'}], u'ns_name': u't2ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.11.2/24', u'tenant_ns_ip': u'10.1.11.1/24', u'tenant_ns_if': u't2ns1if', u'tenant_sub_if': u't2s1if', u'tenant_ns_name': u't2'}], u'bridge_ip': u'1.1.1.1', u'vms': [{u'mem': 2, u'name': u't2_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't2br1if1', u'vmif': u't2VM1if1'}]}, {u'local_ip': u'10.1.11.2', u'dsport': 4789, u'dev': u't2s1if', u'tenant_route_ip': u'192.168.2.2', u'remote_route': u'10.2.11.0/24', u'subnet_route': u'10.1.11.0/24', u'v_name': u'vxlan_t2s1', u'id': 42, u'remote_ip': u'10.2.11.2'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec pns ip route show \"10.1.11.0/24\" via \"192.168.2.2\" | grep -w '^10.1.11.0/24' ; if [ $? -ne 0 ] ; then ip netns exec pns ip route add \"10.1.11.0/24\" via \"192.168.2.2\" ; fi\n", "delta": "0:00:00.035807", "end": "2019-11-17 10:51:30.563622", "item": [{"bridge_ip": "1.1.1.1", "bridge_name": "t2br1", "default_route_ip": "10.1.11.1", "dns": [{"brif": "t2s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t2s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns1", "route": [{"if": "p1", "ip": "10.1.11.1/24", "ns_if": "t2if", "ns_name": "t2"}], "tenant_ns": [{"tenant_ns_if": "t2ns1if", "tenant_ns_ip": "10.1.11.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s1if", "tenant_sub_ip": "10.1.11.2/24"}], "vms": [{"brif": "t2br1if1", "disk": "10G", "mem": 2, "name": "t2_VM1", "vcpu": 4, "vmif": "t2VM1if1"}]}, {"dev": "t2s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.11.2", "remote_ip": "10.2.11.2", "remote_route": "10.2.11.0/24", "subnet_route": "10.1.11.0/24", "tenant_route_ip": "192.168.2.2", "v_name": "vxlan_t2s1"}], "rc": 0, "start": "2019-11-17 10:51:30.527815", "stderr": "", "stderr_lines": [], "stdout": "10.1.11.0/24 dev t2pns_if ", "stdout_lines": ["10.1.11.0/24 dev t2pns_if "]}
skipping: [localhost] => (item=[{u'route': [{u'ip': u'10.1.12.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.1.12.1', u'bridge_name': u't2br2', u'dns': [{u'dnsif': u't2s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't2s2_dnsbrif'}], u'ns_name': u't2ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.12.2/24', u'tenant_ns_ip': u'10.1.12.1/24', u'tenant_ns_if': u't2ns2if', u'tenant_sub_if': u't2s2if', u'tenant_ns_name': u't2'}], u'bridge_ip': u'2.2.2.1', u'vms': [{u'mem': 3, u'name': u't2_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't2br2if1', u'vmif': u't2VM3if1'}]}, {u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}])  => {"ansible_loop_var": "item", "changed": false, "item": [{"bridge_ip": "2.2.2.1", "bridge_name": "t2br2", "default_route_ip": "10.1.12.1", "dns": [{"brif": "t2s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t2s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns2", "route": [{"if": "p1", "ip": "10.1.12.1/24", "ns_if": "t2if", "ns_name": "t2"}], "tenant_ns": [{"tenant_ns_if": "t2ns2if", "tenant_ns_ip": "10.1.12.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s2if", "tenant_sub_ip": "10.1.12.2/24"}], "vms": [{"brif": "t2br2if1", "disk": "10G", "mem": 3, "name": "t2_VM3", "vcpu": 2, "vmif": "t2VM3if1"}]}, {"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}], "skip_reason": "Conditional result was False"}

TASK [Get PNS ip address] ***********************************************************************************************************************************
ok: [localhost] => {"changed": false, "cmd": "ip netns exec pns ip addr show p1 | awk 'FNR==3{ print $2 }' | awk -F/ '{ print $1 }'\n", "delta": "0:00:00.039786", "end": "2019-11-17 10:51:30.884165", "rc": 0, "start": "2019-11-17 10:51:30.844379", "stderr": "", "stderr_lines": [], "stdout": "192.168.100.238", "stdout_lines": ["192.168.100.238"]}

TASK [Add VXLAN routes to host] *****************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.11.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.1.11.1', u'bridge_name': u't2br1', u'dns': [{u'dnsif': u't2s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't2s1_dnsbrif'}], u'ns_name': u't2ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.11.2/24', u'tenant_ns_ip': u'10.1.11.1/24', u'tenant_ns_if': u't2ns1if', u'tenant_sub_if': u't2s1if', u'tenant_ns_name': u't2'}], u'bridge_ip': u'1.1.1.1', u'vms': [{u'mem': 2, u'name': u't2_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't2br1if1', u'vmif': u't2VM1if1'}]}, {u'local_ip': u'10.1.11.2', u'dsport': 4789, u'dev': u't2s1if', u'tenant_route_ip': u'192.168.2.2', u'remote_route': u'10.2.11.0/24', u'subnet_route': u'10.1.11.0/24', u'v_name': u'vxlan_t2s1', u'id': 42, u'remote_ip': u'10.2.11.2'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip route show \"10.1.11.0/24\" via \"192.168.100.238\" | grep -w '^10.1.11.0/24' ; if [ $? -ne 0 ] ; then ip route add \"10.1.11.0/24\" via \"192.168.100.238\" ; fi\nip route show \"10.2.11.0/24\" via 99.99.99.2 | grep -w '^10.2.11.0/24'; if [ $? -ne 0 ] ; then ip route add \"10.2.11.0/24\" via 99.99.99.2 ; fi\n", "delta": "0:00:00.005566", "end": "2019-11-17 10:51:31.202132", "item": [{"bridge_ip": "1.1.1.1", "bridge_name": "t2br1", "default_route_ip": "10.1.11.1", "dns": [{"brif": "t2s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t2s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns1", "route": [{"if": "p1", "ip": "10.1.11.1/24", "ns_if": "t2if", "ns_name": "t2"}], "tenant_ns": [{"tenant_ns_if": "t2ns1if", "tenant_ns_ip": "10.1.11.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s1if", "tenant_sub_ip": "10.1.11.2/24"}], "vms": [{"brif": "t2br1if1", "disk": "10G", "mem": 2, "name": "t2_VM1", "vcpu": 4, "vmif": "t2VM1if1"}]}, {"dev": "t2s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.11.2", "remote_ip": "10.2.11.2", "remote_route": "10.2.11.0/24", "subnet_route": "10.1.11.0/24", "tenant_route_ip": "192.168.2.2", "v_name": "vxlan_t2s1"}], "rc": 0, "start": "2019-11-17 10:51:31.196566", "stderr": "", "stderr_lines": [], "stdout": "10.1.11.0/24 dev testBR \n10.2.11.0/24 dev ens4 ", "stdout_lines": ["10.1.11.0/24 dev testBR ", "10.2.11.0/24 dev ens4 "]}
skipping: [localhost] => (item=[{u'route': [{u'ip': u'10.1.12.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.1.12.1', u'bridge_name': u't2br2', u'dns': [{u'dnsif': u't2s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't2s2_dnsbrif'}], u'ns_name': u't2ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.12.2/24', u'tenant_ns_ip': u'10.1.12.1/24', u'tenant_ns_if': u't2ns2if', u'tenant_sub_if': u't2s2if', u'tenant_ns_name': u't2'}], u'bridge_ip': u'2.2.2.1', u'vms': [{u'mem': 3, u'name': u't2_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't2br2if1', u'vmif': u't2VM3if1'}]}, {u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}])  => {"ansible_loop_var": "item", "changed": false, "item": [{"bridge_ip": "2.2.2.1", "bridge_name": "t2br2", "default_route_ip": "10.1.12.1", "dns": [{"brif": "t2s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t2s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns2", "route": [{"if": "p1", "ip": "10.1.12.1/24", "ns_if": "t2if", "ns_name": "t2"}], "tenant_ns": [{"tenant_ns_if": "t2ns2if", "tenant_ns_ip": "10.1.12.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s2if", "tenant_sub_ip": "10.1.12.2/24"}], "vms": [{"brif": "t2br2if1", "disk": "10G", "mem": 3, "name": "t2_VM3", "vcpu": 2, "vmif": "t2VM3if1"}]}, {"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}], "skip_reason": "Conditional result was False"}

PLAY RECAP **************************************************************************************************************************************************
localhost                  : ok=3    changed=2    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0   

Using /etc/ansible/ansible.cfg as config file

PLAY [worker] ***********************************************************************************************************************************************

TASK [Add VXLAN routes in PNS] ******************************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.11.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.2.11.1', u'bridge_name': u't2br1', u'dns': [{u'dnsif': u't2s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't2s1_dnsbrif'}], u'ns_name': u't2ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.11.2/24', u'tenant_ns_ip': u'10.2.11.1/24', u'tenant_ns_if': u't2ns1if', u'tenant_sub_if': u't2s1if', u'tenant_ns_name': u't2'}], u'bridge_ip': u'1.1.1.1', u'vms': [{u'mem': 2, u'name': u't2_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't2br1if1', u'vmif': u't2VM4if1'}]}, {u'local_ip': u'10.2.11.2', u'dsport': 4789, u'dev': u't2s1if', u'tenant_route_ip': u'192.168.130.2', u'remote_route': u'10.1.11.0/24', u'subnet_route': u'10.2.11.0/24', u'v_name': u'vxlan_t2s1', u'id': 42, u'remote_ip': u'10.1.11.2'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip netns exec pns ip route show \"10.2.11.0/24\" via \"192.168.130.2\" | grep -w '^10.2.11.0/24' ; if [ $? -ne 0 ] ; then ip netns exec pns ip route add \"10.2.11.0/24\" via \"192.168.130.2\" ; fi\n", "delta": "0:00:00.034000", "end": "2019-11-17 10:51:32.424655", "item": [{"bridge_ip": "1.1.1.1", "bridge_name": "t2br1", "default_route_ip": "10.2.11.1", "dns": [{"brif": "t2s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t2s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns1", "route": [{"if": "p1", "ip": "10.2.11.1/24", "ns_if": "t2if", "ns_name": "t2"}], "tenant_ns": [{"tenant_ns_if": "t2ns1if", "tenant_ns_ip": "10.2.11.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s1if", "tenant_sub_ip": "10.2.11.2/24"}], "vms": [{"brif": "t2br1if1", "disk": "10G", "mem": 2, "name": "t2_VM4", "vcpu": 4, "vmif": "t2VM4if1"}]}, {"dev": "t2s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.11.2", "remote_ip": "10.1.11.2", "remote_route": "10.1.11.0/24", "subnet_route": "10.2.11.0/24", "tenant_route_ip": "192.168.130.2", "v_name": "vxlan_t2s1"}], "rc": 0, "start": "2019-11-17 10:51:32.390655", "stderr": "", "stderr_lines": [], "stdout": "10.2.11.0/24 dev t2pns_if ", "stdout_lines": ["10.2.11.0/24 dev t2pns_if "]}

TASK [Get PNS ip address] ***********************************************************************************************************************************
ok: [99.99.99.2] => {"changed": false, "cmd": "ip netns exec pns ip addr show p1 | awk 'FNR==3{ print $2 }' | awk -F/ '{ print $1 }'\n", "delta": "0:00:00.033282", "end": "2019-11-17 10:51:32.848995", "rc": 0, "start": "2019-11-17 10:51:32.815713", "stderr": "", "stderr_lines": [], "stdout": "192.168.100.50", "stdout_lines": ["192.168.100.50"]}

TASK [Add VXLAN routes to host] *****************************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.11.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.2.11.1', u'bridge_name': u't2br1', u'dns': [{u'dnsif': u't2s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't2s1_dnsbrif'}], u'ns_name': u't2ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.11.2/24', u'tenant_ns_ip': u'10.2.11.1/24', u'tenant_ns_if': u't2ns1if', u'tenant_sub_if': u't2s1if', u'tenant_ns_name': u't2'}], u'bridge_ip': u'1.1.1.1', u'vms': [{u'mem': 2, u'name': u't2_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't2br1if1', u'vmif': u't2VM4if1'}]}, {u'local_ip': u'10.2.11.2', u'dsport': 4789, u'dev': u't2s1if', u'tenant_route_ip': u'192.168.130.2', u'remote_route': u'10.1.11.0/24', u'subnet_route': u'10.2.11.0/24', u'v_name': u'vxlan_t2s1', u'id': 42, u'remote_ip': u'10.1.11.2'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "ip route show \"10.2.11.0/24\" via \"192.168.100.50\" | grep -w '^10.2.11.0/24' ; if [ $? -ne 0 ] ; then ip route add \"10.2.11.0/24\" via \"192.168.100.50\" ; fi\nip route show \"10.1.11.0/24\" via 99.99.99.1 | grep -w '^10.1.11.0/24'; if [ $? -ne 0 ] ; then ip route add \"10.1.11.0/24\" via 99.99.99.1 ; fi\n", "delta": "0:00:00.005288", "end": "2019-11-17 10:51:33.247699", "item": [{"bridge_ip": "1.1.1.1", "bridge_name": "t2br1", "default_route_ip": "10.2.11.1", "dns": [{"brif": "t2s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t2s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns1", "route": [{"if": "p1", "ip": "10.2.11.1/24", "ns_if": "t2if", "ns_name": "t2"}], "tenant_ns": [{"tenant_ns_if": "t2ns1if", "tenant_ns_ip": "10.2.11.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s1if", "tenant_sub_ip": "10.2.11.2/24"}], "vms": [{"brif": "t2br1if1", "disk": "10G", "mem": 2, "name": "t2_VM4", "vcpu": 4, "vmif": "t2VM4if1"}]}, {"dev": "t2s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.11.2", "remote_ip": "10.1.11.2", "remote_route": "10.1.11.0/24", "subnet_route": "10.2.11.0/24", "tenant_route_ip": "192.168.130.2", "v_name": "vxlan_t2s1"}], "rc": 0, "start": "2019-11-17 10:51:33.242411", "stderr": "", "stderr_lines": [], "stdout": "10.2.11.0/24 dev testBR \n10.1.11.0/24 dev ens4 ", "stdout_lines": ["10.2.11.0/24 dev testBR ", "10.1.11.0/24 dev ens4 "]}

PLAY RECAP **************************************************************************************************************************************************
99.99.99.2                 : ok=3    changed=2    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0   

Using /etc/ansible/ansible.cfg as config file

PLAY [main] *************************************************************************************************************************************************

TASK [Create VM templates (C1)] *****************************************************************************************************************************
ok: [localhost] => (item=[{u'route': [{u'ip': u'10.1.11.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.1.11.1', u'bridge_name': u't2br1', u'dns': [{u'dnsif': u't2s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't2s1_dnsbrif'}], u'ns_name': u't2ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.11.2/24', u'tenant_ns_ip': u'10.1.11.1/24', u'tenant_ns_if': u't2ns1if', u'tenant_sub_if': u't2s1if', u'tenant_ns_name': u't2'}], u'bridge_ip': u'1.1.1.1', u'vxlan': [{u'local_ip': u'10.1.11.2', u'dsport': 4789, u'dev': u't2s1if', u'tenant_route_ip': u'192.168.2.2', u'remote_route': u'10.2.11.0/24', u'subnet_route': u'10.1.11.0/24', u'v_name': u'vxlan_t2s1', u'id': 42, u'remote_ip': u'10.2.11.2'}]}, {u'mem': 2, u'name': u't2_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't2br1if1', u'vmif': u't2VM1if1'}]) => {"ansible_loop_var": "item", "changed": false, "checksum": "350ba870bd31b7f6ee517845c14237910b5af0bf", "dest": "/root/Migration-as-a-Service/t2/VM_templates/t2_VM1.xml.j2", "gid": 0, "group": "root", "item": [{"bridge_ip": "1.1.1.1", "bridge_name": "t2br1", "default_route_ip": "10.1.11.1", "dns": [{"brif": "t2s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t2s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns1", "route": [{"if": "p1", "ip": "10.1.11.1/24", "ns_if": "t2if", "ns_name": "t2"}], "tenant_ns": [{"tenant_ns_if": "t2ns1if", "tenant_ns_ip": "10.1.11.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s1if", "tenant_sub_ip": "10.1.11.2/24"}], "vxlan": [{"dev": "t2s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.11.2", "remote_ip": "10.2.11.2", "remote_route": "10.2.11.0/24", "subnet_route": "10.1.11.0/24", "tenant_route_ip": "192.168.2.2", "v_name": "vxlan_t2s1"}]}, {"brif": "t2br1if1", "disk": "10G", "mem": 2, "name": "t2_VM1", "vcpu": 4, "vmif": "t2VM1if1"}], "mode": "0644", "owner": "root", "path": "/root/Migration-as-a-Service/t2/VM_templates/t2_VM1.xml.j2", "size": 4091, "state": "file", "uid": 0}
ok: [localhost] => (item=[{u'route': [{u'ip': u'10.1.12.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.1.12.1', u'bridge_name': u't2br2', u'dns': [{u'dnsif': u't2s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't2s2_dnsbrif'}], u'ns_name': u't2ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.12.2/24', u'tenant_ns_ip': u'10.1.12.1/24', u'tenant_ns_if': u't2ns2if', u'tenant_sub_if': u't2s2if', u'tenant_ns_name': u't2'}], u'bridge_ip': u'2.2.2.1', u'vxlan': [{u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}, {u'mem': 3, u'name': u't2_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't2br2if1', u'vmif': u't2VM3if1'}]) => {"ansible_loop_var": "item", "changed": false, "checksum": "350ba870bd31b7f6ee517845c14237910b5af0bf", "dest": "/root/Migration-as-a-Service/t2/VM_templates/t2_VM3.xml.j2", "gid": 0, "group": "root", "item": [{"bridge_ip": "2.2.2.1", "bridge_name": "t2br2", "default_route_ip": "10.1.12.1", "dns": [{"brif": "t2s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t2s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns2", "route": [{"if": "p1", "ip": "10.1.12.1/24", "ns_if": "t2if", "ns_name": "t2"}], "tenant_ns": [{"tenant_ns_if": "t2ns2if", "tenant_ns_ip": "10.1.12.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s2if", "tenant_sub_ip": "10.1.12.2/24"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, {"brif": "t2br2if1", "disk": "10G", "mem": 3, "name": "t2_VM3", "vcpu": 2, "vmif": "t2VM3if1"}], "mode": "0644", "owner": "root", "path": "/root/Migration-as-a-Service/t2/VM_templates/t2_VM3.xml.j2", "size": 4091, "state": "file", "uid": 0}

PLAY RECAP **************************************************************************************************************************************************
localhost                  : ok=1    changed=0    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0   

Using /etc/ansible/ansible.cfg as config file

PLAY [main] *************************************************************************************************************************************************

TASK [Create VM templates (C2)] *****************************************************************************************************************************
ok: [localhost] => (item=[{u'route': [{u'ip': u'10.2.11.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.2.11.1', u'bridge_name': u't2br1', u'dns': [{u'dnsif': u't2s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't2s1_dnsbrif'}], u'ns_name': u't2ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.11.2/24', u'tenant_ns_ip': u'10.2.11.1/24', u'tenant_ns_if': u't2ns1if', u'tenant_sub_if': u't2s1if', u'tenant_ns_name': u't2'}], u'bridge_ip': u'1.1.1.1', u'vxlan': [{u'local_ip': u'10.2.11.2', u'dsport': 4789, u'dev': u't2s1if', u'tenant_route_ip': u'192.168.130.2', u'remote_route': u'10.1.11.0/24', u'subnet_route': u'10.2.11.0/24', u'v_name': u'vxlan_t2s1', u'id': 42, u'remote_ip': u'10.1.11.2'}]}, {u'mem': 2, u'name': u't2_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't2br1if1', u'vmif': u't2VM4if1'}]) => {"ansible_loop_var": "item", "changed": false, "checksum": "350ba870bd31b7f6ee517845c14237910b5af0bf", "dest": "/root/Migration-as-a-Service/t2/VM_templates/t2_VM4.xml.j2", "gid": 0, "group": "root", "item": [{"bridge_ip": "1.1.1.1", "bridge_name": "t2br1", "default_route_ip": "10.2.11.1", "dns": [{"brif": "t2s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t2s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns1", "route": [{"if": "p1", "ip": "10.2.11.1/24", "ns_if": "t2if", "ns_name": "t2"}], "tenant_ns": [{"tenant_ns_if": "t2ns1if", "tenant_ns_ip": "10.2.11.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s1if", "tenant_sub_ip": "10.2.11.2/24"}], "vxlan": [{"dev": "t2s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.11.2", "remote_ip": "10.1.11.2", "remote_route": "10.1.11.0/24", "subnet_route": "10.2.11.0/24", "tenant_route_ip": "192.168.130.2", "v_name": "vxlan_t2s1"}]}, {"brif": "t2br1if1", "disk": "10G", "mem": 2, "name": "t2_VM4", "vcpu": 4, "vmif": "t2VM4if1"}], "mode": "0644", "owner": "root", "path": "/root/Migration-as-a-Service/t2/VM_templates/t2_VM4.xml.j2", "size": 4091, "state": "file", "uid": 0}

PLAY RECAP **************************************************************************************************************************************************
localhost                  : ok=1    changed=0    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0   

Using /etc/ansible/ansible.cfg as config file

PLAY [main] *************************************************************************************************************************************************

TASK [Copy VM image] ****************************************************************************************************************************************
ok: [localhost] => (item=[{u'route': [{u'ip': u'10.1.11.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.1.11.1', u'bridge_name': u't2br1', u'dns': [{u'dnsif': u't2s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't2s1_dnsbrif'}], u'ns_name': u't2ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.11.2/24', u'tenant_ns_ip': u'10.1.11.1/24', u'tenant_ns_if': u't2ns1if', u'tenant_sub_if': u't2s1if', u'tenant_ns_name': u't2'}], u'bridge_ip': u'1.1.1.1', u'vxlan': [{u'local_ip': u'10.1.11.2', u'dsport': 4789, u'dev': u't2s1if', u'tenant_route_ip': u'192.168.2.2', u'remote_route': u'10.2.11.0/24', u'subnet_route': u'10.1.11.0/24', u'v_name': u'vxlan_t2s1', u'id': 42, u'remote_ip': u'10.2.11.2'}]}, {u'mem': 2, u'name': u't2_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't2br1if1', u'vmif': u't2VM1if1'}]) => {"ansible_loop_var": "item", "changed": false, "dest": "/var/lib/libvirt/images/t2_VM1.qcow2", "item": [{"bridge_ip": "1.1.1.1", "bridge_name": "t2br1", "default_route_ip": "10.1.11.1", "dns": [{"brif": "t2s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t2s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns1", "route": [{"if": "p1", "ip": "10.1.11.1/24", "ns_if": "t2if", "ns_name": "t2"}], "tenant_ns": [{"tenant_ns_if": "t2ns1if", "tenant_ns_ip": "10.1.11.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s1if", "tenant_sub_ip": "10.1.11.2/24"}], "vxlan": [{"dev": "t2s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.11.2", "remote_ip": "10.2.11.2", "remote_route": "10.2.11.0/24", "subnet_route": "10.1.11.0/24", "tenant_route_ip": "192.168.2.2", "v_name": "vxlan_t2s1"}]}, {"brif": "t2br1if1", "disk": "10G", "mem": 2, "name": "t2_VM1", "vcpu": 4, "vmif": "t2VM1if1"}], "src": "/root/mainVM.qcow2"}
ok: [localhost] => (item=[{u'route': [{u'ip': u'10.1.12.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.1.12.1', u'bridge_name': u't2br2', u'dns': [{u'dnsif': u't2s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't2s2_dnsbrif'}], u'ns_name': u't2ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.12.2/24', u'tenant_ns_ip': u'10.1.12.1/24', u'tenant_ns_if': u't2ns2if', u'tenant_sub_if': u't2s2if', u'tenant_ns_name': u't2'}], u'bridge_ip': u'2.2.2.1', u'vxlan': [{u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}, {u'mem': 3, u'name': u't2_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't2br2if1', u'vmif': u't2VM3if1'}]) => {"ansible_loop_var": "item", "changed": false, "dest": "/var/lib/libvirt/images/t2_VM3.qcow2", "item": [{"bridge_ip": "2.2.2.1", "bridge_name": "t2br2", "default_route_ip": "10.1.12.1", "dns": [{"brif": "t2s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t2s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns2", "route": [{"if": "p1", "ip": "10.1.12.1/24", "ns_if": "t2if", "ns_name": "t2"}], "tenant_ns": [{"tenant_ns_if": "t2ns2if", "tenant_ns_ip": "10.1.12.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s2if", "tenant_sub_ip": "10.1.12.2/24"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, {"brif": "t2br2if1", "disk": "10G", "mem": 3, "name": "t2_VM3", "vcpu": 2, "vmif": "t2VM3if1"}], "src": "/root/mainVM.qcow2"}

TASK [Create VM templates (C1)] *****************************************************************************************************************************
ok: [localhost] => (item=[{u'route': [{u'ip': u'10.1.11.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.1.11.1', u'bridge_name': u't2br1', u'dns': [{u'dnsif': u't2s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't2s1_dnsbrif'}], u'ns_name': u't2ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.11.2/24', u'tenant_ns_ip': u'10.1.11.1/24', u'tenant_ns_if': u't2ns1if', u'tenant_sub_if': u't2s1if', u'tenant_ns_name': u't2'}], u'bridge_ip': u'1.1.1.1', u'vxlan': [{u'local_ip': u'10.1.11.2', u'dsport': 4789, u'dev': u't2s1if', u'tenant_route_ip': u'192.168.2.2', u'remote_route': u'10.2.11.0/24', u'subnet_route': u'10.1.11.0/24', u'v_name': u'vxlan_t2s1', u'id': 42, u'remote_ip': u'10.2.11.2'}]}, {u'mem': 2, u'name': u't2_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't2br1if1', u'vmif': u't2VM1if1'}]) => {"ansible_loop_var": "item", "changed": false, "checksum": "350ba870bd31b7f6ee517845c14237910b5af0bf", "dest": "/root/Migration-as-a-Service/t2/VM_templates/t2_VM1.xml.j2", "gid": 0, "group": "root", "item": [{"bridge_ip": "1.1.1.1", "bridge_name": "t2br1", "default_route_ip": "10.1.11.1", "dns": [{"brif": "t2s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t2s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns1", "route": [{"if": "p1", "ip": "10.1.11.1/24", "ns_if": "t2if", "ns_name": "t2"}], "tenant_ns": [{"tenant_ns_if": "t2ns1if", "tenant_ns_ip": "10.1.11.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s1if", "tenant_sub_ip": "10.1.11.2/24"}], "vxlan": [{"dev": "t2s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.11.2", "remote_ip": "10.2.11.2", "remote_route": "10.2.11.0/24", "subnet_route": "10.1.11.0/24", "tenant_route_ip": "192.168.2.2", "v_name": "vxlan_t2s1"}]}, {"brif": "t2br1if1", "disk": "10G", "mem": 2, "name": "t2_VM1", "vcpu": 4, "vmif": "t2VM1if1"}], "mode": "0644", "owner": "root", "path": "/root/Migration-as-a-Service/t2/VM_templates/t2_VM1.xml.j2", "size": 4091, "state": "file", "uid": 0}
ok: [localhost] => (item=[{u'route': [{u'ip': u'10.1.12.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.1.12.1', u'bridge_name': u't2br2', u'dns': [{u'dnsif': u't2s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't2s2_dnsbrif'}], u'ns_name': u't2ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.12.2/24', u'tenant_ns_ip': u'10.1.12.1/24', u'tenant_ns_if': u't2ns2if', u'tenant_sub_if': u't2s2if', u'tenant_ns_name': u't2'}], u'bridge_ip': u'2.2.2.1', u'vxlan': [{u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}, {u'mem': 3, u'name': u't2_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't2br2if1', u'vmif': u't2VM3if1'}]) => {"ansible_loop_var": "item", "changed": false, "checksum": "350ba870bd31b7f6ee517845c14237910b5af0bf", "dest": "/root/Migration-as-a-Service/t2/VM_templates/t2_VM3.xml.j2", "gid": 0, "group": "root", "item": [{"bridge_ip": "2.2.2.1", "bridge_name": "t2br2", "default_route_ip": "10.1.12.1", "dns": [{"brif": "t2s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t2s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns2", "route": [{"if": "p1", "ip": "10.1.12.1/24", "ns_if": "t2if", "ns_name": "t2"}], "tenant_ns": [{"tenant_ns_if": "t2ns2if", "tenant_ns_ip": "10.1.12.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s2if", "tenant_sub_ip": "10.1.12.2/24"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, {"brif": "t2br2if1", "disk": "10G", "mem": 3, "name": "t2_VM3", "vcpu": 2, "vmif": "t2VM3if1"}], "mode": "0644", "owner": "root", "path": "/root/Migration-as-a-Service/t2/VM_templates/t2_VM3.xml.j2", "size": 4091, "state": "file", "uid": 0}

TASK [Get list of running VMs] ******************************************************************************************************************************
ok: [localhost] => {"changed": false, "cmd": ["virsh", "list", "--name"], "delta": "0:00:00.023238", "end": "2019-11-17 10:51:38.168578", "rc": 0, "start": "2019-11-17 10:51:38.145340", "stderr": "", "stderr_lines": [], "stdout": "t1_VM1\nt1_VM2\nt1_VM3\nt2_VM1\nt2_VM2\nt2_VM3\nt3_VM1\nt3_VM2\nt3_VM3", "stdout_lines": ["t1_VM1", "t1_VM2", "t1_VM3", "t2_VM1", "t2_VM2", "t2_VM3", "t3_VM1", "t3_VM2", "t3_VM3"]}

TASK [Define VM] ********************************************************************************************************************************************
skipping: [localhost] => (item=[{u'route': [{u'ip': u'10.1.11.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.1.11.1', u'bridge_name': u't2br1', u'dns': [{u'dnsif': u't2s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't2s1_dnsbrif'}], u'ns_name': u't2ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.11.2/24', u'tenant_ns_ip': u'10.1.11.1/24', u'tenant_ns_if': u't2ns1if', u'tenant_sub_if': u't2s1if', u'tenant_ns_name': u't2'}], u'bridge_ip': u'1.1.1.1', u'vxlan': [{u'local_ip': u'10.1.11.2', u'dsport': 4789, u'dev': u't2s1if', u'tenant_route_ip': u'192.168.2.2', u'remote_route': u'10.2.11.0/24', u'subnet_route': u'10.1.11.0/24', u'v_name': u'vxlan_t2s1', u'id': 42, u'remote_ip': u'10.2.11.2'}]}, {u'mem': 2, u'name': u't2_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't2br1if1', u'vmif': u't2VM1if1'}])  => {"ansible_loop_var": "item", "changed": false, "item": [{"bridge_ip": "1.1.1.1", "bridge_name": "t2br1", "default_route_ip": "10.1.11.1", "dns": [{"brif": "t2s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t2s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns1", "route": [{"if": "p1", "ip": "10.1.11.1/24", "ns_if": "t2if", "ns_name": "t2"}], "tenant_ns": [{"tenant_ns_if": "t2ns1if", "tenant_ns_ip": "10.1.11.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s1if", "tenant_sub_ip": "10.1.11.2/24"}], "vxlan": [{"dev": "t2s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.11.2", "remote_ip": "10.2.11.2", "remote_route": "10.2.11.0/24", "subnet_route": "10.1.11.0/24", "tenant_route_ip": "192.168.2.2", "v_name": "vxlan_t2s1"}]}, {"brif": "t2br1if1", "disk": "10G", "mem": 2, "name": "t2_VM1", "vcpu": 4, "vmif": "t2VM1if1"}], "skip_reason": "Conditional result was False"}
skipping: [localhost] => (item=[{u'route': [{u'ip': u'10.1.12.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.1.12.1', u'bridge_name': u't2br2', u'dns': [{u'dnsif': u't2s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't2s2_dnsbrif'}], u'ns_name': u't2ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.12.2/24', u'tenant_ns_ip': u'10.1.12.1/24', u'tenant_ns_if': u't2ns2if', u'tenant_sub_if': u't2s2if', u'tenant_ns_name': u't2'}], u'bridge_ip': u'2.2.2.1', u'vxlan': [{u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}, {u'mem': 3, u'name': u't2_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't2br2if1', u'vmif': u't2VM3if1'}])  => {"ansible_loop_var": "item", "changed": false, "item": [{"bridge_ip": "2.2.2.1", "bridge_name": "t2br2", "default_route_ip": "10.1.12.1", "dns": [{"brif": "t2s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t2s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns2", "route": [{"if": "p1", "ip": "10.1.12.1/24", "ns_if": "t2if", "ns_name": "t2"}], "tenant_ns": [{"tenant_ns_if": "t2ns2if", "tenant_ns_ip": "10.1.12.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s2if", "tenant_sub_ip": "10.1.12.2/24"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, {"brif": "t2br2if1", "disk": "10G", "mem": 3, "name": "t2_VM3", "vcpu": 2, "vmif": "t2VM3if1"}], "skip_reason": "Conditional result was False"}

TASK [Create VM] ********************************************************************************************************************************************
skipping: [localhost] => (item=[{u'route': [{u'ip': u'10.1.11.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.1.11.1', u'bridge_name': u't2br1', u'dns': [{u'dnsif': u't2s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't2s1_dnsbrif'}], u'ns_name': u't2ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.11.2/24', u'tenant_ns_ip': u'10.1.11.1/24', u'tenant_ns_if': u't2ns1if', u'tenant_sub_if': u't2s1if', u'tenant_ns_name': u't2'}], u'bridge_ip': u'1.1.1.1', u'vxlan': [{u'local_ip': u'10.1.11.2', u'dsport': 4789, u'dev': u't2s1if', u'tenant_route_ip': u'192.168.2.2', u'remote_route': u'10.2.11.0/24', u'subnet_route': u'10.1.11.0/24', u'v_name': u'vxlan_t2s1', u'id': 42, u'remote_ip': u'10.2.11.2'}]}, {u'mem': 2, u'name': u't2_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't2br1if1', u'vmif': u't2VM1if1'}])  => {"ansible_loop_var": "item", "changed": false, "item": [{"bridge_ip": "1.1.1.1", "bridge_name": "t2br1", "default_route_ip": "10.1.11.1", "dns": [{"brif": "t2s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t2s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns1", "route": [{"if": "p1", "ip": "10.1.11.1/24", "ns_if": "t2if", "ns_name": "t2"}], "tenant_ns": [{"tenant_ns_if": "t2ns1if", "tenant_ns_ip": "10.1.11.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s1if", "tenant_sub_ip": "10.1.11.2/24"}], "vxlan": [{"dev": "t2s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.11.2", "remote_ip": "10.2.11.2", "remote_route": "10.2.11.0/24", "subnet_route": "10.1.11.0/24", "tenant_route_ip": "192.168.2.2", "v_name": "vxlan_t2s1"}]}, {"brif": "t2br1if1", "disk": "10G", "mem": 2, "name": "t2_VM1", "vcpu": 4, "vmif": "t2VM1if1"}], "skip_reason": "Conditional result was False"}
skipping: [localhost] => (item=[{u'route': [{u'ip': u'10.1.12.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.1.12.1', u'bridge_name': u't2br2', u'dns': [{u'dnsif': u't2s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't2s2_dnsbrif'}], u'ns_name': u't2ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.12.2/24', u'tenant_ns_ip': u'10.1.12.1/24', u'tenant_ns_if': u't2ns2if', u'tenant_sub_if': u't2s2if', u'tenant_ns_name': u't2'}], u'bridge_ip': u'2.2.2.1', u'vxlan': [{u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}, {u'mem': 3, u'name': u't2_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't2br2if1', u'vmif': u't2VM3if1'}])  => {"ansible_loop_var": "item", "changed": false, "item": [{"bridge_ip": "2.2.2.1", "bridge_name": "t2br2", "default_route_ip": "10.1.12.1", "dns": [{"brif": "t2s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t2s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns2", "route": [{"if": "p1", "ip": "10.1.12.1/24", "ns_if": "t2if", "ns_name": "t2"}], "tenant_ns": [{"tenant_ns_if": "t2ns2if", "tenant_ns_ip": "10.1.12.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s2if", "tenant_sub_ip": "10.1.12.2/24"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, {"brif": "t2br2if1", "disk": "10G", "mem": 3, "name": "t2_VM3", "vcpu": 2, "vmif": "t2VM3if1"}], "skip_reason": "Conditional result was False"}

TASK [Start VM] *********************************************************************************************************************************************
skipping: [localhost] => (item=[{u'route': [{u'ip': u'10.1.11.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.1.11.1', u'bridge_name': u't2br1', u'dns': [{u'dnsif': u't2s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't2s1_dnsbrif'}], u'ns_name': u't2ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.11.2/24', u'tenant_ns_ip': u'10.1.11.1/24', u'tenant_ns_if': u't2ns1if', u'tenant_sub_if': u't2s1if', u'tenant_ns_name': u't2'}], u'bridge_ip': u'1.1.1.1', u'vxlan': [{u'local_ip': u'10.1.11.2', u'dsport': 4789, u'dev': u't2s1if', u'tenant_route_ip': u'192.168.2.2', u'remote_route': u'10.2.11.0/24', u'subnet_route': u'10.1.11.0/24', u'v_name': u'vxlan_t2s1', u'id': 42, u'remote_ip': u'10.2.11.2'}]}, {u'mem': 2, u'name': u't2_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't2br1if1', u'vmif': u't2VM1if1'}])  => {"ansible_loop_var": "item", "changed": false, "item": [{"bridge_ip": "1.1.1.1", "bridge_name": "t2br1", "default_route_ip": "10.1.11.1", "dns": [{"brif": "t2s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t2s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns1", "route": [{"if": "p1", "ip": "10.1.11.1/24", "ns_if": "t2if", "ns_name": "t2"}], "tenant_ns": [{"tenant_ns_if": "t2ns1if", "tenant_ns_ip": "10.1.11.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s1if", "tenant_sub_ip": "10.1.11.2/24"}], "vxlan": [{"dev": "t2s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.11.2", "remote_ip": "10.2.11.2", "remote_route": "10.2.11.0/24", "subnet_route": "10.1.11.0/24", "tenant_route_ip": "192.168.2.2", "v_name": "vxlan_t2s1"}]}, {"brif": "t2br1if1", "disk": "10G", "mem": 2, "name": "t2_VM1", "vcpu": 4, "vmif": "t2VM1if1"}], "skip_reason": "Conditional result was False"}
skipping: [localhost] => (item=[{u'route': [{u'ip': u'10.1.12.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.1.12.1', u'bridge_name': u't2br2', u'dns': [{u'dnsif': u't2s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't2s2_dnsbrif'}], u'ns_name': u't2ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.12.2/24', u'tenant_ns_ip': u'10.1.12.1/24', u'tenant_ns_if': u't2ns2if', u'tenant_sub_if': u't2s2if', u'tenant_ns_name': u't2'}], u'bridge_ip': u'2.2.2.1', u'vxlan': [{u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}, {u'mem': 3, u'name': u't2_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't2br2if1', u'vmif': u't2VM3if1'}])  => {"ansible_loop_var": "item", "changed": false, "item": [{"bridge_ip": "2.2.2.1", "bridge_name": "t2br2", "default_route_ip": "10.1.12.1", "dns": [{"brif": "t2s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t2s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns2", "route": [{"if": "p1", "ip": "10.1.12.1/24", "ns_if": "t2if", "ns_name": "t2"}], "tenant_ns": [{"tenant_ns_if": "t2ns2if", "tenant_ns_ip": "10.1.12.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s2if", "tenant_sub_ip": "10.1.12.2/24"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, {"brif": "t2br2if1", "disk": "10G", "mem": 3, "name": "t2_VM3", "vcpu": 2, "vmif": "t2VM3if1"}], "skip_reason": "Conditional result was False"}

TASK [Attach VM interface] **********************************************************************************************************************************
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.11.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.1.11.1', u'bridge_name': u't2br1', u'dns': [{u'dnsif': u't2s1_dnsif', u'dhcp_start': u'1.1.1.5', u'dhcp_end': u'1.1.1.126', u'dnsif_ip': u'1.1.1.1/24', u'net_mask': u'255.255.255.0', u'brif': u't2s1_dnsbrif'}], u'ns_name': u't2ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.11.2/24', u'tenant_ns_ip': u'10.1.11.1/24', u'tenant_ns_if': u't2ns1if', u'tenant_sub_if': u't2s1if', u'tenant_ns_name': u't2'}], u'bridge_ip': u'1.1.1.1', u'vxlan': [{u'local_ip': u'10.1.11.2', u'dsport': 4789, u'dev': u't2s1if', u'tenant_route_ip': u'192.168.2.2', u'remote_route': u'10.2.11.0/24', u'subnet_route': u'10.1.11.0/24', u'v_name': u'vxlan_t2s1', u'id': 42, u'remote_ip': u'10.2.11.2'}]}, {u'mem': 2, u'name': u't2_VM1', u'vcpu': 4, u'disk': u'10G', u'brif': u't2br1if1', u'vmif': u't2VM1if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "virsh domiflist \"t2_VM1\" | grep -w 't2VM1if1' ; if [ $? -ne 0 ] ; then virsh attach-interface \"t2_VM1\" direct \"t2VM1if1\" --live --persistent ; fi\n", "delta": "0:00:00.020232", "end": "2019-11-17 10:51:38.481493", "item": [{"bridge_ip": "1.1.1.1", "bridge_name": "t2br1", "default_route_ip": "10.1.11.1", "dns": [{"brif": "t2s1_dnsbrif", "dhcp_end": "1.1.1.126", "dhcp_start": "1.1.1.5", "dnsif": "t2s1_dnsif", "dnsif_ip": "1.1.1.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns1", "route": [{"if": "p1", "ip": "10.1.11.1/24", "ns_if": "t2if", "ns_name": "t2"}], "tenant_ns": [{"tenant_ns_if": "t2ns1if", "tenant_ns_ip": "10.1.11.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s1if", "tenant_sub_ip": "10.1.11.2/24"}], "vxlan": [{"dev": "t2s1if", "dsport": 4789, "id": 42, "local_ip": "10.1.11.2", "remote_ip": "10.2.11.2", "remote_route": "10.2.11.0/24", "subnet_route": "10.1.11.0/24", "tenant_route_ip": "192.168.2.2", "v_name": "vxlan_t2s1"}]}, {"brif": "t2br1if1", "disk": "10G", "mem": 2, "name": "t2_VM1", "vcpu": 4, "vmif": "t2VM1if1"}], "rc": 0, "start": "2019-11-17 10:51:38.461261", "stderr": "", "stderr_lines": [], "stdout": "macvtap3   direct     t2VM1if1   rtl8139     52:54:00:dd:5b:45", "stdout_lines": ["macvtap3   direct     t2VM1if1   rtl8139     52:54:00:dd:5b:45"]}
changed: [localhost] => (item=[{u'route': [{u'ip': u'10.1.12.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.1.12.1', u'bridge_name': u't2br2', u'dns': [{u'dnsif': u't2s2_dnsif', u'dhcp_start': u'2.2.2.5', u'dhcp_end': u'2.2.2.254', u'dnsif_ip': u'2.2.2.1/24', u'net_mask': u'255.255.255.0', u'brif': u't2s2_dnsbrif'}], u'ns_name': u't2ns2', u'tenant_ns': [{u'tenant_sub_ip': u'10.1.12.2/24', u'tenant_ns_ip': u'10.1.12.1/24', u'tenant_ns_if': u't2ns2if', u'tenant_sub_if': u't2s2if', u'tenant_ns_name': u't2'}], u'bridge_ip': u'2.2.2.1', u'vxlan': [{u'local_ip': [], u'dsport': [], u'dev': [], u'tenant_route_ip': [], u'remote_route': [], u'subnet_route': [], u'v_name': [], u'id': [], u'remote_ip': []}]}, {u'mem': 3, u'name': u't2_VM3', u'vcpu': 2, u'disk': u'10G', u'brif': u't2br2if1', u'vmif': u't2VM3if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "virsh domiflist \"t2_VM3\" | grep -w 't2VM3if1' ; if [ $? -ne 0 ] ; then virsh attach-interface \"t2_VM3\" direct \"t2VM3if1\" --live --persistent ; fi\n", "delta": "0:00:00.018194", "end": "2019-11-17 10:51:38.638950", "item": [{"bridge_ip": "2.2.2.1", "bridge_name": "t2br2", "default_route_ip": "10.1.12.1", "dns": [{"brif": "t2s2_dnsbrif", "dhcp_end": "2.2.2.254", "dhcp_start": "2.2.2.5", "dnsif": "t2s2_dnsif", "dnsif_ip": "2.2.2.1/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns2", "route": [{"if": "p1", "ip": "10.1.12.1/24", "ns_if": "t2if", "ns_name": "t2"}], "tenant_ns": [{"tenant_ns_if": "t2ns2if", "tenant_ns_ip": "10.1.12.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s2if", "tenant_sub_ip": "10.1.12.2/24"}], "vxlan": [{"dev": [], "dsport": [], "id": [], "local_ip": [], "remote_ip": [], "remote_route": [], "subnet_route": [], "tenant_route_ip": [], "v_name": []}]}, {"brif": "t2br2if1", "disk": "10G", "mem": 3, "name": "t2_VM3", "vcpu": 2, "vmif": "t2VM3if1"}], "rc": 0, "start": "2019-11-17 10:51:38.620756", "stderr": "", "stderr_lines": [], "stdout": "macvtap5   direct     t2VM3if1   rtl8139     52:54:00:3b:23:70", "stdout_lines": ["macvtap5   direct     t2VM3if1   rtl8139     52:54:00:3b:23:70"]}

PLAY RECAP **************************************************************************************************************************************************
localhost                  : ok=4    changed=1    unreachable=0    failed=0    skipped=3    rescued=0    ignored=0   

Using /etc/ansible/ansible.cfg as config file

PLAY [worker] ***********************************************************************************************************************************************

TASK [Copy VM image] ****************************************************************************************************************************************
ok: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.11.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.2.11.1', u'bridge_name': u't2br1', u'dns': [{u'dnsif': u't2s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't2s1_dnsbrif'}], u'ns_name': u't2ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.11.2/24', u'tenant_ns_ip': u'10.2.11.1/24', u'tenant_ns_if': u't2ns1if', u'tenant_sub_if': u't2s1if', u'tenant_ns_name': u't2'}], u'bridge_ip': u'1.1.1.1', u'vxlan': [{u'local_ip': u'10.2.11.2', u'dsport': 4789, u'dev': u't2s1if', u'tenant_route_ip': u'192.168.130.2', u'remote_route': u'10.1.11.0/24', u'subnet_route': u'10.2.11.0/24', u'v_name': u'vxlan_t2s1', u'id': 42, u'remote_ip': u'10.1.11.2'}]}, {u'mem': 2, u'name': u't2_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't2br1if1', u'vmif': u't2VM4if1'}]) => {"ansible_loop_var": "item", "changed": false, "dest": "/var/lib/libvirt/images/t2_VM4.qcow2", "gid": 113, "group": "kvm", "item": [{"bridge_ip": "1.1.1.1", "bridge_name": "t2br1", "default_route_ip": "10.2.11.1", "dns": [{"brif": "t2s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t2s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns1", "route": [{"if": "p1", "ip": "10.2.11.1/24", "ns_if": "t2if", "ns_name": "t2"}], "tenant_ns": [{"tenant_ns_if": "t2ns1if", "tenant_ns_ip": "10.2.11.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s1if", "tenant_sub_ip": "10.2.11.2/24"}], "vxlan": [{"dev": "t2s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.11.2", "remote_ip": "10.1.11.2", "remote_route": "10.1.11.0/24", "subnet_route": "10.2.11.0/24", "tenant_route_ip": "192.168.130.2", "v_name": "vxlan_t2s1"}]}, {"brif": "t2br1if1", "disk": "10G", "mem": 2, "name": "t2_VM4", "vcpu": 4, "vmif": "t2VM4if1"}], "mode": "0644", "msg": "file already exists", "owner": "libvirt-qemu", "size": 10739318784, "src": "/root/mainVM.qcow2", "state": "file", "uid": 64055}

TASK [Get list of running VMs] ******************************************************************************************************************************
ok: [99.99.99.2] => {"changed": false, "cmd": ["virsh", "list", "--name"], "delta": "0:00:00.026437", "end": "2019-11-17 10:52:27.683919", "rc": 0, "start": "2019-11-17 10:52:27.657482", "stderr": "", "stderr_lines": [], "stdout": "t1_VM4\nt2_VM4\nt3_VM4\nt3_VM5\nt3_VM6", "stdout_lines": ["t1_VM4", "t2_VM4", "t3_VM4", "t3_VM5", "t3_VM6"]}

TASK [Define VM] ********************************************************************************************************************************************
skipping: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.11.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.2.11.1', u'bridge_name': u't2br1', u'dns': [{u'dnsif': u't2s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't2s1_dnsbrif'}], u'ns_name': u't2ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.11.2/24', u'tenant_ns_ip': u'10.2.11.1/24', u'tenant_ns_if': u't2ns1if', u'tenant_sub_if': u't2s1if', u'tenant_ns_name': u't2'}], u'bridge_ip': u'1.1.1.1', u'vxlan': [{u'local_ip': u'10.2.11.2', u'dsport': 4789, u'dev': u't2s1if', u'tenant_route_ip': u'192.168.130.2', u'remote_route': u'10.1.11.0/24', u'subnet_route': u'10.2.11.0/24', u'v_name': u'vxlan_t2s1', u'id': 42, u'remote_ip': u'10.1.11.2'}]}, {u'mem': 2, u'name': u't2_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't2br1if1', u'vmif': u't2VM4if1'}])  => {"ansible_loop_var": "item", "changed": false, "item": [{"bridge_ip": "1.1.1.1", "bridge_name": "t2br1", "default_route_ip": "10.2.11.1", "dns": [{"brif": "t2s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t2s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns1", "route": [{"if": "p1", "ip": "10.2.11.1/24", "ns_if": "t2if", "ns_name": "t2"}], "tenant_ns": [{"tenant_ns_if": "t2ns1if", "tenant_ns_ip": "10.2.11.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s1if", "tenant_sub_ip": "10.2.11.2/24"}], "vxlan": [{"dev": "t2s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.11.2", "remote_ip": "10.1.11.2", "remote_route": "10.1.11.0/24", "subnet_route": "10.2.11.0/24", "tenant_route_ip": "192.168.130.2", "v_name": "vxlan_t2s1"}]}, {"brif": "t2br1if1", "disk": "10G", "mem": 2, "name": "t2_VM4", "vcpu": 4, "vmif": "t2VM4if1"}], "skip_reason": "Conditional result was False"}

TASK [Create VM] ********************************************************************************************************************************************
skipping: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.11.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.2.11.1', u'bridge_name': u't2br1', u'dns': [{u'dnsif': u't2s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't2s1_dnsbrif'}], u'ns_name': u't2ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.11.2/24', u'tenant_ns_ip': u'10.2.11.1/24', u'tenant_ns_if': u't2ns1if', u'tenant_sub_if': u't2s1if', u'tenant_ns_name': u't2'}], u'bridge_ip': u'1.1.1.1', u'vxlan': [{u'local_ip': u'10.2.11.2', u'dsport': 4789, u'dev': u't2s1if', u'tenant_route_ip': u'192.168.130.2', u'remote_route': u'10.1.11.0/24', u'subnet_route': u'10.2.11.0/24', u'v_name': u'vxlan_t2s1', u'id': 42, u'remote_ip': u'10.1.11.2'}]}, {u'mem': 2, u'name': u't2_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't2br1if1', u'vmif': u't2VM4if1'}])  => {"ansible_loop_var": "item", "changed": false, "item": [{"bridge_ip": "1.1.1.1", "bridge_name": "t2br1", "default_route_ip": "10.2.11.1", "dns": [{"brif": "t2s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t2s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns1", "route": [{"if": "p1", "ip": "10.2.11.1/24", "ns_if": "t2if", "ns_name": "t2"}], "tenant_ns": [{"tenant_ns_if": "t2ns1if", "tenant_ns_ip": "10.2.11.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s1if", "tenant_sub_ip": "10.2.11.2/24"}], "vxlan": [{"dev": "t2s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.11.2", "remote_ip": "10.1.11.2", "remote_route": "10.1.11.0/24", "subnet_route": "10.2.11.0/24", "tenant_route_ip": "192.168.130.2", "v_name": "vxlan_t2s1"}]}, {"brif": "t2br1if1", "disk": "10G", "mem": 2, "name": "t2_VM4", "vcpu": 4, "vmif": "t2VM4if1"}], "skip_reason": "Conditional result was False"}

TASK [Start VM] *********************************************************************************************************************************************
skipping: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.11.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.2.11.1', u'bridge_name': u't2br1', u'dns': [{u'dnsif': u't2s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't2s1_dnsbrif'}], u'ns_name': u't2ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.11.2/24', u'tenant_ns_ip': u'10.2.11.1/24', u'tenant_ns_if': u't2ns1if', u'tenant_sub_if': u't2s1if', u'tenant_ns_name': u't2'}], u'bridge_ip': u'1.1.1.1', u'vxlan': [{u'local_ip': u'10.2.11.2', u'dsport': 4789, u'dev': u't2s1if', u'tenant_route_ip': u'192.168.130.2', u'remote_route': u'10.1.11.0/24', u'subnet_route': u'10.2.11.0/24', u'v_name': u'vxlan_t2s1', u'id': 42, u'remote_ip': u'10.1.11.2'}]}, {u'mem': 2, u'name': u't2_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't2br1if1', u'vmif': u't2VM4if1'}])  => {"ansible_loop_var": "item", "changed": false, "item": [{"bridge_ip": "1.1.1.1", "bridge_name": "t2br1", "default_route_ip": "10.2.11.1", "dns": [{"brif": "t2s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t2s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns1", "route": [{"if": "p1", "ip": "10.2.11.1/24", "ns_if": "t2if", "ns_name": "t2"}], "tenant_ns": [{"tenant_ns_if": "t2ns1if", "tenant_ns_ip": "10.2.11.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s1if", "tenant_sub_ip": "10.2.11.2/24"}], "vxlan": [{"dev": "t2s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.11.2", "remote_ip": "10.1.11.2", "remote_route": "10.1.11.0/24", "subnet_route": "10.2.11.0/24", "tenant_route_ip": "192.168.130.2", "v_name": "vxlan_t2s1"}]}, {"brif": "t2br1if1", "disk": "10G", "mem": 2, "name": "t2_VM4", "vcpu": 4, "vmif": "t2VM4if1"}], "skip_reason": "Conditional result was False"}

TASK [Attach VM interface] **********************************************************************************************************************************
changed: [99.99.99.2] => (item=[{u'route': [{u'ip': u'10.2.11.1/24', u'ns_name': u't2', u'ns_if': u't2if', u'if': u'p1'}], u'default_route_ip': u'10.2.11.1', u'bridge_name': u't2br1', u'dns': [{u'dnsif': u't2s1_dnsif', u'dhcp_start': u'1.1.1.133', u'dhcp_end': u'1.1.1.254', u'dnsif_ip': u'1.1.1.128/24', u'net_mask': u'255.255.255.0', u'brif': u't2s1_dnsbrif'}], u'ns_name': u't2ns1', u'tenant_ns': [{u'tenant_sub_ip': u'10.2.11.2/24', u'tenant_ns_ip': u'10.2.11.1/24', u'tenant_ns_if': u't2ns1if', u'tenant_sub_if': u't2s1if', u'tenant_ns_name': u't2'}], u'bridge_ip': u'1.1.1.1', u'vxlan': [{u'local_ip': u'10.2.11.2', u'dsport': 4789, u'dev': u't2s1if', u'tenant_route_ip': u'192.168.130.2', u'remote_route': u'10.1.11.0/24', u'subnet_route': u'10.2.11.0/24', u'v_name': u'vxlan_t2s1', u'id': 42, u'remote_ip': u'10.1.11.2'}]}, {u'mem': 2, u'name': u't2_VM4', u'vcpu': 4, u'disk': u'10G', u'brif': u't2br1if1', u'vmif': u't2VM4if1'}]) => {"ansible_loop_var": "item", "changed": true, "cmd": "virsh domiflist \"t2_VM4\" | grep -w 't2VM4if1' ; if [ $? -ne 0 ] ; then virsh attach-interface \"t2_VM4\" direct \"t2VM4if1\" --live --persistent ; fi\n", "delta": "0:00:00.020251", "end": "2019-11-17 10:52:28.089691", "item": [{"bridge_ip": "1.1.1.1", "bridge_name": "t2br1", "default_route_ip": "10.2.11.1", "dns": [{"brif": "t2s1_dnsbrif", "dhcp_end": "1.1.1.254", "dhcp_start": "1.1.1.133", "dnsif": "t2s1_dnsif", "dnsif_ip": "1.1.1.128/24", "net_mask": "255.255.255.0"}], "ns_name": "t2ns1", "route": [{"if": "p1", "ip": "10.2.11.1/24", "ns_if": "t2if", "ns_name": "t2"}], "tenant_ns": [{"tenant_ns_if": "t2ns1if", "tenant_ns_ip": "10.2.11.1/24", "tenant_ns_name": "t2", "tenant_sub_if": "t2s1if", "tenant_sub_ip": "10.2.11.2/24"}], "vxlan": [{"dev": "t2s1if", "dsport": 4789, "id": 42, "local_ip": "10.2.11.2", "remote_ip": "10.1.11.2", "remote_route": "10.1.11.0/24", "subnet_route": "10.2.11.0/24", "tenant_route_ip": "192.168.130.2", "v_name": "vxlan_t2s1"}]}, {"brif": "t2br1if1", "disk": "10G", "mem": 2, "name": "t2_VM4", "vcpu": 4, "vmif": "t2VM4if1"}], "rc": 0, "start": "2019-11-17 10:52:28.069440", "stderr": "", "stderr_lines": [], "stdout": "macvtap1   direct     t2VM4if1   rtl8139     52:54:00:1c:55:fa", "stdout_lines": ["macvtap1   direct     t2VM4if1   rtl8139     52:54:00:1c:55:fa"]}

PLAY RECAP **************************************************************************************************************************************************
99.99.99.2                 : ok=3    changed=1    unreachable=0    failed=0    skipped=3    rescued=0    ignored=0   

INFO:root: 12:33:23.322706 Printing the yaml input file
INFO:root: 12:33:23.322897 {'C1': [{'subnet_addr': '1.1.1.0/24', 'VM': [{'name': 'VM1', 'disk': '10G', 'mem': 2, 'vcpu': 4}]}, {'subnet_addr': '2.2.2.0/24', 'VM': [{'name': 'VM3', 'disk': '10G', 'mem': 3, 'vcpu': 2}]}], 'C2': [{'subnet_addr': '1.1.1.0/24', 'VM': [{'name': 'VM4', 'disk': '10G', 'mem': 2, 'vcpu': 4}]}]}
INFO:root: 12:33:23.322996 Provided subnet in C1: 1.1.1.0/24 is valid
ERROR:root: 12:33:23.323068Multiple subnet in the C1 are same
